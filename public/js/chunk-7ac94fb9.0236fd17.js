(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7ac94fb9"],{"7bf8":function(t,e,s){"use strict";s("cd9f")},cd9f:function(t,e,s){},f43f:function(t,e,s){"use strict";s.r(e);s("14d9");var i={components:{myHeader:s("7cfd").a},watch:{msgType:function(t,e){this.loadFirstPage()}},data(){return{sideOptionList:[{id:"info",title:this.$t("notice.info"),font:"nasIcons icon-msg-list"},{id:"error",title:this.$t("notice.error"),font:"nasIcons icon-msg-error"}],infoUnReadCount:0,errorUnReadCount:0,msgType:"info",messageList:[],isLoading:!1,hasMore:!0}},mounted(){this.getMessageList()},beforeDestroy(){},computed:{},methods:{setLeftMenuId(t){t=t.id;this.msgType=t},itemClick(t,e){this.showVsAlertDialog(t.title,t.content),this.readMsg(t,e)},markAllRead(){this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("notice.markAllAsRead")+"?",()=>{this.readMsg(null,null,!0)})},deleteAll(){this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("notice.deleteAll")+"?",()=>{this.deleteMsg(null,!0)})},readMsg(t,s,i){t={id:t?t.id:0};i&&(t.isAll=i,t.level=this.msgType),this.api.post("/api/messageApi/read",t).then(t=>{if(!t.code){if(i)for(var e in"info"==this.msgType?this.infoUnReadCount=0:"error"==this.msgType&&(this.errorUnReadCount=0),this.messageList)this.messageList[e].level==this.msgType&&(this.messageList[e].read=1);else this.messageList[s].read=1,"info"==this.msgType?this.infoUnReadCount=parseInt(this.infoUnReadCount)-1:"error"==this.msgType&&(this.errorUnReadCount=parseInt(this.errorUnReadCount)-1);this.$store.state.unreadMsgCount=this.infoUnReadCount+this.errorUnReadCount}}).catch(t=>{})},loadFirstPage(){this.messageList=[],this.hasMore=!0,this.timestamp=0,this.getMessageList()},deleteMsg(e,s){var t={id:null!=e?this.messageList[e].id:null};s&&(t.isAll=s,t.level=this.msgType),this.api.post("/api/messageApi/delete",t).then(t=>{if(!t.code)if(this.showVsNotification(this.$t("common.deleteSuccess")),s)this.messageList=[],this.getMessageList(),"info"==this.msgType?this.infoUnReadCount=0:"error"==this.msgType&&(this.errorUnReadCount=0),this.$store.state.unreadMsgCount=this.infoUnReadCount+this.errorUnReadCount;else for(let t=0;t<this.messageList.length;t++)e==t&&this.messageList.splice(t,1)}).catch(t=>{})},getMessageList(t){!this.isLoading&&this.hasMore&&(this.isLoading=!0,this.api.post("/api/messageApi/getMessage",{msgType:this.msgType,count:20,id:0<this.messageList.length?this.messageList[this.messageList.length-1].id:0}).then(e=>{if(!e.code){for(let t=0;t<e.data.length;t++)e.data[t].create_time_str=new Date(e.data[t].create_time).toLocaleString();e.data.length<20&&(this.hasMore=!1),t?e.data.forEach(t=>{this.messageList.push(t)}):this.messageList=e.data,this.infoUnReadCount=e.infoUnReadCount,this.errorUnReadCount=e.errorUnReadCount}this.isLoading=!1}).catch(t=>{this.isLoading=!1}))},onPageScroll(t){let e=null,s=null;t.srcElement.scrollingElement?(e=t.srcElement.scrollingElement.scrollTop,s=t.srcElement.scrollingElement.scrollHeight):t.srcElement?(e=t.srcElement.scrollTop,s=t.srcElement.scrollHeight):t.target&&(e=t.target.scrollTop,s=t.target.scrollHeight);t=document.documentElement.clientHeight;e+t>=s-5&&this.getMessageList(!0)}}},s=(s("7bf8"),s("2877")),s=Object(s.a)(i,function(){var i=this,t=i.$createElement,n=i._self._c||t;return n("div",{staticClass:"msg-root"},[n("my-bg"),i._m(0),n("div",{staticClass:"nas-mobile-none"},[n("my-header")],1),n("div",{staticClass:"main-layout  nas-padding-right-zero"},[n("div",{staticClass:"sidebar-root"},[n("my-sidebar",{ref:"sidebar",attrs:{optionList:i.sideOptionList},on:{onItemClick:i.setLeftMenuId}})],1),n("div",{staticClass:"sidebar-mobile-root"},[n("my-sidebar-mobile",{ref:"sidebarMobile",attrs:{optionList:i.sideOptionList},on:{onItemClick:i.setLeftMenuId}})],1),n("div",{staticClass:"right-root"},[i.messageList.length<1?n("my-nodata",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px"},attrs:{title:i.$t("common.noMore")}}):i._e(),n("div",{staticClass:"top-root"},[n("my-btn",{attrs:{title:i.$t("notice.markAllAsRead")},on:{click:i.markAllRead}}),n("my-btn",{attrs:{title:i.$t("notice.deleteAll"),type:"white"},on:{click:i.deleteAll}})],1),n("div",{staticStyle:{width:"100%",height:"100%","padding-top":"60px",overflow:"hidden"}},[0<i.messageList.length?n("div",{staticStyle:{"padding-bottom":"15px",overflow:"auto",height:"100%",width:"100%"},on:{scroll:i.onPageScroll}},[i._l(i.messageList,function(e,s){return n("Card",{staticClass:"card-root"},[n("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between","margin-top":"10px"}},[n("div",{staticStyle:{display:"flex","align-items":"center"}},[0==e.read?n("div",{staticClass:"red-dot"}):n("div",{staticClass:"grey-dot"}),n("p",{staticStyle:{"word-break":"break-all","margin-left":"15px","font-size":"16px","text-align":"left"},on:{click:function(t){return i.itemClick(e,s)}}},[i._v(" ["+i._s(e.create_time_str)+"] "+i._s(e.title))])]),n("a",{staticStyle:{"flex-shrink":"0","margin-left":"10px"},on:{click:function(t){return t.preventDefault(),i.deleteMsg(s,!1)}}},[i._v(" "+i._s(i.$t("common.delete"))+" ")])]),n("p",{staticStyle:{"word-break":"break-all","margin-top":"15px","margin-bottom":"20px",width:"100%","text-align":"left","margin-left":"28px","font-size":"14px","padding-right":"40px"},on:{click:function(t){return i.itemClick(e,s)}}},[i._v(i._s(e.content))])])}),n("div",{staticStyle:{"margin-top":"30px","margin-bottom":"30px",width:"100%"}},[i.messageList.length<1||!i.hasMore?n("p",{staticStyle:{"text-align":"center"}},[i._v(" "+i._s(i.$t("common.noMore"))+" ")]):i._e()])],2):i._e()])],1)])],1)},[function(){var t=this.$createElement,t=this._self._c||t;return t("div",{staticClass:"nas-mobile-none"},[t("p",{staticClass:"my-header-position"})])}],!1,null,"31e4f7f8",null);e.default=s.exports}}]);