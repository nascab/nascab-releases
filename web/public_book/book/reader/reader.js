!function(){"use strict";var e,t={596:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toRange=t.toElement=t.parse=t.joinIndir=t.isCFI=t.fromRange=t.fromElements=t.fromCalibrePos=t.fromCalibreHighlight=t.fake=t.compare=t.collapse=void 0;const n=(e,t)=>[-1,...t,e.length].reduce(((t,n)=>{let{xs:i,a:o}=t;return{xs:(null==i?void 0:i.concat([e.slice(o+1,n)]))??[],a:n}}),{}).xs,i=/\d/,o=t.isCFI=/^epubcfi\((.*)\)$/,r=e=>e.replace(/[\^[\](),;=]/g,"^$&"),s=e=>o.test(e)?e:`epubcfi(${e})`;var a;t.joinIndir=(a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("!")},function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return`epubcfi(${a(...t.map((e=>{var t;return(null===(t=e.match(o))||void 0===t?void 0:t[1])??e})))})`});const l=(e,t)=>((e,t)=>e.map(((e,n,i)=>t(e)?n:null)).filter((e=>null!=e)))(e,(e=>{let[n]=e;return n===t})),c=e=>{const t=[];let n;for(const[i,o]of e){if("/"===i)t.push({index:o});else{const e=t[t.length-1];if(":"===i)e.offset=o;else if("~"===i)e.temporal=o;else if("@"===i)e.spatial=(e.spatial??[]).concat(o);else if(";s"===i)e.side=o;else if("["===i){if("/"!==n||!o){e.text=(e.text??[]).concat(o);continue}e.id=o}}n=i}return t},d=e=>n(e,l(e,"!")).map(c),h=e=>{const t=(e=>{const t=[];let n,o,r="";const s=e=>(t.push(e),n=null,r=""),a=e=>(r+=e,o=!1);for(const t of Array.from(e.trim()).concat("")){var l;if("^"!==t||o){if("!"===n)s(["!"]);else if(","===n)s([","]);else if("/"===n||":"===n){if(i.test(t)){a(t);continue}s([n,parseInt(r)])}else if("~"===n){if(i.test(t)||"."===t){a(t);continue}s(["~",parseFloat(r)])}else if("@"===n){if(":"===t){s(["@",parseFloat(r)]),n="@";continue}if(i.test(t)||"."===t){a(t);continue}s(["@",parseFloat(r)])}else{if("["===n){";"!==t||o?","!==t||o?"]"!==t||o?a(t):s(["[",r]):(s(["[",r]),n="["):(s(["[",r]),n=";");continue}if(null!==(l=n)&&void 0!==l&&l.startsWith(";")){"="!==t||o?";"!==t||o?"]"!==t||o?a(t):s([n,r]):(s([n,r]),n=";"):(n=`;${r}`,r="");continue}}"/"!==t&&":"!==t&&"~"!==t&&"@"!==t&&"["!==t&&"!"!==t&&","!==t||(n=t)}else o=!0}return t})((null===(s=(r=e).match(o))||void 0===s?void 0:s[1])??r);var r,s;const a=l(t,",");if(!a.length)return d(t);const[c,h,u]=n(t,a).map(d);return{parent:c,start:h,end:u}};t.parse=h;const u=e=>{var t;let{index:n,id:i,offset:o,temporal:s,spatial:a,text:l,side:c}=e;const d=c?`;s=${c}`:"";return`/${n}`+(i?`[${r(i)}${d}]`:"")+(null!=o&&n%2?`:${o}`:"")+(s?`~${s}`:"")+(a?`@${a.join(":")}`:"")+(l||!i&&c?"["+((null==l||null===(t=l.map(r))||void 0===t?void 0:t.join(","))??"")+d+"]":"")},f=e=>e.parent?[e.parent,e.start,e.end].map(f).join(","):e.map((e=>e.map(u).join(""))).join("!"),g=e=>s(f(e)),p=(e,t)=>{return"string"==typeof e?g(p(h(e),t)):e.parent?(n=e.parent,i=e[t?"end":"start"],n.slice(0,-1).concat([n[n.length-1].concat(i[0])]).concat(i.slice(1))):e;var n,i};t.collapse=p;const v=(e,t)=>{"string"==typeof e&&(e=h(e)),"string"==typeof t&&(t=h(t)),e=p(e),t=p(t,!0);const n=e[e.length-1],i=t[t.length-1],o=[],r=[],s=[];let a=!0;const l=Math.max(n.length,i.length);for(let e=0;e<l;e++){const t=n[e],l=i[e];a&&(a=!((null==t?void 0:t.index)!==(null==l?void 0:l.index)||null!=t&&t.offset||null!=l&&l.offset)),a?o.push(t):(t&&r.push(t),l&&s.push(l))}const c=e.slice(0,-1).concat([o]);return g({parent:c,start:[r],end:[s]})},m=(e,t)=>{if("string"==typeof e&&(e=h(e)),"string"==typeof t&&(t=h(t)),e.start||t.start)return m(p(e),p(t))||m(p(e,!0),p(t,!0));for(let n=0;n<Math.max(e.length,t.length);n++){const i=e[n],o=t[n],r=Math.max(i.length,o.length)-1;for(let e=0;e<=r;e++){const t=i[e],n=o[e];if(!t)return-1;if(!n)return 1;if(t.index>n.index)return 1;if(t.index<n.index)return-1;if(e===r){if(t.offset>n.offset)return 1;if(t.offset<n.offset)return-1}}}return 0};t.compare=m;const y=e=>{let{nodeType:t}=e;return 3===t||4===t},w=e=>{let{nodeType:t}=e;return 1===t},b=(e,t)=>{const n=Array.from(e.childNodes).filter((e=>y(e)||w(e)));return t?n.map((e=>{const n=t(e);return n===NodeFilter.FILTER_REJECT?null:n===NodeFilter.FILTER_SKIP?b(e,t):e})).flat().filter((e=>e)):n},k=(e,t)=>{const n=b(e,t).reduce(((e,t)=>{let n=e[e.length-1];return n?y(t)?Array.isArray(n)?n.push(t):y(n)?e[e.length-1]=[n,t]:e.push(t):w(n)?e.push(null,t):e.push(t):e.push(t),e}),[]);return w(n[0])&&n.unshift("first"),w(n[n.length-1])&&n.push("last"),n.unshift("before"),n.push("after"),n},C=(e,t,n)=>{const{id:i}=t[t.length-1];if(i){const t=e.ownerDocument.getElementById(i);if(t)return{node:t,offset:0}}for(const{index:i}of t){const t=e?k(e,n)[i]:null;if("first"===t)return{node:e.firstChild??e};if("last"===t)return{node:e.lastChild??e};if("before"===t)return{node:e,before:!0};if("after"===t)return{node:e,after:!0};e=t}const{offset:o}=t[t.length-1];if(!Array.isArray(e))return{node:e,offset:o};let r=0;for(const t of e){const{length:e}=t.nodeValue;if(r+e>=o)return{node:t,offset:o-r};r+=e}},x=(e,t,n)=>{const{parentNode:i,id:o}=e,r=k(i,n),s=r.findIndex((t=>Array.isArray(t)?t.some((t=>t===e)):t===e)),a=r[s];if(Array.isArray(a)){let n=0;for(const i of a){if(i===e){n+=t;break}n+=i.nodeValue.length}t=n}const l={id:o,index:s,offset:t};return(i!==e.ownerDocument.documentElement?x(i,null,n).concat(l):[l]).filter((e=>-1!==e.index))};t.fromRange=(e,t)=>{const{startContainer:n,startOffset:i,endContainer:o,endOffset:r}=e,s=x(n,i,t);if(e.collapsed)return g([s]);const a=x(o,r,t);return v([s],[a])},t.toRange=(e,t,n)=>{const i=p(t),o=p(t,!0),r=e.documentElement,s=C(r,i[0],n),a=C(r,o[0],n),l=e.createRange();return s.before?l.setStartBefore(s.node):s.after?l.setStartAfter(s.node):l.setStart(s.node,s.offset),a.before?l.setEndBefore(a.node):a.after?l.setEndAfter(a.node):l.setEnd(a.node,a.offset),l},t.fromElements=e=>{const t=[],{parentNode:n}=e[0],i=x(n);for(const[o,r]of k(n).entries()){const n=e[t.length];r===n&&t.push(g([i.concat({id:n.id,index:o})]))}return t},t.toElement=(e,t)=>C(e.documentElement,p(t)).node;const A=t.fake={fromIndex:e=>s("/6/"+2*(e+1)),toIndex:e=>(null==e?void 0:e.at(-1).index)/2-1};t.fromCalibrePos=e=>{const[t]=h(e),n=t.shift();return t.shift(),g([[{index:6},n],t])},t.fromCalibreHighlight=e=>{let{spine_index:t,start_cfi:n,end_cfi:i}=e;const o=A.fromIndex(t)+"!";return v(o+n.slice(2),o+i.slice(2))}},804:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;let n="zh-CN";localStorage.language&&(n=localStorage.language);const i={"zh-CN":{ok:"确定",cancel:"取消",bgColor:"背景颜色",textColor:"正文字色",linkColor:"链接颜色",lineHeight:"行间距",defaults:"恢复默认",progress:"调节进度",switchPage:"翻页方式",page:"左右翻页",scroll:"上下滑动",fontWeight:"字粗",scaleMode:"缩放模式",pageLayout:"页面布局",readMode:"阅读模式",leftToRight:"从左到右",rightToLeft:"从右到左",vertical:"垂直",fitScreen:"适应屏幕",fitWidth:"适应宽度",singlePage:"单页",doublePage:"双页",pageMode:"翻页模式",paginated:"分页",freeMode:"自由滑动",pageButton:"翻页按钮",show:"显示",hide:"隐藏",autoPlayDelay:"自动播放间隔",jumpToIndex:"是否跳转到进度:",previewModeTitle:"预览模式:点击图片选择进度",noImgFound:"未找到可以浏览的图片",widthPadding:"两侧边距",helpTitle:"快捷键和操作说明",keyUpdown:"方向键上/下[或滚轮]",keyUpdownContent:"图片可滑动时滑动图片,无法滑动时翻页",keyLeftRight:"方向键左/右",keyLeftRightContent:"直接翻页",key:"按键",keyFcontent:"全屏",keyPcontent:"开始/停止自动播放",keyScontent:"选择进度",keyCcontent:"切换边距[仅'适配宽度'模式]",keyHomeContent:"第一页",keyEndContent:"最后一页",setOk:"设置已完成",keyDContent:"切换单页/双页",keyZContent:"切换缩放模式",keyHcontent:"隐藏/显示翻页按钮",keyMcontent:"隐藏/显示顶部菜单"},"zh-TW":{ok:"確定",cancel:"取消",bgColor:"背景顏色",textColor:"正文字色",linkColor:"鏈接顏色",lineHeight:"行間距",defaults:"恢復默認",progress:"調節進度",switchPage:"翻頁方式",page:"左右翻頁",scroll:"上下滑動",fontWeight:"字粗",scaleMode:"縮放模式",pageLayout:"頁面布局",readMode:"閱讀模式",leftToRight:"左到右",rightToLeft:"右到左",vertical:"垂直",fitScreen:"適應屏幕",fitWidth:"適應寬度",singlePage:"單頁",doublePage:"雙頁",pageMode:"翻頁模式",paginated:"分頁",freeMode:"自由滑動",pageButton:"翻頁按鈕",show:"顯示",hide:"隱藏",autoPlayDelay:"自動播放間隔",jumpToIndex:"是否跳轉到進度:",previewModeTitle:"預覽模式:點擊圖片選擇進度",noImgFound:"未找到可以瀏覽的圖片",widthPadding:"兩側邊距",helpTitle:"快捷鍵和操作說明",keyUpdown:"方向鍵上/下[或滾輪]",keyUpdownContent:"圖片可滑動時滑動圖片,無法滑動時翻頁",keyLeftRight:"方向鍵左/右",keyLeftRightContent:"直接翻頁",key:"按鍵",keyFcontent:"全屏",keyPcontent:"開始/停止自動播放",keyScontent:"選擇進度",keyCcontent:"切換邊距[僅'適配寬度'模式]",keyHomeContent:"第一頁",keyEndContent:"最後一頁",setOk:"設置已完成",keyDContent:"切換單頁/雙頁",keyZContent:"切換縮放模式",keyHcontent:"隱藏/顯示翻頁按鈕",keyMcontent:"隱藏/顯示頂部菜單"},"en-US":{ok:"OK",cancel:"CANCEL",bgColor:"Bg color",textColor:"Text color",linkColor:"Link color",lineHeight:"Line spacing",defaults:"Defaults",progress:"Progress",switchPage:"Page",page:"Paginated",scroll:"Scrolled",fontWeight:"Font Weight",scaleMode:"Scale mode",pageLayout:"Page layout",readMode:"Reading mode",leftToRight:"Left to right",rightToLeft:"Right to left",vertical:"Vertical",fitScreen:"Adapt to screen",fitWidth:"Fit Width",singlePage:"Single page",doublePage:"Double page",pageMode:"Page mode",paginated:"paginated",freeMode:"Free sliding",pageButton:"Page button",show:"Show",hide:"Hide",autoPlayDelay:"Auto play interval",jumpToIndex:"Whether to jump to progress:",previewModeTitle:"Preview mode: click image selection progress",noImgFound:"No images found to browse",widthPadding:"Margin",helpTitle:"Shortcut keys and operation instructions",keyUpdown:"Key up/down[Mousewheel]",keyUpdownContent:"Slide the picture when the picture can be slid, and turn the page when it cannot slide",keyLeftRight:"Key left/right",keyLeftRightContent:"Turn page directly",key:"Key",keyFcontent:"Full screen",keyPcontent:"Start/stop automatic playback",keyScontent:"Select Progress",keyCcontent:"Toggle margins ['Fit to width' mode only]",keyHomeContent:"First page",keyEndContent:"Last page",setOk:"Setup completed",keyDContent:"Switch single page/double page",keyZContent:"Switch zoom mode",keyHcontent:"Hide/show page button",keyMcontent:"Hide/show top menu"}};t.default={t:function(e){return i[n][e]}}},58:function(e,t){function n(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=class{constructor(){n(this,"lastSaveProgress",null),n(this,"timer",null),n(this,"token",null),n(this,"currentReadBook",null),this.getToken()}getBaseByLocation(){const[e,t]=window.location.pathname.split("/").filter(Boolean);return e&&t&&"book"==t?`${window.location.protocol}//${window.location.host}${"/"+e}`:`${window.location.protocol}//${window.location.host}`}getCurrentReadBook(){if(this.currentReadBook)return this.currentReadBook;let e=localStorage.currentReadBook||sessionStorage.currentReadBook;if(e)try{return this.currentReadBook=JSON.parse(e),localStorage.currentReadBook&&(sessionStorage.currentReadBook=localStorage.currentReadBook,localStorage.removeItem("currentReadBook")),this.currentReadBook}catch(e){console.log(e)}return null}getCookie(e){var t=e+"=",n=document.cookie.split(";");console.log(n);for(var i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}getToken(){if(this.token)return this.token;if(this.token=this.getQueryParam("token"),!this.token&&sessionStorage.token&&(this.token=sessionStorage.token),!this.token&&localStorage.store)try{let e=JSON.parse(localStorage.store);e.token&&(this.token=e.token)}catch(e){}return!this.token&&localStorage.tokenPlain&&(this.token=localStorage.tokenPlain),this.token||(this.token=this.getCookie("token"),console.log("从cookie中获取了token",this.token)),this.token}getZipFileUrl(e,t){let n=this.getToken();if(n)return this.getBaseByLocation()+`/api/zipFileApi/getZipInnerFile/file.jpg?token=${n}&zipFilePath=${encodeURIComponent(e)}&innerFilePath=${encodeURIComponent(t)}`}getQueryParam(e){let t=window.location.search.substring(1).split("&");for(let n=0;n<t.length;n++){let i=t[n].split("=");if(i[0]==e)return i[1]}return null}getFileName(e){if(console.log("file",e),!e)return"";try{let t=decodeURIComponent(e.name);console.log("name",e.name,t);return t.split("/").pop()}catch(e){return console.log("解析文件名出错",e),""}}sendHttpPost(e,t,n,i){const o=t;fetch(e,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>n(e))).catch((e=>i(e)))}saveProgressApi(e){localStorage.readerProgress=e,this.lastSaveProgress=e;let t=this.getToken(),n=this.getBaseByLocation()+"/api/bookApi/addReadRecord";if(!t)return console.log("token/file未找到 无法调用接口");let i="",o="",r=this.getCurrentReadBook();r&&(r.filename&&(i=r.filename),r.path&&(o=r.path)),this.sendHttpPost(n,{fileName:i,filePath:o,progress:e,token:t},(e=>{console.log("保存进度API调用成功",e)}),(e=>{console.log("保存进度API调用失败",e)}))}saveProgress(e,t){e!=this.lastSaveProgress&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.saveProgressApi(e,t)}),2e3))}getProgressApi(e,t,n){let i=this.getToken(),o=this.getBaseByLocation()+"/api/bookApi/getReadRecord";this.sendHttpPost(o,{fileName:e,filePath:t,token:i},(e=>{n(e)}),(e=>{console.log("获取阅读进度API调用失败",e)}))}restoreProgress(e,t,n){if(!this.getToken())return console.log("token未找到 无法调用接口");let i=this.getFileName(t),o="",r=this.getCurrentReadBook();r&&(r.filename&&(i=r.filename),r.path&&(o=r.path)),this.getProgressApi(i,o,(t=>{if(t.progress){let n=parseFloat(t.progress);n>0&&setTimeout((()=>{console.log("恢复进度"+n),e&&e.view.goToFraction(n)}),500)}t.readerConfig&&t.readerConfig.config_json&&e&&e.restoreReaderConfig(t.readerConfig.config_json),n&&n(t)}))}setReaderConfig(e,t){let n=this.getToken();if(!n)return console.log("token/file未找到 无法调用接口");let i=this.getBaseByLocation()+"/api/bookApi/setReaderConfig";this.sendHttpPost(i,{token:n,remark:t,configJson:e},(e=>{}),(e=>{console.log("保存阅读器配置失败",e)}))}getZipContent(e,t,n){let i=this.getToken();if(!i)return console.log("token/ 无法调用接口");let o=this.getBaseByLocation()+"/api/zipFileApi/getZipContentList";this.sendHttpPost(o,{token:i,zipFilePath:e,onlyImg:t},(e=>{n&&n(e)}),(e=>{console.log("获取压缩文件内容失败",e)}))}}},777:function(e,t){function n(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function i(e,t){return e.get(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.Overlayer=void 0;const o=e=>document.createElementNS("http://www.w3.org/2000/svg",e);var r=new WeakMap,s=new WeakMap;t.Overlayer=class{constructor(){n(this,r,o("svg")),n(this,s,new Map),Object.assign(i(r,this).style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none"})}get element(){return i(r,this)}add(e,t,n,o){i(s,this).has(e)&&this.remove(e),"function"==typeof t&&(t=t(i(r,this).getRootNode()));const a=t.getClientRects(),l=n(a,o);i(r,this).append(l),i(s,this).set(e,{range:t,draw:n,options:o,element:l,rects:a})}remove(e){i(s,this).has(e)&&(i(r,this).removeChild(i(s,this).get(e).element),i(s,this).delete(e))}redraw(){for(const e of i(s,this).values()){const{range:t,draw:n,options:o,element:s}=e;i(r,this).removeChild(s);const a=t.getClientRects(),l=n(a,o);i(r,this).append(l),e.element=l,e.rects=a}}hitTest(e){let{x:t,y:n}=e;const o=Array.from(i(s,this).entries());for(let e=o.length-1;e>=0;e--){const[i,r]=o[e];for(const{left:e,top:o,right:s,bottom:a}of r.rects)if(o<=n&&e<=t&&a>n&&s>t)return[i,r.range]}return[]}static underline(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{color:n="red",width:i=2,writingMode:r}=t,s=o("g");if(s.setAttribute("fill",n),"vertical-rl"===r||"vertical-lr"===r)for(const{right:t,top:n,height:r}of e){const e=o("rect");e.setAttribute("x",t-i),e.setAttribute("y",n),e.setAttribute("height",r),e.setAttribute("width",i),s.append(e)}else for(const{left:t,bottom:n,width:r}of e){const e=o("rect");e.setAttribute("x",t),e.setAttribute("y",n-i),e.setAttribute("height",i),e.setAttribute("width",r),s.append(e)}return s}static strikethrough(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{color:n="red",width:i=2,writingMode:r}=t,s=o("g");if(s.setAttribute("fill",n),"vertical-rl"===r||"vertical-lr"===r)for(const{right:t,left:n,top:r,height:a}of e){const e=o("rect");e.setAttribute("x",(t+n)/2),e.setAttribute("y",r),e.setAttribute("height",a),e.setAttribute("width",i),s.append(e)}else for(const{left:t,top:n,bottom:r,width:a}of e){const e=o("rect");e.setAttribute("x",t),e.setAttribute("y",(n+r)/2),e.setAttribute("height",i),e.setAttribute("width",a),s.append(e)}return s}static squiggly(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{color:n="red",width:i=2,writingMode:r}=t,s=o("g");s.setAttribute("fill","none"),s.setAttribute("stroke",n),s.setAttribute("stroke-width",i);const a=1.5*i;if("vertical-rl"===r||"vertical-lr"===r)for(const{right:t,top:n,height:i}of e){const e=o("path"),r=Math.round(i/a/1.5),l=i/r,c=Array.from({length:r},((e,t)=>`l${t%2?-a:a} ${l}`)).join("");e.setAttribute("d",`M${t} ${n}${c}`),s.append(e)}else for(const{left:t,bottom:n,width:i}of e){const e=o("path"),r=Math.round(i/a/1.5),l=i/r,c=Array.from({length:r},((e,t)=>`l${l} ${t%2?a:-a}`)).join("");e.setAttribute("d",`M${t} ${n}${c}`),s.append(e)}return s}static highlight(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{color:n="red"}=t,i=o("g");i.setAttribute("fill",n),i.style.opacity="var(--overlayer-highlight-opacity, .3)",i.style.mixBlendMode="var(--overlayer-highlight-blend-mode, normal)";for(const{left:t,top:n,height:r,width:s}of e){const e=o("rect");e.setAttribute("x",t),e.setAttribute("y",n),e.setAttribute("height",r),e.setAttribute("width",s),i.append(e)}return i}static outline(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{color:n="red",width:i=3,radius:r=3}=t,s=o("g");s.setAttribute("fill","none"),s.setAttribute("stroke",n),s.setAttribute("stroke-width",i);for(const{left:t,top:n,height:i,width:a}of e){const e=o("rect");e.setAttribute("x",t),e.setAttribute("y",n),e.setAttribute("height",i),e.setAttribute("width",a),e.setAttribute("rx",r),s.append(e)}return s}static copyImage(e){let[t]=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{src:i}=n,r=o("image"),{left:s,top:a,height:l,width:c}=t;return r.setAttribute("href",i),r.setAttribute("x",s),r.setAttribute("y",a),r.setAttribute("height",l),r.setAttribute("width",c),r}}},559:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TOCProgress=t.SectionProgress=void 0;const n=e=>e.map((e=>{var t;return null!==(t=e.subitems)&&void 0!==t&&t.length?[e,n(e.subitems)].flat():e})).flat();t.TOCProgress=class{async init(e){let{toc:t,ids:i,splitHref:o,getFragment:r}=e;(e=>{let t=0;const n=e=>{if(e.id=t++,e.subitems)for(const t of e.subitems)n(t)};for(const t of e)n(t)})(t);const s=n(t),a=new Map;for(const[e,t]of s.entries()){const[n,i]=await o(null==t?void 0:t.href)??[],r={fragment:i,item:t};a.has(n)?a.get(n).items.push(r):a.set(n,{prev:s[e-1],items:[r]})}const l=new Map;for(const[e,t]of i.entries())a.has(t)?l.set(t,a.get(t)):l.set(t,l.get(i[e-1]));this.ids=i,this.map=l,this.getFragment=r}getProgress(e,t){if(!this.ids)return;const n=this.ids[e],i=this.map.get(n);if(!i)return null;const{prev:o,items:r}=i;if(!r)return o;if(!t||1===r.length&&!r[0].fragment)return r[0].item;const s=t.startContainer.getRootNode();for(const[e,{fragment:n}]of r.entries()){var a;const i=this.getFragment(s,n);if(i&&t.comparePoint(i,0)>0)return(null===(a=r[e-1])||void 0===a?void 0:a.item)??o}return r[r.length-1].item}};var i=new WeakSet;function o(){const{sizeTotal:e}=this,t=[0];let n=0;for(const i of this.sizes)t.push((n+=i)/e);return t}t.SectionProgress=class{constructor(e,t,n){var r,s;(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(r=this,s=i),s.add(r),this.sizes=e.map((e=>"no"!=e.linear&&e.size>0?e.size:0)),this.sizePerLoc=t,this.sizePerTimeUnit=n,this.sizeTotal=this.sizes.reduce(((e,t)=>e+t),0),this.sectionFractions=function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}(i,this,o).call(this)}getProgress(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{sizes:i,sizePerLoc:o,sizePerTimeUnit:r,sizeTotal:s}=this,a=i[e]??0,l=i.slice(0,e).reduce(((e,t)=>e+t),0)+t*a,c=l+n*a,d=s-l,h=(1-t)*a;return{fraction:c/s,section:{current:e,total:i.length},location:{current:Math.floor(l/o),next:Math.floor(c/o),total:Math.ceil(s/o)},time:{section:h/r,total:d/r}}}getSection(e){if(e<=0)return[0,0];if(e>=1)return[this.sizes.length-1,1];e+=Number.EPSILON;const{sizeTotal:t}=this;let n=this.sectionFractions.findIndex((t=>t>e))-1;if(n<0)return[0,0];for(;!this.sizes[n];)n++;return[n,(e-this.sectionFractions[n])/(this.sizes[n]/t)]}}},886:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.textWalker=void 0;const n=(e,t)=>{const n=[];for(let i=t.currentNode;i;i=t.nextNode()){const t=e.comparePoint(i,0);if(0===t)n.push(i);else if(t>0)break}return n},i=(e,t)=>{const n=[];for(let e=t.nextNode();e;e=t.nextNode())n.push(e);return n},o=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_CDATA_SECTION,r=e=>{if(1===e.nodeType){const t=e.tagName.toLowerCase();return"script"===t||"style"===t?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT};t.textWalker=function*(e,t){const s=e.commonAncestorContainer??e.body??e,a=document.createTreeWalker(s,o,{acceptNode:r}),l=(e.commonAncestorContainer?n:i)(e,a),c=l.map((e=>e.nodeValue)),d=(e,t,n,i)=>{const o=document.createRange();return o.setStart(l[e],t),o.setEnd(l[n],i),o};for(const e of t(c,d))yield e}},456:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createTOCView=void 0;const n=e=>document.createElementNS("http://www.w3.org/2000/svg",e),i=(e,t)=>{for(;e.firstChild;)e.removeChild(e.firstChild);for(var n=0;n<t.length;n++)e.appendChild(t[n])};t.createTOCView=(e,t)=>{const o=document.createElement("ol");o.setAttribute("role","tree");const r=[],s=new Map,a=((e,t,o)=>{let r=0;const s=function(a){let{label:l,href:c,subitems:d}=a,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const u=document.createElement(c?"a":"span");u.innerText=l,u.setAttribute("role","treeitem"),u.tabIndex=-1,u.style.paddingInlineStart=24*(h+1)+"px",e.push(u),c?(t.has(c)||t.set(c,u),u.href=c,u.onclick=e=>{e.preventDefault(),o(c)}):u.onclick=e=>{var t;return null===(t=u.firstElementChild)||void 0===t?void 0:t.onclick(e)};const f=document.createElement("li");if(f.setAttribute("role","none"),f.append(u),null!=d&&d.length){u.setAttribute("aria-expanded","false");const e=(()=>{const e=n("svg");e.setAttribute("viewBox","0 0 13 10"),e.setAttribute("width","1.5rem"),e.setAttribute("height","1.5rem");const t=n("polygon");return t.setAttribute("points","2 1, 12 1, 7 9"),e.append(t),e})();e.onclick=e=>{e.preventDefault(),e.stopPropagation();const t=u.getAttribute("aria-expanded");u.setAttribute("aria-expanded","true"===t?"false":"true")},u.prepend(e);const t=document.createElement("ol");t.id="toc-element-"+r++,t.setAttribute("role","group"),u.setAttribute("aria-owns",t.id),i(t,[...d.map((e=>s(e,h+1)))]),f.append(t)}return f};return s})(r,s,t);i(o,[...e.map((e=>a(e)))]);const l=e=>"treeitem"===(null==e?void 0:e.getAttribute("role")),c=function*(e){for(let t=e.parentNode;t!==o;t=t.parentNode){const e=t.previousElementSibling;l(e)&&(yield e)}};let d,h;o.addEventListener("focusout",(()=>{if(d)if(h&&(h.tabIndex=-1),d.offsetParent)d.tabIndex=0;else for(const e of c(d))if(e.offsetParent){e.tabIndex=0,h=e;break}}));const u=document.createTreeWalker(o,1,{acceptNode:e=>l(e)&&e.offsetParent?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}),f=e=>(u.currentNode=e,u);for(const e of r)e.addEventListener("keydown",(e=>{var t,n,i,o,s;let a=!1;const{currentTarget:l,key:d}=e;switch(d){case" ":case"Enter":l.click(),a=!0;break;case"ArrowDown":null===(t=f(l).nextNode())||void 0===t||t.focus(),a=!0;break;case"ArrowUp":null===(n=f(l).previousNode())||void 0===n||n.focus(),a=!0;break;case"ArrowLeft":"true"===l.getAttribute("aria-expanded")?l.setAttribute("aria-expanded","false"):null===(i=c(l).next())||void 0===i||null===(o=i.value)||void 0===o||o.focus(),a=!0;break;case"ArrowRight":"true"===l.getAttribute("aria-expanded")?null===(s=f(l).nextNode())||void 0===s||s.focus():l.getAttribute("aria-owns")&&l.setAttribute("aria-expanded","true"),a=!0;break;case"Home":r[0].focus(),a=!0;break;case"End":{var h;const e=r[r.length-1];e.offsetParent?e.focus():null===(h=f(e).previousNode())||void 0===h||h.focus(),a=!0;break}}a&&(e.preventDefault(),e.stopPropagation())}));return{element:o,setCurrentHref:e=>{d&&(d.removeAttribute("aria-current"),d.tabIndex=-1);const t=s.get(e);if(!t)return d=r[0],void(d.tabIndex=0);for(const e of c(t))e.setAttribute("aria-expanded","true");t.setAttribute("aria-current","page"),t.tabIndex=0,t.scrollIntoView({behavior:"smooth",block:"center"}),d=t}}}},493:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&{}.hasOwnProperty.call(e,r)){var s=o?Object.getOwnPropertyDescriptor(e,r):null;s&&(s.get||s.set)?Object.defineProperty(i,r,s):i[r]=e[r]}return i.default=e,n&&n.set(e,i),i}(n(596)),o=n(559),r=n(777),s=n(886);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n){d(e,t),t.set(e,n)}function d(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t,n){return e.set(f(e,t),n),n}function u(e,t){return e.get(f(e,t))}function f(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const g="foliate-search:";var p=new WeakMap,v=new WeakMap;class m extends EventTarget{constructor(){super(...arguments),c(this,p,[]),c(this,v,-1)}pushState(e){var t;const n=u(p,this)[u(v,this)];n===e||null!=n&&n.fraction&&n.fraction===e.fraction||(u(p,this)[h(v,this,(t=u(v,this),++t))]=e,u(p,this).length=u(v,this)+1,this.dispatchEvent(new Event("index-change")))}replaceState(e){const t=u(v,this);u(p,this)[t]=e}back(){const e=u(v,this);if(e<=0)return;const t={state:u(p,this)[e-1]};h(v,this,e-1),this.dispatchEvent(new CustomEvent("popstate",{detail:t})),this.dispatchEvent(new Event("index-change"))}forward(){const e=u(v,this);if(e>=u(p,this).length-1)return;const t={state:u(p,this)[e+1]};h(v,this,e+1),this.dispatchEvent(new CustomEvent("popstate",{detail:t})),this.dispatchEvent(new Event("index-change"))}get canGoBack(){return u(v,this)>0}get canGoForward(){return u(v,this)<u(p,this).length-1}clear(){h(p,this,[]),h(v,this,-1)}}var y=new WeakMap,w=new WeakMap,b=new WeakMap,k=new WeakMap,C=new WeakMap,x=new WeakSet;class A extends HTMLElement{constructor(){var e;super(),d(this,e=x),e.add(this),c(this,y,this.attachShadow({mode:"closed"})),c(this,w,void 0),c(this,b,void 0),c(this,k,void 0),c(this,C,new Map),l(this,"isFixedLayout",!1),l(this,"lastLocation",void 0),l(this,"history",new m),this.history.addEventListener("popstate",(e=>{let{detail:t}=e;const n=this.resolveNavigation(t.state);this.renderer.goTo(n)}))}async viewOpen(e){var t,i;if(this.book=e,this.language=(e=>{if(!e)return{};try{var t,n;const i=Intl.getCanonicalLocales(e)[0],o=new Intl.Locale(i);return{canonical:i,locale:o,isCJK:["zh","ja","kr"].includes(o.language),direction:null===(t=(null===(n=o.getTextInfo)||void 0===n?void 0:n.call(o))??o.textInfo)||void 0===t?void 0:t.direction}}catch(e){return console.warn(e),{}}})(null===(t=e.metadata)||void 0===t?void 0:t.language),e.splitTOCHref&&e.getTOCFragment){const t=e.sections.map((e=>e.id));h(w,this,new o.SectionProgress(e.sections,1500,1600));const n=e.splitTOCHref.bind(e),i=e.getTOCFragment.bind(e);h(b,this,new o.TOCProgress),await u(b,this).init({toc:e.toc??[],ids:t,splitHref:n,getFragment:i}),h(k,this,new o.TOCProgress),await u(k,this).init({toc:e.pageList??[],ids:t,splitHref:n,getFragment:i})}if(this.isFixedLayout="pre-paginated"===(null===(i=this.book.rendition)||void 0===i?void 0:i.layout),this.isFixedLayout?(await n.e(563).then(n.bind(n,563)),this.renderer=document.createElement("foliate-fxl")):(await n.e(969).then(n.bind(n,350)),this.renderer=document.createElement("foliate-paginator")),this.renderer.setAttribute("exportparts","head,foot,filter"),this.renderer.addEventListener("load",(e=>{f(x,this,E).call(this,e.detail)})),this.renderer.addEventListener("relocate",(e=>{f(x,this,T).call(this,e.detail)})),this.renderer.addEventListener("create-overlayer",(e=>{e.detail.attach(f(x,this,L).call(this,e.detail))})),this.renderer.open(e),u(y,this).append(this.renderer),e.sections.some((e=>e.mediaOverlay))){var r;(r=e.media).activeClass||(r.activeClass="-epub-media-overlay-active");const t=e.media.activeClass;let n;this.mediaOverlay=e.getMediaOverlay(),this.mediaOverlay.addEventListener("highlight",(e=>{const i=this.resolveNavigation(e.detail.text);this.renderer.goTo(i).then((()=>{const{doc:e}=this.renderer.getContents().find((e=>e.index=i.index)),o=i.anchor(e);o.classList.add(t),n=new WeakRef(o)}))})),this.mediaOverlay.addEventListener("unhighlight",(()=>{var e,i,o;null===(e=n)||void 0===e||null===(i=e.deref())||void 0===i||null===(o=i.classList)||void 0===o||o.remove(t)}))}}close(){var e,t;null===(e=this.renderer)||void 0===e||e.destroy(),null===(t=this.renderer)||void 0===t||t.remove(),h(w,this,null),h(b,this,null),h(k,this,null),h(C,this,new Map),this.lastLocation=null,this.history.clear(),this.tts=null,this.mediaOverlay=null}goToTextStart(){var e,t;return this.goTo((null===(e=this.book.landmarks)||void 0===e||null===(t=e.find((e=>e.type.includes("bodymatter")||e.type.includes("text"))))||void 0===t?void 0:t.href)??this.book.sections.findIndex((e=>"no"!==e.linear)))}async init(e){let{lastLocation:t,showTextStart:n}=e;const i=t?this.resolveNavigation(t):null;i?(await this.renderer.goTo(i),this.history.pushState(t)):n?await this.goToTextStart():(this.history.pushState(0),await this.next())}async addAnnotation(e,t){var n;const{value:i}=e;if(i.startsWith(g)){const e=i.replace(g,""),{index:n,anchor:o}=await this.resolveNavigation(e),s=f(x,this,F).call(this,n);if(s){const{overlayer:e,doc:n}=s;if(t)return void e.remove(i);const a=n?o(n):o;e.add(i,a,r.Overlayer.outline)}return}const{index:o,anchor:s}=await this.resolveNavigation(i),a=f(x,this,F).call(this,o);if(a){const{overlayer:n,doc:o}=a;if(n.remove(i),!t){const t=o?s(o):s,r=(e,o)=>n.add(i,t,e,o);f(x,this,P).call(this,"draw-annotation",{draw:r,annotation:e,doc:o,range:t})}}return{index:o,label:(null===(n=u(b,this).getProgress(o))||void 0===n?void 0:n.label)??""}}deleteAnnotation(e){return this.addAnnotation(e,!0)}async showAnnotation(e){const{value:t}=e,n=await this.goTo(t);if(n){const{index:e,anchor:i}=n,{doc:o}=f(x,this,F).call(this,e),r=i(o);f(x,this,P).call(this,"show-annotation",{value:t,index:e,range:r})}}getCFI(e,t){const n=this.book.sections[e].cfi??i.fake.fromIndex(e);return t?i.joinIndir(n,i.fromRange(t)):n}resolveCFI(e){if(this.book.resolveCFI)return this.book.resolveCFI(e);{const t=i.parse(e);return{index:i.fake.toIndex((t.parent??t).shift()),anchor:e=>i.toRange(e,t)}}}resolveNavigation(e){try{if("number"==typeof e)return{index:e};if("number"==typeof e.fraction){const[t,n]=u(w,this).getSection(e.fraction);return{index:t,anchor:n}}return i.isCFI.test(e)?this.resolveCFI(e):this.book.resolveHref(e)}catch(t){console.error(t),console.error(`Could not resolve target ${e}`)}}async goTo(e){const t=this.resolveNavigation(e);try{return await this.renderer.goTo(t),this.history.pushState(e),t}catch(t){console.error(t),console.error(`Could not go to ${e}`)}}async goToFraction(e){const[t,n]=u(w,this).getSection(e);await this.renderer.goTo({index:t,anchor:n}),this.history.pushState({fraction:e})}async select(e){try{const t=await this.resolveNavigation(e);await this.renderer.goTo({...t,select:!0}),this.history.pushState(e)}catch(t){console.error(t),console.error(`Could not go to ${e}`)}}deselect(){for(const{doc:e}of this.renderer.getContents())e.defaultView.getSelection().removeAllRanges()}getSectionFractions(){var e;return((null===(e=u(w,this))||void 0===e?void 0:e.sectionFractions)??[]).map((e=>e+Number.EPSILON))}getProgressOf(e,t){var n,i;return{tocItem:null===(n=u(b,this))||void 0===n?void 0:n.getProgress(e,t),pageItem:null===(i=u(k,this))||void 0===i?void 0:i.getProgress(e,t)}}async getTOCItemOf(e){try{const{index:t,anchor:n}=await this.resolveNavigation(e),i=await this.book.sections[t].createDocument(),o=n(i),r=o instanceof Range,s=r?o:i.createRange();return r||s.selectNodeContents(o),u(b,this).getProgress(t,s)}catch(t){console.error(t),console.error(`Could not get ${e}`)}}async prev(e){await this.renderer.prev(e)}async next(e){await this.renderer.next(e)}goLeft(){return"rtl"===this.book.dir?this.next():this.prev()}goRight(){return"rtl"===this.book.dir?this.prev():this.next()}async*search(e){this.clearSearch();const{searchMatcher:t}=await n.e(956).then(n.bind(n,956)),{query:i,index:o}=e,r=t(s.textWalker,{defaultLocale:this.language,...e}),a=null!=o?f(x,this,R).call(this,r,i,o):f(x,this,I).call(this,r,i),l=[];u(C,this).set(o,l);for await(const e of a)if(e.subitems){var c;const t=e.subitems.map((e=>{let{cfi:t}=e;return{value:g+t}}));u(C,this).set(e.index,t);for(const e of t)this.addAnnotation(e);yield{label:(null===(c=u(b,this).getProgress(e.index))||void 0===c?void 0:c.label)??"",subitems:e.subitems}}else{if(e.cfi){const t={value:g+e.cfi};l.push(t),this.addAnnotation(t)}yield e}yield"done"}clearSearch(){for(const e of u(C,this).values())for(const t of e)this.deleteAnnotation(t);u(C,this).clear()}async initTTS(){const e=this.renderer.getContents()[0].doc;if(this.tts&&this.tts.doc===e)return;const{TTS:t}=await n.e(275).then(n.bind(n,275));this.tts=new t(e,s.textWalker,(e=>this.renderer.scrollToAnchor(e,!0)))}startMediaOverlay(){const{index:e}=this.renderer.getContents()[0];return this.mediaOverlay.start(e)}}function P(e,t,n){return this.dispatchEvent(new CustomEvent(e,{detail:t,cancelable:n}))}function T(e){var t,n,i;let{reason:o,range:r,index:s,fraction:a,size:l}=e;const c=(null===(t=u(w,this))||void 0===t?void 0:t.getProgress(s,a,l))??{},d=null===(n=u(b,this))||void 0===n?void 0:n.getProgress(s,r),h=null===(i=u(k,this))||void 0===i?void 0:i.getProgress(s,r),g=this.getCFI(s,r);this.lastLocation={...c,tocItem:d,pageItem:h,cfi:g,range:r},"snap"!==o&&"page"!==o&&"scroll"!==o||this.history.replaceState(g),f(x,this,P).call(this,"relocate",this.lastLocation)}function E(e){let{doc:t,index:n}=e;t.documentElement.lang||(t.documentElement.lang=this.language.canonical||""),this.language.isCJK||t.documentElement.dir||(t.documentElement.dir=this.language.direction||""),f(x,this,S).call(this,t,n),f(x,this,P).call(this,"load",{doc:t,index:n})}function S(e,t){const{book:n}=this,i=n.sections[t];for(const t of e.querySelectorAll("a[href]"))t.addEventListener("click",(e=>{var o,r;e.preventDefault();const s=t.getAttribute("href"),a=(null==i||null===(o=i.resolveHref)||void 0===o?void 0:o.call(i,s))??s;null!=n&&null!==(r=n.isExternal)&&void 0!==r&&r.call(n,a)?Promise.resolve(f(x,this,P).call(this,"external-link",{a:t,href:a},!0)).then((e=>e?globalThis.open(a,"_blank"):null)).catch((e=>console.error(e))):Promise.resolve(f(x,this,P).call(this,"link",{a:t,href:a},!0)).then((e=>e?this.goTo(a):null)).catch((e=>console.error(e)))}))}function F(e){return this.renderer.getContents().find((t=>t.index===e&&t.overlayer))}function L(e){let{doc:t,index:n}=e;const i=new r.Overlayer;t.addEventListener("click",(e=>{const[t,o]=i.hitTest(e);t&&!t.startsWith(g)&&f(x,this,P).call(this,"show-annotation",{value:t,index:n,range:o})}),!1);const o=u(C,this).get(n);if(o)for(const e of o)this.addAnnotation(e);return f(x,this,P).call(this,"create-overlay",{index:n}),i}async function*R(e,t,n){const i=await this.book.sections[n].createDocument();for(const{range:o,excerpt:r}of e(i,t))yield{cfi:this.getCFI(n,o),excerpt:r}}async function*I(e,t){const{sections:n}=this.book;for(const[i,{createDocument:o}]of n.entries()){if(!o)continue;const r=await o(),s=Array.from(e(r,t),(e=>{let{range:t,excerpt:n}=e;return{cfi:this.getCFI(i,t),excerpt:n}})),a=(i+1)/n.length;yield{progress:a},s.length&&(yield{index:i,subitems:s})}}t.View=A,customElements.define("foliate-view",A)}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,i),r.exports}i.m=t,i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce((function(t,n){return i.f[n](e,t),t}),[]))},i.u=function(e){return e+".js"},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},i.l=function(t,n,o,r){if(e[t])e[t].push(n);else{var s,a;if(void 0!==o)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==t){s=d;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=t),e[t]=[n];var h=function(n,i){s.onerror=s.onload=null,clearTimeout(u);var o=e[t];if(delete e[t],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((function(e){return e(i)})),n)return n(i)},u=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),a&&document.head.appendChild(s)}},function(){var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e}(),function(){var e={586:0};i.f.j=function(t,n){var o=i.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise((function(n,i){o=e[t]=[n,i]}));n.push(o[2]=r);var s=i.p+i.u(t),a=new Error;i.l(s,(function(n){if(i.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,o[1](a)}}),"chunk-"+t,t)}};var t=function(t,n){var o,r,s=n[0],a=n[1],l=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in a)i.o(a,o)&&(i.m[o]=a[o]);l&&l(i)}for(t&&t(n);c<s.length;c++)r=s[c],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),i(493);var o=i(456),r=i(777),s=l(i(58)),a=l(i(804));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t){return e.get(u(e,t))}function u(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Array.prototype.at||Object.defineProperty(Array.prototype,"at",{value:function(e){if(e<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]},writable:!0,configurable:!0});const f=async e=>e.isFile?e:(await Promise.all(Array.from(await new Promise(((t,n)=>e.createReader().readEntries((e=>t(e)),(e=>n(e))))),f))).flat(),g=async e=>{let t;if(e.isDirectory){const n=await(async e=>{const t=await f(e),n=await Promise.all(t.map((e=>new Promise(((t,n)=>e.file((n=>t([n,e.fullPath])),(e=>n(e)))))))),i=new Map(n.map((t=>{let[n,i]=t;return[i.replace(e.fullPath+"/",""),n]}))),o=new TextDecoder;return{loadText:async e=>{return t=await(e=>{var t;return(null===(t=i.get(e))||void 0===t?void 0:t.arrayBuffer())??null})(e),t?o.decode(t):null;var t},loadBlob:e=>i.get(e),getSize:e=>{var t;return(null===(t=i.get(e))||void 0===t?void 0:t.size)??0}}})(e),{EPUB:o}=await i.e(974).then(i.bind(i,974));t=await new o(n).init()}else{if(!e.size)throw new Error("File not found");if(await(async e=>{const t=new Uint8Array(await e.slice(0,4).arrayBuffer());return 80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]})(e)){const n=await(async e=>{const{configure:t,ZipReader:n,BlobReader:o,TextWriter:r,BlobWriter:s}=await i.e(630).then(i.bind(i,630));t({useWebWorkers:!1});const a=new n(new o(e)),l=await a.getEntries(),c=new Map(l.map((e=>[e.filename,e]))),d=e=>function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return c.has(t)?e(c.get(t),...i):null};return{entries:l,loadText:d((e=>e.getData(new r))),loadBlob:d(((e,t)=>e.getData(new s(t)))),getSize:e=>{var t;return(null===(t=c.get(e))||void 0===t?void 0:t.uncompressedSize)??0}}})(e);if((e=>{let{name:t,type:n}=e;return"application/vnd.comicbook+zip"===n||t.endsWith(".cbz")})(e)){const{makeComicBook:o}=await i.e(601).then(i.bind(i,601));t=o(n,e)}else if((e=>{let{name:t,type:n}=e;return"application/x-zip-compressed-fb2"===n||t.endsWith(".fb2.zip")||t.endsWith(".fbz")})(e)){const{makeFB2:e}=await i.e(592).then(i.bind(i,592)),{entries:o}=n,r=o.find((e=>e.filename.endsWith(".fb2"))),s=await n.loadBlob((r??o[0]).filename);t=await e(s)}else{const{EPUB:e}=await i.e(974).then(i.bind(i,974));t=await new e(n).init()}}else if(await(async e=>{const t=new Uint8Array(await e.slice(0,5).arrayBuffer());return 37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]&&45===t[4]})(e)){const{makePDF:n}=await i.e(548).then(i.bind(i,548));t=await n(e)}else if(await(async e=>{let{name:t,type:n}=e;return t.endsWith(".txt")})(e)){const{makeTxt:n}=await i.e(271).then(i.bind(i,271));t=await n(e)}else{const{isMOBI:n,MOBI:o}=await i.e(1).then(i.bind(i,1));if(await n(e)){const n=await i.e(393).then(i.bind(i,393));t=await new o({unzlib:n.unzlibSync}).open(e)}else if((e=>{let{name:t,type:n}=e;return"application/x-fictionbook+xml"===n||t.endsWith(".fb2")})(e)){const{makeFB2:n}=await i.e(592).then(i.bind(i,592));t=await n(e)}}}if(!t)throw new Error("File type not supported");const n=document.createElement("foliate-view");return document.body.append(n),await n.viewOpen(t),n},p=e=>{let{spacing:t,justify:n,hyphenate:i,fontSize:o,fontColor:r,aFontColor:s,fontWeight:a}=e;return`\n    * {\n       ${r?"color:"+r+";":""}\n      line-height: ${t} !important;\n    }\n    a {\n      ${o?"font-size:"+o+" !important ;":""}\n       ${s?"color:"+s+";":""}\n    }\n    p, li, blockquote, dd {\n        line-height: ${t} !important;\n        ${o?"font-size:"+o+" !important;":""}\n        ${a?"font-weight:"+a+" !important;":""}\n        text-align: ${n?"justify":"start"};\n        -webkit-hyphens: ${i?"auto":"manual"};\n        hyphens: ${i?"auto":"manual"};\n        -webkit-hyphenate-limit-before: 3;\n        -webkit-hyphenate-limit-after: 2;\n        -webkit-hyphenate-limit-lines: 2;\n        hanging-punctuation: allow-end last;\n        widows: 2;\n    }\n    /* prevent the above from overriding the align attribute */\n    [align="left"] { text-align: left; }\n    [align="right"] { text-align: right; }\n    [align="center"] { text-align: center; }\n    [align="justify"] { text-align: justify; }\n\n    pre {\n        white-space: pre-wrap !important;\n    }\n    aside[epub|type~="endnote"],\n    aside[epub|type~="footnote"],\n    aside[epub|type~="note"],\n    aside[epub|type~="rearnote"] {\n        display: none;\n    }\n`},v=document.querySelector.bind(document),m=new Intl.NumberFormat("en",{style:"percent"});var y=new WeakMap,w=new WeakSet;class b{closeSideBar(){v("#dimming-overlay").classList.remove("show"),v("#side-bar").classList.remove("show")}restoreReaderConfig(e){try{const t=JSON.parse(e);t.bgColor&&this.setBgColor(t.bgColor),t.fontColor&&this.setFontColor(t.fontColor),t.aFontColor&&this.setAfontColor(t.aFontColor),t.fontSize&&(t.fontSize=t.fontSize.replace("rem",""),this.setFontSize(parseFloat(t.fontSize))),t.fontWeight&&this.setFontWeight(parseFloat(t.fontWeight)),t.lineHeight&&this.setLineHeight(t.lineHeight),setTimeout((()=>{var e;t.pageinate&&(null===(e=this.view)||void 0===e||e.renderer.setAttribute("flow",t.pageinate),"pageinate"==t.pageinate?(v("#radio_pageinate").checked=!0,v("#radio_scroll").checked=!1):(v("#radio_pageinate").checked=!1,v("#radio_scroll").checked=!0))}),1e3)}catch(e){console.log(e)}}saveReaderConfigApi(){const e=v("#setting-bg-color").value,t=v("#setting-font-color").value,n=v("#setting-a-font-color").value;let i=JSON.stringify({bgColor:e,fontColor:t,aFontColor:n,fontSize:this.style.fontSize,lineHeight:this.style.spacing,pageinate:this.pageinate,fontWeight:this.style.fontWeight});this.nascabApi.setReaderConfig(i,null)}setFontColor(e){var t,n;v("#setting-font-color").value=e,document.documentElement.style.setProperty("--nas-font-color",e),this.style.fontColor=e,null===(t=(n=this.view.renderer).setStyles)||void 0===t||t.call(n,p(this.style))}setAfontColor(e){var t,n;v("#setting-a-font-color").value=e,document.documentElement.style.setProperty("--nas-a-font-color",e),this.style.aFontColor=e,null===(t=(n=this.view.renderer).setStyles)||void 0===t||t.call(n,p(this.style))}setBgColor(e){v("#setting-bg-color").value=e,document.documentElement.style.setProperty("--nas-bg-color",e)}setFontSize(e){var t,n;e<.5&&(e=.5),v("#setting-input-font-size").value=e,this.style.fontSize=e+"rem",null===(t=(n=this.view.renderer).setStyles)||void 0===t||t.call(n,p(this.style))}setFontWeight(e){var t,n;e<100&&(e=100),e>900&&(e=900),v("#setting-input-font-weight").value=e,this.style.fontWeight=e,null===(t=(n=this.view.renderer).setStyles)||void 0===t||t.call(n,p(this.style))}setLineHeight(e){var t,n;v("#setting-input-line-height").value=e,this.style.spacing=e,null===(t=(n=this.view.renderer).setStyles)||void 0===t||t.call(n,p(this.style))}constructor(){var e;d(this,e=w),e.add(this),function(e,t){d(e,t),t.set(e,void 0)}(this,y),c(this,"currentFile",void 0),c(this,"defaultLineHeight",1.4),c(this,"defaultFontSize",1),c(this,"defaultFontWeight",400),c(this,"defaultFontColor","#333333"),c(this,"defaultAFontColor","#334dce"),c(this,"defaultBgColor","#ffffff"),c(this,"pageinate","pageinate"),c(this,"style",{fontWeight:this.defaultFontWeight,fontColor:this.defaultFontColor,aFontColor:this.defaultAFontColor,spacing:this.defaultLineHeight,justify:!0,hyphenate:!0,fontSize:this.defaultFontSize+"rem"}),c(this,"annotations",new Map),c(this,"annotationsByValue",new Map),this.initReaderApi(),v("#side-bar-button").addEventListener("click",(()=>{v("#dimming-overlay").classList.add("show"),v("#side-bar").classList.add("show")})),v("#dimming-overlay").addEventListener("click",(()=>this.closeSideBar()));const t=v("#setting-input-font-size");t.value=this.defaultFontSize,t.addEventListener("change",(e=>{this.setFontSize(e.target.value),this.saveReaderConfigApi()}));const n=v("#setting-input-font-weight");n.value=this.defaultFontWeight,n.addEventListener("change",(e=>{this.setFontWeight(e.target.value),this.saveReaderConfigApi()}));const i=v("#setting-input-line-height");i.value=this.defaultLineHeight,i.addEventListener("change",(e=>{this.setLineHeight(e.target.value),this.saveReaderConfigApi()}));const o=v("#setting-bg-color");o.value=this.defaultBgColor,o.addEventListener("change",(e=>{this.setBgColor(e.target.value),this.saveReaderConfigApi()}));const r=v("#setting-font-color");r.value=this.defaultFontColor,r.addEventListener("change",(e=>{this.setFontColor(e.target.value),this.saveReaderConfigApi()}));const s=v("#setting-a-font-color");s.value=this.defaultAFontColor,s.addEventListener("change",(e=>{this.setAfontColor(e.target.value),this.saveReaderConfigApi()})),v("#bt-restore-config").addEventListener("click",(()=>{this.setFontColor("#333333"),this.setAfontColor("#334dce"),this.setBgColor("#ffffff"),this.setFontSize(1),this.setLineHeight(1.4),this.setFontWeight(400),this.saveReaderConfigApi()})),document.querySelectorAll('input[name="pageinate"]').forEach((e=>{e.addEventListener("change",(e=>{var t,n;"pageinate"==e.target.value?(null===(t=this.view)||void 0===t||t.renderer.setAttribute("flow","pageinate"),this.pageinate="pageinate"):(null===(n=this.view)||void 0===n||n.renderer.setAttribute("flow","scrolled"),this.pageinate="scrolled"),this.saveReaderConfigApi()}))})),v("#txt_bg_color").innerText=a.default.t("bgColor")+":",v("#txt_font_color").innerText=a.default.t("textColor")+":",v("#txt_a_color").innerText=a.default.t("linkColor")+":",v("#txt_line_height").innerText=a.default.t("lineHeight")+":",v("#bt-restore-config").innerText=a.default.t("defaults"),v("#title_page").innerText=a.default.t("switchPage")+":",v("#title_paginated").innerText=a.default.t("page"),v("#title_scrolled").innerText=a.default.t("scroll"),v("#txt_font_weight").innerText=a.default.t("fontWeight")+":"}async initReaderApi(){this.nascabApi||(this.nascabApi=new s.default)}async readerOpen(e){var t,n,s,a,l,c,d,f;this.currentFile=e,this.view=await g(e),this.view.addEventListener("load",u(w,this,x).bind(this)),this.view.addEventListener("relocate",u(w,this,A).bind(this));const{book:m}=this.view;null===(t=(n=this.view.renderer).setStyles)||void 0===t||t.call(n,p(this.style)),this.view.renderer.next(),v("#header-bar").style.visibility="visible",v("#nav-bar").style.visibility="visible",v("#loading").style.display="none",v("#left-button").addEventListener("click",(()=>this.view.goLeft())),v("#right-button").addEventListener("click",(()=>{this.view.goRight()}));const b=v("#progress-slider");b.dir=m.dir,b.addEventListener("input",(e=>{this.view.goToFraction(parseFloat(e.target.value))}));for(const e of this.view.getSectionFractions()){const t=document.createElement("option");t.value=e,v("#tick-marks").append(t)}document.addEventListener("keydown",u(w,this,k).bind(this));const C=(null===(s=m.metadata)||void 0===s?void 0:s.title)??"Untitled Book";document.title=C,v("#side-bar-title").innerText=C;const P=null===(a=m.metadata)||void 0===a?void 0:a.author;v("#side-bar-author").innerText="string"==typeof P?P:(null==P||null===(l=P.map((e=>"string"==typeof e?e:e.name)))||void 0===l?void 0:l.join(", "))??"",null===(c=Promise.resolve(null===(d=m.getCover)||void 0===d?void 0:d.call(m)))||void 0===c||c.then((e=>e?v("#side-bar-cover").src=URL.createObjectURL(e):null));const T=m.toc;var E,S;T&&(E=y,S=(0,o.createTOCView)(T,(e=>{this.view.goTo(e).catch((e=>console.error(e))),this.closeSideBar()})),E.set(u(E,this),S),v("#toc-view").append(h(y,this).element));const F=await(null===(f=m.getCalibreBookmarks)||void 0===f?void 0:f.call(m));if(F){const{fromCalibreHighlight:e}=await Promise.resolve().then(i.bind(i,596));for(const t of F)if("highlight"===t.type){const n=e(t),i={value:n,color:t.style.which,note:t.notes},o=this.annotations.get(t.spine_index);o?o.push(i):this.annotations.set(t.spine_index,[i]),this.annotationsByValue.set(n,i)}this.view.addEventListener("create-overlay",(e=>{const{index:t}=e.detail,n=this.annotations.get(t);if(n)for(const e of n)this.view.addAnnotation(e)})),this.view.addEventListener("draw-annotation",(e=>{const{draw:t,annotation:n}=e.detail,{color:i}=n;t(r.Overlayer.highlight,{color:i})})),this.view.addEventListener("show-annotation",(e=>{const t=this.annotationsByValue.get(e.detail.value);t.note&&alert(t.note)}))}this.nascabApi.restoreProgress(this,this.currentFile,(()=>{}))}}function k(e){const t=e.key;"ArrowLeft"===t||"h"===t?this.view.goLeft():"ArrowRight"!==t&&"l"!==t||this.view.goRight()}function C(e){e.deltaY>0?this.view.goRight():this.view.goLeft()}function x(e){let{detail:{doc:t}}=e;t.addEventListener("keydown",u(w,this,k).bind(this)),t.addEventListener("wheel",u(w,this,C).bind(this))}function A(e){var t,n;let{detail:i}=e;const{fraction:o,location:r,tocItem:s,pageItem:a}=i,l=m.format(o),c=a?`Page ${a.label}`:`Loc ${r.current}`,d=v("#progress-slider");d.style.visibility="visible",d.value=o,d.title=`${l} · ${c}`,null!=s&&s.href&&(null===(t=h(y,this))||void 0===t||null===(n=t.setCurrentHref)||void 0===n||n.call(t,s.href)),this.nascabApi.saveProgress(o,this.currentFile)}const P=async e=>{document.body.removeChild(v("#drop-target"));const t=new b;globalThis.reader=t,await t.readerOpen(e)},T=v("#drop-target");T.addEventListener("drop",(e=>{e.preventDefault();const t=Array.from(e.dataTransfer.items).find((e=>"file"===e.kind));if(t){const e=t.webkitGetAsEntry();P(e.isFile?t.getAsFile():e).catch((e=>console.error(e)))}})),T.addEventListener("dragover",(e=>e.preventDefault())),v("#file-input").addEventListener("change",(e=>P(e.target.files[0]).catch((e=>console.error(e))))),v("#file-button").addEventListener("click",(()=>v("#file-input").click()));const E=new URLSearchParams(location.search).get("url");E?fetch(E).then((e=>e.blob())).then((e=>{P(new File([e],new URL(E,window.location.origin).pathname))})).catch((e=>console.error(e))):T.style.visibility="visible"}();