"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[563],{563:function(t,e){function i(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function n(t,e,i){s(t,e),e.set(t,i)}function s(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(t,e,i){return t.set(o(t,e),i),i}function l(t,e){return t.get(o(t,e))}function o(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}Object.defineProperty(e,"__esModule",{value:!0}),e.FixedLayout=void 0;const h=t=>{var e,i;return null==t||null===(e=t.split(/[,;\s]/))||void 0===e||null===(i=e.filter((t=>t)))||void 0===i?void 0:i.map((t=>t.split("=").map((t=>t.trim()))))},a=(t,e)=>{var i;if("svg"===t.documentElement.localName){var n;console.log("getViewport 1");const[,,e,i]=(null===(n=t.documentElement.getAttribute("viewBox"))||void 0===n?void 0:n.split(/\s/))??[];return{width:e,height:i}}const s=h(null===(i=t.querySelector('meta[name="viewport"]'))||void 0===i?void 0:i.getAttribute("content"));if(s)return console.log("getViewport 2"),Object.fromEntries(s);if("string"==typeof e)return console.log("getViewport 3"),h(e);if(e)return console.log("getViewport 4"),e;const r=t.querySelector("img");return r?(console.log("getViewport 5",r.naturalWidth,r.naturalHeight),{width:r.naturalWidth,height:r.naturalHeight}):(console.warn(new Error("Missing viewport properties")),{width:1e3,height:2e3})};var d=new WeakMap,c=new WeakMap,u=new WeakMap,f=new WeakMap,p=new WeakMap,v=new WeakMap,g=new WeakMap,w=new WeakMap,m=new WeakMap,y=new WeakSet;class b extends HTMLElement{constructor(){var t;super(),s(this,t=y),t.add(this),n(this,d,this.attachShadow({mode:"closed"})),n(this,c,new ResizeObserver((()=>o(y,this,L).call(this)))),n(this,u,void 0),n(this,f,-1),i(this,"defaultViewport",void 0),i(this,"spread",void 0),n(this,p,!1),n(this,v,void 0),n(this,g,void 0),n(this,w,void 0),n(this,m,void 0),i(this,"startX",!1),i(this,"currentX",!1),i(this,"isScrollingLeft",!1);const e=new CSSStyleSheet;l(d,this).adoptedStyleSheets=[e],e.replaceSync(":host {\n            width: 100%;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }"),l(c,this).observe(this);const r={passive:!1};this.addEventListener("touchstart",o(y,this,x).bind(this),r),this.addEventListener("touchmove",o(y,this,k).bind(this),r),this.addEventListener("touchend",o(y,this,E).bind(this)),this.addEventListener("load",(t=>{let{detail:{doc:e}}=t;e.addEventListener("touchstart",o(y,this,x).bind(this),r),e.addEventListener("touchmove",o(y,this,k).bind(this),r),e.addEventListener("touchend",o(y,this,E).bind(this))}))}replaceNewChildren(t,e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var i=0;i<e.length;i++)t.appendChild(e[i])}open(t){this.book=t;const{rendition:e}=t;this.spread=null==e?void 0:e.spread,this.defaultViewport=null==e?void 0:e.viewport;const i="rtl"===t.dir,n=!i;this.rtl=i,"none"===(null==e?void 0:e.spread)?r(u,this,t.sections.map((t=>({center:t})))):r(u,this,t.sections.reduce(((t,e)=>{const s=t[t.length-1],{linear:r,pageSpread:l}=e;if("no"===r)return t;const o=()=>{const e={};return t.push(e),e};return"center"===l?(s.left||s.right?o():s).center=e:"left"===l?(s.center||s.left||n?o():s).left=e:"right"===l?(s.center||s.right||i?o():s).right=e:n?s.center||s.right?o().left=e:s.left?s.right=e:s.left=e:s.center||s.left?o().right=e:s.right?s.left=e:s.right=e,t}),[{}]))}get index(){const t=l(u,this)[l(f,this)],e=(null==t?void 0:t.center)??("left"===this.side?t.left??t.right:t.right??t.left);return this.book.sections.indexOf(e)}getSpreadOf(t){const e=l(u,this);for(let i=0;i<e.length;i++){const{left:n,right:s,center:r}=e[i];if(n===t)return{index:i,side:"left"};if(s===t)return{index:i,side:"right"};if(r===t)return{index:i,side:"center"}}}async goToSpread(t,e,i){if(t<0||t>l(u,this).length-1)return;if(t===l(f,this))return void o(y,this,L).call(this,e);r(f,this,t);const n=l(u,this)[t];if(n.center){var s,h;const t=this.book.sections.indexOf(n.center),e=await(null===(s=n.center)||void 0===s||null===(h=s.load)||void 0===h?void 0:h.call(s));await o(y,this,M).call(this,{center:{index:t,src:e}})}else{var a,d,c,p;const t=this.book.sections.indexOf(n.left),i=this.book.sections.indexOf(n.right),s={index:t,src:await(null===(a=n.left)||void 0===a||null===(d=a.load)||void 0===d?void 0:d.call(a))},r={index:i,src:await(null===(c=n.right)||void 0===c||null===(p=c.load)||void 0===p?void 0:p.call(c))};await o(y,this,M).call(this,{left:s,right:r,side:e})}o(y,this,W).call(this,i)}async select(t){await this.goTo(t)}async goTo(t){const{book:e}=this,i=await t,n=e.sections[i.index];if(!n)return;const{index:s,side:r}=this.getSpreadOf(n);await this.goToSpread(s,r)}async next(){if(!(this.rtl?o(y,this,C).call(this):o(y,this,O).call(this)))return this.goToSpread(l(f,this)+1,this.rtl?"right":"left","page");o(y,this,W).call(this,"page")}async prev(){if(!(this.rtl?o(y,this,O).call(this):o(y,this,C).call(this)))return this.goToSpread(l(f,this)-1,this.rtl?"left":"right","page");o(y,this,W).call(this,"page")}getContents(){return Array.from(l(d,this).querySelectorAll("iframe"),(t=>({doc:t.contentDocument})))}destroy(){l(c,this).unobserve(this)}}function x(t){t.preventDefault(),this.startX=t.touches[0].clientX}function k(t){t.preventDefault(),this.currentX=t.touches[0].clientX}function E(){const t=this.currentX-this.startX;t<-100?(this.isScrollingLeft=!0,console.log("下一页",t),this.next()):t>100&&(this.isScrollingLeft=!1,console.log("上一页",t),this.prev()),this.startX=null,this.currentX=null}async function S(t){let{index:e,src:i}=t;const n=document.createElement("div"),s=document.createElement("iframe");return n.append(s),Object.assign(s.style,{border:"0",display:"none",overflow:"hidden"}),s.setAttribute("sandbox","allow-same-origin allow-scripts"),s.setAttribute("scrolling","no"),s.setAttribute("part","filter"),l(d,this).append(n),i?new Promise((t=>{const r=()=>{s.removeEventListener("load",r);const i=s.contentDocument;this.dispatchEvent(new CustomEvent("load",{detail:{doc:i,index:e}}));const{width:l,height:o}=a(i,this.defaultViewport);t({element:n,iframe:s,width:parseFloat(l),height:parseFloat(o)})};s.addEventListener("load",r),s.src=i})):{blank:!0,element:n,iframe:s}}function L(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l(m,this);if(!t)return;const e=l(v,this)??{},i=l(w,this)??l(g,this),n="left"===t?e:i,{width:s,height:o}=this.getBoundingClientRect(),h="both"!==this.spread&&"portrait"!==this.spread&&o>s;r(p,this,h);const a=e.width??i.width,d=e.height??i.height,c=h||l(w,this)?Math.min(s/(n.width??a),o/(n.height??d)):Math.min(s/((e.width??a)+(i.width??a)),o/Math.max(e.height??d,i.height??d)),u=t=>{const{element:e,iframe:i,width:s,height:r,blank:l}=t;Object.assign(i.style,{width:`${s}px`,height:`${r}px`,transform:`scale(${c})`,transformOrigin:"top left",display:l?"none":"block"}),Object.assign(e.style,{width:(s??a)*c+"px",height:(r??d)*c+"px",overflow:"hidden",display:"block"}),h&&t!==n&&(e.style.display="none")};l(w,this)?u(l(w,this)):(u(e),u(i))}async function M(t){let{left:e,right:i,center:n,side:s}=t;this.replaceNewChildren(l(d,this),[]),r(v,this,null),r(g,this,null),r(w,this,null),n?(r(w,this,await o(y,this,S).call(this,n)),r(m,this,"center"),o(y,this,L).call(this)):(r(v,this,await o(y,this,S).call(this,e)),r(g,this,await o(y,this,S).call(this,i)),r(m,this,l(v,this).blank?"right":l(g,this).blank?"left":s),o(y,this,L).call(this))}function C(){var t,e,i,n;if(!(l(w,this)||null!==(t=l(v,this))&&void 0!==t&&t.blank))return l(p,this)&&"none"===(null===(e=l(v,this))||void 0===e||null===(i=e.element)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.display)?(l(g,this).element.style.display="none",l(v,this).element.style.display="block",r(m,this,"left"),!0):void 0}function O(){var t,e,i,n;if(!(l(w,this)||null!==(t=l(g,this))&&void 0!==t&&t.blank))return l(p,this)&&"none"===(null===(e=l(g,this))||void 0===e||null===(i=e.element)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.display)?(l(v,this).element.style.display="none",l(g,this).element.style.display="block",r(m,this,"right"),!0):void 0}function W(t){this.dispatchEvent(new CustomEvent("relocate",{detail:{reason:t,range:null,index:this.index,fraction:0,size:1}}))}e.FixedLayout=b,customElements.define("foliate-fxl",b)}}]);