!function(){"use strict";var e={804:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;let n="zh-CN";localStorage.language&&(n=localStorage.language);const o={"zh-CN":{ok:"确定",cancel:"取消",bgColor:"背景颜色",textColor:"正文字色",linkColor:"链接颜色",lineHeight:"行间距",defaults:"恢复默认",progress:"调节进度",switchPage:"翻页方式",page:"左右翻页",scroll:"上下滑动",fontWeight:"字粗",scaleMode:"缩放模式",pageLayout:"页面布局",readMode:"阅读模式",leftToRight:"从左到右",rightToLeft:"从右到左",vertical:"垂直",fitScreen:"适应屏幕",fitWidth:"适应宽度",singlePage:"单页",doublePage:"双页",pageMode:"翻页模式",paginated:"分页",freeMode:"自由滑动",pageButton:"翻页按钮",show:"显示",hide:"隐藏",autoPlayDelay:"自动播放间隔",jumpToIndex:"是否跳转到进度:",previewModeTitle:"预览模式:点击图片选择进度",noImgFound:"未找到可以浏览的图片",widthPadding:"两侧边距",helpTitle:"快捷键和操作说明",keyUpdown:"方向键上/下[或滚轮]",keyUpdownContent:"图片可滑动时滑动图片,无法滑动时翻页",keyLeftRight:"方向键左/右",keyLeftRightContent:"直接翻页",key:"按键",keyFcontent:"全屏",keyPcontent:"开始/停止自动播放",keyScontent:"选择进度",keyCcontent:"切换边距[仅'适配宽度'模式]",keyHomeContent:"第一页",keyEndContent:"最后一页",setOk:"设置已完成",keyDContent:"切换单页/双页",keyZContent:"切换缩放模式",keyHcontent:"隐藏/显示翻页按钮",keyMcontent:"隐藏/显示顶部菜单"},"zh-TW":{ok:"確定",cancel:"取消",bgColor:"背景顏色",textColor:"正文字色",linkColor:"鏈接顏色",lineHeight:"行間距",defaults:"恢復默認",progress:"調節進度",switchPage:"翻頁方式",page:"左右翻頁",scroll:"上下滑動",fontWeight:"字粗",scaleMode:"縮放模式",pageLayout:"頁面布局",readMode:"閱讀模式",leftToRight:"左到右",rightToLeft:"右到左",vertical:"垂直",fitScreen:"適應屏幕",fitWidth:"適應寬度",singlePage:"單頁",doublePage:"雙頁",pageMode:"翻頁模式",paginated:"分頁",freeMode:"自由滑動",pageButton:"翻頁按鈕",show:"顯示",hide:"隱藏",autoPlayDelay:"自動播放間隔",jumpToIndex:"是否跳轉到進度:",previewModeTitle:"預覽模式:點擊圖片選擇進度",noImgFound:"未找到可以瀏覽的圖片",widthPadding:"兩側邊距",helpTitle:"快捷鍵和操作說明",keyUpdown:"方向鍵上/下[或滾輪]",keyUpdownContent:"圖片可滑動時滑動圖片,無法滑動時翻頁",keyLeftRight:"方向鍵左/右",keyLeftRightContent:"直接翻頁",key:"按鍵",keyFcontent:"全屏",keyPcontent:"開始/停止自動播放",keyScontent:"選擇進度",keyCcontent:"切換邊距[僅'適配寬度'模式]",keyHomeContent:"第一頁",keyEndContent:"最後一頁",setOk:"設置已完成",keyDContent:"切換單頁/雙頁",keyZContent:"切換縮放模式",keyHcontent:"隱藏/顯示翻頁按鈕",keyMcontent:"隱藏/顯示頂部菜單"},"en-US":{ok:"OK",cancel:"CANCEL",bgColor:"Bg color",textColor:"Text color",linkColor:"Link color",lineHeight:"Line spacing",defaults:"Defaults",progress:"Progress",switchPage:"Page",page:"Paginated",scroll:"Scrolled",fontWeight:"Font Weight",scaleMode:"Scale mode",pageLayout:"Page layout",readMode:"Reading mode",leftToRight:"Left to right",rightToLeft:"Right to left",vertical:"Vertical",fitScreen:"Adapt to screen",fitWidth:"Fit Width",singlePage:"Single page",doublePage:"Double page",pageMode:"Page mode",paginated:"paginated",freeMode:"Free sliding",pageButton:"Page button",show:"Show",hide:"Hide",autoPlayDelay:"Auto play interval",jumpToIndex:"Whether to jump to progress:",previewModeTitle:"Preview mode: click image selection progress",noImgFound:"No images found to browse",widthPadding:"Margin",helpTitle:"Shortcut keys and operation instructions",keyUpdown:"Key up/down[Mousewheel]",keyUpdownContent:"Slide the picture when the picture can be slid, and turn the page when it cannot slide",keyLeftRight:"Key left/right",keyLeftRightContent:"Turn page directly",key:"Key",keyFcontent:"Full screen",keyPcontent:"Start/stop automatic playback",keyScontent:"Select Progress",keyCcontent:"Toggle margins ['Fit to width' mode only]",keyHomeContent:"First page",keyEndContent:"Last page",setOk:"Setup completed",keyDContent:"Switch single page/double page",keyZContent:"Switch zoom mode",keyHcontent:"Hide/show page button",keyMcontent:"Hide/show top menu"}};t.default={t:function(e){return o[n][e]}}},58:function(e,t){function n(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=class{constructor(){n(this,"lastSaveProgress",null),n(this,"timer",null),n(this,"token",null),n(this,"currentReadBook",null),this.getToken()}getBaseByLocation(){const[e,t]=window.location.pathname.split("/").filter(Boolean);return e&&t&&"book"==t?`${window.location.protocol}//${window.location.host}${"/"+e}`:`${window.location.protocol}//${window.location.host}`}getCurrentReadBook(){if(this.currentReadBook)return this.currentReadBook;let e=localStorage.currentReadBook||sessionStorage.currentReadBook;if(e)try{return this.currentReadBook=JSON.parse(e),localStorage.currentReadBook&&(sessionStorage.currentReadBook=localStorage.currentReadBook,localStorage.removeItem("currentReadBook")),this.currentReadBook}catch(e){console.log(e)}return null}getCookie(e){var t=e+"=",n=document.cookie.split(";");console.log(n);for(var o=0;o<n.length;o++){for(var i=n[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null}getToken(){if(this.token)return this.token;if(this.token=this.getQueryParam("token"),!this.token&&sessionStorage.token&&(this.token=sessionStorage.token),!this.token&&localStorage.store)try{let e=JSON.parse(localStorage.store);e.token&&(this.token=e.token)}catch(e){}return!this.token&&localStorage.tokenPlain&&(this.token=localStorage.tokenPlain),this.token||(this.token=this.getCookie("token"),console.log("从cookie中获取了token",this.token)),this.token}getZipFileUrl(e,t){let n=this.getToken();if(n)return this.getBaseByLocation()+`/api/zipFileApi/getZipInnerFile/file.jpg?token=${n}&zipFilePath=${encodeURIComponent(e)}&innerFilePath=${encodeURIComponent(t)}`}getQueryParam(e){let t=window.location.search.substring(1).split("&");for(let n=0;n<t.length;n++){let o=t[n].split("=");if(o[0]==e)return o[1]}return null}getFileName(e){if(console.log("file",e),!e)return"";try{let t=decodeURIComponent(e.name);console.log("name",e.name,t);return t.split("/").pop()}catch(e){return console.log("解析文件名出错",e),""}}sendHttpPost(e,t,n,o){const i=t;fetch(e,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>n(e))).catch((e=>o(e)))}saveProgressApi(e){localStorage.readerProgress=e,this.lastSaveProgress=e;let t=this.getToken(),n=this.getBaseByLocation()+"/api/bookApi/addReadRecord";if(!t)return console.log("token/file未找到 无法调用接口");let o="",i="",l=this.getCurrentReadBook();l&&(l.filename&&(o=l.filename),l.path&&(i=l.path)),this.sendHttpPost(n,{fileName:o,filePath:i,progress:e,token:t},(e=>{console.log("保存进度API调用成功",e)}),(e=>{console.log("保存进度API调用失败",e)}))}saveProgress(e,t){e!=this.lastSaveProgress&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.saveProgressApi(e,t)}),2e3))}getProgressApi(e,t,n){let o=this.getToken(),i=this.getBaseByLocation()+"/api/bookApi/getReadRecord";this.sendHttpPost(i,{fileName:e,filePath:t,token:o},(e=>{n(e)}),(e=>{console.log("获取阅读进度API调用失败",e)}))}restoreProgress(e,t,n){if(!this.getToken())return console.log("token未找到 无法调用接口");let o=this.getFileName(t),i="",l=this.getCurrentReadBook();l&&(l.filename&&(o=l.filename),l.path&&(i=l.path)),this.getProgressApi(o,i,(t=>{if(t.progress){let n=parseFloat(t.progress);n>0&&setTimeout((()=>{console.log("恢复进度"+n),e&&e.view.goToFraction(n)}),500)}t.readerConfig&&t.readerConfig.config_json&&e&&e.restoreReaderConfig(t.readerConfig.config_json),n&&n(t)}))}setReaderConfig(e,t){let n=this.getToken();if(!n)return console.log("token/file未找到 无法调用接口");let o=this.getBaseByLocation()+"/api/bookApi/setReaderConfig";this.sendHttpPost(o,{token:n,remark:t,configJson:e},(e=>{}),(e=>{console.log("保存阅读器配置失败",e)}))}getZipContent(e,t,n){let o=this.getToken();if(!o)return console.log("token/ 无法调用接口");let i=this.getBaseByLocation()+"/api/zipFileApi/getZipContentList";this.sendHttpPost(i,{token:o,zipFilePath:e,onlyImg:t},(e=>{n&&n(e)}),(e=>{console.log("获取压缩文件内容失败",e)}))}}},999:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=(o=n(969))&&o.__esModule?o:{default:o};const l=document.querySelector.bind(document);let a,r={},s=!0,d={isReached:!1},c={isReached:!1},u={isReached:!1},g={isReached:!1};function p(){return a||(a=document.querySelector(".swiper").swiper,a)}function f(){return l(".swiper-slide-active")}function h(){return l(".swiper-slide-next")}function y(){p().slidePrev()}function w(){p().slideNext()}function v(){return 2==p().params.slidesPerView}function k(e,t){function n(){let n=f();m(d,n),d.isReached?y():P(n,e,t)}if(v()){let o=h();m(u,o),u.isReached?n():P(o,e,t)}else n()}function m(e,t){t.scrollTop<=5?e.isReached=!0:e.isReached=!1}function b(e,t){let n=Math.floor(t.scrollHeight),o=Math.ceil(t.scrollTop)+Math.ceil(t.clientHeight);e.isReached=o>=n-5}function P(e,t,n){console.log("targetEl",e);let o=Math.ceil(e.scrollTop+t);n?e.scrollTo({top:o,behavior:"smooth"}):e.scrollTo({top:o})}function T(e,t){let n=f();if(b(c,n),c.isReached)if(v()){let n=h();b(g,n),g.isReached?w():P(n,e,t)}else w();else P(n,e,t)}r.initEvent=()=>{r.initMousewheelEvent(),r.initKeyboardEvent(),r.initTouchEvent()},r.initTouchEvent=()=>{},r.initKeyboardEvent=()=>{document.addEventListener("keyup",(function(e){if(e.preventDefault(),!s)return;let t=e.key;switch(e.key&&(t=t.toLowerCase()),t){case"arrowleft":y();break;case"arrowright":w();break;case"arrowup":k(-200);break;case"arrowdown":T(200);break;case"f":i.default.switchFullScreen();break;case"p":i.default.switchAutoPlay();break;case"l":i.default.setReadMode("ltr",!0),i.default.saveReaderConfigApi();break;case"r":i.default.setReadMode("rtl",!0),i.default.saveReaderConfigApi();break;case"v":i.default.setReadMode("vertical",!0),i.default.saveReaderConfigApi();break;case"s":i.default.enterPreviewMode();break;case"c":i.default.switchWidthPadding(),i.default.saveReaderConfigApi();break;case"d":i.default.switchPageLayout(),i.default.saveReaderConfigApi();break;case"z":i.default.switchScaleMode(),i.default.saveReaderConfigApi();break;case"h":i.default.switcPageButtonShow();break;case"m":i.default.switchTopMenuVisible();break;case"home":!function(){let e=p();e.slides.length>0&&e.slideTo(0,300)}();break;case"end":!function(){let e=p();e.slides.length>0&&e.slideTo(e.slides.length-1,300)}();break;default:console.log(t)}}))},r.initMousewheelEvent=()=>{l(".swiper").addEventListener("wheel",(e=>{e.preventDefault(),s&&(e.deltaY<0?k(e.deltaY,!1):e.deltaY>0&&T(e.deltaY,!1))}),{passive:!1})},r.setEventEnable=e=>{s=e},t.default=r},629:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=(o=n(804))&&o.__esModule?o:{default:o};const l=document.querySelector.bind(document);let a={setText:()=>{l("#scale_text").innerText=i.default.t("scaleMode")+":",l("#scale_fit_screen").innerText=i.default.t("fitScreen"),l("#scale_fit_width").innerText=i.default.t("fitWidth"),l("#layout_text").innerText=i.default.t("pageLayout")+":",l("#layout_single").innerText=i.default.t("singlePage"),l("#layout_double").innerText=i.default.t("doublePage"),l("#bg_text").innerText=i.default.t("bgColor")+":",l("#read_mode_text").innerText=i.default.t("readMode")+":",l("#read_ltr").innerText=i.default.t("leftToRight"),l("#read_rtl").innerText=i.default.t("rightToLeft"),l("#read_vertical").innerText=i.default.t("vertical"),l("#page_mode_text").innerText=i.default.t("pageMode")+":",l("#page_paginated").innerText=i.default.t("paginated"),l("#page_free").innerText=i.default.t("freeMode"),l("#page_button").innerText=i.default.t("pageButton")+":",l("#button_show").innerText=i.default.t("show"),l("#button_hide").innerText=i.default.t("hide"),l("#autoplay_text").innerText=i.default.t("autoPlayDelay")+":",l("#preview-text-title").innerText=i.default.t("previewModeTitle"),l("#bt-restore-config").innerText=i.default.t("defaults"),l("#width_padding_text").innerText=i.default.t("widthPadding"),l("#help-title").innerText=i.default.t("helpTitle"),l("#help-updown-title").innerText=i.default.t("keyUpdown")+": ",l("#help-updown-content").innerText=i.default.t("keyUpdownContent"),l("#help-lr-title").innerText=i.default.t("keyLeftRight")+": ",l("#help-lr-content").innerText=i.default.t("keyLeftRightContent"),l("#help-f-title").innerText=i.default.t("key")+" f: ",l("#help-p-title").innerText=i.default.t("key")+" p: ",l("#help-s-title").innerText=i.default.t("key")+" s: ",l("#help-l-title").innerText=i.default.t("key")+" l: ",l("#help-r-title").innerText=i.default.t("key")+" r: ",l("#help-v-title").innerText=i.default.t("key")+" v: ",l("#help-c-title").innerText=i.default.t("key")+" c: ",l("#help-d-title").innerText=i.default.t("key")+" d: ",l("#help-z-title").innerText=i.default.t("key")+" z: ",l("#help-h-title").innerText=i.default.t("key")+" h: ",l("#help-m-title").innerText=i.default.t("key")+" m: ",l("#help-home-title").innerText=i.default.t("key")+" Home: ",l("#help-end-title").innerText=i.default.t("key")+" End: ",l("#help-f-content").innerText=i.default.t("keyFcontent"),l("#help-p-content").innerText=i.default.t("keyPcontent"),l("#help-s-content").innerText=i.default.t("keyScontent"),l("#help-l-content").innerText=i.default.t("leftToRight"),l("#help-r-content").innerText=i.default.t("rightToLeft"),l("#help-v-content").innerText=i.default.t("vertical"),l("#help-c-content").innerText=i.default.t("keyCcontent"),l("#help-h-content").innerText=i.default.t("keyHcontent"),l("#help-m-content").innerText=i.default.t("keyMcontent"),l("#help-home-content").innerText=i.default.t("keyHomeContent"),l("#help-end-content").innerText=i.default.t("keyEndContent"),l("#help-d-content").innerText=i.default.t("keyDContent"),l("#help-z-content").innerText=i.default.t("keyZContent")}};t.default=a},969:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n(804)),i=s(n(58)),l=s(n(999)),a=s(n(629)),r=s(n(544));function s(e){return e&&e.__esModule?e:{default:e}}let d={},c=null,u=new i.default;const g=document.querySelector.bind(document);let p,f,h=!1,y=0,w=[],v=!1,k={scaleMode:"fitScreen",pageLayout:"single",readMode:"ltr",pageMode:"paginated",imgOrder:"asc",bgColor:"#FFFFFF",pageButton:"show",autoPlayDelay:10,widthPadding:0},m={...k};function b(){return p||(p=document.querySelector(".swiper").swiper,p)}d.getIsDoingPreview=()=>h,d.showMessage=e=>{UIkit.notification.closeAll(),UIkit.notification(e)},d.initSwiper=(e,t,n)=>{d.initSettings();for(const n in t){const o=t[n];let i=`\n    <div class="swiper-slide" >\n      <img index=${n} alt="${o.name}" class="swiper-slide-img-main" src='${u.getZipFileUrl(e,o.name)}' loading="lazy" />\n      <div class="swiper-lazy-preloader"></div>\n      <div index=${n} class="number-sign" style="align-items: center;justify-content: center;display: none;position: absolute;width: 100%;height: 100%;color: white;text-align: center;visibility:hidden">\n        <span style="width: 30px;height: 30px;background-color: rgba(0,0,0,0.5);color:white;text-align: center;line-height: 30px;border-radius: 50%;">${parseInt(n)+1}</span>\n      </div>\n    </div>`;w.push(i)}if(p=new Swiper(".swiper",{lazyPreloadPrevNext:2,direction:"horizontal",navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},scrollbar:{el:".swiper-scrollbar",draggable:!0,dragSize:30},on:{init:()=>{d.setAutoHideTopMenu(),setTimeout((()=>{v=!0}),2e3)},slideChange:()=>{d.slideChange()},slideChangeTransitionStart:()=>{l.default.setEventEnable(!1)},slideChangeTransitionEnd:()=>{l.default.setEventEnable(!0)},click:(e,t)=>{console.log("click",t),d.onSwiperClick(t)}}}),p.appendSlide(w),n&&n.readerConfig&&n.readerConfig.remark&&n.readerConfig.remark.startsWith("{"))try{let e=JSON.parse(n.readerConfig.remark);d.restoreConfig(e)}catch(e){}if(n&&n.progress){console.log("record.progress",n.progress);try{let e=parseFloat(n.progress),t=Math.round(e*p.slides.length);t>0&&(console.log("shouldJumpIndex",t),p.slideTo(t),d.setPage(t+1,p.slides.length))}catch(e){console.log(e)}}else d.setPage(1,p.slides.length);l.default.initEvent()},d.switchWidthPadding=()=>{m.widthPadding<40?d.setWidthPadding(m.widthPadding+5,!0):d.setWidthPadding(0,!0)},d.setWidthPadding=(e,t)=>{if(h)return;if("fitWidth"!=m.scaleMode||e<0||e>40)return;let n=document.getElementsByClassName("swiper-slide-img-main");for(let t of n)t.style.width=100-2*e+"%",t.style.marginLeft=e+"%",t.style.marginRight=e+"%";m.widthPadding=e,g("#select_width_padding").value=e,t&&d.showMessage(`${o.default.t("widthPadding")}:${e}%`)},d.saveReaderConfigApi=()=>{let e=JSON.stringify(m);u.setReaderConfig(null,e)},d.switchScaleMode=()=>{d.setScaleMode("fitScreen"==m.scaleMode?"fitWidth":"fitScreen",!0)},d.setScaleMode=(e,t)=>{if(h)return;let n=b(),i="flex";"fitScreen"==e?(i="flex",g("#select_width_padding").disabled=!0,d.setWidthPadding(0)):"fitWidth"==e&&(i="block",g("#select_width_padding").disabled=!1);let l=document.getElementsByClassName("swiper-slide");for(let e of l)e.style.display=i;n.update(),m.scaleMode=e,g("#select_scale").value=e,t&&d.showMessage(`${o.default.t("scaleMode")}:${o.default.t(e)}`)},d.setBgColor=e=>{document.body.style.backgroundColor=e,m.bgColor=e,g("#setting-bg-color").value=e},d.switchPageLayout=()=>{d.setPageLayout("single"==m.pageLayout?"double":"single",!0)},d.setPageLayout=(e,t)=>{if(h)return;let n=b();if("single"==e?g("#select_width_padding").disabled=!1:(g("#select_width_padding").disabled=!0,d.setWidthPadding(0)),n.params.slidesPerView="double"==e?2:1,n.params.slidesPerGroup="double"==e?2:1,n.update(),g("#select_layout").value=e,m.pageLayout=e,t){let t="single"==e?o.default.t("singlePage"):o.default.t("doublePage");d.showMessage(`${o.default.t("pageLayout")}:${t}`)}},d.setPageMode=e=>{if(h)return;let t=b();t.params.freeMode.enabled="free"==e,t.init(document.querySelector(".swiper")),g("#select_page_mode").value=e,m.pageMode=e},d.setReadMode=(e,t)=>{if(h)return;let n=b();if(g("#select_layout").disabled=!1,"ltr"==e?(n.changeDirection("horizontal"),n.changeLanguageDirection("ltr")):"rtl"==e?(n.changeDirection("horizontal"),n.changeLanguageDirection("rtl")):"vertical"==e&&(n.changeLanguageDirection("ltr"),n.changeDirection("vertical"),d.setPageLayout("single"),g("#select_layout").disabled=!0),n.update(),m.readMode=e,g("#select_reading_mode").value=e,t){let t=o.default.t("leftToRight");"rtl"==e&&(t=o.default.t("rightToLeft")),"vertical"==e&&(t=o.default.t("vertical")),d.showMessage(`${o.default.t("readMode")}:${t}`)}},d.setAutoplayDelay=e=>{m.autoPlayDelay=e,g("#input_autoplay_delay").value=e},d.switcPageButtonShow=()=>{d.setPageButtonIsShow("show"==m.pageButton?"hide":"show")},d.setPageButtonIsShow=e=>{"show"==e?(g("#button_pre").style.visibility="visible",g("#button_next").style.visibility="visible"):(g("#button_pre").style.visibility="hidden",g("#button_next").style.visibility="hidden"),m.pageButton=e,g("#select_page_button").value=e},d.switchAutoPlay=()=>{let e=b();e.autoplay.running?(e.params.autoplay=!1,e.autoplay.stop(),g("#icon-autoplay").src="./vendor/icons/play.png"):(e.params.autoplay={delay:1e3*m.autoPlayDelay},e.autoplay.start(),g("#icon-autoplay").src="./vendor/icons/pause.png")},d.setRows=e=>{let t=b();t.params.grid={fill:"column",rows:e},e>1?(t.params.slidesPerView=3,t.params.slidesPerGroup=3):t.params.grid=!1,t.update()},d.setPreviewProgressUi=e=>{let t=b();console.log("value",t.realIndex+3),g("#preview-input-progress").value=t.realIndex,g("#preview-input-progress").min=1,g("#preview-input-progress").step=1;let n=parseInt(t.slides.length/3);console.log("max",n),g("#preview-input-progress").max=n},d.enterPreviewMode=()=>{let e=b();f={...m},y=e.realIndex,d.setTopMenuVisible(!1),d.setScaleMode("fitScreen"),d.setWidthPadding(0),d.setReadMode("ltr"),d.setRows(3),d.setPreviewProgressText(),g("#preview-root").style.visibility="visible",g("#preview-progress-root").style.visibility="visible",e.slideTo(0),d.setPreviewProgressUi(),d.setSignVisiable(!0),e.autoplay.running&&d.switchAutoPlay(),h=!0},d.setSignVisiable=e=>{let t=document.getElementsByClassName("number-sign");for(let n of t)e?(n.style.visibility="visible",n.style.display="flex"):(n.style.visibility="hidden",n.style.display="none")},d.onPreviewProgressChange=e=>{h&&(e=parseInt(e),b().slideTo(e))},d.exitPreviewMode=e=>{h=!1,d.setRows(1),console.log("beforePreviewConfig",f),d.restoreConfig(f),g("#preview-root").style.visibility="hidden",g("#preview-progress-root").style.visibility="hidden",e&&b().slideTo(y,0),g(".swiper-wrapper").style.width="100%",d.setSignVisiable(!1)},d.switchFullScreen=()=>{r.default.isFullscreen?r.default.exit():r.default.request()},d.restoreConfig=e=>{m=e,d.setScaleMode(m.scaleMode),d.setWidthPadding(m.widthPadding),d.setPageLayout(m.pageLayout),d.setReadMode(m.readMode),d.setPageMode(m.pageMode),d.setBgColor(m.bgColor),d.setPageButtonIsShow(m.pageButton),d.setAutoplayDelay(m.autoPlayDelay)},d.downloadUrl=(e,t)=>{e+="&download=1";let n=JSON.stringify([e]);if(window.android)window.android.downloadFiles(n);else if(window.webkit&&window.webkit.messageHandlers)window.webkit.messageHandlers.bridge.postMessage(`{"func": "downloadFiles","downloadFilesJson":${n}}`);else{var o=document.createElement("a");o.href=e,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o)}},d.initSettingEvent=()=>{g("#select_scale").addEventListener("change",(e=>{console.log("选择了缩放模式",e.target.value),d.setScaleMode(e.target.value,!0),d.saveReaderConfigApi()})),g("#select_layout").addEventListener("change",(e=>{console.log("选择了页面布局",e.target.value),d.setPageLayout(e.target.value),d.saveReaderConfigApi()})),g("#select_reading_mode").addEventListener("change",(e=>{console.log("选择了阅读模式",e.target.value),d.setReadMode(e.target.value,!0),d.saveReaderConfigApi()})),g("#select_page_mode").addEventListener("change",(e=>{console.log("选择了翻页模式",e.target.value),d.setPageMode(e.target.value),d.saveReaderConfigApi()})),g("#setting-bg-color").addEventListener("change",(e=>{console.log("选择了背景色",e.target.value),d.setBgColor(e.target.value),d.saveReaderConfigApi()})),g("#select_page_button").addEventListener("change",(e=>{console.log("选择了翻页按钮",e.target.value),d.setPageButtonIsShow(e.target.value),d.saveReaderConfigApi()})),g("#input_autoplay_delay").addEventListener("change",(e=>{console.log("修改了自动播放间隔",e.target.value),d.setAutoplayDelay(e.target.value),d.saveReaderConfigApi()})),g("#icon-autoplay").addEventListener("click",(()=>{console.log("自动播放"),d.switchAutoPlay()})),g("#select_width_padding").addEventListener("change",(e=>{console.log("设置边距",e.target.value),d.setWidthPadding(e.target.value,!0),d.saveReaderConfigApi()})),g("#icon-fullcreen").addEventListener("click",(()=>{console.log("全屏"),d.switchFullScreen()})),g("#preview-img-close").addEventListener("click",(()=>{console.log("退出预览模式"),d.exitPreviewMode(!0)})),g("#icon-grid").addEventListener("click",(()=>{console.log("进入预览模式"),d.enterPreviewMode()})),g("#icon-download").addEventListener("click",(()=>{let e=b();function t(t){if(t>=e.slides.length)return;let n=e.slides[t].getElementsByClassName("swiper-slide-img-main");if(n.length>0){let e=n[0];console.log(e);let t=e.getAttribute("src"),o=e.getAttribute("alt");d.downloadUrl(t,o)}}e.slides.length<1||(t(e.realIndex),"double"==m.pageLayout&&t(e.realIndex+1))})),g("#preview-input-progress").addEventListener("change",(e=>{console.log("预览进度条被拖动",e.target.value),d.onPreviewProgressChange(e.target.value)})),r.default.isEnabled||(g("#icon-fullcreen").style.display="none"),g("#bt-restore-config").addEventListener("click",(()=>{console.log("恢复默认"),d.setScaleMode(k.scaleMode),d.setWidthPadding(k.widthPadding),d.setPageLayout(k.pageLayout),d.setReadMode(k.readMode),d.setPageMode(k.pageMode),d.setBgColor(k.bgColor),d.setPageButtonIsShow(k.pageButton),d.setAutoplayDelay(k.autoPlayDelay),d.saveReaderConfigApi()}))},d.initSettings=()=>{a.default.setText(),d.initSettingEvent()},d.setAutoHideTopMenu=()=>{c&&clearTimeout(c),c=setTimeout((()=>{d.setTopMenuVisible(!1)}),5e3)},d.setTopMenuVisible=e=>{g("#top-menu").style.visibility=e?"visible":"hidden",e&&c&&clearTimeout(c)},d.switchTopMenuVisible=()=>{let e=g("#top-menu");e.style.visibility&&"visible"!=e.style.visibility?d.setTopMenuVisible(!0):d.setTopMenuVisible(!1)},d.setPage=(e,t)=>{let n=g("#txt_current_page"),o=g("#txt_total_page");n.innerHTML=e+"",o.innerHTML=t+""},d.setPreviewProgressText=()=>{let e=3*b().realIndex,t=e+9;g("#preview-text-progress").innerText=`${e+1}-${t}`},d.slideChange=()=>{let e=b();d.setAutoHideTopMenu(),d.setPage(e.realIndex+1,e.slides.length),h||v&&u.saveProgress(e.realIndex/e.slides.length),h&&(d.setPreviewProgressText(),d.setPreviewProgressUi())},d.onSwiperClick=e=>{let t=b();if(h){if(e.target){let n=e.target.getAttribute("index");n&&(console.log("点击图片",n),UIkit.modal.confirm(o.default.t("jumpToIndex")+(parseInt(n)+1)+"/"+t.slides.length,{i18n:{ok:o.default.t("ok"),cancel:o.default.t("cancel")}}).then((()=>{d.exitPreviewMode(!1),t.slideTo(n,0)}),(()=>{})))}}else d.switchTopMenuVisible()},t.default=d},544:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],o=(()=>{if("undefined"==typeof document)return!1;const e=n[0],t={};for(const o of n)if((null==o?void 0:o[1])in document){for(const[n,i]of o.entries())t[e[n]]=i;return t}return!1})(),i={change:o.fullscreenchange,error:o.fullscreenerror};let l={request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(((n,i)=>{const a=()=>{l.off("change",a),n()};l.on("change",a);const r=e[o.requestFullscreen](t);r instanceof Promise&&r.then(a).catch(i)}))},exit(){return new Promise(((e,t)=>{if(!l.isFullscreen)return void e();const n=()=>{l.off("change",n),e()};l.on("change",n);const i=document[o.exitFullscreen]();i instanceof Promise&&i.then(n).catch(t)}))},toggle(e,t){return l.isFullscreen?l.exit():l.request(e,t)},onchange(e){l.on("change",e)},onerror(e){l.on("error",e)},on(e,t){const n=i[e];n&&document.addEventListener(n,t,!1)},off(e,t){const n=i[e];n&&document.removeEventListener(n,t,!1)},raw:o};Object.defineProperties(l,{isFullscreen:{get:()=>Boolean(document[o.fullscreenElement])},element:{enumerable:!0,get:()=>document[o.fullscreenElement]??void 0},isEnabled:{enumerable:!0,get:()=>Boolean(document[o.fullscreenEnabled])}}),o||(l={isEnabled:!1}),t.default=l}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,n),l.exports}var o=a(n(58)),i=a(n(804)),l=a(n(969));function a(e){return e&&e.__esModule?e:{default:e}}const r=new o.default;let s,d=0;function c(e){try{const t=e.replace(/\\/g,"/");return t.slice(t.lastIndexOf("/")+1)}catch(e){return""}}s=r.getQueryParam("zPath"),s?(s=decodeURIComponent(s),r.getZipContent(s,1,(e=>{if(e.code)e.message&&UIkit.modal.alert(e.message);else{if(e.size&&(d=e.size),!e.data||e.data.length<1)return void UIkit.modal.alert(i.default.t("noImgFound"));r.restoreProgress(null,null,(t=>{l.default.initSwiper(s,e.data,t)}))}})),c(s)&&(document.title=c(s))):console.log("需要zPath参数")}();