"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[592],{592:function(e,t){t.makeFB2=void 0;const n=e=>e?e.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"",r=e=>n(null==e?void 0:e.textContent),o={XLINK:"http://www.w3.org/1999/xlink",EPUB:"http://www.idpf.org/2007/ops"},i="application/xml",l="application/xhtml+xml",a={strong:["strong","self"],emphasis:["em","self"],style:["span","self"],a:"anchor",strikethrough:["s","self"],sub:["sub","self"],sup:["sup","self"],code:["code","self"],image:"image"},s={epigraph:["blockquote"],subtitle:["h2",a],"text-author":["p",a],date:["p",a],stanza:"stanza"},c={title:["header",{p:["h1",a],"empty-line":["br"]}],epigraph:["blockquote","self"],image:"image",annotation:["aside"],section:["section","self"],p:["p",a],poem:["blockquote",s],subtitle:["h2",a],cite:["blockquote","self"],"empty-line":["br"],table:["table",{tr:["tr",["align"]],th:["th",["colspan","rowspan","align","valign"]],td:["td",["colspan","rowspan","align","valign"]]}],"text-author":["p",a]};s.epigraph.push(c);const d={image:"image",title:["section",{p:["h1",a],"empty-line":["br"]}],epigraph:["section",c],section:["section",c]},u=e=>{const t=e.getAttributeNS(o.XLINK,"href"),[,n]=t.split("#"),r=e.getRootNode().getElementById(n);return r?`data:${r.getAttribute("content-type")};base64,${r.textContent}`:t};class p{constructor(e){this.fb2=e,this.doc=document.implementation.createDocument(o.XHTML,"html")}image(e){const t=this.doc.createElement("img");return t.alt=e.getAttribute("alt"),t.title=e.getAttribute("title"),t.setAttribute("src",u(e)),t}anchor(e){const t=this.convert(e,{a:["a",a]});return t.setAttribute("href",e.getAttributeNS(o.XLINK,"href")),"note"===e.getAttribute("type")&&t.setAttributeNS(o.EPUB,"epub:type","noteref"),t}stanza(e){const t=this.convert(e,{stanza:["p",{title:["header",{p:["strong",a],"empty-line":["br"]}],subtitle:["p",a]}]});for(const n of e.children)"v"===n.nodeName&&(t.append(this.doc.createTextNode(n.textContent)),t.append(this.doc.createElement("br")));return t}convert(e,t){if(3===e.nodeType)return this.doc.createTextNode(e.textContent);if(4===e.nodeType)return this.doc.createCDATASection(e.textContent);if(8===e.nodeType)return this.doc.createComment(e.textContent);const n=null==t?void 0:t[e.nodeName];if(!n)return null;if("string"==typeof n)return this[n](e);const[r,o]=n,i=this.doc.createElement(r);if(e.id&&(i.id=e.id),i.classList.add(e.nodeName),Array.isArray(o))for(const t of o)i.setAttribute(t,e.getAttribute(t));const l="self"===o?t:Array.isArray(o)?null:o;let a=e.firstChild;for(;a;){const e=this.convert(a,l);e&&i.append(e),a=a.nextSibling}return i}}const m=URL.createObjectURL(new Blob(['\n@namespace epub "http://www.idpf.org/2007/ops";\nbody > img, section > img {\n    display: block;\n    margin: auto;\n}\n.title h1 {\n    text-align: center;\n}\nbody > section > .title, body.notesBodyType > .title {\n    margin: 3em 0;\n}\nbody.notesBodyType > section .title h1 {\n    text-align: start;\n}\nbody.notesBodyType > section .title {\n    margin: 1em 0;\n}\np {\n    text-indent: 1em;\n    margin: 0;\n}\n:not(p) + p, p:first-child {\n    text-indent: 0;\n}\n.poem p {\n    text-indent: 0;\n    margin: 1em 0;\n}\n.text-author, .date {\n    text-align: end;\n}\n.text-author:before {\n    content: "â€”";\n}\ntable {\n    border-collapse: collapse;\n}\ntd, th {\n    padding: .25em;\n}\na[epub|type~="noteref"] {\n    font-size: .75em;\n    vertical-align: super;\n}\nbody:not(.notesBodyType) > .title, body:not(.notesBodyType) > .epigraph {\n    margin: 3em 0;\n}\n'],{type:"text/css"})),f="data-foliate-id";t.makeFB2=async e=>{const t={},o=await(async e=>{var t;const n=await e.arrayBuffer(),r=new TextDecoder("utf-8").decode(n),o=new DOMParser,l=o.parseFromString(r,i),a=l.xmlEncoding||(null===(t=r.match(/^<\?xml\s+version\s*=\s*["']1.\d+"\s+encoding\s*=\s*["']([A-Za-z0-9._-]*)["']/))||void 0===t?void 0:t[1]);if(a&&"utf-8"!==a.toLowerCase()){const e=new TextDecoder(a).decode(n);return o.parseFromString(e,i)}return l})(e),a=new p(o),s=e=>o.querySelector(e),h=e=>[...o.querySelectorAll(e)],g=e=>{const t=r(e.querySelector("nickname"));if(t)return t;const n=r(e.querySelector("first-name")),o=r(e.querySelector("middle-name")),i=r(e.querySelector("last-name"));return{name:[n,o,i].filter((e=>e)).join(" "),sortAs:i?[i,[n,o].filter((e=>e)).join(" ")].join(", "):null}},b=e=>(null==e?void 0:e.getAttribute("value"))??r(e),y=s("title-info annotation");if(t.metadata={title:r(s("title-info book-title")),identifier:r(s("document-info id")),language:r(s("title-info lang")),author:h("title-info author").map(g),translator:h("title-info translator").map(g),producer:h("document-info author").map(g).concat(h("document-info program-used").map(r)),publisher:r(s("publish-info publisher")),published:b(s("title-info date")),modified:b(s("document-info date")),description:y?a.convert(y,{annotation:["div",c]}).innerHTML:null,subject:h("title-info genre").map(r)},s("coverpage image")){const e=u(s("coverpage image"));t.getCover=()=>fetch(e).then((e=>e.blob()))}else t.getCover=()=>null;const x=Array.from(o.querySelectorAll("body"),(e=>{const t=a.convert(e,{body:["body",d]});return[Array.from(t.children,(e=>{const t=[e,...e.querySelectorAll("[id]")].map((e=>e.id));return{el:e,ids:t}})),t]})),v=[],A=x[0][0].map((e=>{let{el:t,ids:n}=e;return{ids:n,titles:Array.from(t.querySelectorAll(":scope > section > .title"),((e,t)=>(e.setAttribute(f,t),{title:r(e),index:t}))),el:t}})).concat(x.slice(1).map((e=>{let[t,n]=e;const r=t.map((e=>e.ids)).flat();return n.classList.add("notesBodyType"),{ids:r,el:n,linear:"no"}}))).map((e=>{var t;let{ids:r,titles:o,el:i,linear:a}=e;const s=(c=i.outerHTML,`<?xml version="1.0" encoding="utf-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head><link href="${m}" rel="stylesheet" type="text/css"/></head>\n    <body>${c}</body>\n</html>`);var c;const d=new Blob([s],{type:l}),u=URL.createObjectURL(d);return v.push(u),{ids:r,title:n((null===(t=i.querySelector(".title, .subtitle, p"))||void 0===t?void 0:t.textContent)??(i.classList.contains("title")?i.textContent:"")),titles:o,load:()=>u,createDocument:()=>(new DOMParser).parseFromString(s,l),size:d.size-Array.from(i.querySelectorAll("[src]"),(e=>{var t;return(null===(t=e.getAttribute("src"))||void 0===t?void 0:t.length)??0})).reduce(((e,t)=>e+t),0),linear:a}})),w=new Map;return t.sections=A.map(((e,t)=>{const{ids:n,load:r,createDocument:o,size:i,linear:l}=e;for(const e of n)e&&w.set(e,t);return{id:t,load:r,createDocument:o,size:i,linear:l}})),t.toc=A.map(((e,t)=>{let{title:n,titles:r}=e;const o=t.toString();return{label:n,href:o,subitems:null!=r&&r.length?r.map((e=>{let{title:t,index:n}=e;return{label:t,href:`${o}#${n}`}})):null}})).filter((e=>e)),t.resolveHref=e=>{const[t,n]=e.split("#");return t?{index:Number(t),anchor:e=>e.querySelector(`[${f}="${n}"]`)}:{index:w.get(n),anchor:e=>e.getElementById(n)}},t.splitTOCHref=e=>{var t;return(null==e||null===(t=e.split("#"))||void 0===t?void 0:t.map((e=>Number(e))))??[]},t.getTOCFragment=(e,t)=>e.querySelector(`[${f}="${t}"]`),t.destroy=()=>{for(const e of v)URL.revokeObjectURL(e)},t}}}]);