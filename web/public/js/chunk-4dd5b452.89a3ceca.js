(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4dd5b452","chunk-2d0e48df"],{1498:function(t,e,o){"use strict";o.r(e);o("14d9");var s=o("be3b"),i={props:{singleSelectMode:{default:!1,type:Boolean}},components:{albumDetail:()=>Promise.resolve().then(o.bind(null,"8fad"))},data(){return{dealState:"",inputName:"",autoNameArr:[],showChangeName:!1,rightMenuList:[{text:this.$t("file.check"),type:"CHECK"},{text:this.$t("common.multiSelect"),type:"SELECT"},{text:this.$t("photo.changeName"),type:"MODIFY"},{text:this.$t("common.delete"),type:"DELETE"}],changeAlbumName:"",itemBaseWidth:180,itemWidth:180,itemMargin:10,selectedItem:"",showAlbumDetail:!1,showAddAlbum:!1,dataList:[],loading:!1,selectedIndex:!1,selectMode:!1,enable:!0,checkStateTimeout:null}},mounted(){this.getFacesList(),window.addEventListener("resize",this.calImageWidth),window.addEventListener("popstate",this.onPopstate)},beforeDestroy(){window.removeEventListener("resize",this.calImageWidth),window.removeEventListener("popstate",this.onPopstate),clearTimeout(this.checkStateTimeout)},methods:{getSelectedFaceId(){for(var t of this.dataList)if(t.selected)return t.id;return!1},onPageScroll(t){if(this.$refs.faceCm&&this.$refs.faceCm.show)return this.$refs.faceCm.hide()},onPopstate(){this.showAlbumDetail?(this.showAlbumDetail=!1,this.$bus.$emit("closePhotoGallery")):this.$router.go(-1)},enableAiFace(){this.api.post("/api/commonApi/saveConfigPhoto",{aiFaceEnable:"1"}).then(t=>{this.getFacesList()}).catch(t=>{})},exitSelectMode(){for(var t in this.selectMode=!1,this.dataList)this.dataList[t].selected=!1},itemSingleSelect(t){for(var e in this.dataList)this.dataList[e].selected=e==t;this.$forceUpdate()},itemSelect(t){this.dataList[t].selected=!this.dataList[t].selected,this.$forceUpdate();let e=!1;for(var i in this.dataList)if(this.dataList[i].selected){e=!0;break}this.selectMode=e},getSelectedIdList(){var t,e=[];for(t in this.dataList)this.dataList[t].selected&&e.push(this.dataList[t].id);return e},deleteSelect(){this.onDeletePerson(this.getSelectedIdList())},mergeSelect(){let t=this.getSelectedIdList();if(t.length<2)return this.showVsNotification(this.$t("photo.atleastTwoPersonMerge"));this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.mergePersonAlert"),()=>{this.api.post("/api/photoApi/mergeFace",{faceIdList:t}).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.getFacesList(),this.exitSelectMode())}).catch(t=>{})})},onShowChangeName(t){this.selectedIndex=t,this.selectedItem=this.dataList[t],this.selectedItem.face_name?this.inputName=this.selectedItem.face_name:this.inputName="",this.showChangeName=!0},onSaveName(){return this.inputName?50<this.inputName.length?this.showVsNotification(this.$t("photo.personNameTooLong")):void this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.changeUserName",{name:this.inputName}),()=>{this.api.post("/api/photoApi/updatePhotoFace",{faceId:this.selectedItem.id,faceName:this.inputName}).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.getFacesList(),this.showChangeName=!1)}).catch(t=>{})}):this.showVsNotification(this.$t("photo.inputPersonName"))},onDeletePerson(e){this.selectedItem,this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.sureDeletePerson"),()=>{var t={disabled:1};e?t.faceIdList=e:t.faceId=this.selectedItem.id,this.api.post("/api/photoApi/updatePhotoFace",t).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.getFacesList(),this.showChangeName=!1,this.exitSelectMode())}).catch(t=>{})})},mouseEnterImg(t){this.isMobile||this.$set(this.dataList[t],"hover",!0)},mouseLeaveImg(t){this.isMobile||this.$set(this.dataList[t],"hover",!1)},showRightMenu(t,e,i,s){if(this.singleSelectMode)return t.preventDefault();this.selectedIndex=s,this.selectedItem=i,this.$easycm(t,e,"faceCm")},rightMenuClick(t,e){if(this.singleSelectMode)return!1;e=e||this.rightMenuList[t[0]].type;"CHECK"==e?this.onAlbumClick(this.selectedIndex):"DELETE"==e?this.onDeletePerson():"MODIFY"==e?this.onShowChangeName(this.selectedIndex):"SELECT"==e&&this.itemSelect(this.selectedIndex)},calImageWidth(){this.singleSelectMode&&(this.itemBaseWidth=120,this.itemWidth=120);var t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin);t&&(this.itemWidth=t)},onAlbumClick(t){if(this.$refs.faceCm&&this.$refs.faceCm.show)return this.$refs.faceCm.hide();this.selectMode?this.itemSelect(t):this.singleSelectMode?this.itemSingleSelect(t):(this.selectedItem=this.dataList[t],this.showAlbumDetail=!0,this.pushState())},getFacesList(){this.autoNameArr=[],this.loading=!0,this.api.post("/api/photoApi/getPhotoFaces",{}).then(t=>{if(!t.code){this.dataList=t.data,this.enable=t.enable,this.dataList.length;for(let t=0;t<this.dataList.length;t++){var e=this.dataList[t],i=s.a.getFaceImageUrl(e.id);this.dataList[t].url=i+"&time="+(new Date).getTime(),this.autoNameArr.length<10&&e.face_name&&this.autoNameArr.push(e.face_name),this.dataList[t].selected=!1}this.dataList.length<1&&this.enable&&this.getFaceDealState(),this.$nextTick(()=>{this.calImageWidth(),setTimeout(()=>{this.calImageWidth()},300)})}this.loading=!1}).catch(t=>{this.loading=!1})},getFaceDealState(){this.api.post("/api/photoApi/getAiDealState",{hideLoading:!0,type:"faceapi"}).then(t=>{t.code||t.data&&(1==t.data.isIndexing?this.dealState=this.$t("photo.indexingNoAi"):t.data.faceApiWaitDealCount?(this.dealState=this.$t("photo.waitDealCount",{count:t.data.faceApiWaitDealCount}),1<t.data.faceApiWaitDealCount&&(this.checkStateTimeout=setTimeout(()=>{this.getFaceDealState()},8e3))):t.data.faceApiWaitCompareCount&&(this.dealState=this.$t("photo.waitCompareFaceCount",{count:t.data.faceApiWaitCompareCount}),1<t.data.faceApiWaitCompareCount)&&(this.checkStateTimeout=setTimeout(()=>{this.getFaceDealState()},8e3)))}).catch(t=>{})}}},a=(o("167b"),o("2877")),a=Object(a.a)(i,function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"album-root-wrapper"},[a("div",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px",display:"flex","flex-direction":"column","align-items":"center"}},[!s.loading&&s.dataList.length<1?a("my-nodata",{attrs:{title:s.$t("photo.noPersonPlaceHolder")}}):s._e(),s.enable?s._e():a("my-btn",{staticStyle:{"margin-top":"20px"},attrs:{title:s.$t("photo.enableAiFace")},on:{click:s.enableAiFace}}),s.enable&&s.dealState?a("div",{staticStyle:{"margin-top":"10px"}},[s._v("["+s._s(s.dealState)+"]")]):s._e()],1),a("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"row",overflow:"hidden"},style:{height:s.singleSelectMode?"450px":"100%"}},[a("div",{ref:"listWrapper",staticClass:"album-list-root",on:{scroll:s.onPageScroll}},[s._l(s.dataList,function(e,i){return a("vs-card",{style:{margin:s.itemMargin+"px",width:s.itemWidth+"px"},attrs:{type:"1"},on:{click:function(t){return s.onAlbumClick(i)},contextmenu:function(t){return s.showRightMenu(t,s.$root,e,i)},mouseenter:function(t){return s.mouseEnterImg(i)},mouseleave:function(t){return s.mouseLeaveImg(i)}},scopedSlots:s._u([{key:"title",fn:function(){return[a("div",{staticStyle:{display:"flex","align-items":"center",width:"100%","justify-content":"center","margin-top":"10px"}},[a("p",{staticClass:"item-name max-line-one"},[s._v(s._s(e.face_name||s.$t("photo.unnamed")))])])]},proxy:!0},{key:"img",fn:function(){return[e.url?a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.url,expression:"item.url"}],staticStyle:{"object-fit":"cover","pointer-events":"none"},style:{width:s.itemWidth+"px",height:s.itemWidth+"px"}}):a("img",{staticStyle:{"object-fit":"cover","pointer-events":"none"},style:{width:s.itemWidth+"px",height:s.itemWidth+"px"},attrs:{src:o("915f")}}),e.selected?a("div",{staticStyle:{width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",display:"flex","align-items":"center","justify-content":"center"}},[a("Icon",{attrs:{type:"md-checkmark-circle-outline",color:"white",size:"50"}})],1):s._e()]},proxy:!0},{key:"text",fn:function(){return[s.singleSelectMode||1!=s.$store.state.currentUser.is_admin?a("p"):a("p",{staticStyle:{"text-align":"center","margin-top":"5px"}},[s._v(s._s(s.$t("photo.photoCount",{photoCount:e.face_photo_count})))])]},proxy:!0},{key:"interactions",fn:function(){return[a("div",{staticStyle:{display:"flex","justify-content":"flex-end",width:"100%"}},[e.hover&&!s.selectMode&&!s.singleSelectMode||s.isMobile&&!s.singleSelectMode?a("vs-button",{staticClass:"btn-chat",attrs:{shadow:""},on:{click:function(t){return t.stopPropagation(),s.showRightMenu(t,s.$root,e,i)}}},[a("span",{staticClass:"nasIcons icon-bianji"})]):s._e(),!e.hover||s.selectMode||s.singleSelectMode?s._e():a("vs-button",{staticClass:"btn-chat",attrs:{shadow:""},on:{click:function(t){return t.stopPropagation(),s.itemSelect(i)}}},[a("span",{staticClass:"nasIcons icon-setting-common",style:{color:e.selected?"#386DF2":""}})])],1)]},proxy:!0}],null,!0)})}),a("div",{staticStyle:{width:"100%",height:"80px"}})],2)]),s.selectMode?a("div",{staticClass:"bottom-select-root"},[a("div",{on:{click:s.exitSelectMode}},[a("my-btn",{attrs:{type:"white",icon:"md-add",title:s.$t("common.cancel")}})],1),a("div",{on:{click:s.deleteSelect}},[a("my-btn",{attrs:{type:"red",icon:"md-add",title:s.$t("common.delete")}})],1),a("div",{on:{click:s.mergeSelect}},[a("my-btn",{attrs:{icon:"md-add",title:s.$t("photo.mergePerson")}})],1)]):s._e(),a("Modal",{ref:"myModal",attrs:{scrollable:!1,"footer-hide":"","class-name":"modal-style-nopadding",fullscreen:"",closable:!1},model:{value:s.showAlbumDetail,callback:function(t){s.showAlbumDetail=t},expression:"showAlbumDetail"}},[s.showAlbumDetail?a("album-detail",{attrs:{propsShowSearchBtn:!1,propsTitle:s.selectedItem.face_name||s.$t("photo.unnamed"),propsShowAddToAlbum:!1,propsShowDelete:!1,propsShowModeSwitch:!1,propsShowRemoveFromAlbum:!0,propsFaceId:s.selectedItem.id+""},on:{onClose:function(t){s.showAlbumDetail=!1}}}):s._e()],1),a("vs-dialog",{scopedSlots:s._u([{key:"header",fn:function(){return[a("h4",{staticStyle:{"font-size":"16px"}},[s._v(" "+s._s(s.$t("photo.inputPersonName"))+" ")])]},proxy:!0},{key:"footer",fn:function(){return[a("div",{staticClass:"footer-dialog"},[a("vs-button",{attrs:{block:""},on:{click:s.onSaveName}},[s._v(" "+s._s(s.$t("common.ok"))+" ")]),a("div",{staticStyle:{"margin-top":"10px"}},[a("a",{on:{click:function(t){return t.stopPropagation(),s.onDeletePerson()}}},[s._v(" "+s._s(s.$t("photo.deletePerson")))])])],1)]},proxy:!0}]),model:{value:s.showChangeName,callback:function(t){s.showChangeName=t},expression:"showChangeName"}},[a("div",{staticClass:"con-form"},[a("img",{staticStyle:{width:"50px",height:"50px","border-radius":"10px","object-fit":"cover","margin-right":"10px"},attrs:{src:s.selectedItem.url}}),a("div",[a("p",{staticClass:"input-alert"},[s._v(s._s(s.$t("photo.sameNameMerged")))])]),a("AutoComplete",{staticStyle:{width:"100%"},attrs:{data:s.autoNameArr,placeholder:s.$t("photo.inputPersonName")},model:{value:s.inputName,callback:function(t){s.inputName=t},expression:"inputName"}})],1)]),a("easy-cm",{ref:"faceCm",attrs:{tag:"faceCm",list:s.rightMenuList},on:{ecmcb:s.rightMenuClick}})],1)},[],!1,null,"33b98544",null);e.default=a.exports},"167b":function(t,e,i){"use strict";i("4b3d")},"4b3d":function(t,e,i){},"915f":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbgAAAG4CAMAAAAAFAKBAAAAb1BMVEXU3+25x9mtu83///+/zNy8ytvI1OP7/P21w9TG0uHR3evCzt7E0OCvvc+3xdbK1uXM2OfT3uz19/rl6vHP2unS2+fZ4erP2eWzwdOywNL4+fve5O3v8vbh5+/V3ujAzd7o7fPL1eLr7/Ty9fi5xthN4swrAAALAUlEQVR42uzBgQAAAACAoP2pF6kCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGB27kU7URiKwnBIENBwtU5Fx6oo7/+MQ+MaV7uMBFvaHI77e4V/xY3xAgAAAAAAz2tVFCsB01LqNpOdOq0ETESZdtGuEpy6KTAn7bPNQgBpJppFK4AsE+2eUgBFJlqfmQBqTDSXjQBKCp1nchA8WFJRmWiDzQX4V5W2aBg50uzRMHKk2aNh5EizR8PIkWZ/EMHIkWaPhpEjzR4NI0faezR5AyNHWlUcLNEwcqTZo2HkSLNHw8iRZo2GkaPtbjSMHF190TByRJlovwdfGRopWiKdMHKkDI+GkSPDRPOjFjC5aBi5r1oU4VeiYeR8WkT+o2HkJhoNI/eAisDLI0aOYLQkbBodthlGbkIvj/l+F6uL+LQPMXJTiCaz9U59dm4wcsSjdeZLdWu5xmdylKNJmR+V3SnByFGN1tGxumerMXI0o3XmseqxxmdyFKN11qpfM3zkqsWqLKJ5qnX0TNPn50ZEK4dYOw7sqiyjKNXhLPjo8Bzpumi19KHeKpc4lzeyLNvUSZLnbXAX+5/3m2i+HJXb8Vprc6kVDMP5zJloHjXKYXs+vbyFXa02eNhB8EThlv+sLOLl7vTy9/VPk4aB3fMeOXPS/Gs+Hq3d8e11v57rWTCWSLBCJNq7o+VojUgLNioC0f4/Y7TBTwsFF2km/TCxavP4/ou4XIdVgXQa/2iZWp4IHmbSZvxYm0ssAnj8k2wkr9gdLSsu7wfycWNdnzGo1bpicuu14Hy0OIcrvl0rmBwW78AjzkeLc7hSDkB+tR6TCgYq6VSzKWZwufNKpMMER6wXlzuvw9N1Y3LnVchedcCQ4MAxctz2rcPlzusfOXeiGycMhAF4RuODS4oKAipulvd/xy5hkz1IXMYk2WB/T1D1j3Hze6aB8d+T6CI3trB6776UjpSVL/4F50TnBX+OG1yfo5UXcEJwzDtO5ieiEvkc6bwAxBGDGzNNZxPacGQJ68VUK+PvlNJFjmyOlJUA0QGDy+gixUcyRjN3hplNlxz+Tgm96XAmwjEv6uw0VZooRiNXykoAcbzgcKCLamhSTXcUGrlSVgKoA1VeIlmOVkqfK9HMkbISIPr1jwNhmRft/CGkLTpPOi+A4JuDk3FYdsvffDpluUSmnlgKTzov4yUX4MLuo9bV2foKIl0jE7G0nnReAOrLOq9+20dtipFFE8fgS+cF0c7gZNjV7epomVS85NINC6pFntOi8aXzAgj2dF5q0MSWSmRoPlxQHbK6u9uio0XqS+cFIOyrE5mRlRYZhpujtVpQHYv4/ouqfem8AJR1cCIlSwK3ax+OkuzxXayJpjq5/aKimSsDeuY3OTSSKdkqcLv6/iiNlS7xzXQJtU6woYXwpawECCyDy8hag9t1tJDXGOv1n2CqqmV5HH3pvACEXeelyJ7G7UpaxIiYNJfgezzL6U7TCfw/ZzovgBe76mSgHSRupmgRomzpTTUihpoe6KH0ZkDv7I9VcJJ+KLiYFmVX0btGIGJ5opXUlwG9WWDTeSn6oU+lXH5vq/QHv0+IIqV7uS8DejNhU510tEODDAJR3gWkb9MJM01XmTcDejP148HVyBG3mm5UId6RXXPtZPwZ0DuLbDqvnHbokUHRnUHgxfrYhR4N6M0Ci+BCstciS0ZXVYmPZKzK7vVQFj7Nec2EReclNTEwSmZjRZPJhzGGptK0SMvWqwG9mWIEt784qRJkCt8a5Hp+TB8+fvGrcOHNgJ7pksNv+FamCbIVtAFe+DKgZ7rkvr6r1DXaOBENetuTg0dlJYCw6bzkxA0tzTqJVsSgcCKzBN95UlYCKJvgUEyb0mqGtu5KFUvc50Rmo19Lqa8iuzkv2RoGQeY3lrDHr5N9+nNRvP5ceLaUugh4wa0Lp+vRGhOB36KmC11N63vNu6XUhbCf8wrzPC/5R4svv/xcSETUq3vNv6XUV+pgu43VB/eab0upr6KDBTetdjz8W0pdBIfabcTTasfDv6XUhThWcJnhfcifAb2ZOtZuY/35O4P0qvOC6FjBFbQYrgsnl3ViarzqvACCQyylPj7jpsvCCWtcyKnOC0D8wFJqnyQCrd1u6jf0Ke3RgN5MMaoTDhmP5e0iVpWNFmmVXbF5l0v6VFYCRF8U3Op/sFhrYvaNxhF7VVYCBDuXUmWstp4LXXJvNI7Qq7ISQFhXJ2U9NJUmBmZyJefNrwm9KisBlF1wstbEp3tkCMlIv78iCf/KSoDIKrixIisnZIgND7RjLP3uvAACi86r1GQpwe3k/ab+4yuS78EJfnChJls1MrTXTX0TDwf0ZorfeaVkrcFv4OGc11nE7rw6sqfxaRzrvAACbueV0g74NI51XgCCGVxMRw3Oqc4LQDE7r5x2SPFpXOu8IGIGV9AOAz6Na50XwF9GWbk3uByfxrXOC0DwqpOO7FX4PK51XgCKuZR61APn1oDeWcSsTvQxbzjnOi+Av7zgWrJ0wmdyrvMCELzOK9ZkpcWncmxAb6aYZWVBFk4Kn8u5shIg4g7oDcQwP6HVeY+/ALgm4A7oZWR2fUKL8RdxrKz8x97ZKKcNA0H4NJZELOjgTpzEpUyAwPs/Y+3yMyE2WDIWnJb7XmFnJXl9KxHpUOHU26LTWl/Hy655ApZ5EdkBA3pvX5ODtdbHy67ZAyecGzZZqTVXa3WCl3kRvaT1xK0Id0QnU0q9Abywksgm0228AcDMixwb4fSsbovUhx2takS4XqoHCndWUDyx/FAjA5h5dWxyKi6tIlZwvSccwMyLyN5DuFYRq4dJLsL14WKVUltFrBAmM7VHMq+LVGMK17qDdyhbNSZwA3oN+tZS6tmDttlYfKoGybwuY4cJ137Qtg2jOUy0Ab0aNyDz2rxuI6jVbghL5nWNKjTz2lzrEDBdK/EyLyITJlz4yBCHQRW0Ab2GPCw6ec06YS4cYOZFLki4z6wb5sLBDeg1VN7RybUJPd57HGBY2drkdgw2uFPbXzKvK+T+wpkgw3GKTggQ5595bbIQONWyAMNKoipet5FN2wAw8yIy3sL9ze7DYqXGAzXz+hlXVo8XbjFVIpwHLqiUGp+1VmMCm3kRVf6l1OhM1htVI8L5YLyjk0UWh1NbJFejA5t5EdmWcLE3ufaLWFEBezXihPMWTvdbjmcRCzLzIqq8w8qPrB+ORSzIzIvI+JdS3wOstWRUxCJIbMCc19vkmrUWy8N9ydyKWJCZF5UBwqnp+tLDpSys1QnkgF5DFTTnNX1fL7fHq8hZtPP7AA0ricyZcIhAZl5EOXwpFVQ4B19KBV0q6Q+4cKDfcUSGQSk1HpiDlf/JsYUzoF8DRC6Bl1LlaNJFBSycAdaNNP8nbgeiLWbcdaD4nnkBYPR0ltt5UUKr1mAAhGvUqsUqHLxa33AvaWZeRq/21oI9OPbhdulkXmZVW+spFkIv5rtfjeGY/pwx5mCtp1oIfXGOaK74YPT0yRfCAAr1YGprzcRa4ZTKB7EWO5y6E2ZvrXkpZ4xxUGeItZLBRFHL2kKO73GZjSSWHN/74XKsNCtZCB+IFmulSWnkjJEmpZEv4zT5bY0shIlSFoV8GQuCIAiCIAiCIPxjDw4EAAAAAID8XxtBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVpDw4EAAAAAAT5Wy8wQgUAAAAAAAAAAADAC3UpXkiMqA/oAAAAAElFTkSuQmCC"}}]);