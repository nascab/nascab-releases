(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-58202272"],{"17bd":function(t,e,i){i("87f9")},"87f9":function(t,e,i){},f43f:function(t,e,i){i.r(e);i("14d9"),i("a434"),i("e9f5"),i("7d54"),i("d3b7"),i("e25e"),i("159b");var s={components:{myHeader:i("7cfd").a},watch:{msgType:function(t,e){this.loadFirstPage()}},data:function(){return{sideOptionList:[{id:"info",title:this.$t("notice.info"),font:"nasIcons icon-msg-list"},{id:"error",title:this.$t("notice.error"),font:"nasIcons icon-msg-error"}],infoUnReadCount:0,errorUnReadCount:0,msgType:"info",messageList:[],isLoading:!1,hasMore:!0}},mounted:function(){this.getMessageList()},beforeDestroy:function(){},computed:{},methods:{setLeftMenuId:function(t){t=t.id;this.msgType=t},itemClick:function(t,e){this.showVsAlertDialog(t.title,t.content),this.readMsg(t,e)},markAllRead:function(){var t=this;this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("notice.markAllAsRead")+"?",function(){t.readMsg(null,null,!0)})},deleteAll:function(){var t=this;this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("notice.deleteAll")+"?",function(){t.deleteMsg(null,!0)})},readMsg:function(t,i,s){var n=this,t={id:t?t.id:0};s&&(t.isAll=s,t.level=this.msgType),this.api.post("/api/messageApi/read",t).then(function(t){if(!t.code){if(s)for(var e in"info"==n.msgType?n.infoUnReadCount=0:"error"==n.msgType&&(n.errorUnReadCount=0),n.messageList)n.messageList[e].level==n.msgType&&(n.messageList[e].read=1);else n.messageList[i].read=1,"info"==n.msgType?n.infoUnReadCount=parseInt(n.infoUnReadCount)-1:"error"==n.msgType&&(n.errorUnReadCount=parseInt(n.errorUnReadCount)-1);n.$store.state.unreadMsgCount=n.infoUnReadCount+n.errorUnReadCount}}).catch(function(t){})},loadFirstPage:function(){this.messageList=[],this.hasMore=!0,this.timestamp=0,this.getMessageList()},deleteMsg:function(i,s){var n=this,t={id:null!=i?this.messageList[i].id:null};s&&(t.isAll=s,t.level=this.msgType),this.api.post("/api/messageApi/delete",t).then(function(t){if(!t.code)if(n.showVsNotification(n.$t("common.deleteSuccess")),s)n.messageList=[],n.getMessageList(),"info"==n.msgType?n.infoUnReadCount=0:"error"==n.msgType&&(n.errorUnReadCount=0),n.$store.state.unreadMsgCount=n.infoUnReadCount+n.errorUnReadCount;else for(var e=0;e<n.messageList.length;e++)i==e&&n.messageList.splice(e,1)}).catch(function(t){})},getMessageList:function(i){var s=this;!this.isLoading&&this.hasMore&&(this.isLoading=!0,this.api.post("/api/messageApi/getMessage",{msgType:this.msgType,count:20,id:0<this.messageList.length?this.messageList[this.messageList.length-1].id:0}).then(function(t){if(!t.code){for(var e=0;e<t.data.length;e++)t.data[e].create_time_str=new Date(t.data[e].create_time).toLocaleString();t.data.length<20&&(s.hasMore=!1),i?t.data.forEach(function(t){s.messageList.push(t)}):s.messageList=t.data,s.infoUnReadCount=t.infoUnReadCount,s.errorUnReadCount=t.errorUnReadCount}s.isLoading=!1}).catch(function(t){s.isLoading=!1}))},onPageScroll:function(t){var e=null,i=null,t=(t.srcElement.scrollingElement?(e=t.srcElement.scrollingElement.scrollTop,i=t.srcElement.scrollingElement.scrollHeight):t.srcElement?(e=t.srcElement.scrollTop,i=t.srcElement.scrollHeight):t.target&&(e=t.target.scrollTop,i=t.target.scrollHeight),document.documentElement.clientHeight);i-5<=e+t&&this.getMessageList(!0)}}},i=(i("17bd"),i("2877")),i=Object(i.a)(s,function(){var s=this,t=s._self._c;return t("div",{staticClass:"msg-root"},[t("my-bg"),s._m(0),t("div",{staticClass:"nas-mobile-none"},[t("my-header")],1),t("div",{staticClass:"main-layout nas-padding-right-zero"},[t("div",{staticClass:"sidebar-root"},[t("my-sidebar",{ref:"sidebar",attrs:{optionList:s.sideOptionList},on:{onItemClick:s.setLeftMenuId}})],1),t("div",{staticClass:"sidebar-mobile-root"},[t("my-sidebar-mobile",{ref:"sidebarMobile",attrs:{optionList:s.sideOptionList},on:{onItemClick:s.setLeftMenuId}})],1),t("div",{staticClass:"right-root"},[s.messageList.length<1?t("my-nodata",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px"},attrs:{title:s.$t("common.noMore")}}):s._e(),t("div",{staticClass:"top-root"},[t("my-btn",{attrs:{title:s.$t("notice.markAllAsRead")},on:{click:s.markAllRead}}),t("my-btn",{attrs:{title:s.$t("notice.deleteAll"),type:"white"},on:{click:s.deleteAll}})],1),t("div",{staticStyle:{width:"100%",height:"100%","padding-top":"60px",overflow:"hidden"}},[0<s.messageList.length?t("div",{staticStyle:{"padding-bottom":"15px",overflow:"auto",height:"100%",width:"100%"},on:{scroll:s.onPageScroll}},[s._l(s.messageList,function(e,i){return t("Card",{staticClass:"card-root"},[t("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between","margin-top":"10px"}},[t("div",{staticStyle:{display:"flex","align-items":"center"}},[0==e.read?t("div",{staticClass:"red-dot"}):t("div",{staticClass:"grey-dot"}),t("p",{staticStyle:{"word-break":"break-all","margin-left":"15px","font-size":"16px","text-align":"left"},on:{click:function(t){return s.itemClick(e,i)}}},[s._v(" ["+s._s(e.create_time_str)+"] "+s._s(e.title))])]),t("a",{staticStyle:{"flex-shrink":"0","margin-left":"10px"},on:{click:function(t){return t.preventDefault(),s.deleteMsg(i,!1)}}},[s._v(" "+s._s(s.$t("common.delete"))+" ")])]),t("p",{staticStyle:{"word-break":"break-all","margin-top":"15px","margin-bottom":"20px",width:"100%","text-align":"left","margin-left":"28px","font-size":"14px","padding-right":"40px"},on:{click:function(t){return s.itemClick(e,i)}}},[s._v(s._s(e.content))])])}),t("div",{staticStyle:{"margin-top":"30px","margin-bottom":"30px",width:"100%"}},[s.messageList.length<1||!s.hasMore?t("p",{staticStyle:{"text-align":"center"}},[s._v(" "+s._s(s.$t("common.noMore"))+" ")]):s._e()])],2):s._e()])],1)])],1)},[function(){var t=this._self._c;return t("div",{staticClass:"nas-mobile-none"},[t("p",{staticClass:"my-header-position"})])}],!1,null,"50f09237",null);e.default=i.exports}}]);