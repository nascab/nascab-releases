(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-596d6bfa","chunk-2d0e48df"],{1498:function(t,e,a){a.r(e);var o=a("b85c"),n=(a("14d9"),a("d3b7"),a("3ca3"),a("ddb0"),a("be3b")),i={props:{singleSelectMode:{default:!1,type:Boolean}},components:{albumDetail:function(){return Promise.resolve().then(a.bind(null,"8fad"))}},data:function(){return{dealState:"",inputName:"",autoNameArr:[],showChangeName:!1,rightMenuList:[{text:this.$t("file.check"),type:"CHECK"},{text:this.$t("common.multiSelect"),type:"SELECT"},{text:this.$t("photo.changeName"),type:"MODIFY"},{text:this.$t("common.delete"),type:"DELETE"}],changeAlbumName:"",itemBaseWidth:180,itemWidth:180,itemMargin:10,selectedItem:"",showAlbumDetail:!1,showAddAlbum:!1,dataList:[],loading:!1,selectedIndex:!1,selectMode:!1,enable:!0,checkStateTimeout:null}},mounted:function(){this.getFacesList(),window.addEventListener("resize",this.calImageWidth)},beforeDestroy:function(){window.removeEventListener("resize",this.calImageWidth),clearTimeout(this.checkStateTimeout)},methods:{getSelectedFaceId:function(){var t,e=Object(o.a)(this.dataList);try{for(e.s();!(t=e.n()).done;){var i=t.value;if(i.selected)return i.id}}catch(t){e.e(t)}finally{e.f()}return!1},onPageScroll:function(t){if(this.$refs.faceCm&&this.$refs.faceCm.show)return this.$refs.faceCm.hide()},enableAiFace:function(){var e=this;this.api.post("/api/commonApi/saveConfigPhoto",{aiFaceEnable:"1"}).then(function(t){e.getFacesList()}).catch(function(t){})},exitSelectMode:function(){for(var t in this.selectMode=!1,this.dataList)this.dataList[t].selected=!1},itemSingleSelect:function(t){for(var e in this.dataList)this.dataList[e].selected=e==t;this.$forceUpdate()},itemSelect:function(t){this.dataList[t].selected=!this.dataList[t].selected,this.$forceUpdate();var e,i=!1;for(e in this.dataList)if(this.dataList[e].selected){i=!0;break}this.selectMode=i},getSelectedIdList:function(){var t,e=[];for(t in this.dataList)this.dataList[t].selected&&e.push(this.dataList[t].id);return e},deleteSelect:function(){this.onDeletePerson(this.getSelectedIdList())},mergeSelect:function(){var e=this,t=this.getSelectedIdList();if(t.length<2)return this.showVsNotification(this.$t("photo.atleastTwoPersonMerge"));this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.mergePersonAlert"),function(){e.api.post("/api/photoApi/mergeFace",{faceIdList:t}).then(function(t){t.code||(e.showVsNotification(e.$t("common.operationSuccess")),e.getFacesList(),e.exitSelectMode())}).catch(function(t){})})},onShowChangeName:function(t){this.selectedIndex=t,this.selectedItem=this.dataList[t],this.selectedItem.face_name?this.inputName=this.selectedItem.face_name:this.inputName="",this.showChangeName=!0},onSaveName:function(){var e=this;return this.inputName?50<this.inputName.length?this.showVsNotification(this.$t("photo.personNameTooLong")):void this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.changeUserName",{name:this.inputName}),function(){e.api.post("/api/photoApi/updatePhotoFace",{faceId:e.selectedItem.id,faceName:e.inputName}).then(function(t){t.code||(e.showVsNotification(e.$t("common.operationSuccess")),e.getFacesList(),e.showChangeName=!1)}).catch(function(t){})}):this.showVsNotification(this.$t("photo.inputPersonName"))},onDeletePerson:function(e){var i=this;this.selectedItem,this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.sureDeletePerson"),function(){var t={disabled:1};e?t.faceIdList=e:t.faceId=i.selectedItem.id,i.api.post("/api/photoApi/updatePhotoFace",t).then(function(t){t.code||(i.showVsNotification(i.$t("common.operationSuccess")),i.getFacesList(),i.showChangeName=!1,i.exitSelectMode())}).catch(function(t){})})},mouseEnterImg:function(t){this.isMobile||this.$set(this.dataList[t],"hover",!0)},mouseLeaveImg:function(t){this.isMobile||this.$set(this.dataList[t],"hover",!1)},showRightMenu:function(t,e,i,o){if(this.singleSelectMode)return t.preventDefault();this.selectedIndex=o,this.selectedItem=i,this.$easycm(t,e,"faceCm")},rightMenuClick:function(t,e){if(this.singleSelectMode)return!1;e=e||this.rightMenuList[t[0]].type;"CHECK"==e?this.onAlbumClick(this.selectedIndex):"DELETE"==e?this.onDeletePerson():"MODIFY"==e?this.onShowChangeName(this.selectedIndex):"SELECT"==e&&this.itemSelect(this.selectedIndex)},calImageWidth:function(){this.singleSelectMode&&(this.itemBaseWidth=120,this.itemWidth=120);var t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin);t&&(this.itemWidth=t)},onAlbumClick:function(t){if(this.$refs.faceCm&&this.$refs.faceCm.show)return this.$refs.faceCm.hide();this.selectMode?this.itemSelect(t):this.singleSelectMode?this.itemSingleSelect(t):(this.selectedItem=this.dataList[t],this.showAlbumDetail=!0,this.addModalToList(this.$refs.refModalAlbumFaces))},getFacesList:function(){var a=this;this.autoNameArr=[],this.loading=!0,this.api.post("/api/photoApi/getPhotoFaces",{}).then(function(t){if(!t.code){a.dataList=t.data,a.enable=t.enable,a.dataList.length;for(var e=0;e<a.dataList.length;e++){var i=a.dataList[e],o=n.a.getFaceImageUrl(i.id);a.dataList[e].url=o+"&time="+(new Date).getTime(),a.autoNameArr.length<10&&i.face_name&&a.autoNameArr.push(i.face_name),a.dataList[e].selected=!1}a.dataList.length<1&&a.enable&&a.getFaceDealState(),a.$nextTick(function(){a.calImageWidth(),setTimeout(function(){a.calImageWidth()},300)})}a.loading=!1}).catch(function(t){a.loading=!1})},getFaceDealState:function(){var e=this;this.api.post("/api/photoApi/getAiDealState",{hideLoading:!0,type:"faceapi"}).then(function(t){t.code||t.data&&(1==t.data.isIndexing?e.dealState=e.$t("photo.indexingNoAi"):t.data.faceApiWaitDealCount?(e.dealState=e.$t("photo.waitDealCount",{count:t.data.faceApiWaitDealCount}),1<t.data.faceApiWaitDealCount&&(e.checkStateTimeout=setTimeout(function(){e.getFaceDealState()},8e3))):t.data.faceApiWaitCompareCount&&(e.dealState=e.$t("photo.waitCompareFaceCount",{count:t.data.faceApiWaitCompareCount}),1<t.data.faceApiWaitCompareCount)&&(e.checkStateTimeout=setTimeout(function(){e.getFaceDealState()},8e3)))}).catch(function(t){})}}},s=(a("6f83"),a("2877")),s=Object(s.a)(i,function(){var o=this,t=o._self._c;return t("div",{staticClass:"album-root-wrapper"},[t("div",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px",display:"flex","flex-direction":"column","align-items":"center"}},[!o.loading&&o.dataList.length<1?t("my-nodata",{attrs:{title:o.$t("photo.noPersonPlaceHolder")}}):o._e(),o.enable?o._e():t("my-btn",{staticStyle:{"margin-top":"20px"},attrs:{title:o.$t("photo.enableAiFace")},on:{click:o.enableAiFace}}),o.enable&&o.dealState?t("div",{staticStyle:{"margin-top":"10px"}},[o._v("["+o._s(o.dealState)+"]")]):o._e()],1),t("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"row",overflow:"hidden"},style:{height:o.singleSelectMode?"450px":"100%"}},[t("div",{ref:"listWrapper",staticClass:"album-list-root",on:{scroll:o.onPageScroll}},[o._l(o.dataList,function(e,i){return t("vs-card",{style:{margin:o.itemMargin+"px",width:o.itemWidth+"px"},attrs:{type:"1"},on:{click:function(t){return o.onAlbumClick(i)},contextmenu:function(t){return o.showRightMenu(t,o.$root,e,i)},mouseenter:function(t){return o.mouseEnterImg(i)},mouseleave:function(t){return o.mouseLeaveImg(i)}},scopedSlots:o._u([{key:"title",fn:function(){return[t("div",{staticStyle:{display:"flex","align-items":"center",width:"100%","justify-content":"center","margin-top":"10px"}},[t("p",{staticClass:"item-name max-line-one"},[o._v(o._s(e.face_name||o.$t("photo.unnamed")))])])]},proxy:!0},{key:"img",fn:function(){return[e.url?t("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.url,expression:"item.url"}],staticStyle:{"object-fit":"cover","pointer-events":"none"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"}}):t("img",{staticStyle:{"object-fit":"cover","pointer-events":"none"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:a("915f")}}),e.selected?t("div",{staticStyle:{width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",display:"flex","align-items":"center","justify-content":"center"}},[t("Icon",{attrs:{type:"md-checkmark-circle-outline",color:"white",size:"50"}})],1):o._e()]},proxy:!0},{key:"text",fn:function(){return[o.singleSelectMode||1!=o.$store.state.currentUser.is_admin?t("p"):t("p",{staticStyle:{"text-align":"center","margin-top":"5px"}},[o._v(o._s(o.$t("photo.photoCount",{photoCount:e.face_photo_count})))])]},proxy:!0},{key:"interactions",fn:function(){return[t("div",{staticStyle:{display:"flex","justify-content":"flex-end",width:"100%"}},[e.hover&&!o.selectMode&&!o.singleSelectMode||o.isMobile&&!o.singleSelectMode?t("vs-button",{staticClass:"btn-chat",attrs:{shadow:""},on:{click:function(t){return t.stopPropagation(),o.showRightMenu(t,o.$root,e,i)}}},[t("span",{staticClass:"nasIcons icon-bianji"})]):o._e(),!e.hover||o.selectMode||o.singleSelectMode?o._e():t("vs-button",{staticClass:"btn-chat",attrs:{shadow:""},on:{click:function(t){return t.stopPropagation(),o.itemSelect(i)}}},[t("span",{staticClass:"nasIcons icon-setting-common",style:{color:e.selected?"#386DF2":""}})])],1)]},proxy:!0}],null,!0)})}),t("div",{staticStyle:{width:"100%",height:"80px"}})],2)]),o.selectMode?t("div",{staticClass:"bottom-select-root"},[t("div",{on:{click:o.exitSelectMode}},[t("my-btn",{attrs:{type:"white",icon:"md-add",title:o.$t("common.cancel")}})],1),t("div",{on:{click:o.deleteSelect}},[t("my-btn",{attrs:{type:"red",icon:"md-add",title:o.$t("common.delete")}})],1),t("div",{on:{click:o.mergeSelect}},[t("my-btn",{attrs:{icon:"md-add",title:o.$t("photo.mergePerson")}})],1)]):o._e(),t("Modal",{ref:"refModalAlbumFaces",attrs:{scrollable:!1,"footer-hide":"","class-name":"modal-style-nopadding",fullscreen:"",closable:!1},model:{value:o.showAlbumDetail,callback:function(t){o.showAlbumDetail=t},expression:"showAlbumDetail"}},[o.showAlbumDetail?t("album-detail",{attrs:{propsShowSearchBtn:!1,propsTitle:o.selectedItem.face_name||o.$t("photo.unnamed"),propsShowAddToAlbum:!1,propsShowDelete:!1,propsShowModeSwitch:!1,propsShowRemoveFromAlbum:!0,propsFaceId:o.selectedItem.id+""},on:{onClose:function(t){return o.historyBack()}}}):o._e()],1),t("vs-dialog",{scopedSlots:o._u([{key:"header",fn:function(){return[t("h4",{staticStyle:{"font-size":"16px"}},[o._v(" "+o._s(o.$t("photo.inputPersonName"))+" ")])]},proxy:!0},{key:"footer",fn:function(){return[t("div",{staticClass:"footer-dialog"},[t("vs-button",{attrs:{block:""},on:{click:o.onSaveName}},[o._v(" "+o._s(o.$t("common.ok"))+" ")]),t("div",{staticStyle:{"margin-top":"10px"}},[t("a",{on:{click:function(t){return t.stopPropagation(),o.onDeletePerson()}}},[o._v(" "+o._s(o.$t("photo.deletePerson")))])])],1)]},proxy:!0}]),model:{value:o.showChangeName,callback:function(t){o.showChangeName=t},expression:"showChangeName"}},[t("div",{staticClass:"con-form"},[t("img",{staticStyle:{width:"50px",height:"50px","border-radius":"10px","object-fit":"cover","margin-right":"10px"},attrs:{src:o.selectedItem.url}}),t("div",[t("p",{staticClass:"input-alert"},[o._v(o._s(o.$t("photo.sameNameMerged")))])]),t("AutoComplete",{staticStyle:{width:"100%"},attrs:{data:o.autoNameArr,placeholder:o.$t("photo.inputPersonName")},model:{value:o.inputName,callback:function(t){o.inputName=t},expression:"inputName"}})],1)]),t("easy-cm",{ref:"faceCm",attrs:{tag:"faceCm",list:o.rightMenuList},on:{ecmcb:o.rightMenuClick}})],1)},[],!1,null,"7d0a4bf5",null);e.default=s.exports},"6f83":function(t,e,i){i("ca42")},"915f":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbgAAAG4CAMAAAAAFAKBAAAAb1BMVEXU3+25x9mtu83///+/zNy8ytvI1OP7/P21w9TG0uHR3evCzt7E0OCvvc+3xdbK1uXM2OfT3uz19/rl6vHP2unS2+fZ4erP2eWzwdOywNL4+fve5O3v8vbh5+/V3ujAzd7o7fPL1eLr7/Ty9fi5xthN4swrAAALAUlEQVR42uzBgQAAAACAoP2pF6kCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGB27kU7URiKwnBIENBwtU5Fx6oo7/+MQ+MaV7uMBFvaHI77e4V/xY3xAgAAAAAAz2tVFCsB01LqNpOdOq0ETESZdtGuEpy6KTAn7bPNQgBpJppFK4AsE+2eUgBFJlqfmQBqTDSXjQBKCp1nchA8WFJRmWiDzQX4V5W2aBg50uzRMHKk2aNh5EizR8PIkWZ/EMHIkWaPhpEjzR4NI0faezR5AyNHWlUcLNEwcqTZo2HkSLNHw8iRZo2GkaPtbjSMHF190TByRJlovwdfGRopWiKdMHKkDI+GkSPDRPOjFjC5aBi5r1oU4VeiYeR8WkT+o2HkJhoNI/eAisDLI0aOYLQkbBodthlGbkIvj/l+F6uL+LQPMXJTiCaz9U59dm4wcsSjdeZLdWu5xmdylKNJmR+V3SnByFGN1tGxumerMXI0o3XmseqxxmdyFKN11qpfM3zkqsWqLKJ5qnX0TNPn50ZEK4dYOw7sqiyjKNXhLPjo8Bzpumi19KHeKpc4lzeyLNvUSZLnbXAX+5/3m2i+HJXb8Vprc6kVDMP5zJloHjXKYXs+vbyFXa02eNhB8EThlv+sLOLl7vTy9/VPk4aB3fMeOXPS/Gs+Hq3d8e11v57rWTCWSLBCJNq7o+VojUgLNioC0f4/Y7TBTwsFF2km/TCxavP4/ou4XIdVgXQa/2iZWp4IHmbSZvxYm0ssAnj8k2wkr9gdLSsu7wfycWNdnzGo1bpicuu14Hy0OIcrvl0rmBwW78AjzkeLc7hSDkB+tR6TCgYq6VSzKWZwufNKpMMER6wXlzuvw9N1Y3LnVchedcCQ4MAxctz2rcPlzusfOXeiGycMhAF4RuODS4oKAipulvd/xy5hkz1IXMYk2WB/T1D1j3Hze6aB8d+T6CI3trB6776UjpSVL/4F50TnBX+OG1yfo5UXcEJwzDtO5ieiEvkc6bwAxBGDGzNNZxPacGQJ68VUK+PvlNJFjmyOlJUA0QGDy+gixUcyRjN3hplNlxz+Tgm96XAmwjEv6uw0VZooRiNXykoAcbzgcKCLamhSTXcUGrlSVgKoA1VeIlmOVkqfK9HMkbISIPr1jwNhmRft/CGkLTpPOi+A4JuDk3FYdsvffDpluUSmnlgKTzov4yUX4MLuo9bV2foKIl0jE7G0nnReAOrLOq9+20dtipFFE8fgS+cF0c7gZNjV7epomVS85NINC6pFntOi8aXzAgj2dF5q0MSWSmRoPlxQHbK6u9uio0XqS+cFIOyrE5mRlRYZhpujtVpQHYv4/ouqfem8AJR1cCIlSwK3ax+OkuzxXayJpjq5/aKimSsDeuY3OTSSKdkqcLv6/iiNlS7xzXQJtU6woYXwpawECCyDy8hag9t1tJDXGOv1n2CqqmV5HH3pvACEXeelyJ7G7UpaxIiYNJfgezzL6U7TCfw/ZzovgBe76mSgHSRupmgRomzpTTUihpoe6KH0ZkDv7I9VcJJ+KLiYFmVX0btGIGJ5opXUlwG9WWDTeSn6oU+lXH5vq/QHv0+IIqV7uS8DejNhU510tEODDAJR3gWkb9MJM01XmTcDejP148HVyBG3mm5UId6RXXPtZPwZ0DuLbDqvnHbokUHRnUHgxfrYhR4N6M0Ci+BCstciS0ZXVYmPZKzK7vVQFj7Nec2EReclNTEwSmZjRZPJhzGGptK0SMvWqwG9mWIEt784qRJkCt8a5Hp+TB8+fvGrcOHNgJ7pksNv+FamCbIVtAFe+DKgZ7rkvr6r1DXaOBENetuTg0dlJYCw6bzkxA0tzTqJVsSgcCKzBN95UlYCKJvgUEyb0mqGtu5KFUvc50Rmo19Lqa8iuzkv2RoGQeY3lrDHr5N9+nNRvP5ceLaUugh4wa0Lp+vRGhOB36KmC11N63vNu6XUhbCf8wrzPC/5R4svv/xcSETUq3vNv6XUV+pgu43VB/eab0upr6KDBTetdjz8W0pdBIfabcTTasfDv6XUhThWcJnhfcifAb2ZOtZuY/35O4P0qvOC6FjBFbQYrgsnl3ViarzqvACCQyylPj7jpsvCCWtcyKnOC0D8wFJqnyQCrd1u6jf0Ke3RgN5MMaoTDhmP5e0iVpWNFmmVXbF5l0v6VFYCRF8U3Op/sFhrYvaNxhF7VVYCBDuXUmWstp4LXXJvNI7Qq7ISQFhXJ2U9NJUmBmZyJefNrwm9KisBlF1wstbEp3tkCMlIv78iCf/KSoDIKrixIisnZIgND7RjLP3uvAACi86r1GQpwe3k/ab+4yuS78EJfnChJls1MrTXTX0TDwf0ZorfeaVkrcFv4OGc11nE7rw6sqfxaRzrvAACbueV0g74NI51XgCCGVxMRw3Oqc4LQDE7r5x2SPFpXOu8IGIGV9AOAz6Na50XwF9GWbk3uByfxrXOC0DwqpOO7FX4PK51XgCKuZR61APn1oDeWcSsTvQxbzjnOi+Av7zgWrJ0wmdyrvMCELzOK9ZkpcWncmxAb6aYZWVBFk4Kn8u5shIg4g7oDcQwP6HVeY+/ALgm4A7oZWR2fUKL8RdxrKz8x97ZKKcNA0H4NJZELOjgTpzEpUyAwPs/Y+3yMyE2WDIWnJb7XmFnJXl9KxHpUOHU26LTWl/Hy655ApZ5EdkBA3pvX5ODtdbHy67ZAyecGzZZqTVXa3WCl3kRvaT1xK0Id0QnU0q9Abywksgm0228AcDMixwb4fSsbovUhx2takS4XqoHCndWUDyx/FAjA5h5dWxyKi6tIlZwvSccwMyLyN5DuFYRq4dJLsL14WKVUltFrBAmM7VHMq+LVGMK17qDdyhbNSZwA3oN+tZS6tmDttlYfKoGybwuY4cJ137Qtg2jOUy0Ab0aNyDz2rxuI6jVbghL5nWNKjTz2lzrEDBdK/EyLyITJlz4yBCHQRW0Ab2GPCw6ec06YS4cYOZFLki4z6wb5sLBDeg1VN7RybUJPd57HGBY2drkdgw2uFPbXzKvK+T+wpkgw3GKTggQ5595bbIQONWyAMNKoipet5FN2wAw8yIy3sL9ze7DYqXGAzXz+hlXVo8XbjFVIpwHLqiUGp+1VmMCm3kRVf6l1OhM1htVI8L5YLyjk0UWh1NbJFejA5t5EdmWcLE3ufaLWFEBezXihPMWTvdbjmcRCzLzIqq8w8qPrB+ORSzIzIvI+JdS3wOstWRUxCJIbMCc19vkmrUWy8N9ydyKWJCZF5UBwqnp+tLDpSys1QnkgF5DFTTnNX1fL7fHq8hZtPP7AA0ricyZcIhAZl5EOXwpFVQ4B19KBV0q6Q+4cKDfcUSGQSk1HpiDlf/JsYUzoF8DRC6Bl1LlaNJFBSycAdaNNP8nbgeiLWbcdaD4nnkBYPR0ltt5UUKr1mAAhGvUqsUqHLxa33AvaWZeRq/21oI9OPbhdulkXmZVW+spFkIv5rtfjeGY/pwx5mCtp1oIfXGOaK74YPT0yRfCAAr1YGprzcRa4ZTKB7EWO5y6E2ZvrXkpZ4xxUGeItZLBRFHL2kKO73GZjSSWHN/74XKsNCtZCB+IFmulSWnkjJEmpZEv4zT5bY0shIlSFoV8GQuCIAiCIAiCIPxjDw4EAAAAAID8XxtBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVpDw4EAAAAAAT5Wy8wQgUAAAAAAAAAAADAC3UpXkiMqA/oAAAAAElFTkSuQmCC"},ca42:function(t,e,i){}}]);