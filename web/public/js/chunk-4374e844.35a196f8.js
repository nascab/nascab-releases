(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4374e844","chunk-ddb87040"],{"0aba":function(t,e,i){"use strict";i("525c")},"0bd4":function(t,e,i){"use strict";i.r(e);var o=i("e11e"),h=i.n(o),c=(i("6cc5"),i("be3b")),o=i("8fad"),o={name:"photoMap",props:{borderRadius:{default:"15px",type:String},albumId:{default:"",Type:String},libraryId:{default:"",Type:String},ordinaryAlbumId:{default:"",Type:String}},components:{albumDetail:o.default},data(){return{showAddServerModal:!1,newTileServer:{name:"",server:"",coordinate:"WGS-84",maxLevel:18},coordinateOptions:[{value:"WGS-84",label:"WGS-84"},{value:"GCJ-02",label:"GCJ-02"},{value:"BD-09",label:"BD-09"}],showSwitchMapModal:!1,tileServerList:[],currentTilesServer:"",albumFirstPhoto:null,showPhotoGeo:!1,map:null,markerGroup:null,clickGeohash:null,selectPositionStr:"",currentMaxZoom:8,moveTimer:null}},mounted(){this.getZoomInfo(),window.addEventListener("popstate",this.onPopstate)},beforeDestroy(){window.removeEventListener("popstate",this.onPopstate)},methods:{openAddServer(){this.newTileServer={name:"",server:"",coordinate:"WGS-84",maxLevel:18},this.showAddServerModal=!0},handleDeleteServer(t){this.$Modal.confirm({title:this.$t("common.alert"),content:this.$t("common.deleteSure"),onOk:()=>{this.api.post("/api/mapApi/deleteTileServer",{tileServerJson:JSON.stringify(t)}).then(t=>{t.code||(this.$Message.success(this.$t("common.operationSuccess")),this.goToSwitchMap())}).catch(t=>{console.error(t),this.$Message.error(this.$t("common.operationFail"))})}})},handleAddServer(){!this.newTileServer.name||!this.newTileServer.server||!this.newTileServer.coordinate||this.newTileServer.maxLevel<2||18<this.newTileServer.maxLevel||this.api.post("/api/mapApi/addTileServer",{tileServerJson:JSON.stringify(this.newTileServer)}).then(t=>{t.code||(this.$Message.success(this.$t("common.operationSuccess")),this.showAddServerModal=!1,this.goToSwitchMap())}).catch(t=>{console.error(t),this.$Message.error(this.$t("common.operationFail"))})},goToSwitchMap(){this.api.post("/api/mapApi/getTileServerList").then(t=>{!t.code&&t.tileServerList?(this.tileServerList=t.tileServerList.sort((t,e)=>e.current-t.current),this.showSwitchMapModal=!0):this.showVsNotification(this.$t("common.operationFail"))}).catch(t=>{console.error(t),this.showVsNotification(this.$t("common.operationFail"))})},switchMapApi(t){this.$Modal.confirm({title:this.$t("common.alert"),content:this.$t("mapSwitchAlert"),onOk:()=>{this.api.post("/api/mapApi/setTileServer",{tileServerJson:JSON.stringify(t)}).then(t=>{t.code||location.reload()}).catch(t=>{console.error(t),this.showVsNotification(this.$t("common.operationFail"))})}})},onPopstate(){this.showPhotoGeo?(this.showPhotoGeo=!1,this.$bus.$emit("closePhotoGallery")):this.$router.go(-1)},getZoomInfo(){this.api.get("/api/mapApi/getZoom",{}).then(t=>{t.code||(this.currentMaxZoom=parseInt(t.zoomInfo.maxZoom),t.tileServer&&(this.currentTilesServer=t.tileServer),this.initMap(parseInt(t.zoomInfo.minZoom),parseInt(t.zoomInfo.maxZoom)))}).catch(t=>{})},initMap(t,e){var i=c.a.mapUrl(),i=new h.a.TileLayer(i,{minZoom:t=t<2?2:t,maxZoom:e,attribution:"NORMAL"});i.setZIndex(1);let o=localStorage.getItem("map-center-lat"),s=localStorage.getItem("map-center-lng"),a=38.8225909761771,n=105.380859375;o&&s&&(a=o,n=s);var t=new h.a.LatLng(a,n),e=h.a.latLng(-90,-360),l=h.a.latLng(90,360),e=h.a.latLngBounds(e,l);this.map=new h.a.Map("mainmap",{maxBounds:e,center:t,zoom:5,attributionControl:!1,layers:[i]}),this.albumId||this.ordinaryAlbumId||this.libraryId?this.getAlbumPhotoList():(this.map.on("moveend",e=>{this.moveTimer&&clearTimeout(this.moveTimer),this.moveTimer=setTimeout(()=>{var t=this.map.getCenter();localStorage.setItem("map-center-lat",t.lat),localStorage.setItem("map-center-lng",t.lng),this.getHashBox(e)},600)}),this.map.zoomIn()),this.markerGroup=h.a.layerGroup().addTo(this.map)},onModalShow(t){if(t){var e=document.getElementsByClassName("ivu-modal-body");for(let t=0;t<e.length;t++)e[t]&&e[t].style&&(e[t].style.padding=0)}},formatTimestampToYearMonth(t){t=new Date(t);return t.getFullYear()+"/"+String(t.getMonth()+1).padStart(2,"0")},dealPhotoMap(o,s){for(var a in this.markerGroup.clearLayers(),s){let e=s[a];var a=document.createElement("div"),n=(a.style="display:inline-block;position:relative; width: 100%;height: 100%; object-fit: cover;padding:2%",document.createElement("img"));n.src=c.a.getImgFullPath(e.id,!0),n.style="width: 100%;height: 100%; object-fit: cover",a.appendChild(n);let t,i=9*o;(i=75<i?75:i)<35&&(i=35),e.original_time&&((t=document.createElement("p")).textContent=this.formatTimestampToYearMonth(e.original_time),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",t.style.fontSize="8px",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.color="white",t.style.overflow="hidden",t.style.textAlign="center",a.appendChild(t));n=h.a.divIcon({iconSize:[i,i],html:a});if((0!=e.latitude||0!=e.longitude)&&"undefined"!=e.latitude&&"undefined"!=e.longitude){this.albumFirstPhoto=e;try{var l=this.utils.transCoordinateForShow(this.currentTilesServer,e.longitude,e.latitude),r=h.a.marker([l[1],l[0]],{icon:n,indexId:e.id});r.on("click",t=>{this.api.post("/api/mapApi/getLocationStr",{indexId:e.id}).then(t=>{t.code||(this.selectPositionStr=t.geo.name+" "+t.geo.cn_name,this.clickGeohash=e.geohash,this.showPhotoGeo=!0,this.pushState())}).catch(t=>{})}),r.addTo(this.markerGroup)}catch(t){}}}var t;(this.albumId||this.ordinaryAlbumId)&&this.albumFirstPhoto&&(t=new h.a.LatLng(this.albumFirstPhoto.latitude,this.albumFirstPhoto.longitude),this.map.flyTo(t))},getAlbumPhotoList(){var t={};this.albumId?t.albumId=this.albumId:this.ordinaryAlbumId?t.ordinaryAlbumId=this.ordinaryAlbumId:this.libraryId&&(t.libraryId=this.libraryId),this.api.post("/api/photoApi/getAlbumPhotoForMap",t).then(t=>{t.code||this.dealPhotoMap(2,t.mapPhoto)}).catch(t=>{this.showVsNotification(JSON.stringify(t))})},getHashBox(t){this.map._zoom;let e=t.target._zoom,i=this.map.getBounds(),o=i._southWest,s=i._northEast,a=(o.lat<s.lat?o:s).lat,n=(s.lat>o.lat?s:o).lat,l=(o.lng<s.lng?o:s).lng,r=(s.lng>o.lng?s:o).lng,h={hideLoading:!0,minLat:a,minLng:l,maxLat:n,maxLng:r,zoom:e};this.api.post("/api/photoApi/getBoundsPhoto",h).then(t=>{t.code||this.dealPhotoMap(e,t.mapPhoto)}).catch(t=>{})}}},i=(i("99f7"),i("2877")),i=Object(i.a)(o,function(){var i=this,t=i.$createElement,o=i._self._c||t;return o("div",{staticClass:"map-root"},[i.isMobile?o("div",{staticClass:"map-content",attrs:{id:"mainmap"}}):o("div",{staticClass:"map-content",style:{"border-top-left-radius":i.borderRadius,"border-top-right-radius":i.borderRadius},attrs:{id:"mainmap"}}),i.map&&i.map._zoom&&!i.ordinaryAlbumId&&!i.albumId?o("div",{staticClass:"zoom-title-root"},[o("a",{staticStyle:{"margin-right":"5px","font-size":"12px"},on:{click:function(t){return i.goToSwitchMap()}}},[i.currentTilesServer&&i.currentTilesServer.name?o("span",{staticStyle:{"margin-right":"5px"}},[i._v(i._s(i.currentTilesServer.name))]):i._e(),i._v(i._s(i.$t("switchMap")))]),o("p",{staticStyle:{"font-size":"12px"}},[i._v(" "+i._s(i.$t("map.currentZoomLevel",{zoom:Math.ceil(i.map._zoom)}))+" "),i.currentMaxZoom?o("span",{staticStyle:{"margin-left":"3px"}},[i._v("(2-"+i._s(i.currentMaxZoom)+")")]):i._e()])]):i._e(),o("Modal",{ref:"myModal",attrs:{"footer-hide":"",fullscreen:"",closable:!1},on:{"on-visible-change":i.onModalShow},model:{value:i.showPhotoGeo,callback:function(t){i.showPhotoGeo=t},expression:"showPhotoGeo"}},[i.showPhotoGeo?o("album-detail",{attrs:{propsNearMode:!0,propsShowSearchBtn:!1,propsTitle:i.selectPositionStr,propsGeoHash:i.clickGeohash},on:{onClose:function(t){i.showPhotoGeo=!1}}}):i._e()],1),o("Modal",{attrs:{"footer-hide":""},scopedSlots:i._u([{key:"header",fn:function(){return[o("div",{staticClass:"ivu-modal-header-inner"},[i._v(i._s(i.$t("switchMap")))]),o("Button",{staticStyle:{position:"absolute",right:"40px",top:"8px"},attrs:{type:"primary",ghost:""},on:{click:i.openAddServer}},[i._v(" "+i._s(i.$t("addMapServer"))+" ")])]},proxy:!0}]),model:{value:i.showSwitchMapModal,callback:function(t){i.showSwitchMapModal=t},expression:"showSwitchMapModal"}},i._l(i.tileServerList,function(e,t){return o("div",{key:t,staticClass:"map-server-card ivu-card ivu-card-bordered"},[o("div",{staticClass:"ivu-card-body"},[o("h4",[i._v(i._s(i.$t("common.name"))+": "+i._s(e.name)),1==e.current?o("a",{staticStyle:{"margin-left":"5px"}},[i._v(i._s(i.$t("currentUsing")))]):i._e()]),1==e.isCustom?o("p",{staticStyle:{"word-break":"break-all"}},[i._v(i._s(i.$t("tileServerUrl"))+": "+i._s(e.server))]):i._e(),o("p",{staticStyle:{"word-break":"break-all"}},[i._v(i._s(i.$t("coordinate"))+": "+i._s(e.coordinate))]),o("p",{staticStyle:{"word-break":"break-all"}},[i._v(i._s(i.$t("maxZoom"))+": "+i._s(e.maxLevel))]),o("Button",{attrs:{type:"primary",ghost:""},on:{click:function(t){return i.switchMapApi(e)}}},[i._v(" "+i._s(i.$t("switch"))+" ")]),1==e.isCustom?o("Button",{staticStyle:{"margin-left":"5px"},attrs:{type:"error",ghost:""},on:{click:function(t){return i.handleDeleteServer(e)}}},[i._v(" "+i._s(i.$t("common.delete"))+" ")]):i._e()],1)])}),0),o("Modal",{attrs:{title:i.$t("addMapServer")},model:{value:i.showAddServerModal,callback:function(t){i.showAddServerModal=t},expression:"showAddServerModal"}},[o("Form",{attrs:{model:i.newTileServer,"label-position":"top"}},[o("FormItem",{attrs:{label:i.$t("common.name"),prop:"name"}},[o("Input",{model:{value:i.newTileServer.name,callback:function(t){i.$set(i.newTileServer,"name",t)},expression:"newTileServer.name"}})],1),o("FormItem",{attrs:{label:i.$t("tileServerUrl")+"(http/https)",prop:"server"}},[o("Input",{attrs:{placeholder:"https://xxx.xxx/{z}/{y}/{x}/tile.png"},model:{value:i.newTileServer.server,callback:function(t){i.$set(i.newTileServer,"server",t)},expression:"newTileServer.server"}})],1),o("FormItem",{attrs:{label:i.$t("coordinate"),prop:"coordinate"}},[o("Select",{model:{value:i.newTileServer.coordinate,callback:function(t){i.$set(i.newTileServer,"coordinate",t)},expression:"newTileServer.coordinate"}},i._l(i.coordinateOptions,function(t){return o("Option",{key:t.value,attrs:{value:t.value}},[i._v(i._s(t.label))])}),1)],1),o("FormItem",{attrs:{label:i.$t("maxZoom"),prop:"maxLevel"}},[o("InputNumber",{attrs:{min:2,max:18},model:{value:i.newTileServer.maxLevel,callback:function(t){i.$set(i.newTileServer,"maxLevel",t)},expression:"newTileServer.maxLevel"}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{on:{click:function(t){i.showAddServerModal=!1}}},[i._v(i._s(i.$t("common.cancel")))]),o("Button",{attrs:{type:"primary"},on:{click:i.handleAddServer}},[i._v(i._s(i.$t("common.commit")))])],1)],1)],1)},[],!1,null,"266a7041",null);e.default=i.exports},1498:function(t,e,a){"use strict";a.r(e);a("14d9");var o=a("be3b"),i={props:{singleSelectMode:{default:!1,type:Boolean}},components:{albumDetail:()=>Promise.resolve().then(a.bind(null,"8fad"))},data(){return{dealState:"",inputName:"",autoNameArr:[],showChangeName:!1,rightMenuList:[{text:this.$t("file.check"),type:"CHECK"},{text:this.$t("common.multiSelect"),type:"SELECT"},{text:this.$t("photo.changeName"),type:"MODIFY"},{text:this.$t("common.delete"),type:"DELETE"}],changeAlbumName:"",itemBaseWidth:180,itemWidth:180,itemMargin:10,selectedItem:"",showAlbumDetail:!1,showAddAlbum:!1,dataList:[],loading:!1,selectedIndex:!1,selectMode:!1,enable:!0,checkStateTimeout:null}},mounted(){this.getFacesList(),window.addEventListener("resize",this.calImageWidth),window.addEventListener("popstate",this.onPopstate)},beforeDestroy(){window.removeEventListener("resize",this.calImageWidth),window.removeEventListener("popstate",this.onPopstate),clearTimeout(this.checkStateTimeout)},methods:{getSelectedFaceId(){for(var t of this.dataList)if(t.selected)return t.id;return!1},onPageScroll(t){if(this.$refs.faceCm&&this.$refs.faceCm.show)return this.$refs.faceCm.hide()},onPopstate(){this.showAlbumDetail?(this.showAlbumDetail=!1,this.$bus.$emit("closePhotoGallery")):this.$router.go(-1)},enableAiFace(){this.api.post("/api/commonApi/saveConfigPhoto",{aiFaceEnable:"1"}).then(t=>{this.getFacesList()}).catch(t=>{})},exitSelectMode(){for(var t in this.selectMode=!1,this.dataList)this.dataList[t].selected=!1},itemSingleSelect(t){for(var e in this.dataList)this.dataList[e].selected=e==t;this.$forceUpdate()},itemSelect(t){this.dataList[t].selected=!this.dataList[t].selected,this.$forceUpdate();let e=!1;for(var i in this.dataList)if(this.dataList[i].selected){e=!0;break}this.selectMode=e},getSelectedIdList(){var t,e=[];for(t in this.dataList)this.dataList[t].selected&&e.push(this.dataList[t].id);return e},deleteSelect(){this.onDeletePerson(this.getSelectedIdList())},mergeSelect(){let t=this.getSelectedIdList();if(t.length<2)return this.showVsNotification(this.$t("photo.atleastTwoPersonMerge"));this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.mergePersonAlert"),()=>{this.api.post("/api/photoApi/mergeFace",{faceIdList:t}).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.getFacesList(),this.exitSelectMode())}).catch(t=>{})})},onShowChangeName(t){this.selectedIndex=t,this.selectedItem=this.dataList[t],this.selectedItem.face_name?this.inputName=this.selectedItem.face_name:this.inputName="",this.showChangeName=!0},onSaveName(){return this.inputName?50<this.inputName.length?this.showVsNotification(this.$t("photo.personNameTooLong")):void this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.changeUserName",{name:this.inputName}),()=>{this.api.post("/api/photoApi/updatePhotoFace",{faceId:this.selectedItem.id,faceName:this.inputName}).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.getFacesList(),this.showChangeName=!1)}).catch(t=>{})}):this.showVsNotification(this.$t("photo.inputPersonName"))},onDeletePerson(e){this.selectedItem,this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.sureDeletePerson"),()=>{var t={disabled:1};e?t.faceIdList=e:t.faceId=this.selectedItem.id,this.api.post("/api/photoApi/updatePhotoFace",t).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.getFacesList(),this.showChangeName=!1,this.exitSelectMode())}).catch(t=>{})})},mouseEnterImg(t){this.isMobile||this.$set(this.dataList[t],"hover",!0)},mouseLeaveImg(t){this.isMobile||this.$set(this.dataList[t],"hover",!1)},showRightMenu(t,e,i,o){if(this.singleSelectMode)return t.preventDefault();this.selectedIndex=o,this.selectedItem=i,this.$easycm(t,e,"faceCm")},rightMenuClick(t,e){if(this.singleSelectMode)return!1;e=e||this.rightMenuList[t[0]].type;"CHECK"==e?this.onAlbumClick(this.selectedIndex):"DELETE"==e?this.onDeletePerson():"MODIFY"==e?this.onShowChangeName(this.selectedIndex):"SELECT"==e&&this.itemSelect(this.selectedIndex)},calImageWidth(){this.singleSelectMode&&(this.itemBaseWidth=120,this.itemWidth=120);var t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin);t&&(this.itemWidth=t)},onAlbumClick(t){if(this.$refs.faceCm&&this.$refs.faceCm.show)return this.$refs.faceCm.hide();this.selectMode?this.itemSelect(t):this.singleSelectMode?this.itemSingleSelect(t):(this.selectedItem=this.dataList[t],this.showAlbumDetail=!0,this.pushState())},getFacesList(){this.autoNameArr=[],this.loading=!0,this.api.post("/api/photoApi/getPhotoFaces",{}).then(t=>{if(!t.code){this.dataList=t.data,this.enable=t.enable,this.dataList.length;for(let t=0;t<this.dataList.length;t++){var e=this.dataList[t],i=o.a.getFaceImageUrl(e.id);this.dataList[t].url=i+"&time="+(new Date).getTime(),this.autoNameArr.length<10&&e.face_name&&this.autoNameArr.push(e.face_name),this.dataList[t].selected=!1}this.dataList.length<1&&this.enable&&this.getFaceDealState(),this.$nextTick(()=>{this.calImageWidth(),setTimeout(()=>{this.calImageWidth()},300)})}this.loading=!1}).catch(t=>{this.loading=!1})},getFaceDealState(){this.api.post("/api/photoApi/getAiDealState",{hideLoading:!0,type:"faceapi"}).then(t=>{t.code||t.data&&(1==t.data.isIndexing?this.dealState=this.$t("photo.indexingNoAi"):t.data.faceApiWaitDealCount?(this.dealState=this.$t("photo.waitDealCount",{count:t.data.faceApiWaitDealCount}),1<t.data.faceApiWaitDealCount&&(this.checkStateTimeout=setTimeout(()=>{this.getFaceDealState()},8e3))):t.data.faceApiWaitCompareCount&&(this.dealState=this.$t("photo.waitCompareFaceCount",{count:t.data.faceApiWaitCompareCount}),1<t.data.faceApiWaitCompareCount)&&(this.checkStateTimeout=setTimeout(()=>{this.getFaceDealState()},8e3)))}).catch(t=>{})}}},s=(a("167b"),a("2877")),s=Object(s.a)(i,function(){var o=this,t=o.$createElement,s=o._self._c||t;return s("div",{staticClass:"album-root-wrapper"},[s("div",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px",display:"flex","flex-direction":"column","align-items":"center"}},[!o.loading&&o.dataList.length<1?s("my-nodata",{attrs:{title:o.$t("photo.noPersonPlaceHolder")}}):o._e(),o.enable?o._e():s("my-btn",{staticStyle:{"margin-top":"20px"},attrs:{title:o.$t("photo.enableAiFace")},on:{click:o.enableAiFace}}),o.enable&&o.dealState?s("div",{staticStyle:{"margin-top":"10px"}},[o._v("["+o._s(o.dealState)+"]")]):o._e()],1),s("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"row",overflow:"hidden"},style:{height:o.singleSelectMode?"450px":"100%"}},[s("div",{ref:"listWrapper",staticClass:"album-list-root",on:{scroll:o.onPageScroll}},[o._l(o.dataList,function(e,i){return s("vs-card",{style:{margin:o.itemMargin+"px",width:o.itemWidth+"px"},attrs:{type:"1"},on:{click:function(t){return o.onAlbumClick(i)},contextmenu:function(t){return o.showRightMenu(t,o.$root,e,i)},mouseenter:function(t){return o.mouseEnterImg(i)},mouseleave:function(t){return o.mouseLeaveImg(i)}},scopedSlots:o._u([{key:"title",fn:function(){return[s("div",{staticStyle:{display:"flex","align-items":"center",width:"100%","justify-content":"center","margin-top":"10px"}},[s("p",{staticClass:"item-name max-line-one"},[o._v(o._s(e.face_name||o.$t("photo.unnamed")))])])]},proxy:!0},{key:"img",fn:function(){return[e.url?s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.url,expression:"item.url"}],staticStyle:{"object-fit":"cover","pointer-events":"none"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"}}):s("img",{staticStyle:{"object-fit":"cover","pointer-events":"none"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:a("915f")}}),e.selected?s("div",{staticStyle:{width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",display:"flex","align-items":"center","justify-content":"center"}},[s("Icon",{attrs:{type:"md-checkmark-circle-outline",color:"white",size:"50"}})],1):o._e()]},proxy:!0},{key:"text",fn:function(){return[o.singleSelectMode||1!=o.$store.state.currentUser.is_admin?s("p"):s("p",{staticStyle:{"text-align":"center","margin-top":"5px"}},[o._v(o._s(o.$t("photo.photoCount",{photoCount:e.face_photo_count})))])]},proxy:!0},{key:"interactions",fn:function(){return[s("div",{staticStyle:{display:"flex","justify-content":"flex-end",width:"100%"}},[e.hover&&!o.selectMode&&!o.singleSelectMode||o.isMobile&&!o.singleSelectMode?s("vs-button",{staticClass:"btn-chat",attrs:{shadow:""},on:{click:function(t){return t.stopPropagation(),o.showRightMenu(t,o.$root,e,i)}}},[s("span",{staticClass:"nasIcons icon-bianji"})]):o._e(),!e.hover||o.selectMode||o.singleSelectMode?o._e():s("vs-button",{staticClass:"btn-chat",attrs:{shadow:""},on:{click:function(t){return t.stopPropagation(),o.itemSelect(i)}}},[s("span",{staticClass:"nasIcons icon-setting-common",style:{color:e.selected?"#386DF2":""}})])],1)]},proxy:!0}],null,!0)})}),s("div",{staticStyle:{width:"100%",height:"80px"}})],2)]),o.selectMode?s("div",{staticClass:"bottom-select-root"},[s("div",{on:{click:o.exitSelectMode}},[s("my-btn",{attrs:{type:"white",icon:"md-add",title:o.$t("common.cancel")}})],1),s("div",{on:{click:o.deleteSelect}},[s("my-btn",{attrs:{type:"red",icon:"md-add",title:o.$t("common.delete")}})],1),s("div",{on:{click:o.mergeSelect}},[s("my-btn",{attrs:{icon:"md-add",title:o.$t("photo.mergePerson")}})],1)]):o._e(),s("Modal",{ref:"myModal",attrs:{scrollable:!1,"footer-hide":"","class-name":"modal-style-nopadding",fullscreen:"",closable:!1},model:{value:o.showAlbumDetail,callback:function(t){o.showAlbumDetail=t},expression:"showAlbumDetail"}},[o.showAlbumDetail?s("album-detail",{attrs:{propsShowSearchBtn:!1,propsTitle:o.selectedItem.face_name||o.$t("photo.unnamed"),propsShowAddToAlbum:!1,propsShowDelete:!1,propsShowModeSwitch:!1,propsShowRemoveFromAlbum:!0,propsFaceId:o.selectedItem.id+""},on:{onClose:function(t){o.showAlbumDetail=!1}}}):o._e()],1),s("vs-dialog",{scopedSlots:o._u([{key:"header",fn:function(){return[s("h4",{staticStyle:{"font-size":"16px"}},[o._v(" "+o._s(o.$t("photo.inputPersonName"))+" ")])]},proxy:!0},{key:"footer",fn:function(){return[s("div",{staticClass:"footer-dialog"},[s("vs-button",{attrs:{block:""},on:{click:o.onSaveName}},[o._v(" "+o._s(o.$t("common.ok"))+" ")]),s("div",{staticStyle:{"margin-top":"10px"}},[s("a",{on:{click:function(t){return t.stopPropagation(),o.onDeletePerson()}}},[o._v(" "+o._s(o.$t("photo.deletePerson")))])])],1)]},proxy:!0}]),model:{value:o.showChangeName,callback:function(t){o.showChangeName=t},expression:"showChangeName"}},[s("div",{staticClass:"con-form"},[s("img",{staticStyle:{width:"50px",height:"50px","border-radius":"10px","object-fit":"cover","margin-right":"10px"},attrs:{src:o.selectedItem.url}}),s("div",[s("p",{staticClass:"input-alert"},[o._v(o._s(o.$t("photo.sameNameMerged")))])]),s("AutoComplete",{staticStyle:{width:"100%"},attrs:{data:o.autoNameArr,placeholder:o.$t("photo.inputPersonName")},model:{value:o.inputName,callback:function(t){o.inputName=t},expression:"inputName"}})],1)]),s("easy-cm",{ref:"faceCm",attrs:{tag:"faceCm",list:o.rightMenuList},on:{ecmcb:o.rightMenuClick}})],1)},[],!1,null,"33b98544",null);e.default=s.exports},"167b":function(t,e,i){"use strict";i("4b3d")},"167d":function(t,e,i){},2010:function(t,e,i){},"208d":function(t,e,i){},"4b1d":function(t,e,i){"use strict";i("bf21")},"4b3d":function(t,e,i){},"525c":function(t,e,i){},5757:function(t,e,i){"use strict";i("8e66")},"5b68":function(t,e,i){},"60bd":function(t,e,i){"use strict";i("9766")},"6a49":function(t,e,i){"use strict";i("c4e1")},"76e3":function(t,e,i){"use strict";i("2010")},"8cd3":function(t,e,i){"use strict";i("f04d")},"8e66":function(t,e,i){},"966f":function(t,e,i){"use strict";i("dc27")},9766:function(t,e,i){},"99f7":function(t,e,i){"use strict";i("208d")},a9d1:function(t,e,i){"use strict";i("5b68")},bf21:function(t,e,i){},c4e1:function(t,e,i){},d0b1:function(t,e,i){"use strict";i("de9b")},dc27:function(t,e,i){},de9b:function(t,e,i){},ed29:function(t,e,a){"use strict";a.r(e);var i=a("7cfd"),o=a("cd79"),s=a("0bd4"),n=(a("14d9"),a("8914")),r=a("be3b"),l=a("8fad"),n={components:{albumAdd:n.a,albumDetail:l.default},data(){return{pageSize:15,orderField:"id",orderType:"desc",searchStr:"",nextHasMore:!0,nextLoading:!1,rightMenuList:[{text:this.$t("file.check"),type:"CHECK"},{text:this.$t("common.delete"),type:"DELETE"}],changeAlbumName:"",itemBaseWidth:220,itemWidth:220,itemMargin:10,editAlbum:null,selectedAlbum:"",showAlbumDetail:!1,showAddAlbum:!1,albumList:[],selectedIndex:!1}},mounted(){this.loadFirstPage(),window.addEventListener("resize",this.calImageWidth),window.addEventListener("popstate",this.onPopstate)},activated(){var t=sessionStorage.getItem("albumDelete");if(t)for(var e in sessionStorage.removeItem("ordinaryAlbumDelete"),this.albumList)if(this.albumList[e].id==t)return this.albumList.splice(e,1)},beforeDestroy(){window.removeEventListener("resize",this.calImageWidth),window.removeEventListener("popstate",this.onPopstate)},methods:{onClickAdd(){this.showAddAlbum=!0},onSearch(t){this.searchStr=t,this.loadFirstPage()},loadFirstPage(){this.albumList=[],this.nextHasMore=!0,this.nextLoading=!1,this.getAlbumList()},loadNextPage(){this.getAlbumList()},onPageScroll(t){t.target.id,"album-smart-wrapper"==t.target.id&&this.dealOnPageScroll(t,()=>{this.loadNextPage()},t=>{})},onPopstate(){this.showAlbumDetail?(this.showAlbumDetail=!1,this.$bus.$emit("closePhotoGallery")):this.$router.go(-1)},showRightMenu(t,e,i,o){if(this.isMobile)return t.preventDefault();this.selectedIndex=o,this.selectedAlbum=i,this.$easycm(t,e)},rightMenuClick(t){t=this.rightMenuList[t[0]].type;"CHECK"==t?this.onAlbumClick(this.selectedIndex):"DELETE"==t&&this.deleteAlbum()},showEditAlbum(t){this.selectedAlbum=this.albumList[t],"condition"==this.selectedAlbum.type?(this.editAlbum=this.albumList[t],this.showAddAlbum=!0):(this.changeAlbumName=this.selectedAlbum.name,this.$nextTick(()=>{this.$refs.changeAlbumDialog.setShow(!0)}))},onChangeAlbumName(t){this.changeAlbumName=t,this.changeAlbumName.length<1&&this.showVsNotification(this.$t("album.pleaseInputAlbumName")),this.api.post("/api/photoApi/updateAlbum",{id:this.selectedAlbum.id,name:this.changeAlbumName}).then(t=>{t.code||(this.showVsNotification(this.$t("common.changeSuccess")),this.loadFirstPage())}).catch(t=>{})},clickOrder(t,e){this.orderField=t,this.orderType=e,this.loadFirstPage()},onAddAlbum(){this.showAddAlbum=!1,this.loadFirstPage()},calImageWidth(){var t;this.$refs.listWrapper&&(t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin))&&(this.itemWidth=t)},onAlbumClick(t){this.selectedAlbum=this.albumList[t],this.showAlbumDetail=!0,this.pushState()},getAlbumList(){var t;!this.nextLoading&&this.nextHasMore&&(this.nextLoading=!0,t={offset:this.albumList.length,count:this.pageSize,orderType:this.orderType,orderField:this.orderField},this.searchStr&&(t.search=this.searchStr),this.api.post("/api/photoApi/getAllAlbum",t).then(e=>{if(this.nextLoading=!1,!e.code){for(let t=0;t<e.data.length;t++){var i=e.data[t];i.data_value=JSON.parse(i.data_value);for(let t=0;t<i.imgList.length;t++){var o=r.a.getImgFullPath(i.imgList[t].id,!0);i.imgList[t].url=o}this.albumList.push(i)}e.data.length<this.pageSize&&(this.nextHasMore=!1),this.$nextTick(()=>{this.calImageWidth(),setTimeout(()=>{this.calImageWidth()},300)})}}).catch(t=>{this.nextLoading=!1}))},deleteAlbum(){this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("common.deleteSure"),()=>{this.api.post("/api/photoApi/deleteAlbum",{id:this.selectedAlbum.id}).then(t=>{t.code||(this.showVsNotification(this.$t("common.deleteSuccess")),this.loadFirstPage(),this.showAlbumDetail=!1)}).catch(t=>{})})}}},h=(a("d0b1"),a("2877")),n=Object(h.a)(n,function(){var o=this,t=o.$createElement,s=o._self._c||t;return s("div",{staticClass:"ai-album-root-wrapper"},[!o.nextLoading&&o.albumList.length<1?s("my-nodata",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px"},attrs:{title:o.$t("album.noAlubmDesc"),btnTitle:o.$t("album.addASmartAlbum")},on:{onBtnClick:function(t){o.showAddAlbum=!0}}}):o._e(),s("div",{staticStyle:{width:"100%",height:"100%",overflow:"scroll"},attrs:{id:"album-smart-wrapper"},on:{scroll:o.onPageScroll}},[s("div",{ref:"listWrapper",staticClass:"album-list-root"},o._l(o.albumList,function(e,i){return 1==o.$store.state.currentUser.is_admin||0<e.imgList.length?s("vs-card",{style:{margin:o.itemMargin+"px",width:o.itemWidth+"px"},attrs:{type:"1"},on:{click:function(t){return o.onAlbumClick(i)},contextmenu:function(t){return o.showRightMenu(t,o.$root,e,i)}},scopedSlots:o._u([{key:"title",fn:function(){return[s("h3",{staticClass:"max-line-one",staticStyle:{"text-align":"left"}},[o._v(o._s(e.name))])]},proxy:!0},{key:"img",fn:function(){return[0<e.imgList.length?s("img",{staticStyle:{"object-fit":"cover"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:e.imgList[0].url}}):s("img",{staticStyle:{"object-fit":"cover"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:a("915f")}})]},proxy:!0},{key:"text",fn:function(){return["date"==e.type?s("div",["aiDate"==e.data_value.type?s("p",{staticClass:"item-subtitle max-line-one"},[o._v(" "+o._s(1==e.data_value.isLunar?o.$t("photo.lunar"):o.$t("photo.solar"))+": "+o._s("%"==e.data_value.year?o.$t("album.everyYear"):e.data_value.year)+o._s("/"+("%"==e.data_value.month?o.$t("album.everyMonth"):e.data_value.month))+o._s("/"+e.data_value.day)+" ")]):o._e(),"fix"==e.data_value.type?s("p",{staticClass:"item-subtitle max-line-one"},[o._v(" "+o._s(e.data_value.year+"/")+o._s(e.data_value.month+"/")+o._s(e.data_value.day)+" "),">"==e.data_value.sign?s("span",[o._v(o._s(o.$t("album.gt")))]):o._e(),"<"==e.data_value.sign?s("span",[o._v(o._s(o.$t("album.lt")))]):o._e(),"="==e.data_value.sign?s("span",[o._v(o._s(o.$t("album.eq")))]):o._e()]):o._e(),"holidays"==e.data_value.type?s("p",{staticClass:"item-subtitle max-line-one"},[o._v(" "+o._s(o.$t("album.holidays"))+"-"+o._s(e.data_value.holidayName)+" ")]):o._e(),"section"==e.data_value.type?s("p",{staticClass:"item-subtitle max-line-one"},[o._v(" "+o._s(e.data_value.year_start+"/")+o._s(e.data_value.month_start+"/")+o._s(e.data_value.day_start)+" - "+o._s(e.data_value.year_end+"/")+o._s(e.data_value.month_end+"/")+o._s(e.data_value.day_end+"/")+" ")]):o._e()]):o._e(),"geo"==e.type?s("div",[s("p",{staticClass:"item-subtitle max-line-one"},[o._v(o._s(o.$t("album.geoAlbumDetail")))])]):o._e(),"mode"==e.type?s("div",[s("p",{staticClass:"item-subtitle max-line-one"},[o._v(o._s(e.data_value.mode))])]):o._e(),"condition"==e.type?s("div",[e.data_value?s("vs-tooltip",{scopedSlots:o._u([{key:"tooltip",fn:function(){return[o._v(" "+o._s(e.data_value)+" ")]},proxy:!0}],null,!0)},[s("p",{staticClass:"item-subtitle max-line-one"},[o._v(o._s(e.data_value))])]):o._e()],1):o._e()]},proxy:!0},{key:"interactions",fn:function(){return[s("vs-button",{attrs:{icon:""}},["date"==e.type?s("div",["aiDate"==e.data_value.type?s("p",{staticClass:"album-type max-line-one"},[o._v(o._s(o.$t("album.aiDate")))]):o._e(),"fix"==e.data_value.type?s("p",{staticClass:"album-type max-line-one"},[o._v(o._s(o.$t("album.fixDate")))]):o._e(),"section"==e.data_value.type?s("p",{staticClass:"album-type max-line-one"},[o._v(o._s(o.$t("album.sectionDate")))]):o._e(),"holidays"==e.data_value.type?s("p",{staticClass:"album-type max-line-one"},[o._v(o._s(o.$t("album.holidays")))]):o._e()]):o._e(),"geo"==e.type?s("div",[s("p",{staticClass:" max-line-one"},[o._v(o._s(o.$t("album.geoAlbum")))])]):o._e(),"mode"==e.type?s("div",[s("p",{staticClass:" max-line-one"},[o._v(o._s(o.$t("album.modeAlbum")))])]):o._e(),"condition"==e.type?s("div",[s("p",{staticClass:" max-line-one"},[o._v(o._s(o.$t("photo.filterAlubm")))])]):o._e()]),s("vs-button",{staticClass:"btn-chat",attrs:{icon:"",shadow:"",primary:""},on:{click:function(t){return t.stopPropagation(),o.showEditAlbum(i)}}},[s("Icon",{attrs:{type:"md-settings",size:"20"}})],1)]},proxy:!0}],null,!0)}):o._e()}),1),s("div",{staticStyle:{display:"flex","justify-content":"center",width:"100%","flex-direction":"column","align-items":"center"}},[o.nextHasMore&&0<o.albumList.length?s("Button",{staticStyle:{width:"250px","margin-top":"30px",height:"45px","border-radius":"20px"},attrs:{type:"default"},on:{click:function(t){return o.loadNextPage()}}},[o._v(o._s(o.$t("common.loadmore")))]):o._e(),o.nextLoading?s("Spin",{staticStyle:{"margin-top":"30px"},attrs:{size:"large"}}):o._e(),!o.nextLoading&&!o.nextHasMore&&0<o.albumList.length?s("span",{staticStyle:{"margin-top":"30px"}},[o._v(o._s(o.$t("common.noMore")))]):o._e(),s("div",{staticStyle:{height:"50px"}})],1),s("div",{staticStyle:{height:"50px",width:"100%"}})]),s("my-dialog-input",{ref:"changeAlbumDialog",attrs:{placeholder:o.$t("album.albumName"),showCloseBtn:!0,content:o.$t("album.albumName"),title:o.$t("album.changeAlbumName"),initValue:o.changeAlbumName},on:{onOkClick:o.onChangeAlbumName}}),s("vs-dialog",{attrs:{scroll:""},scopedSlots:o._u([{key:"header",fn:function(){return[s("h4",{staticStyle:{"font-size":"16px"}},[o._v(" "+o._s(o.$t("album.addAAlbum"))+" ")])]},proxy:!0}]),model:{value:o.showAddAlbum,callback:function(t){o.showAddAlbum=t},expression:"showAddAlbum"}},[o.showAddAlbum?s("album-add",{attrs:{editAlbum:o.editAlbum},on:{onClose:function(t){o.showAddAlbum=!1},onAdd:o.onAddAlbum}}):o._e()],1),s("Modal",{ref:"myModal",attrs:{scrollable:!1,"footer-hide":"","class-name":"modal-style-nopadding",fullscreen:"",closable:!1},model:{value:o.showAlbumDetail,callback:function(t){o.showAlbumDetail=t},expression:"showAlbumDetail"}},[o.showAlbumDetail?s("album-detail",{attrs:{propsShowSearchBtn:!1,propsTitle:o.selectedAlbum.name,propsShowAddToAlbum:!0,propsShowDelete:!0,propsShowModeSwitch:!0,propsAlbumId:o.selectedAlbum.id+""},on:{onClose:function(t){o.showAlbumDetail=!1},onDelete:o.deleteAlbum}}):o._e()],1),s("easy-cm",{attrs:{list:o.rightMenuList},on:{ecmcb:o.rightMenuClick}})],1)},[],!1,null,"030bae36",null).exports,c=a("a95d"),d=a("a732"),p=a("11a3"),m=a("9453"),u=a("d3ac"),g=a("5d55"),f=a("59fb"),v=a("db96"),S=a("2cc5"),y=a("c220"),y={props:{hasSider:{default:!1,type:Boolean},showAddToAlbum:{default:!0,type:Boolean},ordinaryAlbumId:{default:"",type:String},albumId:{default:"",type:String}},components:{myScrollBar:y.a,photoBottomSelect:m.a,photoDetail:u.default,videoDetail:g.default,photoOperationHeader:f.a,photoListContent:v.a},data(){return{searchStr:"",showVideoDetail:!1,scrollTop:0,showPhotoDetail:!1,editMode:!1,showMode:"cover",showFileType:"0"}},mounted(){window.addEventListener("scroll",this.onPageScroll,!0),window.addEventListener("resize",this.onWindowResize),this.loadFirstPage(),window.addEventListener("popstate",this.onPopstate)},beforeDestroy(){window.removeEventListener("scroll",this.onPageScroll,!0),window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("popstate",this.onPopstate)},methods:{galleryLoadMoreNext(){this.$refs.photoContent&&this.$refs.photoContent.loadNextPage()},onPopstate(){this.showPhotoDetail?(this.$refs.photoDetail.closeGallery(),this.showPhotoDetail=!1):this.showVideoDetail?this.showVideoDetail=!1:this.$router.go(-1)},loadFirstPage(){this.$refs.photoContent.clearList(),this.$refs.photoContent.lastHasMore=!1,this.$nextTick(()=>{this.$refs.photoContent.getPhotoByTime((new Date).getTime(),1)})},onWindowResize(){this.$refs.photoContent.calculateImgHeight()},onPageScroll(i){if(!this.showPhotoDetail&&!this.showVideoDetail){this.$refs.scrollBar&&this.$refs.scrollBar.onScroll(i),this.$refs.photoContent&&this.$refs.photoContent.cancelTouchEvent();let t=null,e=null;i.srcElement.scrollingElement?(t=i.srcElement.scrollingElement.scrollTop,e=i.srcElement.scrollingElement.scrollHeight):i.srcElement?(t=i.srcElement.scrollTop,e=i.srcElement.scrollHeight):i.target&&(t=i.target.scrollTop,e=i.target.scrollHeight),this.scrollTop=t;var o=document.documentElement.clientHeight;!e&&i.srcElement.scrollingElement&&(e=i.srcElement.scrollingElement.scrollHeight),this.scrollTop+o>=e-5&&this.$refs.photoContent&&this.$refs.photoContent.loadNextPage()}},onUnSelect(){this.clearSelected()},onSearch(t){this.searchStr=t,this.loadFirstPage(),this.clearSelected()},onChooseDataType(t){this.showFileType=t,this.showFileType,this.loadFirstPage(),this.clearSelected()},setImgSize(t){this.$refs.photoContent.itemBaseWidth=t,this.$refs.photoContent.calculateImgHeight()},onChangeShowMode(t){this.showMode=t,this.$refs.photoContent.calculateImgHeight()},onHoverSelected(t){this.editMode=!0,this.onPhotoClick(t)},onPhotoLoadOver(t,e){setTimeout(()=>{this.$refs.photoContent.calculateImgHeight()},300),this.showPhotoDetail&&this.$refs.photoDetail&&this.$refs.photoDetail.updateImageList(t,e)},onTrashInSuc(){this.$refs.photoContent.onTrashInSuc()},clearSelected(){this.$refs.photoContent.clearSelected(),this.$refs.selectView&&this.$refs.selectView.clearSelected(),this.editMode=!1},onPhotoClick(t){let e=this.$refs.photoContent.photoList;this.editMode?e[t].selected?(this.$refs.photoContent.setPhotoSelected(t,!1),this.$refs.selectView.removeSelected(e[t].id),this.$refs.selectView.selectedList.length<1&&(this.editMode=!1)):(this.$refs.photoContent.setPhotoSelected(t,!0),this.$refs.selectView.addSelected(e[t])):1==e[t].type?(this.showPhotoDetail=!0,this.$nextTick(()=>{this.$refs.photoDetail.showImg(e,t)}),this.pushState()):2==e[t].type&&("1"==localStorage.getItem("rawPlayer")||this.isIosSupportRawPlayer()?S.a.playVideo({playIndex:t,playList:e,token:this.$store.state.token,fromFileBrower:!1,serverType:"photo"}):(this.showVideoDetail=!0,this.$nextTick(()=>{this.$refs.videoPlayer.playVideo(e,t)}),this.pushState()))}}};a("5757");y=Object(h.a)(y,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{ref:"photoListRoot",staticClass:"photo-recent-root"},[t("photo-operation-header",{ref:"photoHeader",staticStyle:{width:"100%",height:"60px",position:"absolute",left:"0","z-index":"2"},on:{onChooseDataType:e.onChooseDataType,onChangeShowMode:e.onChangeShowMode,onSizeChange:e.setImgSize,onSearch:e.onSearch,albumId:e.albumId}}),t("div",{staticStyle:{width:"100%",display:"flex",height:"100%","flex-direction":"row",overflow:"hidden","padding-top":"60px"}},[t("photo-list-content",{ref:"photoContent",attrs:{showMode:e.showMode,albumId:e.albumId,ordinaryAlbumId:e.ordinaryAlbumId,showFileType:e.showFileType,searchStr:e.searchStr,sortField:"check_time"},on:{onHoverSelected:e.onHoverSelected,onPhotoClick:e.onPhotoClick,onPhotoLoadOver:e.onPhotoLoadOver}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.editMode,expression:"editMode"}],staticClass:"bottom-select-root"},[t("photo-bottom-select",{ref:"selectView",attrs:{ordinaryAlbumId:e.ordinaryAlbumId,showAddToAlbum:e.showAddToAlbum,editMode:e.editMode},on:{onRemoveFromAlbum:e.onTrashInSuc,onUnSelect:e.onUnSelect,onTrashInSuc:function(t){return e.onTrashInSuc()}}})],1),e.showPhotoDetail||e.showVideoDetail?e._e():t("my-scroll-bar",{ref:"scrollBar"}),e.showPhotoDetail?t("photo-detail",{ref:"photoDetail",attrs:{enableRemove:!0},on:{onClose:function(t){e.showPhotoDetail=!1},galleryLoadMoreNext:e.galleryLoadMoreNext}}):e._e(),t("Modal",{attrs:{fullscreen:"","footer-hide":"",closable:!1},model:{value:e.showVideoDetail,callback:function(t){e.showVideoDetail=t},expression:"showVideoDetail"}},[e.showVideoDetail?t("video-detail",{ref:"videoPlayer",attrs:{propsServerType:"photo"},on:{onClose:function(t){e.showVideoDetail=!1}}}):e._e()],1)],1)},[],!1,null,"17ffd0c0",null).exports,m={components:{photoBottomSelect:m.a,photoDetail:u.default,videoDetail:g.default,photoOperationHeader:f.a,photoListContent:v.a},props:{serverType:{default:"photo",type:String},hasSider:{default:!0,type:Boolean}},data(){return{selectedPhotoIndex:0,selectedPhoto:"",showTrashChoose:!1,showVideoDetail:!1,scrollTop:0,showPhotoDetail:!1,editMode:!1,showMode:"cover",showFileType:"0"}},mounted(){this.loadFirstPage(),window.addEventListener("scroll",this.onPageScroll,!0),window.addEventListener("resize",this.onWindowResize),window.addEventListener("popstate",this.onPopstate),setTimeout(()=>{this.$forceUpdate()},500)},beforeDestroy(){window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("scroll",this.onPageScroll,!0),window.removeEventListener("popstate",this.onPopstate)},methods:{onPopstate(){this.showPhotoDetail?(this.$refs.photoDetail.closeGallery(),this.showPhotoDetail=!1):this.showVideoDetail?this.showVideoDetail=!1:this.$router.go(-1)},loadFirstPage(){this.$refs.photoContent.clearList(),this.$refs.photoContent.lastHasMore=!1,this.$refs.photoContent.getPhotoByTime("9999999999999",1)},onWindowResize(){this.$refs.photoContent.calculateImgHeight()},onPageScroll(i){if(!this.showPhotoDetail&&!this.showVideoDetail){this.$refs.photoContent&&this.$refs.photoContent.cancelTouchEvent();let t=null,e=null;i.srcElement.scrollingElement?(t=i.srcElement.scrollingElement.scrollTop,e=i.srcElement.scrollingElement.scrollHeight):i.srcElement?(t=i.srcElement.scrollTop,e=i.srcElement.scrollHeight):i.target&&(t=i.target.scrollTop,e=i.target.scrollHeight),this.scrollTop=t;i=document.documentElement.clientHeight;0==this.scrollTop&&this.$refs.photoContent&&this.$refs.photoContent.loadLastPage(),this.scrollTop+i>=e-5&&this.$refs.photoContent&&this.$refs.photoContent.loadNextPage()}},restoreAll(){this.$refs.photoContent.photoList.length<1?this.showVsNotification(this.$t("common.noData")):this.$refs.selectView.restoreAll(this.$refs.photoContent.photoList)},deleteAll(){this.$refs.photoContent.photoList.length<1?this.showVsNotification(this.$t("common.noData")):this.$refs.selectView.deleteAll(this.$refs.photoContent.photoList)},onUnSelect(){this.clearSelected()},onChooseDataType(t){this.showFileType=t,this.clearSelected(),this.$nextTick(()=>{this.loadFirstPage()})},setImgSize(t){this.$refs.photoContent.itemBaseWidth=t,this.$refs.photoContent.calculateImgHeight()},onChangeShowMode(t){this.showMode=t,this.$refs.photoContent.calculateImgHeight()},onHoverSelected(t){this.editMode=!0,this.onPhotoClick(t)},onPhotoLoadOver(){},onTrashOutSuc(){this.$refs.photoContent.onTrashInSuc()},onNeedRefresh(){this.loadFirstPage()},clearSelected(){this.$refs.photoContent.clearSelected(),this.$refs.selectView&&this.$refs.selectView.clearSelected(),this.editMode=!1},onPhotoClick(t){var e=this.$refs.photoContent.photoList;this.editMode?e[t].selected?(this.$refs.photoContent.setPhotoSelected(t,!1),this.$refs.selectView.removeSelected(e[t].id),this.$refs.selectView.selectedList.length<1&&(this.editMode=!1)):(this.$refs.photoContent.setPhotoSelected(t,!0),this.$refs.selectView.addSelected(e[t])):(this.selectedPhotoIndex=t,this.selectedPhoto=e[t],this.showTrashChoose=!0)},checkDetail(){this.showTrashChoose=!1,1==this.selectedPhoto.type?(this.showPhotoDetail=!0,this.$nextTick(()=>{this.$refs.photoDetail.showImg(this.$refs.photoContent.photoList,this.selectedPhotoIndex)}),this.pushState()):2==this.selectedPhoto.type&&("1"==localStorage.getItem("rawPlayer")||this.isIosSupportRawPlayer()?S.a.playVideo({playIndex:this.selectedPhotoIndex,playList:this.$refs.photoContent.photoList,token:this.$store.state.token,fromFileBrower:!1,serverType:"photo"}):(this.showVideoDetail=!0,this.$nextTick(()=>{this.$refs.videoPlayer.playVideo(this.$refs.photoContent.photoList,this.selectedPhotoIndex)}),this.pushState()))},popRestore(){this.selectedPhoto.selected=!0,this.$refs.selectView.addSelected(this.selectedPhoto),this.showTrashChoose=!1,this.$refs.selectView.trashPhotos(0)},popDelete(){this.selectedPhoto.selected=!0,this.$refs.selectView.addSelected(this.selectedPhoto),this.showTrashChoose=!1,this.$refs.selectView.deleteFromDisk()}}};a("4b1d");g=Object(h.a)(m,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"photoListRoot",staticClass:"trash-root"},[i("photo-operation-header",{ref:"photoHeader",staticStyle:{width:"100%",height:"60px",position:"absolute",left:"0","z-index":"2"},on:{onChooseDataType:e.onChooseDataType,onChangeShowMode:e.onChangeShowMode,onSizeChange:e.setImgSize}}),i("div",{staticStyle:{width:"100%",display:"flex",height:"100%","flex-direction":"row",overflow:"hidden","padding-top":"60px"}},[i("photo-list-content",{ref:"photoContent",attrs:{trash:1,showMode:e.showMode,showFileType:e.showFileType,sortField:"in_trash_time",pageRows:10},on:{onHoverSelected:e.onHoverSelected,onPhotoClick:e.onPhotoClick,onPhotoLoadOver:e.onPhotoLoadOver}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTrashChoose&&!e.showPhotoDetail&&!e.showVideoDetail&&e.$refs.photoContent&&0<e.$refs.photoContent.photoList.length,expression:"!showTrashChoose && !showPhotoDetail && !showVideoDetail && $refs.photoContent && $refs.photoContent.photoList.length > 0"}],staticClass:"bottom-select-root"},[i("photo-bottom-select",{ref:"selectView",attrs:{trashMode:!0,editMode:e.editMode},on:{onUnSelect:e.onUnSelect,onTrashOutSuc:function(t){return e.onTrashOutSuc()},restoreAll:e.restoreAll,deleteAll:e.deleteAll,onDeleteSuc:e.onTrashOutSuc,onNeedRefresh:e.onNeedRefresh}})],1),i("vs-dialog",{scopedSlots:e._u([{key:"header",fn:function(){return[i("h4",{staticStyle:{"font-size":"16px"}},[e._v(" "+e._s(e.$t("common.whatWillYouDo"))+" ")])]},proxy:!0}]),model:{value:e.showTrashChoose,callback:function(t){e.showTrashChoose=t},expression:"showTrashChoose"}},[i("div",{staticClass:"pop-root"},[i("img",{staticClass:"pop-img",attrs:{src:e.selectedPhoto.url,mode:"aspectFill"},on:{dragstart:function(t){t.preventDefault()}}}),i("div",{staticClass:"pop-text-root",staticStyle:{"margin-top":"5px"},on:{click:e.checkDetail}},[i("my-btn",{staticStyle:{width:"80%"},attrs:{type:"white",title:e.$t("file.goDetail")}})],1),i("div",{staticClass:"pop-text-root",staticStyle:{"margin-top":"5px"},on:{click:e.popRestore}},[i("my-btn",{staticStyle:{width:"80%"},attrs:{title:e.$t("file.restore")}})],1),i("div",{staticClass:"pop-text-root",staticStyle:{"margin-top":"5px"},on:{click:e.popDelete}},[i("my-btn",{staticStyle:{width:"80%"},attrs:{title:e.$t("file.deleteForever"),type:"red"}})],1)])]),e.showPhotoDetail?i("photo-detail",{ref:"photoDetail",on:{onClose:function(t){e.showPhotoDetail=!1}}}):e._e(),i("Modal",{attrs:{fullscreen:"","footer-hide":"",closable:!1},model:{value:e.showVideoDetail,callback:function(t){e.showVideoDetail=t},expression:"showVideoDetail"}},[e.showVideoDetail?i("video-detail",{ref:"videoPlayer",attrs:{propsServerType:"photo"},on:{onClose:function(t){e.showVideoDetail=!1}}}):e._e()],1)],1)},[],!1,null,"cfe8b95a",null).exports,f=a("1ee4"),v=a("e86f"),m=a("ccdb"),v={props:{sourceType:{default:"photo",type:String}},mounted(){this.getPathList(),this.getExcludeConfig()},components:{fileSelectBar:v.a,fileSelect:m.default,folderBrowerOperationBar:f.a},data(){return{cachePath:"",excludeType:"",excludePathList:[],showAddExcludeDialog:!1,showChangeSourcePosition:!1,canAddPath:!0,showChooseFolder:!1,pathList:[],selectedItem:{},intervalList:[{value:18e5,label:this.$t("everyXHour",{count:.5})},{value:36e5,label:this.$t("everyXHour",{count:1})},{value:72e5,label:this.$t("everyXHour",{count:2})},{value:108e5,label:this.$t("everyXHour",{count:3})},{value:144e5,label:this.$t("everyXHour",{count:4})},{value:18e6,label:this.$t("everyXHour",{count:5})},{value:216e5,label:this.$t("everyXHour",{count:6})},{value:324e5,label:this.$t("everyXHour",{count:9})},{value:432e5,label:this.$t("everyXHour",{count:12})},{value:864e5,label:this.$t("everyXHour",{count:24})}]}},computed:{},methods:{onIntevealChange(t,e){this.updateSource(t)},updateSource(e){1==e.scan_interval&&0==e.scan_interval_ms&&(e.scan_interval_ms=this.intervalList[2].value),this.api.post("/api/sourceFolderApi/updateSource",{scan_when_start:e.scan_when_start,scan_when_change:e.scan_when_change,scan_interval:e.scan_interval,scan_interval_ms:e.scan_interval_ms,sourceId:e.id}).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),t.data&&(e=t.data))}).catch(t=>{this.getPathList()})},showAddExclude(t){this.excludeType=t,this.excludePathList=[],this.getExcludeConfig(),this.showAddExcludeDialog=!0},onAddExcludePath(t){if(t)if(35<t.length)this.showVsAlertDialog(this.$t("common.alert"),this.$t("common.textTooLong"));else{for(var e in this.excludePathList)if(this.excludePathList[e]==t)return;this.excludePathList.push(t),this.saveConfig()}},onDeleteExcludePath(t){if(t){for(var e in this.excludePathList)if(this.excludePathList[e]==t){this.excludePathList.splice(e,1);break}this.saveConfig()}},getExcludeConfig(){this.api.post("/api/commonApi/getAllConfig",{hideLoading:!0,keys:[""+this.excludeType]}).then(e=>{for(let t=0;t<e.data.allConfig.length;t++){var i=e.data.allConfig[t];i.title==this.excludeType&&(this.excludePathList=JSON.parse(i.value))}}).catch(t=>{})},saveConfig(){var t={};t[this.excludeType]=this.excludePathList,this.api.post("/api/commonApi/saveConfig",t).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.getExcludeConfig())}).catch(t=>{})},onFolderBack(){this.$refs.fileSelector,this.$refs.fileSelector&&this.$refs.fileSelector.goBack()},onShowRelocate(t){this.selectedItem=t,this.showChangeSourcePosition=!0},onSelectPath(t){this.addPathReq(t),this.showChooseFolder=!1},onSelectPathRelocate(t){this.relocateReq(t)},relocateReq(t){this.api.post("/api/sourceFolderApi/relocatePath",{type:this.sourceType,path:t,rawPathId:this.selectedItem.id}).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.getPathList(),this.showChangeSourcePosition=!1)}).catch(t=>{})},getPathList(){this.api.post("/api/sourceFolderApi/getPathByType",{type:this.sourceType}).then(t=>{t.code||(this.pathList=t.data,t.cacheParentPath&&(this.cachePath=t.cacheParentPath))}).catch(t=>{})},selectPath(){this.showChooseFolder=!0},addPathReq(t){this.api.post("/api/sourceFolderApi/addPath",{type:this.sourceType,path:t}).then(t=>{t.code||(1==localStorage.sourceAddAlert?this.showVsNotification(this.$t("common.operationSuccess")):(this.showVsAlertDialog(this.$t("common.alert"),this.$t("photo.addSourceAlert")),localStorage.sourceAddAlert=1),this.getPathList())}).catch(t=>{})},deletePath(t){this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("setting.ifDeletePath"),()=>{this.api.post("/api/sourceFolderApi/deletePath",{id:t.id}).then(t=>{t.code||this.showVsAlertDialog(this.$t("common.alert"),this.$t("setting.sourceFolderDeleteInBg"),()=>{this.getPathList()})}).catch(t=>{})})}}};a("6a49");m=Object(h.a)(v,function(){var i=this,t=i.$createElement,o=i._self._c||t;return o("div",{staticClass:"source-setting-root"},[o("div",{staticClass:"content-root"},[o("div",{staticClass:"flex-row",staticStyle:{"justify-content":"right","flex-wrap":"wrap"}},[o("p",{staticClass:"add-title"},[i._v(i._s(i.$t("setting.photoSourceSettingAlert")))])]),o("div",{staticStyle:{display:"flex","align-items":"center","margin-top":"5px"}},[o("a",{staticStyle:{height:"25px","margin-right":"15px"},attrs:{border:""},on:{click:function(t){return i.showAddExclude("excludePathPhoto")}}},[i._v(i._s(i.$t("setting.excludePath")))]),o("a",{staticStyle:{"margin-right":"15px",height:"25px"},attrs:{border:""},on:{click:function(t){return i.showAddExclude("excludeFilenamePhoto")}}},[i._v(i._s(i.$t("setting.excludeFilename")))]),o("a",{staticStyle:{height:"25px"},on:{click:function(t){return i.scanPath("photo","ALL")}}},[i._v(i._s(i.$t("scanAll")))])]),o("Divider"),0<i.pathList.length?o("div",{staticStyle:{width:"100%",overflow:"auto",height:"100%"}},[i._l(i.pathList,function(e,t){return o("Card",{staticStyle:{"margin-bottom":"20px",width:"100%","border-radius":"10px"}},[i.cachePath&&(i.cachePath==e.path||3==i.cachePath.length&&e.path.startsWith(i.cachePath)||e.path.startsWith(i.cachePath+"\\")||e.path.startsWith(i.cachePath+"/"))?o("p",{staticStyle:{color:"red","text-align":"left"}},[i._v(i._s(i.$t("sourceIncludeCache")))]):i._e(),o("div",{staticClass:"item-title"},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("common.path"))+" : ")]),i._v(i._s(e.path)+" "),o("Button",{staticStyle:{"margin-left":"5px"},attrs:{size:"small",type:"primary",shape:"circle"},on:{click:function(t){return i.scanPath("photo",e.path)}}},[i._v(i._s(i.$t("setting.scan")))])],1),o("div",{staticClass:"item-title"},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("common.state"))+" : ")]),o("span",{staticStyle:{"font-weight":"bold"},style:{color:0==e.exist?"#DE4545":"#386DF2"}},[i._v(i._s(0==e.exist?i.$t("common.unavailable"):i.$t("common.available")))]),0==e.exist?o("a",{staticStyle:{"margin-left":"30px"},on:{click:function(t){return i.onShowRelocate(e)}}},[i._v(i._s(i.$t("setting.source.directoryMoved")))]):i._e()]),o("div",{staticClass:"item-title"},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("scanWhenStart"))+" : ")]),o("i-switch",{staticStyle:{"flex-shrink":"0"},attrs:{"true-value":1,"false-value":0},on:{"on-change":function(t){return i.updateSource(e)}},model:{value:e.scan_when_start,callback:function(t){i.$set(e,"scan_when_start",t)},expression:"item.scan_when_start"}})],1),o("div",{staticClass:"item-title",staticStyle:{"margin-bottom":"10px"}},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("scanWhenChange"))+" : "),o("Icon",{staticStyle:{"font-weight":"bold",cursor:"pointer"},attrs:{type:"ios-help-circle-outline"},on:{click:function(t){i.showVsAlertDialog(i.$t("common.alert"),i.$t("scanWhenChangeAlert"))}}})],1),o("i-switch",{staticStyle:{"flex-shrink":"0"},attrs:{"true-value":1,"false-value":0},on:{"on-change":function(t){return i.updateSource(e)}},model:{value:e.scan_when_change,callback:function(t){i.$set(e,"scan_when_change",t)},expression:"item.scan_when_change"}})],1),o("div",{staticClass:"item-title",staticStyle:{"margin-bottom":"20px"}},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("intervalScan"))+" : "),o("Icon",{staticStyle:{"font-weight":"bold",cursor:"pointer"},attrs:{type:"ios-help-circle-outline"},on:{click:function(t){i.showVsAlertDialog(i.$t("common.alert"),i.$t("intervalScanAlert"))}}})],1),o("i-switch",{staticStyle:{"flex-shrink":"0"},attrs:{"true-value":1,"false-value":0},on:{"on-change":function(t){return i.updateSource(e)}},model:{value:e.scan_interval,callback:function(t){i.$set(e,"scan_interval",t)},expression:"item.scan_interval"}}),1==e.scan_interval?o("vs-select",{staticStyle:{width:"130px","margin-left":"20px"},on:{change:function(t){return i.onIntevealChange(e,t)}},model:{value:e.scan_interval_ms,callback:function(t){i.$set(e,"scan_interval_ms",t)},expression:"item.scan_interval_ms"}},i._l(i.intervalList,function(t){return o("vs-option",{attrs:{label:t.label,value:t.value}},[i._v(" "+i._s(t.label)+" ")])}),1):i._e()],1),o("span",{staticClass:"nasIcons icon-trash",staticStyle:{position:"absolute",right:"10px",bottom:"10px","font-size":"20px",cursor:"pointer",color:"#99AABF"},on:{click:function(t){return i.deletePath(e)}}})])}),o("Card",{staticStyle:{"margin-bottom":"20px",width:"100%","border-radius":"10px",cursor:"pointer"}},[o("div",{staticStyle:{width:"100%",height:"100%",display:"flex","justify-content":"center","align-items":"center","padding-left":"30px","padding-right":"30px"},on:{click:i.selectPath}},[o("span",{staticClass:"nasIcons icon-add-album",staticStyle:{color:"#386DF2","font-size":"50px","margin-right":"20px"}}),o("p",{staticClass:"add-text"},[i._v(i._s(i.$t("setting.btAddSource")))])])])],2):i._e()],1),i.pathList.length<1?o("my-nodata",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px"},attrs:{title:i.$t("setting.photoSourceSettingAlert"),btnTitle:i.$t("setting.btAddSource")},on:{onBtnClick:i.selectPath}}):i._e(),o("vs-dialog",{attrs:{"prevent-close":"",scroll:"","full-screen":i.isMobile},scopedSlots:i._u([{key:"header",fn:function(){return[o("h4",{staticStyle:{"font-size":"16px"}},[i._v(" "+i._s(i.$t("file.chooseFolder")+"["+i.$t("file.doubleClickFolderEnter")+"]")+" ")])]},proxy:!0},{key:"footer",fn:function(){return[o("file-select-bar",{on:{back:function(t){return i.$refs.fileSelector.goBack()},select:function(t){return i.$refs.fileSelector.onSelect()},create:function(t){return i.$refs.fileSelector.createNewFolder(t)}}})]},proxy:!0}]),model:{value:i.showChooseFolder,callback:function(t){i.showChooseFolder=t},expression:"showChooseFolder"}},[i.showChooseFolder?o("file-select",{ref:"fileSelector",attrs:{parent:"root",type:2},on:{cancel:function(t){i.showChooseFolder=!1},onSelect:i.onSelectPath,onCancel:function(t){i.showChooseFolder=!1}}}):i._e()],1),o("vs-dialog",{attrs:{"prevent-close":"",scroll:"","full-screen":i.isMobile},scopedSlots:i._u([{key:"header",fn:function(){return[o("h4",{staticStyle:{"font-size":"16px"}},[i._v(" "+i._s(i.$t("setting.source.reChoose")+i.selectedItem.path)+" ")])]},proxy:!0},{key:"footer",fn:function(){return[o("file-select-bar",{on:{back:function(t){return i.$refs.fileSelector.goBack()},select:function(t){return i.$refs.fileSelector.onSelect()},create:function(t){return i.$refs.fileSelector.createNewFolder(t)}}})]},proxy:!0}]),model:{value:i.showChangeSourcePosition,callback:function(t){i.showChangeSourcePosition=t},expression:"showChangeSourcePosition"}},[i.showChangeSourcePosition?o("file-select",{ref:"fileSelector",attrs:{parent:"root",type:2},on:{onSelect:i.onSelectPathRelocate,onCancel:function(t){i.showChangeSourcePosition=!1}}}):i._e()],1),o("vs-dialog",{attrs:{scroll:"","full-screen":i.isMobile},scopedSlots:i._u([{key:"header",fn:function(){return[i.excludeType?o("h4",{staticStyle:{"font-size":"16px"}},[i._v(" "+i._s("excludePathPhoto"==i.excludeType?i.$t("setting.excludePath"):i.$t("setting.excludeFilename"))+" ")]):i._e()]},proxy:!0}]),model:{value:i.showAddExcludeDialog,callback:function(t){i.showAddExcludeDialog=t},expression:"showAddExcludeDialog"}},[o("Input",{attrs:{autocapitalize:"off",autocorrect:"off",search:"","enter-button":i.$t("common.add"),placeholder:i.$t("setting.addExcludePathPlaceholder")},on:{"on-search":i.onAddExcludePath}}),0<i.excludePathList.length?o("p",{staticStyle:{"text-align":"left","margin-top":"15px",color:"#999999"}},[i._v(" "+i._s("excludePathPhoto"==i.excludeType?i.$t("setting.excludePathAlert"):i.$t("setting.excludeFilenameAlert"))+" ")]):i._e(),o("div",{staticClass:"flex-row",staticStyle:{"margin-top":"5px","flex-wrap":"wrap"}},i._l(i.excludePathList,function(e){return o("Tag",{attrs:{type:"dot",closable:"",color:"primary"},on:{"on-close":function(t){return i.onDeleteExcludePath(e)}}},[i._v(" "+i._s(e))])}),1)],1)],1)},[],!1,null,"5e4e7eea",null).exports,f=a("1498"),v={components:{albumDetail:l.default},data(){return{dealState:"",rightMenuList:[{text:this.$t("file.check"),type:"CHECK"}],changeAlbumName:"",itemBaseWidth:220,itemWidth:220,itemMargin:10,selectedItem:"",showAlbumDetail:!1,showAddAlbum:!1,dataList:[],loading:!1,selectedIndex:!1,enable:!0,checkStateTimeout:null}},mounted(){this.getClassesList(),window.addEventListener("resize",this.calImageWidth),window.addEventListener("popstate",this.onPopstate)},beforeDestroy(){window.removeEventListener("resize",this.calImageWidth),window.removeEventListener("popstate",this.onPopstate),clearTimeout(this.checkStateTimeout)},methods:{onPopstate(){this.showAlbumDetail?(this.showAlbumDetail=!1,this.$bus.$emit("closePhotoGallery")):this.$router.go(-1)},enableClass(){this.api.post("/api/commonApi/saveConfigPhoto",{aiClassesEnable:"1"}).then(t=>{this.getClassesList()}).catch(t=>{})},showRightMenu(t,e,i,o){if(this.isMobile)return t.preventDefault();this.selectedIndex=o,this.selectedItem=i,this.$easycm(t,e)},rightMenuClick(t){"CHECK"==this.rightMenuList[t[0]].type&&this.onAlbumClick(this.selectedIndex)},calImageWidth(){var t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin);t&&(this.itemWidth=t)},onAlbumClick(t){this.selectedItem=this.dataList[t],this.showAlbumDetail=!0,this.pushState()},getClassesList(){this.loading=!0,this.api.post("/api/photoApi/getPhotoClasses",{}).then(t=>{if(!t.code){this.enable=t.enable,this.dataList=t.data;for(let t=0;t<this.dataList.length;t++){var e=this.dataList[t],e=r.a.getImgFullPath(e.photo_index_id,!0);this.dataList[t].url=e}this.dataList.length<1&&this.enable&&this.getDealState(),this.$nextTick(()=>{this.calImageWidth()})}this.loading=!1}).catch(t=>{this.loading=!1})},getDealState(){this.api.post("/api/photoApi/getAiDealState",{hideLoading:!0,type:"cocossd"}).then(t=>{t.code||t.data&&t.data.cocossdWaitDealCount&&(1==t.data.isIndexing?this.dealState=this.$t("photo.indexingNoAi"):t.data.cocossdWaitDealCount&&(this.dealState=this.$t("photo.waitDealCount",{count:t.data.cocossdWaitDealCount}),1<t.data.cocossdWaitDealCount)&&(this.checkStateTimeout=setTimeout(()=>{this.getFaceDealState()},8e3)))}).catch(t=>{})}}};a("60bd");l=Object(h.a)(v,function(){var o=this,t=o.$createElement,s=o._self._c||t;return s("div",{staticClass:"album-root-wrapper"},[s("div",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px",display:"flex","flex-direction":"column","align-items":"center"}},[!o.loading&&o.dataList.length<1?s("my-nodata",{attrs:{title:o.$t("photo.classes")}}):o._e(),o.enable?o._e():s("my-btn",{staticStyle:{"margin-top":"20px"},attrs:{title:o.$t("photo.enableClass")},on:{click:o.enableClass}}),o.enable&&o.dealState?s("div",{staticStyle:{"margin-top":"10px"}},[o._v("["+o._s(o.dealState)+"]")]):o._e()],1),s("div",{staticStyle:{width:"100%",display:"flex",height:"100%","flex-direction":"row",overflow:"hidden"}},[s("div",{ref:"listWrapper",staticClass:"album-list-root"},[o._l(o.dataList,function(e,i){return s("vs-card",{style:{margin:o.itemMargin+"px",width:o.itemWidth+"px"},attrs:{type:"1"},on:{click:function(t){return o.onAlbumClick(i)},contextmenu:function(t){return o.showRightMenu(t,o.$root,e,i)}},scopedSlots:o._u([{key:"title",fn:function(){return["coco_ssd"==e.class_type?s("h3",{staticStyle:{"text-align":"left"}},[o._v(o._s(o.$t("coco."+e.class_name)))]):o._e(),"mobilenet"==e.class_type?s("h3",{staticStyle:{"text-align":"left"}},[o._v(" "+o._s(e.class_name))]):o._e()]},proxy:!0},{key:"img",fn:function(){return[e.url?s("img",{staticStyle:{"object-fit":"cover"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:e.url}}):s("img",{staticStyle:{"object-fit":"cover"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:a("915f")}})]},proxy:!0},{key:"text",fn:function(){return[s("h3",{staticStyle:{"text-align":"left"}},[o._v(o._s())])]},proxy:!0}],null,!0)})}),s("div",{staticStyle:{width:"100%",height:"50px"}})],2)]),s("Modal",{ref:"myModal",attrs:{scrollable:!1,"footer-hide":"","class-name":"modal-style-nopadding",fullscreen:"",closable:!1},model:{value:o.showAlbumDetail,callback:function(t){o.showAlbumDetail=t},expression:"showAlbumDetail"}},[o.showAlbumDetail?s("album-detail",{attrs:{propsShowSearchBtn:!1,propsTitle:o.$t("coco."+o.selectedItem.class_name),propsShowAddToAlbum:!1,propsShowDelete:!1,propsShowModeSwitch:!1,propsAiClassId:o.selectedItem.class_id+""},on:{onClose:function(t){o.showAlbumDetail=!1}}}):o._e()],1),s("easy-cm",{attrs:{list:o.rightMenuList},on:{ecmcb:o.rightMenuClick}})],1)},[],!1,null,"7a0de514",null).exports,v={components:{photoFaces:f.default,photoClasses:l,albumSmart:n,ordinaryAlbumContent:c.default},data(){return{orderField:"id",orderType:"desc",showSettingDialog:!1,menuId:"smartAlbum",menuList:[{title:this.$t("photo.smartAlbum"),id:"smartAlbum"},{title:this.$t("photo.ordinaryAlbum"),id:"ordinaryAlbum"},{title:this.$t("photo.aiFace"),id:"aiFace"},{title:this.$t("photo.aiClasses"),id:"aiClasses"}],settingData:{aiFaceMinPhotoCount:5,aiClassesEnable:!1,aiFaceEnable:!1}}},mounted(){localStorage["photo-my-album-selected-type"]&&(this.menuId=localStorage["photo-my-album-selected-type"],this.$refs.myAlbumMenuSelect.setSelectedId(this.menuId))},beforeDestroy(){},methods:{onClickAdd(){"smartAlbum"==this.menuId?this.$refs.smartAlbum.onClickAdd():"ordinaryAlbum"==this.menuId&&this.$refs.ordinaryAlbum.onClickAdd()},onSearch(t){"smartAlbum"==this.menuId?this.$refs.smartAlbum.onSearch(t):"ordinaryAlbum"==this.menuId&&this.$refs.ordinaryAlbum.onSearch(t)},clickOrder(){"smartAlbum"==this.menuId?this.$refs.smartAlbum.clickOrder(this.orderField,this.orderType):"ordinaryAlbum"==this.menuId&&this.$refs.ordinaryAlbum.clickOrder(this.orderField,this.orderType)},showSetting(){this.showSettingDialog=!0,this.getAllConfig()},onChooseMenu(t){this.menuId=t,localStorage["photo-my-album-selected-type"]=t},resetFaceAi(){this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("setting.aiFaceResetAlert"),()=>{this.api.post("/api/photoApi/resetFaceAi",{}).then(t=>{t.code||this.showVsNotification(this.$t("common.operationSuccess"))})})},saveConfig(){var t={...this.settingData};t.aiClassesEnable=t.aiClassesEnable?"1":"0",t.aiFaceEnable=t.aiFaceEnable?"1":"0",this.api.post("/api/commonApi/saveConfigPhoto",t).then(t=>{this.showVsNotification(this.$t("setting.saveSuccess")),this.showSettingDialog=!1}).catch(t=>{})},getAllConfig(){this.api.post("/api/commonApi/getAllConfig",{keys:["aiClassesEnable","aiFaceEnable"]}).then(e=>{for(let t=0;t<e.data.allConfig.length;t++){var i=e.data.allConfig[t];"aiClassesEnable"==i.title?this.settingData.aiClassesEnable="1"==i.value:"aiFaceEnable"==i.title?this.settingData.aiFaceEnable="1"==i.value:"aiFaceMinPhotoCount"==i.title&&(this.settingData.aiFaceMinPhotoCount=i.value)}}).catch(t=>{})}}};a("8cd3");f=Object(h.a)(v,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"photo-root"},[i("div",{staticStyle:{display:"flex","align-items":"center",width:"100%",padding:"10px 20px",height:"60px","justify-content":"space-between"}},[i("my-menu-select",{ref:"myAlbumMenuSelect",attrs:{optionList:e.menuList},on:{onItemClick:e.onChooseMenu}}),i("div",{staticStyle:{display:"flex","text-align":"right"}},["aiFace"==e.menuId||"aiClasses"==e.menuId?i("div",[i("span",{staticClass:"nasIcons icon-setting-system",staticStyle:{"font-size":"25px",color:"#999999"},on:{click:e.showSetting}})]):e._e(),"smartAlbum"==e.menuId||"ordinaryAlbum"==e.menuId?i("div",{staticStyle:{"margin-left":"10px",display:"flex","align-items":"center"}},[i("span",{staticClass:"nasIcons icon-add operation-icon",on:{click:function(t){return e.onClickAdd()}}})]):e._e(),"smartAlbum"==e.menuId||"ordinaryAlbum"==e.menuId?i("div",{staticStyle:{"margin-left":"10px",display:"flex","align-items":"center"}},[i("Poptip",{attrs:{placement:"bottom"},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"sort-root"},[i("div",[e._v(e._s(e.$t("common.sortField")))]),i("RadioGroup",{staticStyle:{"margin-top":"5px"},attrs:{vertical:""},on:{"on-change":e.clickOrder},model:{value:e.orderField,callback:function(t){e.orderField=t},expression:"orderField"}},[i("Radio",{attrs:{label:"name"}},[i("span",[e._v(e._s(e.$t("common.name")))])]),i("Radio",{attrs:{label:"id"}},[i("span",[e._v(e._s(e.$t("movie.createTime")))])])],1),i("div",{staticStyle:{"margin-top":"15px"}},[e._v(e._s(e.$t("common.sortType")))]),i("RadioGroup",{staticStyle:{"margin-top":"5px"},attrs:{vertical:""},on:{"on-change":e.clickOrder},model:{value:e.orderType,callback:function(t){e.orderType=t},expression:"orderType"}},[i("Radio",{attrs:{label:"asc"}},[i("span",[e._v(e._s(e.$t("common.asc")))])]),i("Radio",{attrs:{label:"desc"}},[i("span",[e._v(e._s(e.$t("common.desc")))])])],1)],1)]},proxy:!0}],null,!1,2712173160)},["asc"==e.orderType?i("span",{staticClass:"nasIcons icon-sort-alpha-up operation-icon"}):e._e(),"desc"==e.orderType?i("span",{staticClass:"nasIcons icon-sort-alpha-down-alt operation-icon"}):e._e()])],1):e._e(),"smartAlbum"==e.menuId||"ordinaryAlbum"==e.menuId?i("div",{staticStyle:{"margin-left":"10px"}},[i("my-search",{ref:"mySearch",staticStyle:{"max-width":"200px"},attrs:{shrinkModeTh:800,placeholder:e.$t("common.pleaseInputSearchContent")},on:{onSearch:e.onSearch}})],1):e._e()])],1),"smartAlbum"==e.menuId?i("album-smart",{ref:"smartAlbum"}):e._e(),"ordinaryAlbum"==e.menuId?i("ordinaryAlbumContent",{ref:"ordinaryAlbum"}):e._e(),"aiFace"==e.menuId?i("photo-faces"):e._e(),"aiClasses"==e.menuId?i("photo-classes"):e._e(),i("vs-dialog",{scopedSlots:e._u([{key:"header",fn:function(){return[i("h4",{staticClass:"not-margin"},[e._v(" "+e._s(e.$t("setting.photoFuncsSetting"))+" ")])]},proxy:!0},{key:"footer",fn:function(){return[i("div",{staticStyle:{width:"100%","padding-top":"10px","padding-bottom":"10px"},on:{click:e.saveConfig}},[i("my-btn",{staticStyle:{width:"80%"},attrs:{title:e.$t("common.commit")}})],1)]},proxy:!0}]),model:{value:e.showSettingDialog,callback:function(t){e.showSettingDialog=t},expression:"showSettingDialog"}},[i("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column","align-items":"center"}},[i("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","margin-top":"20px","justify-content":"flex-start",width:"100%"}},[i("div",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.$t("photo.aiClasses")))]),i("i-switch",{model:{value:e.settingData.aiClassesEnable,callback:function(t){e.$set(e.settingData,"aiClassesEnable",t)},expression:"settingData.aiClassesEnable"}})],1)]),i("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column","align-items":"center"}},[i("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","margin-top":"20px","justify-content":"flex-start",width:"100%"}},[i("div",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.$t("photo.aiFace")))]),i("i-switch",{model:{value:e.settingData.aiFaceEnable,callback:function(t){e.$set(e.settingData,"aiFaceEnable",t)},expression:"settingData.aiFaceEnable"}}),i("vs-button",{staticStyle:{height:"25px","line-height":"25px","flex-shrink":"0","min-width":"60px","margin-left":"10px","z-index":"0"},attrs:{flat:"",border:""},on:{click:function(t){return e.resetFaceAi()}}},[e._v(" "+e._s(e.$t("Reset")))])],1)]),i("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column","align-items":"center"}},[i("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","margin-top":"20px","justify-content":"flex-start",width:"100%"}},[i("div",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.$t("photo.aiFaceMinPhotoCount")))]),i("Input",{staticStyle:{width:"50px"},attrs:{type:"number",clearable:""},model:{value:e.settingData.aiFaceMinPhotoCount,callback:function(t){e.$set(e.settingData,"aiFaceMinPhotoCount",t)},expression:"settingData.aiFaceMinPhotoCount"}})],1)])])],1)},[],!1,null,"4c535d0a",null).exports,l={props:{pageSize:{type:Number,default:5}},components:{photoDetail:u.default},data(){return{dealState:"",rightMenuList:[{text:this.$t("file.check"),type:"CHECK"}],showPhotoDetail:!1,changeAlbumName:"",itemBaseWidth:220,itemWidth:220,itemMargin:10,selectedItem:"",showAddAlbum:!1,dataList:[],loading:!1,selectedIndex:!1,enable:!0,checkStateTimeout:null,waitDealCount:0}},mounted(){this.getDealList(),window.addEventListener("resize",this.calImageWidth),window.addEventListener("popstate",this.onPopstate)},beforeDestroy(){window.removeEventListener("resize",this.calImageWidth),window.removeEventListener("popstate",this.onPopstate),clearTimeout(this.checkStateTimeout)},methods:{checkImage(t,e){this.showPhotoDetail=!0;let i=this.dataList[t].similarIndexList;for(var o in i)i[o].type=1;this.$nextTick(()=>{this.$refs.photoDetail.showImg(i,e)}),this.pushState()},nameClick(t,e){this.dataList[t].similarIndexList[e].checked=!this.dataList[t].similarIndexList[e].checked,this.$forceUpdate()},onPopstate(){this.showPhotoDetail?(this.$refs.photoDetail.closeGallery(),this.showPhotoDetail=!1):this.$router.go(-1)},enableSimilarPhoto(){this.api.post("/api/commonApi/saveConfigPhoto",{aiSimilarPhotoEnable:"1"}).then(t=>{this.getDealList()}).catch(t=>{})},rightMenuClick(t){"CHECK"==this.rightMenuList[t[0]].type&&this.onAlbumClick(this.selectedIndex)},calImageWidth(){var t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin);t&&(this.itemWidth=t)},getDealList(){this.loading=!0,this.api.post("/api/photoApi/getSimilarPhoto",{count:this.pageSize}).then(t=>{if(!t.code){this.enable=t.enable,this.dataList=t.data,this.waitDealCount=t.waitDealCount-this.dataList.length;for(let o=0;o<this.dataList.length;o++){let t=this.dataList[o],e=0,i=0;for(var s in t.similarIndexList){var a=r.a.getImgFullPath(this.dataList[o].similarIndexList[s].id,!0)+"&ts="+(new Date).getTime();this.dataList[o].similarIndexList[s].url=a,this.dataList[o].similarIndexList[s].size>i&&(i=this.dataList[o].similarIndexList[s].size,e=s)}for(var n in t.similarIndexList)this.dataList[o].similarIndexList[n].checked=e==n;this.dataList;var l=r.a.getImgFullPath(t.indexObj.id,!0);this.dataList[o].indexObj.url=l,this.$nextTick(()=>{this.calImageWidth()})}this.dataList.length<1&&this.enable&&this.getDealState()}this.loading=!1}).catch(t=>{this.loading=!1})},dealSimilarPhotoApi(t){this.dataList;var e,i=[];for(e in this.dataList){var o,s=[];for(o in this.dataList[e].similarIndexList)(t||this.dataList[e].similarIndexList[o].checked)&&s.push(this.dataList[e].similarIndexList[o].id);i.push({index_id:this.dataList[e].index_id,keepIndexList:s})}this.api.post("/api/photoApi/dealSimilarPhoto",{dealList:i}).then(t=>{t.code||(this.showVsNotification(this.$t("common.operationSuccess")),this.$refs.listWrapper.scrollTo({top:0}),this.getDealList())}).catch(t=>{})},getDealState(){this.api.post("/api/photoApi/getAiDealState",{hideLoading:!0,type:"similar"}).then(t=>{t.code||t.data&&t.data.similarWaitDealCount&&(1==t.data.isIndexing?this.dealState=this.$t("photo.indexingNoAi"):t.data.similarWaitDealCount&&(this.dealState=this.$t("photo.waitDealCount",{count:t.data.similarWaitDealCount}),1<t.data.similarWaitDealCount)&&(this.checkStateTimeout=setTimeout(()=>{this.getDealState()},8e3)))}).catch(t=>{})}}};a("a9d1");var v=Object(h.a)(l,function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"root-wrapper"},[a("div",{staticStyle:{"z-index":"2",position:"absolute",width:"100%","margin-top":"150px",display:"flex","flex-direction":"column","align-items":"center"}},[!s.loading&&s.dataList.length<1?a("my-nodata",{attrs:{title:s.$t("photo.noSimilarPhoto")}}):s._e(),s.enable?s._e():a("div",{on:{click:function(t){return s.enableSimilarPhoto()}}},[a("my-btn",{staticStyle:{"margin-top":"20px"},attrs:{title:s.$t("photo.enableSimilarPhoto")}})],1),s.enable&&s.dealState?a("div",{staticStyle:{"margin-top":"10px"}},[s._v("["+s._s(s.dealState)+"]")]):s._e()],1),a("div",{ref:"listWrapper",staticClass:"list-root"},[s._l(s.dataList,function(t,o){return a("div",{staticClass:"list-item-root"},[a("div",{staticStyle:{width:"100%","text-align":"left","font-size":"18px","margin-bottom":"10px","margin-top":"10px","font-weight":"bold"}},[s._v(" "+s._s(o+1+"."+s.$t("photo.checkKeepPhoto")))]),s._l(t.similarIndexList,function(e,i){return a("div",{staticClass:"item-div"},[a("img",{staticClass:"item-img",attrs:{src:e.url},on:{click:function(t){return s.checkImage(o,i)}}}),a("div",{staticStyle:{"margin-top":"10px",display:"flex","flex-direction":"column"},on:{click:function(t){return s.nameClick(o,i)}}},[a("div",{staticClass:"max-line-one",staticStyle:{"text-align":"left"}},[s._v(s._s(s.$t("common.folder"))+": "+s._s(e.path))]),a("div",{staticClass:"max-line-one",staticStyle:{"text-align":"left"}},[s._v(s._s(s.$t("common.name"))+": "+s._s(e.filename))]),a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("Checkbox",{model:{value:e.checked,callback:function(t){s.$set(e,"checked",t)},expression:"similarItem.checked"}}),a("span",{staticStyle:{color:"#999999"}},[s._v(s._s(s.utils.getSizeStr(e.size)))])],1)])])})],2)}),0<s.dataList.length?a("div",{staticStyle:{width:"100%",height:"200px"}},[a("div",{staticStyle:{"padding-top":"20px"}},[s._v(s._s(s.$t("photo.leftSimilarGroupCount",{count:s.waitDealCount})))])]):s._e()],2),0<s.dataList.length?a("div",{staticClass:"bottom-root"},[a("div",{on:{click:function(t){return t.stopPropagation(),s.dealSimilarPhotoApi(!0)}}},[a("my-btn",{attrs:{title:s.$t("photo.keepAll")}})],1),a("div",{on:{click:function(t){return t.stopPropagation(),s.dealSimilarPhotoApi(!1)}}},[a("my-btn",{staticStyle:{"margin-left":"10px"},attrs:{type:"red",title:s.$t("photo.moveSimilarToTrash")}})],1)]):s._e(),a("easy-cm",{attrs:{list:s.rightMenuList},on:{ecmcb:s.rightMenuClick}}),s.showPhotoDetail?a("photo-detail",{ref:"photoDetail",attrs:{enableExif:!1},on:{onClose:function(t){s.showPhotoDetail=!1}}}):s._e()],1)},[],!1,null,"7222de28",null).exports,l=a("f047"),w=a("e11e"),b=a.n(w);a("6cc5");w={props:{},components:{VueHorizontal:l.a,photoDetail:u.default},data(){return{currentTilesServer:"",isSelectedAll:!0,locationStr:"",currentLatitude:null,currentLongitude:null,placeList:[],placeStr:"",map:null,imgMaker:null,showPhotoDetail:!1,dealList:[],loading:!1,nearIndex:null,useNearIndex:-1}},mounted(){this.getWaitAddGpsIndex()},beforeDestroy(){},methods:{usePreNearIndex(){!this.nearIndex&&this.nearIndex.length<1||(0==this.useNearIndex?this.useNearIndex=this.nearIndex.length-1:--this.useNearIndex,this.map&&this.nearIndex&&0<this.nearIndex.length&&this.addMarker(this.nearIndex[this.useNearIndex].latitude,this.nearIndex[this.useNearIndex].longitude))},useNextNearIndex(){!this.nearIndex&&this.nearIndex.length<1||(this.useNearIndex>=this.nearIndex.length-1?this.useNearIndex=0:this.useNearIndex+=1,this.map&&this.nearIndex&&0<this.nearIndex.length&&this.addMarker(this.nearIndex[this.useNearIndex].latitude,this.nearIndex[this.useNearIndex].longitude))},onSelectAllChange(t){for(var e in this.dealList)this.dealList[e].selected=t},onItemSelect(t){},changeSelect(t,e){this.dealList[t].selected=e,this.$forceUpdate()},skipList(){this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.sureSkipAddGps"),()=>{this.confirmAddGps("SKIP")})},confirmList(){this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.sureAddGps"),()=>{this.confirmAddGps("CONFIRM")})},confirmAddGps(e){if(this.dealList.length<1)return this.showVsNotification(this.$t("photo.noPendingPhotos"));var t,i=[];for(t in this.dealList)this.dealList[t].selected&&i.push(this.dealList[t].id);this.api.post("/api/addGpsApi/confirmAddGps",{type:e,latitude:this.currentLatitude,longitude:this.currentLongitude,indexIdList:i,hideLoading:!0}).then(t=>{t.code||("CONFIRM"==e?(this.showVsNotification(this.$t("photo.gpsAddSuccess")),setTimeout(()=>{this.getWaitAddGpsIndex()},500)):this.getWaitAddGpsIndex())}).catch(t=>{})},getOptionStr(t){return t.cn_name+" "+t.name},onSearchSelect(t){for(var e in this.placeList)if(t==this.getOptionStr(this.placeList[e]))return void this.addMarker(this.placeList[e].latitude,this.placeList[e].longitude)},onPhotoClick(t){this.showPhotoDetail=!0,this.$nextTick(()=>{this.$refs.photoDetail.showImg(this.dealList,t)})},onUsePhotoClick(){this.showPhotoDetail=!0,this.$nextTick(()=>{this.$refs.photoDetail.showImg([this.nearIndex[this.useNearIndex]],0)})},getLocationStr(){this.api.post("/api/mapApi/getLocationStr",{lat:this.currentLatitude,lng:this.currentLongitude,hideLoading:!0}).then(t=>{t.code||(this.locationStr=this.getOptionStr(t.geo))}).catch(t=>{})},searchPlace(t){(t=t.trim())&&this.api.post("/api/mapApi/searchLocation",{searchStr:t,count:15,hideLoading:!0}).then(t=>{t.code||(this.placeList=t.data)}).catch(t=>{})},resetPosition(){this.map&&this.nearIndex&&0<this.nearIndex.length&&this.addMarker(this.nearIndex[0].latitude,this.nearIndex[0].longitude)},addMarker(t,e){this.imgMaker&&this.map.removeLayer(this.imgMaker);var i=b.a.icon({iconUrl:"icon_position.png",iconSize:[38,38]}),o=this.utils.transCoordinateForShow(this.currentTilesServer,e,t);this.imgMaker=b.a.marker([o[1],o[0]],{icon:i}),this.map&&(this.currentLatitude=t,this.currentLongitude=e,this.getLocationStr(),this.imgMaker.addTo(this.map),o=new b.a.LatLng(t,e),this.map.flyTo(o))},initMap(t,e){var i,o,s,a;!this.nearIndex||this.nearIndex.length<1||(i=this.nearIndex[0],this.useNearIndex=0,a=this.axios.mapUrl(),o=new b.a.LatLng(i.latitude,i.longitude),s=parseInt(e/2),a=new b.a.TileLayer(a,{minZoom:t,maxZoom:e,attribution:"NORMAL"}),t=b.a.latLng(-90,-360),e=b.a.latLng(90,360),t={maxBounds:b.a.latLngBounds(t,e),zoom:s,center:o,layers:[a],attributionControl:!1},this.map&&(this.map.remove(),this.map=null),this.map=new b.a.Map("positionMap",t),this.map.on("click",t=>{this.addMarker(t.latlng.lat,t.latlng.lng)}),this.addMarker(i.latitude,i.longitude))},getZoomInfo(){this.api.post("/api/mapApi/getZoom",{hideLoading:!0}).then(t=>{t.code||(t.tileServer&&(this.currentTilesServer=t.tileServer),this.initMap(parseInt(t.zoomInfo.minZoom),parseInt(t.zoomInfo.maxZoom)))}).catch(t=>{})},getWaitAddGpsIndex(){this.loading=!0,this.dealList=[],this.locationStr="",this.api.post("/api/addGpsApi/getWaitAddGpsIndex",{}).then(t=>{if(this.loading=!1,!t.code){if(!t.data.dealList)return this.showVsAlertDialog(this.$t("common.alert"),this.$t("photo.noPendingPhotos"));for(var e in this.nearIndex=t.data.nearIndex,this.dealList=t.data.dealList,this.nearIndex){var i=this.nearIndex[e];this.nearIndex[e].url=this.axios.getImgFullPath(i.id,!0,i.filename),this.nearIndex[e].rawUrl=this.axios.getImgFullPath(i.id,!1,i.filename),this.nearIndex[e].selected=0==e}for(var o in this.dealList){var s=this.dealList[o];this.dealList[o].url=this.axios.getImgFullPath(s.id,!0,s.filename),this.dealList[o].rawUrl=this.axios.getImgFullPath(s.id,!1,s.filename),this.dealList[o].selected=!0}this.$nextTick(()=>{this.getZoomInfo()})}}).catch(t=>{this.loading=!1})}}};a("ed90");l={components:{photoSimilar:v,addGps:Object(h.a)(w,function(){var o=this,t=o.$createElement,s=o._self._c||t;return s("div",{staticClass:"root"},[o.dealList&&0<o.dealList.length?s("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[s("p",{staticClass:"title"},[o._v(o._s(o.$t("photo.dealListForAddGps"))+":")]),s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("Checkbox",{on:{"on-change":o.onSelectAllChange},model:{value:o.isSelectedAll,callback:function(t){o.isSelectedAll=t},expression:"isSelectedAll"}},[o._v(o._s(o.$t("common.selectAll")))]),s("a",{on:{click:function(t){o.showVsAlertDialog(o.$t("help.howToWork"),o.$t("help.addGpsHelp"))}}},[s("span",[o._v(o._s(o.$t("common.help")))]),s("Icon",{staticStyle:{"font-weight":"bold",cursor:"pointer"},attrs:{type:"ios-help-circle-outline"}})],1)],1)]):o._e(),s("div",{staticClass:"top"},[o.dealList.length<1&&!o.loading?s("div",{staticStyle:{"margin-top":"20px"}},[o._v(o._s(o.$t("photo.noCanAddGpsPhoto"))+" "),s("a",{on:{click:function(t){o.showVsAlertDialog(o.$t("help.howToWork"),o.$t("help.addGpsHelp"))}}},[s("span",[o._v(o._s(o.$t("common.help")))]),s("Icon",{staticStyle:{"font-weight":"bold",cursor:"pointer"},attrs:{type:"ios-help-circle-outline"}})],1)]):o._e(),s("div",{staticClass:"photo-list"},o._l(o.dealList,function(e,i){return s("div",{staticClass:"photo-root"},[s("img",{staticClass:"photo-img",attrs:{src:e.url},on:{click:function(t){return o.onPhotoClick(i)}}}),s("p",{staticClass:"max-line-two",staticStyle:{"margin-top":"5px","word-break":"break-all"}},[o._v(" "+o._s(e.filename)+" ")]),e&&e.original_time?s("div",{staticStyle:{color:"grey","font-size":"12px"}},[o._v(" "+o._s(o.utils.formatTimeStamp(e.original_time)))]):o._e(),s("Checkbox",{staticStyle:{position:"absolute",top:"5px",right:"5px"},on:{"on-change":o.onItemSelect},model:{value:e.selected,callback:function(t){o.$set(e,"selected",t)},expression:"item.selected"}})],1)}),0)]),o.dealList&&0<o.dealList.length?s("Divider",{staticStyle:{"background-color":"#bbb",margin:"10px 0"}}):o._e(),0<o.dealList.length?s("div",{staticClass:"bottom-root"},[s("div",{staticClass:"bottom-left"},[s("p",{staticClass:"title"},[o._v(o._s(o.$t("photo.confirmPhotoLocation")))]),s("div",{staticClass:"map-root"},[s("div",{staticClass:"positionMap",attrs:{id:"positionMap"}}),s("div",{staticStyle:{display:"flex","flex-direction":"column",position:"absolute",right:"10px",top:"10px","z-index":"400","background-color":"rgba(255,255,255,0.5)",padding:"10px"}},[s("p",{staticStyle:{"text-align":"left"}},[o._v("["+o._s(o.locationStr)+"]")]),s("div",{staticStyle:{"text-align":"left"}},[o._v(o._s(o.$t("useWhitePhotoGps"))+":")]),s("div",{staticStyle:{display:"flex","align-items":"center",position:"relative"}},[o.nearIndex&&-1<o.useNearIndex?s("img",{class:{"use-photo-img":o.isMobile,"use-photo-img-pc":!o.isMobile},attrs:{src:o.nearIndex[o.useNearIndex].url},on:{click:function(t){return o.onUsePhotoClick()}}}):o._e(),s("div",{staticStyle:{position:"absolute",right:"5px",bottom:"5px",display:"flex"}},[s("Button",{staticStyle:{"margin-right":"5px"},attrs:{shape:"circle",icon:"md-arrow-dropleft"},on:{click:o.usePreNearIndex}}),s("Button",{attrs:{shape:"circle",icon:"md-arrow-dropright"},on:{click:o.useNextNearIndex}})],1),s("div",{staticClass:"number-root"},[s("span",{staticStyle:{color:"white","font-size":"10px"}},[o._v(o._s(o.useNearIndex+1)+"/")]),s("span",{staticStyle:{color:"white","font-size":"10px"}},[o._v(o._s(o.nearIndex.length))])]),s("div",{staticClass:"date-root"},[o.nearIndex[o.useNearIndex]&&o.nearIndex[o.useNearIndex].original_time?s("div",{staticStyle:{color:"white","font-size":"10px"}},[o._v(" "+o._s(o.utils.formatTimeStamp(o.nearIndex[o.useNearIndex].original_time)))]):o._e()])]),s("Button",{staticClass:"btn-item",staticStyle:{"margin-top":"20px"},attrs:{icon:"md-sync"},on:{click:o.resetPosition}},[o._v(o._s(o.$t("photo.restorePosition")))]),s("Button",{staticClass:"btn-item",attrs:{type:"warning",icon:"md-fastforward"},on:{click:o.skipList}},[o._v(o._s(o.$t("photo.skipAddGps")))]),s("Button",{staticClass:"btn-item",attrs:{type:"primary",icon:"md-pin"},on:{click:o.confirmList}},[o._v(o._s(o.$t("photo.wirteGps")))])],1)])])]):o._e(),o.showPhotoDetail?s("photo-detail",{ref:"photoDetail",on:{onClose:function(t){o.showPhotoDetail=!1}}}):o._e()],1)},[],!1,null,"7068f347",null).exports},data(){return{similarPageSize:5,showSettingDialog:!1,menuId:"1",menuList:[{title:this.$t("photo.aiSimilarPhoto"),id:"1"},{title:this.$t("photo.gpsAdd"),id:"2"}],settingData:{aiSimilarPhotoEnable:!1}}},mounted(){},beforeDestroy(){},methods:{onSimilarPageSizeChange(t){this.similarPageSize=t,this.$nextTick(function(){this.$refs.photoSimilar.getDealList()})},showSetting(){this.showSettingDialog=!0,this.getAllConfig()},onChooseMenu(t){this.menuId=t},resetSimilarPhotoAi(){this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("setting.similarPhotoResetAlert"),()=>{this.api.post("/api/photoApi/resetSimilarPhotoAi",{}).then(t=>{t.code||this.showVsNotification(this.$t("common.operationSuccess"))})})},saveConfig(){var t={...this.settingData};t.aiSimilarPhotoEnable=t.aiSimilarPhotoEnable?"1":"0",this.api.post("/api/commonApi/saveConfigPhoto",t).then(t=>{this.showVsNotification(this.$t("setting.saveSuccess")),this.showSettingDialog=!1}).catch(t=>{})},getAllConfig(){this.api.post("/api/commonApi/getAllConfig",{keys:["aiSimilarPhotoEnable"]}).then(e=>{for(let t=0;t<e.data.allConfig.length;t++){var i=e.data.allConfig[t];"aiSimilarPhotoEnable"==i.title&&(this.settingData.aiSimilarPhotoEnable="1"==i.value)}}).catch(t=>{})}}};a("0aba");u=Object(h.a)(l,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"photo-root"},[i("div",{staticStyle:{display:"flex","align-items":"center",width:"100%",padding:"20px",height:"60px"}},[i("my-menu-select",{attrs:{shrinkModeTh:300,optionList:e.menuList},on:{onItemClick:e.onChooseMenu}}),"1"==e.menuId?i("Select",{staticStyle:{width:"100px","margin-left":"10px"},on:{"on-change":e.onSimilarPageSizeChange},model:{value:e.similarPageSize,callback:function(t){e.similarPageSize=t},expression:"similarPageSize"}},[i("Option",{key:5,attrs:{value:5}},[e._v(e._s(e.$t("pageCount",{count:"5"})))]),i("Option",{key:10,attrs:{value:10}},[e._v(e._s(e.$t("pageCount",{count:"10"})))]),i("Option",{key:20,attrs:{value:20}},[e._v(e._s(e.$t("pageCount",{count:"20"})))]),i("Option",{key:50,attrs:{value:50}},[e._v(e._s(e.$t("pageCount",{count:"50"})))]),i("Option",{key:100,attrs:{value:100}},[e._v(e._s(e.$t("pageCount",{count:"100"})))])],1):e._e(),i("div",{staticStyle:{flex:"1","text-align":"right"}},[i("span",{staticClass:"nasIcons icon-setting-system",staticStyle:{"font-size":"25px",color:"#999999"},on:{click:e.showSetting}})])],1),"1"==e.menuId?i("photo-similar",{ref:"photoSimilar",attrs:{pageSize:e.similarPageSize}}):e._e(),"2"==e.menuId?i("addGps"):e._e(),i("vs-dialog",{scopedSlots:e._u([{key:"header",fn:function(){return[i("h4",{staticClass:"not-margin"},[e._v(" "+e._s(e.$t("setting.photoFuncsSetting"))+" ")])]},proxy:!0},{key:"footer",fn:function(){return[i("div",{staticStyle:{width:"100%","padding-top":"10px","padding-bottom":"10px"},on:{click:e.saveConfig}},[i("my-btn",{staticStyle:{width:"80%"},attrs:{title:e.$t("common.commit")}})],1)]},proxy:!0}]),model:{value:e.showSettingDialog,callback:function(t){e.showSettingDialog=t},expression:"showSettingDialog"}},[i("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column","align-items":"center"}},[i("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","margin-top":"20px","justify-content":"flex-start",width:"100%"}},[i("div",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.$t("photo.aiSimilarPhoto")))]),i("i-switch",{model:{value:e.settingData.aiSimilarPhotoEnable,callback:function(t){e.$set(e.settingData,"aiSimilarPhotoEnable",t)},expression:"settingData.aiSimilarPhotoEnable"}}),i("vs-button",{staticStyle:{height:"25px","line-height":"25px","flex-shrink":"0","min-width":"60px","margin-left":"10px","z-index":"0"},attrs:{flat:"",border:""},on:{click:function(t){return e.resetSimilarPhotoAi()}}},[e._v(" "+e._s(e.$t("Reset")))])],1)])])],1)},[],!1,null,"4a2e5f64",null).exports,v={props:{hasPadding:{default:!1,type:Boolean}},mounted(){this.getAllConfig()},components:{},data(){return{sizeOptionList:[{label:2e3},{label:3e3},{label:4e3},{label:5e3},{label:6e3},{label:7e3},{label:8e3}],settingData:{photoPreviewType:"RAW",photoPreviewSize:3e3}}},computed:{},methods:{saveConfigApi(t,e){this.api.post("/api/commonApi/saveConfigPhoto",t).then(t=>{this.showVsNotification(this.$t("setting.saveSuccessRestartValid")),e&&e(),localStorage.imagePreviewType=this.settingData.photoPreviewType,localStorage.imagePreviewSize=this.settingData.photoPreviewSize}).catch(t=>{})},saveConfig(t){var e={...this.settingData};this.saveConfigApi(e,t)},getAllConfig(){this.api.post("/api/commonApi/getAllConfig",{keys:["photoPreviewType","photoPreviewSize"]}).then(e=>{for(let t=0;t<e.data.allConfig.length;t++){var i=e.data.allConfig[t];"photoPreviewType"==i.title?this.settingData.photoPreviewType=i.value||"RAW":"photoPreviewSize"==i.title&&(this.settingData.photoPreviewSize=parseInt(i.value||"3000"))}}).catch(t=>{})}}};a("966f");w=Object(h.a)(v,function(){var i=this,t=i.$createElement,o=i._self._c||t;return o("div",{staticClass:"setting-root-wrapper",class:{"setting-padding":i.hasPadding}},[o("div",{staticClass:"common-setting-root",attrs:{id:"setting-wrapper"}},[o("div",{staticClass:"item-root-wrapper"},[o("Divider",{attrs:{plain:""}},[i._v(i._s(i.$t("imgPreviewSize")))]),o("div",{staticClass:"item-root-margin"},[o("div",{staticStyle:{"margin-right":"20px"}},[i._v(i._s(i.$t("imgPreviewSize"))+":")]),o("RadioGroup",{model:{value:i.settingData.photoPreviewType,callback:function(t){i.$set(i.settingData,"photoPreviewType",t)},expression:"settingData.photoPreviewType"}},[o("Radio",{attrs:{label:"RAW"}},[o("span",[i._v(i._s(i.$t("rawFile")))])]),o("Radio",{attrs:{label:"CUSTOM"}},[o("span",[i._v(i._s(i.$t("Custom")))])])],1)],1),"CUSTOM"==i.settingData.photoPreviewType?o("div",{staticClass:"item-root-margin"},[o("div",{staticStyle:{"margin-right":"20px"}},[i._v(i._s(i.$t("longSideMaxPx"))+":")]),o("Select",{staticStyle:{width:"120px"},model:{value:i.settingData.photoPreviewSize,callback:function(t){i.$set(i.settingData,"photoPreviewSize",t)},expression:"settingData.photoPreviewSize"}},i._l(i.sizeOptionList,function(t,e){return o("Option",{key:e,attrs:{value:t.label}},[i._v(i._s(t.label)+" ")])}),1)],1):i._e(),o("p",{staticClass:"preview_alert"},[i._v(i._s(i.$t("imgPreviewAlert")))])],1)]),o("div",{staticClass:"bottom-root"},[o("my-btn",{staticStyle:{"min-width":"260px"},attrs:{title:i.$t("common.commit")},on:{click:i.saveConfig}})],1)])},[],!1,null,"f1e9f082",null).exports,l={props:{},components:{photoTimelineContent:o.default,photoMapContent:s.default,myHeader:i.a,albumSmart:n,ordinaryAlbum:c.default,libraryPage:d.a,folderView:p.a,photoRecent:y,photoTrash:g,photoSourceSet:m,photoMyAlbum:f,photoTools:u,photoSetting:w},mounted(){let t=!1;if(localStorage.photoViewType)for(var e in this.sideOptionList)if(this.sideOptionList[e].id==localStorage.photoViewType){this.viewType=localStorage.photoViewType,t=!0,this.$refs.sidebarMobile&&this.$refs.sidebarMobile.setIndex(e),this.$refs.sidebar&&this.$refs.sidebar.setIndex(e);break}t||(this.viewType="photoTimeline")},data(){return{viewType:"",sideOptionList:[{id:"photoTimeline",title:this.$t("photo.timeline"),font:"nasIcons icon-timeline"},{id:"photoMap",title:this.$t("photo.footprint"),font:"nasIcons icon-footprint"},{id:"photoMyAlbum",title:this.$t("photo.myAlbum"),font:"nasIcons icon-face-detect"},{id:"photoLibrary",title:this.$t("photo.library"),font:"nasIcons icon-ziliaoku"},{id:"photoFolderView",title:this.$t("photo.folder"),font:"nasIcons icon-folder-iew"},{id:"photoTools",title:this.$t("photo.tools"),font:"nasIcons icon-tools",onlyAdmin:!0},{id:"photoRecent",title:this.$t("photo.recentCheck"),font:"nasIcons icon-recent"},{id:"photoTrash",title:this.$t("file.trashBin"),font:"nasIcons icon-trash"},{id:"photoSetting",title:this.$t("setting"),font:"nasIcons icon-setting-system"},{id:"photoSourceSet",title:this.$t("setting.photoSourceSetting"),font:"nasIcons icon-24gf-folderPlus",onlyAdmin:!0}]}},computed:{},methods:{setViewType(t){this.viewType=t,this.$refs.sidebar.setSelectById(t),this.$refs.sidebarMobile.setSelectById(t),this.viewType},setLeftMenuId(t){t=t.id;this.viewType=t,window.localStorage.photoViewType=t}}},a("76e3"),v=Object(h.a)(l,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticClass:"photos-root"},[e("my-bg"),t._m(0),e("div",{staticClass:"nas-mobile-none"},[e("my-header")],1),e("div",{staticClass:"main-layout nas-padding-right-zero"},[e("div",{staticClass:"sidebar-root"},[e("my-sidebar",{ref:"sidebar",attrs:{name:"photo",optionList:t.sideOptionList},on:{onItemClick:t.setLeftMenuId}})],1),e("div",{staticClass:"sidebar-mobile-root"},[e("my-sidebar-mobile",{ref:"sidebarMobile",attrs:{name:"photo",optionList:t.sideOptionList},on:{onItemClick:t.setLeftMenuId}})],1),e("div",{staticClass:"right-layout"},["photoTimeline"==t.viewType?e("photo-timeline-content",{on:{setViewType:t.setViewType}}):t._e(),"photoMap"==t.viewType?e("photo-map-content",{on:{setViewType:t.setViewType}}):t._e(),"albumSmart"==t.viewType?e("album-smart",{on:{setViewType:t.setViewType}}):t._e(),"ordinaryAlbum"==t.viewType?e("ordinary-album",{on:{setViewType:t.setViewType}}):t._e(),"photoLibrary"==t.viewType?e("library-page",{attrs:{isPhotoLibrary:!0},on:{setViewType:t.setViewType}}):t._e(),"photoFolderView"==t.viewType?e("folder-view",{on:{setViewType:t.setViewType}}):t._e(),"photoRecent"==t.viewType?e("photo-recent",{on:{setViewType:t.setViewType}}):t._e(),"photoTrash"==t.viewType?e("photo-trash",{on:{setViewType:t.setViewType}}):t._e(),"photoSourceSet"==t.viewType?e("photo-source-set",{on:{setViewType:t.setViewType}}):t._e(),"photoSetting"==t.viewType?e("photo-setting",{on:{setViewType:t.setViewType}}):t._e(),"photoMyAlbum"==t.viewType?e("photo-my-album",{on:{setViewType:t.setViewType}}):t._e(),"photoTools"==t.viewType?e("photo-tools",{on:{setViewType:t.setViewType}}):t._e()],1)])],1)},[function(){var t=this.$createElement,t=this._self._c||t;return t("div",{staticClass:"nas-mobile-none"},[t("p",{staticClass:"my-header-position"})])}],!1,null,"6901c51a",null);e.default=v.exports},ed90:function(t,e,i){"use strict";i("167d")},f04d:function(t,e,i){}}]);