(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-58f359e0"],{"0bb0":function(t,e,i){i("8ec8")},"0bd4":function(t,e,i){i.r(e),i("d81d"),i("b0c0"),i("e9f5"),i("ab43"),i("d3b7");i("99af"),i("4e82"),i("e9c4"),i("e25e"),i("4d90");var o=i("e11e"),d=i.n(o),u=(i("6cc5"),i("be3b")),o=i("8fad"),o={name:"photoMap",props:{borderRadius:{default:"15px",type:String},albumId:{default:"",Type:String},libraryId:{default:"",Type:String},ordinaryAlbumId:{default:"",Type:String}},components:{albumDetail:o.default},data:function(){return{showAddServerModal:!1,newTileServer:{name:"",server:"",coordinate:"WGS-84",maxLevel:18},coordinateOptions:[{value:"WGS-84",label:"WGS-84"},{value:"GCJ-02",label:"GCJ-02"},{value:"BD-09",label:"BD-09"}],showSwitchMapModal:!1,tileServerList:[],currentTilesServer:"",albumFirstPhoto:null,showPhotoGeo:!1,map:null,markerGroup:null,clickGeohash:null,selectPositionStr:"",currentMaxZoom:8,moveTimer:null}},mounted:function(){this.getZoomInfo()},beforeDestroy:function(){},methods:{openAddServer:function(){this.newTileServer={name:"",server:"",coordinate:"WGS-84",maxLevel:18},this.showAddServerModal=!0},handleDeleteServer:function(t){var e=this;this.$Modal.confirm({title:this.$t("common.alert"),content:this.$t("common.deleteSure"),onOk:function(){e.api.post("/api/mapApi/deleteTileServer",{tileServerJson:JSON.stringify(t)}).then(function(t){t.code||(e.$Message.success(e.$t("common.operationSuccess")),e.goToSwitchMap())}).catch(function(t){console.error(t),e.$Message.error(e.$t("common.operationFail"))})}})},handleAddServer:function(){var e=this;!this.newTileServer.name||!this.newTileServer.server||!this.newTileServer.coordinate||this.newTileServer.maxLevel<2||18<this.newTileServer.maxLevel||this.api.post("/api/mapApi/addTileServer",{tileServerJson:JSON.stringify(this.newTileServer)}).then(function(t){t.code||(e.$Message.success(e.$t("common.operationSuccess")),e.showAddServerModal=!1,e.goToSwitchMap())}).catch(function(t){console.error(t),e.$Message.error(e.$t("common.operationFail"))})},goToSwitchMap:function(){var e=this;this.api.post("/api/mapApi/getTileServerList").then(function(t){!t.code&&t.tileServerList?(e.tileServerList=t.tileServerList.sort(function(t,e){return e.current-t.current}),e.showSwitchMapModal=!0):e.showVsNotification(e.$t("common.operationFail"))}).catch(function(t){console.error(t),e.showVsNotification(e.$t("common.operationFail"))})},switchMapApi:function(t){var e=this;this.$Modal.confirm({title:this.$t("common.alert"),content:this.$t("mapSwitchAlert"),onOk:function(){e.api.post("/api/mapApi/setTileServer",{tileServerJson:JSON.stringify(t)}).then(function(t){t.code||location.reload()}).catch(function(t){console.error(t),e.showVsNotification(e.$t("common.operationFail"))})}})},getZoomInfo:function(){var e=this;this.api.get("/api/mapApi/getZoom",{}).then(function(t){t.code||(e.currentMaxZoom=parseInt(t.zoomInfo.maxZoom),t.tileServer&&(e.currentTilesServer=t.tileServer),e.initMap(parseInt(t.zoomInfo.minZoom),parseInt(t.zoomInfo.maxZoom)))}).catch(function(t){})},initMap:function(t,e){var i=this,o=u.a.mapUrl(),o=new d.a.TileLayer(o,{minZoom:t=t<2?2:t,maxZoom:e,attribution:"NORMAL"}),t=(o.setZIndex(1),localStorage.getItem("map-center-lat")),e=localStorage.getItem("map-center-lng"),a=38.8225909761771,s=105.380859375,t=(t&&e&&(a=t,s=e),new d.a.LatLng(a,s)),e=d.a.latLng(-90,-360),a=d.a.latLng(90,360),s=d.a.latLngBounds(e,a);this.map=new d.a.Map("mainmap",{maxBounds:s,center:t,zoom:5,attributionControl:!1,layers:[o]}),this.albumId||this.ordinaryAlbumId||this.libraryId?this.getAlbumPhotoList():(this.map.on("moveend",function(e){i.moveTimer&&clearTimeout(i.moveTimer),i.moveTimer=setTimeout(function(){var t=i.map.getCenter();localStorage.setItem("map-center-lat",t.lat),localStorage.setItem("map-center-lng",t.lng),i.getHashBox(e)},600)}),this.map.zoomIn()),this.markerGroup=d.a.layerGroup().addTo(this.map)},onModalShow:function(t){if(t)for(var e=document.getElementsByClassName("ivu-modal-body"),i=0;i<e.length;i++)e[i]&&e[i].style&&(e[i].style.padding=0)},formatTimestampToYearMonth:function(t){var t=new Date(t),e=t.getFullYear(),t=String(t.getMonth()+1).padStart(2,"0");return"".concat(e,"/").concat(t)},dealPhotoMap:function(n,l){var r=this;this.markerGroup.clearLayers();var c,h,t;for(h in l)(()=>{var t,e=l[h],i=document.createElement("div"),o=(i.style="display:inline-block;position:relative; width: 100%;height: 100%; object-fit: cover;padding:2%",document.createElement("img"));if(o.src=u.a.getImgFullPath(e.id,!0),o.style="width: 100%;height: 100%; object-fit: cover",i.appendChild(o),(o=75<(o=9*n)?75:o)<35&&(o=35),e.original_time&&((t=document.createElement("p")).textContent=r.formatTimestampToYearMonth(e.original_time),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",t.style.fontSize="8px",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.color="white",t.style.overflow="hidden",t.style.textAlign="center",i.appendChild(t)),c=d.a.divIcon({iconSize:[o,o],html:i}),0==e.latitude&&0==e.longitude)return;if("undefined"==e.latitude||"undefined"==e.longitude)return;r.albumFirstPhoto=e;try{var a=r.utils.transCoordinateForShow(r.currentTilesServer,e.longitude,e.latitude),s=d.a.marker([a[1],a[0]],{icon:c,indexId:e.id});s.on("click",function(t){r.api.post("/api/mapApi/getLocationStr",{indexId:e.id}).then(function(t){t.code||(r.selectPositionStr=t.geo.name+" "+t.geo.cn_name,r.clickGeohash=e.geohash,r.showPhotoGeo=!0,r.addModalToList(r.$refs.refModalPhotoAlbum))}).catch(function(t){})}),s.addTo(r.markerGroup)}catch(t){}})();(this.albumId||this.ordinaryAlbumId)&&this.albumFirstPhoto&&(t=new d.a.LatLng(this.albumFirstPhoto.latitude,this.albumFirstPhoto.longitude),this.map.flyTo(t))},getAlbumPhotoList:function(){var e=this,t={};this.albumId?t.albumId=this.albumId:this.ordinaryAlbumId?t.ordinaryAlbumId=this.ordinaryAlbumId:this.libraryId&&(t.libraryId=this.libraryId),this.api.post("/api/photoApi/getAlbumPhotoForMap",t).then(function(t){t.code||e.dealPhotoMap(2,t.mapPhoto)}).catch(function(t){e.showVsNotification(JSON.stringify(t))})},getHashBox:function(t){var e=this,i=(this.map._zoom,t.target._zoom),t=this.map.getBounds(),o=t._southWest,t=t._northEast,a=(o.lat<t.lat?o:t).lat,s=(o.lat<t.lat?t:o).lat,n=(o.lng<t.lng?o:t).lng,t=(o.lng<t.lng?t:o).lng;this.api.post("/api/photoApi/getBoundsPhoto",{hideLoading:!0,minLat:a,minLng:n,maxLat:s,maxLng:t,zoom:i}).then(function(t){t.code||e.dealPhotoMap(i,t.mapPhoto)}).catch(function(t){})}}},i=(i("7b06"),i("2877")),i=Object(i.a)(o,function(){var i=this,o=i._self._c;return o("div",{staticClass:"map-root"},[o("div",i.isMobile?{staticClass:"map-content",attrs:{id:"mainmap"}}:{staticClass:"map-content",style:{"border-top-left-radius":i.borderRadius,"border-top-right-radius":i.borderRadius},attrs:{id:"mainmap"}}),i.map&&i.map._zoom&&!i.ordinaryAlbumId&&!i.albumId?o("div",{staticClass:"zoom-title-root"},[o("a",{staticStyle:{"margin-right":"5px","font-size":"12px"},on:{click:function(t){return i.goToSwitchMap()}}},[i.currentTilesServer&&i.currentTilesServer.name?o("span",{staticStyle:{"margin-right":"5px"}},[i._v(i._s(i.currentTilesServer.name))]):i._e(),i._v(i._s(i.$t("switchMap")))]),o("p",{staticStyle:{"font-size":"12px"}},[i._v(" "+i._s(i.$t("map.currentZoomLevel",{zoom:Math.ceil(i.map._zoom)}))+" "),i.currentMaxZoom?o("span",{staticStyle:{"margin-left":"3px"}},[i._v("(2-"+i._s(i.currentMaxZoom)+")")]):i._e()])]):i._e(),o("Modal",{ref:"refModalPhotoAlbum",attrs:{"footer-hide":"",fullscreen:"",closable:!1},on:{"on-visible-change":i.onModalShow},model:{value:i.showPhotoGeo,callback:function(t){i.showPhotoGeo=t},expression:"showPhotoGeo"}},[i.showPhotoGeo?o("album-detail",{attrs:{propsNearMode:!0,propsShowSearchBtn:!1,propsTitle:i.selectPositionStr,propsGeoHash:i.clickGeohash},on:{onClose:function(t){return i.historyBack()}}}):i._e()],1),o("Modal",{attrs:{"footer-hide":""},scopedSlots:i._u([{key:"header",fn:function(){return[o("div",{staticClass:"ivu-modal-header-inner"},[i._v(i._s(i.$t("switchMap")))]),o("Button",{staticStyle:{position:"absolute",right:"40px",top:"8px"},attrs:{type:"primary",ghost:""},on:{click:i.openAddServer}},[i._v(" "+i._s(i.$t("addMapServer"))+" ")])]},proxy:!0}]),model:{value:i.showSwitchMapModal,callback:function(t){i.showSwitchMapModal=t},expression:"showSwitchMapModal"}},i._l(i.tileServerList,function(e,t){return o("div",{key:t,staticClass:"map-server-card ivu-card ivu-card-bordered"},[o("div",{staticClass:"ivu-card-body"},[o("h4",[i._v(i._s(i.$t("common.name"))+": "+i._s(e.name)),1==e.current?o("a",{staticStyle:{"margin-left":"5px"}},[i._v(i._s(i.$t("currentUsing")))]):i._e()]),1==e.isCustom?o("p",{staticStyle:{"word-break":"break-all"}},[i._v(i._s(i.$t("tileServerUrl"))+": "+i._s(e.server))]):i._e(),o("p",{staticStyle:{"word-break":"break-all"}},[i._v(i._s(i.$t("coordinate"))+": "+i._s(e.coordinate))]),o("p",{staticStyle:{"word-break":"break-all"}},[i._v(i._s(i.$t("maxZoom"))+": "+i._s(e.maxLevel))]),o("Button",{attrs:{type:"primary",ghost:""},on:{click:function(t){return i.switchMapApi(e)}}},[i._v(" "+i._s(i.$t("switch"))+" ")]),1==e.isCustom?o("Button",{staticStyle:{"margin-left":"5px"},attrs:{type:"error",ghost:""},on:{click:function(t){return i.handleDeleteServer(e)}}},[i._v(" "+i._s(i.$t("common.delete"))+" ")]):i._e()],1)])}),0),o("Modal",{attrs:{title:i.$t("addMapServer")},model:{value:i.showAddServerModal,callback:function(t){i.showAddServerModal=t},expression:"showAddServerModal"}},[o("Form",{attrs:{model:i.newTileServer,"label-position":"top"}},[o("FormItem",{attrs:{label:i.$t("common.name"),prop:"name"}},[o("Input",{model:{value:i.newTileServer.name,callback:function(t){i.$set(i.newTileServer,"name",t)},expression:"newTileServer.name"}})],1),o("FormItem",{attrs:{label:i.$t("tileServerUrl")+"(http/https)",prop:"server"}},[o("Input",{attrs:{placeholder:"https://xxx.xxx/{z}/{y}/{x}/tile.png"},model:{value:i.newTileServer.server,callback:function(t){i.$set(i.newTileServer,"server",t)},expression:"newTileServer.server"}})],1),o("FormItem",{attrs:{label:i.$t("coordinate"),prop:"coordinate"}},[o("Select",{model:{value:i.newTileServer.coordinate,callback:function(t){i.$set(i.newTileServer,"coordinate",t)},expression:"newTileServer.coordinate"}},i._l(i.coordinateOptions,function(t){return o("Option",{key:t.value,attrs:{value:t.value}},[i._v(i._s(t.label))])}),1)],1),o("FormItem",{attrs:{label:i.$t("maxZoom"),prop:"maxLevel"}},[o("InputNumber",{attrs:{min:2,max:18},model:{value:i.newTileServer.maxLevel,callback:function(t){i.$set(i.newTileServer,"maxLevel",t)},expression:"newTileServer.maxLevel"}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{on:{click:function(t){i.showAddServerModal=!1}}},[i._v(i._s(i.$t("common.cancel")))]),o("Button",{attrs:{type:"primary"},on:{click:i.handleAddServer}},[i._v(i._s(i.$t("common.commit")))])],1)],1)],1)},[],!1,null,"7efdfefc",null);e.default=i.exports},1498:function(t,e,a){a.r(e);var o=a("b85c"),s=(a("14d9"),a("d3b7"),a("3ca3"),a("ddb0"),a("be3b")),i={props:{singleSelectMode:{default:!1,type:Boolean}},components:{albumDetail:function(){return Promise.resolve().then(a.bind(null,"8fad"))}},data:function(){return{dealState:"",inputName:"",autoNameArr:[],showChangeName:!1,rightMenuList:[{text:this.$t("file.check"),type:"CHECK"},{text:this.$t("common.multiSelect"),type:"SELECT"},{text:this.$t("photo.changeName"),type:"MODIFY"},{text:this.$t("common.delete"),type:"DELETE"}],changeAlbumName:"",itemBaseWidth:180,itemWidth:180,itemMargin:10,selectedItem:"",showAlbumDetail:!1,showAddAlbum:!1,dataList:[],loading:!1,selectedIndex:!1,selectMode:!1,enable:!0,checkStateTimeout:null}},mounted:function(){this.getFacesList(),window.addEventListener("resize",this.calImageWidth)},beforeDestroy:function(){window.removeEventListener("resize",this.calImageWidth),clearTimeout(this.checkStateTimeout)},methods:{getSelectedFaceId:function(){var t,e=Object(o.a)(this.dataList);try{for(e.s();!(t=e.n()).done;){var i=t.value;if(i.selected)return i.id}}catch(t){e.e(t)}finally{e.f()}return!1},onPageScroll:function(t){if(this.$refs.faceCm&&this.$refs.faceCm.show)return this.$refs.faceCm.hide()},enableAiFace:function(){var e=this;this.api.post("/api/commonApi/saveConfigPhoto",{aiFaceEnable:"1"}).then(function(t){e.getFacesList()}).catch(function(t){})},exitSelectMode:function(){for(var t in this.selectMode=!1,this.dataList)this.dataList[t].selected=!1},itemSingleSelect:function(t){for(var e in this.dataList)this.dataList[e].selected=e==t;this.$forceUpdate()},itemSelect:function(t){this.dataList[t].selected=!this.dataList[t].selected,this.$forceUpdate();var e,i=!1;for(e in this.dataList)if(this.dataList[e].selected){i=!0;break}this.selectMode=i},getSelectedIdList:function(){var t,e=[];for(t in this.dataList)this.dataList[t].selected&&e.push(this.dataList[t].id);return e},deleteSelect:function(){this.onDeletePerson(this.getSelectedIdList())},mergeSelect:function(){var e=this,t=this.getSelectedIdList();if(t.length<2)return this.showVsNotification(this.$t("photo.atleastTwoPersonMerge"));this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.mergePersonAlert"),function(){e.api.post("/api/photoApi/mergeFace",{faceIdList:t}).then(function(t){t.code||(e.showVsNotification(e.$t("common.operationSuccess")),e.getFacesList(),e.exitSelectMode())}).catch(function(t){})})},onShowChangeName:function(t){this.selectedIndex=t,this.selectedItem=this.dataList[t],this.selectedItem.face_name?this.inputName=this.selectedItem.face_name:this.inputName="",this.showChangeName=!0},onSaveName:function(){var e=this;return this.inputName?50<this.inputName.length?this.showVsNotification(this.$t("photo.personNameTooLong")):void this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.changeUserName",{name:this.inputName}),function(){e.api.post("/api/photoApi/updatePhotoFace",{faceId:e.selectedItem.id,faceName:e.inputName}).then(function(t){t.code||(e.showVsNotification(e.$t("common.operationSuccess")),e.getFacesList(),e.showChangeName=!1)}).catch(function(t){})}):this.showVsNotification(this.$t("photo.inputPersonName"))},onDeletePerson:function(e){var i=this;this.selectedItem,this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.sureDeletePerson"),function(){var t={disabled:1};e?t.faceIdList=e:t.faceId=i.selectedItem.id,i.api.post("/api/photoApi/updatePhotoFace",t).then(function(t){t.code||(i.showVsNotification(i.$t("common.operationSuccess")),i.getFacesList(),i.showChangeName=!1,i.exitSelectMode())}).catch(function(t){})})},mouseEnterImg:function(t){this.isMobile||this.$set(this.dataList[t],"hover",!0)},mouseLeaveImg:function(t){this.isMobile||this.$set(this.dataList[t],"hover",!1)},showRightMenu:function(t,e,i,o){if(this.singleSelectMode)return t.preventDefault();this.selectedIndex=o,this.selectedItem=i,this.$easycm(t,e,"faceCm")},rightMenuClick:function(t,e){if(this.singleSelectMode)return!1;e=e||this.rightMenuList[t[0]].type;"CHECK"==e?this.onAlbumClick(this.selectedIndex):"DELETE"==e?this.onDeletePerson():"MODIFY"==e?this.onShowChangeName(this.selectedIndex):"SELECT"==e&&this.itemSelect(this.selectedIndex)},calImageWidth:function(){this.singleSelectMode&&(this.itemBaseWidth=120,this.itemWidth=120);var t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin);t&&(this.itemWidth=t)},onAlbumClick:function(t){if(this.$refs.faceCm&&this.$refs.faceCm.show)return this.$refs.faceCm.hide();this.selectMode?this.itemSelect(t):this.singleSelectMode?this.itemSingleSelect(t):(this.selectedItem=this.dataList[t],this.showAlbumDetail=!0,this.addModalToList(this.$refs.refModalAlbumFaces))},getFacesList:function(){var a=this;this.autoNameArr=[],this.loading=!0,this.api.post("/api/photoApi/getPhotoFaces",{}).then(function(t){if(!t.code){a.dataList=t.data,a.enable=t.enable,a.dataList.length;for(var e=0;e<a.dataList.length;e++){var i=a.dataList[e],o=s.a.getFaceImageUrl(i.id);a.dataList[e].url=o+"&time="+(new Date).getTime(),a.autoNameArr.length<10&&i.face_name&&a.autoNameArr.push(i.face_name),a.dataList[e].selected=!1}a.dataList.length<1&&a.enable&&a.getFaceDealState(),a.$nextTick(function(){a.calImageWidth(),setTimeout(function(){a.calImageWidth()},300)})}a.loading=!1}).catch(function(t){a.loading=!1})},getFaceDealState:function(){var e=this;this.api.post("/api/photoApi/getAiDealState",{hideLoading:!0,type:"faceapi"}).then(function(t){t.code||t.data&&(1==t.data.isIndexing?e.dealState=e.$t("photo.indexingNoAi"):t.data.faceApiWaitDealCount?(e.dealState=e.$t("photo.waitDealCount",{count:t.data.faceApiWaitDealCount}),1<t.data.faceApiWaitDealCount&&(e.checkStateTimeout=setTimeout(function(){e.getFaceDealState()},8e3))):t.data.faceApiWaitCompareCount&&(e.dealState=e.$t("photo.waitCompareFaceCount",{count:t.data.faceApiWaitCompareCount}),1<t.data.faceApiWaitCompareCount)&&(e.checkStateTimeout=setTimeout(function(){e.getFaceDealState()},8e3)))}).catch(function(t){})}}},n=(a("6f83"),a("2877")),n=Object(n.a)(i,function(){var o=this,t=o._self._c;return t("div",{staticClass:"album-root-wrapper"},[t("div",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px",display:"flex","flex-direction":"column","align-items":"center"}},[!o.loading&&o.dataList.length<1?t("my-nodata",{attrs:{title:o.$t("photo.noPersonPlaceHolder")}}):o._e(),o.enable?o._e():t("my-btn",{staticStyle:{"margin-top":"20px"},attrs:{title:o.$t("photo.enableAiFace")},on:{click:o.enableAiFace}}),o.enable&&o.dealState?t("div",{staticStyle:{"margin-top":"10px"}},[o._v("["+o._s(o.dealState)+"]")]):o._e()],1),t("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"row",overflow:"hidden"},style:{height:o.singleSelectMode?"450px":"100%"}},[t("div",{ref:"listWrapper",staticClass:"album-list-root",on:{scroll:o.onPageScroll}},[o._l(o.dataList,function(e,i){return t("vs-card",{style:{margin:o.itemMargin+"px",width:o.itemWidth+"px"},attrs:{type:"1"},on:{click:function(t){return o.onAlbumClick(i)},contextmenu:function(t){return o.showRightMenu(t,o.$root,e,i)},mouseenter:function(t){return o.mouseEnterImg(i)},mouseleave:function(t){return o.mouseLeaveImg(i)}},scopedSlots:o._u([{key:"title",fn:function(){return[t("div",{staticStyle:{display:"flex","align-items":"center",width:"100%","justify-content":"center","margin-top":"10px"}},[t("p",{staticClass:"item-name max-line-one"},[o._v(o._s(e.face_name||o.$t("photo.unnamed")))])])]},proxy:!0},{key:"img",fn:function(){return[e.url?t("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.url,expression:"item.url"}],staticStyle:{"object-fit":"cover","pointer-events":"none"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"}}):t("img",{staticStyle:{"object-fit":"cover","pointer-events":"none"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:a("915f")}}),e.selected?t("div",{staticStyle:{width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",display:"flex","align-items":"center","justify-content":"center"}},[t("Icon",{attrs:{type:"md-checkmark-circle-outline",color:"white",size:"50"}})],1):o._e()]},proxy:!0},{key:"text",fn:function(){return[o.singleSelectMode||1!=o.$store.state.currentUser.is_admin?t("p"):t("p",{staticStyle:{"text-align":"center","margin-top":"5px"}},[o._v(o._s(o.$t("photo.photoCount",{photoCount:e.face_photo_count})))])]},proxy:!0},{key:"interactions",fn:function(){return[t("div",{staticStyle:{display:"flex","justify-content":"flex-end",width:"100%"}},[e.hover&&!o.selectMode&&!o.singleSelectMode||o.isMobile&&!o.singleSelectMode?t("vs-button",{staticClass:"btn-chat",attrs:{shadow:""},on:{click:function(t){return t.stopPropagation(),o.showRightMenu(t,o.$root,e,i)}}},[t("span",{staticClass:"nasIcons icon-bianji"})]):o._e(),!e.hover||o.selectMode||o.singleSelectMode?o._e():t("vs-button",{staticClass:"btn-chat",attrs:{shadow:""},on:{click:function(t){return t.stopPropagation(),o.itemSelect(i)}}},[t("span",{staticClass:"nasIcons icon-setting-common",style:{color:e.selected?"#386DF2":""}})])],1)]},proxy:!0}],null,!0)})}),t("div",{staticStyle:{width:"100%",height:"80px"}})],2)]),o.selectMode?t("div",{staticClass:"bottom-select-root"},[t("div",{on:{click:o.exitSelectMode}},[t("my-btn",{attrs:{type:"white",icon:"md-add",title:o.$t("common.cancel")}})],1),t("div",{on:{click:o.deleteSelect}},[t("my-btn",{attrs:{type:"red",icon:"md-add",title:o.$t("common.delete")}})],1),t("div",{on:{click:o.mergeSelect}},[t("my-btn",{attrs:{icon:"md-add",title:o.$t("photo.mergePerson")}})],1)]):o._e(),t("Modal",{ref:"refModalAlbumFaces",attrs:{scrollable:!1,"footer-hide":"","class-name":"modal-style-nopadding",fullscreen:"",closable:!1},model:{value:o.showAlbumDetail,callback:function(t){o.showAlbumDetail=t},expression:"showAlbumDetail"}},[o.showAlbumDetail?t("album-detail",{attrs:{propsShowSearchBtn:!1,propsTitle:o.selectedItem.face_name||o.$t("photo.unnamed"),propsShowAddToAlbum:!1,propsShowDelete:!1,propsShowModeSwitch:!1,propsShowRemoveFromAlbum:!0,propsFaceId:o.selectedItem.id+""},on:{onClose:function(t){return o.historyBack()}}}):o._e()],1),t("vs-dialog",{scopedSlots:o._u([{key:"header",fn:function(){return[t("h4",{staticStyle:{"font-size":"16px"}},[o._v(" "+o._s(o.$t("photo.inputPersonName"))+" ")])]},proxy:!0},{key:"footer",fn:function(){return[t("div",{staticClass:"footer-dialog"},[t("vs-button",{attrs:{block:""},on:{click:o.onSaveName}},[o._v(" "+o._s(o.$t("common.ok"))+" ")]),t("div",{staticStyle:{"margin-top":"10px"}},[t("a",{on:{click:function(t){return t.stopPropagation(),o.onDeletePerson()}}},[o._v(" "+o._s(o.$t("photo.deletePerson")))])])],1)]},proxy:!0}]),model:{value:o.showChangeName,callback:function(t){o.showChangeName=t},expression:"showChangeName"}},[t("div",{staticClass:"con-form"},[t("img",{staticStyle:{width:"50px",height:"50px","border-radius":"10px","object-fit":"cover","margin-right":"10px"},attrs:{src:o.selectedItem.url}}),t("div",[t("p",{staticClass:"input-alert"},[o._v(o._s(o.$t("photo.sameNameMerged")))])]),t("AutoComplete",{staticStyle:{width:"100%"},attrs:{data:o.autoNameArr,placeholder:o.$t("photo.inputPersonName")},model:{value:o.inputName,callback:function(t){o.inputName=t},expression:"inputName"}})],1)]),t("easy-cm",{ref:"faceCm",attrs:{tag:"faceCm",list:o.rightMenuList},on:{ecmcb:o.rightMenuClick}})],1)},[],!1,null,"7d0a4bf5",null);e.default=n.exports},"173b":function(t,e,i){},3360:function(t,e,i){i("6917")},"402f":function(t,e,i){i("173b")},47387:function(t,e,i){},"4b1c":function(t,e,i){},5325:function(t,e,i){i("47387")},"5e97":function(t,e,i){},"67ab":function(t,e,i){},6917:function(t,e,i){},"6f83":function(t,e,i){i("ca42")},"78de":function(t,e,i){i("b993")},"7b06":function(t,e,i){i("4b1c")},"8ec8":function(t,e,i){},"90a5":function(t,e,i){},"93c0":function(t,e,i){i("67ab")},"95b4":function(t,e,i){i("a7b3")},"9e9f":function(t,e,i){},a7b3:function(t,e,i){},b426:function(t,e,i){i("90a5")},b993:function(t,e,i){},ba65:function(t,e,i){i("ead0")},ca42:function(t,e,i){},d2c4:function(t,e,i){i("5e97")},d40c:function(t,e,i){i("9e9f")},ead0:function(t,e,i){},ed29:function(t,e,a){a.r(e);{var i=a("7cfd"),o=a("cd79"),s=a("0bd4"),n=(a("b0c0"),a("14d9"),a("a434"),a("b64b"),a("ac1f"),a("8914")),c=a("be3b"),l=a("8fad"),n={components:{albumAdd:n.a,albumDetail:l.default},data:function(){return{pageSize:15,orderField:"id",orderType:"desc",searchStr:"",nextHasMore:!0,nextLoading:!1,rightMenuList:[{text:this.$t("file.check"),type:"CHECK"},{text:this.$t("setting"),type:"SETTING"},{text:this.$t("common.delete"),type:"DELETE"}],changeAlbumName:"",itemBaseWidth:220,itemWidth:220,itemMargin:10,editAlbum:null,selectedAlbum:"",showAlbumDetail:!1,showAddAlbum:!1,albumList:[],selectedIndex:!1}},mounted:function(){this.loadFirstPage(),window.addEventListener("resize",this.calImageWidth)},activated:function(){var t=sessionStorage.getItem("albumDelete");if(t)for(var e in sessionStorage.removeItem("ordinaryAlbumDelete"),this.albumList)if(this.albumList[e].id==t)return this.albumList.splice(e,1)},beforeDestroy:function(){window.removeEventListener("resize",this.calImageWidth)},methods:{onClickAdd:function(){this.showAddAlbum=!0},onSearch:function(t){this.searchStr=t,this.loadFirstPage()},loadFirstPage:function(){this.albumList=[],this.nextHasMore=!0,this.nextLoading=!1,this.getAlbumList()},loadNextPage:function(){this.getAlbumList()},onPageScroll:function(t){var e=this;t.target.id,"album-smart-wrapper"==t.target.id&&(this.$refs.easyCm&&this.$refs.easyCm.show&&this.$refs.easyCm.hide(),this.dealOnPageScroll(t,function(){e.loadNextPage()},function(t){}))},showRightMenu:function(t,e,i,o){this.selectedIndex=o,this.selectedAlbum=i,this.$easycm(t,e)},rightMenuClick:function(t){t=this.rightMenuList[t[0]].type;"CHECK"==t?this.onAlbumClick(this.selectedIndex):"SETTING"==t?this.showEditAlbum(this.selectedIndex):"DELETE"==t&&this.deleteAlbum()},showEditAlbum:function(t){var e=this;this.selectedAlbum=this.albumList[t],"condition"==this.selectedAlbum.type?(this.editAlbum=this.albumList[t],this.showAddAlbum=!0):(this.changeAlbumName=this.selectedAlbum.name,this.$nextTick(function(){e.$refs.changeAlbumDialog.setShow(!0)}))},onChangeAlbumName:function(t){var e=this;this.changeAlbumName=t,this.changeAlbumName.length<1&&this.showVsNotification(this.$t("album.pleaseInputAlbumName")),this.api.post("/api/photoApi/updateAlbum",{id:this.selectedAlbum.id,name:this.changeAlbumName}).then(function(t){t.code||(e.showVsNotification(e.$t("common.changeSuccess")),e.loadFirstPage())}).catch(function(t){})},clickOrder:function(t,e){this.orderField=t,this.orderType=e,this.loadFirstPage()},onAddAlbum:function(){this.showAddAlbum=!1,this.loadFirstPage()},calImageWidth:function(){var t;this.$refs.listWrapper&&(t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin))&&(this.itemWidth=t)},onAlbumClick:function(t){if(this.$refs.easyCm&&this.$refs.easyCm.show)return this.$refs.easyCm.hide();this.selectedAlbum=this.albumList[t],this.showAlbumDetail=!0,this.addModalToList(this.$refs.refModalAlbumDetail)},getAlbumList:function(){var t,s=this;!this.nextLoading&&this.nextHasMore&&(this.nextLoading=!0,t={offset:this.albumList.length,count:this.pageSize,orderType:this.orderType,orderField:this.orderField},this.searchStr&&(t.search=this.searchStr),this.api.post("/api/photoApi/getAllAlbum",t).then(function(t){if(s.nextLoading=!1,!t.code){for(var e=0;e<t.data.length;e++){var i=t.data[e];i.data_value=JSON.parse(i.data_value);for(var o=0;o<i.imgList.length;o++){var a=c.a.getImgFullPath(i.imgList[o].id,!0);i.imgList[o].url=a}s.albumList.push(i)}t.data.length<s.pageSize&&(s.nextHasMore=!1),s.$nextTick(function(){s.calImageWidth(),setTimeout(function(){s.calImageWidth()},300)})}}).catch(function(t){s.nextLoading=!1}))},deleteAlbum:function(){var e=this;this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("common.deleteSure"),function(){e.api.post("/api/photoApi/deleteAlbum",{id:e.selectedAlbum.id}).then(function(t){t.code||(e.showVsNotification(e.$t("common.deleteSuccess")),e.loadFirstPage())}).catch(function(t){})})}}},r=(a("3360"),a("2877")),n,n=(n=Object(r.a)(n,function(){var o=this,t=o._self._c;return t("div",{staticClass:"ai-album-root-wrapper"},[!o.nextLoading&&o.albumList.length<1?t("my-nodata",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px"},attrs:{title:o.$t("album.noAlubmDesc"),btnTitle:o.$t("album.addASmartAlbum")},on:{onBtnClick:function(t){o.showAddAlbum=!0}}}):o._e(),t("div",{staticStyle:{width:"100%",height:"100%",overflow:"scroll"},attrs:{id:"album-smart-wrapper"},on:{scroll:o.onPageScroll}},[t("div",{ref:"listWrapper",staticClass:"album-list-root"},o._l(o.albumList,function(e,i){return 1==o.$store.state.currentUser.is_admin||0<e.imgList.length?t("vs-card",{style:{margin:o.itemMargin+"px",width:o.itemWidth+"px"},attrs:{type:"1"},on:{click:function(t){return o.onAlbumClick(i)},contextmenu:function(t){return o.showRightMenu(t,o.$root,e,i)}},scopedSlots:o._u([{key:"title",fn:function(){return[t("h3",{staticClass:"max-line-one",staticStyle:{"text-align":"left"}},[o._v(o._s(e.name))])]},proxy:!0},{key:"img",fn:function(){return[0<e.imgList.length?t("img",{staticStyle:{"object-fit":"cover"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:e.imgList[0].url}}):t("img",{staticStyle:{"object-fit":"cover"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:a("915f")}})]},proxy:!0},{key:"text",fn:function(){return["date"==e.type?t("div",["aiDate"==e.data_value.type?t("p",{staticClass:"item-subtitle max-line-one"},[o._v(" "+o._s(1==e.data_value.isLunar?o.$t("photo.lunar"):o.$t("photo.solar"))+": "+o._s("%"==e.data_value.year?o.$t("album.everyYear"):e.data_value.year)+o._s("/"+("%"==e.data_value.month?o.$t("album.everyMonth"):e.data_value.month))+o._s("/"+e.data_value.day)+" ")]):o._e(),"fix"==e.data_value.type?t("p",{staticClass:"item-subtitle max-line-one"},[o._v(" "+o._s(e.data_value.year+"/")+o._s(e.data_value.month+"/")+o._s(e.data_value.day)+" "),">"==e.data_value.sign?t("span",[o._v(o._s(o.$t("album.gt")))]):o._e(),"<"==e.data_value.sign?t("span",[o._v(o._s(o.$t("album.lt")))]):o._e(),"="==e.data_value.sign?t("span",[o._v(o._s(o.$t("album.eq")))]):o._e()]):o._e(),"holidays"==e.data_value.type?t("p",{staticClass:"item-subtitle max-line-one"},[o._v(" "+o._s(o.$t("album.holidays"))+"-"+o._s(e.data_value.holidayName)+" ")]):o._e(),"section"==e.data_value.type?t("p",{staticClass:"item-subtitle max-line-one"},[o._v(" "+o._s(e.data_value.year_start+"/")+o._s(e.data_value.month_start+"/")+o._s(e.data_value.day_start)+" - "+o._s(e.data_value.year_end+"/")+o._s(e.data_value.month_end+"/")+o._s(e.data_value.day_end+"/")+" ")]):o._e()]):o._e(),"geo"==e.type?t("div",[t("p",{staticClass:"item-subtitle max-line-one"},[o._v(o._s(o.$t("album.geoAlbumDetail")))])]):o._e(),"mode"==e.type?t("div",[t("p",{staticClass:"item-subtitle max-line-one"},[o._v(o._s(e.data_value.mode))])]):o._e(),"condition"==e.type?t("div",[e.data_value?t("vs-tooltip",{scopedSlots:o._u([{key:"tooltip",fn:function(){return[o._v(" "+o._s(e.data_value)+" ")]},proxy:!0}],null,!0)},[t("p",{staticClass:"item-subtitle max-line-one"},[o._v(o._s(e.data_value))])]):o._e()],1):o._e()]},proxy:!0},{key:"interactions",fn:function(){return[t("vs-button",{attrs:{icon:""}},["date"==e.type?t("div",["aiDate"==e.data_value.type?t("p",{staticClass:"album-type max-line-one"},[o._v(" "+o._s(o.$t("album.aiDate"))+" ")]):o._e(),"fix"==e.data_value.type?t("p",{staticClass:"album-type max-line-one"},[o._v(" "+o._s(o.$t("album.fixDate"))+" ")]):o._e(),"section"==e.data_value.type?t("p",{staticClass:"album-type max-line-one"},[o._v(" "+o._s(o.$t("album.sectionDate"))+" ")]):o._e(),"holidays"==e.data_value.type?t("p",{staticClass:"album-type max-line-one"},[o._v(" "+o._s(o.$t("album.holidays"))+" ")]):o._e()]):o._e(),"geo"==e.type?t("div",[t("p",{staticClass:"max-line-one"},[o._v(o._s(o.$t("album.geoAlbum")))])]):o._e(),"mode"==e.type?t("div",[t("p",{staticClass:"max-line-one"},[o._v(o._s(o.$t("album.modeAlbum")))])]):o._e(),"condition"==e.type?t("div",[t("p",{staticClass:"max-line-one"},[o._v(o._s(o.$t("photo.filterAlubm")))])]):o._e()]),t("vs-button",{staticClass:"btn-chat",attrs:{icon:"",shadow:"",primary:""},on:{click:function(t){return t.stopPropagation(),o.showRightMenu(t,o.$root,e,i)}}},[t("Icon",{attrs:{type:"ios-more",size:"20"}})],1)]},proxy:!0}],null,!0)}):o._e()}),1),t("div",{staticStyle:{display:"flex","justify-content":"center",width:"100%","flex-direction":"column","align-items":"center"}},[o.nextHasMore&&0<o.albumList.length?t("Button",{staticStyle:{width:"250px","margin-top":"30px",height:"45px","border-radius":"20px"},attrs:{type:"default"},on:{click:function(t){return o.loadNextPage()}}},[o._v(o._s(o.$t("common.loadmore")))]):o._e(),o.nextLoading?t("Spin",{staticStyle:{"margin-top":"30px"},attrs:{size:"large"}}):o._e(),!o.nextLoading&&!o.nextHasMore&&0<o.albumList.length?t("span",{staticStyle:{"margin-top":"30px"}},[o._v(o._s(o.$t("common.noMore")))]):o._e(),t("div",{staticStyle:{height:"50px"}})],1),t("div",{staticStyle:{height:"50px",width:"100%"}})]),t("my-dialog-input",{ref:"changeAlbumDialog",attrs:{placeholder:o.$t("album.albumName"),showCloseBtn:!0,content:o.$t("album.albumName"),title:o.$t("album.changeAlbumName"),initValue:o.changeAlbumName},on:{onOkClick:o.onChangeAlbumName}}),t("vs-dialog",{attrs:{scroll:""},scopedSlots:o._u([{key:"header",fn:function(){return[t("h4",{staticStyle:{"font-size":"16px"}},[o._v(" "+o._s(o.$t("album.addAAlbum"))+" ")])]},proxy:!0}]),model:{value:o.showAddAlbum,callback:function(t){o.showAddAlbum=t},expression:"showAddAlbum"}},[o.showAddAlbum?t("album-add",{attrs:{editAlbum:o.editAlbum},on:{onClose:function(t){o.showAddAlbum=!1},onAdd:o.onAddAlbum}}):o._e()],1),t("Modal",{ref:"refModalAlbumDetail",attrs:{scrollable:!1,"footer-hide":"","class-name":"modal-style-nopadding",fullscreen:"",closable:!1},model:{value:o.showAlbumDetail,callback:function(t){o.showAlbumDetail=t},expression:"showAlbumDetail"}},[o.showAlbumDetail?t("album-detail",{attrs:{propsShowSearchBtn:!1,propsTitle:o.selectedAlbum.name,propsShowAddToAlbum:!0,propsShowDelete:!0,propsShowModeSwitch:!0,propsAlbumId:o.selectedAlbum.id+""},on:{onClose:function(t){return o.historyBack()}}}):o._e()],1),t("easy-cm",{ref:"easyCm",attrs:{list:o.rightMenuList},on:{ecmcb:o.rightMenuClick}})],1)},[],!1,null,"0f4580b0",null)).exports,h=a("a95d"),d=a("a732c"),u=a("11a3"),p=a("9453"),m=a("d3ac"),f=a("5d55"),g=a("59fb"),v=a("db96"),y=a("2cc5"),S=a("c220"),S={props:{hasSider:{default:!1,type:Boolean},showAddToAlbum:{default:!0,type:Boolean},ordinaryAlbumId:{default:"",type:String},albumId:{default:"",type:String}},components:{myScrollBar:S.a,photoBottomSelect:p.a,photoDetail:m.default,videoDetail:f.default,photoOperationHeader:g.a,photoListContent:v.a},data:function(){return{searchStr:"",showVideoDetail:!1,scrollTop:0,showPhotoDetail:!1,editMode:!1,showMode:"cover",showFileType:"0"}},mounted:function(){window.addEventListener("scroll",this.onPageScroll,!0),window.addEventListener("resize",this.onWindowResize),this.loadFirstPage()},beforeDestroy:function(){window.removeEventListener("scroll",this.onPageScroll,!0),window.removeEventListener("resize",this.onWindowResize)},methods:{galleryLoadMoreNext:function(){this.$refs.photoContent&&this.$refs.photoContent.loadNextPage()},loadFirstPage:function(){var t=this;this.$refs.photoContent.clearList(),this.$refs.photoContent.lastHasMore=!1,this.$nextTick(function(){t.$refs.photoContent.getPhotoByTime((new Date).getTime(),1)})},onWindowResize:function(){this.$refs.photoContent.calculateImgHeight()},onPageScroll:function(t){var e,i;this.showPhotoDetail||this.showVideoDetail||(this.$refs.scrollBar&&this.$refs.scrollBar.onScroll(t),this.$refs.photoContent&&this.$refs.photoContent.cancelTouchEvent(),e=i=null,t.srcElement.scrollingElement?(i=t.srcElement.scrollingElement.scrollTop,e=t.srcElement.scrollingElement.scrollHeight):t.srcElement?(i=t.srcElement.scrollTop,e=t.srcElement.scrollHeight):t.target&&(i=t.target.scrollTop,e=t.target.scrollHeight),this.scrollTop=i,i=document.documentElement.clientHeight,!e&&t.srcElement.scrollingElement&&(e=t.srcElement.scrollingElement.scrollHeight),this.scrollTop+i>=e-5&&this.$refs.photoContent&&this.$refs.photoContent.loadNextPage())},onUnSelect:function(){this.clearSelected()},onSearch:function(t){this.searchStr=t,this.loadFirstPage(),this.clearSelected()},onChooseDataType:function(t){this.showFileType=t,this.showFileType,this.loadFirstPage(),this.clearSelected()},setImgSize:function(t){this.$refs.photoContent.itemBaseWidth=t,this.$refs.photoContent.calculateImgHeight()},onChangeShowMode:function(t){this.showMode=t,this.$refs.photoContent.calculateImgHeight()},onHoverSelected:function(t){this.editMode=!0,this.onPhotoClick(t)},onPhotoLoadOver:function(t,e){var i=this;setTimeout(function(){i.$refs.photoContent.calculateImgHeight()},300),this.showPhotoDetail&&this.$refs.photoDetail&&this.$refs.photoDetail.updateImageList(t,e)},onTrashInSuc:function(){this.$refs.photoContent.onTrashInSuc()},clearSelected:function(){this.$refs.photoContent.clearSelected(),this.$refs.selectView&&this.$refs.selectView.clearSelected(),this.editMode=!1},onPhotoClick:function(t){var e=this,i=this.$refs.photoContent.photoList;this.editMode?i[t].selected?(this.$refs.photoContent.setPhotoSelected(t,!1),this.$refs.selectView.removeSelected(i[t].id),this.$refs.selectView.selectedList.length<1&&(this.editMode=!1)):(this.$refs.photoContent.setPhotoSelected(t,!0),this.$refs.selectView.addSelected(i[t])):1==i[t].type?(this.showPhotoDetail=!0,this.$nextTick(function(){e.$refs.photoDetail.showImg(i,t)})):2==i[t].type&&("1"==localStorage.getItem("rawPlayer")||this.isIosSupportRawPlayer()?y.a.playVideo({playIndex:t,playList:i,token:this.$store.state.token,fromFileBrower:!1,serverType:"photo"}):(this.showVideoDetail=!0,this.addModalToList(this.$refs.refModalVideoDetail),this.$nextTick(function(){e.$refs.videoPlayer.playVideo(i,t)})))}}};a("5325"),S=Object(r.a)(S,function(){var e=this,t=e._self._c;return t("div",{ref:"photoListRoot",staticClass:"photo-recent-root"},[t("photo-operation-header",{ref:"photoHeader",staticStyle:{width:"100%",height:"60px",position:"absolute",left:"0","z-index":"2"},on:{onChooseDataType:e.onChooseDataType,onChangeShowMode:e.onChangeShowMode,onSizeChange:e.setImgSize,onSearch:e.onSearch,albumId:e.albumId}}),t("div",{staticStyle:{width:"100%",display:"flex",height:"100%","flex-direction":"row",overflow:"hidden","padding-top":"60px"}},[t("photo-list-content",{ref:"photoContent",attrs:{showMode:e.showMode,albumId:e.albumId,ordinaryAlbumId:e.ordinaryAlbumId,showFileType:e.showFileType,searchStr:e.searchStr,sortField:"check_time"},on:{onHoverSelected:e.onHoverSelected,onPhotoClick:e.onPhotoClick,onPhotoLoadOver:e.onPhotoLoadOver}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.editMode,expression:"editMode"}],staticClass:"bottom-select-root"},[t("photo-bottom-select",{ref:"selectView",attrs:{ordinaryAlbumId:e.ordinaryAlbumId,showAddToAlbum:e.showAddToAlbum,editMode:e.editMode},on:{onRemoveFromAlbum:e.onTrashInSuc,onUnSelect:e.onUnSelect,onTrashInSuc:function(t){return e.onTrashInSuc()}}})],1),e.showPhotoDetail||e.showVideoDetail?e._e():t("my-scroll-bar",{ref:"scrollBar"}),e.showPhotoDetail?t("photo-detail",{ref:"photoDetail",attrs:{enableRemove:!0},on:{onClose:function(t){e.showPhotoDetail=!1},galleryLoadMoreNext:e.galleryLoadMoreNext}}):e._e(),t("Modal",{ref:"refModalVideoDetail",attrs:{fullscreen:"","footer-hide":"",closable:!1},model:{value:e.showVideoDetail,callback:function(t){e.showVideoDetail=t},expression:"showVideoDetail"}},[e.showVideoDetail?t("video-detail",{ref:"videoPlayer",attrs:{propsServerType:"photo"},on:{onClose:function(t){return e.historyBack()}}}):e._e()],1)],1)},[],!1,null,"43bd9fb6",null).exports,p={components:{photoBottomSelect:p.a,photoDetail:m.default,videoDetail:f.default,photoOperationHeader:g.a,photoListContent:v.a},props:{serverType:{default:"photo",type:String},hasSider:{default:!0,type:Boolean}},data:function(){return{selectedPhotoIndex:0,selectedPhoto:"",showTrashChoose:!1,showVideoDetail:!1,scrollTop:0,showPhotoDetail:!1,editMode:!1,showMode:"cover",showFileType:"0"}},mounted:function(){var t=this;this.loadFirstPage(),window.addEventListener("scroll",this.onPageScroll,!0),window.addEventListener("resize",this.onWindowResize),setTimeout(function(){t.$forceUpdate()},500)},beforeDestroy:function(){window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("scroll",this.onPageScroll,!0)},methods:{loadFirstPage:function(){this.$refs.photoContent.clearList(),this.$refs.photoContent.lastHasMore=!1,this.$refs.photoContent.getPhotoByTime("9999999999999",1)},onWindowResize:function(){this.$refs.photoContent.calculateImgHeight()},onPageScroll:function(t){var e,i;this.showPhotoDetail||this.showVideoDetail||(this.$refs.photoContent&&this.$refs.photoContent.cancelTouchEvent(),i=e=null,t.srcElement.scrollingElement?(e=t.srcElement.scrollingElement.scrollTop,i=t.srcElement.scrollingElement.scrollHeight):t.srcElement?(e=t.srcElement.scrollTop,i=t.srcElement.scrollHeight):t.target&&(e=t.target.scrollTop,i=t.target.scrollHeight),this.scrollTop=e,t=document.documentElement.clientHeight,0==this.scrollTop&&this.$refs.photoContent&&this.$refs.photoContent.loadLastPage(),this.scrollTop+t>=i-5&&this.$refs.photoContent&&this.$refs.photoContent.loadNextPage())},restoreAll:function(){this.$refs.photoContent.photoList.length<1?this.showVsNotification(this.$t("common.noData")):this.$refs.selectView.restoreAll(this.$refs.photoContent.photoList)},deleteAll:function(){this.$refs.photoContent.photoList.length<1?this.showVsNotification(this.$t("common.noData")):this.$refs.selectView.deleteAll(this.$refs.photoContent.photoList)},onUnSelect:function(){this.clearSelected()},onChooseDataType:function(t){var e=this;this.showFileType=t,this.clearSelected(),this.$nextTick(function(){e.loadFirstPage()})},setImgSize:function(t){this.$refs.photoContent.itemBaseWidth=t,this.$refs.photoContent.calculateImgHeight()},onChangeShowMode:function(t){this.showMode=t,this.$refs.photoContent.calculateImgHeight()},onHoverSelected:function(t){this.editMode=!0,this.onPhotoClick(t)},onPhotoLoadOver:function(){},onTrashOutSuc:function(){this.$refs.photoContent.onTrashInSuc()},onNeedRefresh:function(){this.loadFirstPage()},clearSelected:function(){this.$refs.photoContent.clearSelected(),this.$refs.selectView&&this.$refs.selectView.clearSelected(),this.editMode=!1},onPhotoClick:function(t){var e=this.$refs.photoContent.photoList;this.editMode?e[t].selected?(this.$refs.photoContent.setPhotoSelected(t,!1),this.$refs.selectView.removeSelected(e[t].id),this.$refs.selectView.selectedList.length<1&&(this.editMode=!1)):(this.$refs.photoContent.setPhotoSelected(t,!0),this.$refs.selectView.addSelected(e[t])):(this.selectedPhotoIndex=t,this.selectedPhoto=e[t],this.showTrashChoose=!0)},checkDetail:function(){var t=this;this.showTrashChoose=!1,1==this.selectedPhoto.type?(this.showPhotoDetail=!0,this.$nextTick(function(){t.$refs.photoDetail.showImg(t.$refs.photoContent.photoList,t.selectedPhotoIndex)})):2==this.selectedPhoto.type&&("1"==localStorage.getItem("rawPlayer")||this.isIosSupportRawPlayer()?y.a.playVideo({playIndex:this.selectedPhotoIndex,playList:this.$refs.photoContent.photoList,token:this.$store.state.token,fromFileBrower:!1,serverType:"photo"}):(this.showVideoDetail=!0,this.addModalToList(this.$refs.refModalVideoDetail),this.$nextTick(function(){t.$refs.videoPlayer.playVideo(t.$refs.photoContent.photoList,t.selectedPhotoIndex)})))},popRestore:function(){this.selectedPhoto.selected=!0,this.$refs.selectView.addSelected(this.selectedPhoto),this.showTrashChoose=!1,this.$refs.selectView.trashPhotos(0)},popDelete:function(){this.selectedPhoto.selected=!0,this.$refs.selectView.addSelected(this.selectedPhoto),this.showTrashChoose=!1,this.$refs.selectView.deleteFromDisk()}}}}a("78de");f=Object(r.a)(p,function(){var e=this,t=e._self._c;return t("div",{ref:"photoListRoot",staticClass:"trash-root"},[t("photo-operation-header",{ref:"photoHeader",staticStyle:{width:"100%",height:"60px",position:"absolute",left:"0","z-index":"2"},on:{onChooseDataType:e.onChooseDataType,onChangeShowMode:e.onChangeShowMode,onSizeChange:e.setImgSize}}),t("div",{staticStyle:{width:"100%",display:"flex",height:"100%","flex-direction":"row",overflow:"hidden","padding-top":"60px"}},[t("photo-list-content",{ref:"photoContent",attrs:{trash:1,showMode:e.showMode,showFileType:e.showFileType,sortField:"in_trash_time",pageRows:10},on:{onHoverSelected:e.onHoverSelected,onPhotoClick:e.onPhotoClick,onPhotoLoadOver:e.onPhotoLoadOver}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showTrashChoose&&!e.showPhotoDetail&&!e.showVideoDetail&&e.$refs.photoContent&&0<e.$refs.photoContent.photoList.length,expression:"!showTrashChoose && !showPhotoDetail && !showVideoDetail && $refs.photoContent && $refs.photoContent.photoList.length > 0"}],staticClass:"bottom-select-root"},[t("photo-bottom-select",{ref:"selectView",attrs:{trashMode:!0,editMode:e.editMode},on:{onUnSelect:e.onUnSelect,onTrashOutSuc:function(t){return e.onTrashOutSuc()},restoreAll:e.restoreAll,deleteAll:e.deleteAll,onDeleteSuc:e.onTrashOutSuc,onNeedRefresh:e.onNeedRefresh}})],1),t("vs-dialog",{scopedSlots:e._u([{key:"header",fn:function(){return[t("h4",{staticStyle:{"font-size":"16px"}},[e._v(" "+e._s(e.$t("common.whatWillYouDo"))+" ")])]},proxy:!0}]),model:{value:e.showTrashChoose,callback:function(t){e.showTrashChoose=t},expression:"showTrashChoose"}},[t("div",{staticClass:"pop-root"},[t("img",{staticClass:"pop-img",attrs:{src:e.selectedPhoto.url,mode:"aspectFill"},on:{dragstart:function(t){t.preventDefault()}}}),t("div",{staticClass:"pop-text-root",staticStyle:{"margin-top":"5px"},on:{click:e.checkDetail}},[t("my-btn",{staticStyle:{width:"80%"},attrs:{type:"white",title:e.$t("file.goDetail")}})],1),t("div",{staticClass:"pop-text-root",staticStyle:{"margin-top":"5px"},on:{click:e.popRestore}},[t("my-btn",{staticStyle:{width:"80%"},attrs:{title:e.$t("file.restore")}})],1),t("div",{staticClass:"pop-text-root",staticStyle:{"margin-top":"5px"},on:{click:e.popDelete}},[t("my-btn",{staticStyle:{width:"80%"},attrs:{title:e.$t("file.deleteForever"),type:"red"}})],1)])]),e.showPhotoDetail?t("photo-detail",{ref:"photoDetail",on:{onClose:function(t){e.showPhotoDetail=!1}}}):e._e(),t("Modal",{ref:"refModalVideoDetail",attrs:{fullscreen:"","footer-hide":"",closable:!1},model:{value:e.showVideoDetail,callback:function(t){e.showVideoDetail=t},expression:"showVideoDetail"}},[e.showVideoDetail?t("video-detail",{ref:"videoPlayer",attrs:{propsServerType:"photo"},on:{onClose:function(t){return e.historyBack()}}}):e._e()],1)],1)},[],!1,null,"303301ea",null).exports,a("2ca0"),g=a("1ee4"),v=a("e86f"),p=a("ccdb"),v={props:{sourceType:{default:"photo",type:String}},mounted:function(){this.getPathList(),this.getExcludeConfig()},components:{fileSelectBar:v.a,fileSelect:p.default,folderBrowerOperationBar:g.a},data:function(){return{cachePath:"",excludeType:"",excludePathList:[],showAddExcludeDialog:!1,showChangeSourcePosition:!1,canAddPath:!0,showChooseFolder:!1,pathList:[],selectedItem:{},intervalList:[{value:18e5,label:this.$t("everyXHour",{count:.5})},{value:36e5,label:this.$t("everyXHour",{count:1})},{value:72e5,label:this.$t("everyXHour",{count:2})},{value:108e5,label:this.$t("everyXHour",{count:3})},{value:144e5,label:this.$t("everyXHour",{count:4})},{value:18e6,label:this.$t("everyXHour",{count:5})},{value:216e5,label:this.$t("everyXHour",{count:6})},{value:324e5,label:this.$t("everyXHour",{count:9})},{value:432e5,label:this.$t("everyXHour",{count:12})},{value:864e5,label:this.$t("everyXHour",{count:24})}]}},computed:{},methods:{onIntevealChange:function(t,e){this.updateSource(t)},updateSource:function(e){var i=this;1==e.scan_interval&&0==e.scan_interval_ms&&(e.scan_interval_ms=this.intervalList[2].value),this.api.post("/api/sourceFolderApi/updateSource",{scan_when_start:e.scan_when_start,scan_when_change:e.scan_when_change,scan_interval:e.scan_interval,scan_interval_ms:e.scan_interval_ms,sourceId:e.id}).then(function(t){t.code||(i.showVsNotification(i.$t("common.operationSuccess")),t.data&&(e=t.data))}).catch(function(t){i.getPathList()})},showAddExclude:function(t){this.excludeType=t,this.excludePathList=[],this.getExcludeConfig(),this.showAddExcludeDialog=!0},onAddExcludePath:function(t){if(t)if(35<t.length)this.showVsAlertDialog(this.$t("common.alert"),this.$t("common.textTooLong"));else{for(var e in this.excludePathList)if(this.excludePathList[e]==t)return;this.excludePathList.push(t),this.saveConfig()}},onDeleteExcludePath:function(t){if(t){for(var e in this.excludePathList)if(this.excludePathList[e]==t){this.excludePathList.splice(e,1);break}this.saveConfig()}},getExcludeConfig:function(){var o=this;this.api.post("/api/commonApi/getAllConfig",{hideLoading:!0,keys:["".concat(this.excludeType)]}).then(function(t){for(var e=0;e<t.data.allConfig.length;e++){var i=t.data.allConfig[e];i.title==o.excludeType&&(o.excludePathList=JSON.parse(i.value))}}).catch(function(t){})},saveConfig:function(){var e=this,t={};t[this.excludeType]=this.excludePathList,this.api.post("/api/commonApi/saveConfig",t).then(function(t){t.code||(e.showVsNotification(e.$t("common.operationSuccess")),e.getExcludeConfig())}).catch(function(t){})},onFolderBack:function(){this.$refs.fileSelector,this.$refs.fileSelector&&this.$refs.fileSelector.goBack()},onShowRelocate:function(t){this.selectedItem=t,this.showChangeSourcePosition=!0},onSelectPath:function(t){this.addPathReq(t),this.showChooseFolder=!1},onSelectPathRelocate:function(t){this.relocateReq(t)},relocateReq:function(t){var e=this;this.api.post("/api/sourceFolderApi/relocatePath",{type:this.sourceType,path:t,rawPathId:this.selectedItem.id}).then(function(t){t.code||(e.showVsNotification(e.$t("common.operationSuccess")),e.getPathList(),e.showChangeSourcePosition=!1)}).catch(function(t){})},getPathList:function(){var e=this;this.api.post("/api/sourceFolderApi/getPathByType",{type:this.sourceType}).then(function(t){t.code||(e.pathList=t.data,t.cacheParentPath&&(e.cachePath=t.cacheParentPath))}).catch(function(t){})},selectPath:function(){this.showChooseFolder=!0},addPathReq:function(t){var e=this;this.api.post("/api/sourceFolderApi/addPath",{type:this.sourceType,path:t}).then(function(t){t.code||(1==localStorage.sourceAddAlert?e.showVsNotification(e.$t("common.operationSuccess")):(e.showVsAlertDialog(e.$t("common.alert"),e.$t("photo.addSourceAlert")),localStorage.sourceAddAlert=1),e.getPathList())}).catch(function(t){})},deletePath:function(t){var e=this;this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("setting.ifDeletePath"),function(){e.api.post("/api/sourceFolderApi/deletePath",{id:t.id}).then(function(t){t.code||e.showVsAlertDialog(e.$t("common.alert"),e.$t("setting.sourceFolderDeleteInBg"),function(){e.getPathList()})}).catch(function(t){})})}}};a("402f");var p=Object(r.a)(v,function(){var i=this,o=i._self._c;return o("div",{staticClass:"source-setting-root"},[o("div",{staticClass:"content-root"},[o("div",{staticClass:"flex-row",staticStyle:{"justify-content":"right","flex-wrap":"wrap"}},[o("p",{staticClass:"add-title"},[i._v(i._s(i.$t("setting.photoSourceSettingAlert")))])]),o("div",{staticStyle:{display:"flex","align-items":"center","margin-top":"5px"}},[o("a",{staticStyle:{height:"25px","margin-right":"15px"},attrs:{border:""},on:{click:function(t){return i.showAddExclude("excludePathPhoto")}}},[i._v(i._s(i.$t("setting.excludePath")))]),o("a",{staticStyle:{"margin-right":"15px",height:"25px"},attrs:{border:""},on:{click:function(t){return i.showAddExclude("excludeFilenamePhoto")}}},[i._v(i._s(i.$t("setting.excludeFilename")))]),o("a",{staticStyle:{height:"25px"},on:{click:function(t){return i.scanPath("photo","ALL")}}},[i._v(i._s(i.$t("scanAll")))])]),o("Divider"),0<i.pathList.length?o("div",{staticStyle:{width:"100%",overflow:"auto",height:"100%"}},[i._l(i.pathList,function(e,t){return o("Card",{staticStyle:{"margin-bottom":"20px",width:"100%","border-radius":"10px"}},[i.cachePath&&(i.cachePath==e.path||3==i.cachePath.length&&e.path.startsWith(i.cachePath)||e.path.startsWith(i.cachePath+"\\")||e.path.startsWith(i.cachePath+"/"))?o("p",{staticStyle:{color:"red","text-align":"left"}},[i._v(i._s(i.$t("sourceIncludeCache")))]):i._e(),o("div",{staticClass:"item-title"},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("common.path"))+" : ")]),i._v(i._s(e.path)+" "),o("Button",{staticStyle:{"margin-left":"5px"},attrs:{size:"small",type:"primary",shape:"circle"},on:{click:function(t){return i.scanPath("photo",e.path)}}},[i._v(i._s(i.$t("setting.scan")))])],1),o("div",{staticClass:"item-title"},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("common.state"))+" : ")]),o("span",{staticStyle:{"font-weight":"bold"},style:{color:0==e.exist?"#DE4545":"#386DF2"}},[i._v(i._s(0==e.exist?i.$t("common.unavailable"):i.$t("common.available")))]),0==e.exist?o("a",{staticStyle:{"margin-left":"30px"},on:{click:function(t){return i.onShowRelocate(e)}}},[i._v(i._s(i.$t("setting.source.directoryMoved")))]):i._e()]),o("div",{staticClass:"item-title"},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("scanWhenStart"))+" : ")]),o("i-switch",{staticStyle:{"flex-shrink":"0"},attrs:{"true-value":1,"false-value":0},on:{"on-change":function(t){return i.updateSource(e)}},model:{value:e.scan_when_start,callback:function(t){i.$set(e,"scan_when_start",t)},expression:"item.scan_when_start"}})],1),o("div",{staticClass:"item-title",staticStyle:{"margin-bottom":"10px"}},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("scanWhenChange"))+" : "),o("Icon",{staticStyle:{"font-weight":"bold",cursor:"pointer"},attrs:{type:"ios-help-circle-outline"},on:{click:function(t){i.showVsAlertDialog(i.$t("common.alert"),i.$t("scanWhenChangeAlert"))}}})],1),o("i-switch",{staticStyle:{"flex-shrink":"0"},attrs:{"true-value":1,"false-value":0},on:{"on-change":function(t){return i.updateSource(e)}},model:{value:e.scan_when_change,callback:function(t){i.$set(e,"scan_when_change",t)},expression:"item.scan_when_change"}})],1),o("div",{staticClass:"item-title",staticStyle:{"margin-bottom":"20px"}},[o("span",{staticClass:"item-label"},[i._v(i._s(i.$t("intervalScan"))+" : "),o("Icon",{staticStyle:{"font-weight":"bold",cursor:"pointer"},attrs:{type:"ios-help-circle-outline"},on:{click:function(t){i.showVsAlertDialog(i.$t("common.alert"),i.$t("intervalScanAlert"))}}})],1),o("i-switch",{staticStyle:{"flex-shrink":"0"},attrs:{"true-value":1,"false-value":0},on:{"on-change":function(t){return i.updateSource(e)}},model:{value:e.scan_interval,callback:function(t){i.$set(e,"scan_interval",t)},expression:"item.scan_interval"}}),1==e.scan_interval?o("vs-select",{staticStyle:{width:"130px","margin-left":"20px"},on:{change:function(t){return i.onIntevealChange(e,t)}},model:{value:e.scan_interval_ms,callback:function(t){i.$set(e,"scan_interval_ms",t)},expression:"item.scan_interval_ms"}},i._l(i.intervalList,function(t){return o("vs-option",{attrs:{label:t.label,value:t.value}},[i._v(" "+i._s(t.label)+" ")])}),1):i._e()],1),o("span",{staticClass:"nasIcons icon-trash",staticStyle:{position:"absolute",right:"10px",bottom:"10px","font-size":"20px",cursor:"pointer",color:"#99AABF"},on:{click:function(t){return i.deletePath(e)}}})])}),o("Card",{staticStyle:{"margin-bottom":"20px",width:"100%","border-radius":"10px",cursor:"pointer"}},[o("div",{staticStyle:{width:"100%",height:"100%",display:"flex","justify-content":"center","align-items":"center","padding-left":"30px","padding-right":"30px"},on:{click:i.selectPath}},[o("span",{staticClass:"nasIcons icon-add-album",staticStyle:{color:"#386DF2","font-size":"50px","margin-right":"20px"}}),o("p",{staticClass:"add-text"},[i._v(i._s(i.$t("setting.btAddSource")))])])])],2):i._e()],1),i.pathList.length<1?o("my-nodata",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px"},attrs:{title:i.$t("setting.photoSourceSettingAlert"),btnTitle:i.$t("setting.btAddSource")},on:{onBtnClick:i.selectPath}}):i._e(),o("vs-dialog",{attrs:{"prevent-close":"",scroll:"","full-screen":i.isMobile},scopedSlots:i._u([{key:"header",fn:function(){return[o("h4",{staticStyle:{"font-size":"16px"}},[i._v(" "+i._s(i.$t("file.chooseFolder")+"["+i.$t("file.doubleClickFolderEnter")+"]")+" ")])]},proxy:!0},{key:"footer",fn:function(){return[o("file-select-bar",{on:{back:function(t){return i.$refs.fileSelector.goBack()},select:function(t){return i.$refs.fileSelector.onSelect()},create:function(t){return i.$refs.fileSelector.createNewFolder(t)}}})]},proxy:!0}]),model:{value:i.showChooseFolder,callback:function(t){i.showChooseFolder=t},expression:"showChooseFolder"}},[i.showChooseFolder?o("file-select",{ref:"fileSelector",attrs:{parent:"root",type:2},on:{cancel:function(t){i.showChooseFolder=!1},onSelect:i.onSelectPath,onCancel:function(t){i.showChooseFolder=!1}}}):i._e()],1),o("vs-dialog",{attrs:{"prevent-close":"",scroll:"","full-screen":i.isMobile},scopedSlots:i._u([{key:"header",fn:function(){return[o("h4",{staticStyle:{"font-size":"16px"}},[i._v(" "+i._s(i.$t("setting.source.reChoose")+i.selectedItem.path)+" ")])]},proxy:!0},{key:"footer",fn:function(){return[o("file-select-bar",{on:{back:function(t){return i.$refs.fileSelector.goBack()},select:function(t){return i.$refs.fileSelector.onSelect()},create:function(t){return i.$refs.fileSelector.createNewFolder(t)}}})]},proxy:!0}]),model:{value:i.showChangeSourcePosition,callback:function(t){i.showChangeSourcePosition=t},expression:"showChangeSourcePosition"}},[i.showChangeSourcePosition?o("file-select",{ref:"fileSelector",attrs:{parent:"root",type:2},on:{onSelect:i.onSelectPathRelocate,onCancel:function(t){i.showChangeSourcePosition=!1}}}):i._e()],1),o("vs-dialog",{attrs:{scroll:"","full-screen":i.isMobile},scopedSlots:i._u([{key:"header",fn:function(){return[i.excludeType?o("h4",{staticStyle:{"font-size":"16px"}},[i._v(" "+i._s("excludePathPhoto"==i.excludeType?i.$t("setting.excludePath"):i.$t("setting.excludeFilename"))+" ")]):i._e()]},proxy:!0}]),model:{value:i.showAddExcludeDialog,callback:function(t){i.showAddExcludeDialog=t},expression:"showAddExcludeDialog"}},[o("Input",{attrs:{autocapitalize:"off",autocorrect:"off",search:"","enter-button":i.$t("common.add"),placeholder:i.$t("setting.addExcludePathPlaceholder")},on:{"on-search":i.onAddExcludePath}}),0<i.excludePathList.length?o("p",{staticStyle:{"text-align":"left","margin-top":"15px",color:"#999999"}},[i._v(" "+i._s("excludePathPhoto"==i.excludeType?i.$t("setting.excludePathAlert"):i.$t("setting.excludeFilenameAlert"))+" ")]):i._e(),o("div",{staticClass:"flex-row",staticStyle:{"margin-top":"5px","flex-wrap":"wrap"}},i._l(i.excludePathList,function(e){return o("Tag",{attrs:{type:"dot",closable:"",color:"primary"},on:{"on-close":function(t){return i.onDeleteExcludePath(e)}}},[i._v(" "+i._s(e))])}),1)],1)],1)},[],!1,null,"5e4e7eea",null).exports,b=a("5530"),g=a("1498"),v={components:{albumDetail:l.default},data:function(){return{dealState:"",rightMenuList:[{text:this.$t("file.check"),type:"CHECK"}],changeAlbumName:"",itemBaseWidth:220,itemWidth:220,itemMargin:10,selectedItem:"",showAlbumDetail:!1,showAddAlbum:!1,dataList:[],loading:!1,selectedIndex:!1,enable:!0,checkStateTimeout:null}},mounted:function(){this.getClassesList(),window.addEventListener("resize",this.calImageWidth)},beforeDestroy:function(){window.removeEventListener("resize",this.calImageWidth),clearTimeout(this.checkStateTimeout)},methods:{enableClass:function(){var e=this;this.api.post("/api/commonApi/saveConfigPhoto",{aiClassesEnable:"1"}).then(function(t){e.getClassesList()}).catch(function(t){})},showRightMenu:function(t,e,i,o){if(this.isMobile)return t.preventDefault();this.selectedIndex=o,this.selectedItem=i,this.$easycm(t,e)},rightMenuClick:function(t){"CHECK"==this.rightMenuList[t[0]].type&&this.onAlbumClick(this.selectedIndex)},calImageWidth:function(){var t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin);t&&(this.itemWidth=t)},onAlbumClick:function(t){this.selectedItem=this.dataList[t],this.showAlbumDetail=!0,this.addModalToList(this.$refs.refModalAlbumDetail)},getClassesList:function(){var o=this;this.loading=!0,this.api.post("/api/photoApi/getPhotoClasses",{}).then(function(t){if(!t.code){o.enable=t.enable,o.dataList=t.data;for(var e=0;e<o.dataList.length;e++){var i=o.dataList[e],i=c.a.getImgFullPath(i.photo_index_id,!0);o.dataList[e].url=i}o.dataList.length<1&&o.enable&&o.getDealState(),o.$nextTick(function(){o.calImageWidth()})}o.loading=!1}).catch(function(t){o.loading=!1})},getDealState:function(){var e=this;this.api.post("/api/photoApi/getAiDealState",{hideLoading:!0,type:"cocossd"}).then(function(t){t.code||t.data&&t.data.cocossdWaitDealCount&&(1==t.data.isIndexing?e.dealState=e.$t("photo.indexingNoAi"):t.data.cocossdWaitDealCount&&(e.dealState=e.$t("photo.waitDealCount",{count:t.data.cocossdWaitDealCount}),1<t.data.cocossdWaitDealCount)&&(e.checkStateTimeout=setTimeout(function(){e.getFaceDealState()},8e3)))}).catch(function(t){})}}};a("95b4");l=Object(r.a)(v,function(){var o=this,t=o._self._c;return t("div",{staticClass:"album-root-wrapper"},[t("div",{staticStyle:{position:"absolute",width:"100%","margin-top":"150px",display:"flex","flex-direction":"column","align-items":"center"}},[!o.loading&&o.dataList.length<1?t("my-nodata",{attrs:{title:o.$t("photo.classes")}}):o._e(),o.enable?o._e():t("my-btn",{staticStyle:{"margin-top":"20px"},attrs:{title:o.$t("photo.enableClass")},on:{click:o.enableClass}}),o.enable&&o.dealState?t("div",{staticStyle:{"margin-top":"10px"}},[o._v("["+o._s(o.dealState)+"]")]):o._e()],1),t("div",{staticStyle:{width:"100%",display:"flex",height:"100%","flex-direction":"row",overflow:"hidden"}},[t("div",{ref:"listWrapper",staticClass:"album-list-root"},[o._l(o.dataList,function(e,i){return t("vs-card",{style:{margin:o.itemMargin+"px",width:o.itemWidth+"px"},attrs:{type:"1"},on:{click:function(t){return o.onAlbumClick(i)},contextmenu:function(t){return o.showRightMenu(t,o.$root,e,i)}},scopedSlots:o._u([{key:"title",fn:function(){return["coco_ssd"==e.class_type?t("h3",{staticStyle:{"text-align":"left"}},[o._v(o._s(o.$t("coco.".concat(e.class_name))))]):o._e(),"mobilenet"==e.class_type?t("h3",{staticStyle:{"text-align":"left"}},[o._v(" "+o._s(e.class_name))]):o._e()]},proxy:!0},{key:"img",fn:function(){return[e.url?t("img",{staticStyle:{"object-fit":"cover"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:e.url}}):t("img",{staticStyle:{"object-fit":"cover"},style:{width:o.itemWidth+"px",height:o.itemWidth+"px"},attrs:{src:a("915f")}})]},proxy:!0},{key:"text",fn:function(){return[t("h3",{staticStyle:{"text-align":"left"}},[o._v(o._s())])]},proxy:!0}],null,!0)})}),t("div",{staticStyle:{width:"100%",height:"50px"}})],2)]),t("Modal",{ref:"refModalAlbumDetail",attrs:{scrollable:!1,"footer-hide":"","class-name":"modal-style-nopadding",fullscreen:"",closable:!1},model:{value:o.showAlbumDetail,callback:function(t){o.showAlbumDetail=t},expression:"showAlbumDetail"}},[o.showAlbumDetail?t("album-detail",{attrs:{propsShowSearchBtn:!1,propsTitle:o.$t("coco.".concat(o.selectedItem.class_name)),propsShowAddToAlbum:!1,propsShowDelete:!1,propsShowModeSwitch:!1,propsAiClassId:o.selectedItem.class_id+""},on:{onClose:function(t){return o.historyBack()}}}):o._e()],1),t("easy-cm",{attrs:{list:o.rightMenuList},on:{ecmcb:o.rightMenuClick}})],1)},[],!1,null,"673802de",null).exports,v={components:{photoFaces:g.default,photoClasses:l,albumSmart:n,ordinaryAlbumContent:h.default},data:function(){return{orderField:"id",orderType:"desc",showSettingDialog:!1,menuId:"smartAlbum",menuList:[{title:this.$t("photo.smartAlbum"),id:"smartAlbum"},{title:this.$t("photo.ordinaryAlbum"),id:"ordinaryAlbum"},{title:this.$t("photo.aiFace"),id:"aiFace"},{title:this.$t("photo.aiClasses"),id:"aiClasses"}],settingData:{aiFaceMinPhotoCount:5,aiClassesEnable:!1,aiFaceEnable:!1}}},mounted:function(){localStorage["photo-my-album-selected-type"]&&(this.menuId=localStorage["photo-my-album-selected-type"],this.$refs.myAlbumMenuSelect.setSelectedId(this.menuId))},beforeDestroy:function(){},methods:{onClickAdd:function(){"smartAlbum"==this.menuId?this.$refs.smartAlbum.onClickAdd():"ordinaryAlbum"==this.menuId&&this.$refs.ordinaryAlbum.onClickAdd()},onSearch:function(t){"smartAlbum"==this.menuId?this.$refs.smartAlbum.onSearch(t):"ordinaryAlbum"==this.menuId&&this.$refs.ordinaryAlbum.onSearch(t)},clickOrder:function(){"smartAlbum"==this.menuId?this.$refs.smartAlbum.clickOrder(this.orderField,this.orderType):"ordinaryAlbum"==this.menuId&&this.$refs.ordinaryAlbum.clickOrder(this.orderField,this.orderType)},showSetting:function(){this.showSettingDialog=!0,this.getAllConfig()},onChooseMenu:function(t){this.menuId=t,localStorage["photo-my-album-selected-type"]=t},resetFaceAi:function(){var e=this;this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("setting.aiFaceResetAlert"),function(){e.api.post("/api/photoApi/resetFaceAi",{}).then(function(t){t.code||e.showVsNotification(e.$t("common.operationSuccess"))})})},saveConfig:function(){var e=this,t=Object(b.a)({},this.settingData);t.aiClassesEnable=t.aiClassesEnable?"1":"0",t.aiFaceEnable=t.aiFaceEnable?"1":"0",this.api.post("/api/commonApi/saveConfigPhoto",t).then(function(t){e.showVsNotification(e.$t("setting.saveSuccess")),e.showSettingDialog=!1}).catch(function(t){})},getAllConfig:function(){var o=this;this.api.post("/api/commonApi/getAllConfig",{keys:["aiClassesEnable","aiFaceEnable"]}).then(function(t){for(var e=0;e<t.data.allConfig.length;e++){var i=t.data.allConfig[e];"aiClassesEnable"==i.title?o.settingData.aiClassesEnable="1"==i.value:"aiFaceEnable"==i.title?o.settingData.aiFaceEnable="1"==i.value:"aiFaceMinPhotoCount"==i.title&&(o.settingData.aiFaceMinPhotoCount=i.value)}}).catch(function(t){})}}};a("93c0");g=Object(r.a)(v,function(){var e=this,t=e._self._c;return t("div",{staticClass:"photo-root"},[t("div",{staticStyle:{display:"flex","align-items":"center",width:"100%",padding:"10px 20px",height:"60px","justify-content":"space-between"}},[t("my-menu-select",{ref:"myAlbumMenuSelect",attrs:{optionList:e.menuList},on:{onItemClick:e.onChooseMenu}}),t("div",{staticStyle:{display:"flex","text-align":"right"}},["aiFace"==e.menuId||"aiClasses"==e.menuId?t("div",[t("span",{staticClass:"nasIcons icon-setting-system",staticStyle:{"font-size":"25px",color:"#999999"},on:{click:e.showSetting}})]):e._e(),"smartAlbum"==e.menuId||"ordinaryAlbum"==e.menuId?t("div",{staticStyle:{"margin-left":"10px",display:"flex","align-items":"center"}},[t("span",{staticClass:"nasIcons icon-add operation-icon",on:{click:function(t){return e.onClickAdd()}}})]):e._e(),"smartAlbum"==e.menuId||"ordinaryAlbum"==e.menuId?t("div",{staticStyle:{"margin-left":"10px",display:"flex","align-items":"center"}},[t("Poptip",{attrs:{placement:"bottom"},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",{staticClass:"sort-root"},[t("div",[e._v(e._s(e.$t("common.sortField")))]),t("RadioGroup",{staticStyle:{"margin-top":"5px"},attrs:{vertical:""},on:{"on-change":e.clickOrder},model:{value:e.orderField,callback:function(t){e.orderField=t},expression:"orderField"}},[t("Radio",{attrs:{label:"name"}},[t("span",[e._v(e._s(e.$t("common.name")))])]),t("Radio",{attrs:{label:"id"}},[t("span",[e._v(e._s(e.$t("movie.createTime")))])])],1),t("div",{staticStyle:{"margin-top":"15px"}},[e._v(e._s(e.$t("common.sortType")))]),t("RadioGroup",{staticStyle:{"margin-top":"5px"},attrs:{vertical:""},on:{"on-change":e.clickOrder},model:{value:e.orderType,callback:function(t){e.orderType=t},expression:"orderType"}},[t("Radio",{attrs:{label:"asc"}},[t("span",[e._v(e._s(e.$t("common.asc")))])]),t("Radio",{attrs:{label:"desc"}},[t("span",[e._v(e._s(e.$t("common.desc")))])])],1)],1)]},proxy:!0}],null,!1,2712173160)},["asc"==e.orderType?t("span",{staticClass:"nasIcons icon-sort-alpha-up operation-icon"}):e._e(),"desc"==e.orderType?t("span",{staticClass:"nasIcons icon-sort-alpha-down-alt operation-icon"}):e._e()])],1):e._e(),"smartAlbum"==e.menuId||"ordinaryAlbum"==e.menuId?t("div",{staticStyle:{"margin-left":"10px"}},[t("my-search",{ref:"mySearch",staticStyle:{"max-width":"200px"},attrs:{shrinkModeTh:800,placeholder:e.$t("common.pleaseInputSearchContent")},on:{onSearch:e.onSearch}})],1):e._e()])],1),"smartAlbum"==e.menuId?t("album-smart",{ref:"smartAlbum"}):e._e(),"ordinaryAlbum"==e.menuId?t("ordinaryAlbumContent",{ref:"ordinaryAlbum"}):e._e(),"aiFace"==e.menuId?t("photo-faces"):e._e(),"aiClasses"==e.menuId?t("photo-classes"):e._e(),t("vs-dialog",{scopedSlots:e._u([{key:"header",fn:function(){return[t("h4",{staticClass:"not-margin"},[e._v(" "+e._s(e.$t("setting.photoFuncsSetting"))+" ")])]},proxy:!0},{key:"footer",fn:function(){return[t("div",{staticStyle:{width:"100%","padding-top":"10px","padding-bottom":"10px"},on:{click:e.saveConfig}},[t("my-btn",{staticStyle:{width:"80%"},attrs:{title:e.$t("common.commit")}})],1)]},proxy:!0}]),model:{value:e.showSettingDialog,callback:function(t){e.showSettingDialog=t},expression:"showSettingDialog"}},[t("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column","align-items":"center"}},[t("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","margin-top":"20px","justify-content":"flex-start",width:"100%"}},[t("div",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.$t("photo.aiClasses")))]),t("i-switch",{model:{value:e.settingData.aiClassesEnable,callback:function(t){e.$set(e.settingData,"aiClassesEnable",t)},expression:"settingData.aiClassesEnable"}})],1)]),t("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column","align-items":"center"}},[t("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","margin-top":"20px","justify-content":"flex-start",width:"100%"}},[t("div",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.$t("photo.aiFace")))]),t("i-switch",{model:{value:e.settingData.aiFaceEnable,callback:function(t){e.$set(e.settingData,"aiFaceEnable",t)},expression:"settingData.aiFaceEnable"}}),t("vs-button",{staticStyle:{height:"25px","line-height":"25px","flex-shrink":"0","min-width":"60px","margin-left":"10px","z-index":"0"},attrs:{flat:"",border:""},on:{click:function(t){return e.resetFaceAi()}}},[e._v(" "+e._s(e.$t("Reset")))])],1)]),t("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column","align-items":"center"}},[t("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","margin-top":"20px","justify-content":"flex-start",width:"100%"}},[t("div",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.$t("photo.aiFaceMinPhotoCount")))]),t("Input",{staticStyle:{width:"50px"},attrs:{type:"number",clearable:""},model:{value:e.settingData.aiFaceMinPhotoCount,callback:function(t){e.$set(e.settingData,"aiFaceMinPhotoCount",t)},expression:"settingData.aiFaceMinPhotoCount"}})],1)])])],1)},[],!1,null,"4c535d0a",null).exports;a("a9e3");l={props:{pageSize:{type:Number,default:5}},components:{photoDetail:m.default},data:function(){return{dealState:"",rightMenuList:[{text:this.$t("file.check"),type:"CHECK"}],showPhotoDetail:!1,changeAlbumName:"",itemBaseWidth:220,itemWidth:220,itemMargin:10,selectedItem:"",showAddAlbum:!1,dataList:[],loading:!1,selectedIndex:!1,enable:!0,checkStateTimeout:null,waitDealCount:0}},mounted:function(){this.getDealList(),window.addEventListener("resize",this.calImageWidth)},beforeDestroy:function(){window.removeEventListener("resize",this.calImageWidth),clearTimeout(this.checkStateTimeout)},methods:{checkImage:function(t,e){var i,o=this,a=(this.showPhotoDetail=!0,this.dataList[t].similarIndexList);for(i in a)a[i].type=1;this.$nextTick(function(){o.$refs.photoDetail.showImg(a,e)})},nameClick:function(t,e){this.dataList[t].similarIndexList[e].checked=!this.dataList[t].similarIndexList[e].checked,this.$forceUpdate()},enableSimilarPhoto:function(){var e=this;this.api.post("/api/commonApi/saveConfigPhoto",{aiSimilarPhotoEnable:"1"}).then(function(t){e.getDealList()}).catch(function(t){})},rightMenuClick:function(t){"CHECK"==this.rightMenuList[t[0]].type&&this.onAlbumClick(this.selectedIndex)},calImageWidth:function(){var t=this.$refs.listWrapper.getBoundingClientRect(),t=this.utils.calItemWidth(t,this.itemBaseWidth,this.itemMargin);t&&(this.itemWidth=t)},getDealList:function(){var r=this;this.loading=!0,this.api.post("/api/photoApi/getSimilarPhoto",{count:this.pageSize}).then(function(t){if(!t.code){r.enable=t.enable,r.dataList=t.data,r.waitDealCount=t.waitDealCount-r.dataList.length;for(var e=0;e<r.dataList.length;e++){var i,o,a=r.dataList[e],s=0,n=0;for(i in a.similarIndexList){var l=c.a.getImgFullPath(r.dataList[e].similarIndexList[i].id,!0)+"&ts="+(new Date).getTime();r.dataList[e].similarIndexList[i].url=l,r.dataList[e].similarIndexList[i].size>n&&(n=r.dataList[e].similarIndexList[i].size,s=i)}for(o in a.similarIndexList)r.dataList[e].similarIndexList[o].checked=s==o;r.dataList;a=c.a.getImgFullPath(a.indexObj.id,!0);r.dataList[e].indexObj.url=a,r.$nextTick(function(){r.calImageWidth()})}r.dataList.length<1&&r.enable&&r.getDealState()}r.loading=!1}).catch(function(t){r.loading=!1})},dealSimilarPhotoApi:function(t){var e,i=this,o=(this.dataList,[]);for(e in this.dataList){var a,s=[];for(a in this.dataList[e].similarIndexList)(t||this.dataList[e].similarIndexList[a].checked)&&s.push(this.dataList[e].similarIndexList[a].id);o.push({index_id:this.dataList[e].index_id,keepIndexList:s})}this.api.post("/api/photoApi/dealSimilarPhoto",{dealList:o}).then(function(t){t.code||(i.showVsNotification(i.$t("common.operationSuccess")),i.$refs.listWrapper.scrollTo({top:0}),i.getDealList())}).catch(function(t){})},getDealState:function(){var e=this;this.api.post("/api/photoApi/getAiDealState",{hideLoading:!0,type:"similar"}).then(function(t){t.code||t.data&&t.data.similarWaitDealCount&&(1==t.data.isIndexing?e.dealState=e.$t("photo.indexingNoAi"):t.data.similarWaitDealCount&&(e.dealState=e.$t("photo.waitDealCount",{count:t.data.similarWaitDealCount}),1<t.data.similarWaitDealCount)&&(e.checkStateTimeout=setTimeout(function(){e.getDealState()},8e3)))}).catch(function(t){})}}};a("d2c4");var v=Object(r.a)(l,function(){var a=this,s=a._self._c;return s("div",{staticClass:"root-wrapper"},[s("div",{staticStyle:{"z-index":"2",position:"absolute",width:"100%","margin-top":"150px",display:"flex","flex-direction":"column","align-items":"center"}},[!a.loading&&a.dataList.length<1?s("my-nodata",{attrs:{title:a.$t("photo.noSimilarPhoto")}}):a._e(),a.enable?a._e():s("div",{on:{click:function(t){return a.enableSimilarPhoto()}}},[s("my-btn",{staticStyle:{"margin-top":"20px"},attrs:{title:a.$t("photo.enableSimilarPhoto")}})],1),a.enable&&a.dealState?s("div",{staticStyle:{"margin-top":"10px"}},[a._v("["+a._s(a.dealState)+"]")]):a._e()],1),s("div",{ref:"listWrapper",staticClass:"list-root"},[a._l(a.dataList,function(t,o){return s("div",{staticClass:"list-item-root"},[s("div",{staticStyle:{width:"100%","text-align":"left","font-size":"18px","margin-bottom":"10px","margin-top":"10px","font-weight":"bold"}},[a._v(" "+a._s(o+1+"."+a.$t("photo.checkKeepPhoto")))]),a._l(t.similarIndexList,function(e,i){return s("div",{staticClass:"item-div"},[s("img",{staticClass:"item-img",attrs:{src:e.url},on:{click:function(t){return a.checkImage(o,i)}}}),s("div",{staticStyle:{"margin-top":"10px",display:"flex","flex-direction":"column"},on:{click:function(t){return a.nameClick(o,i)}}},[s("div",{staticClass:"max-line-one",staticStyle:{"text-align":"left"}},[a._v(a._s(a.$t("common.folder"))+": "+a._s(e.path))]),s("div",{staticClass:"max-line-one",staticStyle:{"text-align":"left"}},[a._v(a._s(a.$t("common.name"))+": "+a._s(e.filename))]),s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("Checkbox",{model:{value:e.checked,callback:function(t){a.$set(e,"checked",t)},expression:"similarItem.checked"}}),s("span",{staticStyle:{color:"#999999"}},[a._v(a._s(a.utils.getSizeStr(e.size)))])],1)])])})],2)}),0<a.dataList.length?s("div",{staticStyle:{width:"100%",height:"200px"}},[s("div",{staticStyle:{"padding-top":"20px"}},[a._v(a._s(a.$t("photo.leftSimilarGroupCount",{count:a.waitDealCount})))])]):a._e()],2),0<a.dataList.length?s("div",{staticClass:"bottom-root"},[s("div",{on:{click:function(t){return t.stopPropagation(),a.dealSimilarPhotoApi(!0)}}},[s("my-btn",{attrs:{title:a.$t("photo.keepAll")}})],1),s("div",{on:{click:function(t){return t.stopPropagation(),a.dealSimilarPhotoApi(!1)}}},[s("my-btn",{staticStyle:{"margin-left":"10px"},attrs:{type:"red",title:a.$t("photo.moveSimilarToTrash")}})],1)]):a._e(),s("easy-cm",{attrs:{list:a.rightMenuList},on:{ecmcb:a.rightMenuClick}}),a.showPhotoDetail?s("photo-detail",{ref:"photoDetail",attrs:{enableExif:!1},on:{onClose:function(t){a.showPhotoDetail=!1}}}):a._e()],1)},[],!1,null,"91ef09c4",null).exports,l=(a("d81d"),a("e9f5"),a("ab43"),a("d3b7"),a("e25e"),a("498a"),a("f047")),x=a("e11e"),w=a.n(x);a("6cc5");x={props:{},components:{VueHorizontal:l.a,photoDetail:m.default},data:function(){return{currentTilesServer:"",isSelectedAll:!0,locationStr:"",currentLatitude:null,currentLongitude:null,placeList:[],placeStr:"",map:null,imgMaker:null,showPhotoDetail:!1,dealList:[],loading:!1,nearIndex:null,useNearIndex:-1}},mounted:function(){this.getWaitAddGpsIndex()},beforeDestroy:function(){},methods:{usePreNearIndex:function(){!this.nearIndex&&this.nearIndex.length<1||(0==this.useNearIndex?this.useNearIndex=this.nearIndex.length-1:--this.useNearIndex,this.map&&this.nearIndex&&0<this.nearIndex.length&&this.addMarker(this.nearIndex[this.useNearIndex].latitude,this.nearIndex[this.useNearIndex].longitude))},useNextNearIndex:function(){!this.nearIndex&&this.nearIndex.length<1||(this.useNearIndex>=this.nearIndex.length-1?this.useNearIndex=0:this.useNearIndex+=1,this.map&&this.nearIndex&&0<this.nearIndex.length&&this.addMarker(this.nearIndex[this.useNearIndex].latitude,this.nearIndex[this.useNearIndex].longitude))},onSelectAllChange:function(t){for(var e in this.dealList)this.dealList[e].selected=t},onItemSelect:function(t){},changeSelect:function(t,e){this.dealList[t].selected=e,this.$forceUpdate()},skipList:function(){var t=this;this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.sureSkipAddGps"),function(){t.confirmAddGps("SKIP")})},confirmList:function(){var t=this;this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("photo.sureAddGps"),function(){t.confirmAddGps("CONFIRM")})},confirmAddGps:function(e){var i=this;if(this.dealList.length<1)return this.showVsNotification(this.$t("photo.noPendingPhotos"));var t,o=[];for(t in this.dealList)this.dealList[t].selected&&o.push(this.dealList[t].id);this.api.post("/api/addGpsApi/confirmAddGps",{type:e,latitude:this.currentLatitude,longitude:this.currentLongitude,indexIdList:o,hideLoading:!0}).then(function(t){t.code||("CONFIRM"==e?(i.showVsNotification(i.$t("photo.gpsAddSuccess")),setTimeout(function(){i.getWaitAddGpsIndex()},500)):i.getWaitAddGpsIndex())}).catch(function(t){})},getOptionStr:function(t){return t.cn_name+" "+t.name},onSearchSelect:function(t){for(var e in this.placeList)if(t==this.getOptionStr(this.placeList[e]))return void this.addMarker(this.placeList[e].latitude,this.placeList[e].longitude)},onPhotoClick:function(t){var e=this;this.showPhotoDetail=!0,this.$nextTick(function(){e.$refs.photoDetail.showImg(e.dealList,t)})},onUsePhotoClick:function(){var t=this;this.showPhotoDetail=!0,this.$nextTick(function(){t.$refs.photoDetail.showImg([t.nearIndex[t.useNearIndex]],0)})},getLocationStr:function(){var e=this;this.api.post("/api/mapApi/getLocationStr",{lat:this.currentLatitude,lng:this.currentLongitude,hideLoading:!0}).then(function(t){t.code||(e.locationStr=e.getOptionStr(t.geo))}).catch(function(t){})},searchPlace:function(t){var e=this;(t=t.trim())&&this.api.post("/api/mapApi/searchLocation",{searchStr:t,count:15,hideLoading:!0}).then(function(t){t.code||(e.placeList=t.data)}).catch(function(t){})},resetPosition:function(){this.map&&this.nearIndex&&0<this.nearIndex.length&&this.addMarker(this.nearIndex[0].latitude,this.nearIndex[0].longitude)},addMarker:function(t,e){this.imgMaker&&this.map.removeLayer(this.imgMaker);var i=w.a.icon({iconUrl:"icon_position.png",iconSize:[38,38]}),o=this.utils.transCoordinateForShow(this.currentTilesServer,e,t);this.imgMaker=w.a.marker([o[1],o[0]],{icon:i}),this.map&&(this.currentLatitude=t,this.currentLongitude=e,this.getLocationStr(),this.imgMaker.addTo(this.map),o=new w.a.LatLng(t,e),this.map.flyTo(o))},initMap:function(t,e){var i,o,a,s,n=this;!this.nearIndex||this.nearIndex.length<1||(i=this.nearIndex[0],this.useNearIndex=0,s=this.axios.mapUrl(),o=new w.a.LatLng(i.latitude,i.longitude),a=parseInt(e/2),s=new w.a.TileLayer(s,{minZoom:t,maxZoom:e,attribution:"NORMAL"}),t=w.a.latLng(-90,-360),e=w.a.latLng(90,360),t={maxBounds:w.a.latLngBounds(t,e),zoom:a,center:o,layers:[s],attributionControl:!1},this.map&&(this.map.remove(),this.map=null),this.map=new w.a.Map("positionMap",t),this.map.on("click",function(t){n.addMarker(t.latlng.lat,t.latlng.lng)}),this.addMarker(i.latitude,i.longitude))},getZoomInfo:function(){var e=this;this.api.post("/api/mapApi/getZoom",{hideLoading:!0}).then(function(t){t.code||(t.tileServer&&(e.currentTilesServer=t.tileServer),e.initMap(parseInt(t.zoomInfo.minZoom),parseInt(t.zoomInfo.maxZoom)))}).catch(function(t){})},getWaitAddGpsIndex:function(){var s=this;this.loading=!0,this.dealList=[],this.locationStr="",this.api.post("/api/addGpsApi/getWaitAddGpsIndex",{}).then(function(t){if(s.loading=!1,!t.code){if(!t.data.dealList)return s.showVsAlertDialog(s.$t("common.alert"),s.$t("photo.noPendingPhotos"));for(var e in s.nearIndex=t.data.nearIndex,s.dealList=t.data.dealList,s.nearIndex){var i=s.nearIndex[e];s.nearIndex[e].url=s.axios.getImgFullPath(i.id,!0,i.filename),s.nearIndex[e].rawUrl=s.axios.getImgFullPath(i.id,!1,i.filename),s.nearIndex[e].selected=0==e}for(var o in s.dealList){var a=s.dealList[o];s.dealList[o].url=s.axios.getImgFullPath(a.id,!0,a.filename),s.dealList[o].rawUrl=s.axios.getImgFullPath(a.id,!1,a.filename),s.dealList[o].selected=!0}s.$nextTick(function(){s.getZoomInfo()})}}).catch(function(t){s.loading=!1})}}};a("0bb0");l={components:{photoSimilar:v,addGps:Object(r.a)(x,function(){var o=this,t=o._self._c;return t("div",{staticClass:"root"},[o.dealList&&0<o.dealList.length?t("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("p",{staticClass:"title"},[o._v(o._s(o.$t("photo.dealListForAddGps"))+":")]),t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("Checkbox",{on:{"on-change":o.onSelectAllChange},model:{value:o.isSelectedAll,callback:function(t){o.isSelectedAll=t},expression:"isSelectedAll"}},[o._v(o._s(o.$t("common.selectAll")))]),t("a",{on:{click:function(t){o.showVsAlertDialog(o.$t("help.howToWork"),o.$t("help.addGpsHelp"))}}},[t("span",[o._v(o._s(o.$t("common.help")))]),t("Icon",{staticStyle:{"font-weight":"bold",cursor:"pointer"},attrs:{type:"ios-help-circle-outline"}})],1)],1)]):o._e(),t("div",{staticClass:"top"},[o.dealList.length<1&&!o.loading?t("div",{staticStyle:{"margin-top":"20px"}},[o._v(o._s(o.$t("photo.noCanAddGpsPhoto"))+" "),t("a",{on:{click:function(t){o.showVsAlertDialog(o.$t("help.howToWork"),o.$t("help.addGpsHelp"))}}},[t("span",[o._v(o._s(o.$t("common.help")))]),t("Icon",{staticStyle:{"font-weight":"bold",cursor:"pointer"},attrs:{type:"ios-help-circle-outline"}})],1)]):o._e(),t("div",{staticClass:"photo-list"},o._l(o.dealList,function(e,i){return t("div",{staticClass:"photo-root"},[t("img",{staticClass:"photo-img",attrs:{src:e.url},on:{click:function(t){return o.onPhotoClick(i)}}}),t("p",{staticClass:"max-line-two",staticStyle:{"margin-top":"5px","word-break":"break-all"}},[o._v(" "+o._s(e.filename)+" ")]),e&&e.original_time?t("div",{staticStyle:{color:"grey","font-size":"12px"}},[o._v(" "+o._s(o.utils.formatTimeStamp(e.original_time)))]):o._e(),t("Checkbox",{staticStyle:{position:"absolute",top:"5px",right:"5px"},on:{"on-change":o.onItemSelect},model:{value:e.selected,callback:function(t){o.$set(e,"selected",t)},expression:"item.selected"}})],1)}),0)]),o.dealList&&0<o.dealList.length?t("Divider",{staticStyle:{"background-color":"#bbb",margin:"10px 0"}}):o._e(),0<o.dealList.length?t("div",{staticClass:"bottom-root"},[t("div",{staticClass:"bottom-left"},[t("p",{staticClass:"title"},[o._v(o._s(o.$t("photo.confirmPhotoLocation")))]),t("div",{staticClass:"map-root"},[t("div",{staticClass:"positionMap",attrs:{id:"positionMap"}}),t("div",{staticStyle:{display:"flex","flex-direction":"column",position:"absolute",right:"10px",top:"10px","z-index":"400","background-color":"rgba(255,255,255,0.5)",padding:"10px"}},[t("p",{staticStyle:{"text-align":"left"}},[o._v("["+o._s(o.locationStr)+"]")]),t("div",{staticStyle:{"text-align":"left"}},[o._v(o._s(o.$t("useWhitePhotoGps"))+":")]),t("div",{staticStyle:{display:"flex","align-items":"center",position:"relative"}},[o.nearIndex&&-1<o.useNearIndex?t("img",{class:{"use-photo-img":o.isMobile,"use-photo-img-pc":!o.isMobile},attrs:{src:o.nearIndex[o.useNearIndex].url},on:{click:function(t){return o.onUsePhotoClick()}}}):o._e(),t("div",{staticStyle:{position:"absolute",right:"5px",bottom:"5px",display:"flex"}},[t("Button",{staticStyle:{"margin-right":"5px"},attrs:{shape:"circle",icon:"md-arrow-dropleft"},on:{click:o.usePreNearIndex}}),t("Button",{attrs:{shape:"circle",icon:"md-arrow-dropright"},on:{click:o.useNextNearIndex}})],1),t("div",{staticClass:"number-root"},[t("span",{staticStyle:{color:"white","font-size":"10px"}},[o._v(o._s(o.useNearIndex+1)+"/")]),t("span",{staticStyle:{color:"white","font-size":"10px"}},[o._v(o._s(o.nearIndex.length))])]),t("div",{staticClass:"date-root"},[o.nearIndex[o.useNearIndex]&&o.nearIndex[o.useNearIndex].original_time?t("div",{staticStyle:{color:"white","font-size":"10px"}},[o._v(" "+o._s(o.utils.formatTimeStamp(o.nearIndex[o.useNearIndex].original_time)))]):o._e()])]),t("Button",{staticClass:"btn-item",staticStyle:{"margin-top":"20px"},attrs:{icon:"md-sync"},on:{click:o.resetPosition}},[o._v(o._s(o.$t("photo.restorePosition")))]),t("Button",{staticClass:"btn-item",attrs:{type:"warning",icon:"md-fastforward"},on:{click:o.skipList}},[o._v(o._s(o.$t("photo.skipAddGps")))]),t("Button",{staticClass:"btn-item",attrs:{type:"primary",icon:"md-pin"},on:{click:o.confirmList}},[o._v(o._s(o.$t("photo.wirteGps")))])],1)])])]):o._e(),o.showPhotoDetail?t("photo-detail",{ref:"photoDetail",on:{onClose:function(t){o.showPhotoDetail=!1}}}):o._e()],1)},[],!1,null,"7068f347",null).exports},data:function(){return{similarPageSize:5,showSettingDialog:!1,menuId:"1",menuList:[{title:this.$t("photo.aiSimilarPhoto"),id:"1"},{title:this.$t("photo.gpsAdd"),id:"2"}],settingData:{aiSimilarPhotoEnable:!1}}},mounted:function(){},beforeDestroy:function(){},methods:{onSimilarPageSizeChange:function(t){this.similarPageSize=t,this.$nextTick(function(){this.$refs.photoSimilar.getDealList()})},showSetting:function(){this.showSettingDialog=!0,this.getAllConfig()},onChooseMenu:function(t){this.menuId=t},resetSimilarPhotoAi:function(){var e=this;this.showVsConfirmDialog(this.$t("common.confirm"),this.$t("setting.similarPhotoResetAlert"),function(){e.api.post("/api/photoApi/resetSimilarPhotoAi",{}).then(function(t){t.code||e.showVsNotification(e.$t("common.operationSuccess"))})})},saveConfig:function(){var e=this,t=Object(b.a)({},this.settingData);t.aiSimilarPhotoEnable=t.aiSimilarPhotoEnable?"1":"0",this.api.post("/api/commonApi/saveConfigPhoto",t).then(function(t){e.showVsNotification(e.$t("setting.saveSuccess")),e.showSettingDialog=!1}).catch(function(t){})},getAllConfig:function(){var o=this;this.api.post("/api/commonApi/getAllConfig",{keys:["aiSimilarPhotoEnable"]}).then(function(t){for(var e=0;e<t.data.allConfig.length;e++){var i=t.data.allConfig[e];"aiSimilarPhotoEnable"==i.title&&(o.settingData.aiSimilarPhotoEnable="1"==i.value)}}).catch(function(t){})}}};a("ba65");m=Object(r.a)(l,function(){var e=this,t=e._self._c;return t("div",{staticClass:"photo-root"},[t("div",{staticStyle:{display:"flex","align-items":"center",width:"100%",padding:"20px",height:"60px"}},[t("my-menu-select",{attrs:{shrinkModeTh:300,optionList:e.menuList},on:{onItemClick:e.onChooseMenu}}),"1"==e.menuId?t("Select",{staticStyle:{width:"100px","margin-left":"10px"},on:{"on-change":e.onSimilarPageSizeChange},model:{value:e.similarPageSize,callback:function(t){e.similarPageSize=t},expression:"similarPageSize"}},[t("Option",{key:5,attrs:{value:5}},[e._v(e._s(e.$t("pageCount",{count:"5"})))]),t("Option",{key:10,attrs:{value:10}},[e._v(e._s(e.$t("pageCount",{count:"10"})))]),t("Option",{key:20,attrs:{value:20}},[e._v(e._s(e.$t("pageCount",{count:"20"})))]),t("Option",{key:50,attrs:{value:50}},[e._v(e._s(e.$t("pageCount",{count:"50"})))]),t("Option",{key:100,attrs:{value:100}},[e._v(e._s(e.$t("pageCount",{count:"100"})))])],1):e._e(),t("div",{staticStyle:{flex:"1","text-align":"right"}},[t("span",{staticClass:"nasIcons icon-setting-system",staticStyle:{"font-size":"25px",color:"#999999"},on:{click:e.showSetting}})])],1),"1"==e.menuId?t("photo-similar",{ref:"photoSimilar",attrs:{pageSize:e.similarPageSize}}):e._e(),"2"==e.menuId?t("addGps"):e._e(),t("vs-dialog",{scopedSlots:e._u([{key:"header",fn:function(){return[t("h4",{staticClass:"not-margin"},[e._v(" "+e._s(e.$t("setting.photoFuncsSetting"))+" ")])]},proxy:!0},{key:"footer",fn:function(){return[t("div",{staticStyle:{width:"100%","padding-top":"10px","padding-bottom":"10px"},on:{click:e.saveConfig}},[t("my-btn",{staticStyle:{width:"80%"},attrs:{title:e.$t("common.commit")}})],1)]},proxy:!0}]),model:{value:e.showSettingDialog,callback:function(t){e.showSettingDialog=t},expression:"showSettingDialog"}},[t("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column","align-items":"center"}},[t("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","margin-top":"20px","justify-content":"flex-start",width:"100%"}},[t("div",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.$t("photo.aiSimilarPhoto")))]),t("i-switch",{model:{value:e.settingData.aiSimilarPhotoEnable,callback:function(t){e.$set(e.settingData,"aiSimilarPhotoEnable",t)},expression:"settingData.aiSimilarPhotoEnable"}}),t("vs-button",{staticStyle:{height:"25px","line-height":"25px","flex-shrink":"0","min-width":"60px","margin-left":"10px","z-index":"0"},attrs:{flat:"",border:""},on:{click:function(t){return e.resetSimilarPhotoAi()}}},[e._v(" "+e._s(e.$t("Reset")))])],1)])])],1)},[],!1,null,"4a2e5f64",null).exports,v={props:{hasPadding:{default:!1,type:Boolean}},mounted:function(){this.getAllConfig()},components:{},data:function(){return{sizeOptionList:[{label:2e3},{label:3e3},{label:4e3},{label:5e3},{label:6e3},{label:7e3},{label:8e3}],settingData:{photoPreviewType:"RAW",photoPreviewSize:3e3}}},computed:{},methods:{saveConfigApi:function(t,e){var i=this;this.api.post("/api/commonApi/saveConfigPhoto",t).then(function(t){i.showVsNotification(i.$t("setting.saveSuccessRestartValid")),e&&e(),localStorage.imagePreviewType=i.settingData.photoPreviewType,localStorage.imagePreviewSize=i.settingData.photoPreviewSize}).catch(function(t){})},saveConfig:function(t){var e=Object(b.a)({},this.settingData);this.saveConfigApi(e,t)},getAllConfig:function(){var o=this;this.api.post("/api/commonApi/getAllConfig",{keys:["photoPreviewType","photoPreviewSize"]}).then(function(t){for(var e=0;e<t.data.allConfig.length;e++){var i=t.data.allConfig[e];"photoPreviewType"==i.title?o.settingData.photoPreviewType=i.value||"RAW":"photoPreviewSize"==i.title&&(o.settingData.photoPreviewSize=parseInt(i.value||"3000"))}}).catch(function(t){})}}};a("b426");x=Object(r.a)(v,function(){var i=this,o=i._self._c;return o("div",{staticClass:"setting-root-wrapper",class:{"setting-padding":i.hasPadding}},[o("div",{staticClass:"common-setting-root",attrs:{id:"setting-wrapper"}},[o("div",{staticClass:"item-root-wrapper"},[o("Divider",{attrs:{plain:""}},[i._v(i._s(i.$t("imgPreviewSize")))]),o("div",{staticClass:"item-root-margin"},[o("div",{staticStyle:{"margin-right":"20px"}},[i._v(i._s(i.$t("imgPreviewSize"))+":")]),o("RadioGroup",{model:{value:i.settingData.photoPreviewType,callback:function(t){i.$set(i.settingData,"photoPreviewType",t)},expression:"settingData.photoPreviewType"}},[o("Radio",{attrs:{label:"RAW"}},[o("span",[i._v(i._s(i.$t("rawFile")))])]),o("Radio",{attrs:{label:"CUSTOM"}},[o("span",[i._v(i._s(i.$t("Custom")))])])],1)],1),"CUSTOM"==i.settingData.photoPreviewType?o("div",{staticClass:"item-root-margin"},[o("div",{staticStyle:{"margin-right":"20px"}},[i._v(i._s(i.$t("longSideMaxPx"))+":")]),o("Select",{staticStyle:{width:"120px"},model:{value:i.settingData.photoPreviewSize,callback:function(t){i.$set(i.settingData,"photoPreviewSize",t)},expression:"settingData.photoPreviewSize"}},i._l(i.sizeOptionList,function(t,e){return o("Option",{key:e,attrs:{value:t.label}},[i._v(i._s(t.label)+" ")])}),1)],1):i._e(),o("p",{staticClass:"preview_alert"},[i._v(i._s(i.$t("imgPreviewAlert")))])],1)]),o("div",{staticClass:"bottom-root"},[o("my-btn",{staticStyle:{"min-width":"260px"},attrs:{title:i.$t("common.commit")},on:{click:i.saveConfig}})],1)])},[],!1,null,"f1e9f082",null).exports,l={props:{},components:{photoTimelineContent:o.default,photoMapContent:s.default,myHeader:i.a,albumSmart:n,ordinaryAlbum:h.default,libraryPage:d.a,folderView:u.a,photoRecent:S,photoTrash:f,photoSourceSet:p,photoMyAlbum:g,photoTools:m,photoSetting:x},mounted:function(){var t=!1;if(localStorage.photoViewType)for(var e in this.sideOptionList)if(this.sideOptionList[e].id==localStorage.photoViewType){this.viewType=localStorage.photoViewType,t=!0,this.$refs.sidebarMobile&&this.$refs.sidebarMobile.setIndex(e),this.$refs.sidebar&&this.$refs.sidebar.setIndex(e);break}t||(this.viewType="photoTimeline")},data:function(){return{viewType:"",sideOptionList:[{id:"photoTimeline",title:this.$t("photo.timeline"),font:"nasIcons icon-timeline"},{id:"photoMap",title:this.$t("photo.footprint"),font:"nasIcons icon-footprint"},{id:"photoMyAlbum",title:this.$t("photo.myAlbum"),font:"nasIcons icon-face-detect"},{id:"photoLibrary",title:this.$t("photo.library"),font:"nasIcons icon-ziliaoku"},{id:"photoFolderView",title:this.$t("photo.folder"),font:"nasIcons icon-folder-iew"},{id:"photoTools",title:this.$t("tools"),font:"nasIcons icon-tools",onlyAdmin:!0},{id:"photoRecent",title:this.$t("photo.recentCheck"),font:"nasIcons icon-recent"},{id:"photoTrash",title:this.$t("file.trashBin"),font:"nasIcons icon-trash"},{id:"photoSetting",title:this.$t("setting"),font:"nasIcons icon-setting-system"},{id:"photoSourceSet",title:this.$t("setting.photoSourceSetting"),font:"nasIcons icon-24gf-folderPlus",onlyAdmin:!0}]}},computed:{},methods:{setViewType:function(t){this.viewType=t,this.$refs.sidebar.setSelectById(t),this.$refs.sidebarMobile.setSelectById(t),this.viewType},setLeftMenuId:function(t){t=t.id;this.viewType=t,window.localStorage.photoViewType=t}}},a("d40c"),v=Object(r.a)(l,function(){var t=this,e=t._self._c;return e("div",{staticClass:"photos-root"},[e("my-bg"),t._m(0),e("div",{staticClass:"nas-mobile-none"},[e("my-header")],1),e("div",{staticClass:"main-layout nas-padding-right-zero"},[e("div",{staticClass:"sidebar-root"},[e("my-sidebar",{ref:"sidebar",attrs:{name:"photo",optionList:t.sideOptionList},on:{onItemClick:t.setLeftMenuId}})],1),e("div",{staticClass:"sidebar-mobile-root"},[e("my-sidebar-mobile",{ref:"sidebarMobile",attrs:{name:"photo",optionList:t.sideOptionList},on:{onItemClick:t.setLeftMenuId}})],1),e("div",{staticClass:"right-layout"},["photoTimeline"==t.viewType?e("photo-timeline-content",{on:{setViewType:t.setViewType}}):t._e(),"photoMap"==t.viewType?e("photo-map-content",{on:{setViewType:t.setViewType}}):t._e(),"albumSmart"==t.viewType?e("album-smart",{on:{setViewType:t.setViewType}}):t._e(),"ordinaryAlbum"==t.viewType?e("ordinary-album",{on:{setViewType:t.setViewType}}):t._e(),"photoLibrary"==t.viewType?e("library-page",{attrs:{isPhotoLibrary:!0},on:{setViewType:t.setViewType}}):t._e(),"photoFolderView"==t.viewType?e("folder-view",{on:{setViewType:t.setViewType}}):t._e(),"photoRecent"==t.viewType?e("photo-recent",{on:{setViewType:t.setViewType}}):t._e(),"photoTrash"==t.viewType?e("photo-trash",{on:{setViewType:t.setViewType}}):t._e(),"photoSourceSet"==t.viewType?e("photo-source-set",{on:{setViewType:t.setViewType}}):t._e(),"photoSetting"==t.viewType?e("photo-setting",{on:{setViewType:t.setViewType}}):t._e(),"photoMyAlbum"==t.viewType?e("photo-my-album",{on:{setViewType:t.setViewType}}):t._e(),"photoTools"==t.viewType?e("photo-tools",{on:{setViewType:t.setViewType}}):t._e()],1)])],1)},[function(){var t=this._self._c;return t("div",{staticClass:"nas-mobile-none"},[t("p",{staticClass:"my-header-position"})])}],!1,null,"2d6910d4",null);e.default=v.exports}}]);