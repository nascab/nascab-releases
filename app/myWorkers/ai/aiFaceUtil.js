const _0x1be7a2=_0x205b;(function(_0x3d50d8,_0x13d4fc){const _0x5dfade=_0x205b,_0x225085=_0x3d50d8();while(!![]){try{const _0x2db475=parseInt(_0x5dfade(0x105))/0x1*(-parseInt(_0x5dfade(0x168))/0x2)+-parseInt(_0x5dfade(0xfa))/0x3+-parseInt(_0x5dfade(0x11c))/0x4+-parseInt(_0x5dfade(0x140))/0x5+parseInt(_0x5dfade(0x153))/0x6+parseInt(_0x5dfade(0x148))/0x7+-parseInt(_0x5dfade(0x14e))/0x8*(-parseInt(_0x5dfade(0x157))/0x9);if(_0x2db475===_0x13d4fc)break;else _0x225085['push'](_0x225085['shift']());}catch(_0x1bac80){_0x225085['push'](_0x225085['shift']());}}}(_0x12a7,0x8b1f1));const fs=require('fs'),path=require(_0x1be7a2(0x15f)),tfjs=require('@tensorflow/tfjs'),wasm=require(_0x1be7a2(0x101)),sharpUtil=require(_0x1be7a2(0xed)),exifUtils=require(_0x1be7a2(0x15a)),urlConfig=require('../../myConfig/urlConfig'),faceapi=require('../../libs/faceapi/face-api.node-wasm'),config=require(_0x1be7a2(0xfc)),Database=require(_0x1be7a2(0x133)),https=require('https'),dbConfigTable=require(_0x1be7a2(0x16a));process[_0x1be7a2(0xeb)]=_0x1be7a2(0x147);let dbFileIndex=new Database(config['dbFileIndex'],{}),dbOther=new Database(config[_0x1be7a2(0x107)],{});dbOther['pragma'](_0x1be7a2(0xf1)),dbFileIndex[_0x1be7a2(0x120)]('journal_mode\x20=\x20WAL'),process['on']('exit',()=>{const _0x927cdf=_0x1be7a2;dbOther[_0x927cdf(0x116)](),dbFileIndex[_0x927cdf(0x116)]();});const DEAL_GAP=0x7530;let TABLE_NAME_FACE2INDEX='photo_faces2index',TABLE_NAME_PHOTO_FACES=_0x1be7a2(0xea),modelInit=![],modelSavePath=path[_0x1be7a2(0x103)](config[_0x1be7a2(0x143)],_0x1be7a2(0x14f),_0x1be7a2(0x111));!fs[_0x1be7a2(0x117)](modelSavePath)&&fs[_0x1be7a2(0x102)](modelSavePath,{'recursive':!![]});let modelBaseUrl=urlConfig[_0x1be7a2(0x12f)](dbOther,'modeUrl_ai_face'),modelFileUrlList=[],modelFileList=[_0x1be7a2(0x13e),_0x1be7a2(0x110),_0x1be7a2(0xf6),_0x1be7a2(0x122),_0x1be7a2(0x158),_0x1be7a2(0x135),_0x1be7a2(0x10b),_0x1be7a2(0x11e)];for(let i=0x0;i<modelFileList['length'];i++){modelFileUrlList[_0x1be7a2(0xf5)](modelBaseUrl+modelFileList[i]);}function httpDownload(_0x28c8ee,_0x2d2af1,_0xe32182){return new Promise((_0x203387,_0x2ece2a)=>{const _0x18ca1a=_0x205b;https[_0x18ca1a(0xef)](_0x28c8ee,_0x26a9e8=>{const _0x4fb0d8=_0x18ca1a,_0x1364db=fs[_0x4fb0d8(0x164)](_0x2d2af1);_0x26a9e8[_0x4fb0d8(0x106)](_0x1364db),_0x1364db['on'](_0x4fb0d8(0x131),()=>{const _0x27a0ec=_0x4fb0d8;_0x1364db[_0x27a0ec(0x116)](),fs['renameSync'](_0x2d2af1,_0xe32182),_0x203387();})['on']('error',_0xc6f714=>{});})['on'](_0x18ca1a(0x15d),_0xc62303=>{_0x2ece2a(_0xc62303['message']);});});}function downloadModelFile(){return new Promise(async(_0x239fa9,_0x2f8433)=>{const _0x4bac52=_0x205b;try{for(let _0x2e9a4f=0x0;_0x2e9a4f<modelFileList[_0x4bac52(0x129)];_0x2e9a4f++){let _0x1bffda=path[_0x4bac52(0x103)](modelSavePath,modelFileList[_0x2e9a4f]),_0x8a7ef5=path[_0x4bac52(0x103)](modelSavePath,_0x4bac52(0x139)+modelFileList[_0x2e9a4f]);if(!fs['existsSync'](_0x1bffda)){let _0x1f637e=modelFileUrlList[_0x2e9a4f];await httpDownload(_0x1f637e,_0x8a7ef5,_0x1bffda);}else{}}_0x239fa9();}catch(_0x53786f){_0x2f8433(_0x53786f);}});}async function initFaceAPI(){return new Promise(async(_0x22cf5f,_0x361beb)=>{const _0xfd37b3=_0x205b;try{!modelInit&&(await downloadModelFile(),await tfjs['setBackend'](_0xfd37b3(0x15b)),await tfjs[_0xfd37b3(0x10f)](),await faceapi[_0xfd37b3(0x13c)][_0xfd37b3(0x10a)][_0xfd37b3(0x12b)](modelSavePath),await faceapi[_0xfd37b3(0x13c)]['faceLandmark68Net'][_0xfd37b3(0x12b)](modelSavePath),await faceapi['nets']['faceRecognitionNet'][_0xfd37b3(0x12b)](modelSavePath),modelInit=!![]),_0x22cf5f();}catch(_0x143ad4){console[_0xfd37b3(0x167)](_0x143ad4),_0x361beb(_0x143ad4);}});}let currentDetectIndex=null;function _0x12a7(){const _0x4e7e93=['(face_descriptor)\x20VALUES(?)','_box','tmp_','_distance','(photo_index_id,score,x,y,width,height,face_descriptor)\x20\x20VALUES(?,?,?,?,?,?,?)','nets','SELECT\x20id\x20from\x20','face_landmark_68_tiny_model.bin','\x20where\x20belong_face_id=','2694380SzbKpG','catch','raw','userDataFolder','endScope','uncaughtException','face_descriptor','NasCabAiFace','7739193vapXYD','SELECT\x20*\x20from\x20','engine','dispose','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20(type=1\x20OR\x20type=2)\x20AND\x20ai_face_detect_state=0\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20is_raw!=1\x20\x20LIMIT\x201','_height','670376ERvIEW','tfModel','detection','\x20WHERE\x20\x20compare_state=0\x20\x20and\x20face_id\x20is\x20null\x20LIMIT\x201','width','243708UVevni','\x20and\x20disabled=0','findBestMatch',',\x20compare_state=1\x20where\x20id\x20=\x20','171RtKjqM','ssd_mobilenetv1_model.bin','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','../../utils/exifUtils','wasm','channels','error','filename','path','REPLACE\x20INTO\x20\x20','face_id','\x20,min_similar_score=','\x20where\x20face_id\x20in\x20','createWriteStream','descriptor','withFaceDescriptors','log','15898oxahdO','\x20SET\x20face_photo_count=','../../db/dbConfigTable','resize','photo_faces','title','\x20AND\x20(type=1\x20OR\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20ai_face_detect_state=0\x20\x20AND\x20is_raw!=1\x20LIMIT\x201','../../express-server/utils/sharpUtils','withFaceLandmarks','get','min_similar_score','journal_mode\x20=\x20WAL','values','\x20where\x20belong_face_id\x20is\x20null','all','push','face_recognition_model.bin','type','jpeg','aiFaceEnable','1044363gVNUSD','_score','../../myConfig/config','deleteRawTempFile','stringify','REPLACE\x20INTO\x20','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20where\x20id=','@tensorflow/tfjs-backend-wasm','mkdirSync','join','startScope','93mHmeuE','pipe','dbOther','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20WHERE\x20ai_face_detect_state=0\x20and\x20size<=','AI_FACES','ssdMobilenetv1','face_landmark_68_model.bin','\x20SET\x20compare_state=1\x20where\x20id=','tensor','then','ready','face_landmark_68_tiny_model-weights_manifest.json','faceapi_models','value','\x20SET\x20face_id=','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20size>','getSharpInstanceFromInput','close','existsSync','stat','\x20where\x20face_photo_count<1\x20and\x20belong_face_id\x20is\x20null','FaceMatcher','SELECT\x20COUNT(photo_index_id)\x20as\x20count\x20FROM\x20','2169060giaiJR','toBuffer','face_landmark_68_model-weights_manifest.json','lastInsertRowid','pragma','parse','face_recognition_model-weights_manifest.json','exit','slice','transSpcielFormat','_width','prepare','DELETE\x20FROM\x20','length','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','loadFromDisk','run','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','UPDATE\x20','getUrlByUrlKey','send','finish','rotate','better-sqlite3','tiny_path','ssd_mobilenetv1_model-weights_manifest.json','count'];_0x12a7=function(){return _0x4e7e93;};return _0x12a7();}function runInfinitDetectFaces(){return new Promise(async _0x1561c0=>{const _0x29c94c=_0x205b;let _0xa73032;try{let _0x150775=0x32*0x400;dbFileIndex[_0x29c94c(0x127)](_0x29c94c(0x108)+_0x150775)[_0x29c94c(0x12c)](),_0xa73032=dbFileIndex['prepare'](_0x29c94c(0x114)+_0x150775+_0x29c94c(0xec))['get']();if(!_0xa73032)return setTimeout(()=>{_0x1561c0();},DEAL_GAP);currentDetectIndex=_0xa73032,await initFaceAPI();try{bgTaskId&&dbOther[_0x29c94c(0x127)](_0x29c94c(0x159)+bgTaskId)[_0x29c94c(0x12c)]();}catch(_0x54bfba){}function _0x15f82f(){const _0x4a154b=_0x29c94c;dbFileIndex['prepare'](_0x4a154b(0x100)+_0xa73032['id'])[_0x4a154b(0x12c)](),currentDetectIndex=null,_0x1561c0();}let _0x281037=path[_0x29c94c(0x103)](_0xa73032['path'],_0xa73032[_0x29c94c(0x15e)]);parseInt(_0xa73032[_0x29c94c(0xf7)])==0x2&&(_0x281037=path[_0x29c94c(0x103)](_0xa73032[_0x29c94c(0x134)]));let _0x1803c3=0x7d0;fs[_0x29c94c(0x118)](_0x281037,async(_0x188f1b,_0x9e605a)=>{const _0x4da6a6=_0x29c94c;if(_0x188f1b)return _0x15f82f();sharpUtil[_0x4da6a6(0x125)](_0x281037,(_0x31021b,_0x297f1b,_0x13cefe)=>{const _0x496de2=_0x4da6a6;let _0x3589e6=sharpUtil[_0x496de2(0x115)](_0x31021b),_0x3116cc=exifUtils['getRotateFromTags'](_0x13cefe);_0x3116cc?_0x3589e6=_0x3589e6['rotate'](_0x3116cc):_0x3589e6=_0x3589e6[_0x496de2(0x132)](),_0x3589e6[_0x496de2(0xe9)]({'width':_0x1803c3,'height':_0x1803c3,'withoutEnlargement':!![]})[_0x496de2(0xf8)]()[_0x496de2(0x142)]()[_0x496de2(0x11d)](async(_0x445d35,_0x5f3273,_0x3ea4aa)=>{const _0x3d77ee=_0x496de2;_0x297f1b&&sharpUtil[_0x3d77ee(0xfd)](_0x31021b);if(_0x445d35)return _0x5f3273=null,_0x15f82f();let _0x24a537;try{faceapi['tf'][_0x3d77ee(0x14a)]()[_0x3d77ee(0x104)](),temp=tfjs[_0x3d77ee(0x10d)](_0x5f3273,[_0x3ea4aa['height'],_0x3ea4aa[_0x3d77ee(0x152)],_0x3ea4aa[_0x3d77ee(0x15c)]]),_0x24a537=tfjs[_0x3d77ee(0x124)](temp,[0x0,0x0,0x0],[-0x1,-0x1,0x3]),faceapi['tf']['dispose'](temp);}catch(_0x2c5d27){if(_0x24a537)faceapi['tf'][_0x3d77ee(0x14b)](_0x24a537);if(temp)faceapi['tf'][_0x3d77ee(0x14b)](temp);return faceapi['tf'][_0x3d77ee(0x14a)]()['endScope'](),_0x15f82f();}_0x5f3273=null,faceapi['detectAllFaces'](_0x24a537)[_0x3d77ee(0xee)]()[_0x3d77ee(0x166)]()[_0x3d77ee(0x10e)](_0x403dfe=>{const _0x279a79=_0x3d77ee;faceapi['tf'][_0x279a79(0x14b)](_0x24a537),faceapi['tf'][_0x279a79(0x14a)]()[_0x279a79(0x144)]();if(!_0x403dfe[_0x279a79(0x129)])return _0x15f82f();let _0xce2e38=[];for(let _0x994057 of _0x403dfe){let _0x20bd1e=_0x994057[_0x279a79(0x150)][_0x279a79(0x138)][_0x279a79(0x126)],_0x660e9=_0x994057[_0x279a79(0x150)]['_box'][_0x279a79(0x14d)];if(_0x20bd1e>_0x1803c3||_0x660e9>_0x1803c3)continue;let _0x1a7d5d=_0x994057[_0x279a79(0x150)][_0x279a79(0xfb)];if(_0x20bd1e<0x50||_0x660e9<0x50||_0x1a7d5d<0.8)continue;_0xce2e38['push'](_0x994057);}if(!_0xce2e38[_0x279a79(0x129)])return _0x15f82f();for(let _0x2aaa7e=0x0;_0x2aaa7e<_0xce2e38[_0x279a79(0x129)];_0x2aaa7e++){let _0x5f285e=_0xce2e38[_0x2aaa7e],_0x58f816=_0x5f285e[_0x279a79(0x150)]['_box'];dbFileIndex[_0x279a79(0x127)](_0x279a79(0x160)+TABLE_NAME_FACE2INDEX+_0x279a79(0x13b))[_0x279a79(0x12c)](_0xa73032['id'],_0x5f285e[_0x279a79(0x150)]['_score'],_0x58f816['_x'],_0x58f816['_y'],_0x58f816['_width'],_0x58f816['_height'],JSON[_0x279a79(0xfe)](_0x5f285e[_0x279a79(0x165)]));}return _0x403dfe=null,_0x15f82f();})[_0x3d77ee(0x141)](_0x3a2503=>{const _0x153c07=_0x3d77ee;return _0x297f1b&&sharpUtil[_0x153c07(0xfd)](_0x31021b),faceapi['tf'][_0x153c07(0x14b)](_0x24a537),faceapi['tf'][_0x153c07(0x14a)]()[_0x153c07(0x144)](),_0x15f82f();});});});});}catch(_0x23367d){_0xa73032&&dbFileIndex[_0x29c94c(0x127)](_0x29c94c(0x100)+_0xa73032['id'])['run'](),_0x1561c0();}});}function exitProcess(){const _0x7a3f63=_0x1be7a2;try{bgTaskId&&dbOther['prepare'](_0x7a3f63(0x12d)+bgTaskId)[_0x7a3f63(0x12c)]();}catch(_0x488494){}return process['send']({'type':_0x7a3f63(0x116)}),statisticFacePhotoCount(),process['exit']();}function runInfinitCompareFaces(){let _0x47660f=0.35;return new Promise(async _0x2547b6=>{const _0x266ee7=_0x205b;let _0x1ce0b3=dbFileIndex['prepare'](_0x266ee7(0x14c))[_0x266ee7(0xef)]();if(_0x1ce0b3)return setTimeout(()=>{_0x2547b6();},DEAL_GAP);let _0xfc36c5;try{try{bgTaskId&&dbOther[_0x266ee7(0x127)](_0x266ee7(0x159)+bgTaskId)[_0x266ee7(0x12c)]();}catch(_0x5739b8){}_0xfc36c5=dbFileIndex[_0x266ee7(0x127)](_0x266ee7(0x149)+TABLE_NAME_FACE2INDEX+_0x266ee7(0x151))[_0x266ee7(0xef)]();if(!_0xfc36c5)return exitProcess();await initFaceAPI();function _0x519a06(){const _0x18b276=_0x266ee7;dbFileIndex[_0x18b276(0x127)](_0x18b276(0x12e)+TABLE_NAME_FACE2INDEX+'\x20SET\x20compare_state=1\x20where\x20id='+_0xfc36c5['id'])[_0x18b276(0x12c)](),_0x2547b6();}let _0x59b789=new Float32Array(Object['values'](JSON['parse'](_0xfc36c5[_0x266ee7(0x146)])));const _0x324e67=new faceapi[(_0x266ee7(0x11a))]([_0x59b789]);let _0x31a5dc=[_0xfc36c5],_0x366acc=dbFileIndex[_0x266ee7(0x127)](_0x266ee7(0x13d)+TABLE_NAME_FACE2INDEX+'\x20where\x20id!='+_0xfc36c5['id'])['all'](),_0x2e5be0=0x1,_0x3fcd82=null;for(let _0x523b0b=0x0;_0x523b0b<_0x366acc[_0x266ee7(0x129)];_0x523b0b++){let _0x32a44a=dbFileIndex[_0x266ee7(0x127)](_0x266ee7(0x149)+TABLE_NAME_FACE2INDEX+'\x20WHERE\x20id='+_0x366acc[_0x523b0b]['id'])['get']();if(!_0x32a44a)continue;const _0x1f8d45=_0x324e67[_0x266ee7(0x155)](new Float32Array(Object[_0x266ee7(0xf2)](JSON[_0x266ee7(0x121)](_0x32a44a['face_descriptor']))));_0x1f8d45[_0x266ee7(0x13a)]<_0x47660f&&(_0x1f8d45[_0x266ee7(0x13a)]<_0x2e5be0&&_0x32a44a['face_id']&&(_0x2e5be0=_0x1f8d45[_0x266ee7(0x13a)],_0x3fcd82=_0x32a44a[_0x266ee7(0x161)]),_0x1f8d45[_0x266ee7(0x13a)]<_0x32a44a['min_similar_score']&&(_0x32a44a[_0x266ee7(0xf0)]=_0x1f8d45['_distance'],_0x31a5dc[_0x266ee7(0xf5)](_0x32a44a)));}if(_0x31a5dc[_0x266ee7(0x129)]<0x2){if(_0x3fcd82&&!_0xfc36c5[_0x266ee7(0x161)]){let _0x3e9522=_0x266ee7(0x12e)+TABLE_NAME_FACE2INDEX+_0x266ee7(0x113)+_0x3fcd82+_0x266ee7(0x162)+_0x2e5be0+',\x20compare_state=1\x20where\x20id\x20=\x20'+_0xfc36c5['id'];dbFileIndex[_0x266ee7(0x127)](_0x3e9522)['run']();}else{}return _0x519a06();}let _0x44b18b={};for(let _0xd028dd=0x0;_0xd028dd<_0x31a5dc[_0x266ee7(0x129)];_0xd028dd++){let _0x576074=_0x31a5dc[_0xd028dd]['face_id'];_0x576074&&(_0x44b18b[_0x576074]?_0x44b18b[_0x576074]+=0x1:_0x44b18b[_0x576074]=0x1);}if(Object['keys'](_0x44b18b)[_0x266ee7(0x129)]>0x0){let _0x42ec2d=0x0,_0x537f54=0x0;for(let _0x3fde8a in _0x44b18b){_0x44b18b[_0x3fde8a]>_0x537f54&&(_0x537f54=_0x44b18b[_0x3fde8a],_0x42ec2d=_0x3fde8a);}if(_0x537f54>0x0&&_0x537f54>=(_0x31a5dc[_0x266ee7(0x129)]-0x1)/0x6){for(let _0x3f20d0 in _0x31a5dc){let _0x2e40e6='UPDATE\x20'+TABLE_NAME_FACE2INDEX+'\x20SET\x20face_id='+_0x42ec2d+'\x20,min_similar_score='+_0x31a5dc[_0x3f20d0][_0x266ee7(0xf0)]+',\x20compare_state=1\x20where\x20id\x20=\x20'+_0x31a5dc[_0x3f20d0]['id'];dbFileIndex['prepare'](_0x2e40e6)['run']();}return _0x519a06();}else{let _0x1ff511=dbFileIndex[_0x266ee7(0x127)]('REPLACE\x20INTO\x20'+TABLE_NAME_PHOTO_FACES+'(face_descriptor)\x20VALUES(?)')[_0x266ee7(0x12c)](JSON[_0x266ee7(0xfe)](_0x59b789));for(let _0x3768cb in _0x31a5dc){let _0x4cb5de='UPDATE\x20'+TABLE_NAME_FACE2INDEX+_0x266ee7(0x113)+_0x1ff511['lastInsertRowid']+_0x266ee7(0x162)+_0x31a5dc[_0x3768cb][_0x266ee7(0xf0)]+_0x266ee7(0x156)+_0x31a5dc[_0x3768cb]['id'];dbFileIndex[_0x266ee7(0x127)](_0x4cb5de)[_0x266ee7(0x12c)]();}return _0x519a06();}}else{let _0x56de38=dbFileIndex[_0x266ee7(0x127)](_0x266ee7(0xff)+TABLE_NAME_PHOTO_FACES+_0x266ee7(0x137))[_0x266ee7(0x12c)](JSON['stringify'](_0x59b789));for(let _0x37012e in _0x31a5dc){let _0xd52200=_0x266ee7(0x12e)+TABLE_NAME_FACE2INDEX+_0x266ee7(0x113)+_0x56de38[_0x266ee7(0x11f)]+'\x20,min_similar_score='+_0x31a5dc[_0x37012e][_0x266ee7(0xf0)]+_0x266ee7(0x156)+_0x31a5dc[_0x37012e]['id'];dbFileIndex[_0x266ee7(0x127)](_0xd52200)[_0x266ee7(0x12c)]();}return _0x519a06();}}catch(_0x55a465){console[_0x266ee7(0x167)](_0x55a465),_0xfc36c5&&dbFileIndex[_0x266ee7(0x127)]('UPDATE\x20'+TABLE_NAME_FACE2INDEX+_0x266ee7(0x10c)+_0xfc36c5['id'])[_0x266ee7(0x12c)](),_0x2547b6();}});}function _0x205b(_0x556eac,_0x27afc7){const _0x12a79c=_0x12a7();return _0x205b=function(_0x205b98,_0x50863d){_0x205b98=_0x205b98-0xe9;let _0x12bc6a=_0x12a79c[_0x205b98];return _0x12bc6a;},_0x205b(_0x556eac,_0x27afc7);}async function runFaceDetect(){const _0x4edde1=_0x1be7a2;let _0x42637f=dbConfigTable['findByTitle'](dbOther,_0x4edde1(0xf9));_0x42637f&&_0x42637f[_0x4edde1(0x112)]=='1'?runInfinitDetectFaces()[_0x4edde1(0x10e)](()=>{runFaceDetect();}):exitProcess();}async function runFaceCompare(){runInfinitCompareFaces()['then'](()=>{runFaceCompare();});}function statisticFacePhotoCount(){const _0x3adb53=_0x1be7a2;try{let _0x2e2bf6=dbFileIndex['prepare']('SELECT\x20id\x20from\x20'+TABLE_NAME_PHOTO_FACES+_0x3adb53(0xf3))[_0x3adb53(0xf4)]();for(let _0x4ddd93 of _0x2e2bf6){let _0xb0f4f8=dbFileIndex[_0x3adb53(0x127)]('SELECT\x20id\x20from\x20'+TABLE_NAME_PHOTO_FACES+_0x3adb53(0x13f)+_0x4ddd93['id'])[_0x3adb53(0xf4)]();_0xb0f4f8[_0x3adb53(0xf5)](_0x4ddd93);let _0x573991='(';for(let _0x18702b in _0xb0f4f8){_0x573991+=_0xb0f4f8[_0x18702b]['id'],_0x18702b!=_0xb0f4f8[_0x3adb53(0x129)]-0x1&&(_0x573991+=',');}_0x573991+=')';let _0x245fe4=dbFileIndex['prepare'](_0x3adb53(0x11b)+TABLE_NAME_FACE2INDEX+_0x3adb53(0x163)+_0x573991+_0x3adb53(0x154))[_0x3adb53(0xef)]();dbFileIndex['prepare'](_0x3adb53(0x12e)+TABLE_NAME_PHOTO_FACES+_0x3adb53(0x169)+_0x245fe4[_0x3adb53(0x136)]+'\x20where\x20id='+_0x4ddd93['id'])[_0x3adb53(0x12c)]();}dbFileIndex[_0x3adb53(0x127)](_0x3adb53(0x12e)+TABLE_NAME_PHOTO_FACES+'\x20SET\x20face_photo_count=0\x20where\x20belong_face_id\x20is\x20not\x20null')['run'](),dbFileIndex['prepare'](_0x3adb53(0x128)+TABLE_NAME_PHOTO_FACES+_0x3adb53(0x119))[_0x3adb53(0x12c)]();}catch(_0x4cec90){console[_0x3adb53(0x167)](_0x4cec90);}}let bgTaskId;try{let info=dbOther[_0x1be7a2(0x127)](_0x1be7a2(0x12a))[_0x1be7a2(0x12c)](_0x1be7a2(0x109));bgTaskId=info['lastInsertRowid'];}catch(_0x4b85e9){}async function main(){setTimeout(async()=>{runFaceDetect();},0x7d0),setTimeout(async()=>{runFaceCompare();},0x1388);}main(),process['on'](_0x1be7a2(0x145),(_0x48b9c8,_0x10f4e1)=>{const _0x571100=_0x1be7a2;currentDetectIndex&&dbFileIndex[_0x571100(0x127)](_0x571100(0x100)+currentDetectIndex['id'])[_0x571100(0x12c)](),process[_0x571100(0x130)]({'type':_0x571100(0x116)}),process[_0x571100(0x123)]();});