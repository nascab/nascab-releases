const _0x506b3e=_0x6c9a;(function(_0x667def,_0x2f681e){const _0x4d38d5=_0x6c9a,_0x287c65=_0x667def();while(!![]){try{const _0x363744=-parseInt(_0x4d38d5(0x168))/0x1*(-parseInt(_0x4d38d5(0x134))/0x2)+-parseInt(_0x4d38d5(0x15a))/0x3*(parseInt(_0x4d38d5(0x145))/0x4)+parseInt(_0x4d38d5(0x18b))/0x5*(parseInt(_0x4d38d5(0x1ac))/0x6)+-parseInt(_0x4d38d5(0x15e))/0x7+parseInt(_0x4d38d5(0x196))/0x8+parseInt(_0x4d38d5(0x155))/0x9*(-parseInt(_0x4d38d5(0x19a))/0xa)+parseInt(_0x4d38d5(0x14d))/0xb*(parseInt(_0x4d38d5(0x195))/0xc);if(_0x363744===_0x2f681e)break;else _0x287c65['push'](_0x287c65['shift']());}catch(_0x23e7bf){_0x287c65['push'](_0x287c65['shift']());}}}(_0x15a7,0xde43c));const fs=require('fs'),path=require(_0x506b3e(0x1b2)),tfjs=require(_0x506b3e(0x1a7)),wasm=require(_0x506b3e(0x171)),sharpUtil=require('../../express-server/utils/sharpUtils'),exifUtils=require('../../utils/exifUtils'),urlConfig=require('../../myConfig/urlConfig'),faceapi=require('../../libs/faceapi/face-api.node-wasm'),config=require(_0x506b3e(0x16c)),Database=require(_0x506b3e(0x1ab)),https=require(_0x506b3e(0x190)),dbConfigTable=require(_0x506b3e(0x19e));process['title']=_0x506b3e(0x137);function _0x15a7(){const _0x461736=['_box','run','tmp_','tensor','REPLACE\x20INTO\x20','uncaughtException','getSharpInstanceFromInput','getUrlByUrlKey','ready','AI_FACES','245poPZdU','endScope','message','mkdirSync','face_landmark_68_model.bin','https','faceapi_models','stringify','\x20,min_similar_score=','detection','12udCJYr','1550744rEMdlo','\x20where\x20belong_face_id\x20is\x20null','faceLandmark68Net','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','110WMKbUB','face_recognition_model.bin','renameSync','type','../../db/dbConfigTable','FaceMatcher','stat','loadFromDisk','push','photo_faces','\x20SET\x20compare_state=1\x20where\x20id=','height','lastInsertRowid','@tensorflow/tfjs','aiFaceEnable','all','filename','better-sqlite3','197958AZhwxo','(photo_index_id,score,x,y,width,height,face_descriptor)\x20\x20VALUES(?,?,?,?,?,?,?)','detectAllFaces','length','face_id','SELECT\x20*\x20from\x20','path','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','2zNqzZY','dbOther','findByTitle','NasCabAiFace','photo_faces2index','face_descriptor','close','catch','engine','ssd_mobilenetv1_model-weights_manifest.json','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20(type=1\x20OR\x20type=2)\x20AND\x20ai_face_detect_state=0\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20is_raw!=1\x20\x20LIMIT\x201','min_similar_score','startScope','modeUrl_ai_face','rotate','send','join','14468TNuvNF','deleteRawTempFile','dbFileIndex','get','journal_mode\x20=\x20WAL','pragma','nets','faceRecognitionNet','6147262kUQTWR','pipe','withFaceLandmarks','existsSync','setBackend','\x20where\x20face_photo_count<1\x20and\x20belong_face_id\x20is\x20null','face_landmark_68_model-weights_manifest.json','_width','998397sxpFEc','\x20SET\x20face_photo_count=','resize','ssd_mobilenetv1_model.bin','createWriteStream','1101voEQQb','log','count','toBuffer','2422084ZshkiE','dispose','\x20where\x20id!=','\x20and\x20disabled=0','_distance','UPDATE\x20','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20where\x20id=','keys','tfModel','findBestMatch','1434768mBGKsV','ssdMobilenetv1','face_recognition_model-weights_manifest.json','tiny_path','../../myConfig/config','prepare','error','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20WHERE\x20ai_face_detect_state=0\x20and\x20size<=','\x20AND\x20(type=1\x20OR\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20ai_face_detect_state=0\x20\x20AND\x20is_raw!=1\x20LIMIT\x201','@tensorflow/tfjs-backend-wasm','(face_descriptor)\x20VALUES(?)','getRotateFromTags','finish','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','SELECT\x20id\x20from\x20','then','raw','descriptor','_height','\x20SET\x20face_id=','parse',',\x20compare_state=1\x20where\x20id\x20=\x20','exit','DELETE\x20FROM\x20','_score'];_0x15a7=function(){return _0x461736;};return _0x15a7();}let dbFileIndex=new Database(config[_0x506b3e(0x147)],{}),dbOther=new Database(config[_0x506b3e(0x135)],{});dbOther[_0x506b3e(0x14a)]('journal_mode\x20=\x20WAL'),dbFileIndex['pragma'](_0x506b3e(0x149)),process['on'](_0x506b3e(0x17e),()=>{const _0x3a3589=_0x506b3e;dbOther[_0x3a3589(0x13a)](),dbFileIndex[_0x3a3589(0x13a)]();});const DEAL_GAP=0x7530;let TABLE_NAME_FACE2INDEX=_0x506b3e(0x138),TABLE_NAME_PHOTO_FACES=_0x506b3e(0x1a3),modelInit=![],modelSavePath=path['join'](config['userDataFolder'],_0x506b3e(0x166),_0x506b3e(0x191));function _0x6c9a(_0x1f34ed,_0x829756){const _0x15a704=_0x15a7();return _0x6c9a=function(_0x6c9ae1,_0x5e8e9e){_0x6c9ae1=_0x6c9ae1-0x134;let _0x1e239a=_0x15a704[_0x6c9ae1];return _0x1e239a;},_0x6c9a(_0x1f34ed,_0x829756);}!fs[_0x506b3e(0x150)](modelSavePath)&&fs[_0x506b3e(0x18e)](modelSavePath,{'recursive':!![]});let modelBaseUrl=urlConfig[_0x506b3e(0x188)](dbOther,_0x506b3e(0x141)),modelFileUrlList=[],modelFileList=['face_landmark_68_tiny_model.bin','face_landmark_68_tiny_model-weights_manifest.json',_0x506b3e(0x19b),_0x506b3e(0x16a),_0x506b3e(0x158),_0x506b3e(0x13d),_0x506b3e(0x18f),_0x506b3e(0x153)];for(let i=0x0;i<modelFileList['length'];i++){modelFileUrlList[_0x506b3e(0x1a2)](modelBaseUrl+modelFileList[i]);}function httpDownload(_0xe65909,_0xd5029d,_0x40a813){return new Promise((_0x44a1ce,_0x2b2cf2)=>{const _0x50c04c=_0x6c9a;https[_0x50c04c(0x148)](_0xe65909,_0x13ae48=>{const _0x53fbf0=_0x50c04c,_0x5d4dad=fs[_0x53fbf0(0x159)](_0xd5029d);_0x13ae48[_0x53fbf0(0x14e)](_0x5d4dad),_0x5d4dad['on'](_0x53fbf0(0x174),()=>{const _0x5491fa=_0x53fbf0;_0x5d4dad[_0x5491fa(0x13a)](),fs[_0x5491fa(0x19c)](_0xd5029d,_0x40a813),_0x44a1ce();})['on'](_0x53fbf0(0x16e),_0x480f72=>{});})['on'](_0x50c04c(0x16e),_0x4e79e5=>{const _0x2e7532=_0x50c04c;_0x2b2cf2(_0x4e79e5[_0x2e7532(0x18d)]);});});}function downloadModelFile(){return new Promise(async(_0x2f7cc3,_0x1254fd)=>{const _0x2196ea=_0x6c9a;try{for(let _0x17ac76=0x0;_0x17ac76<modelFileList[_0x2196ea(0x1af)];_0x17ac76++){let _0x2138f9=path[_0x2196ea(0x144)](modelSavePath,modelFileList[_0x17ac76]),_0x3ab4d3=path['join'](modelSavePath,_0x2196ea(0x183)+modelFileList[_0x17ac76]);if(!fs[_0x2196ea(0x150)](_0x2138f9)){let _0x578741=modelFileUrlList[_0x17ac76];await httpDownload(_0x578741,_0x3ab4d3,_0x2138f9);}else{}}_0x2f7cc3();}catch(_0xf5cd93){_0x1254fd(_0xf5cd93);}});}async function initFaceAPI(){return new Promise(async(_0x145bf2,_0x1c53e5)=>{const _0x18daf2=_0x6c9a;try{!modelInit&&(await downloadModelFile(),await tfjs[_0x18daf2(0x151)]('wasm'),await tfjs[_0x18daf2(0x189)](),await faceapi[_0x18daf2(0x14b)][_0x18daf2(0x169)][_0x18daf2(0x1a1)](modelSavePath),await faceapi[_0x18daf2(0x14b)][_0x18daf2(0x198)]['loadFromDisk'](modelSavePath),await faceapi[_0x18daf2(0x14b)][_0x18daf2(0x14c)][_0x18daf2(0x1a1)](modelSavePath),modelInit=!![]),_0x145bf2();}catch(_0x2dc161){console['log'](_0x2dc161),_0x1c53e5(_0x2dc161);}});}let currentDetectIndex=null;function runInfinitDetectFaces(){return new Promise(async _0x1f4a06=>{const _0x51dbbc=_0x6c9a;let _0x20e66f;try{let _0x1c08a4=0x32*0x400;dbFileIndex[_0x51dbbc(0x16d)](_0x51dbbc(0x16f)+_0x1c08a4)[_0x51dbbc(0x182)](),_0x20e66f=dbFileIndex['prepare']('SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20size>'+_0x1c08a4+_0x51dbbc(0x170))[_0x51dbbc(0x148)]();if(!_0x20e66f)return setTimeout(()=>{_0x1f4a06();},DEAL_GAP);currentDetectIndex=_0x20e66f,await initFaceAPI();try{bgTaskId&&dbOther[_0x51dbbc(0x16d)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)[_0x51dbbc(0x182)]();}catch(_0x25f683){}function _0x40e23c(){const _0x172d4a=_0x51dbbc;dbFileIndex['prepare'](_0x172d4a(0x164)+_0x20e66f['id'])[_0x172d4a(0x182)](),currentDetectIndex=null,_0x1f4a06();}let _0xbb09eb=path[_0x51dbbc(0x144)](_0x20e66f[_0x51dbbc(0x1b2)],_0x20e66f[_0x51dbbc(0x1aa)]);parseInt(_0x20e66f[_0x51dbbc(0x19d)])==0x2&&(_0xbb09eb=path[_0x51dbbc(0x144)](_0x20e66f[_0x51dbbc(0x16b)]));let _0xcc40e8=0x7d0;fs[_0x51dbbc(0x1a0)](_0xbb09eb,async(_0x30afd,_0x355cb1)=>{if(_0x30afd)return _0x40e23c();sharpUtil['transSpcielFormat'](_0xbb09eb,(_0x32b554,_0x197b8a,_0x4baea3)=>{const _0x55d38d=_0x6c9a;let _0x3d5028=sharpUtil[_0x55d38d(0x187)](_0x32b554),_0x3d3f62=exifUtils[_0x55d38d(0x173)](_0x4baea3);_0x3d3f62?_0x3d5028=_0x3d5028[_0x55d38d(0x142)](_0x3d3f62):_0x3d5028=_0x3d5028[_0x55d38d(0x142)](),_0x3d5028[_0x55d38d(0x157)]({'width':_0xcc40e8,'height':_0xcc40e8,'withoutEnlargement':!![]})['jpeg']()[_0x55d38d(0x178)]()[_0x55d38d(0x15d)](async(_0x340e22,_0x1f3e8c,_0x3f2844)=>{const _0x5eebd9=_0x55d38d;_0x197b8a&&sharpUtil[_0x5eebd9(0x146)](_0x32b554);if(_0x340e22)return _0x1f3e8c=null,_0x40e23c();let _0x2c694a;try{faceapi['tf']['engine']()[_0x5eebd9(0x140)](),temp=tfjs[_0x5eebd9(0x184)](_0x1f3e8c,[_0x3f2844[_0x5eebd9(0x1a5)],_0x3f2844['width'],_0x3f2844['channels']]),_0x2c694a=tfjs['slice'](temp,[0x0,0x0,0x0],[-0x1,-0x1,0x3]),faceapi['tf']['dispose'](temp);}catch(_0x5f3d35){if(_0x2c694a)faceapi['tf'][_0x5eebd9(0x15f)](_0x2c694a);if(temp)faceapi['tf'][_0x5eebd9(0x15f)](temp);return faceapi['tf']['engine']()['endScope'](),_0x40e23c();}_0x1f3e8c=null,faceapi[_0x5eebd9(0x1ae)](_0x2c694a)[_0x5eebd9(0x14f)]()['withFaceDescriptors']()[_0x5eebd9(0x177)](_0x5280c6=>{const _0xe2d77b=_0x5eebd9;faceapi['tf']['dispose'](_0x2c694a),faceapi['tf'][_0xe2d77b(0x13c)]()[_0xe2d77b(0x18c)]();if(!_0x5280c6[_0xe2d77b(0x1af)])return _0x40e23c();let _0x1bab7e=[];for(let _0x186c1d of _0x5280c6){let _0x309a38=_0x186c1d[_0xe2d77b(0x194)][_0xe2d77b(0x181)]['_width'],_0x4d3d0b=_0x186c1d[_0xe2d77b(0x194)]['_box'][_0xe2d77b(0x17a)];if(_0x309a38>_0xcc40e8||_0x4d3d0b>_0xcc40e8)continue;let _0x34989b=_0x186c1d[_0xe2d77b(0x194)][_0xe2d77b(0x180)];if(_0x309a38<0x50||_0x4d3d0b<0x50||_0x34989b<0.8)continue;_0x1bab7e[_0xe2d77b(0x1a2)](_0x186c1d);}if(!_0x1bab7e[_0xe2d77b(0x1af)])return _0x40e23c();for(let _0x5b0ac6=0x0;_0x5b0ac6<_0x1bab7e['length'];_0x5b0ac6++){let _0x5e16b8=_0x1bab7e[_0x5b0ac6],_0x4b4bac=_0x5e16b8[_0xe2d77b(0x194)]['_box'];dbFileIndex[_0xe2d77b(0x16d)]('REPLACE\x20INTO\x20\x20'+TABLE_NAME_FACE2INDEX+_0xe2d77b(0x1ad))[_0xe2d77b(0x182)](_0x20e66f['id'],_0x5e16b8[_0xe2d77b(0x194)][_0xe2d77b(0x180)],_0x4b4bac['_x'],_0x4b4bac['_y'],_0x4b4bac[_0xe2d77b(0x154)],_0x4b4bac[_0xe2d77b(0x17a)],JSON[_0xe2d77b(0x192)](_0x5e16b8[_0xe2d77b(0x179)]));}return _0x5280c6=null,_0x40e23c();})[_0x5eebd9(0x13b)](_0xdcb0e9=>{const _0xdcfa57=_0x5eebd9;return _0x197b8a&&sharpUtil[_0xdcfa57(0x146)](_0x32b554),faceapi['tf'][_0xdcfa57(0x15f)](_0x2c694a),faceapi['tf'][_0xdcfa57(0x13c)]()['endScope'](),_0x40e23c();});});});});}catch(_0x132087){_0x20e66f&&dbFileIndex[_0x51dbbc(0x16d)](_0x51dbbc(0x164)+_0x20e66f['id'])['run'](),_0x1f4a06();}});}function exitProcess(){const _0xea8c89=_0x506b3e;try{bgTaskId&&dbOther['prepare'](_0xea8c89(0x175)+bgTaskId)[_0xea8c89(0x182)]();}catch(_0x38197a){}return process['send']({'type':_0xea8c89(0x13a)}),statisticFacePhotoCount(),process[_0xea8c89(0x17e)]();}function runInfinitCompareFaces(){let _0xc1d0cb=0.35;return new Promise(async _0x29aed1=>{const _0x575b39=_0x6c9a;let _0x2ffdab=dbFileIndex[_0x575b39(0x16d)](_0x575b39(0x13e))[_0x575b39(0x148)]();if(_0x2ffdab)return setTimeout(()=>{_0x29aed1();},DEAL_GAP);let _0x589bc3;try{try{bgTaskId&&dbOther['prepare'](_0x575b39(0x199)+bgTaskId)[_0x575b39(0x182)]();}catch(_0x557e90){}_0x589bc3=dbFileIndex[_0x575b39(0x16d)](_0x575b39(0x1b1)+TABLE_NAME_FACE2INDEX+'\x20WHERE\x20\x20compare_state=0\x20\x20and\x20face_id\x20is\x20null\x20LIMIT\x201')[_0x575b39(0x148)]();if(!_0x589bc3)return exitProcess();await initFaceAPI();function _0x5f3430(){const _0x379254=_0x575b39;dbFileIndex[_0x379254(0x16d)]('UPDATE\x20'+TABLE_NAME_FACE2INDEX+_0x379254(0x1a4)+_0x589bc3['id'])[_0x379254(0x182)](),_0x29aed1();}let _0x4bb4a7=new Float32Array(Object['values'](JSON['parse'](_0x589bc3['face_descriptor'])));const _0x14584e=new faceapi[(_0x575b39(0x19f))]([_0x4bb4a7]);let _0x4a6cb1=[_0x589bc3],_0x378c2d=dbFileIndex[_0x575b39(0x16d)](_0x575b39(0x176)+TABLE_NAME_FACE2INDEX+_0x575b39(0x160)+_0x589bc3['id'])[_0x575b39(0x1a9)](),_0x41f1cc=0x1,_0x3d38cf=null;for(let _0x4aa2e0=0x0;_0x4aa2e0<_0x378c2d[_0x575b39(0x1af)];_0x4aa2e0++){let _0x1903fa=dbFileIndex[_0x575b39(0x16d)](_0x575b39(0x1b1)+TABLE_NAME_FACE2INDEX+'\x20WHERE\x20id='+_0x378c2d[_0x4aa2e0]['id'])[_0x575b39(0x148)]();if(!_0x1903fa)continue;const _0x1dddfa=_0x14584e[_0x575b39(0x167)](new Float32Array(Object['values'](JSON[_0x575b39(0x17c)](_0x1903fa[_0x575b39(0x139)]))));_0x1dddfa[_0x575b39(0x162)]<_0xc1d0cb&&(_0x1dddfa['_distance']<_0x41f1cc&&_0x1903fa[_0x575b39(0x1b0)]&&(_0x41f1cc=_0x1dddfa[_0x575b39(0x162)],_0x3d38cf=_0x1903fa[_0x575b39(0x1b0)]),_0x1dddfa[_0x575b39(0x162)]<_0x1903fa[_0x575b39(0x13f)]&&(_0x1903fa[_0x575b39(0x13f)]=_0x1dddfa[_0x575b39(0x162)],_0x4a6cb1[_0x575b39(0x1a2)](_0x1903fa)));}if(_0x4a6cb1[_0x575b39(0x1af)]<0x2){if(_0x3d38cf&&!_0x589bc3['face_id']){let _0x7c792=_0x575b39(0x163)+TABLE_NAME_FACE2INDEX+_0x575b39(0x17b)+_0x3d38cf+_0x575b39(0x193)+_0x41f1cc+',\x20compare_state=1\x20where\x20id\x20=\x20'+_0x589bc3['id'];dbFileIndex[_0x575b39(0x16d)](_0x7c792)[_0x575b39(0x182)]();}else{}return _0x5f3430();}let _0x1280df={};for(let _0x42d952=0x0;_0x42d952<_0x4a6cb1['length'];_0x42d952++){let _0x3c9615=_0x4a6cb1[_0x42d952][_0x575b39(0x1b0)];_0x3c9615&&(_0x1280df[_0x3c9615]?_0x1280df[_0x3c9615]+=0x1:_0x1280df[_0x3c9615]=0x1);}if(Object[_0x575b39(0x165)](_0x1280df)['length']>0x0){let _0x207fc3=0x0,_0x548a0c=0x0;for(let _0x2bd8fe in _0x1280df){_0x1280df[_0x2bd8fe]>_0x548a0c&&(_0x548a0c=_0x1280df[_0x2bd8fe],_0x207fc3=_0x2bd8fe);}if(_0x548a0c>0x0&&_0x548a0c>=(_0x4a6cb1[_0x575b39(0x1af)]-0x1)/0x6){for(let _0x234db3 in _0x4a6cb1){let _0x1c54f5=_0x575b39(0x163)+TABLE_NAME_FACE2INDEX+_0x575b39(0x17b)+_0x207fc3+_0x575b39(0x193)+_0x4a6cb1[_0x234db3][_0x575b39(0x13f)]+',\x20compare_state=1\x20where\x20id\x20=\x20'+_0x4a6cb1[_0x234db3]['id'];dbFileIndex['prepare'](_0x1c54f5)['run']();}return _0x5f3430();}else{let _0x149857=dbFileIndex['prepare']('REPLACE\x20INTO\x20'+TABLE_NAME_PHOTO_FACES+_0x575b39(0x172))[_0x575b39(0x182)](JSON[_0x575b39(0x192)](_0x4bb4a7));for(let _0x3ae637 in _0x4a6cb1){let _0x43a806=_0x575b39(0x163)+TABLE_NAME_FACE2INDEX+_0x575b39(0x17b)+_0x149857['lastInsertRowid']+_0x575b39(0x193)+_0x4a6cb1[_0x3ae637][_0x575b39(0x13f)]+_0x575b39(0x17d)+_0x4a6cb1[_0x3ae637]['id'];dbFileIndex[_0x575b39(0x16d)](_0x43a806)[_0x575b39(0x182)]();}return _0x5f3430();}}else{let _0x4a42f2=dbFileIndex[_0x575b39(0x16d)](_0x575b39(0x185)+TABLE_NAME_PHOTO_FACES+_0x575b39(0x172))['run'](JSON[_0x575b39(0x192)](_0x4bb4a7));for(let _0x455d24 in _0x4a6cb1){let _0x3bdb74=_0x575b39(0x163)+TABLE_NAME_FACE2INDEX+_0x575b39(0x17b)+_0x4a42f2[_0x575b39(0x1a6)]+_0x575b39(0x193)+_0x4a6cb1[_0x455d24][_0x575b39(0x13f)]+_0x575b39(0x17d)+_0x4a6cb1[_0x455d24]['id'];dbFileIndex[_0x575b39(0x16d)](_0x3bdb74)[_0x575b39(0x182)]();}return _0x5f3430();}}catch(_0x54e316){console['log'](_0x54e316),_0x589bc3&&dbFileIndex[_0x575b39(0x16d)](_0x575b39(0x163)+TABLE_NAME_FACE2INDEX+_0x575b39(0x1a4)+_0x589bc3['id'])[_0x575b39(0x182)](),_0x29aed1();}});}async function runFaceDetect(){const _0x3e2262=_0x506b3e;let _0x4b18c8=dbConfigTable[_0x3e2262(0x136)](dbOther,_0x3e2262(0x1a8));_0x4b18c8&&_0x4b18c8['value']=='1'?runInfinitDetectFaces()['then'](()=>{runFaceDetect();}):exitProcess();}async function runFaceCompare(){const _0x51d654=_0x506b3e;runInfinitCompareFaces()[_0x51d654(0x177)](()=>{runFaceCompare();});}function statisticFacePhotoCount(){const _0x18c2c4=_0x506b3e;try{let _0x18079d=dbFileIndex[_0x18c2c4(0x16d)]('SELECT\x20id\x20from\x20'+TABLE_NAME_PHOTO_FACES+_0x18c2c4(0x197))[_0x18c2c4(0x1a9)]();for(let _0x27669a of _0x18079d){let _0x42a3b2=dbFileIndex['prepare'](_0x18c2c4(0x176)+TABLE_NAME_PHOTO_FACES+'\x20where\x20belong_face_id='+_0x27669a['id'])['all']();_0x42a3b2[_0x18c2c4(0x1a2)](_0x27669a);let _0x19b143='(';for(let _0xc576a9 in _0x42a3b2){_0x19b143+=_0x42a3b2[_0xc576a9]['id'],_0xc576a9!=_0x42a3b2[_0x18c2c4(0x1af)]-0x1&&(_0x19b143+=',');}_0x19b143+=')';let _0x2dc28e=dbFileIndex['prepare']('SELECT\x20COUNT(photo_index_id)\x20as\x20count\x20FROM\x20'+TABLE_NAME_FACE2INDEX+'\x20where\x20face_id\x20in\x20'+_0x19b143+_0x18c2c4(0x161))[_0x18c2c4(0x148)]();dbFileIndex[_0x18c2c4(0x16d)](_0x18c2c4(0x163)+TABLE_NAME_PHOTO_FACES+_0x18c2c4(0x156)+_0x2dc28e[_0x18c2c4(0x15c)]+'\x20where\x20id='+_0x27669a['id'])[_0x18c2c4(0x182)]();}dbFileIndex['prepare'](_0x18c2c4(0x163)+TABLE_NAME_PHOTO_FACES+'\x20SET\x20face_photo_count=0\x20where\x20belong_face_id\x20is\x20not\x20null')['run'](),dbFileIndex[_0x18c2c4(0x16d)](_0x18c2c4(0x17f)+TABLE_NAME_PHOTO_FACES+_0x18c2c4(0x152))[_0x18c2c4(0x182)]();}catch(_0x7bc03d){console[_0x18c2c4(0x15b)](_0x7bc03d);}}let bgTaskId;try{let info=dbOther[_0x506b3e(0x16d)](_0x506b3e(0x1b3))[_0x506b3e(0x182)](_0x506b3e(0x18a));bgTaskId=info['lastInsertRowid'];}catch(_0xc4a2e2){}async function main(){setTimeout(async()=>{runFaceDetect();},0x7d0),setTimeout(async()=>{runFaceCompare();},0x1388);}main(),process['on'](_0x506b3e(0x186),(_0x4f3b97,_0x46eaf2)=>{const _0x5642fa=_0x506b3e;currentDetectIndex&&dbFileIndex[_0x5642fa(0x16d)](_0x5642fa(0x164)+currentDetectIndex['id'])['run'](),process[_0x5642fa(0x143)]({'type':_0x5642fa(0x13a)}),process[_0x5642fa(0x17e)]();});