const _0x3a52a9=_0x3da2;(function(_0xc5f96c,_0x685c36){const _0x3e6936=_0x3da2,_0x1b6f14=_0xc5f96c();while(!![]){try{const _0x4eda54=-parseInt(_0x3e6936(0x141))/0x1*(parseInt(_0x3e6936(0x14d))/0x2)+-parseInt(_0x3e6936(0x18e))/0x3+-parseInt(_0x3e6936(0x1a9))/0x4*(parseInt(_0x3e6936(0x154))/0x5)+-parseInt(_0x3e6936(0x182))/0x6+parseInt(_0x3e6936(0x179))/0x7+-parseInt(_0x3e6936(0x18b))/0x8+parseInt(_0x3e6936(0x1a7))/0x9;if(_0x4eda54===_0x685c36)break;else _0x1b6f14['push'](_0x1b6f14['shift']());}catch(_0x2fd92d){_0x1b6f14['push'](_0x1b6f14['shift']());}}}(_0xc87f,0x9d1aa));const fs=require('fs'),path=require('path'),tfjs=require(_0x3a52a9(0x18f)),wasm=require(_0x3a52a9(0x163)),sharpUtil=require('../../express-server/utils/sharpUtils'),exifUtils=require(_0x3a52a9(0x189)),urlConfig=require(_0x3a52a9(0x1a0)),faceapi=require('../../libs/faceapi/face-api.node-wasm'),config=require(_0x3a52a9(0x1a5)),Database=require(_0x3a52a9(0x15b)),https=require(_0x3a52a9(0x19c)),dbConfigTable=require('../../db/dbConfigTable');process[_0x3a52a9(0x193)]=_0x3a52a9(0x167);let dbFileIndex=new Database(config[_0x3a52a9(0x13d)],{}),dbOther=new Database(config['dbOther'],{});dbOther[_0x3a52a9(0x165)]('journal_mode\x20=\x20WAL'),dbFileIndex[_0x3a52a9(0x165)]('journal_mode\x20=\x20WAL'),process['on'](_0x3a52a9(0x151),()=>{const _0x5edd18=_0x3a52a9;dbOther[_0x5edd18(0x1a4)](),dbFileIndex[_0x5edd18(0x1a4)]();});const DEAL_GAP=0x7530;let TABLE_NAME_FACE2INDEX=_0x3a52a9(0x130),TABLE_NAME_PHOTO_FACES=_0x3a52a9(0x168),modelInit=![],modelSavePath=path[_0x3a52a9(0x176)](config[_0x3a52a9(0x144)],_0x3a52a9(0x19e),_0x3a52a9(0x150));!fs[_0x3a52a9(0x1a1)](modelSavePath)&&fs[_0x3a52a9(0x16b)](modelSavePath,{'recursive':!![]});let modelBaseUrl=urlConfig[_0x3a52a9(0x1ab)](dbOther,'modeUrl_ai_face'),modelFileUrlList=[],modelFileList=[_0x3a52a9(0x14e),_0x3a52a9(0x133),'face_recognition_model.bin',_0x3a52a9(0x159),_0x3a52a9(0x153),_0x3a52a9(0x16e),_0x3a52a9(0x152),'face_landmark_68_model-weights_manifest.json'];function _0xc87f(){const _0x39d5be=['DELETE\x20FROM\x20','detectAllFaces','3446766rLGcYo','height','\x20SET\x20face_photo_count=','raw','nets','endScope','SELECT\x20id\x20from\x20','../../utils/exifUtils','tmp_','2033816lzRBRc','get','deleteRawTempFile','572979zgFahw','@tensorflow/tfjs','lastInsertRowid','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20(type=1\x20OR\x20type=2)\x20AND\x20ai_face_detect_state=0\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20is_raw!=1\x20\x20LIMIT\x201','REPLACE\x20INTO\x20\x20','title','toBuffer','jpeg','stringify','faceLandmark68Net','values','\x20where\x20id=','withFaceDescriptors','\x20SET\x20compare_state=1\x20where\x20id=','https','all','tfModel','\x20,min_similar_score=','../../myConfig/urlConfig','existsSync','faceRecognitionNet','startScope','close','../../myConfig/config','ready','11163141YnPHZw','parse','12YNFUBJ','length','getUrlByUrlKey','error','\x20SET\x20face_id=','catch','engine','rotate','photo_faces2index','value','\x20where\x20belong_face_id\x20is\x20null','face_landmark_68_tiny_model-weights_manifest.json','face_id','SELECT\x20*\x20from\x20','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20WHERE\x20ai_face_detect_state=0\x20and\x20size<=','width','\x20where\x20belong_face_id=','push','stat','tiny_path','face_descriptor','dbFileIndex','_box','filename','\x20SET\x20face_photo_count=0\x20where\x20belong_face_id\x20is\x20not\x20null','7cbRvEI','(face_descriptor)\x20VALUES(?)','wasm','userDataFolder','detection','transSpcielFormat','_distance','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20where\x20id=','_score','\x20where\x20face_id\x20in\x20','log','then','7732RuvzJb','face_landmark_68_tiny_model.bin','\x20WHERE\x20\x20compare_state=0\x20\x20and\x20face_id\x20is\x20null\x20LIMIT\x201','faceapi_models','exit','face_landmark_68_model.bin','ssd_mobilenetv1_model.bin','1176305RSQhnx','channels',',\x20compare_state=1\x20where\x20id\x20=\x20','resize','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','face_recognition_model-weights_manifest.json','withFaceLandmarks','better-sqlite3','_width','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','\x20WHERE\x20id=','(photo_index_id,score,x,y,width,height,face_descriptor)\x20\x20VALUES(?,?,?,?,?,?,?)','prepare','REPLACE\x20INTO\x20','dispose','@tensorflow/tfjs-backend-wasm','type','pragma','keys','NasCabAiFace','photo_faces','ssdMobilenetv1','count','mkdirSync','aiFaceEnable','message','ssd_mobilenetv1_model-weights_manifest.json','min_similar_score','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20size>','findByTitle','\x20where\x20face_photo_count<1\x20and\x20belong_face_id\x20is\x20null','SELECT\x20COUNT(photo_index_id)\x20as\x20count\x20FROM\x20','loadFromDisk','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','join','run','getRotateFromTags','8089725uolVma','slice','send','pipe','FaceMatcher','UPDATE\x20','_height'];_0xc87f=function(){return _0x39d5be;};return _0xc87f();}for(let i=0x0;i<modelFileList[_0x3a52a9(0x1aa)];i++){modelFileUrlList[_0x3a52a9(0x139)](modelBaseUrl+modelFileList[i]);}function httpDownload(_0x168d7e,_0x2c9744,_0xbd7495){return new Promise((_0x1ac673,_0xb2083f)=>{https['get'](_0x168d7e,_0x58caed=>{const _0x4f50a8=_0x3da2,_0x3d3f5f=fs['createWriteStream'](_0x2c9744);_0x58caed[_0x4f50a8(0x17c)](_0x3d3f5f),_0x3d3f5f['on']('finish',()=>{const _0x19b521=_0x4f50a8;_0x3d3f5f[_0x19b521(0x1a4)](),fs['renameSync'](_0x2c9744,_0xbd7495),_0x1ac673();})['on'](_0x4f50a8(0x12b),_0x31bc34=>{});})['on']('error',_0x15262d=>{const _0x491f63=_0x3da2;_0xb2083f(_0x15262d[_0x491f63(0x16d)]);});});}function downloadModelFile(){return new Promise(async(_0x3f200b,_0x468c89)=>{const _0x2eb497=_0x3da2;try{for(let _0x35dfda=0x0;_0x35dfda<modelFileList[_0x2eb497(0x1aa)];_0x35dfda++){let _0x1442fb=path[_0x2eb497(0x176)](modelSavePath,modelFileList[_0x35dfda]),_0x2c025a=path['join'](modelSavePath,_0x2eb497(0x18a)+modelFileList[_0x35dfda]);if(!fs[_0x2eb497(0x1a1)](_0x1442fb)){let _0x5d6a8b=modelFileUrlList[_0x35dfda];await httpDownload(_0x5d6a8b,_0x2c025a,_0x1442fb);}else{}}_0x3f200b();}catch(_0x216ea9){_0x468c89(_0x216ea9);}});}async function initFaceAPI(){return new Promise(async(_0x9cd93b,_0x4b4c30)=>{const _0x30d660=_0x3da2;try{!modelInit&&(await downloadModelFile(),await tfjs['setBackend'](_0x30d660(0x143)),await tfjs[_0x30d660(0x1a6)](),await faceapi['nets'][_0x30d660(0x169)][_0x30d660(0x174)](modelSavePath),await faceapi[_0x30d660(0x186)][_0x30d660(0x197)][_0x30d660(0x174)](modelSavePath),await faceapi[_0x30d660(0x186)][_0x30d660(0x1a2)][_0x30d660(0x174)](modelSavePath),modelInit=!![]),_0x9cd93b();}catch(_0x3e5217){console[_0x30d660(0x14b)](_0x3e5217),_0x4b4c30(_0x3e5217);}});}let currentDetectIndex=null;function runInfinitDetectFaces(){return new Promise(async _0x24c93a=>{const _0x5437e4=_0x3da2;let _0x9bd0d6;try{let _0x328e00=0x32*0x400;dbFileIndex['prepare'](_0x5437e4(0x136)+_0x328e00)[_0x5437e4(0x177)](),_0x9bd0d6=dbFileIndex[_0x5437e4(0x160)](_0x5437e4(0x170)+_0x328e00+'\x20AND\x20(type=1\x20OR\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20ai_face_detect_state=0\x20\x20AND\x20is_raw!=1\x20LIMIT\x201')[_0x5437e4(0x18c)]();if(!_0x9bd0d6)return setTimeout(()=>{_0x24c93a();},DEAL_GAP);currentDetectIndex=_0x9bd0d6,await initFaceAPI();try{bgTaskId&&dbOther[_0x5437e4(0x160)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)['run']();}catch(_0x6bf214){}function _0x382b86(){const _0xa3292d=_0x5437e4;dbFileIndex[_0xa3292d(0x160)](_0xa3292d(0x148)+_0x9bd0d6['id'])['run'](),currentDetectIndex=null,_0x24c93a();}let _0x2be037=path[_0x5437e4(0x176)](_0x9bd0d6['path'],_0x9bd0d6[_0x5437e4(0x13f)]);parseInt(_0x9bd0d6[_0x5437e4(0x164)])==0x2&&(_0x2be037=path[_0x5437e4(0x176)](_0x9bd0d6[_0x5437e4(0x13b)]));let _0x324453=0x7d0;fs[_0x5437e4(0x13a)](_0x2be037,async(_0x2d3dbd,_0x464ce9)=>{const _0x313d81=_0x5437e4;if(_0x2d3dbd)return _0x382b86();sharpUtil[_0x313d81(0x146)](_0x2be037,(_0x47d889,_0x51bbff,_0xc080d8)=>{const _0x390544=_0x313d81;let _0x34fca4=sharpUtil['getSharpInstanceFromInput'](_0x47d889),_0x1924e8=exifUtils[_0x390544(0x178)](_0xc080d8);_0x1924e8?_0x34fca4=_0x34fca4[_0x390544(0x12f)](_0x1924e8):_0x34fca4=_0x34fca4[_0x390544(0x12f)](),_0x34fca4[_0x390544(0x157)]({'width':_0x324453,'height':_0x324453,'withoutEnlargement':!![]})[_0x390544(0x195)]()[_0x390544(0x185)]()[_0x390544(0x194)](async(_0x5304b1,_0x440b6a,_0x2f768d)=>{const _0x2c5286=_0x390544;_0x51bbff&&sharpUtil[_0x2c5286(0x18d)](_0x47d889);if(_0x5304b1)return _0x440b6a=null,_0x382b86();let _0x253d7b;try{faceapi['tf']['engine']()[_0x2c5286(0x1a3)](),temp=tfjs['tensor'](_0x440b6a,[_0x2f768d[_0x2c5286(0x183)],_0x2f768d[_0x2c5286(0x137)],_0x2f768d[_0x2c5286(0x155)]]),_0x253d7b=tfjs[_0x2c5286(0x17a)](temp,[0x0,0x0,0x0],[-0x1,-0x1,0x3]),faceapi['tf']['dispose'](temp);}catch(_0x38dfd7){if(_0x253d7b)faceapi['tf'][_0x2c5286(0x162)](_0x253d7b);if(temp)faceapi['tf']['dispose'](temp);return faceapi['tf']['engine']()[_0x2c5286(0x187)](),_0x382b86();}_0x440b6a=null,faceapi[_0x2c5286(0x181)](_0x253d7b)[_0x2c5286(0x15a)]()[_0x2c5286(0x19a)]()['then'](_0xabcd44=>{const _0x30efcf=_0x2c5286;faceapi['tf'][_0x30efcf(0x162)](_0x253d7b),faceapi['tf'][_0x30efcf(0x12e)]()[_0x30efcf(0x187)]();if(!_0xabcd44['length'])return _0x382b86();let _0x5d520e=[];for(let _0x33a50f of _0xabcd44){let _0x1835ed=_0x33a50f[_0x30efcf(0x145)][_0x30efcf(0x13e)][_0x30efcf(0x15c)],_0x18634f=_0x33a50f[_0x30efcf(0x145)][_0x30efcf(0x13e)][_0x30efcf(0x17f)];if(_0x1835ed>_0x324453||_0x18634f>_0x324453)continue;let _0xb066b7=_0x33a50f[_0x30efcf(0x145)][_0x30efcf(0x149)];if(_0x1835ed<0x50||_0x18634f<0x50||_0xb066b7<0.8)continue;_0x5d520e[_0x30efcf(0x139)](_0x33a50f);}if(!_0x5d520e[_0x30efcf(0x1aa)])return _0x382b86();for(let _0x4e56eb=0x0;_0x4e56eb<_0x5d520e['length'];_0x4e56eb++){let _0x14f3ae=_0x5d520e[_0x4e56eb],_0x4bccb3=_0x14f3ae[_0x30efcf(0x145)][_0x30efcf(0x13e)];dbFileIndex[_0x30efcf(0x160)](_0x30efcf(0x192)+TABLE_NAME_FACE2INDEX+_0x30efcf(0x15f))['run'](_0x9bd0d6['id'],_0x14f3ae[_0x30efcf(0x145)][_0x30efcf(0x149)],_0x4bccb3['_x'],_0x4bccb3['_y'],_0x4bccb3['_width'],_0x4bccb3[_0x30efcf(0x17f)],JSON[_0x30efcf(0x196)](_0x14f3ae['descriptor']));}return _0xabcd44=null,_0x382b86();})[_0x2c5286(0x12d)](_0x4fe152=>{const _0xfdcd15=_0x2c5286;return _0x51bbff&&sharpUtil[_0xfdcd15(0x18d)](_0x47d889),faceapi['tf'][_0xfdcd15(0x162)](_0x253d7b),faceapi['tf'][_0xfdcd15(0x12e)]()[_0xfdcd15(0x187)](),_0x382b86();});});});});}catch(_0x36d3e1){_0x9bd0d6&&dbFileIndex['prepare'](_0x5437e4(0x148)+_0x9bd0d6['id'])['run'](),_0x24c93a();}});}function exitProcess(){const _0x2a33ec=_0x3a52a9;try{bgTaskId&&dbOther[_0x2a33ec(0x160)](_0x2a33ec(0x15d)+bgTaskId)[_0x2a33ec(0x177)]();}catch(_0x3f9a93){}return process[_0x2a33ec(0x17b)]({'type':_0x2a33ec(0x1a4)}),statisticFacePhotoCount(),process[_0x2a33ec(0x151)]();}function runInfinitCompareFaces(){let _0x3ad647=0.35;return new Promise(async _0x2f2974=>{const _0x3edd2d=_0x3da2;let _0x1d8467=dbFileIndex['prepare'](_0x3edd2d(0x191))[_0x3edd2d(0x18c)]();if(_0x1d8467)return setTimeout(()=>{_0x2f2974();},DEAL_GAP);let _0x231285;try{try{bgTaskId&&dbOther[_0x3edd2d(0x160)](_0x3edd2d(0x175)+bgTaskId)[_0x3edd2d(0x177)]();}catch(_0x1ca547){}_0x231285=dbFileIndex['prepare'](_0x3edd2d(0x135)+TABLE_NAME_FACE2INDEX+_0x3edd2d(0x14f))[_0x3edd2d(0x18c)]();if(!_0x231285)return exitProcess();await initFaceAPI();function _0x29b3f7(){const _0x558085=_0x3edd2d;dbFileIndex[_0x558085(0x160)]('UPDATE\x20'+TABLE_NAME_FACE2INDEX+'\x20SET\x20compare_state=1\x20where\x20id='+_0x231285['id'])['run'](),_0x2f2974();}let _0x50c60b=new Float32Array(Object[_0x3edd2d(0x198)](JSON['parse'](_0x231285[_0x3edd2d(0x13c)])));const _0x5b3cfa=new faceapi[(_0x3edd2d(0x17d))]([_0x50c60b]);let _0x5dc4e0=[_0x231285],_0x12fa8d=dbFileIndex[_0x3edd2d(0x160)](_0x3edd2d(0x188)+TABLE_NAME_FACE2INDEX+'\x20where\x20id!='+_0x231285['id'])[_0x3edd2d(0x19d)](),_0x5c9356=0x1,_0x2c6a31=null;for(let _0x56012a=0x0;_0x56012a<_0x12fa8d['length'];_0x56012a++){let _0x21b67f=dbFileIndex[_0x3edd2d(0x160)](_0x3edd2d(0x135)+TABLE_NAME_FACE2INDEX+_0x3edd2d(0x15e)+_0x12fa8d[_0x56012a]['id'])['get']();if(!_0x21b67f)continue;const _0xe68c41=_0x5b3cfa['findBestMatch'](new Float32Array(Object[_0x3edd2d(0x198)](JSON[_0x3edd2d(0x1a8)](_0x21b67f[_0x3edd2d(0x13c)]))));_0xe68c41[_0x3edd2d(0x147)]<_0x3ad647&&(_0xe68c41['_distance']<_0x5c9356&&_0x21b67f[_0x3edd2d(0x134)]&&(_0x5c9356=_0xe68c41[_0x3edd2d(0x147)],_0x2c6a31=_0x21b67f[_0x3edd2d(0x134)]),_0xe68c41['_distance']<_0x21b67f[_0x3edd2d(0x16f)]&&(_0x21b67f[_0x3edd2d(0x16f)]=_0xe68c41['_distance'],_0x5dc4e0[_0x3edd2d(0x139)](_0x21b67f)));}if(_0x5dc4e0[_0x3edd2d(0x1aa)]<0x2){if(_0x2c6a31&&!_0x231285[_0x3edd2d(0x134)]){let _0x5d1556=_0x3edd2d(0x17e)+TABLE_NAME_FACE2INDEX+_0x3edd2d(0x12c)+_0x2c6a31+_0x3edd2d(0x19f)+_0x5c9356+',\x20compare_state=1\x20where\x20id\x20=\x20'+_0x231285['id'];dbFileIndex[_0x3edd2d(0x160)](_0x5d1556)[_0x3edd2d(0x177)]();}else{}return _0x29b3f7();}let _0x4df27a={};for(let _0x597b6e=0x0;_0x597b6e<_0x5dc4e0[_0x3edd2d(0x1aa)];_0x597b6e++){let _0x3d7f72=_0x5dc4e0[_0x597b6e]['face_id'];_0x3d7f72&&(_0x4df27a[_0x3d7f72]?_0x4df27a[_0x3d7f72]+=0x1:_0x4df27a[_0x3d7f72]=0x1);}if(Object[_0x3edd2d(0x166)](_0x4df27a)[_0x3edd2d(0x1aa)]>0x0){let _0x1574d4=0x0,_0xff262a=0x0;for(let _0x160f38 in _0x4df27a){_0x4df27a[_0x160f38]>_0xff262a&&(_0xff262a=_0x4df27a[_0x160f38],_0x1574d4=_0x160f38);}if(_0xff262a>0x0&&_0xff262a>=(_0x5dc4e0[_0x3edd2d(0x1aa)]-0x1)/0x6){for(let _0x4c7c2a in _0x5dc4e0){let _0x49f247=_0x3edd2d(0x17e)+TABLE_NAME_FACE2INDEX+_0x3edd2d(0x12c)+_0x1574d4+_0x3edd2d(0x19f)+_0x5dc4e0[_0x4c7c2a][_0x3edd2d(0x16f)]+',\x20compare_state=1\x20where\x20id\x20=\x20'+_0x5dc4e0[_0x4c7c2a]['id'];dbFileIndex[_0x3edd2d(0x160)](_0x49f247)[_0x3edd2d(0x177)]();}return _0x29b3f7();}else{let _0x2b597b=dbFileIndex['prepare'](_0x3edd2d(0x161)+TABLE_NAME_PHOTO_FACES+_0x3edd2d(0x142))[_0x3edd2d(0x177)](JSON[_0x3edd2d(0x196)](_0x50c60b));for(let _0x6444a6 in _0x5dc4e0){let _0x555e2f=_0x3edd2d(0x17e)+TABLE_NAME_FACE2INDEX+_0x3edd2d(0x12c)+_0x2b597b['lastInsertRowid']+_0x3edd2d(0x19f)+_0x5dc4e0[_0x6444a6][_0x3edd2d(0x16f)]+',\x20compare_state=1\x20where\x20id\x20=\x20'+_0x5dc4e0[_0x6444a6]['id'];dbFileIndex[_0x3edd2d(0x160)](_0x555e2f)[_0x3edd2d(0x177)]();}return _0x29b3f7();}}else{let _0x130d31=dbFileIndex[_0x3edd2d(0x160)](_0x3edd2d(0x161)+TABLE_NAME_PHOTO_FACES+_0x3edd2d(0x142))[_0x3edd2d(0x177)](JSON[_0x3edd2d(0x196)](_0x50c60b));for(let _0xb99fcd in _0x5dc4e0){let _0x542c37='UPDATE\x20'+TABLE_NAME_FACE2INDEX+'\x20SET\x20face_id='+_0x130d31[_0x3edd2d(0x190)]+_0x3edd2d(0x19f)+_0x5dc4e0[_0xb99fcd][_0x3edd2d(0x16f)]+_0x3edd2d(0x156)+_0x5dc4e0[_0xb99fcd]['id'];dbFileIndex['prepare'](_0x542c37)[_0x3edd2d(0x177)]();}return _0x29b3f7();}}catch(_0x5c4891){console[_0x3edd2d(0x14b)](_0x5c4891),_0x231285&&dbFileIndex['prepare'](_0x3edd2d(0x17e)+TABLE_NAME_FACE2INDEX+_0x3edd2d(0x19b)+_0x231285['id'])['run'](),_0x2f2974();}});}function _0x3da2(_0x255a83,_0x4da798){const _0xc87f41=_0xc87f();return _0x3da2=function(_0x3da2d2,_0x145269){_0x3da2d2=_0x3da2d2-0x12b;let _0x22a588=_0xc87f41[_0x3da2d2];return _0x22a588;},_0x3da2(_0x255a83,_0x4da798);}async function runFaceDetect(){const _0x31599f=_0x3a52a9;let _0x379196=dbConfigTable[_0x31599f(0x171)](dbOther,_0x31599f(0x16c));_0x379196&&_0x379196[_0x31599f(0x131)]=='1'?runInfinitDetectFaces()[_0x31599f(0x14c)](()=>{runFaceDetect();}):exitProcess();}async function runFaceCompare(){const _0x2fa970=_0x3a52a9;runInfinitCompareFaces()[_0x2fa970(0x14c)](()=>{runFaceCompare();});}function statisticFacePhotoCount(){const _0xd18b1f=_0x3a52a9;try{let _0x4e6b6d=dbFileIndex[_0xd18b1f(0x160)]('SELECT\x20id\x20from\x20'+TABLE_NAME_PHOTO_FACES+_0xd18b1f(0x132))['all']();for(let _0xfd1ae3 of _0x4e6b6d){let _0x2a2e8b=dbFileIndex[_0xd18b1f(0x160)]('SELECT\x20id\x20from\x20'+TABLE_NAME_PHOTO_FACES+_0xd18b1f(0x138)+_0xfd1ae3['id'])['all']();_0x2a2e8b[_0xd18b1f(0x139)](_0xfd1ae3);let _0x42c173='(';for(let _0x69e6b2 in _0x2a2e8b){_0x42c173+=_0x2a2e8b[_0x69e6b2]['id'],_0x69e6b2!=_0x2a2e8b['length']-0x1&&(_0x42c173+=',');}_0x42c173+=')';let _0x4d7652=dbFileIndex['prepare'](_0xd18b1f(0x173)+TABLE_NAME_FACE2INDEX+_0xd18b1f(0x14a)+_0x42c173+'\x20and\x20disabled=0')[_0xd18b1f(0x18c)]();dbFileIndex[_0xd18b1f(0x160)](_0xd18b1f(0x17e)+TABLE_NAME_PHOTO_FACES+_0xd18b1f(0x184)+_0x4d7652[_0xd18b1f(0x16a)]+_0xd18b1f(0x199)+_0xfd1ae3['id'])[_0xd18b1f(0x177)]();}dbFileIndex[_0xd18b1f(0x160)](_0xd18b1f(0x17e)+TABLE_NAME_PHOTO_FACES+_0xd18b1f(0x140))[_0xd18b1f(0x177)](),dbFileIndex['prepare'](_0xd18b1f(0x180)+TABLE_NAME_PHOTO_FACES+_0xd18b1f(0x172))[_0xd18b1f(0x177)]();}catch(_0x568500){console[_0xd18b1f(0x14b)](_0x568500);}}let bgTaskId;try{let info=dbOther[_0x3a52a9(0x160)](_0x3a52a9(0x158))[_0x3a52a9(0x177)]('AI_FACES');bgTaskId=info[_0x3a52a9(0x190)];}catch(_0x5ed6cc){}async function main(){setTimeout(async()=>{runFaceDetect();},0x7d0),setTimeout(async()=>{runFaceCompare();},0x1388);}main(),process['on']('uncaughtException',(_0x3787cb,_0x5b1663)=>{const _0x5736b1=_0x3a52a9;currentDetectIndex&&dbFileIndex[_0x5736b1(0x160)]('UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20where\x20id='+currentDetectIndex['id'])[_0x5736b1(0x177)](),process[_0x5736b1(0x17b)]({'type':_0x5736b1(0x1a4)}),process['exit']();});