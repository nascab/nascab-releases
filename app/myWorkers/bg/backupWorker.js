const _0x403388=_0x2f68;(function(_0x298cd7,_0x3f0607){const _0xe8419f=_0x2f68,_0x16f69a=_0x298cd7();while(!![]){try{const _0x394059=parseInt(_0xe8419f(0x1bb))/0x1+parseInt(_0xe8419f(0x1c5))/0x2+parseInt(_0xe8419f(0x1a0))/0x3+parseInt(_0xe8419f(0x195))/0x4*(-parseInt(_0xe8419f(0x1d2))/0x5)+-parseInt(_0xe8419f(0x1c2))/0x6*(-parseInt(_0xe8419f(0x199))/0x7)+-parseInt(_0xe8419f(0x1e1))/0x8*(-parseInt(_0xe8419f(0x1e9))/0x9)+-parseInt(_0xe8419f(0x197))/0xa;if(_0x394059===_0x3f0607)break;else _0x16f69a['push'](_0x16f69a['shift']());}catch(_0x1db552){_0x16f69a['push'](_0x16f69a['shift']());}}}(_0x4bca,0x7404b));const Database=require('better-sqlite3'),config=require(_0x403388(0x1cc));function _0x2f68(_0x5beab5,_0x1bc665){const _0x4bca33=_0x4bca();return _0x2f68=function(_0x2f6842,_0x462c33){_0x2f6842=_0x2f6842-0x192;let _0xbdf6c1=_0x4bca33[_0x2f6842];return _0xbdf6c1;},_0x2f68(_0x5beab5,_0x1bc665);}let dbOther=new Database(config['dbOther'],{});dbOther['pragma'](_0x403388(0x1ab));let moment=require(_0x403388(0x1a6)),path=require(_0x403388(0x1d7)),fs=require('fs'),i18nUtil=require(_0x403388(0x1a1)),i18n=i18nUtil[_0x403388(0x19b)](dbOther);process[_0x403388(0x1aa)]=_0x403388(0x1b7);let copyFileCount=0x0,copySize=0x0,filesCount=0x0,excludeCount=0x0,totalSize=0x0,paused=![],excludeList=[];function copyFile(_0x2093a4,_0x158256,_0x2b777b,_0x5ba641){const _0x32f796=_0x403388;try{let _0x535882=dbOther['prepare'](_0x32f796(0x1be)+_0x158256)[_0x32f796(0x1b0)]();if(_0x535882[_0x32f796(0x1a8)]!=_0x32f796(0x1bc))return paused=!![],![];let _0x57cf7d=fs[_0x32f796(0x1cd)](_0x2b777b);filesCount+=0x1,totalSize+=_0x57cf7d['size'];let _0x3b50de=!![];if(!fs[_0x32f796(0x1d4)](_0x5ba641))fs['cpSync'](_0x2b777b,_0x5ba641,{'preserveTimestamps':!![]}),copySize+=_0x57cf7d[_0x32f796(0x1eb)],copyFileCount+=0x1;else{let _0xa9fc5e=fs[_0x32f796(0x1cd)](_0x5ba641);_0x57cf7d[_0x32f796(0x1eb)]==_0xa9fc5e[_0x32f796(0x1eb)]&&Math[_0x32f796(0x192)](_0x57cf7d['mtimeMs']-_0xa9fc5e[_0x32f796(0x1e3)])<=0x3e8?_0x3b50de=![]:(fs[_0x32f796(0x1c3)](_0x2b777b,_0x5ba641,{'preserveTimestamps':!![]}),copySize+=_0x57cf7d['size'],copyFileCount+=0x1);}return _0x3b50de&&updateTaskRecord(_0x158256,_0x32f796(0x1dd)+copySize+_0x32f796(0x1d9)+copyFileCount),!![];}catch(_0x115595){return addTaskMsg(_0x2093a4,_0x158256,_0x32f796(0x1e7),_0x2b777b+':'+i18n['__'](_0x32f796(0x1c6))+_0x32f796(0x19c)+JSON[_0x32f796(0x1a4)](_0x115595)),!![];}}function matchRuleShort(_0x4c340b,_0x1a6f97){const _0x536756=_0x403388;var _0x360ff3=_0x5af0d9=>_0x5af0d9[_0x536756(0x19a)](/([.*+?^=!:${}()|\[\]\/\\])/g,_0x536756(0x19e));return new RegExp('^'+_0x1a6f97['split']('*')[_0x536756(0x1d5)](_0x360ff3)[_0x536756(0x1b9)]('.*')+'$')[_0x536756(0x1b1)](_0x4c340b);}function copyFolder(_0x2ec377,_0x16a916,_0x68daa9,_0x12535a,_0x49e08d){const _0x2cdf3d=_0x403388;let _0xddd48d=_0x2ec377['id'],_0x1c0000=checkFolderPower(_0x12535a,!![]);if(!_0x1c0000)addTaskMsg(_0xddd48d,_0x16a916,_0x2cdf3d(0x1e7),i18n['__'](_0x2cdf3d(0x1ec))+':'+_0x12535a);else try{let _0x323094=fs['readdirSync'](_0x12535a);for(let _0x38e931=0x0;_0x38e931<_0x323094['length'];_0x38e931++){let _0x261f22=_0x323094[_0x38e931];var _0x103726=path[_0x2cdf3d(0x1b9)](_0x12535a,_0x261f22);let _0x59a23f=fs[_0x2cdf3d(0x1cd)](_0x103726);var _0x5b9d13=_0x59a23f[_0x2cdf3d(0x1bf)](),_0x3df54e=_0x59a23f[_0x2cdf3d(0x198)]();if(_0x5b9d13){if(excludeList[_0x2cdf3d(0x1a2)](_0x261f22))continue;if(_0x2ec377[_0x2cdf3d(0x1a7)]&&_0x2ec377[_0x2cdf3d(0x1a7)][_0x2cdf3d(0x1cf)]>0x0){let _0x532f90=JSON[_0x2cdf3d(0x1e6)](_0x2ec377[_0x2cdf3d(0x1a7)]),_0x41291f=!![];for(let _0x288fd9 in _0x532f90){if(_0x532f90[_0x288fd9][_0x2cdf3d(0x1a2)]('*')){if(matchRuleShort(_0x261f22,_0x532f90[_0x288fd9])){_0x41291f=![];break;}}else{if(_0x532f90[_0x288fd9]==_0x261f22){_0x41291f=![];break;}}}if(!_0x41291f){excludeCount+=0x1;continue;}}let _0x375657=path[_0x2cdf3d(0x1b9)](_0x49e08d,path[_0x2cdf3d(0x1db)](_0x68daa9),_0x103726[_0x2cdf3d(0x1b6)](_0x68daa9['length'])),_0x41b52b=copyFile(_0xddd48d,_0x16a916,_0x103726,_0x375657);if(_0x41b52b===![])return![];}else _0x3df54e&&copyFolder(_0x2ec377,_0x16a916,_0x68daa9,_0x103726,_0x49e08d);}}catch(_0x3cc096){addTaskMsg(_0xddd48d,_0x16a916,'ERROR',i18n['__'](_0x2cdf3d(0x1d6))+':'+_0x12535a);}}function reverseCheck(_0x2cde10,_0x36432a,_0x44f76d,_0x6f856b,_0x1c0900){const _0x5b05a0=_0x403388;try{if(!fs['existsSync'](_0x1c0900))return;let _0x3e0d4b=fs[_0x5b05a0(0x1b3)](_0x1c0900);for(let _0x7a92d=0x0;_0x7a92d<_0x3e0d4b['length'];_0x7a92d++){let _0x430ec2=_0x3e0d4b[_0x7a92d];var _0x257500=path['join'](_0x1c0900,_0x430ec2);let _0x481347=fs['statSync'](_0x257500);var _0x4b5c5e=_0x481347[_0x5b05a0(0x1bf)](),_0x8934fd=_0x481347[_0x5b05a0(0x198)]();let _0x50957c=path[_0x5b05a0(0x1b9)](_0x6f856b,_0x257500[_0x5b05a0(0x1b6)](_0x44f76d[_0x5b05a0(0x1cf)]));if(_0x4b5c5e)!fs[_0x5b05a0(0x1d4)](_0x50957c)&&fs['rmSync'](_0x257500,{'force':!![],'maxRetries':0xa});else _0x8934fd&&(!fs[_0x5b05a0(0x1d4)](_0x50957c)?fs[_0x5b05a0(0x1ac)](_0x257500,{'recursive':!![],'maxRetries':0xa}):reverseCheck(_0x2cde10,_0x36432a,_0x44f76d,_0x6f856b,_0x257500));}}catch(_0x278a6a){addTaskMsg(_0x2cde10,_0x36432a,_0x5b05a0(0x1e7),i18n['__'](_0x5b05a0(0x1d6))+':'+_0x6f856b);}}function updateTaskRecord(_0x441dec,_0x51aa18){const _0x2984d0=_0x403388;let _0x58a149=_0x2984d0(0x1a3);_0x58a149+=_0x51aa18,_0x58a149+=_0x2984d0(0x1e2)+_0x441dec,dbOther[_0x2984d0(0x1a5)](_0x58a149);}function setTaskOver(_0x54fc3a){const _0x31c9f4=_0x403388;let _0x1bb0ef=dbOther[_0x31c9f4(0x1c9)](_0x31c9f4(0x1da)+_0x54fc3a['id'])[_0x31c9f4(0x1b0)](),_0x27c740=moment()[_0x31c9f4(0x1ad)](_0x31c9f4(0x1c4));updateTaskRecord(_0x54fc3a['id'],'copy_size='+copySize+',copy_count='+copyFileCount+_0x31c9f4(0x1e0)+excludeCount+_0x31c9f4(0x1c8)+_0x1bb0ef['count']+',files_count='+filesCount+_0x31c9f4(0x1f0)+totalSize+_0x31c9f4(0x1b5)+_0x27c740+'\x27');}function addTaskMsg(_0x3fbccc,_0x68316a,_0x1a7e37,_0x3644b7){const _0x1e344a=_0x403388,_0x288be9=_0x1e344a(0x1af);return dbOther[_0x1e344a(0x1c9)](_0x288be9)['run'](''+_0x3fbccc,''+_0x68316a,''+_0x1a7e37,''+_0x3644b7);}function checkFolderPower(_0xb8c651,_0x262637){const _0x29b544=_0x403388;try{return _0x262637?fs[_0x29b544(0x1b4)](_0xb8c651,fs[_0x29b544(0x1b8)]['R_OK']):fs[_0x29b544(0x1b4)](_0xb8c651,fs['constants']['R_OK']|fs[_0x29b544(0x1b8)][_0x29b544(0x1ce)]),!![];}catch(_0x24d55e){return![];}}function exeTask(_0x189f26){const _0x214723=_0x403388;let _0x5eef50=_0x214723(0x1ee),_0x3bc328=dbOther[_0x214723(0x1c9)](_0x5eef50)[_0x214723(0x1b0)]();if(_0x3bc328){let _0x159e31=_0x214723(0x1e4)+_0x3bc328[_0x214723(0x196)],_0x48d160=dbOther[_0x214723(0x1c9)](_0x159e31)[_0x214723(0x1b0)]();if(!fs['existsSync'](_0x48d160[_0x214723(0x1ef)]))return addTaskMsg(_0x48d160['id'],_0x3bc328['id'],_0x214723(0x1e7),i18n['__'](_0x214723(0x1ca))+':'+_0x48d160[_0x214723(0x1ef)]),setTaskOver(_0x3bc328),_0x189f26();let _0x88e898=checkFolderPower(_0x48d160[_0x214723(0x1ef)]);if(!_0x88e898)return addTaskMsg(_0x48d160['id'],_0x3bc328['id'],'ERROR',i18n['__'](_0x214723(0x1ec))+':'+_0x48d160[_0x214723(0x1ef)]),setTaskOver(_0x3bc328),_0x189f26();updateTaskRecord(_0x3bc328['id'],_0x214723(0x1dc));let _0x1ad611=JSON[_0x214723(0x1e6)](_0x48d160[_0x214723(0x1c0)]);copyFileCount=0x0,copySize=0x0,filesCount=0x0,excludeCount=0x0,totalSize=0x0,paused=![];for(let _0x1ad081 in _0x1ad611){try{if(fs['existsSync'](_0x1ad611[_0x1ad081])){copyFolder(_0x48d160,_0x3bc328['id'],_0x1ad611[_0x1ad081],_0x1ad611[_0x1ad081],_0x48d160[_0x214723(0x1ef)]);if(!paused){let _0x3829d5=path['join'](_0x48d160[_0x214723(0x1ef)],path[_0x214723(0x1db)](_0x1ad611[_0x1ad081]));reverseCheck(_0x48d160['id'],_0x3bc328['id'],_0x3829d5,_0x1ad611[_0x1ad081],_0x3829d5);}}else addTaskMsg(_0x48d160['id'],_0x3bc328['id'],_0x214723(0x1e7),i18n['__']('folderNotExist')+':'+_0x1ad611[_0x1ad081]);}catch(_0x4a060b){addTaskMsg(_0x48d160['id'],_0x3bc328['id'],_0x214723(0x1e7),i18n['__']('fileCopyFail')+':'+_0x1ad611[_0x1ad081]+':'+JSON['stringify'](_0x4a060b));}}!paused&&setTaskOver(_0x3bc328),_0x189f26();}else setTimeout(()=>{_0x189f26();},0x2710);}function runInfinit(){return new Promise(_0x382ee4=>{exeTask(_0x382ee4);});}async function runBacupExe(){const _0x3ab289=_0x403388;runInfinit()[_0x3ab289(0x1c1)](()=>{runBacupExe();});}dbOther[_0x403388(0x1a5)](_0x403388(0x1b2)),runBacupExe();function addTask(_0x30da04){const _0x1435d3=_0x403388;let _0x2e65c0=dbOther[_0x1435d3(0x1c9)](_0x30da04)[_0x1435d3(0x1d8)]();if(_0x2e65c0[_0x1435d3(0x1cf)]>0x0)for(let _0x2bb572=0x0;_0x2bb572<_0x2e65c0['length'];_0x2bb572++){let _0x424c66=_0x2e65c0[_0x2bb572],_0x509237=moment(new Date()[_0x1435d3(0x1ba)]()-0xea60)[_0x1435d3(0x1ad)]('YYYY-MM-DD\x20HH:mm:ss'),_0x2d9527=_0x1435d3(0x1e5)+_0x424c66['id']+_0x1435d3(0x194)+_0x509237+_0x1435d3(0x1d0),_0x4aa47e=dbOther['prepare'](_0x2d9527)[_0x1435d3(0x1b0)]();if(_0x4aa47e[_0x1435d3(0x193)]<0x1){let _0x4379ef=moment()['format']('YYYY-MM-DD\x20HH:mm:ss');const _0x3f857a=_0x1435d3(0x1ed)+_0x424c66['id']+_0x1435d3(0x1a9)+_0x4379ef+'\x27)';return dbOther[_0x1435d3(0x1a5)](_0x3f857a);}else{}}}function add0(_0x564b51){return _0x564b51<0xa?'0'+_0x564b51:_0x564b51;}function getYmd(_0x560e37){const _0x4a309f=_0x403388;var _0x376ce7=_0x560e37[_0x4a309f(0x1d1)](),_0x25553b=_0x560e37[_0x4a309f(0x1e8)]()+0x1,_0x4b35f6=_0x560e37[_0x4a309f(0x19d)]();return _0x376ce7+'-'+add0(_0x25553b)+'-'+add0(_0x4b35f6);}function runBackupCheck(){setInterval(()=>{const _0x13f6f4=_0x2f68;let _0x4ca42f=new Date(),_0xf860c9=_0x4ca42f[_0x13f6f4(0x1d3)](),_0x14b047=_0x4ca42f[_0x13f6f4(0x19d)](),_0x512212=add0(_0x4ca42f[_0x13f6f4(0x1de)]()),_0x403a4a=add0(_0x4ca42f[_0x13f6f4(0x1cb)]()),_0x58a57c=getYmd(_0x4ca42f),_0x4d6e7d=_0x13f6f4(0x1ea)+_0x58a57c+_0x13f6f4(0x1df)+_0x512212+':'+_0x403a4a+'%\x27)';addTask(_0x4d6e7d);let _0x3fd58d=_0x13f6f4(0x19f)+_0x512212+':'+_0x403a4a+'%\x27)';addTask(_0x3fd58d);let _0x27ef6c='SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x273\x27\x20AND\x20task_day=\x27'+_0xf860c9+_0x13f6f4(0x1df)+_0x512212+':'+_0x403a4a+_0x13f6f4(0x1c7);addTask(_0x27ef6c);let _0x4111a0=_0x13f6f4(0x1ae)+_0x14b047+_0x13f6f4(0x1df)+_0x512212+':'+_0x403a4a+'%\x27)';addTask(_0x4111a0);},0x3a98);}function _0x4bca(){const _0x18fc81=['includes','UPDATE\x20backup_task_record\x20SET\x20','stringify','exec','moment','exclude_list','status','\x27,\x20\x27waiting\x27,\x27','title','journal_mode\x20=\x20WAL','rmdirSync','format','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x274\x27\x20AND\x20task_day=\x27','REPLACE\x20INTO\x20\x0a\x09\x20\x20\x20\x20\x20backup_task_msg(task_id,task_record_id,msg_type,content)\x20\x0a\x09\x20\x20\x20\x20\x20VALUES(\x20?,?,?,?)','get','test','UPDATE\x20backup_task_record\x20SET\x20status=\x27waiting\x27\x20where\x20status=\x27running\x27','readdirSync','accessSync',',end_time=\x27','substring','NasCabBackupWorker','constants','join','getTime','657556pVoDYW','running','send','select\x20status\x20from\x20backup_task_record\x20where\x20id=','isFile','source_list','then','6gRihQC','cpSync','YYYY-MM-DD\x20HH:mm:ss','274246CRriTz','fileCopyFail','%\x27)',',status=\x27done\x27,fail_count=','prepare','targetFolderNotExist','getMinutes','../../myConfig/config','statSync','W_OK','length','\x27\x20or\x20status!=\x27done\x27)','getFullYear','15VHRYwL','getDay','existsSync','map','ReadFolderFail','path','all',',copy_count=','select\x20count(*)\x20as\x20count\x20from\x20backup_task_msg\x20where\x20msg_type=\x27ERROR\x27\x20and\x20task_record_id=','basename','status=\x27running\x27','copy_size=','getHours','\x27\x20AND\x20task_time\x20LIKE\x20\x27',',exclude_count=','8ogYJza','\x20WHERE\x20id=','mtimeMs','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20id\x20=\x20','select\x20count(*)\x20as\x20count\x20from\x20backup_task_record\x20where\x20task_id=','parse','ERROR','getMonth','252810CaZTiH','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x271\x27\x20AND\x20task_day=\x27','size','noWritePermission','REPLACE\x20INTO\x20\x0a\x09\x09\x09\x09\x20\x20\x20\x20\x20backup_task_record(task_id,status,start_time)\x20\x0a\x09\x09\x09\x09\x20\x20\x20\x20\x20VALUES(\x20\x27','SELECT\x20*\x20FROM\x20backup_task_record\x20WHERE\x20status\x20=\x20\x27waiting\x27\x20order\x20by\x20start_time\x20limit\x201\x20','target_path',',total_size=','abs','count','\x20and\x20(start_time>=\x27','438344wepgBt','task_id','4148290utouSt','isDirectory','2319919zAwWfZ','replace','getI18n','\x20ERROR:','getDate','\x5c$1','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x272\x27\x20AND\x20task_time\x20LIKE\x20\x27','193836qSMOvU','../../utils/i18nUtil'];_0x4bca=function(){return _0x18fc81;};return _0x4bca();}runBackupCheck(),process['on']('exit',(_0x353348,_0xc5a4db)=>{const _0x2d5d70=_0x403388;process[_0x2d5d70(0x1bd)]({'type':'close'});});