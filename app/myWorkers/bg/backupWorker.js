function _0xc463(){const _0x32673e=['constants','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x271\x27\x20AND\x20task_day=\x27','title','ERROR','368556bcuZKW','moment','stringify','size','getFullYear','cpSync','source_list','getTime','format','ReadFolderFail','readdirSync','accessSync','prepare','status=\x27running\x27','12eVgTcy','649NGxUXH','getMonth','rmSync','20JtuuAw','abs','1596605xGwOka','UPDATE\x20backup_task_record\x20SET\x20status=\x27waiting\x27\x20where\x20status=\x27running\x27','REPLACE\x20INTO\x20\x0a\x09\x20\x20\x20\x20\x20backup_task_msg(task_id,task_record_id,msg_type,content)\x20\x0a\x09\x20\x20\x20\x20\x20VALUES(\x20?,?,?,?)','mtimeMs','getMinutes','1981BWTLse',',exclude_count=','getI18n','%\x27)','exec','\x27\x20AND\x20task_time\x20LIKE\x20\x27','copy_size=','basename','\x20ERROR:','5348304DmSVIt','rmdirSync','task_id','isFile','exit','target_path','noWritePermission','get','111664Pxkjyl','\x5c$1','getDate','path','712sYjpli','isDirectory','../../myConfig/config','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20id\x20=\x20','parse','select\x20status\x20from\x20backup_task_record\x20where\x20id=','existsSync','REPLACE\x20INTO\x20\x0a\x09\x09\x09\x09\x20\x20\x20\x20\x20backup_task_record(task_id,status,start_time)\x20\x0a\x09\x09\x09\x09\x20\x20\x20\x20\x20VALUES(\x20\x27',',copy_count=','substring','getHours','fileCopyFail','YYYY-MM-DD\x20HH:mm:ss','\x27,\x20\x27waiting\x27,\x27','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x274\x27\x20AND\x20task_day=\x27','journal_mode\x20=\x20WAL','map',',files_count=','R_OK','status','../../utils/i18nUtil','then','all','count','36871497DMWQEn','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x272\x27\x20AND\x20task_time\x20LIKE\x20\x27','\x20WHERE\x20id=','W_OK','dbOther','158sKREKf','targetFolderNotExist','20aLspwU','statSync',',total_size=','test','408927vZZNse','UPDATE\x20backup_task_record\x20SET\x20','\x20and\x20(start_time>=\x27',',status=\x27done\x27,fail_count=','join','length'];_0xc463=function(){return _0x32673e;};return _0xc463();}const _0xeba867=_0x4f16;(function(_0x5eaf16,_0x12b86e){const _0x3b145b=_0x4f16,_0x17754d=_0x5eaf16();while(!![]){try{const _0x3a0fcd=parseInt(_0x3b145b(0x1b2))/0x1*(parseInt(_0x3b145b(0x189))/0x2)+parseInt(_0x3b145b(0x18f))/0x3*(parseInt(_0x3b145b(0x18b))/0x4)+parseInt(_0x3b145b(0x1ad))/0x5*(-parseInt(_0x3b145b(0x1a7))/0x6)+parseInt(_0x3b145b(0x1c3))/0x7*(-parseInt(_0x3b145b(0x1c7))/0x8)+-parseInt(_0x3b145b(0x1bb))/0x9*(-parseInt(_0x3b145b(0x1ab))/0xa)+-parseInt(_0x3b145b(0x1a8))/0xb*(parseInt(_0x3b145b(0x199))/0xc)+parseInt(_0x3b145b(0x184))/0xd;if(_0x3a0fcd===_0x12b86e)break;else _0x17754d['push'](_0x17754d['shift']());}catch(_0xf4b326){_0x17754d['push'](_0x17754d['shift']());}}}(_0xc463,0xf2484));const Database=require('better-sqlite3'),config=require(_0xeba867(0x1c9));let dbOther=new Database(config[_0xeba867(0x188)],{});dbOther['pragma'](_0xeba867(0x17b));let moment=require(_0xeba867(0x19a)),path=require(_0xeba867(0x1c6)),fs=require('fs'),i18nUtil=require(_0xeba867(0x180)),i18n=i18nUtil[_0xeba867(0x1b4)](dbOther);process[_0xeba867(0x197)]='NasCabBackupWorker';let copyFileCount=0x0,copySize=0x0,filesCount=0x0,excludeCount=0x0,totalSize=0x0,paused=![],excludeList=[];function copyFile(_0x2527eb,_0x3e3e8a,_0xd20909,_0x422a00){const _0x3e0aa1=_0xeba867;try{let _0x5605a9=dbOther[_0x3e0aa1(0x1a5)](_0x3e0aa1(0x1cc)+_0x3e3e8a)[_0x3e0aa1(0x1c2)]();if(_0x5605a9[_0x3e0aa1(0x17f)]!='running')return paused=!![],![];let _0x2ebcda=fs[_0x3e0aa1(0x18c)](_0xd20909);filesCount+=0x1,totalSize+=_0x2ebcda[_0x3e0aa1(0x19c)];let _0x1d6072=!![];if(!fs['existsSync'](_0x422a00))fs[_0x3e0aa1(0x19e)](_0xd20909,_0x422a00,{'preserveTimestamps':!![]}),copySize+=_0x2ebcda[_0x3e0aa1(0x19c)],copyFileCount+=0x1;else{let _0x1d3c77=fs['statSync'](_0x422a00);_0x2ebcda[_0x3e0aa1(0x19c)]==_0x1d3c77[_0x3e0aa1(0x19c)]&&Math[_0x3e0aa1(0x1ac)](_0x2ebcda[_0x3e0aa1(0x1b0)]-_0x1d3c77[_0x3e0aa1(0x1b0)])<=0x3e8?_0x1d6072=![]:(fs[_0x3e0aa1(0x19e)](_0xd20909,_0x422a00,{'preserveTimestamps':!![]}),copySize+=_0x2ebcda[_0x3e0aa1(0x19c)],copyFileCount+=0x1);}return _0x1d6072&&updateTaskRecord(_0x3e3e8a,_0x3e0aa1(0x1b8)+copySize+_0x3e0aa1(0x1cf)+copyFileCount),!![];}catch(_0x3f2bbe){return addTaskMsg(_0x2527eb,_0x3e3e8a,'ERROR',_0xd20909+':'+i18n['__']('fileCopyFail')+_0x3e0aa1(0x1ba)+JSON[_0x3e0aa1(0x19b)](_0x3f2bbe)),!![];}}function matchRuleShort(_0x52cf3d,_0x527591){const _0xd799dc=_0xeba867;var _0x34e460=_0x350e3a=>_0x350e3a['replace'](/([.*+?^=!:${}()|\[\]\/\\])/g,_0xd799dc(0x1c4));return new RegExp('^'+_0x527591['split']('*')[_0xd799dc(0x17c)](_0x34e460)[_0xd799dc(0x193)]('.*')+'$')[_0xd799dc(0x18e)](_0x52cf3d);}function copyFolder(_0x183996,_0x2eb93f,_0x1b61a3,_0x3d5c86,_0x34f1f9){const _0x35dbd7=_0xeba867;let _0x1fda61=_0x183996['id'],_0x47a165=checkFolderPower(_0x3d5c86,!![]);if(!_0x47a165)addTaskMsg(_0x1fda61,_0x2eb93f,_0x35dbd7(0x198),i18n['__'](_0x35dbd7(0x1c1))+':'+_0x3d5c86);else try{let _0x506dbd=fs[_0x35dbd7(0x1a3)](_0x3d5c86);for(let _0x575017=0x0;_0x575017<_0x506dbd['length'];_0x575017++){let _0x3ab444=_0x506dbd[_0x575017];var _0x2d4e05=path['join'](_0x3d5c86,_0x3ab444);let _0x5b5086=fs[_0x35dbd7(0x18c)](_0x2d4e05);var _0x20020d=_0x5b5086[_0x35dbd7(0x1be)](),_0x1eff92=_0x5b5086['isDirectory']();if(_0x20020d){if(excludeList['includes'](_0x3ab444))continue;if(_0x183996['exclude_list']&&_0x183996['exclude_list'][_0x35dbd7(0x194)]>0x0){let _0x9b3705=JSON[_0x35dbd7(0x1cb)](_0x183996['exclude_list']),_0x1eca2e=!![];for(let _0xae45a9 in _0x9b3705){if(_0x9b3705[_0xae45a9]['includes']('*')){if(matchRuleShort(_0x3ab444,_0x9b3705[_0xae45a9])){_0x1eca2e=![];break;}}else{if(_0x9b3705[_0xae45a9]==_0x3ab444){_0x1eca2e=![];break;}}}if(!_0x1eca2e){excludeCount+=0x1;continue;}}let _0x38dace=path[_0x35dbd7(0x193)](_0x34f1f9,path[_0x35dbd7(0x1b9)](_0x1b61a3),_0x2d4e05[_0x35dbd7(0x1d0)](_0x1b61a3['length'])),_0x2d78fe=copyFile(_0x1fda61,_0x2eb93f,_0x2d4e05,_0x38dace);if(_0x2d78fe===![])return![];}else _0x1eff92&&copyFolder(_0x183996,_0x2eb93f,_0x1b61a3,_0x2d4e05,_0x34f1f9);}}catch(_0x59c161){addTaskMsg(_0x1fda61,_0x2eb93f,_0x35dbd7(0x198),i18n['__'](_0x35dbd7(0x1a2))+':'+_0x3d5c86);}}function reverseCheck(_0x535efe,_0x374b39,_0x374b5c,_0x4834ce,_0x42d3e9){const _0x564385=_0xeba867;try{if(!fs[_0x564385(0x1cd)](_0x42d3e9))return;let _0x49fbff=fs[_0x564385(0x1a3)](_0x42d3e9);for(let _0x3dfd5a=0x0;_0x3dfd5a<_0x49fbff[_0x564385(0x194)];_0x3dfd5a++){let _0x1b1ea5=_0x49fbff[_0x3dfd5a];var _0x58eb1b=path[_0x564385(0x193)](_0x42d3e9,_0x1b1ea5);let _0x1e3d9e=fs['statSync'](_0x58eb1b);var _0x2ace4d=_0x1e3d9e[_0x564385(0x1be)](),_0x791efb=_0x1e3d9e[_0x564385(0x1c8)]();let _0x3522d1=path[_0x564385(0x193)](_0x4834ce,_0x58eb1b['substring'](_0x374b5c['length']));if(_0x2ace4d)!fs[_0x564385(0x1cd)](_0x3522d1)&&fs[_0x564385(0x1aa)](_0x58eb1b,{'force':!![],'maxRetries':0xa});else _0x791efb&&(!fs[_0x564385(0x1cd)](_0x3522d1)?fs[_0x564385(0x1bc)](_0x58eb1b,{'recursive':!![],'maxRetries':0xa}):reverseCheck(_0x535efe,_0x374b39,_0x374b5c,_0x4834ce,_0x58eb1b));}}catch(_0x2022e7){addTaskMsg(_0x535efe,_0x374b39,'ERROR',i18n['__']('ReadFolderFail')+':'+_0x4834ce);}}function updateTaskRecord(_0x331d4f,_0x21ec85){const _0x36ba50=_0xeba867;let _0x28603c=_0x36ba50(0x190);_0x28603c+=_0x21ec85,_0x28603c+=_0x36ba50(0x186)+_0x331d4f,dbOther[_0x36ba50(0x1b6)](_0x28603c);}function setTaskOver(_0x263045){const _0x5b0acc=_0xeba867;let _0x303511=dbOther[_0x5b0acc(0x1a5)]('select\x20count(*)\x20as\x20count\x20from\x20backup_task_msg\x20where\x20msg_type=\x27ERROR\x27\x20and\x20task_record_id='+_0x263045['id'])[_0x5b0acc(0x1c2)](),_0x3acaf1=moment()[_0x5b0acc(0x1a1)](_0x5b0acc(0x178));updateTaskRecord(_0x263045['id'],_0x5b0acc(0x1b8)+copySize+',copy_count='+copyFileCount+_0x5b0acc(0x1b3)+excludeCount+_0x5b0acc(0x192)+_0x303511[_0x5b0acc(0x183)]+_0x5b0acc(0x17d)+filesCount+_0x5b0acc(0x18d)+totalSize+',end_time=\x27'+_0x3acaf1+'\x27');}function addTaskMsg(_0x1e17d9,_0x39748b,_0x4a9d7b,_0x54f53d){const _0x4863fc=_0xeba867,_0x569b4b=_0x4863fc(0x1af);return dbOther[_0x4863fc(0x1a5)](_0x569b4b)['run'](''+_0x1e17d9,''+_0x39748b,''+_0x4a9d7b,''+_0x54f53d);}function checkFolderPower(_0xce6284,_0x4a00b1){const _0x35cc7b=_0xeba867;try{return _0x4a00b1?fs['accessSync'](_0xce6284,fs[_0x35cc7b(0x195)][_0x35cc7b(0x17e)]):fs[_0x35cc7b(0x1a4)](_0xce6284,fs[_0x35cc7b(0x195)][_0x35cc7b(0x17e)]|fs[_0x35cc7b(0x195)][_0x35cc7b(0x187)]),!![];}catch(_0x21b1a5){return![];}}function exeTask(_0x4e9d5c){const _0x26b2c5=_0xeba867;let _0x1ec6d1='SELECT\x20*\x20FROM\x20backup_task_record\x20WHERE\x20status\x20=\x20\x27waiting\x27\x20order\x20by\x20start_time\x20limit\x201\x20',_0x5d151e=dbOther['prepare'](_0x1ec6d1)[_0x26b2c5(0x1c2)]();if(_0x5d151e){let _0x325061=_0x26b2c5(0x1ca)+_0x5d151e[_0x26b2c5(0x1bd)],_0x4ada3d=dbOther[_0x26b2c5(0x1a5)](_0x325061)[_0x26b2c5(0x1c2)]();if(!fs['existsSync'](_0x4ada3d[_0x26b2c5(0x1c0)]))return addTaskMsg(_0x4ada3d['id'],_0x5d151e['id'],_0x26b2c5(0x198),i18n['__'](_0x26b2c5(0x18a))+':'+_0x4ada3d[_0x26b2c5(0x1c0)]),setTaskOver(_0x5d151e),_0x4e9d5c();let _0x267c3a=checkFolderPower(_0x4ada3d[_0x26b2c5(0x1c0)]);if(!_0x267c3a)return addTaskMsg(_0x4ada3d['id'],_0x5d151e['id'],_0x26b2c5(0x198),i18n['__'](_0x26b2c5(0x1c1))+':'+_0x4ada3d[_0x26b2c5(0x1c0)]),setTaskOver(_0x5d151e),_0x4e9d5c();updateTaskRecord(_0x5d151e['id'],_0x26b2c5(0x1a6));let _0x369537=JSON[_0x26b2c5(0x1cb)](_0x4ada3d[_0x26b2c5(0x19f)]);copyFileCount=0x0,copySize=0x0,filesCount=0x0,excludeCount=0x0,totalSize=0x0,paused=![];for(let _0x108884 in _0x369537){try{if(fs[_0x26b2c5(0x1cd)](_0x369537[_0x108884])){copyFolder(_0x4ada3d,_0x5d151e['id'],_0x369537[_0x108884],_0x369537[_0x108884],_0x4ada3d[_0x26b2c5(0x1c0)]);if(!paused){let _0x5bb06f=path[_0x26b2c5(0x193)](_0x4ada3d[_0x26b2c5(0x1c0)],path['basename'](_0x369537[_0x108884]));reverseCheck(_0x4ada3d['id'],_0x5d151e['id'],_0x5bb06f,_0x369537[_0x108884],_0x5bb06f);}}else addTaskMsg(_0x4ada3d['id'],_0x5d151e['id'],_0x26b2c5(0x198),i18n['__']('folderNotExist')+':'+_0x369537[_0x108884]);}catch(_0x37033d){addTaskMsg(_0x4ada3d['id'],_0x5d151e['id'],_0x26b2c5(0x198),i18n['__'](_0x26b2c5(0x177))+':'+_0x369537[_0x108884]+':'+JSON[_0x26b2c5(0x19b)](_0x37033d));}}!paused&&setTaskOver(_0x5d151e),_0x4e9d5c();}else setTimeout(()=>{_0x4e9d5c();},0x2710);}function runInfinit(){return new Promise(_0x286371=>{exeTask(_0x286371);});}async function runBacupExe(){const _0x341bcb=_0xeba867;runInfinit()[_0x341bcb(0x181)](()=>{runBacupExe();});}dbOther[_0xeba867(0x1b6)](_0xeba867(0x1ae)),runBacupExe();function addTask(_0x1b3baf){const _0x382faf=_0xeba867;let _0x2e8bc7=dbOther[_0x382faf(0x1a5)](_0x1b3baf)[_0x382faf(0x182)]();if(_0x2e8bc7[_0x382faf(0x194)]>0x0)for(let _0x3f99b5=0x0;_0x3f99b5<_0x2e8bc7[_0x382faf(0x194)];_0x3f99b5++){let _0x462494=_0x2e8bc7[_0x3f99b5],_0x3b63a9=moment(new Date()[_0x382faf(0x1a0)]()-0xea60)[_0x382faf(0x1a1)](_0x382faf(0x178)),_0x3d5506='select\x20count(*)\x20as\x20count\x20from\x20backup_task_record\x20where\x20task_id='+_0x462494['id']+_0x382faf(0x191)+_0x3b63a9+'\x27\x20or\x20status!=\x27done\x27)',_0x3a84a5=dbOther['prepare'](_0x3d5506)[_0x382faf(0x1c2)]();if(_0x3a84a5[_0x382faf(0x183)]<0x1){let _0xace1fc=moment()['format'](_0x382faf(0x178));const _0x2eca79=_0x382faf(0x1ce)+_0x462494['id']+_0x382faf(0x179)+_0xace1fc+'\x27)';return dbOther[_0x382faf(0x1b6)](_0x2eca79);}else{}}}function add0(_0x460782){return _0x460782<0xa?'0'+_0x460782:_0x460782;}function _0x4f16(_0x4ce87b,_0x2468ed){const _0xc4634c=_0xc463();return _0x4f16=function(_0x4f166b,_0x7e6d4){_0x4f166b=_0x4f166b-0x177;let _0x4eaec9=_0xc4634c[_0x4f166b];return _0x4eaec9;},_0x4f16(_0x4ce87b,_0x2468ed);}function getYmd(_0x4d490c){const _0x40a46c=_0xeba867;var _0x56cc28=_0x4d490c[_0x40a46c(0x19d)](),_0x26e4ef=_0x4d490c[_0x40a46c(0x1a9)]()+0x1,_0x412c99=_0x4d490c[_0x40a46c(0x1c5)]();return _0x56cc28+'-'+add0(_0x26e4ef)+'-'+add0(_0x412c99);}function runBackupCheck(){setInterval(()=>{const _0x424a2c=_0x4f16;let _0x265110=new Date(),_0x4c66ec=_0x265110['getDay'](),_0x280295=_0x265110[_0x424a2c(0x1c5)](),_0x5ccda8=add0(_0x265110[_0x424a2c(0x1d1)]()),_0x5eb015=add0(_0x265110[_0x424a2c(0x1b1)]()),_0x5a71ca=getYmd(_0x265110),_0x2ef607=_0x424a2c(0x196)+_0x5a71ca+_0x424a2c(0x1b7)+_0x5ccda8+':'+_0x5eb015+_0x424a2c(0x1b5);addTask(_0x2ef607);let _0x5b65d0=_0x424a2c(0x185)+_0x5ccda8+':'+_0x5eb015+_0x424a2c(0x1b5);addTask(_0x5b65d0);let _0x38272e='SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x273\x27\x20AND\x20task_day=\x27'+_0x4c66ec+'\x27\x20AND\x20task_time\x20LIKE\x20\x27'+_0x5ccda8+':'+_0x5eb015+_0x424a2c(0x1b5);addTask(_0x38272e);let _0x151b38=_0x424a2c(0x17a)+_0x280295+_0x424a2c(0x1b7)+_0x5ccda8+':'+_0x5eb015+_0x424a2c(0x1b5);addTask(_0x151b38);},0x3a98);}runBackupCheck(),process['on'](_0xeba867(0x1bf),(_0x29af21,_0x1923ea)=>{process['send']({'type':'close'});});