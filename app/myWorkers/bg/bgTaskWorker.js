const _0x5eefc1=_0xffd3;(function(_0x36e86e,_0xf46b4f){const _0x1c9515=_0xffd3,_0x8ae7cb=_0x36e86e();while(!![]){try{const _0x35f7ae=-parseInt(_0x1c9515(0xb6))/0x1+-parseInt(_0x1c9515(0xae))/0x2+-parseInt(_0x1c9515(0xbd))/0x3+parseInt(_0x1c9515(0xc7))/0x4+parseInt(_0x1c9515(0xc1))/0x5+parseInt(_0x1c9515(0xb3))/0x6*(parseInt(_0x1c9515(0xdf))/0x7)+parseInt(_0x1c9515(0xd1))/0x8*(-parseInt(_0x1c9515(0xd3))/0x9);if(_0x35f7ae===_0xf46b4f)break;else _0x8ae7cb['push'](_0x8ae7cb['shift']());}catch(_0x28ff62){_0x8ae7cb['push'](_0x8ae7cb['shift']());}}}(_0x3ea1,0x479bb));let path=require(_0x5eefc1(0xb8)),fs=require('fs'),cryptoUtils=require(_0x5eefc1(0xbb));const dbNoticeCenterTable=require(_0x5eefc1(0xc6)),config=require(_0x5eefc1(0xd2)),Database=require('better-sqlite3');let dbOther=new Database(config[_0x5eefc1(0xc8)],{});dbOther[_0x5eefc1(0xda)]('journal_mode\x20=\x20WAL');let i18nUtil=require(_0x5eefc1(0xdb)),i18n=i18nUtil['getI18n'](dbOther);function _0x3ea1(){const _0x1dde6f=['join','title','3803114uoxJcP','isFile','targetFolderPath','toString','spacePwd','335754xnBPIJ','NasCabBgTaskWorker','UPDATE\x20bg_task\x20SET\x20progress_current=','private.passwordIncorrect','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','6jhvJVc','prepare','UPDATE\x20bg_task\x20SET\x20progress_all=','170496HLSonW','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=','path','decryptString','\x20where\x20id=','../../express-server/utils/cryptoUtils','close','839649GSWneO','catch',']\x20=>\x20[','get','1905760gxCLDB','statSync','stringify','send','from','../../db/dbNoticeCenterTable','527164uqFlzN','dbOther','length','privateSpaceKey','run','error','log','folderPath','private.exportSuc','private.exportStart','1157456cHmhRI','../../myConfig/config','9wVKXvz','private.exportFail','startsWith','task_json','taskDeleted','then','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','pragma','../../utils/i18nUtil','info'];_0x3ea1=function(){return _0x1dde6f;};return _0x3ea1();}process[_0x5eefc1(0xde)]=_0x5eefc1(0xaf);function saveMsg(_0x51fae6,_0x5857db,_0x5aadeb){dbNoticeCenterTable['create'](dbOther,{'title':_0x51fae6,'level':_0x5857db,'content':_0x5aadeb});}async function exportPrivateSpace(_0x48a795,_0x183add,_0x240044,_0x18715e,_0x76e831){const _0x160bdb=_0x5eefc1;saveMsg(i18n['__'](_0x160bdb(0xd0)),_0x160bdb(0xdc),'['+_0x48a795+_0x160bdb(0xbf)+_0x183add+']'),cryptoUtils[_0x160bdb(0xb9)](config[_0x160bdb(0xca)],_0x240044)[_0x160bdb(0xd8)](async _0x584385=>{const _0x130e85=_0x160bdb;_0x240044=Buffer[_0x130e85(0xc5)](_0x584385,'base64')[_0x130e85(0xe2)]();try{let _0x69223c=0x0,_0x3429d8=0x0,_0x16e874=fs['readdirSync'](_0x48a795);dbOther[_0x130e85(0xb4)](_0x130e85(0xb5)+_0x16e874[_0x130e85(0xc9)]+_0x130e85(0xba)+_0x18715e['id'])[_0x130e85(0xcb)]();let _0x1a6794;for(let _0x150c05=0x0;_0x150c05<_0x16e874[_0x130e85(0xc9)];_0x150c05++){try{let _0x2becc0=dbOther[_0x130e85(0xb4)]('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id='+_0x18715e['id'])[_0x130e85(0xc0)]();if(!_0x2becc0)return saveMsg(i18n['__'](_0x130e85(0xd4)),'error',i18n['__'](_0x130e85(0xd7))),_0x76e831();dbOther[_0x130e85(0xb4)](_0x130e85(0xb0)+(_0x150c05+0x1)+_0x130e85(0xba)+_0x18715e['id'])[_0x130e85(0xcb)](),_0x1a6794=_0x16e874[_0x150c05];if(_0x1a6794[_0x130e85(0xd5)]('.'))continue;let _0x5cb98d=path['join'](_0x48a795,_0x1a6794),_0x33299a=fs[_0x130e85(0xc2)](_0x5cb98d)[_0x130e85(0xe0)](),_0x18da6f=path[_0x130e85(0xdd)](_0x183add,_0x1a6794);if(_0x33299a)try{await cryptoUtils['decryptFile'](_0x240044,_0x5cb98d,fs['createWriteStream'](_0x18da6f)),cryptoUtils[_0x130e85(0xb9)](_0x240044,_0x1a6794)[_0x130e85(0xd8)](_0x59f815=>{let _0xb1a543=path['join'](_0x183add,_0x59f815);fs['renameSync'](_0x18da6f,_0xb1a543);})['catch'](_0x47473e=>{const _0x4cb09f=_0x130e85;console[_0x4cb09f(0xcd)](_0x4cb09f(0xcc),_0x47473e);});}catch(_0x190639){console[_0x130e85(0xcd)](_0x130e85(0xcc),_0x190639),saveMsg(i18n['__'](_0x130e85(0xd4)),_0x130e85(0xcc),_0x5cb98d+':'+JSON[_0x130e85(0xc3)](err));}}catch(_0x199c00){saveMsg(i18n['__']('private.exportFail'),_0x130e85(0xcc),_0x1a6794+'\x20'+_0x199c00?JSON['stringify'](_0x199c00):'');continue;}}saveMsg(i18n['__'](_0x130e85(0xcf)),'info','['+_0x48a795+_0x130e85(0xbf)+_0x183add+']'),dbOther[_0x130e85(0xb4)](_0x130e85(0xb2)+_0x18715e['id'])['run'](),_0x76e831();}catch(_0x50366e){console['log'](_0x50366e),saveMsg(i18n['__']('private.exportFail'),_0x130e85(0xcc),_0x50366e?JSON[_0x130e85(0xc3)](_0x50366e):''),dbOther[_0x130e85(0xb4)]('UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id='+_0x18715e['id'])[_0x130e85(0xcb)](),_0x76e831();}})[_0x160bdb(0xbe)](_0x276cb9=>{const _0x581e6f=_0x160bdb;console['log'](_0x276cb9),saveMsg(i18n['__'](_0x581e6f(0xd4)),_0x581e6f(0xcc),i18n['__'](_0x581e6f(0xb1))),dbOther[_0x581e6f(0xb4)](_0x581e6f(0xb7)+_0x18715e['id'])[_0x581e6f(0xcb)](),_0x76e831();});}async function taskStart(){return new Promise((_0x466071,_0x1ce698)=>{const _0x245a54=_0xffd3;let _0x32dec0=dbOther[_0x245a54(0xb4)]('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201')[_0x245a54(0xc0)]();if(_0x32dec0){let _0x4eb607=JSON['parse'](_0x32dec0[_0x245a54(0xd6)]);dbOther[_0x245a54(0xb4)](_0x245a54(0xd9)+_0x32dec0['id'])[_0x245a54(0xcb)](),exportPrivateSpace(_0x4eb607[_0x245a54(0xce)],_0x4eb607[_0x245a54(0xe1)],_0x4eb607[_0x245a54(0xe3)],_0x32dec0,_0x466071);}else process[_0x245a54(0xc4)]({'type':_0x245a54(0xbc)});});}async function runGbTask(){const _0x4f221b=_0x5eefc1;taskStart()[_0x4f221b(0xd8)](()=>{runGbTask();});}function _0xffd3(_0x2cd1f4,_0x4b4998){const _0x3ea1c4=_0x3ea1();return _0xffd3=function(_0xffd369,_0x310199){_0xffd369=_0xffd369-0xae;let _0x3673fa=_0x3ea1c4[_0xffd369];return _0x3673fa;},_0xffd3(_0x2cd1f4,_0x4b4998);}runGbTask();