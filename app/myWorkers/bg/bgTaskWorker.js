const _0x230164=_0x5439;(function(_0x108f0f,_0x43a2e0){const _0x1d2bde=_0x5439,_0x3db213=_0x108f0f();while(!![]){try{const _0x369738=parseInt(_0x1d2bde(0xa8))/0x1*(-parseInt(_0x1d2bde(0xd5))/0x2)+parseInt(_0x1d2bde(0xdb))/0x3+-parseInt(_0x1d2bde(0xb5))/0x4*(-parseInt(_0x1d2bde(0xc9))/0x5)+parseInt(_0x1d2bde(0xad))/0x6*(parseInt(_0x1d2bde(0xcf))/0x7)+-parseInt(_0x1d2bde(0xa7))/0x8*(-parseInt(_0x1d2bde(0xd6))/0x9)+parseInt(_0x1d2bde(0xca))/0xa+-parseInt(_0x1d2bde(0xd8))/0xb;if(_0x369738===_0x43a2e0)break;else _0x3db213['push'](_0x3db213['shift']());}catch(_0x931f58){_0x3db213['push'](_0x3db213['shift']());}}}(_0x3039,0xab0e0));let path=require(_0x230164(0xb7)),fs=require('fs'),cryptoUtils=require(_0x230164(0xb9));function _0x3039(){const _0x3bea31=['folderPath','stringify','decryptFile',']\x20=>\x20[','renameSync','private.exportFail','send','5xpSGqI','12030390OQVJZA','NasCabBgTaskWorker','../../myConfig/config','title','catch','14FZwlUo','better-sqlite3','dbOther','decryptString','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','privateSpaceKey','276jibwmF','15291JliVXD','prepare','43122585RKBzjJ','private.passwordIncorrect','info','4162278wSzXQu','readdirSync','toString','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201','UPDATE\x20bg_task\x20SET\x20progress_current=','4936AIXsZD','706OPTJba','../../db/dbNoticeCenterTable','join','createWriteStream','statSync','345234zzsspO','base64','task_json','run','getI18n','length','\x20where\x20id=','close','3857908WaKtel','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=','path','log','../../express-server/utils/cryptoUtils','then','UPDATE\x20bg_task\x20SET\x20progress_all=','journal_mode\x20=\x20WAL','error','isFile','private.exportStart','private.exportSuc','get'];_0x3039=function(){return _0x3bea31;};return _0x3039();}const dbNoticeCenterTable=require(_0x230164(0xa9)),config=require(_0x230164(0xcc)),Database=require(_0x230164(0xd0));let dbOther=new Database(config[_0x230164(0xd1)],{});dbOther['pragma'](_0x230164(0xbc));let i18nUtil=require('../../utils/i18nUtil'),i18n=i18nUtil[_0x230164(0xb1)](dbOther);function _0x5439(_0xc36722,_0x12dec3){const _0x3039b5=_0x3039();return _0x5439=function(_0x54397f,_0x2bde75){_0x54397f=_0x54397f-0xa6;let _0x3a1e5a=_0x3039b5[_0x54397f];return _0x3a1e5a;},_0x5439(_0xc36722,_0x12dec3);}process[_0x230164(0xcd)]=_0x230164(0xcb);function saveMsg(_0x226cce,_0x3222be,_0x225f40){dbNoticeCenterTable['create'](dbOther,{'title':_0x226cce,'level':_0x3222be,'content':_0x225f40});}async function exportPrivateSpace(_0x101da7,_0x3e099a,_0x30224a,_0x5452e3,_0x322214){const _0x41f4a8=_0x230164;saveMsg(i18n['__'](_0x41f4a8(0xbf)),_0x41f4a8(0xda),'['+_0x101da7+']\x20=>\x20['+_0x3e099a+']'),cryptoUtils[_0x41f4a8(0xd2)](config[_0x41f4a8(0xd4)],_0x30224a)[_0x41f4a8(0xba)](async _0x18b7a9=>{const _0x30c97e=_0x41f4a8;_0x30224a=Buffer['from'](_0x18b7a9,_0x30c97e(0xae))[_0x30c97e(0xdd)]();try{let _0x375662=0x0,_0x61f23c=0x0,_0x4cbaa2=fs[_0x30c97e(0xdc)](_0x101da7);dbOther[_0x30c97e(0xd7)](_0x30c97e(0xbb)+_0x4cbaa2['length']+'\x20where\x20id='+_0x5452e3['id'])[_0x30c97e(0xb0)]();let _0xf21e;for(let _0x31d769=0x0;_0x31d769<_0x4cbaa2[_0x30c97e(0xb2)];_0x31d769++){try{let _0xa128ae=dbOther[_0x30c97e(0xd7)]('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id='+_0x5452e3['id'])['get']();if(!_0xa128ae)return saveMsg(i18n['__'](_0x30c97e(0xc7)),_0x30c97e(0xbd),i18n['__']('taskDeleted')),_0x322214();dbOther[_0x30c97e(0xd7)](_0x30c97e(0xa6)+(_0x31d769+0x1)+_0x30c97e(0xb3)+_0x5452e3['id'])[_0x30c97e(0xb0)](),_0xf21e=_0x4cbaa2[_0x31d769];if(_0xf21e['startsWith']('.'))continue;let _0x3ee463=path[_0x30c97e(0xaa)](_0x101da7,_0xf21e),_0x2bc9c9=fs[_0x30c97e(0xac)](_0x3ee463)[_0x30c97e(0xbe)](),_0x182fd4=path[_0x30c97e(0xaa)](_0x3e099a,_0xf21e);if(_0x2bc9c9)try{await cryptoUtils[_0x30c97e(0xc4)](_0x30224a,_0x3ee463,fs[_0x30c97e(0xab)](_0x182fd4)),cryptoUtils[_0x30c97e(0xd2)](_0x30224a,_0xf21e)['then'](_0x15e551=>{const _0x1e0ecb=_0x30c97e;let _0xeb78c6=path['join'](_0x3e099a,_0x15e551);fs[_0x1e0ecb(0xc6)](_0x182fd4,_0xeb78c6);})['catch'](_0x479642=>{const _0x2ad1d3=_0x30c97e;console[_0x2ad1d3(0xb8)](_0x2ad1d3(0xbd),_0x479642);});}catch(_0x405dd7){console[_0x30c97e(0xb8)]('error',_0x405dd7),saveMsg(i18n['__']('private.exportFail'),_0x30c97e(0xbd),_0x3ee463+':'+JSON[_0x30c97e(0xc3)](err));}}catch(_0x6e23a3){saveMsg(i18n['__'](_0x30c97e(0xc7)),_0x30c97e(0xbd),_0xf21e+'\x20'+_0x6e23a3?JSON['stringify'](_0x6e23a3):'');continue;}}saveMsg(i18n['__'](_0x30c97e(0xc0)),'info','['+_0x101da7+_0x30c97e(0xc5)+_0x3e099a+']'),dbOther[_0x30c97e(0xd7)]('UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id='+_0x5452e3['id'])[_0x30c97e(0xb0)](),_0x322214();}catch(_0xa83931){console['log'](_0xa83931),saveMsg(i18n['__'](_0x30c97e(0xc7)),_0x30c97e(0xbd),_0xa83931?JSON[_0x30c97e(0xc3)](_0xa83931):''),dbOther[_0x30c97e(0xd7)](_0x30c97e(0xb6)+_0x5452e3['id'])[_0x30c97e(0xb0)](),_0x322214();}})[_0x41f4a8(0xce)](_0x4ac8b9=>{const _0x7279ec=_0x41f4a8;console[_0x7279ec(0xb8)](_0x4ac8b9),saveMsg(i18n['__'](_0x7279ec(0xc7)),_0x7279ec(0xbd),i18n['__'](_0x7279ec(0xd9))),dbOther['prepare']('UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id='+_0x5452e3['id'])[_0x7279ec(0xb0)](),_0x322214();});}async function taskStart(){return new Promise((_0x1f0761,_0xc587ae)=>{const _0x2323f5=_0x5439;let _0x3f8d95=dbOther['prepare'](_0x2323f5(0xde))[_0x2323f5(0xc1)]();if(_0x3f8d95){let _0xd36f6b=JSON['parse'](_0x3f8d95[_0x2323f5(0xaf)]);dbOther[_0x2323f5(0xd7)](_0x2323f5(0xd3)+_0x3f8d95['id'])['run'](),exportPrivateSpace(_0xd36f6b[_0x2323f5(0xc2)],_0xd36f6b['targetFolderPath'],_0xd36f6b['spacePwd'],_0x3f8d95,_0x1f0761);}else process[_0x2323f5(0xc8)]({'type':_0x2323f5(0xb4)});});}async function runGbTask(){const _0x1739ba=_0x230164;taskStart()[_0x1739ba(0xba)](()=>{runGbTask();});}runGbTask();