const _0x1ba6d7=_0x5c85;(function(_0x513807,_0x53c785){const _0x443950=_0x5c85,_0xe8afc1=_0x513807();while(!![]){try{const _0x31ac06=parseInt(_0x443950(0x114))/0x1+parseInt(_0x443950(0x105))/0x2+parseInt(_0x443950(0x121))/0x3*(-parseInt(_0x443950(0x122))/0x4)+parseInt(_0x443950(0x117))/0x5+-parseInt(_0x443950(0x10d))/0x6+parseInt(_0x443950(0xf7))/0x7+-parseInt(_0x443950(0x108))/0x8;if(_0x31ac06===_0x53c785)break;else _0xe8afc1['push'](_0xe8afc1['shift']());}catch(_0x48f67f){_0xe8afc1['push'](_0xe8afc1['shift']());}}}(_0x294f,0x35000));let path=require(_0x1ba6d7(0x11e)),fs=require('fs'),cryptoUtils=require(_0x1ba6d7(0x11f));function _0x5c85(_0x142729,_0xf6742e){const _0x294f65=_0x294f();return _0x5c85=function(_0x5c85b3,_0x400425){_0x5c85b3=_0x5c85b3-0xf5;let _0x49fcc0=_0x294f65[_0x5c85b3];return _0x49fcc0;},_0x5c85(_0x142729,_0xf6742e);}const dbNoticeCenterTable=require(_0x1ba6d7(0x11d)),config=require('../../myConfig/config'),Database=require('better-sqlite3');let dbOther=new Database(config['dbOther'],{});dbOther[_0x1ba6d7(0x101)](_0x1ba6d7(0xfd));let i18nUtil=require(_0x1ba6d7(0x116)),i18n=i18nUtil[_0x1ba6d7(0x102)](dbOther);process['title']=_0x1ba6d7(0x128);function saveMsg(_0x38b949,_0x37556c,_0x3dbbdf){dbNoticeCenterTable['create'](dbOther,{'title':_0x38b949,'level':_0x37556c,'content':_0x3dbbdf});}async function exportPrivateSpace(_0x30ddbd,_0x214783,_0x4c976a,_0x17bafc,_0x3cd8ae){const _0x9886d1=_0x1ba6d7;saveMsg(i18n['__'](_0x9886d1(0x12a)),'info','['+_0x30ddbd+_0x9886d1(0x113)+_0x214783+']'),cryptoUtils[_0x9886d1(0xff)](config['privateSpaceKey'],_0x4c976a)[_0x9886d1(0xf8)](async _0x5c87e5=>{const _0x42d2ba=_0x9886d1;_0x4c976a=Buffer[_0x42d2ba(0x109)](_0x5c87e5,'base64')['toString']();try{let _0x4cb034=0x0,_0x27fcb8=0x0,_0x764679=fs[_0x42d2ba(0xfa)](_0x30ddbd);dbOther['prepare'](_0x42d2ba(0x100)+_0x764679['length']+_0x42d2ba(0x115)+_0x17bafc['id'])[_0x42d2ba(0x123)]();let _0x4fd032;for(let _0x171bbb=0x0;_0x171bbb<_0x764679[_0x42d2ba(0x126)];_0x171bbb++){try{let _0x50aaca=dbOther['prepare']('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id='+_0x17bafc['id'])[_0x42d2ba(0x120)]();if(!_0x50aaca)return saveMsg(i18n['__'](_0x42d2ba(0xfc)),_0x42d2ba(0x127),i18n['__'](_0x42d2ba(0x129))),_0x3cd8ae();dbOther[_0x42d2ba(0x10e)](_0x42d2ba(0x125)+(_0x171bbb+0x1)+_0x42d2ba(0x115)+_0x17bafc['id'])[_0x42d2ba(0x123)](),_0x4fd032=_0x764679[_0x171bbb];if(_0x4fd032[_0x42d2ba(0x104)]('.'))continue;let _0x545f50=path[_0x42d2ba(0x11b)](_0x30ddbd,_0x4fd032),_0x5f3ec3=fs[_0x42d2ba(0x10a)](_0x545f50)[_0x42d2ba(0x124)](),_0x50d979=path[_0x42d2ba(0x11b)](_0x214783,_0x4fd032);if(_0x5f3ec3)try{await cryptoUtils['decryptFile'](_0x4c976a,_0x545f50,fs[_0x42d2ba(0x103)](_0x50d979)),cryptoUtils[_0x42d2ba(0xff)](_0x4c976a,_0x4fd032)[_0x42d2ba(0xf8)](_0x2dbf4b=>{const _0x59439c=_0x42d2ba;let _0x13bbe3=path['join'](_0x214783,_0x2dbf4b);fs[_0x59439c(0x112)](_0x50d979,_0x13bbe3);})[_0x42d2ba(0x119)](_0x40806d=>{console['log']('error',_0x40806d);});}catch(_0x3d3e14){console[_0x42d2ba(0xfe)]('error',_0x3d3e14),saveMsg(i18n['__'](_0x42d2ba(0xfc)),'error',_0x545f50+':'+JSON[_0x42d2ba(0x110)](err));}}catch(_0x37a4fd){saveMsg(i18n['__'](_0x42d2ba(0xfc)),_0x42d2ba(0x127),_0x4fd032+'\x20'+_0x37a4fd?JSON[_0x42d2ba(0x110)](_0x37a4fd):'');continue;}}saveMsg(i18n['__'](_0x42d2ba(0x118)),_0x42d2ba(0xf5),'['+_0x30ddbd+']\x20=>\x20['+_0x214783+']'),dbOther[_0x42d2ba(0x10e)](_0x42d2ba(0x10b)+_0x17bafc['id'])[_0x42d2ba(0x123)](),_0x3cd8ae();}catch(_0x5e432f){console[_0x42d2ba(0xfe)](_0x5e432f),saveMsg(i18n['__']('private.exportFail'),_0x42d2ba(0x127),_0x5e432f?JSON['stringify'](_0x5e432f):''),dbOther[_0x42d2ba(0x10e)]('UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id='+_0x17bafc['id'])[_0x42d2ba(0x123)](),_0x3cd8ae();}})['catch'](_0x41ddc3=>{const _0x4db320=_0x9886d1;console['log'](_0x41ddc3),saveMsg(i18n['__']('private.exportFail'),_0x4db320(0x127),i18n['__'](_0x4db320(0x11a))),dbOther[_0x4db320(0x10e)]('UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id='+_0x17bafc['id'])['run'](),_0x3cd8ae();});}async function taskStart(){return new Promise((_0x4f43c1,_0x2cec88)=>{const _0x5a32fe=_0x5c85;let _0x5eb9f3=dbOther[_0x5a32fe(0x10e)](_0x5a32fe(0x11c))[_0x5a32fe(0x120)]();if(_0x5eb9f3){let _0x524343=JSON[_0x5a32fe(0x106)](_0x5eb9f3[_0x5a32fe(0xfb)]);dbOther[_0x5a32fe(0x10e)](_0x5a32fe(0x107)+_0x5eb9f3['id'])[_0x5a32fe(0x123)](),exportPrivateSpace(_0x524343[_0x5a32fe(0xf9)],_0x524343[_0x5a32fe(0x111)],_0x524343[_0x5a32fe(0xf6)],_0x5eb9f3,_0x4f43c1);}else process[_0x5a32fe(0x10f)]({'type':_0x5a32fe(0x10c)});});}async function runGbTask(){const _0x56f02f=_0x1ba6d7;taskStart()[_0x56f02f(0xf8)](()=>{runGbTask();});}function _0x294f(){const _0x57da4f=['private.exportFail','journal_mode\x20=\x20WAL','log','decryptString','UPDATE\x20bg_task\x20SET\x20progress_all=','pragma','getI18n','createWriteStream','startsWith','214000wTZVmb','parse','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','1925392YIxgfN','from','statSync','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','close','1049916ozPudT','prepare','send','stringify','targetFolderPath','renameSync',']\x20=>\x20[','223487lYovck','\x20where\x20id=','../../utils/i18nUtil','1392870AISOrr','private.exportSuc','catch','private.passwordIncorrect','join','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201','../../db/dbNoticeCenterTable','path','../../express-server/utils/cryptoUtils','get','23565jaFqMb','180JNrshM','run','isFile','UPDATE\x20bg_task\x20SET\x20progress_current=','length','error','NasCabBgTaskWorker','taskDeleted','private.exportStart','info','spacePwd','2640134STWyRS','then','folderPath','readdirSync','task_json'];_0x294f=function(){return _0x57da4f;};return _0x294f();}runGbTask();