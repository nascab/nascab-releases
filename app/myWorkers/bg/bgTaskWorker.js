const _0x1e1f2c=_0x99b4;(function(_0x51fe96,_0x1888d0){const _0x12d407=_0x99b4,_0x55e8d3=_0x51fe96();while(!![]){try{const _0x198f26=parseInt(_0x12d407(0xc5))/0x1+parseInt(_0x12d407(0xdd))/0x2*(-parseInt(_0x12d407(0xf2))/0x3)+-parseInt(_0x12d407(0xd3))/0x4*(-parseInt(_0x12d407(0xf6))/0x5)+parseInt(_0x12d407(0xde))/0x6*(-parseInt(_0x12d407(0xcd))/0x7)+parseInt(_0x12d407(0xdf))/0x8+-parseInt(_0x12d407(0xcb))/0x9+parseInt(_0x12d407(0xed))/0xa;if(_0x198f26===_0x1888d0)break;else _0x55e8d3['push'](_0x55e8d3['shift']());}catch(_0x2ccd2a){_0x55e8d3['push'](_0x55e8d3['shift']());}}}(_0x1688,0x9c3de));function _0x99b4(_0x138241,_0x3accf6){const _0x168826=_0x1688();return _0x99b4=function(_0x99b422,_0x547616){_0x99b422=_0x99b422-0xc4;let _0x3bf7dc=_0x168826[_0x99b422];return _0x3bf7dc;},_0x99b4(_0x138241,_0x3accf6);}let path=require(_0x1e1f2c(0xe1)),fs=require('fs'),cryptoUtils=require(_0x1e1f2c(0xd8));const dbNoticeCenterTable=require('../../db/dbNoticeCenterTable'),config=require(_0x1e1f2c(0xf4)),Database=require('better-sqlite3');let dbOther=new Database(config[_0x1e1f2c(0xd1)],{});dbOther[_0x1e1f2c(0xc4)]('journal_mode\x20=\x20WAL');let i18nUtil=require(_0x1e1f2c(0xd5)),i18n=i18nUtil[_0x1e1f2c(0xef)](dbOther);process[_0x1e1f2c(0xf5)]='NasCabBgTaskWorker';function saveMsg(_0x9cfdbe,_0x272865,_0x2337c5){const _0x5afa2e=_0x1e1f2c;dbNoticeCenterTable[_0x5afa2e(0xd9)](dbOther,{'title':_0x9cfdbe,'level':_0x272865,'content':_0x2337c5});}async function exportPrivateSpace(_0xabb46b,_0x29fcb5,_0x2e53e3,_0x563390,_0x3eb75a){const _0x10b386=_0x1e1f2c;saveMsg(i18n['__']('private.exportStart'),'info','['+_0xabb46b+']\x20=>\x20['+_0x29fcb5+']'),cryptoUtils[_0x10b386(0xe0)](config[_0x10b386(0xee)],_0x2e53e3)[_0x10b386(0xe2)](async _0xc3902c=>{const _0x231334=_0x10b386;_0x2e53e3=Buffer[_0x231334(0xe8)](_0xc3902c,'base64')[_0x231334(0xfa)]();try{let _0x9bbf=0x0,_0x273400=0x0,_0x21ba4d=fs[_0x231334(0xc8)](_0xabb46b);dbOther[_0x231334(0xea)](_0x231334(0xeb)+_0x21ba4d['length']+_0x231334(0xcf)+_0x563390['id'])[_0x231334(0xe6)]();let _0x1f4299;for(let _0x460fca=0x0;_0x460fca<_0x21ba4d['length'];_0x460fca++){try{let _0x58e868=dbOther[_0x231334(0xea)](_0x231334(0xca)+_0x563390['id'])[_0x231334(0xe5)]();if(!_0x58e868)return saveMsg(i18n['__'](_0x231334(0xc9)),_0x231334(0xce),i18n['__']('taskDeleted')),_0x3eb75a();dbOther['prepare'](_0x231334(0xd7)+(_0x460fca+0x1)+_0x231334(0xcf)+_0x563390['id'])[_0x231334(0xe6)](),_0x1f4299=_0x21ba4d[_0x460fca];if(_0x1f4299[_0x231334(0xdc)]('.'))continue;let _0x540ea7=path['join'](_0xabb46b,_0x1f4299),_0x29e15c=fs[_0x231334(0xf9)](_0x540ea7)[_0x231334(0xcc)](),_0x2434ef=path[_0x231334(0xf1)](_0x29fcb5,_0x1f4299);if(_0x29e15c)try{await cryptoUtils[_0x231334(0xd6)](_0x2e53e3,_0x540ea7,fs[_0x231334(0xd2)](_0x2434ef)),cryptoUtils[_0x231334(0xe0)](_0x2e53e3,_0x1f4299)['then'](_0x167632=>{const _0xca6335=_0x231334;let _0x1d492f=path[_0xca6335(0xf1)](_0x29fcb5,_0x167632);fs['renameSync'](_0x2434ef,_0x1d492f);})['catch'](_0x189b94=>{const _0x541d1f=_0x231334;console[_0x541d1f(0xda)](_0x541d1f(0xce),_0x189b94);});}catch(_0x5114bb){console[_0x231334(0xda)](_0x231334(0xce),_0x5114bb),saveMsg(i18n['__']('private.exportFail'),_0x231334(0xce),_0x540ea7+':'+JSON[_0x231334(0xd0)](err));}}catch(_0x5904dc){saveMsg(i18n['__']('private.exportFail'),_0x231334(0xce),_0x1f4299+'\x20'+_0x5904dc?JSON[_0x231334(0xd0)](_0x5904dc):'');continue;}}saveMsg(i18n['__'](_0x231334(0xf0)),_0x231334(0xe3),'['+_0xabb46b+']\x20=>\x20['+_0x29fcb5+']'),dbOther[_0x231334(0xea)](_0x231334(0xc6)+_0x563390['id'])[_0x231334(0xe6)](),_0x3eb75a();}catch(_0x48d8b6){console[_0x231334(0xda)](_0x48d8b6),saveMsg(i18n['__'](_0x231334(0xc9)),_0x231334(0xce),_0x48d8b6?JSON['stringify'](_0x48d8b6):''),dbOther['prepare'](_0x231334(0xe4)+_0x563390['id'])[_0x231334(0xe6)](),_0x3eb75a();}})[_0x10b386(0xe7)](_0x56e386=>{const _0x28d3d2=_0x10b386;console[_0x28d3d2(0xda)](_0x56e386),saveMsg(i18n['__'](_0x28d3d2(0xc9)),_0x28d3d2(0xce),i18n['__'](_0x28d3d2(0xd4))),dbOther[_0x28d3d2(0xea)]('UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id='+_0x563390['id'])[_0x28d3d2(0xe6)](),_0x3eb75a();});}async function taskStart(){return new Promise((_0x540e7a,_0x38b73a)=>{const _0x99d75d=_0x99b4;let _0x5aeea2=dbOther[_0x99d75d(0xea)](_0x99d75d(0xdb))['get']();if(_0x5aeea2){let _0x2b350e=JSON[_0x99d75d(0xf7)](_0x5aeea2[_0x99d75d(0xf3)]);dbOther[_0x99d75d(0xea)](_0x99d75d(0xec)+_0x5aeea2['id'])[_0x99d75d(0xe6)](),exportPrivateSpace(_0x2b350e['folderPath'],_0x2b350e['targetFolderPath'],_0x2b350e[_0x99d75d(0xf8)],_0x5aeea2,_0x540e7a);}else process[_0x99d75d(0xe9)]({'type':_0x99d75d(0xc7)});});}async function runGbTask(){const _0x1e428d=_0x1e1f2c;taskStart()[_0x1e428d(0xe2)](()=>{runGbTask();});}function _0x1688(){const _0x4fdd8f=['UPDATE\x20bg_task\x20SET\x20progress_all=','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','622330RZVzSG','privateSpaceKey','getI18n','private.exportSuc','join','3ueBXFJ','task_json','../../myConfig/config','title','10PtFyhA','parse','spacePwd','statSync','toString','pragma','1215370wfIJJt','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','close','readdirSync','private.exportFail','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id=','5562369mSkPOr','isFile','316526GRUTmn','error','\x20where\x20id=','stringify','dbOther','createWriteStream','1408376HxPgwV','private.passwordIncorrect','../../utils/i18nUtil','decryptFile','UPDATE\x20bg_task\x20SET\x20progress_current=','../../express-server/utils/cryptoUtils','create','log','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201','startsWith','2363514eLbJXs','12lxORcp','4387272Mknmai','decryptString','path','then','info','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=','get','run','catch','from','send','prepare'];_0x1688=function(){return _0x4fdd8f;};return _0x1688();}runGbTask();