const _0x402660=_0xbf23;(function(_0x4ea169,_0x2c94a8){const _0x558fab=_0xbf23,_0x1b2373=_0x4ea169();while(!![]){try{const _0x47de5f=-parseInt(_0x558fab(0x19c))/0x1*(parseInt(_0x558fab(0x1c3))/0x2)+-parseInt(_0x558fab(0x19d))/0x3+parseInt(_0x558fab(0x1be))/0x4*(-parseInt(_0x558fab(0x1c4))/0x5)+-parseInt(_0x558fab(0x19a))/0x6*(-parseInt(_0x558fab(0x1b2))/0x7)+-parseInt(_0x558fab(0x1a3))/0x8+-parseInt(_0x558fab(0x1c2))/0x9+-parseInt(_0x558fab(0x1ab))/0xa*(-parseInt(_0x558fab(0x1bd))/0xb);if(_0x47de5f===_0x2c94a8)break;else _0x1b2373['push'](_0x1b2373['shift']());}catch(_0x14742c){_0x1b2373['push'](_0x1b2373['shift']());}}}(_0x373b,0x221fb));function _0xbf23(_0x5c5b23,_0x2d9d05){const _0x373bcf=_0x373b();return _0xbf23=function(_0xbf23e7,_0x2d0b3c){_0xbf23e7=_0xbf23e7-0x198;let _0x47aed9=_0x373bcf[_0xbf23e7];return _0x47aed9;},_0xbf23(_0x5c5b23,_0x2d9d05);}let path=require(_0x402660(0x1b8)),fs=require('fs'),cryptoUtils=require('../../express-server/utils/cryptoUtils');const dbNoticeCenterTable=require(_0x402660(0x1c7)),config=require(_0x402660(0x1b0)),Database=require(_0x402660(0x1cc));let dbOther=new Database(config[_0x402660(0x1af)],{});dbOther[_0x402660(0x1ad)](_0x402660(0x1b9));let i18nUtil=require(_0x402660(0x1b6)),i18n=i18nUtil[_0x402660(0x1ce)](dbOther);process[_0x402660(0x1a2)]='NasCabBgTaskWorker';function saveMsg(_0x1c6ece,_0x33c7d0,_0x44a9e1){dbNoticeCenterTable['create'](dbOther,{'title':_0x1c6ece,'level':_0x33c7d0,'content':_0x44a9e1});}async function exportPrivateSpace(_0x25307e,_0x4fb952,_0x6485ca,_0x396c9c,_0x3be09d){const _0x106cb7=_0x402660;saveMsg(i18n['__'](_0x106cb7(0x19b)),_0x106cb7(0x1c0),'['+_0x25307e+_0x106cb7(0x1ca)+_0x4fb952+']'),cryptoUtils['decryptString'](config[_0x106cb7(0x1bb)],_0x6485ca)[_0x106cb7(0x1c5)](async _0x3741af=>{const _0x32a1c8=_0x106cb7;_0x6485ca=Buffer['from'](_0x3741af,_0x32a1c8(0x1b1))['toString']();try{let _0x37f26b=0x0,_0x24593b=0x0,_0x16a705=fs[_0x32a1c8(0x1b7)](_0x25307e);dbOther[_0x32a1c8(0x1ac)](_0x32a1c8(0x1a7)+_0x16a705[_0x32a1c8(0x19e)]+_0x32a1c8(0x1b5)+_0x396c9c['id'])[_0x32a1c8(0x1ba)]();let _0x1b7fd4;for(let _0x28d601=0x0;_0x28d601<_0x16a705[_0x32a1c8(0x19e)];_0x28d601++){try{let _0x37ab3b=dbOther[_0x32a1c8(0x1ac)]('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id='+_0x396c9c['id'])[_0x32a1c8(0x199)]();if(!_0x37ab3b)return saveMsg(i18n['__'](_0x32a1c8(0x1a6)),_0x32a1c8(0x1c9),i18n['__'](_0x32a1c8(0x198))),_0x3be09d();dbOther[_0x32a1c8(0x1ac)]('UPDATE\x20bg_task\x20SET\x20progress_current='+(_0x28d601+0x1)+_0x32a1c8(0x1b5)+_0x396c9c['id'])[_0x32a1c8(0x1ba)](),_0x1b7fd4=_0x16a705[_0x28d601];if(_0x1b7fd4[_0x32a1c8(0x1ae)]('.'))continue;let _0x167523=path[_0x32a1c8(0x1bc)](_0x25307e,_0x1b7fd4),_0x1615a7=fs['statSync'](_0x167523)['isFile'](),_0x4b8e63=path[_0x32a1c8(0x1bc)](_0x4fb952,_0x1b7fd4);if(_0x1615a7)try{await cryptoUtils['decryptFile'](_0x6485ca,_0x167523,fs[_0x32a1c8(0x19f)](_0x4b8e63)),cryptoUtils[_0x32a1c8(0x1a8)](_0x6485ca,_0x1b7fd4)['then'](_0x47bd28=>{const _0x5f97ff=_0x32a1c8;let _0x5aa70a=path[_0x5f97ff(0x1bc)](_0x4fb952,_0x47bd28);fs[_0x5f97ff(0x1a5)](_0x4b8e63,_0x5aa70a);})[_0x32a1c8(0x1aa)](_0x2d5b94=>{const _0x3c9171=_0x32a1c8;console[_0x3c9171(0x1b3)](_0x3c9171(0x1c9),_0x2d5b94);});}catch(_0x207b31){console[_0x32a1c8(0x1b3)]('error',_0x207b31),saveMsg(i18n['__'](_0x32a1c8(0x1a6)),_0x32a1c8(0x1c9),_0x167523+':'+JSON[_0x32a1c8(0x1bf)](err));}}catch(_0x308551){saveMsg(i18n['__']('private.exportFail'),_0x32a1c8(0x1c9),_0x1b7fd4+'\x20'+_0x308551?JSON['stringify'](_0x308551):'');continue;}}saveMsg(i18n['__'](_0x32a1c8(0x1a0)),'info','['+_0x25307e+_0x32a1c8(0x1ca)+_0x4fb952+']'),dbOther[_0x32a1c8(0x1ac)](_0x32a1c8(0x1a9)+_0x396c9c['id'])[_0x32a1c8(0x1ba)](),_0x3be09d();}catch(_0x4c0829){console[_0x32a1c8(0x1b3)](_0x4c0829),saveMsg(i18n['__'](_0x32a1c8(0x1a6)),_0x32a1c8(0x1c9),_0x4c0829?JSON[_0x32a1c8(0x1bf)](_0x4c0829):''),dbOther[_0x32a1c8(0x1ac)](_0x32a1c8(0x1cd)+_0x396c9c['id'])[_0x32a1c8(0x1ba)](),_0x3be09d();}})[_0x106cb7(0x1aa)](_0x3be54d=>{const _0x1300dd=_0x106cb7;console[_0x1300dd(0x1b3)](_0x3be54d),saveMsg(i18n['__'](_0x1300dd(0x1a6)),_0x1300dd(0x1c9),i18n['__'](_0x1300dd(0x1c8))),dbOther[_0x1300dd(0x1ac)]('UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id='+_0x396c9c['id'])[_0x1300dd(0x1ba)](),_0x3be09d();});}async function taskStart(){return new Promise((_0x555f8e,_0x490e17)=>{const _0xd587b3=_0xbf23;let _0x50404e=dbOther['prepare']('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201')['get']();if(_0x50404e){let _0x511e47=JSON[_0xd587b3(0x1c6)](_0x50404e[_0xd587b3(0x1b4)]);dbOther['prepare'](_0xd587b3(0x1cb)+_0x50404e['id'])[_0xd587b3(0x1ba)](),exportPrivateSpace(_0x511e47[_0xd587b3(0x1a1)],_0x511e47[_0xd587b3(0x1c1)],_0x511e47[_0xd587b3(0x1a4)],_0x50404e,_0x555f8e);}else process['send']({'type':'close'});});}async function runGbTask(){const _0x2fcfd7=_0x402660;taskStart()[_0x2fcfd7(0x1c5)](()=>{runGbTask();});}function _0x373b(){const _0x12ef4b=['UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','catch','10TNCBgu','prepare','pragma','startsWith','dbOther','../../myConfig/config','base64','19600UdlOzC','log','task_json','\x20where\x20id=','../../utils/i18nUtil','readdirSync','path','journal_mode\x20=\x20WAL','run','privateSpaceKey','join','10271998QjXNGq','4efiIJp','stringify','info','targetFolderPath','1512063lgRULZ','544774krqWYF','375020avCyCI','then','parse','../../db/dbNoticeCenterTable','private.passwordIncorrect','error',']\x20=>\x20[','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','better-sqlite3','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=','getI18n','taskDeleted','get','390LYlyCw','private.exportStart','1yOqXYd','662352CRzzeV','length','createWriteStream','private.exportSuc','folderPath','title','1918920Ucothg','spacePwd','renameSync','private.exportFail','UPDATE\x20bg_task\x20SET\x20progress_all=','decryptString'];_0x373b=function(){return _0x12ef4b;};return _0x373b();}runGbTask();