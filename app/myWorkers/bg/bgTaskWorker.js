const _0x5dbbb5=_0x5d7c;(function(_0x3d023c,_0x760f9a){const _0x345e7c=_0x5d7c,_0x1bbf50=_0x3d023c();while(!![]){try{const _0x2a9358=parseInt(_0x345e7c(0x13d))/0x1*(-parseInt(_0x345e7c(0x145))/0x2)+parseInt(_0x345e7c(0x130))/0x3+parseInt(_0x345e7c(0x11d))/0x4*(-parseInt(_0x345e7c(0x14b))/0x5)+parseInt(_0x345e7c(0x128))/0x6+-parseInt(_0x345e7c(0x126))/0x7*(parseInt(_0x345e7c(0x134))/0x8)+parseInt(_0x345e7c(0x114))/0x9+parseInt(_0x345e7c(0x115))/0xa*(parseInt(_0x345e7c(0x118))/0xb);if(_0x2a9358===_0x760f9a)break;else _0x1bbf50['push'](_0x1bbf50['shift']());}catch(_0x29f19b){_0x1bbf50['push'](_0x1bbf50['shift']());}}}(_0x4fae,0x31395));let path=require(_0x5dbbb5(0x149)),fs=require('fs'),cryptoUtils=require(_0x5dbbb5(0x12a));const dbNoticeCenterTable=require(_0x5dbbb5(0x139)),config=require(_0x5dbbb5(0x123)),Database=require(_0x5dbbb5(0x141));let dbOther=new Database(config[_0x5dbbb5(0x13c)],{});dbOther['pragma'](_0x5dbbb5(0x14a));let i18nUtil=require(_0x5dbbb5(0x11c)),i18n=i18nUtil[_0x5dbbb5(0x148)](dbOther);process[_0x5dbbb5(0x11b)]=_0x5dbbb5(0x11f);function _0x4fae(){const _0x155d11=['dbOther','176447eOnTpQ','spacePwd','toString','base64','better-sqlite3','then','private.exportSuc','length','4neXFMJ','isFile','statSync','getI18n','path','journal_mode\x20=\x20WAL','10XWUckE','task_json','private.exportFail','send','decryptString','folderPath','\x20where\x20id=','888048IwpBXX','70OCmNVC','close','get','459140rlvEiG','readdirSync','privateSpaceKey','title','../../utils/i18nUtil','200828mjDdSW','private.passwordIncorrect','NasCabBgTaskWorker','createWriteStream','parse','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','../../myConfig/config','targetFolderPath','run','7kcDiQv','stringify','2130468ydIkze','UPDATE\x20bg_task\x20SET\x20progress_all=','../../express-server/utils/cryptoUtils','UPDATE\x20bg_task\x20SET\x20progress_current=','prepare','renameSync','private.exportStart','join','454914SbkblU','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','error','log','1941112VOPfUC','info','catch','create',']\x20=>\x20[','../../db/dbNoticeCenterTable','taskDeleted','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id='];_0x4fae=function(){return _0x155d11;};return _0x4fae();}function saveMsg(_0x20cf44,_0x40cf36,_0x4936aa){const _0x24118b=_0x5dbbb5;dbNoticeCenterTable[_0x24118b(0x137)](dbOther,{'title':_0x20cf44,'level':_0x40cf36,'content':_0x4936aa});}async function exportPrivateSpace(_0x1a1c4c,_0x37532f,_0x172df1,_0x1997b6,_0x24fadf){const _0x3168a5=_0x5dbbb5;saveMsg(i18n['__'](_0x3168a5(0x12e)),_0x3168a5(0x135),'['+_0x1a1c4c+_0x3168a5(0x138)+_0x37532f+']'),cryptoUtils[_0x3168a5(0x14f)](config[_0x3168a5(0x11a)],_0x172df1)['then'](async _0x408a9b=>{const _0x43df9c=_0x3168a5;_0x172df1=Buffer['from'](_0x408a9b,_0x43df9c(0x140))[_0x43df9c(0x13f)]();try{let _0x4dc013=0x0,_0x244405=0x0,_0xe2e2be=fs[_0x43df9c(0x119)](_0x1a1c4c);dbOther[_0x43df9c(0x12c)](_0x43df9c(0x129)+_0xe2e2be[_0x43df9c(0x144)]+'\x20where\x20id='+_0x1997b6['id'])[_0x43df9c(0x125)]();let _0x13d924;for(let _0x5b88a5=0x0;_0x5b88a5<_0xe2e2be[_0x43df9c(0x144)];_0x5b88a5++){try{let _0x5040ea=dbOther[_0x43df9c(0x12c)]('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id='+_0x1997b6['id'])['get']();if(!_0x5040ea)return saveMsg(i18n['__'](_0x43df9c(0x14d)),'error',i18n['__'](_0x43df9c(0x13a))),_0x24fadf();dbOther[_0x43df9c(0x12c)](_0x43df9c(0x12b)+(_0x5b88a5+0x1)+_0x43df9c(0x113)+_0x1997b6['id'])[_0x43df9c(0x125)](),_0x13d924=_0xe2e2be[_0x5b88a5];if(_0x13d924['startsWith']('.'))continue;let _0x587b84=path[_0x43df9c(0x12f)](_0x1a1c4c,_0x13d924),_0x5a3912=fs[_0x43df9c(0x147)](_0x587b84)[_0x43df9c(0x146)](),_0x3fa361=path[_0x43df9c(0x12f)](_0x37532f,_0x13d924);if(_0x5a3912)try{await cryptoUtils['decryptFile'](_0x172df1,_0x587b84,fs[_0x43df9c(0x120)](_0x3fa361)),cryptoUtils[_0x43df9c(0x14f)](_0x172df1,_0x13d924)[_0x43df9c(0x142)](_0x31644e=>{const _0x57ec63=_0x43df9c;let _0x5ec06e=path[_0x57ec63(0x12f)](_0x37532f,_0x31644e);fs[_0x57ec63(0x12d)](_0x3fa361,_0x5ec06e);})['catch'](_0x36911b=>{const _0x2926b4=_0x43df9c;console[_0x2926b4(0x133)](_0x2926b4(0x132),_0x36911b);});}catch(_0x566bd7){console['log'](_0x43df9c(0x132),_0x566bd7),saveMsg(i18n['__'](_0x43df9c(0x14d)),_0x43df9c(0x132),_0x587b84+':'+JSON[_0x43df9c(0x127)](err));}}catch(_0x3ac7f0){saveMsg(i18n['__'](_0x43df9c(0x14d)),_0x43df9c(0x132),_0x13d924+'\x20'+_0x3ac7f0?JSON[_0x43df9c(0x127)](_0x3ac7f0):'');continue;}}saveMsg(i18n['__'](_0x43df9c(0x143)),_0x43df9c(0x135),'['+_0x1a1c4c+_0x43df9c(0x138)+_0x37532f+']'),dbOther['prepare'](_0x43df9c(0x122)+_0x1997b6['id'])[_0x43df9c(0x125)](),_0x24fadf();}catch(_0xb3a6c6){console[_0x43df9c(0x133)](_0xb3a6c6),saveMsg(i18n['__'](_0x43df9c(0x14d)),_0x43df9c(0x132),_0xb3a6c6?JSON[_0x43df9c(0x127)](_0xb3a6c6):''),dbOther[_0x43df9c(0x12c)](_0x43df9c(0x13b)+_0x1997b6['id'])['run'](),_0x24fadf();}})[_0x3168a5(0x136)](_0x57fbd5=>{const _0x53df29=_0x3168a5;console[_0x53df29(0x133)](_0x57fbd5),saveMsg(i18n['__'](_0x53df29(0x14d)),_0x53df29(0x132),i18n['__'](_0x53df29(0x11e))),dbOther[_0x53df29(0x12c)](_0x53df29(0x13b)+_0x1997b6['id'])[_0x53df29(0x125)](),_0x24fadf();});}async function taskStart(){return new Promise((_0x50a05f,_0x49230c)=>{const _0x22d5b9=_0x5d7c;let _0x350eab=dbOther['prepare']('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201')[_0x22d5b9(0x117)]();if(_0x350eab){let _0x1610ec=JSON[_0x22d5b9(0x121)](_0x350eab[_0x22d5b9(0x14c)]);dbOther['prepare'](_0x22d5b9(0x131)+_0x350eab['id'])[_0x22d5b9(0x125)](),exportPrivateSpace(_0x1610ec[_0x22d5b9(0x150)],_0x1610ec[_0x22d5b9(0x124)],_0x1610ec[_0x22d5b9(0x13e)],_0x350eab,_0x50a05f);}else process[_0x22d5b9(0x14e)]({'type':_0x22d5b9(0x116)});});}async function runGbTask(){const _0x126af5=_0x5dbbb5;taskStart()[_0x126af5(0x142)](()=>{runGbTask();});}function _0x5d7c(_0x2acc41,_0x2ba3f3){const _0x4faedf=_0x4fae();return _0x5d7c=function(_0x5d7caf,_0x62e65a){_0x5d7caf=_0x5d7caf-0x113;let _0x241a55=_0x4faedf[_0x5d7caf];return _0x241a55;},_0x5d7c(_0x2acc41,_0x2ba3f3);}runGbTask();