const _0x20961e=_0x2912;(function(_0x2a679d,_0x59d430){const _0xe80e02=_0x2912,_0x1cae31=_0x2a679d();while(!![]){try{const _0x58c92b=parseInt(_0xe80e02(0x104))/0x1*(parseInt(_0xe80e02(0x12e))/0x2)+parseInt(_0xe80e02(0x144))/0x3+parseInt(_0xe80e02(0xb5))/0x4*(parseInt(_0xe80e02(0x133))/0x5)+-parseInt(_0xe80e02(0x125))/0x6*(-parseInt(_0xe80e02(0x147))/0x7)+parseInt(_0xe80e02(0xaf))/0x8+-parseInt(_0xe80e02(0x80))/0x9*(parseInt(_0xe80e02(0x151))/0xa)+parseInt(_0xe80e02(0xda))/0xb*(parseInt(_0xe80e02(0x115))/0xc);if(_0x58c92b===_0x59d430)break;else _0x1cae31['push'](_0x1cae31['shift']());}catch(_0x5b1eb6){_0x1cae31['push'](_0x1cae31['shift']());}}}(_0x5ded,0x57e83));const {XMLParser,XMLBuilder}=require(_0x20961e(0x136)),path=require(_0x20961e(0x95));let axios=require(_0x20961e(0xed));const {HttpsProxyAgent}=require('hpagent'),https=require(_0x20961e(0x15a)),{URL}=require(_0x20961e(0xf1)),fs=require('fs'),movieSeasonUtil=require('../utils/movieSeasonUtil'),mediaTypeConfig=require(_0x20961e(0x112)),{parentPort,workerData}=require(_0x20961e(0x149)),movieInfoTmdbApi=require(_0x20961e(0x105)),dbConfigTable=require(_0x20961e(0xdc)),nfoUtil=require(_0x20961e(0x167)),Database=require(_0x20961e(0x15e)),config=require(_0x20961e(0x11e)),dbFileIndex=new Database(config[_0x20961e(0x15d)],{'timeout':0xea60});dbFileIndex[_0x20961e(0x11d)](_0x20961e(0x89));let dbOther=new Database(config[_0x20961e(0xd3)],{});dbOther[_0x20961e(0x11d)](_0x20961e(0x89));let i18nUtil=require(_0x20961e(0xef));i18n=i18nUtil[_0x20961e(0xbc)](dbOther);let excludeList=['阳光电影dygod.org','dolby-multi-bodhmall',_0x20961e(0xb3),_0x20961e(0x142),_0x20961e(0xe1),_0x20961e(0xfc),'bd720p',_0x20961e(0x8d),_0x20961e(0xa7),_0x20961e(0x10f),_0x20961e(0x122),_0x20961e(0xff),_0x20961e(0x9b),'x265-terminal',_0x20961e(0xe3),'3audio',_0x20961e(0x10c),_0x20961e(0x118),_0x20961e(0x13c),_0x20961e(0xec),_0x20961e(0xbd),_0x20961e(0x96),_0x20961e(0x158),_0x20961e(0x13e),_0x20961e(0x9d),_0x20961e(0x145),_0x20961e(0x83),_0x20961e(0xa1),_0x20961e(0xa2),_0x20961e(0xa0),_0x20961e(0x12f),_0x20961e(0xf4),_0x20961e(0x103),_0x20961e(0xdf),'8bit',_0x20961e(0xf3),_0x20961e(0x148),_0x20961e(0x93),'hd',_0x20961e(0x81),_0x20961e(0x154),_0x20961e(0xb7),_0x20961e(0x84),_0x20961e(0x135),_0x20961e(0x97),_0x20961e(0x117),_0x20961e(0x16b),'ma',_0x20961e(0xab),'dv',_0x20961e(0xe2),_0x20961e(0xc3),_0x20961e(0x110),_0x20961e(0xf4),'web-dl','x265-dvsux','x265',_0x20961e(0x15b),'x260bit','4ktrash',_0x20961e(0x102),'atmos-iamable','atmos-coaster',_0x20961e(0xb1),'nahom',_0x20961e(0x7f),_0x20961e(0xe6),_0x20961e(0x90),_0x20961e(0xfb),_0x20961e(0xd8),_0x20961e(0xdd),_0x20961e(0xe5),_0x20961e(0x140),_0x20961e(0x9a),_0x20961e(0x157),'ultra-hd',_0x20961e(0x141),_0x20961e(0xc7),'mkv','mp4',_0x20961e(0xc6),'rm','mov',_0x20961e(0x169),_0x20961e(0xff),'tbs',_0x20961e(0xfe),_0x20961e(0x114),_0x20961e(0xc9),_0x20961e(0x113),_0x20961e(0xf7),_0x20961e(0x13f),_0x20961e(0xd1),'电影天堂',_0x20961e(0xd4),_0x20961e(0x14e),_0x20961e(0x129),_0x20961e(0x132),_0x20961e(0xa3),_0x20961e(0x164),'dl','-',_0x20961e(0x8a),_0x20961e(0xb6),_0x20961e(0xc0),_0x20961e(0xf0),_0x20961e(0xce)];function isObjectInQueryArray(_0x267df1,_0x35b6c9){const _0x2368a5=_0x20961e;return _0x267df1[_0x2368a5(0x82)](function(_0x1ce543){const _0x1feefb=_0x2368a5,_0x4a60ae=Object[_0x1feefb(0x92)](_0x35b6c9);return _0x4a60ae['every'](_0x2e67dc=>_0x1ce543[_0x2e67dc]===_0x35b6c9[_0x2e67dc]);});}function getQueryArray(_0x18238e){const _0x194243=_0x20961e;let _0x447a1c=[];if(!_0x18238e||!_0x18238e['filename'])return[];let _0x23a00b=_0x18238e[_0x194243(0xeb)][_0x194243(0x99)]();if(!_0x23a00b||_0x23a00b[_0x194243(0xd7)]<0x2)return[];function _0x24b2fc(_0x410e4a,_0x1968dd){const _0x3a2538=_0x194243;let _0x2e7dd1={'title':_0x410e4a,'year':_0x1968dd};_0x410e4a!='STREAM'&&!isObjectInQueryArray(_0x447a1c,_0x2e7dd1)&&_0x447a1c[_0x3a2538(0xc2)](_0x2e7dd1);}function _0x342e3e(_0x921ddb){const _0x17ff0a=_0x194243;let _0x11f9c3=path[_0x17ff0a(0x128)](_0x921ddb);_0x11f9c3&&(_0x921ddb=_0x921ddb[_0x17ff0a(0xae)](_0x11f9c3,''));if(/^[0-9]*$/[_0x17ff0a(0x14b)](_0x921ddb)&&_0x921ddb!=_0x17ff0a(0x130)&&!_0x921ddb['startsWith'](_0x17ff0a(0x10e)))return[];if(_0x921ddb[_0x17ff0a(0x121)](_0x17ff0a(0x16c))||_0x921ddb[_0x17ff0a(0x121)](_0x17ff0a(0xa9))||_0x921ddb['startsWith']('VID')||_0x921ddb['startsWith'](_0x17ff0a(0xa6))||_0x921ddb[_0x17ff0a(0x121)]('VID_')||_0x921ddb['startsWith'](_0x17ff0a(0x11a))||_0x921ddb[_0x17ff0a(0x121)](_0x17ff0a(0x14c)))return[];_0x921ddb[_0x921ddb['length']-0x1]=='.'&&(_0x921ddb=_0x921ddb['substr'](0x0,_0x921ddb[_0x17ff0a(0xd7)]-0x1));_0x921ddb=_0x921ddb[_0x17ff0a(0xae)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')['replace'](_0x17ff0a(0x131),'')[_0x17ff0a(0xae)]('7.1',''),_0x921ddb=_0x921ddb['replace'](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')[_0x17ff0a(0xae)](/[ ]+/gi,'\x20');let _0x74e70d=_0x921ddb['split']('\x20'),_0x35e044=[],_0x505f6e=null;for(let _0x5ee76f in _0x74e70d){let _0xdaad20=_0x74e70d[_0x5ee76f][_0x17ff0a(0x168)]();if(excludeList[_0x17ff0a(0x124)](_0xdaad20))continue;if(isNumber(_0xdaad20)){if(parseInt(_0xdaad20)>0x767&&parseInt(_0xdaad20)<0x834){_0x505f6e=_0xdaad20;continue;}}_0x35e044[_0x17ff0a(0xc2)](_0xdaad20);}for(let _0x1ef627=_0x35e044[_0x17ff0a(0xd7)];_0x1ef627>=0x0;_0x1ef627--){let _0x1cea6c=_0x35e044[_0x17ff0a(0xfa)]('\x20')['trim']();_0x1cea6c&&(_0x505f6e&&_0x24b2fc(_0x1cea6c,_0x505f6e),_0x24b2fc(_0x1cea6c)),_0x35e044[_0x17ff0a(0xb4)](_0x35e044[_0x17ff0a(0xd7)]-0x1,0x1);}}if(_0x18238e[_0x194243(0x11b)]==0x1)try{let _0x1b3ba2=path[_0x194243(0xc5)](_0x18238e['path'])[_0x194243(0x119)](),_0x5d985f=movieSeasonUtil[_0x194243(0x91)](_0x1b3ba2);if(_0x5d985f>-0x1){let _0x1b8513=path['basename'](path[_0x194243(0x7c)](_0x18238e[_0x194243(0x95)]))[_0x194243(0x119)]();_0x1b8513&&_0x342e3e(_0x1b8513);}else _0x342e3e(_0x1b3ba2);}catch(_0x59047e){console[_0x194243(0xf6)](_0x59047e);}const _0x536846=_0x23a00b['replace'](/s\d{1,2}e\d{1,2}/g,'');return _0x342e3e(_0x536846),_0x447a1c;}function isNumber(_0x2d2e91){const _0x523eac=_0x20961e;return/^-?[\d.]+(?:e-?\d+)?$/[_0x523eac(0x14b)](_0x2d2e91);}function getTmdbApi(){const _0x1cc26f=_0x20961e;let _0x16a339=dbConfigTable[_0x1cc26f(0x94)](dbOther,_0x1cc26f(0xd5)),_0x4ac4da=null;if(_0x16a339&&_0x16a339[_0x1cc26f(0xde)]==0x1){let _0x5aac99=dbConfigTable[_0x1cc26f(0x94)](dbOther,_0x1cc26f(0xbf));_0x5aac99&&_0x5aac99[_0x1cc26f(0xde)]&&(_0x4ac4da=_0x5aac99[_0x1cc26f(0xde)]),log(_0x1cc26f(0x165)+_0x4ac4da);}return tmdbApiObj=new movieInfoTmdbApi['API'](workerData[_0x1cc26f(0x137)],workerData[_0x1cc26f(0x15f)],workerData[_0x1cc26f(0xc4)],_0x4ac4da),tmdbApiObj;}function getProxyUrl(_0x2bb11d){const _0xced76d=_0x20961e;let _0x12f276=dbConfigTable['findByTitle'](_0x2bb11d,_0xced76d(0xd5)),_0x5441ae=null;if(_0x12f276&&_0x12f276[_0xced76d(0xde)]==0x1){let _0x2df7b2=dbConfigTable[_0xced76d(0x94)](_0x2bb11d,'tmdbProxyUrl');_0x2df7b2&&_0x2df7b2[_0xced76d(0xde)]&&(_0x5441ae=_0x2df7b2[_0xced76d(0xde)]);}return _0x5441ae;}function downloadPoster(_0x17156e,_0x4ed231){return new Promise((_0x5dc8c9,_0x3d7834)=>{const _0x324362=_0x2912;fs[_0x324362(0xf2)](_0x17156e,(_0x48b664,_0x30cf05)=>{const _0x5c2217=_0x324362;if(_0x48b664){console[_0x5c2217(0xf6)](_0x5c2217(0x10a),_0x4ed231);let _0x22d175=getProxyUrl(dbOther),_0x371283=null;_0x22d175&&(_0x371283=new HttpsProxyAgent({'proxy':_0x22d175}));const _0x1726d3=new URL(_0x4ed231);https['get']({'hostname':_0x1726d3['hostname'],'port':_0x1726d3[_0x5c2217(0x87)]||0x1bb,'path':_0x1726d3[_0x5c2217(0x12c)]+_0x1726d3[_0x5c2217(0xf5)],'agent':_0x371283?_0x371283:![]},_0x5f4d64=>{const _0x275c2c=_0x5c2217;if(_0x5f4d64['statusCode']!==0xc8)return console[_0x275c2c(0xd9)]('请求失败:\x20HTTP\x20'+_0x5f4d64[_0x275c2c(0xad)]),addScrapeLog(path[_0x275c2c(0xfa)](workerData[_0x275c2c(0x95)]),_0x275c2c(0x120),'',_0x17156e,_0x275c2c(0x98)),_0x5dc8c9('');let _0x25998e=_0x17156e+_0x275c2c(0x139),_0x35643c=fs[_0x275c2c(0x143)](_0x25998e);_0x5f4d64['pipe'](_0x35643c),_0x35643c['on']('finish',()=>{fs['rename'](_0x25998e,_0x17156e,_0x44f74c=>{const _0x1dfbc3=_0x2912;if(_0x44f74c)return _0x5dc8c9('');addScrapeLog(path[_0x1dfbc3(0xfa)](workerData[_0x1dfbc3(0x95)]),_0x1dfbc3(0x120),'',_0x17156e,'SUCCESS'),_0x5dc8c9(_0x17156e);});}),_0x35643c['on']('error',_0x20c8ed=>{const _0x346a22=_0x275c2c;console[_0x346a22(0xf6)](_0x20c8ed),addScrapeLog(path[_0x346a22(0xfa)](workerData[_0x346a22(0x95)]),_0x346a22(0x120),'',_0x17156e,_0x346a22(0x98)),_0x5dc8c9('');}),_0x35643c['on'](_0x275c2c(0x155),()=>{});})['on'](_0x5c2217(0xd9),_0x2d631e=>{_0x5dc8c9('');});}else _0x5dc8c9(_0x17156e);});});}function downloadPosterAndSaveNfo(_0x20a2ca,_0x5a1f7c,_0x3abb67,_0x31f502,_0x2d76f3,_0x401aca,_0x5d22df){return new Promise((_0x1bb841,_0x1672d4)=>{const _0x4cd804=_0x2912;let _0x4ae654=[];_0x5a1f7c&&_0x20a2ca&&(!_0x5d22df||_0x5d22df&&!fs[_0x4cd804(0x101)](_0x20a2ca)?_0x4ae654[_0x4cd804(0xc2)](downloadPoster(_0x20a2ca,_0x5a1f7c)):log(_0x4cd804(0xfd)+_0x20a2ca)),_0x3abb67&&_0x31f502&&(!_0x5d22df||_0x5d22df&&!fs['existsSync'](_0x31f502)?(console['log'](_0x4cd804(0xcd),_0x31f502,_0x5d22df),addScrapeLog(path[_0x4cd804(0xfa)](workerData[_0x4cd804(0x95)]),_0x4cd804(0xdb),_0x31f502,'',_0x4cd804(0xa4)),_0x4ae654['push'](nfoUtil[_0x4cd804(0xc1)](_0x3abb67,_0x31f502,_0x2d76f3))):log(_0x4cd804(0x14d)+_0x31f502)),_0x3abb67[_0x4cd804(0xb2)]&&_0x401aca&&(!_0x5d22df||_0x5d22df&&!fs[_0x4cd804(0x101)](_0x401aca)?(log(_0x4cd804(0xcc)+_0x401aca),_0x4ae654[_0x4cd804(0xc2)](downloadPoster(_0x401aca,_0x3abb67[_0x4cd804(0xb2)]))):log(_0x4cd804(0x14a)+_0x401aca)),Promise['allSettled'](_0x4ae654)[_0x4cd804(0x12a)](_0x64def=>{_0x1bb841();});});}function saveEpisodeInfo(_0xf0ca0,_0x254d4f,_0x2d4044,_0x1399fa,_0x128b0d){return new Promise((_0x35bd1d,_0x544ae4)=>{const _0x504a7c=_0x2912;if(!mediaTypeConfig[_0x504a7c(0x116)][_0x504a7c(0x124)](path[_0x504a7c(0x128)](_0x2d4044)['toLowerCase']()))return log(_0x504a7c(0xbb)+_0x2d4044),_0x35bd1d();if(!_0x254d4f[_0x504a7c(0xe8)]||_0x254d4f[_0x504a7c(0xe8)][_0x504a7c(0xd7)]<0x1)return log('seasonInfo没找到每一集的信息'),_0x35bd1d();let _0x486042;for(let _0x1d1815 of _0x254d4f[_0x504a7c(0xe8)]){if(_0x1d1815[_0x504a7c(0x7e)]==_0x1399fa){_0x486042=_0x1d1815;break;}}if(!_0x486042)return log(_0x504a7c(0x138)+_0x1399fa),_0x35bd1d();_0x254d4f[_0x504a7c(0x152)]&&(_0x486042[_0x504a7c(0xca)]=_0x254d4f['season_number']);_0x486042['episode']=_0x1399fa;let {dir:_0x7aeb28,name:_0x54202c}=path['parse'](path[_0x504a7c(0xfa)](_0xf0ca0,_0x2d4044)),_0x3122b1=path[_0x504a7c(0xfa)](_0x7aeb28,_0x54202c)+_0x504a7c(0xb0),_0x2c5f35=path[_0x504a7c(0xfa)](_0x7aeb28,_0x54202c)+_0x504a7c(0x111);downloadPosterAndSaveNfo(_0x3122b1,_0x486042[_0x504a7c(0x13d)],_0x486042,_0x2c5f35,_0x504a7c(0xba),null,_0x128b0d)[_0x504a7c(0x12a)](_0x190fc9=>{_0x35bd1d();});});}function detectIsMissingEpisodeInfo(_0x3c84ee){const _0x3d8c3e=_0x20961e;let _0x1b2422=fs[_0x3d8c3e(0xcb)](_0x3c84ee),_0x6f4f1a=![];for(let _0x278943 of _0x1b2422){let _0x2ee18f=path[_0x3d8c3e(0x128)](_0x278943)?path['extname'](_0x278943)['toLowerCase']():null;if(_0x2ee18f&&config[_0x3d8c3e(0x116)][_0x3d8c3e(0x124)](_0x2ee18f)){let _0x13e70f=_0x278943['substring'](0x0,_0x278943[_0x3d8c3e(0x15c)]('.')),_0x227c2d=path[_0x3d8c3e(0xfa)](_0x3c84ee,_0x13e70f+_0x3d8c3e(0x111));if(!fs[_0x3d8c3e(0x101)](_0x227c2d))return console[_0x3d8c3e(0xf6)](_0x3d8c3e(0xb9)+_0x227c2d),_0x6f4f1a=!![],_0x6f4f1a;}}return _0x6f4f1a;}function _0x2912(_0x47275f,_0x1a4b4d){const _0x5ded2=_0x5ded();return _0x2912=function(_0x291212,_0x4f2e7d){_0x291212=_0x291212-0x7c;let _0x5f121a=_0x5ded2[_0x291212];return _0x5f121a;},_0x2912(_0x47275f,_0x1a4b4d);}function saveSeasonInfo(_0x411582,_0x4feaf4,_0x5df6be,_0x243d65,_0x362d61){return new Promise((_0x5d49c7,_0x2cde60)=>{const _0x5bfb6c=_0x2912;if(!_0x4feaf4[_0x5bfb6c(0xd6)]||_0x4feaf4[_0x5bfb6c(0xd6)][_0x5bfb6c(0xd7)]<0x1)return log(_0x5bfb6c(0xcf)),_0x5d49c7();let _0x27d7d8;for(let _0x4c1231 of _0x4feaf4[_0x5bfb6c(0xd6)]){log(_0x5bfb6c(0x109)+_0x4c1231[_0x5bfb6c(0x152)]);if(_0x4c1231[_0x5bfb6c(0x152)]==_0x5df6be){_0x27d7d8=_0x4c1231;break;}}if(!_0x27d7d8)return log('没有找到要保存的季信息\x20对应号码:'+_0x5df6be),_0x5d49c7();let _0x756ade,_0x76df,_0xd1c9af,_0x35cd59;if(_0x243d65){let _0x349db3=_0x5df6be+'';if(_0x5df6be<0xa)_0x349db3='0'+_0x5df6be;_0x756ade=path['join'](path['dirname'](_0x411582),_0x5bfb6c(0xca)+_0x349db3+'-poster.jpg'),_0xd1c9af=path[_0x5bfb6c(0xfa)](_0x411582,_0x5bfb6c(0x107)),_0x35cd59=path['join'](path[_0x5bfb6c(0x7c)](_0x411582),_0x5bfb6c(0x10d));}else _0x756ade=path[_0x5bfb6c(0xfa)](_0x411582,_0x5bfb6c(0x13a)),_0xd1c9af=path[_0x5bfb6c(0xfa)](_0x411582,_0x5bfb6c(0x8c)),_0x35cd59=path[_0x5bfb6c(0xfa)](_0x411582,_0x5bfb6c(0x10d)),!_0x27d7d8[_0x5bfb6c(0xb2)]&&(_0x27d7d8[_0x5bfb6c(0xb2)]=_0x4feaf4[_0x5bfb6c(0xb2)]);!_0x27d7d8['cover_url']&&(_0x27d7d8[_0x5bfb6c(0x13d)]=_0x4feaf4[_0x5bfb6c(0x13d)]),_0x27d7d8[_0x5bfb6c(0xca)]=_0x5df6be,_0x4feaf4[_0x5bfb6c(0xe7)]&&_0x27d7d8[_0x5bfb6c(0xe7)]&&(_0x27d7d8[_0x5bfb6c(0x106)]=_0x4feaf4[_0x5bfb6c(0xe7)]+'\x20'+_0x27d7d8['movie_name'],_0x27d7d8[_0x5bfb6c(0xe7)]=_0x27d7d8[_0x5bfb6c(0x106)]),_0x4feaf4[_0x5bfb6c(0x9e)]&&!_0x27d7d8[_0x5bfb6c(0x9e)]&&(_0x27d7d8[_0x5bfb6c(0x9e)]=_0x4feaf4[_0x5bfb6c(0x9e)]),_0x4feaf4['actorsOriginal']&&!_0x27d7d8['actorsOriginal']&&(_0x27d7d8[_0x5bfb6c(0x150)]=_0x4feaf4[_0x5bfb6c(0x150)]),_0x4feaf4['directors']&&!_0x27d7d8[_0x5bfb6c(0x123)]&&(_0x27d7d8['directors']=_0x4feaf4[_0x5bfb6c(0x123)]),_0x4feaf4[_0x5bfb6c(0x12d)]&&!_0x27d7d8[_0x5bfb6c(0x12d)]&&(_0x27d7d8[_0x5bfb6c(0x12d)]=_0x4feaf4['directorsOriginal']),_0x4feaf4[_0x5bfb6c(0xc8)]&&!_0x27d7d8[_0x5bfb6c(0xc8)]&&(_0x27d7d8[_0x5bfb6c(0xc8)]=_0x4feaf4[_0x5bfb6c(0xc8)]),_0x4feaf4['creatorOriginal']&&!_0x27d7d8['creatorOriginal']&&(_0x27d7d8[_0x5bfb6c(0xea)]=_0x4feaf4[_0x5bfb6c(0xea)]),_0x4feaf4['guestActorsOriginal']&&!_0x27d7d8[_0x5bfb6c(0xd0)]&&(_0x27d7d8[_0x5bfb6c(0xd0)]=_0x4feaf4[_0x5bfb6c(0xd0)]),_0x4feaf4['genres']&&!_0x27d7d8['genres']&&(_0x27d7d8[_0x5bfb6c(0x7d)]=_0x4feaf4['genres']),_0x4feaf4[_0x5bfb6c(0xbe)]&&!_0x27d7d8[_0x5bfb6c(0xbe)]&&(_0x27d7d8[_0x5bfb6c(0xbe)]=_0x4feaf4[_0x5bfb6c(0xbe)]),_0x4feaf4[_0x5bfb6c(0xe9)]&&(_0x27d7d8['tmdb_id']=_0x4feaf4[_0x5bfb6c(0xe9)]),downloadPosterAndSaveNfo(_0x756ade,_0x27d7d8[_0x5bfb6c(0x13d)],_0x27d7d8,_0xd1c9af,'tvshow',_0x35cd59,_0x362d61)[_0x5bfb6c(0x12a)](_0x32e0b2=>{const _0x9bbd7a=_0x5bfb6c;log('season海报和nfo保存完毕');if(!_0x4feaf4[_0x9bbd7a(0xe9)])return _0x5d49c7();if(_0x362d61&&!detectIsMissingEpisodeInfo(_0x411582))return log('跳过不缺失任何信息的季'),_0x5d49c7();let _0x1cd402=getTmdbApi();_0x1cd402[_0x9bbd7a(0x14f)](_0x4feaf4[_0x9bbd7a(0xe9)],_0x5df6be)[_0x9bbd7a(0x12a)](_0x4f744f=>{const _0x19f7a4=_0x9bbd7a;log(_0x19f7a4(0x162)),fs['readdir'](_0x411582,(_0xf2e181,_0x3a0303)=>{const _0x20d59c=_0x19f7a4;if(_0xf2e181)return _0x5d49c7();let _0x250a90=[];for(let _0xdbfb12 of _0x3a0303){try{let _0x20cde8=path[_0x20d59c(0xfa)](_0x411582,_0xdbfb12),_0x151522=fs[_0x20d59c(0x9f)](_0x20cde8);if(_0x151522[_0x20d59c(0xa8)]()){let _0x29c40b=movieSeasonUtil[_0x20d59c(0x159)](_0xdbfb12);_0x29c40b&&_0x29c40b[_0x20d59c(0x16a)]&&_0x29c40b[_0x20d59c(0x16a)]>0x0&&_0x250a90[_0x20d59c(0xc2)](saveEpisodeInfo(_0x411582,_0x4f744f,_0xdbfb12,_0x29c40b[_0x20d59c(0x16a)],_0x362d61));}}catch(_0x521a7b){log(_0x521a7b);continue;}}Promise['allSettled'](_0x250a90)[_0x20d59c(0x12a)](_0x5de532=>{_0x5d49c7();});});})[_0x9bbd7a(0xaa)](_0x3105b7=>{const _0x533634=_0x9bbd7a;return log(_0x3105b7),addScrapeLog(path[_0x533634(0xfa)](workerData[_0x533634(0x95)]),_0x533634(0xf9),'','','FAIL',_0x3105b7[_0x533634(0xa5)]?_0x3105b7['status_message']:_0x533634(0x11f)),_0x5d49c7();});});});}function onSearchFinish(_0x1d19b1,_0x2231af,_0x197d6e){return new Promise((_0x4f8005,_0x3f354c)=>{const _0x2c733e=_0x2912;let _0x278b18=path[_0x2c733e(0xfa)](_0x1d19b1[_0x2c733e(0x95)],_0x1d19b1[_0x2c733e(0xeb)]),_0x13ce46=_0x1d19b1[_0x2c733e(0x11b)]==0x1,_0x1dfb81=getTmdbApi();_0x1dfb81[_0x2c733e(0xac)](_0x2231af,_0x13ce46)[_0x2c733e(0x12a)](_0x6a341c=>{const _0xcccaa7=_0x2c733e;if(!_0x13ce46){let {dir:_0x184fba,name:_0x2b8815}=path['parse'](_0x278b18),_0x40c178=path[_0xcccaa7(0xfa)](_0x184fba,_0x2b8815+'.jpg'),_0xf9939=_0x6a341c['cover_url'],_0x453329=path[_0xcccaa7(0xfa)](_0x184fba,_0x2b8815+'.nfo'),_0x449be9=path[_0xcccaa7(0xfa)](_0x184fba,_0x2b8815+'-fanart.jpg');downloadPosterAndSaveNfo(_0x40c178,_0xf9939,_0x6a341c,_0x453329,_0xcccaa7(0x88),_0x449be9,_0x197d6e)[_0xcccaa7(0x12a)](_0x2e06e4=>{return log('电影的海报和nfo保存完毕'),_0x4f8005();});}else{let _0x3c15d8=movieSeasonUtil[_0xcccaa7(0x91)](path[_0xcccaa7(0xc5)](_0x1d19b1[_0xcccaa7(0x95)]));if(_0x3c15d8>-0x1){log('符合三级命名规则:'+_0x278b18);let {dir:_0x20b8bc,name:_0x3ce84b}=path[_0xcccaa7(0x86)](_0x278b18),_0x5c6171=path[_0xcccaa7(0xfa)](path[_0xcccaa7(0x7c)](_0x20b8bc),'poster.jpg'),_0x2eb8c0=path['join'](path[_0xcccaa7(0x7c)](_0x20b8bc),_0xcccaa7(0x10d)),_0x26da66=path[_0xcccaa7(0xfa)](path[_0xcccaa7(0x7c)](_0x20b8bc),_0xcccaa7(0x8c));downloadPosterAndSaveNfo(_0x5c6171,_0x6a341c['cover_url'],_0x6a341c,_0x26da66,_0xcccaa7(0xb8),_0x2eb8c0,_0x197d6e)[_0xcccaa7(0x12a)](_0x558047=>{const _0x26fc23=_0xcccaa7;log(_0x26fc23(0x161)),fs[_0x26fc23(0x166)](path[_0x26fc23(0x7c)](_0x20b8bc),(_0xc6567e,_0x32d3a7)=>{const _0x2dca34=_0x26fc23;if(_0xc6567e)return _0x4f8005();let _0x48a6cc=[];for(let _0x1f8800 of _0x32d3a7){try{let _0x109a57=path[_0x2dca34(0xfa)](path[_0x2dca34(0x7c)](_0x20b8bc),_0x1f8800),_0x4b4851=fs['statSync'](_0x109a57);if(_0x4b4851[_0x2dca34(0x13b)]()){let _0x10bab2=movieSeasonUtil[_0x2dca34(0x91)](_0x1f8800);_0x10bab2>-0x1&&_0x48a6cc[_0x2dca34(0xc2)](saveSeasonInfo(_0x109a57,_0x6a341c,_0x10bab2,!![],_0x197d6e));}}catch(_0x178bfb){log(_0x178bfb);continue;}}Promise['allSettled'](_0x48a6cc)[_0x2dca34(0x12a)](_0x3da5e4=>{_0x4f8005();});});});}else{log(_0xcccaa7(0x126)+_0x278b18);let _0x3b12ea=movieSeasonUtil['getSeasonNumber'](path[_0xcccaa7(0xc5)](_0x1d19b1[_0xcccaa7(0x95)]),![]);if(_0x3b12ea>-0x1)saveSeasonInfo(path[_0xcccaa7(0x7c)](_0x278b18),_0x6a341c,_0x3b12ea,![],_0x197d6e)[_0xcccaa7(0x12a)](_0x59c4ff=>{_0x4f8005();});else{let _0x1ff6c1=movieSeasonUtil['extractEpisodeNumbers'](_0x278b18);_0x1ff6c1&&_0x1ff6c1[_0xcccaa7(0xca)]&&_0x1ff6c1[_0xcccaa7(0xca)]>0x0?saveSeasonInfo(path['dirname'](_0x278b18),_0x6a341c,_0x1ff6c1[_0xcccaa7(0xca)],![],_0x197d6e)['then'](_0x66e301=>{_0x4f8005();}):(log(_0xcccaa7(0x10b)),saveSeasonInfo(path[_0xcccaa7(0x7c)](_0x278b18),_0x6a341c,0x1,![],_0x197d6e)['then'](_0x1635f4=>{_0x4f8005();}));}}}})[_0x2c733e(0xaa)](_0x176f3c=>{const _0x58c1c7=_0x2c733e;return log(_0x176f3c),addScrapeLog(path[_0x58c1c7(0xfa)](workerData[_0x58c1c7(0x95)]),_0x58c1c7(0x12b),'','',_0x58c1c7(0x98),_0x176f3c['status_message']?_0x176f3c[_0x58c1c7(0xa5)]:_0x58c1c7(0x11f)),_0x4f8005();});});}function addScrapeLog(_0x55ecb8,_0xcaefd3,_0x592e38,_0x2573f8,_0x2db60f,_0x17604a){const _0x21e273=_0x20961e;dbFileIndex[_0x21e273(0x100)](_0x21e273(0x9c))['run'](_0x55ecb8,_0xcaefd3,_0x592e38,_0x2573f8,_0x2db60f,_0x17604a,Date[_0x21e273(0xd2)]());}function getTvExistTmdbId(_0x4c1623){const _0x11a36b=_0x20961e;if(_0x4c1623[_0x11a36b(0x11b)]!=0x1)return null;let _0x13c48a=path[_0x11a36b(0x7c)](_0x4c1623[_0x11a36b(0x95)]),_0x75bfad=movieSeasonUtil['getSeasonNumber'](path[_0x11a36b(0xc5)](_0x4c1623['path']),!![]),_0x18a979=null,_0x313ba7='';_0x75bfad>-0x1&&(_0x313ba7=path[_0x11a36b(0xfa)](_0x13c48a,'tvshow.nfo'));(!_0x313ba7||!fs[_0x11a36b(0x101)](_0x313ba7))&&(_0x313ba7=path[_0x11a36b(0xfa)](_0x4c1623[_0x11a36b(0x95)],_0x11a36b(0x8c)));if(!_0x313ba7||!fs[_0x11a36b(0x101)](_0x313ba7))return null;const _0x3f3bfb=new XMLParser();let _0x5e561c=_0x3f3bfb[_0x11a36b(0x86)](fs[_0x11a36b(0x8f)](_0x313ba7));return _0x5e561c['tvshow']&&(_0x5e561c=_0x5e561c[_0x11a36b(0xb8)],_0x5e561c[_0x11a36b(0x85)]&&(_0x18a979=_0x5e561c[_0x11a36b(0x85)])),{'tmdbId':_0x18a979,'seassonNumber':_0x75bfad};}function searchMovieInfo(_0x405509,_0x1f8b08){const _0x5912c1=_0x20961e;return!_0x1f8b08&&(_0x1f8b08=getQueryArray(_0x405509)),log(JSON[_0x5912c1(0x146)](_0x1f8b08)),new Promise((_0x3a1e39,_0x220005)=>{const _0x5d599a=_0x5912c1;function _0x36031c(){return _0x220005();}if(!_0x1f8b08||_0x1f8b08[_0x5d599a(0xd7)]<0x1)return log(_0x5d599a(0x156)),_0x36031c();let _0x260971=_0x1f8b08[0x0][_0x5d599a(0xf8)],_0x17a588=_0x1f8b08[0x0]['year'];log('Matching\x20movie\x20information\x20',_0x260971[_0x5d599a(0xf8)]);let _0x49c4a0=getTmdbApi();if(!_0x49c4a0)return log(_0x5d599a(0xe0)),_0x36031c();let _0x5cae34=_0x405509[_0x5d599a(0x11b)]==0x1;_0x49c4a0['search'](_0x260971,_0x5cae34,_0x17a588)[_0x5d599a(0x12a)](_0x5c31a3=>{const _0x2f8708=_0x5d599a;if(_0x5c31a3&&_0x5c31a3['length']>0x0){let _0x1b8832=_0x5c31a3[0x0];onSearchFinish(_0x405509,_0x1b8832[_0x2f8708(0xe9)])[_0x2f8708(0x12a)](()=>{return _0x3a1e39();});}else{if(_0x1f8b08[_0x2f8708(0xd7)]>0x1){let _0x320725=_0x1f8b08['splice'](0x1);return searchMovieInfo(_0x405509,_0x320725)['then'](_0x3a1e39);}else return log(_0x2f8708(0x160),_0x260971),addScrapeLog(path['join'](workerData['path']),_0x2f8708(0x12b),'','',_0x2f8708(0x98),i18n['__'](_0x2f8708(0x127))),_0x36031c();}})[_0x5d599a(0xaa)](_0x5a28f4=>{return log('TMDB\x20search接口请求失败',_0x5a28f4),_0x36031c();});});}function _0x5ded(){const _0x1535f5=['SUCCESS','status_message','vid','x264','isFile','img_','catch','bhd','getDetail','statusCode','replace','3978888KAFjSO','.jpg','eng','backdrop_url','2160p','splice','24vrlecm','电影天堂','dts','tvshow','缺失:','episodedetails','跳过非视频文件:','getI18n','7audio','regions','tmdbProxyUrl','韩语中字','saveNfoFile','push','cmrg','tmdb_api_url','basename','rmvb','h265','creator','dvd','season','readdirSync','下载fanart:','nfo不存在,开始保存','高清mp4电影','seriesInfo没找到季信息','guestActorsOriginal','高清版','now','dbOther','阳光电影','tmdbProxyEnable','seasons','length','bdrip','error','1507NKbEAA','NFO','../db/dbConfigTable','remux','value','10bit','TMDB\x20api实例获取失败\x20请检查TMDB相关配置','hd1080p','ddp','brrip','SCRAPE_MISSING','bluray','265-apex','movie_name','episodes','tmdb_id','creatorOriginal','filename','6audio','axios','根据文件名和路径搜索','../utils/i18nUtil','日语中字','url','stat','sdr','fgt','search','log','ac3','title','API_SEASON_DETAIL','join','uhd','1080p','跳过保存海报:','2audios','web','prepare','existsSync','atmos-swtyblz','truehd','3wvxEjv','../utils/movieInfoTmdbApi','showtitle','season.nfo','exit','season.season_number:','开始下载','没有季信息\x20默认使用第一季','4audio','fanart.jpg','0000','480p','surcode','.nfo','../myConfig/mediaType','chs-eng','aac','10380BppQrj','videoTypeList','cmct','hdwing','toLocaleLowerCase','vid_','is_tvplay','tmdbidNotFound','pragma','../myConfig/config','ERROR','POSTER','startsWith','240p','directors','includes','6dEyiPw','不符合三级命名规则:','noSearchResult','extname','英语中字','then','API_DETAIL','pathname','directorsOriginal','46790CkbdYN','hds','1942','5.1','英文中字','9995ooyrZd','信息获取完毕','swtyblz','fast-xml-parser','tmdb_api_key','没有找到要保存的集信息\x20对应号码:','.tmp','poster.jpg','isDirectory','5audio','cover_url','5audios','dreamhd','hdtv','h264','bd1080p','createWriteStream','363777QuHLQK','7audios','stringify','93667HRAdxh','hdr10','worker_threads','跳过保存fanart:','test','IMG','跳过保存NFO:','高清晰版','getSeasonDetail','actorsOriginal','2363090lpqCzj','season_number','信息不足\x20无法搜索\x20退出worker','dts-hd','close','要查询的数据不存在','ultrahd','4audios','extractEpisodeNumbers','https','dvsux','lastIndexOf','dbFileIndex','better-sqlite3','tmdb_api_language','tmdb.没有获取到相关信息','整部剧的海报和nfo保存完毕','开始保存每一集的信息','根据已有NFO刮削缺失集','beitai','Search\x20Worker:Tmdb代理已经开启','readdir','../utils/nfoUtil','trim','3gp','episode','coaster','IMG_','dirname','genres','episode_number','ita','18RbdJzS','dts-ift','some','cee','rargb','tmdbid','parse','port','movie','journal_mode\x20=\x20WAL','中文字幕','scrapeMissing','tvshow.nfo','720p','tmdbId','readFileSync','atmos','getSeasonNumber','keys','hdr','findByTitle','path','3audios','iamable','FAIL','toLowerCase','blue-ray','nexusnf','INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)','6audios','actors','statSync','internal','hevc','remastered','西语中字'];_0x5ded=function(){return _0x1535f5;};return _0x5ded();}function returnResult(){const _0x54d3bc=_0x20961e;log('刮削任务结束'),parentPort['postMessage']({'code':0x0}),process[_0x54d3bc(0x108)](0x0);}function log(_0x3f5191){const _0x3d13ee=_0x20961e;parentPort['postMessage']({'type':_0x3d13ee(0xf6),'message':_0x3f5191});}if(workerData&&workerData['filename']&&workerData['path']&&workerData[_0x20961e(0x15f)]&&workerData[_0x20961e(0x137)]&&workerData[_0x20961e(0xc4)]){if(workerData[_0x20961e(0xe9)])log('根据TMDBID搜索'),onSearchFinish(workerData,workerData[_0x20961e(0xe9)])[_0x20961e(0x12a)](_0x331fb0=>{const _0x417767=_0x20961e;log(_0x417767(0x134),workerData[_0x417767(0xe9)],workerData[_0x417767(0x95)],workerData[_0x417767(0xeb)]),returnResult();})[_0x20961e(0xaa)](_0x59ad99=>{returnResult();});else{if(workerData[_0x20961e(0x8b)]==0x1){log(_0x20961e(0x163));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId[_0x20961e(0x8e)]){addScrapeLog(path['join'](workerData[_0x20961e(0x95)]),_0x20961e(0xe4),'','','FAIL',i18n['__'](_0x20961e(0x11c)));return;}let tmdbId=foundTmdbId[_0x20961e(0x8e)];onSearchFinish(workerData,tmdbId,!![])['then'](_0x2267bd=>{const _0x4029df=_0x20961e;log(_0x4029df(0x134)),returnResult();})[_0x20961e(0xaa)](_0x4416cb=>{returnResult();});}else log(_0x20961e(0xee)),searchMovieInfo(workerData)['then'](_0x3fe0a2=>{const _0x3f70d0=_0x20961e;log(_0x3f70d0(0x134)+workerData[_0x3f70d0(0x95)]+'\x20'+workerData['filename']),returnResult();})['catch'](_0x21d99d=>{returnResult();});}}else log(_0x20961e(0x153)),returnResult();