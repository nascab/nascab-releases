const _0x146399=_0x2626;(function(_0x5d39f9,_0x535bfa){const _0x62ffd4=_0x2626,_0x1eda64=_0x5d39f9();while(!![]){try{const _0x48740c=parseInt(_0x62ffd4(0x28b))/0x1*(-parseInt(_0x62ffd4(0x203))/0x2)+-parseInt(_0x62ffd4(0x1d6))/0x3*(parseInt(_0x62ffd4(0x217))/0x4)+parseInt(_0x62ffd4(0x24c))/0x5*(parseInt(_0x62ffd4(0x2af))/0x6)+-parseInt(_0x62ffd4(0x286))/0x7*(parseInt(_0x62ffd4(0x1f6))/0x8)+-parseInt(_0x62ffd4(0x21f))/0x9+-parseInt(_0x62ffd4(0x23c))/0xa*(-parseInt(_0x62ffd4(0x2a4))/0xb)+parseInt(_0x62ffd4(0x224))/0xc*(parseInt(_0x62ffd4(0x26a))/0xd);if(_0x48740c===_0x535bfa)break;else _0x1eda64['push'](_0x1eda64['shift']());}catch(_0x13b079){_0x1eda64['push'](_0x1eda64['shift']());}}}(_0x44fc,0x9a304));const {XMLParser,XMLBuilder}=require(_0x146399(0x250)),path=require(_0x146399(0x1fd));let axios=require('axios');const {HttpsProxyAgent}=require(_0x146399(0x1e4)),https=require(_0x146399(0x27e)),{URL}=require(_0x146399(0x22c)),fs=require('fs'),movieSeasonUtil=require(_0x146399(0x1dd)),mediaTypeConfig=require(_0x146399(0x28d)),{parentPort,workerData}=require(_0x146399(0x223)),movieInfoTmdbApi=require(_0x146399(0x233)),dbConfigTable=require('../db/dbConfigTable'),nfoUtil=require(_0x146399(0x22f)),Database=require('better-sqlite3'),config=require('../myConfig/config'),dbFileIndex=new Database(config[_0x146399(0x291)],{'timeout':0xea60});dbFileIndex[_0x146399(0x27a)](_0x146399(0x236));let dbOther=new Database(config['dbOther'],{});dbOther['pragma']('journal_mode\x20=\x20WAL');let i18nUtil=require('../utils/i18nUtil');i18n=i18nUtil[_0x146399(0x2a3)](dbOther);let excludeList=[_0x146399(0x24a),_0x146399(0x2c0),_0x146399(0x2b6),_0x146399(0x25d),_0x146399(0x232),'1080p',_0x146399(0x235),_0x146399(0x234),_0x146399(0x287),_0x146399(0x228),_0x146399(0x26d),_0x146399(0x242),_0x146399(0x267),_0x146399(0x1e3),_0x146399(0x1fa),_0x146399(0x245),_0x146399(0x275),'hdwing',_0x146399(0x2ad),_0x146399(0x22e),'7audio',_0x146399(0x276),_0x146399(0x1d8),_0x146399(0x27d),_0x146399(0x1f5),'7audios','cee','hevc','remastered',_0x146399(0x25e),_0x146399(0x255),_0x146399(0x29f),_0x146399(0x211),_0x146399(0x28c),'8bit','sdr',_0x146399(0x1fe),'hdr','hd',_0x146399(0x215),_0x146399(0x273),_0x146399(0x214),_0x146399(0x1dc),_0x146399(0x285),_0x146399(0x209),_0x146399(0x1eb),'coaster','ma',_0x146399(0x200),'dv',_0x146399(0x2a1),_0x146399(0x205),_0x146399(0x244),_0x146399(0x29f),'web-dl',_0x146399(0x20c),'x265','dvsux',_0x146399(0x1e2),_0x146399(0x277),_0x146399(0x292),_0x146399(0x288),_0x146399(0x295),_0x146399(0x2b8),_0x146399(0x2a6),_0x146399(0x1fb),'265-apex','atmos','uhd',_0x146399(0x212),'remux','bluray',_0x146399(0x240),_0x146399(0x26c),_0x146399(0x271),_0x146399(0x238),_0x146399(0x230),_0x146399(0x274),'mkv','mp4',_0x146399(0x262),'rm',_0x146399(0x1f0),_0x146399(0x2bc),_0x146399(0x242),'tbs','2audios',_0x146399(0x1ff),'dvd',_0x146399(0x21b),_0x146399(0x246),_0x146399(0x213),_0x146399(0x253),_0x146399(0x25c),_0x146399(0x21c),_0x146399(0x272),_0x146399(0x263),_0x146399(0x201),_0x146399(0x29b),_0x146399(0x23e),'dl','-',_0x146399(0x28f),_0x146399(0x25c),'韩语中字','日语中字','高清mp4电影'];function _0x44fc(){const _0x587292=['eng','tmdbid','substr','pipe','3gp','tvshow.nfo','backdrop_url','creatorOriginal','dolby-multi-bodhmall','postMessage','search','title','1228917DpsXLj','-fanart.jpg','4audios','pathname','stringify','getSeasonNumber','rargb','../utils/movieSeasonUtil','videoTypeList','readdir','run','actors','x260bit','x265-terminal','hpagent','根据文件名和路径搜索','.nfo','tmdbProxyEnable','nfo不存在,开始保存','poster.jpg','existsSync','cmct','season.nfo','VID_','cover_url','log','mov','substring','prepare','statSync','tmdb_api_language','6audios','8caxNmG','FAIL','directors','跳过保存海报:','brrip','ita','extname','path','hdr10','aac','bhd','英文中字','getDetail','698ILDCXO','showtitle','cmrg','splice','allSettled','season海报和nfo保存完毕','iamable','keys','toLocaleLowerCase','x265-dvsux','IMG_','scrapeMissing','creator','seasonInfo没找到每一集的信息','truehd','bdrip','dreamhd','dts','dts-ift','get','4MqafyI','toLowerCase','-poster.jpg','episode','chs-eng','阳光电影','year','tmdbProxyUrl','11034612nmCHab','TMDB\x20api实例获取失败\x20请检查TMDB相关配置','NFO','vid','worker_threads','3805272ZSLmwg','value','then','episodes','480p','isDirectory','fanart.jpg','TMDB\x20search接口请求失败','url','电影的海报和nfo保存完毕','6audio','../utils/nfoUtil','h264','close','hd1080p','../utils/movieInfoTmdbApi','720p','bd720p','journal_mode\x20=\x20WAL','开始保存每一集的信息','ultra-hd','tmdb.没有获取到相关信息','符合三级命名规则:','rename','19590zoHHWy','Matching\x20movie\x20information\x20','beitai','dirname','hdtv','length','web','parse','surcode','3audio','ac3','跳过保存NFO:','findByTitle','整部剧的海报和nfo保存完毕','阳光电影dygod.org','replace','5CEJsMe','STREAM','season','getSeasonDetail','fast-xml-parser','is_tvplay','信息获取完毕','高清版','isFile','hds','开始下载','seasons','seriesInfo没找到季信息','tmdb_api_key','startsWith','trim','电影天堂','bd1080p','internal','stat','split','actorsOriginal','rmvb','英语中字','API_DETAIL','error','vid_','nexusnf','0000','noSearchResult','52FrBBQJ','push','blue-ray','240p','tmdb_api_url','tmdb_id','根据已有NFO刮削缺失集','ultrahd','高清晰版','dts-hd','h265','4audio','3audios','4ktrash','movie','status_message','pragma','episode_number','根据TMDBID搜索','5audios','https','createWriteStream','VID','extractEpisodeNumbers','IMG','.jpg','genres','swtyblz','3027689mdYDXh','x264','atmos-iamable','exit','port','1955vsgTSz','10bit','../myConfig/mediaType','season.season_number:','中文字幕','filename','dbFileIndex','atmos-swtyblz','ERROR','catch','atmos-coaster','basename','没有找到要保存的季信息\x20对应号码:','includes','lastIndexOf','请求失败:\x20HTTP\x20','西语中字','some','SUCCESS','statusCode','fgt','season_number','ddp','tmdbId','getI18n','5764vAaBVG','test','nahom','now','POSTER','没有找到要保存的集信息\x20对应号码:','regions','directorsOriginal','要查询的数据不存在','5audio','刮削任务结束','6522870VvsbPM','下载fanart:','join','guestActorsOriginal','movie_name','跳过非视频文件:','tvshow','2160p','every'];_0x44fc=function(){return _0x587292;};return _0x44fc();}function isObjectInQueryArray(_0x24ba84,_0x55ea6e){const _0x4cc08b=_0x146399;return _0x24ba84[_0x4cc08b(0x29c)](function(_0x441cd5){const _0x59938d=_0x4cc08b,_0x58d94b=Object[_0x59938d(0x20a)](_0x55ea6e);return _0x58d94b[_0x59938d(0x2b7)](_0x5a40c3=>_0x441cd5[_0x5a40c3]===_0x55ea6e[_0x5a40c3]);});}function getQueryArray(_0x423a8e){const _0x2673a9=_0x146399;let _0x429490=[];if(!_0x423a8e||!_0x423a8e[_0x2673a9(0x290)])return[];let _0xce72be=_0x423a8e[_0x2673a9(0x290)][_0x2673a9(0x218)]();if(!_0xce72be||_0xce72be[_0x2673a9(0x241)]<0x2)return[];function _0x210e03(_0x430117,_0x308740){const _0x40ffff=_0x2673a9;let _0x19cd71={'title':_0x430117,'year':_0x308740};_0x430117!=_0x40ffff(0x24d)&&!isObjectInQueryArray(_0x429490,_0x19cd71)&&_0x429490[_0x40ffff(0x26b)](_0x19cd71);}function _0x39e5c2(_0x5b2f7f){const _0x2e124a=_0x2673a9;let _0x152297=path[_0x2e124a(0x1fc)](_0x5b2f7f);_0x152297&&(_0x5b2f7f=_0x5b2f7f['replace'](_0x152297,''));if(/^[0-9]*$/[_0x2e124a(0x2a5)](_0x5b2f7f)&&_0x5b2f7f!='1942'&&!_0x5b2f7f['startsWith'](_0x2e124a(0x268)))return[];if(_0x5b2f7f[_0x2e124a(0x25a)](_0x2e124a(0x20d))||_0x5b2f7f[_0x2e124a(0x25a)]('img_')||_0x5b2f7f['startsWith'](_0x2e124a(0x280))||_0x5b2f7f['startsWith'](_0x2e124a(0x222))||_0x5b2f7f[_0x2e124a(0x25a)](_0x2e124a(0x1ed))||_0x5b2f7f['startsWith'](_0x2e124a(0x266))||_0x5b2f7f['startsWith'](_0x2e124a(0x282)))return[];_0x5b2f7f[_0x5b2f7f[_0x2e124a(0x241)]-0x1]=='.'&&(_0x5b2f7f=_0x5b2f7f[_0x2e124a(0x2ba)](0x0,_0x5b2f7f[_0x2e124a(0x241)]-0x1));_0x5b2f7f=_0x5b2f7f[_0x2e124a(0x24b)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')[_0x2e124a(0x24b)]('5.1','')[_0x2e124a(0x24b)]('7.1',''),_0x5b2f7f=_0x5b2f7f['replace'](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')['replace'](/[ ]+/gi,'\x20');let _0xb9cee0=_0x5b2f7f[_0x2e124a(0x260)]('\x20'),_0x29f980=[],_0x248bb7=null;for(let _0x1ac44e in _0xb9cee0){let _0x24c055=_0xb9cee0[_0x1ac44e][_0x2e124a(0x25b)]();if(excludeList['includes'](_0x24c055))continue;if(isNumber(_0x24c055)){if(parseInt(_0x24c055)>0x767&&parseInt(_0x24c055)<0x834){_0x248bb7=_0x24c055;continue;}}_0x29f980[_0x2e124a(0x26b)](_0x24c055);}for(let _0xd8c8f=_0x29f980[_0x2e124a(0x241)];_0xd8c8f>=0x0;_0xd8c8f--){let _0x3b18ac=_0x29f980[_0x2e124a(0x2b1)]('\x20')[_0x2e124a(0x25b)]();_0x3b18ac&&(_0x248bb7&&_0x210e03(_0x3b18ac,_0x248bb7),_0x210e03(_0x3b18ac)),_0x29f980[_0x2e124a(0x206)](_0x29f980[_0x2e124a(0x241)]-0x1,0x1);}}if(_0x423a8e['is_tvplay']==0x1)try{let _0x445f83=path[_0x2673a9(0x296)](_0x423a8e[_0x2673a9(0x1fd)])[_0x2673a9(0x20b)](),_0xcc20df=movieSeasonUtil['getSeasonNumber'](_0x445f83);if(_0xcc20df>-0x1){let _0x127eb7=path['basename'](path[_0x2673a9(0x23f)](_0x423a8e['path']))['toLocaleLowerCase']();_0x127eb7&&_0x39e5c2(_0x127eb7);}else _0x39e5c2(_0x445f83);}catch(_0x12c697){console[_0x2673a9(0x1ef)](_0x12c697);}const _0x33524c=_0xce72be[_0x2673a9(0x24b)](/s\d{1,2}e\d{1,2}/g,'');return _0x39e5c2(_0x33524c),_0x429490;}function isNumber(_0x43a208){const _0x3838b2=_0x146399;return/^-?[\d.]+(?:e-?\d+)?$/[_0x3838b2(0x2a5)](_0x43a208);}function getTmdbApi(){const _0x3c8b53=_0x146399;let _0x4277da=dbConfigTable[_0x3c8b53(0x248)](dbOther,_0x3c8b53(0x1e7)),_0x3917da=null;if(_0x4277da&&_0x4277da[_0x3c8b53(0x225)]==0x1){let _0x51b7b9=dbConfigTable[_0x3c8b53(0x248)](dbOther,_0x3c8b53(0x21e));_0x51b7b9&&_0x51b7b9[_0x3c8b53(0x225)]&&(_0x3917da=_0x51b7b9[_0x3c8b53(0x225)]),log('Search\x20Worker:Tmdb代理已经开启'+_0x3917da);}return tmdbApiObj=new movieInfoTmdbApi['API'](workerData[_0x3c8b53(0x259)],workerData[_0x3c8b53(0x1f4)],workerData[_0x3c8b53(0x26e)],_0x3917da),tmdbApiObj;}function getProxyUrl(_0xfb8ff8){const _0x558c3b=_0x146399;let _0x4af21d=dbConfigTable[_0x558c3b(0x248)](_0xfb8ff8,_0x558c3b(0x1e7)),_0x237f61=null;if(_0x4af21d&&_0x4af21d[_0x558c3b(0x225)]==0x1){let _0x5a6dbd=dbConfigTable[_0x558c3b(0x248)](_0xfb8ff8,_0x558c3b(0x21e));_0x5a6dbd&&_0x5a6dbd[_0x558c3b(0x225)]&&(_0x237f61=_0x5a6dbd['value']);}return _0x237f61;}function downloadPoster(_0x3e8321,_0x1cb73f){return new Promise((_0x380ac7,_0x559f67)=>{const _0x1cb666=_0x2626;fs[_0x1cb666(0x25f)](_0x3e8321,(_0x49979a,_0x395a8c)=>{const _0xf00b36=_0x1cb666;if(_0x49979a){console[_0xf00b36(0x1ef)](_0xf00b36(0x256),_0x1cb73f);let _0x2d9da9=getProxyUrl(dbOther),_0x1c1bcd=null;_0x2d9da9&&(_0x1c1bcd=new HttpsProxyAgent({'proxy':_0x2d9da9}));const _0x5aac0c=new URL(_0x1cb73f);https[_0xf00b36(0x216)]({'hostname':_0x5aac0c['hostname'],'port':_0x5aac0c[_0xf00b36(0x28a)]||0x1bb,'path':_0x5aac0c[_0xf00b36(0x1d9)]+_0x5aac0c['search'],'agent':_0x1c1bcd?_0x1c1bcd:![]},_0x18a8bc=>{const _0x487e30=_0xf00b36;if(_0x18a8bc[_0x487e30(0x29e)]!==0xc8)return console[_0x487e30(0x265)](_0x487e30(0x29a)+_0x18a8bc[_0x487e30(0x29e)]),addScrapeLog(path[_0x487e30(0x2b1)](workerData[_0x487e30(0x1fd)]),_0x487e30(0x2a8),'',_0x3e8321,_0x487e30(0x1f7)),_0x380ac7('');let _0x55f1d5=_0x3e8321+'.tmp',_0x23ae8f=fs[_0x487e30(0x27f)](_0x55f1d5);_0x18a8bc[_0x487e30(0x2bb)](_0x23ae8f),_0x23ae8f['on']('finish',()=>{const _0x5b8a47=_0x487e30;fs[_0x5b8a47(0x23b)](_0x55f1d5,_0x3e8321,_0x3fad07=>{const _0x11c3be=_0x5b8a47;if(_0x3fad07)return _0x380ac7('');addScrapeLog(path[_0x11c3be(0x2b1)](workerData[_0x11c3be(0x1fd)]),'POSTER','',_0x3e8321,_0x11c3be(0x29d)),_0x380ac7(_0x3e8321);});}),_0x23ae8f['on']('error',_0x131b48=>{const _0x434e6d=_0x487e30;console[_0x434e6d(0x1ef)](_0x131b48),addScrapeLog(path['join'](workerData[_0x434e6d(0x1fd)]),_0x434e6d(0x2a8),'',_0x3e8321,'FAIL'),_0x380ac7('');}),_0x23ae8f['on'](_0x487e30(0x231),()=>{});})['on'](_0xf00b36(0x265),_0x5edcda=>{_0x380ac7('');});}else _0x380ac7(_0x3e8321);});});}function downloadPosterAndSaveNfo(_0x1f3ef6,_0x5a1d7c,_0xcbe103,_0xeb0015,_0x57a05d,_0x341766,_0x5ed2ab){return new Promise((_0x1bed01,_0x5f22ba)=>{const _0x30a8b7=_0x2626;let _0x28fe51=[];_0x5a1d7c&&_0x1f3ef6&&(!_0x5ed2ab||_0x5ed2ab&&!fs['existsSync'](_0x1f3ef6)?_0x28fe51[_0x30a8b7(0x26b)](downloadPoster(_0x1f3ef6,_0x5a1d7c)):log(_0x30a8b7(0x1f9)+_0x1f3ef6)),_0xcbe103&&_0xeb0015&&(!_0x5ed2ab||_0x5ed2ab&&!fs[_0x30a8b7(0x1ea)](_0xeb0015)?(console[_0x30a8b7(0x1ef)](_0x30a8b7(0x1e8),_0xeb0015,_0x5ed2ab),addScrapeLog(path[_0x30a8b7(0x2b1)](workerData[_0x30a8b7(0x1fd)]),_0x30a8b7(0x221),_0xeb0015,'',_0x30a8b7(0x29d)),_0x28fe51[_0x30a8b7(0x26b)](nfoUtil['saveNfoFile'](_0xcbe103,_0xeb0015,_0x57a05d))):log(_0x30a8b7(0x247)+_0xeb0015)),_0xcbe103['backdrop_url']&&_0x341766&&(!_0x5ed2ab||_0x5ed2ab&&!fs[_0x30a8b7(0x1ea)](_0x341766)?(log(_0x30a8b7(0x2b0)+_0x341766),_0x28fe51[_0x30a8b7(0x26b)](downloadPoster(_0x341766,_0xcbe103[_0x30a8b7(0x2be)]))):log('跳过保存fanart:'+_0x341766)),Promise['allSettled'](_0x28fe51)[_0x30a8b7(0x226)](_0x5a64f6=>{_0x1bed01();});});}function saveEpisodeInfo(_0x305fff,_0x39e992,_0x87be17,_0x35dfc4,_0x44f5ed){return new Promise((_0x145fe7,_0x170e2a)=>{const _0x493622=_0x2626;if(!mediaTypeConfig['videoTypeList']['includes'](path['extname'](_0x87be17)[_0x493622(0x218)]()))return log(_0x493622(0x2b4)+_0x87be17),_0x145fe7();if(!_0x39e992['episodes']||_0x39e992[_0x493622(0x227)]['length']<0x1)return log(_0x493622(0x210)),_0x145fe7();let _0x2283b4;for(let _0x3402b6 of _0x39e992[_0x493622(0x227)]){if(_0x3402b6[_0x493622(0x27b)]==_0x35dfc4){_0x2283b4=_0x3402b6;break;}}if(!_0x2283b4)return log(_0x493622(0x2a9)+_0x35dfc4),_0x145fe7();_0x39e992['season_number']&&(_0x2283b4[_0x493622(0x24e)]=_0x39e992[_0x493622(0x2a0)]);_0x2283b4['episode']=_0x35dfc4;let {dir:_0x42a3f5,name:_0x163bb3}=path[_0x493622(0x243)](path['join'](_0x305fff,_0x87be17)),_0x25f626=path[_0x493622(0x2b1)](_0x42a3f5,_0x163bb3)+_0x493622(0x283),_0x188193=path['join'](_0x42a3f5,_0x163bb3)+_0x493622(0x1e6);downloadPosterAndSaveNfo(_0x25f626,_0x2283b4[_0x493622(0x1ee)],_0x2283b4,_0x188193,'episodedetails',null,_0x44f5ed)[_0x493622(0x226)](_0x1f8879=>{_0x145fe7();});});}function detectIsMissingEpisodeInfo(_0x4c15fc){const _0x362a80=_0x146399;let _0x2c2854=fs['readdirSync'](_0x4c15fc),_0x47b105=![];for(let _0x205e51 of _0x2c2854){let _0x8ab8f6=path['extname'](_0x205e51)?path[_0x362a80(0x1fc)](_0x205e51)[_0x362a80(0x218)]():null;if(_0x8ab8f6&&config[_0x362a80(0x1de)][_0x362a80(0x298)](_0x8ab8f6)){let _0x12f473=_0x205e51[_0x362a80(0x1f1)](0x0,_0x205e51[_0x362a80(0x299)]('.')),_0x4b4287=path['join'](_0x4c15fc,_0x12f473+_0x362a80(0x1e6));if(!fs[_0x362a80(0x1ea)](_0x4b4287))return console[_0x362a80(0x1ef)]('缺失:'+_0x4b4287),_0x47b105=!![],_0x47b105;}}return _0x47b105;}function saveSeasonInfo(_0x5d9900,_0x7cc876,_0x493357,_0x517c88,_0x2f5dad){return new Promise((_0x27ebcb,_0x2ebdf3)=>{const _0x4a03a9=_0x2626;if(!_0x7cc876[_0x4a03a9(0x257)]||_0x7cc876[_0x4a03a9(0x257)]['length']<0x1)return log(_0x4a03a9(0x258)),_0x27ebcb();let _0xe6f7e9;for(let _0xdead25 of _0x7cc876[_0x4a03a9(0x257)]){log(_0x4a03a9(0x28e)+_0xdead25[_0x4a03a9(0x2a0)]);if(_0xdead25['season_number']==_0x493357){_0xe6f7e9=_0xdead25;break;}}if(!_0xe6f7e9)return log(_0x4a03a9(0x297)+_0x493357),_0x27ebcb();let _0x461696,_0x179266,_0x405aa8,_0x5d5f68;if(_0x517c88){let _0xf41acd=_0x493357+'';if(_0x493357<0xa)_0xf41acd='0'+_0x493357;_0x461696=path[_0x4a03a9(0x2b1)](path['dirname'](_0x5d9900),_0x4a03a9(0x24e)+_0xf41acd+_0x4a03a9(0x219)),_0x405aa8=path[_0x4a03a9(0x2b1)](_0x5d9900,_0x4a03a9(0x1ec)),_0x5d5f68=path[_0x4a03a9(0x2b1)](path[_0x4a03a9(0x23f)](_0x5d9900),'fanart.jpg');}else _0x461696=path['join'](_0x5d9900,_0x4a03a9(0x1e9)),_0x405aa8=path[_0x4a03a9(0x2b1)](_0x5d9900,'tvshow.nfo'),_0x5d5f68=path[_0x4a03a9(0x2b1)](_0x5d9900,'fanart.jpg'),!_0xe6f7e9['backdrop_url']&&(_0xe6f7e9['backdrop_url']=_0x7cc876['backdrop_url']);!_0xe6f7e9['cover_url']&&(_0xe6f7e9[_0x4a03a9(0x1ee)]=_0x7cc876[_0x4a03a9(0x1ee)]),_0xe6f7e9[_0x4a03a9(0x24e)]=_0x493357,_0x7cc876[_0x4a03a9(0x2b3)]&&_0xe6f7e9[_0x4a03a9(0x2b3)]&&(_0xe6f7e9[_0x4a03a9(0x204)]=_0x7cc876[_0x4a03a9(0x2b3)]+'\x20'+_0xe6f7e9[_0x4a03a9(0x2b3)],_0xe6f7e9['movie_name']=_0xe6f7e9[_0x4a03a9(0x204)]),_0x7cc876[_0x4a03a9(0x1e1)]&&!_0xe6f7e9['actors']&&(_0xe6f7e9[_0x4a03a9(0x1e1)]=_0x7cc876[_0x4a03a9(0x1e1)]),_0x7cc876[_0x4a03a9(0x261)]&&!_0xe6f7e9[_0x4a03a9(0x261)]&&(_0xe6f7e9[_0x4a03a9(0x261)]=_0x7cc876[_0x4a03a9(0x261)]),_0x7cc876[_0x4a03a9(0x1f8)]&&!_0xe6f7e9[_0x4a03a9(0x1f8)]&&(_0xe6f7e9[_0x4a03a9(0x1f8)]=_0x7cc876[_0x4a03a9(0x1f8)]),_0x7cc876[_0x4a03a9(0x2ab)]&&!_0xe6f7e9[_0x4a03a9(0x2ab)]&&(_0xe6f7e9[_0x4a03a9(0x2ab)]=_0x7cc876['directorsOriginal']),_0x7cc876[_0x4a03a9(0x20f)]&&!_0xe6f7e9[_0x4a03a9(0x20f)]&&(_0xe6f7e9[_0x4a03a9(0x20f)]=_0x7cc876[_0x4a03a9(0x20f)]),_0x7cc876['creatorOriginal']&&!_0xe6f7e9[_0x4a03a9(0x2bf)]&&(_0xe6f7e9[_0x4a03a9(0x2bf)]=_0x7cc876[_0x4a03a9(0x2bf)]),_0x7cc876[_0x4a03a9(0x2b2)]&&!_0xe6f7e9['guestActorsOriginal']&&(_0xe6f7e9[_0x4a03a9(0x2b2)]=_0x7cc876[_0x4a03a9(0x2b2)]),_0x7cc876[_0x4a03a9(0x284)]&&!_0xe6f7e9[_0x4a03a9(0x284)]&&(_0xe6f7e9['genres']=_0x7cc876[_0x4a03a9(0x284)]),_0x7cc876[_0x4a03a9(0x2aa)]&&!_0xe6f7e9[_0x4a03a9(0x2aa)]&&(_0xe6f7e9[_0x4a03a9(0x2aa)]=_0x7cc876[_0x4a03a9(0x2aa)]),_0x7cc876[_0x4a03a9(0x26f)]&&(_0xe6f7e9['tmdb_id']=_0x7cc876[_0x4a03a9(0x26f)]),downloadPosterAndSaveNfo(_0x461696,_0xe6f7e9[_0x4a03a9(0x1ee)],_0xe6f7e9,_0x405aa8,_0x4a03a9(0x2b5),_0x5d5f68,_0x2f5dad)[_0x4a03a9(0x226)](_0x18285a=>{const _0x3bb390=_0x4a03a9;log(_0x3bb390(0x208));if(!_0x7cc876[_0x3bb390(0x26f)])return _0x27ebcb();if(_0x2f5dad&&!detectIsMissingEpisodeInfo(_0x5d9900))return log('跳过不缺失任何信息的季'),_0x27ebcb();let _0x17013e=getTmdbApi();_0x17013e[_0x3bb390(0x24f)](_0x7cc876['tmdb_id'],_0x493357)[_0x3bb390(0x226)](_0x48b5d4=>{const _0x5790f4=_0x3bb390;log(_0x5790f4(0x237)),fs['readdir'](_0x5d9900,(_0x30251d,_0x3387ec)=>{const _0x4685f9=_0x5790f4;if(_0x30251d)return _0x27ebcb();let _0x54b36c=[];for(let _0x30bb1d of _0x3387ec){try{let _0x18cd64=path[_0x4685f9(0x2b1)](_0x5d9900,_0x30bb1d),_0x4b48a2=fs['statSync'](_0x18cd64);if(_0x4b48a2[_0x4685f9(0x254)]()){let _0x7cf876=movieSeasonUtil[_0x4685f9(0x281)](_0x30bb1d);_0x7cf876&&_0x7cf876[_0x4685f9(0x21a)]&&_0x7cf876['episode']>0x0&&_0x54b36c['push'](saveEpisodeInfo(_0x5d9900,_0x48b5d4,_0x30bb1d,_0x7cf876[_0x4685f9(0x21a)],_0x2f5dad));}}catch(_0x33611f){log(_0x33611f);continue;}}Promise[_0x4685f9(0x207)](_0x54b36c)[_0x4685f9(0x226)](_0x289194=>{_0x27ebcb();});});})['catch'](_0x4be2f0=>{const _0x5e0240=_0x3bb390;return log(_0x4be2f0),addScrapeLog(path[_0x5e0240(0x2b1)](workerData[_0x5e0240(0x1fd)]),'API_SEASON_DETAIL','','',_0x5e0240(0x1f7),_0x4be2f0[_0x5e0240(0x279)]?_0x4be2f0[_0x5e0240(0x279)]:_0x5e0240(0x293)),_0x27ebcb();});});});}function onSearchFinish(_0x3e8d8e,_0xe7a2c9,_0x249785){return new Promise((_0x261e8d,_0x1a4a66)=>{const _0x44dd6f=_0x2626;let _0x2cab15=path[_0x44dd6f(0x2b1)](_0x3e8d8e[_0x44dd6f(0x1fd)],_0x3e8d8e[_0x44dd6f(0x290)]),_0x374311=_0x3e8d8e[_0x44dd6f(0x251)]==0x1,_0x28b7a8=getTmdbApi();_0x28b7a8[_0x44dd6f(0x202)](_0xe7a2c9,_0x374311)[_0x44dd6f(0x226)](_0x1f805a=>{const _0x9324e5=_0x44dd6f;if(!_0x374311){let {dir:_0x4fcb82,name:_0x17c164}=path[_0x9324e5(0x243)](_0x2cab15),_0x6059f4=path[_0x9324e5(0x2b1)](_0x4fcb82,_0x17c164+_0x9324e5(0x283)),_0x8b8832=_0x1f805a['cover_url'],_0x149927=path[_0x9324e5(0x2b1)](_0x4fcb82,_0x17c164+'.nfo'),_0x3d421a=path[_0x9324e5(0x2b1)](_0x4fcb82,_0x17c164+_0x9324e5(0x1d7));downloadPosterAndSaveNfo(_0x6059f4,_0x8b8832,_0x1f805a,_0x149927,_0x9324e5(0x278),_0x3d421a,_0x249785)['then'](_0x441e9d=>{const _0x5baa98=_0x9324e5;return log(_0x5baa98(0x22d)),_0x261e8d();});}else{let _0x23722e=movieSeasonUtil[_0x9324e5(0x1db)](path[_0x9324e5(0x296)](_0x3e8d8e[_0x9324e5(0x1fd)]));if(_0x23722e>-0x1){log(_0x9324e5(0x23a)+_0x2cab15);let {dir:_0x21cdcb,name:_0x5a442d}=path[_0x9324e5(0x243)](_0x2cab15),_0x4207d3=path[_0x9324e5(0x2b1)](path[_0x9324e5(0x23f)](_0x21cdcb),_0x9324e5(0x1e9)),_0x3bda2e=path[_0x9324e5(0x2b1)](path[_0x9324e5(0x23f)](_0x21cdcb),_0x9324e5(0x22a)),_0x4e33b7=path[_0x9324e5(0x2b1)](path['dirname'](_0x21cdcb),_0x9324e5(0x2bd));downloadPosterAndSaveNfo(_0x4207d3,_0x1f805a['cover_url'],_0x1f805a,_0x4e33b7,'tvshow',_0x3bda2e,_0x249785)['then'](_0x182850=>{const _0x474367=_0x9324e5;log(_0x474367(0x249)),fs[_0x474367(0x1df)](path[_0x474367(0x23f)](_0x21cdcb),(_0x3cdaab,_0x2bcaa0)=>{const _0x51e779=_0x474367;if(_0x3cdaab)return _0x261e8d();let _0x2179ed=[];for(let _0x12b0e1 of _0x2bcaa0){try{let _0x3634be=path[_0x51e779(0x2b1)](path[_0x51e779(0x23f)](_0x21cdcb),_0x12b0e1),_0x3490c8=fs[_0x51e779(0x1f3)](_0x3634be);if(_0x3490c8[_0x51e779(0x229)]()){let _0x214256=movieSeasonUtil['getSeasonNumber'](_0x12b0e1);_0x214256>-0x1&&_0x2179ed[_0x51e779(0x26b)](saveSeasonInfo(_0x3634be,_0x1f805a,_0x214256,!![],_0x249785));}}catch(_0x4c8862){log(_0x4c8862);continue;}}Promise[_0x51e779(0x207)](_0x2179ed)[_0x51e779(0x226)](_0x23682a=>{_0x261e8d();});});});}else{log('不符合三级命名规则:'+_0x2cab15);let _0x55696d=movieSeasonUtil[_0x9324e5(0x1db)](path[_0x9324e5(0x296)](_0x3e8d8e[_0x9324e5(0x1fd)]),![]);if(_0x55696d>-0x1)saveSeasonInfo(path[_0x9324e5(0x23f)](_0x2cab15),_0x1f805a,_0x55696d,![],_0x249785)[_0x9324e5(0x226)](_0x455ee0=>{_0x261e8d();});else{let _0x358151=movieSeasonUtil[_0x9324e5(0x281)](_0x2cab15);_0x358151&&_0x358151['season']&&_0x358151[_0x9324e5(0x24e)]>0x0?saveSeasonInfo(path['dirname'](_0x2cab15),_0x1f805a,_0x358151['season'],![],_0x249785)[_0x9324e5(0x226)](_0x242e15=>{_0x261e8d();}):(log('没有季信息\x20默认使用第一季'),saveSeasonInfo(path[_0x9324e5(0x23f)](_0x2cab15),_0x1f805a,0x1,![],_0x249785)['then'](_0x1509c6=>{_0x261e8d();}));}}}})[_0x44dd6f(0x294)](_0x382dbf=>{const _0xebefda=_0x44dd6f;return log(_0x382dbf),addScrapeLog(path[_0xebefda(0x2b1)](workerData[_0xebefda(0x1fd)]),_0xebefda(0x264),'','',_0xebefda(0x1f7),_0x382dbf['status_message']?_0x382dbf['status_message']:_0xebefda(0x293)),_0x261e8d();});});}function _0x2626(_0x1e4083,_0x3b5af4){const _0x44fc89=_0x44fc();return _0x2626=function(_0x26267f,_0x437c85){_0x26267f=_0x26267f-0x1d3;let _0x4cdc0f=_0x44fc89[_0x26267f];return _0x4cdc0f;},_0x2626(_0x1e4083,_0x3b5af4);}function addScrapeLog(_0xaf3085,_0xf6102e,_0x116d37,_0x4efc2f,_0x27f23a,_0x178fb5){const _0x1fef18=_0x146399;dbFileIndex[_0x1fef18(0x1f2)]('INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)')[_0x1fef18(0x1e0)](_0xaf3085,_0xf6102e,_0x116d37,_0x4efc2f,_0x27f23a,_0x178fb5,Date[_0x1fef18(0x2a7)]());}function getTvExistTmdbId(_0x46465f){const _0x3fd609=_0x146399;if(_0x46465f[_0x3fd609(0x251)]!=0x1)return null;let _0x450272=path[_0x3fd609(0x23f)](_0x46465f[_0x3fd609(0x1fd)]),_0x37c468=movieSeasonUtil[_0x3fd609(0x1db)](path[_0x3fd609(0x296)](_0x46465f['path']),!![]),_0x121739=null,_0x19266c='';_0x37c468>-0x1&&(_0x19266c=path[_0x3fd609(0x2b1)](_0x450272,_0x3fd609(0x2bd)));(!_0x19266c||!fs[_0x3fd609(0x1ea)](_0x19266c))&&(_0x19266c=path[_0x3fd609(0x2b1)](_0x46465f[_0x3fd609(0x1fd)],'tvshow.nfo'));if(!_0x19266c||!fs['existsSync'](_0x19266c))return null;const _0x264393=new XMLParser();let _0x2d0438=_0x264393[_0x3fd609(0x243)](fs['readFileSync'](_0x19266c));return _0x2d0438[_0x3fd609(0x2b5)]&&(_0x2d0438=_0x2d0438[_0x3fd609(0x2b5)],_0x2d0438[_0x3fd609(0x2b9)]&&(_0x121739=_0x2d0438[_0x3fd609(0x2b9)])),{'tmdbId':_0x121739,'seassonNumber':_0x37c468};}function searchMovieInfo(_0x520207,_0x1f1ca1){const _0x343f35=_0x146399;return!_0x1f1ca1&&(_0x1f1ca1=getQueryArray(_0x520207)),log(JSON[_0x343f35(0x1da)](_0x1f1ca1)),new Promise((_0x2fb10d,_0xe1b7ac)=>{const _0x5e9820=_0x343f35;function _0x1701f3(){return _0xe1b7ac();}if(!_0x1f1ca1||_0x1f1ca1[_0x5e9820(0x241)]<0x1)return log(_0x5e9820(0x2ac)),_0x1701f3();let _0x352473=_0x1f1ca1[0x0][_0x5e9820(0x1d5)],_0x40e894=_0x1f1ca1[0x0][_0x5e9820(0x21d)];log(_0x5e9820(0x23d),_0x352473[_0x5e9820(0x1d5)]);let _0x4bbf9c=getTmdbApi();if(!_0x4bbf9c)return log(_0x5e9820(0x220)),_0x1701f3();let _0x4a519d=_0x520207[_0x5e9820(0x251)]==0x1;_0x4bbf9c[_0x5e9820(0x1d4)](_0x352473,_0x4a519d,_0x40e894)['then'](_0x2b54dc=>{const _0x4480d4=_0x5e9820;if(_0x2b54dc&&_0x2b54dc[_0x4480d4(0x241)]>0x0){let _0x3ef2c0=_0x2b54dc[0x0];onSearchFinish(_0x520207,_0x3ef2c0['tmdb_id'])['then'](()=>{return _0x2fb10d();});}else{if(_0x1f1ca1[_0x4480d4(0x241)]>0x1){let _0x25af63=_0x1f1ca1[_0x4480d4(0x206)](0x1);return searchMovieInfo(_0x520207,_0x25af63)['then'](_0x2fb10d);}else return log(_0x4480d4(0x239),_0x352473),addScrapeLog(path['join'](workerData[_0x4480d4(0x1fd)]),_0x4480d4(0x264),'','',_0x4480d4(0x1f7),i18n['__'](_0x4480d4(0x269))),_0x1701f3();}})[_0x5e9820(0x294)](_0x3cf8c9=>{const _0x1e46e5=_0x5e9820;return log(_0x1e46e5(0x22b),_0x3cf8c9),_0x1701f3();});});}function returnResult(){const _0x30e133=_0x146399;log(_0x30e133(0x2ae)),parentPort[_0x30e133(0x1d3)]({'code':0x0}),process[_0x30e133(0x289)](0x0);}function log(_0x517dfb){const _0x54612a=_0x146399;parentPort[_0x54612a(0x1d3)]({'type':'log','message':_0x517dfb});}if(workerData&&workerData[_0x146399(0x290)]&&workerData['path']&&workerData[_0x146399(0x1f4)]&&workerData[_0x146399(0x259)]&&workerData[_0x146399(0x26e)]){if(workerData['tmdb_id'])log(_0x146399(0x27c)),onSearchFinish(workerData,workerData['tmdb_id'])[_0x146399(0x226)](_0x1f49bb=>{const _0x5de381=_0x146399;log(_0x5de381(0x252),workerData['tmdb_id'],workerData[_0x5de381(0x1fd)],workerData[_0x5de381(0x290)]),returnResult();})[_0x146399(0x294)](_0x110155=>{returnResult();});else{if(workerData[_0x146399(0x20e)]==0x1){log(_0x146399(0x270));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId['tmdbId']){addScrapeLog(path[_0x146399(0x2b1)](workerData['path']),'SCRAPE_MISSING','','',_0x146399(0x1f7),i18n['__']('tmdbidNotFound'));return;}let tmdbId=foundTmdbId[_0x146399(0x2a2)];onSearchFinish(workerData,tmdbId,!![])['then'](_0x5d14a7=>{const _0x88e88a=_0x146399;log(_0x88e88a(0x252)),returnResult();})[_0x146399(0x294)](_0x84096d=>{returnResult();});}else log(_0x146399(0x1e5)),searchMovieInfo(workerData)[_0x146399(0x226)](_0x4aedb8=>{const _0xc0e8fb=_0x146399;log(_0xc0e8fb(0x252)+workerData[_0xc0e8fb(0x1fd)]+'\x20'+workerData[_0xc0e8fb(0x290)]),returnResult();})[_0x146399(0x294)](_0x3e09d1=>{returnResult();});}}else log('信息不足\x20无法搜索\x20退出worker'),returnResult();