const _0x39f310=_0x41e2;(function(_0x4f4af4,_0x48aae9){const _0x473165=_0x41e2,_0x748599=_0x4f4af4();while(!![]){try{const _0x34688e=-parseInt(_0x473165(0x105))/0x1+parseInt(_0x473165(0x189))/0x2*(parseInt(_0x473165(0xd8))/0x3)+parseInt(_0x473165(0xda))/0x4*(parseInt(_0x473165(0x16c))/0x5)+-parseInt(_0x473165(0xe5))/0x6*(-parseInt(_0x473165(0x11b))/0x7)+-parseInt(_0x473165(0x13c))/0x8*(parseInt(_0x473165(0x126))/0x9)+-parseInt(_0x473165(0x146))/0xa+parseInt(_0x473165(0x12e))/0xb;if(_0x34688e===_0x48aae9)break;else _0x748599['push'](_0x748599['shift']());}catch(_0x136d75){_0x748599['push'](_0x748599['shift']());}}}(_0x59a6,0xb9959));const {XMLParser,XMLBuilder}=require(_0x39f310(0xf5)),path=require(_0x39f310(0x13e));let axios=require(_0x39f310(0x185));const {HttpsProxyAgent}=require(_0x39f310(0xea)),https=require('https'),{URL}=require(_0x39f310(0x124)),fs=require('fs'),movieSeasonUtil=require(_0x39f310(0x174)),mediaTypeConfig=require('../myConfig/mediaType'),{parentPort,workerData}=require(_0x39f310(0xd5)),movieInfoTmdbApi=require(_0x39f310(0x15e)),dbConfigTable=require(_0x39f310(0x130)),nfoUtil=require(_0x39f310(0x153)),Database=require(_0x39f310(0x18d)),config=require('../myConfig/config'),dbFileIndex=new Database(config[_0x39f310(0x16d)],{'timeout':0xea60});dbFileIndex[_0x39f310(0x1a4)](_0x39f310(0x177));let dbOther=new Database(config[_0x39f310(0xfd)],{});function _0x59a6(){const _0x1f1f42=['internal','SCRAPE_MISSING','basename','url','atmos-swtyblz','9jJExEn','uhd','跳过保存海报:','电影的海报和nfo保存完毕','tmdbId','ddp','STREAM','阳光电影dygod.org','6448211aHpOyC','要查询的数据不存在','../db/dbConfigTable','6audio','API_SEASON_DETAIL','remastered','7.1','VID_','fanart.jpg','includes','-fanart.jpg','startsWith','exit','hd1080p','2017712lIpNCi','toLocaleLowerCase','path','substr','x265','atmos-coaster','下载fanart:','没有找到要保存的季信息\x20对应号码:','genres','4audio','4563260yQrHqd','刮削任务结束','英语中字','电影天堂','port','scrapeMissing','开始保存每一集的信息','allSettled','hostname','getDetail','.tmp','swtyblz','API_DETAIL','../utils/nfoUtil','brrip','5audios','ita','rename','Search\x20Worker:Tmdb代理已经开启','dvd','web','nexusnf','.jpg','coaster','../utils/movieInfoTmdbApi','toLowerCase','img_','2audios','0000','hds','fgt','then','parse','pathname','is_tvplay','statSync','prepare','episodes','2395logYah','dbFileIndex','beitai','getSeasonNumber','tmdbProxyEnable','3audio','directors','isFile','../utils/movieSeasonUtil','vid','some','journal_mode\x20=\x20WAL','跳过非视频文件:','缺失:','tmdb_api_language','extname','replace','265-apex','season.season_number:','hevc','season_number','跳过保存NFO:','length','seriesInfo没找到季信息','pipe','axios','.nfo','不符合三级命名规则:','cover_url','6sULkwx','6audios','postMessage','creatorOriginal','better-sqlite3','rmvb','5audio','跳过保存fanart:','iamable','seasons','ac3','bdrip','test','keys','根据已有NFO刮削缺失集','season海报和nfo保存完毕','480p','title','finish','showtitle','bhd','backdrop_url','movie_name','episode_number','dolby-multi-bodhmall','nfo不存在,开始保存','cee','pragma','整部剧的海报和nfo保存完毕','tmdb.没有获取到相关信息','信息获取完毕','10bit','isDirectory','mov','tmdbid','tmdbidNotFound','push','actors','开始下载','NFO','findByTitle','every','tmdbProxyUrl','INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)','240p','existsSync','videoTypeList','720p','1080p','noSearchResult','根据文件名和路径搜索','readdir','close','creator','split','worker_threads','chs-eng','hdtv','168441SccaNF','3gp','9908vDyBDR','SUCCESS','poster.jpg','7audio','高清晰版','guestActorsOriginal','-poster.jpg','getSeasonDetail','tmdb_id','请求失败:\x20HTTP\x20','episodedetails','114dUSMvv','dirname','3audios','h265','search','hpagent','actorsOriginal','tmdb_api_url','join','error','FAIL','7audios','stringify','year','tmdb_api_key','extractEpisodeNumbers','fast-xml-parser','catch','atmos','POSTER','now','regions','IMG_','statusCode','dbOther','splice','movie','value','高清版','x260bit','bd720p','英文中字','571403krhHcH','directorsOriginal','tvshow','信息不足\x20无法搜索\x20退出worker','status_message','filename','get','TMDB\x20search接口请求失败','Matching\x20movie\x20information\x20','dts-ift','createWriteStream','blue-ray','没有季信息\x20默认使用第一季','season','2160p','dvsux','ERROR','log','substring','tvshow.nfo','日语中字','lastIndexOf','36463vcigFu','高清mp4电影','tbs','h264','atmos-iamable','episode'];_0x59a6=function(){return _0x1f1f42;};return _0x59a6();}dbOther[_0x39f310(0x1a4)](_0x39f310(0x177));let i18nUtil=require('../utils/i18nUtil');i18n=i18nUtil['getI18n'](dbOther);let excludeList=[_0x39f310(0x12d),_0x39f310(0x1a1),_0x39f310(0x113),'bd1080p',_0x39f310(0x13b),_0x39f310(0xce),_0x39f310(0x103),_0x39f310(0xcd),'x264',_0x39f310(0x199),_0x39f310(0xca),_0x39f310(0x15a),_0x39f310(0x15b),'x265-terminal',_0x39f310(0x154),_0x39f310(0x171),_0x39f310(0x145),'hdwing',_0x39f310(0x18f),_0x39f310(0x131),_0x39f310(0xdd),_0x39f310(0xe7),'4audios',_0x39f310(0x155),_0x39f310(0x18a),_0x39f310(0xf0),_0x39f310(0x1a3),_0x39f310(0x17f),_0x39f310(0x133),_0x39f310(0x121),_0x39f310(0x163),'fgt','truehd',_0x39f310(0x1a8),'8bit','sdr','hdr10','hdr','hd',_0x39f310(0x10e),'dts-hd','dts','rargb',_0x39f310(0x151),_0x39f310(0x191),'cmct',_0x39f310(0x15d),'ma',_0x39f310(0x19d),'dv',_0x39f310(0x12b),'cmrg','surcode',_0x39f310(0x164),'web-dl','x265-dvsux',_0x39f310(0x140),_0x39f310(0x114),_0x39f310(0x102),'4ktrash',_0x39f310(0x125),_0x39f310(0x11f),_0x39f310(0x141),'eng','nahom',_0x39f310(0x156),_0x39f310(0x17d),_0x39f310(0xf7),_0x39f310(0x127),_0x39f310(0x194),'remux','bluray',_0x39f310(0xd7),_0x39f310(0x110),'ultrahd','ultra-hd',_0x39f310(0x11e),_0x39f310(0xe8),'mkv','mp4',_0x39f310(0x18e),'rm',_0x39f310(0x1aa),_0x39f310(0xd9),_0x39f310(0x15a),_0x39f310(0x11d),_0x39f310(0x161),'aac',_0x39f310(0x159),_0x39f310(0xd6),_0x39f310(0x193),'dreamhd',_0x39f310(0x101),_0x39f310(0x149),'阳光电影',_0x39f310(0xde),_0x39f310(0x148),_0x39f310(0x104),'西语中字',_0x39f310(0x16e),'dl','-','中文字幕',_0x39f310(0x149),'韩语中字',_0x39f310(0x119),_0x39f310(0x11c)];function isObjectInQueryArray(_0x168186,_0x247bdf){const _0x7a38a2=_0x39f310;return _0x168186[_0x7a38a2(0x176)](function(_0x5eb520){const _0x4bbca2=_0x7a38a2,_0x1c4768=Object[_0x4bbca2(0x196)](_0x247bdf);return _0x1c4768[_0x4bbca2(0xc7)](_0x1ea8e0=>_0x5eb520[_0x1ea8e0]===_0x247bdf[_0x1ea8e0]);});}function getQueryArray(_0xfc341f){const _0x501c15=_0x39f310;let _0x1e945b=[];if(!_0xfc341f||!_0xfc341f[_0x501c15(0x10a)])return[];let _0x433b96=_0xfc341f['filename'][_0x501c15(0x15f)]();if(!_0x433b96||_0x433b96['length']<0x2)return[];function _0x50d639(_0x488e43,_0x5a1acf){const _0x1306a6=_0x501c15;let _0x336cd0={'title':_0x488e43,'year':_0x5a1acf};_0x488e43!=_0x1306a6(0x12c)&&!isObjectInQueryArray(_0x1e945b,_0x336cd0)&&_0x1e945b[_0x1306a6(0x1ad)](_0x336cd0);}function _0x2bd734(_0x39493b){const _0x1d722b=_0x501c15;let _0x55c17c=path['extname'](_0x39493b);_0x55c17c&&(_0x39493b=_0x39493b[_0x1d722b(0x17c)](_0x55c17c,''));if(/^[0-9]*$/[_0x1d722b(0x195)](_0x39493b)&&_0x39493b!='1942'&&!_0x39493b[_0x1d722b(0x139)](_0x1d722b(0x162)))return[];if(_0x39493b[_0x1d722b(0x139)](_0x1d722b(0xfb))||_0x39493b[_0x1d722b(0x139)](_0x1d722b(0x160))||_0x39493b[_0x1d722b(0x139)]('VID')||_0x39493b[_0x1d722b(0x139)](_0x1d722b(0x175))||_0x39493b[_0x1d722b(0x139)](_0x1d722b(0x135))||_0x39493b[_0x1d722b(0x139)]('vid_')||_0x39493b[_0x1d722b(0x139)]('IMG'))return[];_0x39493b[_0x39493b['length']-0x1]=='.'&&(_0x39493b=_0x39493b[_0x1d722b(0x13f)](0x0,_0x39493b[_0x1d722b(0x182)]-0x1));_0x39493b=_0x39493b[_0x1d722b(0x17c)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')['replace']('5.1','')[_0x1d722b(0x17c)](_0x1d722b(0x134),''),_0x39493b=_0x39493b['replace'](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')[_0x1d722b(0x17c)](/[ ]+/gi,'\x20');let _0x10a9e9=_0x39493b[_0x1d722b(0xd4)]('\x20'),_0x50b502=[],_0xdf50b9=null;for(let _0xa1f446 in _0x10a9e9){let _0xdefe4e=_0x10a9e9[_0xa1f446]['trim']();if(excludeList['includes'](_0xdefe4e))continue;if(isNumber(_0xdefe4e)){if(parseInt(_0xdefe4e)>0x767&&parseInt(_0xdefe4e)<0x834){_0xdf50b9=_0xdefe4e;continue;}}_0x50b502['push'](_0xdefe4e);}for(let _0x108d11=_0x50b502['length'];_0x108d11>=0x0;_0x108d11--){let _0x158ac6=_0x50b502[_0x1d722b(0xed)]('\x20')['trim']();_0x158ac6&&(_0xdf50b9&&_0x50d639(_0x158ac6,_0xdf50b9),_0x50d639(_0x158ac6)),_0x50b502['splice'](_0x50b502[_0x1d722b(0x182)]-0x1,0x1);}}if(_0xfc341f[_0x501c15(0x168)]==0x1)try{let _0x279d5a=path[_0x501c15(0x123)](_0xfc341f[_0x501c15(0x13e)])[_0x501c15(0x13d)](),_0x3e6d74=movieSeasonUtil[_0x501c15(0x16f)](_0x279d5a);if(_0x3e6d74>-0x1){let _0x49d2da=path[_0x501c15(0x123)](path[_0x501c15(0xe6)](_0xfc341f[_0x501c15(0x13e)]))[_0x501c15(0x13d)]();_0x49d2da&&_0x2bd734(_0x49d2da);}else _0x2bd734(_0x279d5a);}catch(_0x3381f3){console['log'](_0x3381f3);}const _0x1fab4c=_0x433b96['replace'](/s\d{1,2}e\d{1,2}/g,'');return _0x2bd734(_0x1fab4c),_0x1e945b;}function isNumber(_0x1a063c){const _0x507721=_0x39f310;return/^-?[\d.]+(?:e-?\d+)?$/[_0x507721(0x195)](_0x1a063c);}function getTmdbApi(){const _0x1d216f=_0x39f310;let _0x2de00e=dbConfigTable[_0x1d216f(0xc6)](dbOther,_0x1d216f(0x170)),_0x43e05d=null;if(_0x2de00e&&_0x2de00e[_0x1d216f(0x100)]==0x1){let _0x14da29=dbConfigTable[_0x1d216f(0xc6)](dbOther,'tmdbProxyUrl');_0x14da29&&_0x14da29[_0x1d216f(0x100)]&&(_0x43e05d=_0x14da29[_0x1d216f(0x100)]),log(_0x1d216f(0x158)+_0x43e05d);}return tmdbApiObj=new movieInfoTmdbApi['API'](workerData[_0x1d216f(0xf3)],workerData['tmdb_api_language'],workerData['tmdb_api_url'],_0x43e05d),tmdbApiObj;}function getProxyUrl(_0x3f378f){const _0x3cb6fb=_0x39f310;let _0x54bb01=dbConfigTable[_0x3cb6fb(0xc6)](_0x3f378f,_0x3cb6fb(0x170)),_0x336b37=null;if(_0x54bb01&&_0x54bb01[_0x3cb6fb(0x100)]==0x1){let _0x399178=dbConfigTable[_0x3cb6fb(0xc6)](_0x3f378f,_0x3cb6fb(0xc8));_0x399178&&_0x399178['value']&&(_0x336b37=_0x399178[_0x3cb6fb(0x100)]);}return _0x336b37;}function downloadPoster(_0x3cfe90,_0x744d3c){return new Promise((_0x234481,_0x26b2d3)=>{fs['stat'](_0x3cfe90,(_0x56a85b,_0x2196a7)=>{const _0x292a77=_0x41e2;if(_0x56a85b){console[_0x292a77(0x116)](_0x292a77(0x1af),_0x744d3c);let _0x5ae2ee=getProxyUrl(dbOther),_0x923142=null;_0x5ae2ee&&(_0x923142=new HttpsProxyAgent({'proxy':_0x5ae2ee}));const _0x10c499=new URL(_0x744d3c);https[_0x292a77(0x10b)]({'hostname':_0x10c499[_0x292a77(0x14e)],'port':_0x10c499[_0x292a77(0x14a)]||0x1bb,'path':_0x10c499[_0x292a77(0x167)]+_0x10c499[_0x292a77(0xe9)],'agent':_0x923142?_0x923142:![]},_0x2e0d88=>{const _0x45145e=_0x292a77;if(_0x2e0d88['statusCode']!==0xc8)return console[_0x45145e(0xee)](_0x45145e(0xe3)+_0x2e0d88[_0x45145e(0xfc)]),addScrapeLog(path['join'](workerData[_0x45145e(0x13e)]),_0x45145e(0xf8),'',_0x3cfe90,'FAIL'),_0x234481('');let _0x1f94cc=_0x3cfe90+_0x45145e(0x150),_0x577482=fs[_0x45145e(0x10f)](_0x1f94cc);_0x2e0d88[_0x45145e(0x184)](_0x577482),_0x577482['on'](_0x45145e(0x19b),()=>{const _0x3689e3=_0x45145e;fs[_0x3689e3(0x157)](_0x1f94cc,_0x3cfe90,_0x2d8763=>{const _0x58e122=_0x3689e3;if(_0x2d8763)return _0x234481('');addScrapeLog(path[_0x58e122(0xed)](workerData[_0x58e122(0x13e)]),_0x58e122(0xf8),'',_0x3cfe90,_0x58e122(0xdb)),_0x234481(_0x3cfe90);});}),_0x577482['on']('error',_0x4581c5=>{const _0x31a518=_0x45145e;console[_0x31a518(0x116)](_0x4581c5),addScrapeLog(path[_0x31a518(0xed)](workerData[_0x31a518(0x13e)]),'POSTER','',_0x3cfe90,_0x31a518(0xef)),_0x234481('');}),_0x577482['on'](_0x45145e(0xd2),()=>{});})['on']('error',_0x4161f0=>{_0x234481('');});}else _0x234481(_0x3cfe90);});});}function downloadPosterAndSaveNfo(_0x447e13,_0x44948c,_0x75c3eb,_0x54f738,_0x470880,_0x3a6fdf,_0x276d2e){return new Promise((_0x388bff,_0x2a4b79)=>{const _0xd17162=_0x41e2;let _0x2fdbbf=[];_0x44948c&&_0x447e13&&(!_0x276d2e||_0x276d2e&&!fs[_0xd17162(0xcb)](_0x447e13)?_0x2fdbbf[_0xd17162(0x1ad)](downloadPoster(_0x447e13,_0x44948c)):log(_0xd17162(0x128)+_0x447e13)),_0x75c3eb&&_0x54f738&&(!_0x276d2e||_0x276d2e&&!fs[_0xd17162(0xcb)](_0x54f738)?(console[_0xd17162(0x116)](_0xd17162(0x1a2),_0x54f738,_0x276d2e),addScrapeLog(path[_0xd17162(0xed)](workerData[_0xd17162(0x13e)]),_0xd17162(0xc5),_0x54f738,'','SUCCESS'),_0x2fdbbf[_0xd17162(0x1ad)](nfoUtil['saveNfoFile'](_0x75c3eb,_0x54f738,_0x470880))):log(_0xd17162(0x181)+_0x54f738)),_0x75c3eb[_0xd17162(0x19e)]&&_0x3a6fdf&&(!_0x276d2e||_0x276d2e&&!fs[_0xd17162(0xcb)](_0x3a6fdf)?(log(_0xd17162(0x142)+_0x3a6fdf),_0x2fdbbf[_0xd17162(0x1ad)](downloadPoster(_0x3a6fdf,_0x75c3eb['backdrop_url']))):log(_0xd17162(0x190)+_0x3a6fdf)),Promise[_0xd17162(0x14d)](_0x2fdbbf)[_0xd17162(0x165)](_0x44732c=>{_0x388bff();});});}function saveEpisodeInfo(_0xb82214,_0x2bd5db,_0x2bcf02,_0x4baa77,_0x2186fb){return new Promise((_0x236d8a,_0x149f53)=>{const _0x4e0f72=_0x41e2;if(!mediaTypeConfig[_0x4e0f72(0xcc)][_0x4e0f72(0x137)](path['extname'](_0x2bcf02)[_0x4e0f72(0x15f)]()))return log(_0x4e0f72(0x178)+_0x2bcf02),_0x236d8a();if(!_0x2bd5db['episodes']||_0x2bd5db['episodes'][_0x4e0f72(0x182)]<0x1)return log('seasonInfo没找到每一集的信息'),_0x236d8a();let _0x13576e;for(let _0x34d02c of _0x2bd5db[_0x4e0f72(0x16b)]){if(_0x34d02c[_0x4e0f72(0x1a0)]==_0x4baa77){_0x13576e=_0x34d02c;break;}}if(!_0x13576e)return log('没有找到要保存的集信息\x20对应号码:'+_0x4baa77),_0x236d8a();_0x2bd5db[_0x4e0f72(0x180)]&&(_0x13576e[_0x4e0f72(0x112)]=_0x2bd5db[_0x4e0f72(0x180)]);_0x13576e['episode']=_0x4baa77;let {dir:_0x5c8b36,name:_0x57bd14}=path[_0x4e0f72(0x166)](path[_0x4e0f72(0xed)](_0xb82214,_0x2bcf02)),_0x36c0e8=path[_0x4e0f72(0xed)](_0x5c8b36,_0x57bd14)+_0x4e0f72(0x15c),_0x3fbb9f=path[_0x4e0f72(0xed)](_0x5c8b36,_0x57bd14)+_0x4e0f72(0x186);downloadPosterAndSaveNfo(_0x36c0e8,_0x13576e[_0x4e0f72(0x188)],_0x13576e,_0x3fbb9f,_0x4e0f72(0xe4),null,_0x2186fb)['then'](_0xa5ca51=>{_0x236d8a();});});}function _0x41e2(_0x6ed4a9,_0x3e2164){const _0x59a68d=_0x59a6();return _0x41e2=function(_0x41e234,_0x181930){_0x41e234=_0x41e234-0xc5;let _0x5ba0b9=_0x59a68d[_0x41e234];return _0x5ba0b9;},_0x41e2(_0x6ed4a9,_0x3e2164);}function detectIsMissingEpisodeInfo(_0x28bf5b){const _0x165626=_0x39f310;let _0x3b30d1=fs['readdirSync'](_0x28bf5b),_0x49a000=![];for(let _0x2e8398 of _0x3b30d1){let _0x4ced8a=path[_0x165626(0x17b)](_0x2e8398)?path[_0x165626(0x17b)](_0x2e8398)[_0x165626(0x15f)]():null;if(_0x4ced8a&&config[_0x165626(0xcc)][_0x165626(0x137)](_0x4ced8a)){let _0x1d9fd1=_0x2e8398[_0x165626(0x117)](0x0,_0x2e8398[_0x165626(0x11a)]('.')),_0xe959d3=path[_0x165626(0xed)](_0x28bf5b,_0x1d9fd1+_0x165626(0x186));if(!fs[_0x165626(0xcb)](_0xe959d3))return console[_0x165626(0x116)](_0x165626(0x179)+_0xe959d3),_0x49a000=!![],_0x49a000;}}return _0x49a000;}function saveSeasonInfo(_0x252690,_0x1fe001,_0x378fa6,_0x517da5,_0xab216b){return new Promise((_0x5e3f98,_0x4ed677)=>{const _0x5707c4=_0x41e2;if(!_0x1fe001[_0x5707c4(0x192)]||_0x1fe001[_0x5707c4(0x192)][_0x5707c4(0x182)]<0x1)return log(_0x5707c4(0x183)),_0x5e3f98();let _0x384346;for(let _0x95f8d6 of _0x1fe001[_0x5707c4(0x192)]){log(_0x5707c4(0x17e)+_0x95f8d6['season_number']);if(_0x95f8d6[_0x5707c4(0x180)]==_0x378fa6){_0x384346=_0x95f8d6;break;}}if(!_0x384346)return log(_0x5707c4(0x143)+_0x378fa6),_0x5e3f98();let _0x20b0e3,_0x3a9f4e,_0x11e638,_0x334fc4;if(_0x517da5){let _0x579892=_0x378fa6+'';if(_0x378fa6<0xa)_0x579892='0'+_0x378fa6;_0x20b0e3=path['join'](path[_0x5707c4(0xe6)](_0x252690),_0x5707c4(0x112)+_0x579892+_0x5707c4(0xe0)),_0x11e638=path[_0x5707c4(0xed)](_0x252690,'season.nfo'),_0x334fc4=path[_0x5707c4(0xed)](path['dirname'](_0x252690),_0x5707c4(0x136));}else _0x20b0e3=path[_0x5707c4(0xed)](_0x252690,_0x5707c4(0xdc)),_0x11e638=path[_0x5707c4(0xed)](_0x252690,_0x5707c4(0x118)),_0x334fc4=path['join'](_0x252690,'fanart.jpg'),!_0x384346['backdrop_url']&&(_0x384346['backdrop_url']=_0x1fe001['backdrop_url']);!_0x384346['cover_url']&&(_0x384346[_0x5707c4(0x188)]=_0x1fe001[_0x5707c4(0x188)]),_0x384346['season']=_0x378fa6,_0x1fe001[_0x5707c4(0x19f)]&&_0x384346[_0x5707c4(0x19f)]&&(_0x384346[_0x5707c4(0x19c)]=_0x1fe001['movie_name']+'\x20'+_0x384346[_0x5707c4(0x19f)],_0x384346[_0x5707c4(0x19f)]=_0x384346[_0x5707c4(0x19c)]),_0x1fe001[_0x5707c4(0x1ae)]&&!_0x384346[_0x5707c4(0x1ae)]&&(_0x384346[_0x5707c4(0x1ae)]=_0x1fe001['actors']),_0x1fe001['actorsOriginal']&&!_0x384346[_0x5707c4(0xeb)]&&(_0x384346['actorsOriginal']=_0x1fe001[_0x5707c4(0xeb)]),_0x1fe001[_0x5707c4(0x172)]&&!_0x384346[_0x5707c4(0x172)]&&(_0x384346[_0x5707c4(0x172)]=_0x1fe001[_0x5707c4(0x172)]),_0x1fe001['directorsOriginal']&&!_0x384346[_0x5707c4(0x106)]&&(_0x384346[_0x5707c4(0x106)]=_0x1fe001[_0x5707c4(0x106)]),_0x1fe001[_0x5707c4(0xd3)]&&!_0x384346['creator']&&(_0x384346[_0x5707c4(0xd3)]=_0x1fe001[_0x5707c4(0xd3)]),_0x1fe001[_0x5707c4(0x18c)]&&!_0x384346['creatorOriginal']&&(_0x384346[_0x5707c4(0x18c)]=_0x1fe001[_0x5707c4(0x18c)]),_0x1fe001[_0x5707c4(0xdf)]&&!_0x384346[_0x5707c4(0xdf)]&&(_0x384346[_0x5707c4(0xdf)]=_0x1fe001[_0x5707c4(0xdf)]),_0x1fe001[_0x5707c4(0x144)]&&!_0x384346[_0x5707c4(0x144)]&&(_0x384346['genres']=_0x1fe001[_0x5707c4(0x144)]),_0x1fe001[_0x5707c4(0xfa)]&&!_0x384346[_0x5707c4(0xfa)]&&(_0x384346[_0x5707c4(0xfa)]=_0x1fe001[_0x5707c4(0xfa)]),_0x1fe001[_0x5707c4(0xe2)]&&(_0x384346['tmdb_id']=_0x1fe001[_0x5707c4(0xe2)]),downloadPosterAndSaveNfo(_0x20b0e3,_0x384346[_0x5707c4(0x188)],_0x384346,_0x11e638,_0x5707c4(0x107),_0x334fc4,_0xab216b)[_0x5707c4(0x165)](_0x570641=>{const _0xc4f805=_0x5707c4;log(_0xc4f805(0x198));if(!_0x1fe001[_0xc4f805(0xe2)])return _0x5e3f98();if(_0xab216b&&!detectIsMissingEpisodeInfo(_0x252690))return log('跳过不缺失任何信息的季'),_0x5e3f98();let _0x2d5471=getTmdbApi();_0x2d5471[_0xc4f805(0xe1)](_0x1fe001[_0xc4f805(0xe2)],_0x378fa6)[_0xc4f805(0x165)](_0x48613c=>{const _0x143997=_0xc4f805;log(_0x143997(0x14c)),fs['readdir'](_0x252690,(_0x58ef6d,_0x2a4fc6)=>{const _0x10a82a=_0x143997;if(_0x58ef6d)return _0x5e3f98();let _0x2d9752=[];for(let _0xb3afc2 of _0x2a4fc6){try{let _0x6e1f8c=path[_0x10a82a(0xed)](_0x252690,_0xb3afc2),_0x2f66e6=fs[_0x10a82a(0x169)](_0x6e1f8c);if(_0x2f66e6[_0x10a82a(0x173)]()){let _0x2ef7e9=movieSeasonUtil[_0x10a82a(0xf4)](_0xb3afc2);_0x2ef7e9&&_0x2ef7e9[_0x10a82a(0x120)]&&_0x2ef7e9[_0x10a82a(0x120)]>0x0&&_0x2d9752[_0x10a82a(0x1ad)](saveEpisodeInfo(_0x252690,_0x48613c,_0xb3afc2,_0x2ef7e9[_0x10a82a(0x120)],_0xab216b));}}catch(_0x34c91a){log(_0x34c91a);continue;}}Promise[_0x10a82a(0x14d)](_0x2d9752)[_0x10a82a(0x165)](_0x3bb742=>{_0x5e3f98();});});})[_0xc4f805(0xf6)](_0x3e0525=>{const _0x4a4276=_0xc4f805;return log(_0x3e0525),addScrapeLog(path[_0x4a4276(0xed)](workerData[_0x4a4276(0x13e)]),_0x4a4276(0x132),'','','FAIL',_0x3e0525[_0x4a4276(0x109)]?_0x3e0525[_0x4a4276(0x109)]:'ERROR'),_0x5e3f98();});});});}function onSearchFinish(_0x8ff903,_0x512a74,_0x15ed4b){return new Promise((_0x22d93c,_0x44d799)=>{const _0x58c4b6=_0x41e2;let _0x1b840b=path[_0x58c4b6(0xed)](_0x8ff903[_0x58c4b6(0x13e)],_0x8ff903[_0x58c4b6(0x10a)]),_0x46cf46=_0x8ff903['is_tvplay']==0x1,_0x2fbe35=getTmdbApi();_0x2fbe35[_0x58c4b6(0x14f)](_0x512a74,_0x46cf46)[_0x58c4b6(0x165)](_0x163005=>{const _0x333674=_0x58c4b6;if(!_0x46cf46){let {dir:_0x4497d0,name:_0xa6942a}=path[_0x333674(0x166)](_0x1b840b),_0x403e61=path[_0x333674(0xed)](_0x4497d0,_0xa6942a+'.jpg'),_0x345372=_0x163005['cover_url'],_0x1499f5=path[_0x333674(0xed)](_0x4497d0,_0xa6942a+'.nfo'),_0x559bb5=path[_0x333674(0xed)](_0x4497d0,_0xa6942a+_0x333674(0x138));downloadPosterAndSaveNfo(_0x403e61,_0x345372,_0x163005,_0x1499f5,_0x333674(0xff),_0x559bb5,_0x15ed4b)[_0x333674(0x165)](_0x54765f=>{const _0x370b4b=_0x333674;return log(_0x370b4b(0x129)),_0x22d93c();});}else{let _0x599ab7=movieSeasonUtil['getSeasonNumber'](path[_0x333674(0x123)](_0x8ff903[_0x333674(0x13e)]));if(_0x599ab7>-0x1){log('符合三级命名规则:'+_0x1b840b);let {dir:_0x2d3e1b,name:_0x439914}=path[_0x333674(0x166)](_0x1b840b),_0x141f91=path[_0x333674(0xed)](path[_0x333674(0xe6)](_0x2d3e1b),_0x333674(0xdc)),_0x5e1eb4=path[_0x333674(0xed)](path[_0x333674(0xe6)](_0x2d3e1b),_0x333674(0x136)),_0x1e117b=path['join'](path[_0x333674(0xe6)](_0x2d3e1b),'tvshow.nfo');downloadPosterAndSaveNfo(_0x141f91,_0x163005['cover_url'],_0x163005,_0x1e117b,'tvshow',_0x5e1eb4,_0x15ed4b)[_0x333674(0x165)](_0x544dfa=>{const _0x55ffa9=_0x333674;log(_0x55ffa9(0x1a5)),fs[_0x55ffa9(0xd1)](path[_0x55ffa9(0xe6)](_0x2d3e1b),(_0xf888fd,_0x38db28)=>{const _0xa2b68e=_0x55ffa9;if(_0xf888fd)return _0x22d93c();let _0x1d9da3=[];for(let _0xd16a95 of _0x38db28){try{let _0x57c176=path[_0xa2b68e(0xed)](path[_0xa2b68e(0xe6)](_0x2d3e1b),_0xd16a95),_0x5e46d2=fs[_0xa2b68e(0x169)](_0x57c176);if(_0x5e46d2[_0xa2b68e(0x1a9)]()){let _0x571e3b=movieSeasonUtil[_0xa2b68e(0x16f)](_0xd16a95);_0x571e3b>-0x1&&_0x1d9da3[_0xa2b68e(0x1ad)](saveSeasonInfo(_0x57c176,_0x163005,_0x571e3b,!![],_0x15ed4b));}}catch(_0x543704){log(_0x543704);continue;}}Promise[_0xa2b68e(0x14d)](_0x1d9da3)[_0xa2b68e(0x165)](_0x1b9b31=>{_0x22d93c();});});});}else{log(_0x333674(0x187)+_0x1b840b);let _0x5dee75=movieSeasonUtil['getSeasonNumber'](path[_0x333674(0x123)](_0x8ff903[_0x333674(0x13e)]),![]);if(_0x5dee75>-0x1)saveSeasonInfo(path['dirname'](_0x1b840b),_0x163005,_0x5dee75,![],_0x15ed4b)[_0x333674(0x165)](_0x2bb2a1=>{_0x22d93c();});else{let _0x52f415=movieSeasonUtil[_0x333674(0xf4)](_0x1b840b);_0x52f415&&_0x52f415[_0x333674(0x112)]&&_0x52f415[_0x333674(0x112)]>0x0?saveSeasonInfo(path['dirname'](_0x1b840b),_0x163005,_0x52f415['season'],![],_0x15ed4b)[_0x333674(0x165)](_0x2c67c4=>{_0x22d93c();}):(log(_0x333674(0x111)),saveSeasonInfo(path[_0x333674(0xe6)](_0x1b840b),_0x163005,0x1,![],_0x15ed4b)[_0x333674(0x165)](_0x3fa7f1=>{_0x22d93c();}));}}}})[_0x58c4b6(0xf6)](_0x148289=>{const _0x4e23ef=_0x58c4b6;return log(_0x148289),addScrapeLog(path[_0x4e23ef(0xed)](workerData[_0x4e23ef(0x13e)]),_0x4e23ef(0x152),'','',_0x4e23ef(0xef),_0x148289[_0x4e23ef(0x109)]?_0x148289[_0x4e23ef(0x109)]:_0x4e23ef(0x115)),_0x22d93c();});});}function addScrapeLog(_0x4e4943,_0x3309c8,_0x43ebd7,_0x5b87fd,_0x516103,_0x36d5dc){const _0x46deb8=_0x39f310;dbFileIndex[_0x46deb8(0x16a)](_0x46deb8(0xc9))['run'](_0x4e4943,_0x3309c8,_0x43ebd7,_0x5b87fd,_0x516103,_0x36d5dc,Date[_0x46deb8(0xf9)]());}function getTvExistTmdbId(_0x2dc843){const _0xd7d2e5=_0x39f310;if(_0x2dc843[_0xd7d2e5(0x168)]!=0x1)return null;let _0x133b21=path[_0xd7d2e5(0xe6)](_0x2dc843[_0xd7d2e5(0x13e)]),_0x437fb3=movieSeasonUtil[_0xd7d2e5(0x16f)](path[_0xd7d2e5(0x123)](_0x2dc843[_0xd7d2e5(0x13e)]),!![]),_0x40c968=null,_0x331139='';_0x437fb3>-0x1&&(_0x331139=path[_0xd7d2e5(0xed)](_0x133b21,_0xd7d2e5(0x118)));(!_0x331139||!fs[_0xd7d2e5(0xcb)](_0x331139))&&(_0x331139=path[_0xd7d2e5(0xed)](_0x2dc843[_0xd7d2e5(0x13e)],'tvshow.nfo'));if(!_0x331139||!fs[_0xd7d2e5(0xcb)](_0x331139))return null;const _0x38a395=new XMLParser();let _0x728fe3=_0x38a395[_0xd7d2e5(0x166)](fs['readFileSync'](_0x331139));return _0x728fe3[_0xd7d2e5(0x107)]&&(_0x728fe3=_0x728fe3[_0xd7d2e5(0x107)],_0x728fe3[_0xd7d2e5(0x1ab)]&&(_0x40c968=_0x728fe3['tmdbid'])),{'tmdbId':_0x40c968,'seassonNumber':_0x437fb3};}function searchMovieInfo(_0x3d6440,_0x2868ed){const _0x2c5d23=_0x39f310;return!_0x2868ed&&(_0x2868ed=getQueryArray(_0x3d6440)),log(JSON[_0x2c5d23(0xf1)](_0x2868ed)),new Promise((_0x543515,_0x3b9d3f)=>{const _0x2f15e6=_0x2c5d23;function _0x44c4c5(){return _0x3b9d3f();}if(!_0x2868ed||_0x2868ed['length']<0x1)return log(_0x2f15e6(0x12f)),_0x44c4c5();let _0x16cfcb=_0x2868ed[0x0][_0x2f15e6(0x19a)],_0x15f90c=_0x2868ed[0x0][_0x2f15e6(0xf2)];log(_0x2f15e6(0x10d),_0x16cfcb[_0x2f15e6(0x19a)]);let _0x540bf9=getTmdbApi();if(!_0x540bf9)return log('TMDB\x20api实例获取失败\x20请检查TMDB相关配置'),_0x44c4c5();let _0x27b72e=_0x3d6440[_0x2f15e6(0x168)]==0x1;_0x540bf9[_0x2f15e6(0xe9)](_0x16cfcb,_0x27b72e,_0x15f90c)['then'](_0x489e46=>{const _0x2761d0=_0x2f15e6;if(_0x489e46&&_0x489e46[_0x2761d0(0x182)]>0x0){let _0x1a5173=_0x489e46[0x0];onSearchFinish(_0x3d6440,_0x1a5173[_0x2761d0(0xe2)])[_0x2761d0(0x165)](()=>{return _0x543515();});}else{if(_0x2868ed[_0x2761d0(0x182)]>0x1){let _0x1dfb3d=_0x2868ed[_0x2761d0(0xfe)](0x1);return searchMovieInfo(_0x3d6440,_0x1dfb3d)[_0x2761d0(0x165)](_0x543515);}else return log(_0x2761d0(0x1a6),_0x16cfcb),addScrapeLog(path[_0x2761d0(0xed)](workerData['path']),'API_DETAIL','','','FAIL',i18n['__'](_0x2761d0(0xcf))),_0x44c4c5();}})['catch'](_0xac1760=>{const _0x4ab9f0=_0x2f15e6;return log(_0x4ab9f0(0x10c),_0xac1760),_0x44c4c5();});});}function returnResult(){const _0x5ea84=_0x39f310;log(_0x5ea84(0x147)),parentPort['postMessage']({'code':0x0}),process[_0x5ea84(0x13a)](0x0);}function log(_0x52d42d){const _0x34861d=_0x39f310;parentPort[_0x34861d(0x18b)]({'type':_0x34861d(0x116),'message':_0x52d42d});}if(workerData&&workerData[_0x39f310(0x10a)]&&workerData[_0x39f310(0x13e)]&&workerData[_0x39f310(0x17a)]&&workerData[_0x39f310(0xf3)]&&workerData[_0x39f310(0xec)]){if(workerData[_0x39f310(0xe2)])log('根据TMDBID搜索'),onSearchFinish(workerData,workerData[_0x39f310(0xe2)])[_0x39f310(0x165)](_0x3a9333=>{const _0x53dbd1=_0x39f310;log(_0x53dbd1(0x1a7),workerData['tmdb_id'],workerData[_0x53dbd1(0x13e)],workerData['filename']),returnResult();})[_0x39f310(0xf6)](_0x437ba5=>{returnResult();});else{if(workerData[_0x39f310(0x14b)]==0x1){log(_0x39f310(0x197));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId['tmdbId']){addScrapeLog(path[_0x39f310(0xed)](workerData[_0x39f310(0x13e)]),_0x39f310(0x122),'','','FAIL',i18n['__'](_0x39f310(0x1ac)));return;}let tmdbId=foundTmdbId[_0x39f310(0x12a)];onSearchFinish(workerData,tmdbId,!![])[_0x39f310(0x165)](_0x27997e=>{const _0x1d95f4=_0x39f310;log(_0x1d95f4(0x1a7)),returnResult();})[_0x39f310(0xf6)](_0x851948=>{returnResult();});}else log(_0x39f310(0xd0)),searchMovieInfo(workerData)[_0x39f310(0x165)](_0x30edfd=>{const _0x10bddc=_0x39f310;log(_0x10bddc(0x1a7)+workerData['path']+'\x20'+workerData['filename']),returnResult();})['catch'](_0x4e767a=>{returnResult();});}}else log(_0x39f310(0x108)),returnResult();