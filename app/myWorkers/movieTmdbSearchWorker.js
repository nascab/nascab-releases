const _0x8cf56e=_0x2205;(function(_0x59912c,_0x40439d){const _0x5d8d62=_0x2205,_0x252ec9=_0x59912c();while(!![]){try{const _0x452b5b=-parseInt(_0x5d8d62(0x175))/0x1*(parseInt(_0x5d8d62(0xc5))/0x2)+-parseInt(_0x5d8d62(0x13b))/0x3*(-parseInt(_0x5d8d62(0x129))/0x4)+parseInt(_0x5d8d62(0x104))/0x5+parseInt(_0x5d8d62(0xad))/0x6*(-parseInt(_0x5d8d62(0xda))/0x7)+-parseInt(_0x5d8d62(0xdc))/0x8+-parseInt(_0x5d8d62(0x137))/0x9+-parseInt(_0x5d8d62(0x92))/0xa*(-parseInt(_0x5d8d62(0xf7))/0xb);if(_0x452b5b===_0x40439d)break;else _0x252ec9['push'](_0x252ec9['shift']());}catch(_0x13cf45){_0x252ec9['push'](_0x252ec9['shift']());}}}(_0x4092,0x975ab));const {XMLParser,XMLBuilder}=require(_0x8cf56e(0x157)),path=require(_0x8cf56e(0xe9));let axios=require(_0x8cf56e(0xbe));const {HttpsProxyAgent}=require(_0x8cf56e(0xd2)),https=require(_0x8cf56e(0x151)),{URL}=require(_0x8cf56e(0x106)),fs=require('fs'),movieSeasonUtil=require(_0x8cf56e(0x9d)),mediaTypeConfig=require(_0x8cf56e(0xea)),{parentPort,workerData}=require('worker_threads'),movieInfoTmdbApi=require(_0x8cf56e(0xd5)),dbConfigTable=require(_0x8cf56e(0xfc)),nfoUtil=require(_0x8cf56e(0xba)),Database=require(_0x8cf56e(0x8d)),config=require(_0x8cf56e(0x87)),dbFileIndex=new Database(config[_0x8cf56e(0x98)],{'timeout':0xea60});dbFileIndex['pragma'](_0x8cf56e(0x162));let dbOther=new Database(config[_0x8cf56e(0xc4)],{});dbOther[_0x8cf56e(0xeb)](_0x8cf56e(0x162));let i18nUtil=require(_0x8cf56e(0x153));i18n=i18nUtil[_0x8cf56e(0x169)](dbOther);let excludeList=[_0x8cf56e(0x146),_0x8cf56e(0xcf),_0x8cf56e(0x10c),_0x8cf56e(0x138),'hd1080p',_0x8cf56e(0x15f),_0x8cf56e(0x120),_0x8cf56e(0xa3),'x264',_0x8cf56e(0xcb),_0x8cf56e(0x132),_0x8cf56e(0xc6),'nexusnf',_0x8cf56e(0xce),'brrip',_0x8cf56e(0x13d),_0x8cf56e(0x159),_0x8cf56e(0x13f),_0x8cf56e(0x156),_0x8cf56e(0xfe),'7audio',_0x8cf56e(0x154),_0x8cf56e(0x172),'5audios',_0x8cf56e(0xe3),'7audios',_0x8cf56e(0x103),_0x8cf56e(0x113),'remastered',_0x8cf56e(0x14b),_0x8cf56e(0x158),_0x8cf56e(0x15c),_0x8cf56e(0xf3),'10bit',_0x8cf56e(0x8b),_0x8cf56e(0xd9),_0x8cf56e(0xb1),_0x8cf56e(0x8a),'hd',_0x8cf56e(0x174),_0x8cf56e(0xe6),_0x8cf56e(0x16d),_0x8cf56e(0x12f),_0x8cf56e(0x147),_0x8cf56e(0x17a),'cmct',_0x8cf56e(0x10a),'ma',_0x8cf56e(0x12d),'dv',_0x8cf56e(0xb8),_0x8cf56e(0x109),_0x8cf56e(0x177),_0x8cf56e(0x15c),_0x8cf56e(0x96),_0x8cf56e(0xac),_0x8cf56e(0x163),_0x8cf56e(0xa7),_0x8cf56e(0xdb),_0x8cf56e(0xbf),_0x8cf56e(0x111),'atmos-iamable',_0x8cf56e(0x14a),_0x8cf56e(0x14e),_0x8cf56e(0x11d),_0x8cf56e(0x93),_0x8cf56e(0x12c),'atmos','uhd',_0x8cf56e(0x89),_0x8cf56e(0x15a),_0x8cf56e(0x13a),_0x8cf56e(0xb4),'blue-ray',_0x8cf56e(0x102),_0x8cf56e(0xd3),_0x8cf56e(0xbc),_0x8cf56e(0xa5),_0x8cf56e(0x135),_0x8cf56e(0x9c),_0x8cf56e(0x179),'rm','mov',_0x8cf56e(0xa1),_0x8cf56e(0xc6),_0x8cf56e(0xb6),_0x8cf56e(0x160),_0x8cf56e(0xf4),_0x8cf56e(0x134),_0x8cf56e(0x13c),_0x8cf56e(0xb5),_0x8cf56e(0x107),'高清版',_0x8cf56e(0x117),_0x8cf56e(0x128),'高清晰版',_0x8cf56e(0xef),'英文中字',_0x8cf56e(0xaa),_0x8cf56e(0xae),'dl','-',_0x8cf56e(0x143),_0x8cf56e(0x117),_0x8cf56e(0xe0),_0x8cf56e(0xe5),_0x8cf56e(0xca)];function isObjectInQueryArray(_0x5b5637,_0x494e99){return _0x5b5637['some'](function(_0x275d6f){const _0x4105a1=_0x2205,_0x4e29d9=Object[_0x4105a1(0x11a)](_0x494e99);return _0x4e29d9[_0x4105a1(0xcc)](_0x5d6bba=>_0x275d6f[_0x5d6bba]===_0x494e99[_0x5d6bba]);});}function getQueryArray(_0x546293){const _0x5a0d7b=_0x8cf56e;let _0x330bf4=[];if(!_0x546293||!_0x546293['filename'])return[];let _0x4359f3=_0x546293[_0x5a0d7b(0xbb)][_0x5a0d7b(0xec)]();if(!_0x4359f3||_0x4359f3[_0x5a0d7b(0xab)]<0x2)return[];function _0xc9f905(_0x39bfb1,_0x1aebb5){const _0x26eae0=_0x5a0d7b;let _0x5765d2={'title':_0x39bfb1,'year':_0x1aebb5};_0x39bfb1!='STREAM'&&!isObjectInQueryArray(_0x330bf4,_0x5765d2)&&_0x330bf4[_0x26eae0(0xa6)](_0x5765d2);}function _0x3ff687(_0x54f698){const _0x564201=_0x5a0d7b;let _0x1e7776=path[_0x564201(0x168)](_0x54f698);_0x1e7776&&(_0x54f698=_0x54f698[_0x564201(0x173)](_0x1e7776,''));if(/^[0-9]*$/[_0x564201(0xed)](_0x54f698)&&_0x54f698!='1942'&&!_0x54f698[_0x564201(0xdd)]('0000'))return[];if(_0x54f698[_0x564201(0xdd)](_0x564201(0x112))||_0x54f698[_0x564201(0xdd)](_0x564201(0xfd))||_0x54f698[_0x564201(0xdd)]('VID')||_0x54f698[_0x564201(0xdd)]('vid')||_0x54f698['startsWith'](_0x564201(0xf8))||_0x54f698['startsWith'](_0x564201(0xb2))||_0x54f698[_0x564201(0xdd)](_0x564201(0x11c)))return[];_0x54f698[_0x54f698[_0x564201(0xab)]-0x1]=='.'&&(_0x54f698=_0x54f698[_0x564201(0x9b)](0x0,_0x54f698['length']-0x1));_0x54f698=_0x54f698[_0x564201(0x173)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')[_0x564201(0x173)](_0x564201(0x16a),'')['replace']('7.1',''),_0x54f698=_0x54f698[_0x564201(0x173)](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')[_0x564201(0x173)](/[ ]+/gi,'\x20');let _0x42947d=_0x54f698[_0x564201(0x149)]('\x20'),_0x33045b=[],_0x56053e=null;for(let _0x3bcbb in _0x42947d){let _0x331c13=_0x42947d[_0x3bcbb][_0x564201(0xb7)]();if(excludeList['includes'](_0x331c13))continue;if(isNumber(_0x331c13)){if(parseInt(_0x331c13)>0x767&&parseInt(_0x331c13)<0x834){_0x56053e=_0x331c13;continue;}}_0x33045b[_0x564201(0xa6)](_0x331c13);}for(let _0x91f524=_0x33045b[_0x564201(0xab)];_0x91f524>=0x0;_0x91f524--){let _0xf239a5=_0x33045b[_0x564201(0x144)]('\x20')[_0x564201(0xb7)]();_0xf239a5&&(_0x56053e&&_0xc9f905(_0xf239a5,_0x56053e),_0xc9f905(_0xf239a5)),_0x33045b[_0x564201(0x97)](_0x33045b[_0x564201(0xab)]-0x1,0x1);}}if(_0x546293[_0x5a0d7b(0xf0)]==0x1)try{let _0x10d45e=path['basename'](_0x546293[_0x5a0d7b(0xe9)])[_0x5a0d7b(0x176)](),_0x223e44=movieSeasonUtil['getSeasonNumber'](_0x10d45e);if(_0x223e44>-0x1){let _0x293ec8=path[_0x5a0d7b(0xf9)](path[_0x5a0d7b(0x165)](_0x546293[_0x5a0d7b(0xe9)]))['toLocaleLowerCase']();_0x293ec8&&_0x3ff687(_0x293ec8);}else _0x3ff687(_0x10d45e);}catch(_0x25f30e){console[_0x5a0d7b(0x100)](_0x25f30e);}const _0x9ca203=_0x4359f3['replace'](/s\d{1,2}e\d{1,2}/g,'');return _0x3ff687(_0x9ca203),_0x330bf4;}function isNumber(_0x3489e7){const _0x5989b3=_0x8cf56e;return/^-?[\d.]+(?:e-?\d+)?$/[_0x5989b3(0xed)](_0x3489e7);}function getTmdbApi(){const _0x3d14fe=_0x8cf56e;let _0x19bb7b=dbConfigTable[_0x3d14fe(0xb3)](dbOther,'tmdbProxyEnable'),_0x41814f=null;if(_0x19bb7b&&_0x19bb7b['value']==0x1){let _0x1be436=dbConfigTable[_0x3d14fe(0xb3)](dbOther,_0x3d14fe(0xc3));_0x1be436&&_0x1be436[_0x3d14fe(0xdf)]&&(_0x41814f=_0x1be436['value']),log(_0x3d14fe(0x124)+_0x41814f);}return tmdbApiObj=new movieInfoTmdbApi[(_0x3d14fe(0x122))](workerData[_0x3d14fe(0x142)],workerData['tmdb_api_language'],workerData[_0x3d14fe(0xcd)],_0x41814f),tmdbApiObj;}function getProxyUrl(_0x13f191){const _0x10fe5d=_0x8cf56e;let _0x1410a5=dbConfigTable['findByTitle'](_0x13f191,_0x10fe5d(0x114)),_0x3d4d9e=null;if(_0x1410a5&&_0x1410a5[_0x10fe5d(0xdf)]==0x1){let _0x2a4a95=dbConfigTable[_0x10fe5d(0xb3)](_0x13f191,_0x10fe5d(0xc3));_0x2a4a95&&_0x2a4a95[_0x10fe5d(0xdf)]&&(_0x3d4d9e=_0x2a4a95['value']);}return _0x3d4d9e;}function _0x4092(){const _0x305ba2=['39SFsGGy','chs-eng','3audio','isFile','hdwing','tmdb_api_language','stat','tmdb_api_key','中文字幕','join','getDetail','阳光电影dygod.org','swtyblz','不符合三级命名规则:','split','atmos-coaster','internal','showtitle','hostname','eng','statSync','API_DETAIL','https','INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)','../utils/i18nUtil','3audios','actorsOriginal','5audio','fast-xml-parser','hds','4audio','remux','season海报和nfo保存完毕','fgt','episode','.tmp','1080p','2audios','actors','journal_mode\x20=\x20WAL','x265','-poster.jpg','dirname','seasons','cover_url','extname','getI18n','5.1','信息获取完毕','没有季信息\x20默认使用第一季','dts','finish','guestActorsOriginal','seasonInfo没找到每一集的信息','season.season_number:','4audios','replace','dts-ift','928627FUrjCK','toLocaleLowerCase','surcode','now','rmvb','iamable','saveNfoFile','../myConfig/config','episode_number','bdrip','hdr','8bit','year','better-sqlite3','getSeasonNumber','请求失败:\x20HTTP\x20','season','pathname','57740vIkcJU','ita','开始下载','根据已有NFO刮削缺失集','web-dl','splice','dbFileIndex','noSearchResult','directors','substr','mp4','../utils/movieSeasonUtil','title','开始保存每一集的信息','includes','3gp','genres','720p','电影的海报和nfo保存完毕','h265','push','dvsux','根据TMDBID搜索','postMessage','西语中字','length','x265-dvsux','6QnCzzd','beitai','ERROR','videoTypeList','hdr10','vid_','findByTitle','hdtv','ac3','tbs','trim','ddp','API_SEASON_DETAIL','../utils/nfoUtil','filename','h264','backdrop_url','axios','4ktrash','scrapeMissing','directorsOriginal','episodes','tmdbProxyUrl','dbOther','2WkgUGa','web','fanart.jpg','符合三级命名规则:','跳过不缺失任何信息的季','高清mp4电影','480p','every','tmdb_api_url','x265-terminal','dolby-multi-bodhmall','根据文件名和路径搜索','regions','hpagent','ultra-hd','nfo不存在,开始保存','../utils/movieInfoTmdbApi','then','movie','extractEpisodeNumbers','sdr','3804829jeNAbu','x260bit','1639544eSpyyX','startsWith','tmdb_id','value','韩语中字','exit','status_message','6audios','search','日语中字','dts-hd','lastIndexOf','信息不足\x20无法搜索\x20退出worker','path','../myConfig/mediaType','pragma','toLowerCase','test','跳过保存NFO:','英语中字','is_tvplay','season_number','parse','truehd','aac','run','下载fanart:','1012DLfOLs','VID_','basename','get','getSeasonDetail','../db/dbConfigTable','img_','6audio','.jpg','log','NFO','ultrahd','cee','4153585Voiyyd','allSettled','url','dreamhd','tvshow','cmrg','coaster','SUCCESS','2160p','existsSync','creator','poster.jpg','catch','atmos-swtyblz','IMG_','hevc','tmdbProxyEnable','TMDB\x20api实例获取失败\x20请检查TMDB相关配置','SCRAPE_MISSING','电影天堂','movie_name','readdirSync','keys','readdir','IMG','nahom','FAIL','POSTER','bd720p','episodedetails','API','statusCode','Search\x20Worker:Tmdb代理已经开启','substring','tmdbidNotFound','createWriteStream','阳光电影','328036QpGbjm','-fanart.jpg','creatorOriginal','265-apex','bhd','刮削任务结束','rargb','tmdbid','port','240p','error','dvd','mkv','.nfo','1178802eSKOCP','bd1080p','tvshow.nfo','bluray'];_0x4092=function(){return _0x305ba2;};return _0x4092();}function downloadPoster(_0x295443,_0x5cfdcf){return new Promise((_0x4c55ba,_0x4fb0da)=>{const _0x58e38b=_0x2205;fs[_0x58e38b(0x141)](_0x295443,(_0x3b8002,_0x1bae05)=>{const _0xccdea2=_0x58e38b;if(_0x3b8002){console[_0xccdea2(0x100)](_0xccdea2(0x94),_0x5cfdcf);let _0x4c3371=getProxyUrl(dbOther),_0x236695=null;_0x4c3371&&(_0x236695=new HttpsProxyAgent({'proxy':_0x4c3371}));const _0x3c960c=new URL(_0x5cfdcf);https[_0xccdea2(0xfa)]({'hostname':_0x3c960c[_0xccdea2(0x14d)],'port':_0x3c960c[_0xccdea2(0x131)]||0x1bb,'path':_0x3c960c[_0xccdea2(0x91)]+_0x3c960c[_0xccdea2(0xe4)],'agent':_0x236695?_0x236695:![]},_0x281f48=>{const _0x5a0221=_0xccdea2;if(_0x281f48['statusCode']!==0xc8)return console['error'](_0x5a0221(0x8f)+_0x281f48[_0x5a0221(0x123)]),addScrapeLog(path[_0x5a0221(0x144)](workerData[_0x5a0221(0xe9)]),_0x5a0221(0x11f),'',_0x295443,'FAIL'),_0x4c55ba('');let _0x460c58=_0x295443+_0x5a0221(0x15e),_0x4ce64e=fs[_0x5a0221(0x127)](_0x460c58);_0x281f48['pipe'](_0x4ce64e),_0x4ce64e['on'](_0x5a0221(0x16e),()=>{fs['rename'](_0x460c58,_0x295443,_0xef3bc5=>{const _0x466b60=_0x2205;if(_0xef3bc5)return _0x4c55ba('');addScrapeLog(path[_0x466b60(0x144)](workerData[_0x466b60(0xe9)]),_0x466b60(0x11f),'',_0x295443,_0x466b60(0x10b)),_0x4c55ba(_0x295443);});}),_0x4ce64e['on'](_0x5a0221(0x133),_0x75229e=>{const _0x506bac=_0x5a0221;console[_0x506bac(0x100)](_0x75229e),addScrapeLog(path[_0x506bac(0x144)](workerData[_0x506bac(0xe9)]),_0x506bac(0x11f),'',_0x295443,'FAIL'),_0x4c55ba('');}),_0x4ce64e['on']('close',()=>{});})['on'](_0xccdea2(0x133),_0x4be803=>{_0x4c55ba('');});}else _0x4c55ba(_0x295443);});});}function downloadPosterAndSaveNfo(_0x8ed00d,_0x3b95dc,_0x2f9237,_0x1bc31f,_0x1819c3,_0x2d0b77,_0x2ece60){return new Promise((_0x2c048e,_0x24d02e)=>{const _0x17316e=_0x2205;let _0x411a34=[];_0x3b95dc&&_0x8ed00d&&(!_0x2ece60||_0x2ece60&&!fs[_0x17316e(0x10d)](_0x8ed00d)?_0x411a34[_0x17316e(0xa6)](downloadPoster(_0x8ed00d,_0x3b95dc)):log('跳过保存海报:'+_0x8ed00d)),_0x2f9237&&_0x1bc31f&&(!_0x2ece60||_0x2ece60&&!fs['existsSync'](_0x1bc31f)?(console[_0x17316e(0x100)](_0x17316e(0xd4),_0x1bc31f,_0x2ece60),addScrapeLog(path[_0x17316e(0x144)](workerData[_0x17316e(0xe9)]),_0x17316e(0x101),_0x1bc31f,'',_0x17316e(0x10b)),_0x411a34[_0x17316e(0xa6)](nfoUtil[_0x17316e(0x86)](_0x2f9237,_0x1bc31f,_0x1819c3))):log(_0x17316e(0xee)+_0x1bc31f)),_0x2f9237['backdrop_url']&&_0x2d0b77&&(!_0x2ece60||_0x2ece60&&!fs[_0x17316e(0x10d)](_0x2d0b77)?(log(_0x17316e(0xf6)+_0x2d0b77),_0x411a34[_0x17316e(0xa6)](downloadPoster(_0x2d0b77,_0x2f9237[_0x17316e(0xbd)]))):log('跳过保存fanart:'+_0x2d0b77)),Promise[_0x17316e(0x105)](_0x411a34)['then'](_0x41d2e1=>{_0x2c048e();});});}function saveEpisodeInfo(_0x5d32f5,_0x3bd57f,_0x4a7feb,_0x426a04,_0x40d5ea){return new Promise((_0x4479ec,_0x468b2c)=>{const _0x232546=_0x2205;if(!mediaTypeConfig[_0x232546(0xb0)][_0x232546(0xa0)](path[_0x232546(0x168)](_0x4a7feb)['toLowerCase']()))return log('跳过非视频文件:'+_0x4a7feb),_0x4479ec();if(!_0x3bd57f[_0x232546(0xc2)]||_0x3bd57f[_0x232546(0xc2)][_0x232546(0xab)]<0x1)return log(_0x232546(0x170)),_0x4479ec();let _0x496c46;for(let _0x5cee2d of _0x3bd57f[_0x232546(0xc2)]){if(_0x5cee2d[_0x232546(0x88)]==_0x426a04){_0x496c46=_0x5cee2d;break;}}if(!_0x496c46)return log('没有找到要保存的集信息\x20对应号码:'+_0x426a04),_0x4479ec();_0x3bd57f[_0x232546(0xf1)]&&(_0x496c46[_0x232546(0x90)]=_0x3bd57f[_0x232546(0xf1)]);_0x496c46['episode']=_0x426a04;let {dir:_0x677d6,name:_0x2421c5}=path['parse'](path['join'](_0x5d32f5,_0x4a7feb)),_0x29a0bd=path[_0x232546(0x144)](_0x677d6,_0x2421c5)+'.jpg',_0x366545=path[_0x232546(0x144)](_0x677d6,_0x2421c5)+'.nfo';downloadPosterAndSaveNfo(_0x29a0bd,_0x496c46[_0x232546(0x167)],_0x496c46,_0x366545,_0x232546(0x121),null,_0x40d5ea)[_0x232546(0xd6)](_0x403c80=>{_0x4479ec();});});}function detectIsMissingEpisodeInfo(_0xc4e67a){const _0xf7dee7=_0x8cf56e;let _0x459501=fs[_0xf7dee7(0x119)](_0xc4e67a),_0x3863cd=![];for(let _0x5bee5e of _0x459501){let _0x53ecf9=path[_0xf7dee7(0x168)](_0x5bee5e)?path[_0xf7dee7(0x168)](_0x5bee5e)[_0xf7dee7(0xec)]():null;if(_0x53ecf9&&config[_0xf7dee7(0xb0)][_0xf7dee7(0xa0)](_0x53ecf9)){let _0x2f64bb=_0x5bee5e[_0xf7dee7(0x125)](0x0,_0x5bee5e[_0xf7dee7(0xe7)]('.')),_0x4582a7=path['join'](_0xc4e67a,_0x2f64bb+'.nfo');if(!fs['existsSync'](_0x4582a7))return console[_0xf7dee7(0x100)]('缺失:'+_0x4582a7),_0x3863cd=!![],_0x3863cd;}}return _0x3863cd;}function saveSeasonInfo(_0x16cce1,_0x460699,_0x17d065,_0x70b621,_0x3d8b30){return new Promise((_0x144f66,_0x4abd4a)=>{const _0x551772=_0x2205;if(!_0x460699['seasons']||_0x460699[_0x551772(0x166)][_0x551772(0xab)]<0x1)return log('seriesInfo没找到季信息'),_0x144f66();let _0x5f597d;for(let _0x226ea0 of _0x460699[_0x551772(0x166)]){log(_0x551772(0x171)+_0x226ea0['season_number']);if(_0x226ea0[_0x551772(0xf1)]==_0x17d065){_0x5f597d=_0x226ea0;break;}}if(!_0x5f597d)return log('没有找到要保存的季信息\x20对应号码:'+_0x17d065),_0x144f66();let _0x2bd364,_0x236365,_0x52f300,_0x30c63b;if(_0x70b621){let _0x8e9657=_0x17d065+'';if(_0x17d065<0xa)_0x8e9657='0'+_0x17d065;_0x2bd364=path['join'](path[_0x551772(0x165)](_0x16cce1),'season'+_0x8e9657+_0x551772(0x164)),_0x52f300=path[_0x551772(0x144)](_0x16cce1,'season.nfo'),_0x30c63b=path['join'](path['dirname'](_0x16cce1),'fanart.jpg');}else _0x2bd364=path[_0x551772(0x144)](_0x16cce1,_0x551772(0x10f)),_0x52f300=path[_0x551772(0x144)](_0x16cce1,_0x551772(0x139)),_0x30c63b=path[_0x551772(0x144)](_0x16cce1,_0x551772(0xc7)),!_0x5f597d['backdrop_url']&&(_0x5f597d[_0x551772(0xbd)]=_0x460699['backdrop_url']);!_0x5f597d[_0x551772(0x167)]&&(_0x5f597d[_0x551772(0x167)]=_0x460699[_0x551772(0x167)]),_0x5f597d['season']=_0x17d065,_0x460699[_0x551772(0x118)]&&_0x5f597d[_0x551772(0x118)]&&(_0x5f597d['showtitle']=_0x460699[_0x551772(0x118)]+'\x20'+_0x5f597d[_0x551772(0x118)],_0x5f597d[_0x551772(0x118)]=_0x5f597d[_0x551772(0x14c)]),_0x460699[_0x551772(0x161)]&&!_0x5f597d[_0x551772(0x161)]&&(_0x5f597d[_0x551772(0x161)]=_0x460699[_0x551772(0x161)]),_0x460699['actorsOriginal']&&!_0x5f597d[_0x551772(0x155)]&&(_0x5f597d['actorsOriginal']=_0x460699[_0x551772(0x155)]),_0x460699[_0x551772(0x9a)]&&!_0x5f597d[_0x551772(0x9a)]&&(_0x5f597d[_0x551772(0x9a)]=_0x460699[_0x551772(0x9a)]),_0x460699['directorsOriginal']&&!_0x5f597d['directorsOriginal']&&(_0x5f597d[_0x551772(0xc1)]=_0x460699[_0x551772(0xc1)]),_0x460699[_0x551772(0x10e)]&&!_0x5f597d[_0x551772(0x10e)]&&(_0x5f597d[_0x551772(0x10e)]=_0x460699['creator']),_0x460699['creatorOriginal']&&!_0x5f597d[_0x551772(0x12b)]&&(_0x5f597d[_0x551772(0x12b)]=_0x460699[_0x551772(0x12b)]),_0x460699['guestActorsOriginal']&&!_0x5f597d[_0x551772(0x16f)]&&(_0x5f597d[_0x551772(0x16f)]=_0x460699[_0x551772(0x16f)]),_0x460699[_0x551772(0xa2)]&&!_0x5f597d[_0x551772(0xa2)]&&(_0x5f597d[_0x551772(0xa2)]=_0x460699['genres']),_0x460699[_0x551772(0xd1)]&&!_0x5f597d[_0x551772(0xd1)]&&(_0x5f597d[_0x551772(0xd1)]=_0x460699['regions']),_0x460699[_0x551772(0xde)]&&(_0x5f597d['tmdb_id']=_0x460699['tmdb_id']),downloadPosterAndSaveNfo(_0x2bd364,_0x5f597d['cover_url'],_0x5f597d,_0x52f300,_0x551772(0x108),_0x30c63b,_0x3d8b30)[_0x551772(0xd6)](_0x5c9766=>{const _0x6b02ed=_0x551772;log(_0x6b02ed(0x15b));if(!_0x460699['tmdb_id'])return _0x144f66();if(_0x3d8b30&&!detectIsMissingEpisodeInfo(_0x16cce1))return log(_0x6b02ed(0xc9)),_0x144f66();let _0x49f7d0=getTmdbApi();_0x49f7d0[_0x6b02ed(0xfb)](_0x460699['tmdb_id'],_0x17d065)[_0x6b02ed(0xd6)](_0x1f86d7=>{const _0x198481=_0x6b02ed;log(_0x198481(0x9f)),fs[_0x198481(0x11b)](_0x16cce1,(_0x338165,_0x202dc2)=>{const _0x1dbe0c=_0x198481;if(_0x338165)return _0x144f66();let _0x563408=[];for(let _0x1f44e7 of _0x202dc2){try{let _0x15464b=path[_0x1dbe0c(0x144)](_0x16cce1,_0x1f44e7),_0x321f22=fs[_0x1dbe0c(0x14f)](_0x15464b);if(_0x321f22[_0x1dbe0c(0x13e)]()){let _0x33b464=movieSeasonUtil['extractEpisodeNumbers'](_0x1f44e7);_0x33b464&&_0x33b464[_0x1dbe0c(0x15d)]&&_0x33b464['episode']>0x0&&_0x563408[_0x1dbe0c(0xa6)](saveEpisodeInfo(_0x16cce1,_0x1f86d7,_0x1f44e7,_0x33b464[_0x1dbe0c(0x15d)],_0x3d8b30));}}catch(_0x2c9097){log(_0x2c9097);continue;}}Promise[_0x1dbe0c(0x105)](_0x563408)[_0x1dbe0c(0xd6)](_0x192b16=>{_0x144f66();});});})['catch'](_0x274c49=>{const _0x3857ff=_0x6b02ed;return log(_0x274c49),addScrapeLog(path['join'](workerData[_0x3857ff(0xe9)]),_0x3857ff(0xb9),'','',_0x3857ff(0x11e),_0x274c49[_0x3857ff(0xe2)]?_0x274c49[_0x3857ff(0xe2)]:_0x3857ff(0xaf)),_0x144f66();});});});}function onSearchFinish(_0x145c77,_0x599294,_0x32501d){return new Promise((_0x1efd2f,_0x43bad6)=>{const _0x397a54=_0x2205;let _0x6da305=path[_0x397a54(0x144)](_0x145c77[_0x397a54(0xe9)],_0x145c77[_0x397a54(0xbb)]),_0x96be42=_0x145c77[_0x397a54(0xf0)]==0x1,_0x238baf=getTmdbApi();_0x238baf[_0x397a54(0x145)](_0x599294,_0x96be42)[_0x397a54(0xd6)](_0x2ddfc7=>{const _0x151d6b=_0x397a54;if(!_0x96be42){let {dir:_0x193b22,name:_0x4bc2c9}=path[_0x151d6b(0xf2)](_0x6da305),_0x3eced6=path[_0x151d6b(0x144)](_0x193b22,_0x4bc2c9+_0x151d6b(0xff)),_0x2aba41=_0x2ddfc7[_0x151d6b(0x167)],_0x472872=path[_0x151d6b(0x144)](_0x193b22,_0x4bc2c9+_0x151d6b(0x136)),_0x473f9c=path[_0x151d6b(0x144)](_0x193b22,_0x4bc2c9+_0x151d6b(0x12a));downloadPosterAndSaveNfo(_0x3eced6,_0x2aba41,_0x2ddfc7,_0x472872,_0x151d6b(0xd7),_0x473f9c,_0x32501d)[_0x151d6b(0xd6)](_0x543561=>{const _0x477f0f=_0x151d6b;return log(_0x477f0f(0xa4)),_0x1efd2f();});}else{let _0x428d28=movieSeasonUtil['getSeasonNumber'](path['basename'](_0x145c77[_0x151d6b(0xe9)]));if(_0x428d28>-0x1){log(_0x151d6b(0xc8)+_0x6da305);let {dir:_0xdb5fed,name:_0x4f81d6}=path[_0x151d6b(0xf2)](_0x6da305),_0x48bd2c=path[_0x151d6b(0x144)](path[_0x151d6b(0x165)](_0xdb5fed),_0x151d6b(0x10f)),_0x171bff=path[_0x151d6b(0x144)](path[_0x151d6b(0x165)](_0xdb5fed),_0x151d6b(0xc7)),_0x4b9f25=path[_0x151d6b(0x144)](path[_0x151d6b(0x165)](_0xdb5fed),_0x151d6b(0x139));downloadPosterAndSaveNfo(_0x48bd2c,_0x2ddfc7[_0x151d6b(0x167)],_0x2ddfc7,_0x4b9f25,'tvshow',_0x171bff,_0x32501d)[_0x151d6b(0xd6)](_0x25c43b=>{log('整部剧的海报和nfo保存完毕'),fs['readdir'](path['dirname'](_0xdb5fed),(_0x58566e,_0x578e83)=>{const _0x25b740=_0x2205;if(_0x58566e)return _0x1efd2f();let _0x2199c9=[];for(let _0x3febed of _0x578e83){try{let _0x41a5d3=path[_0x25b740(0x144)](path[_0x25b740(0x165)](_0xdb5fed),_0x3febed),_0x3f08e4=fs['statSync'](_0x41a5d3);if(_0x3f08e4['isDirectory']()){let _0x2bf971=movieSeasonUtil[_0x25b740(0x8e)](_0x3febed);_0x2bf971>-0x1&&_0x2199c9[_0x25b740(0xa6)](saveSeasonInfo(_0x41a5d3,_0x2ddfc7,_0x2bf971,!![],_0x32501d));}}catch(_0x145f11){log(_0x145f11);continue;}}Promise[_0x25b740(0x105)](_0x2199c9)[_0x25b740(0xd6)](_0x36fb9a=>{_0x1efd2f();});});});}else{log(_0x151d6b(0x148)+_0x6da305);let _0x5484c=movieSeasonUtil['getSeasonNumber'](path[_0x151d6b(0xf9)](_0x145c77['path']),![]);if(_0x5484c>-0x1)saveSeasonInfo(path['dirname'](_0x6da305),_0x2ddfc7,_0x5484c,![],_0x32501d)[_0x151d6b(0xd6)](_0x1d8b88=>{_0x1efd2f();});else{let _0x34ac87=movieSeasonUtil[_0x151d6b(0xd8)](_0x6da305);_0x34ac87&&_0x34ac87[_0x151d6b(0x90)]&&_0x34ac87['season']>0x0?saveSeasonInfo(path[_0x151d6b(0x165)](_0x6da305),_0x2ddfc7,_0x34ac87[_0x151d6b(0x90)],![],_0x32501d)['then'](_0xa9de66=>{_0x1efd2f();}):(log(_0x151d6b(0x16c)),saveSeasonInfo(path[_0x151d6b(0x165)](_0x6da305),_0x2ddfc7,0x1,![],_0x32501d)[_0x151d6b(0xd6)](_0x1b622b=>{_0x1efd2f();}));}}}})['catch'](_0x546f9e=>{const _0x502deb=_0x397a54;return log(_0x546f9e),addScrapeLog(path[_0x502deb(0x144)](workerData[_0x502deb(0xe9)]),_0x502deb(0x150),'','',_0x502deb(0x11e),_0x546f9e[_0x502deb(0xe2)]?_0x546f9e[_0x502deb(0xe2)]:_0x502deb(0xaf)),_0x1efd2f();});});}function addScrapeLog(_0xfc600b,_0x197910,_0x319b64,_0x429ee8,_0x346573,_0x46fcfd){const _0x49f126=_0x8cf56e;dbFileIndex['prepare'](_0x49f126(0x152))[_0x49f126(0xf5)](_0xfc600b,_0x197910,_0x319b64,_0x429ee8,_0x346573,_0x46fcfd,Date[_0x49f126(0x178)]());}function _0x2205(_0x197d4c,_0x5881e7){const _0x4092f2=_0x4092();return _0x2205=function(_0x220506,_0x4182eb){_0x220506=_0x220506-0x86;let _0x318a1e=_0x4092f2[_0x220506];return _0x318a1e;},_0x2205(_0x197d4c,_0x5881e7);}function getTvExistTmdbId(_0x80f7cf){const _0x45ee26=_0x8cf56e;if(_0x80f7cf['is_tvplay']!=0x1)return null;let _0x119563=path['dirname'](_0x80f7cf[_0x45ee26(0xe9)]),_0x300fd9=movieSeasonUtil[_0x45ee26(0x8e)](path[_0x45ee26(0xf9)](_0x80f7cf[_0x45ee26(0xe9)]),!![]),_0x3c7e44=null,_0x4676ad='';_0x300fd9>-0x1&&(_0x4676ad=path[_0x45ee26(0x144)](_0x119563,'tvshow.nfo'));(!_0x4676ad||!fs[_0x45ee26(0x10d)](_0x4676ad))&&(_0x4676ad=path['join'](_0x80f7cf[_0x45ee26(0xe9)],_0x45ee26(0x139)));if(!_0x4676ad||!fs[_0x45ee26(0x10d)](_0x4676ad))return null;const _0xbea6b2=new XMLParser();let _0x5034a0=_0xbea6b2[_0x45ee26(0xf2)](fs['readFileSync'](_0x4676ad));return _0x5034a0[_0x45ee26(0x108)]&&(_0x5034a0=_0x5034a0['tvshow'],_0x5034a0[_0x45ee26(0x130)]&&(_0x3c7e44=_0x5034a0[_0x45ee26(0x130)])),{'tmdbId':_0x3c7e44,'seassonNumber':_0x300fd9};}function searchMovieInfo(_0x53b8f7,_0x1a619d){return!_0x1a619d&&(_0x1a619d=getQueryArray(_0x53b8f7)),log(JSON['stringify'](_0x1a619d)),new Promise((_0x4b6180,_0x13ab80)=>{const _0x5ac609=_0x2205;function _0x1f191e(){return _0x13ab80();}if(!_0x1a619d||_0x1a619d[_0x5ac609(0xab)]<0x1)return log('要查询的数据不存在'),_0x1f191e();let _0x340ca4=_0x1a619d[0x0][_0x5ac609(0x9e)],_0xe8c23=_0x1a619d[0x0][_0x5ac609(0x8c)];log('Matching\x20movie\x20information\x20',_0x340ca4['title']);let _0x2429ec=getTmdbApi();if(!_0x2429ec)return log(_0x5ac609(0x115)),_0x1f191e();let _0x539971=_0x53b8f7[_0x5ac609(0xf0)]==0x1;_0x2429ec[_0x5ac609(0xe4)](_0x340ca4,_0x539971,_0xe8c23)['then'](_0x3f99ab=>{const _0x45aff9=_0x5ac609;if(_0x3f99ab&&_0x3f99ab[_0x45aff9(0xab)]>0x0){let _0x5a129f=_0x3f99ab[0x0];onSearchFinish(_0x53b8f7,_0x5a129f[_0x45aff9(0xde)])[_0x45aff9(0xd6)](()=>{return _0x4b6180();});}else{if(_0x1a619d[_0x45aff9(0xab)]>0x1){let _0x3159b7=_0x1a619d[_0x45aff9(0x97)](0x1);return searchMovieInfo(_0x53b8f7,_0x3159b7)[_0x45aff9(0xd6)](_0x4b6180);}else return log('tmdb.没有获取到相关信息',_0x340ca4),addScrapeLog(path['join'](workerData[_0x45aff9(0xe9)]),_0x45aff9(0x150),'','',_0x45aff9(0x11e),i18n['__'](_0x45aff9(0x99))),_0x1f191e();}})[_0x5ac609(0x110)](_0x513f7d=>{return log('TMDB\x20search接口请求失败',_0x513f7d),_0x1f191e();});});}function returnResult(){const _0x270f03=_0x8cf56e;log(_0x270f03(0x12e)),parentPort[_0x270f03(0xa9)]({'code':0x0}),process[_0x270f03(0xe1)](0x0);}function log(_0xaaa834){const _0xcf96d2=_0x8cf56e;parentPort[_0xcf96d2(0xa9)]({'type':_0xcf96d2(0x100),'message':_0xaaa834});}if(workerData&&workerData[_0x8cf56e(0xbb)]&&workerData[_0x8cf56e(0xe9)]&&workerData[_0x8cf56e(0x140)]&&workerData[_0x8cf56e(0x142)]&&workerData[_0x8cf56e(0xcd)]){if(workerData[_0x8cf56e(0xde)])log(_0x8cf56e(0xa8)),onSearchFinish(workerData,workerData[_0x8cf56e(0xde)])['then'](_0x37265e=>{const _0x3217d8=_0x8cf56e;log(_0x3217d8(0x16b),workerData[_0x3217d8(0xde)],workerData[_0x3217d8(0xe9)],workerData[_0x3217d8(0xbb)]),returnResult();})[_0x8cf56e(0x110)](_0x491723=>{returnResult();});else{if(workerData[_0x8cf56e(0xc0)]==0x1){log(_0x8cf56e(0x95));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId['tmdbId']){addScrapeLog(path[_0x8cf56e(0x144)](workerData[_0x8cf56e(0xe9)]),_0x8cf56e(0x116),'','','FAIL',i18n['__'](_0x8cf56e(0x126)));return;}let tmdbId=foundTmdbId['tmdbId'];onSearchFinish(workerData,tmdbId,!![])[_0x8cf56e(0xd6)](_0x57dc7a=>{const _0x3798ea=_0x8cf56e;log(_0x3798ea(0x16b)),returnResult();})[_0x8cf56e(0x110)](_0x3c3604=>{returnResult();});}else log(_0x8cf56e(0xd0)),searchMovieInfo(workerData)[_0x8cf56e(0xd6)](_0x3982d9=>{const _0x459691=_0x8cf56e;log(_0x459691(0x16b)+workerData[_0x459691(0xe9)]+'\x20'+workerData[_0x459691(0xbb)]),returnResult();})[_0x8cf56e(0x110)](_0xd11378=>{returnResult();});}}else log(_0x8cf56e(0xe8)),returnResult();