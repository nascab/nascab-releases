const _0x1bc29e=_0x1dab;function _0x1dab(_0x521c9c,_0x5bad02){const _0x27fe8d=_0x27fe();return _0x1dab=function(_0x1dab78,_0x10610e){_0x1dab78=_0x1dab78-0x1a5;let _0x284e6d=_0x27fe8d[_0x1dab78];return _0x284e6d;},_0x1dab(_0x521c9c,_0x5bad02);}(function(_0x152761,_0x2b76f1){const _0x2ab7d0=_0x1dab,_0x28bb00=_0x152761();while(!![]){try{const _0x38ce07=parseInt(_0x2ab7d0(0x20f))/0x1+parseInt(_0x2ab7d0(0x1d3))/0x2*(-parseInt(_0x2ab7d0(0x263))/0x3)+parseInt(_0x2ab7d0(0x213))/0x4+parseInt(_0x2ab7d0(0x243))/0x5*(parseInt(_0x2ab7d0(0x1bb))/0x6)+parseInt(_0x2ab7d0(0x247))/0x7+-parseInt(_0x2ab7d0(0x219))/0x8*(parseInt(_0x2ab7d0(0x234))/0x9)+-parseInt(_0x2ab7d0(0x233))/0xa*(parseInt(_0x2ab7d0(0x238))/0xb);if(_0x38ce07===_0x2b76f1)break;else _0x28bb00['push'](_0x28bb00['shift']());}catch(_0x32078d){_0x28bb00['push'](_0x28bb00['shift']());}}}(_0x27fe,0x18a2a));const {XMLParser,XMLBuilder}=require(_0x1bc29e(0x21c)),path=require('path');let axios=require(_0x1bc29e(0x261));const {HttpsProxyAgent}=require(_0x1bc29e(0x255)),https=require(_0x1bc29e(0x231)),{URL}=require(_0x1bc29e(0x25e)),fs=require('fs'),movieSeasonUtil=require('../utils/movieSeasonUtil'),mediaTypeConfig=require(_0x1bc29e(0x1da)),{parentPort,workerData}=require('worker_threads'),movieInfoTmdbApi=require(_0x1bc29e(0x1b5)),dbConfigTable=require(_0x1bc29e(0x276)),nfoUtil=require(_0x1bc29e(0x282)),Database=require(_0x1bc29e(0x20a)),config=require(_0x1bc29e(0x1bf)),dbFileIndex=new Database(config[_0x1bc29e(0x1b8)],{'timeout':0xea60});dbFileIndex[_0x1bc29e(0x22a)]('journal_mode\x20=\x20WAL');let dbOther=new Database(config[_0x1bc29e(0x287)],{});dbOther[_0x1bc29e(0x22a)]('journal_mode\x20=\x20WAL');let i18nUtil=require(_0x1bc29e(0x270));i18n=i18nUtil[_0x1bc29e(0x22f)](dbOther);let excludeList=[_0x1bc29e(0x24d),_0x1bc29e(0x218),_0x1bc29e(0x23a),_0x1bc29e(0x278),_0x1bc29e(0x26f),'1080p',_0x1bc29e(0x20b),'720p',_0x1bc29e(0x1e5),_0x1bc29e(0x1e8),'240p',_0x1bc29e(0x242),_0x1bc29e(0x236),_0x1bc29e(0x28e),'brrip','3audio','4audio','hdwing',_0x1bc29e(0x1bc),_0x1bc29e(0x21b),_0x1bc29e(0x208),_0x1bc29e(0x214),_0x1bc29e(0x1c1),_0x1bc29e(0x277),_0x1bc29e(0x1ed),_0x1bc29e(0x285),_0x1bc29e(0x1b4),'hevc',_0x1bc29e(0x1ec),'internal',_0x1bc29e(0x1e9),_0x1bc29e(0x1ce),'truehd',_0x1bc29e(0x217),_0x1bc29e(0x25d),_0x1bc29e(0x281),_0x1bc29e(0x1ad),_0x1bc29e(0x1a9),'hd',_0x1bc29e(0x23f),_0x1bc29e(0x1e0),_0x1bc29e(0x25f),_0x1bc29e(0x207),_0x1bc29e(0x20e),'iamable','cmct','coaster','ma',_0x1bc29e(0x1d5),'dv',_0x1bc29e(0x200),_0x1bc29e(0x20d),_0x1bc29e(0x256),_0x1bc29e(0x1ce),'web-dl','x265-dvsux',_0x1bc29e(0x1e6),_0x1bc29e(0x24e),_0x1bc29e(0x28d),_0x1bc29e(0x209),'atmos-swtyblz',_0x1bc29e(0x1ac),_0x1bc29e(0x269),'eng','nahom',_0x1bc29e(0x1f9),_0x1bc29e(0x271),'atmos','uhd',_0x1bc29e(0x1c6),_0x1bc29e(0x1aa),_0x1bc29e(0x239),_0x1bc29e(0x1f1),_0x1bc29e(0x1be),_0x1bc29e(0x22c),_0x1bc29e(0x23b),'h264','h265',_0x1bc29e(0x1b3),_0x1bc29e(0x205),'rmvb','rm',_0x1bc29e(0x1d9),_0x1bc29e(0x1ea),'web',_0x1bc29e(0x20c),'2audios',_0x1bc29e(0x23c),_0x1bc29e(0x262),_0x1bc29e(0x1f4),_0x1bc29e(0x223),'dreamhd',_0x1bc29e(0x244),'电影天堂',_0x1bc29e(0x1db),_0x1bc29e(0x202),'英语中字',_0x1bc29e(0x1df),_0x1bc29e(0x1c9),'beitai','dl','-','中文字幕','电影天堂',_0x1bc29e(0x1f3),_0x1bc29e(0x1f0),'高清mp4电影'];function isObjectInQueryArray(_0x528ae7,_0x2c34c1){const _0x399161=_0x1bc29e;return _0x528ae7[_0x399161(0x1b9)](function(_0x1ae723){const _0x564c63=_0x399161,_0x5b345c=Object['keys'](_0x2c34c1);return _0x5b345c[_0x564c63(0x24c)](_0x113ca2=>_0x1ae723[_0x113ca2]===_0x2c34c1[_0x113ca2]);});}function _0x27fe(){const _0x8ad013=['480p','hds','3gp','createWriteStream','remastered','6audios','creatorOriginal','tmdb_api_language','日语中字','hdtv','substr','韩语中字','chs-eng','缺失:','episode_number','isDirectory','SCRAPE_MISSING','ita','then','startsWith','value','SUCCESS','跳过保存fanart:','STREAM','ddp','actors','高清晰版','videoTypeList','port','mp4','statusCode','rargb','7audio','4ktrash','better-sqlite3','bd720p','tbs','cmrg','swtyblz','7072YNVObP','basename','tmdbId','guestActorsOriginal','370060PlrNyZ','3audios','regions','run','10bit','dolby-multi-bodhmall','825752oecIAI','season','6audio','fast-xml-parser','prepare','statSync','tmdbidNotFound','search','join','pipe','ac3','noSearchResult','fanart.jpg','directors','tvshow','replace','VID_','pragma','tvshow.nfo','ultrahd','path','API','getI18n','tmdbProxyEnable','https','1942','146350AbIFDK','9yKPyKn','exit','nexusnf','信息不足\x20无法搜索\x20退出worker','22lrxxpt','bluray','2160p','ultra-hd','aac','lastIndexOf','is_tvplay','dts-ift','length','seasonInfo没找到每一集的信息','web','100865CqjfJP','高清版','genres','没有季信息\x20默认使用第一季','979762IXZpTf','dirname','readdirSync','ERROR','findByTitle','every','阳光电影dygod.org','dvsux','includes','splice','-fanart.jpg','tmdbProxyUrl','isFile','没有找到要保存的集信息\x20对应号码:','hpagent','surcode','Matching\x20movie\x20information\x20','creator','5.1','actorsOriginal','movie','season_number','8bit','url','dts','7.1','axios','dvd','6hLEMES','get','跳过保存海报:','log','0000','now','atmos-coaster','catch','postMessage','getSeasonNumber','showtitle','.nfo','hd1080p','../utils/i18nUtil','265-apex','vid','allSettled','backdrop_url','VID','../db/dbConfigTable','5audios','bd1080p','Search\x20Worker:Tmdb代理已经开启','test','hostname','error','trim','跳过保存NFO:','根据TMDBID搜索','cover_url','sdr','../utils/nfoUtil','.jpg','substring','7audios','pathname','dbOther','tmdb_api_key','saveNfoFile','poster.jpg','tmdbid','filename','x260bit','x265-terminal','finish','API_SEASON_DETAIL','parse','season海报和nfo保存完毕','hdr','remux','.tmp','atmos-iamable','hdr10','season.nfo','根据已有NFO刮削缺失集','push','rename','toLocaleLowerCase','mkv','cee','../utils/movieInfoTmdbApi','tmdb_api_url','信息获取完毕','dbFileIndex','some','POSTER','12qFrfrj','5audio','directorsOriginal','blue-ray','../myConfig/config','tmdb_id','4audios','episode','没有找到要保存的季信息\x20对应号码:','TMDB\x20api实例获取失败\x20请检查TMDB相关配置','movie_name','bdrip','-poster.jpg','FAIL','西语中字','根据文件名和路径搜索','title','toLowerCase','不符合三级命名规则:','fgt','开始下载','img_','close','API_DETAIL','46504rozirl','符合三级命名规则:','bhd','extname','跳过不缺失任何信息的季','seasons','mov','../myConfig/mediaType','阳光电影','要查询的数据不存在','episodes','extractEpisodeNumbers','英文中字','dts-hd','IMG_','getSeasonDetail','status_message','INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)','x264','x265','existsSync'];_0x27fe=function(){return _0x8ad013;};return _0x27fe();}function getQueryArray(_0x4bf875){const _0x5789e0=_0x1bc29e;let _0x105eee=[];if(!_0x4bf875||!_0x4bf875[_0x5789e0(0x28c)])return[];let _0x2991b8=_0x4bf875[_0x5789e0(0x28c)]['toLowerCase']();if(!_0x2991b8||_0x2991b8[_0x5789e0(0x240)]<0x2)return[];function _0x6c5aed(_0x1d317b,_0xdf93b1){const _0x103472=_0x5789e0;let _0x1fa78f={'title':_0x1d317b,'year':_0xdf93b1};_0x1d317b!=_0x103472(0x1ff)&&!isObjectInQueryArray(_0x105eee,_0x1fa78f)&&_0x105eee['push'](_0x1fa78f);}function _0x3009dc(_0x42103a){const _0x18b385=_0x5789e0;let _0x130679=path[_0x18b385(0x1d6)](_0x42103a);_0x130679&&(_0x42103a=_0x42103a[_0x18b385(0x228)](_0x130679,''));if(/^[0-9]*$/['test'](_0x42103a)&&_0x42103a!=_0x18b385(0x232)&&!_0x42103a['startsWith'](_0x18b385(0x267)))return[];if(_0x42103a[_0x18b385(0x1fb)](_0x18b385(0x1e1))||_0x42103a[_0x18b385(0x1fb)](_0x18b385(0x1d0))||_0x42103a['startsWith'](_0x18b385(0x275))||_0x42103a[_0x18b385(0x1fb)](_0x18b385(0x272))||_0x42103a['startsWith'](_0x18b385(0x229))||_0x42103a[_0x18b385(0x1fb)]('vid_')||_0x42103a[_0x18b385(0x1fb)]('IMG'))return[];_0x42103a[_0x42103a[_0x18b385(0x240)]-0x1]=='.'&&(_0x42103a=_0x42103a[_0x18b385(0x1f2)](0x0,_0x42103a[_0x18b385(0x240)]-0x1));_0x42103a=_0x42103a[_0x18b385(0x228)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')[_0x18b385(0x228)](_0x18b385(0x259),'')['replace'](_0x18b385(0x260),''),_0x42103a=_0x42103a[_0x18b385(0x228)](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')[_0x18b385(0x228)](/[ ]+/gi,'\x20');let _0x1a4935=_0x42103a['split']('\x20'),_0x6997ed=[],_0x3eec9e=null;for(let _0x552bcd in _0x1a4935){let _0x1e3aff=_0x1a4935[_0x552bcd][_0x18b385(0x27d)]();if(excludeList['includes'](_0x1e3aff))continue;if(isNumber(_0x1e3aff)){if(parseInt(_0x1e3aff)>0x767&&parseInt(_0x1e3aff)<0x834){_0x3eec9e=_0x1e3aff;continue;}}_0x6997ed[_0x18b385(0x1b0)](_0x1e3aff);}for(let _0x30bf15=_0x6997ed[_0x18b385(0x240)];_0x30bf15>=0x0;_0x30bf15--){let _0x30da2f=_0x6997ed[_0x18b385(0x221)]('\x20')[_0x18b385(0x27d)]();_0x30da2f&&(_0x3eec9e&&_0x6c5aed(_0x30da2f,_0x3eec9e),_0x6c5aed(_0x30da2f)),_0x6997ed[_0x18b385(0x250)](_0x6997ed[_0x18b385(0x240)]-0x1,0x1);}}if(_0x4bf875['is_tvplay']==0x1)try{let _0x103568=path[_0x5789e0(0x210)](_0x4bf875[_0x5789e0(0x22d)])['toLocaleLowerCase'](),_0x11089d=movieSeasonUtil[_0x5789e0(0x26c)](_0x103568);if(_0x11089d>-0x1){let _0x1e9fb4=path[_0x5789e0(0x210)](path[_0x5789e0(0x248)](_0x4bf875['path']))[_0x5789e0(0x1b2)]();_0x1e9fb4&&_0x3009dc(_0x1e9fb4);}else _0x3009dc(_0x103568);}catch(_0x278b20){console[_0x5789e0(0x266)](_0x278b20);}const _0x2cdd7b=_0x2991b8[_0x5789e0(0x228)](/s\d{1,2}e\d{1,2}/g,'');return _0x3009dc(_0x2cdd7b),_0x105eee;}function isNumber(_0x219ff3){const _0x39ff5e=_0x1bc29e;return/^-?[\d.]+(?:e-?\d+)?$/[_0x39ff5e(0x27a)](_0x219ff3);}function getTmdbApi(){const _0x30b1a8=_0x1bc29e;let _0x4cb61c=dbConfigTable[_0x30b1a8(0x24b)](dbOther,_0x30b1a8(0x230)),_0x5891db=null;if(_0x4cb61c&&_0x4cb61c[_0x30b1a8(0x1fc)]==0x1){let _0x381920=dbConfigTable[_0x30b1a8(0x24b)](dbOther,_0x30b1a8(0x252));_0x381920&&_0x381920[_0x30b1a8(0x1fc)]&&(_0x5891db=_0x381920[_0x30b1a8(0x1fc)]),log(_0x30b1a8(0x279)+_0x5891db);}return tmdbApiObj=new movieInfoTmdbApi[(_0x30b1a8(0x22e))](workerData[_0x30b1a8(0x288)],workerData[_0x30b1a8(0x1ef)],workerData[_0x30b1a8(0x1b6)],_0x5891db),tmdbApiObj;}function getProxyUrl(_0x5307dd){const _0x57b7fa=_0x1bc29e;let _0xd43122=dbConfigTable[_0x57b7fa(0x24b)](_0x5307dd,_0x57b7fa(0x230)),_0x43c2a9=null;if(_0xd43122&&_0xd43122[_0x57b7fa(0x1fc)]==0x1){let _0x413502=dbConfigTable[_0x57b7fa(0x24b)](_0x5307dd,'tmdbProxyUrl');_0x413502&&_0x413502['value']&&(_0x43c2a9=_0x413502['value']);}return _0x43c2a9;}function downloadPoster(_0x16ec87,_0x2437ce){return new Promise((_0x1ee3bf,_0x2b5678)=>{fs['stat'](_0x16ec87,(_0x120b40,_0x41cc6a)=>{const _0x383ea3=_0x1dab;if(_0x120b40){console[_0x383ea3(0x266)](_0x383ea3(0x1cf),_0x2437ce);let _0x3a92df=getProxyUrl(dbOther),_0x5a2b6e=null;_0x3a92df&&(_0x5a2b6e=new HttpsProxyAgent({'proxy':_0x3a92df}));const _0x34d5bc=new URL(_0x2437ce);https[_0x383ea3(0x264)]({'hostname':_0x34d5bc[_0x383ea3(0x27b)],'port':_0x34d5bc[_0x383ea3(0x204)]||0x1bb,'path':_0x34d5bc[_0x383ea3(0x286)]+_0x34d5bc[_0x383ea3(0x220)],'agent':_0x5a2b6e?_0x5a2b6e:![]},_0xfcf263=>{const _0x3fdb49=_0x383ea3;if(_0xfcf263[_0x3fdb49(0x206)]!==0xc8)return console[_0x3fdb49(0x27c)]('请求失败:\x20HTTP\x20'+_0xfcf263[_0x3fdb49(0x206)]),addScrapeLog(path['join'](workerData[_0x3fdb49(0x22d)]),_0x3fdb49(0x1ba),'',_0x16ec87,_0x3fdb49(0x1c8)),_0x1ee3bf('');let _0x3c1c2d=_0x16ec87+_0x3fdb49(0x1ab),_0x3bdf02=fs[_0x3fdb49(0x1eb)](_0x3c1c2d);_0xfcf263[_0x3fdb49(0x222)](_0x3bdf02),_0x3bdf02['on'](_0x3fdb49(0x1a5),()=>{const _0x5e2c93=_0x3fdb49;fs[_0x5e2c93(0x1b1)](_0x3c1c2d,_0x16ec87,_0x205029=>{const _0x3ca758=_0x5e2c93;if(_0x205029)return _0x1ee3bf('');addScrapeLog(path['join'](workerData[_0x3ca758(0x22d)]),_0x3ca758(0x1ba),'',_0x16ec87,_0x3ca758(0x1fd)),_0x1ee3bf(_0x16ec87);});}),_0x3bdf02['on']('error',_0x468758=>{const _0x47b35e=_0x3fdb49;console['log'](_0x468758),addScrapeLog(path['join'](workerData[_0x47b35e(0x22d)]),_0x47b35e(0x1ba),'',_0x16ec87,'FAIL'),_0x1ee3bf('');}),_0x3bdf02['on'](_0x3fdb49(0x1d1),()=>{});})['on'](_0x383ea3(0x27c),_0x5b8f86=>{_0x1ee3bf('');});}else _0x1ee3bf(_0x16ec87);});});}function downloadPosterAndSaveNfo(_0x47ab24,_0x215e8b,_0x5f4e33,_0x571a4b,_0x5c3a66,_0x13eac4,_0x38af17){return new Promise((_0x3ffb4f,_0x46a84c)=>{const _0x536c67=_0x1dab;let _0x2c5594=[];_0x215e8b&&_0x47ab24&&(!_0x38af17||_0x38af17&&!fs['existsSync'](_0x47ab24)?_0x2c5594[_0x536c67(0x1b0)](downloadPoster(_0x47ab24,_0x215e8b)):log(_0x536c67(0x265)+_0x47ab24)),_0x5f4e33&&_0x571a4b&&(!_0x38af17||_0x38af17&&!fs[_0x536c67(0x1e7)](_0x571a4b)?(console[_0x536c67(0x266)]('nfo不存在,开始保存',_0x571a4b,_0x38af17),addScrapeLog(path['join'](workerData['path']),'NFO',_0x571a4b,'',_0x536c67(0x1fd)),_0x2c5594[_0x536c67(0x1b0)](nfoUtil[_0x536c67(0x289)](_0x5f4e33,_0x571a4b,_0x5c3a66))):log(_0x536c67(0x27e)+_0x571a4b)),_0x5f4e33[_0x536c67(0x274)]&&_0x13eac4&&(!_0x38af17||_0x38af17&&!fs[_0x536c67(0x1e7)](_0x13eac4)?(log('下载fanart:'+_0x13eac4),_0x2c5594[_0x536c67(0x1b0)](downloadPoster(_0x13eac4,_0x5f4e33[_0x536c67(0x274)]))):log(_0x536c67(0x1fe)+_0x13eac4)),Promise[_0x536c67(0x273)](_0x2c5594)[_0x536c67(0x1fa)](_0x2fc7b2=>{_0x3ffb4f();});});}function saveEpisodeInfo(_0x572843,_0x11b6a9,_0x4f282e,_0x8a56d6,_0x4c6364){return new Promise((_0x2920f7,_0x3772aa)=>{const _0x4907eb=_0x1dab;if(!mediaTypeConfig[_0x4907eb(0x203)][_0x4907eb(0x24f)](path[_0x4907eb(0x1d6)](_0x4f282e)[_0x4907eb(0x1cc)]()))return log('跳过非视频文件:'+_0x4f282e),_0x2920f7();if(!_0x11b6a9[_0x4907eb(0x1dd)]||_0x11b6a9[_0x4907eb(0x1dd)][_0x4907eb(0x240)]<0x1)return log(_0x4907eb(0x241)),_0x2920f7();let _0x2bfed2;for(let _0x160b91 of _0x11b6a9[_0x4907eb(0x1dd)]){if(_0x160b91[_0x4907eb(0x1f6)]==_0x8a56d6){_0x2bfed2=_0x160b91;break;}}if(!_0x2bfed2)return log(_0x4907eb(0x254)+_0x8a56d6),_0x2920f7();_0x11b6a9[_0x4907eb(0x25c)]&&(_0x2bfed2[_0x4907eb(0x21a)]=_0x11b6a9[_0x4907eb(0x25c)]);_0x2bfed2[_0x4907eb(0x1c2)]=_0x8a56d6;let {dir:_0x278723,name:_0x3092f2}=path[_0x4907eb(0x1a7)](path[_0x4907eb(0x221)](_0x572843,_0x4f282e)),_0x1f7001=path[_0x4907eb(0x221)](_0x278723,_0x3092f2)+'.jpg',_0x4a088f=path[_0x4907eb(0x221)](_0x278723,_0x3092f2)+'.nfo';downloadPosterAndSaveNfo(_0x1f7001,_0x2bfed2[_0x4907eb(0x280)],_0x2bfed2,_0x4a088f,'episodedetails',null,_0x4c6364)[_0x4907eb(0x1fa)](_0x160550=>{_0x2920f7();});});}function detectIsMissingEpisodeInfo(_0x3d1fff){const _0x549d7f=_0x1bc29e;let _0x830859=fs[_0x549d7f(0x249)](_0x3d1fff),_0x28b23c=![];for(let _0x3874c3 of _0x830859){let _0x51c746=path[_0x549d7f(0x1d6)](_0x3874c3)?path['extname'](_0x3874c3)[_0x549d7f(0x1cc)]():null;if(_0x51c746&&config['videoTypeList'][_0x549d7f(0x24f)](_0x51c746)){let _0x542797=_0x3874c3[_0x549d7f(0x284)](0x0,_0x3874c3[_0x549d7f(0x23d)]('.')),_0x4357f5=path[_0x549d7f(0x221)](_0x3d1fff,_0x542797+_0x549d7f(0x26e));if(!fs[_0x549d7f(0x1e7)](_0x4357f5))return console[_0x549d7f(0x266)](_0x549d7f(0x1f5)+_0x4357f5),_0x28b23c=!![],_0x28b23c;}}return _0x28b23c;}function saveSeasonInfo(_0x25d82d,_0x8e9e74,_0x110ed6,_0x2c2cdc,_0x48faf5){return new Promise((_0x386e2f,_0x378912)=>{const _0x1936c5=_0x1dab;if(!_0x8e9e74[_0x1936c5(0x1d8)]||_0x8e9e74[_0x1936c5(0x1d8)][_0x1936c5(0x240)]<0x1)return log('seriesInfo没找到季信息'),_0x386e2f();let _0x478097;for(let _0x276965 of _0x8e9e74[_0x1936c5(0x1d8)]){log('season.season_number:'+_0x276965[_0x1936c5(0x25c)]);if(_0x276965[_0x1936c5(0x25c)]==_0x110ed6){_0x478097=_0x276965;break;}}if(!_0x478097)return log(_0x1936c5(0x1c3)+_0x110ed6),_0x386e2f();let _0x501c1a,_0x527a0f,_0x5685d6,_0x4ae45d;if(_0x2c2cdc){let _0x5958e3=_0x110ed6+'';if(_0x110ed6<0xa)_0x5958e3='0'+_0x110ed6;_0x501c1a=path[_0x1936c5(0x221)](path['dirname'](_0x25d82d),_0x1936c5(0x21a)+_0x5958e3+_0x1936c5(0x1c7)),_0x5685d6=path[_0x1936c5(0x221)](_0x25d82d,_0x1936c5(0x1ae)),_0x4ae45d=path[_0x1936c5(0x221)](path[_0x1936c5(0x248)](_0x25d82d),_0x1936c5(0x225));}else _0x501c1a=path[_0x1936c5(0x221)](_0x25d82d,_0x1936c5(0x28a)),_0x5685d6=path[_0x1936c5(0x221)](_0x25d82d,_0x1936c5(0x22b)),_0x4ae45d=path[_0x1936c5(0x221)](_0x25d82d,_0x1936c5(0x225)),!_0x478097[_0x1936c5(0x274)]&&(_0x478097[_0x1936c5(0x274)]=_0x8e9e74[_0x1936c5(0x274)]);!_0x478097[_0x1936c5(0x280)]&&(_0x478097[_0x1936c5(0x280)]=_0x8e9e74['cover_url']),_0x478097[_0x1936c5(0x21a)]=_0x110ed6,_0x8e9e74[_0x1936c5(0x1c5)]&&_0x478097['movie_name']&&(_0x478097['showtitle']=_0x8e9e74['movie_name']+'\x20'+_0x478097[_0x1936c5(0x1c5)],_0x478097[_0x1936c5(0x1c5)]=_0x478097[_0x1936c5(0x26d)]),_0x8e9e74[_0x1936c5(0x201)]&&!_0x478097[_0x1936c5(0x201)]&&(_0x478097[_0x1936c5(0x201)]=_0x8e9e74['actors']),_0x8e9e74[_0x1936c5(0x25a)]&&!_0x478097[_0x1936c5(0x25a)]&&(_0x478097[_0x1936c5(0x25a)]=_0x8e9e74['actorsOriginal']),_0x8e9e74[_0x1936c5(0x226)]&&!_0x478097[_0x1936c5(0x226)]&&(_0x478097[_0x1936c5(0x226)]=_0x8e9e74[_0x1936c5(0x226)]),_0x8e9e74[_0x1936c5(0x1bd)]&&!_0x478097[_0x1936c5(0x1bd)]&&(_0x478097[_0x1936c5(0x1bd)]=_0x8e9e74[_0x1936c5(0x1bd)]),_0x8e9e74[_0x1936c5(0x258)]&&!_0x478097['creator']&&(_0x478097['creator']=_0x8e9e74[_0x1936c5(0x258)]),_0x8e9e74['creatorOriginal']&&!_0x478097['creatorOriginal']&&(_0x478097[_0x1936c5(0x1ee)]=_0x8e9e74[_0x1936c5(0x1ee)]),_0x8e9e74['guestActorsOriginal']&&!_0x478097['guestActorsOriginal']&&(_0x478097['guestActorsOriginal']=_0x8e9e74[_0x1936c5(0x212)]),_0x8e9e74[_0x1936c5(0x245)]&&!_0x478097['genres']&&(_0x478097[_0x1936c5(0x245)]=_0x8e9e74['genres']),_0x8e9e74[_0x1936c5(0x215)]&&!_0x478097['regions']&&(_0x478097['regions']=_0x8e9e74['regions']),_0x8e9e74[_0x1936c5(0x1c0)]&&(_0x478097[_0x1936c5(0x1c0)]=_0x8e9e74[_0x1936c5(0x1c0)]),downloadPosterAndSaveNfo(_0x501c1a,_0x478097[_0x1936c5(0x280)],_0x478097,_0x5685d6,_0x1936c5(0x227),_0x4ae45d,_0x48faf5)[_0x1936c5(0x1fa)](_0x4490a4=>{const _0x188293=_0x1936c5;log(_0x188293(0x1a8));if(!_0x8e9e74[_0x188293(0x1c0)])return _0x386e2f();if(_0x48faf5&&!detectIsMissingEpisodeInfo(_0x25d82d))return log(_0x188293(0x1d7)),_0x386e2f();let _0x415a8c=getTmdbApi();_0x415a8c[_0x188293(0x1e2)](_0x8e9e74[_0x188293(0x1c0)],_0x110ed6)[_0x188293(0x1fa)](_0x3fb91f=>{log('开始保存每一集的信息'),fs['readdir'](_0x25d82d,(_0x213dfa,_0xbc2a89)=>{const _0x8eb8b3=_0x1dab;if(_0x213dfa)return _0x386e2f();let _0x57ed72=[];for(let _0x2f2e2d of _0xbc2a89){try{let _0x480984=path[_0x8eb8b3(0x221)](_0x25d82d,_0x2f2e2d),_0x140c72=fs[_0x8eb8b3(0x21e)](_0x480984);if(_0x140c72[_0x8eb8b3(0x253)]()){let _0xa27782=movieSeasonUtil[_0x8eb8b3(0x1de)](_0x2f2e2d);_0xa27782&&_0xa27782[_0x8eb8b3(0x1c2)]&&_0xa27782['episode']>0x0&&_0x57ed72[_0x8eb8b3(0x1b0)](saveEpisodeInfo(_0x25d82d,_0x3fb91f,_0x2f2e2d,_0xa27782['episode'],_0x48faf5));}}catch(_0x2f67dd){log(_0x2f67dd);continue;}}Promise[_0x8eb8b3(0x273)](_0x57ed72)[_0x8eb8b3(0x1fa)](_0x4c0e17=>{_0x386e2f();});});})[_0x188293(0x26a)](_0x11a80d=>{const _0x2d77c8=_0x188293;return log(_0x11a80d),addScrapeLog(path[_0x2d77c8(0x221)](workerData[_0x2d77c8(0x22d)]),_0x2d77c8(0x1a6),'','','FAIL',_0x11a80d[_0x2d77c8(0x1e3)]?_0x11a80d[_0x2d77c8(0x1e3)]:_0x2d77c8(0x24a)),_0x386e2f();});});});}function onSearchFinish(_0xbffa6c,_0x1973dd,_0x3f26a3){return new Promise((_0x11c015,_0x436e29)=>{const _0x20472b=_0x1dab;let _0x1e32c3=path[_0x20472b(0x221)](_0xbffa6c[_0x20472b(0x22d)],_0xbffa6c[_0x20472b(0x28c)]),_0x4e7933=_0xbffa6c[_0x20472b(0x23e)]==0x1,_0x548f83=getTmdbApi();_0x548f83['getDetail'](_0x1973dd,_0x4e7933)[_0x20472b(0x1fa)](_0x5e8008=>{const _0x4e67aa=_0x20472b;if(!_0x4e7933){let {dir:_0x135efb,name:_0x57af28}=path[_0x4e67aa(0x1a7)](_0x1e32c3),_0x59e338=path['join'](_0x135efb,_0x57af28+_0x4e67aa(0x283)),_0x229f44=_0x5e8008[_0x4e67aa(0x280)],_0x3f22fd=path[_0x4e67aa(0x221)](_0x135efb,_0x57af28+'.nfo'),_0x182071=path[_0x4e67aa(0x221)](_0x135efb,_0x57af28+_0x4e67aa(0x251));downloadPosterAndSaveNfo(_0x59e338,_0x229f44,_0x5e8008,_0x3f22fd,_0x4e67aa(0x25b),_0x182071,_0x3f26a3)[_0x4e67aa(0x1fa)](_0x39f34a=>{return log('电影的海报和nfo保存完毕'),_0x11c015();});}else{let _0xdc62af=movieSeasonUtil[_0x4e67aa(0x26c)](path[_0x4e67aa(0x210)](_0xbffa6c[_0x4e67aa(0x22d)]));if(_0xdc62af>-0x1){log(_0x4e67aa(0x1d4)+_0x1e32c3);let {dir:_0x5ca03f,name:_0x9912a1}=path[_0x4e67aa(0x1a7)](_0x1e32c3),_0x51815c=path[_0x4e67aa(0x221)](path[_0x4e67aa(0x248)](_0x5ca03f),_0x4e67aa(0x28a)),_0x57fc2d=path[_0x4e67aa(0x221)](path[_0x4e67aa(0x248)](_0x5ca03f),_0x4e67aa(0x225)),_0x3159ff=path['join'](path[_0x4e67aa(0x248)](_0x5ca03f),_0x4e67aa(0x22b));downloadPosterAndSaveNfo(_0x51815c,_0x5e8008[_0x4e67aa(0x280)],_0x5e8008,_0x3159ff,_0x4e67aa(0x227),_0x57fc2d,_0x3f26a3)[_0x4e67aa(0x1fa)](_0x45d5cf=>{log('整部剧的海报和nfo保存完毕'),fs['readdir'](path['dirname'](_0x5ca03f),(_0x2df5f9,_0x3b9a94)=>{const _0x152964=_0x1dab;if(_0x2df5f9)return _0x11c015();let _0x27c3ec=[];for(let _0x3f5492 of _0x3b9a94){try{let _0x18f3fe=path[_0x152964(0x221)](path['dirname'](_0x5ca03f),_0x3f5492),_0x128e2c=fs['statSync'](_0x18f3fe);if(_0x128e2c[_0x152964(0x1f7)]()){let _0x573e88=movieSeasonUtil[_0x152964(0x26c)](_0x3f5492);_0x573e88>-0x1&&_0x27c3ec[_0x152964(0x1b0)](saveSeasonInfo(_0x18f3fe,_0x5e8008,_0x573e88,!![],_0x3f26a3));}}catch(_0xabd120){log(_0xabd120);continue;}}Promise[_0x152964(0x273)](_0x27c3ec)[_0x152964(0x1fa)](_0xbf5bfa=>{_0x11c015();});});});}else{log(_0x4e67aa(0x1cd)+_0x1e32c3);let _0x424c4d=movieSeasonUtil[_0x4e67aa(0x26c)](path[_0x4e67aa(0x210)](_0xbffa6c[_0x4e67aa(0x22d)]),![]);if(_0x424c4d>-0x1)saveSeasonInfo(path['dirname'](_0x1e32c3),_0x5e8008,_0x424c4d,![],_0x3f26a3)[_0x4e67aa(0x1fa)](_0x37d5d4=>{_0x11c015();});else{let _0x23ef36=movieSeasonUtil[_0x4e67aa(0x1de)](_0x1e32c3);_0x23ef36&&_0x23ef36[_0x4e67aa(0x21a)]&&_0x23ef36['season']>0x0?saveSeasonInfo(path[_0x4e67aa(0x248)](_0x1e32c3),_0x5e8008,_0x23ef36[_0x4e67aa(0x21a)],![],_0x3f26a3)[_0x4e67aa(0x1fa)](_0xb73c81=>{_0x11c015();}):(log(_0x4e67aa(0x246)),saveSeasonInfo(path[_0x4e67aa(0x248)](_0x1e32c3),_0x5e8008,0x1,![],_0x3f26a3)['then'](_0x3f26dc=>{_0x11c015();}));}}}})[_0x20472b(0x26a)](_0x119cf7=>{const _0x10626d=_0x20472b;return log(_0x119cf7),addScrapeLog(path['join'](workerData[_0x10626d(0x22d)]),_0x10626d(0x1d2),'','','FAIL',_0x119cf7[_0x10626d(0x1e3)]?_0x119cf7[_0x10626d(0x1e3)]:_0x10626d(0x24a)),_0x11c015();});});}function addScrapeLog(_0x6b3cf4,_0x53a526,_0x3cc18d,_0x3826ba,_0x32f43d,_0x5a79e7){const _0x4b0230=_0x1bc29e;dbFileIndex[_0x4b0230(0x21d)](_0x4b0230(0x1e4))[_0x4b0230(0x216)](_0x6b3cf4,_0x53a526,_0x3cc18d,_0x3826ba,_0x32f43d,_0x5a79e7,Date[_0x4b0230(0x268)]());}function getTvExistTmdbId(_0xc670e){const _0x524008=_0x1bc29e;if(_0xc670e['is_tvplay']!=0x1)return null;let _0x414934=path[_0x524008(0x248)](_0xc670e['path']),_0x220144=movieSeasonUtil[_0x524008(0x26c)](path[_0x524008(0x210)](_0xc670e[_0x524008(0x22d)]),!![]),_0x41a352=null,_0x330e0f='';_0x220144>-0x1&&(_0x330e0f=path[_0x524008(0x221)](_0x414934,_0x524008(0x22b)));(!_0x330e0f||!fs['existsSync'](_0x330e0f))&&(_0x330e0f=path[_0x524008(0x221)](_0xc670e[_0x524008(0x22d)],_0x524008(0x22b)));if(!_0x330e0f||!fs[_0x524008(0x1e7)](_0x330e0f))return null;const _0x5a946d=new XMLParser();let _0x3788e9=_0x5a946d[_0x524008(0x1a7)](fs['readFileSync'](_0x330e0f));return _0x3788e9[_0x524008(0x227)]&&(_0x3788e9=_0x3788e9['tvshow'],_0x3788e9['tmdbid']&&(_0x41a352=_0x3788e9[_0x524008(0x28b)])),{'tmdbId':_0x41a352,'seassonNumber':_0x220144};}function searchMovieInfo(_0x4a3044,_0x63edb9){return!_0x63edb9&&(_0x63edb9=getQueryArray(_0x4a3044)),log(JSON['stringify'](_0x63edb9)),new Promise((_0x69c878,_0x58051d)=>{const _0x4194f5=_0x1dab;function _0x533607(){return _0x58051d();}if(!_0x63edb9||_0x63edb9[_0x4194f5(0x240)]<0x1)return log(_0x4194f5(0x1dc)),_0x533607();let _0x523d01=_0x63edb9[0x0][_0x4194f5(0x1cb)],_0x139e15=_0x63edb9[0x0]['year'];log(_0x4194f5(0x257),_0x523d01[_0x4194f5(0x1cb)]);let _0x335454=getTmdbApi();if(!_0x335454)return log(_0x4194f5(0x1c4)),_0x533607();let _0x20a5b6=_0x4a3044[_0x4194f5(0x23e)]==0x1;_0x335454[_0x4194f5(0x220)](_0x523d01,_0x20a5b6,_0x139e15)[_0x4194f5(0x1fa)](_0x56ebd5=>{const _0x3808be=_0x4194f5;if(_0x56ebd5&&_0x56ebd5[_0x3808be(0x240)]>0x0){let _0x4858a9=_0x56ebd5[0x0];onSearchFinish(_0x4a3044,_0x4858a9[_0x3808be(0x1c0)])[_0x3808be(0x1fa)](()=>{return _0x69c878();});}else{if(_0x63edb9[_0x3808be(0x240)]>0x1){let _0x472438=_0x63edb9['splice'](0x1);return searchMovieInfo(_0x4a3044,_0x472438)[_0x3808be(0x1fa)](_0x69c878);}else return log('tmdb.没有获取到相关信息',_0x523d01),addScrapeLog(path[_0x3808be(0x221)](workerData['path']),_0x3808be(0x1d2),'','','FAIL',i18n['__'](_0x3808be(0x224))),_0x533607();}})[_0x4194f5(0x26a)](_0x1f78cf=>{return log('TMDB\x20search接口请求失败',_0x1f78cf),_0x533607();});});}function returnResult(){const _0x242409=_0x1bc29e;log('刮削任务结束'),parentPort['postMessage']({'code':0x0}),process[_0x242409(0x235)](0x0);}function log(_0xa91324){const _0x12283f=_0x1bc29e;parentPort[_0x12283f(0x26b)]({'type':_0x12283f(0x266),'message':_0xa91324});}if(workerData&&workerData[_0x1bc29e(0x28c)]&&workerData['path']&&workerData[_0x1bc29e(0x1ef)]&&workerData[_0x1bc29e(0x288)]&&workerData[_0x1bc29e(0x1b6)]){if(workerData[_0x1bc29e(0x1c0)])log(_0x1bc29e(0x27f)),onSearchFinish(workerData,workerData[_0x1bc29e(0x1c0)])['then'](_0x461d6b=>{const _0x4bf1de=_0x1bc29e;log(_0x4bf1de(0x1b7),workerData[_0x4bf1de(0x1c0)],workerData['path'],workerData[_0x4bf1de(0x28c)]),returnResult();})[_0x1bc29e(0x26a)](_0x29edf4=>{returnResult();});else{if(workerData['scrapeMissing']==0x1){log(_0x1bc29e(0x1af));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId[_0x1bc29e(0x211)]){addScrapeLog(path['join'](workerData[_0x1bc29e(0x22d)]),_0x1bc29e(0x1f8),'','',_0x1bc29e(0x1c8),i18n['__'](_0x1bc29e(0x21f)));return;}let tmdbId=foundTmdbId[_0x1bc29e(0x211)];onSearchFinish(workerData,tmdbId,!![])[_0x1bc29e(0x1fa)](_0x4775fb=>{const _0x3b42d6=_0x1bc29e;log(_0x3b42d6(0x1b7)),returnResult();})[_0x1bc29e(0x26a)](_0x298a63=>{returnResult();});}else log(_0x1bc29e(0x1ca)),searchMovieInfo(workerData)[_0x1bc29e(0x1fa)](_0x26d0d6=>{const _0x4421b3=_0x1bc29e;log(_0x4421b3(0x1b7)+workerData[_0x4421b3(0x22d)]+'\x20'+workerData[_0x4421b3(0x28c)]),returnResult();})[_0x1bc29e(0x26a)](_0x5904a3=>{returnResult();});}}else log(_0x1bc29e(0x237)),returnResult();