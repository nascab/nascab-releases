const _0x361498=_0x133e;(function(_0x41e294,_0x58af16){const _0x21c009=_0x133e,_0x47d063=_0x41e294();while(!![]){try{const _0x347bd6=parseInt(_0x21c009(0x23f))/0x1*(-parseInt(_0x21c009(0x1de))/0x2)+-parseInt(_0x21c009(0x2b0))/0x3+-parseInt(_0x21c009(0x225))/0x4*(parseInt(_0x21c009(0x203))/0x5)+-parseInt(_0x21c009(0x1ea))/0x6*(-parseInt(_0x21c009(0x1e9))/0x7)+parseInt(_0x21c009(0x2cc))/0x8+-parseInt(_0x21c009(0x25d))/0x9+parseInt(_0x21c009(0x28d))/0xa;if(_0x347bd6===_0x58af16)break;else _0x47d063['push'](_0x47d063['shift']());}catch(_0x5ad2dc){_0x47d063['push'](_0x47d063['shift']());}}}(_0x20c1,0x73d45));const {XMLParser,XMLBuilder}=require('fast-xml-parser'),path=require(_0x361498(0x259));let axios=require('axios');const {HttpsProxyAgent}=require('hpagent'),https=require(_0x361498(0x250)),{URL}=require(_0x361498(0x24a)),fs=require('fs'),movieSeasonUtil=require(_0x361498(0x2a7)),mediaTypeConfig=require(_0x361498(0x298)),{parentPort,workerData}=require(_0x361498(0x28c)),movieInfoTmdbApi=require(_0x361498(0x213)),dbConfigTable=require(_0x361498(0x2c3)),nfoUtil=require(_0x361498(0x2a9)),Database=require('better-sqlite3'),config=require('../myConfig/config'),dbFileIndex=new Database(config[_0x361498(0x233)],{'timeout':0xea60});dbFileIndex[_0x361498(0x1df)](_0x361498(0x263));let dbOther=new Database(config['dbOther'],{});dbOther[_0x361498(0x1df)](_0x361498(0x263));let i18nUtil=require(_0x361498(0x1fd));i18n=i18nUtil[_0x361498(0x2b8)](dbOther);let excludeList=['阳光电影dygod.org',_0x361498(0x296),_0x361498(0x29d),_0x361498(0x27b),_0x361498(0x29a),_0x361498(0x2c8),_0x361498(0x20c),_0x361498(0x211),_0x361498(0x228),_0x361498(0x23d),_0x361498(0x1e4),_0x361498(0x20f),'nexusnf',_0x361498(0x2b9),_0x361498(0x257),_0x361498(0x27a),'4audio',_0x361498(0x241),'5audio',_0x361498(0x22c),_0x361498(0x231),_0x361498(0x21f),_0x361498(0x23c),_0x361498(0x275),_0x361498(0x2b1),_0x361498(0x2b4),_0x361498(0x212),_0x361498(0x1fa),_0x361498(0x270),_0x361498(0x22d),_0x361498(0x2ce),'fgt',_0x361498(0x271),_0x361498(0x291),_0x361498(0x26c),_0x361498(0x290),_0x361498(0x2c2),'hdr','hd',_0x361498(0x27d),_0x361498(0x1eb),_0x361498(0x29f),'rargb','swtyblz',_0x361498(0x2c5),_0x361498(0x267),_0x361498(0x251),'ma',_0x361498(0x2c1),'dv',_0x361498(0x206),_0x361498(0x28e),'surcode','fgt',_0x361498(0x1fb),_0x361498(0x1f9),_0x361498(0x25b),_0x361498(0x235),_0x361498(0x294),'4ktrash',_0x361498(0x25c),'atmos-iamable',_0x361498(0x2bc),'eng',_0x361498(0x2bb),_0x361498(0x258),_0x361498(0x205),_0x361498(0x26f),_0x361498(0x2a6),_0x361498(0x1f4),'remux','bluray',_0x361498(0x208),_0x361498(0x216),_0x361498(0x1fe),_0x361498(0x262),_0x361498(0x295),_0x361498(0x279),'mkv','mp4',_0x361498(0x210),'rm','mov',_0x361498(0x20d),_0x361498(0x20f),_0x361498(0x214),_0x361498(0x24b),_0x361498(0x269),_0x361498(0x22b),_0x361498(0x26e),_0x361498(0x1ef),_0x361498(0x2a1),_0x361498(0x286),_0x361498(0x2c6),_0x361498(0x274),_0x361498(0x200),_0x361498(0x1ee),'英文中字',_0x361498(0x289),_0x361498(0x246),'dl','-',_0x361498(0x255),'电影天堂','韩语中字',_0x361498(0x283),'高清mp4电影'];function _0x20c1(){const _0x5ec5b4=['backdrop_url','fanart.jpg','value','extname','日语中字','stat','TMDB\x20search接口请求失败','高清版','没有找到要保存的季信息\x20对应号码:','tvshow.nfo','西语中字','guestActorsOriginal','findByTitle','worker_threads','22614630PkGwVa','cmrg','push','sdr','10bit','basename','.nfo','x260bit','h264','dolby-multi-bodhmall','poster.jpg','../myConfig/mediaType','TMDB\x20api实例获取失败\x20请检查TMDB相关配置','hd1080p','getSeasonDetail','seasonInfo没找到每一集的信息','2160p','SCRAPE_MISSING','dts','vid_','dreamhd','catch','is_tvplay','parse','seriesInfo没找到季信息','uhd','../utils/movieSeasonUtil','search','../utils/nfoUtil','信息不足\x20无法搜索\x20退出worker','readFileSync','allSettled','5.1','saveNfoFile','POSTER','1460985GTSBta','6audios','SUCCESS','episodes','7audios','下载fanart:','test','-poster.jpg','getI18n','x265-terminal','pipe','nahom','atmos-coaster','INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)','API_DETAIL','split','缺失:','bhd','hdr10','../db/dbConfigTable','readdir','iamable','电影天堂','year','1080p','根据已有NFO刮削缺失集','IMG_','regions','4591472dcFiuN','startsWith','hds','actorsOriginal','substr','24286zoudTk','pragma','.jpg','toLocaleLowerCase','tmdbid','tmdb_api_key','240p','join','directors','-fanart.jpg','statSync','5467TzxrFc','3018PrddgX','dts-hd','replace','movie_name','英语中字','ac3','substring','stringify','跳过不缺失任何信息的季','filename','bdrip','开始保存每一集的信息','season.season_number:','splice','hostname','x265-dvsux','hevc','web-dl','genres','../utils/i18nUtil','ultrahd','prepare','高清晰版','showtitle','不符合三级命名规则:','25hUkPra','season','265-apex','ddp','dirname','hdtv','跳过保存fanart:','根据TMDBID搜索','isFile','bd720p','3gp','now','web','rmvb','720p','cee','../utils/movieInfoTmdbApi','tbs','every','blue-ray','get','tmdb_id','season.nfo','readdirSync','tmdb_api_url','includes','请求失败:\x20HTTP\x20','length','3audios','season_number','Search\x20Worker:Tmdb代理已经开启','close','episode','NFO','376440tELgXv','isDirectory','整部剧的海报和nfo保存完毕','x264','error','跳过非视频文件:','dvd','6audio','internal','status_message','noSearchResult','statusCode','7audio','tmdbProxyUrl','dbFileIndex','信息获取完毕','dvsux','FAIL','then','.tmp','createWriteStream','tmdb_api_language','finish','4audios','480p','跳过保存海报:','78YoQlUY','title','hdwing','tmdbidNotFound','postMessage','log','directorsOriginal','beitai','run','tmdbId','tmdbProxyEnable','url','2audios','creator','getSeasonNumber','exit','episodedetails','https','coaster','VID_','keys','符合三级命名规则:','中文字幕','ERROR','brrip','ita','path','STREAM','x265','atmos-swtyblz','7641936LZOTEc','getDetail','没有季信息\x20默认使用第一季','videoTypeList','toLowerCase','ultra-hd','journal_mode\x20=\x20WAL','trim','existsSync','Matching\x20movie\x20information\x20','cmct','跳过保存NFO:','aac','tvshow','电影的海报和nfo保存完毕','8bit','creatorOriginal','chs-eng','atmos','remastered','truehd','1942','没有找到要保存的集信息\x20对应号码:','阳光电影','5audios','cover_url','开始下载','根据文件名和路径搜索','h265','3audio','bd1080p','rename','dts-ift','seasons'];_0x20c1=function(){return _0x5ec5b4;};return _0x20c1();}function isObjectInQueryArray(_0x4098d7,_0x17e570){return _0x4098d7['some'](function(_0xe197ea){const _0x2514a0=_0x133e,_0x19b5e2=Object[_0x2514a0(0x253)](_0x17e570);return _0x19b5e2[_0x2514a0(0x215)](_0x597719=>_0xe197ea[_0x597719]===_0x17e570[_0x597719]);});}function getQueryArray(_0xd2f5e8){const _0x5aef67=_0x361498;let _0x324a00=[];if(!_0xd2f5e8||!_0xd2f5e8['filename'])return[];let _0x4b5bda=_0xd2f5e8[_0x5aef67(0x1f3)][_0x5aef67(0x261)]();if(!_0x4b5bda||_0x4b5bda['length']<0x2)return[];function _0xa4cb53(_0xaa105e,_0x5aa854){const _0x2a05a4=_0x5aef67;let _0x4cca9d={'title':_0xaa105e,'year':_0x5aa854};_0xaa105e!=_0x2a05a4(0x25a)&&!isObjectInQueryArray(_0x324a00,_0x4cca9d)&&_0x324a00[_0x2a05a4(0x28f)](_0x4cca9d);}function _0xaee938(_0x19604c){const _0x5f211a=_0x5aef67;let _0x1250b3=path[_0x5f211a(0x282)](_0x19604c);_0x1250b3&&(_0x19604c=_0x19604c[_0x5f211a(0x1ec)](_0x1250b3,''));if(/^[0-9]*$/[_0x5f211a(0x2b6)](_0x19604c)&&_0x19604c!=_0x5f211a(0x272)&&!_0x19604c['startsWith']('0000'))return[];if(_0x19604c['startsWith'](_0x5f211a(0x2ca))||_0x19604c[_0x5f211a(0x2cd)]('img_')||_0x19604c[_0x5f211a(0x2cd)]('VID')||_0x19604c[_0x5f211a(0x2cd)]('vid')||_0x19604c[_0x5f211a(0x2cd)](_0x5f211a(0x252))||_0x19604c[_0x5f211a(0x2cd)](_0x5f211a(0x2a0))||_0x19604c['startsWith']('IMG'))return[];_0x19604c[_0x19604c[_0x5f211a(0x21e)]-0x1]=='.'&&(_0x19604c=_0x19604c[_0x5f211a(0x2d0)](0x0,_0x19604c['length']-0x1));_0x19604c=_0x19604c[_0x5f211a(0x1ec)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')[_0x5f211a(0x1ec)](_0x5f211a(0x2ad),'')['replace']('7.1',''),_0x19604c=_0x19604c['replace'](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')[_0x5f211a(0x1ec)](/[ ]+/gi,'\x20');let _0x4ada0e=_0x19604c[_0x5f211a(0x2bf)]('\x20'),_0x568254=[],_0x2aa0b2=null;for(let _0x1ca38e in _0x4ada0e){let _0x13f064=_0x4ada0e[_0x1ca38e][_0x5f211a(0x264)]();if(excludeList['includes'](_0x13f064))continue;if(isNumber(_0x13f064)){if(parseInt(_0x13f064)>0x767&&parseInt(_0x13f064)<0x834){_0x2aa0b2=_0x13f064;continue;}}_0x568254[_0x5f211a(0x28f)](_0x13f064);}for(let _0x4cae14=_0x568254[_0x5f211a(0x21e)];_0x4cae14>=0x0;_0x4cae14--){let _0x5150f4=_0x568254[_0x5f211a(0x1e5)]('\x20')['trim']();_0x5150f4&&(_0x2aa0b2&&_0xa4cb53(_0x5150f4,_0x2aa0b2),_0xa4cb53(_0x5150f4)),_0x568254[_0x5f211a(0x1f7)](_0x568254[_0x5f211a(0x21e)]-0x1,0x1);}}if(_0xd2f5e8['is_tvplay']==0x1)try{let _0xac5231=path[_0x5aef67(0x292)](_0xd2f5e8[_0x5aef67(0x259)])[_0x5aef67(0x1e1)](),_0x13e140=movieSeasonUtil[_0x5aef67(0x24d)](_0xac5231);if(_0x13e140>-0x1){let _0x2b0bab=path[_0x5aef67(0x292)](path[_0x5aef67(0x207)](_0xd2f5e8[_0x5aef67(0x259)]))['toLocaleLowerCase']();_0x2b0bab&&_0xaee938(_0x2b0bab);}else _0xaee938(_0xac5231);}catch(_0x2d1a26){console['log'](_0x2d1a26);}const _0x3592f5=_0x4b5bda[_0x5aef67(0x1ec)](/s\d{1,2}e\d{1,2}/g,'');return _0xaee938(_0x3592f5),_0x324a00;}function isNumber(_0x1fcefe){const _0x2609b0=_0x361498;return/^-?[\d.]+(?:e-?\d+)?$/[_0x2609b0(0x2b6)](_0x1fcefe);}function getTmdbApi(){const _0x53c65b=_0x361498;let _0xc1840b=dbConfigTable['findByTitle'](dbOther,_0x53c65b(0x249)),_0x22b0ab=null;if(_0xc1840b&&_0xc1840b['value']==0x1){let _0x4125e8=dbConfigTable[_0x53c65b(0x28b)](dbOther,_0x53c65b(0x232));_0x4125e8&&_0x4125e8['value']&&(_0x22b0ab=_0x4125e8[_0x53c65b(0x281)]),log(_0x53c65b(0x221)+_0x22b0ab);}return tmdbApiObj=new movieInfoTmdbApi['API'](workerData[_0x53c65b(0x1e3)],workerData[_0x53c65b(0x23a)],workerData['tmdb_api_url'],_0x22b0ab),tmdbApiObj;}function _0x133e(_0x2cffda,_0x11f82e){const _0x20c1d0=_0x20c1();return _0x133e=function(_0x133e94,_0x2d8409){_0x133e94=_0x133e94-0x1de;let _0x514bbb=_0x20c1d0[_0x133e94];return _0x514bbb;},_0x133e(_0x2cffda,_0x11f82e);}function getProxyUrl(_0x2273de){const _0x55e79c=_0x361498;let _0x271dda=dbConfigTable['findByTitle'](_0x2273de,_0x55e79c(0x249)),_0x4048c6=null;if(_0x271dda&&_0x271dda[_0x55e79c(0x281)]==0x1){let _0x12eade=dbConfigTable['findByTitle'](_0x2273de,_0x55e79c(0x232));_0x12eade&&_0x12eade[_0x55e79c(0x281)]&&(_0x4048c6=_0x12eade[_0x55e79c(0x281)]);}return _0x4048c6;}function downloadPoster(_0x14c883,_0x429abb){return new Promise((_0x70d8,_0xb80b31)=>{const _0x345949=_0x133e;fs[_0x345949(0x284)](_0x14c883,(_0x3712f0,_0x3435f1)=>{const _0x24af54=_0x345949;if(_0x3712f0){console['log'](_0x24af54(0x277),_0x429abb);let _0x141d20=getProxyUrl(dbOther),_0x558f4a=null;_0x141d20&&(_0x558f4a=new HttpsProxyAgent({'proxy':_0x141d20}));const _0x35f2ab=new URL(_0x429abb);https[_0x24af54(0x217)]({'hostname':_0x35f2ab[_0x24af54(0x1f8)],'port':_0x35f2ab['port']||0x1bb,'path':_0x35f2ab['pathname']+_0x35f2ab[_0x24af54(0x2a8)],'agent':_0x558f4a?_0x558f4a:![]},_0x128465=>{const _0x4e4cbd=_0x24af54;if(_0x128465[_0x4e4cbd(0x230)]!==0xc8)return console[_0x4e4cbd(0x229)](_0x4e4cbd(0x21d)+_0x128465[_0x4e4cbd(0x230)]),addScrapeLog(path[_0x4e4cbd(0x1e5)](workerData['path']),_0x4e4cbd(0x2af),'',_0x14c883,'FAIL'),_0x70d8('');let _0x29caa0=_0x14c883+_0x4e4cbd(0x238),_0x426686=fs[_0x4e4cbd(0x239)](_0x29caa0);_0x128465[_0x4e4cbd(0x2ba)](_0x426686),_0x426686['on'](_0x4e4cbd(0x23b),()=>{const _0x5ba5c9=_0x4e4cbd;fs[_0x5ba5c9(0x27c)](_0x29caa0,_0x14c883,_0x584e86=>{const _0x1741b5=_0x5ba5c9;if(_0x584e86)return _0x70d8('');addScrapeLog(path['join'](workerData[_0x1741b5(0x259)]),_0x1741b5(0x2af),'',_0x14c883,_0x1741b5(0x2b2)),_0x70d8(_0x14c883);});}),_0x426686['on'](_0x4e4cbd(0x229),_0x1ae7dc=>{const _0x24dcfb=_0x4e4cbd;console[_0x24dcfb(0x244)](_0x1ae7dc),addScrapeLog(path[_0x24dcfb(0x1e5)](workerData[_0x24dcfb(0x259)]),_0x24dcfb(0x2af),'',_0x14c883,_0x24dcfb(0x236)),_0x70d8('');}),_0x426686['on'](_0x4e4cbd(0x222),()=>{});})['on']('error',_0x17eaea=>{_0x70d8('');});}else _0x70d8(_0x14c883);});});}function downloadPosterAndSaveNfo(_0x9139ca,_0x437856,_0x52d9fd,_0x3dfa89,_0xa0f9a0,_0x45d3af,_0x2b8bb3){return new Promise((_0x133442,_0x5d882f)=>{const _0x3a58f1=_0x133e;let _0x143690=[];_0x437856&&_0x9139ca&&(!_0x2b8bb3||_0x2b8bb3&&!fs[_0x3a58f1(0x265)](_0x9139ca)?_0x143690[_0x3a58f1(0x28f)](downloadPoster(_0x9139ca,_0x437856)):log(_0x3a58f1(0x23e)+_0x9139ca)),_0x52d9fd&&_0x3dfa89&&(!_0x2b8bb3||_0x2b8bb3&&!fs[_0x3a58f1(0x265)](_0x3dfa89)?(console[_0x3a58f1(0x244)]('nfo不存在,开始保存',_0x3dfa89,_0x2b8bb3),addScrapeLog(path[_0x3a58f1(0x1e5)](workerData[_0x3a58f1(0x259)]),_0x3a58f1(0x224),_0x3dfa89,'',_0x3a58f1(0x2b2)),_0x143690[_0x3a58f1(0x28f)](nfoUtil[_0x3a58f1(0x2ae)](_0x52d9fd,_0x3dfa89,_0xa0f9a0))):log(_0x3a58f1(0x268)+_0x3dfa89)),_0x52d9fd['backdrop_url']&&_0x45d3af&&(!_0x2b8bb3||_0x2b8bb3&&!fs['existsSync'](_0x45d3af)?(log(_0x3a58f1(0x2b5)+_0x45d3af),_0x143690[_0x3a58f1(0x28f)](downloadPoster(_0x45d3af,_0x52d9fd[_0x3a58f1(0x27f)]))):log(_0x3a58f1(0x209)+_0x45d3af)),Promise['allSettled'](_0x143690)[_0x3a58f1(0x237)](_0x3de696=>{_0x133442();});});}function saveEpisodeInfo(_0x11ea78,_0x233ca9,_0x2e8773,_0x33a111,_0x1c483f){return new Promise((_0x42afd9,_0x27fb5a)=>{const _0x20768d=_0x133e;if(!mediaTypeConfig[_0x20768d(0x260)][_0x20768d(0x21c)](path[_0x20768d(0x282)](_0x2e8773)[_0x20768d(0x261)]()))return log(_0x20768d(0x22a)+_0x2e8773),_0x42afd9();if(!_0x233ca9['episodes']||_0x233ca9[_0x20768d(0x2b3)][_0x20768d(0x21e)]<0x1)return log(_0x20768d(0x29c)),_0x42afd9();let _0x3a7653;for(let _0x147764 of _0x233ca9[_0x20768d(0x2b3)]){if(_0x147764['episode_number']==_0x33a111){_0x3a7653=_0x147764;break;}}if(!_0x3a7653)return log(_0x20768d(0x273)+_0x33a111),_0x42afd9();_0x233ca9[_0x20768d(0x220)]&&(_0x3a7653[_0x20768d(0x204)]=_0x233ca9[_0x20768d(0x220)]);_0x3a7653[_0x20768d(0x223)]=_0x33a111;let {dir:_0x5f5442,name:_0x1ce03f}=path[_0x20768d(0x2a4)](path['join'](_0x11ea78,_0x2e8773)),_0x45362f=path[_0x20768d(0x1e5)](_0x5f5442,_0x1ce03f)+_0x20768d(0x1e0),_0x3991c7=path[_0x20768d(0x1e5)](_0x5f5442,_0x1ce03f)+_0x20768d(0x293);downloadPosterAndSaveNfo(_0x45362f,_0x3a7653[_0x20768d(0x276)],_0x3a7653,_0x3991c7,_0x20768d(0x24f),null,_0x1c483f)[_0x20768d(0x237)](_0xcd7dc8=>{_0x42afd9();});});}function detectIsMissingEpisodeInfo(_0xa31d29){const _0x32c0ab=_0x361498;let _0x2b46cc=fs[_0x32c0ab(0x21a)](_0xa31d29),_0x2acbce=![];for(let _0x12d318 of _0x2b46cc){let _0x37a502=path[_0x32c0ab(0x282)](_0x12d318)?path['extname'](_0x12d318)[_0x32c0ab(0x261)]():null;if(_0x37a502&&config[_0x32c0ab(0x260)][_0x32c0ab(0x21c)](_0x37a502)){let _0x2abd28=_0x12d318[_0x32c0ab(0x1f0)](0x0,_0x12d318['lastIndexOf']('.')),_0x24eea3=path[_0x32c0ab(0x1e5)](_0xa31d29,_0x2abd28+_0x32c0ab(0x293));if(!fs['existsSync'](_0x24eea3))return console['log'](_0x32c0ab(0x2c0)+_0x24eea3),_0x2acbce=!![],_0x2acbce;}}return _0x2acbce;}function saveSeasonInfo(_0x29ee5d,_0xcd60b2,_0x348ecc,_0x3db4d8,_0x427ecc){return new Promise((_0x4641b1,_0x337659)=>{const _0x447a9c=_0x133e;if(!_0xcd60b2[_0x447a9c(0x27e)]||_0xcd60b2['seasons'][_0x447a9c(0x21e)]<0x1)return log(_0x447a9c(0x2a5)),_0x4641b1();let _0x36170d;for(let _0x4a432f of _0xcd60b2[_0x447a9c(0x27e)]){log(_0x447a9c(0x1f6)+_0x4a432f[_0x447a9c(0x220)]);if(_0x4a432f['season_number']==_0x348ecc){_0x36170d=_0x4a432f;break;}}if(!_0x36170d)return log(_0x447a9c(0x287)+_0x348ecc),_0x4641b1();let _0xae2a2c,_0x2dc2ee,_0x5264cc,_0x5187f4;if(_0x3db4d8){let _0x3d2c67=_0x348ecc+'';if(_0x348ecc<0xa)_0x3d2c67='0'+_0x348ecc;_0xae2a2c=path['join'](path[_0x447a9c(0x207)](_0x29ee5d),'season'+_0x3d2c67+_0x447a9c(0x2b7)),_0x5264cc=path[_0x447a9c(0x1e5)](_0x29ee5d,_0x447a9c(0x219)),_0x5187f4=path[_0x447a9c(0x1e5)](path[_0x447a9c(0x207)](_0x29ee5d),_0x447a9c(0x280));}else _0xae2a2c=path[_0x447a9c(0x1e5)](_0x29ee5d,_0x447a9c(0x297)),_0x5264cc=path['join'](_0x29ee5d,_0x447a9c(0x288)),_0x5187f4=path[_0x447a9c(0x1e5)](_0x29ee5d,'fanart.jpg'),!_0x36170d[_0x447a9c(0x27f)]&&(_0x36170d[_0x447a9c(0x27f)]=_0xcd60b2[_0x447a9c(0x27f)]);!_0x36170d[_0x447a9c(0x276)]&&(_0x36170d['cover_url']=_0xcd60b2[_0x447a9c(0x276)]),_0x36170d[_0x447a9c(0x204)]=_0x348ecc,_0xcd60b2[_0x447a9c(0x1ed)]&&_0x36170d[_0x447a9c(0x1ed)]&&(_0x36170d['showtitle']=_0xcd60b2['movie_name']+'\x20'+_0x36170d[_0x447a9c(0x1ed)],_0x36170d[_0x447a9c(0x1ed)]=_0x36170d[_0x447a9c(0x201)]),_0xcd60b2['actors']&&!_0x36170d['actors']&&(_0x36170d['actors']=_0xcd60b2['actors']),_0xcd60b2[_0x447a9c(0x2cf)]&&!_0x36170d[_0x447a9c(0x2cf)]&&(_0x36170d[_0x447a9c(0x2cf)]=_0xcd60b2[_0x447a9c(0x2cf)]),_0xcd60b2['directors']&&!_0x36170d[_0x447a9c(0x1e6)]&&(_0x36170d[_0x447a9c(0x1e6)]=_0xcd60b2[_0x447a9c(0x1e6)]),_0xcd60b2[_0x447a9c(0x245)]&&!_0x36170d['directorsOriginal']&&(_0x36170d['directorsOriginal']=_0xcd60b2[_0x447a9c(0x245)]),_0xcd60b2[_0x447a9c(0x24c)]&&!_0x36170d['creator']&&(_0x36170d[_0x447a9c(0x24c)]=_0xcd60b2['creator']),_0xcd60b2[_0x447a9c(0x26d)]&&!_0x36170d['creatorOriginal']&&(_0x36170d[_0x447a9c(0x26d)]=_0xcd60b2[_0x447a9c(0x26d)]),_0xcd60b2[_0x447a9c(0x28a)]&&!_0x36170d[_0x447a9c(0x28a)]&&(_0x36170d[_0x447a9c(0x28a)]=_0xcd60b2[_0x447a9c(0x28a)]),_0xcd60b2['genres']&&!_0x36170d[_0x447a9c(0x1fc)]&&(_0x36170d[_0x447a9c(0x1fc)]=_0xcd60b2[_0x447a9c(0x1fc)]),_0xcd60b2[_0x447a9c(0x2cb)]&&!_0x36170d['regions']&&(_0x36170d['regions']=_0xcd60b2[_0x447a9c(0x2cb)]),_0xcd60b2[_0x447a9c(0x218)]&&(_0x36170d['tmdb_id']=_0xcd60b2[_0x447a9c(0x218)]),downloadPosterAndSaveNfo(_0xae2a2c,_0x36170d[_0x447a9c(0x276)],_0x36170d,_0x5264cc,_0x447a9c(0x26a),_0x5187f4,_0x427ecc)[_0x447a9c(0x237)](_0x2316ba=>{const _0x211691=_0x447a9c;log('season海报和nfo保存完毕');if(!_0xcd60b2['tmdb_id'])return _0x4641b1();if(_0x427ecc&&!detectIsMissingEpisodeInfo(_0x29ee5d))return log(_0x211691(0x1f2)),_0x4641b1();let _0xdfce36=getTmdbApi();_0xdfce36[_0x211691(0x29b)](_0xcd60b2[_0x211691(0x218)],_0x348ecc)[_0x211691(0x237)](_0x286457=>{const _0x7298bf=_0x211691;log(_0x7298bf(0x1f5)),fs[_0x7298bf(0x2c4)](_0x29ee5d,(_0x383944,_0x4dc4a4)=>{const _0x581553=_0x7298bf;if(_0x383944)return _0x4641b1();let _0x1a6477=[];for(let _0x4f93d1 of _0x4dc4a4){try{let _0x3fc95f=path[_0x581553(0x1e5)](_0x29ee5d,_0x4f93d1),_0x457f90=fs['statSync'](_0x3fc95f);if(_0x457f90[_0x581553(0x20b)]()){let _0x3d98ca=movieSeasonUtil['extractEpisodeNumbers'](_0x4f93d1);_0x3d98ca&&_0x3d98ca['episode']&&_0x3d98ca[_0x581553(0x223)]>0x0&&_0x1a6477[_0x581553(0x28f)](saveEpisodeInfo(_0x29ee5d,_0x286457,_0x4f93d1,_0x3d98ca[_0x581553(0x223)],_0x427ecc));}}catch(_0x109478){log(_0x109478);continue;}}Promise['allSettled'](_0x1a6477)[_0x581553(0x237)](_0x13c2d3=>{_0x4641b1();});});})['catch'](_0x3260f6=>{const _0x1b6a83=_0x211691;return log(_0x3260f6),addScrapeLog(path[_0x1b6a83(0x1e5)](workerData['path']),'API_SEASON_DETAIL','','',_0x1b6a83(0x236),_0x3260f6[_0x1b6a83(0x22e)]?_0x3260f6[_0x1b6a83(0x22e)]:_0x1b6a83(0x256)),_0x4641b1();});});});}function onSearchFinish(_0x35b71e,_0x27f87f,_0x1e021f){return new Promise((_0x431a7e,_0x168aa3)=>{const _0xdeb2e1=_0x133e;let _0x395248=path[_0xdeb2e1(0x1e5)](_0x35b71e[_0xdeb2e1(0x259)],_0x35b71e[_0xdeb2e1(0x1f3)]),_0x7ed9ed=_0x35b71e['is_tvplay']==0x1,_0x306c7e=getTmdbApi();_0x306c7e[_0xdeb2e1(0x25e)](_0x27f87f,_0x7ed9ed)[_0xdeb2e1(0x237)](_0x4b8803=>{const _0x2141fb=_0xdeb2e1;if(!_0x7ed9ed){let {dir:_0x5c1c26,name:_0x1566eb}=path['parse'](_0x395248),_0x21ffa0=path[_0x2141fb(0x1e5)](_0x5c1c26,_0x1566eb+_0x2141fb(0x1e0)),_0x4cff8e=_0x4b8803[_0x2141fb(0x276)],_0x5e7a27=path[_0x2141fb(0x1e5)](_0x5c1c26,_0x1566eb+_0x2141fb(0x293)),_0x558977=path[_0x2141fb(0x1e5)](_0x5c1c26,_0x1566eb+_0x2141fb(0x1e7));downloadPosterAndSaveNfo(_0x21ffa0,_0x4cff8e,_0x4b8803,_0x5e7a27,'movie',_0x558977,_0x1e021f)[_0x2141fb(0x237)](_0x2f2125=>{const _0x2f8f9c=_0x2141fb;return log(_0x2f8f9c(0x26b)),_0x431a7e();});}else{let _0x80853e=movieSeasonUtil[_0x2141fb(0x24d)](path[_0x2141fb(0x292)](_0x35b71e[_0x2141fb(0x259)]));if(_0x80853e>-0x1){log(_0x2141fb(0x254)+_0x395248);let {dir:_0x3c7de7,name:_0x16c6bb}=path[_0x2141fb(0x2a4)](_0x395248),_0x5b3b51=path[_0x2141fb(0x1e5)](path[_0x2141fb(0x207)](_0x3c7de7),'poster.jpg'),_0x316a23=path[_0x2141fb(0x1e5)](path['dirname'](_0x3c7de7),_0x2141fb(0x280)),_0x534095=path['join'](path['dirname'](_0x3c7de7),_0x2141fb(0x288));downloadPosterAndSaveNfo(_0x5b3b51,_0x4b8803[_0x2141fb(0x276)],_0x4b8803,_0x534095,_0x2141fb(0x26a),_0x316a23,_0x1e021f)[_0x2141fb(0x237)](_0x560940=>{const _0x1eede5=_0x2141fb;log(_0x1eede5(0x227)),fs[_0x1eede5(0x2c4)](path[_0x1eede5(0x207)](_0x3c7de7),(_0x5e8ed8,_0x57f747)=>{const _0x190b9b=_0x1eede5;if(_0x5e8ed8)return _0x431a7e();let _0x3ea69d=[];for(let _0x1d643f of _0x57f747){try{let _0x2db0d4=path['join'](path[_0x190b9b(0x207)](_0x3c7de7),_0x1d643f),_0x11ebcc=fs[_0x190b9b(0x1e8)](_0x2db0d4);if(_0x11ebcc[_0x190b9b(0x226)]()){let _0x55f90a=movieSeasonUtil[_0x190b9b(0x24d)](_0x1d643f);_0x55f90a>-0x1&&_0x3ea69d['push'](saveSeasonInfo(_0x2db0d4,_0x4b8803,_0x55f90a,!![],_0x1e021f));}}catch(_0x1d19de){log(_0x1d19de);continue;}}Promise[_0x190b9b(0x2ac)](_0x3ea69d)['then'](_0x563f53=>{_0x431a7e();});});});}else{log(_0x2141fb(0x202)+_0x395248);let _0x4e709f=movieSeasonUtil[_0x2141fb(0x24d)](path[_0x2141fb(0x292)](_0x35b71e[_0x2141fb(0x259)]),![]);if(_0x4e709f>-0x1)saveSeasonInfo(path[_0x2141fb(0x207)](_0x395248),_0x4b8803,_0x4e709f,![],_0x1e021f)['then'](_0x59441c=>{_0x431a7e();});else{let _0x4a2ac7=movieSeasonUtil['extractEpisodeNumbers'](_0x395248);_0x4a2ac7&&_0x4a2ac7[_0x2141fb(0x204)]&&_0x4a2ac7['season']>0x0?saveSeasonInfo(path['dirname'](_0x395248),_0x4b8803,_0x4a2ac7[_0x2141fb(0x204)],![],_0x1e021f)[_0x2141fb(0x237)](_0x5b7d61=>{_0x431a7e();}):(log(_0x2141fb(0x25f)),saveSeasonInfo(path[_0x2141fb(0x207)](_0x395248),_0x4b8803,0x1,![],_0x1e021f)[_0x2141fb(0x237)](_0x28434f=>{_0x431a7e();}));}}}})[_0xdeb2e1(0x2a2)](_0x4ee014=>{const _0x4f91d8=_0xdeb2e1;return log(_0x4ee014),addScrapeLog(path[_0x4f91d8(0x1e5)](workerData['path']),_0x4f91d8(0x2be),'','',_0x4f91d8(0x236),_0x4ee014[_0x4f91d8(0x22e)]?_0x4ee014[_0x4f91d8(0x22e)]:_0x4f91d8(0x256)),_0x431a7e();});});}function addScrapeLog(_0x45aacb,_0x9ad6eb,_0x265b51,_0xa65a63,_0x29340b,_0x3c6729){const _0x18c649=_0x361498;dbFileIndex[_0x18c649(0x1ff)](_0x18c649(0x2bd))[_0x18c649(0x247)](_0x45aacb,_0x9ad6eb,_0x265b51,_0xa65a63,_0x29340b,_0x3c6729,Date[_0x18c649(0x20e)]());}function getTvExistTmdbId(_0x575416){const _0x256744=_0x361498;if(_0x575416[_0x256744(0x2a3)]!=0x1)return null;let _0x5b0c02=path['dirname'](_0x575416[_0x256744(0x259)]),_0x1846d8=movieSeasonUtil[_0x256744(0x24d)](path[_0x256744(0x292)](_0x575416[_0x256744(0x259)]),!![]),_0x4e857a=null,_0xccfbb1='';_0x1846d8>-0x1&&(_0xccfbb1=path['join'](_0x5b0c02,_0x256744(0x288)));(!_0xccfbb1||!fs[_0x256744(0x265)](_0xccfbb1))&&(_0xccfbb1=path[_0x256744(0x1e5)](_0x575416[_0x256744(0x259)],_0x256744(0x288)));if(!_0xccfbb1||!fs[_0x256744(0x265)](_0xccfbb1))return null;const _0x14087d=new XMLParser();let _0x52f14d=_0x14087d[_0x256744(0x2a4)](fs[_0x256744(0x2ab)](_0xccfbb1));return _0x52f14d[_0x256744(0x26a)]&&(_0x52f14d=_0x52f14d[_0x256744(0x26a)],_0x52f14d[_0x256744(0x1e2)]&&(_0x4e857a=_0x52f14d[_0x256744(0x1e2)])),{'tmdbId':_0x4e857a,'seassonNumber':_0x1846d8};}function searchMovieInfo(_0x2cae6a,_0x520208){const _0x19aee5=_0x361498;return!_0x520208&&(_0x520208=getQueryArray(_0x2cae6a)),log(JSON[_0x19aee5(0x1f1)](_0x520208)),new Promise((_0x4c7f26,_0x43e690)=>{const _0x37e9af=_0x19aee5;function _0x1d5cb2(){return _0x43e690();}if(!_0x520208||_0x520208[_0x37e9af(0x21e)]<0x1)return log('要查询的数据不存在'),_0x1d5cb2();let _0x48ae73=_0x520208[0x0][_0x37e9af(0x240)],_0x16e6a4=_0x520208[0x0][_0x37e9af(0x2c7)];log(_0x37e9af(0x266),_0x48ae73[_0x37e9af(0x240)]);let _0x45884e=getTmdbApi();if(!_0x45884e)return log(_0x37e9af(0x299)),_0x1d5cb2();let _0x450b78=_0x2cae6a[_0x37e9af(0x2a3)]==0x1;_0x45884e['search'](_0x48ae73,_0x450b78,_0x16e6a4)['then'](_0x31b2d8=>{const _0x2c0b04=_0x37e9af;if(_0x31b2d8&&_0x31b2d8[_0x2c0b04(0x21e)]>0x0){let _0x53b97b=_0x31b2d8[0x0];onSearchFinish(_0x2cae6a,_0x53b97b[_0x2c0b04(0x218)])[_0x2c0b04(0x237)](()=>{return _0x4c7f26();});}else{if(_0x520208[_0x2c0b04(0x21e)]>0x1){let _0x101faf=_0x520208[_0x2c0b04(0x1f7)](0x1);return searchMovieInfo(_0x2cae6a,_0x101faf)[_0x2c0b04(0x237)](_0x4c7f26);}else return log('tmdb.没有获取到相关信息',_0x48ae73),addScrapeLog(path[_0x2c0b04(0x1e5)](workerData['path']),_0x2c0b04(0x2be),'','','FAIL',i18n['__'](_0x2c0b04(0x22f))),_0x1d5cb2();}})['catch'](_0x44deb5=>{const _0x4465f3=_0x37e9af;return log(_0x4465f3(0x285),_0x44deb5),_0x1d5cb2();});});}function returnResult(){const _0xaf7321=_0x361498;log('刮削任务结束'),parentPort['postMessage']({'code':0x0}),process[_0xaf7321(0x24e)](0x0);}function log(_0x45b2fc){const _0x456839=_0x361498;parentPort[_0x456839(0x243)]({'type':'log','message':_0x45b2fc});}if(workerData&&workerData[_0x361498(0x1f3)]&&workerData['path']&&workerData[_0x361498(0x23a)]&&workerData[_0x361498(0x1e3)]&&workerData[_0x361498(0x21b)]){if(workerData[_0x361498(0x218)])log(_0x361498(0x20a)),onSearchFinish(workerData,workerData['tmdb_id'])[_0x361498(0x237)](_0x1bbba1=>{const _0x195c61=_0x361498;log(_0x195c61(0x234),workerData['tmdb_id'],workerData[_0x195c61(0x259)],workerData[_0x195c61(0x1f3)]),returnResult();})[_0x361498(0x2a2)](_0x241c01=>{returnResult();});else{if(workerData['scrapeMissing']==0x1){log(_0x361498(0x2c9));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId[_0x361498(0x248)]){addScrapeLog(path['join'](workerData[_0x361498(0x259)]),_0x361498(0x29e),'','',_0x361498(0x236),i18n['__'](_0x361498(0x242)));return;}let tmdbId=foundTmdbId[_0x361498(0x248)];onSearchFinish(workerData,tmdbId,!![])[_0x361498(0x237)](_0x166754=>{const _0x5ce5a2=_0x361498;log(_0x5ce5a2(0x234)),returnResult();})['catch'](_0x41788f=>{returnResult();});}else log(_0x361498(0x278)),searchMovieInfo(workerData)[_0x361498(0x237)](_0x87935c=>{const _0x33bca8=_0x361498;log(_0x33bca8(0x234)+workerData[_0x33bca8(0x259)]+'\x20'+workerData[_0x33bca8(0x1f3)]),returnResult();})['catch'](_0x1fe0f5=>{returnResult();});}}else log(_0x361498(0x2aa)),returnResult();