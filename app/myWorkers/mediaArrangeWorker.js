const _0x3df280=_0x57d8;(function(_0x1ad8c7,_0x238f2c){const _0x2736f5=_0x57d8,_0xb186ce=_0x1ad8c7();while(!![]){try{const _0x4cd4c0=parseInt(_0x2736f5(0xf2))/0x1*(parseInt(_0x2736f5(0x11a))/0x2)+parseInt(_0x2736f5(0xef))/0x3+parseInt(_0x2736f5(0x122))/0x4*(parseInt(_0x2736f5(0xfc))/0x5)+-parseInt(_0x2736f5(0xf3))/0x6*(parseInt(_0x2736f5(0x105))/0x7)+parseInt(_0x2736f5(0x124))/0x8*(-parseInt(_0x2736f5(0xfa))/0x9)+parseInt(_0x2736f5(0x115))/0xa+parseInt(_0x2736f5(0x100))/0xb*(-parseInt(_0x2736f5(0xfe))/0xc);if(_0x4cd4c0===_0x238f2c)break;else _0xb186ce['push'](_0xb186ce['shift']());}catch(_0x2e8b2e){_0xb186ce['push'](_0xb186ce['shift']());}}}(_0x5e41,0x19ff0));const Database=require(_0x3df280(0x127)),config=require(_0x3df280(0x118));let dbOther=new Database(config[_0x3df280(0xfb)],{});function _0x57d8(_0xfd148a,_0x2d4e05){const _0x5e4138=_0x5e41();return _0x57d8=function(_0x57d83d,_0x1436b9){_0x57d83d=_0x57d83d-0xee;let _0x1dc96e=_0x5e4138[_0x57d83d];return _0x1dc96e;},_0x57d8(_0xfd148a,_0x2d4e05);}dbOther[_0x3df280(0x11f)](_0x3df280(0xee));let path=require(_0x3df280(0xf1)),fs=require('fs'),i18nUtil=require(_0x3df280(0xff));const dbMediaTools=require(_0x3df280(0xf0)),mediaUtils=require(_0x3df280(0x117));let i18n=i18nUtil[_0x3df280(0x116)](dbOther);process[_0x3df280(0x112)]=_0x3df280(0x109);let currentTaskObj=null,copyFileCount=0x0,copySize=0x0,totalSize=0x0,failCount=0x0,taskExist=!![];async function copyFile(_0x3c5631,_0x8673fd){const _0x4d8e98=_0x3df280;try{let _0xb0c724=fs[_0x4d8e98(0x110)](_0x3c5631);totalSize+=_0xb0c724[_0x4d8e98(0x10b)],fs['cpSync'](_0x3c5631,_0x8673fd,{'preserveTimestamps':!![]}),copySize+=_0xb0c724[_0x4d8e98(0x10b)],copyFileCount+=0x1,updateTask(dbMediaTools[_0x4d8e98(0x10d)],JSON['stringify']({'copy_size':copySize,'copy_count':copyFileCount,'fail_count':failCount}));}catch(_0x54079a){failCount+=0x1;}}function genFilePath(_0x5ec749){const _0x51cb8b=_0x3df280;if(!fs[_0x51cb8b(0xf7)](_0x5ec749))return _0x5ec749;let _0x5e6857=path[_0x51cb8b(0x129)](_0x5ec749,path[_0x51cb8b(0x128)](_0x5ec749)),_0x3edf66=path['extname'](_0x5ec749),_0xd59e0b=0x1;while(!![]){let _0x347813=_0x5e6857+'('+_0xd59e0b+')'+_0x3edf66,_0x1248c5=path['join'](path['dirname'](_0x5ec749),_0x347813);if(!fs[_0x51cb8b(0xf7)](_0x1248c5))return _0x1248c5;_0xd59e0b+=0x1;}}function _0x5e41(){const _0x2689b2=['readdirSync','close','join','accessSync','856562QaRLZH','err2','length','未传递任务数据','NasCabMediaArrangeWorker','updateTask','size','R_OK','TASK_STATE_RUNNING','taskData','targetFolderNotExist','statSync','getFileTime','title','isDirectory','constants','1527540cXAQGA','getI18n','../utils/mediaUtils','../myConfig/config','uncaughtException','2hugdXk','mkdirSync','noWritePermission','source_path','getMonth','pragma','folderNotExist','stringify','44RevgmT','message','8SnxXOz','task_json','getFullYear','better-sqlite3','extname','basename','getDate','err1','log','getByIdAndCreateTime','journal_mode\x20=\x20WAL','87864AaZwUE','../db/dbMediaTools','path','147185FEuXVZ','6PPGxXA','fileCopyFail','TASK_STATE_SUC','parse','existsSync','send','任务已不存在','631890ERokTe','dbOther','11055mILLEx','taskObj','72rJPZpD','../utils/i18nUtil','99902NhGMBP'];_0x5e41=function(){return _0x2689b2;};return _0x5e41();}async function copyFolder(_0x15c39c,_0x4f39fa){const _0x1e5352=_0x3df280;console['log']('复制文件夹',_0x15c39c);let _0x31ff7a=checkFolderPower(_0x15c39c,!![]);if(!_0x31ff7a)console[_0x1e5352(0x12c)]('无读取权限',_0x15c39c),failCount+=0x1;else try{let _0x274c58=fs[_0x1e5352(0x101)](_0x15c39c);for(let _0x1b9810=0x0;_0x1b9810<_0x274c58[_0x1e5352(0x107)];_0x1b9810++){if(!taskExist||!currentTaskObjIsExist()){console['log'](_0x1e5352(0xf9));return;}let _0x23847c=_0x274c58[_0x1b9810];var _0x376289=path[_0x1e5352(0x103)](_0x15c39c,_0x23847c);let _0x136af=fs['statSync'](_0x376289);var _0x159b4c=_0x136af['isFile'](),_0x7fa56d=_0x136af[_0x1e5352(0x113)]();if(_0x159b4c){let _0x50c848=await mediaUtils[_0x1e5352(0x111)](_0x376289),_0x4672e4=new Date(_0x50c848),_0x48d1d0=_0x4672e4[_0x1e5352(0x126)](),_0x4a0ab2=_0x4672e4[_0x1e5352(0x11e)]()+0x1,_0x48a2e9=_0x4672e4[_0x1e5352(0x12a)](),_0x17af7a=path['join'](_0x4f39fa,_0x48d1d0+'',_0x4a0ab2+'',_0x48a2e9+'');!fs['existsSync'](_0x17af7a)&&fs[_0x1e5352(0x11b)](_0x17af7a,{'recursive':!![]});let _0x288867=path[_0x1e5352(0x103)](_0x17af7a,_0x23847c);_0x288867=genFilePath(_0x288867),await copyFile(_0x376289,_0x288867);}else _0x7fa56d&&await copyFolder(_0x376289,_0x4f39fa);}}catch(_0x4f465e){console[_0x1e5352(0x12c)](_0x4f465e),failCount+=0x1;}}function checkFolderPower(_0x27d253,_0x1ced30){const _0x4bc9f5=_0x3df280;try{return _0x1ced30?fs[_0x4bc9f5(0x104)](_0x27d253,fs['constants'][_0x4bc9f5(0x10c)]):fs[_0x4bc9f5(0x104)](_0x27d253,fs['constants'][_0x4bc9f5(0x10c)]|fs[_0x4bc9f5(0x114)]['W_OK']),!![];}catch(_0x246a46){return![];}}async function runCurrentTask(){const _0xda3cb1=_0x3df280;let _0x41a08e=currentTaskObj[_0xda3cb1(0x10e)][_0xda3cb1(0x11d)],_0x3448f6=currentTaskObj[_0xda3cb1(0x10e)]['target_path'];if(!fs[_0xda3cb1(0xf7)](_0x3448f6)){console['log'](_0xda3cb1(0x12b),i18n['__'](_0xda3cb1(0x10f))),updateTask(dbMediaTools['TASK_STATE_FAIL'],i18n['__'](_0xda3cb1(0x10f)));return;}let _0x11187e=checkFolderPower(_0x3448f6);if(!_0x11187e){console['log'](_0xda3cb1(0x106),i18n['__'](_0xda3cb1(0x11c))),updateTask(dbMediaTools['TASK_STATE_FAIL'],i18n['__'](_0xda3cb1(0x11c)));return;}updateTask(dbMediaTools[_0xda3cb1(0x10d)],''),copyFileCount=0x0,copySize=0x0,excludeCount=0x0,totalSize=0x0;try{fs['existsSync'](_0x41a08e)?(await copyFolder(_0x41a08e,_0x3448f6),updateTask(dbMediaTools[_0xda3cb1(0xf5)],JSON[_0xda3cb1(0x121)]({'copy_size':copySize,'copy_count':copyFileCount,'fail_count':failCount}))):updateTask(dbMediaTools['TASK_STATE_FAIL'],i18n['__'](_0xda3cb1(0x120))+':'+_0x41a08e);}catch(_0x46ed2c){console['log'](_0x46ed2c),updateTask(dbMediaTools['TASK_STATE_FAIL'],i18n['__'](_0xda3cb1(0xf4))+':'+_0x41a08e+':'+JSON[_0xda3cb1(0x121)](_0x46ed2c));}}function exitProcess(){const _0x1b0ac4=_0x3df280;console[_0x1b0ac4(0x12c)]('结束媒体整理线程'),process[_0x1b0ac4(0xf8)]({'type':_0x1b0ac4(0x102)}),process['exit']();}function updateTask(_0x370bf7,_0x5de3ef){const _0x37be9b=_0x3df280;dbMediaTools[_0x37be9b(0x10a)](dbOther,currentTaskObj['id'],_0x370bf7,_0x5de3ef);}function currentTaskObjIsExist(){const _0x3e555e=_0x3df280;if(currentTaskObj){let _0x229d3b=dbMediaTools[_0x3e555e(0x12d)](dbOther,currentTaskObj['id'],currentTaskObj['create_time']);if(_0x229d3b)return!![];}return taskExist=![],console[_0x3e555e(0x12c)](_0x3e555e(0xf9)),![];}process['on'](_0x3df280(0x123),async _0x2e2def=>{const _0x1c5667=_0x3df280;_0x2e2def[_0x1c5667(0xfd)]?(currentTaskObj=_0x2e2def[_0x1c5667(0xfd)],currentTaskObj[_0x1c5667(0x10e)]=JSON[_0x1c5667(0xf6)](currentTaskObj[_0x1c5667(0x125)]),await runCurrentTask(),exitProcess()):(console[_0x1c5667(0x12c)](_0x1c5667(0x108)),exitProcess());}),process['on'](_0x3df280(0x119),_0x3a0f67=>{const _0x4f296e=_0x3df280;console[_0x4f296e(0x12c)]('媒体整理\x20线程异常',_0x3a0f67),exitProcess();});