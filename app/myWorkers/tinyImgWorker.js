const _0x1bd248=_0x12ba;(function(_0x209737,_0x44d0a1){const _0x4b62dd=_0x12ba,_0x16c3df=_0x209737();while(!![]){try{const _0x34a38b=-parseInt(_0x4b62dd(0x196))/0x1*(-parseInt(_0x4b62dd(0x185))/0x2)+-parseInt(_0x4b62dd(0x1a5))/0x3+-parseInt(_0x4b62dd(0x17b))/0x4+-parseInt(_0x4b62dd(0x194))/0x5+parseInt(_0x4b62dd(0x19e))/0x6*(parseInt(_0x4b62dd(0x19c))/0x7)+-parseInt(_0x4b62dd(0x172))/0x8+-parseInt(_0x4b62dd(0x184))/0x9*(-parseInt(_0x4b62dd(0x188))/0xa);if(_0x34a38b===_0x44d0a1)break;else _0x16c3df['push'](_0x16c3df['shift']());}catch(_0x23e547){_0x16c3df['push'](_0x16c3df['shift']());}}}(_0x44df,0xc5091));const config=require('../myConfig/config');let fs=require('fs'),path=require(_0x1bd248(0x175)),sharpUtil=require(_0x1bd248(0x19b));const dbFileIndexTable=require(_0x1bd248(0x17f)),Database=require(_0x1bd248(0x17d));let dbOther=new Database(config[_0x1bd248(0x19f)],{'timeout':0xea60});dbOther['pragma']('journal_mode\x20=\x20WAL');let dbFileIndex=new Database(config[_0x1bd248(0x19d)],{'timeout':0xea60});function _0x12ba(_0x216f0a,_0x4dbf4a){const _0x44df49=_0x44df();return _0x12ba=function(_0x12ba56,_0x14c6e6){_0x12ba56=_0x12ba56-0x171;let _0x44fdc1=_0x44df49[_0x12ba56];return _0x44fdc1;},_0x12ba(_0x216f0a,_0x4dbf4a);}dbFileIndex[_0x1bd248(0x182)]('journal_mode\x20=\x20WAL');const messageUtil=require(_0x1bd248(0x178));process[_0x1bd248(0x181)]=_0x1bd248(0x19a);function dealFail(_0x58d6a0,_0x270580,_0x38e178,_0x45331f,_0x46e552){const _0x221f78=_0x1bd248;dbFileIndexTable[_0x221f78(0x199)](_0x270580,_0x45331f['id'],_0x221f78(0x18e),'0',_0x46e552),_0x58d6a0();}function genTiny(_0x4e604e,_0x5bbf5d,_0x6e12e8,_0x20f3a3,_0x4e96fc,_0x4843d7){const _0x28dc46=_0x1bd248;let _0x19f058=_0x28dc46(0x1a0);_0x20f3a3[_0x28dc46(0x186)]==0x2&&(_0x19f058=_0x28dc46(0x1a2));if(_0x20f3a3[_0x28dc46(0x18f)]==_0x28dc46(0x197)&&_0x20f3a3['size']>config[_0x28dc46(0x189)]){console['log'](_0x28dc46(0x17a),_0x6e12e8),dealFail(_0x4e604e,_0x5bbf5d,_0x6e12e8,_0x20f3a3,_0x4843d7);return;}sharpUtil[_0x28dc46(0x191)](_0x6e12e8,path[_0x28dc46(0x1a4)](_0x4e96fc),path[_0x28dc46(0x195)](_0x4e96fc),_0x19f058,_0x20f3a3,_0x51f7a2=>{const _0x563f0c=_0x28dc46;dbFileIndexTable['updateById'](_0x5bbf5d,_0x20f3a3['id'],_0x563f0c(0x18e),_0x51f7a2,_0x4843d7),_0x4e604e();},_0x307149=>{dealFail(_0x4e604e,_0x5bbf5d,_0x6e12e8,_0x20f3a3,_0x4843d7);});}function genStart(_0x37a7e8){return new Promise((_0x836bf3,_0x15130f)=>{const _0x2daffa=_0x12ba;let _0x3ddaf8=dbFileIndexTable[_0x2daffa(0x187)](dbFileIndex,'\x20tiny_path\x20is\x20null\x20and\x20type=1\x20LIMIT\x201','*',_0x37a7e8);!_0x3ddaf8&&(_0x3ddaf8=dbFileIndexTable[_0x2daffa(0x187)](dbFileIndex,_0x2daffa(0x17c),'*',_0x37a7e8));if(_0x3ddaf8){try{bgTaskId&&dbOther[_0x2daffa(0x171)](_0x2daffa(0x183)+bgTaskId)['run']();}catch(_0x8355f4){}let _0x313762=path[_0x2daffa(0x190)](_0x3ddaf8['path'],_0x3ddaf8['filename']),_0x3a757a=config[_0x2daffa(0x177)](_0x3ddaf8),_0x507d8d=path[_0x2daffa(0x190)](config[_0x2daffa(0x17e)],_0x3a757a);fs['stat'](_0x507d8d,(_0x3585fb,_0x3e6272)=>{const _0x344894=_0x2daffa;if(_0x3585fb)return genTiny(_0x836bf3,dbFileIndex,_0x313762,_0x3ddaf8,_0x507d8d,_0x37a7e8);_0x3e6272[_0x344894(0x179)]()&&_0x3e6272['size']>0x7d0?(dbFileIndexTable[_0x344894(0x199)](dbFileIndex,_0x3ddaf8['id'],_0x344894(0x18e),_0x507d8d,_0x37a7e8),_0x836bf3()):genTiny(_0x836bf3,dbFileIndex,_0x313762,_0x3ddaf8,_0x507d8d,_0x37a7e8);});}else _0x836bf3(_0x2daffa(0x18a));});}let bgTaskId;function _0x44df(){const _0x2f53c5=['maxPsdSize','noData','GEN_TINY_IMAGE','INDEX_TABLE_NAME_MOVIE','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','tiny_path','ext','join','genTinyFile','uncaughtException','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20task_type=\x27GEN_TINY_IMAGE\x27','7150080OInmCf','basename','479129IRjRlh','.psd','NEW_TINY_IMAGE','updateById','NasCabThumbnailWorker','../express-server/utils/sharpUtils','1505lCgPiL','dbFileIndex','3012ruhafW','dbOther','image','run','video','exit','dirname','628716CDPRId','prepare','4158184nsvREO','send','Error\x20occurred\x20in\x20thumbnail\x20process\x20','path','INDEX_TABLE_NAME_PHOTO','getFileHashName','../utils/messageUtil','isFile','PSD文件过大不生成缩略图','667836tRfckD','\x20tiny_path\x20is\x20null\x20and\x20type=2\x20LIMIT\x201','better-sqlite3','cachePath','../db/dbFileIndexTable','log','title','pragma','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','11458431cnYbcf','2gSGllD','type','getByWhere','20ckhtMH'];_0x44df=function(){return _0x2f53c5;};return _0x44df();}try{let info=dbOther[_0x1bd248(0x171)](_0x1bd248(0x18d))[_0x1bd248(0x1a1)](_0x1bd248(0x18b));bgTaskId=info['lastInsertRowid'];}catch(_0x4ec88a){}let genCount=0x0;async function runGen(){const _0x5b7e3c=_0x1bd248;try{let _0x404ac6=await genStart(dbFileIndexTable[_0x5b7e3c(0x176)]);_0x404ac6!=_0x5b7e3c(0x18a)&&(genCount+=0x1);let _0x56a791=await genStart(dbFileIndexTable[_0x5b7e3c(0x18c)]);if(_0x404ac6==_0x5b7e3c(0x18a)&&_0x56a791=='noData'){try{bgTaskId&&dbOther['prepare'](_0x5b7e3c(0x193))[_0x5b7e3c(0x1a1)]();}catch(_0x17a18e){}genCount>0x0&&process['send']({'type':_0x5b7e3c(0x198)}),process[_0x5b7e3c(0x173)]({'type':'close'}),process[_0x5b7e3c(0x1a3)]();}else return runGen();}catch(_0x43826f){return console[_0x5b7e3c(0x180)](_0x43826f),runGen();}}runGen();function exitProcess(){const _0x156f47=_0x1bd248;process[_0x156f47(0x173)]({'type':'close'}),process[_0x156f47(0x1a3)]();}process['on'](_0x1bd248(0x192),(_0x149a45,_0x4b6a15)=>{const _0x532b37=_0x1bd248;console[_0x532b37(0x180)](_0x532b37(0x174),_0x149a45),exitProcess();});