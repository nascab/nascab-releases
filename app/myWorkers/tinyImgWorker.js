function _0xf792(){const _0x5b6221=['NasCabThumbnailWorker','exit','uncaughtException','10083411dZlAmO','type','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','dbFileIndex','image','4602TbTfMM','run','noData','better-sqlite3','7007uIQNYM','basename','video','dbOther','genTinyFile','../express-server/utils/sharpUtils','\x20tiny_path\x20is\x20null\x20and\x20type=1\x20LIMIT\x201','send','1506980OerSHx','NEW_TINY_IMAGE','tiny_path','462ElLzmT','cachePath','INDEX_TABLE_NAME_MOVIE','stat','.psd','getByWhere','723OtRddI','8XbzTeL','prepare','isFile','updateById','lastInsertRowid','size','filename','journal_mode\x20=\x20WAL','\x20tiny_path\x20is\x20null\x20and\x20type=2\x20LIMIT\x201','1639088lgFHCR','getFileHashName','5462235npThED','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20task_type=\x27GEN_TINY_IMAGE\x27','PSD文件过大不生成缩略图','path','maxPsdSize','740283RrYLVl','dirname','log','close','join','Error\x20occurred\x20in\x20thumbnail\x20process\x20','../db/dbFileIndexTable'];_0xf792=function(){return _0x5b6221;};return _0xf792();}const _0x342ce5=_0x2110;(function(_0x39152f,_0x48cf08){const _0x302eab=_0x2110,_0x5ecefb=_0x39152f();while(!![]){try{const _0x158293=parseInt(_0x302eab(0x1f9))/0x1+parseInt(_0x302eab(0x208))/0x2*(parseInt(_0x302eab(0x1e8))/0x3)+-parseInt(_0x302eab(0x1f2))/0x4+parseInt(_0x302eab(0x1f4))/0x5+-parseInt(_0x302eab(0x1e2))/0x6*(parseInt(_0x302eab(0x20c))/0x7)+-parseInt(_0x302eab(0x1e9))/0x8*(parseInt(_0x302eab(0x203))/0x9)+-parseInt(_0x302eab(0x1df))/0xa;if(_0x158293===_0x48cf08)break;else _0x5ecefb['push'](_0x5ecefb['shift']());}catch(_0x42b6c6){_0x5ecefb['push'](_0x5ecefb['shift']());}}}(_0xf792,0x99a61));const config=require('../myConfig/config');function _0x2110(_0xa53d85,_0x50b7a7){const _0xf79299=_0xf792();return _0x2110=function(_0x2110fb,_0x33ad51){_0x2110fb=_0x2110fb-0x1d8;let _0x28a73d=_0xf79299[_0x2110fb];return _0x28a73d;},_0x2110(_0xa53d85,_0x50b7a7);}let fs=require('fs'),path=require(_0x342ce5(0x1f7)),sharpUtil=require(_0x342ce5(0x1dc));const dbFileIndexTable=require(_0x342ce5(0x1ff)),Database=require(_0x342ce5(0x20b));let dbOther=new Database(config[_0x342ce5(0x1da)],{'timeout':0xea60});dbOther['pragma'](_0x342ce5(0x1f0));let dbFileIndex=new Database(config[_0x342ce5(0x206)],{'timeout':0xea60});dbFileIndex['pragma']('journal_mode\x20=\x20WAL');const messageUtil=require('../utils/messageUtil');process['title']=_0x342ce5(0x200);function dealFail(_0x453118,_0x18b2d5,_0x15927a,_0xac4dd,_0x2aed85){const _0x3e6a90=_0x342ce5;dbFileIndexTable[_0x3e6a90(0x1ec)](_0x18b2d5,_0xac4dd['id'],_0x3e6a90(0x1e1),'0',_0x2aed85),_0x453118();}function genTiny(_0x52fc73,_0x175ec0,_0x3962b5,_0x6ae94e,_0x227c74,_0x175ef8){const _0x45a500=_0x342ce5;let _0x13269a=_0x45a500(0x207);_0x6ae94e[_0x45a500(0x204)]==0x2&&(_0x13269a=_0x45a500(0x1d9));if(_0x6ae94e['ext']==_0x45a500(0x1e6)&&_0x6ae94e[_0x45a500(0x1ee)]>config[_0x45a500(0x1f8)]){console[_0x45a500(0x1fb)](_0x45a500(0x1f6),_0x3962b5),dealFail(_0x52fc73,_0x175ec0,_0x3962b5,_0x6ae94e,_0x175ef8);return;}sharpUtil[_0x45a500(0x1db)](_0x3962b5,path[_0x45a500(0x1fa)](_0x227c74),path[_0x45a500(0x1d8)](_0x227c74),_0x13269a,_0x6ae94e,_0x25fb0e=>{const _0x5849bb=_0x45a500;dbFileIndexTable['updateById'](_0x175ec0,_0x6ae94e['id'],_0x5849bb(0x1e1),_0x25fb0e,_0x175ef8),_0x52fc73();},_0x8a9e68=>{dealFail(_0x52fc73,_0x175ec0,_0x3962b5,_0x6ae94e,_0x175ef8);});}function genStart(_0x2e9720){return new Promise((_0x445060,_0x33182a)=>{const _0x158254=_0x2110;let _0x31e22b=dbFileIndexTable[_0x158254(0x1e7)](dbFileIndex,_0x158254(0x1dd),'*',_0x2e9720);!_0x31e22b&&(_0x31e22b=dbFileIndexTable[_0x158254(0x1e7)](dbFileIndex,_0x158254(0x1f1),'*',_0x2e9720));if(_0x31e22b){try{bgTaskId&&dbOther[_0x158254(0x1ea)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)[_0x158254(0x209)]();}catch(_0x5551ab){}let _0x43646a=path[_0x158254(0x1fd)](_0x31e22b['path'],_0x31e22b[_0x158254(0x1ef)]),_0x24c0e0=config[_0x158254(0x1f3)](_0x31e22b),_0x4393c4=path[_0x158254(0x1fd)](config[_0x158254(0x1e3)],_0x24c0e0);fs[_0x158254(0x1e5)](_0x4393c4,(_0x2518b6,_0x4cf756)=>{const _0x28d5f9=_0x158254;if(_0x2518b6)return genTiny(_0x445060,dbFileIndex,_0x43646a,_0x31e22b,_0x4393c4,_0x2e9720);_0x4cf756[_0x28d5f9(0x1eb)]()&&_0x4cf756[_0x28d5f9(0x1ee)]>0x7d0?(dbFileIndexTable[_0x28d5f9(0x1ec)](dbFileIndex,_0x31e22b['id'],_0x28d5f9(0x1e1),_0x4393c4,_0x2e9720),_0x445060()):genTiny(_0x445060,dbFileIndex,_0x43646a,_0x31e22b,_0x4393c4,_0x2e9720);});}else _0x445060(_0x158254(0x20a));});}let bgTaskId;try{let info=dbOther[_0x342ce5(0x1ea)](_0x342ce5(0x205))[_0x342ce5(0x209)]('GEN_TINY_IMAGE');bgTaskId=info[_0x342ce5(0x1ed)];}catch(_0x4f4835){}let genCount=0x0;async function runGen(){const _0x1a78d1=_0x342ce5;try{let _0x327d30=await genStart(dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']);_0x327d30!=_0x1a78d1(0x20a)&&(genCount+=0x1);let _0x312239=await genStart(dbFileIndexTable[_0x1a78d1(0x1e4)]);if(_0x327d30==_0x1a78d1(0x20a)&&_0x312239==_0x1a78d1(0x20a)){try{bgTaskId&&dbOther[_0x1a78d1(0x1ea)](_0x1a78d1(0x1f5))[_0x1a78d1(0x209)]();}catch(_0x3cece0){}genCount>0x0&&process[_0x1a78d1(0x1de)]({'type':_0x1a78d1(0x1e0)}),process[_0x1a78d1(0x1de)]({'type':_0x1a78d1(0x1fc)}),process[_0x1a78d1(0x201)]();}else return runGen();}catch(_0x45b5de){return console[_0x1a78d1(0x1fb)](_0x45b5de),runGen();}}runGen();function exitProcess(){const _0x22685a=_0x342ce5;process['send']({'type':_0x22685a(0x1fc)}),process[_0x22685a(0x201)]();}process['on'](_0x342ce5(0x202),(_0x1ee946,_0x5dba88)=>{const _0x5092ae=_0x342ce5;console[_0x5092ae(0x1fb)](_0x5092ae(0x1fe),_0x1ee946),exitProcess();});