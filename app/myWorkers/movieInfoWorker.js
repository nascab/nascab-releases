const _0x5af191=_0x4cca;(function(_0xfb44b7,_0x1a065b){const _0x764799=_0x4cca,_0x440c8f=_0xfb44b7();while(!![]){try{const _0x4eb414=parseInt(_0x764799(0x205))/0x1+-parseInt(_0x764799(0x1e3))/0x2*(parseInt(_0x764799(0x1f3))/0x3)+parseInt(_0x764799(0x1e9))/0x4+-parseInt(_0x764799(0x1e6))/0x5*(-parseInt(_0x764799(0x200))/0x6)+parseInt(_0x764799(0x212))/0x7+parseInt(_0x764799(0x1f2))/0x8*(parseInt(_0x764799(0x207))/0x9)+-parseInt(_0x764799(0x208))/0xa;if(_0x4eb414===_0x1a065b)break;else _0x440c8f['push'](_0x440c8f['shift']());}catch(_0x58ba34){_0x440c8f['push'](_0x440c8f['shift']());}}}(_0x2f0c,0x4198b));const config=require(_0x5af191(0x209));let path=require('path');const dbFileIndexTable=require(_0x5af191(0x20d)),Database=require('better-sqlite3');let dbFileIndex=new Database(config[_0x5af191(0x20c)],{'timeout':0xea60}),dbOther=new Database(config[_0x5af191(0x202)],{});function _0x4cca(_0x435a84,_0x5319a2){const _0x2f0c0c=_0x2f0c();return _0x4cca=function(_0x4cca71,_0x1dcd59){_0x4cca71=_0x4cca71-0x1e1;let _0x3c5096=_0x2f0c0c[_0x4cca71];return _0x3c5096;},_0x4cca(_0x435a84,_0x5319a2);}function _0x2f0c(){const _0x40d21b=['prepare','filename','parseNfo','712uitEaF','20358XlSrUl','saveMovieInfoToDb','journal_mode\x20=\x20WAL','../utils/nfoUtil','is_tvplay','movie_info_state','uncaughtException','get','\x0a\x09\x20\x20\x20\x20','usedNfo','NasCabMovieNfoWorker','Error\x20occurred\x20in\x20movie\x20info\x20searching\x20process','join','27060qrYkPF','path','dbOther','\x20movie_info_state=0\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20size>','getByWhere','266977JcnOys','sep','53613WBweUs','8888420llMwuZ','../myConfig/config','saveMsg','SELECT\x20*\x20FROM\x20source_folder\x20where\x20type=\x27movie\x27\x20AND\x20\x20?\x20like\x20','dbFileIndex','../db/dbFileIndexTable','pragma',',movie_info_get_time=','then',',movie_info_get_times=','1099742AQTIVB','开始查询','\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id=','18NDpyNp','send','catch','45MdtXsw','exit','\x20LIMIT\x201','895012ivvwge','log','error','close','ignore_match_info','file_index_movie'];_0x2f0c=function(){return _0x40d21b;};return _0x2f0c();}dbOther[_0x5af191(0x20e)]('journal_mode\x20=\x20WAL'),dbFileIndex[_0x5af191(0x20e)](_0x5af191(0x1f5));const nfoUtil=require(_0x5af191(0x1f6)),messageUtil=require('../utils/messageUtil'),movieInfoUtil=require('../utils/movieInfoUtil');process['title']=_0x5af191(0x1fd);function updateMovieInfoState(_0x288223,_0x13994d,_0x59b2cf){const _0x5d38ad=_0x5af191;let _0x355970=new Date()['getTime']();const _0x1f8714='\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20UPDATE\x20file_index_movie\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20SET\x20movie_info_state='+_0x13994d+_0x5d38ad(0x20f)+_0x355970+_0x5d38ad(0x211)+_0x59b2cf+_0x5d38ad(0x1e2)+_0x288223+_0x5d38ad(0x1fb);return dbFileIndex[_0x5d38ad(0x1ef)](_0x1f8714)['run']();}function getInfoStart(){return new Promise((_0x38e9ca,_0x2dbfd4)=>{const _0x1a0de4=_0x4cca;let _0x5b0e75=0x400*0x400*0x64,_0x22dd59=dbFileIndexTable[_0x1a0de4(0x204)](dbFileIndex,_0x1a0de4(0x203)+_0x5b0e75+_0x1a0de4(0x1e8),'*',_0x1a0de4(0x1ee));if(_0x22dd59){let _0x1b1a46=path[_0x1a0de4(0x1ff)](_0x22dd59[_0x1a0de4(0x201)],_0x22dd59[_0x1a0de4(0x1f0)]);nfoUtil[_0x1a0de4(0x1f1)](_0x22dd59,!![],![])[_0x1a0de4(0x210)](_0x1c7f7b=>{const _0x56d448=_0x1a0de4;return updateMovieInfoState(_0x22dd59['id'],0x1,0x1),movieInfoUtil[_0x56d448(0x1f4)](dbFileIndex,_0x22dd59['id'],_0x1c7f7b),_0x38e9ca({'usedNfo':!![]});})[_0x1a0de4(0x1e5)](_0x15a094=>{const _0x33da6d=_0x1a0de4;let _0xcc8a98=_0x33da6d(0x20b)+'`path`||\x27'+path[_0x33da6d(0x206)]+'%\x27',_0x5f5abd=dbOther[_0x33da6d(0x1ef)](_0xcc8a98)[_0x33da6d(0x1fa)](path[_0x33da6d(0x1ff)](_0x22dd59[_0x33da6d(0x201)],_0x22dd59[_0x33da6d(0x1f0)]));if(_0x5f5abd&&_0x5f5abd[_0x33da6d(0x1ed)]==0x1)return updateMovieInfoState(_0x22dd59['id'],0x3,0x1),_0x38e9ca();console['log'](_0x33da6d(0x1e1),_0x22dd59[_0x33da6d(0x1f0)],_0x22dd59[_0x33da6d(0x1f8)]),movieInfoUtil['runSearchNfoWorker'](dbOther,_0x22dd59[_0x33da6d(0x201)],_0x22dd59[_0x33da6d(0x1f0)],_0x22dd59[_0x33da6d(0x1f7)])[_0x33da6d(0x210)](_0x1def9f=>{const _0x203fee=_0x33da6d;updateMovieInfoState(_0x22dd59['id'],0x1,0x1),nfoUtil['parseNfo'](_0x22dd59,!![],![])[_0x203fee(0x210)](_0x3a9b9c=>{const _0x4fcc05=_0x203fee;return movieInfoUtil[_0x4fcc05(0x1f4)](dbFileIndex,_0x22dd59['id'],_0x3a9b9c),_0x38e9ca();})[_0x203fee(0x1e5)](_0x3cc69a=>{return _0x38e9ca();});})[_0x33da6d(0x1e5)](_0x3035fd=>{const _0x370f88=_0x33da6d;return console[_0x370f88(0x1ea)]('nfo获取失败了'),updateMovieInfoState(_0x22dd59['id'],0x3,0x1),_0x38e9ca();});});}else exitProcess();});}function exitProcess(){const _0x306f33=_0x5af191;try{dbOther[_0x306f33(0x1ec)](),dbFileIndex[_0x306f33(0x1ec)]();}catch(_0x34a397){}process[_0x306f33(0x1e4)]({'type':_0x306f33(0x1ec)}),process[_0x306f33(0x1e7)]();}async function runGetMovieInfo(){const _0x41e730=_0x5af191;getInfoStart()[_0x41e730(0x210)](_0x40b8ab=>{const _0x3f7449=_0x41e730;_0x40b8ab&&_0x40b8ab[_0x3f7449(0x1fc)]?runGetMovieInfo():setTimeout(()=>{runGetMovieInfo();},0x1388);})[_0x41e730(0x1e5)](_0x3ccb82=>{const _0x2510f7=_0x41e730;console[_0x2510f7(0x1ea)](_0x3ccb82),exitProcess();});}runGetMovieInfo(),process['on'](_0x5af191(0x1f9),(_0x20e046,_0x52d827)=>{const _0x5035b0=_0x5af191;console['log'](_0x20e046),messageUtil[_0x5035b0(0x20a)](dbOther,_0x5035b0(0x1fe),_0x5035b0(0x1eb),_0x20e046['stack']||_0x20e046['message']);});