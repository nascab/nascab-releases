const _0x1173e6=_0x46cb;(function(_0xe38dca,_0x13acf0){const _0x3b571f=_0x46cb,_0x49e5e5=_0xe38dca();while(!![]){try{const _0xf6ba33=parseInt(_0x3b571f(0xa2))/0x1+-parseInt(_0x3b571f(0xa7))/0x2*(-parseInt(_0x3b571f(0xb0))/0x3)+-parseInt(_0x3b571f(0xaf))/0x4*(-parseInt(_0x3b571f(0xae))/0x5)+parseInt(_0x3b571f(0xb5))/0x6+-parseInt(_0x3b571f(0xcb))/0x7+parseInt(_0x3b571f(0xc9))/0x8*(parseInt(_0x3b571f(0x99))/0x9)+-parseInt(_0x3b571f(0x9e))/0xa;if(_0xf6ba33===_0x13acf0)break;else _0x49e5e5['push'](_0x49e5e5['shift']());}catch(_0x19b179){_0x49e5e5['push'](_0x49e5e5['shift']());}}}(_0x237f,0x67cab));const config=require(_0x1173e6(0xb4));let path=require(_0x1173e6(0xcc));const dbFileIndexTable=require(_0x1173e6(0x97)),Database=require('better-sqlite3');let dbFileIndex=new Database(config[_0x1173e6(0xb9)],{'timeout':0xea60}),dbOther=new Database(config[_0x1173e6(0xa6)],{});dbOther[_0x1173e6(0xbe)](_0x1173e6(0xc4)),dbFileIndex['pragma'](_0x1173e6(0xc4));const nfoUtil=require(_0x1173e6(0xb1)),messageUtil=require(_0x1173e6(0xad)),movieInfoUtil=require('../utils/movieInfoUtil');process[_0x1173e6(0xc3)]=_0x1173e6(0xc0);function updateMovieInfoState(_0x31c56f,_0xe3f729,_0x1b217e){const _0x5af557=_0x1173e6;let _0x31c9d1=new Date()[_0x5af557(0xc8)]();const _0xb9e5c4=_0x5af557(0xbc)+_0xe3f729+_0x5af557(0x96)+_0x31c9d1+',movie_info_get_times='+_0x1b217e+'\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id='+_0x31c56f+'\x0a\x09\x20\x20\x20\x20';return dbFileIndex[_0x5af557(0xb2)](_0xb9e5c4)[_0x5af557(0xa9)]();}function _0x237f(){const _0x312dd1=['catch','is_tvplay','sample','16279660FoEwJM','sep','`path`||\x27','get','683974NXqHZi','file_index_movie','nfo没有\x20从网络读取\x20','toLowerCase','dbOther','6efTpug','filename','run','开始查询','saveMsg','getByWhere','../utils/messageUtil','265axmynB','62672TMdIeZ','445767ZllVvo','../utils/nfoUtil','prepare','Error\x20occurred\x20in\x20movie\x20info\x20searching\x20process','../myConfig/config','2360466zZidii','error','stack','nfo获取失败了','dbFileIndex','parseNfo','endsWith','\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20UPDATE\x20file_index_movie\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20SET\x20movie_info_state=','usedNfo','pragma','join','NasCabMovieNfoWorker','uncaughtException','movie_info_state','title','journal_mode\x20=\x20WAL','log','close','ignore_match_info','getTime','573776Jorcfq','then','3609375TNTMUN','path','runSearchNfoWorker','extra',',movie_info_get_time=','../db/dbFileIndexTable','message','27SvMCMN','\x20movie_info_state=0\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20size>'];_0x237f=function(){return _0x312dd1;};return _0x237f();}function getInfoStart(){return new Promise((_0x7406db,_0x3c894b)=>{const _0x4b9e0c=_0x46cb;let _0x50ccfe=0x400*0x400*0x64,_0x1d1a8b=dbFileIndexTable[_0x4b9e0c(0xac)](dbFileIndex,_0x4b9e0c(0x9a)+_0x50ccfe+'\x20LIMIT\x201','*',_0x4b9e0c(0xa3));if(_0x1d1a8b){let _0x1f185b=path[_0x4b9e0c(0xbf)](_0x1d1a8b[_0x4b9e0c(0xcc)],_0x1d1a8b[_0x4b9e0c(0xa8)]);if(_0x1d1a8b['path']){let _0x21d022=_0x1d1a8b[_0x4b9e0c(0xcc)][_0x4b9e0c(0xa5)]();if(_0x21d022['endsWith'](path['sep']+'specials')||_0x21d022[_0x4b9e0c(0xbb)](path['sep']+_0x4b9e0c(0xce))||_0x21d022['endsWith'](path['sep']+_0x4b9e0c(0x9d)))return console[_0x4b9e0c(0xc5)]('跳过\x20sample\x20/\x20extra\x20/\x20specials'),updateMovieInfoState(_0x1d1a8b['id'],0x3,0x1),_0x7406db();}nfoUtil[_0x4b9e0c(0xba)](_0x1d1a8b,!![],![])[_0x4b9e0c(0xca)](_0x3c113b=>{return updateMovieInfoState(_0x1d1a8b['id'],0x1,0x1),movieInfoUtil['saveMovieInfoToDb'](dbFileIndex,_0x1d1a8b['id'],_0x3c113b),_0x7406db({'usedNfo':!![]});})['catch'](_0x312bf3=>{const _0x2235d4=_0x4b9e0c;console[_0x2235d4(0xc5)](_0x2235d4(0xa4));let _0x1d3722='SELECT\x20*\x20FROM\x20source_folder\x20where\x20type=\x27movie\x27\x20AND\x20\x20?\x20like\x20'+_0x2235d4(0xa0)+path[_0x2235d4(0x9f)]+'%\x27',_0x461b71=dbOther['prepare'](_0x1d3722)[_0x2235d4(0xa1)](path[_0x2235d4(0xbf)](_0x1d1a8b[_0x2235d4(0xcc)],_0x1d1a8b['filename']));if(_0x461b71&&_0x461b71[_0x2235d4(0xc7)]==0x1)return updateMovieInfoState(_0x1d1a8b['id'],0x3,0x1),_0x7406db();console[_0x2235d4(0xc5)](_0x2235d4(0xaa),_0x1d1a8b[_0x2235d4(0xa8)],_0x1d1a8b[_0x2235d4(0xc2)]),movieInfoUtil[_0x2235d4(0xcd)](dbOther,_0x1d1a8b[_0x2235d4(0xcc)],_0x1d1a8b[_0x2235d4(0xa8)],_0x1d1a8b[_0x2235d4(0x9c)])[_0x2235d4(0xca)](_0x21b09b=>{const _0x79175a=_0x2235d4;updateMovieInfoState(_0x1d1a8b['id'],0x1,0x1),nfoUtil[_0x79175a(0xba)](_0x1d1a8b,!![],![])[_0x79175a(0xca)](_0x1d361a=>{return movieInfoUtil['saveMovieInfoToDb'](dbFileIndex,_0x1d1a8b['id'],_0x1d361a),_0x7406db();})[_0x79175a(0x9b)](_0x4671cc=>{return _0x7406db();});})[_0x2235d4(0x9b)](_0x1ef08a=>{const _0x88432a=_0x2235d4;return console[_0x88432a(0xc5)](_0x88432a(0xb8)),updateMovieInfoState(_0x1d1a8b['id'],0x3,0x1),_0x7406db();});});}else exitProcess();});}function exitProcess(){const _0x5f30e2=_0x1173e6;try{dbOther['close'](),dbFileIndex['close']();}catch(_0x582651){}process['send']({'type':_0x5f30e2(0xc6)}),process['exit']();}async function runGetMovieInfo(){const _0x3149fc=_0x1173e6;getInfoStart()[_0x3149fc(0xca)](_0x56be5b=>{const _0x42bc96=_0x3149fc;_0x56be5b&&_0x56be5b[_0x42bc96(0xbd)]?runGetMovieInfo():setTimeout(()=>{runGetMovieInfo();},0x1388);})[_0x3149fc(0x9b)](_0x407b22=>{const _0x47ca1f=_0x3149fc;console[_0x47ca1f(0xc5)](_0x407b22),exitProcess();});}function _0x46cb(_0x1a48ea,_0x3e023a){const _0x237f32=_0x237f();return _0x46cb=function(_0x46cb1f,_0x1a7013){_0x46cb1f=_0x46cb1f-0x96;let _0x40b267=_0x237f32[_0x46cb1f];return _0x40b267;},_0x46cb(_0x1a48ea,_0x3e023a);}runGetMovieInfo(),process['on'](_0x1173e6(0xc1),(_0x1f80ad,_0x3c93e3)=>{const _0x1fa2cf=_0x1173e6;console[_0x1fa2cf(0xc5)](_0x1f80ad),messageUtil[_0x1fa2cf(0xab)](dbOther,_0x1fa2cf(0xb3),_0x1fa2cf(0xb6),_0x1f80ad[_0x1fa2cf(0xb7)]||_0x1f80ad[_0x1fa2cf(0x98)]);});