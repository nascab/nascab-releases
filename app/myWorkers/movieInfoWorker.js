const _0x53a6e0=_0x2542;function _0x2f05(){const _0x576e68=['filename','\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id=','86069soyFRI','dbFileIndex','then','../utils/nfoUtil','catch','path','Error\x20occurred\x20in\x20movie\x20info\x20searching\x20process','file_index_movie','\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20UPDATE\x20file_index_movie\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20SET\x20movie_info_state=','exit','1594602VQDpyJ','getTime','1449906OUAkwM','SELECT\x20*\x20FROM\x20source_folder\x20where\x20type=\x27movie\x27\x20AND\x20\x20?\x20like\x20','join','title','log','165UCEuyr','5WCPXzp','\x20LIMIT\x201','NasCabMovieNfoWorker','journal_mode\x20=\x20WAL',',movie_info_get_times=','usedNfo','saveMsg','`path`||\x27','runSearchNfoWorker','sep','send','run','919784FKkVoi','stack','644208HsOndh','parseNfo','saveMovieInfoToDb','getByWhere','dbOther','90370kdbWXf','close','开始查询','pragma','message','7pakSkw','../utils/messageUtil','error','4KDponB','nfo获取失败了','663963zgkZmK','movie_info_state'];_0x2f05=function(){return _0x576e68;};return _0x2f05();}(function(_0x49138d,_0x1b5dc6){const _0x574f60=_0x2542,_0x3d707f=_0x49138d();while(!![]){try{const _0x3780c1=-parseInt(_0x574f60(0xf1))/0x1*(-parseInt(_0x574f60(0xeb))/0x2)+parseInt(_0x574f60(0xed))/0x3+parseInt(_0x574f60(0xde))/0x4+parseInt(_0x574f60(0x103))/0x5*(-parseInt(_0x574f60(0xfd))/0x6)+-parseInt(_0x574f60(0xe8))/0x7*(parseInt(_0x574f60(0xdc))/0x8)+parseInt(_0x574f60(0xfb))/0x9+parseInt(_0x574f60(0xe3))/0xa*(-parseInt(_0x574f60(0x102))/0xb);if(_0x3780c1===_0x1b5dc6)break;else _0x3d707f['push'](_0x3d707f['shift']());}catch(_0x197c9f){_0x3d707f['push'](_0x3d707f['shift']());}}}(_0x2f05,0x3a796));const config=require('../myConfig/config');function _0x2542(_0x5f05b1,_0x24d111){const _0x2f052e=_0x2f05();return _0x2542=function(_0x25422c,_0x3f747b){_0x25422c=_0x25422c-0xdb;let _0x439ecc=_0x2f052e[_0x25422c];return _0x439ecc;},_0x2542(_0x5f05b1,_0x24d111);}let path=require(_0x53a6e0(0xf6));const dbFileIndexTable=require('../db/dbFileIndexTable'),Database=require('better-sqlite3');let dbFileIndex=new Database(config[_0x53a6e0(0xf2)],{'timeout':0xea60}),dbOther=new Database(config[_0x53a6e0(0xe2)],{});dbOther[_0x53a6e0(0xe6)](_0x53a6e0(0x106)),dbFileIndex['pragma']('journal_mode\x20=\x20WAL');const nfoUtil=require(_0x53a6e0(0xf4)),messageUtil=require(_0x53a6e0(0xe9)),movieInfoUtil=require('../utils/movieInfoUtil');process[_0x53a6e0(0x100)]=_0x53a6e0(0x105);function updateMovieInfoState(_0x37d944,_0x676c6,_0xf6b759){const _0x56ebfc=_0x53a6e0;let _0x2efc4d=new Date()[_0x56ebfc(0xfc)]();const _0x2791ae=_0x56ebfc(0xf9)+_0x676c6+',movie_info_get_time='+_0x2efc4d+_0x56ebfc(0x107)+_0xf6b759+_0x56ebfc(0xf0)+_0x37d944+'\x0a\x09\x20\x20\x20\x20';return dbFileIndex['prepare'](_0x2791ae)[_0x56ebfc(0xdb)]();}function getInfoStart(){return new Promise((_0x43cac9,_0x30131d)=>{const _0x5dad0d=_0x2542;let _0x1bce68=0x400*0x400*0x64,_0x32c3d4=dbFileIndexTable[_0x5dad0d(0xe1)](dbFileIndex,'\x20movie_info_state=0\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20size>'+_0x1bce68+_0x5dad0d(0x104),'*',_0x5dad0d(0xf8));if(_0x32c3d4){let _0x4a4364=path[_0x5dad0d(0xff)](_0x32c3d4['path'],_0x32c3d4[_0x5dad0d(0xef)]);nfoUtil['parseNfo'](_0x32c3d4,!![],![])[_0x5dad0d(0xf3)](_0x60373c=>{const _0x5f1c74=_0x5dad0d;return updateMovieInfoState(_0x32c3d4['id'],0x1,0x1),movieInfoUtil[_0x5f1c74(0xe0)](dbFileIndex,_0x32c3d4['id'],_0x60373c),_0x43cac9({'usedNfo':!![]});})[_0x5dad0d(0xf5)](_0x1e817f=>{const _0x1a6767=_0x5dad0d;let _0x1a21c3=_0x1a6767(0xfe)+_0x1a6767(0x10a)+path[_0x1a6767(0x10c)]+'%\x27',_0x5e7763=dbOther['prepare'](_0x1a21c3)['get'](path[_0x1a6767(0xff)](_0x32c3d4[_0x1a6767(0xf6)],_0x32c3d4[_0x1a6767(0xef)]));if(_0x5e7763&&_0x5e7763['ignore_match_info']==0x1)return updateMovieInfoState(_0x32c3d4['id'],0x3,0x1),_0x43cac9();console[_0x1a6767(0x101)](_0x1a6767(0xe5),_0x32c3d4['filename'],_0x32c3d4[_0x1a6767(0xee)]),movieInfoUtil[_0x1a6767(0x10b)](dbOther,_0x32c3d4[_0x1a6767(0xf6)],_0x32c3d4[_0x1a6767(0xef)],_0x32c3d4['is_tvplay'])[_0x1a6767(0xf3)](_0x26671d=>{const _0x511ab7=_0x1a6767;updateMovieInfoState(_0x32c3d4['id'],0x1,0x1),nfoUtil[_0x511ab7(0xdf)](_0x32c3d4,!![],![])['then'](_0x59125d=>{const _0x1e0758=_0x511ab7;return movieInfoUtil[_0x1e0758(0xe0)](dbFileIndex,_0x32c3d4['id'],_0x59125d),_0x43cac9();})[_0x511ab7(0xf5)](_0x43585f=>{return _0x43cac9();});})['catch'](_0x2cd570=>{const _0x3bfe3c=_0x1a6767;return console[_0x3bfe3c(0x101)](_0x3bfe3c(0xec)),updateMovieInfoState(_0x32c3d4['id'],0x3,0x1),_0x43cac9();});});}else exitProcess();});}function exitProcess(){const _0x25da10=_0x53a6e0;try{dbOther[_0x25da10(0xe4)](),dbFileIndex[_0x25da10(0xe4)]();}catch(_0x1f4ddf){}process[_0x25da10(0x10d)]({'type':'close'}),process[_0x25da10(0xfa)]();}async function runGetMovieInfo(){const _0x3a815d=_0x53a6e0;getInfoStart()['then'](_0xb16342=>{const _0x55fe6e=_0x2542;_0xb16342&&_0xb16342[_0x55fe6e(0x108)]?runGetMovieInfo():setTimeout(()=>{runGetMovieInfo();},0x1388);})[_0x3a815d(0xf5)](_0x51c6a8=>{const _0x1ca13b=_0x3a815d;console[_0x1ca13b(0x101)](_0x51c6a8),exitProcess();});}runGetMovieInfo(),process['on']('uncaughtException',(_0xc3712c,_0x36a7bc)=>{const _0x2831a5=_0x53a6e0;console['log'](_0xc3712c),messageUtil[_0x2831a5(0x109)](dbOther,_0x2831a5(0xf7),_0x2831a5(0xea),_0xc3712c[_0x2831a5(0xdd)]||_0xc3712c[_0x2831a5(0xe7)]);});