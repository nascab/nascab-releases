const _0x1bcb29=_0xd252;(function(_0x16b17e,_0x663bf1){const _0x5a531b=_0xd252,_0x904d41=_0x16b17e();while(!![]){try{const _0x26a556=parseInt(_0x5a531b(0xee))/0x1+-parseInt(_0x5a531b(0xf3))/0x2*(parseInt(_0x5a531b(0xf4))/0x3)+-parseInt(_0x5a531b(0xff))/0x4*(parseInt(_0x5a531b(0x11f))/0x5)+parseInt(_0x5a531b(0x10d))/0x6*(-parseInt(_0x5a531b(0x113))/0x7)+parseInt(_0x5a531b(0x11d))/0x8+parseInt(_0x5a531b(0xf9))/0x9+parseInt(_0x5a531b(0x114))/0xa;if(_0x26a556===_0x663bf1)break;else _0x904d41['push'](_0x904d41['shift']());}catch(_0x3b0d22){_0x904d41['push'](_0x904d41['shift']());}}}(_0x4909,0x18f3e));const config=require(_0x1bcb29(0x10c));let path=require(_0x1bcb29(0xf1));const dbFileIndexTable=require(_0x1bcb29(0x115)),Database=require(_0x1bcb29(0x120));let dbFileIndex=new Database(config[_0x1bcb29(0x102)],{'timeout':0xea60}),dbOther=new Database(config[_0x1bcb29(0xf8)],{});function _0x4909(){const _0x5809a6=['3381XxgifI','1444320CUuYyA','../db/dbFileIndexTable','saveMovieInfoToDb','pragma','prepare','stack','send','getTime','catch','652856RonThR','saveMsg','10305QHJlxz','better-sqlite3','filename','跳过\x20sample\x20/\x20extra\x20/\x20specials','110046OExTTd','usedNfo','\x20movie_info_state=0\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20size>','path','`path`||\x27','6262OxMseb','129JzTwtC','log','nfo获取失败了','endsWith','dbOther','520830TamNDa','specials','../utils/messageUtil','sample','SELECT\x20*\x20FROM\x20source_folder\x20where\x20type=\x27movie\x27\x20AND\x20\x20?\x20like\x20','get','244RDQajy','开始查询','join','dbFileIndex','sep','run','../utils/nfoUtil',',movie_info_get_time=','movie_info_state','getByWhere','then','runSearchNfoWorker','extra','../myConfig/config','390zmoPwt','close','toLowerCase','parseNfo','ignore_match_info','error'];_0x4909=function(){return _0x5809a6;};return _0x4909();}dbOther[_0x1bcb29(0x117)]('journal_mode\x20=\x20WAL'),dbFileIndex['pragma']('journal_mode\x20=\x20WAL');const nfoUtil=require(_0x1bcb29(0x105)),messageUtil=require(_0x1bcb29(0xfb)),movieInfoUtil=require('../utils/movieInfoUtil');function _0xd252(_0x9e16cc,_0x1a8e42){const _0x4909a8=_0x4909();return _0xd252=function(_0xd25232,_0x3a1878){_0xd25232=_0xd25232-0xee;let _0x297577=_0x4909a8[_0xd25232];return _0x297577;},_0xd252(_0x9e16cc,_0x1a8e42);}process['title']='NasCabMovieNfoWorker';function updateMovieInfoState(_0x7799fa,_0x4b71b6,_0x2f1f1d){const _0x4544f0=_0x1bcb29;let _0x3c5bd1=new Date()[_0x4544f0(0x11b)]();const _0xef60c4='\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20UPDATE\x20file_index_movie\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20SET\x20movie_info_state='+_0x4b71b6+_0x4544f0(0x106)+_0x3c5bd1+',movie_info_get_times='+_0x2f1f1d+'\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id='+_0x7799fa+'\x0a\x09\x20\x20\x20\x20';return dbFileIndex[_0x4544f0(0x118)](_0xef60c4)[_0x4544f0(0x104)]();}function getInfoStart(){return new Promise((_0xeaf064,_0x1140a2)=>{const _0x5c142e=_0xd252;let _0x1353f6=0x400*0x400*0x64,_0x5e3a0f=dbFileIndexTable[_0x5c142e(0x108)](dbFileIndex,_0x5c142e(0xf0)+_0x1353f6+'\x20LIMIT\x201','*','file_index_movie');if(_0x5e3a0f){let _0x207b86=path[_0x5c142e(0x101)](_0x5e3a0f['path'],_0x5e3a0f[_0x5c142e(0x121)]);if(_0x5e3a0f[_0x5c142e(0xf1)]){let _0x4bb5e3=_0x5e3a0f[_0x5c142e(0xf1)][_0x5c142e(0x10f)]();if(_0x4bb5e3[_0x5c142e(0xf7)](path['sep']+_0x5c142e(0xfa))||_0x4bb5e3[_0x5c142e(0xf7)](path[_0x5c142e(0x103)]+_0x5c142e(0x10b))||_0x4bb5e3['endsWith'](path[_0x5c142e(0x103)]+_0x5c142e(0xfc)))return console[_0x5c142e(0xf5)](_0x5c142e(0x122)),updateMovieInfoState(_0x5e3a0f['id'],0x3,0x1),_0xeaf064();}nfoUtil[_0x5c142e(0x110)](_0x5e3a0f,!![],![])['then'](_0xbb285d=>{const _0x23dafc=_0x5c142e;return updateMovieInfoState(_0x5e3a0f['id'],0x1,0x1),movieInfoUtil[_0x23dafc(0x116)](dbFileIndex,_0x5e3a0f['id'],_0xbb285d),_0xeaf064({'usedNfo':!![]});})[_0x5c142e(0x11c)](_0x5a3e96=>{const _0x16c0d6=_0x5c142e;console[_0x16c0d6(0xf5)]('nfo没有\x20从网络读取\x20');let _0x5782f4=_0x16c0d6(0xfd)+_0x16c0d6(0xf2)+path['sep']+'%\x27',_0x2f807e=dbOther[_0x16c0d6(0x118)](_0x5782f4)[_0x16c0d6(0xfe)](path['join'](_0x5e3a0f[_0x16c0d6(0xf1)],_0x5e3a0f['filename']));if(_0x2f807e&&_0x2f807e[_0x16c0d6(0x111)]==0x1)return updateMovieInfoState(_0x5e3a0f['id'],0x3,0x1),_0xeaf064();console[_0x16c0d6(0xf5)](_0x16c0d6(0x100),_0x5e3a0f[_0x16c0d6(0x121)],_0x5e3a0f[_0x16c0d6(0x107)]),movieInfoUtil[_0x16c0d6(0x10a)](dbOther,_0x5e3a0f[_0x16c0d6(0xf1)],_0x5e3a0f[_0x16c0d6(0x121)],_0x5e3a0f['is_tvplay'])[_0x16c0d6(0x109)](_0x742e14=>{const _0x3b6daf=_0x16c0d6;updateMovieInfoState(_0x5e3a0f['id'],0x1,0x1),nfoUtil[_0x3b6daf(0x110)](_0x5e3a0f,!![],![])[_0x3b6daf(0x109)](_0x4ad42e=>{return movieInfoUtil['saveMovieInfoToDb'](dbFileIndex,_0x5e3a0f['id'],_0x4ad42e),_0xeaf064();})[_0x3b6daf(0x11c)](_0x4a006f=>{return _0xeaf064();});})[_0x16c0d6(0x11c)](_0x198a37=>{const _0x1a6117=_0x16c0d6;return console[_0x1a6117(0xf5)](_0x1a6117(0xf6)),updateMovieInfoState(_0x5e3a0f['id'],0x3,0x1),_0xeaf064();});});}else exitProcess();});}function exitProcess(){const _0x19f41b=_0x1bcb29;try{dbOther[_0x19f41b(0x10e)](),dbFileIndex[_0x19f41b(0x10e)]();}catch(_0x40ba8b){}process[_0x19f41b(0x11a)]({'type':_0x19f41b(0x10e)}),process['exit']();}async function runGetMovieInfo(){const _0x4b28a5=_0x1bcb29;getInfoStart()['then'](_0x3fbb26=>{const _0x133916=_0xd252;_0x3fbb26&&_0x3fbb26[_0x133916(0xef)]?runGetMovieInfo():setTimeout(()=>{runGetMovieInfo();},0x1388);})[_0x4b28a5(0x11c)](_0x335827=>{console['log'](_0x335827),exitProcess();});}runGetMovieInfo(),process['on']('uncaughtException',(_0x11624c,_0x3bbe60)=>{const _0x46f1a9=_0x1bcb29;console[_0x46f1a9(0xf5)](_0x11624c),messageUtil[_0x46f1a9(0x11e)](dbOther,'Error\x20occurred\x20in\x20movie\x20info\x20searching\x20process',_0x46f1a9(0x112),_0x11624c[_0x46f1a9(0x119)]||_0x11624c['message']);});