const _0x26d6fc=_0x145e;(function(_0x237b87,_0x3f7f6b){const _0x2331a1=_0x145e,_0x22620e=_0x237b87();while(!![]){try{const _0x120a7b=-parseInt(_0x2331a1(0xc7))/0x1*(-parseInt(_0x2331a1(0xe0))/0x2)+parseInt(_0x2331a1(0xc6))/0x3*(-parseInt(_0x2331a1(0xe6))/0x4)+-parseInt(_0x2331a1(0xe4))/0x5*(-parseInt(_0x2331a1(0xe3))/0x6)+parseInt(_0x2331a1(0xc5))/0x7*(-parseInt(_0x2331a1(0xf2))/0x8)+parseInt(_0x2331a1(0xc4))/0x9+parseInt(_0x2331a1(0xe9))/0xa+parseInt(_0x2331a1(0xd1))/0xb;if(_0x120a7b===_0x3f7f6b)break;else _0x22620e['push'](_0x22620e['shift']());}catch(_0x2bb448){_0x22620e['push'](_0x22620e['shift']());}}}(_0x4396,0x8638f));const config=require(_0x26d6fc(0xd2));let path=require('path');const dbFileIndexTable=require(_0x26d6fc(0xd4)),Database=require(_0x26d6fc(0xec));let dbFileIndex=new Database(config[_0x26d6fc(0xdf)],{'timeout':0xea60}),dbOther=new Database(config[_0x26d6fc(0xcc)],{});dbOther[_0x26d6fc(0xea)](_0x26d6fc(0xcd)),dbFileIndex[_0x26d6fc(0xea)]('journal_mode\x20=\x20WAL');const nfoUtil=require('../utils/nfoUtil'),messageUtil=require(_0x26d6fc(0xca)),movieInfoUtil=require(_0x26d6fc(0xd9));process[_0x26d6fc(0xcf)]=_0x26d6fc(0xf0);function _0x4396(){const _0x2021f3=['journal_mode\x20=\x20WAL','message','title','exit','5245526CdfOjn','../myConfig/config','send','../db/dbFileIndexTable','log','nfo获取失败了','SELECT\x20*\x20FROM\x20source_folder\x20where\x20type=\x27movie\x27\x20AND\x20\x20?\x20like\x20','Error\x20occurred\x20in\x20movie\x20info\x20searching\x20process','../utils/movieInfoUtil','is_tvplay','error','uncaughtException','get','run','dbFileIndex','1498846bbkheO','saveMsg','join','406446JiVXvx','55kEkXSz','filename','4RVAKkv','close','saveMovieInfoToDb','2817610JzCpQO','pragma','prepare','better-sqlite3','sep','then','getTime','NasCabMovieNfoWorker','movie_info_state','8KLaYvU','getByWhere','parseNfo',',movie_info_get_times=','path','\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20UPDATE\x20file_index_movie\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20SET\x20movie_info_state=','\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id=','1350198SGJpbi','6912045UswWkg','2598039Gewywa','1jIceSx','ignore_match_info',',movie_info_get_time=','../utils/messageUtil','catch','dbOther'];_0x4396=function(){return _0x2021f3;};return _0x4396();}function _0x145e(_0x13079e,_0x2a26dc){const _0x43960d=_0x4396();return _0x145e=function(_0x145ea4,_0xacafd6){_0x145ea4=_0x145ea4-0xbf;let _0xaf96f1=_0x43960d[_0x145ea4];return _0xaf96f1;},_0x145e(_0x13079e,_0x2a26dc);}function updateMovieInfoState(_0x1c9521,_0x497b1a,_0x13482d){const _0x19535c=_0x26d6fc;let _0x255230=new Date()[_0x19535c(0xef)]();const _0x2baf35=_0x19535c(0xc2)+_0x497b1a+_0x19535c(0xc9)+_0x255230+_0x19535c(0xc0)+_0x13482d+_0x19535c(0xc3)+_0x1c9521+'\x0a\x09\x20\x20\x20\x20';return dbFileIndex['prepare'](_0x2baf35)[_0x19535c(0xde)]();}function getInfoStart(){return new Promise((_0x48943f,_0x2633e1)=>{const _0x15e2bc=_0x145e;let _0x7e5f99=0x400*0x400*0x64,_0x1a8dda=dbFileIndexTable[_0x15e2bc(0xf3)](dbFileIndex,'\x20movie_info_state=0\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20size>'+_0x7e5f99+'\x20LIMIT\x201','*','file_index_movie');if(_0x1a8dda){let _0x5e705e=path[_0x15e2bc(0xe2)](_0x1a8dda['path'],_0x1a8dda['filename']);nfoUtil[_0x15e2bc(0xbf)](_0x1a8dda,!![],![])[_0x15e2bc(0xee)](_0x1378fd=>{return updateMovieInfoState(_0x1a8dda['id'],0x1,0x1),movieInfoUtil['saveMovieInfoToDb'](dbFileIndex,_0x1a8dda['id'],_0x1378fd),_0x48943f({'usedNfo':!![]});})[_0x15e2bc(0xcb)](_0x2dac46=>{const _0xbd640=_0x15e2bc;let _0x3e210d=_0xbd640(0xd7)+'`path`||\x27'+path[_0xbd640(0xed)]+'%\x27',_0x4b459b=dbOther[_0xbd640(0xeb)](_0x3e210d)[_0xbd640(0xdd)](path[_0xbd640(0xe2)](_0x1a8dda[_0xbd640(0xc1)],_0x1a8dda['filename']));if(_0x4b459b&&_0x4b459b[_0xbd640(0xc8)]==0x1)return updateMovieInfoState(_0x1a8dda['id'],0x3,0x1),_0x48943f();console['log']('开始查询',_0x1a8dda[_0xbd640(0xe5)],_0x1a8dda[_0xbd640(0xf1)]),movieInfoUtil['runSearchNfoWorker'](dbOther,_0x1a8dda[_0xbd640(0xc1)],_0x1a8dda[_0xbd640(0xe5)],_0x1a8dda[_0xbd640(0xda)])[_0xbd640(0xee)](_0x1d4668=>{const _0x53b651=_0xbd640;updateMovieInfoState(_0x1a8dda['id'],0x1,0x1),nfoUtil[_0x53b651(0xbf)](_0x1a8dda,!![],![])['then'](_0x26550e=>{const _0x1afd1=_0x53b651;return movieInfoUtil[_0x1afd1(0xe8)](dbFileIndex,_0x1a8dda['id'],_0x26550e),_0x48943f();})['catch'](_0x1fadde=>{return _0x48943f();});})[_0xbd640(0xcb)](_0x4390b6=>{const _0x2e7521=_0xbd640;return console[_0x2e7521(0xd5)](_0x2e7521(0xd6)),updateMovieInfoState(_0x1a8dda['id'],0x3,0x1),_0x48943f();});});}else exitProcess();});}function exitProcess(){const _0x366289=_0x26d6fc;try{dbOther['close'](),dbFileIndex[_0x366289(0xe7)]();}catch(_0x1d4862){}process[_0x366289(0xd3)]({'type':'close'}),process[_0x366289(0xd0)]();}async function runGetMovieInfo(){const _0x5331fa=_0x26d6fc;getInfoStart()[_0x5331fa(0xee)](_0x5d4b23=>{_0x5d4b23&&_0x5d4b23['usedNfo']?runGetMovieInfo():setTimeout(()=>{runGetMovieInfo();},0x1388);})[_0x5331fa(0xcb)](_0x4066e5=>{const _0x174b17=_0x5331fa;console[_0x174b17(0xd5)](_0x4066e5),exitProcess();});}runGetMovieInfo(),process['on'](_0x26d6fc(0xdc),(_0x574688,_0x3aa509)=>{const _0x1a0934=_0x26d6fc;console[_0x1a0934(0xd5)](_0x574688),messageUtil[_0x1a0934(0xe1)](dbOther,_0x1a0934(0xd8),_0x1a0934(0xdb),_0x574688['stack']||_0x574688[_0x1a0934(0xce)]);});