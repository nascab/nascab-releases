const _0x27f485=_0x598a;(function(_0x236792,_0x36593c){const _0x44b43d=_0x598a,_0x25d5a9=_0x236792();while(!![]){try{const _0x333061=parseInt(_0x44b43d(0xdc))/0x1+-parseInt(_0x44b43d(0xb1))/0x2*(parseInt(_0x44b43d(0xab))/0x3)+-parseInt(_0x44b43d(0xcb))/0x4*(parseInt(_0x44b43d(0xc3))/0x5)+-parseInt(_0x44b43d(0xd6))/0x6+-parseInt(_0x44b43d(0xd2))/0x7+-parseInt(_0x44b43d(0xe5))/0x8+parseInt(_0x44b43d(0xc7))/0x9;if(_0x333061===_0x36593c)break;else _0x25d5a9['push'](_0x25d5a9['shift']());}catch(_0x42dc31){_0x25d5a9['push'](_0x25d5a9['shift']());}}}(_0x2776,0x66f0a));const expressApp=require(_0x27f485(0xb8)),fs=require('fs'),path=require(_0x27f485(0xc9)),config=require('../myConfig/config'),Database=require(_0x27f485(0xda)),dbConfigTable=require(_0x27f485(0xb6));let dbNoticeCenterTable=require(_0x27f485(0xbf));const http=require(_0x27f485(0xa7)),https=require('https');let dbOther=new Database(config[_0x27f485(0xdb)],{});dbOther[_0x27f485(0xbb)](_0x27f485(0xa8));let tls=require(_0x27f485(0xb4));const cryptoUtils=require(_0x27f485(0xe4));var expressWs=require(_0x27f485(0xc4));const messageUtil=require(_0x27f485(0xe7));process['title']='NasCabApiWorker';function testCertAndKeyMatch(_0x11b9aa,_0x87417e){const _0x3abcb9=_0x27f485;try{return tls[_0x3abcb9(0xca)]({'cert':_0x11b9aa,'key':_0x87417e}),!![];}catch(_0x44c0ec){return![];}}function _0x2776(){const _0x26de38=['decryptString','listen','usePort','28CyZGKP','HTTPS\x20certs\x20not\x20exist','apiServerHttps','tls','warn','../db/dbConfigTable','证书信息:系统默认证书(Default\x20https\x20cert)','../express-server/app','(Custom\x20https\x20cert)','join','pragma','httpsCert','nasZs987bac','saveMsg','../db/dbNoticeCenterTable','cert.pem','error','Error\x20occurred\x20in\x20api\x20process','4895vxLUMP','express-ws','readFileSync','stringify','17419293ojyEJo','run','path','createSecureContext','2484TKHOrc','createServer','appRootPath','message','apiPortHttps','uncaughtException','HTTPS\x20certs\x20error','2667686RGjcoy','send','Error\x20occurred\x20in\x20api\x20process\x20','certs','387396WANTLG','证书信息:系统默认证书(Default\x20https\x20key)','value','then','better-sqlite3','dbOther','172623zukUNz','httpsKey','stack','startsWith','log','toString','existsSync','expressStartedHttps','../express-server/utils/cryptoUtils','1196216ZLBecT','-----','../utils/messageUtil','http','journal_mode\x20=\x20WAL','(Custom\x20https\x20key)','https\x20service\x20is\x20not\x20running','103566BzTdMR','findByTitle','create'];_0x2776=function(){return _0x26de38;};return _0x2776();}function notifyMainLoadPage(_0x4bdf9d){const _0x371cdc=_0x27f485;currentPort=_0x4bdf9d,process[_0x371cdc(0xd3)]({'type':'expressStarted','exressPort':_0x4bdf9d});}function getFreePort(_0x5dc536,_0x174b6e){const _0x4fd6d5=_0x27f485;_0x5dc536=parseInt(_0x5dc536),isPortFree(_0x5dc536)[_0x4fd6d5(0xd9)](_0x163c1b=>{_0x163c1b?_0x174b6e(_0x5dc536):(_0x5dc536=parseInt(_0x5dc536)+0x1,getFreePort(_0x5dc536,_0x174b6e));});}function isPortFree(_0x410f2b){return new Promise(_0x49dc93=>{const _0x110612=_0x598a,_0x3a857a=http[_0x110612(0xcc)]()[_0x110612(0xaf)](_0x410f2b,()=>{_0x3a857a['close'](),_0x49dc93(!![]);})['on'](_0x110612(0xc1),()=>{_0x49dc93(![]);});});}function _0x598a(_0xbb6887,_0x17442c){const _0x277658=_0x2776();return _0x598a=function(_0x598add,_0x15e82b){_0x598add=_0x598add-0xa7;let _0x19c1af=_0x277658[_0x598add];return _0x19c1af;},_0x598a(_0xbb6887,_0x17442c);}function setHttpsError(_0x115a4c){const _0x3fb7c8=_0x27f485;console[_0x3fb7c8(0xe0)]('https\x20service\x20is\x20not\x20running\x20',_0x115a4c),dbConfigTable[_0x3fb7c8(0xad)](dbOther,{'title':'apiServerHttps','value':JSON['stringify']({'state':_0x3fb7c8(0xc1),'port':0x0,'message':_0x115a4c?JSON['stringify'](_0x115a4c):_0x3fb7c8(0xc1)})}),dbNoticeCenterTable['create'](dbOther,{'title':_0x3fb7c8(0xaa),'level':'error','content':_0x115a4c?JSON['stringify'](_0x115a4c):'error'});}function startListen(_0x5d61f7){const _0x196258=_0x27f485;expressApp[_0x196258(0xaf)](_0x5d61f7,()=>{const _0x8d74a6=_0x196258;notifyMainLoadPage(_0x5d61f7);try{let _0xd96786=0x1bb,_0x54ac54=dbConfigTable[_0x8d74a6(0xac)](dbOther,_0x8d74a6(0xcf));_0x54ac54&&_0x54ac54[_0x8d74a6(0xd8)]&&_0x54ac54[_0x8d74a6(0xd8)]>0x0&&_0x54ac54[_0x8d74a6(0xd8)]<0xffff&&(_0xd96786=_0x54ac54[_0x8d74a6(0xd8)]),getFreePort(_0xd96786,async _0x36d136=>{const _0x6c8def=_0x8d74a6;_0xd96786=_0x36d136;let _0x4fc87='',_0x1e8338='',_0x1c0203=dbConfigTable[_0x6c8def(0xac)](dbOther,_0x6c8def(0xbc));_0x1c0203&&_0x1c0203['value']&&(_0x4fc87=_0x1c0203[_0x6c8def(0xd8)],console['log'](_0x6c8def(0xb9)));let _0x37b7fb=dbConfigTable[_0x6c8def(0xac)](dbOther,_0x6c8def(0xdd));_0x37b7fb&&_0x37b7fb['value']&&(_0x1e8338=_0x37b7fb[_0x6c8def(0xd8)],console[_0x6c8def(0xe0)](_0x6c8def(0xa9)));if(!_0x4fc87){let _0xbd35ea=path[_0x6c8def(0xba)](config[_0x6c8def(0xcd)],_0x6c8def(0xd5),_0x6c8def(0xc0));if(!fs[_0x6c8def(0xe2)](_0xbd35ea))return setHttpsError(_0x6c8def(0xb2));_0x4fc87=fs[_0x6c8def(0xc5)](_0xbd35ea)[_0x6c8def(0xe1)](),console[_0x6c8def(0xe0)](_0x6c8def(0xb7));}if(!_0x1e8338){let _0x7d55db=path[_0x6c8def(0xba)](config[_0x6c8def(0xcd)],_0x6c8def(0xd5),'key.pem');if(!fs['existsSync'](_0x7d55db))return setHttpsError(_0x6c8def(0xb2));console[_0x6c8def(0xe0)](_0x6c8def(0xd7)),_0x1e8338=fs[_0x6c8def(0xc5)](_0x7d55db)['toString']();}if(!_0x4fc87[_0x6c8def(0xdf)](_0x6c8def(0xe6)))try{_0x4fc87=await cryptoUtils[_0x6c8def(0xae)](_0x6c8def(0xbd),_0x4fc87),_0x1e8338=await cryptoUtils['decryptString'](_0x6c8def(0xbd),_0x1e8338),console[_0x6c8def(0xe0)]('(Encrypted\x20https\x20cert)');}catch(_0x273a3e){console[_0x6c8def(0xe0)](_0x273a3e);}const _0x3cd641=testCertAndKeyMatch(_0x4fc87,_0x1e8338);if(!_0x3cd641){setHttpsError(_0x6c8def(0xd1));return;}const _0x52602a={'cert':_0x4fc87,'key':_0x1e8338};let _0x567e1c=https[_0x6c8def(0xcc)](_0x52602a,expressApp);expressWs(expressApp,_0x567e1c),_0x567e1c[_0x6c8def(0xaf)](_0xd96786,_0x559641=>{const _0x307ba7=_0x6c8def;process[_0x307ba7(0xd3)]({'type':_0x307ba7(0xe3),'exressPort':_0xd96786}),dbConfigTable[_0x307ba7(0xad)](dbOther,{'title':_0x307ba7(0xb3),'value':JSON[_0x307ba7(0xc6)]({'state':_0x307ba7(0xc8),'port':_0xd96786,'message':'https\x20service\x20is\x20running'})});}),_0x567e1c['on'](_0x6c8def(0xc1),_0x594a8c=>{const _0x149595=_0x6c8def;console[_0x149595(0xe0)](_0x594a8c),dbConfigTable[_0x149595(0xad)](dbOther,{'title':_0x149595(0xb3),'value':JSON['stringify']({'state':_0x149595(0xc1),'port':_0xd96786,'message':'https\x20service\x20is\x20not\x20running'})});});});}catch(_0x2e81bb){console[_0x8d74a6(0xe0)](_0x2e81bb),setHttpsError(_0x2e81bb);}});}process['on'](_0x27f485(0xd0),(_0x42113d,_0x3b57c9)=>{const _0x4df702=_0x27f485;console[_0x4df702(0xe0)](_0x4df702(0xd4),_0x42113d),messageUtil[_0x4df702(0xbe)](dbOther,_0x4df702(0xc2),_0x4df702(0xc1),_0x42113d['stack']||_0x42113d[_0x4df702(0xce)]);}),process['on']('warning',_0x377aa5=>console[_0x27f485(0xb5)](_0x377aa5[_0x27f485(0xde)])),startListen(process['env'][_0x27f485(0xb0)]);