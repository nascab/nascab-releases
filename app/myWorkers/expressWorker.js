const _0x4797f3=_0x146c;(function(_0x244f11,_0x16e56f){const _0x23621c=_0x146c,_0x27b709=_0x244f11();while(!![]){try{const _0x556958=-parseInt(_0x23621c(0x171))/0x1*(-parseInt(_0x23621c(0x1ab))/0x2)+parseInt(_0x23621c(0x187))/0x3*(parseInt(_0x23621c(0x1ad))/0x4)+-parseInt(_0x23621c(0x173))/0x5*(parseInt(_0x23621c(0x197))/0x6)+-parseInt(_0x23621c(0x16f))/0x7+-parseInt(_0x23621c(0x1b1))/0x8+-parseInt(_0x23621c(0x1a8))/0x9*(parseInt(_0x23621c(0x17d))/0xa)+parseInt(_0x23621c(0x19f))/0xb;if(_0x556958===_0x16e56f)break;else _0x27b709['push'](_0x27b709['shift']());}catch(_0x3bb3fe){_0x27b709['push'](_0x27b709['shift']());}}}(_0x380f,0x2e731));function _0x380f(){const _0x18874b=['Error\x20occurred\x20in\x20api\x20process','startsWith','(Custom\x20https\x20key)','value','createServer','existsSync','apiServerHttps','-----','create','env','../express-server/utils/cryptoUtils','https\x20service\x20is\x20not\x20running','证书信息:系统默认证书(Default\x20https\x20key)','dbOther','run','367242xhjrfb','expressStarted','(Encrypted\x20https\x20cert)','HTTPS\x20certs\x20error','https','log','title','tls','7437562CekZGg','appRootPath','stringify','../utils/messageUtil','express-ws','httpsServer\x20error\x20:\x20','HTTPS\x20certs\x20not\x20exist','httpsKey','message','5202ZtsZSa','证书信息:系统默认证书(Default\x20https\x20cert)','pragma','14sRqAPu','error','84RIDlWh','usePort','toString','https\x20service\x20is\x20not\x20running\x20','2197160SFVeBV','readFileSync','stack','1825796PpxbvP','join','14226mCqfnI','http','15AkEFzC','uncaughtException','https\x20service\x20is\x20running','apiPortHttps','journal_mode\x20=\x20WAL','then','expressStartedHttps','cert.pem','../express-server/app','findByTitle','3070ogGIPx','../myConfig/config','nasZs987bac','send','warn','close','listen','createSecureContext','key.pem','NasCabApiWorker','44439RyVDCS'];_0x380f=function(){return _0x18874b;};return _0x380f();}const expressApp=require(_0x4797f3(0x17b)),fs=require('fs'),path=require('path'),config=require(_0x4797f3(0x17e)),Database=require('better-sqlite3'),dbConfigTable=require('../db/dbConfigTable');let dbNoticeCenterTable=require('../db/dbNoticeCenterTable');const http=require(_0x4797f3(0x172)),https=require(_0x4797f3(0x19b));let dbOther=new Database(config[_0x4797f3(0x195)],{});dbOther[_0x4797f3(0x1aa)](_0x4797f3(0x177));let tls=require(_0x4797f3(0x19e));const cryptoUtils=require(_0x4797f3(0x192));var expressWs=require(_0x4797f3(0x1a3));const messageUtil=require(_0x4797f3(0x1a2));process[_0x4797f3(0x19d)]=_0x4797f3(0x186);function testCertAndKeyMatch(_0x36c84b,_0x3bcd9f){const _0x475b62=_0x4797f3;try{return tls[_0x475b62(0x184)]({'cert':_0x36c84b,'key':_0x3bcd9f}),!![];}catch(_0x531613){return![];}}function notifyMainLoadPage(_0x4866d2){const _0x1d1a2e=_0x4797f3;currentPort=_0x4866d2,process[_0x1d1a2e(0x180)]({'type':_0x1d1a2e(0x198),'exressPort':_0x4866d2});}function _0x146c(_0x13ace2,_0xc399bf){const _0x380fd7=_0x380f();return _0x146c=function(_0x146c77,_0xdbd953){_0x146c77=_0x146c77-0x16e;let _0x72d927=_0x380fd7[_0x146c77];return _0x72d927;},_0x146c(_0x13ace2,_0xc399bf);}function getFreePort(_0x39d33b,_0x27a331){const _0x53ea1b=_0x4797f3;_0x39d33b=parseInt(_0x39d33b),isPortFree(_0x39d33b)[_0x53ea1b(0x178)](_0xda9681=>{_0xda9681?_0x27a331(_0x39d33b):(_0x39d33b=parseInt(_0x39d33b)+0x1,getFreePort(_0x39d33b,_0x27a331));});}function isPortFree(_0x2ac511){return new Promise(_0x5efb29=>{const _0x37d327=_0x146c,_0x3a4046=http[_0x37d327(0x18c)]()[_0x37d327(0x183)](_0x2ac511,()=>{const _0x14b077=_0x37d327;_0x3a4046[_0x14b077(0x182)](),_0x5efb29(!![]);})['on']('error',()=>{_0x5efb29(![]);});});}function setHttpsError(_0x544d21){const _0x4b7b4e=_0x4797f3;console[_0x4b7b4e(0x19c)](_0x4b7b4e(0x1b0),_0x544d21),dbConfigTable['create'](dbOther,{'title':_0x4b7b4e(0x18e),'value':JSON['stringify']({'state':_0x4b7b4e(0x1ac),'port':0x0,'message':_0x544d21?JSON[_0x4b7b4e(0x1a1)](_0x544d21):'error'})}),dbNoticeCenterTable[_0x4b7b4e(0x190)](dbOther,{'title':'https\x20service\x20is\x20not\x20running','level':_0x4b7b4e(0x1ac),'content':_0x544d21?JSON[_0x4b7b4e(0x1a1)](_0x544d21):_0x4b7b4e(0x1ac)});}function startListen(_0x3637f7){const _0x7b447b=_0x4797f3;expressApp[_0x7b447b(0x183)](_0x3637f7,()=>{const _0x453a4d=_0x7b447b;notifyMainLoadPage(_0x3637f7);try{let _0x2c62a5=0x1bb,_0x37a847=dbConfigTable[_0x453a4d(0x17c)](dbOther,_0x453a4d(0x176));_0x37a847&&_0x37a847[_0x453a4d(0x18b)]&&_0x37a847[_0x453a4d(0x18b)]>0x0&&_0x37a847[_0x453a4d(0x18b)]<0xffff&&(_0x2c62a5=_0x37a847[_0x453a4d(0x18b)]),getFreePort(_0x2c62a5,async _0x5eb436=>{const _0x59bc49=_0x453a4d;_0x2c62a5=_0x5eb436;let _0x12f1a0='',_0x515029='',_0x3090bf=dbConfigTable[_0x59bc49(0x17c)](dbOther,'httpsCert');_0x3090bf&&_0x3090bf[_0x59bc49(0x18b)]&&(_0x12f1a0=_0x3090bf[_0x59bc49(0x18b)],console[_0x59bc49(0x19c)]('(Custom\x20https\x20cert)'));let _0x5a7fa3=dbConfigTable['findByTitle'](dbOther,_0x59bc49(0x1a6));_0x5a7fa3&&_0x5a7fa3[_0x59bc49(0x18b)]&&(_0x515029=_0x5a7fa3[_0x59bc49(0x18b)],console['log'](_0x59bc49(0x18a)));if(!_0x12f1a0){let _0x382475=path[_0x59bc49(0x170)](config[_0x59bc49(0x1a0)],'certs',_0x59bc49(0x17a));if(!fs[_0x59bc49(0x18d)](_0x382475))return setHttpsError(_0x59bc49(0x1a5));_0x12f1a0=fs['readFileSync'](_0x382475)[_0x59bc49(0x1af)](),console[_0x59bc49(0x19c)](_0x59bc49(0x1a9));}if(!_0x515029){let _0x189558=path[_0x59bc49(0x170)](config[_0x59bc49(0x1a0)],'certs',_0x59bc49(0x185));if(!fs[_0x59bc49(0x18d)](_0x189558))return setHttpsError(_0x59bc49(0x1a5));console[_0x59bc49(0x19c)](_0x59bc49(0x194)),_0x515029=fs[_0x59bc49(0x1b2)](_0x189558)['toString']();}if(!_0x12f1a0[_0x59bc49(0x189)](_0x59bc49(0x18f)))try{_0x12f1a0=await cryptoUtils['decryptString'](_0x59bc49(0x17f),_0x12f1a0),_0x515029=await cryptoUtils['decryptString'](_0x59bc49(0x17f),_0x515029),console['log'](_0x59bc49(0x199));}catch(_0x3319b1){console[_0x59bc49(0x19c)](_0x3319b1);}const _0x327696=testCertAndKeyMatch(_0x12f1a0,_0x515029);if(!_0x327696){setHttpsError(_0x59bc49(0x19a));return;}const _0x98925b={'cert':_0x12f1a0,'key':_0x515029};let _0x35b59f=https[_0x59bc49(0x18c)](_0x98925b,expressApp);expressWs(expressApp,_0x35b59f),_0x35b59f[_0x59bc49(0x183)](_0x2c62a5,_0x29dfb7=>{const _0x8c3d93=_0x59bc49;_0x29dfb7&&console[_0x8c3d93(0x19c)](_0x8c3d93(0x1a4),_0x29dfb7),process[_0x8c3d93(0x180)]({'type':_0x8c3d93(0x179),'exressPort':_0x2c62a5}),dbConfigTable[_0x8c3d93(0x190)](dbOther,{'title':'apiServerHttps','value':JSON['stringify']({'state':_0x8c3d93(0x196),'port':_0x2c62a5,'message':_0x8c3d93(0x175)})});}),_0x35b59f['on']('error',_0x405842=>{const _0xca71c1=_0x59bc49;console[_0xca71c1(0x19c)](_0xca71c1(0x1a4),_0x405842),dbConfigTable['create'](dbOther,{'title':'apiServerHttps','value':JSON[_0xca71c1(0x1a1)]({'state':'error','port':_0x2c62a5,'message':_0xca71c1(0x193)})});});});}catch(_0x387b43){console[_0x453a4d(0x19c)](_0x387b43),setHttpsError(_0x387b43);}});}process['on'](_0x4797f3(0x174),(_0x49ee1e,_0x37ff40)=>{const _0x2ff7ec=_0x4797f3;console['log']('Error\x20occurred\x20in\x20api\x20process\x20',_0x49ee1e),messageUtil['saveMsg'](dbOther,_0x2ff7ec(0x188),_0x2ff7ec(0x1ac),_0x49ee1e[_0x2ff7ec(0x16e)]||_0x49ee1e[_0x2ff7ec(0x1a7)]);}),process['on']('warning',_0x2369b3=>console[_0x4797f3(0x181)](_0x2369b3[_0x4797f3(0x16e)])),startListen(process[_0x4797f3(0x191)][_0x4797f3(0x1ae)]);