const _0x4d6976=_0x2a16;(function(_0x421be2,_0x2e8b38){const _0x239765=_0x2a16,_0x531d94=_0x421be2();while(!![]){try{const _0x5cc4f3=parseInt(_0x239765(0x1f0))/0x1+parseInt(_0x239765(0x20d))/0x2+parseInt(_0x239765(0x1fd))/0x3+-parseInt(_0x239765(0x1fa))/0x4*(-parseInt(_0x239765(0x202))/0x5)+parseInt(_0x239765(0x22c))/0x6*(parseInt(_0x239765(0x219))/0x7)+-parseInt(_0x239765(0x20f))/0x8*(-parseInt(_0x239765(0x1f4))/0x9)+parseInt(_0x239765(0x223))/0xa*(-parseInt(_0x239765(0x201))/0xb);if(_0x5cc4f3===_0x2e8b38)break;else _0x531d94['push'](_0x531d94['shift']());}catch(_0x247a7d){_0x531d94['push'](_0x531d94['shift']());}}}(_0x49b5,0xed7cd));const expressApp=require(_0x4d6976(0x220)),fs=require('fs'),path=require(_0x4d6976(0x206)),config=require('../myConfig/config'),Database=require(_0x4d6976(0x222)),dbConfigTable=require(_0x4d6976(0x1fe));function _0x49b5(){const _0x3eeec6=['dbOther','81hMiWRe','stack','message','create','decryptString','(Custom\x20https\x20key)','1076qoXjxf','apiServerHttps','tls','5462190NOpRhD','../db/dbConfigTable','send','httpsKey','11PofLoU','4245GvmDZB','../db/dbNoticeCenterTable','Error\x20occurred\x20in\x20api\x20process\x20','createServer','path','journal_mode\x20=\x20WAL','express-ws','saveMsg','-----','https\x20service\x20is\x20not\x20running','existsSync','1654804arouuv','close','470920zuiwib','证书信息:系统默认证书(Default\x20https\x20key)','(Encrypted\x20https\x20cert)','证书信息:系统默认证书(Default\x20https\x20cert)','log','cert.pem','title','appRootPath','error','env','42Rdxyko','HTTPS\x20certs\x20error','value','certs','createSecureContext','then','findByTitle','../express-server/app','join','better-sqlite3','48233110IZQEdF','warn','listen','https\x20service\x20is\x20running','../utils/messageUtil','startsWith','https','nasZs987bac','readFileSync','657138JmYBzI','apiPortHttps','toString','(Custom\x20https\x20cert)','Error\x20occurred\x20in\x20api\x20process','stringify','1732624SoskfL','key.pem','HTTPS\x20certs\x20not\x20exist'];_0x49b5=function(){return _0x3eeec6;};return _0x49b5();}let dbNoticeCenterTable=require(_0x4d6976(0x203));const http=require('http'),https=require(_0x4d6976(0x229));let dbOther=new Database(config[_0x4d6976(0x1f3)],{});dbOther['pragma'](_0x4d6976(0x207));let tls=require(_0x4d6976(0x1fc));const cryptoUtils=require('../express-server/utils/cryptoUtils');function _0x2a16(_0x163f43,_0x45babc){const _0x49b555=_0x49b5();return _0x2a16=function(_0x2a1690,_0x57ba46){_0x2a1690=_0x2a1690-0x1ed;let _0x4c043d=_0x49b555[_0x2a1690];return _0x4c043d;},_0x2a16(_0x163f43,_0x45babc);}var expressWs=require(_0x4d6976(0x208));const messageUtil=require(_0x4d6976(0x227));process[_0x4d6976(0x215)]='NasCabApiWorker';function testCertAndKeyMatch(_0x3cab0d,_0x4e8237){const _0x334994=_0x4d6976;try{return tls[_0x334994(0x21d)]({'cert':_0x3cab0d,'key':_0x4e8237}),!![];}catch(_0x5df37c){return![];}}function notifyMainLoadPage(_0x1fca6e){const _0x47a7f6=_0x4d6976;currentPort=_0x1fca6e,process[_0x47a7f6(0x1ff)]({'type':'expressStarted','exressPort':_0x1fca6e});}function getFreePort(_0x3afdef,_0x4a7b5d){const _0x535939=_0x4d6976;_0x3afdef=parseInt(_0x3afdef),isPortFree(_0x3afdef)[_0x535939(0x21e)](_0x4e5f88=>{_0x4e5f88?_0x4a7b5d(_0x3afdef):(_0x3afdef=parseInt(_0x3afdef)+0x1,getFreePort(_0x3afdef,_0x4a7b5d));});}function isPortFree(_0x5089f3){return new Promise(_0xeba43b=>{const _0x2394bd=_0x2a16,_0x241e25=http[_0x2394bd(0x205)]()[_0x2394bd(0x225)](_0x5089f3,()=>{const _0x435245=_0x2394bd;_0x241e25[_0x435245(0x20e)](),_0xeba43b(!![]);})['on']('error',()=>{_0xeba43b(![]);});});}function setHttpsError(_0x58362f){const _0x1f215c=_0x4d6976;console[_0x1f215c(0x213)]('https\x20service\x20is\x20not\x20running\x20',_0x58362f),dbConfigTable[_0x1f215c(0x1f7)](dbOther,{'title':_0x1f215c(0x1fb),'value':JSON[_0x1f215c(0x1ef)]({'state':_0x1f215c(0x217),'port':0x0,'message':_0x58362f?JSON[_0x1f215c(0x1ef)](_0x58362f):_0x1f215c(0x217)})}),dbNoticeCenterTable['create'](dbOther,{'title':_0x1f215c(0x20b),'level':_0x1f215c(0x217),'content':_0x58362f?JSON['stringify'](_0x58362f):'error'});}function startListen(_0x3ec9ee){const _0x58e52f=_0x4d6976;expressApp[_0x58e52f(0x225)](_0x3ec9ee,()=>{const _0x5511c6=_0x58e52f;notifyMainLoadPage(_0x3ec9ee);try{let _0x41907d=0x1bb,_0x6f6c6a=dbConfigTable[_0x5511c6(0x21f)](dbOther,_0x5511c6(0x22d));_0x6f6c6a&&_0x6f6c6a[_0x5511c6(0x21b)]&&_0x6f6c6a['value']>0x0&&_0x6f6c6a[_0x5511c6(0x21b)]<0xffff&&(_0x41907d=_0x6f6c6a[_0x5511c6(0x21b)]),getFreePort(_0x41907d,async _0x4c6eae=>{const _0x170a6d=_0x5511c6;_0x41907d=_0x4c6eae;let _0x3e32ad='',_0x3bae01='',_0x794217=dbConfigTable[_0x170a6d(0x21f)](dbOther,'httpsCert');_0x794217&&_0x794217[_0x170a6d(0x21b)]&&(_0x3e32ad=_0x794217[_0x170a6d(0x21b)],console[_0x170a6d(0x213)](_0x170a6d(0x1ed)));let _0x23ab3d=dbConfigTable[_0x170a6d(0x21f)](dbOther,_0x170a6d(0x200));_0x23ab3d&&_0x23ab3d[_0x170a6d(0x21b)]&&(_0x3bae01=_0x23ab3d[_0x170a6d(0x21b)],console[_0x170a6d(0x213)](_0x170a6d(0x1f9)));if(!_0x3e32ad){let _0x421574=path['join'](config[_0x170a6d(0x216)],_0x170a6d(0x21c),_0x170a6d(0x214));if(!fs[_0x170a6d(0x20c)](_0x421574))return setHttpsError(_0x170a6d(0x1f2));_0x3e32ad=fs[_0x170a6d(0x22b)](_0x421574)[_0x170a6d(0x22e)](),console[_0x170a6d(0x213)](_0x170a6d(0x212));}if(!_0x3bae01){let _0x3eca16=path[_0x170a6d(0x221)](config[_0x170a6d(0x216)],_0x170a6d(0x21c),_0x170a6d(0x1f1));if(!fs[_0x170a6d(0x20c)](_0x3eca16))return setHttpsError(_0x170a6d(0x1f2));console['log'](_0x170a6d(0x210)),_0x3bae01=fs[_0x170a6d(0x22b)](_0x3eca16)[_0x170a6d(0x22e)]();}if(!_0x3e32ad[_0x170a6d(0x228)](_0x170a6d(0x20a)))try{_0x3e32ad=await cryptoUtils[_0x170a6d(0x1f8)](_0x170a6d(0x22a),_0x3e32ad),_0x3bae01=await cryptoUtils[_0x170a6d(0x1f8)](_0x170a6d(0x22a),_0x3bae01),console['log'](_0x170a6d(0x211));}catch(_0x4cfe8d){console[_0x170a6d(0x213)](_0x4cfe8d);}const _0x11f108=testCertAndKeyMatch(_0x3e32ad,_0x3bae01);if(!_0x11f108){setHttpsError(_0x170a6d(0x21a));return;}const _0x39fd9b={'cert':_0x3e32ad,'key':_0x3bae01};let _0x536c8b=https['createServer'](_0x39fd9b,expressApp);expressWs(expressApp,_0x536c8b),_0x536c8b[_0x170a6d(0x225)](_0x41907d,_0x284eb5=>{const _0x2b6af2=_0x170a6d;process[_0x2b6af2(0x1ff)]({'type':'expressStartedHttps','exressPort':_0x41907d}),dbConfigTable[_0x2b6af2(0x1f7)](dbOther,{'title':'apiServerHttps','value':JSON[_0x2b6af2(0x1ef)]({'state':'run','port':_0x41907d,'message':_0x2b6af2(0x226)})});}),_0x536c8b['on'](_0x170a6d(0x217),_0x50416f=>{const _0x4364e6=_0x170a6d;console[_0x4364e6(0x213)](_0x50416f),dbConfigTable[_0x4364e6(0x1f7)](dbOther,{'title':_0x4364e6(0x1fb),'value':JSON[_0x4364e6(0x1ef)]({'state':_0x4364e6(0x217),'port':_0x41907d,'message':'https\x20service\x20is\x20not\x20running'})});});});}catch(_0x11e9ec){console[_0x5511c6(0x213)](_0x11e9ec),setHttpsError(_0x11e9ec);}});}process['on']('uncaughtException',(_0x56eb87,_0xb9af0c)=>{const _0x23fd8e=_0x4d6976;console['log'](_0x23fd8e(0x204),_0x56eb87),messageUtil[_0x23fd8e(0x209)](dbOther,_0x23fd8e(0x1ee),_0x23fd8e(0x217),_0x56eb87['stack']||_0x56eb87[_0x23fd8e(0x1f6)]);}),process['on']('warning',_0x34099c=>console[_0x4d6976(0x224)](_0x34099c[_0x4d6976(0x1f5)])),startListen(process[_0x4d6976(0x218)]['usePort']);