const _0x188073=_0x3459;(function(_0x22b458,_0x2386a5){const _0x21cb4c=_0x3459,_0x1a73b3=_0x22b458();while(!![]){try{const _0x7bcf49=parseInt(_0x21cb4c(0x1b7))/0x1+-parseInt(_0x21cb4c(0x1aa))/0x2+-parseInt(_0x21cb4c(0x185))/0x3+-parseInt(_0x21cb4c(0x183))/0x4+-parseInt(_0x21cb4c(0x17e))/0x5+-parseInt(_0x21cb4c(0x1b0))/0x6*(parseInt(_0x21cb4c(0x192))/0x7)+parseInt(_0x21cb4c(0x184))/0x8;if(_0x7bcf49===_0x2386a5)break;else _0x1a73b3['push'](_0x1a73b3['shift']());}catch(_0x4683ba){_0x1a73b3['push'](_0x1a73b3['shift']());}}}(_0x5b19,0x8452b));const expressApp=require('../express-server/app'),fs=require('fs'),path=require(_0x188073(0x198)),config=require('../myConfig/config'),Database=require(_0x188073(0x1ab)),dbConfigTable=require('../db/dbConfigTable');let dbNoticeCenterTable=require('../db/dbNoticeCenterTable');const http=require(_0x188073(0x191)),https=require(_0x188073(0x18d));let dbOther=new Database(config[_0x188073(0x1a2)],{});dbOther[_0x188073(0x1b1)](_0x188073(0x1a1));let tls=require('tls');const cryptoUtils=require(_0x188073(0x1ae));var expressWs=require(_0x188073(0x19e));function _0x5b19(){const _0x369677=['certs','HTTPS\x20certs\x20error','../express-server/utils/cryptoUtils','证书信息:系统默认证书(Default\x20https\x20key)','5201268tHZMuE','pragma','send','https\x20service\x20is\x20not\x20running','(Custom\x20https\x20key)','httpsServer\x20error\x20:\x20','join','942805gfxXOT','existsSync','nasZs987bac','warn','-----','188005tMVFgP','error','title','key.pem','then','2618632VDoOUW','19914648bAVabt','2663952GVuoAL','log','message','stringify','findByTitle','apiServerHttps','toString','createSecureContext','https','create','expressStartedHttps','NasCabApiWorker','http','7dPlyqz','env','warning','readFileSync','listen','Error\x20occurred\x20in\x20api\x20process\x20','path','decryptString','证书信息:系统默认证书(Default\x20https\x20cert)','startsWith','HTTPS\x20certs\x20not\x20exist','usePort','express-ws','httpsCert','value','journal_mode\x20=\x20WAL','dbOther','(Encrypted\x20https\x20cert)','stack','saveMsg','appRootPath','cert.pem','close','(Custom\x20https\x20cert)','886040QomAaP','better-sqlite3'];_0x5b19=function(){return _0x369677;};return _0x5b19();}const messageUtil=require('../utils/messageUtil');process[_0x188073(0x180)]=_0x188073(0x190);function testCertAndKeyMatch(_0x2cd8fa,_0x2c1c50){const _0x5ece71=_0x188073;try{return tls[_0x5ece71(0x18c)]({'cert':_0x2cd8fa,'key':_0x2c1c50}),!![];}catch(_0x544bca){return![];}}function notifyMainLoadPage(_0x35ae20){const _0x48e96a=_0x188073;currentPort=_0x35ae20,process[_0x48e96a(0x1b2)]({'type':'expressStarted','exressPort':_0x35ae20});}function getFreePort(_0x1ea720,_0x33108e){const _0x1ed390=_0x188073;_0x1ea720=parseInt(_0x1ea720),isPortFree(_0x1ea720)[_0x1ed390(0x182)](_0x5bab8e=>{_0x5bab8e?_0x33108e(_0x1ea720):(_0x1ea720=parseInt(_0x1ea720)+0x1,getFreePort(_0x1ea720,_0x33108e));});}function _0x3459(_0x27b858,_0x469ed4){const _0x5b195b=_0x5b19();return _0x3459=function(_0x34596d,_0x5a6057){_0x34596d=_0x34596d-0x17d;let _0x5adede=_0x5b195b[_0x34596d];return _0x5adede;},_0x3459(_0x27b858,_0x469ed4);}function isPortFree(_0xd3bb97){return new Promise(_0x313489=>{const _0x502982=_0x3459,_0x17ad08=http['createServer']()[_0x502982(0x196)](_0xd3bb97,()=>{const _0x2a6ea7=_0x502982;_0x17ad08[_0x2a6ea7(0x1a8)](),_0x313489(!![]);})['on'](_0x502982(0x17f),()=>{_0x313489(![]);});});}function setHttpsError(_0x2f1d5f){const _0x1cb389=_0x188073;console['log']('https\x20service\x20is\x20not\x20running\x20',_0x2f1d5f),dbConfigTable['create'](dbOther,{'title':_0x1cb389(0x18a),'value':JSON[_0x1cb389(0x188)]({'state':'error','port':0x0,'message':_0x2f1d5f?JSON[_0x1cb389(0x188)](_0x2f1d5f):_0x1cb389(0x17f)})}),dbNoticeCenterTable['create'](dbOther,{'title':_0x1cb389(0x1b3),'level':_0x1cb389(0x17f),'content':_0x2f1d5f?JSON[_0x1cb389(0x188)](_0x2f1d5f):_0x1cb389(0x17f)});}function startListen(_0x4a9ba3){expressApp['listen'](_0x4a9ba3,()=>{const _0x489563=_0x3459;notifyMainLoadPage(_0x4a9ba3);try{let _0x3288ac=0x1bb,_0x4fd718=dbConfigTable[_0x489563(0x189)](dbOther,'apiPortHttps');_0x4fd718&&_0x4fd718[_0x489563(0x1a0)]&&_0x4fd718[_0x489563(0x1a0)]>0x0&&_0x4fd718['value']<0xffff&&(_0x3288ac=_0x4fd718[_0x489563(0x1a0)]),getFreePort(_0x3288ac,async _0x36cb4b=>{const _0x23ee9b=_0x489563;_0x3288ac=_0x36cb4b;let _0xe214af='',_0x1cf050='',_0x18c57b=dbConfigTable[_0x23ee9b(0x189)](dbOther,_0x23ee9b(0x19f));_0x18c57b&&_0x18c57b['value']&&(_0xe214af=_0x18c57b[_0x23ee9b(0x1a0)],console['log'](_0x23ee9b(0x1a9)));let _0x2304ce=dbConfigTable['findByTitle'](dbOther,'httpsKey');_0x2304ce&&_0x2304ce[_0x23ee9b(0x1a0)]&&(_0x1cf050=_0x2304ce['value'],console[_0x23ee9b(0x186)](_0x23ee9b(0x1b4)));if(!_0xe214af){let _0x44bab3=path[_0x23ee9b(0x1b6)](config[_0x23ee9b(0x1a6)],_0x23ee9b(0x1ac),_0x23ee9b(0x1a7));if(!fs[_0x23ee9b(0x1b8)](_0x44bab3))return setHttpsError('HTTPS\x20certs\x20not\x20exist');_0xe214af=fs[_0x23ee9b(0x195)](_0x44bab3)['toString'](),console['log'](_0x23ee9b(0x19a));}if(!_0x1cf050){let _0x46f7fa=path[_0x23ee9b(0x1b6)](config[_0x23ee9b(0x1a6)],_0x23ee9b(0x1ac),_0x23ee9b(0x181));if(!fs[_0x23ee9b(0x1b8)](_0x46f7fa))return setHttpsError(_0x23ee9b(0x19c));console['log'](_0x23ee9b(0x1af)),_0x1cf050=fs[_0x23ee9b(0x195)](_0x46f7fa)[_0x23ee9b(0x18b)]();}if(!_0xe214af[_0x23ee9b(0x19b)](_0x23ee9b(0x17d)))try{_0xe214af=await cryptoUtils[_0x23ee9b(0x199)]('nasZs987bac',_0xe214af),_0x1cf050=await cryptoUtils[_0x23ee9b(0x199)](_0x23ee9b(0x1b9),_0x1cf050),console[_0x23ee9b(0x186)](_0x23ee9b(0x1a3));}catch(_0x43f032){console[_0x23ee9b(0x186)](_0x43f032);}const _0x4b24bb=testCertAndKeyMatch(_0xe214af,_0x1cf050);if(!_0x4b24bb){setHttpsError(_0x23ee9b(0x1ad));return;}const _0x30fd7d={'cert':_0xe214af,'key':_0x1cf050};let _0x5d5053=https['createServer'](_0x30fd7d,expressApp);expressWs(expressApp,_0x5d5053),_0x5d5053[_0x23ee9b(0x196)](_0x3288ac,_0x5c8f0d=>{const _0x59e7c0=_0x23ee9b;_0x5c8f0d&&console['log'](_0x59e7c0(0x1b5),_0x5c8f0d),process['send']({'type':_0x59e7c0(0x18f),'exressPort':_0x3288ac}),dbConfigTable[_0x59e7c0(0x18e)](dbOther,{'title':_0x59e7c0(0x18a),'value':JSON[_0x59e7c0(0x188)]({'state':'run','port':_0x3288ac,'message':'https\x20service\x20is\x20running'})});}),_0x5d5053['on'](_0x23ee9b(0x17f),_0x321fcd=>{const _0x3d87e5=_0x23ee9b;console[_0x3d87e5(0x186)](_0x3d87e5(0x1b5),_0x321fcd),dbConfigTable[_0x3d87e5(0x18e)](dbOther,{'title':_0x3d87e5(0x18a),'value':JSON[_0x3d87e5(0x188)]({'state':'error','port':_0x3288ac,'message':'https\x20service\x20is\x20not\x20running'})});});});}catch(_0x50c537){console['log'](_0x50c537),setHttpsError(_0x50c537);}});}process['on']('uncaughtException',(_0x568dae,_0x558bb6)=>{const _0x3dfc3e=_0x188073;console[_0x3dfc3e(0x186)](_0x3dfc3e(0x197),_0x568dae),messageUtil[_0x3dfc3e(0x1a5)](dbOther,'Error\x20occurred\x20in\x20api\x20process',_0x3dfc3e(0x17f),_0x568dae[_0x3dfc3e(0x1a4)]||_0x568dae[_0x3dfc3e(0x187)]);}),process['on'](_0x188073(0x194),_0x3828a8=>console[_0x188073(0x1ba)](_0x3828a8[_0x188073(0x1a4)])),startListen(process[_0x188073(0x193)][_0x188073(0x19d)]);