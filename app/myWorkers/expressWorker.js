const _0x37639e=_0x378f;(function(_0x5e6999,_0x3c2f3b){const _0x46e9cb=_0x378f,_0xa94ec8=_0x5e6999();while(!![]){try{const _0x39422a=parseInt(_0x46e9cb(0xad))/0x1+-parseInt(_0x46e9cb(0xbd))/0x2+-parseInt(_0x46e9cb(0xb4))/0x3+-parseInt(_0x46e9cb(0xc6))/0x4+parseInt(_0x46e9cb(0xb2))/0x5*(parseInt(_0x46e9cb(0xb5))/0x6)+-parseInt(_0x46e9cb(0x98))/0x7+parseInt(_0x46e9cb(0x90))/0x8*(parseInt(_0x46e9cb(0x8f))/0x9);if(_0x39422a===_0x3c2f3b)break;else _0xa94ec8['push'](_0xa94ec8['shift']());}catch(_0x55e377){_0xa94ec8['push'](_0xa94ec8['shift']());}}}(_0x3800,0x909c2));const expressApp=require('../express-server/app'),fs=require('fs'),path=require(_0x37639e(0x96)),config=require('../myConfig/config'),Database=require(_0x37639e(0xa7)),dbConfigTable=require(_0x37639e(0xb8));function _0x378f(_0x386761,_0x10906a){const _0x380038=_0x3800();return _0x378f=function(_0x378fec,_0x2fb1ec){_0x378fec=_0x378fec-0x8c;let _0xaa8136=_0x380038[_0x378fec];return _0xaa8136;},_0x378f(_0x386761,_0x10906a);}let dbNoticeCenterTable=require(_0x37639e(0xc7));const http=require('http'),https=require(_0x37639e(0x93));function _0x3800(){const _0x220bbb=['https\x20service\x20is\x20not\x20running\x20','apiPortHttps','expressStartedHttps','close','(Custom\x20https\x20cert)','../utils/messageUtil','(Custom\x20https\x20key)','dbOther','9HdEXJV','8061512PgoeHo','decryptString','certs','https','create','listen','path','message','2807798rUmtBf','error','readFileSync','-----','nasZs987bac','warn','findByTitle','key.pem','log','existsSync','value','toString','(Encrypted\x20https\x20cert)','Error\x20occurred\x20in\x20api\x20process\x20','startsWith','better-sqlite3','apiServerHttps','warning','cert.pem','appRootPath','express-ws','1125429TxFFzl','Error\x20occurred\x20in\x20api\x20process','tls','stack','send','15egFLFe','证书信息:系统默认证书(Default\x20https\x20key)','2409888kMptpl','1445298hHHBVl','https\x20service\x20is\x20not\x20running','saveMsg','../db/dbConfigTable','stringify','NasCabApiWorker','httpsServer\x20error\x20:\x20','HTTPS\x20certs\x20error','1107142vJUQEH','env','httpsKey','HTTPS\x20certs\x20not\x20exist','证书信息:系统默认证书(Default\x20https\x20cert)','join','createServer','createSecureContext','httpsCert','2021856EqXkwh','../db/dbNoticeCenterTable','then'];_0x3800=function(){return _0x220bbb;};return _0x3800();}let dbOther=new Database(config[_0x37639e(0x8e)],{});dbOther['pragma']('journal_mode\x20=\x20WAL');let tls=require(_0x37639e(0xaf));const cryptoUtils=require('../express-server/utils/cryptoUtils');var expressWs=require(_0x37639e(0xac));const messageUtil=require(_0x37639e(0x8c));process['title']=_0x37639e(0xba);function testCertAndKeyMatch(_0x39df25,_0x4afcb5){const _0x195dae=_0x37639e;try{return tls[_0x195dae(0xc4)]({'cert':_0x39df25,'key':_0x4afcb5}),!![];}catch(_0x2004e1){return![];}}function notifyMainLoadPage(_0x5bf680){currentPort=_0x5bf680,process['send']({'type':'expressStarted','exressPort':_0x5bf680});}function getFreePort(_0x3d095c,_0x31cc9d){const _0x48bdcc=_0x37639e;_0x3d095c=parseInt(_0x3d095c),isPortFree(_0x3d095c)[_0x48bdcc(0xc8)](_0x21e1b5=>{_0x21e1b5?_0x31cc9d(_0x3d095c):(_0x3d095c=parseInt(_0x3d095c)+0x1,getFreePort(_0x3d095c,_0x31cc9d));});}function isPortFree(_0x11d1a0){return new Promise(_0x1ff6a9=>{const _0x281744=_0x378f,_0xeca04f=http[_0x281744(0xc3)]()['listen'](_0x11d1a0,()=>{const _0x139363=_0x281744;_0xeca04f[_0x139363(0xcc)](),_0x1ff6a9(!![]);})['on'](_0x281744(0x99),()=>{_0x1ff6a9(![]);});});}function setHttpsError(_0x22e3b4){const _0x7c73f1=_0x37639e;console[_0x7c73f1(0xa0)](_0x7c73f1(0xc9),_0x22e3b4),dbConfigTable[_0x7c73f1(0x94)](dbOther,{'title':_0x7c73f1(0xa8),'value':JSON[_0x7c73f1(0xb9)]({'state':'error','port':0x0,'message':_0x22e3b4?JSON[_0x7c73f1(0xb9)](_0x22e3b4):'error'})}),dbNoticeCenterTable[_0x7c73f1(0x94)](dbOther,{'title':'https\x20service\x20is\x20not\x20running','level':_0x7c73f1(0x99),'content':_0x22e3b4?JSON[_0x7c73f1(0xb9)](_0x22e3b4):_0x7c73f1(0x99)});}function startListen(_0x58e409){const _0x11bab9=_0x37639e;expressApp[_0x11bab9(0x95)](_0x58e409,()=>{const _0x1f2770=_0x11bab9;notifyMainLoadPage(_0x58e409);try{let _0x14b0f6=0x1bb,_0x2a7358=dbConfigTable['findByTitle'](dbOther,_0x1f2770(0xca));_0x2a7358&&_0x2a7358[_0x1f2770(0xa2)]&&_0x2a7358[_0x1f2770(0xa2)]>0x0&&_0x2a7358['value']<0xffff&&(_0x14b0f6=_0x2a7358[_0x1f2770(0xa2)]),getFreePort(_0x14b0f6,async _0xbe461f=>{const _0x4b56b9=_0x1f2770;_0x14b0f6=_0xbe461f;let _0x23eaba='',_0x3ba0e1='',_0x47bcc2=dbConfigTable[_0x4b56b9(0x9e)](dbOther,_0x4b56b9(0xc5));_0x47bcc2&&_0x47bcc2[_0x4b56b9(0xa2)]&&(_0x23eaba=_0x47bcc2[_0x4b56b9(0xa2)],console['log'](_0x4b56b9(0xcd)));let _0x5affe4=dbConfigTable[_0x4b56b9(0x9e)](dbOther,_0x4b56b9(0xbf));_0x5affe4&&_0x5affe4[_0x4b56b9(0xa2)]&&(_0x3ba0e1=_0x5affe4['value'],console['log'](_0x4b56b9(0x8d)));if(!_0x23eaba){let _0x40c192=path[_0x4b56b9(0xc2)](config[_0x4b56b9(0xab)],_0x4b56b9(0x92),_0x4b56b9(0xaa));if(!fs[_0x4b56b9(0xa1)](_0x40c192))return setHttpsError(_0x4b56b9(0xc0));_0x23eaba=fs[_0x4b56b9(0x9a)](_0x40c192)[_0x4b56b9(0xa3)](),console[_0x4b56b9(0xa0)](_0x4b56b9(0xc1));}if(!_0x3ba0e1){let _0x4b9c9b=path['join'](config[_0x4b56b9(0xab)],_0x4b56b9(0x92),_0x4b56b9(0x9f));if(!fs[_0x4b56b9(0xa1)](_0x4b9c9b))return setHttpsError(_0x4b56b9(0xc0));console[_0x4b56b9(0xa0)](_0x4b56b9(0xb3)),_0x3ba0e1=fs['readFileSync'](_0x4b9c9b)[_0x4b56b9(0xa3)]();}if(!_0x23eaba[_0x4b56b9(0xa6)](_0x4b56b9(0x9b)))try{_0x23eaba=await cryptoUtils[_0x4b56b9(0x91)](_0x4b56b9(0x9c),_0x23eaba),_0x3ba0e1=await cryptoUtils[_0x4b56b9(0x91)](_0x4b56b9(0x9c),_0x3ba0e1),console[_0x4b56b9(0xa0)](_0x4b56b9(0xa4));}catch(_0xb00384){console[_0x4b56b9(0xa0)](_0xb00384);}const _0x873ab2=testCertAndKeyMatch(_0x23eaba,_0x3ba0e1);if(!_0x873ab2){setHttpsError(_0x4b56b9(0xbc));return;}const _0x179b04={'cert':_0x23eaba,'key':_0x3ba0e1};let _0xb225f9=https[_0x4b56b9(0xc3)](_0x179b04,expressApp);expressWs(expressApp,_0xb225f9),_0xb225f9[_0x4b56b9(0x95)](_0x14b0f6,_0x3fbb22=>{const _0x1e4f3d=_0x4b56b9;_0x3fbb22&&console[_0x1e4f3d(0xa0)](_0x1e4f3d(0xbb),_0x3fbb22),process[_0x1e4f3d(0xb1)]({'type':_0x1e4f3d(0xcb),'exressPort':_0x14b0f6}),dbConfigTable['create'](dbOther,{'title':'apiServerHttps','value':JSON[_0x1e4f3d(0xb9)]({'state':'run','port':_0x14b0f6,'message':'https\x20service\x20is\x20running'})});}),_0xb225f9['on']('error',_0x11fd03=>{const _0x42fab8=_0x4b56b9;console[_0x42fab8(0xa0)](_0x42fab8(0xbb),_0x11fd03),dbConfigTable[_0x42fab8(0x94)](dbOther,{'title':_0x42fab8(0xa8),'value':JSON['stringify']({'state':_0x42fab8(0x99),'port':_0x14b0f6,'message':_0x42fab8(0xb6)})});});});}catch(_0xf72ac2){console[_0x1f2770(0xa0)](_0xf72ac2),setHttpsError(_0xf72ac2);}});}process['on']('uncaughtException',(_0x1abb46,_0x26f38a)=>{const _0x5d5349=_0x37639e;console['log'](_0x5d5349(0xa5),_0x1abb46),messageUtil[_0x5d5349(0xb7)](dbOther,_0x5d5349(0xae),_0x5d5349(0x99),_0x1abb46[_0x5d5349(0xb0)]||_0x1abb46[_0x5d5349(0x97)]);}),process['on'](_0x37639e(0xa9),_0x115413=>console[_0x37639e(0x9d)](_0x115413[_0x37639e(0xb0)])),startListen(process[_0x37639e(0xbe)]['usePort']);