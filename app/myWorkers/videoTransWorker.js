const _0x160abd=_0x5408;(function(_0x44a4cd,_0x4ad145){const _0x99f926=_0x5408,_0x54ea46=_0x44a4cd();while(!![]){try{const _0x367426=parseInt(_0x99f926(0x94))/0x1+-parseInt(_0x99f926(0x75))/0x2*(parseInt(_0x99f926(0x9c))/0x3)+-parseInt(_0x99f926(0x87))/0x4+parseInt(_0x99f926(0x9e))/0x5+-parseInt(_0x99f926(0x88))/0x6*(parseInt(_0x99f926(0x90))/0x7)+parseInt(_0x99f926(0x9d))/0x8*(-parseInt(_0x99f926(0x86))/0x9)+parseInt(_0x99f926(0x81))/0xa;if(_0x367426===_0x4ad145)break;else _0x54ea46['push'](_0x54ea46['shift']());}catch(_0xd302f0){_0x54ea46['push'](_0x54ea46['shift']());}}}(_0x5247,0xe782f));function _0x5247(){const _0x5d9a8d=['updateTask','exit','task_json','28686380VrnHak','source_path','push','taskObj','log','10972512bfWiNA','2073888oSFdCE','2478izUIqU','send','err2','targetFolderNotExist','TASK_STATE_FAIL','sourceStat','path','isFile','29218WmBNMa','TASK_STATE_RUNNING','dbOther','isDirectory','1497677hkSfQx','statSync','length','noWritePermission','结束媒体整理线程','join','未传递任务数据','basename','468yjSlat','8tCHowK','8455650wRfwIJ','../myConfig/config','getByIdAndCreateTime','size','../utils/mediaUtils','includes','checkFolderPower','TASK_STATE_SUC','pragma','create_time','taskData','better-sqlite3','21124ejLNsa','extname','视频转换\x20线程异常','fileCopyFail','close','NasCabMediaArrangeWorker','existsSync','journal_mode\x20=\x20WAL','../utils/i18nUtil'];_0x5247=function(){return _0x5d9a8d;};return _0x5247();}const Database=require(_0x160abd(0x74)),config=require(_0x160abd(0x6a));let dbOther=new Database(config[_0x160abd(0x92)],{});dbOther[_0x160abd(0x71)](_0x160abd(0x7c));function _0x5408(_0x5f0062,_0x256aeb){const _0x524713=_0x5247();return _0x5408=function(_0x5408d9,_0x4337ab){_0x5408d9=_0x5408d9-0x6a;let _0x1f4d8e=_0x524713[_0x5408d9];return _0x1f4d8e;},_0x5408(_0x5f0062,_0x256aeb);}let path=require(_0x160abd(0x8e)),fs=require('fs'),i18nUtil=require(_0x160abd(0x7d)),fileStatUtil=require('../utils/fileStatUtil');const dbMediaTools=require('../db/dbMediaTools'),mediaUtils=require(_0x160abd(0x6d));let i18n=i18nUtil['getI18n'](dbOther);process['title']=_0x160abd(0x7a);let currentTaskObj=null,copyFileCount=0x0,copySize=0x0,totalSize=0x0,failCount=0x0;async function transVideo(_0x4bfbf4){}async function runCurrentTask(){const _0x2b616c=_0x160abd;let _0x993ac1=currentTaskObj[_0x2b616c(0x73)][_0x2b616c(0x82)],_0x40ec5b=currentTaskObj[_0x2b616c(0x73)]['target_path'],_0x28ae6c=[];async function _0x2d617f(_0x1bde6a,_0x541896){const _0x5624c2=_0x2b616c;let _0x36169d=fs['readdirSync'](_0x541896),_0x1ba635=path['relative'](_0x1bde6a,_0x541896);for(let _0x11b8c5=0x0;_0x11b8c5<_0x36169d['length'];_0x11b8c5++){let _0x177403=_0x36169d[_0x11b8c5],_0x5cd202=path[_0x5624c2(0x99)](_0x541896,_0x177403),_0x173d8e=fs[_0x5624c2(0x95)](_0x5cd202);if(_0x173d8e['isFile']()){let _0x317880=path[_0x5624c2(0x76)](_0x5cd202);_0x317880&&config['videoTypeList'][_0x5624c2(0x6e)](_0x317880)&&_0x28ae6c[_0x5624c2(0x83)]({'sourcePath':_0x5cd202,'isFile':_0x173d8e[_0x5624c2(0x8f)](),'targetPath':_0x40ec5b,'savePath':path[_0x5624c2(0x99)](_0x40ec5b,_0x1ba635,path[_0x5624c2(0x9b)](_0x5cd202)),'sourceStat':_0x173d8e});}_0x173d8e[_0x5624c2(0x93)]()&&_0x2d617f(_0x1bde6a,_0x5cd202);}}for(let _0xd03780=0x0;_0xd03780<_0x993ac1[_0x2b616c(0x96)];_0xd03780++){let _0x2efc7a=_0x993ac1[_0xd03780],_0x2d2f96=fs[_0x2b616c(0x95)](_0x2efc7a);if(_0x2d2f96[_0x2b616c(0x8f)]()){let _0x2d9439=path[_0x2b616c(0x76)](_0x2efc7a);_0x2d9439&&config['videoTypeList']['includes'](_0x2d9439)&&_0x28ae6c[_0x2b616c(0x83)]({'sourcePath':_0x2efc7a,'isFile':_0x2d2f96[_0x2b616c(0x8f)](),'targetPath':_0x40ec5b,'savePath':path[_0x2b616c(0x99)](_0x40ec5b,path['basename'](_0x2efc7a)),'sourceStat':_0x2d2f96});}_0x2d2f96['isDirectory']()&&_0x2d617f(_0x2efc7a,_0x2efc7a);}if(!fs[_0x2b616c(0x7b)](_0x40ec5b)){console[_0x2b616c(0x85)]('err1',i18n['__'](_0x2b616c(0x8b))),updateTask(dbMediaTools['TASK_STATE_FAIL'],i18n['__'](_0x2b616c(0x8b)));return;}let _0x396345=fileStatUtil[_0x2b616c(0x6f)](_0x40ec5b);if(!_0x396345){console['log'](_0x2b616c(0x8a),i18n['__'](_0x2b616c(0x97))),updateTask(dbMediaTools['TASK_STATE_FAIL'],i18n['__'](_0x2b616c(0x97)));return;}updateTask(dbMediaTools[_0x2b616c(0x91)],''),copyFileCount=0x0,copySize=0x0,excludeCount=0x0,totalSize=0x0;try{for(let _0x22d8f0=0x0;_0x22d8f0<_0x28ae6c[_0x2b616c(0x96)];_0x22d8f0++){let _0x3e2b91=_0x28ae6c[_0x22d8f0];await transVideo(_0x3e2b91),copyFileCount++,copySize+=_0x3e2b91[_0x2b616c(0x8d)][_0x2b616c(0x6c)];}updateTask(dbMediaTools[_0x2b616c(0x70)],JSON['stringify']({'copy_size':copySize,'copy_count':copyFileCount,'fail_count':failCount}));}catch(_0x4501a3){console[_0x2b616c(0x85)](_0x4501a3),updateTask(dbMediaTools[_0x2b616c(0x8c)],i18n['__'](_0x2b616c(0x78)));}}function exitProcess(){const _0x514538=_0x160abd;console[_0x514538(0x85)](_0x514538(0x98)),process[_0x514538(0x89)]({'type':_0x514538(0x79)}),process[_0x514538(0x7f)]();}function updateTask(_0x45501e,_0x1725c4){const _0xa2bce9=_0x160abd;dbMediaTools[_0xa2bce9(0x7e)](dbOther,currentTaskObj['id'],_0x45501e,_0x1725c4);}function currentTaskObjIsExist(){const _0x532b3e=_0x160abd;if(currentTaskObj){let _0x2f0aa6=dbMediaTools[_0x532b3e(0x6b)](dbOther,currentTaskObj['id'],currentTaskObj[_0x532b3e(0x72)]);if(_0x2f0aa6)return!![];}return taskExist=![],console[_0x532b3e(0x85)]('任务已不存在'),![];}process['on']('message',async _0x1ffd3a=>{const _0x3e9f73=_0x160abd;_0x1ffd3a[_0x3e9f73(0x84)]?(currentTaskObj=_0x1ffd3a[_0x3e9f73(0x84)],currentTaskObj[_0x3e9f73(0x73)]=JSON['parse'](currentTaskObj[_0x3e9f73(0x80)]),await runCurrentTask(),exitProcess()):(console[_0x3e9f73(0x85)](_0x3e9f73(0x9a)),exitProcess());}),process['on']('uncaughtException',_0x1007ae=>{const _0x1cbf60=_0x160abd;console[_0x1cbf60(0x85)](_0x1cbf60(0x77),_0x1007ae),exitProcess();});