const _0x429e4a=_0x53ef;(function(_0x2bbba6,_0xca83fd){const _0x24bc3e=_0x53ef,_0x40585e=_0x2bbba6();while(!![]){try{const _0x240b3c=-parseInt(_0x24bc3e(0x9f))/0x1+parseInt(_0x24bc3e(0xbf))/0x2*(-parseInt(_0x24bc3e(0x96))/0x3)+parseInt(_0x24bc3e(0xbb))/0x4+parseInt(_0x24bc3e(0xab))/0x5+parseInt(_0x24bc3e(0xa1))/0x6*(-parseInt(_0x24bc3e(0xc5))/0x7)+parseInt(_0x24bc3e(0x98))/0x8+-parseInt(_0x24bc3e(0xa6))/0x9;if(_0x240b3c===_0xca83fd)break;else _0x40585e['push'](_0x40585e['shift']());}catch(_0x11ce1c){_0x40585e['push'](_0x40585e['shift']());}}}(_0x35e7,0x44baf));const Database=require(_0x429e4a(0x95)),config=require(_0x429e4a(0xb0));let dbOther=new Database(config[_0x429e4a(0xad)],{});function _0x53ef(_0x217e87,_0x32583e){const _0x35e7e7=_0x35e7();return _0x53ef=function(_0x53ef1b,_0x442e27){_0x53ef1b=_0x53ef1b-0x91;let _0x46185f=_0x35e7e7[_0x53ef1b];return _0x46185f;},_0x53ef(_0x217e87,_0x32583e);}dbOther[_0x429e4a(0xa0)](_0x429e4a(0xa9));let path=require(_0x429e4a(0xba)),fs=require('fs'),i18nUtil=require('../utils/i18nUtil'),fileStatUtil=require(_0x429e4a(0xbd));const dbMediaTools=require(_0x429e4a(0x94)),mediaUtils=require(_0x429e4a(0xb1));let i18n=i18nUtil[_0x429e4a(0x9d)](dbOther);process[_0x429e4a(0xa4)]=_0x429e4a(0x9a);function _0x35e7(){const _0x45e9e2=['../db/dbMediaTools','better-sqlite3','3UTfXCr','basename','2592384LTZwNR','getByIdAndCreateTime','NasCabMediaArrangeWorker','updateTask','existsSync','getI18n','size','166536lGfVyy','pragma','6Yolfhg','exit','checkFolderPower','title','close','628182fEXIvy','task_json','relative','journal_mode\x20=\x20WAL','stringify','1730655ujoYbX','fileCopyFail','dbOther','create_time','readdirSync','../myConfig/config','../utils/mediaUtils','includes','videoTypeList','TASK_STATE_FAIL','noWritePermission','isDirectory','err2','length','taskData','path','1406976MVXPnB','push','../utils/fileStatUtil','extname','924998qNemWl','taskObj','isFile','targetFolderNotExist','TASK_STATE_SUC','视频转换\x20线程异常','290997nvddkQ','statSync','parse','log'];_0x35e7=function(){return _0x45e9e2;};return _0x35e7();}let currentTaskObj=null,copyFileCount=0x0,copySize=0x0,totalSize=0x0,failCount=0x0;async function transVideo(_0x54bfcb){}async function runCurrentTask(){const _0x19527e=_0x429e4a;let _0x58b770=currentTaskObj[_0x19527e(0xb9)]['source_path'],_0x2bce84=currentTaskObj[_0x19527e(0xb9)]['target_path'],_0x17398e=[];async function _0x2d9f4a(_0x56c7f4,_0x5bc75e){const _0x3f7e8a=_0x19527e;let _0x42ab3f=fs[_0x3f7e8a(0xaf)](_0x5bc75e),_0xea58ce=path[_0x3f7e8a(0xa8)](_0x56c7f4,_0x5bc75e);for(let _0x5add55=0x0;_0x5add55<_0x42ab3f[_0x3f7e8a(0xb8)];_0x5add55++){let _0x4f3e1b=_0x42ab3f[_0x5add55],_0x24eb59=path['join'](_0x5bc75e,_0x4f3e1b),_0xb1ba94=fs['statSync'](_0x24eb59);if(_0xb1ba94[_0x3f7e8a(0xc1)]()){let _0x456ae4=path[_0x3f7e8a(0xbe)](_0x24eb59);_0x456ae4&&config[_0x3f7e8a(0xb3)]['includes'](_0x456ae4)&&_0x17398e[_0x3f7e8a(0xbc)]({'sourcePath':_0x24eb59,'isFile':_0xb1ba94['isFile'](),'targetPath':_0x2bce84,'savePath':path['join'](_0x2bce84,_0xea58ce,path[_0x3f7e8a(0x97)](_0x24eb59)),'sourceStat':_0xb1ba94});}_0xb1ba94[_0x3f7e8a(0xb6)]()&&_0x2d9f4a(_0x56c7f4,_0x24eb59);}}for(let _0x42d009=0x0;_0x42d009<_0x58b770[_0x19527e(0xb8)];_0x42d009++){let _0x3a89f4=_0x58b770[_0x42d009],_0x5b14c8=fs[_0x19527e(0x91)](_0x3a89f4);if(_0x5b14c8[_0x19527e(0xc1)]()){let _0x2b5339=path[_0x19527e(0xbe)](_0x3a89f4);_0x2b5339&&config['videoTypeList'][_0x19527e(0xb2)](_0x2b5339)&&_0x17398e[_0x19527e(0xbc)]({'sourcePath':_0x3a89f4,'isFile':_0x5b14c8['isFile'](),'targetPath':_0x2bce84,'savePath':path['join'](_0x2bce84,path[_0x19527e(0x97)](_0x3a89f4)),'sourceStat':_0x5b14c8});}_0x5b14c8[_0x19527e(0xb6)]()&&_0x2d9f4a(_0x3a89f4,_0x3a89f4);}if(!fs[_0x19527e(0x9c)](_0x2bce84)){console['log']('err1',i18n['__'](_0x19527e(0xc2))),updateTask(dbMediaTools[_0x19527e(0xb4)],i18n['__'](_0x19527e(0xc2)));return;}let _0x800d80=fileStatUtil[_0x19527e(0xa3)](_0x2bce84);if(!_0x800d80){console[_0x19527e(0x93)](_0x19527e(0xb7),i18n['__'](_0x19527e(0xb5))),updateTask(dbMediaTools[_0x19527e(0xb4)],i18n['__'](_0x19527e(0xb5)));return;}updateTask(dbMediaTools['TASK_STATE_RUNNING'],''),copyFileCount=0x0,copySize=0x0,excludeCount=0x0,totalSize=0x0;try{for(let _0x36c467=0x0;_0x36c467<_0x17398e[_0x19527e(0xb8)];_0x36c467++){let _0x313b75=_0x17398e[_0x36c467];await transVideo(_0x313b75),copyFileCount++,copySize+=_0x313b75['sourceStat'][_0x19527e(0x9e)];}updateTask(dbMediaTools[_0x19527e(0xc3)],JSON[_0x19527e(0xaa)]({'copy_size':copySize,'copy_count':copyFileCount,'fail_count':failCount}));}catch(_0x5f1a26){console[_0x19527e(0x93)](_0x5f1a26),updateTask(dbMediaTools[_0x19527e(0xb4)],i18n['__'](_0x19527e(0xac)));}}function exitProcess(){const _0x324eaf=_0x429e4a;console[_0x324eaf(0x93)]('结束媒体整理线程'),process['send']({'type':_0x324eaf(0xa5)}),process[_0x324eaf(0xa2)]();}function updateTask(_0x55c868,_0x4a6568){const _0x30b947=_0x429e4a;dbMediaTools[_0x30b947(0x9b)](dbOther,currentTaskObj['id'],_0x55c868,_0x4a6568);}function currentTaskObjIsExist(){const _0x281098=_0x429e4a;if(currentTaskObj){let _0x3bee62=dbMediaTools[_0x281098(0x99)](dbOther,currentTaskObj['id'],currentTaskObj[_0x281098(0xae)]);if(_0x3bee62)return!![];}return taskExist=![],console['log']('任务已不存在'),![];}process['on']('message',async _0x2e8927=>{const _0x40dead=_0x429e4a;_0x2e8927[_0x40dead(0xc0)]?(currentTaskObj=_0x2e8927['taskObj'],currentTaskObj['taskData']=JSON[_0x40dead(0x92)](currentTaskObj[_0x40dead(0xa7)]),await runCurrentTask(),exitProcess()):(console['log']('未传递任务数据'),exitProcess());}),process['on']('uncaughtException',_0x1efd23=>{const _0x2c86a4=_0x429e4a;console['log'](_0x2c86a4(0xc4),_0x1efd23),exitProcess();});