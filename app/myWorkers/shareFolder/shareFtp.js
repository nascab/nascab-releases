const _0x5bec8e=_0x1bf3;(function(_0x1bdb82,_0x510310){const _0x582830=_0x1bf3,_0x37eea6=_0x1bdb82();while(!![]){try{const _0x33bdf9=-parseInt(_0x582830(0xe9))/0x1+parseInt(_0x582830(0xe6))/0x2+-parseInt(_0x582830(0xf8))/0x3+parseInt(_0x582830(0xd7))/0x4*(parseInt(_0x582830(0xe1))/0x5)+parseInt(_0x582830(0xf4))/0x6+-parseInt(_0x582830(0xca))/0x7+-parseInt(_0x582830(0xf3))/0x8*(-parseInt(_0x582830(0xfa))/0x9);if(_0x33bdf9===_0x510310)break;else _0x37eea6['push'](_0x37eea6['shift']());}catch(_0x24dbf9){_0x37eea6['push'](_0x37eea6['shift']());}}}(_0x57f9,0x65b19));const config=require(_0x5bec8e(0xed)),Database=require(_0x5bec8e(0xdc));let dbOther=new Database(config['dbOther'],{});dbOther[_0x5bec8e(0xd0)](_0x5bec8e(0xf6));const dbConfigTable=require('../../db/dbConfigTable'),dbFileShare=require(_0x5bec8e(0xd5)),dbUserTable=require('../../db/dbUserTable'),FtpSrv=require(_0x5bec8e(0xe0));process['title']=_0x5bec8e(0xf2);function _0x1bf3(_0x4fda00,_0x4f35d6){const _0x57f957=_0x57f9();return _0x1bf3=function(_0x1bf301,_0x356193){_0x1bf301=_0x1bf301-0xca;let _0x3db759=_0x57f957[_0x1bf301];return _0x3db759;},_0x1bf3(_0x4fda00,_0x4f35d6);}let cryptoUtils=require('../../express-server/utils/cryptoUtils'),myFtpServer=null;const dbNoticeCenterTable=require(_0x5bec8e(0xd2));let netUtils=require(_0x5bec8e(0xfb));function saveMsg(_0x155183,_0x49489c,_0x4cc370){dbNoticeCenterTable['create'](dbOther,{'title':_0x155183,'level':_0x49489c,'content':_0x4cc370});}function ftpListenNew(_0x5e45b0){const _0x2e3f0=_0x5bec8e;myFtpServer=new FtpSrv({'url':'ftp://0.0.0.0:'+_0x5e45b0});let _0x1abee8=dbFileShare[_0x2e3f0(0xd1)](dbOther,_0x2e3f0(0xd3),[]);_0x1abee8&&_0x1abee8[_0x2e3f0(0xcf)]>0x0?(myFtpServer['on']('login',({connection:_0x3e6c12,username:_0x899b53,password:_0x1b545c},_0x5cccb4,_0x528fa0)=>{const _0x518588=_0x2e3f0;cryptoUtils[_0x518588(0xef)](config[_0x518588(0xfd)],_0x1b545c)[_0x518588(0xcb)](_0xcad0b9=>{const _0x4dfb96=_0x518588;let _0x2c168a=dbUserTable[_0x4dfb96(0xf5)](dbOther,_0x899b53,_0xcad0b9);if(!_0x2c168a)return _0x528fa0(new errors['GeneralError'](_0x4dfb96(0xd9),0x191));let _0x442bdd=dbFileShare[_0x4dfb96(0xcc)](dbOther,_0x2c168a['id'],_0x4dfb96(0xfc));return _0x442bdd?_0x5cccb4({'root':_0x442bdd['path']}):_0x528fa0(0x191);})[_0x518588(0xeb)](_0x48414e=>{const _0x45bf7c=_0x518588;return console['log'](_0x45bf7c(0xda),_0x48414e),_0x528fa0(0x191);});}),myFtpServer[_0x2e3f0(0xcd)]()[_0x2e3f0(0xcb)](()=>{const _0x153a85=_0x2e3f0;console['log'](_0x153a85(0xd4)+_0x5e45b0),dbConfigTable[_0x153a85(0xf0)](dbOther,{'title':'FTPServer','value':JSON[_0x153a85(0xdd)]({'state':_0x153a85(0xe5),'port':_0x5e45b0})});})[_0x2e3f0(0xeb)](_0x444d64=>{const _0x4b7df1=_0x2e3f0;console[_0x4b7df1(0xe7)](_0x4b7df1(0xda),_0x444d64),_0x444d64[_0x4b7df1(0xee)]==_0x4b7df1(0xdf)?initFtpShare(_0x5e45b0+0x1):(dbConfigTable[_0x4b7df1(0xf0)](dbOther,{'title':_0x4b7df1(0xe2),'value':JSON[_0x4b7df1(0xdd)]({'state':_0x4b7df1(0xd6),'port':_0x5e45b0})}),saveMsg(_0x4b7df1(0xf7),'error',_0x444d64[_0x4b7df1(0xee)]));})):dbConfigTable['create'](dbOther,{'title':'FTPServer','value':JSON['stringify']({'state':_0x2e3f0(0xd6),'port':_0x5e45b0})});}function _0x57f9(){const _0x51bc1a=['2970373PqaDPb','then','userHasFtp','listen','fileShareRestart','length','pragma','getAllByWhere','../../db/dbNoticeCenterTable','\x20server_type=\x27FTP\x27','FTP\x20start\x20running\x20on\x20:','../../db/dbFileShare','stop','8BRNnig','closed','Invalid\x20username\x20or\x20password','error','value','better-sqlite3','stringify','Restart\x20FTP','EADDRINUSE','ftp-srv','528665nawYqo','FTPServer','isPortFree','findByTitle','run','351904vzHGLf','log','message','764697FiaoQq','close','catch','shareType','../../myConfig/config','code','encryptString','create','FTPPort','NasCabFtpWorker','2120kwGvpq','3438678QAzuNS','login','journal_mode\x20=\x20WAL','FTP\x20Start\x20failed','2252139SiwshP','type','47403UAiMGJ','../../express-server/utils/netUtils','FTP','passwordKey'];_0x57f9=function(){return _0x51bc1a;};return _0x57f9();}async function initFtpShare(_0x5d31d1){const _0x23baa6=_0x5bec8e;myFtpServer?(myFtpServer['close'](),myFtpServer['on'](_0x23baa6(0xd8),({})=>{ftpListenNew(_0x5d31d1);})):ftpListenNew(_0x5d31d1);}let getFreePort=function(_0x2622ee,_0x1d4155){const _0x43d549=_0x5bec8e;netUtils[_0x43d549(0xe3)](_0x2622ee)['then'](_0x2146d0=>{_0x2146d0?_0x1d4155(_0x2622ee):(_0x2622ee+=0x1,getFreePort(_0x2622ee,_0x1d4155));});};function getFtpSetPort(_0x5c13e0){const _0x47aedd=_0x5bec8e;let _0xe827a4=config['FTPPort'],_0xcdd782=_0x47aedd(0xf1),_0x53705e=dbConfigTable[_0x47aedd(0xe4)](dbOther,_0xcdd782);if(_0x53705e){let _0x32e767=parseInt(_0x53705e[_0x47aedd(0xdb)]);if(_0x32e767<=0x0||_0x32e767>0xffff){}else _0xe827a4=_0x32e767;}getFreePort(_0xe827a4,_0x5c13e0);}process['on'](_0x5bec8e(0xe8),_0x48cbe6=>{const _0x399966=_0x5bec8e;if(_0x48cbe6[_0x399966(0xf9)]==_0x399966(0xce)&&_0x48cbe6[_0x399966(0xec)]==_0x399966(0xfc))console[_0x399966(0xe7)](_0x399966(0xde)),getFtpSetPort(_0xca2561=>{initFtpShare(_0xca2561);});else _0x48cbe6[_0x399966(0xf9)]==_0x399966(0xea)&&(myFtpServer&&myFtpServer[_0x399966(0xea)]());}),getFtpSetPort(_0x497d82=>{initFtpShare(_0x497d82);});