const _0x339251=_0xebb1;(function(_0x32e766,_0x4ce128){const _0x2d5bdc=_0xebb1,_0x4610f3=_0x32e766();while(!![]){try{const _0x3f3221=parseInt(_0x2d5bdc(0x1d2))/0x1+parseInt(_0x2d5bdc(0x1d9))/0x2*(-parseInt(_0x2d5bdc(0x1b9))/0x3)+parseInt(_0x2d5bdc(0x1d4))/0x4+-parseInt(_0x2d5bdc(0x1d6))/0x5+-parseInt(_0x2d5bdc(0x1ca))/0x6+-parseInt(_0x2d5bdc(0x1bb))/0x7+parseInt(_0x2d5bdc(0x1ce))/0x8;if(_0x3f3221===_0x4ce128)break;else _0x4610f3['push'](_0x4610f3['shift']());}catch(_0x3b1b3f){_0x4610f3['push'](_0x4610f3['shift']());}}}(_0x3fc6,0xc2d82));const config=require(_0x339251(0x1ac)),Database=require('better-sqlite3');function _0xebb1(_0xb42d57,_0x5946aa){const _0x3fc61a=_0x3fc6();return _0xebb1=function(_0xebb13c,_0x22c3bf){_0xebb13c=_0xebb13c-0x1ab;let _0x5c46ce=_0x3fc61a[_0xebb13c];return _0x5c46ce;},_0xebb1(_0xb42d57,_0x5946aa);}let dbOther=new Database(config[_0x339251(0x1b2)],{});dbOther['pragma']('journal_mode\x20=\x20WAL');const dbConfigTable=require(_0x339251(0x1cb)),dbFileShare=require(_0x339251(0x1db)),dbUserTable=require(_0x339251(0x1af)),FtpSrv=require(_0x339251(0x1c8));process[_0x339251(0x1c2)]=_0x339251(0x1d7);let cryptoUtils=require(_0x339251(0x1c7)),myFtpServer=null;const dbNoticeCenterTable=require('../../db/dbNoticeCenterTable');let netUtils=require(_0x339251(0x1da));function saveMsg(_0x4bc88b,_0x5d51a3,_0x4c8e41){const _0x2ecfa9=_0x339251;dbNoticeCenterTable[_0x2ecfa9(0x1bc)](dbOther,{'title':_0x4bc88b,'level':_0x5d51a3,'content':_0x4c8e41});}function ftpListenNew(_0x1c399d){const _0x23b2b6=_0x339251;myFtpServer=new FtpSrv({'url':'ftp://0.0.0.0:'+_0x1c399d});let _0x4a3c8d=dbFileShare['getAllByWhere'](dbOther,_0x23b2b6(0x1b1),[]);_0x4a3c8d&&_0x4a3c8d[_0x23b2b6(0x1b6)]>0x0?(myFtpServer['on'](_0x23b2b6(0x1d8),({connection:_0x59069d,username:_0x5b1835,password:_0x214f6b},_0x247bf8,_0x2a91c2)=>{const _0x2c3eb4=_0x23b2b6;cryptoUtils[_0x2c3eb4(0x1d3)](config[_0x2c3eb4(0x1ae)],_0x214f6b)[_0x2c3eb4(0x1c5)](_0x4c320c=>{const _0xc69fd7=_0x2c3eb4;let _0x7e7f98=dbUserTable[_0xc69fd7(0x1d8)](dbOther,_0x5b1835,_0x4c320c);if(!_0x7e7f98)return _0x2a91c2(new errors[(_0xc69fd7(0x1ad))](_0xc69fd7(0x1ba),0x191));let _0x5e769a=dbFileShare[_0xc69fd7(0x1b8)](dbOther,_0x7e7f98['id'],_0xc69fd7(0x1b0));return _0x5e769a?_0x247bf8({'root':_0x5e769a[_0xc69fd7(0x1b5)]}):_0x2a91c2(0x191);})[_0x2c3eb4(0x1b4)](_0x4d4f69=>{const _0x132107=_0x2c3eb4;return console[_0x132107(0x1d1)](_0x132107(0x1c4),_0x4d4f69),_0x2a91c2(0x191);});}),myFtpServer[_0x23b2b6(0x1cd)]()[_0x23b2b6(0x1c5)](()=>{const _0x208456=_0x23b2b6;console['log'](_0x208456(0x1cf)+_0x1c399d),dbConfigTable['create'](dbOther,{'title':_0x208456(0x1c6),'value':JSON['stringify']({'state':_0x208456(0x1cc),'port':_0x1c399d})});})[_0x23b2b6(0x1b4)](_0x3a2ae3=>{const _0x1f817c=_0x23b2b6;console[_0x1f817c(0x1d1)](_0x1f817c(0x1c4),_0x3a2ae3),_0x3a2ae3['code']==_0x1f817c(0x1b3)?initFtpShare(_0x1c399d+0x1):(dbConfigTable['create'](dbOther,{'title':_0x1f817c(0x1c6),'value':JSON['stringify']({'state':_0x1f817c(0x1c3),'port':_0x1c399d})}),saveMsg('FTP\x20Start\x20failed',_0x1f817c(0x1c4),_0x3a2ae3[_0x1f817c(0x1c9)]));})):dbConfigTable[_0x23b2b6(0x1bc)](dbOther,{'title':_0x23b2b6(0x1c6),'value':JSON['stringify']({'state':_0x23b2b6(0x1c3),'port':_0x1c399d})});}async function initFtpShare(_0x3a2786){const _0x46b2a0=_0x339251;myFtpServer?(myFtpServer[_0x46b2a0(0x1c0)](),myFtpServer['on'](_0x46b2a0(0x1c1),({})=>{ftpListenNew(_0x3a2786);})):ftpListenNew(_0x3a2786);}function _0x3fc6(){const _0x12b445=['EADDRINUSE','catch','path','length','isPortFree','userHasFtp','21kldQsL','Invalid\x20username\x20or\x20password','4709957MSLlsE','create','message','Restart\x20FTP','fileShareRestart','close','closed','title','stop','error','then','FTPServer','../../express-server/utils/cryptoUtils','ftp-srv','code','4482960Dxiqlm','../../db/dbConfigTable','run','listen','18101208ZBRJPT','FTP\x20start\x20running\x20on\x20:','type','log','1359411lAoHzP','encryptString','4009048StoQEl','value','5460185sCdGFc','NasCabFtpWorker','login','375484xqFOsZ','../../express-server/utils/netUtils','../../db/dbFileShare','findByTitle','shareType','../../myConfig/config','GeneralError','passwordKey','../../db/dbUserTable','FTP','\x20server_type=\x27FTP\x27','dbOther'];_0x3fc6=function(){return _0x12b445;};return _0x3fc6();}let getFreePort=function(_0xb93e62,_0x424b70){const _0x80e135=_0x339251;netUtils[_0x80e135(0x1b7)](_0xb93e62)[_0x80e135(0x1c5)](_0x7ff7ac=>{_0x7ff7ac?_0x424b70(_0xb93e62):(_0xb93e62+=0x1,getFreePort(_0xb93e62,_0x424b70));});};function getFtpSetPort(_0x3ca409){const _0x444372=_0x339251;let _0x470a35=config['FTPPort'],_0x4b11eb='FTPPort',_0x28b874=dbConfigTable[_0x444372(0x1dc)](dbOther,_0x4b11eb);if(_0x28b874){let _0x3762a6=parseInt(_0x28b874[_0x444372(0x1d5)]);if(_0x3762a6<=0x0||_0x3762a6>0xffff){}else _0x470a35=_0x3762a6;}getFreePort(_0x470a35,_0x3ca409);}process['on'](_0x339251(0x1bd),_0x213875=>{const _0x34689d=_0x339251;if(_0x213875[_0x34689d(0x1d0)]==_0x34689d(0x1bf)&&_0x213875[_0x34689d(0x1ab)]==_0x34689d(0x1b0))console['log'](_0x34689d(0x1be)),getFtpSetPort(_0x21b714=>{initFtpShare(_0x21b714);});else _0x213875[_0x34689d(0x1d0)]==_0x34689d(0x1c0)&&(myFtpServer&&myFtpServer['close']());}),getFtpSetPort(_0x3b0e2f=>{initFtpShare(_0x3b0e2f);});