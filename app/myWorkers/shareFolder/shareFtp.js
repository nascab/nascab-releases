const _0x395c27=_0x5b06;(function(_0x3333f0,_0x67b064){const _0x1fd0bd=_0x5b06,_0x1bae68=_0x3333f0();while(!![]){try{const _0x5b5d87=parseInt(_0x1fd0bd(0x179))/0x1*(parseInt(_0x1fd0bd(0x166))/0x2)+-parseInt(_0x1fd0bd(0x160))/0x3+parseInt(_0x1fd0bd(0x161))/0x4*(-parseInt(_0x1fd0bd(0x15e))/0x5)+-parseInt(_0x1fd0bd(0x162))/0x6*(parseInt(_0x1fd0bd(0x187))/0x7)+-parseInt(_0x1fd0bd(0x173))/0x8+parseInt(_0x1fd0bd(0x165))/0x9+-parseInt(_0x1fd0bd(0x17a))/0xa*(-parseInt(_0x1fd0bd(0x182))/0xb);if(_0x5b5d87===_0x67b064)break;else _0x1bae68['push'](_0x1bae68['shift']());}catch(_0x412d3d){_0x1bae68['push'](_0x1bae68['shift']());}}}(_0x1a0c,0x3938c));const config=require(_0x395c27(0x176)),Database=require(_0x395c27(0x16c));let dbOther=new Database(config['dbOther'],{});dbOther[_0x395c27(0x178)](_0x395c27(0x175));const dbConfigTable=require(_0x395c27(0x188)),dbFileShare=require(_0x395c27(0x18b)),dbUserTable=require(_0x395c27(0x18c)),FtpSrv=require(_0x395c27(0x158));process[_0x395c27(0x181)]=_0x395c27(0x17b);let cryptoUtils=require(_0x395c27(0x16b)),myFtpServer=null;const dbNoticeCenterTable=require(_0x395c27(0x168));function _0x5b06(_0xf429ad,_0x8d35ff){const _0x1a0c38=_0x1a0c();return _0x5b06=function(_0x5b0629,_0x31eaaf){_0x5b0629=_0x5b0629-0x155;let _0x2a904c=_0x1a0c38[_0x5b0629];return _0x2a904c;},_0x5b06(_0xf429ad,_0x8d35ff);}let netUtils=require(_0x395c27(0x15d));function saveMsg(_0x4f4ef1,_0x3ce997,_0x539d12){dbNoticeCenterTable['create'](dbOther,{'title':_0x4f4ef1,'level':_0x3ce997,'content':_0x539d12});}function ftpListenNew(_0x953b87){const _0x5772a8=_0x395c27;myFtpServer=new FtpSrv({'url':_0x5772a8(0x171)+_0x953b87});let _0x3ee829=dbFileShare[_0x5772a8(0x155)](dbOther,_0x5772a8(0x167),[]);_0x3ee829&&_0x3ee829[_0x5772a8(0x174)]>0x0?(myFtpServer['on'](_0x5772a8(0x17d),({connection:_0x436c4d,username:_0x3dbff8,password:_0x143ee4},_0x5322e5,_0x548919)=>{const _0x2dfcb6=_0x5772a8;cryptoUtils[_0x2dfcb6(0x164)](config['passwordKey'],_0x143ee4)['then'](_0x43db4a=>{const _0xf65980=_0x2dfcb6;let _0x4c4c3b=dbUserTable['login'](dbOther,_0x3dbff8,_0x43db4a);if(!_0x4c4c3b)return _0x548919(new errors[(_0xf65980(0x156))]('Invalid\x20username\x20or\x20password',0x191));let _0x3b8bbd=dbFileShare['userHasFtp'](dbOther,_0x4c4c3b['id'],_0xf65980(0x16a));return _0x3b8bbd?_0x5322e5({'root':_0x3b8bbd[_0xf65980(0x16e)]}):_0x548919(0x191);})['catch'](_0x16561b=>{const _0x1e6aad=_0x2dfcb6;return console[_0x1e6aad(0x17f)](_0x1e6aad(0x170),_0x16561b),_0x548919(0x191);});}),myFtpServer[_0x5772a8(0x17e)]()[_0x5772a8(0x186)](()=>{const _0xb45052=_0x5772a8;console[_0xb45052(0x17f)](_0xb45052(0x183)+_0x953b87),dbConfigTable[_0xb45052(0x184)](dbOther,{'title':'FTPServer','value':JSON[_0xb45052(0x177)]({'state':_0xb45052(0x16d),'port':_0x953b87})});})[_0x5772a8(0x169)](_0x118fac=>{const _0x593bfe=_0x5772a8;console[_0x593bfe(0x17f)](_0x593bfe(0x170),_0x118fac),_0x118fac[_0x593bfe(0x157)]==_0x593bfe(0x185)?initFtpShare(_0x953b87+0x1):(dbConfigTable[_0x593bfe(0x184)](dbOther,{'title':_0x593bfe(0x159),'value':JSON[_0x593bfe(0x177)]({'state':_0x593bfe(0x172),'port':_0x953b87})}),saveMsg(_0x593bfe(0x15b),_0x593bfe(0x170),_0x118fac[_0x593bfe(0x157)]));})):dbConfigTable[_0x5772a8(0x184)](dbOther,{'title':_0x5772a8(0x159),'value':JSON[_0x5772a8(0x177)]({'state':_0x5772a8(0x172),'port':_0x953b87})});}async function initFtpShare(_0x152f94){const _0x5d3868=_0x395c27;myFtpServer?(myFtpServer[_0x5d3868(0x15a)](),myFtpServer['on'](_0x5d3868(0x163),({})=>{ftpListenNew(_0x152f94);})):ftpListenNew(_0x152f94);}let getFreePort=function(_0x5ba8ff,_0x1e7c77){const _0x57d415=_0x395c27;netUtils[_0x57d415(0x16f)](_0x5ba8ff)[_0x57d415(0x186)](_0x38621e=>{_0x38621e?_0x1e7c77(_0x5ba8ff):(_0x5ba8ff+=0x1,getFreePort(_0x5ba8ff,_0x1e7c77));});};function _0x1a0c(){const _0x551a31=['228AHZrrn','closed','encryptString','3552156GTJmsa','424bcjgfU','\x20server_type=\x27FTP\x27','../../db/dbNoticeCenterTable','catch','FTP','../../express-server/utils/cryptoUtils','better-sqlite3','run','path','isPortFree','error','ftp://0.0.0.0:','stop','300712RHzDPY','length','journal_mode\x20=\x20WAL','../../myConfig/config','stringify','pragma','599kNgHgK','4910BPbkpw','NasCabFtpWorker','findByTitle','login','listen','log','Restart\x20FTP','title','2695PbyGuV','FTP\x20start\x20running\x20on\x20:','create','EADDRINUSE','then','448FWUVgk','../../db/dbConfigTable','message','fileShareRestart','../../db/dbFileShare','../../db/dbUserTable','shareType','getAllByWhere','GeneralError','code','ftp-srv','FTPServer','close','FTP\x20Start\x20failed','value','../../express-server/utils/netUtils','759140AJwYpy','FTPPort','647214kQmmDs','4HInmFO'];_0x1a0c=function(){return _0x551a31;};return _0x1a0c();}function getFtpSetPort(_0x535054){const _0x4104cb=_0x395c27;let _0x21c83c=config[_0x4104cb(0x15f)],_0x18dfdb=_0x4104cb(0x15f),_0x2810e1=dbConfigTable[_0x4104cb(0x17c)](dbOther,_0x18dfdb);if(_0x2810e1){let _0x9538f1=parseInt(_0x2810e1[_0x4104cb(0x15c)]);if(_0x9538f1<=0x0||_0x9538f1>0xffff){}else _0x21c83c=_0x9538f1;}getFreePort(_0x21c83c,_0x535054);}process['on'](_0x395c27(0x189),_0x5c33f5=>{const _0x178521=_0x395c27;if(_0x5c33f5['type']==_0x178521(0x18a)&&_0x5c33f5[_0x178521(0x18d)]==_0x178521(0x16a))console[_0x178521(0x17f)](_0x178521(0x180)),getFtpSetPort(_0xbdb7f9=>{initFtpShare(_0xbdb7f9);});else _0x5c33f5['type']==_0x178521(0x15a)&&(myFtpServer&&myFtpServer[_0x178521(0x15a)]());}),getFtpSetPort(_0xb8989=>{initFtpShare(_0xb8989);});