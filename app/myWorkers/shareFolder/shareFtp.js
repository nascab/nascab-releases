const _0x400955=_0x41d8;(function(_0x4667fe,_0x5dba33){const _0x1a0e7e=_0x41d8,_0x174201=_0x4667fe();while(!![]){try{const _0x5c8dd8=-parseInt(_0x1a0e7e(0x1f4))/0x1*(parseInt(_0x1a0e7e(0x1f6))/0x2)+-parseInt(_0x1a0e7e(0x1f1))/0x3*(-parseInt(_0x1a0e7e(0x1fc))/0x4)+parseInt(_0x1a0e7e(0x220))/0x5*(parseInt(_0x1a0e7e(0x214))/0x6)+-parseInt(_0x1a0e7e(0x20a))/0x7+parseInt(_0x1a0e7e(0x206))/0x8*(parseInt(_0x1a0e7e(0x20d))/0x9)+-parseInt(_0x1a0e7e(0x1fb))/0xa*(parseInt(_0x1a0e7e(0x217))/0xb)+-parseInt(_0x1a0e7e(0x20f))/0xc;if(_0x5c8dd8===_0x5dba33)break;else _0x174201['push'](_0x174201['shift']());}catch(_0x2dc415){_0x174201['push'](_0x174201['shift']());}}}(_0x3174,0xe582b));const config=require(_0x400955(0x1f8)),Database=require('better-sqlite3');let dbOther=new Database(config['dbOther'],{});function _0x41d8(_0x373594,_0x301d2b){const _0x317412=_0x3174();return _0x41d8=function(_0x41d85f,_0x2ff7d8){_0x41d85f=_0x41d85f-0x1f0;let _0x389f3b=_0x317412[_0x41d85f];return _0x389f3b;},_0x41d8(_0x373594,_0x301d2b);}dbOther[_0x400955(0x225)](_0x400955(0x1f3));const dbConfigTable=require(_0x400955(0x21e)),dbFileShare=require('../../db/dbFileShare'),dbUserTable=require('../../db/dbUserTable'),FtpSrv=require(_0x400955(0x215));process[_0x400955(0x21c)]=_0x400955(0x204);let cryptoUtils=require(_0x400955(0x1f2)),myFtpServer=null;const dbNoticeCenterTable=require(_0x400955(0x218));let netUtils=require('../../express-server/utils/netUtils');function saveMsg(_0x4056c7,_0x12f8ae,_0x54fa29){dbNoticeCenterTable['create'](dbOther,{'title':_0x4056c7,'level':_0x12f8ae,'content':_0x54fa29});}function ftpListenNew(_0x51e207){const _0x26a2c4=_0x400955;myFtpServer=new FtpSrv({'url':'ftp://0.0.0.0:'+_0x51e207});let _0x53f642=dbFileShare['getAllByWhere'](dbOther,_0x26a2c4(0x21a),[]);_0x53f642&&_0x53f642[_0x26a2c4(0x1ff)]>0x0?(myFtpServer['on'](_0x26a2c4(0x1f0),({connection:_0x158a20,username:_0x4321f4,password:_0x4e3952},_0x37bea0,_0xe2e156)=>{const _0x3eefb8=_0x26a2c4;cryptoUtils[_0x3eefb8(0x20c)](config[_0x3eefb8(0x211)],_0x4e3952)[_0x3eefb8(0x20b)](_0x42f54b=>{const _0x245fd6=_0x3eefb8;let _0x27678d=dbUserTable[_0x245fd6(0x1f0)](dbOther,_0x4321f4,_0x42f54b);if(!_0x27678d)return _0xe2e156(new errors[(_0x245fd6(0x1fd))](_0x245fd6(0x21f),0x191));let _0x57c8a8=dbFileShare[_0x245fd6(0x21b)](dbOther,_0x27678d['id'],_0x245fd6(0x207));return _0x57c8a8?_0x37bea0({'root':_0x57c8a8[_0x245fd6(0x213)]}):_0xe2e156(0x191);})[_0x3eefb8(0x210)](_0x3bb927=>{const _0x173f64=_0x3eefb8;return console[_0x173f64(0x1f9)]('error',_0x3bb927),_0xe2e156(0x191);});}),myFtpServer[_0x26a2c4(0x212)]()[_0x26a2c4(0x20b)](()=>{const _0x15dac1=_0x26a2c4;console[_0x15dac1(0x1f9)](_0x15dac1(0x200)+_0x51e207),dbConfigTable[_0x15dac1(0x201)](dbOther,{'title':_0x15dac1(0x1fa),'value':JSON[_0x15dac1(0x222)]({'state':_0x15dac1(0x223),'port':_0x51e207})});})[_0x26a2c4(0x210)](_0x3ee7ca=>{const _0x4e4e19=_0x26a2c4;console['log'](_0x4e4e19(0x221),_0x3ee7ca),_0x3ee7ca[_0x4e4e19(0x21d)]==_0x4e4e19(0x209)?initFtpShare(_0x51e207+0x1):(dbConfigTable[_0x4e4e19(0x201)](dbOther,{'title':_0x4e4e19(0x1fa),'value':JSON[_0x4e4e19(0x222)]({'state':_0x4e4e19(0x1f7),'port':_0x51e207})}),saveMsg(_0x4e4e19(0x224),_0x4e4e19(0x221),_0x3ee7ca[_0x4e4e19(0x21d)]));})):dbConfigTable[_0x26a2c4(0x201)](dbOther,{'title':_0x26a2c4(0x1fa),'value':JSON['stringify']({'state':'stop','port':_0x51e207})});}async function initFtpShare(_0x304a8f){const _0x4a7b34=_0x400955;myFtpServer?(myFtpServer[_0x4a7b34(0x216)](),myFtpServer['on'](_0x4a7b34(0x208),({})=>{ftpListenNew(_0x304a8f);})):ftpListenNew(_0x304a8f);}let getFreePort=function(_0x17d1e6,_0x10f5a2){const _0x3e315d=_0x400955;netUtils[_0x3e315d(0x20e)](_0x17d1e6)[_0x3e315d(0x20b)](_0x1db9b5=>{_0x1db9b5?_0x10f5a2(_0x17d1e6):(_0x17d1e6+=0x1,getFreePort(_0x17d1e6,_0x10f5a2));});};function getFtpSetPort(_0x5a721d){const _0x44bcf7=_0x400955;let _0x14c993=config['FTPPort'],_0x1eb1a1=_0x44bcf7(0x203),_0x405279=dbConfigTable[_0x44bcf7(0x1fe)](dbOther,_0x1eb1a1);if(_0x405279){let _0x348160=parseInt(_0x405279[_0x44bcf7(0x205)]);if(_0x348160<=0x0||_0x348160>0xffff){}else _0x14c993=_0x348160;}getFreePort(_0x14c993,_0x5a721d);}function _0x3174(){const _0x3cb7ca=['userHasFtp','title','code','../../db/dbConfigTable','Invalid\x20username\x20or\x20password','530KQjMdi','error','stringify','run','FTP\x20Start\x20failed','pragma','login','114euZnBS','../../express-server/utils/cryptoUtils','journal_mode\x20=\x20WAL','69521xZiGKn','Restart\x20FTP','10MlkAOS','stop','../../myConfig/config','log','FTPServer','9170InfIJH','81128jeDMJV','GeneralError','findByTitle','length','FTP\x20start\x20running\x20on\x20:','create','type','FTPPort','NasCabFtpWorker','value','824voCxbL','FTP','closed','EADDRINUSE','3706857NzsynZ','then','encryptString','159876PljqVy','isPortFree','5676984lUXkxA','catch','passwordKey','listen','path','3054ZnUAlf','ftp-srv','close','4367uXhrrs','../../db/dbNoticeCenterTable','fileShareRestart','\x20server_type=\x27FTP\x27'];_0x3174=function(){return _0x3cb7ca;};return _0x3174();}process['on']('message',_0x2346a2=>{const _0x36855f=_0x400955;if(_0x2346a2[_0x36855f(0x202)]==_0x36855f(0x219)&&_0x2346a2['shareType']==_0x36855f(0x207))console[_0x36855f(0x1f9)](_0x36855f(0x1f5)),getFtpSetPort(_0x52624e=>{initFtpShare(_0x52624e);});else _0x2346a2[_0x36855f(0x202)]==_0x36855f(0x216)&&(myFtpServer&&myFtpServer[_0x36855f(0x216)]());}),getFtpSetPort(_0x5b7967=>{initFtpShare(_0x5b7967);});