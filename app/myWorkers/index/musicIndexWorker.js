const _0x299048=_0x54f7;(function(_0x1955ef,_0x4026bf){const _0x6f96e8=_0x54f7,_0x3a75e1=_0x1955ef();while(!![]){try{const _0x2afafd=-parseInt(_0x6f96e8(0xd2))/0x1+-parseInt(_0x6f96e8(0xc9))/0x2+parseInt(_0x6f96e8(0xe1))/0x3+-parseInt(_0x6f96e8(0xd0))/0x4+-parseInt(_0x6f96e8(0xd1))/0x5+-parseInt(_0x6f96e8(0xc0))/0x6+parseInt(_0x6f96e8(0xcb))/0x7;if(_0x2afafd===_0x4026bf)break;else _0x3a75e1['push'](_0x3a75e1['shift']());}catch(_0x111d53){_0x3a75e1['push'](_0x3a75e1['shift']());}}}(_0x47a6,0x931a6));let fs=require('fs');function _0x54f7(_0x16ec1f,_0x55446f){const _0x47a637=_0x47a6();return _0x54f7=function(_0x54f7df,_0x286284){_0x54f7df=_0x54f7df-0xbf;let _0x4d03cc=_0x47a637[_0x54f7df];return _0x4d03cc;},_0x54f7(_0x16ec1f,_0x55446f);}const config=require(_0x299048(0xc4)),Database=require(_0x299048(0xcc));let dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config[_0x299048(0xdc)],{});function _0x47a6(){const _0x172a39=['scan_path','820884sUCQhD','pragma','../../utils/musicUtil','recursionDeleteIndex','2771826evOFYZ','../../db/dbFileIndexTable','recursionFilesAddIndex','prepare','../../myConfig/config','log','isDirectory','journal_mode\x20=\x20WAL','../../db/dbScanTaskTable','432206bRZkBN','要扫描的目录不是文件夹','19427520vpYqje','better-sqlite3','文件夹数量','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27','耗时:','1103748viKSXP','4751880pYDqju','542067RtFHOk','getOnTask','run','SCAN_TYPE_MUSIC','exit','NasCabMusicIndexWorker','文件数量','then','./indexUtil','statSync','dbFileIndex','title','音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]','扫描目录已不存在\x20'];_0x47a6=function(){return _0x172a39;};return _0x47a6();}dbFileIndex[_0x299048(0xe2)]('journal_mode\x20=\x20WAL'),dbOther[_0x299048(0xe2)](_0x299048(0xc7));let musicUtils=require(_0x299048(0xe3));const dbFileIndexTable=require(_0x299048(0xc1));process[_0x299048(0xdd)]=_0x299048(0xd7);const musicIndexUtil=require('./musicIndexUtil'),indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_MUSIC'],dbScanTaskTable=require(_0x299048(0xc8)),indexUtil=require(_0x299048(0xda));async function startIndexingFolder(_0x338316){return new Promise(async(_0x217d45,_0x591e91)=>{const _0x5004f9=_0x54f7;try{let _0x29622e=new Date()['getTime'](),_0xda018e=fs[_0x5004f9(0xdb)](_0x338316);if(!_0xda018e[_0x5004f9(0xc6)]())return console[_0x5004f9(0xc5)](_0x5004f9(0xca),_0x338316),_0x217d45();console['log']('音乐管理:\x20开始扫描',_0x338316),await indexUtil[_0x5004f9(0xbf)](dbFileIndex,indexTableName,_0x338316);let {checkFileCount:_0x5981db,checkPathCount:_0x32a7e4}=await musicIndexUtil[_0x5004f9(0xc2)](dbOther,dbFileIndex,_0x338316);console[_0x5004f9(0xc5)]('音乐管理：扫描完成：'+_0x338316,_0x5004f9(0xcf),new Date()['getTime']()-_0x29622e,'ms',_0x5004f9(0xcd),_0x32a7e4,_0x5004f9(0xd8),_0x5981db),_0x217d45();}catch(_0x1290fc){console[_0x5004f9(0xc5)](_0x5004f9(0xdf),_0x338316),_0x217d45();}});}async function runScanTask(){const _0xfd8d61=_0x299048;let _0x49d9bf=dbScanTaskTable[_0xfd8d61(0xd3)](dbOther,dbScanTaskTable[_0xfd8d61(0xd5)]);_0x49d9bf?(dbOther[_0xfd8d61(0xc3)](_0xfd8d61(0xce))[_0xfd8d61(0xd4)](Date['now'](),_0x49d9bf[_0xfd8d61(0xe0)]),startIndexingFolder(_0x49d9bf[_0xfd8d61(0xe0)])[_0xfd8d61(0xd9)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x49d9bf['id']),musicUtils['dealFirstLetterAll'](dbFileIndex),runScanTask();})):(console[_0xfd8d61(0xc5)](_0xfd8d61(0xde)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process[_0xfd8d61(0xd6)]());}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();