const _0x269d6c=_0x426f;(function(_0x1a17b5,_0x15cf2e){const _0x2b3bf7=_0x426f,_0x5761fd=_0x1a17b5();while(!![]){try{const _0xa91bb6=-parseInt(_0x2b3bf7(0x1a0))/0x1*(parseInt(_0x2b3bf7(0x19d))/0x2)+parseInt(_0x2b3bf7(0x198))/0x3*(-parseInt(_0x2b3bf7(0x1aa))/0x4)+-parseInt(_0x2b3bf7(0x199))/0x5*(parseInt(_0x2b3bf7(0x18c))/0x6)+parseInt(_0x2b3bf7(0x18e))/0x7+-parseInt(_0x2b3bf7(0x189))/0x8+parseInt(_0x2b3bf7(0x195))/0x9+parseInt(_0x2b3bf7(0x197))/0xa;if(_0xa91bb6===_0x15cf2e)break;else _0x5761fd['push'](_0x5761fd['shift']());}catch(_0x18c8d4){_0x5761fd['push'](_0x5761fd['shift']());}}}(_0x43c9,0x21e0d));let fs=require('fs');function _0x426f(_0x29abfc,_0x25cc7c){const _0x43c9a3=_0x43c9();return _0x426f=function(_0x426fd5,_0x5ddff7){_0x426fd5=_0x426fd5-0x183;let _0x4a8d6b=_0x43c9a3[_0x426fd5];return _0x4a8d6b;},_0x426f(_0x29abfc,_0x25cc7c);}const config=require(_0x269d6c(0x188)),Database=require('better-sqlite3');let dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config['dbFileIndex'],{});dbFileIndex[_0x269d6c(0x19e)](_0x269d6c(0x193)),dbOther[_0x269d6c(0x19e)](_0x269d6c(0x193));let musicUtils=require(_0x269d6c(0x185));const dbFileIndexTable=require(_0x269d6c(0x19a));function _0x43c9(){const _0x4a1f43=['4AaOpqu','statSync','扫描目录已不存在\x20','./musicIndexUtil','../../utils/musicUtil','dealFirstLetterAll','音乐管理:\x20开始扫描','../../myConfig/config','2026664rRScFb','./indexUtil','then','6oIsjCS','SCAN_TYPE_MUSIC','629153kQicjI','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27','title','exit','../../db/dbScanTaskTable','journal_mode\x20=\x20WAL','deleteTask','2196621PMzccD','scan_path','4996180jImfoM','748449FPpFAY','59385cxNuNH','../../db/dbFileIndexTable','run','要扫描的目录不是文件夹','40024yClEKM','pragma','getTime','9WfEGVJ','log','setIndexingState','音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]','NasCabMusicIndexWorker','recursionDeleteIndex','recursionFilesAddIndex','now','音乐管理：扫描完成：','INDEX_TABLE_NAME_MUSIC'];_0x43c9=function(){return _0x4a1f43;};return _0x43c9();}process[_0x269d6c(0x190)]=_0x269d6c(0x1a4);const musicIndexUtil=require(_0x269d6c(0x184)),indexTableName=dbFileIndexTable[_0x269d6c(0x1a9)],dbScanTaskTable=require(_0x269d6c(0x192)),indexUtil=require(_0x269d6c(0x18a));async function startIndexingFolder(_0x4b5f0f){return new Promise(async(_0x558ca9,_0x135559)=>{const _0x3203b8=_0x426f;try{let _0x3e505a=new Date()[_0x3203b8(0x19f)](),_0x4dac88=fs[_0x3203b8(0x1ab)](_0x4b5f0f);if(!_0x4dac88['isDirectory']())return console[_0x3203b8(0x1a1)](_0x3203b8(0x19c),_0x4b5f0f),_0x558ca9();console['log'](_0x3203b8(0x187),_0x4b5f0f),await indexUtil[_0x3203b8(0x1a5)](dbFileIndex,indexTableName,_0x4b5f0f);let {checkFileCount:_0x212ad6,checkPathCount:_0x467635}=await musicIndexUtil[_0x3203b8(0x1a6)](dbOther,dbFileIndex,_0x4b5f0f);console['log'](_0x3203b8(0x1a8)+_0x4b5f0f,'耗时:',new Date()[_0x3203b8(0x19f)]()-_0x3e505a,'ms','文件夹数量',_0x467635,'文件数量',_0x212ad6),_0x558ca9();}catch(_0x5e8b5d){console[_0x3203b8(0x1a1)](_0x3203b8(0x183),_0x4b5f0f),_0x558ca9();}});}async function runScanTask(){const _0x2d8acf=_0x269d6c;let _0x4d34d9=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable[_0x2d8acf(0x18d)]);_0x4d34d9?(dbOther['prepare'](_0x2d8acf(0x18f))[_0x2d8acf(0x19b)](Date[_0x2d8acf(0x1a7)](),_0x4d34d9[_0x2d8acf(0x196)]),startIndexingFolder(_0x4d34d9['scan_path'])[_0x2d8acf(0x18b)](()=>{const _0x6a0539=_0x2d8acf;dbScanTaskTable[_0x6a0539(0x194)](dbOther,_0x4d34d9['id']),musicUtils[_0x6a0539(0x186)](dbFileIndex),runScanTask();})):(console[_0x2d8acf(0x1a1)](_0x2d8acf(0x1a3)),indexUtil[_0x2d8acf(0x1a2)](dbOther,indexTableName,![]),process[_0x2d8acf(0x191)]());}indexUtil[_0x269d6c(0x1a2)](dbOther,indexTableName,!![]),runScanTask();