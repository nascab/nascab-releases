const _0x497dbf=_0x238f;(function(_0x665da,_0x52eda7){const _0x58d058=_0x238f,_0x48048c=_0x665da();while(!![]){try{const _0x5885fc=-parseInt(_0x58d058(0x14c))/0x1+-parseInt(_0x58d058(0x155))/0x2+parseInt(_0x58d058(0x15a))/0x3+-parseInt(_0x58d058(0x153))/0x4*(-parseInt(_0x58d058(0x146))/0x5)+parseInt(_0x58d058(0x149))/0x6+parseInt(_0x58d058(0x152))/0x7*(parseInt(_0x58d058(0x148))/0x8)+-parseInt(_0x58d058(0x15d))/0x9;if(_0x5885fc===_0x52eda7)break;else _0x48048c['push'](_0x48048c['shift']());}catch(_0x2c816b){_0x48048c['push'](_0x48048c['shift']());}}}(_0x3476,0x3513b));let fs=require('fs');const config=require(_0x497dbf(0x15c)),Database=require(_0x497dbf(0x156));let dbOther=new Database(config[_0x497dbf(0x162)],{}),dbFileIndex=new Database(config['dbFileIndex'],{});dbFileIndex[_0x497dbf(0x158)](_0x497dbf(0x14e)),dbOther[_0x497dbf(0x158)](_0x497dbf(0x14e));let musicUtils=require('../../utils/musicUtil');const dbFileIndexTable=require('../../db/dbFileIndexTable');process[_0x497dbf(0x151)]='NasCabMusicIndexWorker';function _0x3476(){const _0x17682c=['getTime','音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]','179252aOkJuq','deleteTask','journal_mode\x20=\x20WAL','SCAN_TYPE_MUSIC','recursionDeleteIndex','title','7YaHpaQ','1347716UQJNsD','getOnTask','189660aQAuQL','better-sqlite3','prepare','pragma','耗时:','713916xTWOna','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27','../../myConfig/config','3824766lysnSO','recursionFilesAddIndex','文件数量','./musicIndexUtil','isDirectory','dbOther','statSync','then','scan_path','文件夹数量','INDEX_TABLE_NAME_MUSIC','dealFirstLetterAll','exit','run','log','setIndexingState','5SFDiMV','音乐管理：扫描完成：','1325624EoxDij','1055130voBBxD'];_0x3476=function(){return _0x17682c;};return _0x3476();}function _0x238f(_0x3bce59,_0x17a5d7){const _0x3476ce=_0x3476();return _0x238f=function(_0x238f53,_0x2a3710){_0x238f53=_0x238f53-0x13e;let _0x5ae7ba=_0x3476ce[_0x238f53];return _0x5ae7ba;},_0x238f(_0x3bce59,_0x17a5d7);}const musicIndexUtil=require(_0x497dbf(0x160)),indexTableName=dbFileIndexTable[_0x497dbf(0x140)],dbScanTaskTable=require('../../db/dbScanTaskTable'),indexUtil=require('./indexUtil');async function startIndexingFolder(_0x1dee47){return new Promise(async(_0x52f4d3,_0x59526d)=>{const _0x22b7af=_0x238f;try{let _0x2c556b=new Date()[_0x22b7af(0x14a)](),_0x121f2d=fs[_0x22b7af(0x163)](_0x1dee47);if(!_0x121f2d[_0x22b7af(0x161)]())return console[_0x22b7af(0x144)]('要扫描的目录不是文件夹',_0x1dee47),_0x52f4d3();console['log']('音乐管理:\x20开始扫描',_0x1dee47),await indexUtil[_0x22b7af(0x150)](dbFileIndex,indexTableName,_0x1dee47);let {checkFileCount:_0xb0c5ba,checkPathCount:_0x11b0c2}=await musicIndexUtil[_0x22b7af(0x15e)](dbOther,dbFileIndex,_0x1dee47);console['log'](_0x22b7af(0x147)+_0x1dee47,_0x22b7af(0x159),new Date()[_0x22b7af(0x14a)]()-_0x2c556b,'ms',_0x22b7af(0x13f),_0x11b0c2,_0x22b7af(0x15f),_0xb0c5ba),_0x52f4d3();}catch(_0x3fa014){console[_0x22b7af(0x144)]('扫描目录已不存在\x20',_0x1dee47),_0x52f4d3();}});}async function runScanTask(){const _0x10c6b6=_0x497dbf;let _0x1c9501=dbScanTaskTable[_0x10c6b6(0x154)](dbOther,dbScanTaskTable[_0x10c6b6(0x14f)]);_0x1c9501?(dbOther[_0x10c6b6(0x157)](_0x10c6b6(0x15b))[_0x10c6b6(0x143)](Date['now'](),_0x1c9501[_0x10c6b6(0x13e)]),startIndexingFolder(_0x1c9501[_0x10c6b6(0x13e)])[_0x10c6b6(0x164)](()=>{const _0x11c59a=_0x10c6b6;dbScanTaskTable[_0x11c59a(0x14d)](dbOther,_0x1c9501['id']),musicUtils[_0x11c59a(0x141)](dbFileIndex),runScanTask();})):(console['log'](_0x10c6b6(0x14b)),indexUtil[_0x10c6b6(0x145)](dbOther,indexTableName,![]),process[_0x10c6b6(0x142)]());}indexUtil[_0x497dbf(0x145)](dbOther,indexTableName,!![]),runScanTask();