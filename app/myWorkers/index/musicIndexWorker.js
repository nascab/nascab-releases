const _0x59ccc8=_0x1c3a;(function(_0x119f8d,_0x5354df){const _0x226c65=_0x1c3a,_0x43ba36=_0x119f8d();while(!![]){try{const _0x3f71eb=parseInt(_0x226c65(0x133))/0x1*(parseInt(_0x226c65(0x149))/0x2)+parseInt(_0x226c65(0x137))/0x3+-parseInt(_0x226c65(0x148))/0x4+-parseInt(_0x226c65(0x146))/0x5*(parseInt(_0x226c65(0x143))/0x6)+-parseInt(_0x226c65(0x157))/0x7*(parseInt(_0x226c65(0x13a))/0x8)+parseInt(_0x226c65(0x14c))/0x9*(-parseInt(_0x226c65(0x13b))/0xa)+parseInt(_0x226c65(0x136))/0xb;if(_0x3f71eb===_0x5354df)break;else _0x43ba36['push'](_0x43ba36['shift']());}catch(_0x139ec8){_0x43ba36['push'](_0x43ba36['shift']());}}}(_0x2df2,0x6b3e1));let fs=require('fs');const config=require(_0x59ccc8(0x147)),Database=require('better-sqlite3');let dbOther=new Database(config[_0x59ccc8(0x155)],{}),dbFileIndex=new Database(config[_0x59ccc8(0x150)],{});dbFileIndex[_0x59ccc8(0x140)](_0x59ccc8(0x159)),dbOther[_0x59ccc8(0x140)](_0x59ccc8(0x159));let musicUtils=require(_0x59ccc8(0x141));function _0x2df2(){const _0x26df08=['run','./musicIndexUtil','耗时:','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27','dbOther','recursionFilesAddIndex','98aRHfQV','音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]','journal_mode\x20=\x20WAL','log','title','dealFirstLetterAll','6935yifkOy','statSync','音乐管理：扫描完成：','26327818UXwBSY','604368YvNcLp','setIndexingState','getOnTask','473912dUvODO','2705110pgHGfu','音乐管理:\x20开始扫描','then','../../db/dbFileIndexTable','exit','pragma','../../utils/musicUtil','isDirectory','12hwtotT','SCAN_TYPE_MUSIC','../../db/dbScanTaskTable','1764190GrIyni','../../myConfig/config','2260324qfpFUa','62HQeDQK','deleteTask','now','9trUrlF','scan_path','./indexUtil','recursionDeleteIndex','dbFileIndex'];_0x2df2=function(){return _0x26df08;};return _0x2df2();}const dbFileIndexTable=require(_0x59ccc8(0x13e));process[_0x59ccc8(0x15b)]='NasCabMusicIndexWorker';function _0x1c3a(_0x38aab5,_0x2bdbb2){const _0x2df20e=_0x2df2();return _0x1c3a=function(_0x1c3a46,_0x44bcc4){_0x1c3a46=_0x1c3a46-0x133;let _0x388932=_0x2df20e[_0x1c3a46];return _0x388932;},_0x1c3a(_0x38aab5,_0x2bdbb2);}const musicIndexUtil=require(_0x59ccc8(0x152)),indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_MUSIC'],dbScanTaskTable=require(_0x59ccc8(0x145)),indexUtil=require(_0x59ccc8(0x14e));async function startIndexingFolder(_0x45923f){return new Promise(async(_0x19d5cd,_0x4f2b6a)=>{const _0x2dc36e=_0x1c3a;try{let _0x69c4d8=new Date()['getTime'](),_0x3d20c3=fs[_0x2dc36e(0x134)](_0x45923f);if(!_0x3d20c3[_0x2dc36e(0x142)]())return console[_0x2dc36e(0x15a)]('要扫描的目录不是文件夹',_0x45923f),_0x19d5cd();console[_0x2dc36e(0x15a)](_0x2dc36e(0x13c),_0x45923f),await indexUtil[_0x2dc36e(0x14f)](dbFileIndex,indexTableName,_0x45923f);let {checkFileCount:_0x1659ac,checkPathCount:_0x344dd8}=await musicIndexUtil[_0x2dc36e(0x156)](dbOther,dbFileIndex,_0x45923f);console['log'](_0x2dc36e(0x135)+_0x45923f,_0x2dc36e(0x153),new Date()['getTime']()-_0x69c4d8,'ms','文件夹数量',_0x344dd8,'文件数量',_0x1659ac),_0x19d5cd();}catch(_0x5bff16){console[_0x2dc36e(0x15a)]('扫描目录已不存在\x20',_0x45923f),_0x19d5cd();}});}async function runScanTask(){const _0x3131ef=_0x59ccc8;let _0x55da6a=dbScanTaskTable[_0x3131ef(0x139)](dbOther,dbScanTaskTable[_0x3131ef(0x144)]);_0x55da6a?(dbOther['prepare'](_0x3131ef(0x154))[_0x3131ef(0x151)](Date[_0x3131ef(0x14b)](),_0x55da6a['scan_path']),startIndexingFolder(_0x55da6a[_0x3131ef(0x14d)])[_0x3131ef(0x13d)](()=>{const _0x9a25e3=_0x3131ef;dbScanTaskTable[_0x9a25e3(0x14a)](dbOther,_0x55da6a['id']),musicUtils[_0x9a25e3(0x15c)](dbFileIndex),runScanTask();})):(console[_0x3131ef(0x15a)](_0x3131ef(0x158)),indexUtil[_0x3131ef(0x138)](dbOther,indexTableName,![]),process[_0x3131ef(0x13f)]());}indexUtil[_0x59ccc8(0x138)](dbOther,indexTableName,!![]),runScanTask();