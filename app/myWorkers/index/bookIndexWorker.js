const _0x4d79ef=_0x5f1b;(function(_0x173ac4,_0x5421fd){const _0xd409a6=_0x5f1b,_0x2ac681=_0x173ac4();while(!![]){try{const _0x1fb52a=parseInt(_0xd409a6(0x169))/0x1*(parseInt(_0xd409a6(0x14b))/0x2)+parseInt(_0xd409a6(0x16a))/0x3+-parseInt(_0xd409a6(0x143))/0x4+-parseInt(_0xd409a6(0x148))/0x5+parseInt(_0xd409a6(0x160))/0x6*(parseInt(_0xd409a6(0x172))/0x7)+parseInt(_0xd409a6(0x15c))/0x8*(-parseInt(_0xd409a6(0x150))/0x9)+-parseInt(_0xd409a6(0x16b))/0xa;if(_0x1fb52a===_0x5421fd)break;else _0x2ac681['push'](_0x2ac681['shift']());}catch(_0x449f65){_0x2ac681['push'](_0x2ac681['shift']());}}}(_0x5372,0xcdd1a));const fs=require('fs'),path=require(_0x4d79ef(0x146)),config=require(_0x4d79ef(0x147)),Database=require('better-sqlite3'),dbOther=new Database(config[_0x4d79ef(0x171)],{}),dbFileIndex=new Database(config[_0x4d79ef(0x163)],{});dbFileIndex[_0x4d79ef(0x155)](_0x4d79ef(0x165)),dbOther[_0x4d79ef(0x155)](_0x4d79ef(0x165));const dbFileIndexTable=require(_0x4d79ef(0x14f));process[_0x4d79ef(0x153)]=_0x4d79ef(0x152);const bookIndexUtil=require(_0x4d79ef(0x14e)),indexTableName=dbFileIndexTable[_0x4d79ef(0x15a)],dbScanTaskTable=require(_0x4d79ef(0x166)),indexUtil=require(_0x4d79ef(0x154));function _0x5f1b(_0x10db0f,_0x20cf34){const _0x53722f=_0x5372();return _0x5f1b=function(_0x5f1b4e,_0xda7217){_0x5f1b4e=_0x5f1b4e-0x143;let _0x14b59b=_0x53722f[_0x5f1b4e];return _0x14b59b;},_0x5f1b(_0x10db0f,_0x20cf34);}function _0x5372(){const _0x470402=['./indexUtil','pragma','run','then','图书管理:未找到扫描任务[Books\x20scanning\x20task\x20not\x20found]','isDirectory','INDEX_TABLE_NAME_BOOK','SCAN_TYPE_BOOK','611864wrJubg','uncaughtException','prepare','文件夹数量','251802NshrSV','耗时:','图书管理：扫描完成：','dbFileIndex','getOnTask','journal_mode\x20=\x20WAL','../../db/dbScanTaskTable','setIndexingState','getTime','1vLChFe','1777926PGKgLQ','4910040ggBeHW','now','图书管理:\x20开始扫描','scan_path','statSync','要扫描的目录不是文件夹','dbOther','196QkHZgH','扫描目录已不存在\x20','306096VFCGQe','deleteTask','文件数量','path','../../myConfig/config','1235100fzadfs','Error\x20occurred\x20','recursionFilesAddIndex','697524vKLsoW','log','recursionDeleteIndex','./bookIndexUtil','../../db/dbFileIndexTable','54VizXar','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27book\x27','NasCabBookIndexWorker','title'];_0x5372=function(){return _0x470402;};return _0x5372();}process['on'](_0x4d79ef(0x15d),(_0x49f499,_0x328e5d)=>{const _0x1bad4a=_0x4d79ef;console['log'](_0x1bad4a(0x149),_0x49f499);});async function startIndexingFolder(_0x3f3c1f){return new Promise(async(_0x32aee7,_0x23beb4)=>{const _0x9417b9=_0x5f1b;try{let _0x260f7f=new Date()['getTime'](),_0xb5cc4e=fs[_0x9417b9(0x16f)](_0x3f3c1f);if(!_0xb5cc4e[_0x9417b9(0x159)]())return console['log'](_0x9417b9(0x170),_0x3f3c1f),_0x32aee7();console['log'](_0x9417b9(0x16d),_0x3f3c1f),await indexUtil[_0x9417b9(0x14d)](dbFileIndex,indexTableName,_0x3f3c1f);let {checkFileCount:_0x273ffa,checkPathCount:_0x2116e8}=await bookIndexUtil[_0x9417b9(0x14a)](dbOther,dbFileIndex,_0x3f3c1f);console[_0x9417b9(0x14c)](_0x9417b9(0x162)+_0x3f3c1f,_0x9417b9(0x161),new Date()[_0x9417b9(0x168)]()-_0x260f7f,'ms',_0x9417b9(0x15f),_0x2116e8,_0x9417b9(0x145),_0x273ffa),_0x32aee7();}catch(_0x4abbce){console['log'](_0x9417b9(0x173),_0x3f3c1f),_0x32aee7();}});}async function runScanTask(){const _0x231caf=_0x4d79ef;let _0x2c5903=dbScanTaskTable[_0x231caf(0x164)](dbOther,dbScanTaskTable[_0x231caf(0x15b)]);_0x2c5903?(dbOther[_0x231caf(0x15e)](_0x231caf(0x151))[_0x231caf(0x156)](Date[_0x231caf(0x16c)](),_0x2c5903[_0x231caf(0x16e)]),startIndexingFolder(_0x2c5903['scan_path'])[_0x231caf(0x157)](()=>{const _0x462bfb=_0x231caf;dbScanTaskTable[_0x462bfb(0x144)](dbOther,_0x2c5903['id']),runScanTask();})):(console[_0x231caf(0x14c)](_0x231caf(0x158)),indexUtil[_0x231caf(0x167)](dbOther,indexTableName,![]),process['exit']());}indexUtil[_0x4d79ef(0x167)](dbOther,indexTableName,!![]),runScanTask();