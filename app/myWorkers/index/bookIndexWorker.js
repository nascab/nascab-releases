const _0xb956f0=_0x4ecf;(function(_0x171dcb,_0x44087d){const _0x450d03=_0x4ecf,_0x3e8ab2=_0x171dcb();while(!![]){try{const _0x1282ca=-parseInt(_0x450d03(0xca))/0x1*(parseInt(_0x450d03(0xd1))/0x2)+parseInt(_0x450d03(0xbc))/0x3*(-parseInt(_0x450d03(0xc8))/0x4)+parseInt(_0x450d03(0xd6))/0x5+parseInt(_0x450d03(0xd2))/0x6*(-parseInt(_0x450d03(0xb9))/0x7)+parseInt(_0x450d03(0xd9))/0x8*(parseInt(_0x450d03(0xbd))/0x9)+-parseInt(_0x450d03(0xb4))/0xa+parseInt(_0x450d03(0xd7))/0xb;if(_0x1282ca===_0x44087d)break;else _0x3e8ab2['push'](_0x3e8ab2['shift']());}catch(_0x1cc111){_0x3e8ab2['push'](_0x3e8ab2['shift']());}}}(_0x3b1c,0xb084e));const fs=require('fs'),path=require('path'),config=require('../../myConfig/config'),Database=require('better-sqlite3'),dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config[_0xb956f0(0xcd)],{});dbFileIndex['pragma']('journal_mode\x20=\x20WAL'),dbOther[_0xb956f0(0xc3)]('journal_mode\x20=\x20WAL');const dbFileIndexTable=require(_0xb956f0(0xc0));process[_0xb956f0(0xbf)]=_0xb956f0(0xc9);const bookIndexUtil=require(_0xb956f0(0xbe)),indexTableName=dbFileIndexTable[_0xb956f0(0xc1)],dbScanTaskTable=require(_0xb956f0(0xd0)),indexUtil=require(_0xb956f0(0xc6));function _0x3b1c(){const _0x5c1c4c=['scan_path','pragma','then','文件数量','./indexUtil','要扫描的目录不是文件夹','1358924VYuvyk','NasCabBookIndexWorker','637pkkMQG','exit','扫描目录已不存在\x20','dbFileIndex','deleteTask','文件夹数量','../../db/dbScanTaskTable','4258LRoOXZ','1398cpZZfr','isDirectory','图书管理：扫描完成：','耗时:','6571130zLoWnL','42463487mJohrX','getTime','867392BJYugc','uncaughtException','图书管理:未找到扫描任务[Books\x20scanning\x20task\x20not\x20found]','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27book\x27','statSync','14233720LLmuiY','setIndexingState','now','run','log','32641NNuPLC','getOnTask','prepare','9nZsCPQ','36nmaPOg','./bookIndexUtil','title','../../db/dbFileIndexTable','INDEX_TABLE_NAME_BOOK'];_0x3b1c=function(){return _0x5c1c4c;};return _0x3b1c();}process['on'](_0xb956f0(0xb0),(_0x5d49d9,_0x1baa7c)=>{const _0x327f13=_0xb956f0;console[_0x327f13(0xb8)]('Error\x20occurred\x20',_0x5d49d9);});async function startIndexingFolder(_0x569706){return new Promise(async(_0x54b53f,_0x251746)=>{const _0x354a98=_0x4ecf;try{let _0x5847fd=new Date()[_0x354a98(0xd8)](),_0x1c5064=fs[_0x354a98(0xb3)](_0x569706);if(!_0x1c5064[_0x354a98(0xd3)]())return console[_0x354a98(0xb8)](_0x354a98(0xc7),_0x569706),_0x54b53f();console[_0x354a98(0xb8)]('图书管理:\x20开始扫描',_0x569706),await indexUtil['recursionDeleteIndex'](dbFileIndex,indexTableName,_0x569706);let {checkFileCount:_0xef3e98,checkPathCount:_0x4922f7}=await bookIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x569706);console[_0x354a98(0xb8)](_0x354a98(0xd4)+_0x569706,_0x354a98(0xd5),new Date()[_0x354a98(0xd8)]()-_0x5847fd,'ms',_0x354a98(0xcf),_0x4922f7,_0x354a98(0xc5),_0xef3e98),_0x54b53f();}catch(_0x3484b6){console[_0x354a98(0xb8)](_0x354a98(0xcc),_0x569706),_0x54b53f();}});}async function runScanTask(){const _0x5192d0=_0xb956f0;let _0x5551d1=dbScanTaskTable[_0x5192d0(0xba)](dbOther,dbScanTaskTable['SCAN_TYPE_BOOK']);_0x5551d1?(dbOther[_0x5192d0(0xbb)](_0x5192d0(0xb2))[_0x5192d0(0xb7)](Date[_0x5192d0(0xb6)](),_0x5551d1[_0x5192d0(0xc2)]),startIndexingFolder(_0x5551d1['scan_path'])[_0x5192d0(0xc4)](()=>{const _0x2045fe=_0x5192d0;dbScanTaskTable[_0x2045fe(0xce)](dbOther,_0x5551d1['id']),runScanTask();})):(console[_0x5192d0(0xb8)](_0x5192d0(0xb1)),indexUtil[_0x5192d0(0xb5)](dbOther,indexTableName,![]),process[_0x5192d0(0xcb)]());}function _0x4ecf(_0x10c0dd,_0x36a5b1){const _0x3b1c6f=_0x3b1c();return _0x4ecf=function(_0x4ecf08,_0x1a689e){_0x4ecf08=_0x4ecf08-0xb0;let _0x348491=_0x3b1c6f[_0x4ecf08];return _0x348491;},_0x4ecf(_0x10c0dd,_0x36a5b1);}indexUtil[_0xb956f0(0xb5)](dbOther,indexTableName,!![]),runScanTask();