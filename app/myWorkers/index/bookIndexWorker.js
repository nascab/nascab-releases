const _0x44dd36=_0x34cc;(function(_0x3f6cff,_0x53aaec){const _0x2dd8fd=_0x34cc,_0x1896fb=_0x3f6cff();while(!![]){try{const _0x573154=parseInt(_0x2dd8fd(0x151))/0x1+parseInt(_0x2dd8fd(0x16b))/0x2*(-parseInt(_0x2dd8fd(0x168))/0x3)+-parseInt(_0x2dd8fd(0x145))/0x4+-parseInt(_0x2dd8fd(0x143))/0x5*(-parseInt(_0x2dd8fd(0x155))/0x6)+parseInt(_0x2dd8fd(0x164))/0x7*(parseInt(_0x2dd8fd(0x157))/0x8)+parseInt(_0x2dd8fd(0x158))/0x9*(parseInt(_0x2dd8fd(0x14f))/0xa)+-parseInt(_0x2dd8fd(0x14a))/0xb;if(_0x573154===_0x53aaec)break;else _0x1896fb['push'](_0x1896fb['shift']());}catch(_0x3096a3){_0x1896fb['push'](_0x1896fb['shift']());}}}(_0x3053,0xb09fa));function _0x3053(){const _0xd1438b=['UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27book\x27','../../db/dbScanTaskTable','耗时:','journal_mode\x20=\x20WAL','1570300bEuVHH','statSync','862630gsdxzi','INDEX_TABLE_NAME_BOOK','recursionFilesAddIndex','run','12tNTQxn','recursionDeleteIndex','1904792jXJpbZ','72mJzShb','扫描目录已不存在\x20','deleteTask','./bookIndexUtil','图书管理:未找到扫描任务[Books\x20scanning\x20task\x20not\x20found]','文件夹数量','then','scan_path','要扫描的目录不是文件夹','uncaughtException','log','now','28JHvYZW','../../myConfig/config','dbFileIndex','./indexUtil','21aGrbRC','pragma','Error\x20occurred\x20','137296wccGxl','dbOther','setIndexingState','2797255LsUxtX','better-sqlite3','2412812lvZqwS','NasCabBookIndexWorker','SCAN_TYPE_BOOK','getTime','prepare','26212769cZKkkl'];_0x3053=function(){return _0xd1438b;};return _0x3053();}const fs=require('fs'),path=require('path'),config=require(_0x44dd36(0x165)),Database=require(_0x44dd36(0x144)),dbOther=new Database(config[_0x44dd36(0x141)],{}),dbFileIndex=new Database(config[_0x44dd36(0x166)],{});dbFileIndex[_0x44dd36(0x169)](_0x44dd36(0x14e)),dbOther[_0x44dd36(0x169)](_0x44dd36(0x14e));const dbFileIndexTable=require('../../db/dbFileIndexTable');process['title']=_0x44dd36(0x146);const bookIndexUtil=require(_0x44dd36(0x15b)),indexTableName=dbFileIndexTable[_0x44dd36(0x152)],dbScanTaskTable=require(_0x44dd36(0x14c)),indexUtil=require(_0x44dd36(0x167));process['on'](_0x44dd36(0x161),(_0xecbef2,_0x372d90)=>{const _0x268104=_0x44dd36;console[_0x268104(0x162)](_0x268104(0x16a),_0xecbef2);});async function startIndexingFolder(_0x3293ba){return new Promise(async(_0x429f85,_0xc39409)=>{const _0x4baee6=_0x34cc;try{let _0x6a0c19=new Date()[_0x4baee6(0x148)](),_0x556ffb=fs[_0x4baee6(0x150)](_0x3293ba);if(!_0x556ffb['isDirectory']())return console[_0x4baee6(0x162)](_0x4baee6(0x160),_0x3293ba),_0x429f85();console[_0x4baee6(0x162)]('图书管理:\x20开始扫描',_0x3293ba),await indexUtil[_0x4baee6(0x156)](dbFileIndex,indexTableName,_0x3293ba);let {checkFileCount:_0x241a95,checkPathCount:_0x493a14}=await bookIndexUtil[_0x4baee6(0x153)](dbOther,dbFileIndex,_0x3293ba);console[_0x4baee6(0x162)]('图书管理：扫描完成：'+_0x3293ba,_0x4baee6(0x14d),new Date()[_0x4baee6(0x148)]()-_0x6a0c19,'ms',_0x4baee6(0x15d),_0x493a14,'文件数量',_0x241a95),_0x429f85();}catch(_0x300e2a){console[_0x4baee6(0x162)](_0x4baee6(0x159),_0x3293ba),_0x429f85();}});}async function runScanTask(){const _0x378b81=_0x44dd36;let _0x511f3e=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable[_0x378b81(0x147)]);_0x511f3e?(dbOther[_0x378b81(0x149)](_0x378b81(0x14b))[_0x378b81(0x154)](Date[_0x378b81(0x163)](),_0x511f3e['scan_path']),startIndexingFolder(_0x511f3e[_0x378b81(0x15f)])[_0x378b81(0x15e)](()=>{const _0x2e4260=_0x378b81;dbScanTaskTable[_0x2e4260(0x15a)](dbOther,_0x511f3e['id']),runScanTask();})):(console[_0x378b81(0x162)](_0x378b81(0x15c)),indexUtil[_0x378b81(0x142)](dbOther,indexTableName,![]),process['exit']());}function _0x34cc(_0x3bf1e7,_0x5ca09b){const _0x305304=_0x3053();return _0x34cc=function(_0x34cc32,_0x578be5){_0x34cc32=_0x34cc32-0x141;let _0x613ed3=_0x305304[_0x34cc32];return _0x613ed3;},_0x34cc(_0x3bf1e7,_0x5ca09b);}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();