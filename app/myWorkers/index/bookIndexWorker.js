const _0x4cc41b=_0x2410;function _0x382e(){const _0x1e3cf9=['要扫描的目录不是文件夹','setIndexingState','./indexUtil','title','recursionDeleteIndex','2065gWoUVi','better-sqlite3','2pZPizx','5443224OtOIeF','getOnTask','path','../../myConfig/config','now','./bookIndexUtil','../../db/dbScanTaskTable','SCAN_TYPE_BOOK','扫描目录已不存在\x20','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27book\x27','2056FcsmGu','deleteTask','run','3342060HnquEF','dbFileIndex','Error\x20occurred\x20','prepare','INDEX_TABLE_NAME_BOOK','log','文件数量','图书管理：扫描完成：','图书管理:未找到扫描任务[Books\x20scanning\x20task\x20not\x20found]','35295597anmFMA','pragma','522847uctzkB','statSync','exit','journal_mode\x20=\x20WAL','recursionFilesAddIndex','scan_path','NasCabBookIndexWorker','3979026HsbVmA','耗时:','1755975XMLmLU'];_0x382e=function(){return _0x1e3cf9;};return _0x382e();}(function(_0x2ea787,_0x5e6e82){const _0x55dd89=_0x2410,_0x34f719=_0x2ea787();while(!![]){try{const _0x410e23=parseInt(_0x55dd89(0xe6))/0x1*(parseInt(_0x55dd89(0xf7))/0x2)+-parseInt(_0x55dd89(0xed))/0x3+-parseInt(_0x55dd89(0xf8))/0x4+-parseInt(_0x55dd89(0xef))/0x5+-parseInt(_0x55dd89(0xdb))/0x6+-parseInt(_0x55dd89(0xf5))/0x7*(parseInt(_0x55dd89(0xd8))/0x8)+parseInt(_0x55dd89(0xe4))/0x9;if(_0x410e23===_0x5e6e82)break;else _0x34f719['push'](_0x34f719['shift']());}catch(_0x282ab5){_0x34f719['push'](_0x34f719['shift']());}}}(_0x382e,0xbcd24));const fs=require('fs'),path=require(_0x4cc41b(0xd0)),config=require(_0x4cc41b(0xd1)),Database=require(_0x4cc41b(0xf6)),dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config[_0x4cc41b(0xdc)],{});dbFileIndex[_0x4cc41b(0xe5)](_0x4cc41b(0xe9)),dbOther[_0x4cc41b(0xe5)](_0x4cc41b(0xe9));const dbFileIndexTable=require('../../db/dbFileIndexTable');function _0x2410(_0x1b3103,_0x2f83db){const _0x382e1d=_0x382e();return _0x2410=function(_0x241079,_0x811a){_0x241079=_0x241079-0xd0;let _0x5308d7=_0x382e1d[_0x241079];return _0x5308d7;},_0x2410(_0x1b3103,_0x2f83db);}process[_0x4cc41b(0xf3)]=_0x4cc41b(0xec);const bookIndexUtil=require(_0x4cc41b(0xd3)),indexTableName=dbFileIndexTable[_0x4cc41b(0xdf)],dbScanTaskTable=require(_0x4cc41b(0xd4)),indexUtil=require(_0x4cc41b(0xf2));process['on']('uncaughtException',(_0x5ec869,_0xdc6a9d)=>{const _0x5d5ae0=_0x4cc41b;console[_0x5d5ae0(0xe0)](_0x5d5ae0(0xdd),_0x5ec869);});async function startIndexingFolder(_0x42fcba){return new Promise(async(_0x2c2bd9,_0x456d3e)=>{const _0x1fdfc9=_0x2410;try{let _0x466431=new Date()['getTime'](),_0x53c25d=fs[_0x1fdfc9(0xe7)](_0x42fcba);if(!_0x53c25d['isDirectory']())return console[_0x1fdfc9(0xe0)](_0x1fdfc9(0xf0),_0x42fcba),_0x2c2bd9();console[_0x1fdfc9(0xe0)]('图书管理:\x20开始扫描',_0x42fcba),await indexUtil[_0x1fdfc9(0xf4)](dbFileIndex,indexTableName,_0x42fcba);let {checkFileCount:_0x1061d9,checkPathCount:_0x24e6d6}=await bookIndexUtil[_0x1fdfc9(0xea)](dbOther,dbFileIndex,_0x42fcba);console[_0x1fdfc9(0xe0)](_0x1fdfc9(0xe2)+_0x42fcba,_0x1fdfc9(0xee),new Date()['getTime']()-_0x466431,'ms','文件夹数量',_0x24e6d6,_0x1fdfc9(0xe1),_0x1061d9),_0x2c2bd9();}catch(_0x287b18){console[_0x1fdfc9(0xe0)](_0x1fdfc9(0xd6),_0x42fcba),_0x2c2bd9();}});}async function runScanTask(){const _0x228ea8=_0x4cc41b;let _0x2a353b=dbScanTaskTable[_0x228ea8(0xf9)](dbOther,dbScanTaskTable[_0x228ea8(0xd5)]);_0x2a353b?(dbOther[_0x228ea8(0xde)](_0x228ea8(0xd7))[_0x228ea8(0xda)](Date[_0x228ea8(0xd2)](),_0x2a353b[_0x228ea8(0xeb)]),startIndexingFolder(_0x2a353b[_0x228ea8(0xeb)])['then'](()=>{const _0x40b52a=_0x228ea8;dbScanTaskTable[_0x40b52a(0xd9)](dbOther,_0x2a353b['id']),runScanTask();})):(console['log'](_0x228ea8(0xe3)),indexUtil[_0x228ea8(0xf1)](dbOther,indexTableName,![]),process[_0x228ea8(0xe8)]());}indexUtil[_0x4cc41b(0xf1)](dbOther,indexTableName,!![]),runScanTask();