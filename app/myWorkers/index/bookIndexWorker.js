function _0xfc17(){const _0x2ff6d4=['pragma','journal_mode\x20=\x20WAL','3239796JxlhnR','文件夹数量','36LUUQVC','prepare','2289240cHtlUN','NasCabBookIndexWorker','scan_path','dbFileIndex','recursionFilesAddIndex','then','要扫描的目录不是文件夹','3339mIIGKk','12604gyJlLT','图书管理:未找到扫描任务[Books\x20scanning\x20task\x20not\x20found]','recursionDeleteIndex','log','2344RNMxGo','../../db/dbFileIndexTable','uncaughtException','path','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27book\x27','getOnTask','getTime','图书管理：扫描完成：','isDirectory','939680GGLiYg','Error\x20occurred\x20','INDEX_TABLE_NAME_BOOK','耗时:','13492548BYyhEn','setIndexingState','../../myConfig/config','exit','图书管理:\x20开始扫描','../../db/dbScanTaskTable','deleteTask','306681xGWkGS','dbOther','now','文件数量'];_0xfc17=function(){return _0x2ff6d4;};return _0xfc17();}const _0x21cdd0=_0x154c;(function(_0x3f22f8,_0x3dfb38){const _0x3e0b21=_0x154c,_0x266b12=_0x3f22f8();while(!![]){try{const _0xc4f03c=parseInt(_0x3e0b21(0x155))/0x1*(-parseInt(_0x3e0b21(0x14b))/0x2)+parseInt(_0x3e0b21(0x143))/0x3+-parseInt(_0x3e0b21(0x162))/0x4+-parseInt(_0x3e0b21(0x14d))/0x5+-parseInt(_0x3e0b21(0x149))/0x6+parseInt(_0x3e0b21(0x154))/0x7*(parseInt(_0x3e0b21(0x159))/0x8)+parseInt(_0x3e0b21(0x166))/0x9;if(_0xc4f03c===_0x3dfb38)break;else _0x266b12['push'](_0x266b12['shift']());}catch(_0x50e0d5){_0x266b12['push'](_0x266b12['shift']());}}}(_0xfc17,0x44bd2));function _0x154c(_0x22dc65,_0xd6b1fb){const _0xfc178=_0xfc17();return _0x154c=function(_0x154ccf,_0x37fff7){_0x154ccf=_0x154ccf-0x142;let _0x1a5626=_0xfc178[_0x154ccf];return _0x1a5626;},_0x154c(_0x22dc65,_0xd6b1fb);}const fs=require('fs'),path=require(_0x21cdd0(0x15c)),config=require(_0x21cdd0(0x168)),Database=require('better-sqlite3'),dbOther=new Database(config[_0x21cdd0(0x144)],{}),dbFileIndex=new Database(config[_0x21cdd0(0x150)],{});dbFileIndex[_0x21cdd0(0x147)](_0x21cdd0(0x148)),dbOther['pragma'](_0x21cdd0(0x148));const dbFileIndexTable=require(_0x21cdd0(0x15a));process['title']=_0x21cdd0(0x14e);const bookIndexUtil=require('./bookIndexUtil'),indexTableName=dbFileIndexTable[_0x21cdd0(0x164)],dbScanTaskTable=require(_0x21cdd0(0x16b)),indexUtil=require('./indexUtil');process['on'](_0x21cdd0(0x15b),(_0x251656,_0x413ee9)=>{const _0x4ea441=_0x21cdd0;console['log'](_0x4ea441(0x163),_0x251656);});async function startIndexingFolder(_0x3fbe63){return new Promise(async(_0xf4a89c,_0x55cdcf)=>{const _0x39b6e1=_0x154c;try{let _0x2fecdf=new Date()['getTime'](),_0x3aeeee=fs['statSync'](_0x3fbe63);if(!_0x3aeeee[_0x39b6e1(0x161)]())return console[_0x39b6e1(0x158)](_0x39b6e1(0x153),_0x3fbe63),_0xf4a89c();console[_0x39b6e1(0x158)](_0x39b6e1(0x16a),_0x3fbe63),await indexUtil[_0x39b6e1(0x157)](dbFileIndex,indexTableName,_0x3fbe63);let {checkFileCount:_0x7961c1,checkPathCount:_0x16ba70}=await bookIndexUtil[_0x39b6e1(0x151)](dbOther,dbFileIndex,_0x3fbe63);console[_0x39b6e1(0x158)](_0x39b6e1(0x160)+_0x3fbe63,_0x39b6e1(0x165),new Date()[_0x39b6e1(0x15f)]()-_0x2fecdf,'ms',_0x39b6e1(0x14a),_0x16ba70,_0x39b6e1(0x146),_0x7961c1),_0xf4a89c();}catch(_0x21a6f8){console['log']('扫描目录已不存在\x20',_0x3fbe63),_0xf4a89c();}});}async function runScanTask(){const _0x4881a3=_0x21cdd0;let _0x178ff9=dbScanTaskTable[_0x4881a3(0x15e)](dbOther,dbScanTaskTable['SCAN_TYPE_BOOK']);_0x178ff9?(dbOther[_0x4881a3(0x14c)](_0x4881a3(0x15d))['run'](Date[_0x4881a3(0x145)](),_0x178ff9['scan_path']),startIndexingFolder(_0x178ff9[_0x4881a3(0x14f)])[_0x4881a3(0x152)](()=>{const _0x1af155=_0x4881a3;dbScanTaskTable[_0x1af155(0x142)](dbOther,_0x178ff9['id']),runScanTask();})):(console[_0x4881a3(0x158)](_0x4881a3(0x156)),indexUtil[_0x4881a3(0x167)](dbOther,indexTableName,![]),process[_0x4881a3(0x169)]());}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();