const _0x295a5e=_0x1468;(function(_0x2a69b2,_0x343c38){const _0x513a78=_0x1468,_0x4e7ee9=_0x2a69b2();while(!![]){try{const _0x5988d4=parseInt(_0x513a78(0x153))/0x1*(-parseInt(_0x513a78(0x162))/0x2)+parseInt(_0x513a78(0x158))/0x3*(-parseInt(_0x513a78(0x133))/0x4)+parseInt(_0x513a78(0x128))/0x5+-parseInt(_0x513a78(0x13d))/0x6*(-parseInt(_0x513a78(0x148))/0x7)+-parseInt(_0x513a78(0x14c))/0x8+parseInt(_0x513a78(0x14e))/0x9+-parseInt(_0x513a78(0x121))/0xa;if(_0x5988d4===_0x343c38)break;else _0x4e7ee9['push'](_0x4e7ee9['shift']());}catch(_0x34b9cc){_0x4e7ee9['push'](_0x4e7ee9['shift']());}}}(_0x2649,0x399f5));let indexUtil={};const currentPlatform=require('os')[_0x295a5e(0x154)](),path=require('path'),dbSourceFolderTable=require(_0x295a5e(0x167)),dbFileIndexTable=require(_0x295a5e(0x125)),dbConfigTable=require(_0x295a5e(0x16e)),config=require(_0x295a5e(0x122)),fs=require('fs');let FFmpeg=require(_0x295a5e(0x142))[_0x295a5e(0x172)];const transCodeUtil=require(_0x295a5e(0x123));function _0x1468(_0x331cb2,_0x19fe1d){const _0x2649da=_0x2649();return _0x1468=function(_0x1468c4,_0x2bb02f){_0x1468c4=_0x1468c4-0x120;let _0x1477e6=_0x2649da[_0x1468c4];return _0x1477e6;},_0x1468(_0x331cb2,_0x19fe1d);}function _0x2649(){const _0x219ef4=['isPathIsInSourceFolder','darwin','isFile','来源目录已不存在\x20停止扫描','ENOENT','getByPath','filePath','sep','deletePathAll','922206LDZaya','readdirSync','isDirectory','recursionFilesAddIndex','prepare','../../libs/nasTrans','******New\x20file******:','filename','checkPathIsInPrivateSpace','code','ffprobeSync','7mNXMQT','mtimeMs','length','文件夹已不存在\x20删除文件夹及文件夹下的索引','812712nSOlDt','缓存数据目录内的变动，不处理','4021569syWVfx','delete','-indexing','log','deleteByPathAndFileName','1FmuvSD','platform','some','fullPath','/proc/','366SUPAjL','mtime','.bc!','is_file','.tmp','getTime','add','get','dbnascab-journal','watchPath','934710ccAETW','filter','.downloading','\x27\x20like\x20','Skip\x20hidden\x20file/folder\x20','../../db/dbSourceFolderTable','dealFileChange','dbPath','split','isForbiddenPath','endsWith','statSync','../../db/dbConfigTable','索引状态比对','dealFFmpegPath','.xltd','FFmpeg','setIndexingState','path','dbnascab','cacheParentPath','nascabconfig','tiny','Not\x20in\x20source\x20folder\x20','文件已不存在','isForbiddenFilename','pop','error','startsWith','1187810KAiayW','../../myConfig/config','../../utils/transCodeUtil','Not\x20exist\x20','../../db/dbFileIndexTable','existsSync','uploadTempFilePrefix','2229680ulNUuA','linux','SELECT\x20*\x20FROM\x20private_space\x20WHERE\x20folder_path=\x27','`folder_path`||\x27','push','isPathInHiddenDir','.td','getPathByType','join','getPathAllOnlyChild','replace','4024vRFlPP'];_0x2649=function(){return _0x219ef4;};return _0x2649();}indexUtil[_0x295a5e(0x140)]=async function(_0x508215,_0x5f1f09,_0xefac3d,_0x239da8,_0x127eed,_0x5e9306,_0x1a9187){const _0x3e6439=_0x295a5e;let _0x1193f0=0x1,_0x39dada=0x0;try{let _0x134457=[{'path':_0x127eed,'files':fs[_0x3e6439(0x13e)](_0x127eed)}];while(_0x134457[_0x3e6439(0x14a)]>0x0){let {path:_0xaa04c3,files:_0x638495}=_0x134457[_0x3e6439(0x17c)]();if(indexUtil[_0x3e6439(0x145)](_0x508215,_0xaa04c3))continue;if(indexUtil['isPathInHiddenDir'](_0xaa04c3)){console['log'](_0x3e6439(0x166)+_0xaa04c3);continue;}for(let _0x531332=0x0;_0x531332<_0x638495[_0x3e6439(0x14a)];_0x531332++){let _0x59a907=_0x638495[_0x531332];if(_0x59a907[_0x3e6439(0x120)](config[_0x3e6439(0x127)]))continue;if(!indexUtil[_0x3e6439(0x134)](_0x508215,_0x239da8,_0x127eed))return console[_0x3e6439(0x151)](_0x3e6439(0x137),_0x127eed),![];let _0x2edd79=path[_0x3e6439(0x130)](_0xaa04c3,_0x59a907);try{let _0x5b7ba3=fs['statSync'](_0x2edd79),_0x3aa2fb=dbFileIndexTable['getByPath'](_0x5f1f09,_0xaa04c3,_0x59a907,_0xefac3d);if(_0x5b7ba3[_0x3e6439(0x136)]())!_0x3aa2fb&&await _0x5e9306(_0x508215,_0x5f1f09,_0xaa04c3,_0x59a907,0x1,_0x5b7ba3),_0x39dada+=0x1;else _0x5b7ba3['isDirectory']()&&(!_0x3aa2fb&&await _0x5e9306(_0x508215,_0x5f1f09,_0xaa04c3,_0x59a907,0x0,_0x5b7ba3),_0x134457['push']({'path':_0x2edd79,'files':fs['readdirSync'](_0x2edd79)}),_0x1193f0+=0x1);_0x1a9187&&_0x1a9187();}catch(_0x552ae8){console[_0x3e6439(0x151)]('err',_0x552ae8);continue;}}}return{'checkFileCount':_0x39dada,'checkPathCount':_0x1193f0};}catch(_0x3b975e){return console['log'](_0x3e6439(0x17d),_0x3b975e),{'checkFileCount':_0x39dada,'checkPathCount':_0x1193f0};}},indexUtil[_0x295a5e(0x168)]=async function(_0x35bed2,_0x30f798,_0x4e363d,_0x331f44,_0x217cf7,_0x3dd128,_0x3a63cc){const _0x56c978=_0x295a5e;let _0x4ca4c1=_0x4e363d[_0x56c978(0x161)],_0x8bd504=_0x4e363d[_0x56c978(0x13a)],_0x2701f8=_0x4e363d['fileName'],_0x6bf794=_0x4e363d[_0x56c978(0x156)];if(_0x2701f8[_0x56c978(0x120)](config[_0x56c978(0x127)]))return;let _0x417e70=dbSourceFolderTable[_0x56c978(0x139)](_0x30f798,_0x4ca4c1);if(!_0x417e70){console[_0x56c978(0x151)]('来源目录不存在了\x20不处理文件\x20',_0x4ca4c1);return;}let _0x1b5a27=dbFileIndexTable[_0x56c978(0x139)](_0x35bed2,_0x8bd504,_0x2701f8,_0x331f44);try{let _0x166dce=fs[_0x56c978(0x16d)](_0x6bf794);if(_0x166dce[_0x56c978(0x136)]()&&!_0x1b5a27)console[_0x56c978(0x151)](_0x56c978(0x143),_0x2701f8),await _0x217cf7(_0x30f798,_0x35bed2,_0x8bd504,_0x2701f8,0x1,_0x166dce);else{if(_0x166dce[_0x56c978(0x13f)]()&&!_0x1b5a27)console[_0x56c978(0x151)]('******New\x20folder******',_0x6bf794),await _0x217cf7(_0x30f798,_0x35bed2,_0x8bd504,_0x2701f8,0x0,_0x166dce),await _0x3dd128(_0x30f798,_0x35bed2,_0x6bf794);else{if(_0x166dce&&_0x1b5a27){if(_0x166dce[_0x56c978(0x149)]!=_0x1b5a27[_0x56c978(0x159)]){let _0xa2d762=dbFileIndexTable['deleteByPathAndFileName'](_0x35bed2,_0x8bd504,_0x2701f8,_0x331f44);_0x3a63cc&&_0x3a63cc(_0x1b5a27,_0xa2d762),await _0x217cf7(_0x30f798,_0x35bed2,_0x8bd504,_0x2701f8,_0x166dce['isFile']()?0x1:0x0,_0x166dce);}else{}}}}}catch(_0x48a370){console[_0x56c978(0x151)](_0x56c978(0x17a),_0x8bd504,_0x2701f8);try{if(_0x48a370[_0x56c978(0x146)]==_0x56c978(0x138)){if(_0x1b5a27&&_0x1b5a27[_0x56c978(0x15b)]==0x1){let _0x22819c=dbFileIndexTable[_0x56c978(0x152)](_0x35bed2,_0x8bd504,_0x2701f8,_0x331f44);_0x3a63cc&&_0x3a63cc(_0x1b5a27,_0x22819c);}else _0x1b5a27&&_0x1b5a27[_0x56c978(0x15b)]==0x0&&(dbFileIndexTable[_0x56c978(0x152)](_0x35bed2,_0x8bd504,_0x2701f8,_0x331f44),dbFileIndexTable[_0x56c978(0x13c)](_0x35bed2,_0x6bf794,_0x331f44));}else console[_0x56c978(0x151)](_0x48a370);}catch(_0x2780ad){console[_0x56c978(0x151)](_0x2780ad);}}return;},indexUtil[_0x295a5e(0x147)]=function(_0x157ff3){return new Promise((_0x9dcaff,_0x4a4e62)=>{const _0x10aa0b=_0x1468;try{FFmpeg(transCodeUtil[_0x10aa0b(0x170)](_0x157ff3))['ffprobe']((_0x4b7817,_0x3ae6f5)=>{_0x4b7817?_0x4a4e62(_0x4b7817):_0x9dcaff(_0x3ae6f5);});}catch(_0x173743){_0x4a4e62(_0x173743);}});},indexUtil[_0x295a5e(0x12d)]=function(_0x49b339){const _0x1bdbf9=_0x295a5e;try{const _0x52159d=_0x49b339[_0x1bdbf9(0x16a)](/[\/\\]/)[_0x1bdbf9(0x163)](Boolean);return _0x52159d[_0x1bdbf9(0x155)](_0x5933e5=>_0x5933e5[_0x1bdbf9(0x120)]('.'));}catch(_0x4fada5){return![];}},indexUtil[_0x295a5e(0x134)]=function(_0x4b2f65,_0x31e761,_0x2eac37){const _0x53be5e=_0x295a5e;let _0x1bf669=dbSourceFolderTable[_0x53be5e(0x12f)](_0x4b2f65,_0x31e761);for(let _0x13191d of _0x1bf669){if(_0x2eac37==_0x13191d[_0x53be5e(0x174)]||_0x2eac37[_0x53be5e(0x120)](path[_0x53be5e(0x130)](_0x13191d[_0x53be5e(0x174)],path['sep'])))return _0x13191d;}return![];},indexUtil[_0x295a5e(0x145)]=function(_0x472460,_0x15fc1b){const _0x3dc8b7=_0x295a5e;if(_0x15fc1b['endsWith'](path[_0x3dc8b7(0x130)](_0x3dc8b7(0x177),path[_0x3dc8b7(0x13b)],_0x3dc8b7(0x160)))||_0x15fc1b['endsWith'](path[_0x3dc8b7(0x130)](_0x3dc8b7(0x177),path[_0x3dc8b7(0x13b)],_0x3dc8b7(0x178)))||_0x15fc1b['endsWith'](path[_0x3dc8b7(0x130)](_0x3dc8b7(0x177),path['sep'],_0x3dc8b7(0x175))))return!![];try{_0x15fc1b=_0x15fc1b[_0x3dc8b7(0x132)](/\'/g,'\x27\x27');let _0x50f7ad=_0x3dc8b7(0x12a)+_0x15fc1b+'\x27\x20or\x20\x27'+_0x15fc1b+_0x3dc8b7(0x165)+_0x3dc8b7(0x12b)+path['sep']+'%\x27',_0x21a18e=_0x472460[_0x3dc8b7(0x141)](_0x50f7ad)[_0x3dc8b7(0x15f)]();return _0x21a18e?!![]:![];}catch(_0x1aadf3){return![];}},indexUtil['isForbiddenPath']=function(_0x3fd71b,_0x11a9ef){const _0x4c1d3a=_0x295a5e;try{if(currentPlatform==_0x4c1d3a(0x129)||currentPlatform==_0x4c1d3a(0x135)){if(_0x11a9ef[_0x4c1d3a(0x120)](_0x4c1d3a(0x157)))return!![];if(_0x11a9ef=='/')return!![];}let _0x1201ed=path[_0x4c1d3a(0x130)](_0x3fd71b[_0x4c1d3a(0x169)]),_0x4257c6=path[_0x4c1d3a(0x130)](_0x3fd71b[_0x4c1d3a(0x176)]),_0x13c988=path[_0x4c1d3a(0x130)](_0x4257c6,path[_0x4c1d3a(0x13b)]),_0x303375=path[_0x4c1d3a(0x130)](_0x1201ed);_0x11a9ef=path[_0x4c1d3a(0x130)](_0x11a9ef);if(_0x11a9ef==_0x1201ed||_0x11a9ef==_0x4257c6||_0x11a9ef[_0x4c1d3a(0x120)](_0x303375)||_0x11a9ef[_0x4c1d3a(0x120)](_0x13c988))return console[_0x4c1d3a(0x151)](_0x4c1d3a(0x14d),_0x11a9ef),!![];return![];}catch(_0x507e1f){return console['log'](_0x507e1f),![];}},indexUtil[_0x295a5e(0x17b)]=function(_0x4a1ed8){const _0x3f0a37=_0x295a5e;try{if(_0x4a1ed8[_0x3f0a37(0x120)]('.'))return!![];if(_0x4a1ed8[_0x3f0a37(0x16c)](_0x3f0a37(0x15c))||_0x4a1ed8['endsWith'](_0x3f0a37(0x15a))||_0x4a1ed8['endsWith'](_0x3f0a37(0x12e))||_0x4a1ed8[_0x3f0a37(0x16c)]('.qkdownloading')||_0x4a1ed8[_0x3f0a37(0x16c)](_0x3f0a37(0x171))||_0x4a1ed8[_0x3f0a37(0x16c)](_0x3f0a37(0x164)))return!![];return![];}catch(_0x1bfed3){return console['log'](_0x1bfed3),![];}},indexUtil[_0x295a5e(0x173)]=function(_0xd84ad0,_0x5943d2,_0x2b2ede){const _0x9f3566=_0x295a5e;dbConfigTable['create'](_0xd84ad0,{'title':_0x5943d2+_0x9f3566(0x150),'value':_0x2b2ede?'1':'0'});},indexUtil['doesPathCanAddToDb']=function(_0x3b8798,_0x42fbba,_0x33b9be,_0x27b66a,_0x3e9c5a){const _0x4890fb=_0x295a5e;if(indexUtil[_0x4890fb(0x16b)](_0x33b9be,_0x27b66a))return![];if(indexUtil[_0x4890fb(0x17b)](_0x3e9c5a))return![];if(!fs[_0x4890fb(0x126)](path[_0x4890fb(0x130)](_0x27b66a,_0x3e9c5a)))return console[_0x4890fb(0x151)](_0x4890fb(0x124),_0x27b66a,_0x3e9c5a),![];let _0x11b0f1=indexUtil['isPathIsInSourceFolder'](_0x3b8798,_0x42fbba,_0x27b66a);if(!_0x11b0f1)return console[_0x4890fb(0x151)](_0x4890fb(0x179),_0x42fbba,_0x27b66a,_0x3e9c5a),![];return _0x11b0f1;},indexUtil['recursionDeleteIndex']=async function(_0x5058d9,_0x31e575,_0x367887){const _0x2dd2a8=_0x295a5e;let _0x50d358=[_0x367887],_0x317835=new Set([_0x367887]),_0x2b478b=new Date()[_0x2dd2a8(0x15d)]();while(_0x50d358[_0x2dd2a8(0x14a)]>0x0){let _0xe562b3=_0x50d358[_0x2dd2a8(0x17c)](),_0x5da5de=dbFileIndexTable[_0x2dd2a8(0x131)](_0x5058d9,_0xe562b3,_0x31e575);for(let _0x5cb44c=0x0;_0x5cb44c<_0x5da5de['length'];_0x5cb44c++){let _0x2aa2e1=path[_0x2dd2a8(0x130)](_0x5da5de[_0x5cb44c][_0x2dd2a8(0x174)],_0x5da5de[_0x5cb44c][_0x2dd2a8(0x144)]);try{let _0x5cdb03=fs['statSync'](_0x2aa2e1);if(_0x5cdb03[_0x2dd2a8(0x136)]()){}else _0x5cdb03[_0x2dd2a8(0x13f)]()&&(!_0x317835['has'](_0x2aa2e1)&&(_0x50d358[_0x2dd2a8(0x12c)](_0x2aa2e1),_0x317835[_0x2dd2a8(0x15e)](_0x2aa2e1)));}catch(_0x2072bf){_0x2072bf[_0x2dd2a8(0x146)]==_0x2dd2a8(0x138)&&(_0x5da5de[_0x5cb44c]['is_file']==0x1?dbFileIndexTable[_0x2dd2a8(0x14f)](_0x5058d9,_0x5da5de[_0x5cb44c]['id'],_0x31e575):(console[_0x2dd2a8(0x151)](_0x2dd2a8(0x14b),_0x2aa2e1),dbFileIndexTable['deleteByPathAndFileName'](_0x5058d9,_0x5da5de[_0x5cb44c][_0x2dd2a8(0x174)],_0x5da5de[_0x5cb44c]['filename'],_0x31e575),dbFileIndexTable['deletePathAll'](_0x5058d9,_0x2aa2e1,_0x31e575)));}}}console['log'](_0x2dd2a8(0x16f),_0x367887,'耗时:',new Date()[_0x2dd2a8(0x15d)]()-_0x2b478b,'ms');},module['exports']=indexUtil;