const _0x2156b4=_0x5e07;(function(_0x4913db,_0x5851b2){const _0x1fd368=_0x5e07,_0x3ba47e=_0x4913db();while(!![]){try{const _0x9c07a6=-parseInt(_0x1fd368(0x1e1))/0x1*(parseInt(_0x1fd368(0x1d2))/0x2)+parseInt(_0x1fd368(0x1df))/0x3*(parseInt(_0x1fd368(0x1e6))/0x4)+parseInt(_0x1fd368(0x1ff))/0x5+parseInt(_0x1fd368(0x1fb))/0x6*(parseInt(_0x1fd368(0x1d1))/0x7)+parseInt(_0x1fd368(0x1be))/0x8*(parseInt(_0x1fd368(0x1d0))/0x9)+-parseInt(_0x1fd368(0x1f1))/0xa*(-parseInt(_0x1fd368(0x1f5))/0xb)+-parseInt(_0x1fd368(0x1ae))/0xc;if(_0x9c07a6===_0x5851b2)break;else _0x3ba47e['push'](_0x3ba47e['shift']());}catch(_0x5854a8){_0x3ba47e['push'](_0x3ba47e['shift']());}}}(_0x1229,0x686ac));let indexUtil={};function _0x5e07(_0x49b60c,_0x190b85){const _0x1229e5=_0x1229();return _0x5e07=function(_0x5e075f,_0x4af323){_0x5e075f=_0x5e075f-0x1ae;let _0x1b99d5=_0x1229e5[_0x5e075f];return _0x1b99d5;},_0x5e07(_0x49b60c,_0x190b85);}const currentPlatform=require('os')['platform'](),path=require('path'),dbSourceFolderTable=require(_0x2156b4(0x1ec)),dbFileIndexTable=require(_0x2156b4(0x1d5)),dbConfigTable=require(_0x2156b4(0x1b7)),config=require('../../myConfig/config'),fs=require('fs');let FFmpeg=require(_0x2156b4(0x1de))[_0x2156b4(0x1db)];const transCodeUtil=require(_0x2156b4(0x1f9));indexUtil[_0x2156b4(0x1ce)]=async function(_0x3004f5,_0x3d8938,_0x1e802f,_0x33695f,_0x13ceae,_0x21d485,_0x370768){const _0x26cb05=_0x2156b4;let _0x26b795=0x1,_0x28ae1f=0x0;try{let _0xe75d46=[{'path':_0x13ceae,'files':fs[_0x26cb05(0x1e4)](_0x13ceae)}];while(_0xe75d46[_0x26cb05(0x1c9)]>0x0){let {path:_0x289f82,files:_0x6a6727}=_0xe75d46[_0x26cb05(0x1d7)]();if(indexUtil['checkPathIsInPrivateSpace'](_0x3004f5,_0x289f82))continue;if(indexUtil['isPathInHiddenDir'](_0x289f82)){console[_0x26cb05(0x1f0)](_0x26cb05(0x1c6)+_0x289f82);continue;}for(let _0xe25c48=0x0;_0xe25c48<_0x6a6727['length'];_0xe25c48++){let _0x36bc96=_0x6a6727[_0xe25c48];if(_0x36bc96[_0x26cb05(0x1b9)](config[_0x26cb05(0x1bb)]))continue;if(!indexUtil[_0x26cb05(0x1e0)](_0x3004f5,_0x33695f,_0x13ceae))return console[_0x26cb05(0x1f0)](_0x26cb05(0x1eb),_0x13ceae),![];let _0x70b57a=path['join'](_0x289f82,_0x36bc96);try{let _0x9759e6=fs['statSync'](_0x70b57a),_0x574c07=dbFileIndexTable['getByPath'](_0x3d8938,_0x289f82,_0x36bc96,_0x1e802f);if(_0x9759e6[_0x26cb05(0x1ef)]())!_0x574c07&&await _0x21d485(_0x3004f5,_0x3d8938,_0x289f82,_0x36bc96,0x1,_0x9759e6),_0x28ae1f+=0x1;else _0x9759e6[_0x26cb05(0x1bf)]()&&(!_0x574c07&&await _0x21d485(_0x3004f5,_0x3d8938,_0x289f82,_0x36bc96,0x0,_0x9759e6),_0xe75d46[_0x26cb05(0x1bc)]({'path':_0x70b57a,'files':fs[_0x26cb05(0x1e4)](_0x70b57a)}),_0x26b795+=0x1);_0x370768&&_0x370768();}catch(_0x34ee22){console[_0x26cb05(0x1f0)](_0x26cb05(0x1e8),_0x34ee22);continue;}}}return{'checkFileCount':_0x28ae1f,'checkPathCount':_0x26b795};}catch(_0x13a111){return console[_0x26cb05(0x1f0)](_0x26cb05(0x207),_0x13a111),{'checkFileCount':_0x28ae1f,'checkPathCount':_0x26b795};}},indexUtil[_0x2156b4(0x1ee)]=async function(_0x2162f7,_0x57f197,_0x3e6157,_0x3d4c4f,_0x20ea92,_0x4ed73a,_0x39b6d6){const _0x1d1ffc=_0x2156b4;let _0x9fbba5=_0x3e6157[_0x1d1ffc(0x1f6)],_0x41639a=_0x3e6157[_0x1d1ffc(0x201)],_0x1d3d12=_0x3e6157[_0x1d1ffc(0x1b4)],_0x1cbde6=_0x3e6157['fullPath'];if(_0x1d3d12[_0x1d1ffc(0x1b9)](config['uploadTempFilePrefix']))return;let _0x4f66ba=dbSourceFolderTable[_0x1d1ffc(0x1d4)](_0x57f197,_0x9fbba5);if(!_0x4f66ba){console[_0x1d1ffc(0x1f0)](_0x1d1ffc(0x1ea),_0x9fbba5);return;}let _0xb811b=dbFileIndexTable[_0x1d1ffc(0x1d4)](_0x2162f7,_0x41639a,_0x1d3d12,_0x3d4c4f);try{let _0x5ebbfc=fs['statSync'](_0x1cbde6);if(_0x5ebbfc[_0x1d1ffc(0x1ef)]()&&!_0xb811b)console[_0x1d1ffc(0x1f0)](_0x1d1ffc(0x1bd),_0x1d3d12),await _0x20ea92(_0x57f197,_0x2162f7,_0x41639a,_0x1d3d12,0x1,_0x5ebbfc);else{if(_0x5ebbfc[_0x1d1ffc(0x1bf)]()&&!_0xb811b)console['log'](_0x1d1ffc(0x1f7),_0x1cbde6),await _0x20ea92(_0x57f197,_0x2162f7,_0x41639a,_0x1d3d12,0x0,_0x5ebbfc),await _0x4ed73a(_0x57f197,_0x2162f7,_0x1cbde6);else{if(_0x5ebbfc&&_0xb811b){if(_0x5ebbfc[_0x1d1ffc(0x1c2)]!=_0xb811b[_0x1d1ffc(0x1d6)]){let _0x385ec6=dbFileIndexTable[_0x1d1ffc(0x1d9)](_0x2162f7,_0x41639a,_0x1d3d12,_0x3d4c4f);_0x39b6d6&&_0x39b6d6(_0xb811b,_0x385ec6),await _0x20ea92(_0x57f197,_0x2162f7,_0x41639a,_0x1d3d12,_0x5ebbfc[_0x1d1ffc(0x1ef)]()?0x1:0x0,_0x5ebbfc);}else{}}}}}catch(_0x3932d0){console['log'](_0x1d1ffc(0x1c3),_0x41639a,_0x1d3d12);try{if(_0x3932d0['code']==_0x1d1ffc(0x202)){if(_0xb811b&&_0xb811b['is_file']==0x1){let _0x5a1601=dbFileIndexTable['deleteByPathAndFileName'](_0x2162f7,_0x41639a,_0x1d3d12,_0x3d4c4f);_0x39b6d6&&_0x39b6d6(_0xb811b,_0x5a1601);}else _0xb811b&&_0xb811b[_0x1d1ffc(0x1b2)]==0x0&&(dbFileIndexTable['deleteByPathAndFileName'](_0x2162f7,_0x41639a,_0x1d3d12,_0x3d4c4f),dbFileIndexTable[_0x1d1ffc(0x1e3)](_0x2162f7,_0x1cbde6,_0x3d4c4f));}else console[_0x1d1ffc(0x1f0)](_0x3932d0);}catch(_0x43c5b3){console[_0x1d1ffc(0x1f0)](_0x43c5b3);}}return;},indexUtil[_0x2156b4(0x1cd)]=function(_0x481178){return new Promise((_0x2bece6,_0x4b4e42)=>{const _0x2528c4=_0x5e07;try{FFmpeg(transCodeUtil['dealFFmpegPath'](_0x481178))[_0x2528c4(0x1cf)]((_0x33d162,_0x4ac1dd)=>{_0x33d162?_0x4b4e42(_0x33d162):_0x2bece6(_0x4ac1dd);});}catch(_0x2446e9){_0x4b4e42(_0x2446e9);}});},indexUtil[_0x2156b4(0x200)]=function(_0xe85397){const _0x34832d=_0x2156b4;try{const _0x2c39b2=_0xe85397['split'](/[\/\\]/)['filter'](Boolean);return _0x2c39b2['some'](_0x1d8a1c=>_0x1d8a1c[_0x34832d(0x1b9)]('.'));}catch(_0x1688f9){return![];}},indexUtil['isPathIsInSourceFolder']=function(_0x4a4812,_0x5c76a4,_0xc8647){const _0x12b2f3=_0x2156b4;let _0x12902e=dbSourceFolderTable[_0x12b2f3(0x1c0)](_0x4a4812,_0x5c76a4);for(let _0x27eff7 of _0x12902e){if(_0xc8647==_0x27eff7[_0x12b2f3(0x1d8)]||_0xc8647[_0x12b2f3(0x1b9)](path[_0x12b2f3(0x1f8)](_0x27eff7[_0x12b2f3(0x1d8)],path[_0x12b2f3(0x1fd)])))return _0x27eff7;}return![];},indexUtil[_0x2156b4(0x1c4)]=function(_0xdbd7c2,_0x2eae64){const _0x1f066e=_0x2156b4;if(_0x2eae64[_0x1f066e(0x1b1)](path[_0x1f066e(0x1f8)](_0x1f066e(0x203),path[_0x1f066e(0x1fd)],_0x1f066e(0x1af)))||_0x2eae64['endsWith'](path['join'](_0x1f066e(0x203),path['sep'],'tiny'))||_0x2eae64[_0x1f066e(0x1b1)](path[_0x1f066e(0x1f8)](_0x1f066e(0x203),path[_0x1f066e(0x1fd)],'dbnascab')))return!![];try{_0x2eae64=_0x2eae64[_0x1f066e(0x1f4)](/\'/g,'\x27\x27');let _0x5090e1='SELECT\x20*\x20FROM\x20private_space\x20WHERE\x20folder_path=\x27'+_0x2eae64+_0x1f066e(0x1f3)+_0x2eae64+_0x1f066e(0x1e2)+_0x1f066e(0x1c1)+path['sep']+'%\x27',_0x212572=_0xdbd7c2[_0x1f066e(0x1fa)](_0x5090e1)[_0x1f066e(0x1fe)]();return _0x212572?!![]:![];}catch(_0x12a595){return![];}},indexUtil['isForbiddenPath']=function(_0x24f5f4,_0x189308){const _0xe7e561=_0x2156b4;try{if(currentPlatform=='linux'||currentPlatform==_0xe7e561(0x1d3)){if(_0x189308['startsWith'](_0xe7e561(0x1dd)))return!![];if(_0x189308=='/')return!![];}let _0x3093af=path[_0xe7e561(0x1f8)](_0x24f5f4[_0xe7e561(0x206)]),_0x4d7c4d=path[_0xe7e561(0x1f8)](_0x24f5f4['cacheParentPath']),_0x5a06e2=path[_0xe7e561(0x1f8)](_0x4d7c4d,path[_0xe7e561(0x1fd)]),_0x9d560c=path[_0xe7e561(0x1f8)](_0x3093af);_0x189308=path[_0xe7e561(0x1f8)](_0x189308);if(_0x189308==_0x3093af||_0x189308==_0x4d7c4d||_0x189308['startsWith'](_0x9d560c)||_0x189308[_0xe7e561(0x1b9)](_0x5a06e2))return console[_0xe7e561(0x1f0)]('缓存数据目录内的变动，不处理',_0x189308),!![];return![];}catch(_0x3cf332){return console['log'](_0x3cf332),![];}},indexUtil['isForbiddenFilename']=function(_0x40d921){const _0x4faa52=_0x2156b4;try{if(_0x40d921['startsWith']('.'))return!![];if(_0x40d921[_0x4faa52(0x1b1)](_0x4faa52(0x1f2))||_0x40d921[_0x4faa52(0x1b1)](_0x4faa52(0x1b0))||_0x40d921[_0x4faa52(0x1b1)](_0x4faa52(0x1b6))||_0x40d921['endsWith']('.qkdownloading')||_0x40d921['endsWith'](_0x4faa52(0x1b3))||_0x40d921[_0x4faa52(0x1b1)](_0x4faa52(0x1b5)))return!![];return![];}catch(_0x1d02d0){return console[_0x4faa52(0x1f0)](_0x1d02d0),![];}},indexUtil[_0x2156b4(0x1fc)]=function(_0x110aa2,_0x25cd2c,_0x14ee80){const _0xe4a6ca=_0x2156b4;dbConfigTable['create'](_0x110aa2,{'title':_0x25cd2c+_0xe4a6ca(0x1e5),'value':_0x14ee80?'1':'0'});},indexUtil[_0x2156b4(0x1ba)]=function(_0x43d09d,_0x4de219,_0x261d12,_0x43ff75,_0x13853e){const _0x64b7e7=_0x2156b4;if(indexUtil[_0x64b7e7(0x204)](_0x261d12,_0x43ff75))return![];if(indexUtil['isForbiddenFilename'](_0x13853e))return![];if(!fs[_0x64b7e7(0x1cb)](path[_0x64b7e7(0x1f8)](_0x43ff75,_0x13853e)))return console[_0x64b7e7(0x1f0)](_0x64b7e7(0x1ca),_0x43ff75,_0x13853e),![];let _0x11af3c=indexUtil[_0x64b7e7(0x1e0)](_0x43d09d,_0x4de219,_0x43ff75);if(!_0x11af3c)return console[_0x64b7e7(0x1f0)](_0x64b7e7(0x205),_0x4de219,_0x43ff75,_0x13853e),![];return _0x11af3c;},indexUtil['recursionDeleteIndex']=async function(_0x3f291d,_0x7d07cf,_0x14fd86){const _0x3dc929=_0x2156b4;let _0x671031=[_0x14fd86],_0x1dc07f=new Set([_0x14fd86]),_0x1c3646=new Date()['getTime']();while(_0x671031[_0x3dc929(0x1c9)]>0x0){let _0x26b8d0=_0x671031[_0x3dc929(0x1d7)](),_0x34dc27=dbFileIndexTable[_0x3dc929(0x1dc)](_0x3f291d,_0x26b8d0,_0x7d07cf);for(let _0x12b595=0x0;_0x12b595<_0x34dc27[_0x3dc929(0x1c9)];_0x12b595++){let _0x2b4d92=path['join'](_0x34dc27[_0x12b595][_0x3dc929(0x1d8)],_0x34dc27[_0x12b595]['filename']);try{let _0x2753aa=fs[_0x3dc929(0x1c5)](_0x2b4d92);if(_0x2753aa[_0x3dc929(0x1ef)]()){}else _0x2753aa[_0x3dc929(0x1bf)]()&&(!_0x1dc07f[_0x3dc929(0x1c7)](_0x2b4d92)&&(_0x671031['push'](_0x2b4d92),_0x1dc07f[_0x3dc929(0x1e9)](_0x2b4d92)));}catch(_0x4eb278){_0x4eb278['code']==_0x3dc929(0x202)&&(_0x34dc27[_0x12b595]['is_file']==0x1?dbFileIndexTable[_0x3dc929(0x1cc)](_0x3f291d,_0x34dc27[_0x12b595]['id'],_0x7d07cf):(console[_0x3dc929(0x1f0)](_0x3dc929(0x1da),_0x2b4d92),dbFileIndexTable[_0x3dc929(0x1d9)](_0x3f291d,_0x34dc27[_0x12b595][_0x3dc929(0x1d8)],_0x34dc27[_0x12b595][_0x3dc929(0x1c8)],_0x7d07cf),dbFileIndexTable['deletePathAll'](_0x3f291d,_0x2b4d92,_0x7d07cf)));}}}console[_0x3dc929(0x1f0)]('索引状态比对',_0x14fd86,_0x3dc929(0x1ed),new Date()[_0x3dc929(0x1b8)]()-_0x1c3646,'ms');},module[_0x2156b4(0x1e7)]=indexUtil;function _0x1229(){const _0x105690=['来源目录已不存在\x20停止扫描','../../db/dbSourceFolderTable','耗时:','dealFileChange','isFile','log','54420fHyzvt','.tmp','\x27\x20or\x20\x27','replace','286MwfRfI','watchPath','******New\x20folder******','join','../../utils/transCodeUtil','prepare','24ugRJZe','setIndexingState','sep','get','3507620RzvYHX','isPathInHiddenDir','filePath','ENOENT','nascabconfig','isForbiddenPath','Not\x20in\x20source\x20folder\x20','dbPath','error','13611672uQNYOG','dbnascab-journal','.bc!','endsWith','is_file','.xltd','fileName','.downloading','.td','../../db/dbConfigTable','getTime','startsWith','doesPathCanAddToDb','uploadTempFilePrefix','push','******New\x20file******:','308304GHOJfU','isDirectory','getPathByType','`folder_path`||\x27','mtimeMs','文件已不存在','checkPathIsInPrivateSpace','statSync','Skip\x20hidden\x20file/folder\x20','has','filename','length','Not\x20exist\x20','existsSync','delete','ffprobeSync','recursionFilesAddIndex','ffprobe','27aZOFPl','635621oycTrE','27484kaiYYT','darwin','getByPath','../../db/dbFileIndexTable','mtime','pop','path','deleteByPathAndFileName','文件夹已不存在\x20删除文件夹及文件夹下的索引','FFmpeg','getPathAllOnlyChild','/proc/','../../libs/nasTrans','1668666ytUXdO','isPathIsInSourceFolder','23vAeYvL','\x27\x20like\x20','deletePathAll','readdirSync','-indexing','4zQmpMk','exports','err','add','来源目录不存在了\x20不处理文件\x20'];_0x1229=function(){return _0x105690;};return _0x1229();}