const _0x931fba=_0x3e31;(function(_0x1d8384,_0xf4a55a){const _0x3ec1fc=_0x3e31,_0x10cd2a=_0x1d8384();while(!![]){try{const _0x8d7832=parseInt(_0x3ec1fc(0x1f0))/0x1*(parseInt(_0x3ec1fc(0x1ec))/0x2)+-parseInt(_0x3ec1fc(0x20d))/0x3*(parseInt(_0x3ec1fc(0x208))/0x4)+parseInt(_0x3ec1fc(0x1ce))/0x5+-parseInt(_0x3ec1fc(0x207))/0x6*(-parseInt(_0x3ec1fc(0x1cd))/0x7)+parseInt(_0x3ec1fc(0x205))/0x8*(-parseInt(_0x3ec1fc(0x1ca))/0x9)+-parseInt(_0x3ec1fc(0x200))/0xa+parseInt(_0x3ec1fc(0x1f7))/0xb*(parseInt(_0x3ec1fc(0x202))/0xc);if(_0x8d7832===_0xf4a55a)break;else _0x10cd2a['push'](_0x10cd2a['shift']());}catch(_0x592b44){_0x10cd2a['push'](_0x10cd2a['shift']());}}}(_0x56ad,0x91e69));function _0x3e31(_0x2efe05,_0x522df8){const _0x56ad91=_0x56ad();return _0x3e31=function(_0x3e31ae,_0x8ee97e){_0x3e31ae=_0x3e31ae-0x1c5;let _0x87e011=_0x56ad91[_0x3e31ae];return _0x87e011;},_0x3e31(_0x2efe05,_0x522df8);}const path=require(_0x931fba(0x1f4)),fs=require('fs'),dbFileIndexTable=require(_0x931fba(0x1d1)),config=require('../../myConfig/config'),videoStreamUtil=require(_0x931fba(0x20c)),indexUtil=require('./indexUtil');let musicUtils=require(_0x931fba(0x20a));const indexTableName=dbFileIndexTable[_0x931fba(0x1df)],musicIndexUtil={},sharpUtil=require(_0x931fba(0x1d4));let jsmediatags=require('jsmediatags'),musicTypeList=config[_0x931fba(0x1fd)];musicIndexUtil['dealFileChange']=async function(_0x4742fa,_0x5f6bd2,_0x4610e3){const _0x4ce2c2=_0x931fba;await indexUtil['dealFileChange'](_0x4742fa,_0x5f6bd2,_0x4610e3,indexTableName,musicIndexUtil[_0x4ce2c2(0x1cf)],musicIndexUtil['recursionFilesAddIndex']);return;},musicIndexUtil[_0x931fba(0x1cb)]=async function(_0x28dc0a,_0x1a71bd,_0x2b1574){const _0x2d32f7=_0x931fba;return await indexUtil[_0x2d32f7(0x1cb)](_0x28dc0a,_0x1a71bd,indexTableName,_0x2d32f7(0x1d0),_0x2b1574,musicIndexUtil['addFileIndexToDb']);},musicIndexUtil['addFileIndexToDb']=async function(_0x1b98be,_0x163df8,_0x49577f,_0xc8aea5,_0x3b840c,_0x134681){const _0x5e3431=_0x931fba;let _0x50a824=indexUtil['doesPathCanAddToDb'](_0x1b98be,'music',config,_0x49577f,_0xc8aea5);if(!_0x50a824)return;let _0x57bf64=_0x134681[_0x5e3431(0x1db)];_0x134681['mtimeMs']<_0x57bf64&&(_0x57bf64=_0x134681['mtimeMs']);_0x134681['atimeMs']<_0x57bf64&&(_0x57bf64=_0x134681[_0x5e3431(0x201)]);_0x134681[_0x5e3431(0x1d6)]<_0x57bf64&&(_0x57bf64=_0x134681['ctimeMs']);let _0x27f81b={'path':_0x49577f,'filename':_0xc8aea5,'is_file':_0x3b840c,'ctime':_0x134681[_0x5e3431(0x1d6)],'mtime':_0x134681[_0x5e3431(0x1d5)],'ext':path[_0x5e3431(0x210)](_0xc8aea5),'birthtime':Math['ceil'](_0x57bf64),'size':_0x134681[_0x5e3431(0x1dc)],'check_time':new Date()['getTime']()};_0x27f81b=await musicIndexUtil['dealMediaInfo'](_0x163df8,_0x27f81b);},musicIndexUtil[_0x931fba(0x1ff)]=async function(_0x5b1732,_0x1d042b){const _0xa0142d=_0x931fba;let _0x1a0a87=![],_0x4754f5=path['join'](_0x1d042b[_0xa0142d(0x1f4)],_0x1d042b['filename']);if(_0x1d042b[_0xa0142d(0x1c5)]==0x1&&_0x1d042b[_0xa0142d(0x206)]&&musicTypeList['includes'](_0x1d042b[_0xa0142d(0x206)]['toLowerCase']())){_0x1d042b[_0xa0142d(0x1e1)]=0x3;try{let _0x255230=await indexUtil[_0xa0142d(0x209)](_0x4754f5);if(_0x255230&&_0x255230[_0xa0142d(0x1c6)]&&_0x255230['streams']['length']>0x0){_0x1d042b[_0xa0142d(0x203)]=JSON[_0xa0142d(0x20f)](_0x255230[_0xa0142d(0x1c6)]);let _0x24427e=videoStreamUtil[_0xa0142d(0x1fc)](_0x255230);_0x24427e&&(_0x1d042b[_0xa0142d(0x1f2)]=_0x24427e);}if(_0x255230&&_0x255230[_0xa0142d(0x213)]&&_0x255230[_0xa0142d(0x213)][_0xa0142d(0x1e2)]){let _0x531577=_0x255230[_0xa0142d(0x213)][_0xa0142d(0x1e2)][_0xa0142d(0x1e5)];_0x531577&&(_0x1d042b[_0xa0142d(0x1e5)]=_0x531577),_0x255230[_0xa0142d(0x213)][_0xa0142d(0x1f2)]&&!_0x1d042b[_0xa0142d(0x1f2)]&&(_0x1d042b[_0xa0142d(0x1f2)]=_0x255230[_0xa0142d(0x213)][_0xa0142d(0x1f2)]);}musicIndexUtil['parseAudioTags'](_0x4754f5,_0x1d042b,_0x3927bc=>{const _0x58bf1f=_0xa0142d;return _0x3927bc[_0x58bf1f(0x1e5)]&&(_0x3927bc[_0x58bf1f(0x1e5)]=musicUtils[_0x58bf1f(0x1e6)](_0x3927bc[_0x58bf1f(0x1e5)])),_0x3927bc[_0x58bf1f(0x1e4)]&&(_0x3927bc['artist']=musicUtils[_0x58bf1f(0x1e6)](_0x3927bc[_0x58bf1f(0x1e4)])),_0x3927bc[_0x58bf1f(0x204)]&&(_0x3927bc[_0x58bf1f(0x204)]=musicUtils['transStringToUtf8'](_0x3927bc['title'])),_0x3927bc[_0x58bf1f(0x1ee)]&&(_0x3927bc[_0x58bf1f(0x1ee)]=musicUtils[_0x58bf1f(0x1e6)](_0x3927bc[_0x58bf1f(0x1ee)])),musicIndexUtil['addOriginalDate'](_0x5b1732,_0x1a0a87,_0x3927bc);});}catch(_0x221373){return console[_0xa0142d(0x1da)](_0x221373),musicIndexUtil[_0xa0142d(0x1fb)](_0x5b1732,_0x1a0a87,_0x1d042b);}}else{if(_0x1d042b[_0xa0142d(0x1c5)]==0x1)return;return musicIndexUtil[_0xa0142d(0x1fb)](_0x5b1732,_0x1a0a87,_0x1d042b);}},musicIndexUtil[_0x931fba(0x1fb)]=function(_0x31df91,_0x50b789,_0x13ded2){const _0x2dafef=_0x931fba;_0x50b789&&_0x50b789<config[_0x2dafef(0x1ef)]&&(_0x50b789=![]);(!_0x50b789||_0x50b789==_0x2dafef(0x1dd)||_0x50b789==_0x2dafef(0x1f1)||_0x50b789==_0x2dafef(0x1dd)||_0x50b789==_0x2dafef(0x1e9))&&(_0x50b789=_0x13ded2[_0x2dafef(0x1f5)]||_0x13ded2['ctime']);let _0x42c1fd=new Date(_0x50b789);_0x13ded2[_0x2dafef(0x1d7)]=_0x42c1fd[_0x2dafef(0x1e3)]();let _0x1aa4de=_0x42c1fd[_0x2dafef(0x20e)](),_0x112845=_0x42c1fd[_0x2dafef(0x1eb)]()+0x1;_0x112845=_0x112845>=0xa?_0x112845:'0'+_0x112845;let _0x4af1d8=_0x42c1fd[_0x2dafef(0x1f3)]();_0x4af1d8=_0x4af1d8>=0xa?_0x4af1d8:'0'+_0x4af1d8,_0x13ded2[_0x2dafef(0x212)]=_0x1aa4de+'-'+_0x112845+'-'+_0x4af1d8,musicIndexUtil[_0x2dafef(0x1cc)](_0x31df91,_0x13ded2);},musicIndexUtil[_0x931fba(0x1cc)]=function(_0x3195da,_0x335239){const _0x9e3dc4=_0x931fba;!_0x335239['album']&&(_0x335239[_0x9e3dc4(0x1e5)]=path[_0x9e3dc4(0x215)](_0x335239[_0x9e3dc4(0x1f4)]));let _0x550939=musicUtils[_0x9e3dc4(0x1ea)](_0x3195da,_0x335239);_0x335239['fileCoverPath']=_0x550939?_0x550939:'';let _0x34ffb9=dbFileIndexTable[_0x9e3dc4(0x1e7)](_0x3195da,_0x335239,indexTableName);if(_0x34ffb9&&_0x34ffb9[_0x9e3dc4(0x1c7)]){let _0x4e8f13=dbFileIndexTable['getById'](_0x3195da,_0x34ffb9[_0x9e3dc4(0x1c7)],dbFileIndexTable[_0x9e3dc4(0x1df)]);_0x4e8f13&&musicUtils['dealFirstLetterSingle'](_0x3195da,_0x4e8f13);}},musicIndexUtil[_0x931fba(0x20b)]=function(_0x3bf199,_0xd5d28e,_0x30670b){const _0x5cc98e=_0x931fba;function _0x46fa42(_0x27bfbe,_0x52a431,_0x247c9d,_0x2b3e2a,_0x25fb98){const _0x422eae=_0x3e31;try{!_0xd5d28e[_0x52a431]&&(_0x27bfbe[_0x247c9d]&&typeof _0x27bfbe[_0x247c9d]=='string'&&(_0xd5d28e[_0x247c9d]=_0x27bfbe[_0x247c9d]),!_0xd5d28e[_0x52a431]&&_0x2b3e2a&&_0x27bfbe[_0x2b3e2a]&&_0x27bfbe[_0x2b3e2a][_0x422eae(0x1e0)]&&typeof _0x27bfbe[_0x2b3e2a]['data']==_0x422eae(0x1d3)&&_0x27bfbe[_0x2b3e2a][_0x422eae(0x1fa)]&&typeof _0x27bfbe[_0x2b3e2a][_0x422eae(0x1fa)]==_0x422eae(0x1d3)&&_0x27bfbe[_0x2b3e2a][_0x422eae(0x1fa)][_0x422eae(0x1fe)]()[_0x422eae(0x1f9)](_0x25fb98)!=-0x1&&(_0xd5d28e[_0x52a431]=_0x27bfbe[_0x2b3e2a][_0x422eae(0x1e0)]));}catch(_0x1c41ee){console['log'](_0x1c41ee);}}jsmediatags[_0x5cc98e(0x1c8)](_0x3bf199,{'onSuccess':function(_0x4d5bca){const _0x5c2481=_0x5cc98e;let _0x4c8f49=_0x4d5bca[_0x5c2481(0x1e2)];_0x46fa42(_0x4c8f49,'album','album',_0x5c2481(0x1d2),'album'),_0x46fa42(_0x4c8f49,'title',_0x5c2481(0x204),_0x5c2481(0x1f6),_0x5c2481(0x204)),_0x46fa42(_0x4c8f49,_0x5c2481(0x1e4),_0x5c2481(0x1e4),'TPE1','performer'),_0x46fa42(_0x4c8f49,'year',_0x5c2481(0x214),'TYER',_0x5c2481(0x214)),_0x46fa42(_0x4c8f49,'genre',_0x5c2481(0x1de),_0x5c2481(0x1d9),'content\x20type');try{_0x4c8f49[_0x5c2481(0x1ee)]&&(_0x4c8f49[_0x5c2481(0x1ee)]=JSON[_0x5c2481(0x20f)](_0x4c8f49[_0x5c2481(0x1ee)])),_0x46fa42(_0x4c8f49,'lyrics','lyrics','','');}catch(_0x575afa){console['log'](_0x575afa);}var _0x5f28c9;_0x4c8f49[_0x5c2481(0x1c9)]&&_0x4c8f49[_0x5c2481(0x1c9)][_0x5c2481(0x1e0)]&&(_0x5f28c9=_0x4c8f49[_0x5c2481(0x1c9)][_0x5c2481(0x1e0)]);!_0x5f28c9&&_0x4c8f49['APIC']&&_0x4c8f49[_0x5c2481(0x1f8)][_0x5c2481(0x1e0)]&&_0x4c8f49[_0x5c2481(0x1f8)][_0x5c2481(0x1e0)][_0x5c2481(0x1e0)]&&(_0x5f28c9=_0x4c8f49['APIC'][_0x5c2481(0x1e0)][_0x5c2481(0x1e0)]);let _0x1d7c95='';if(_0x5f28c9){let _0x3e5272=0x200;_0x1d7c95=config['getMediaCoverCachePath'](_0xd5d28e,_0x3e5272);let _0x2da5d1=path['join'](path[_0x5c2481(0x1ed)](_0x1d7c95),_0x5c2481(0x1d8)+path[_0x5c2481(0x215)](_0x1d7c95));fs['writeFile'](_0x2da5d1,Buffer[_0x5c2481(0x211)](_0x5f28c9),{'encoding':'base64'},function(_0x61e31b){const _0x58b1ff=_0x5c2481;_0x61e31b?console[_0x58b1ff(0x1da)](_0x61e31b):sharpUtil['genTinyFile'](_0x2da5d1,path['dirname'](_0x1d7c95),path[_0x58b1ff(0x215)](_0x1d7c95),'image',null,_0x5d0f40=>{_0xd5d28e['coverPath']=_0x1d7c95,fs['rm'](_0x2da5d1,_0x57e4de=>{}),_0x30670b(_0xd5d28e);},_0x55c1a6=>{_0x30670b(_0xd5d28e);},_0x3e5272);});}else _0x30670b(_0xd5d28e);},'onError':function(_0x3ec93c){const _0xa277e5=_0x5cc98e;console[_0xa277e5(0x1da)](_0x3ec93c),_0x30670b(_0xd5d28e);}});},module[_0x931fba(0x1e8)]=musicIndexUtil;function _0x56ad(){const _0x536484=['getTime','artist','album','transStringToUtf8','create','exports','Null','getMusicSameNameCover','getMonth','2095914WWlyxx','dirname','lyrics','exifMinTimeStamp','1LHocgw','Nan','duration','getDate','path','birthtime','TIT2','11NKBUsz','APIC','indexOf','description','addOriginalDate','getDurationFromStream','musicTypeList','toLowerCase','dealMediaInfo','61950IFtouw','atimeMs','14065944CiUMdC','stream_info','title','4274376iteMXI','ext','2164764fBXoLC','582716nYBdfV','ffprobeSync','../../utils/musicUtil','parseAudioTags','../../utils/videoStreamUtil','21LCUGPu','getFullYear','stringify','extname','from','original_date','format','year','basename','is_file','streams','lastInsertRowid','read','picture','18KIoKRR','recursionFilesAddIndex','addFinalIndexToDB','7rLmSls','556190uYlvHz','addFileIndexToDb','music','../../db/dbFileIndexTable','TALB','string','../../express-server/utils/sharpUtils','mtimeMs','ctimeMs','original_time','temp.','TYER','log','birthtimeMs','size','NaN','genre','INDEX_TABLE_NAME_MUSIC','data','type','tags'];_0x56ad=function(){return _0x536484;};return _0x56ad();}