const _0x473d52=_0x3f58;function _0x3f58(_0x44732c,_0x465358){const _0x32eb19=_0x32eb();return _0x3f58=function(_0x3f58e0,_0x4b5226){_0x3f58e0=_0x3f58e0-0x1dd;let _0x3e9f68=_0x32eb19[_0x3f58e0];return _0x3e9f68;},_0x3f58(_0x44732c,_0x465358);}(function(_0x410068,_0x2bfad8){const _0xda037f=_0x3f58,_0xc1f6d1=_0x410068();while(!![]){try{const _0xa270f2=-parseInt(_0xda037f(0x231))/0x1+-parseInt(_0xda037f(0x1de))/0x2*(-parseInt(_0xda037f(0x21a))/0x3)+-parseInt(_0xda037f(0x1e8))/0x4+parseInt(_0xda037f(0x218))/0x5+-parseInt(_0xda037f(0x1fa))/0x6+parseInt(_0xda037f(0x22d))/0x7+-parseInt(_0xda037f(0x222))/0x8*(-parseInt(_0xda037f(0x1f5))/0x9);if(_0xa270f2===_0x2bfad8)break;else _0xc1f6d1['push'](_0xc1f6d1['shift']());}catch(_0x166b90){_0xc1f6d1['push'](_0xc1f6d1['shift']());}}}(_0x32eb,0x5f434));const path=require('path'),fs=require('fs'),dbFileIndexTable=require('../../db/dbFileIndexTable'),config=require(_0x473d52(0x1ec)),videoStreamUtil=require(_0x473d52(0x210)),indexUtil=require(_0x473d52(0x204));let musicUtils=require(_0x473d52(0x217));const indexTableName=dbFileIndexTable[_0x473d52(0x20c)],musicIndexUtil={},sharpUtil=require(_0x473d52(0x1e4));function _0x32eb(){const _0x21ed29=['path','getMediaCoverCachePath','lyrics','2437792ReLsvm','original_date','performer','musicTypeList','../../myConfig/config','stream_info','artist','TYER','APIC','format','music','getById','join','1833885sPzHmC','atimeMs','toLowerCase','ext','dealFirstLetterSingle','1636338qDcvbE','description','log','string','jsmediatags','NaN','addFileIndexToDb','year','title','create','./indexUtil','content\x20type','basename','tags','getFullYear','genTinyFile','Nan','from','INDEX_TABLE_NAME_MUSIC','image','TPE1','dealMediaInfo','../../utils/videoStreamUtil','getDurationFromStream','genre','getDate','temp.','addOriginalDate','dealFileChange','../../utils/musicUtil','2603900ckRMbX','size','38751xLDufr','mtimeMs','Null','picture','TALB','stringify','addFinalIndexToDB','birthtimeMs','40zjraMK','data','ctime','original_time','birthtime','getMusicSameNameCover','TIT2','getTime','base64','coverPath','exifMinTimeStamp','516180HOviXB','is_file','ctimeMs','duration','780156meggGZ','includes','indexOf','extname','dirname','doesPathCanAddToDb','album','68bjAyBv','exports','parseAudioTags','recursionFilesAddIndex','streams','transStringToUtf8','../../express-server/utils/sharpUtils'];_0x32eb=function(){return _0x21ed29;};return _0x32eb();}let jsmediatags=require(_0x473d52(0x1fe)),musicTypeList=config[_0x473d52(0x1eb)];musicIndexUtil[_0x473d52(0x216)]=async function(_0x644c50,_0xe08cb3,_0xfdafc8){const _0xbeb0e3=_0x473d52;await indexUtil[_0xbeb0e3(0x216)](_0x644c50,_0xe08cb3,_0xfdafc8,indexTableName,musicIndexUtil[_0xbeb0e3(0x200)],musicIndexUtil[_0xbeb0e3(0x1e1)]);return;},musicIndexUtil[_0x473d52(0x1e1)]=async function(_0x7ae7cf,_0x339451,_0x58444f){const _0x317255=_0x473d52;return await indexUtil[_0x317255(0x1e1)](_0x7ae7cf,_0x339451,indexTableName,'music',_0x58444f,musicIndexUtil['addFileIndexToDb']);},musicIndexUtil['addFileIndexToDb']=async function(_0x49bafa,_0x1ab720,_0x313908,_0x19ca3f,_0x2ed2a4,_0xca7a00){const _0x5a0ffb=_0x473d52;let _0x308a74=indexUtil[_0x5a0ffb(0x236)](_0x49bafa,_0x5a0ffb(0x1f2),config,_0x313908,_0x19ca3f);if(!_0x308a74)return;let _0x4ecd45=_0xca7a00[_0x5a0ffb(0x221)];_0xca7a00[_0x5a0ffb(0x21b)]<_0x4ecd45&&(_0x4ecd45=_0xca7a00['mtimeMs']);_0xca7a00[_0x5a0ffb(0x1f6)]<_0x4ecd45&&(_0x4ecd45=_0xca7a00[_0x5a0ffb(0x1f6)]);_0xca7a00[_0x5a0ffb(0x22f)]<_0x4ecd45&&(_0x4ecd45=_0xca7a00[_0x5a0ffb(0x22f)]);let _0x101eba={'path':_0x313908,'filename':_0x19ca3f,'is_file':_0x2ed2a4,'ctime':_0xca7a00['ctimeMs'],'mtime':_0xca7a00[_0x5a0ffb(0x21b)],'ext':path[_0x5a0ffb(0x234)](_0x19ca3f),'birthtime':Math['ceil'](_0x4ecd45),'size':_0xca7a00[_0x5a0ffb(0x219)],'check_time':new Date()[_0x5a0ffb(0x229)]()};_0x101eba=await musicIndexUtil[_0x5a0ffb(0x20f)](_0x1ab720,_0x101eba);},musicIndexUtil['dealMediaInfo']=async function(_0x264b94,_0x24a9a2){const _0x300c11=_0x473d52;let _0x5e5790=![],_0x4231e7=path['join'](_0x24a9a2[_0x300c11(0x1e5)],_0x24a9a2['filename']);if(_0x24a9a2[_0x300c11(0x22e)]==0x1&&_0x24a9a2[_0x300c11(0x1f8)]&&musicTypeList[_0x300c11(0x232)](_0x24a9a2[_0x300c11(0x1f8)]['toLowerCase']())){_0x24a9a2['type']=0x3;try{let _0x3ccca0=await indexUtil['ffprobeSync'](_0x4231e7);if(_0x3ccca0&&_0x3ccca0[_0x300c11(0x1e2)]&&_0x3ccca0[_0x300c11(0x1e2)]['length']>0x0){_0x24a9a2[_0x300c11(0x1ed)]=JSON[_0x300c11(0x21f)](_0x3ccca0[_0x300c11(0x1e2)]);let _0x450575=videoStreamUtil[_0x300c11(0x211)](_0x3ccca0);_0x450575&&(_0x24a9a2[_0x300c11(0x230)]=_0x450575);}if(_0x3ccca0&&_0x3ccca0[_0x300c11(0x1f1)]&&_0x3ccca0[_0x300c11(0x1f1)][_0x300c11(0x207)]){let _0x28bcfa=_0x3ccca0[_0x300c11(0x1f1)][_0x300c11(0x207)]['album'];_0x28bcfa&&(_0x24a9a2['album']=_0x28bcfa),_0x3ccca0[_0x300c11(0x1f1)][_0x300c11(0x230)]&&!_0x24a9a2[_0x300c11(0x230)]&&(_0x24a9a2[_0x300c11(0x230)]=_0x3ccca0['format'][_0x300c11(0x230)]);}musicIndexUtil[_0x300c11(0x1e0)](_0x4231e7,_0x24a9a2,_0x18d3eb=>{const _0x35aee2=_0x300c11;return _0x18d3eb['album']&&(_0x18d3eb[_0x35aee2(0x1dd)]=musicUtils['transStringToUtf8'](_0x18d3eb[_0x35aee2(0x1dd)])),_0x18d3eb['artist']&&(_0x18d3eb['artist']=musicUtils[_0x35aee2(0x1e3)](_0x18d3eb[_0x35aee2(0x1ee)])),_0x18d3eb[_0x35aee2(0x202)]&&(_0x18d3eb[_0x35aee2(0x202)]=musicUtils[_0x35aee2(0x1e3)](_0x18d3eb['title'])),_0x18d3eb[_0x35aee2(0x1e7)]&&(_0x18d3eb[_0x35aee2(0x1e7)]=musicUtils[_0x35aee2(0x1e3)](_0x18d3eb[_0x35aee2(0x1e7)])),musicIndexUtil['addOriginalDate'](_0x264b94,_0x5e5790,_0x18d3eb);});}catch(_0x38708a){return console[_0x300c11(0x1fc)](_0x38708a),musicIndexUtil[_0x300c11(0x215)](_0x264b94,_0x5e5790,_0x24a9a2);}}else{if(_0x24a9a2[_0x300c11(0x22e)]==0x1)return;return musicIndexUtil[_0x300c11(0x215)](_0x264b94,_0x5e5790,_0x24a9a2);}},musicIndexUtil[_0x473d52(0x215)]=function(_0x4a20cc,_0x41cdfd,_0x167c6d){const _0x1afc8e=_0x473d52;_0x41cdfd&&_0x41cdfd<config[_0x1afc8e(0x22c)]&&(_0x41cdfd=![]);(!_0x41cdfd||_0x41cdfd==_0x1afc8e(0x1ff)||_0x41cdfd==_0x1afc8e(0x20a)||_0x41cdfd==_0x1afc8e(0x1ff)||_0x41cdfd==_0x1afc8e(0x21c))&&(_0x41cdfd=_0x167c6d[_0x1afc8e(0x226)]||_0x167c6d[_0x1afc8e(0x224)]);let _0x2a0235=new Date(_0x41cdfd);_0x167c6d[_0x1afc8e(0x225)]=_0x2a0235[_0x1afc8e(0x229)]();let _0x20d7b9=_0x2a0235[_0x1afc8e(0x208)](),_0x5a70c0=_0x2a0235['getMonth']()+0x1;_0x5a70c0=_0x5a70c0>=0xa?_0x5a70c0:'0'+_0x5a70c0;let _0x1df0f4=_0x2a0235[_0x1afc8e(0x213)]();_0x1df0f4=_0x1df0f4>=0xa?_0x1df0f4:'0'+_0x1df0f4,_0x167c6d[_0x1afc8e(0x1e9)]=_0x20d7b9+'-'+_0x5a70c0+'-'+_0x1df0f4,musicIndexUtil[_0x1afc8e(0x220)](_0x4a20cc,_0x167c6d);},musicIndexUtil['addFinalIndexToDB']=function(_0x188a55,_0x5cea87){const _0x3e7969=_0x473d52;!_0x5cea87[_0x3e7969(0x1dd)]&&(_0x5cea87[_0x3e7969(0x1dd)]=path[_0x3e7969(0x206)](_0x5cea87[_0x3e7969(0x1e5)]));let _0x5d5686=musicUtils[_0x3e7969(0x227)](_0x188a55,_0x5cea87);_0x5cea87['fileCoverPath']=_0x5d5686?_0x5d5686:'';let _0x1f7268=dbFileIndexTable[_0x3e7969(0x203)](_0x188a55,_0x5cea87,indexTableName);if(_0x1f7268&&_0x1f7268['lastInsertRowid']){let _0x73a2f2=dbFileIndexTable[_0x3e7969(0x1f3)](_0x188a55,_0x1f7268['lastInsertRowid'],dbFileIndexTable[_0x3e7969(0x20c)]);_0x73a2f2&&musicUtils[_0x3e7969(0x1f9)](_0x188a55,_0x73a2f2);}},musicIndexUtil[_0x473d52(0x1e0)]=function(_0x3c8ba5,_0x422a6,_0x2cebfe){function _0x6e802c(_0x5cfa0b,_0x155e3e,_0x10518d,_0x698081,_0x1fa9fe){const _0x3821c2=_0x3f58;try{!_0x422a6[_0x155e3e]&&(_0x5cfa0b[_0x10518d]&&typeof _0x5cfa0b[_0x10518d]==_0x3821c2(0x1fd)&&(_0x422a6[_0x10518d]=_0x5cfa0b[_0x10518d]),!_0x422a6[_0x155e3e]&&_0x698081&&_0x5cfa0b[_0x698081]&&_0x5cfa0b[_0x698081][_0x3821c2(0x223)]&&typeof _0x5cfa0b[_0x698081][_0x3821c2(0x223)]==_0x3821c2(0x1fd)&&_0x5cfa0b[_0x698081][_0x3821c2(0x1fb)]&&typeof _0x5cfa0b[_0x698081][_0x3821c2(0x1fb)]=='string'&&_0x5cfa0b[_0x698081][_0x3821c2(0x1fb)][_0x3821c2(0x1f7)]()[_0x3821c2(0x233)](_0x1fa9fe)!=-0x1&&(_0x422a6[_0x155e3e]=_0x5cfa0b[_0x698081][_0x3821c2(0x223)]));}catch(_0x2ce084){console[_0x3821c2(0x1fc)](_0x2ce084);}}jsmediatags['read'](_0x3c8ba5,{'onSuccess':function(_0x27e3ba){const _0x382d0c=_0x3f58;let _0x403968=_0x27e3ba[_0x382d0c(0x207)];_0x6e802c(_0x403968,_0x382d0c(0x1dd),_0x382d0c(0x1dd),_0x382d0c(0x21e),_0x382d0c(0x1dd)),_0x6e802c(_0x403968,_0x382d0c(0x202),_0x382d0c(0x202),_0x382d0c(0x228),'title'),_0x6e802c(_0x403968,_0x382d0c(0x1ee),_0x382d0c(0x1ee),_0x382d0c(0x20e),_0x382d0c(0x1ea)),_0x6e802c(_0x403968,_0x382d0c(0x201),_0x382d0c(0x201),_0x382d0c(0x1ef),_0x382d0c(0x201)),_0x6e802c(_0x403968,_0x382d0c(0x212),_0x382d0c(0x212),_0x382d0c(0x1ef),_0x382d0c(0x205));try{_0x403968[_0x382d0c(0x1e7)]&&(_0x403968[_0x382d0c(0x1e7)]=JSON[_0x382d0c(0x21f)](_0x403968[_0x382d0c(0x1e7)])),_0x6e802c(_0x403968,_0x382d0c(0x1e7),_0x382d0c(0x1e7),'','');}catch(_0x57eda3){console[_0x382d0c(0x1fc)](_0x57eda3);}var _0x5a2ecb;_0x403968[_0x382d0c(0x21d)]&&_0x403968[_0x382d0c(0x21d)][_0x382d0c(0x223)]&&(_0x5a2ecb=_0x403968[_0x382d0c(0x21d)][_0x382d0c(0x223)]);!_0x5a2ecb&&_0x403968['APIC']&&_0x403968[_0x382d0c(0x1f0)][_0x382d0c(0x223)]&&_0x403968[_0x382d0c(0x1f0)][_0x382d0c(0x223)][_0x382d0c(0x223)]&&(_0x5a2ecb=_0x403968[_0x382d0c(0x1f0)]['data'][_0x382d0c(0x223)]);let _0x44db0a='';if(_0x5a2ecb){let _0x521926=0x200;_0x44db0a=config[_0x382d0c(0x1e6)](_0x422a6,_0x521926);let _0x4d391b=path[_0x382d0c(0x1f4)](path[_0x382d0c(0x235)](_0x44db0a),_0x382d0c(0x214)+path[_0x382d0c(0x206)](_0x44db0a));fs['writeFile'](_0x4d391b,Buffer[_0x382d0c(0x20b)](_0x5a2ecb),{'encoding':_0x382d0c(0x22a)},function(_0x21c3c9){const _0xb3ee28=_0x382d0c;_0x21c3c9?console[_0xb3ee28(0x1fc)](_0x21c3c9):sharpUtil[_0xb3ee28(0x209)](_0x4d391b,path[_0xb3ee28(0x235)](_0x44db0a),path[_0xb3ee28(0x206)](_0x44db0a),_0xb3ee28(0x20d),null,_0x4eaa6b=>{const _0x1be381=_0xb3ee28;_0x422a6[_0x1be381(0x22b)]=_0x44db0a,fs['rm'](_0x4d391b,_0x5dd73c=>{}),_0x2cebfe(_0x422a6);},_0x4fa00b=>{_0x2cebfe(_0x422a6);},_0x521926);});}else _0x2cebfe(_0x422a6);},'onError':function(_0x2c3e4c){const _0x3ce1ca=_0x3f58;console[_0x3ce1ca(0x1fc)](_0x2c3e4c),_0x2cebfe(_0x422a6);}});},module[_0x473d52(0x1df)]=musicIndexUtil;