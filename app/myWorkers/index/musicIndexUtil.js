const _0x323539=_0x2544;function _0x4749(){const _0x4e77c4=['fileCoverPath','artist','base64','62184mSxWka','dealMediaInfo','15480cuxOHa','9678376gQcNaU','writeFile','../../utils/musicUtil','10EDGUEO','TPE1','ceil','INDEX_TABLE_NAME_MUSIC','getDurationFromStream','create','lyrics','addFileIndexToDb','../../myConfig/config','length','TALB','transStringToUtf8','duration','is_file','stringify','data','getTime','2130JZQHZc','dealFileChange','album','picture','parseAudioTags','Null','getDate','stream_info','jsmediatags','8756343FdsUko','APIC','TYER','mtimeMs','streams','from','lastInsertRowid','NaN','addFinalIndexToDB','format','birthtime','basename','size','ext','type','log','title','year','atimeMs','original_time','ffprobeSync','birthtimeMs','temp.','Nan','genre','musicTypeList','original_date','getMediaCoverCachePath','music','tags','1288276JmVlXx','string','coverPath','getFullYear','../../db/dbFileIndexTable','doesPathCanAddToDb','../../express-server/utils/sharpUtils','ctimeMs','recursionFilesAddIndex','join','performer','path','image','addOriginalDate','extname','27IqFvfD','getMusicSameNameCover','2298702tZzQce','dealFirstLetterSingle','description','TIT2','dirname','3241224OQfhZp','toLowerCase'];_0x4749=function(){return _0x4e77c4;};return _0x4749();}(function(_0x3a77e2,_0x1336dd){const _0x49a5d3=_0x2544,_0x5da158=_0x3a77e2();while(!![]){try{const _0x33e32b=parseInt(_0x49a5d3(0x94))/0x1*(-parseInt(_0x49a5d3(0xa0))/0x2)+parseInt(_0x49a5d3(0x9b))/0x3+-parseInt(_0x49a5d3(0x85))/0x4+parseInt(_0x49a5d3(0xb7))/0x5*(-parseInt(_0x49a5d3(0xa2))/0x6)+-parseInt(_0x49a5d3(0x96))/0x7+parseInt(_0x49a5d3(0xa3))/0x8+-parseInt(_0x49a5d3(0xc0))/0x9*(-parseInt(_0x49a5d3(0xa6))/0xa);if(_0x33e32b===_0x1336dd)break;else _0x5da158['push'](_0x5da158['shift']());}catch(_0x2d47d9){_0x5da158['push'](_0x5da158['shift']());}}}(_0x4749,0xa4941));const path=require(_0x323539(0x90)),fs=require('fs'),dbFileIndexTable=require(_0x323539(0x89)),config=require(_0x323539(0xae)),videoStreamUtil=require('../../utils/videoStreamUtil'),indexUtil=require('./indexUtil');let musicUtils=require(_0x323539(0xa5));const indexTableName=dbFileIndexTable[_0x323539(0xa9)],musicIndexUtil={},sharpUtil=require(_0x323539(0x8b));let jsmediatags=require(_0x323539(0xbf)),musicTypeList=config[_0x323539(0x80)];function _0x2544(_0x1fc690,_0x510c0d){const _0x47493d=_0x4749();return _0x2544=function(_0x254446,_0x40de10){_0x254446=_0x254446-0x7a;let _0x5cb000=_0x47493d[_0x254446];return _0x5cb000;},_0x2544(_0x1fc690,_0x510c0d);}musicIndexUtil[_0x323539(0xb8)]=async function(_0x136b87,_0xf53409,_0x445db0){const _0x45fa7f=_0x323539;await indexUtil['dealFileChange'](_0x136b87,_0xf53409,_0x445db0,indexTableName,musicIndexUtil['addFileIndexToDb'],musicIndexUtil[_0x45fa7f(0x8d)]);return;},musicIndexUtil[_0x323539(0x8d)]=async function(_0x30ce80,_0x3050c8,_0x47114a){const _0x76b0c3=_0x323539;return await indexUtil[_0x76b0c3(0x8d)](_0x30ce80,_0x3050c8,indexTableName,_0x76b0c3(0x83),_0x47114a,musicIndexUtil[_0x76b0c3(0xad)]);},musicIndexUtil[_0x323539(0xad)]=async function(_0x34cb85,_0x1c805b,_0x267503,_0x40cffe,_0x4a2c4e,_0x47ada2){const _0x174ad1=_0x323539;let _0x9df709=indexUtil[_0x174ad1(0x8a)](_0x34cb85,'music',config,_0x267503,_0x40cffe);if(!_0x9df709)return;let _0x28806a=_0x47ada2[_0x174ad1(0x7c)];_0x47ada2[_0x174ad1(0xc3)]<_0x28806a&&(_0x28806a=_0x47ada2[_0x174ad1(0xc3)]);_0x47ada2[_0x174ad1(0xd2)]<_0x28806a&&(_0x28806a=_0x47ada2[_0x174ad1(0xd2)]);_0x47ada2[_0x174ad1(0x8c)]<_0x28806a&&(_0x28806a=_0x47ada2['ctimeMs']);let _0x462019={'path':_0x267503,'filename':_0x40cffe,'is_file':_0x4a2c4e,'ctime':_0x47ada2[_0x174ad1(0x8c)],'mtime':_0x47ada2['mtimeMs'],'ext':path[_0x174ad1(0x93)](_0x40cffe),'birthtime':Math[_0x174ad1(0xa8)](_0x28806a),'size':_0x47ada2[_0x174ad1(0xcc)],'check_time':new Date()[_0x174ad1(0xb6)]()};_0x462019=await musicIndexUtil[_0x174ad1(0xa1)](_0x1c805b,_0x462019);},musicIndexUtil[_0x323539(0xa1)]=async function(_0x9bfd80,_0x5ba508){const _0x136a66=_0x323539;let _0x167fc6=![],_0x111df5=path[_0x136a66(0x8e)](_0x5ba508['path'],_0x5ba508['filename']);if(_0x5ba508[_0x136a66(0xb3)]==0x1&&_0x5ba508['ext']&&musicTypeList['includes'](_0x5ba508[_0x136a66(0xcd)][_0x136a66(0x9c)]())){_0x5ba508[_0x136a66(0xce)]=0x3;try{let _0x3ce1d2=await indexUtil[_0x136a66(0x7b)](_0x111df5);if(_0x3ce1d2&&_0x3ce1d2[_0x136a66(0xc4)]&&_0x3ce1d2[_0x136a66(0xc4)][_0x136a66(0xaf)]>0x0){_0x5ba508[_0x136a66(0xbe)]=JSON[_0x136a66(0xb4)](_0x3ce1d2[_0x136a66(0xc4)]);let _0x165a67=videoStreamUtil[_0x136a66(0xaa)](_0x3ce1d2);_0x165a67&&(_0x5ba508[_0x136a66(0xb2)]=_0x165a67);}if(_0x3ce1d2&&_0x3ce1d2[_0x136a66(0xc9)]&&_0x3ce1d2[_0x136a66(0xc9)]['tags']){let _0x1760a7=_0x3ce1d2[_0x136a66(0xc9)][_0x136a66(0x84)][_0x136a66(0xb9)];_0x1760a7&&(_0x5ba508['album']=_0x1760a7),_0x3ce1d2['format'][_0x136a66(0xb2)]&&!_0x5ba508[_0x136a66(0xb2)]&&(_0x5ba508[_0x136a66(0xb2)]=_0x3ce1d2[_0x136a66(0xc9)]['duration']);}musicIndexUtil[_0x136a66(0xbb)](_0x111df5,_0x5ba508,_0x4421b3=>{const _0x5da1e0=_0x136a66;return _0x4421b3[_0x5da1e0(0xb9)]&&(_0x4421b3[_0x5da1e0(0xb9)]=musicUtils[_0x5da1e0(0xb1)](_0x4421b3[_0x5da1e0(0xb9)])),_0x4421b3['artist']&&(_0x4421b3['artist']=musicUtils[_0x5da1e0(0xb1)](_0x4421b3['artist'])),_0x4421b3[_0x5da1e0(0xd0)]&&(_0x4421b3[_0x5da1e0(0xd0)]=musicUtils[_0x5da1e0(0xb1)](_0x4421b3['title'])),_0x4421b3[_0x5da1e0(0xac)]&&(_0x4421b3[_0x5da1e0(0xac)]=musicUtils[_0x5da1e0(0xb1)](_0x4421b3[_0x5da1e0(0xac)])),musicIndexUtil[_0x5da1e0(0x92)](_0x9bfd80,_0x167fc6,_0x4421b3);});}catch(_0x2d142e){return console[_0x136a66(0xcf)](_0x2d142e),musicIndexUtil[_0x136a66(0x92)](_0x9bfd80,_0x167fc6,_0x5ba508);}}else{if(_0x5ba508[_0x136a66(0xb3)]==0x1)return;return musicIndexUtil[_0x136a66(0x92)](_0x9bfd80,_0x167fc6,_0x5ba508);}},musicIndexUtil[_0x323539(0x92)]=function(_0x22f29c,_0x5a6523,_0x45d6e1){const _0x1c2ac6=_0x323539;_0x5a6523&&_0x5a6523<config['exifMinTimeStamp']&&(_0x5a6523=![]);(!_0x5a6523||_0x5a6523==_0x1c2ac6(0xc7)||_0x5a6523==_0x1c2ac6(0x7e)||_0x5a6523==_0x1c2ac6(0xc7)||_0x5a6523==_0x1c2ac6(0xbc))&&(_0x5a6523=_0x45d6e1[_0x1c2ac6(0xca)]||_0x45d6e1['ctime']);let _0x394832=new Date(_0x5a6523);_0x45d6e1[_0x1c2ac6(0x7a)]=_0x394832[_0x1c2ac6(0xb6)]();let _0x194207=_0x394832[_0x1c2ac6(0x88)](),_0x32d527=_0x394832['getMonth']()+0x1;_0x32d527=_0x32d527>=0xa?_0x32d527:'0'+_0x32d527;let _0x2def11=_0x394832[_0x1c2ac6(0xbd)]();_0x2def11=_0x2def11>=0xa?_0x2def11:'0'+_0x2def11,_0x45d6e1[_0x1c2ac6(0x81)]=_0x194207+'-'+_0x32d527+'-'+_0x2def11,musicIndexUtil[_0x1c2ac6(0xc8)](_0x22f29c,_0x45d6e1);},musicIndexUtil['addFinalIndexToDB']=function(_0x207c85,_0x1fc059){const _0x12b861=_0x323539;!_0x1fc059[_0x12b861(0xb9)]&&(_0x1fc059['album']=path[_0x12b861(0xcb)](_0x1fc059['path']));let _0x5b3123=musicUtils[_0x12b861(0x95)](_0x207c85,_0x1fc059);_0x1fc059[_0x12b861(0x9d)]=_0x5b3123?_0x5b3123:'';let _0x5d219a=dbFileIndexTable[_0x12b861(0xab)](_0x207c85,_0x1fc059,indexTableName);if(_0x5d219a&&_0x5d219a[_0x12b861(0xc6)]){let _0x368fa4=dbFileIndexTable['getById'](_0x207c85,_0x5d219a['lastInsertRowid'],dbFileIndexTable[_0x12b861(0xa9)]);_0x368fa4&&musicUtils[_0x12b861(0x97)](_0x207c85,_0x368fa4);}},musicIndexUtil[_0x323539(0xbb)]=function(_0x47864b,_0x19ebf2,_0x4026e7){function _0xa184b9(_0x3119c6,_0x149d28,_0x4679eb,_0x14aa34,_0x5d5e0c){const _0x4338a4=_0x2544;try{!_0x19ebf2[_0x149d28]&&(_0x3119c6[_0x4679eb]&&typeof _0x3119c6[_0x4679eb]==_0x4338a4(0x86)&&(_0x19ebf2[_0x4679eb]=_0x3119c6[_0x4679eb]),!_0x19ebf2[_0x149d28]&&_0x14aa34&&_0x3119c6[_0x14aa34]&&_0x3119c6[_0x14aa34][_0x4338a4(0xb5)]&&typeof _0x3119c6[_0x14aa34]['data']==_0x4338a4(0x86)&&_0x3119c6[_0x14aa34][_0x4338a4(0x98)]&&typeof _0x3119c6[_0x14aa34][_0x4338a4(0x98)]==_0x4338a4(0x86)&&_0x3119c6[_0x14aa34][_0x4338a4(0x98)][_0x4338a4(0x9c)]()['indexOf'](_0x5d5e0c)!=-0x1&&(_0x19ebf2[_0x149d28]=_0x3119c6[_0x14aa34][_0x4338a4(0xb5)]));}catch(_0x513867){console['log'](_0x513867);}}jsmediatags['read'](_0x47864b,{'onSuccess':function(_0x1d575f){const _0x540197=_0x2544;let _0x47ab9c=_0x1d575f[_0x540197(0x84)];_0xa184b9(_0x47ab9c,_0x540197(0xb9),'album',_0x540197(0xb0),_0x540197(0xb9)),_0xa184b9(_0x47ab9c,'title','title',_0x540197(0x99),_0x540197(0xd0)),_0xa184b9(_0x47ab9c,_0x540197(0x9e),_0x540197(0x9e),_0x540197(0xa7),_0x540197(0x8f)),_0xa184b9(_0x47ab9c,_0x540197(0xd1),_0x540197(0xd1),_0x540197(0xc2),'year'),_0xa184b9(_0x47ab9c,_0x540197(0x7f),_0x540197(0x7f),_0x540197(0xc2),'content\x20type');try{_0x47ab9c[_0x540197(0xac)]&&(_0x47ab9c[_0x540197(0xac)]=JSON[_0x540197(0xb4)](_0x47ab9c[_0x540197(0xac)])),_0xa184b9(_0x47ab9c,_0x540197(0xac),_0x540197(0xac),'','');}catch(_0x5ba37f){console[_0x540197(0xcf)](_0x5ba37f);}var _0x3a09e5;_0x47ab9c['picture']&&_0x47ab9c[_0x540197(0xba)]['data']&&(_0x3a09e5=_0x47ab9c[_0x540197(0xba)][_0x540197(0xb5)]);!_0x3a09e5&&_0x47ab9c[_0x540197(0xc1)]&&_0x47ab9c[_0x540197(0xc1)][_0x540197(0xb5)]&&_0x47ab9c[_0x540197(0xc1)][_0x540197(0xb5)]['data']&&(_0x3a09e5=_0x47ab9c[_0x540197(0xc1)][_0x540197(0xb5)]['data']);let _0x43b2b8='';if(_0x3a09e5){let _0x2eecd6=0x200;_0x43b2b8=config[_0x540197(0x82)](_0x19ebf2,_0x2eecd6);let _0x37489e=path['join'](path[_0x540197(0x9a)](_0x43b2b8),_0x540197(0x7d)+path[_0x540197(0xcb)](_0x43b2b8));fs[_0x540197(0xa4)](_0x37489e,Buffer[_0x540197(0xc5)](_0x3a09e5),{'encoding':_0x540197(0x9f)},function(_0x5287f4){const _0x23a560=_0x540197;_0x5287f4?console[_0x23a560(0xcf)](_0x5287f4):sharpUtil['genTinyFile'](_0x37489e,path[_0x23a560(0x9a)](_0x43b2b8),path[_0x23a560(0xcb)](_0x43b2b8),_0x23a560(0x91),null,_0x195cf7=>{const _0x4d065f=_0x23a560;_0x19ebf2[_0x4d065f(0x87)]=_0x43b2b8,fs['rm'](_0x37489e,_0x2cd348=>{}),_0x4026e7(_0x19ebf2);},_0x4f79f8=>{_0x4026e7(_0x19ebf2);},_0x2eecd6);});}else _0x4026e7(_0x19ebf2);},'onError':function(_0x2fa9db){const _0x4a6b02=_0x2544;console[_0x4a6b02(0xcf)](_0x2fa9db),_0x4026e7(_0x19ebf2);}});},module['exports']=musicIndexUtil;