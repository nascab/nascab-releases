const _0x345edd=_0x5788;(function(_0x4f09a4,_0x31916b){const _0x376f97=_0x5788,_0x2a2d70=_0x4f09a4();while(!![]){try{const _0x1354f8=-parseInt(_0x376f97(0x13d))/0x1+-parseInt(_0x376f97(0x122))/0x2*(-parseInt(_0x376f97(0x137))/0x3)+parseInt(_0x376f97(0x15d))/0x4*(parseInt(_0x376f97(0x13b))/0x5)+-parseInt(_0x376f97(0x151))/0x6*(parseInt(_0x376f97(0x11f))/0x7)+parseInt(_0x376f97(0x140))/0x8+-parseInt(_0x376f97(0x139))/0x9+parseInt(_0x376f97(0x168))/0xa*(parseInt(_0x376f97(0x158))/0xb);if(_0x1354f8===_0x31916b)break;else _0x2a2d70['push'](_0x2a2d70['shift']());}catch(_0x17cffd){_0x2a2d70['push'](_0x2a2d70['shift']());}}}(_0x519c,0x32e1d));const path=require('path'),fs=require('fs'),dbFileIndexTable=require(_0x345edd(0x12f)),config=require(_0x345edd(0x126)),videoStreamUtil=require(_0x345edd(0x142)),indexUtil=require(_0x345edd(0x120));function _0x5788(_0x15b054,_0x44f865){const _0x519c3b=_0x519c();return _0x5788=function(_0x5788ec,_0x204570){_0x5788ec=_0x5788ec-0x11a;let _0x386f0a=_0x519c3b[_0x5788ec];return _0x386f0a;},_0x5788(_0x15b054,_0x44f865);}let musicUtils=require(_0x345edd(0x141));const indexTableName=dbFileIndexTable[_0x345edd(0x152)],musicIndexUtil={},sharpUtil=require('../../express-server/utils/sharpUtils');function _0x519c(){const _0xc7062=['ext','toLowerCase','TYER','includes','from','format','album','music','addOriginalDate','base64','20bvLMHq','fileCoverPath','getDate','genre','artist','data','Nan','NaN','duration','birthtime','lastInsertRowid','path','genTinyFile','create','content\x20type','transStringToUtf8','addFinalIndexToDB','21iaeYCM','./indexUtil','image','41890NSYUdL','title','performer','exports','../../myConfig/config','recursionFilesAddIndex','getDurationFromStream','mtimeMs','coverPath','stringify','description','year','ceil','../../db/dbFileIndexTable','parseAudioTags','tags','jsmediatags','atimeMs','indexOf','stream_info','TIT2','3igQHPT','join','2768202vxGXmT','birthtimeMs','2049765WldPbh','APIC','312858nkLhkB','dirname','getTime','1542040rTxVGT','../../utils/musicUtil','../../utils/videoStreamUtil','dealMediaInfo','filename','getMusicSameNameCover','size','temp.','addFileIndexToDb','TPE1','string','getMediaCoverCachePath','extname','ffprobeSync','ctimeMs','lyrics','doesPathCanAddToDb','353244cVZPOA','INDEX_TABLE_NAME_MUSIC','log','is_file','ctime','length','Null','2099999bEhHkh','picture','basename','getFullYear','streams','4iARVgW'];_0x519c=function(){return _0xc7062;};return _0x519c();}let jsmediatags=require(_0x345edd(0x132)),musicTypeList=config['musicTypeList'];musicIndexUtil['dealFileChange']=async function(_0x56b793,_0x2f93c9,_0x4e7e1a){const _0x51dd35=_0x345edd;await indexUtil['dealFileChange'](_0x56b793,_0x2f93c9,_0x4e7e1a,indexTableName,musicIndexUtil[_0x51dd35(0x148)],musicIndexUtil[_0x51dd35(0x127)]);return;},musicIndexUtil[_0x345edd(0x127)]=async function(_0x13b1b1,_0x43df43,_0xb47a2e){const _0x20ea93=_0x345edd;return await indexUtil[_0x20ea93(0x127)](_0x13b1b1,_0x43df43,indexTableName,'music',_0xb47a2e,musicIndexUtil[_0x20ea93(0x148)]);},musicIndexUtil[_0x345edd(0x148)]=async function(_0x491803,_0x4b7df2,_0x4184f3,_0x4674d5,_0x2e3660,_0x33c372){const _0x46ce0d=_0x345edd;let _0x49907c=indexUtil[_0x46ce0d(0x150)](_0x491803,_0x46ce0d(0x165),config,_0x4184f3,_0x4674d5);if(!_0x49907c)return;let _0x466b13=_0x33c372[_0x46ce0d(0x13a)];_0x33c372[_0x46ce0d(0x129)]<_0x466b13&&(_0x466b13=_0x33c372[_0x46ce0d(0x129)]);_0x33c372[_0x46ce0d(0x133)]<_0x466b13&&(_0x466b13=_0x33c372[_0x46ce0d(0x133)]);_0x33c372[_0x46ce0d(0x14e)]<_0x466b13&&(_0x466b13=_0x33c372[_0x46ce0d(0x14e)]);let _0x5dfe4e={'path':_0x4184f3,'filename':_0x4674d5,'is_file':_0x2e3660,'ctime':_0x33c372['ctimeMs'],'mtime':_0x33c372[_0x46ce0d(0x129)],'ext':path[_0x46ce0d(0x14c)](_0x4674d5),'birthtime':Math[_0x46ce0d(0x12e)](_0x466b13),'size':_0x33c372[_0x46ce0d(0x146)],'check_time':new Date()[_0x46ce0d(0x13f)]()};_0x5dfe4e=await musicIndexUtil[_0x46ce0d(0x143)](_0x4b7df2,_0x5dfe4e);},musicIndexUtil['dealMediaInfo']=async function(_0x2b3014,_0x28d3ba){const _0xbc477b=_0x345edd;let _0x1e47ca=![],_0x2c16aa=path['join'](_0x28d3ba[_0xbc477b(0x173)],_0x28d3ba[_0xbc477b(0x144)]);if(_0x28d3ba['is_file']==0x1&&_0x28d3ba[_0xbc477b(0x15e)]&&musicTypeList[_0xbc477b(0x161)](_0x28d3ba[_0xbc477b(0x15e)][_0xbc477b(0x15f)]())){_0x28d3ba['type']=0x3;try{let _0x458dff=await indexUtil[_0xbc477b(0x14d)](_0x2c16aa);if(_0x458dff&&_0x458dff[_0xbc477b(0x15c)]&&_0x458dff[_0xbc477b(0x15c)][_0xbc477b(0x156)]>0x0){_0x28d3ba[_0xbc477b(0x135)]=JSON[_0xbc477b(0x12b)](_0x458dff[_0xbc477b(0x15c)]);let _0x1388a7=videoStreamUtil[_0xbc477b(0x128)](_0x458dff);_0x1388a7&&(_0x28d3ba[_0xbc477b(0x170)]=_0x1388a7);}if(_0x458dff&&_0x458dff[_0xbc477b(0x163)]&&_0x458dff[_0xbc477b(0x163)][_0xbc477b(0x131)]){let _0x1da072=_0x458dff[_0xbc477b(0x163)]['tags'][_0xbc477b(0x164)];_0x1da072&&(_0x28d3ba[_0xbc477b(0x164)]=_0x1da072),_0x458dff['format'][_0xbc477b(0x170)]&&!_0x28d3ba['duration']&&(_0x28d3ba[_0xbc477b(0x170)]=_0x458dff[_0xbc477b(0x163)][_0xbc477b(0x170)]);}musicIndexUtil[_0xbc477b(0x130)](_0x2c16aa,_0x28d3ba,_0x16bf98=>{const _0x526dbb=_0xbc477b;return _0x16bf98[_0x526dbb(0x164)]&&(_0x16bf98['album']=musicUtils[_0x526dbb(0x11d)](_0x16bf98['album'])),_0x16bf98[_0x526dbb(0x16c)]&&(_0x16bf98[_0x526dbb(0x16c)]=musicUtils['transStringToUtf8'](_0x16bf98['artist'])),_0x16bf98[_0x526dbb(0x123)]&&(_0x16bf98['title']=musicUtils[_0x526dbb(0x11d)](_0x16bf98[_0x526dbb(0x123)])),_0x16bf98[_0x526dbb(0x14f)]&&(_0x16bf98[_0x526dbb(0x14f)]=musicUtils[_0x526dbb(0x11d)](_0x16bf98[_0x526dbb(0x14f)])),musicIndexUtil[_0x526dbb(0x166)](_0x2b3014,_0x1e47ca,_0x16bf98);});}catch(_0x3b6360){return console[_0xbc477b(0x153)](_0x3b6360),musicIndexUtil[_0xbc477b(0x166)](_0x2b3014,_0x1e47ca,_0x28d3ba);}}else{if(_0x28d3ba[_0xbc477b(0x154)]==0x1)return;return musicIndexUtil['addOriginalDate'](_0x2b3014,_0x1e47ca,_0x28d3ba);}},musicIndexUtil[_0x345edd(0x166)]=function(_0x21de6e,_0x1bc56a,_0x2fe25f){const _0x22e19a=_0x345edd;_0x1bc56a&&_0x1bc56a<config['exifMinTimeStamp']&&(_0x1bc56a=![]);(!_0x1bc56a||_0x1bc56a==_0x22e19a(0x16f)||_0x1bc56a==_0x22e19a(0x16e)||_0x1bc56a=='NaN'||_0x1bc56a==_0x22e19a(0x157))&&(_0x1bc56a=_0x2fe25f[_0x22e19a(0x171)]||_0x2fe25f[_0x22e19a(0x155)]);let _0xb1c566=new Date(_0x1bc56a);_0x2fe25f['original_time']=_0xb1c566['getTime']();let _0x17056d=_0xb1c566[_0x22e19a(0x15b)](),_0x176aad=_0xb1c566['getMonth']()+0x1;_0x176aad=_0x176aad>=0xa?_0x176aad:'0'+_0x176aad;let _0xd82c49=_0xb1c566[_0x22e19a(0x16a)]();_0xd82c49=_0xd82c49>=0xa?_0xd82c49:'0'+_0xd82c49,_0x2fe25f['original_date']=_0x17056d+'-'+_0x176aad+'-'+_0xd82c49,musicIndexUtil[_0x22e19a(0x11e)](_0x21de6e,_0x2fe25f);},musicIndexUtil[_0x345edd(0x11e)]=function(_0x4023ab,_0x329e74){const _0x3dd5bb=_0x345edd;!_0x329e74['album']&&(_0x329e74[_0x3dd5bb(0x164)]=path[_0x3dd5bb(0x15a)](_0x329e74[_0x3dd5bb(0x173)]));let _0x2c680c=musicUtils[_0x3dd5bb(0x145)](_0x4023ab,_0x329e74);_0x329e74[_0x3dd5bb(0x169)]=_0x2c680c?_0x2c680c:'';let _0x423623=dbFileIndexTable[_0x3dd5bb(0x11b)](_0x4023ab,_0x329e74,indexTableName);if(_0x423623&&_0x423623[_0x3dd5bb(0x172)]){let _0x1fce59=dbFileIndexTable['getById'](_0x4023ab,_0x423623[_0x3dd5bb(0x172)],dbFileIndexTable[_0x3dd5bb(0x152)]);_0x1fce59&&musicUtils['dealFirstLetterSingle'](_0x4023ab,_0x1fce59);}},musicIndexUtil[_0x345edd(0x130)]=function(_0x47b329,_0x4a927f,_0x6fddfe){function _0x259c93(_0x1353db,_0x4036e,_0x123ae0,_0x1cac41,_0x5f94a){const _0x2d485f=_0x5788;try{!_0x4a927f[_0x4036e]&&(_0x1353db[_0x123ae0]&&typeof _0x1353db[_0x123ae0]==_0x2d485f(0x14a)&&(_0x4a927f[_0x123ae0]=_0x1353db[_0x123ae0]),!_0x4a927f[_0x4036e]&&_0x1cac41&&_0x1353db[_0x1cac41]&&_0x1353db[_0x1cac41][_0x2d485f(0x16d)]&&typeof _0x1353db[_0x1cac41]['data']==_0x2d485f(0x14a)&&_0x1353db[_0x1cac41][_0x2d485f(0x12c)]&&typeof _0x1353db[_0x1cac41]['description']==_0x2d485f(0x14a)&&_0x1353db[_0x1cac41][_0x2d485f(0x12c)][_0x2d485f(0x15f)]()[_0x2d485f(0x134)](_0x5f94a)!=-0x1&&(_0x4a927f[_0x4036e]=_0x1353db[_0x1cac41][_0x2d485f(0x16d)]));}catch(_0xc307cb){console[_0x2d485f(0x153)](_0xc307cb);}}jsmediatags['read'](_0x47b329,{'onSuccess':function(_0xf7ae11){const _0x22a21d=_0x5788;let _0x2bf9dd=_0xf7ae11[_0x22a21d(0x131)];_0x259c93(_0x2bf9dd,_0x22a21d(0x164),_0x22a21d(0x164),'TALB','album'),_0x259c93(_0x2bf9dd,_0x22a21d(0x123),_0x22a21d(0x123),_0x22a21d(0x136),_0x22a21d(0x123)),_0x259c93(_0x2bf9dd,_0x22a21d(0x16c),_0x22a21d(0x16c),_0x22a21d(0x149),_0x22a21d(0x124)),_0x259c93(_0x2bf9dd,'year','year',_0x22a21d(0x160),_0x22a21d(0x12d)),_0x259c93(_0x2bf9dd,_0x22a21d(0x16b),_0x22a21d(0x16b),_0x22a21d(0x160),_0x22a21d(0x11c));try{_0x2bf9dd['lyrics']&&(_0x2bf9dd[_0x22a21d(0x14f)]=JSON[_0x22a21d(0x12b)](_0x2bf9dd['lyrics'])),_0x259c93(_0x2bf9dd,_0x22a21d(0x14f),_0x22a21d(0x14f),'','');}catch(_0x429b26){console[_0x22a21d(0x153)](_0x429b26);}var _0x26669e;_0x2bf9dd[_0x22a21d(0x159)]&&_0x2bf9dd['picture'][_0x22a21d(0x16d)]&&(_0x26669e=_0x2bf9dd['picture']['data']);!_0x26669e&&_0x2bf9dd[_0x22a21d(0x13c)]&&_0x2bf9dd['APIC'][_0x22a21d(0x16d)]&&_0x2bf9dd[_0x22a21d(0x13c)][_0x22a21d(0x16d)][_0x22a21d(0x16d)]&&(_0x26669e=_0x2bf9dd[_0x22a21d(0x13c)][_0x22a21d(0x16d)][_0x22a21d(0x16d)]);let _0x40d905='';if(_0x26669e){let _0x261932=0x200;_0x40d905=config[_0x22a21d(0x14b)](_0x4a927f,_0x261932);let _0x158884=path[_0x22a21d(0x138)](path[_0x22a21d(0x13e)](_0x40d905),_0x22a21d(0x147)+path[_0x22a21d(0x15a)](_0x40d905));fs['writeFile'](_0x158884,Buffer[_0x22a21d(0x162)](_0x26669e),{'encoding':_0x22a21d(0x167)},function(_0x1cb111){const _0x55faf6=_0x22a21d;_0x1cb111?console[_0x55faf6(0x153)](_0x1cb111):sharpUtil[_0x55faf6(0x11a)](_0x158884,path[_0x55faf6(0x13e)](_0x40d905),path[_0x55faf6(0x15a)](_0x40d905),_0x55faf6(0x121),null,_0x885b55=>{const _0x238924=_0x55faf6;_0x4a927f[_0x238924(0x12a)]=_0x40d905,fs['rm'](_0x158884,_0x1772c7=>{}),_0x6fddfe(_0x4a927f);},_0x4d89d8=>{_0x6fddfe(_0x4a927f);},_0x261932);});}else _0x6fddfe(_0x4a927f);},'onError':function(_0x3f7f84){const _0x1aa67d=_0x5788;console[_0x1aa67d(0x153)](_0x3f7f84),_0x6fddfe(_0x4a927f);}});},module[_0x345edd(0x125)]=musicIndexUtil;