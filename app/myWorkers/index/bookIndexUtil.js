const _0x3fc6ab=_0x4216;(function(_0xe559,_0x4948a9){const _0x449520=_0x4216,_0x4a133f=_0xe559();while(!![]){try{const _0x6ba766=parseInt(_0x449520(0x130))/0x1+parseInt(_0x449520(0x158))/0x2*(parseInt(_0x449520(0x11c))/0x3)+-parseInt(_0x449520(0x153))/0x4+-parseInt(_0x449520(0x16f))/0x5+parseInt(_0x449520(0x133))/0x6+-parseInt(_0x449520(0x121))/0x7+parseInt(_0x449520(0x15c))/0x8;if(_0x6ba766===_0x4948a9)break;else _0x4a133f['push'](_0x4a133f['shift']());}catch(_0x5b427d){_0x4a133f['push'](_0x4a133f['shift']());}}}(_0x2347,0xae9cd));const path=require('path'),fs=require('fs');let pinyin=require('node-pinyin');function _0x2347(){const _0x17acaa=['../../utils/nfoUtil','../../db/dbConfigTable','getTime','getMonth','initials','prepare','../../db/dbSourceFolderTable','indexObj','.zip','title','book','original_date','../../myConfig/config','run','./indexUtil','error','NaN','3929096tVIaaH','exit','runGetBookInfoWorker','then','lastInsertRowid','1117162bUwXzW','filename','type','extname','9595008vdnUyA','recursionFilesAddIndex','dealBookInfo','restoreBookNfo','exports','exifMinTimeStamp','dealFirstLetterAll','dealFirstLetterSingle','all','coverPath','create','bookInfoWorker.js','total_page','ceil','getMediaCoverCachePath','INDEX_TABLE_NAME_BOOK','ctime','test','UPDATE\x20file_index_book\x20SET\x20type=1\x20WHERE\x20type\x20=\x20\x27\x27\x20and\x20ext\x20not\x20in\x20','5770460gZDYmu','coverData','resize','sharpWriteCover','3bpNvOT','(\x27.cbz\x27,\x27.cbr\x27,\x27.rar\x27,\x27.zip\x27,\x27.CBZ\x27,\x27.CBR\x27,\x27.RAR\x27,\x27.ZIP\x27)','getFullYear','toLowerCase','setAllBookType','8140020GXFlJb','toUpperCase','getBookType','mtimeMs','bookTypeList','worker_threads','../../db/dbFileIndexTable','ext','sharp','getDate','ctimeMs','atimeMs','birthtime','is_file','封面写入成功','1113816chLwJC','log','dealFileChange','6855996KoaSUg','已超时\x20结束处理worker','artist','birthtimeMs','err1','.cbz','terminate','length','getById','toBuffer','doesPathCanAddToDb','.cbr','addOriginalDate','includes','addFileIndexToDb'];_0x2347=function(){return _0x17acaa;};return _0x2347();}const sharp=require(_0x3fc6ab(0x129)),{Worker}=require(_0x3fc6ab(0x126));let letterList=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];const dbSourceFolderTable=require(_0x3fc6ab(0x148)),dbFileIndexTable=require(_0x3fc6ab(0x127)),dbConfigTable=require(_0x3fc6ab(0x143)),config=require(_0x3fc6ab(0x14e)),indexUtil=require(_0x3fc6ab(0x150)),nfoUtil=require(_0x3fc6ab(0x142)),indexTableName=dbFileIndexTable[_0x3fc6ab(0x16b)],bookIndexUtil={};bookIndexUtil[_0x3fc6ab(0x11b)]=async function(_0xdfa901,_0x45320a){return new Promise((_0x11b37b,_0x4da71d)=>{const _0x17e9d0=_0x4216;sharp(_0xdfa901,{'failOnError':![]})['jpeg']({'quality':0x4d})[_0x17e9d0(0x171)]({'width':0x1f4})[_0x17e9d0(0x13c)]()[_0x17e9d0(0x156)](_0x2f5ae8=>{fs['writeFile'](_0x45320a,_0x2f5ae8,_0x300f01=>{if(_0x300f01)return _0x4da71d();return _0x11b37b(_0x45320a);});})['catch'](_0x5b1b01=>{const _0x1b86ca=_0x17e9d0;return console[_0x1b86ca(0x131)](_0x1b86ca(0x137),_0x5b1b01),_0x4da71d();});});},bookIndexUtil[_0x3fc6ab(0x155)]=function(_0x37c561,_0xb33323,_0x3c0b29=![]){return new Promise((_0x4b09c1,_0xdb81f6)=>{const _0x3cfbf9=_0x4216;let _0x28aac0=new Worker(path['resolve'](__dirname,_0x3cfbf9(0x167)),{'workerData':{'indexObj':_0x37c561,'bookCoverCachePath':_0xb33323,'onlyGenCover':_0x3c0b29}}),_0x1cc971=setTimeout(()=>{const _0x31a915=_0x3cfbf9;_0x28aac0&&(console[_0x31a915(0x131)](_0x31a915(0x134)),_0x28aac0[_0x31a915(0x139)](),_0x28aac0=null,_0xdb81f6());},0x7530);_0x28aac0['on']('message',_0xeeba2=>{_0xeeba2['code']==0x0&&(_0x1cc971&&clearTimeout(_0x1cc971),_0x4b09c1(_0xeeba2));}),_0x28aac0['on'](_0x3cfbf9(0x151),_0x243e5a=>{const _0x485d2a=_0x3cfbf9;console[_0x485d2a(0x151)]('Worker\x20error:',_0x243e5a),_0x28aac0&&(_0x28aac0['terminate'](),_0x28aac0=null),_0xdb81f6();}),_0x28aac0['on'](_0x3cfbf9(0x154),_0x50fe0b=>{const _0x2484e0=_0x3cfbf9;if(_0x50fe0b!==0x0)console[_0x2484e0(0x151)]('Worker\x20stopped\x20with\x20exit\x20code:',_0x50fe0b);else{}});});},bookIndexUtil['dealBookInfo']=async function(_0x25e536,_0x38aa98){const _0x25f8d4=_0x3fc6ab;let _0x199203=![];if(_0x38aa98[_0x25f8d4(0x12e)]==0x1&&_0x38aa98[_0x25f8d4(0x128)]&&config[_0x25f8d4(0x125)][_0x25f8d4(0x140)](_0x38aa98[_0x25f8d4(0x128)][_0x25f8d4(0x11f)]())){!_0x38aa98[_0x25f8d4(0x15a)]&&(_0x38aa98[_0x25f8d4(0x15a)]=bookIndexUtil[_0x25f8d4(0x123)](_0x38aa98));let _0x449d0e=config[_0x25f8d4(0x16a)](_0x38aa98);try{let _0x43098c=await bookIndexUtil[_0x25f8d4(0x155)](_0x38aa98,_0x449d0e);if(_0x43098c['coverData'])try{let _0x48978e=await bookIndexUtil[_0x25f8d4(0x11b)](_0x43098c[_0x25f8d4(0x170)],_0x449d0e);_0x48978e&&(console[_0x25f8d4(0x131)](_0x25f8d4(0x12f),_0x48978e),_0x43098c['indexObj'][_0x25f8d4(0x165)]=_0x48978e);}catch(_0x2d30fd){console[_0x25f8d4(0x131)](_0x2d30fd);}return console['log']('处理成功',_0x43098c['indexObj']['filename'],_0x43098c[_0x25f8d4(0x149)][_0x25f8d4(0x168)]),bookIndexUtil[_0x25f8d4(0x13f)](_0x25e536,_0x43098c['originalTime'],_0x43098c['indexObj']);}catch(_0x7fa47){return console[_0x25f8d4(0x131)]('err\x205',_0x7fa47),bookIndexUtil[_0x25f8d4(0x13f)](_0x25e536,_0x199203,_0x38aa98);}}else{if(_0x38aa98[_0x25f8d4(0x12e)]==0x1)return;return bookIndexUtil[_0x25f8d4(0x13f)](_0x25e536,_0x199203,_0x38aa98);}},bookIndexUtil[_0x3fc6ab(0x123)]=function(_0x3bc609){const _0x2c4a38=_0x3fc6ab;let _0x511c30=[_0x2c4a38(0x138),_0x2c4a38(0x13e),'.rar',_0x2c4a38(0x14a)];return _0x3bc609[_0x2c4a38(0x128)]&&_0x511c30[_0x2c4a38(0x140)](_0x3bc609[_0x2c4a38(0x128)][_0x2c4a38(0x11f)]())?0x2:0x1;},bookIndexUtil[_0x3fc6ab(0x120)]=function(_0xd606d3){const _0x50838b=_0x3fc6ab;let _0x1edc01=_0x50838b(0x11d),_0x470872='UPDATE\x20file_index_book\x20SET\x20type=2\x20WHERE\x20type\x20=\x20\x27\x27\x20and\x20ext\x20in\x20'+_0x1edc01;_0xd606d3[_0x50838b(0x147)](_0x470872)[_0x50838b(0x14f)](),_0x470872=_0x50838b(0x16e)+_0x1edc01,_0xd606d3[_0x50838b(0x147)](_0x470872)[_0x50838b(0x14f)]();},bookIndexUtil[_0x3fc6ab(0x15d)]=async function(_0x1cbad5,_0x42d8bc,_0x2ae68a){const _0x267269=_0x3fc6ab;return await indexUtil[_0x267269(0x15d)](_0x1cbad5,_0x42d8bc,indexTableName,_0x267269(0x14c),_0x2ae68a,bookIndexUtil[_0x267269(0x141)]);},bookIndexUtil[_0x3fc6ab(0x141)]=async function(_0x2eba6e,_0x40269b,_0xd6b67c,_0x15ff79,_0x4737a3,_0x1d3046){const _0x5cba90=_0x3fc6ab;let _0x383ad5=indexUtil[_0x5cba90(0x13d)](_0x2eba6e,_0x5cba90(0x14c),config,_0xd6b67c,_0x15ff79);if(!_0x383ad5)return;let _0x56ad33=_0x1d3046[_0x5cba90(0x136)];_0x1d3046['mtimeMs']<_0x56ad33&&(_0x56ad33=_0x1d3046[_0x5cba90(0x124)]);_0x1d3046[_0x5cba90(0x12c)]<_0x56ad33&&(_0x56ad33=_0x1d3046[_0x5cba90(0x12c)]);_0x1d3046[_0x5cba90(0x12b)]<_0x56ad33&&(_0x56ad33=_0x1d3046[_0x5cba90(0x12b)]);let _0x1a9cac={'path':_0xd6b67c,'filename':_0x15ff79,'is_file':_0x4737a3,'ctime':_0x1d3046[_0x5cba90(0x12b)],'mtime':_0x1d3046[_0x5cba90(0x124)],'ext':path[_0x5cba90(0x15b)](_0x15ff79),'birthtime':Math[_0x5cba90(0x169)](_0x56ad33),'size':_0x1d3046['size'],'check_time':new Date()[_0x5cba90(0x144)]()};_0x1a9cac=await bookIndexUtil[_0x5cba90(0x15e)](_0x40269b,_0x1a9cac);},bookIndexUtil[_0x3fc6ab(0x132)]=async function(_0x1b2ab9,_0x32892c,_0x5ccfab){const _0x4cf1af=_0x3fc6ab;await indexUtil[_0x4cf1af(0x132)](_0x1b2ab9,_0x32892c,_0x5ccfab,indexTableName,bookIndexUtil[_0x4cf1af(0x141)],bookIndexUtil['recursionFilesAddIndex']);return;},bookIndexUtil[_0x3fc6ab(0x13f)]=function(_0x43b118,_0x43dac6,_0xf61c34){const _0x456616=_0x3fc6ab;nfoUtil[_0x456616(0x15f)](_0xf61c34)['then'](_0x52aad1=>{_0x4dc7fd(_0x52aad1);})['catch'](_0x35c5e1=>{_0x4dc7fd(_0xf61c34);});function _0x4dc7fd(_0x487166){const _0x22d8b2=_0x456616;_0x43dac6&&_0x43dac6<config[_0x22d8b2(0x161)]&&(_0x43dac6=![]);(!_0x43dac6||_0x43dac6==_0x22d8b2(0x152)||_0x43dac6=='Nan'||_0x43dac6==_0x22d8b2(0x152)||_0x43dac6=='Null')&&(_0x43dac6=_0x487166[_0x22d8b2(0x12d)]||_0x487166[_0x22d8b2(0x16c)]);let _0x2f7867=new Date(_0x43dac6);_0x487166['original_time']=_0x2f7867['getTime']();let _0x1b4538=_0x2f7867[_0x22d8b2(0x11e)](),_0x418b30=_0x2f7867[_0x22d8b2(0x145)]()+0x1;_0x418b30=_0x418b30>=0xa?_0x418b30:'0'+_0x418b30;let _0x43eb1e=_0x2f7867[_0x22d8b2(0x12a)]();_0x43eb1e=_0x43eb1e>=0xa?_0x43eb1e:'0'+_0x43eb1e,_0x487166[_0x22d8b2(0x14d)]=_0x1b4538+'-'+_0x418b30+'-'+_0x43eb1e;let _0x5a993f=dbFileIndexTable[_0x22d8b2(0x166)](_0x43b118,_0x487166,indexTableName);if(_0x5a993f&&_0x5a993f[_0x22d8b2(0x157)]){let _0x41ebd2=dbFileIndexTable[_0x22d8b2(0x13b)](_0x43b118,_0x5a993f['lastInsertRowid'],dbFileIndexTable[_0x22d8b2(0x16b)]);_0x41ebd2&&bookIndexUtil['dealFirstLetterSingle'](_0x43b118,_0x41ebd2);}}},bookIndexUtil[_0x3fc6ab(0x162)]=function(_0x1fed1b){const _0x2b810a=_0x3fc6ab;let _0x296ed9='SELECT\x20id,filename,artist,album,title\x20FROM\x20file_index_book\x20WHERE\x20filename_fl\x20is\x20null',_0x2cb531=_0x1fed1b[_0x2b810a(0x147)](_0x296ed9)[_0x2b810a(0x164)]();for(let _0x5c0b05 in _0x2cb531){bookIndexUtil[_0x2b810a(0x163)](_0x1fed1b,_0x2cb531[_0x5c0b05]);}};function _0x4216(_0x2c8056,_0x9184f2){const _0x2347f8=_0x2347();return _0x4216=function(_0x4216ef,_0x37aad8){_0x4216ef=_0x4216ef-0x11b;let _0x57f41f=_0x2347f8[_0x4216ef];return _0x57f41f;},_0x4216(_0x2c8056,_0x9184f2);}function isChinese(_0x490466){const _0x36be14=_0x3fc6ab;var _0x405d8b=/[^\\u4e00-\\u9fa5]/;return _0x405d8b[_0x36be14(0x16d)](_0x490466);}bookIndexUtil[_0x3fc6ab(0x163)]=function(_0x12fb86,_0x3fdc6b){const _0x510982=_0x3fc6ab;function _0x2485a3(_0x5a59dd){const _0x43229c=_0x4216;if(_0x5a59dd&&_0x5a59dd[_0x43229c(0x13a)]>0x0){let _0x113447=_0x5a59dd[0x0];if(letterList[_0x43229c(0x140)](_0x113447))return _0x113447;else{if(isChinese(_0x113447)){let _0x2e3805=pinyin(_0x113447,{'style':_0x43229c(0x146)});return _0x2e3805&&_0x2e3805[_0x43229c(0x13a)]>0x0&&_0x2e3805[0x0][_0x43229c(0x13a)]>0x0&&_0x2e3805[0x0][0x0]['length']>0x0?_0x2e3805[0x0][0x0][0x0]:'#';}else return'#';}}else return'';}let _0x1d3ca2=_0x2485a3(_0x3fdc6b[_0x510982(0x159)]?_0x3fdc6b[_0x510982(0x159)][_0x510982(0x122)]():'')[_0x510982(0x122)](),_0x1e3894=_0x2485a3(_0x3fdc6b[_0x510982(0x135)]?_0x3fdc6b[_0x510982(0x135)]['toUpperCase']():'')[_0x510982(0x122)](),_0x1c75cb=_0x2485a3(_0x3fdc6b['title']?_0x3fdc6b[_0x510982(0x14b)]['toUpperCase']():'')[_0x510982(0x122)]();_0x12fb86['prepare']('UPDATE\x20file_index_book\x20set\x20filename_fl=?,artist_fl=?,title_fl=?\x20where\x20id=?')[_0x510982(0x14f)](_0x1d3ca2,_0x1e3894,_0x1c75cb,_0x3fdc6b['id']);},module[_0x3fc6ab(0x160)]=bookIndexUtil;