function _0x5999(){const _0x4ee04b=['coverPath','bookInfoWorker.js','recursionFilesAddIndex','dealFileChange','getFullYear','length','path','log','INDEX_TABLE_NAME_BOOK','coverData','bookTypeList','getMonth','mtimeMs','dealBookInfo','book','处理成功','2216GmfiGT','runGetBookInfoWorker','封面写入成功','sharpWriteCover','original_time','filename','(\x27.cbz\x27,\x27.cbr\x27,\x27.rar\x27,\x27.zip\x27,\x27.CBZ\x27,\x27.CBR\x27,\x27.RAR\x27,\x27.ZIP\x27)','../../db/dbFileIndexTable','getTime','prepare','atimeMs','ctimeMs','ext','ceil','UPDATE\x20file_index_book\x20SET\x20type=2\x20WHERE\x20type\x20=\x20\x27\x27\x20and\x20ext\x20in\x20','toLowerCase','6247584ubfSrL','41474090uYJdeP','getById','addFileIndexToDb','getDate','writeFile','resolve','getMediaCoverCachePath','../../db/dbConfigTable','Worker\x20error:','dealFirstLetterAll','lastInsertRowid','dealFirstLetterSingle','168138YwSvbd','originalTime','351090ASSKZp','toUpperCase','type','test','SELECT\x20id,filename,artist,album,title\x20FROM\x20file_index_book\x20WHERE\x20filename_fl\x20is\x20null','title','artist','then','Worker\x20stopped\x20with\x20exit\x20code:','exports','../../utils/nfoUtil','birthtimeMs','11uGhNbB','size','toBuffer','initials','16jtSsgX','create','.rar','1985631IPWbpf','err\x205','Null','.cbr','4875129xmjdfQ','.cbz','135cwwMZe','exit','Nan','getBookType','all','err1','code','catch','is_file','error','doesPathCanAddToDb','.zip','sharp','NaN','restoreBookNfo','terminate','addOriginalDate','node-pinyin','includes','worker_threads','run'];_0x5999=function(){return _0x4ee04b;};return _0x5999();}function _0x5c0f(_0x1aea79,_0x7f8eb4){const _0x59994c=_0x5999();return _0x5c0f=function(_0x5c0f96,_0x573ce5){_0x5c0f96=_0x5c0f96-0x9a;let _0x29a51d=_0x59994c[_0x5c0f96];return _0x29a51d;},_0x5c0f(_0x1aea79,_0x7f8eb4);}const _0x316b64=_0x5c0f;(function(_0x3ea068,_0x3a4a37){const _0x118d5c=_0x5c0f,_0x1a341b=_0x3ea068();while(!![]){try{const _0x49b6ee=-parseInt(_0x118d5c(0xad))/0x1*(parseInt(_0x118d5c(0x9f))/0x2)+-parseInt(_0x118d5c(0xb4))/0x3+-parseInt(_0x118d5c(0xb1))/0x4*(parseInt(_0x118d5c(0xa1))/0x5)+-parseInt(_0x118d5c(0xef))/0x6+-parseInt(_0x118d5c(0xb8))/0x7+-parseInt(_0x118d5c(0xdf))/0x8*(-parseInt(_0x118d5c(0xba))/0x9)+parseInt(_0x118d5c(0xf0))/0xa;if(_0x49b6ee===_0x3a4a37)break;else _0x1a341b['push'](_0x1a341b['shift']());}catch(_0x5d4112){_0x1a341b['push'](_0x1a341b['shift']());}}}(_0x5999,0x85629));const path=require(_0x316b64(0xd5)),fs=require('fs');let pinyin=require(_0x316b64(0xcb));const sharp=require(_0x316b64(0xc6)),{Worker}=require(_0x316b64(0xcd));let letterList=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];const dbSourceFolderTable=require('../../db/dbSourceFolderTable'),dbFileIndexTable=require(_0x316b64(0xe6)),dbConfigTable=require(_0x316b64(0x9a)),config=require('../../myConfig/config'),indexUtil=require('./indexUtil'),nfoUtil=require(_0x316b64(0xab)),indexTableName=dbFileIndexTable[_0x316b64(0xd7)],bookIndexUtil={};bookIndexUtil['sharpWriteCover']=async function(_0x36deb5,_0x31ffa1){return new Promise((_0x58238d,_0x1fa226)=>{const _0x1f68e3=_0x5c0f;sharp(_0x36deb5,{'failOnError':![]})['jpeg']({'quality':0x4d})['resize']({'width':0x1f4})[_0x1f68e3(0xaf)]()[_0x1f68e3(0xa8)](_0x402944=>{const _0x495234=_0x1f68e3;fs[_0x495234(0xf4)](_0x31ffa1,_0x402944,_0x301bc9=>{if(_0x301bc9)return _0x1fa226();return _0x58238d(_0x31ffa1);});})[_0x1f68e3(0xc1)](_0x35d912=>{const _0x4776b6=_0x1f68e3;return console[_0x4776b6(0xd6)](_0x4776b6(0xbf),_0x35d912),_0x1fa226();});});},bookIndexUtil[_0x316b64(0xe0)]=function(_0xe33bb7,_0x16d2aa,_0x512165=![]){return new Promise((_0x3c4ada,_0x1d6e57)=>{const _0x118feb=_0x5c0f;let _0x156cdd=new Worker(path[_0x118feb(0xf5)](__dirname,_0x118feb(0xd0)),{'workerData':{'indexObj':_0xe33bb7,'bookCoverCachePath':_0x16d2aa,'onlyGenCover':_0x512165}}),_0x12389b=setTimeout(()=>{const _0x5d73dd=_0x118feb;_0x156cdd&&(console[_0x5d73dd(0xd6)]('已超时\x20结束处理worker'),_0x156cdd[_0x5d73dd(0xc9)](),_0x156cdd=null,_0x1d6e57());},0x7530);_0x156cdd['on']('message',_0x2d324c=>{const _0x3c4042=_0x118feb;_0x2d324c[_0x3c4042(0xc0)]==0x0&&(_0x12389b&&clearTimeout(_0x12389b),_0x3c4ada(_0x2d324c));}),_0x156cdd['on'](_0x118feb(0xc3),_0x1a98db=>{const _0x512bac=_0x118feb;console[_0x512bac(0xc3)](_0x512bac(0x9b),_0x1a98db),_0x156cdd&&(_0x156cdd[_0x512bac(0xc9)](),_0x156cdd=null),_0x1d6e57();}),_0x156cdd['on'](_0x118feb(0xbb),_0x256931=>{const _0x1b9f7c=_0x118feb;if(_0x256931!==0x0)console[_0x1b9f7c(0xc3)](_0x1b9f7c(0xa9),_0x256931);else{}});});},bookIndexUtil['dealBookInfo']=async function(_0x4feb65,_0x336559){const _0x334741=_0x316b64;let _0x32cbd1=![];if(_0x336559[_0x334741(0xc2)]==0x1&&_0x336559[_0x334741(0xeb)]&&config[_0x334741(0xd9)][_0x334741(0xcc)](_0x336559[_0x334741(0xeb)]['toLowerCase']())){!_0x336559[_0x334741(0xa3)]&&(_0x336559[_0x334741(0xa3)]=bookIndexUtil[_0x334741(0xbd)](_0x336559));let _0x2617ca=config[_0x334741(0xf6)](_0x336559);try{let _0x297033=await bookIndexUtil[_0x334741(0xe0)](_0x336559,_0x2617ca);if(_0x297033[_0x334741(0xd8)])try{let _0x30cc98=await bookIndexUtil[_0x334741(0xe2)](_0x297033[_0x334741(0xd8)],_0x2617ca);_0x30cc98&&(console[_0x334741(0xd6)](_0x334741(0xe1),_0x30cc98),_0x297033['indexObj'][_0x334741(0xcf)]=_0x30cc98);}catch(_0x1ab15f){console[_0x334741(0xd6)](_0x1ab15f);}return console['log'](_0x334741(0xde),_0x297033['indexObj'][_0x334741(0xe4)],_0x297033['indexObj']['total_page']),bookIndexUtil['addOriginalDate'](_0x4feb65,_0x297033[_0x334741(0xa0)],_0x297033['indexObj']);}catch(_0x265c97){return console['log'](_0x334741(0xb5),_0x265c97),bookIndexUtil['addOriginalDate'](_0x4feb65,_0x32cbd1,_0x336559);}}else{if(_0x336559[_0x334741(0xc2)]==0x1)return;return bookIndexUtil[_0x334741(0xca)](_0x4feb65,_0x32cbd1,_0x336559);}},bookIndexUtil[_0x316b64(0xbd)]=function(_0x1e4248){const _0x4b61e7=_0x316b64;let _0x578863=[_0x4b61e7(0xb9),_0x4b61e7(0xb7),_0x4b61e7(0xb3),_0x4b61e7(0xc5)];return _0x1e4248[_0x4b61e7(0xeb)]&&_0x578863[_0x4b61e7(0xcc)](_0x1e4248['ext'][_0x4b61e7(0xee)]())?0x2:0x1;},bookIndexUtil['setAllBookType']=function(_0x388326){const _0x30eea6=_0x316b64;let _0x5114df=_0x30eea6(0xe5),_0x4338e4=_0x30eea6(0xed)+_0x5114df;_0x388326[_0x30eea6(0xe8)](_0x4338e4)[_0x30eea6(0xce)](),_0x4338e4='UPDATE\x20file_index_book\x20SET\x20type=1\x20WHERE\x20type\x20=\x20\x27\x27\x20and\x20ext\x20not\x20in\x20'+_0x5114df,_0x388326[_0x30eea6(0xe8)](_0x4338e4)[_0x30eea6(0xce)]();},bookIndexUtil[_0x316b64(0xd1)]=async function(_0x21bf26,_0x2e5aee,_0x4a9188){const _0xb631fc=_0x316b64;return await indexUtil[_0xb631fc(0xd1)](_0x21bf26,_0x2e5aee,indexTableName,_0xb631fc(0xdd),_0x4a9188,bookIndexUtil[_0xb631fc(0xf2)]);},bookIndexUtil[_0x316b64(0xf2)]=async function(_0x525f52,_0x5d5f60,_0x1bc235,_0x1b8fe4,_0x1c909f,_0x5e63d9){const _0x1cdd5e=_0x316b64;let _0x47906e=indexUtil[_0x1cdd5e(0xc4)](_0x525f52,_0x1cdd5e(0xdd),config,_0x1bc235,_0x1b8fe4);if(!_0x47906e)return;let _0x196daf=_0x5e63d9[_0x1cdd5e(0xac)];_0x5e63d9[_0x1cdd5e(0xdb)]<_0x196daf&&(_0x196daf=_0x5e63d9[_0x1cdd5e(0xdb)]);_0x5e63d9[_0x1cdd5e(0xe9)]<_0x196daf&&(_0x196daf=_0x5e63d9[_0x1cdd5e(0xe9)]);_0x5e63d9['ctimeMs']<_0x196daf&&(_0x196daf=_0x5e63d9[_0x1cdd5e(0xea)]);let _0x1b9f44={'path':_0x1bc235,'filename':_0x1b8fe4,'is_file':_0x1c909f,'ctime':_0x5e63d9[_0x1cdd5e(0xea)],'mtime':_0x5e63d9[_0x1cdd5e(0xdb)],'ext':path['extname'](_0x1b8fe4),'birthtime':Math[_0x1cdd5e(0xec)](_0x196daf),'size':_0x5e63d9[_0x1cdd5e(0xae)],'check_time':new Date()[_0x1cdd5e(0xe7)]()};_0x1b9f44=await bookIndexUtil[_0x1cdd5e(0xdc)](_0x5d5f60,_0x1b9f44);},bookIndexUtil[_0x316b64(0xd2)]=async function(_0x23cdbb,_0x7e2405,_0x104b4e){const _0x227254=_0x316b64;await indexUtil['dealFileChange'](_0x23cdbb,_0x7e2405,_0x104b4e,indexTableName,bookIndexUtil[_0x227254(0xf2)],bookIndexUtil[_0x227254(0xd1)]);return;},bookIndexUtil[_0x316b64(0xca)]=function(_0x1fd627,_0xeaa13a,_0x39f449){const _0x39ab00=_0x316b64;nfoUtil[_0x39ab00(0xc8)](_0x39f449)['then'](_0x126d65=>{_0x433530(_0x126d65);})[_0x39ab00(0xc1)](_0x221757=>{_0x433530(_0x39f449);});function _0x433530(_0x5ba2d6){const _0x14e544=_0x39ab00;_0xeaa13a&&_0xeaa13a<config['exifMinTimeStamp']&&(_0xeaa13a=![]);(!_0xeaa13a||_0xeaa13a=='NaN'||_0xeaa13a==_0x14e544(0xbc)||_0xeaa13a==_0x14e544(0xc7)||_0xeaa13a==_0x14e544(0xb6))&&(_0xeaa13a=_0x5ba2d6['birthtime']||_0x5ba2d6['ctime']);let _0x5f2e79=new Date(_0xeaa13a);_0x5ba2d6[_0x14e544(0xe3)]=_0x5f2e79['getTime']();let _0x319e9f=_0x5f2e79[_0x14e544(0xd3)](),_0x1381b8=_0x5f2e79[_0x14e544(0xda)]()+0x1;_0x1381b8=_0x1381b8>=0xa?_0x1381b8:'0'+_0x1381b8;let _0x4ff3e8=_0x5f2e79[_0x14e544(0xf3)]();_0x4ff3e8=_0x4ff3e8>=0xa?_0x4ff3e8:'0'+_0x4ff3e8,_0x5ba2d6['original_date']=_0x319e9f+'-'+_0x1381b8+'-'+_0x4ff3e8;let _0x4fbb2d=dbFileIndexTable[_0x14e544(0xb2)](_0x1fd627,_0x5ba2d6,indexTableName);if(_0x4fbb2d&&_0x4fbb2d['lastInsertRowid']){let _0x43b3ec=dbFileIndexTable[_0x14e544(0xf1)](_0x1fd627,_0x4fbb2d[_0x14e544(0x9d)],dbFileIndexTable[_0x14e544(0xd7)]);_0x43b3ec&&bookIndexUtil['dealFirstLetterSingle'](_0x1fd627,_0x43b3ec);}}},bookIndexUtil[_0x316b64(0x9c)]=function(_0x3fc536){const _0x3107bb=_0x316b64;let _0x20575d=_0x3107bb(0xa5),_0xc9807e=_0x3fc536[_0x3107bb(0xe8)](_0x20575d)[_0x3107bb(0xbe)]();for(let _0x4ab120 in _0xc9807e){bookIndexUtil['dealFirstLetterSingle'](_0x3fc536,_0xc9807e[_0x4ab120]);}};function isChinese(_0x23ef19){const _0x25e8bf=_0x316b64;var _0x2f260b=/[^\\u4e00-\\u9fa5]/;return _0x2f260b[_0x25e8bf(0xa4)](_0x23ef19);}bookIndexUtil[_0x316b64(0x9e)]=function(_0x567888,_0x256623){const _0x1a84a3=_0x316b64;function _0x4f88d1(_0x356d25){const _0x144be3=_0x5c0f;if(_0x356d25&&_0x356d25[_0x144be3(0xd4)]>0x0){let _0x5e8e4d=_0x356d25[0x0];if(letterList[_0x144be3(0xcc)](_0x5e8e4d))return _0x5e8e4d;else{if(isChinese(_0x5e8e4d)){let _0x8d45ce=pinyin(_0x5e8e4d,{'style':_0x144be3(0xb0)});return _0x8d45ce&&_0x8d45ce[_0x144be3(0xd4)]>0x0&&_0x8d45ce[0x0][_0x144be3(0xd4)]>0x0&&_0x8d45ce[0x0][0x0][_0x144be3(0xd4)]>0x0?_0x8d45ce[0x0][0x0][0x0]:'#';}else return'#';}}else return'';}let _0xd7ff50=_0x4f88d1(_0x256623[_0x1a84a3(0xe4)]?_0x256623[_0x1a84a3(0xe4)][_0x1a84a3(0xa2)]():'')['toUpperCase'](),_0x2dba3e=_0x4f88d1(_0x256623[_0x1a84a3(0xa7)]?_0x256623[_0x1a84a3(0xa7)][_0x1a84a3(0xa2)]():'')['toUpperCase'](),_0x5738e4=_0x4f88d1(_0x256623[_0x1a84a3(0xa6)]?_0x256623[_0x1a84a3(0xa6)][_0x1a84a3(0xa2)]():'')[_0x1a84a3(0xa2)]();_0x567888[_0x1a84a3(0xe8)]('UPDATE\x20file_index_book\x20set\x20filename_fl=?,artist_fl=?,title_fl=?\x20where\x20id=?')[_0x1a84a3(0xce)](_0xd7ff50,_0x2dba3e,_0x5738e4,_0x256623['id']);},module[_0x316b64(0xaa)]=bookIndexUtil;