function _0x19cf(_0xb99be9,_0x5a1ce9){const _0xde1bc7=_0xde1b();return _0x19cf=function(_0x19cf21,_0x45ebce){_0x19cf21=_0x19cf21-0x93;let _0x1549aa=_0xde1bc7[_0x19cf21];return _0x1549aa;},_0x19cf(_0xb99be9,_0x5a1ce9);}const _0x4b7d4b=_0x19cf;(function(_0x4a2b9c,_0x377e02){const _0x2eda67=_0x19cf,_0x15fc19=_0x4a2b9c();while(!![]){try{const _0x23e4af=-parseInt(_0x2eda67(0x9e))/0x1*(-parseInt(_0x2eda67(0xdd))/0x2)+-parseInt(_0x2eda67(0xe2))/0x3*(parseInt(_0x2eda67(0xd5))/0x4)+-parseInt(_0x2eda67(0x98))/0x5*(-parseInt(_0x2eda67(0xa0))/0x6)+parseInt(_0x2eda67(0xde))/0x7+-parseInt(_0x2eda67(0xbf))/0x8+parseInt(_0x2eda67(0xd3))/0x9*(-parseInt(_0x2eda67(0xed))/0xa)+parseInt(_0x2eda67(0xb0))/0xb*(parseInt(_0x2eda67(0xe9))/0xc);if(_0x23e4af===_0x377e02)break;else _0x15fc19['push'](_0x15fc19['shift']());}catch(_0x38eecd){_0x15fc19['push'](_0x15fc19['shift']());}}}(_0xde1b,0xb7a02));const path=require(_0x4b7d4b(0xcf)),dbFileIndexTable=require(_0x4b7d4b(0xe0)),config=require('../../myConfig/config'),exifUtil=require(_0x4b7d4b(0xb1)),videoStreamUtil=require(_0x4b7d4b(0xd0)),indexUtil=require(_0x4b7d4b(0xdb)),movieUtil=require(_0x4b7d4b(0xc4)),indexTableName=dbFileIndexTable[_0x4b7d4b(0xb9)],movieIndexUtil={};movieIndexUtil['needDealTvDrama']=!![];let lastDealTvDramaTimestamp=0x0;movieIndexUtil[_0x4b7d4b(0xb6)]=async function(_0x4bf0f8,_0x5edac9,_0x4ade28){const _0x3396d6=_0x4b7d4b;await indexUtil['dealFileChange'](_0x4bf0f8,_0x5edac9,_0x4ade28,indexTableName,movieIndexUtil[_0x3396d6(0xdf)],movieIndexUtil['recursionFilesAddIndex']);return;},movieIndexUtil[_0x4b7d4b(0xeb)]=async function(_0x548016,_0x2898c9,_0x36cdb7){const _0x2e56b4=_0x4b7d4b;return await indexUtil['recursionFilesAddIndex'](_0x548016,_0x2898c9,indexTableName,_0x2e56b4(0xd9),_0x36cdb7,movieIndexUtil['addFileIndexToDb'],()=>{const _0x39133a=_0x2e56b4;let _0x1d9b3d=new Date()[_0x39133a(0xb5)]()-lastDealTvDramaTimestamp;movieIndexUtil['needDealTvDrama']&&_0x1d9b3d>0x1d4c0&&(movieIndexUtil[_0x39133a(0xc0)](_0x2898c9),lastDealTvDramaTimestamp=new Date()[_0x39133a(0xb5)]());});},movieIndexUtil[_0x4b7d4b(0xdf)]=async function(_0x5bf238,_0x21b4d0,_0x49f168,_0x2f44af,_0x4b9528,_0x3a28a5){const _0x29483f=_0x4b7d4b;let _0x253829={'path':_0x49f168,'filename':_0x2f44af,'is_file':_0x4b9528},_0x4a8ea8=indexUtil[_0x29483f(0xaa)](_0x5bf238,_0x29483f(0xd9),config,_0x49f168,_0x2f44af);if(!_0x4a8ea8)return;_0x4a8ea8['media_type']==_0x29483f(0x9c)&&(_0x253829[_0x29483f(0x9a)]=0x1,_0x253829[_0x29483f(0xea)]=0x0);let _0x38a916=_0x3a28a5['birthtimeMs'];_0x3a28a5[_0x29483f(0x95)]<_0x38a916&&(_0x38a916=_0x3a28a5[_0x29483f(0x95)]),_0x3a28a5[_0x29483f(0x93)]<_0x38a916&&(_0x38a916=_0x3a28a5['atimeMs']),_0x3a28a5[_0x29483f(0xe8)]<_0x38a916&&(_0x38a916=_0x3a28a5[_0x29483f(0xe8)]),_0x253829={..._0x253829,'ctime':_0x3a28a5[_0x29483f(0xe8)],'mtime':_0x3a28a5[_0x29483f(0x95)],'ext':path[_0x29483f(0xc1)](_0x2f44af),'birthtime':Math[_0x29483f(0xa6)](_0x38a916),'size':_0x3a28a5['size'],'check_time':new Date()['getTime']()},_0x253829=await movieIndexUtil[_0x29483f(0xa1)](_0x21b4d0,_0x253829);},movieIndexUtil[_0x4b7d4b(0xa1)]=async function(_0x24ba57,_0x21d9f1){const _0x1ebbd0=_0x4b7d4b;let _0xc34b5d=![],_0x99ed7a=path[_0x1ebbd0(0xd6)](_0x21d9f1[_0x1ebbd0(0xcf)],_0x21d9f1[_0x1ebbd0(0xc3)]);if(_0x21d9f1[_0x1ebbd0(0xae)]==0x1&&_0x21d9f1[_0x1ebbd0(0xbd)]&&(config[_0x1ebbd0(0xe6)][_0x1ebbd0(0xe7)](_0x21d9f1['ext'][_0x1ebbd0(0xac)]())||config['rawImgTypeList'][_0x1ebbd0(0xe7)](_0x21d9f1[_0x1ebbd0(0xbd)]['toLowerCase']()))){_0x21d9f1[_0x1ebbd0(0xe4)]=0x1;try{let {tags:_0x5e3b95,dealedIndexObj:_0x56edb5}=await exifUtil[_0x1ebbd0(0xa8)](_0x99ed7a,_0x21d9f1);return movieIndexUtil[_0x1ebbd0(0xad)](_0x24ba57,_0x56edb5[_0x1ebbd0(0xe1)],_0x56edb5);}catch(_0x56811c){return movieIndexUtil['addOriginalDate'](_0x24ba57,_0xc34b5d,_0x21d9f1);}}else{if(_0x21d9f1[_0x1ebbd0(0xae)]==0x1&&_0x21d9f1[_0x1ebbd0(0xbd)]&&config[_0x1ebbd0(0xba)][_0x1ebbd0(0xe7)](_0x21d9f1[_0x1ebbd0(0xbd)][_0x1ebbd0(0xac)]())){_0x21d9f1['type']=0x2;try{let _0x2b20e6=await indexUtil[_0x1ebbd0(0x9d)](_0x99ed7a),_0x431d54=0x0,_0x2fe2f3=0x0;if(_0x2b20e6&&_0x2b20e6[_0x1ebbd0(0xa9)]&&_0x2b20e6['streams']['length']>0x0){_0x21d9f1[_0x1ebbd0(0xc5)]=JSON[_0x1ebbd0(0xee)](_0x2b20e6[_0x1ebbd0(0xa9)]);let _0x388468=videoStreamUtil[_0x1ebbd0(0xe3)](_0x2b20e6[_0x1ebbd0(0xa9)]);_0x21d9f1[_0x1ebbd0(0xef)]=_0x388468['videoWidth'],_0x21d9f1[_0x1ebbd0(0xc8)]=_0x388468[_0x1ebbd0(0xb8)];let _0x4c3f80=videoStreamUtil[_0x1ebbd0(0xce)](_0x2b20e6);_0x4c3f80&&(_0x21d9f1[_0x1ebbd0(0xd2)]=_0x4c3f80);}if(_0x2b20e6&&_0x2b20e6[_0x1ebbd0(0xd4)]&&_0x2b20e6[_0x1ebbd0(0xd4)]['tags']){let _0x2c64cb=_0x2b20e6[_0x1ebbd0(0xd4)]['tags']['com.apple.quicktime.location.ISO6709'],_0x5ed722=_0x2b20e6[_0x1ebbd0(0xd4)]['tags']['com.apple.quicktime.model'],_0x4b3370=_0x2b20e6[_0x1ebbd0(0xd4)]['tags'][_0x1ebbd0(0xab)];_0x5ed722&&(_0x21d9f1['mode']=_0x5ed722);_0x4b3370&&(_0xc34b5d=_0x4b3370);!_0xc34b5d&&_0x2b20e6[_0x1ebbd0(0xd4)][_0x1ebbd0(0xc2)][_0x1ebbd0(0xb4)]&&(_0xc34b5d=_0x2b20e6[_0x1ebbd0(0xd4)][_0x1ebbd0(0xc2)][_0x1ebbd0(0xb4)]);function _0x914e45(_0x1319ec){const _0x433705=_0x1ebbd0;let _0x13fd83=[];for(let _0x362331=0x0;_0x362331<_0x1319ec['length'];_0x362331++){(_0x1319ec[_0x362331]=='+'||_0x1319ec[_0x362331]=='-')&&_0x13fd83[_0x433705(0xb3)](_0x362331);}if(_0x13fd83[_0x433705(0xa4)]==0x2)_0x431d54=_0x1319ec[_0x433705(0xcc)](_0x13fd83[0x0],_0x13fd83[0x1]),_0x2fe2f3=_0x1319ec[_0x433705(0xcc)](_0x13fd83[0x1]);else _0x13fd83[_0x433705(0xa4)]>=0x3&&(_0x431d54=_0x1319ec['substring'](_0x13fd83[0x0],_0x13fd83[0x1]),_0x2fe2f3=_0x1319ec[_0x433705(0xcc)](_0x13fd83[0x1],_0x13fd83[0x2]));}_0x2c64cb&&_0x914e45(_0x2c64cb);let _0x56d1c4=_0x2b20e6['format']['tags'][_0x1ebbd0(0xbc)]||_0x2b20e6[_0x1ebbd0(0xd4)]['tags']['location-eng'];_0x56d1c4&&!_0x431d54&&(_0x56d1c4=_0x56d1c4[_0x1ebbd0(0xdc)]('/',''),_0x914e45(_0x56d1c4)),_0x2b20e6[_0x1ebbd0(0xd4)][_0x1ebbd0(0xd2)]&&(_0x21d9f1[_0x1ebbd0(0xd2)]=_0x2b20e6['format'][_0x1ebbd0(0xd2)]);}return _0x21d9f1['latitude']=_0x431d54,_0x21d9f1['longitude']=_0x2fe2f3,movieIndexUtil['addOriginalDate'](_0x24ba57,_0xc34b5d,_0x21d9f1);}catch(_0x50e858){return movieIndexUtil[_0x1ebbd0(0xad)](_0x24ba57,_0xc34b5d,_0x21d9f1);}}else{if(_0x21d9f1[_0x1ebbd0(0xae)]==0x1)return;return movieIndexUtil[_0x1ebbd0(0xad)](_0x24ba57,_0xc34b5d,_0x21d9f1);}}},movieIndexUtil[_0x4b7d4b(0xad)]=function(_0x316195,_0xd044b1,_0x7e3116){const _0x4eae02=_0x4b7d4b;_0xd044b1&&_0xd044b1<config[_0x4eae02(0x9f)]&&(_0xd044b1=![]);!_0xd044b1&&(_0xd044b1=_0x7e3116[_0x4eae02(0xb2)]||_0x7e3116['ctime']);let _0x3715cb=new Date(_0xd044b1);_0x7e3116[_0x4eae02(0xa5)]=_0x3715cb['getTime']();let _0x4ece3e=_0x3715cb[_0x4eae02(0xd7)](),_0x1931dc=_0x3715cb[_0x4eae02(0xc9)]()+0x1;_0x1931dc=_0x1931dc>=0xa?_0x1931dc:'0'+_0x1931dc;let _0x18e321=_0x3715cb['getDate']();_0x18e321=_0x18e321>=0xa?_0x18e321:'0'+_0x18e321,_0x7e3116[_0x4eae02(0xaf)]=_0x4ece3e+'-'+_0x1931dc+'-'+_0x18e321,movieIndexUtil[_0x4eae02(0xa3)](_0x316195,_0x7e3116);},movieIndexUtil[_0x4b7d4b(0xa3)]=function(_0x5d5ea7,_0x34c32c){const _0x57af27=_0x4b7d4b;_0x34c32c[_0x57af27(0x9a)]==0x1&&_0x34c32c[_0x57af27(0xe4)]==0x2&&(movieIndexUtil[_0x57af27(0xec)]=!![]);_0x34c32c[_0x57af27(0xda)]=movieUtil[_0x57af27(0xb7)](_0x34c32c[_0x57af27(0xc3)]);let _0x1a3dfe=dbFileIndexTable[_0x57af27(0xe5)](_0x5d5ea7,_0x34c32c,indexTableName),_0x54c018=_0x34c32c['path'][_0x57af27(0xac)]();try{if(_0x54c018[_0x57af27(0xc7)]('\x5cbdmv\x5cstream')||_0x54c018[_0x57af27(0xc7)](_0x57af27(0xc6))){_0x5d5ea7['prepare'](_0x57af27(0xa2)+indexTableName+'\x20SET\x20show_in_list\x20=\x200\x20WHERE\x20path=?')[_0x57af27(0xcd)](_0x34c32c[_0x57af27(0xcf)]);let _0xb6412a=_0x34c32c['path'][_0x57af27(0xdc)]('\x5cbdmv\x5cstream','')[_0x57af27(0xdc)]('/bdmv/stream','')[_0x57af27(0xdc)](_0x57af27(0xa7),'')[_0x57af27(0xdc)](_0x57af27(0xbb),'');_0xb6412a=path[_0x57af27(0xbe)](_0xb6412a),_0x5d5ea7['prepare'](_0x57af27(0xa2)+indexTableName+_0x57af27(0xd1))[_0x57af27(0xcd)](_0xb6412a,_0x34c32c['path']);}}catch(_0x50cf72){}let _0x211c53=dbFileIndexTable['getById'](_0x5d5ea7,_0x1a3dfe[_0x57af27(0x94)],indexTableName);_0x211c53&&movieUtil[_0x57af27(0xcb)](_0x5d5ea7,_0x211c53);};function _0xde1b(){const _0x28c674=['addFinalIndexToDB','length','original_time','ceil','\x5cBDMV\x5cSTREAM','getExifInfo','streams','doesPathCanAddToDb','com.apple.quicktime.creationdate','toLowerCase','addOriginalDate','is_file','original_date','5443966cGUULg','../../utils/exifUtils','birthtime','push','creation_time','getTime','dealFileChange','getFilenameNumber','videoHeight','INDEX_TABLE_NAME_MOVIE','videoTypeList','/BDMV/STREAM','location','ext','basename','11835024lkkdTE','dealTvDrama','extname','tags','filename','../../express-server/utils/movieUtil','stream_info','/bdmv/stream','endsWith','height','getMonth','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x201\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20IN\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20t1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x20t1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INNER\x20JOIN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20path,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min(filename)\x20AS\x20filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x20path\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t2\x20ON\x20t1.path\x20=\x20t2.path\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t1.filename\x20=\x20t2.filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','dealFirstLetterSingle','substring','run','getDurationFromStream','path','../../utils/videoStreamUtil','\x20as\x20t\x20SET\x20show_in_list\x20=\x201,show_name=?\x20WHERE\x20path=?\x20AND\x20duration>1800','duration','27jNntge','format','4BQImgm','join','getFullYear','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20show_in_list\x20=\x201;','movie','filenameNumber','./indexUtil','replace','360RInyXC','1442301WjjbqI','addFileIndexToDb','../../db/dbFileIndexTable','originalTime','2719269upJJHu','parseVideoWH','type','create','imgTypeList','includes','ctimeMs','60yxWaKj','show_in_list','recursionFilesAddIndex','needDealTvDrama','692890DjCRjF','stringify','width','atimeMs','lastInsertRowid','mtimeMs','transaction','exports','25FaovYg','prepare','is_tvplay','影音管理：电视剧状态处理完成,耗时:','tvplay','ffprobeSync','238zuFREo','exifMinTimeStamp','746862kaCayO','dealMediaInfo','UPDATE\x20'];_0xde1b=function(){return _0x28c674;};return _0xde1b();}let tvDramaIsDealing=![];movieIndexUtil[_0x4b7d4b(0xc0)]=function(_0x48827e){const _0x270953=_0x4b7d4b;if(!movieIndexUtil[_0x270953(0xec)])return;if(tvDramaIsDealing)return;tvDramaIsDealing=!![];let _0x420af7=new Date()[_0x270953(0xb5)]();try{let _0x3d84be=_0x270953(0xd8),_0x39fdb2=_0x270953(0xca),_0x114a3b=_0x48827e[_0x270953(0x96)](()=>{const _0x2cf7e2=_0x270953;_0x48827e[_0x2cf7e2(0x99)](_0x3d84be)[_0x2cf7e2(0xcd)](),_0x48827e[_0x2cf7e2(0x99)](_0x39fdb2)[_0x2cf7e2(0xcd)]();}),_0x5ab900=new Date()[_0x270953(0xb5)]();_0x114a3b(),console['log'](_0x270953(0x9b),(_0x5ab900-_0x420af7)/0x3e8+'s');}catch(_0x150ecd){console['log']('影音管理：设置电视剧状态出错',_0x150ecd);}tvDramaIsDealing=![],movieIndexUtil['needDealTvDrama']=![];},module[_0x4b7d4b(0x97)]=movieIndexUtil;