const _0x59830b=_0x3652;(function(_0x14674c,_0x4adddf){const _0x511427=_0x3652,_0x5579d6=_0x14674c();while(!![]){try{const _0xbc2871=-parseInt(_0x511427(0xd7))/0x1*(-parseInt(_0x511427(0xdc))/0x2)+parseInt(_0x511427(0x122))/0x3*(parseInt(_0x511427(0x101))/0x4)+-parseInt(_0x511427(0x128))/0x5*(-parseInt(_0x511427(0x11c))/0x6)+parseInt(_0x511427(0xf7))/0x7+-parseInt(_0x511427(0xe4))/0x8+parseInt(_0x511427(0x130))/0x9*(-parseInt(_0x511427(0xed))/0xa)+-parseInt(_0x511427(0x100))/0xb;if(_0xbc2871===_0x4adddf)break;else _0x5579d6['push'](_0x5579d6['shift']());}catch(_0x5c6ee0){_0x5579d6['push'](_0x5579d6['shift']());}}}(_0x179f,0xbf2e0));const path=require('path'),dbFileIndexTable=require(_0x59830b(0xf8)),config=require(_0x59830b(0x102)),exifUtil=require(_0x59830b(0xd8)),videoStreamUtil=require(_0x59830b(0xfd)),indexUtil=require('./indexUtil'),movieUtil=require(_0x59830b(0xd5)),indexTableName=dbFileIndexTable[_0x59830b(0xe2)],movieIndexUtil={};function _0x3652(_0xdb30a3,_0xb6707d){const _0x179f2f=_0x179f();return _0x3652=function(_0x36525e,_0x45d905){_0x36525e=_0x36525e-0xd4;let _0x5e2af5=_0x179f2f[_0x36525e];return _0x5e2af5;},_0x3652(_0xdb30a3,_0xb6707d);}movieIndexUtil[_0x59830b(0x106)]=!![];let lastDealTvDramaTimestamp=0x0;movieIndexUtil[_0x59830b(0x118)]=async function(_0x54942f,_0x1b67b5,_0x5b1b41){const _0x3cc0a0=_0x59830b;await indexUtil[_0x3cc0a0(0x118)](_0x54942f,_0x1b67b5,_0x5b1b41,indexTableName,movieIndexUtil[_0x3cc0a0(0x124)],movieIndexUtil[_0x3cc0a0(0x12c)]);return;},movieIndexUtil[_0x59830b(0x12c)]=async function(_0x39e9f8,_0x126939,_0x235bf8){const _0x55abe8=_0x59830b;return await indexUtil[_0x55abe8(0x12c)](_0x39e9f8,_0x126939,indexTableName,_0x55abe8(0x112),_0x235bf8,movieIndexUtil[_0x55abe8(0x124)],()=>{const _0x65b37e=_0x55abe8;let _0x99ab12=new Date()[_0x65b37e(0x113)]()-lastDealTvDramaTimestamp;movieIndexUtil[_0x65b37e(0x106)]&&_0x99ab12>0x1d4c0&&(movieIndexUtil[_0x65b37e(0x10e)](_0x126939),lastDealTvDramaTimestamp=new Date()[_0x65b37e(0x113)]());});},movieIndexUtil['addFileIndexToDb']=async function(_0xf2b434,_0x20396b,_0x2e3844,_0x14ccd6,_0x2ae832,_0x1a5bd5){const _0x4f688c=_0x59830b;let _0x1c8a48={'path':_0x2e3844,'filename':_0x14ccd6,'is_file':_0x2ae832},_0x311abb=indexUtil[_0x4f688c(0xf1)](_0xf2b434,_0x4f688c(0x112),config,_0x2e3844,_0x14ccd6);if(!_0x311abb)return;_0x311abb[_0x4f688c(0xde)]=='tvplay'&&(_0x1c8a48[_0x4f688c(0xfa)]=0x1,_0x1c8a48['show_in_list']=0x0);let _0x25cbee=_0x1a5bd5['birthtimeMs'];_0x1a5bd5[_0x4f688c(0x10f)]<_0x25cbee&&(_0x25cbee=_0x1a5bd5[_0x4f688c(0x10f)]),_0x1a5bd5[_0x4f688c(0x11d)]<_0x25cbee&&(_0x25cbee=_0x1a5bd5[_0x4f688c(0x11d)]),_0x1a5bd5[_0x4f688c(0xe3)]<_0x25cbee&&(_0x25cbee=_0x1a5bd5[_0x4f688c(0xe3)]),_0x1c8a48={..._0x1c8a48,'ctime':_0x1a5bd5[_0x4f688c(0xe3)],'mtime':_0x1a5bd5[_0x4f688c(0x10f)],'ext':path[_0x4f688c(0xe0)](_0x14ccd6),'birthtime':Math[_0x4f688c(0x125)](_0x25cbee),'size':_0x1a5bd5[_0x4f688c(0xdb)],'check_time':new Date()[_0x4f688c(0x113)]()},_0x1c8a48=await movieIndexUtil[_0x4f688c(0xf9)](_0x20396b,_0x1c8a48);},movieIndexUtil[_0x59830b(0xf9)]=async function(_0x414d9a,_0x2ebf77){const _0x14b021=_0x59830b;let _0x1d031d=![],_0x2a3b6e=path[_0x14b021(0xe8)](_0x2ebf77[_0x14b021(0x115)],_0x2ebf77[_0x14b021(0xfe)]);if(_0x2ebf77[_0x14b021(0xe1)]==0x1&&_0x2ebf77[_0x14b021(0x12b)]&&(config['imgTypeList'][_0x14b021(0xf2)](_0x2ebf77[_0x14b021(0x12b)][_0x14b021(0x104)]())||config[_0x14b021(0x123)]['includes'](_0x2ebf77[_0x14b021(0x12b)]['toLowerCase']()))){_0x2ebf77[_0x14b021(0xdf)]=0x1;try{let {tags:_0x157936,dealedIndexObj:_0x54ffd1}=await exifUtil[_0x14b021(0xf3)](_0x2a3b6e,_0x2ebf77);return movieIndexUtil[_0x14b021(0x133)](_0x414d9a,_0x54ffd1[_0x14b021(0xf5)],_0x54ffd1);}catch(_0x12f49d){return movieIndexUtil['addOriginalDate'](_0x414d9a,_0x1d031d,_0x2ebf77);}}else{if(_0x2ebf77['is_file']==0x1&&_0x2ebf77[_0x14b021(0x12b)]&&config[_0x14b021(0x120)][_0x14b021(0xf2)](_0x2ebf77['ext']['toLowerCase']())){_0x2ebf77[_0x14b021(0xdf)]=0x2;try{let _0x2be4ba=await indexUtil[_0x14b021(0x109)](_0x2a3b6e),_0x23da71=0x0,_0x6ea16e=0x0;if(_0x2be4ba&&_0x2be4ba[_0x14b021(0x103)]&&_0x2be4ba[_0x14b021(0x103)][_0x14b021(0xfb)]>0x0){_0x2ebf77[_0x14b021(0x111)]=JSON[_0x14b021(0x114)](_0x2be4ba[_0x14b021(0x103)]);let _0x587ad3=videoStreamUtil[_0x14b021(0x105)](_0x2be4ba['streams']);_0x2ebf77[_0x14b021(0x117)]=_0x587ad3[_0x14b021(0xe7)],_0x2ebf77[_0x14b021(0xeb)]=_0x587ad3[_0x14b021(0xec)];let _0x1053f3=videoStreamUtil[_0x14b021(0xe6)](_0x2be4ba);_0x1053f3&&(_0x2ebf77['duration']=_0x1053f3);}if(_0x2be4ba&&_0x2be4ba['format']&&_0x2be4ba[_0x14b021(0x12d)]['tags']){let _0x35bd66=_0x2be4ba[_0x14b021(0x12d)][_0x14b021(0x131)]['com.apple.quicktime.location.ISO6709'],_0x4519e6=_0x2be4ba[_0x14b021(0x12d)][_0x14b021(0x131)]['com.apple.quicktime.model'],_0x5aa4e9=_0x2be4ba[_0x14b021(0x12d)][_0x14b021(0x131)][_0x14b021(0xee)];_0x4519e6&&(_0x2ebf77[_0x14b021(0xf6)]=_0x4519e6);_0x5aa4e9&&(_0x1d031d=_0x5aa4e9);!_0x1d031d&&_0x2be4ba[_0x14b021(0x12d)][_0x14b021(0x131)]['creation_time']&&(_0x1d031d=_0x2be4ba[_0x14b021(0x12d)][_0x14b021(0x131)][_0x14b021(0xfc)]);function _0xeb86b3(_0x1cf73a){const _0x39f113=_0x14b021;let _0x51ec73=[];for(let _0x28b5dc=0x0;_0x28b5dc<_0x1cf73a[_0x39f113(0xfb)];_0x28b5dc++){(_0x1cf73a[_0x28b5dc]=='+'||_0x1cf73a[_0x28b5dc]=='-')&&_0x51ec73[_0x39f113(0x119)](_0x28b5dc);}if(_0x51ec73['length']==0x2)_0x23da71=_0x1cf73a['substring'](_0x51ec73[0x0],_0x51ec73[0x1]),_0x6ea16e=_0x1cf73a[_0x39f113(0xef)](_0x51ec73[0x1]);else _0x51ec73['length']>=0x3&&(_0x23da71=_0x1cf73a['substring'](_0x51ec73[0x0],_0x51ec73[0x1]),_0x6ea16e=_0x1cf73a[_0x39f113(0xef)](_0x51ec73[0x1],_0x51ec73[0x2]));}_0x35bd66&&_0xeb86b3(_0x35bd66);let _0x27a294=_0x2be4ba[_0x14b021(0x12d)][_0x14b021(0x131)][_0x14b021(0xf0)]||_0x2be4ba[_0x14b021(0x12d)][_0x14b021(0x131)][_0x14b021(0x10a)];_0x27a294&&!_0x23da71&&(_0x27a294=_0x27a294[_0x14b021(0xf4)]('/',''),_0xeb86b3(_0x27a294)),_0x2be4ba[_0x14b021(0x12d)][_0x14b021(0x107)]&&(_0x2ebf77[_0x14b021(0x107)]=_0x2be4ba['format']['duration']);}return _0x2ebf77[_0x14b021(0xd9)]=_0x23da71,_0x2ebf77['longitude']=_0x6ea16e,movieIndexUtil[_0x14b021(0x133)](_0x414d9a,_0x1d031d,_0x2ebf77);}catch(_0x1de916){return movieIndexUtil['addOriginalDate'](_0x414d9a,_0x1d031d,_0x2ebf77);}}else{if(_0x2ebf77[_0x14b021(0xe1)]==0x1)return;return movieIndexUtil[_0x14b021(0x133)](_0x414d9a,_0x1d031d,_0x2ebf77);}}},movieIndexUtil['addOriginalDate']=function(_0xd496bb,_0xcd0f3b,_0x4419e0){const _0x4a758c=_0x59830b;_0xcd0f3b&&_0xcd0f3b<config[_0x4a758c(0xdd)]&&(_0xcd0f3b=![]);!_0xcd0f3b&&(_0xcd0f3b=_0x4419e0[_0x4a758c(0xe5)]||_0x4419e0['ctime']);let _0x50efd3=new Date(_0xcd0f3b);_0x4419e0[_0x4a758c(0xda)]=_0x50efd3[_0x4a758c(0x113)]();let _0x1f700f=_0x50efd3[_0x4a758c(0x11b)](),_0xea828a=_0x50efd3['getMonth']()+0x1;_0xea828a=_0xea828a>=0xa?_0xea828a:'0'+_0xea828a;let _0xc64ff4=_0x50efd3['getDate']();_0xc64ff4=_0xc64ff4>=0xa?_0xc64ff4:'0'+_0xc64ff4,_0x4419e0['original_date']=_0x1f700f+'-'+_0xea828a+'-'+_0xc64ff4,movieIndexUtil[_0x4a758c(0x12a)](_0xd496bb,_0x4419e0);},movieIndexUtil['addFinalIndexToDB']=function(_0x3f4f87,_0x3abb2c){const _0x4a1f38=_0x59830b;_0x3abb2c[_0x4a1f38(0xfa)]==0x1&&_0x3abb2c[_0x4a1f38(0xdf)]==0x2&&(movieIndexUtil[_0x4a1f38(0x106)]=!![]);_0x3abb2c['filenameNumber']=movieUtil[_0x4a1f38(0x12e)](_0x3abb2c['filename']);let _0x3c8286=dbFileIndexTable[_0x4a1f38(0xea)](_0x3f4f87,_0x3abb2c,indexTableName),_0x35e9d8=_0x3abb2c[_0x4a1f38(0x115)][_0x4a1f38(0x104)]();try{if(_0x35e9d8[_0x4a1f38(0x110)](_0x4a1f38(0x11e))||_0x35e9d8[_0x4a1f38(0x110)](_0x4a1f38(0x11a))){_0x3f4f87[_0x4a1f38(0xff)](_0x4a1f38(0x12f)+indexTableName+_0x4a1f38(0x10d))['run'](_0x3abb2c[_0x4a1f38(0x115)]);let _0x266d3b=_0x3abb2c['path'][_0x4a1f38(0xf4)](_0x4a1f38(0x11e),'')[_0x4a1f38(0xf4)](_0x4a1f38(0x11a),'')[_0x4a1f38(0xf4)]('\x5cBDMV\x5cSTREAM','')[_0x4a1f38(0xf4)]('/BDMV/STREAM','');_0x266d3b=path[_0x4a1f38(0x10b)](_0x266d3b),_0x3f4f87['prepare'](_0x4a1f38(0x12f)+indexTableName+_0x4a1f38(0xe9))['run'](_0x266d3b,_0x3abb2c[_0x4a1f38(0x115)]);}}catch(_0x116379){}let _0x37b612=dbFileIndexTable[_0x4a1f38(0x129)](_0x3f4f87,_0x3c8286[_0x4a1f38(0x121)],indexTableName);_0x37b612&&movieUtil[_0x4a1f38(0x11f)](_0x3f4f87,_0x37b612);};function _0x179f(){const _0x52bcbc=['4290902pcsteh','4UQDHoL','../../myConfig/config','streams','toLowerCase','parseVideoWH','needDealTvDrama','duration','exports','ffprobeSync','location-eng','basename','影音管理：设置电视剧状态出错','\x20SET\x20show_in_list\x20=\x200\x20WHERE\x20path=?','dealTvDrama','mtimeMs','endsWith','stream_info','movie','getTime','stringify','path','log','width','dealFileChange','push','/bdmv/stream','getFullYear','2830878oBtEXv','atimeMs','\x5cbdmv\x5cstream','dealFirstLetterSingle','videoTypeList','lastInsertRowid','1513779CiiujP','rawImgTypeList','addFileIndexToDb','ceil','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x201\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20IN\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20t1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x20t1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INNER\x20JOIN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20path,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min(filename)\x20AS\x20filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x20path\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t2\x20ON\x20t1.path\x20=\x20t2.path\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t1.filename\x20=\x20t2.filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20show_in_list\x20=\x201;','15Gykckz','getById','addFinalIndexToDB','ext','recursionFilesAddIndex','format','getFilenameNumber','UPDATE\x20','639135ImKIwF','tags','transaction','addOriginalDate','run','../../express-server/utils/movieUtil','影音管理：电视剧状态处理完成,耗时:','143142dWJZzB','../../utils/exifUtils','latitude','original_time','size','2NLShPe','exifMinTimeStamp','media_type','type','extname','is_file','INDEX_TABLE_NAME_MOVIE','ctimeMs','7596160bygeuz','birthtime','getDurationFromStream','videoWidth','join','\x20as\x20t\x20SET\x20show_in_list\x20=\x201,show_name=?\x20WHERE\x20path=?\x20AND\x20duration>1800','create','height','videoHeight','130GcAfCz','com.apple.quicktime.creationdate','substring','location','doesPathCanAddToDb','includes','getExifInfo','replace','originalTime','mode','6878865vHUxjd','../../db/dbFileIndexTable','dealMediaInfo','is_tvplay','length','creation_time','../../utils/videoStreamUtil','filename','prepare'];_0x179f=function(){return _0x52bcbc;};return _0x179f();}let tvDramaIsDealing=![];movieIndexUtil[_0x59830b(0x10e)]=function(_0x52d440){const _0x39bdc3=_0x59830b;if(!movieIndexUtil['needDealTvDrama'])return;if(tvDramaIsDealing)return;tvDramaIsDealing=!![];let _0x68aefc=new Date()[_0x39bdc3(0x113)]();try{let _0x2dfa80=_0x39bdc3(0x127),_0x5a4087=_0x39bdc3(0x126),_0x54f1f7=_0x52d440[_0x39bdc3(0x132)](()=>{const _0x82d010=_0x39bdc3;_0x52d440[_0x82d010(0xff)](_0x2dfa80)[_0x82d010(0xd4)](),_0x52d440[_0x82d010(0xff)](_0x5a4087)[_0x82d010(0xd4)]();}),_0x2413ac=new Date()['getTime']();_0x54f1f7(),console[_0x39bdc3(0x116)](_0x39bdc3(0xd6),(_0x2413ac-_0x68aefc)/0x3e8+'s');}catch(_0x415320){console['log'](_0x39bdc3(0x10c),_0x415320);}tvDramaIsDealing=![],movieIndexUtil['needDealTvDrama']=![];},module[_0x59830b(0x108)]=movieIndexUtil;