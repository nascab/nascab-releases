const _0x445960=_0x5a53;function _0x44a8(){const _0x304c60=['bookCoverCachePath','235194UuCTYg','error','book-type','4ioaXjm','toLowerCase','then','封面缓存已经存在','close','678444BUvHUE','path','getZipCover','join','exit','artist','title','../../utils/zipUtil','language','mobi','ext','log','.epub','4875174DewWQy','readFileSync','metadata','cover','unzlibSync','publisher','from','worker_threads','err2','2347919aKboJp','EPUB写入书籍封面缓存：','coverPath','dealedBuffer','.cbr','type','2224384fYwYZI','creator','.cbz','MOBI写入书籍封面缓存：','.rar','.zip','没有找到需要处理的书籍目录','fileCount','1146MPYiFN','8485BwJCHr','metadata_state','filename','471554PMoJwc','existsSync','getCover','indexObj','comic','epub解析失败','getTime','.azw','getImage','epub'];_0x44a8=function(){return _0x304c60;};return _0x44a8();}(function(_0x5b7f2c,_0x5f0994){const _0xfd9a34=_0x5a53,_0x2f0012=_0x5b7f2c();while(!![]){try{const _0x3e7b16=parseInt(_0xfd9a34(0x142))/0x1+-parseInt(_0xfd9a34(0x137))/0x2+-parseInt(_0xfd9a34(0x10f))/0x3*(parseInt(_0xfd9a34(0x145))/0x4)+-parseInt(_0xfd9a34(0x134))/0x5*(-parseInt(_0xfd9a34(0x133))/0x6)+parseInt(_0xfd9a34(0x125))/0x7+parseInt(_0xfd9a34(0x12b))/0x8+-parseInt(_0xfd9a34(0x11c))/0x9;if(_0x3e7b16===_0x5f0994)break;else _0x2f0012['push'](_0x2f0012['shift']());}catch(_0x15231f){_0x2f0012['push'](_0x2f0012['shift']());}}}(_0x44a8,0x294d7));const {parentPort,workerData}=require(_0x445960(0x123)),EPub=require(_0x445960(0x140)),mobiNode=require('./bookMobiNode'),mobiJs=require(_0x445960(0x118)),fflate=require('./bookFflate'),fs=require('fs'),path=require(_0x445960(0x110));let originalTime=null,coverData=null,zipUtil=require(_0x445960(0x116));function returnResult(){const _0x44b582=_0x445960;parentPort['postMessage']({'code':0x0,'indexObj':workerData[_0x44b582(0x13a)],'originalTime':originalTime,'coverData':coverData}),process[_0x44b582(0x113)](0x0);}async function genBookInfoMobi(_0x470528){const _0x319071=_0x445960;if(!workerData['onlyGenCover'])try{let _0x42237c=new mobiJs(_0x470528);_0x42237c['title']&&(workerData[_0x319071(0x13a)]['title']=_0x42237c[_0x319071(0x115)]),workerData[_0x319071(0x13a)]['metadata_state']=0x1;}catch(_0x12a34c){}try{if(fs[_0x319071(0x138)](workerData[_0x319071(0x141)]))return console[_0x319071(0x11a)](_0x319071(0x148),workerData[_0x319071(0x13a)][_0x319071(0x136)]),workerData[_0x319071(0x13a)][_0x319071(0x127)]=workerData[_0x319071(0x141)],returnResult();let _0x652d83=fs[_0x319071(0x11d)](_0x470528),_0x3dc763=await new mobiNode['MOBI']({'unzlib':fflate[_0x319071(0x120)]})['open'](new Uint8Array(_0x652d83)),_0x23ebcc=await _0x3dc763[_0x319071(0x139)]();if(!_0x23ebcc)return returnResult();return console['log'](_0x319071(0x12e),workerData['indexObj']['filename']),coverData=Buffer[_0x319071(0x122)](_0x23ebcc),returnResult();}catch(_0x5d64a3){return console[_0x319071(0x11a)](_0x319071(0x124),_0x5d64a3),returnResult();}}function _0x5a53(_0x5b7f38,_0x1e8fe0){const _0x44a8bd=_0x44a8();return _0x5a53=function(_0x5a537c,_0x1de693){_0x5a537c=_0x5a537c-0x10f;let _0x2e934b=_0x44a8bd[_0x5a537c];return _0x2e934b;},_0x5a53(_0x5b7f38,_0x1e8fe0);}async function genBookInfoEpub(_0x5cf136){let _0x3ff403=new EPub(_0x5cf136);_0x3ff403['on']('end',function(){const _0x3e5326=_0x5a53;if(_0x3ff403[_0x3e5326(0x11e)]){let _0x13cf71=_0x3ff403[_0x3e5326(0x11e)];_0x13cf71[_0x3e5326(0x12c)]&&(workerData[_0x3e5326(0x13a)][_0x3e5326(0x114)]=_0x13cf71['creator']);_0x13cf71['publisher']&&(workerData['indexObj'][_0x3e5326(0x121)]=_0x13cf71[_0x3e5326(0x121)]);_0x13cf71['language']&&(workerData[_0x3e5326(0x13a)][_0x3e5326(0x117)]=_0x13cf71['language']);_0x13cf71[_0x3e5326(0x115)]&&(workerData[_0x3e5326(0x13a)][_0x3e5326(0x115)]=_0x13cf71[_0x3e5326(0x115)]);_0x13cf71[_0x3e5326(0x144)]&&(console['log']('book-type',_0x13cf71[_0x3e5326(0x144)]),_0x13cf71[_0x3e5326(0x144)]==_0x3e5326(0x13b)&&(workerData[_0x3e5326(0x13a)][_0x3e5326(0x12a)]=0x2));if(_0x13cf71['date'])try{originalTime=new Date(_0x13cf71['date'])[_0x3e5326(0x13d)]();}catch(_0x4eaaba){console[_0x3e5326(0x11a)](_0x4eaaba);}workerData[_0x3e5326(0x13a)][_0x3e5326(0x135)]=0x1;if(fs[_0x3e5326(0x138)](workerData[_0x3e5326(0x141)]))return console[_0x3e5326(0x11a)]('封面缓存已经存在',workerData[_0x3e5326(0x13a)][_0x3e5326(0x136)]),workerData[_0x3e5326(0x13a)][_0x3e5326(0x127)]=workerData['bookCoverCachePath'],returnResult();_0x3ff403['metadata'][_0x3e5326(0x11f)]?_0x3ff403[_0x3e5326(0x13f)](_0x3ff403[_0x3e5326(0x11e)][_0x3e5326(0x11f)],async(_0x9706f8,_0x1153bd,_0x28a170)=>{const _0x331dbf=_0x3e5326;return console[_0x331dbf(0x11a)](_0x331dbf(0x126),workerData[_0x331dbf(0x141)]),coverData=_0x1153bd,returnResult();}):returnResult();}else returnResult();}),_0x3ff403['on']('error',()=>{const _0x3fbdb8=_0x5a53;console[_0x3fbdb8(0x11a)](_0x3fbdb8(0x13c),_0x5cf136),returnResult();}),_0x3ff403['parse']();}async function genBookInfoZip(_0xd01532){const _0x405aa9=_0x445960;zipUtil[_0x405aa9(0x111)](_0xd01532)[_0x405aa9(0x147)](_0xf8e777=>{const _0x3b2d36=_0x405aa9;if(!_0xf8e777)return console[_0x3b2d36(0x11a)]('未找到封面',_0xd01532),returnResult();let _0x5dd9a3=_0xf8e777[_0x3b2d36(0x128)],_0x237b67=_0xf8e777[_0x3b2d36(0x132)];_0x5dd9a3&&(coverData=_0x5dd9a3),_0x237b67&&(workerData[_0x3b2d36(0x13a)]['total_page']=_0x237b67),returnResult();})['catch'](_0x3ca759=>{const _0x23cebb=_0x405aa9;console[_0x23cebb(0x11a)](_0x3ca759);});}if(workerData&&workerData['indexObj']&&workerData[_0x445960(0x141)]){let bookFullPath=path[_0x445960(0x112)](workerData[_0x445960(0x13a)]['path'],workerData['indexObj'][_0x445960(0x136)]),lowerExt=workerData[_0x445960(0x13a)][_0x445960(0x119)][_0x445960(0x146)]();if(fs[_0x445960(0x138)](bookFullPath)){if(lowerExt==_0x445960(0x11b))genBookInfoEpub(bookFullPath);else{if(lowerExt=='.mobi'||lowerExt=='.azw3'||lowerExt==_0x445960(0x13e))genBookInfoMobi(bookFullPath);else lowerExt==_0x445960(0x12d)||lowerExt==_0x445960(0x130)||lowerExt==_0x445960(0x129)||lowerExt==_0x445960(0x12f)?genBookInfoZip(bookFullPath):returnResult();}}else returnResult();}else console['log'](_0x445960(0x131)),returnResult();parentPort['on'](_0x445960(0x143),_0x10dedd=>{const _0x59a844=_0x445960;console[_0x59a844(0x143)]('Worker\x20error:',_0x10dedd),returnResult();}),parentPort['on'](_0x445960(0x149),()=>{const _0x5bccf=_0x445960;console[_0x5bccf(0x11a)]('Worker\x20stopped.');});