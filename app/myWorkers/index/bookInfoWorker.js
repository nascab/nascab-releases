const _0xa2cc06=_0x5345;(function(_0x254412,_0x4e711f){const _0x2fe4dc=_0x5345,_0x504456=_0x254412();while(!![]){try{const _0x5e7b0b=parseInt(_0x2fe4dc(0xa1))/0x1+-parseInt(_0x2fe4dc(0xae))/0x2+parseInt(_0x2fe4dc(0x9b))/0x3+parseInt(_0x2fe4dc(0x8b))/0x4*(-parseInt(_0x2fe4dc(0x82))/0x5)+parseInt(_0x2fe4dc(0x85))/0x6+-parseInt(_0x2fe4dc(0x89))/0x7+-parseInt(_0x2fe4dc(0xad))/0x8;if(_0x5e7b0b===_0x4e711f)break;else _0x504456['push'](_0x504456['shift']());}catch(_0x3ac677){_0x504456['push'](_0x504456['shift']());}}}(_0x3d7f,0x63ea2));const {parentPort,workerData}=require('worker_threads'),EPub=require(_0xa2cc06(0xb2)),mobiNode=require('./bookMobiNode'),mobiJs=require(_0xa2cc06(0x96)),fflate=require('./bookFflate'),fs=require('fs'),path=require(_0xa2cc06(0xb0));let originalTime=null,coverData=null,zipUtil=require(_0xa2cc06(0x9d));function returnResult(){const _0x597edb=_0xa2cc06;parentPort[_0x597edb(0x9e)]({'code':0x0,'indexObj':workerData[_0x597edb(0xb6)],'originalTime':originalTime,'coverData':coverData}),process[_0x597edb(0x9a)](0x0);}async function genBookInfoMobi(_0x471ec1){const _0x124266=_0xa2cc06;if(!workerData['onlyGenCover'])try{let _0x5c3309=new mobiJs(_0x471ec1);_0x5c3309[_0x124266(0x9c)]&&(workerData['indexObj'][_0x124266(0x9c)]=_0x5c3309['title']),workerData[_0x124266(0xb6)][_0x124266(0xb3)]=0x1;}catch(_0x5d6ed8){}try{if(fs[_0x124266(0x94)](workerData[_0x124266(0x87)]))return console[_0x124266(0xac)](_0x124266(0xba),workerData[_0x124266(0xb6)]['filename']),workerData[_0x124266(0xb6)][_0x124266(0x8e)]=workerData[_0x124266(0x87)],returnResult();let _0x1c3bf6=fs['readFileSync'](_0x471ec1),_0x1fc7e0=await new mobiNode[(_0x124266(0x8d))]({'unzlib':fflate[_0x124266(0x8f)]})[_0x124266(0xa5)](new Uint8Array(_0x1c3bf6)),_0xaa8e2d=await _0x1fc7e0['getCover']();if(!_0xaa8e2d)return returnResult();return console[_0x124266(0xac)]('MOBI写入书籍封面缓存：',workerData['indexObj'][_0x124266(0x95)]),coverData=Buffer['from'](_0xaa8e2d),returnResult();}catch(_0x1f6ed0){return console[_0x124266(0xac)](_0x124266(0x9f),_0x1f6ed0),returnResult();}}async function genBookInfoEpub(_0x240fe0){const _0x384108=_0xa2cc06;let _0x387d4b=new EPub(_0x240fe0);_0x387d4b['on'](_0x384108(0xab),function(){const _0x4106de=_0x384108;if(_0x387d4b['metadata']){let _0x29f221=_0x387d4b[_0x4106de(0xa4)];_0x29f221[_0x4106de(0xb5)]&&(workerData[_0x4106de(0xb6)]['artist']=_0x29f221['creator']);_0x29f221[_0x4106de(0x91)]&&(workerData['indexObj']['publisher']=_0x29f221[_0x4106de(0x91)]);_0x29f221['language']&&(workerData[_0x4106de(0xb6)][_0x4106de(0x98)]=_0x29f221[_0x4106de(0x98)]);_0x29f221[_0x4106de(0x9c)]&&(workerData[_0x4106de(0xb6)][_0x4106de(0x9c)]=_0x29f221['title']);_0x29f221[_0x4106de(0xa0)]&&(console[_0x4106de(0xac)]('book-type',_0x29f221[_0x4106de(0xa0)]),_0x29f221[_0x4106de(0xa0)]==_0x4106de(0x84)&&(workerData['indexObj'][_0x4106de(0x93)]=0x2));if(_0x29f221['date'])try{originalTime=new Date(_0x29f221[_0x4106de(0xb4)])[_0x4106de(0xa9)]();}catch(_0x1ff065){console['log'](_0x1ff065);}workerData[_0x4106de(0xb6)][_0x4106de(0xb3)]=0x1;if(fs[_0x4106de(0x94)](workerData[_0x4106de(0x87)]))return console['log'](_0x4106de(0xba),workerData[_0x4106de(0xb6)][_0x4106de(0x95)]),workerData['indexObj'][_0x4106de(0x8e)]=workerData[_0x4106de(0x87)],returnResult();_0x387d4b[_0x4106de(0xa4)]['cover']?_0x387d4b[_0x4106de(0x90)](_0x387d4b[_0x4106de(0xa4)]['cover'],async(_0x3a199f,_0x715151,_0x362dc7)=>{const _0x10534b=_0x4106de;return console[_0x10534b(0xac)](_0x10534b(0xb9),workerData[_0x10534b(0x87)]),coverData=_0x715151,returnResult();}):returnResult();}else returnResult();}),_0x387d4b['on'](_0x384108(0xa7),()=>{const _0x18bf11=_0x384108;console['log'](_0x18bf11(0xb7),_0x240fe0),returnResult();}),_0x387d4b[_0x384108(0xb1)]();}function _0x3d7f(){const _0x56a733=['parse','epub','metadata_state','date','creator','indexObj','epub解析失败','total_page','EPUB写入书籍封面缓存：','封面缓存已经存在','没有找到需要处理的书籍目录','232745teESra','.cbr','comic','4900194HMhQoH','.cbz','bookCoverCachePath','then','3522722wreMrk','catch','16nBFUkD','getZipCover','MOBI','coverPath','unzlibSync','getImage','publisher','dealedBuffer','type','existsSync','filename','mobi','.azw','language','.mobi','exit','1065384Cqvttf','title','../../utils/zipUtil','postMessage','err2','book-type','350456iSuiIJ','Worker\x20error:','.zip','metadata','open','Worker\x20stopped.','error','close','getTime','.rar','end','log','2334952hgNncm','263444jwfmPr','join','path'];_0x3d7f=function(){return _0x56a733;};return _0x3d7f();}async function genBookInfoZip(_0xb949ad){const _0x569a5e=_0xa2cc06;zipUtil[_0x569a5e(0x8c)](_0xb949ad)[_0x569a5e(0x88)](_0x15c4eb=>{const _0x38e7ba=_0x569a5e;if(!_0x15c4eb)return console[_0x38e7ba(0xac)]('未找到封面',_0xb949ad),returnResult();let _0x23b761=_0x15c4eb[_0x38e7ba(0x92)],_0x403d4e=_0x15c4eb['fileCount'];_0x23b761&&(coverData=_0x23b761),_0x403d4e&&(workerData[_0x38e7ba(0xb6)][_0x38e7ba(0xb8)]=_0x403d4e),returnResult();})[_0x569a5e(0x8a)](_0x3d1641=>{console['log'](_0x3d1641);});}function _0x5345(_0x101fd,_0x16348f){const _0x3d7f7d=_0x3d7f();return _0x5345=function(_0x5345b4,_0x3f246a){_0x5345b4=_0x5345b4-0x82;let _0x5d11b2=_0x3d7f7d[_0x5345b4];return _0x5d11b2;},_0x5345(_0x101fd,_0x16348f);}if(workerData&&workerData[_0xa2cc06(0xb6)]&&workerData['bookCoverCachePath']){let bookFullPath=path[_0xa2cc06(0xaf)](workerData[_0xa2cc06(0xb6)][_0xa2cc06(0xb0)],workerData['indexObj'][_0xa2cc06(0x95)]),lowerExt=workerData[_0xa2cc06(0xb6)]['ext']['toLowerCase']();if(fs[_0xa2cc06(0x94)](bookFullPath)){if(lowerExt=='.epub')genBookInfoEpub(bookFullPath);else{if(lowerExt==_0xa2cc06(0x99)||lowerExt=='.azw3'||lowerExt==_0xa2cc06(0x97))genBookInfoMobi(bookFullPath);else lowerExt==_0xa2cc06(0x86)||lowerExt==_0xa2cc06(0xa3)||lowerExt==_0xa2cc06(0x83)||lowerExt==_0xa2cc06(0xaa)?genBookInfoZip(bookFullPath):returnResult();}}else returnResult();}else console[_0xa2cc06(0xac)](_0xa2cc06(0xbb)),returnResult();parentPort['on'](_0xa2cc06(0xa7),_0x1fafa4=>{const _0x32ef40=_0xa2cc06;console[_0x32ef40(0xa7)](_0x32ef40(0xa2),_0x1fafa4),returnResult();}),parentPort['on'](_0xa2cc06(0xa8),()=>{const _0x1ef291=_0xa2cc06;console[_0x1ef291(0xac)](_0x1ef291(0xa6));});