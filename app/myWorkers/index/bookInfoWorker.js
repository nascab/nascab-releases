const _0x1cbbb9=_0x208c;(function(_0x2006e1,_0x52f813){const _0x12a8ec=_0x208c,_0x4815bc=_0x2006e1();while(!![]){try{const _0x3bf46c=parseInt(_0x12a8ec(0x1b1))/0x1*(parseInt(_0x12a8ec(0x1d0))/0x2)+parseInt(_0x12a8ec(0x1cc))/0x3*(-parseInt(_0x12a8ec(0x1c9))/0x4)+-parseInt(_0x12a8ec(0x1d2))/0x5*(parseInt(_0x12a8ec(0x1ca))/0x6)+-parseInt(_0x12a8ec(0x1ad))/0x7*(-parseInt(_0x12a8ec(0x1b5))/0x8)+parseInt(_0x12a8ec(0x1a2))/0x9*(parseInt(_0x12a8ec(0x1c0))/0xa)+-parseInt(_0x12a8ec(0x1a8))/0xb*(parseInt(_0x12a8ec(0x1c2))/0xc)+-parseInt(_0x12a8ec(0x1d5))/0xd*(parseInt(_0x12a8ec(0x191))/0xe);if(_0x3bf46c===_0x52f813)break;else _0x4815bc['push'](_0x4815bc['shift']());}catch(_0x346035){_0x4815bc['push'](_0x4815bc['shift']());}}}(_0x358e,0x4dec3));const {parentPort,workerData}=require(_0x1cbbb9(0x1ce)),EPub=require(_0x1cbbb9(0x1a4)),mobiNode=require(_0x1cbbb9(0x1be)),mobiJs=require(_0x1cbbb9(0x19c)),fflate=require(_0x1cbbb9(0x1c1)),fs=require('fs'),path=require(_0x1cbbb9(0x1b7));let originalTime=null,coverData=null,zipUtil=require(_0x1cbbb9(0x1d1));function returnResult(){const _0x59f961=_0x1cbbb9;parentPort['postMessage']({'code':0x0,'indexObj':workerData['indexObj'],'originalTime':originalTime,'coverData':coverData}),process[_0x59f961(0x1b2)](0x0);}async function genBookInfoMobi(_0x2dfc88){const _0x599553=_0x1cbbb9;if(!workerData[_0x599553(0x1a3)])try{let _0x5e0689=new mobiJs(_0x2dfc88);_0x5e0689[_0x599553(0x1b3)]&&(workerData[_0x599553(0x199)][_0x599553(0x1b3)]=_0x5e0689['title']),workerData[_0x599553(0x199)][_0x599553(0x1d4)]=0x1;}catch(_0x563ce5){}try{if(fs[_0x599553(0x1c5)](workerData['bookCoverCachePath']))return console[_0x599553(0x19a)](_0x599553(0x1a7),workerData['indexObj'][_0x599553(0x1bf)]),workerData[_0x599553(0x199)][_0x599553(0x1bc)]=workerData[_0x599553(0x19e)],returnResult();let _0x1fe34d=fs[_0x599553(0x1c3)](_0x2dfc88),_0x324c35=await new mobiNode[(_0x599553(0x190))]({'unzlib':fflate[_0x599553(0x1a0)]})[_0x599553(0x1a9)](new Uint8Array(_0x1fe34d)),_0x135a8e=await _0x324c35[_0x599553(0x19f)]();if(!_0x135a8e)return returnResult();return console[_0x599553(0x19a)](_0x599553(0x195),workerData[_0x599553(0x199)][_0x599553(0x1bf)]),coverData=Buffer['from'](_0x135a8e),returnResult();}catch(_0x284f08){return console[_0x599553(0x19a)](_0x599553(0x1c7),_0x284f08),returnResult();}}async function genBookInfoEpub(_0x1a5e46){const _0x3820d8=_0x1cbbb9;let _0x3f5d0f=new EPub(_0x1a5e46);_0x3f5d0f['on'](_0x3820d8(0x198),function(){const _0x50a23b=_0x3820d8;if(_0x3f5d0f['metadata']){let _0x336389=_0x3f5d0f[_0x50a23b(0x1cd)];_0x336389[_0x50a23b(0x1bb)]&&(workerData[_0x50a23b(0x199)][_0x50a23b(0x1c6)]=_0x336389[_0x50a23b(0x1bb)]);_0x336389[_0x50a23b(0x1a1)]&&(workerData[_0x50a23b(0x199)][_0x50a23b(0x1a1)]=_0x336389[_0x50a23b(0x1a1)]);_0x336389[_0x50a23b(0x1b0)]&&(workerData['indexObj'][_0x50a23b(0x1b0)]=_0x336389[_0x50a23b(0x1b0)]);_0x336389['title']&&(workerData[_0x50a23b(0x199)][_0x50a23b(0x1b3)]=_0x336389[_0x50a23b(0x1b3)]);_0x336389[_0x50a23b(0x1b4)]&&(console[_0x50a23b(0x19a)]('book-type',_0x336389['book-type']),_0x336389[_0x50a23b(0x1b4)]==_0x50a23b(0x1d3)&&(workerData[_0x50a23b(0x199)]['type']=0x2));if(_0x336389[_0x50a23b(0x1d6)])try{originalTime=new Date(_0x336389[_0x50a23b(0x1d6)])[_0x50a23b(0x193)]();}catch(_0x4cf859){console['log'](_0x4cf859);}workerData[_0x50a23b(0x199)][_0x50a23b(0x1d4)]=0x1;if(fs[_0x50a23b(0x1c5)](workerData[_0x50a23b(0x19e)]))return console[_0x50a23b(0x19a)](_0x50a23b(0x1a7),workerData['indexObj'][_0x50a23b(0x1bf)]),workerData[_0x50a23b(0x199)][_0x50a23b(0x1bc)]=workerData[_0x50a23b(0x19e)],returnResult();_0x3f5d0f['metadata'][_0x50a23b(0x1a6)]?_0x3f5d0f[_0x50a23b(0x1a5)](_0x3f5d0f['metadata']['cover'],async(_0xbe88,_0x47b854,_0x7885b9)=>{const _0x50ee43=_0x50a23b;return console[_0x50ee43(0x19a)]('EPUB写入书籍封面缓存：',workerData['bookCoverCachePath']),coverData=_0x47b854,returnResult();}):returnResult();}else returnResult();}),_0x3f5d0f['on'](_0x3820d8(0x1bd),()=>{const _0x562351=_0x3820d8;console['log'](_0x562351(0x197),_0x1a5e46),returnResult();}),_0x3f5d0f[_0x3820d8(0x1cb)]();}async function genBookInfoZip(_0x8d82f0){const _0x5d93ab=_0x1cbbb9;zipUtil['getZipCover'](_0x8d82f0)[_0x5d93ab(0x1ac)](_0x26a36a=>{const _0x47baac=_0x5d93ab;if(!_0x26a36a)return console[_0x47baac(0x19a)](_0x47baac(0x18f),_0x8d82f0),returnResult();let _0x56e758=_0x26a36a[_0x47baac(0x1cf)],_0x23ae86=_0x26a36a[_0x47baac(0x1af)];_0x56e758&&(coverData=_0x56e758),_0x23ae86&&(workerData[_0x47baac(0x199)][_0x47baac(0x19b)]=_0x23ae86),returnResult();})['catch'](_0x5ee798=>{console['log'](_0x5ee798);});}function _0x358e(){const _0x541352=['.zip','MOBI写入书籍封面缓存：','.cbr','epub解析失败','end','indexObj','log','total_page','mobi','.rar','bookCoverCachePath','getCover','unzlibSync','publisher','522486WaGswt','onlyGenCover','epub','getImage','cover','封面缓存已经存在','2431VlJFVh','open','没有找到需要处理的书籍目录','ext','then','14QQBkgg','toLowerCase','fileCount','language','4161BjgvXj','exit','title','book-type','2373800pnsRej','.azw3','path','.cbz','.azw','Worker\x20error:','creator','coverPath','error','./bookMobiNode','filename','30UxQcly','./bookFflate','21816MBbSzw','readFileSync','.epub','existsSync','artist','err2','join','231124pPFsQX','6vQhDSf','parse','3kPOSjA','metadata','worker_threads','dealedBuffer','166kdrUfP','../../utils/zipUtil','429095tJbiXq','comic','metadata_state','1614769BHAtha','date','未找到封面','MOBI','28ZqhvHo','.mobi','getTime'];_0x358e=function(){return _0x541352;};return _0x358e();}function _0x208c(_0x391b57,_0x1ab227){const _0x358e70=_0x358e();return _0x208c=function(_0x208c06,_0x38bd4c){_0x208c06=_0x208c06-0x18f;let _0x306169=_0x358e70[_0x208c06];return _0x306169;},_0x208c(_0x391b57,_0x1ab227);}if(workerData&&workerData[_0x1cbbb9(0x199)]&&workerData[_0x1cbbb9(0x19e)]){let bookFullPath=path[_0x1cbbb9(0x1c8)](workerData[_0x1cbbb9(0x199)][_0x1cbbb9(0x1b7)],workerData[_0x1cbbb9(0x199)]['filename']),lowerExt=workerData[_0x1cbbb9(0x199)][_0x1cbbb9(0x1ab)][_0x1cbbb9(0x1ae)]();if(fs['existsSync'](bookFullPath)){if(lowerExt==_0x1cbbb9(0x1c4))genBookInfoEpub(bookFullPath);else{if(lowerExt==_0x1cbbb9(0x192)||lowerExt==_0x1cbbb9(0x1b6)||lowerExt==_0x1cbbb9(0x1b9))genBookInfoMobi(bookFullPath);else lowerExt==_0x1cbbb9(0x1b8)||lowerExt==_0x1cbbb9(0x194)||lowerExt==_0x1cbbb9(0x196)||lowerExt==_0x1cbbb9(0x19d)?genBookInfoZip(bookFullPath):returnResult();}}else returnResult();}else console['log'](_0x1cbbb9(0x1aa)),returnResult();parentPort['on'](_0x1cbbb9(0x1bd),_0xe84da2=>{const _0x43ae6e=_0x1cbbb9;console[_0x43ae6e(0x1bd)](_0x43ae6e(0x1ba),_0xe84da2),returnResult();}),parentPort['on']('close',()=>{console['log']('Worker\x20stopped.');});