const _0x442ad3=_0x2545;(function(_0x18efac,_0x23cd61){const _0x3e8570=_0x2545,_0x3a039a=_0x18efac();while(!![]){try{const _0x11ac92=parseInt(_0x3e8570(0x151))/0x1*(-parseInt(_0x3e8570(0x157))/0x2)+parseInt(_0x3e8570(0x154))/0x3+parseInt(_0x3e8570(0x143))/0x4*(-parseInt(_0x3e8570(0x149))/0x5)+parseInt(_0x3e8570(0x145))/0x6*(-parseInt(_0x3e8570(0x14b))/0x7)+-parseInt(_0x3e8570(0x15e))/0x8*(-parseInt(_0x3e8570(0x160))/0x9)+parseInt(_0x3e8570(0x156))/0xa*(parseInt(_0x3e8570(0x15f))/0xb)+parseInt(_0x3e8570(0x159))/0xc;if(_0x11ac92===_0x23cd61)break;else _0x3a039a['push'](_0x3a039a['shift']());}catch(_0x4d1874){_0x3a039a['push'](_0x3a039a['shift']());}}}(_0x192e,0x4f5f3));const fs=require('fs'),config=require('../../myConfig/config'),Database=require('better-sqlite3'),dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config[_0x442ad3(0x152)],{});dbFileIndex[_0x442ad3(0x141)]('journal_mode\x20=\x20WAL'),dbOther[_0x442ad3(0x141)]('journal_mode\x20=\x20WAL');function _0x192e(){const _0x4dea1c=['getTime','recursionFilesAddIndex','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27','文件数量','pragma','getOnTask','2892DhKPnO','log','41046MtjtRa','SCAN_TYPE_PHOTO','../../db/dbScanTaskTable','../../db/dbFileIndexTable','3685bLfSGR','isDirectory','287ztWHeT','recursionDeleteIndex','scan_path','NEW_PHOTO_INDEX','exit','statSync','3812SrFZpx','dbFileIndex','deleteTask','1546821kxKSrX','INDEX_TABLE_NAME_PHOTO','6700wQUxEB','244usJTJp','../../db/dbSourceFolderTable','4893432qSkzhM','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','then','照片管理：扫描完成：','扫描目录已不存在\x20','18248JKfFrw','10417aAqfzz','180ynFSLo','setIndexingState','prepare','./indexUtil','run','文件夹数量'];_0x192e=function(){return _0x4dea1c;};return _0x192e();}const dbFileIndexTable=require(_0x442ad3(0x148));function _0x2545(_0x1b7635,_0x40f7c3){const _0x192e30=_0x192e();return _0x2545=function(_0x2545c9,_0x5b0fda){_0x2545c9=_0x2545c9-0x13d;let _0x4856d4=_0x192e30[_0x2545c9];return _0x4856d4;},_0x2545(_0x1b7635,_0x40f7c3);}process['title']='NasCabPhotoIndexWorker';const photoIndexUtil=require('./photoIndexUtil'),indexTableName=dbFileIndexTable[_0x442ad3(0x155)],dbScanTaskTable=require(_0x442ad3(0x147)),indexUtil=require(_0x442ad3(0x163)),dbSourceFolderTable=require(_0x442ad3(0x158));async function startIndexingFolder(_0x9cfe67){return new Promise(async(_0x3450ce,_0x30b10d)=>{const _0x552856=_0x2545;try{let _0x356951=new Date()[_0x552856(0x13d)](),_0x43c9b3=fs[_0x552856(0x150)](_0x9cfe67);if(!_0x43c9b3[_0x552856(0x14a)]())return console[_0x552856(0x144)]('要扫描的目录不是文件夹',_0x9cfe67),_0x3450ce();console['log']('照片管理:\x20开始扫描',_0x9cfe67),await indexUtil[_0x552856(0x14c)](dbFileIndex,indexTableName,_0x9cfe67);let {checkFileCount:_0x9bd4bd,checkPathCount:_0x4a940b}=await photoIndexUtil[_0x552856(0x13e)](dbOther,dbFileIndex,_0x9cfe67);console['log'](_0x552856(0x15c)+_0x9cfe67,'耗时:',new Date()['getTime']()-_0x356951,'ms',_0x552856(0x165),_0x4a940b,_0x552856(0x140),_0x9bd4bd),process['send']({'type':_0x552856(0x14e)}),_0x3450ce();}catch(_0x4bcddd){console[_0x552856(0x144)](_0x552856(0x15d),_0x9cfe67),_0x3450ce();}});}function runScanTask(){const _0x408934=_0x442ad3;let _0x59ede7=dbScanTaskTable[_0x408934(0x142)](dbOther,dbScanTaskTable[_0x408934(0x146)]);_0x59ede7?(dbOther[_0x408934(0x162)](_0x408934(0x13f))[_0x408934(0x164)](Date['now'](),_0x59ede7[_0x408934(0x14d)]),startIndexingFolder(_0x59ede7['scan_path'])[_0x408934(0x15b)](()=>{const _0xc2f791=_0x408934;dbScanTaskTable[_0xc2f791(0x153)](dbOther,_0x59ede7['id']),runScanTask();})):(console[_0x408934(0x144)](_0x408934(0x15a)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process[_0x408934(0x14f)]());}indexUtil[_0x442ad3(0x161)](dbOther,indexTableName,!![]),runScanTask();