function _0x1304(_0x56c21b,_0x1d20a1){const _0x3f03f1=_0x3f03();return _0x1304=function(_0x1304e3,_0x39f093){_0x1304e3=_0x1304e3-0x170;let _0x439a2e=_0x3f03f1[_0x1304e3];return _0x439a2e;},_0x1304(_0x56c21b,_0x1d20a1);}const _0x4e8b32=_0x1304;(function(_0x387217,_0x656156){const _0x14014f=_0x1304,_0x2f9884=_0x387217();while(!![]){try{const _0x30e13f=parseInt(_0x14014f(0x17e))/0x1*(-parseInt(_0x14014f(0x171))/0x2)+parseInt(_0x14014f(0x175))/0x3+-parseInt(_0x14014f(0x176))/0x4+parseInt(_0x14014f(0x179))/0x5*(parseInt(_0x14014f(0x196))/0x6)+-parseInt(_0x14014f(0x17a))/0x7+-parseInt(_0x14014f(0x173))/0x8*(-parseInt(_0x14014f(0x172))/0x9)+-parseInt(_0x14014f(0x184))/0xa*(-parseInt(_0x14014f(0x192))/0xb);if(_0x30e13f===_0x656156)break;else _0x2f9884['push'](_0x2f9884['shift']());}catch(_0x50b86c){_0x2f9884['push'](_0x2f9884['shift']());}}}(_0x3f03,0x590b5));const fs=require('fs'),config=require(_0x4e8b32(0x17b)),Database=require('better-sqlite3'),dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config[_0x4e8b32(0x17c)],{});dbFileIndex[_0x4e8b32(0x188)](_0x4e8b32(0x18c)),dbOther[_0x4e8b32(0x188)](_0x4e8b32(0x18c));const dbFileIndexTable=require('../../db/dbFileIndexTable');process[_0x4e8b32(0x178)]='NasCabPhotoIndexWorker';const photoIndexUtil=require('./photoIndexUtil'),indexTableName=dbFileIndexTable[_0x4e8b32(0x170)],dbScanTaskTable=require(_0x4e8b32(0x18f)),indexUtil=require('./indexUtil'),dbSourceFolderTable=require(_0x4e8b32(0x194));async function startIndexingFolder(_0x4f00f0){return new Promise(async(_0x14ee3a,_0x24ea13)=>{const _0x482290=_0x1304;try{let _0x3c388f=new Date()['getTime'](),_0x5a1602=fs[_0x482290(0x185)](_0x4f00f0);if(!_0x5a1602[_0x482290(0x191)]())return console['log'](_0x482290(0x187),_0x4f00f0),_0x14ee3a();console[_0x482290(0x17d)]('照片管理:\x20开始扫描',_0x4f00f0),await indexUtil['recursionDeleteIndex'](dbFileIndex,indexTableName,_0x4f00f0);let {checkFileCount:_0x2ad7a7,checkPathCount:_0xb84a82}=await photoIndexUtil[_0x482290(0x180)](dbOther,dbFileIndex,_0x4f00f0);console[_0x482290(0x17d)](_0x482290(0x181)+_0x4f00f0,_0x482290(0x195),new Date()[_0x482290(0x190)]()-_0x3c388f,'ms',_0x482290(0x186),_0xb84a82,_0x482290(0x18d),_0x2ad7a7),process[_0x482290(0x18a)]({'type':_0x482290(0x18b)}),_0x14ee3a();}catch(_0x24d91c){console[_0x482290(0x17d)]('扫描目录已不存在\x20',_0x4f00f0),_0x14ee3a();}});}function runScanTask(){const _0x36bb4d=_0x4e8b32;let _0x5b3093=dbScanTaskTable[_0x36bb4d(0x193)](dbOther,dbScanTaskTable['SCAN_TYPE_PHOTO']);_0x5b3093?(dbOther[_0x36bb4d(0x174)](_0x36bb4d(0x189))[_0x36bb4d(0x182)](Date['now'](),_0x5b3093[_0x36bb4d(0x177)]),startIndexingFolder(_0x5b3093[_0x36bb4d(0x177)])[_0x36bb4d(0x183)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x5b3093['id']),runScanTask();})):(console[_0x36bb4d(0x17d)]('照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]'),indexUtil[_0x36bb4d(0x17f)](dbOther,indexTableName,![]),process[_0x36bb4d(0x18e)]());}indexUtil[_0x4e8b32(0x17f)](dbOther,indexTableName,!![]),runScanTask();function _0x3f03(){const _0x56719a=['then','10fxVSPB','statSync','文件夹数量','要扫描的目录不是文件夹','pragma','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27','send','NEW_PHOTO_INDEX','journal_mode\x20=\x20WAL','文件数量','exit','../../db/dbScanTaskTable','getTime','isDirectory','10502382Yfpyyt','getOnTask','../../db/dbSourceFolderTable','耗时:','29340CilebN','INDEX_TABLE_NAME_PHOTO','78DgSrFQ','90YCUbBX','32104NAOSKT','prepare','390240GFqzBn','776848wrJWJd','scan_path','title','545LnFujJ','4225396mCBCTT','../../myConfig/config','dbFileIndex','log','12703pJeRBE','setIndexingState','recursionFilesAddIndex','照片管理：扫描完成：','run'];_0x3f03=function(){return _0x56719a;};return _0x3f03();}