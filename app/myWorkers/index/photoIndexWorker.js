const _0xd002af=_0x2cc6;(function(_0x31db70,_0x56a311){const _0x163486=_0x2cc6,_0x346583=_0x31db70();while(!![]){try{const _0x38c7e4=parseInt(_0x163486(0xcd))/0x1*(-parseInt(_0x163486(0xdb))/0x2)+parseInt(_0x163486(0xd7))/0x3*(parseInt(_0x163486(0xde))/0x4)+-parseInt(_0x163486(0xe2))/0x5*(-parseInt(_0x163486(0xeb))/0x6)+parseInt(_0x163486(0xca))/0x7*(parseInt(_0x163486(0xe9))/0x8)+parseInt(_0x163486(0xe4))/0x9+-parseInt(_0x163486(0xd1))/0xa+-parseInt(_0x163486(0xc9))/0xb*(parseInt(_0x163486(0xd0))/0xc);if(_0x38c7e4===_0x56a311)break;else _0x346583['push'](_0x346583['shift']());}catch(_0x22e46f){_0x346583['push'](_0x346583['shift']());}}}(_0x2ed2,0xc7474));const fs=require('fs'),config=require(_0xd002af(0xe8)),Database=require(_0xd002af(0xd3)),dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config['dbFileIndex'],{});dbFileIndex[_0xd002af(0xdc)]('journal_mode\x20=\x20WAL'),dbOther[_0xd002af(0xdc)](_0xd002af(0xcf));const dbFileIndexTable=require(_0xd002af(0xc4));function _0x2cc6(_0x4ae99d,_0x42001f){const _0x2ed292=_0x2ed2();return _0x2cc6=function(_0x2cc682,_0xd2f3be){_0x2cc682=_0x2cc682-0xc1;let _0x19869a=_0x2ed292[_0x2cc682];return _0x19869a;},_0x2cc6(_0x4ae99d,_0x42001f);}process['title']=_0xd002af(0xe3);const photoIndexUtil=require(_0xd002af(0xd4)),indexTableName=dbFileIndexTable[_0xd002af(0xe7)],dbScanTaskTable=require('../../db/dbScanTaskTable'),indexUtil=require(_0xd002af(0xec)),dbSourceFolderTable=require(_0xd002af(0xcc));async function startIndexingFolder(_0x48ccd0){return new Promise(async(_0x459423,_0x52ec9)=>{const _0x361f2b=_0x2cc6;try{let _0x2bde92=new Date()[_0x361f2b(0xdd)](),_0x12d2e8=fs[_0x361f2b(0xd2)](_0x48ccd0);if(!_0x12d2e8[_0x361f2b(0xc8)]())return console[_0x361f2b(0xda)]('要扫描的目录不是文件夹',_0x48ccd0),_0x459423();console[_0x361f2b(0xda)](_0x361f2b(0xc5),_0x48ccd0),await indexUtil[_0x361f2b(0xd9)](dbFileIndex,indexTableName,_0x48ccd0);let {checkFileCount:_0x57acbb,checkPathCount:_0xf5a5b9}=await photoIndexUtil[_0x361f2b(0xc2)](dbOther,dbFileIndex,_0x48ccd0);console['log'](_0x361f2b(0xcb)+_0x48ccd0,_0x361f2b(0xc3),new Date()['getTime']()-_0x2bde92,'ms',_0x361f2b(0xd6),_0xf5a5b9,_0x361f2b(0xd5),_0x57acbb),process[_0x361f2b(0xd8)]({'type':_0x361f2b(0xed)}),_0x459423();}catch(_0x5812c3){console['log'](_0x361f2b(0xe0),_0x48ccd0),_0x459423();}});}function runScanTask(){const _0x18e1d7=_0xd002af;let _0x5a3896=dbScanTaskTable[_0x18e1d7(0xdf)](dbOther,dbScanTaskTable['SCAN_TYPE_PHOTO']);_0x5a3896?(dbOther[_0x18e1d7(0xce)](_0x18e1d7(0xc6))['run'](Date[_0x18e1d7(0xe1)](),_0x5a3896[_0x18e1d7(0xe6)]),startIndexingFolder(_0x5a3896[_0x18e1d7(0xe6)])[_0x18e1d7(0xe5)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x5a3896['id']),runScanTask();})):(console[_0x18e1d7(0xda)](_0x18e1d7(0xea)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process[_0x18e1d7(0xc7)]());}function _0x2ed2(){const _0x19a56c=['../../db/dbFileIndexTable','照片管理:\x20开始扫描','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27','exit','isDirectory','20901331KhbmDa','189AOOPHk','照片管理：扫描完成：','../../db/dbSourceFolderTable','801PAAEsJ','prepare','journal_mode\x20=\x20WAL','12oqvZLV','15388070axBSEq','statSync','better-sqlite3','./photoIndexUtil','文件数量','文件夹数量','74556RpulPi','send','recursionDeleteIndex','log','312pJCjRE','pragma','getTime','172nWYPZG','getOnTask','扫描目录已不存在\x20','now','5jSewbk','NasCabPhotoIndexWorker','13719240aRrslv','then','scan_path','INDEX_TABLE_NAME_PHOTO','../../myConfig/config','57320TtEXVy','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','9562062lsnykU','./indexUtil','NEW_PHOTO_INDEX','setIndexingState','recursionFilesAddIndex','耗时:'];_0x2ed2=function(){return _0x19a56c;};return _0x2ed2();}indexUtil[_0xd002af(0xc1)](dbOther,indexTableName,!![]),runScanTask();