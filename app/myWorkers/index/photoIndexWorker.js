const _0x1f2887=_0x4705;function _0x510b(){const _0x20d3b9=['setIndexingState','./indexUtil','文件数量','send','../../myConfig/config','then','../../db/dbFileIndexTable','54rczVUt','isDirectory','recursionFilesAddIndex','../../db/dbScanTaskTable','177249WPPjCm','dbOther','INDEX_TABLE_NAME_PHOTO','文件夹数量','159130teNSsg','prepare','照片管理：扫描完成：','507713sRlJrb','10089168KQHLnn','run','SCAN_TYPE_PHOTO','../../db/dbSourceFolderTable','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27','5742252owqmiF','NEW_PHOTO_INDEX','扫描目录已不存在\x20','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','better-sqlite3','./photoIndexUtil','recursionDeleteIndex','耗时:','scan_path','26610pAJhzS','NasCabPhotoIndexWorker','journal_mode\x20=\x20WAL','statSync','dbFileIndex','now','title','132Adftfr','log','pragma','getOnTask','1673bXbmfQ','exit','48188840itCrPT','deleteTask'];_0x510b=function(){return _0x20d3b9;};return _0x510b();}(function(_0x185c1f,_0x3832dc){const _0x4338a2=_0x4705,_0x10a6e5=_0x185c1f();while(!![]){try{const _0x47ed53=-parseInt(_0x4338a2(0x1e6))/0x1+parseInt(_0x4338a2(0x1db))/0x2*(-parseInt(_0x4338a2(0x1df))/0x3)+-parseInt(_0x4338a2(0x1cc))/0x4*(parseInt(_0x4338a2(0x1e3))/0x5)+parseInt(_0x4338a2(0x1c5))/0x6*(parseInt(_0x4338a2(0x1d0))/0x7)+-parseInt(_0x4338a2(0x1e7))/0x8+-parseInt(_0x4338a2(0x1bc))/0x9+parseInt(_0x4338a2(0x1d2))/0xa;if(_0x47ed53===_0x3832dc)break;else _0x10a6e5['push'](_0x10a6e5['shift']());}catch(_0x3b3659){_0x10a6e5['push'](_0x10a6e5['shift']());}}}(_0x510b,0xc9c5f));const fs=require('fs'),config=require(_0x1f2887(0x1d8)),Database=require(_0x1f2887(0x1c0)),dbOther=new Database(config[_0x1f2887(0x1e0)],{}),dbFileIndex=new Database(config[_0x1f2887(0x1c9)],{});dbFileIndex[_0x1f2887(0x1ce)](_0x1f2887(0x1c7)),dbOther['pragma'](_0x1f2887(0x1c7));const dbFileIndexTable=require(_0x1f2887(0x1da));process[_0x1f2887(0x1cb)]=_0x1f2887(0x1c6);function _0x4705(_0x5274e2,_0x532c67){const _0x510bcd=_0x510b();return _0x4705=function(_0x47050f,_0x30152f){_0x47050f=_0x47050f-0x1bb;let _0x246589=_0x510bcd[_0x47050f];return _0x246589;},_0x4705(_0x5274e2,_0x532c67);}const photoIndexUtil=require(_0x1f2887(0x1c1)),indexTableName=dbFileIndexTable[_0x1f2887(0x1e1)],dbScanTaskTable=require(_0x1f2887(0x1de)),indexUtil=require(_0x1f2887(0x1d5)),dbSourceFolderTable=require(_0x1f2887(0x1ea));async function startIndexingFolder(_0x19f80f){return new Promise(async(_0x532a50,_0x3fac19)=>{const _0x4d0b88=_0x4705;try{let _0x57ce92=new Date()['getTime'](),_0x9a9cc9=fs[_0x4d0b88(0x1c8)](_0x19f80f);if(!_0x9a9cc9[_0x4d0b88(0x1dc)]())return console['log']('要扫描的目录不是文件夹',_0x19f80f),_0x532a50();console['log']('照片管理:\x20开始扫描',_0x19f80f),await indexUtil[_0x4d0b88(0x1c2)](dbFileIndex,indexTableName,_0x19f80f);let {checkFileCount:_0x13ff01,checkPathCount:_0x550af0}=await photoIndexUtil[_0x4d0b88(0x1dd)](dbOther,dbFileIndex,_0x19f80f);console['log'](_0x4d0b88(0x1e5)+_0x19f80f,_0x4d0b88(0x1c3),new Date()['getTime']()-_0x57ce92,'ms',_0x4d0b88(0x1e2),_0x550af0,_0x4d0b88(0x1d6),_0x13ff01),process[_0x4d0b88(0x1d7)]({'type':_0x4d0b88(0x1bd)}),_0x532a50();}catch(_0x3a7c7e){console[_0x4d0b88(0x1cd)](_0x4d0b88(0x1be),_0x19f80f),_0x532a50();}});}function runScanTask(){const _0x538e58=_0x1f2887;let _0x5d0083=dbScanTaskTable[_0x538e58(0x1cf)](dbOther,dbScanTaskTable[_0x538e58(0x1e9)]);_0x5d0083?(dbOther[_0x538e58(0x1e4)](_0x538e58(0x1bb))[_0x538e58(0x1e8)](Date[_0x538e58(0x1ca)](),_0x5d0083[_0x538e58(0x1c4)]),startIndexingFolder(_0x5d0083['scan_path'])[_0x538e58(0x1d9)](()=>{const _0x2b1199=_0x538e58;dbScanTaskTable[_0x2b1199(0x1d3)](dbOther,_0x5d0083['id']),runScanTask();})):(console[_0x538e58(0x1cd)](_0x538e58(0x1bf)),indexUtil[_0x538e58(0x1d4)](dbOther,indexTableName,![]),process[_0x538e58(0x1d1)]());}indexUtil[_0x1f2887(0x1d4)](dbOther,indexTableName,!![]),runScanTask();