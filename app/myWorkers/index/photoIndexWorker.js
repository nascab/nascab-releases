const _0x2097eb=_0x1aec;(function(_0x3338ad,_0x5a26fe){const _0xfe9700=_0x1aec,_0x2fef78=_0x3338ad();while(!![]){try{const _0xcec36f=-parseInt(_0xfe9700(0x1f7))/0x1+parseInt(_0xfe9700(0x20c))/0x2*(-parseInt(_0xfe9700(0x211))/0x3)+parseInt(_0xfe9700(0x1f9))/0x4+parseInt(_0xfe9700(0x20a))/0x5+-parseInt(_0xfe9700(0x1fe))/0x6*(parseInt(_0xfe9700(0x209))/0x7)+parseInt(_0xfe9700(0x1fc))/0x8*(parseInt(_0xfe9700(0x207))/0x9)+-parseInt(_0xfe9700(0x20b))/0xa*(-parseInt(_0xfe9700(0x204))/0xb);if(_0xcec36f===_0x5a26fe)break;else _0x2fef78['push'](_0x2fef78['shift']());}catch(_0x32d961){_0x2fef78['push'](_0x2fef78['shift']());}}}(_0x5a96,0xedd5a));const fs=require('fs'),config=require('../../myConfig/config'),Database=require('better-sqlite3'),dbOther=new Database(config[_0x2097eb(0x218)],{}),dbFileIndex=new Database(config[_0x2097eb(0x205)],{});dbFileIndex[_0x2097eb(0x200)](_0x2097eb(0x1ff)),dbOther['pragma'](_0x2097eb(0x1ff));const dbFileIndexTable=require(_0x2097eb(0x20d));process['title']='NasCabPhotoIndexWorker';const photoIndexUtil=require('./photoIndexUtil'),indexTableName=dbFileIndexTable[_0x2097eb(0x1fa)],dbScanTaskTable=require(_0x2097eb(0x1f3)),indexUtil=require('./indexUtil'),dbSourceFolderTable=require(_0x2097eb(0x1f6));async function startIndexingFolder(_0x523216){return new Promise(async(_0x4f221e,_0x9af87d)=>{const _0x5c91af=_0x1aec;try{let _0x30a25e=new Date()[_0x5c91af(0x213)](),_0x24f7f9=fs[_0x5c91af(0x1f2)](_0x523216);if(!_0x24f7f9[_0x5c91af(0x215)]())return console[_0x5c91af(0x206)](_0x5c91af(0x217),_0x523216),_0x4f221e();console[_0x5c91af(0x206)](_0x5c91af(0x219),_0x523216),await indexUtil[_0x5c91af(0x20f)](dbFileIndex,indexTableName,_0x523216);let {checkFileCount:_0x304065,checkPathCount:_0x2dd098}=await photoIndexUtil[_0x5c91af(0x203)](dbOther,dbFileIndex,_0x523216);console['log']('照片管理：扫描完成：'+_0x523216,'耗时:',new Date()[_0x5c91af(0x213)]()-_0x30a25e,'ms',_0x5c91af(0x1fd),_0x2dd098,_0x5c91af(0x202),_0x304065),process[_0x5c91af(0x1f4)]({'type':_0x5c91af(0x214)}),_0x4f221e();}catch(_0x3d64fa){console['log'](_0x5c91af(0x212),_0x523216),_0x4f221e();}});}function _0x5a96(){const _0x2bc307=['recursionFilesAddIndex','55uOXvSB','dbFileIndex','log','1580814RZxRva','run','56413cCosEP','7752125Pkstni','5379620REpEVR','20YTdfTC','../../db/dbFileIndexTable','setIndexingState','recursionDeleteIndex','prepare','276894MKRCLg','扫描目录已不存在\x20','getTime','NEW_PHOTO_INDEX','isDirectory','scan_path','要扫描的目录不是文件夹','dbOther','照片管理:\x20开始扫描','then','statSync','../../db/dbScanTaskTable','send','now','../../db/dbSourceFolderTable','1571084hKEyim','getOnTask','1992872JgVKYV','INDEX_TABLE_NAME_PHOTO','deleteTask','24WOaqKJ','文件夹数量','1338qSufHP','journal_mode\x20=\x20WAL','pragma','exit','文件数量'];_0x5a96=function(){return _0x2bc307;};return _0x5a96();}function runScanTask(){const _0x6e1f1=_0x2097eb;let _0x25227e=dbScanTaskTable[_0x6e1f1(0x1f8)](dbOther,dbScanTaskTable['SCAN_TYPE_PHOTO']);_0x25227e?(dbOther[_0x6e1f1(0x210)]('UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27')[_0x6e1f1(0x208)](Date[_0x6e1f1(0x1f5)](),_0x25227e[_0x6e1f1(0x216)]),startIndexingFolder(_0x25227e[_0x6e1f1(0x216)])[_0x6e1f1(0x21a)](()=>{const _0x3f1e65=_0x6e1f1;dbScanTaskTable[_0x3f1e65(0x1fb)](dbOther,_0x25227e['id']),runScanTask();})):(console[_0x6e1f1(0x206)]('照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]'),indexUtil[_0x6e1f1(0x20e)](dbOther,indexTableName,![]),process[_0x6e1f1(0x201)]());}function _0x1aec(_0x245fa7,_0x5e3492){const _0x5a9650=_0x5a96();return _0x1aec=function(_0x1aece6,_0x78215d){_0x1aece6=_0x1aece6-0x1f2;let _0x595f69=_0x5a9650[_0x1aece6];return _0x595f69;},_0x1aec(_0x245fa7,_0x5e3492);}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();