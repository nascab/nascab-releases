const _0x5c49dc=_0x4eb5;(function(_0x47466d,_0x46060f){const _0x3d8ffe=_0x4eb5,_0x26bac5=_0x47466d();while(!![]){try{const _0x233c25=-parseInt(_0x3d8ffe(0x210))/0x1+parseInt(_0x3d8ffe(0x1f8))/0x2+-parseInt(_0x3d8ffe(0x208))/0x3+-parseInt(_0x3d8ffe(0x1f3))/0x4+-parseInt(_0x3d8ffe(0x1f7))/0x5*(-parseInt(_0x3d8ffe(0x20a))/0x6)+-parseInt(_0x3d8ffe(0x207))/0x7*(parseInt(_0x3d8ffe(0x1f0))/0x8)+parseInt(_0x3d8ffe(0x1fc))/0x9;if(_0x233c25===_0x46060f)break;else _0x26bac5['push'](_0x26bac5['shift']());}catch(_0x325e86){_0x26bac5['push'](_0x26bac5['shift']());}}}(_0x1200,0x69067));function _0x1200(){const _0x5a9cea=['now','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27','then','142205aKesXT','1441274GHloMh','INDEX_TABLE_NAME_PHOTO','exit','../../db/dbSourceFolderTable','8508213PAdJBh','要扫描的目录不是文件夹','scan_path','deleteTask','statSync','prepare','照片管理：扫描完成：','NasCabPhotoIndexWorker','setIndexingState','SCAN_TYPE_PHOTO','recursionDeleteIndex','14JjYmju','1928952Etqmxn','getOnTask','150jMnyMi','./photoIndexUtil','耗时:','../../db/dbFileIndexTable','title','dbFileIndex','429314zmNXxd','recursionFilesAddIndex','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','log','pragma','dbOther','NEW_PHOTO_INDEX','文件数量','../../myConfig/config','run','3348056PZlYcF','getTime','journal_mode\x20=\x20WAL','150096oxiThL'];_0x1200=function(){return _0x5a9cea;};return _0x1200();}const fs=require('fs'),config=require(_0x5c49dc(0x218)),Database=require('better-sqlite3'),dbOther=new Database(config[_0x5c49dc(0x215)],{}),dbFileIndex=new Database(config[_0x5c49dc(0x20f)],{});dbFileIndex['pragma'](_0x5c49dc(0x1f2)),dbOther[_0x5c49dc(0x214)]('journal_mode\x20=\x20WAL');const dbFileIndexTable=require(_0x5c49dc(0x20d));process[_0x5c49dc(0x20e)]=_0x5c49dc(0x203);const photoIndexUtil=require(_0x5c49dc(0x20b)),indexTableName=dbFileIndexTable[_0x5c49dc(0x1f9)],dbScanTaskTable=require('../../db/dbScanTaskTable'),indexUtil=require('./indexUtil'),dbSourceFolderTable=require(_0x5c49dc(0x1fb));async function startIndexingFolder(_0x14daee){return new Promise(async(_0x6a1211,_0x108b58)=>{const _0x4b2a84=_0x4eb5;try{let _0x28c35d=new Date()[_0x4b2a84(0x1f1)](),_0x22c7fc=fs[_0x4b2a84(0x200)](_0x14daee);if(!_0x22c7fc['isDirectory']())return console[_0x4b2a84(0x213)](_0x4b2a84(0x1fd),_0x14daee),_0x6a1211();console[_0x4b2a84(0x213)]('照片管理:\x20开始扫描',_0x14daee),await indexUtil[_0x4b2a84(0x206)](dbFileIndex,indexTableName,_0x14daee);let {checkFileCount:_0xf2a88c,checkPathCount:_0xc097a8}=await photoIndexUtil[_0x4b2a84(0x211)](dbOther,dbFileIndex,_0x14daee);console['log'](_0x4b2a84(0x202)+_0x14daee,_0x4b2a84(0x20c),new Date()[_0x4b2a84(0x1f1)]()-_0x28c35d,'ms','文件夹数量',_0xc097a8,_0x4b2a84(0x217),_0xf2a88c),process['send']({'type':_0x4b2a84(0x216)}),_0x6a1211();}catch(_0x19a1c1){console[_0x4b2a84(0x213)]('扫描目录已不存在\x20',_0x14daee),_0x6a1211();}});}function _0x4eb5(_0x3edb33,_0x26e609){const _0x12005c=_0x1200();return _0x4eb5=function(_0x4eb55f,_0x4165c3){_0x4eb55f=_0x4eb55f-0x1ef;let _0x51f776=_0x12005c[_0x4eb55f];return _0x51f776;},_0x4eb5(_0x3edb33,_0x26e609);}function runScanTask(){const _0x3ed357=_0x5c49dc;let _0x48a9bd=dbScanTaskTable[_0x3ed357(0x209)](dbOther,dbScanTaskTable[_0x3ed357(0x205)]);_0x48a9bd?(dbOther[_0x3ed357(0x201)](_0x3ed357(0x1f5))[_0x3ed357(0x1ef)](Date[_0x3ed357(0x1f4)](),_0x48a9bd[_0x3ed357(0x1fe)]),startIndexingFolder(_0x48a9bd[_0x3ed357(0x1fe)])[_0x3ed357(0x1f6)](()=>{const _0x3a884c=_0x3ed357;dbScanTaskTable[_0x3a884c(0x1ff)](dbOther,_0x48a9bd['id']),runScanTask();})):(console[_0x3ed357(0x213)](_0x3ed357(0x212)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process[_0x3ed357(0x1fa)]());}indexUtil[_0x5c49dc(0x204)](dbOther,indexTableName,!![]),runScanTask();