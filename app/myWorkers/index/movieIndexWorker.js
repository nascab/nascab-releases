const _0xf322bb=_0x18bc;(function(_0x50bfee,_0x44b8f9){const _0x567799=_0x18bc,_0x1259f2=_0x50bfee();while(!![]){try{const _0x586ce6=parseInt(_0x567799(0x96))/0x1+parseInt(_0x567799(0x89))/0x2+parseInt(_0x567799(0xa1))/0x3+-parseInt(_0x567799(0x83))/0x4*(-parseInt(_0x567799(0x9e))/0x5)+-parseInt(_0x567799(0x93))/0x6+parseInt(_0x567799(0xa2))/0x7+parseInt(_0x567799(0x8c))/0x8*(-parseInt(_0x567799(0x9b))/0x9);if(_0x586ce6===_0x44b8f9)break;else _0x1259f2['push'](_0x1259f2['shift']());}catch(_0x108195){_0x1259f2['push'](_0x1259f2['shift']());}}}(_0x2d5c,0xd9110));const fs=require('fs'),path=require(_0xf322bb(0xa6)),config=require(_0xf322bb(0x9f)),Database=require(_0xf322bb(0x85)),dbOther=new Database(config[_0xf322bb(0x84)],{});dbOther['pragma'](_0xf322bb(0x8f));const dbFileIndex=new Database(config[_0xf322bb(0x80)],{'timeout':0xea60});dbFileIndex[_0xf322bb(0x82)]('journal_mode\x20=\x20WAL');const movieUtil=require(_0xf322bb(0x7e)),dbScanTaskTable=require(_0xf322bb(0x90)),dbFileIndexTable=require('../../db/dbFileIndexTable'),indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_MOVIE'],movieIndexUtil=require(_0xf322bb(0x98)),indexUtil=require(_0xf322bb(0x8d));function _0x2d5c(){const _0x33d33b=['journal_mode\x20=\x20WAL','../../db/dbScanTaskTable','run','statSync','2454960POYESS','影音管理：扫描完成：','send','1552164fdeqjA','then','./movieIndexUtil','recursionDeleteIndex','耗时:','26901KEkhIV','SCAN_TYPE_MOVIE','exit','10VKihUV','../../myConfig/config','title','2123871GIOfCt','1284787ycFMxO','影音管理:未找到扫描任务[Movies\x20scanning\x20task\x20not\x20found]','要扫描的目录不是文件夹','log','path','NEW_MOVIE_INDEX','setIndexingState','../../express-server/utils/movieUtil','getOnTask','dbFileIndex','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27movie\x27','pragma','1750076GscnUj','dbOther','better-sqlite3','影音管理:\x20开始扫描','扫描目录已不存在\x20','dealTvDrama','1919194vWwKIs','getTime','scan_path','7976GkJNXl','./indexUtil','dealFirstLetterAll'];_0x2d5c=function(){return _0x33d33b;};return _0x2d5c();}process[_0xf322bb(0xa0)]='NasCabMovieIndexingWorker';async function startIndexingFolder(_0x308455){return new Promise(async(_0x80ee90,_0xb70690)=>{const _0x451a6c=_0x18bc;try{let _0x6087c6=new Date()['getTime'](),_0x44b991=fs[_0x451a6c(0x92)](_0x308455);if(!_0x44b991['isDirectory']())return console['log'](_0x451a6c(0xa4),_0x308455),_0x80ee90();console[_0x451a6c(0xa5)](_0x451a6c(0x86),_0x308455),await indexUtil[_0x451a6c(0x99)](dbFileIndex,indexTableName,_0x308455);let {checkFileCount:_0x38e926,checkPathCount:_0x2fdbb2}=await movieIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x308455);console[_0x451a6c(0xa5)](_0x451a6c(0x94)+_0x308455,_0x451a6c(0x9a),new Date()[_0x451a6c(0x8a)]()-_0x6087c6,'ms','文件夹数量',_0x2fdbb2,'文件数量',_0x38e926),movieIndexUtil[_0x451a6c(0x88)](dbFileIndex),process[_0x451a6c(0x95)]({'type':_0x451a6c(0x7c)}),_0x80ee90();}catch(_0x5372c3){console[_0x451a6c(0xa5)](_0x451a6c(0x87),_0x5372c3,_0x308455),_0x80ee90();}});}async function runScanTask(){const _0x1019fd=_0xf322bb;let _0x3d85ad=dbScanTaskTable[_0x1019fd(0x7f)](dbOther,dbScanTaskTable[_0x1019fd(0x9c)]);_0x3d85ad?(dbOther['prepare'](_0x1019fd(0x81))[_0x1019fd(0x91)](Date['now'](),_0x3d85ad[_0x1019fd(0x8b)]),startIndexingFolder(_0x3d85ad[_0x1019fd(0x8b)])[_0x1019fd(0x97)](()=>{const _0x2f2e63=_0x1019fd;dbScanTaskTable['deleteTask'](dbOther,_0x3d85ad['id']),movieUtil[_0x2f2e63(0x8e)](dbFileIndex),runScanTask();})):(console[_0x1019fd(0xa5)](_0x1019fd(0xa3)),indexUtil[_0x1019fd(0x7d)](dbOther,indexTableName,![]),process[_0x1019fd(0x9d)]());}function _0x18bc(_0xb8e7bf,_0x5a0b2f){const _0x2d5ce2=_0x2d5c();return _0x18bc=function(_0x18bc79,_0x5c5f9a){_0x18bc79=_0x18bc79-0x7c;let _0xb6911e=_0x2d5ce2[_0x18bc79];return _0xb6911e;},_0x18bc(_0xb8e7bf,_0x5a0b2f);}indexUtil[_0xf322bb(0x7d)](dbOther,indexTableName,!![]),runScanTask();