const _0x22062d=_0x2d00;(function(_0x3a3eba,_0x4d84e4){const _0xd38b6e=_0x2d00,_0x3c1a1c=_0x3a3eba();while(!![]){try{const _0x4bb356=-parseInt(_0xd38b6e(0x95))/0x1+-parseInt(_0xd38b6e(0x7b))/0x2+-parseInt(_0xd38b6e(0x87))/0x3*(parseInt(_0xd38b6e(0x78))/0x4)+parseInt(_0xd38b6e(0x6f))/0x5+-parseInt(_0xd38b6e(0x7d))/0x6*(parseInt(_0xd38b6e(0x71))/0x7)+parseInt(_0xd38b6e(0x82))/0x8+parseInt(_0xd38b6e(0x75))/0x9*(parseInt(_0xd38b6e(0x74))/0xa);if(_0x4bb356===_0x4d84e4)break;else _0x3c1a1c['push'](_0x3c1a1c['shift']());}catch(_0x288c1d){_0x3c1a1c['push'](_0x3c1a1c['shift']());}}}(_0x1661,0xcddb3));const fs=require('fs'),path=require('path'),config=require(_0x22062d(0x90)),Database=require(_0x22062d(0x84)),dbOther=new Database(config['dbOther'],{});dbOther['pragma'](_0x22062d(0x93));const dbFileIndex=new Database(config[_0x22062d(0x83)],{'timeout':0xea60});dbFileIndex[_0x22062d(0x92)](_0x22062d(0x93));function _0x1661(){const _0x4dbf75=['../../db/dbScanTaskTable','statSync','./indexUtil','6984495SWHsEB','dealFirstLetterAll','9415245IXYoEI','文件夹数量','扫描目录已不存在\x20','768620NGpjyb','477iUczgE','prepare','NasCabMovieIndexingWorker','44wWONfO','./movieIndexUtil','recursionFilesAddIndex','2807018bIgnEL','send','6MxXJZV','log','影音管理:未找到扫描任务[Movies\x20scanning\x20task\x20not\x20found]','recursionDeleteIndex','now','3383888HXqqZE','dbFileIndex','better-sqlite3','NEW_MOVIE_INDEX','isDirectory','428397frsWLk','../../db/dbFileIndexTable','setIndexingState','scan_path','影音管理：扫描完成：','INDEX_TABLE_NAME_MOVIE','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27movie\x27','影音管理:\x20开始扫描','getTime','../../myConfig/config','要扫描的目录不是文件夹','pragma','journal_mode\x20=\x20WAL','then','731051hmunfT','SCAN_TYPE_MOVIE'];_0x1661=function(){return _0x4dbf75;};return _0x1661();}const movieUtil=require('../../express-server/utils/movieUtil'),dbScanTaskTable=require(_0x22062d(0x97)),dbFileIndexTable=require(_0x22062d(0x88)),indexTableName=dbFileIndexTable[_0x22062d(0x8c)],movieIndexUtil=require(_0x22062d(0x79)),indexUtil=require(_0x22062d(0x99));process['title']=_0x22062d(0x77);async function startIndexingFolder(_0x403896){return new Promise(async(_0x111c24,_0x92a7a6)=>{const _0x436ecf=_0x2d00;try{let _0x27350a=new Date()[_0x436ecf(0x8f)](),_0x24cc1a=fs[_0x436ecf(0x98)](_0x403896);if(!_0x24cc1a[_0x436ecf(0x86)]())return console['log'](_0x436ecf(0x91),_0x403896),_0x111c24();console['log'](_0x436ecf(0x8e),_0x403896),await indexUtil[_0x436ecf(0x80)](dbFileIndex,indexTableName,_0x403896);let {checkFileCount:_0x22d395,checkPathCount:_0x55518d}=await movieIndexUtil[_0x436ecf(0x7a)](dbOther,dbFileIndex,_0x403896);console[_0x436ecf(0x7e)](_0x436ecf(0x8b)+_0x403896,'耗时:',new Date()[_0x436ecf(0x8f)]()-_0x27350a,'ms',_0x436ecf(0x72),_0x55518d,'文件数量',_0x22d395),movieIndexUtil['dealTvDrama'](dbFileIndex),process[_0x436ecf(0x7c)]({'type':_0x436ecf(0x85)}),_0x111c24();}catch(_0x1d59fe){console[_0x436ecf(0x7e)](_0x436ecf(0x73),_0x1d59fe,_0x403896),_0x111c24();}});}async function runScanTask(){const _0x55a4a4=_0x22062d;let _0xbb0ca8=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable[_0x55a4a4(0x96)]);_0xbb0ca8?(dbOther[_0x55a4a4(0x76)](_0x55a4a4(0x8d))['run'](Date[_0x55a4a4(0x81)](),_0xbb0ca8[_0x55a4a4(0x8a)]),startIndexingFolder(_0xbb0ca8['scan_path'])[_0x55a4a4(0x94)](()=>{const _0x420baf=_0x55a4a4;dbScanTaskTable['deleteTask'](dbOther,_0xbb0ca8['id']),movieUtil[_0x420baf(0x70)](dbFileIndex),runScanTask();})):(console[_0x55a4a4(0x7e)](_0x55a4a4(0x7f)),indexUtil[_0x55a4a4(0x89)](dbOther,indexTableName,![]),process['exit']());}function _0x2d00(_0x29e1ca,_0x1c58af){const _0x1661f0=_0x1661();return _0x2d00=function(_0x2d000e,_0x4ba3c1){_0x2d000e=_0x2d000e-0x6f;let _0x5bee0e=_0x1661f0[_0x2d000e];return _0x5bee0e;},_0x2d00(_0x29e1ca,_0x1c58af);}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();