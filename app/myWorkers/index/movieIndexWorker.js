const _0x349df6=_0x5db3;function _0x5db3(_0x3bdbb1,_0x335317){const _0x303f3d=_0x303f();return _0x5db3=function(_0x5db33c,_0x3938e0){_0x5db33c=_0x5db33c-0xff;let _0x4dc65e=_0x303f3d[_0x5db33c];return _0x4dc65e;},_0x5db3(_0x3bdbb1,_0x335317);}(function(_0x532058,_0x41bd2f){const _0x19eb02=_0x5db3,_0x252bac=_0x532058();while(!![]){try{const _0x2f3abb=-parseInt(_0x19eb02(0x117))/0x1+parseInt(_0x19eb02(0x122))/0x2*(-parseInt(_0x19eb02(0x127))/0x3)+parseInt(_0x19eb02(0xff))/0x4+-parseInt(_0x19eb02(0x119))/0x5+-parseInt(_0x19eb02(0x10b))/0x6*(parseInt(_0x19eb02(0x106))/0x7)+-parseInt(_0x19eb02(0x11e))/0x8+parseInt(_0x19eb02(0x11b))/0x9;if(_0x2f3abb===_0x41bd2f)break;else _0x252bac['push'](_0x252bac['shift']());}catch(_0x56411d){_0x252bac['push'](_0x252bac['shift']());}}}(_0x303f,0x60c7f));const fs=require('fs'),path=require(_0x349df6(0x102)),config=require(_0x349df6(0x129)),Database=require('better-sqlite3'),dbOther=new Database(config[_0x349df6(0x10a)],{});dbOther[_0x349df6(0x115)](_0x349df6(0x103));const dbFileIndex=new Database(config[_0x349df6(0x109)],{'timeout':0xea60});dbFileIndex[_0x349df6(0x115)](_0x349df6(0x103));const movieUtil=require(_0x349df6(0x118)),dbScanTaskTable=require(_0x349df6(0x100)),dbFileIndexTable=require(_0x349df6(0x128)),indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_MOVIE'],movieIndexUtil=require(_0x349df6(0x121)),indexUtil=require('./indexUtil');process[_0x349df6(0x124)]=_0x349df6(0x107);async function startIndexingFolder(_0x644591){return new Promise(async(_0xb2748,_0x32370f)=>{const _0x4f49f0=_0x5db3;try{let _0x271b8e=new Date()[_0x4f49f0(0x104)](),_0x28639e=fs['statSync'](_0x644591);if(!_0x28639e['isDirectory']())return console[_0x4f49f0(0x11a)](_0x4f49f0(0x125),_0x644591),_0xb2748();console[_0x4f49f0(0x11a)](_0x4f49f0(0x110),_0x644591),await indexUtil[_0x4f49f0(0x10e)](dbFileIndex,indexTableName,_0x644591);let {checkFileCount:_0x58f37d,checkPathCount:_0x527bcd}=await movieIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x644591);console[_0x4f49f0(0x11a)](_0x4f49f0(0x123)+_0x644591,_0x4f49f0(0x10f),new Date()[_0x4f49f0(0x104)]()-_0x271b8e,'ms',_0x4f49f0(0x11f),_0x527bcd,_0x4f49f0(0x113),_0x58f37d),movieIndexUtil[_0x4f49f0(0x10d)](dbFileIndex),process[_0x4f49f0(0x10c)]({'type':'NEW_MOVIE_INDEX'}),_0xb2748();}catch(_0x13706a){console[_0x4f49f0(0x11a)](_0x4f49f0(0x114),_0x13706a,_0x644591),_0xb2748();}});}async function runScanTask(){const _0x1d1871=_0x349df6;let _0xa639dc=dbScanTaskTable[_0x1d1871(0x112)](dbOther,dbScanTaskTable[_0x1d1871(0x120)]);_0xa639dc?(dbOther[_0x1d1871(0x116)](_0x1d1871(0x11d))[_0x1d1871(0x101)](Date[_0x1d1871(0x111)](),_0xa639dc[_0x1d1871(0x11c)]),startIndexingFolder(_0xa639dc[_0x1d1871(0x11c)])['then'](()=>{const _0x90f46=_0x1d1871;dbScanTaskTable[_0x90f46(0x108)](dbOther,_0xa639dc['id']),movieUtil['dealFirstLetterAll'](dbFileIndex),runScanTask();})):(console[_0x1d1871(0x11a)](_0x1d1871(0x126)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process['exit']());}indexUtil[_0x349df6(0x105)](dbOther,indexTableName,!![]),runScanTask();function _0x303f(){const _0x10ab2d=['NasCabMovieIndexingWorker','deleteTask','dbFileIndex','dbOther','390DFCaOh','send','dealTvDrama','recursionDeleteIndex','耗时:','影音管理:\x20开始扫描','now','getOnTask','文件数量','扫描目录已不存在\x20','pragma','prepare','77766MIpgpm','../../express-server/utils/movieUtil','2248700aKKskL','log','11937096ygvYzI','scan_path','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27movie\x27','5162712xvmZDu','文件夹数量','SCAN_TYPE_MOVIE','./movieIndexUtil','2eQNqpX','影音管理：扫描完成：','title','要扫描的目录不是文件夹','影音管理:未找到扫描任务[Movies\x20scanning\x20task\x20not\x20found]','1196646rhmvey','../../db/dbFileIndexTable','../../myConfig/config','2586952jvoRxl','../../db/dbScanTaskTable','run','path','journal_mode\x20=\x20WAL','getTime','setIndexingState','532bbsIQJ'];_0x303f=function(){return _0x10ab2d;};return _0x303f();}