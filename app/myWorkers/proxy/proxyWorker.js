const _0x462af3=_0x1c38;(function(_0x157941,_0x7c682d){const _0x15212b=_0x1c38,_0x32e7cd=_0x157941();while(!![]){try{const _0x4b65eb=-parseInt(_0x15212b(0x14c))/0x1+parseInt(_0x15212b(0x196))/0x2+parseInt(_0x15212b(0x1b3))/0x3+parseInt(_0x15212b(0x169))/0x4+-parseInt(_0x15212b(0x18e))/0x5*(parseInt(_0x15212b(0x15f))/0x6)+parseInt(_0x15212b(0x156))/0x7*(-parseInt(_0x15212b(0x159))/0x8)+-parseInt(_0x15212b(0x163))/0x9*(parseInt(_0x15212b(0x129))/0xa);if(_0x4b65eb===_0x7c682d)break;else _0x32e7cd['push'](_0x32e7cd['shift']());}catch(_0x6601f4){_0x32e7cd['push'](_0x32e7cd['shift']());}}}(_0x13e7,0xa060e));let path=require(_0x462af3(0x176)),fs=require('fs'),os=require('os'),child_process=require(_0x462af3(0x16e)),proxyProcess=null;const config=require('../../myConfig/config'),Database=require(_0x462af3(0x13d));function _0x13e7(){const _0x3babc7=['child_process','\x20TIMEOUT','alive','prepare','TLS\x20handshake\x20error','getUrlByUrlKey','userReqDns','state','path','log','FRP\x20Connected','catch','\x0aplugin_host_header_rewrite\x20=\x20127.0.0.1\x0aplugin_header_X-From-Where\x20=\x20NasCab\x0asubdomain\x20=\x20','invalid\x20user','length','../../myConfig/urlConfig','proxy','message：reset','msg','error','proxy.frpcNoExist','pid','../../express-server/utils/cryptoUtils','mkdirSync','operation\x20timed\x20out','platform','create','probe','key','show_name','ping_time','netRate','12565PwmYJu','stop','writeFile','---Connection\x20error\x20，\x20reconnecting\x20frpc---','decryptString','apiServer','../../utils/i18nUtil','_id','948920SldNPX','success','-https]\x0atype\x20=\x20https\x0alocal_port\x20=\x20','tmp','getProxyServer','chmodSync','dbOther','account.onlyPtSupport','../../db/dbConfigTable','proxy.frpcStartFailWin','title','type','getTime','stopped','\x20refused','kill','错误输出','code','\x0asubdomain\x20=\x20','\x0aplugin_crt_path\x20=\x20','getI18n','NasCabFrpWorker','reset','post','promise','start','server_bandwidth','run','message','2905998tJSHTC','proxy.conFail','token','proxyServerList','nasZs987bac','\x0ause_compression\x20=\x20true\x0ause_encryption\x20=\x20true\x0abandwidth_limit\x20=\x20','parse','port','crt','user_count','1049080JTNnBz','https://','tmp_crt','PING','lastIndexOf','bandwidth','tmp/proxy/tmp_crt','proxy.noExpress','proxy.frpcStartFail','retry','apiProxyUrl','toString','proxy.isntVip','proxy.noUsableServer','stringify','selected','indexOf','首选服务器','value','then','better-sqlite3','子域名冲突','stderr','time','frpcPath','未登录\x20不连接内网穿透','proxy_subdomain','数据输出','\x0a[common]\x0aserver_addr\x20=\x20','errMsg','nasAccountInfoConfigKey','data','win32','exit','\x0aplugin_key_path\x20=\x20\x20','171098qLUZZv','getServerRootPath','serverId','unknown','stdout','wsarecv','context\x20canceled','proxy.timeout','\x0aserver_port\x20=\x20','axios','382711gVpmsv','proxy.noLoginInfo','router\x20config\x20conflict','64vskXuc','远程连接未启用','\x20error','findByTitle','pragma','proxy.conSuc','138ndFOwD','fail','远程代理线程退出','writeFileSync','18MXzhQn','nasRemoteEnable','close','vipInfo','proxyConfig','join','359524bXspzK','frpc\x20process\x20error','message：start','message：stop','existsSync'];_0x13e7=function(){return _0x3babc7;};return _0x13e7();}let dbOther=new Database(config[_0x462af3(0x19c)],{});dbOther[_0x462af3(0x15d)]('journal_mode\x20=\x20WAL');let dbConfigTable=require(_0x462af3(0x19e)),cryptoUtils=require(_0x462af3(0x184)),axios=require(_0x462af3(0x155)),i18nUtil=require(_0x462af3(0x194)),retryCount=0x0,maxRetryCount=0x9184e729fff,tmpPath,apiConfig,userToken,crtPath,keyPath,i18n;var ping=require('ping');let isWin=os[_0x462af3(0x187)]()==_0x462af3(0x149),frpIsConnected=![],isWaittingTimeout=![],urlConfig=require(_0x462af3(0x17d));process[_0x462af3(0x1a0)]=_0x462af3(0x1ab);const healthCheckGap=0x1e;let healthCheckInterval=null,healthCheckUrl='',healthCheckFailCount=0x0,maxhealthCheckFailCount=0x3;process['on'](_0x462af3(0x14a),()=>{const _0x49bd44=_0x462af3;console[_0x49bd44(0x177)](_0x49bd44(0x161)),stopProxy(),dbOther[_0x49bd44(0x165)]();}),process['on'](_0x462af3(0x1b2),_0x473afb=>{const _0x3761ca=_0x462af3;if(_0x473afb['type']==_0x3761ca(0x1af))console[_0x3761ca(0x177)](_0x3761ca(0x16b)),startProxy();else{if(_0x473afb[_0x3761ca(0x1a1)]==_0x3761ca(0x18f))console[_0x3761ca(0x177)](_0x3761ca(0x16c)),stopProxy();else _0x473afb['type']==_0x3761ca(0x1ac)&&(console[_0x3761ca(0x177)](_0x3761ca(0x17f)),_0x473afb[_0x3761ca(0x180)]&&_0x473afb[_0x3761ca(0x180)][_0x3761ca(0x14e)]?resetProxy(_0x473afb[_0x3761ca(0x180)][_0x3761ca(0x14e)]):resetProxy());}});let stopProxy=function(){const _0x569ec5=_0x462af3;proxyProcess&&(proxyProcess[_0x569ec5(0x1a5)](),console['log']('远程代理停止'),proxyProcess=null);};function saveNasProxyState(_0x5d6328,_0x3ee95f,_0x44d2f7){const _0xd48c48=_0x462af3;if(_0x44d2f7)console[_0xd48c48(0x177)](_0x44d2f7);dbConfigTable['create'](dbOther,{'title':'nasRemoteState','value':JSON[_0xd48c48(0x137)]({'status':_0x5d6328,'time':_0x3ee95f,'error':_0x44d2f7})});}let resetProxy=async function(_0x865dff){retryCount=0x0,startProxy(_0x865dff);},startProxy=async function(_0x16e6f2){const _0x507705=_0x462af3;i18n=i18nUtil[_0x507705(0x1aa)](dbOther),stopProxy();let _0x5f13a2=dbConfigTable[_0x507705(0x15c)](dbOther,_0x507705(0x164));if(!_0x5f13a2||_0x5f13a2&&_0x5f13a2[_0x507705(0x13b)]!=0x1)return console[_0x507705(0x177)](_0x507705(0x15a)),saveNasProxyState(_0x507705(0x160),new Date()[_0x507705(0x1a2)](),i18n['__']('proxy.disable'));console[_0x507705(0x177)]('正在连接远程代理,重试次数:',retryCount);let _0x18626f=dbConfigTable[_0x507705(0x15c)](dbOther,config[_0x507705(0x147)]);if(!_0x18626f)return console['log'](_0x507705(0x142)),saveNasProxyState(_0x507705(0x160),new Date()['getTime'](),i18n['__']('proxy.noLoginInfo'));if(!fs[_0x507705(0x16d)](config[_0x507705(0x141)]))return saveNasProxyState(_0x507705(0x160),new Date()[_0x507705(0x1a2)](),i18n['__'](_0x507705(0x182)));retryCount+=0x1;if(retryCount>=maxRetryCount)return saveNasProxyState(_0x507705(0x160),new Date()[_0x507705(0x1a2)](),i18n['__'](_0x507705(0x1b4)));os[_0x507705(0x187)]()!='win32'&&fs[_0x507705(0x19b)](config[_0x507705(0x141)],'777'),cryptoUtils['decryptString'](config['nasAccountInfoPwd'],_0x18626f[_0x507705(0x13b)])[_0x507705(0x13c)](_0xa488cd=>{const _0x105e16=_0x507705;let _0x236aa8=JSON[_0x105e16(0x1b9)](_0xa488cd),_0x10e86e=_0x236aa8['userInfo'],_0x10b477=_0x236aa8[_0x105e16(0x166)];_0x10e86e[_0x105e16(0x1b5)]&&_0x10e86e[_0x105e16(0x1b5)][_0x105e16(0x17c)]>0x0&&(userToken=_0x10e86e[_0x105e16(0x1b5)][_0x10e86e[_0x105e16(0x1b5)][_0x105e16(0x17c)]-0x1]);if(!userToken)return saveNasProxyState('fail',new Date()[_0x105e16(0x1a2)](),i18n['__'](_0x105e16(0x157)));if(!_0x10b477)return saveNasProxyState('fail',new Date()[_0x105e16(0x1a2)](),i18n['__'](_0x105e16(0x135)));if(_0x10b477['type']<0x2)return saveNasProxyState(_0x105e16(0x160),new Date()[_0x105e16(0x1a2)](),i18n['__'](_0x105e16(0x19d)));if(!_0x10b477['proxy_subdomain'])return saveNasProxyState('fail',new Date()['getTime'](),i18n['__']('proxy.noSubdomain'));let _0x18c7f2=dbConfigTable['findByTitle'](dbOther,_0x105e16(0x193));if(!_0x18c7f2)return saveNasProxyState(_0x105e16(0x160),new Date()['getTime'](),i18n['__'](_0x105e16(0x130)));apiConfig=JSON[_0x105e16(0x1b9)](_0x18c7f2[_0x105e16(0x13b)]);if(!apiConfig[_0x105e16(0x1ba)]||apiConfig[_0x105e16(0x175)]!=_0x105e16(0x1b1))return saveNasProxyState(_0x105e16(0x160),new Date()[_0x105e16(0x1a2)](),i18n['__']('proxy.noExpress'));let _0x4b90fd={'token':userToken,'type':_0x105e16(0x19a)};axios['post'](urlConfig[_0x105e16(0x173)](dbOther,'apiProxyUrl'),_0x4b90fd)[_0x105e16(0x13c)](async _0x7610a8=>{const _0xb33cb9=_0x105e16;if(_0x7610a8[_0xb33cb9(0x148)][_0xb33cb9(0x1a7)])return saveNasProxyState(_0xb33cb9(0x160),new Date()[_0xb33cb9(0x1a2)](),_0x7610a8[_0xb33cb9(0x148)][_0xb33cb9(0x180)]?_0x7610a8[_0xb33cb9(0x148)][_0xb33cb9(0x180)]:i18n['__']('proxy.conFail'));else{let _0x18de01=_0x7610a8[_0xb33cb9(0x148)]['validServer'],_0x2ceda3=null,_0x3525ac=dbConfigTable[_0xb33cb9(0x15c)](dbOther,_0xb33cb9(0x1b6));if(_0x3525ac&&_0x3525ac[_0xb33cb9(0x13b)])try{_0x3525ac=JSON[_0xb33cb9(0x1b9)](_0x3525ac[_0xb33cb9(0x13b)]);for(let _0x10cb48=0x0;_0x10cb48<_0x18de01['length'];_0x10cb48++){if(_0x16e6f2){if(_0x16e6f2==_0x18de01[_0x10cb48]['_id']){_0x2ceda3=_0x18de01[_0x10cb48];break;}}else for(let _0x16a808=0x0;_0x16a808<_0x3525ac[_0xb33cb9(0x17c)];_0x16a808++){if(_0x3525ac[_0x16a808]['selected']&&_0x3525ac[_0x16a808][_0xb33cb9(0x195)]==_0x18de01[_0x10cb48][_0xb33cb9(0x195)]){_0x2ceda3=_0x18de01[_0x10cb48];break;}}}}catch(_0xc695a5){console[_0xb33cb9(0x177)](_0xc695a5);}testPing(_0x7610a8[_0xb33cb9(0x148)]['validServer'],_0x2ceda3?_0x2ceda3[_0xb33cb9(0x195)]:null);}})[_0x105e16(0x179)](_0x17c8c0=>{const _0x5d6a27=_0x105e16;console[_0x5d6a27(0x177)](_0x17c8c0);});})[_0x507705(0x179)](_0x56a87f=>{const _0x12c182=_0x507705;console[_0x12c182(0x177)](_0x56a87f);});};function _0x1c38(_0x5d8cd8,_0x5e3c9e){const _0x13e7e5=_0x13e7();return _0x1c38=function(_0x1c38d6,_0x54daa3){_0x1c38d6=_0x1c38d6-0x127;let _0x56723c=_0x13e7e5[_0x1c38d6];return _0x56723c;},_0x1c38(_0x5d8cd8,_0x5e3c9e);}function userReqDns(_0x4b5aee,_0x2fabbd){const _0x25da1a=_0x462af3;tmpPath=path['join'](config['userDataFolder'],_0x25da1a(0x199),_0x25da1a(0x17e));!fs[_0x25da1a(0x16d)](tmpPath)&&fs[_0x25da1a(0x185)](tmpPath,{'recursive':!![]});let _0x965547=0x1;crtPath=path[_0x25da1a(0x168)](tmpPath,_0x25da1a(0x12b)),keyPath=path['join'](tmpPath,'tmp_key'),axios[_0x25da1a(0x1ad)](urlConfig[_0x25da1a(0x173)](dbOther,_0x25da1a(0x133)),{'token':userToken,'type':_0x25da1a(0x174),'serverId':_0x2fabbd['_id'],'getKey':_0x965547})[_0x25da1a(0x13c)](async _0x3bfc87=>{const _0x314372=_0x25da1a;if(_0x3bfc87[_0x314372(0x148)]['code'])return saveNasProxyState(_0x314372(0x160),new Date()[_0x314372(0x1a2)](),_0x3bfc87['data'][_0x314372(0x180)]?_0x3bfc87[_0x314372(0x148)]['msg']:i18n['__']('proxy.conFail'));else{if(_0x965547==0x1){let _0x393210=await cryptoUtils[_0x314372(0x192)](_0x314372(0x1b7),_0x3bfc87[_0x314372(0x148)][_0x314372(0x127)]),_0x466293=await cryptoUtils[_0x314372(0x192)](_0x314372(0x1b7),_0x3bfc87[_0x314372(0x148)][_0x314372(0x18a)]);fs[_0x314372(0x162)](crtPath,_0x393210),fs[_0x314372(0x162)](keyPath,_0x466293);}connectProxy(_0x4b5aee,_0x2fabbd);}})[_0x25da1a(0x179)](_0x5c02ee=>{const _0x659c76=_0x25da1a;console[_0x659c76(0x177)](_0x5c02ee);});}function testPing(_0x503d3b,_0x201ab3){const _0x3b5a25=_0x462af3;if(_0x503d3b[_0x3b5a25(0x17c)]<0x1)return saveNasProxyState(_0x3b5a25(0x160),new Date()[_0x3b5a25(0x1a2)](),i18n['__'](_0x3b5a25(0x136)));let _0x36476d=0x0,_0xec7af7=null;function _0x5d1b58(){const _0x2765d9=_0x3b5a25;if(_0x36476d>=_0x503d3b[_0x2765d9(0x17c)]){for(let _0x454a49 of _0x503d3b){if(_0x201ab3&&_0x201ab3==_0x454a49[_0x2765d9(0x195)]&&_0x454a49['alive']){_0xec7af7=_0x454a49,console[_0x2765d9(0x177)](_0x2765d9(0x13a),_0xec7af7[_0x2765d9(0x18b)]);break;}if(_0x454a49[_0x2765d9(0x170)]&&_0x454a49[_0x2765d9(0x18c)]&&_0x454a49[_0x2765d9(0x18c)]!=_0x2765d9(0x14f)){if(_0xec7af7==null)_0xec7af7=_0x454a49;else _0xec7af7[_0x2765d9(0x18c)]*_0xec7af7['netRate']>_0x454a49[_0x2765d9(0x18c)]*_0x454a49[_0x2765d9(0x18d)]&&(_0xec7af7=_0x454a49);}}if(!_0xec7af7)return saveNasProxyState('fail',new Date()[_0x2765d9(0x1a2)](),i18n['__'](_0x2765d9(0x136)));userReqDns(_0x503d3b,_0xec7af7);}}for(let _0x343990 of _0x503d3b){let _0x40cd70=0x1;if(!_0x343990[_0x3b5a25(0x128)]||!_0x343990[_0x3b5a25(0x1b0)])_0x40cd70=0x1;else try{_0x40cd70=parseInt(_0x343990['user_count'])/parseInt(_0x343990[_0x3b5a25(0x1b0)]);}catch(_0x4ecf69){console['log'](_0x4ecf69);}_0x343990[_0x3b5a25(0x18d)]=_0x40cd70;}for(let _0x27948a of _0x503d3b){ping[_0x3b5a25(0x1ae)][_0x3b5a25(0x189)](_0x27948a['ip'],{'timeout':0x14})[_0x3b5a25(0x13c)](function(_0x195d82){const _0x4b5df6=_0x3b5a25;_0x36476d+=0x1,_0x27948a[_0x4b5df6(0x170)]=_0x195d82[_0x4b5df6(0x170)],_0x27948a[_0x4b5df6(0x18c)]=_0x195d82[_0x4b5df6(0x140)],_0x5d1b58(),console[_0x4b5df6(0x177)](_0x4b5df6(0x12c),_0x27948a['ip'],_0x195d82[_0x4b5df6(0x170)],_0x195d82[_0x4b5df6(0x140)]?_0x195d82[_0x4b5df6(0x140)]:_0x4b5df6(0x16f));})[_0x3b5a25(0x179)](_0xfd29fe=>{const _0xb5a68c=_0x3b5a25;_0x36476d+=0x1,_0x27948a['alive']=![],_0x27948a[_0xb5a68c(0x18c)]=0x1869f,console['log'](_0xb5a68c(0x12c),_0x27948a['ip'],_0xb5a68c(0x16f)),_0x5d1b58();});}}function setHealthCheckInterval(){healthCheckInterval&&clearInterval(healthCheckInterval),healthCheckInterval=setInterval(()=>{proxyProcess==null?startProxy():checkFrpConnectHealth();},healthCheckGap*0x3e8);}function tryRestartFrpc(){if(isWaittingTimeout)return;setTimeout(()=>{isWaittingTimeout=![],!frpIsConnected&&startProxy();},0x2710);}function checkFrpConnectHealth(){const _0x3cc6e5=_0x462af3;axios[_0x3cc6e5(0x1ad)](healthCheckUrl+'/api/healthCheck',{'timeout':0x3a98})[_0x3cc6e5(0x13c)](async _0x4be8b2=>{const _0x22d5a7=_0x3cc6e5;_0x4be8b2['data'][_0x22d5a7(0x1a7)]?(healthCheckFailCount+=0x1,console[_0x22d5a7(0x177)]('FRP\x20Connection\x20health\x20check\x20fail:',healthCheckFailCount),healthCheckFailCount>maxhealthCheckFailCount&&(healthCheckFailCount=0x0,startProxy())):healthCheckFailCount=0x0;})[_0x3cc6e5(0x179)](_0x5e9717=>{const _0x59f955=_0x3cc6e5;healthCheckFailCount+=0x1,console[_0x59f955(0x177)]('FRP\x20Connection\x20health\x20check\x20fail:',healthCheckFailCount),healthCheckFailCount>maxhealthCheckFailCount&&(healthCheckFailCount=0x0,startProxy());});}async function connectProxy(_0x218672,_0x5f7558){const _0x54a61e=_0x462af3;for(let _0x544198 of _0x218672){_0x544198[_0x54a61e(0x195)]==_0x5f7558['_id']?_0x544198[_0x54a61e(0x138)]=!![]:_0x544198[_0x54a61e(0x138)]=![];}dbConfigTable[_0x54a61e(0x188)](dbOther,{'title':'proxyServerList','value':JSON[_0x54a61e(0x137)](_0x218672)}),console[_0x54a61e(0x177)]('已选代理服务器',_0x5f7558['ip']);let _0x347b5e=apiConfig[_0x54a61e(0x1ba)],_0x2e51c6=_0x5f7558[_0x54a61e(0x1ba)],_0x1bb3a3=_0x5f7558[_0x54a61e(0x143)],_0x3a5ffc=path[_0x54a61e(0x168)](tmpPath,_0x54a61e(0x167)),_0x5debee=dbConfigTable[_0x54a61e(0x14d)](dbOther);healthCheckUrl=_0x54a61e(0x12a)+_0x1bb3a3+'.'+urlConfig['getUrlByUrlKey'](dbOther,'proxySuffix')+_0x5debee;let _0x253604=_0x54a61e(0x145)+_0x5f7558['ip']+_0x54a61e(0x154)+_0x2e51c6+'\x0auser=\x22'+userToken+'\x22\x0ause_compression\x20=\x20true\x0ause_encryption\x20=\x20true\x0ameta_subdomain='+_0x1bb3a3+_0x54a61e(0x1a8)+_0x1bb3a3+'\x0apool_count\x20=\x201\x0atcp_mux\x20=\x20true\x0a\x0a['+_0x1bb3a3+_0x54a61e(0x198)+_0x347b5e+'\x0aplugin\x20=\x20https2http\x0aplugin_local_addr\x20=\x20127.0.0.1:'+_0x347b5e+_0x54a61e(0x1a9)+crtPath+_0x54a61e(0x14b)+keyPath+_0x54a61e(0x17a)+_0x1bb3a3+_0x54a61e(0x1b8)+_0x5f7558[_0x54a61e(0x12e)]+'\x0a';fs[_0x54a61e(0x190)](_0x3a5ffc,_0x253604,()=>{const _0x48c766=_0x54a61e;try{proxyProcess!=null&&proxyProcess['kill'](),proxyProcess=child_process['spawn'](''+config[_0x48c766(0x141)],['-c',_0x3a5ffc],{'detached':![],'killSignal':'SIGTERM'}),proxyProcess['on'](_0x48c766(0x181),function(_0x3f4d72){const _0x21e24d=_0x48c766;return console[_0x21e24d(0x177)](_0x21e24d(0x16a),_0x3f4d72),saveNasProxyState(_0x21e24d(0x160),new Date()[_0x21e24d(0x1a2)](),isWin?i18n['__'](_0x21e24d(0x19f)):i18n['__'](_0x21e24d(0x131)));});}catch(_0x2c5887){return console[_0x48c766(0x177)](_0x2c5887),saveNasProxyState(_0x48c766(0x160),new Date()[_0x48c766(0x1a2)](),isWin?i18n['__']('proxy.frpcStartFailWin'):i18n['__']('proxy.frpcStartFail'));}proxyProcess[_0x48c766(0x150)]['on'](_0x48c766(0x148),_0x5de4f1=>{const _0xf19753=_0x48c766;let _0x32e304=_0x5de4f1['toString']();console[_0xf19753(0x177)](_0xf19753(0x144),_0x32e304);if(_0x32e304[_0xf19753(0x139)](_0xf19753(0x158))!=-0x1)console[_0xf19753(0x177)](_0xf19753(0x13e)),frpIsConnected=!![],setHealthCheckInterval(),saveNasProxyState(_0xf19753(0x197),new Date()[_0xf19753(0x1a2)](),i18n['__'](_0xf19753(0x15e)));else{if(_0x32e304[_0xf19753(0x139)]('cannot\x20find\x20the\x20file\x20specified')!=-0x1)startProxy();else{if(_0x32e304['indexOf'](_0xf19753(0x15b))!=-0x1||_0x32e304[_0xf19753(0x139)](_0xf19753(0x1a4))!=-0x1){frpIsConnected=![];if(isWaittingTimeout)return;isWaittingTimeout=!![],setTimeout(()=>{const _0x3c9cae=_0xf19753;isWaittingTimeout=![],!frpIsConnected&&_0x32e304['indexOf'](_0x3c9cae(0x132))!=-0x1&&(console[_0x3c9cae(0x177)](_0x3c9cae(0x191),_0x32e304),startProxy());},0x4e20);}else{if(_0x32e304[_0xf19753(0x139)]('invalid\x20user')!=-0x1){console[_0xf19753(0x177)](_0xf19753(0x146),_0x32e304);var _0x2f29cf=_0x32e304[_0xf19753(0x12d)](_0xf19753(0x17b));let _0x52315f=_0x32e304['substring'](_0x2f29cf,_0x32e304['length']);saveNasProxyState(_0xf19753(0x160),new Date()[_0xf19753(0x1a2)](),_0x52315f);}else{if(_0x32e304[_0xf19753(0x139)]('start\x20proxy\x20success')!=-0x1)frpIsConnected=!![],retryCount=0x0,console['log'](_0xf19753(0x178)),saveNasProxyState(_0xf19753(0x197),new Date()[_0xf19753(0x1a2)](),i18n['__'](_0xf19753(0x15e))),dbOther[_0xf19753(0x171)]('REPLACE\x20INTO\x20process_record(process_id)\x20VALUES(?)')[_0xf19753(0x1b1)](proxyProcess[_0xf19753(0x183)]+''),fs['rm'](crtPath,()=>{}),fs['rm'](keyPath,()=>{}),fs['rm'](_0x3a5ffc,()=>{}),setHealthCheckInterval();else{if(_0x32e304[_0xf19753(0x139)](_0xf19753(0x186))!=-0x1)saveNasProxyState(_0xf19753(0x160),new Date()[_0xf19753(0x1a2)](),i18n['__'](_0xf19753(0x153)));else{if(_0x32e304['indexOf'](_0xf19753(0x1a3))!=-0x1)saveNasProxyState(_0xf19753(0x160),new Date()[_0xf19753(0x1a2)](),i18n['__']('stopped')),tryRestartFrpc();else _0x32e304[_0xf19753(0x139)](_0xf19753(0x12f))!=-0x1&&tryRestartFrpc();}}}}}}}),proxyProcess[_0x48c766(0x13f)]['on'](_0x48c766(0x148),_0x51b662=>{const _0x445e92=_0x48c766;let _0x4d68e9=_0x51b662[_0x445e92(0x134)]();console[_0x445e92(0x177)](_0x445e92(0x1a6),_0x4d68e9),_0x4d68e9[_0x445e92(0x139)](_0x445e92(0x151))==-0x1&&_0x4d68e9[_0x445e92(0x139)](_0x445e92(0x152))==-0x1&&_0x4d68e9[_0x445e92(0x139)](_0x445e92(0x172))==-0x1&&(frpIsConnected=![]),tryRestartFrpc();}),proxyProcess['on'](_0x48c766(0x165),_0x75ace6=>{const _0x5be548=_0x48c766;console[_0x5be548(0x177)]('frpc\x20stopped'),frpIsConnected=![],stopProxy();});});}