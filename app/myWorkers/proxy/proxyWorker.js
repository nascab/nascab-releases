const _0x3b5870=_0x47e2;(function(_0x37bc1e,_0x19a75d){const _0x1215f2=_0x47e2,_0x2ae606=_0x37bc1e();while(!![]){try{const _0xa5ab56=parseInt(_0x1215f2(0x184))/0x1*(parseInt(_0x1215f2(0x166))/0x2)+parseInt(_0x1215f2(0x1a3))/0x3*(parseInt(_0x1215f2(0x173))/0x4)+parseInt(_0x1215f2(0x133))/0x5*(parseInt(_0x1215f2(0x136))/0x6)+parseInt(_0x1215f2(0x134))/0x7+-parseInt(_0x1215f2(0x14d))/0x8*(parseInt(_0x1215f2(0x1be))/0x9)+-parseInt(_0x1215f2(0x1bf))/0xa+parseInt(_0x1215f2(0x180))/0xb*(parseInt(_0x1215f2(0x13b))/0xc);if(_0xa5ab56===_0x19a75d)break;else _0x2ae606['push'](_0x2ae606['shift']());}catch(_0x3ccf9d){_0x2ae606['push'](_0x2ae606['shift']());}}}(_0x1763,0x230dd));let path=require(_0x3b5870(0x1c2)),fs=require('fs'),os=require('os'),child_process=require(_0x3b5870(0x188)),proxyProcess=null;const config=require(_0x3b5870(0x162)),Database=require(_0x3b5870(0x1af));let dbOther=new Database(config[_0x3b5870(0x196)],{});dbOther[_0x3b5870(0x18a)](_0x3b5870(0x185));let dbConfigTable=require(_0x3b5870(0x14e)),cryptoUtils=require(_0x3b5870(0x1c7)),axios=require(_0x3b5870(0x15c)),i18nUtil=require(_0x3b5870(0x161)),retryCount=0x0,maxRetryCount=0x9184e729fff,tmpPath,apiConfig,userToken,crtPath,keyPath,i18n;var ping=require(_0x3b5870(0x175));let isWin=os[_0x3b5870(0x195)]()==_0x3b5870(0x13f),frpIsConnected=![],isWaittingTimeout=![],urlConfig=require(_0x3b5870(0x1a2));process['title']=_0x3b5870(0x1c4);const healthCheckGap=0x1e;function _0x1763(){const _0x1da093=['proxy.noSubdomain','axios','数据输出','errMsg','\x0aplugin_host_header_rewrite\x20=\x20127.0.0.1\x0aplugin_header_X-From-Where\x20=\x20NasCab\x0asubdomain\x20=\x20','pid','../../utils/i18nUtil','../../myConfig/config','invalid\x20user','userReqDns','\x22\x0ause_compression\x20=\x20true\x0ause_encryption\x20=\x20true\x0ameta_subdomain=','2ITmLdk','time','proxy.noLoginInfo','writeFileSync','validServer','\x0aplugin_key_path\x20=\x20\x20','userInfo','existsSync','proxy.frpcStartFail','\x0asubdomain\x20=\x20','then','SIGTERM','proxy.timeout','16qepmre','length','ping','proxy.noExpress','正在连接远程代理,重试次数:','proxy.frpcNoExist','proxyConfig','start','getUrlByUrlKey','FRP\x20Connected','message：reset','substring','proxy.conFail','33AQjHJw','\x0aplugin_crt_path\x20=\x20','data','\x0apool_count\x20=\x201\x0atcp_mux\x20=\x20true\x0a\x0a[','63956HyqmjL','journal_mode\x20=\x20WAL','apiProxyUrl','777','child_process','join','pragma','promise','alive','\x0aserver_port\x20=\x20','nasRemoteEnable','run','selected','fail','https://','\x20TIMEOUT','type','platform','dbOther','stringify','start\x20proxy\x20success','proxy.noUsableServer','spawn','operation\x20timed\x20out','indexOf','\x0a[common]\x0aserver_addr\x20=\x20','kill','远程代理停止','tmp','nasAccountInfoPwd','../../myConfig/urlConfig','4794pnQjjb','frpcPath','post','code','getI18n','catch','netRate','bandwidth','\x20refused','router\x20config\x20conflict','ping_time','\x0auser=\x22','better-sqlite3','getProxyServer','findByTitle','probe','\x20error','proxy.frpcStartFailWin','server_bandwidth','proxy.disable','account.onlyPtSupport','getTime','stopped','\x0ause_compression\x20=\x20true\x0ause_encryption\x20=\x20true\x0abandwidth_limit\x20=\x20','/api/healthCheck','parse','vipInfo','81avqZLH','1206510QVsDUn','tmp_crt','stdout','path','getServerRootPath','NasCabFrpWorker','message','nasZs987bac','../../express-server/utils/cryptoUtils','toString','user_count','value','\x0aplugin\x20=\x20https2http\x0aplugin_local_addr\x20=\x20127.0.0.1:','TLS\x20handshake\x20error','retry','REPLACE\x20INTO\x20process_record(process_id)\x20VALUES(?)','PING','15UaQYRW','287847yUZHZL','mkdirSync','461442kVZbJt','log','create','proxy_subdomain','context\x20canceled','610884HtBDUz','token','proxy.isntVip','msg','win32','FRP\x20Connection\x20health\x20check\x20fail:','proxyServerList','_id','-https]\x0atype\x20=\x20https\x0alocal_port\x20=\x20','close','serverId','port','error','userDataFolder','success','错误输出','---Connection\x20error\x20，\x20reconnecting\x20frpc---','prepare','205048XnNLaU','../../db/dbConfigTable','state','cannot\x20find\x20the\x20file\x20specified','chmodSync','decryptString','frpc\x20process\x20error','frpc\x20stopped','proxy.conSuc','message：stop','crt','show_name','exit','unknown'];_0x1763=function(){return _0x1da093;};return _0x1763();}let healthCheckInterval=null,healthCheckUrl='',healthCheckFailCount=0x0,maxhealthCheckFailCount=0x3;process['on'](_0x3b5870(0x159),()=>{const _0x8d3cf1=_0x3b5870;console[_0x8d3cf1(0x137)]('远程代理线程退出'),stopProxy(),dbOther[_0x8d3cf1(0x144)]();}),process['on'](_0x3b5870(0x1c5),_0x2310d8=>{const _0x111347=_0x3b5870;if(_0x2310d8[_0x111347(0x194)]==_0x111347(0x17a))console[_0x111347(0x137)]('message：start'),startProxy();else{if(_0x2310d8[_0x111347(0x194)]=='stop')console[_0x111347(0x137)](_0x111347(0x156)),stopProxy();else _0x2310d8[_0x111347(0x194)]=='reset'&&(console[_0x111347(0x137)](_0x111347(0x17d)),_0x2310d8[_0x111347(0x13e)]&&_0x2310d8[_0x111347(0x13e)][_0x111347(0x145)]?resetProxy(_0x2310d8[_0x111347(0x13e)]['serverId']):resetProxy());}});function _0x47e2(_0x1a6d2d,_0xd0a73c){const _0x17634a=_0x1763();return _0x47e2=function(_0x47e294,_0x3c09ee){_0x47e294=_0x47e294-0x12b;let _0xe501ad=_0x17634a[_0x47e294];return _0xe501ad;},_0x47e2(_0x1a6d2d,_0xd0a73c);}let stopProxy=function(){const _0x223756=_0x3b5870;proxyProcess&&(proxyProcess[_0x223756(0x19e)](),console['log'](_0x223756(0x19f)),proxyProcess=null);};function saveNasProxyState(_0x461ce8,_0x4b4d57,_0x127752){const _0x13dbfd=_0x3b5870;if(_0x127752)console[_0x13dbfd(0x137)](_0x127752);dbConfigTable[_0x13dbfd(0x138)](dbOther,{'title':'nasRemoteState','value':JSON[_0x13dbfd(0x197)]({'status':_0x461ce8,'time':_0x4b4d57,'error':_0x127752})});}let resetProxy=async function(_0x53ebd0){retryCount=0x0,startProxy(_0x53ebd0);},startProxy=async function(_0x1f732b){const _0x42ece5=_0x3b5870;i18n=i18nUtil[_0x42ece5(0x1a7)](dbOther),stopProxy();let _0x1d88ea=dbConfigTable[_0x42ece5(0x1b1)](dbOther,_0x42ece5(0x18e));if(!_0x1d88ea||_0x1d88ea&&_0x1d88ea['value']!=0x1)return console[_0x42ece5(0x137)]('远程连接未启用'),saveNasProxyState('fail',new Date()['getTime'](),i18n['__'](_0x42ece5(0x1b6)));console[_0x42ece5(0x137)](_0x42ece5(0x177),retryCount);let _0x5f297=dbConfigTable[_0x42ece5(0x1b1)](dbOther,config['nasAccountInfoConfigKey']);if(!_0x5f297)return console['log']('未登录\x20不连接内网穿透'),saveNasProxyState(_0x42ece5(0x191),new Date()[_0x42ece5(0x1b8)](),i18n['__'](_0x42ece5(0x168)));if(!fs[_0x42ece5(0x16d)](config['frpcPath']))return saveNasProxyState(_0x42ece5(0x191),new Date()['getTime'](),i18n['__'](_0x42ece5(0x178)));retryCount+=0x1;if(retryCount>=maxRetryCount)return saveNasProxyState(_0x42ece5(0x191),new Date()['getTime'](),i18n['__'](_0x42ece5(0x17f)));os[_0x42ece5(0x195)]()!=_0x42ece5(0x13f)&&fs[_0x42ece5(0x151)](config[_0x42ece5(0x1a4)],_0x42ece5(0x187)),cryptoUtils['decryptString'](config[_0x42ece5(0x1a1)],_0x5f297[_0x42ece5(0x12d)])['then'](_0x5837c2=>{const _0x14a00c=_0x42ece5;let _0x69b02d=JSON['parse'](_0x5837c2),_0x5a2b9a=_0x69b02d[_0x14a00c(0x16c)],_0x178f60=_0x69b02d[_0x14a00c(0x1bd)];_0x5a2b9a[_0x14a00c(0x13c)]&&_0x5a2b9a['token'][_0x14a00c(0x174)]>0x0&&(userToken=_0x5a2b9a[_0x14a00c(0x13c)][_0x5a2b9a[_0x14a00c(0x13c)][_0x14a00c(0x174)]-0x1]);if(!userToken)return saveNasProxyState('fail',new Date()['getTime'](),i18n['__'](_0x14a00c(0x168)));if(!_0x178f60)return saveNasProxyState('fail',new Date()[_0x14a00c(0x1b8)](),i18n['__'](_0x14a00c(0x13d)));if(_0x178f60['type']<0x2)return saveNasProxyState(_0x14a00c(0x191),new Date()[_0x14a00c(0x1b8)](),i18n['__'](_0x14a00c(0x1b7)));if(!_0x178f60['proxy_subdomain'])return saveNasProxyState(_0x14a00c(0x191),new Date()['getTime'](),i18n['__'](_0x14a00c(0x15b)));let _0x2bbcda=dbConfigTable[_0x14a00c(0x1b1)](dbOther,'apiServer');if(!_0x2bbcda)return saveNasProxyState(_0x14a00c(0x191),new Date()[_0x14a00c(0x1b8)](),i18n['__'](_0x14a00c(0x176)));apiConfig=JSON[_0x14a00c(0x1bc)](_0x2bbcda[_0x14a00c(0x12d)]);if(!apiConfig[_0x14a00c(0x146)]||apiConfig[_0x14a00c(0x14f)]!=_0x14a00c(0x18f))return saveNasProxyState(_0x14a00c(0x191),new Date()['getTime'](),i18n['__'](_0x14a00c(0x176)));let _0x2a151f={'token':userToken,'type':_0x14a00c(0x1b0)};axios[_0x14a00c(0x1a5)](urlConfig[_0x14a00c(0x17b)](dbOther,_0x14a00c(0x186)),_0x2a151f)[_0x14a00c(0x170)](async _0x4195d2=>{const _0x105f10=_0x14a00c;if(_0x4195d2['data']['code'])return saveNasProxyState(_0x105f10(0x191),new Date()[_0x105f10(0x1b8)](),_0x4195d2[_0x105f10(0x182)][_0x105f10(0x13e)]?_0x4195d2[_0x105f10(0x182)][_0x105f10(0x13e)]:i18n['__']('proxy.conFail'));else{let _0xdebccc=_0x4195d2['data'][_0x105f10(0x16a)],_0x258a80=null,_0x56602e=dbConfigTable[_0x105f10(0x1b1)](dbOther,_0x105f10(0x141));if(_0x56602e&&_0x56602e[_0x105f10(0x12d)])try{_0x56602e=JSON[_0x105f10(0x1bc)](_0x56602e[_0x105f10(0x12d)]);for(let _0xf1be64=0x0;_0xf1be64<_0xdebccc['length'];_0xf1be64++){if(_0x1f732b){if(_0x1f732b==_0xdebccc[_0xf1be64][_0x105f10(0x142)]){_0x258a80=_0xdebccc[_0xf1be64];break;}}else for(let _0x6d47a=0x0;_0x6d47a<_0x56602e[_0x105f10(0x174)];_0x6d47a++){if(_0x56602e[_0x6d47a][_0x105f10(0x190)]&&_0x56602e[_0x6d47a]['_id']==_0xdebccc[_0xf1be64][_0x105f10(0x142)]){_0x258a80=_0xdebccc[_0xf1be64];break;}}}}catch(_0x28e30f){console[_0x105f10(0x137)](_0x28e30f);}testPing(_0x4195d2[_0x105f10(0x182)][_0x105f10(0x16a)],_0x258a80?_0x258a80[_0x105f10(0x142)]:null);}})[_0x14a00c(0x1a8)](_0x309bb1=>{const _0x2a56e5=_0x14a00c;console[_0x2a56e5(0x137)](_0x309bb1);});})['catch'](_0x3ca3bd=>{console['log'](_0x3ca3bd);});};function userReqDns(_0x29f0f9,_0x513af8){const _0x34cdce=_0x3b5870;tmpPath=path[_0x34cdce(0x189)](config[_0x34cdce(0x148)],_0x34cdce(0x1a0),'proxy');!fs[_0x34cdce(0x16d)](tmpPath)&&fs[_0x34cdce(0x135)](tmpPath,{'recursive':!![]});let _0x5afcf8=0x1;crtPath=path[_0x34cdce(0x189)](tmpPath,_0x34cdce(0x1c0)),keyPath=path[_0x34cdce(0x189)](tmpPath,'tmp_key'),axios[_0x34cdce(0x1a5)](urlConfig[_0x34cdce(0x17b)](dbOther,'apiProxyUrl'),{'token':userToken,'type':_0x34cdce(0x164),'serverId':_0x513af8[_0x34cdce(0x142)],'getKey':_0x5afcf8})[_0x34cdce(0x170)](async _0x54329e=>{const _0x3407b6=_0x34cdce;if(_0x54329e[_0x3407b6(0x182)]['code'])return saveNasProxyState(_0x3407b6(0x191),new Date()['getTime'](),_0x54329e[_0x3407b6(0x182)][_0x3407b6(0x13e)]?_0x54329e['data'][_0x3407b6(0x13e)]:i18n['__']('proxy.conFail'));else{if(_0x5afcf8==0x1){let _0x4bc05d=await cryptoUtils[_0x3407b6(0x152)](_0x3407b6(0x1c6),_0x54329e['data'][_0x3407b6(0x157)]),_0x18a13b=await cryptoUtils[_0x3407b6(0x152)](_0x3407b6(0x1c6),_0x54329e[_0x3407b6(0x182)]['key']);fs[_0x3407b6(0x169)](crtPath,_0x4bc05d),fs[_0x3407b6(0x169)](keyPath,_0x18a13b);}connectProxy(_0x29f0f9,_0x513af8);}})['catch'](_0x5f0eff=>{const _0x2f240e=_0x34cdce;console[_0x2f240e(0x137)](_0x5f0eff);});}function testPing(_0x53123a,_0x4bfa9e){const _0x608727=_0x3b5870;if(_0x53123a[_0x608727(0x174)]<0x1)return saveNasProxyState('fail',new Date()[_0x608727(0x1b8)](),i18n['__'](_0x608727(0x199)));let _0x133fab=0x0,_0x32af6b=null;function _0x2c0468(){const _0x388f93=_0x608727;if(_0x133fab>=_0x53123a['length']){for(let _0x1a632c of _0x53123a){if(_0x4bfa9e&&_0x4bfa9e==_0x1a632c['_id']&&_0x1a632c[_0x388f93(0x18c)]){_0x32af6b=_0x1a632c,console['log']('首选服务器',_0x32af6b[_0x388f93(0x158)]);break;}if(_0x1a632c[_0x388f93(0x18c)]&&_0x1a632c['ping_time']&&_0x1a632c[_0x388f93(0x1ad)]!=_0x388f93(0x15a)){if(_0x32af6b==null)_0x32af6b=_0x1a632c;else _0x32af6b[_0x388f93(0x1ad)]*_0x32af6b[_0x388f93(0x1a9)]>_0x1a632c['ping_time']*_0x1a632c[_0x388f93(0x1a9)]&&(_0x32af6b=_0x1a632c);}}if(!_0x32af6b)return saveNasProxyState(_0x388f93(0x191),new Date()[_0x388f93(0x1b8)](),i18n['__'](_0x388f93(0x199)));userReqDns(_0x53123a,_0x32af6b);}}for(let _0x3d2f5b of _0x53123a){let _0x26a009=0x1;if(!_0x3d2f5b[_0x608727(0x12c)]||!_0x3d2f5b[_0x608727(0x1b5)])_0x26a009=0x1;else try{_0x26a009=parseInt(_0x3d2f5b[_0x608727(0x12c)])/parseInt(_0x3d2f5b[_0x608727(0x1b5)]);}catch(_0x18b501){console['log'](_0x18b501);}_0x3d2f5b[_0x608727(0x1a9)]=_0x26a009;}for(let _0x5b95d7 of _0x53123a){ping[_0x608727(0x18b)][_0x608727(0x1b2)](_0x5b95d7['ip'],{'timeout':0x14})['then'](function(_0xe278ee){const _0x338b1a=_0x608727;_0x133fab+=0x1,_0x5b95d7[_0x338b1a(0x18c)]=_0xe278ee[_0x338b1a(0x18c)],_0x5b95d7[_0x338b1a(0x1ad)]=_0xe278ee[_0x338b1a(0x167)],_0x2c0468(),console[_0x338b1a(0x137)](_0x338b1a(0x132),_0x5b95d7['ip'],_0xe278ee[_0x338b1a(0x18c)],_0xe278ee['time']?_0xe278ee[_0x338b1a(0x167)]:_0x338b1a(0x193));})['catch'](_0x3f7e78=>{const _0x27a4e3=_0x608727;_0x133fab+=0x1,_0x5b95d7[_0x27a4e3(0x18c)]=![],_0x5b95d7[_0x27a4e3(0x1ad)]=0x1869f,console[_0x27a4e3(0x137)](_0x27a4e3(0x132),_0x5b95d7['ip'],'\x20TIMEOUT'),_0x2c0468();});}}function setHealthCheckInterval(){healthCheckInterval&&clearInterval(healthCheckInterval),healthCheckInterval=setInterval(()=>{proxyProcess==null?startProxy():checkFrpConnectHealth();},healthCheckGap*0x3e8);}function tryRestartFrpc(){if(isWaittingTimeout)return;setTimeout(()=>{isWaittingTimeout=![],!frpIsConnected&&startProxy();},0x2710);}function checkFrpConnectHealth(){const _0x9953ab=_0x3b5870;axios[_0x9953ab(0x1a5)](healthCheckUrl+_0x9953ab(0x1bb),{'timeout':0x3a98})[_0x9953ab(0x170)](async _0x334d34=>{const _0x203aef=_0x9953ab;_0x334d34['data'][_0x203aef(0x1a6)]?(healthCheckFailCount+=0x1,console[_0x203aef(0x137)](_0x203aef(0x140),healthCheckFailCount),healthCheckFailCount>maxhealthCheckFailCount&&(healthCheckFailCount=0x0,startProxy())):healthCheckFailCount=0x0;})['catch'](_0x3984f3=>{const _0x2c4922=_0x9953ab;healthCheckFailCount+=0x1,console[_0x2c4922(0x137)]('FRP\x20Connection\x20health\x20check\x20fail:',healthCheckFailCount),healthCheckFailCount>maxhealthCheckFailCount&&(healthCheckFailCount=0x0,startProxy());});}async function connectProxy(_0x31ed55,_0x2f7ffd){const _0x1ada9b=_0x3b5870;for(let _0x27b5be of _0x31ed55){_0x27b5be['_id']==_0x2f7ffd['_id']?_0x27b5be[_0x1ada9b(0x190)]=!![]:_0x27b5be[_0x1ada9b(0x190)]=![];}dbConfigTable[_0x1ada9b(0x138)](dbOther,{'title':'proxyServerList','value':JSON['stringify'](_0x31ed55)}),console[_0x1ada9b(0x137)]('已选代理服务器',_0x2f7ffd['ip']);let _0x7fec67=apiConfig[_0x1ada9b(0x146)],_0x1a4134=_0x2f7ffd[_0x1ada9b(0x146)],_0x4249c8=_0x2f7ffd[_0x1ada9b(0x139)],_0x40c499=path['join'](tmpPath,_0x1ada9b(0x179)),_0x44c3da=dbConfigTable[_0x1ada9b(0x1c3)](dbOther);healthCheckUrl=_0x1ada9b(0x192)+_0x4249c8+'.'+urlConfig[_0x1ada9b(0x17b)](dbOther,'proxySuffix')+_0x44c3da;let _0x2eaeb6=_0x1ada9b(0x19d)+_0x2f7ffd['ip']+_0x1ada9b(0x18d)+_0x1a4134+_0x1ada9b(0x1ae)+userToken+_0x1ada9b(0x165)+_0x4249c8+_0x1ada9b(0x16f)+_0x4249c8+_0x1ada9b(0x183)+_0x4249c8+_0x1ada9b(0x143)+_0x7fec67+_0x1ada9b(0x12e)+_0x7fec67+_0x1ada9b(0x181)+crtPath+_0x1ada9b(0x16b)+keyPath+_0x1ada9b(0x15f)+_0x4249c8+_0x1ada9b(0x1ba)+_0x2f7ffd[_0x1ada9b(0x1aa)]+'\x0a';fs['writeFile'](_0x40c499,_0x2eaeb6,()=>{const _0xed7911=_0x1ada9b;try{proxyProcess!=null&&proxyProcess[_0xed7911(0x19e)](),proxyProcess=child_process[_0xed7911(0x19a)](''+config[_0xed7911(0x1a4)],['-c',_0x40c499],{'detached':![],'killSignal':_0xed7911(0x171)}),proxyProcess['on'](_0xed7911(0x147),function(_0x3c6411){const _0x1b7b43=_0xed7911;return console[_0x1b7b43(0x137)](_0x1b7b43(0x153),_0x3c6411),saveNasProxyState(_0x1b7b43(0x191),new Date()[_0x1b7b43(0x1b8)](),isWin?i18n['__'](_0x1b7b43(0x1b4)):i18n['__'](_0x1b7b43(0x16e)));});}catch(_0x50eaf1){return console['log'](_0x50eaf1),saveNasProxyState(_0xed7911(0x191),new Date()[_0xed7911(0x1b8)](),isWin?i18n['__'](_0xed7911(0x1b4)):i18n['__'](_0xed7911(0x16e)));}proxyProcess[_0xed7911(0x1c1)]['on']('data',_0x18d8a0=>{const _0x3b5015=_0xed7911;let _0x5b342b=_0x18d8a0['toString']();console[_0x3b5015(0x137)](_0x3b5015(0x15d),_0x5b342b);if(_0x5b342b[_0x3b5015(0x19c)](_0x3b5015(0x1ac))!=-0x1)console[_0x3b5015(0x137)]('子域名冲突'),frpIsConnected=!![],setHealthCheckInterval(),saveNasProxyState(_0x3b5015(0x149),new Date()['getTime'](),i18n['__'](_0x3b5015(0x155)));else{if(_0x5b342b['indexOf'](_0x3b5015(0x150))!=-0x1)startProxy();else{if(_0x5b342b[_0x3b5015(0x19c)](_0x3b5015(0x1b3))!=-0x1||_0x5b342b['indexOf'](_0x3b5015(0x1ab))!=-0x1){frpIsConnected=![];if(isWaittingTimeout)return;isWaittingTimeout=!![],setTimeout(()=>{const _0x353639=_0x3b5015;isWaittingTimeout=![],!frpIsConnected&&_0x5b342b[_0x353639(0x19c)](_0x353639(0x130))!=-0x1&&(console['log'](_0x353639(0x14b),_0x5b342b),startProxy());},0x4e20);}else{if(_0x5b342b[_0x3b5015(0x19c)](_0x3b5015(0x163))!=-0x1){console['log'](_0x3b5015(0x15e),_0x5b342b);var _0x55b411=_0x5b342b['lastIndexOf'](_0x3b5015(0x163));let _0x12020d=_0x5b342b[_0x3b5015(0x17e)](_0x55b411,_0x5b342b[_0x3b5015(0x174)]);saveNasProxyState(_0x3b5015(0x191),new Date()['getTime'](),_0x12020d);}else{if(_0x5b342b[_0x3b5015(0x19c)](_0x3b5015(0x198))!=-0x1)frpIsConnected=!![],retryCount=0x0,console[_0x3b5015(0x137)](_0x3b5015(0x17c)),saveNasProxyState('success',new Date()[_0x3b5015(0x1b8)](),i18n['__']('proxy.conSuc')),dbOther[_0x3b5015(0x14c)](_0x3b5015(0x131))[_0x3b5015(0x18f)](proxyProcess[_0x3b5015(0x160)]+''),fs['rm'](crtPath,()=>{}),fs['rm'](keyPath,()=>{}),fs['rm'](_0x40c499,()=>{}),setHealthCheckInterval();else{if(_0x5b342b[_0x3b5015(0x19c)](_0x3b5015(0x19b))!=-0x1)saveNasProxyState(_0x3b5015(0x191),new Date()['getTime'](),i18n['__'](_0x3b5015(0x172)));else{if(_0x5b342b[_0x3b5015(0x19c)](_0x3b5015(0x1b9))!=-0x1)saveNasProxyState(_0x3b5015(0x191),new Date()['getTime'](),i18n['__'](_0x3b5015(0x1b9))),tryRestartFrpc();else _0x5b342b['indexOf']('tmp/proxy/tmp_crt')!=-0x1&&tryRestartFrpc();}}}}}}}),proxyProcess['stderr']['on'](_0xed7911(0x182),_0x5a1bc2=>{const _0x50a0bc=_0xed7911;let _0x1a5769=_0x5a1bc2[_0x50a0bc(0x12b)]();console[_0x50a0bc(0x137)](_0x50a0bc(0x14a),_0x1a5769),_0x1a5769['indexOf']('wsarecv')==-0x1&&_0x1a5769[_0x50a0bc(0x19c)](_0x50a0bc(0x13a))==-0x1&&_0x1a5769['indexOf'](_0x50a0bc(0x12f))==-0x1&&(frpIsConnected=![]),tryRestartFrpc();}),proxyProcess['on'](_0xed7911(0x144),_0x399e9d=>{const _0x398f64=_0xed7911;console[_0x398f64(0x137)](_0x398f64(0x154)),frpIsConnected=![],stopProxy();});});}