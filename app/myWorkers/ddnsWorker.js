function _0x20bd(){const _0x5b0e3b=['findByTitle','proxy.conFail','apiGetIpv4','create','path','error','log','896679WJQfEC','send','17608QoCLmc','pragma','catch','start','title','getI18n','startDdns','Error\x20occurred\x20in\x20ddns\x20process','globalIpList','then','ipv6Address','message','ipv6addressNotFound','token','better-sqlite3','stack','ddnsIp','close','journal_mode\x20=\x20WAL','DDNS\x20设置失败,\x20网络请求失败','Start\x20ddns...','force','value','data','../express-server/utils/cryptoUtils','success','332epwigx','exit','../utils/i18nUtil','DDNS\x20is\x20not\x20open','vipInfo','User\x20didn\x27t\x20login\x20nascab','uncaughtException','nasAccountInfoPwd','474890XrrnNL','proxy.noSubdomain','../db/dbConfigTable','getUrlByUrlKey','type','../utils/messageUtil','../myConfig/config','1390ZEJUGN','nasDdnsState','deleteByTitle','proxy.noLoginInfo','decryptString','length','6zirXpn','proxy.isntVip','ipv4','获取公网ip失败','1553678TLdBGj','ddnsIpv6Address','27AGfhGj','1587800gYUYuJ','NasCabDDNSWorker','post','axios','../myConfig/urlConfig','ipv6','ddnsIpv4Address','1824nYvhJk','11STAiGX','nasAccountInfoConfigKey','parse','fail','stop','saveMsg','apiGetIpv6'];_0x20bd=function(){return _0x5b0e3b;};return _0x20bd();}const _0x54ee78=_0x5434;(function(_0x17edb2,_0x7e195e){const _0x51ee93=_0x5434,_0x1e4ea9=_0x17edb2();while(!![]){try{const _0x2972a5=-parseInt(_0x51ee93(0x18e))/0x1+-parseInt(_0x51ee93(0x1a8))/0x2*(parseInt(_0x51ee93(0x1c3))/0x3)+parseInt(_0x51ee93(0x17d))/0x4*(-parseInt(_0x51ee93(0x1b7))/0x5)+parseInt(_0x51ee93(0x1bd))/0x6*(parseInt(_0x51ee93(0x1c1))/0x7)+parseInt(_0x51ee93(0x176))/0x8+-parseInt(_0x51ee93(0x18c))/0x9+-parseInt(_0x51ee93(0x1b0))/0xa*(parseInt(_0x51ee93(0x17e))/0xb);if(_0x2972a5===_0x7e195e)break;else _0x1e4ea9['push'](_0x1e4ea9['shift']());}catch(_0x1b4580){_0x1e4ea9['push'](_0x1e4ea9['shift']());}}}(_0x20bd,0x1f1cf));let path=require(_0x54ee78(0x189)),fs=require('fs');const config=require(_0x54ee78(0x1b6)),Database=require(_0x54ee78(0x19c));let dbOther=new Database(config['dbOther'],{});dbOther[_0x54ee78(0x18f)](_0x54ee78(0x1a0));let dbConfigTable=require(_0x54ee78(0x1b2)),cryptoUtils=require(_0x54ee78(0x1a6)),axios=require(_0x54ee78(0x179)),i18nUtil=require(_0x54ee78(0x1aa)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,urlConfig=require(_0x54ee78(0x17a)),reqInterval;const messageUtil=require(_0x54ee78(0x1b5));process[_0x54ee78(0x192)]=_0x54ee78(0x177),process['on'](_0x54ee78(0x1ae),(_0x617d79,_0x2c6c5b)=>{const _0x3bea20=_0x54ee78;messageUtil[_0x3bea20(0x183)](dbOther,_0x3bea20(0x195),_0x3bea20(0x18a),_0x617d79[_0x3bea20(0x19d)]||_0x617d79['message']);}),process['on'](_0x54ee78(0x1a9),()=>{const _0xcddae4=_0x54ee78;reqInterval&&clearInterval(reqInterval),dbOther[_0xcddae4(0x19f)]();});function _0x5434(_0x2aff12,_0x1f937d){const _0x20bd17=_0x20bd();return _0x5434=function(_0x5434f1,_0x480909){_0x5434f1=_0x5434f1-0x176;let _0x5ef950=_0x20bd17[_0x5434f1];return _0x5ef950;},_0x5434(_0x2aff12,_0x1f937d);}function exitProcess(){const _0x52c296=_0x54ee78;console[_0x52c296(0x18b)]('DDNS\x20stop'),process[_0x52c296(0x18d)]({'type':'close'}),process[_0x52c296(0x1a9)]();}process['on'](_0x54ee78(0x199),_0x47ff1e=>{const _0x1f03bc=_0x54ee78;if(_0x47ff1e[_0x1f03bc(0x1b4)]==_0x1f03bc(0x191))startDdns();else _0x47ff1e[_0x1f03bc(0x1b4)]==_0x1f03bc(0x182)&&exitProcess();});function getDdnsType(){const _0x1b1f92=_0x54ee78;let _0xc870ba=dbConfigTable[_0x1b1f92(0x185)](dbOther,'ddnsType');return!_0xc870ba?_0xc870ba='ipv4':_0xc870ba=_0xc870ba[_0x1b1f92(0x1a4)],_0xc870ba;}function saveNasDdnsState(_0x1cd736,_0x5cd7e9,_0x44ddaf,_0x1b9329){const _0x4d551e=_0x54ee78;dbConfigTable[_0x4d551e(0x188)](dbOther,{'title':_0x4d551e(0x1b8),'value':JSON['stringify']({'status':_0x1cd736,'ddnsIp':_0x5cd7e9,'error':_0x44ddaf})}),_0x1cd736==_0x4d551e(0x181)&&!_0x1b9329&&exitProcess();}function reqSetDDNS(_0x1aa31b,_0x44866f){const _0x2c06a8=_0x54ee78;let _0x34e596=getDdnsType(),_0x21ef4c='',_0x2003b6='';_0x34e596==_0x2c06a8(0x17b)?(dbConfigTable[_0x2c06a8(0x1b9)](dbOther,_0x2c06a8(0x17c)),getMyIp(_0x34e596,_0x278354=>{const _0x169baf=_0x2c06a8;if(_0x278354)_0x21ef4c=_0x278354,_0x5a80c5();else try{let _0x3ed47f=dbConfigTable['findByTitle'](dbOther,_0x169baf(0x196));_0x3ed47f&&(_0x3ed47f=JSON[_0x169baf(0x180)](_0x3ed47f[_0x169baf(0x1a4)]));for(let _0x5815f3 in _0x3ed47f){if(_0x3ed47f[_0x5815f3]['type']==_0x169baf(0x17b)){_0x21ef4c=_0x3ed47f[_0x5815f3]['ip'];break;}}if(_0x21ef4c)_0x5a80c5();else return saveNasDdnsState(_0x169baf(0x181),'',i18n['__'](_0x169baf(0x19a)));}catch(_0x3a5f0a){return saveNasDdnsState(_0x169baf(0x181),'',i18n['__'](_0x169baf(0x19a)));}})):(dbConfigTable[_0x2c06a8(0x1b9)](dbOther,_0x2c06a8(0x1c2)),getMyIp(_0x34e596,_0x57f341=>{_0x2003b6=_0x57f341,_0x5a80c5();}));function _0x5a80c5(){const _0x4a1063=_0x2c06a8;let _0x4812f1={'token':userToken,'type':_0x1aa31b?_0x4a1063(0x194):'stopDdns'};_0x34e596&&(_0x4812f1['ddnsType']=_0x34e596);_0x21ef4c&&(_0x4812f1[_0x4a1063(0x198)]=_0x21ef4c);if(_0x34e596==_0x4a1063(0x17b)&&_0x21ef4c&&!_0x44866f){let _0x406279=dbConfigTable[_0x4a1063(0x185)](dbOther,'ddnsIpv6Address');if(_0x406279&&_0x406279['value']==_0x21ef4c)return;}if(_0x34e596==_0x4a1063(0x1bf)&&_0x2003b6&&!_0x44866f){let _0x467d5c=dbConfigTable[_0x4a1063(0x185)](dbOther,_0x4a1063(0x17c));if(_0x467d5c&&_0x467d5c['value']==_0x2003b6)return;}_0x44866f&&_0x44866f==0x1&&(_0x4812f1[_0x4a1063(0x1a3)]=_0x44866f),axios[_0x4a1063(0x178)](urlConfig[_0x4a1063(0x1b3)](dbOther,'apiDDNSUrl'),_0x4812f1)[_0x4a1063(0x197)](_0xf5702e=>{const _0x1c9d27=_0x4a1063;return _0xf5702e[_0x1c9d27(0x1a5)]['code']?saveNasDdnsState(_0x1c9d27(0x181),'',i18n['__'](_0x1c9d27(0x186)),!![]):(_0x34e596==_0x1c9d27(0x17b)&&dbConfigTable[_0x1c9d27(0x188)](dbOther,{'title':_0x1c9d27(0x1c2),'value':_0xf5702e[_0x1c9d27(0x1a5)][_0x1c9d27(0x19e)]}),_0x34e596=='ipv4'&&dbConfigTable[_0x1c9d27(0x188)](dbOther,{'title':_0x1c9d27(0x17c),'value':_0xf5702e[_0x1c9d27(0x1a5)]['ddnsIp']}),console['log']('DDNS\x20设置成功：\x20',_0xf5702e[_0x1c9d27(0x1a5)][_0x1c9d27(0x19e)]),saveNasDdnsState(_0x1c9d27(0x1a7),_0xf5702e[_0x1c9d27(0x1a5)]['ddnsIp'],''));})[_0x4a1063(0x190)](_0x175c21=>{const _0x1f1056=_0x4a1063;console[_0x1f1056(0x18b)](_0x1f1056(0x1a1));});}}let startDdns=async function(){const _0x378e22=_0x54ee78;console['log'](_0x378e22(0x1a2));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil[_0x378e22(0x193)](dbOther);let _0x5ab30a=dbConfigTable['findByTitle'](dbOther,'nasDdnsEnable');if(!_0x5ab30a||_0x5ab30a[_0x378e22(0x1a4)]!=0x1)return console['log'](_0x378e22(0x1ab)),reqSetDDNS(![]),saveNasDdnsState('fail','','OFF');let _0x1e2914=dbConfigTable[_0x378e22(0x185)](dbOther,config[_0x378e22(0x17f)]);if(!_0x1e2914)return console[_0x378e22(0x18b)](_0x378e22(0x1ad)),saveNasDdnsState('fail','',i18n['__'](_0x378e22(0x1ba)));cryptoUtils[_0x378e22(0x1bb)](config[_0x378e22(0x1af)],_0x1e2914[_0x378e22(0x1a4)])[_0x378e22(0x197)](_0x4f3af1=>{const _0x1f506d=_0x378e22;let _0x4d23ca=JSON['parse'](_0x4f3af1),_0x1beb58=_0x4d23ca['userInfo'],_0x118a34=_0x4d23ca[_0x1f506d(0x1ac)];_0x1beb58[_0x1f506d(0x19b)]&&_0x1beb58[_0x1f506d(0x19b)][_0x1f506d(0x1bc)]>0x0&&(userToken=_0x1beb58['token'][_0x1beb58['token']['length']-0x1]);if(!userToken)return saveNasDdnsState(_0x1f506d(0x181),'',i18n['__'](_0x1f506d(0x1ba)));if(!_0x118a34)return saveNasDdnsState('fail','',i18n['__'](_0x1f506d(0x1be)));if(!_0x118a34['subdomain'])return saveNasDdnsState('fail','',i18n['__'](_0x1f506d(0x1b1)));let _0x13f0ec=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x13f0ec==_0x1f506d(0x1bf)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x378e22(0x190)](_0x59bd18=>{const _0x59675c=_0x378e22;console[_0x59675c(0x18b)](_0x59bd18),dbConfigTable[_0x59675c(0x1b9)](dbOther,config[_0x59675c(0x17f)]);});};function getMyIp(_0x228cea,_0x70d0d2){const _0x1ba360=_0x54ee78;let _0x45182e=urlConfig[_0x1ba360(0x1b3)](dbOther,_0x1ba360(0x187));_0x228cea==_0x1ba360(0x17b)&&(_0x45182e=urlConfig['getUrlByUrlKey'](dbOther,_0x1ba360(0x184)));const _0x5e801b={'timeout':0x2710};axios[_0x1ba360(0x178)](_0x45182e,{},_0x5e801b)[_0x1ba360(0x197)](_0x52ba04=>{const _0xab07e5=_0x1ba360;_0x52ba04&&_0x52ba04['data']&&_0x52ba04[_0xab07e5(0x1a5)]['ip']?_0x70d0d2&&_0x70d0d2(_0x52ba04[_0xab07e5(0x1a5)]['ip']):(console[_0xab07e5(0x18b)](_0xab07e5(0x1c0)),_0x70d0d2&&_0x70d0d2(null));})['catch'](_0x200855=>{const _0x5b3522=_0x1ba360;console[_0x5b3522(0x18b)](_0x5b3522(0x1c0),_0x200855[_0x5b3522(0x19d)]),_0x70d0d2&&_0x70d0d2(null);});}startDdns();