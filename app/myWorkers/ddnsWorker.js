const _0x5781e6=_0x2dc8;(function(_0x47ceff,_0x4bf95e){const _0x3a5da9=_0x2dc8,_0x21fc98=_0x47ceff();while(!![]){try{const _0x4c416d=parseInt(_0x3a5da9(0x1ee))/0x1+-parseInt(_0x3a5da9(0x1e7))/0x2*(-parseInt(_0x3a5da9(0x1ed))/0x3)+-parseInt(_0x3a5da9(0x1dc))/0x4+parseInt(_0x3a5da9(0x1bf))/0x5+parseInt(_0x3a5da9(0x1d8))/0x6+parseInt(_0x3a5da9(0x1f4))/0x7+-parseInt(_0x3a5da9(0x1b9))/0x8;if(_0x4c416d===_0x4bf95e)break;else _0x21fc98['push'](_0x21fc98['shift']());}catch(_0x3e0e61){_0x21fc98['push'](_0x21fc98['shift']());}}}(_0x4de6,0xd8069));let path=require(_0x5781e6(0x1be)),fs=require('fs');const config=require('../myConfig/config'),Database=require('better-sqlite3');let dbOther=new Database(config['dbOther'],{});dbOther[_0x5781e6(0x1d6)](_0x5781e6(0x1cf));let dbConfigTable=require(_0x5781e6(0x1ef)),cryptoUtils=require(_0x5781e6(0x1f6)),axios=require('axios'),i18nUtil=require(_0x5781e6(0x1d0)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,urlConfig=require(_0x5781e6(0x1f2)),reqInterval;const messageUtil=require(_0x5781e6(0x1d4));process[_0x5781e6(0x1c7)]=_0x5781e6(0x1e4),process['on'](_0x5781e6(0x1f8),(_0x3f34a9,_0x4694a6)=>{const _0x3e191e=_0x5781e6;messageUtil[_0x3e191e(0x1c8)](dbOther,_0x3e191e(0x1ba),'error',_0x3f34a9[_0x3e191e(0x1bd)]||_0x3f34a9[_0x3e191e(0x1d9)]);}),process['on'](_0x5781e6(0x1b8),()=>{reqInterval&&clearInterval(reqInterval),dbOther['close']();});function exitProcess(){console['log']('DDNS\x20stop'),process['send']({'type':'close'}),process['exit']();}process['on'](_0x5781e6(0x1d9),_0x478c93=>{const _0x137409=_0x5781e6;if(_0x478c93['type']==_0x137409(0x1c0))startDdns();else _0x478c93[_0x137409(0x1ec)]=='stop'&&exitProcess();});function getDdnsType(){const _0x54e7d9=_0x5781e6;let _0x5741a7=dbConfigTable['findByTitle'](dbOther,_0x54e7d9(0x1fa));return!_0x5741a7?_0x5741a7=_0x54e7d9(0x1e0):_0x5741a7=_0x5741a7[_0x54e7d9(0x1e1)],_0x5741a7;}function saveNasDdnsState(_0x44d441,_0x1f6b70,_0x3c2cc9,_0x4d757e){const _0x48d9f2=_0x5781e6;dbConfigTable[_0x48d9f2(0x1e5)](dbOther,{'title':'nasDdnsState','value':JSON[_0x48d9f2(0x1de)]({'status':_0x44d441,'ddnsIp':_0x1f6b70,'error':_0x3c2cc9})}),_0x44d441==_0x48d9f2(0x1ce)&&!_0x4d757e&&exitProcess();}function reqSetDDNS(_0x10cceb,_0x42f59b){const _0x4f7340=_0x5781e6;let _0x13c5e6=getDdnsType(),_0x4a5981='',_0x11c011='';_0x13c5e6==_0x4f7340(0x1c3)?(dbConfigTable['deleteByTitle'](dbOther,_0x4f7340(0x1d1)),getMyIp(_0x13c5e6,_0xd0b1a0=>{const _0x5711e4=_0x4f7340;if(_0xd0b1a0)_0x4a5981=_0xd0b1a0,_0x491000();else try{let _0x2929cd=dbConfigTable[_0x5711e4(0x1e6)](dbOther,_0x5711e4(0x1ea));_0x2929cd&&(_0x2929cd=JSON['parse'](_0x2929cd['value']));for(let _0x73ab51 in _0x2929cd){if(_0x2929cd[_0x73ab51][_0x5711e4(0x1ec)]==_0x5711e4(0x1c3)){_0x4a5981=_0x2929cd[_0x73ab51]['ip'];break;}}if(_0x4a5981)_0x491000();else return saveNasDdnsState(_0x5711e4(0x1ce),'',i18n['__'](_0x5711e4(0x1c4)));}catch(_0x4b4ea0){return saveNasDdnsState(_0x5711e4(0x1ce),'',i18n['__'](_0x5711e4(0x1c4)));}})):(dbConfigTable['deleteByTitle'](dbOther,_0x4f7340(0x1d5)),getMyIp(_0x13c5e6,_0x136df6=>{_0x11c011=_0x136df6,_0x491000();}));function _0x491000(){const _0x270e3d=_0x4f7340;let _0x24dc5b={'token':userToken,'type':_0x10cceb?_0x270e3d(0x1df):_0x270e3d(0x1c5)};_0x13c5e6&&(_0x24dc5b[_0x270e3d(0x1fa)]=_0x13c5e6);_0x4a5981&&(_0x24dc5b[_0x270e3d(0x1e8)]=_0x4a5981);if(_0x13c5e6==_0x270e3d(0x1c3)&&_0x4a5981&&!_0x42f59b){let _0x2e78df=dbConfigTable[_0x270e3d(0x1e6)](dbOther,_0x270e3d(0x1d5));if(_0x2e78df&&_0x2e78df[_0x270e3d(0x1e1)]==_0x4a5981)return;}if(_0x13c5e6==_0x270e3d(0x1e0)&&_0x11c011&&!_0x42f59b){let _0x2532cd=dbConfigTable[_0x270e3d(0x1e6)](dbOther,_0x270e3d(0x1d1));if(_0x2532cd&&_0x2532cd['value']==_0x11c011)return;}_0x42f59b&&_0x42f59b==0x1&&(_0x24dc5b[_0x270e3d(0x1cd)]=_0x42f59b),axios[_0x270e3d(0x1bb)](urlConfig[_0x270e3d(0x1f1)](dbOther,_0x270e3d(0x1e9)),_0x24dc5b)[_0x270e3d(0x1d2)](_0x2304b6=>{const _0x2c781d=_0x270e3d;return _0x2304b6[_0x2c781d(0x1c6)][_0x2c781d(0x1ca)]?saveNasDdnsState(_0x2c781d(0x1ce),'',i18n['__'](_0x2c781d(0x1cc)),!![]):(_0x13c5e6=='ipv6'&&dbConfigTable[_0x2c781d(0x1e5)](dbOther,{'title':_0x2c781d(0x1d5),'value':_0x2304b6['data']['ddnsIp']}),_0x13c5e6=='ipv4'&&dbConfigTable[_0x2c781d(0x1e5)](dbOther,{'title':_0x2c781d(0x1d1),'value':_0x2304b6['data'][_0x2c781d(0x1bc)]}),console['log'](_0x2c781d(0x1dd),_0x2304b6[_0x2c781d(0x1c6)][_0x2c781d(0x1bc)]),saveNasDdnsState(_0x2c781d(0x1f0),_0x2304b6[_0x2c781d(0x1c6)][_0x2c781d(0x1bc)],''));})[_0x270e3d(0x1c9)](_0x479ddf=>{console['log']('DDNS\x20设置失败,\x20网络请求失败');});}}let startDdns=async function(){const _0x1cd58a=_0x5781e6;console['log'](_0x1cd58a(0x1c1));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil['getI18n'](dbOther);let _0xe20a68=dbConfigTable[_0x1cd58a(0x1e6)](dbOther,_0x1cd58a(0x1f9));if(!_0xe20a68||_0xe20a68[_0x1cd58a(0x1e1)]!=0x1)return console[_0x1cd58a(0x1e3)](_0x1cd58a(0x1c2)),reqSetDDNS(![]),saveNasDdnsState(_0x1cd58a(0x1ce),'','OFF');let _0x2345f8=dbConfigTable[_0x1cd58a(0x1e6)](dbOther,config[_0x1cd58a(0x1f7)]);if(!_0x2345f8)return console[_0x1cd58a(0x1e3)](_0x1cd58a(0x1e2)),saveNasDdnsState(_0x1cd58a(0x1ce),'',i18n['__'](_0x1cd58a(0x1f5)));cryptoUtils[_0x1cd58a(0x1d3)](config[_0x1cd58a(0x1cb)],_0x2345f8[_0x1cd58a(0x1e1)])[_0x1cd58a(0x1d2)](_0x4d416d=>{const _0x2b3101=_0x1cd58a;let _0x50cad9=JSON['parse'](_0x4d416d),_0x310536=_0x50cad9['userInfo'],_0x247c91=_0x50cad9[_0x2b3101(0x1db)];_0x310536[_0x2b3101(0x1d7)]&&_0x310536[_0x2b3101(0x1d7)][_0x2b3101(0x1f3)]>0x0&&(userToken=_0x310536[_0x2b3101(0x1d7)][_0x310536[_0x2b3101(0x1d7)]['length']-0x1]);if(!userToken)return saveNasDdnsState('fail','',i18n['__'](_0x2b3101(0x1f5)));if(!_0x247c91)return saveNasDdnsState(_0x2b3101(0x1ce),'',i18n['__']('proxy.isntVip'));if(!_0x247c91[_0x2b3101(0x1fb)])return saveNasDdnsState(_0x2b3101(0x1ce),'',i18n['__']('proxy.noSubdomain'));let _0x1980ec=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x1980ec==_0x2b3101(0x1e0)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x1cd58a(0x1c9)](_0x280041=>{const _0x658a9b=_0x1cd58a;console[_0x658a9b(0x1e3)](_0x280041),dbConfigTable['deleteByTitle'](dbOther,config['nasAccountInfoConfigKey']);});};function _0x2dc8(_0x37e01b,_0x570ae0){const _0x4de6d8=_0x4de6();return _0x2dc8=function(_0x2dc805,_0x123b1d){_0x2dc805=_0x2dc805-0x1b8;let _0x2f3ee9=_0x4de6d8[_0x2dc805];return _0x2f3ee9;},_0x2dc8(_0x37e01b,_0x570ae0);}function getMyIp(_0xd48e7b,_0xc2511b){const _0x296a7a=_0x5781e6;let _0x456485=urlConfig['getUrlByUrlKey'](dbOther,_0x296a7a(0x1eb));_0xd48e7b==_0x296a7a(0x1c3)&&(_0x456485=urlConfig['getUrlByUrlKey'](dbOther,'apiGetIpv6'));const _0x3b2122={'timeout':0x2710};axios[_0x296a7a(0x1bb)](_0x456485,{},_0x3b2122)[_0x296a7a(0x1d2)](_0x2b625c=>{const _0x1d7127=_0x296a7a;_0x2b625c&&_0x2b625c[_0x1d7127(0x1c6)]&&_0x2b625c['data']['ip']?_0xc2511b&&_0xc2511b(_0x2b625c[_0x1d7127(0x1c6)]['ip']):(console['log']('获取公网ip失败'),_0xc2511b&&_0xc2511b(null));})[_0x296a7a(0x1c9)](_0x155363=>{const _0x4770b0=_0x296a7a;console[_0x4770b0(0x1e3)](_0x4770b0(0x1da),_0x155363[_0x4770b0(0x1bd)]),_0xc2511b&&_0xc2511b(null);});}function _0x4de6(){const _0x4a2916=['journal_mode\x20=\x20WAL','../utils/i18nUtil','ddnsIpv4Address','then','decryptString','../utils/messageUtil','ddnsIpv6Address','pragma','token','9222558VuvaEK','message','获取公网ip失败','vipInfo','837724IQTOaz','DDNS\x20设置成功：\x20','stringify','startDdns','ipv4','value','User\x20didn\x27t\x20login\x20nascab','log','NasCabDDNSWorker','create','findByTitle','166mcMSvz','ipv6Address','apiDDNSUrl','globalIpList','apiGetIpv4','type','12933cRmfRv','266279UWhhQU','../db/dbConfigTable','success','getUrlByUrlKey','../myConfig/urlConfig','length','1885821mPiVWj','proxy.noLoginInfo','../express-server/utils/cryptoUtils','nasAccountInfoConfigKey','uncaughtException','nasDdnsEnable','ddnsType','subdomain','exit','10784400lRgOZQ','Error\x20occurred\x20in\x20ddns\x20process','post','ddnsIp','stack','path','58670Pmqqhj','start','Start\x20ddns...','DDNS\x20is\x20not\x20open','ipv6','ipv6addressNotFound','stopDdns','data','title','saveMsg','catch','code','nasAccountInfoPwd','proxy.conFail','force','fail'];_0x4de6=function(){return _0x4a2916;};return _0x4de6();}startDdns();