const _0x6cad2c=_0x30ea;(function(_0x30c8a0,_0x5a47be){const _0x2aa99c=_0x30ea,_0xdd161e=_0x30c8a0();while(!![]){try{const _0x52bc0d=-parseInt(_0x2aa99c(0x13a))/0x1*(-parseInt(_0x2aa99c(0x11a))/0x2)+-parseInt(_0x2aa99c(0x11b))/0x3*(parseInt(_0x2aa99c(0x10b))/0x4)+parseInt(_0x2aa99c(0x115))/0x5+parseInt(_0x2aa99c(0x109))/0x6*(-parseInt(_0x2aa99c(0x141))/0x7)+-parseInt(_0x2aa99c(0x140))/0x8*(parseInt(_0x2aa99c(0x114))/0x9)+-parseInt(_0x2aa99c(0x10c))/0xa*(-parseInt(_0x2aa99c(0x11f))/0xb)+-parseInt(_0x2aa99c(0x130))/0xc*(-parseInt(_0x2aa99c(0x129))/0xd);if(_0x52bc0d===_0x5a47be)break;else _0xdd161e['push'](_0xdd161e['shift']());}catch(_0x4bbeeb){_0xdd161e['push'](_0xdd161e['shift']());}}}(_0x59f5,0x1edb8));let path=require(_0x6cad2c(0x10e)),fs=require('fs');const config=require('../myConfig/config'),Database=require(_0x6cad2c(0x12e));let dbOther=new Database(config[_0x6cad2c(0x101)],{});dbOther[_0x6cad2c(0x11e)](_0x6cad2c(0x121));let dbConfigTable=require('../db/dbConfigTable'),cryptoUtils=require('../express-server/utils/cryptoUtils'),axios=require(_0x6cad2c(0xff)),i18nUtil=require(_0x6cad2c(0x13c)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,urlConfig=require(_0x6cad2c(0x134)),reqInterval;const messageUtil=require('../utils/messageUtil');process['title']=_0x6cad2c(0x142),process['on'](_0x6cad2c(0xfe),(_0x47b117,_0x1fe6e3)=>{const _0x5e3fbf=_0x6cad2c;messageUtil['saveMsg'](dbOther,_0x5e3fbf(0x112),_0x5e3fbf(0x116),_0x47b117[_0x5e3fbf(0x13e)]||_0x47b117[_0x5e3fbf(0x105)]);}),process['on'](_0x6cad2c(0x147),()=>{const _0x126199=_0x6cad2c;reqInterval&&clearInterval(reqInterval),dbOther[_0x126199(0x100)]();});function exitProcess(){const _0x4531d9=_0x6cad2c;console['log'](_0x4531d9(0x126)),process[_0x4531d9(0x106)]({'type':_0x4531d9(0x100)}),process[_0x4531d9(0x147)]();}process['on']('message',_0x582778=>{const _0x5d330d=_0x6cad2c;if(_0x582778['type']==_0x5d330d(0x143))startDdns();else _0x582778['type']=='stop'&&exitProcess();});function _0x59f5(){const _0x90b3aa=['313026yqGhPN','findByTitle','User\x20didn\x27t\x20login\x20nascab','pragma','3718ldRUzx','fail','journal_mode\x20=\x20WAL','stringify','token','nasAccountInfoPwd','Start\x20ddns...','DDNS\x20stop','proxy.conFail','ipv6addressNotFound','13jHHraF','then','force','nasDdnsState','success','better-sqlite3','deleteByTitle','712824GSfumu','length','ipv6','catch','../myConfig/urlConfig','stopDdns','data','获取公网ip失败','getUrlByUrlKey','value','23dwJovh','startDdns','../utils/i18nUtil','proxy.noLoginInfo','stack','ddnsIpv4Address','24TIQUhp','7GRqKhJ','NasCabDDNSWorker','start','ddnsIp','apiGetIpv6','getI18n','exit','vipInfo','parse','uncaughtException','axios','close','dbOther','type','ipv4','log','message','send','DDNS\x20设置成功：\x20','OFF','1229274YXfwcU','nasAccountInfoConfigKey','8xwSLSi','4440nYMVok','userInfo','path','decryptString','DDNS\x20设置失败,\x20网络请求失败','ddnsType','Error\x20occurred\x20in\x20ddns\x20process','ddnsIpv6Address','167238BOMmzJ','1226070ILPlyE','error','create','post','DDNS\x20is\x20not\x20open','12262qCQtXn'];_0x59f5=function(){return _0x90b3aa;};return _0x59f5();}function getDdnsType(){const _0x5d215d=_0x6cad2c;let _0x480a5f=dbConfigTable[_0x5d215d(0x11c)](dbOther,_0x5d215d(0x111));return!_0x480a5f?_0x480a5f=_0x5d215d(0x103):_0x480a5f=_0x480a5f[_0x5d215d(0x139)],_0x480a5f;}function _0x30ea(_0x479e98,_0x539f9c){const _0x59f572=_0x59f5();return _0x30ea=function(_0x30ea46,_0x4397e2){_0x30ea46=_0x30ea46-0xfd;let _0x2a7ae7=_0x59f572[_0x30ea46];return _0x2a7ae7;},_0x30ea(_0x479e98,_0x539f9c);}function saveNasDdnsState(_0x3fe82c,_0x447b10,_0xf46706,_0x3531b0){const _0x4925af=_0x6cad2c;dbConfigTable[_0x4925af(0x117)](dbOther,{'title':_0x4925af(0x12c),'value':JSON[_0x4925af(0x122)]({'status':_0x3fe82c,'ddnsIp':_0x447b10,'error':_0xf46706})}),_0x3fe82c==_0x4925af(0x120)&&!_0x3531b0&&exitProcess();}function reqSetDDNS(_0x10a7f3,_0xf6e386){const _0x4fb772=_0x6cad2c;let _0x136064=getDdnsType(),_0x482eee='',_0x3c23f1='';_0x136064==_0x4fb772(0x132)?(dbConfigTable['deleteByTitle'](dbOther,_0x4fb772(0x13f)),getMyIp(_0x136064,_0x209896=>{const _0x4943fb=_0x4fb772;if(_0x209896)_0x482eee=_0x209896,_0x395080();else try{let _0x550904=dbConfigTable['findByTitle'](dbOther,'globalIpList');_0x550904&&(_0x550904=JSON[_0x4943fb(0xfd)](_0x550904[_0x4943fb(0x139)]));for(let _0x3ed15c in _0x550904){if(_0x550904[_0x3ed15c][_0x4943fb(0x102)]==_0x4943fb(0x132)){_0x482eee=_0x550904[_0x3ed15c]['ip'];break;}}if(_0x482eee)_0x395080();else return saveNasDdnsState(_0x4943fb(0x120),'',i18n['__'](_0x4943fb(0x128)));}catch(_0x2a4b8c){return saveNasDdnsState(_0x4943fb(0x120),'',i18n['__'](_0x4943fb(0x128)));}})):(dbConfigTable['deleteByTitle'](dbOther,_0x4fb772(0x113)),getMyIp(_0x136064,_0x44b4f1=>{_0x3c23f1=_0x44b4f1,_0x395080();}));function _0x395080(){const _0x4ef3e4=_0x4fb772;let _0x2a86f5={'token':userToken,'type':_0x10a7f3?_0x4ef3e4(0x13b):_0x4ef3e4(0x135)};_0x136064&&(_0x2a86f5[_0x4ef3e4(0x111)]=_0x136064);_0x482eee&&(_0x2a86f5['ipv6Address']=_0x482eee);if(_0x136064=='ipv6'&&_0x482eee&&!_0xf6e386){let _0xfa3739=dbConfigTable[_0x4ef3e4(0x11c)](dbOther,_0x4ef3e4(0x113));if(_0xfa3739&&_0xfa3739[_0x4ef3e4(0x139)]==_0x482eee)return;}if(_0x136064==_0x4ef3e4(0x103)&&_0x3c23f1&&!_0xf6e386){let _0x5cd8bd=dbConfigTable[_0x4ef3e4(0x11c)](dbOther,'ddnsIpv4Address');if(_0x5cd8bd&&_0x5cd8bd[_0x4ef3e4(0x139)]==_0x3c23f1)return;}_0xf6e386&&_0xf6e386==0x1&&(_0x2a86f5[_0x4ef3e4(0x12b)]=_0xf6e386),axios[_0x4ef3e4(0x118)](urlConfig[_0x4ef3e4(0x138)](dbOther,'apiDDNSUrl'),_0x2a86f5)[_0x4ef3e4(0x12a)](_0x2e36c6=>{const _0x144885=_0x4ef3e4;return _0x2e36c6['data']['code']?saveNasDdnsState(_0x144885(0x120),'',i18n['__'](_0x144885(0x127)),!![]):(_0x136064=='ipv6'&&dbConfigTable[_0x144885(0x117)](dbOther,{'title':_0x144885(0x113),'value':_0x2e36c6['data']['ddnsIp']}),_0x136064==_0x144885(0x103)&&dbConfigTable[_0x144885(0x117)](dbOther,{'title':'ddnsIpv4Address','value':_0x2e36c6['data']['ddnsIp']}),console['log'](_0x144885(0x107),_0x2e36c6[_0x144885(0x136)][_0x144885(0x144)]),saveNasDdnsState(_0x144885(0x12d),_0x2e36c6[_0x144885(0x136)][_0x144885(0x144)],''));})[_0x4ef3e4(0x133)](_0x1b6530=>{const _0x581ff9=_0x4ef3e4;console['log'](_0x581ff9(0x110));});}}let startDdns=async function(){const _0xf4a644=_0x6cad2c;console[_0xf4a644(0x104)](_0xf4a644(0x125));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil[_0xf4a644(0x146)](dbOther);let _0x27cd14=dbConfigTable[_0xf4a644(0x11c)](dbOther,'nasDdnsEnable');if(!_0x27cd14||_0x27cd14[_0xf4a644(0x139)]!=0x1)return console[_0xf4a644(0x104)](_0xf4a644(0x119)),reqSetDDNS(![]),saveNasDdnsState(_0xf4a644(0x120),'',_0xf4a644(0x108));let _0x559cd2=dbConfigTable[_0xf4a644(0x11c)](dbOther,config['nasAccountInfoConfigKey']);if(!_0x559cd2)return console['log'](_0xf4a644(0x11d)),saveNasDdnsState(_0xf4a644(0x120),'',i18n['__']('proxy.noLoginInfo'));cryptoUtils[_0xf4a644(0x10f)](config[_0xf4a644(0x124)],_0x559cd2['value'])[_0xf4a644(0x12a)](_0x9435ca=>{const _0x2dd742=_0xf4a644;let _0x283134=JSON[_0x2dd742(0xfd)](_0x9435ca),_0x5836ee=_0x283134[_0x2dd742(0x10d)],_0x1ff027=_0x283134[_0x2dd742(0x148)];_0x5836ee[_0x2dd742(0x123)]&&_0x5836ee[_0x2dd742(0x123)]['length']>0x0&&(userToken=_0x5836ee['token'][_0x5836ee[_0x2dd742(0x123)][_0x2dd742(0x131)]-0x1]);if(!userToken)return saveNasDdnsState(_0x2dd742(0x120),'',i18n['__'](_0x2dd742(0x13d)));if(!_0x1ff027)return saveNasDdnsState(_0x2dd742(0x120),'',i18n['__']('proxy.isntVip'));if(!_0x1ff027['subdomain'])return saveNasDdnsState(_0x2dd742(0x120),'',i18n['__']('proxy.noSubdomain'));let _0x46bd33=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x46bd33==_0x2dd742(0x103)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0xf4a644(0x133)](_0x4cb92c=>{const _0x5df9c0=_0xf4a644;console[_0x5df9c0(0x104)](_0x4cb92c),dbConfigTable[_0x5df9c0(0x12f)](dbOther,config[_0x5df9c0(0x10a)]);});};function getMyIp(_0x5d70a6,_0x53eba0){const _0x5c4021=_0x6cad2c;let _0x24e779=urlConfig[_0x5c4021(0x138)](dbOther,'apiGetIpv4');_0x5d70a6==_0x5c4021(0x132)&&(_0x24e779=urlConfig[_0x5c4021(0x138)](dbOther,_0x5c4021(0x145)));const _0x218527={'timeout':0x2710};axios['post'](_0x24e779,{},_0x218527)[_0x5c4021(0x12a)](_0x433263=>{const _0x4cc9a6=_0x5c4021;_0x433263&&_0x433263[_0x4cc9a6(0x136)]&&_0x433263[_0x4cc9a6(0x136)]['ip']?_0x53eba0&&_0x53eba0(_0x433263[_0x4cc9a6(0x136)]['ip']):(console['log'](_0x4cc9a6(0x137)),_0x53eba0&&_0x53eba0(null));})[_0x5c4021(0x133)](_0x7545c4=>{const _0x2aa451=_0x5c4021;console['log'](_0x2aa451(0x137),_0x7545c4[_0x2aa451(0x13e)]),_0x53eba0&&_0x53eba0(null);});}startDdns();