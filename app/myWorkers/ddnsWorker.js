const _0x3da773=_0x494c;(function(_0x4e64d7,_0x594b11){const _0x3307c4=_0x494c,_0x5306a0=_0x4e64d7();while(!![]){try{const _0x34c69f=-parseInt(_0x3307c4(0x1fa))/0x1*(-parseInt(_0x3307c4(0x237))/0x2)+-parseInt(_0x3307c4(0x223))/0x3*(parseInt(_0x3307c4(0x20e))/0x4)+-parseInt(_0x3307c4(0x218))/0x5*(-parseInt(_0x3307c4(0x206))/0x6)+parseInt(_0x3307c4(0x225))/0x7+-parseInt(_0x3307c4(0x20a))/0x8+-parseInt(_0x3307c4(0x1f5))/0x9+parseInt(_0x3307c4(0x21b))/0xa;if(_0x34c69f===_0x594b11)break;else _0x5306a0['push'](_0x5306a0['shift']());}catch(_0x58c1db){_0x5306a0['push'](_0x5306a0['shift']());}}}(_0x10a4,0xed3fe));let path=require(_0x3da773(0x1ea)),fs=require('fs');const config=require(_0x3da773(0x21e)),Database=require(_0x3da773(0x1fd));let dbOther=new Database(config[_0x3da773(0x1ff)],{});function _0x494c(_0xa9f266,_0x124834){const _0x10a46f=_0x10a4();return _0x494c=function(_0x494ceb,_0x238cc5){_0x494ceb=_0x494ceb-0x1e8;let _0xeffe03=_0x10a46f[_0x494ceb];return _0xeffe03;},_0x494c(_0xa9f266,_0x124834);}dbOther[_0x3da773(0x20d)](_0x3da773(0x1f6));let dbConfigTable=require('../db/dbConfigTable'),cryptoUtils=require(_0x3da773(0x1fc)),axios=require(_0x3da773(0x22c)),i18nUtil=require(_0x3da773(0x230)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,urlConfig=require(_0x3da773(0x220)),reqInterval;const messageUtil=require(_0x3da773(0x21c));process[_0x3da773(0x205)]=_0x3da773(0x1ec),process['on'](_0x3da773(0x238),(_0x25e770,_0x46fb2d)=>{const _0x41e753=_0x3da773;messageUtil[_0x41e753(0x200)](dbOther,'Error\x20occurred\x20in\x20ddns\x20process',_0x41e753(0x1e8),_0x25e770[_0x41e753(0x236)]||_0x25e770['message']);}),process['on'](_0x3da773(0x211),()=>{reqInterval&&clearInterval(reqInterval),dbOther['close']();});function exitProcess(){const _0x2e5f59=_0x3da773;console[_0x2e5f59(0x212)](_0x2e5f59(0x204)),process[_0x2e5f59(0x219)]({'type':'close'}),process[_0x2e5f59(0x211)]();}process['on']('message',_0xa41537=>{const _0x34fcbd=_0x3da773;if(_0xa41537[_0x34fcbd(0x224)]==_0x34fcbd(0x20b))startDdns();else _0xa41537['type']==_0x34fcbd(0x21f)&&exitProcess();});function getDdnsType(){const _0x15435e=_0x3da773;let _0x127c34=dbConfigTable[_0x15435e(0x22b)](dbOther,_0x15435e(0x228));return!_0x127c34?_0x127c34='ipv4':_0x127c34=_0x127c34['value'],_0x127c34;}function saveNasDdnsState(_0x1bcd9c,_0x11cfa4,_0x547460,_0xba87af){const _0x1425e5=_0x3da773;dbConfigTable[_0x1425e5(0x214)](dbOther,{'title':_0x1425e5(0x233),'value':JSON[_0x1425e5(0x1f3)]({'status':_0x1bcd9c,'ddnsIp':_0x11cfa4,'error':_0x547460})}),_0x1bcd9c==_0x1425e5(0x229)&&!_0xba87af&&exitProcess();}function reqSetDDNS(_0xa9c8b,_0x3349c0){const _0x37e4d1=_0x3da773;let _0x44621e=getDdnsType(),_0x3d621d='',_0x4e1109='';_0x44621e==_0x37e4d1(0x22d)?(dbConfigTable[_0x37e4d1(0x1f1)](dbOther,_0x37e4d1(0x216)),getMyIp(_0x44621e,_0x12accc=>{const _0x28c7f7=_0x37e4d1;if(_0x12accc)_0x3d621d=_0x12accc,_0xfa1973();else try{let _0x2b3940=dbConfigTable[_0x28c7f7(0x22b)](dbOther,'globalIpList');_0x2b3940&&(_0x2b3940=JSON['parse'](_0x2b3940['value']));for(let _0x492d4d in _0x2b3940){if(_0x2b3940[_0x492d4d][_0x28c7f7(0x224)]==_0x28c7f7(0x22d)){_0x3d621d=_0x2b3940[_0x492d4d]['ip'];break;}}if(_0x3d621d)_0xfa1973();else return saveNasDdnsState(_0x28c7f7(0x229),'',i18n['__'](_0x28c7f7(0x232)));}catch(_0x323e54){return saveNasDdnsState('fail','',i18n['__'](_0x28c7f7(0x232)));}})):(dbConfigTable['deleteByTitle'](dbOther,_0x37e4d1(0x209)),getMyIp(_0x44621e,_0x85efae=>{_0x4e1109=_0x85efae,_0xfa1973();}));function _0xfa1973(){const _0x3cd17a=_0x37e4d1;let _0x4b9b60={'token':userToken,'type':_0xa9c8b?_0x3cd17a(0x217):_0x3cd17a(0x231)};_0x44621e&&(_0x4b9b60[_0x3cd17a(0x228)]=_0x44621e);_0x3d621d&&(_0x4b9b60[_0x3cd17a(0x22e)]=_0x3d621d);if(_0x44621e==_0x3cd17a(0x22d)&&_0x3d621d&&!_0x3349c0){let _0x43165e=dbConfigTable[_0x3cd17a(0x22b)](dbOther,_0x3cd17a(0x209));if(_0x43165e&&_0x43165e[_0x3cd17a(0x235)]==_0x3d621d)return;}if(_0x44621e==_0x3cd17a(0x1ed)&&_0x4e1109&&!_0x3349c0){let _0x13ad23=dbConfigTable[_0x3cd17a(0x22b)](dbOther,'ddnsIpv4Address');if(_0x13ad23&&_0x13ad23[_0x3cd17a(0x235)]==_0x4e1109)return;}_0x3349c0&&_0x3349c0==0x1&&(_0x4b9b60[_0x3cd17a(0x227)]=_0x3349c0),axios[_0x3cd17a(0x226)](urlConfig[_0x3cd17a(0x203)](dbOther,_0x3cd17a(0x1ee)),_0x4b9b60)[_0x3cd17a(0x1fe)](_0x503763=>{const _0x5afd63=_0x3cd17a;return _0x503763['data'][_0x5afd63(0x222)]?saveNasDdnsState(_0x5afd63(0x229),'',i18n['__'](_0x5afd63(0x22a)),!![]):(_0x44621e==_0x5afd63(0x22d)&&dbConfigTable[_0x5afd63(0x214)](dbOther,{'title':_0x5afd63(0x209),'value':_0x503763[_0x5afd63(0x1e9)][_0x5afd63(0x1f8)]}),_0x44621e==_0x5afd63(0x1ed)&&dbConfigTable[_0x5afd63(0x214)](dbOther,{'title':_0x5afd63(0x216),'value':_0x503763['data']['ddnsIp']}),console[_0x5afd63(0x212)](_0x5afd63(0x1eb),_0x503763[_0x5afd63(0x1e9)]['ddnsIp']),saveNasDdnsState(_0x5afd63(0x210),_0x503763[_0x5afd63(0x1e9)][_0x5afd63(0x1f8)],''));})[_0x3cd17a(0x215)](_0x5b615f=>{console['log']('DDNS\x20设置失败,\x20网络请求失败');});}}function _0x10a4(){const _0x17cf8b=['31312360ssczpx','../utils/messageUtil','proxy.noLoginInfo','../myConfig/config','stop','../myConfig/urlConfig','getI18n','code','6ArhJJu','type','12450578WWcgNi','post','force','ddnsType','fail','proxy.conFail','findByTitle','axios','ipv6','ipv6Address','parse','../utils/i18nUtil','stopDdns','ipv6addressNotFound','nasDdnsState','Start\x20ddns...','value','stack','226hEGBVA','uncaughtException','error','data','path','DDNS\x20设置成功：\x20','NasCabDDNSWorker','ipv4','apiDDNSUrl','nasAccountInfoConfigKey','length','deleteByTitle','nasDdnsEnable','stringify','vipInfo','17288190ouONxP','journal_mode\x20=\x20WAL','获取公网ip失败','ddnsIp','decryptString','2513DeUQci','OFF','../express-server/utils/cryptoUtils','better-sqlite3','then','dbOther','saveMsg','apiGetIpv6','DDNS\x20is\x20not\x20open','getUrlByUrlKey','DDNS\x20stop','title','67056zFiPeq','userInfo','token','ddnsIpv6Address','10543496EAtpCp','start','subdomain','pragma','2279404vLYpPo','nasAccountInfoPwd','success','exit','log','proxy.noSubdomain','create','catch','ddnsIpv4Address','startDdns','70ksGJRn','send','proxy.isntVip'];_0x10a4=function(){return _0x17cf8b;};return _0x10a4();}let startDdns=async function(){const _0x535734=_0x3da773;console[_0x535734(0x212)](_0x535734(0x234));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil[_0x535734(0x221)](dbOther);let _0x573ccc=dbConfigTable[_0x535734(0x22b)](dbOther,_0x535734(0x1f2));if(!_0x573ccc||_0x573ccc[_0x535734(0x235)]!=0x1)return console['log'](_0x535734(0x202)),reqSetDDNS(![]),saveNasDdnsState('fail','',_0x535734(0x1fb));let _0x22eb99=dbConfigTable[_0x535734(0x22b)](dbOther,config[_0x535734(0x1ef)]);if(!_0x22eb99)return console['log']('User\x20didn\x27t\x20login\x20nascab'),saveNasDdnsState(_0x535734(0x229),'',i18n['__']('proxy.noLoginInfo'));cryptoUtils[_0x535734(0x1f9)](config[_0x535734(0x20f)],_0x22eb99['value'])[_0x535734(0x1fe)](_0x5f54bf=>{const _0x31ba1d=_0x535734;let _0x20aee7=JSON[_0x31ba1d(0x22f)](_0x5f54bf),_0x439596=_0x20aee7[_0x31ba1d(0x207)],_0x74021b=_0x20aee7[_0x31ba1d(0x1f4)];_0x439596[_0x31ba1d(0x208)]&&_0x439596[_0x31ba1d(0x208)]['length']>0x0&&(userToken=_0x439596[_0x31ba1d(0x208)][_0x439596[_0x31ba1d(0x208)][_0x31ba1d(0x1f0)]-0x1]);if(!userToken)return saveNasDdnsState('fail','',i18n['__'](_0x31ba1d(0x21d)));if(!_0x74021b)return saveNasDdnsState(_0x31ba1d(0x229),'',i18n['__'](_0x31ba1d(0x21a)));if(!_0x74021b[_0x31ba1d(0x20c)])return saveNasDdnsState(_0x31ba1d(0x229),'',i18n['__'](_0x31ba1d(0x213)));let _0x4fac2d=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x4fac2d==_0x31ba1d(0x1ed)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x535734(0x215)](_0x3a79b3=>{const _0x5d7e90=_0x535734;console['log'](_0x3a79b3),dbConfigTable[_0x5d7e90(0x1f1)](dbOther,config[_0x5d7e90(0x1ef)]);});};function getMyIp(_0x58203b,_0x10355e){const _0x48b87c=_0x3da773;let _0x51ecb5=urlConfig[_0x48b87c(0x203)](dbOther,'apiGetIpv4');_0x58203b==_0x48b87c(0x22d)&&(_0x51ecb5=urlConfig[_0x48b87c(0x203)](dbOther,_0x48b87c(0x201)));const _0x2f5cec={'timeout':0x2710};axios[_0x48b87c(0x226)](_0x51ecb5,{},_0x2f5cec)[_0x48b87c(0x1fe)](_0x4f2574=>{const _0x4dfe1f=_0x48b87c;_0x4f2574&&_0x4f2574[_0x4dfe1f(0x1e9)]&&_0x4f2574[_0x4dfe1f(0x1e9)]['ip']?_0x10355e&&_0x10355e(_0x4f2574[_0x4dfe1f(0x1e9)]['ip']):(console['log'](_0x4dfe1f(0x1f7)),_0x10355e&&_0x10355e(null));})['catch'](_0x187dbc=>{const _0xe5cb87=_0x48b87c;console['log'](_0xe5cb87(0x1f7),_0x187dbc[_0xe5cb87(0x236)]),_0x10355e&&_0x10355e(null);});}startDdns();