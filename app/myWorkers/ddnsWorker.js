const _0x2d7565=_0x5252;(function(_0x395141,_0x558308){const _0xba8dc4=_0x5252,_0xd3f527=_0x395141();while(!![]){try{const _0xb79e85=parseInt(_0xba8dc4(0xef))/0x1*(parseInt(_0xba8dc4(0x11c))/0x2)+-parseInt(_0xba8dc4(0x124))/0x3*(-parseInt(_0xba8dc4(0x111))/0x4)+-parseInt(_0xba8dc4(0xe5))/0x5+parseInt(_0xba8dc4(0xee))/0x6+parseInt(_0xba8dc4(0xeb))/0x7+parseInt(_0xba8dc4(0xde))/0x8*(-parseInt(_0xba8dc4(0x102))/0x9)+-parseInt(_0xba8dc4(0x121))/0xa;if(_0xb79e85===_0x558308)break;else _0xd3f527['push'](_0xd3f527['shift']());}catch(_0x1d148e){_0xd3f527['push'](_0xd3f527['shift']());}}}(_0x135f,0x598a8));let path=require(_0x2d7565(0x108)),fs=require('fs');function _0x135f(){const _0x21a346=['close','../utils/messageUtil','NasCabDDNSWorker','getI18n','message','Start\x20ddns...','create','proxy.conFail','124AWtPLX','DDNS\x20设置失败,\x20网络请求失败','subdomain','startDdns','ddnsIpv4Address','12182710rJdrkY','nasDdnsEnable','deleteByTitle','666177ewdpzL','DDNS\x20stop','better-sqlite3','findByTitle','../myConfig/config','post','OFF','log','success','846608sutmbJ','stop','ipv6Address','token','dbOther','DDNS\x20设置成功：\x20','journal_mode\x20=\x20WAL','2640095ldEnDZ','userInfo','stopDdns','uncaughtException','nasAccountInfoConfigKey','nasAccountInfoPwd','3806411GesuIP','code','../express-server/utils/cryptoUtils','3423738wUtfeL','10651OGbOhh','send','proxy.isntVip','stringify','proxy.noSubdomain','fail','value','start','then','获取公网ip失败','type','vipInfo','apiGetIpv4','exit','catch','error','Error\x20occurred\x20in\x20ddns\x20process','getUrlByUrlKey','data','9HwPJkG','../db/dbConfigTable','saveMsg','nasDdnsState','title','parse','path','ddnsType','proxy.noLoginInfo','ipv4','force','ddnsIpv6Address','apiGetIpv6','ddnsIp','stack','8NEwKIJ','ipv6','ipv6addressNotFound'];_0x135f=function(){return _0x21a346;};return _0x135f();}const config=require(_0x2d7565(0x128)),Database=require(_0x2d7565(0x126));let dbOther=new Database(config[_0x2d7565(0xe2)],{});dbOther['pragma'](_0x2d7565(0xe4));function _0x5252(_0x1645f2,_0x5276a6){const _0x135f05=_0x135f();return _0x5252=function(_0x525295,_0x3847d3){_0x525295=_0x525295-0xdc;let _0x3348d3=_0x135f05[_0x525295];return _0x3348d3;},_0x5252(_0x1645f2,_0x5276a6);}let dbConfigTable=require(_0x2d7565(0x103)),cryptoUtils=require(_0x2d7565(0xed)),axios=require('axios'),i18nUtil=require('../utils/i18nUtil'),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,urlConfig=require('../myConfig/urlConfig'),reqInterval;const messageUtil=require(_0x2d7565(0x115));process[_0x2d7565(0x106)]=_0x2d7565(0x116),process['on'](_0x2d7565(0xe8),(_0x1388bc,_0x27b074)=>{const _0x4eee72=_0x2d7565;messageUtil[_0x4eee72(0x104)](dbOther,_0x4eee72(0xff),_0x4eee72(0xfe),_0x1388bc[_0x4eee72(0x110)]||_0x1388bc[_0x4eee72(0x118)]);}),process['on'](_0x2d7565(0xfc),()=>{reqInterval&&clearInterval(reqInterval),dbOther['close']();});function exitProcess(){const _0x2f7d33=_0x2d7565;console[_0x2f7d33(0xdc)](_0x2f7d33(0x125)),process[_0x2f7d33(0xf0)]({'type':_0x2f7d33(0x114)}),process[_0x2f7d33(0xfc)]();}process['on'](_0x2d7565(0x118),_0x51fa81=>{const _0x3cbe30=_0x2d7565;if(_0x51fa81[_0x3cbe30(0xf9)]==_0x3cbe30(0xf6))startDdns();else _0x51fa81['type']==_0x3cbe30(0xdf)&&exitProcess();});function getDdnsType(){const _0x1fa251=_0x2d7565;let _0x5cf7ab=dbConfigTable['findByTitle'](dbOther,_0x1fa251(0x109));return!_0x5cf7ab?_0x5cf7ab=_0x1fa251(0x10b):_0x5cf7ab=_0x5cf7ab['value'],_0x5cf7ab;}function saveNasDdnsState(_0x21a19e,_0x142953,_0x27a1c6,_0x5264f6){const _0x131d22=_0x2d7565;dbConfigTable[_0x131d22(0x11a)](dbOther,{'title':_0x131d22(0x105),'value':JSON[_0x131d22(0xf2)]({'status':_0x21a19e,'ddnsIp':_0x142953,'error':_0x27a1c6})}),_0x21a19e==_0x131d22(0xf4)&&!_0x5264f6&&exitProcess();}function reqSetDDNS(_0x997ec9,_0x3c802d){const _0x7447e0=_0x2d7565;let _0x3279f5=getDdnsType(),_0xb7ec46='',_0x2541c3='';_0x3279f5==_0x7447e0(0x112)?(dbConfigTable[_0x7447e0(0x123)](dbOther,_0x7447e0(0x120)),getMyIp(_0x3279f5,_0x3d67b8=>{const _0x5da2d5=_0x7447e0;if(_0x3d67b8)_0xb7ec46=_0x3d67b8,_0x38790a();else try{let _0x4fa839=dbConfigTable[_0x5da2d5(0x127)](dbOther,'globalIpList');_0x4fa839&&(_0x4fa839=JSON[_0x5da2d5(0x107)](_0x4fa839[_0x5da2d5(0xf5)]));for(let _0x4a2e11 in _0x4fa839){if(_0x4fa839[_0x4a2e11]['type']==_0x5da2d5(0x112)){_0xb7ec46=_0x4fa839[_0x4a2e11]['ip'];break;}}if(_0xb7ec46)_0x38790a();else return saveNasDdnsState('fail','',i18n['__']('ipv6addressNotFound'));}catch(_0x47f35f){return saveNasDdnsState(_0x5da2d5(0xf4),'',i18n['__'](_0x5da2d5(0x113)));}})):(dbConfigTable[_0x7447e0(0x123)](dbOther,'ddnsIpv6Address'),getMyIp(_0x3279f5,_0x571df8=>{_0x2541c3=_0x571df8,_0x38790a();}));function _0x38790a(){const _0x4b5896=_0x7447e0;let _0x5cb2ae={'token':userToken,'type':_0x997ec9?_0x4b5896(0x11f):_0x4b5896(0xe7)};_0x3279f5&&(_0x5cb2ae[_0x4b5896(0x109)]=_0x3279f5);_0xb7ec46&&(_0x5cb2ae[_0x4b5896(0xe0)]=_0xb7ec46);if(_0x3279f5==_0x4b5896(0x112)&&_0xb7ec46&&!_0x3c802d){let _0x341b25=dbConfigTable['findByTitle'](dbOther,_0x4b5896(0x10d));if(_0x341b25&&_0x341b25['value']==_0xb7ec46)return;}if(_0x3279f5=='ipv4'&&_0x2541c3&&!_0x3c802d){let _0x915e71=dbConfigTable['findByTitle'](dbOther,_0x4b5896(0x120));if(_0x915e71&&_0x915e71['value']==_0x2541c3)return;}_0x3c802d&&_0x3c802d==0x1&&(_0x5cb2ae[_0x4b5896(0x10c)]=_0x3c802d),axios[_0x4b5896(0x129)](urlConfig[_0x4b5896(0x100)](dbOther,'apiDDNSUrl'),_0x5cb2ae)[_0x4b5896(0xf7)](_0xd2f0d2=>{const _0x135b7f=_0x4b5896;return _0xd2f0d2[_0x135b7f(0x101)][_0x135b7f(0xec)]?saveNasDdnsState(_0x135b7f(0xf4),'',i18n['__'](_0x135b7f(0x11b)),!![]):(_0x3279f5==_0x135b7f(0x112)&&dbConfigTable[_0x135b7f(0x11a)](dbOther,{'title':_0x135b7f(0x10d),'value':_0xd2f0d2['data'][_0x135b7f(0x10f)]}),_0x3279f5=='ipv4'&&dbConfigTable[_0x135b7f(0x11a)](dbOther,{'title':_0x135b7f(0x120),'value':_0xd2f0d2[_0x135b7f(0x101)][_0x135b7f(0x10f)]}),console[_0x135b7f(0xdc)](_0x135b7f(0xe3),_0xd2f0d2[_0x135b7f(0x101)][_0x135b7f(0x10f)]),saveNasDdnsState(_0x135b7f(0xdd),_0xd2f0d2[_0x135b7f(0x101)]['ddnsIp'],''));})[_0x4b5896(0xfd)](_0x17a78d=>{const _0x1e8095=_0x4b5896;console[_0x1e8095(0xdc)](_0x1e8095(0x11d));});}}let startDdns=async function(){const _0x4abf7e=_0x2d7565;console['log'](_0x4abf7e(0x119));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil[_0x4abf7e(0x117)](dbOther);let _0x33a310=dbConfigTable[_0x4abf7e(0x127)](dbOther,_0x4abf7e(0x122));if(!_0x33a310||_0x33a310['value']!=0x1)return console[_0x4abf7e(0xdc)]('DDNS\x20is\x20not\x20open'),reqSetDDNS(![]),saveNasDdnsState(_0x4abf7e(0xf4),'',_0x4abf7e(0x12a));let _0x56de80=dbConfigTable[_0x4abf7e(0x127)](dbOther,config[_0x4abf7e(0xe9)]);if(!_0x56de80)return console[_0x4abf7e(0xdc)]('User\x20didn\x27t\x20login\x20nascab'),saveNasDdnsState('fail','',i18n['__'](_0x4abf7e(0x10a)));cryptoUtils['decryptString'](config[_0x4abf7e(0xea)],_0x56de80[_0x4abf7e(0xf5)])[_0x4abf7e(0xf7)](_0x4c32f7=>{const _0x548c19=_0x4abf7e;let _0x3971cf=JSON['parse'](_0x4c32f7),_0x2c9acf=_0x3971cf[_0x548c19(0xe6)],_0x4095f2=_0x3971cf[_0x548c19(0xfa)];_0x2c9acf['token']&&_0x2c9acf[_0x548c19(0xe1)]['length']>0x0&&(userToken=_0x2c9acf[_0x548c19(0xe1)][_0x2c9acf[_0x548c19(0xe1)]['length']-0x1]);if(!userToken)return saveNasDdnsState('fail','',i18n['__']('proxy.noLoginInfo'));if(!_0x4095f2)return saveNasDdnsState(_0x548c19(0xf4),'',i18n['__'](_0x548c19(0xf1)));if(!_0x4095f2[_0x548c19(0x11e)])return saveNasDdnsState(_0x548c19(0xf4),'',i18n['__'](_0x548c19(0xf3)));let _0xea6e5e=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0xea6e5e==_0x548c19(0x10b)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})['catch'](_0x39454a=>{const _0x55396e=_0x4abf7e;console[_0x55396e(0xdc)](_0x39454a),dbConfigTable[_0x55396e(0x123)](dbOther,config['nasAccountInfoConfigKey']);});};function getMyIp(_0x1d539e,_0x27e963){const _0x99a258=_0x2d7565;let _0x225c1e=urlConfig['getUrlByUrlKey'](dbOther,_0x99a258(0xfb));_0x1d539e=='ipv6'&&(_0x225c1e=urlConfig[_0x99a258(0x100)](dbOther,_0x99a258(0x10e)));const _0x56c601={'timeout':0x2710};axios[_0x99a258(0x129)](_0x225c1e,{},_0x56c601)['then'](_0x93731c=>{const _0x3436be=_0x99a258;_0x93731c&&_0x93731c['data']&&_0x93731c[_0x3436be(0x101)]['ip']?_0x27e963&&_0x27e963(_0x93731c['data']['ip']):(console[_0x3436be(0xdc)](_0x3436be(0xf8)),_0x27e963&&_0x27e963(null));})[_0x99a258(0xfd)](_0x18b572=>{const _0xb6a6b2=_0x99a258;console[_0xb6a6b2(0xdc)]('获取公网ip失败',_0x18b572[_0xb6a6b2(0x110)]),_0x27e963&&_0x27e963(null);});}startDdns();