const _0x2d2ca8=_0x1deb;(function(_0x5944c0,_0x4a8f6c){const _0xdf1eb8=_0x1deb,_0x5ea4ac=_0x5944c0();while(!![]){try{const _0x43f31a=-parseInt(_0xdf1eb8(0x1c0))/0x1+-parseInt(_0xdf1eb8(0x1a2))/0x2*(-parseInt(_0xdf1eb8(0x18b))/0x3)+-parseInt(_0xdf1eb8(0x1ae))/0x4*(-parseInt(_0xdf1eb8(0x1c2))/0x5)+parseInt(_0xdf1eb8(0x1a7))/0x6+-parseInt(_0xdf1eb8(0x192))/0x7+parseInt(_0xdf1eb8(0x1ce))/0x8+parseInt(_0xdf1eb8(0x1cf))/0x9*(-parseInt(_0xdf1eb8(0x1bb))/0xa);if(_0x43f31a===_0x4a8f6c)break;else _0x5ea4ac['push'](_0x5ea4ac['shift']());}catch(_0x51a57d){_0x5ea4ac['push'](_0x5ea4ac['shift']());}}}(_0x427b,0xa9e66));let path=require(_0x2d2ca8(0x1a9)),fs=require('fs');const config=require(_0x2d2ca8(0x1be)),Database=require(_0x2d2ca8(0x199));let dbOther=new Database(config['dbOther'],{});dbOther[_0x2d2ca8(0x19f)]('journal_mode\x20=\x20WAL');let dbConfigTable=require(_0x2d2ca8(0x1d3)),cryptoUtils=require(_0x2d2ca8(0x19e)),axios=require(_0x2d2ca8(0x1b8)),i18nUtil=require(_0x2d2ca8(0x1d0)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,urlConfig=require(_0x2d2ca8(0x1bc)),reqInterval;const messageUtil=require(_0x2d2ca8(0x1b5));process[_0x2d2ca8(0x1d2)]='NasCabDDNSWorker',process['on'](_0x2d2ca8(0x1b6),(_0x3c23ed,_0x267fc3)=>{const _0xcd065f=_0x2d2ca8;messageUtil[_0xcd065f(0x1a8)](dbOther,_0xcd065f(0x1b7),_0xcd065f(0x197),_0x3c23ed[_0xcd065f(0x1b9)]||_0x3c23ed[_0xcd065f(0x18a)]);}),process['on'](_0x2d2ca8(0x1b4),()=>{const _0x3d5037=_0x2d2ca8;reqInterval&&clearInterval(reqInterval),dbOther[_0x3d5037(0x190)]();});function exitProcess(){const _0x1993bf=_0x2d2ca8;console[_0x1993bf(0x188)](_0x1993bf(0x18e)),process[_0x1993bf(0x1b1)]({'type':_0x1993bf(0x190)}),process[_0x1993bf(0x1b4)]();}process['on'](_0x2d2ca8(0x18a),_0x26b9e9=>{const _0x4ad3f9=_0x2d2ca8;if(_0x26b9e9['type']==_0x4ad3f9(0x195))startDdns();else _0x26b9e9['type']==_0x4ad3f9(0x1a3)&&exitProcess();});function _0x1deb(_0x2c77f1,_0x36f8d4){const _0x427b9d=_0x427b();return _0x1deb=function(_0x1debc1,_0x3b0ccd){_0x1debc1=_0x1debc1-0x188;let _0x2c9f08=_0x427b9d[_0x1debc1];return _0x2c9f08;},_0x1deb(_0x2c77f1,_0x36f8d4);}function getDdnsType(){const _0x219707=_0x2d2ca8;let _0x867858=dbConfigTable['findByTitle'](dbOther,_0x219707(0x18c));return!_0x867858?_0x867858=_0x219707(0x19a):_0x867858=_0x867858['value'],_0x867858;}function saveNasDdnsState(_0x57f817,_0x38540c,_0xe86a5a,_0xa5b5b3){const _0x19b3da=_0x2d2ca8;dbConfigTable[_0x19b3da(0x1d6)](dbOther,{'title':_0x19b3da(0x1af),'value':JSON[_0x19b3da(0x193)]({'status':_0x57f817,'ddnsIp':_0x38540c,'error':_0xe86a5a})}),_0x57f817==_0x19b3da(0x1c9)&&!_0xa5b5b3&&exitProcess();}function reqSetDDNS(_0x3c9fb8,_0x4744e1){const _0x41752d=_0x2d2ca8;let _0x2496e5=getDdnsType(),_0x37efb2='',_0x2333f1='';_0x2496e5==_0x41752d(0x19c)?(dbConfigTable['deleteByTitle'](dbOther,'ddnsIpv4Address'),getMyIp(_0x2496e5,_0x4b90c1=>{const _0x279ffb=_0x41752d;if(_0x4b90c1)_0x37efb2=_0x4b90c1,_0x4ec3b6();else try{let _0x1e1275=dbConfigTable[_0x279ffb(0x1ca)](dbOther,_0x279ffb(0x1c3));_0x1e1275&&(_0x1e1275=JSON[_0x279ffb(0x1aa)](_0x1e1275[_0x279ffb(0x1d1)]));for(let _0x5cc3e9 in _0x1e1275){if(_0x1e1275[_0x5cc3e9][_0x279ffb(0x194)]==_0x279ffb(0x19c)){_0x37efb2=_0x1e1275[_0x5cc3e9]['ip'];break;}}if(_0x37efb2)_0x4ec3b6();else return saveNasDdnsState(_0x279ffb(0x1c9),'',i18n['__'](_0x279ffb(0x1a1)));}catch(_0xc76ca0){return saveNasDdnsState(_0x279ffb(0x1c9),'',i18n['__']('ipv6addressNotFound'));}})):(dbConfigTable[_0x41752d(0x1cd)](dbOther,'ddnsIpv6Address'),getMyIp(_0x2496e5,_0x21aa72=>{_0x2333f1=_0x21aa72,_0x4ec3b6();}));function _0x4ec3b6(){const _0x54b2a2=_0x41752d;let _0x3ed008={'token':userToken,'type':_0x3c9fb8?_0x54b2a2(0x1c6):_0x54b2a2(0x1c1)};_0x2496e5&&(_0x3ed008[_0x54b2a2(0x18c)]=_0x2496e5);_0x37efb2&&(_0x3ed008[_0x54b2a2(0x196)]=_0x37efb2);if(_0x2496e5==_0x54b2a2(0x19c)&&_0x37efb2&&!_0x4744e1){let _0x38b33a=dbConfigTable[_0x54b2a2(0x1ca)](dbOther,_0x54b2a2(0x1a0));if(_0x38b33a&&_0x38b33a[_0x54b2a2(0x1d1)]==_0x37efb2)return;}if(_0x2496e5==_0x54b2a2(0x19a)&&_0x2333f1&&!_0x4744e1){let _0x28a27e=dbConfigTable['findByTitle'](dbOther,_0x54b2a2(0x189));if(_0x28a27e&&_0x28a27e[_0x54b2a2(0x1d1)]==_0x2333f1)return;}_0x4744e1&&_0x4744e1==0x1&&(_0x3ed008['force']=_0x4744e1),axios[_0x54b2a2(0x19b)](urlConfig[_0x54b2a2(0x1a4)](dbOther,_0x54b2a2(0x198)),_0x3ed008)[_0x54b2a2(0x1bf)](_0x57aa51=>{const _0x1027c1=_0x54b2a2;return _0x57aa51[_0x1027c1(0x1ab)]['code']?saveNasDdnsState(_0x1027c1(0x1c9),'',i18n['__']('proxy.conFail'),!![]):(_0x2496e5==_0x1027c1(0x19c)&&dbConfigTable[_0x1027c1(0x1d6)](dbOther,{'title':_0x1027c1(0x1a0),'value':_0x57aa51[_0x1027c1(0x1ab)][_0x1027c1(0x1c5)]}),_0x2496e5==_0x1027c1(0x19a)&&dbConfigTable[_0x1027c1(0x1d6)](dbOther,{'title':'ddnsIpv4Address','value':_0x57aa51[_0x1027c1(0x1ab)][_0x1027c1(0x1c5)]}),console[_0x1027c1(0x188)](_0x1027c1(0x1b0),_0x57aa51[_0x1027c1(0x1ab)]['ddnsIp']),saveNasDdnsState(_0x1027c1(0x1ba),_0x57aa51[_0x1027c1(0x1ab)][_0x1027c1(0x1c5)],''));})[_0x54b2a2(0x19d)](_0x27547b=>{const _0x54e7bc=_0x54b2a2;console[_0x54e7bc(0x188)](_0x54e7bc(0x1bd));});}}function _0x427b(){const _0x201edd=['better-sqlite3','ipv4','post','ipv6','catch','../express-server/utils/cryptoUtils','pragma','ddnsIpv6Address','ipv6addressNotFound','2OcGXvz','stop','getUrlByUrlKey','User\x20didn\x27t\x20login\x20nascab','nasDdnsEnable','1320312EOJjuI','saveMsg','path','parse','data','token','proxy.noLoginInfo','776404uUcspB','nasDdnsState','DDNS\x20设置成功：\x20','send','subdomain','OFF','exit','../utils/messageUtil','uncaughtException','Error\x20occurred\x20in\x20ddns\x20process','axios','stack','success','1811850nAjzfB','../myConfig/urlConfig','DDNS\x20设置失败,\x20网络请求失败','../myConfig/config','then','600890NLdVQI','stopDdns','5TtWZcp','globalIpList','proxy.noSubdomain','ddnsIp','startDdns','apiGetIpv4','getI18n','fail','findByTitle','decryptString','proxy.isntVip','deleteByTitle','3337808QhOZJz','27WNYUGU','../utils/i18nUtil','value','title','../db/dbConfigTable','nasAccountInfoConfigKey','vipInfo','create','log','ddnsIpv4Address','message','3691296Znctxu','ddnsType','Start\x20ddns...','DDNS\x20stop','length','close','获取公网ip失败','1550192GIBUxZ','stringify','type','start','ipv6Address','error','apiDDNSUrl'];_0x427b=function(){return _0x201edd;};return _0x427b();}let startDdns=async function(){const _0x12879f=_0x2d2ca8;console['log'](_0x12879f(0x18d));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil[_0x12879f(0x1c8)](dbOther);let _0xb95ef4=dbConfigTable[_0x12879f(0x1ca)](dbOther,_0x12879f(0x1a6));if(!_0xb95ef4||_0xb95ef4[_0x12879f(0x1d1)]!=0x1)return console['log']('DDNS\x20is\x20not\x20open'),reqSetDDNS(![]),saveNasDdnsState(_0x12879f(0x1c9),'',_0x12879f(0x1b3));let _0x577a6d=dbConfigTable['findByTitle'](dbOther,config[_0x12879f(0x1d4)]);if(!_0x577a6d)return console['log'](_0x12879f(0x1a5)),saveNasDdnsState(_0x12879f(0x1c9),'',i18n['__'](_0x12879f(0x1ad)));cryptoUtils[_0x12879f(0x1cb)](config['nasAccountInfoPwd'],_0x577a6d[_0x12879f(0x1d1)])[_0x12879f(0x1bf)](_0xed2972=>{const _0x4c6706=_0x12879f;let _0x2ba01e=JSON['parse'](_0xed2972),_0x5c3d4f=_0x2ba01e['userInfo'],_0x27c74a=_0x2ba01e[_0x4c6706(0x1d5)];_0x5c3d4f[_0x4c6706(0x1ac)]&&_0x5c3d4f[_0x4c6706(0x1ac)][_0x4c6706(0x18f)]>0x0&&(userToken=_0x5c3d4f[_0x4c6706(0x1ac)][_0x5c3d4f[_0x4c6706(0x1ac)][_0x4c6706(0x18f)]-0x1]);if(!userToken)return saveNasDdnsState('fail','',i18n['__'](_0x4c6706(0x1ad)));if(!_0x27c74a)return saveNasDdnsState('fail','',i18n['__'](_0x4c6706(0x1cc)));if(!_0x27c74a[_0x4c6706(0x1b2)])return saveNasDdnsState(_0x4c6706(0x1c9),'',i18n['__'](_0x4c6706(0x1c4)));let _0x3165f3=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x3165f3=='ipv4'?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x12879f(0x19d)](_0x1f7369=>{const _0x4148ea=_0x12879f;console[_0x4148ea(0x188)](_0x1f7369),dbConfigTable['deleteByTitle'](dbOther,config[_0x4148ea(0x1d4)]);});};function getMyIp(_0x26eec6,_0x3f65f3){const _0x6bd931=_0x2d2ca8;let _0x37c873=urlConfig['getUrlByUrlKey'](dbOther,_0x6bd931(0x1c7));_0x26eec6==_0x6bd931(0x19c)&&(_0x37c873=urlConfig[_0x6bd931(0x1a4)](dbOther,'apiGetIpv6'));const _0x308a87={'timeout':0x2710};axios[_0x6bd931(0x19b)](_0x37c873,{},_0x308a87)[_0x6bd931(0x1bf)](_0x4f5e7b=>{const _0x548ead=_0x6bd931;_0x4f5e7b&&_0x4f5e7b[_0x548ead(0x1ab)]&&_0x4f5e7b[_0x548ead(0x1ab)]['ip']?_0x3f65f3&&_0x3f65f3(_0x4f5e7b['data']['ip']):(console[_0x548ead(0x188)]('获取公网ip失败'),_0x3f65f3&&_0x3f65f3(null));})['catch'](_0x948c4c=>{const _0x7dcad3=_0x6bd931;console[_0x7dcad3(0x188)](_0x7dcad3(0x191),_0x948c4c[_0x7dcad3(0x1b9)]),_0x3f65f3&&_0x3f65f3(null);});}startDdns();