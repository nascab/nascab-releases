const _0x439ed0=_0x3e7b;function _0x3e7b(_0x2adf4b,_0x4cf861){const _0x1beb35=_0x1beb();return _0x3e7b=function(_0x3e7bf2,_0x1c4964){_0x3e7bf2=_0x3e7bf2-0x1a3;let _0x322088=_0x1beb35[_0x3e7bf2];return _0x322088;},_0x3e7b(_0x2adf4b,_0x4cf861);}(function(_0x33334c,_0x3b7c50){const _0x3a0daa=_0x3e7b,_0x2eb208=_0x33334c();while(!![]){try{const _0x13f385=parseInt(_0x3a0daa(0x1aa))/0x1+-parseInt(_0x3a0daa(0x1bf))/0x2*(parseInt(_0x3a0daa(0x1b1))/0x3)+parseInt(_0x3a0daa(0x1bb))/0x4*(-parseInt(_0x3a0daa(0x1bc))/0x5)+parseInt(_0x3a0daa(0x1ce))/0x6*(-parseInt(_0x3a0daa(0x1bd))/0x7)+-parseInt(_0x3a0daa(0x1a8))/0x8*(parseInt(_0x3a0daa(0x1e0))/0x9)+parseInt(_0x3a0daa(0x1df))/0xa+parseInt(_0x3a0daa(0x1d0))/0xb;if(_0x13f385===_0x3b7c50)break;else _0x2eb208['push'](_0x2eb208['shift']());}catch(_0x5dce6c){_0x2eb208['push'](_0x2eb208['shift']());}}}(_0x1beb,0xa9cbd));const config=require('../myConfig/config');let fs=require('fs'),path=require(_0x439ed0(0x1ae));const dbFileIndexTable=require('../db/dbFileIndexTable'),dbConfigTable=require(_0x439ed0(0x1c5));let transCodeUtil=require(_0x439ed0(0x1d1)),sha256=require(_0x439ed0(0x1d7)),FFmpeg=require(_0x439ed0(0x1ac))['FFmpeg'];process[_0x439ed0(0x1c0)]=_0x439ed0(0x1cd);const Database=require(_0x439ed0(0x1b0));let dbFileIndex=new Database(config[_0x439ed0(0x1ad)],{'timeout':0xea60});dbFileIndex[_0x439ed0(0x1d2)](_0x439ed0(0x1de));let dbOther=new Database(config['dbOther'],{});dbOther[_0x439ed0(0x1d2)](_0x439ed0(0x1de));const messageUtil=require(_0x439ed0(0x1d9));function dealFinish(_0x41a5c2,_0x579ccf){const _0x4f2373=_0x439ed0;if(_0x41a5c2){let _0x2ad08e='UPDATE\x20'+dbFileIndexTable[_0x4f2373(0x1d4)]+_0x4f2373(0x1ca);dbFileIndex[_0x4f2373(0x1cc)](_0x2ad08e)['run'](_0x41a5c2['id']);}_0x579ccf&&_0x579ccf();}function genStart(){return new Promise(async(_0x5bf8d4,_0x3ab8d8)=>{const _0x33811a=_0x3e7b;let _0x2cbd18=dbFileIndexTable[_0x33811a(0x1cf)](dbFileIndex,'\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','*',dbFileIndexTable[_0x33811a(0x1d4)]);if(_0x2cbd18){let _0x3239f1=_0x2cbd18[_0x33811a(0x1b8)];if(!_0x3239f1)return dealFinish(_0x2cbd18,_0x5bf8d4);let _0x69917d=path[_0x33811a(0x1a9)](_0x2cbd18['path'],_0x2cbd18['filename']);try{_0x3239f1=JSON['parse'](_0x3239f1);}catch(_0x4cd2d2){return dealFinish(_0x2cbd18,_0x5bf8d4);}let _0x1b386e=[];for(let _0xd7c754 in _0x3239f1){let _0x300aa0=_0x3239f1[_0xd7c754];_0x300aa0[_0x33811a(0x1dc)]==_0x33811a(0x1c2)&&_0x1b386e[_0x33811a(0x1c8)](_0x300aa0);}if(_0x1b386e[_0x33811a(0x1a4)]<0x1)return dealFinish(_0x2cbd18,_0x5bf8d4);let _0x4fa71d=0x0;function _0x10d6d8(){const _0x173b9e=_0x33811a;if(_0x4fa71d>=_0x1b386e[_0x173b9e(0x1a4)])return dealFinish(_0x2cbd18,_0x5bf8d4);}function _0x22d263(_0x3f0f46,_0x358507,_0x356f66){const _0x495d35=_0x33811a;try{bgTaskId&&dbOther[_0x495d35(0x1cc)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)[_0x495d35(0x1ba)]();}catch(_0x5940ce){}return new Promise((_0x67ffb3,_0x32baa3)=>{const _0x4ae4dc=_0x495d35;let _0xb452ab=FFmpeg({'timeout':0x258});_0xb452ab[_0x4ae4dc(0x1a5)](transCodeUtil[_0x4ae4dc(0x1a6)](_0x3f0f46))[_0x4ae4dc(0x1a7)]()[_0x4ae4dc(0x1ab)]()[_0x4ae4dc(0x1da)](['-map\x200:s:'+_0x356f66])[_0x4ae4dc(0x1d3)](_0x358507)['on']('start',function(_0x36bb52){})['on'](_0x4ae4dc(0x1d5),function(_0x243286){const _0x32f287=_0x4ae4dc;_0x243286['message']&&_0x243286[_0x32f287(0x1c7)][_0x32f287(0x1dd)]('killed')==-0x1&&(fs['rm'](_0x358507,_0x1c1690=>{}),dealFinish(_0x2cbd18,_0x67ffb3),_0xb452ab[_0x32f287(0x1b3)]());})['on'](_0x4ae4dc(0x1e2),function(){const _0x41528d=_0x4ae4dc;console[_0x41528d(0x1d6)]('Subtitle\x20extraction\x20:\x20',_0x3f0f46),_0xb452ab[_0x41528d(0x1b3)](),_0x67ffb3();}),_0xb452ab['run']();});}for(let _0x17c20c in _0x1b386e){let _0x52c8df=path[_0x33811a(0x1a9)](config[_0x33811a(0x1c1)],sha256(_0x69917d+_0x17c20c)+_0x33811a(0x1c3));try{let _0x217512=!![],_0x3f07e3=fs['existsSync'](_0x52c8df);if(_0x3f07e3){let _0x2693de=fs[_0x33811a(0x1c6)](_0x52c8df);_0x2693de[_0x33811a(0x1c4)]>0x2710&&(_0x217512=![]);}if(_0x217512)await _0x22d263(_0x69917d,_0x52c8df,_0x17c20c),_0x4fa71d+=0x1,_0x10d6d8();else{_0x4fa71d+=0x1,_0x10d6d8();continue;}}catch(_0x5aded2){_0x4fa71d+=0x1,_0x10d6d8();}}}else exitProcess();});}let bgTaskId;function _0x1beb(){const _0x187d1f=['SUBTITLE_PRE_GEN','exit','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','stream_info','uncaughtException','run','8nxkWJE','2752235ftGNZH','2513XmdYcX','saveMsg','8798GybKET','title','subtitlePath','subtitle','.vtt','size','../db/dbConfigTable','statSync','message','push','Error\x20occurred\x20in\x20subtitles\x20gen\x20process','\x20set\x20pre_gen_subtitles=1\x20where\x20id=?','lastInsertRowid','prepare','NasCabSubtitleWorker','840hjsrgU','getByWhere','32086351CHxvPZ','../utils/transCodeUtil','pragma','output','INDEX_TABLE_NAME_MOVIE','error','log','sha256','close','../utils/messageUtil','outputOptions','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','codec_type','indexOf','journal_mode\x20=\x20WAL','3044180YXIxBD','171gnMIqK','then','end','subtitlePreGen','length','input','dealFFmpegPath','noAudio','462736yeHncN','join','115789UefdyD','noVideo','../libs/nasTrans','dbFileIndex','path','send','better-sqlite3','267OUcdxe','value','kill','stack'];_0x1beb=function(){return _0x187d1f;};return _0x1beb();}try{let info=dbOther['prepare'](_0x439ed0(0x1db))[_0x439ed0(0x1ba)](_0x439ed0(0x1b5));bgTaskId=info[_0x439ed0(0x1cb)];}catch(_0x3e3a65){}function exitProcess(){const _0x70f9f5=_0x439ed0;try{bgTaskId&&dbOther[_0x70f9f5(0x1cc)](_0x70f9f5(0x1b7)+bgTaskId)[_0x70f9f5(0x1ba)]();}catch(_0x30b82c){}return process[_0x70f9f5(0x1af)]({'type':_0x70f9f5(0x1d8)}),process[_0x70f9f5(0x1b6)]();}async function runGen(){const _0x47ee12=_0x439ed0;let _0x377ca1=dbConfigTable['findByTitle'](dbOther,_0x47ee12(0x1a3));!_0x377ca1||_0x377ca1&&_0x377ca1[_0x47ee12(0x1b2)]=='1'?genStart(dbFileIndexTable[_0x47ee12(0x1d4)])[_0x47ee12(0x1e1)](()=>{runGen();})['catch'](()=>{runGen();}):exitProcess();}process['on'](_0x439ed0(0x1b9),(_0x1ac0e2,_0x8d3da2)=>{const _0x3ad514=_0x439ed0;console[_0x3ad514(0x1d6)](_0x1ac0e2),messageUtil[_0x3ad514(0x1be)](dbOther,_0x3ad514(0x1c9),'error',_0x1ac0e2[_0x3ad514(0x1b4)]||_0x1ac0e2[_0x3ad514(0x1c7)]);}),process['on']('exit',(_0x35ae6a,_0x272ab7)=>{const _0x4149d8=_0x439ed0;process[_0x4149d8(0x1af)]({'type':_0x4149d8(0x1d8)});}),runGen();