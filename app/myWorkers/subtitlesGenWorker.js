const _0x4987c4=_0xd2cc;(function(_0x4906c3,_0xa1bbaf){const _0x3d8c67=_0xd2cc,_0x305101=_0x4906c3();while(!![]){try{const _0x59ae77=parseInt(_0x3d8c67(0x19e))/0x1*(-parseInt(_0x3d8c67(0x1a9))/0x2)+-parseInt(_0x3d8c67(0x170))/0x3*(-parseInt(_0x3d8c67(0x188))/0x4)+-parseInt(_0x3d8c67(0x190))/0x5*(-parseInt(_0x3d8c67(0x17d))/0x6)+-parseInt(_0x3d8c67(0x1a3))/0x7*(parseInt(_0x3d8c67(0x19c))/0x8)+parseInt(_0x3d8c67(0x186))/0x9*(-parseInt(_0x3d8c67(0x185))/0xa)+parseInt(_0x3d8c67(0x196))/0xb+parseInt(_0x3d8c67(0x1a2))/0xc;if(_0x59ae77===_0xa1bbaf)break;else _0x305101['push'](_0x305101['shift']());}catch(_0x473498){_0x305101['push'](_0x305101['shift']());}}}(_0x274b,0xd1aad));const config=require(_0x4987c4(0x192));let fs=require('fs'),path=require(_0x4987c4(0x1a8));const dbFileIndexTable=require('../db/dbFileIndexTable'),dbConfigTable=require(_0x4987c4(0x198));let transCodeUtil=require(_0x4987c4(0x17c)),sha256=require(_0x4987c4(0x189)),FFmpeg=require(_0x4987c4(0x17f))[_0x4987c4(0x18e)];process[_0x4987c4(0x1a5)]='NasCabSubtitleWorker';const Database=require(_0x4987c4(0x187));let dbFileIndex=new Database(config[_0x4987c4(0x16e)],{'timeout':0xea60});dbFileIndex[_0x4987c4(0x176)](_0x4987c4(0x16d));let dbOther=new Database(config['dbOther'],{});function _0x274b(){const _0x106b50=['run','INDEX_TABLE_NAME_MOVIE','stack','error','UPDATE\x20','1689340VOnVPW','81SIVINa','better-sqlite3','12NzbNZf','sha256','-map\x200:s:','stream_info','findByTitle','noAudio','FFmpeg','subtitlePath','155915yaYSDL','lastInsertRowid','../myConfig/config','saveMsg','start','\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','9552290WSEpnG','SUBTITLE_PRE_GEN','../db/dbConfigTable','codec_type','send','close','218648uvnezp','log','25462MPmBQq','prepare','../utils/messageUtil','join','27518184kKCNCy','217lIJaAf','end','title','indexOf','statSync','path','82trwqBW','output','exit','journal_mode\x20=\x20WAL','dbFileIndex','killed','890553tRGwtf','input','length','filename','parse','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','pragma','kill','.vtt','existsSync','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','outputOptions','../utils/transCodeUtil','42vLSbSk','message','../libs/nasTrans'];_0x274b=function(){return _0x106b50;};return _0x274b();}dbOther['pragma'](_0x4987c4(0x16d));const messageUtil=require(_0x4987c4(0x1a0));function dealFinish(_0x176b51,_0x590cdb){const _0x2a7bd4=_0x4987c4;if(_0x176b51){let _0x6a04c4=_0x2a7bd4(0x184)+dbFileIndexTable[_0x2a7bd4(0x181)]+'\x20set\x20pre_gen_subtitles=1\x20where\x20id=?';dbFileIndex['prepare'](_0x6a04c4)['run'](_0x176b51['id']);}_0x590cdb&&_0x590cdb();}function _0xd2cc(_0x2c8ac8,_0x497b43){const _0x274b92=_0x274b();return _0xd2cc=function(_0xd2cc6a,_0x4837b1){_0xd2cc6a=_0xd2cc6a-0x16b;let _0x32ab51=_0x274b92[_0xd2cc6a];return _0x32ab51;},_0xd2cc(_0x2c8ac8,_0x497b43);}function genStart(){return new Promise(async(_0x260a6b,_0xad4f67)=>{const _0x284b8f=_0xd2cc;let _0x284a9d=dbFileIndexTable['getByWhere'](dbFileIndex,_0x284b8f(0x195),'*',dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(_0x284a9d){let _0x43bab5=_0x284a9d[_0x284b8f(0x18b)];if(!_0x43bab5)return dealFinish(_0x284a9d,_0x260a6b);let _0x1908c5=path[_0x284b8f(0x1a1)](_0x284a9d['path'],_0x284a9d[_0x284b8f(0x173)]);try{_0x43bab5=JSON[_0x284b8f(0x174)](_0x43bab5);}catch(_0x33c312){return dealFinish(_0x284a9d,_0x260a6b);}let _0x1f961e=[];for(let _0x2b153d in _0x43bab5){let _0x1e0755=_0x43bab5[_0x2b153d];_0x1e0755[_0x284b8f(0x199)]=='subtitle'&&_0x1f961e['push'](_0x1e0755);}if(_0x1f961e[_0x284b8f(0x172)]<0x1)return dealFinish(_0x284a9d,_0x260a6b);let _0x1016c0=0x0;function _0x51e586(){if(_0x1016c0>=_0x1f961e['length'])return dealFinish(_0x284a9d,_0x260a6b);}function _0x31e409(_0x1f0a21,_0x4b384f,_0x4e7b38){const _0x155c91=_0x284b8f;try{bgTaskId&&dbOther[_0x155c91(0x19f)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)['run']();}catch(_0xd344a0){}return new Promise((_0x5abd7c,_0x105796)=>{const _0x574fe0=_0x155c91;let _0x31789e=FFmpeg({'timeout':0x258});_0x31789e[_0x574fe0(0x171)](transCodeUtil['dealFFmpegPath'](_0x1f0a21))[_0x574fe0(0x18d)]()['noVideo']()[_0x574fe0(0x17b)]([_0x574fe0(0x18a)+_0x4e7b38])[_0x574fe0(0x16b)](_0x4b384f)['on'](_0x574fe0(0x194),function(_0x434943){})['on'](_0x574fe0(0x183),function(_0x4abf1d){const _0x1ae77b=_0x574fe0;_0x4abf1d[_0x1ae77b(0x17e)]&&_0x4abf1d['message'][_0x1ae77b(0x1a6)](_0x1ae77b(0x16f))==-0x1&&(fs['rm'](_0x4b384f,_0xbffd96=>{}),dealFinish(_0x284a9d,_0x5abd7c),_0x31789e[_0x1ae77b(0x177)]());})['on'](_0x574fe0(0x1a4),function(){const _0x17e92d=_0x574fe0;console['log']('Subtitle\x20extraction\x20:\x20',_0x1f0a21),_0x31789e[_0x17e92d(0x177)](),_0x5abd7c();}),_0x31789e[_0x574fe0(0x180)]();});}for(let _0xa3568b in _0x1f961e){let _0x5707ea=path[_0x284b8f(0x1a1)](config[_0x284b8f(0x18f)],sha256(_0x1908c5+_0xa3568b)+_0x284b8f(0x178));try{let _0x3bdddf=!![],_0x4eba3a=fs[_0x284b8f(0x179)](_0x5707ea);if(_0x4eba3a){let _0x58a78b=fs[_0x284b8f(0x1a7)](_0x5707ea);_0x58a78b['size']>0x2710&&(_0x3bdddf=![]);}if(_0x3bdddf)await _0x31e409(_0x1908c5,_0x5707ea,_0xa3568b),_0x1016c0+=0x1,_0x51e586();else{_0x1016c0+=0x1,_0x51e586();continue;}}catch(_0x439e09){_0x1016c0+=0x1,_0x51e586();}}}else exitProcess();});}let bgTaskId;try{let info=dbOther[_0x4987c4(0x19f)](_0x4987c4(0x175))[_0x4987c4(0x180)](_0x4987c4(0x197));bgTaskId=info[_0x4987c4(0x191)];}catch(_0x518435){}function exitProcess(){const _0x386164=_0x4987c4;try{bgTaskId&&dbOther[_0x386164(0x19f)](_0x386164(0x17a)+bgTaskId)['run']();}catch(_0x1d3fd7){}return process[_0x386164(0x19a)]({'type':_0x386164(0x19b)}),process[_0x386164(0x16c)]();}async function runGen(){const _0x34bf11=_0x4987c4;let _0xe6812b=dbConfigTable[_0x34bf11(0x18c)](dbOther,'subtitlePreGen');!_0xe6812b||_0xe6812b&&_0xe6812b['value']=='1'?genStart(dbFileIndexTable[_0x34bf11(0x181)])['then'](()=>{runGen();})['catch'](()=>{runGen();}):exitProcess();}process['on']('uncaughtException',(_0x56447f,_0x519a5d)=>{const _0x1c15b3=_0x4987c4;console[_0x1c15b3(0x19d)](_0x56447f),messageUtil[_0x1c15b3(0x193)](dbOther,'Error\x20occurred\x20in\x20subtitles\x20gen\x20process',_0x1c15b3(0x183),_0x56447f[_0x1c15b3(0x182)]||_0x56447f[_0x1c15b3(0x17e)]);}),process['on']('exit',(_0x12d556,_0x15d816)=>{const _0x554f4c=_0x4987c4;process[_0x554f4c(0x19a)]({'type':_0x554f4c(0x19b)});}),runGen();