const _0x250f23=_0x2c39;(function(_0x159a36,_0x4b1ce1){const _0x494c83=_0x2c39,_0x21498d=_0x159a36();while(!![]){try{const _0x53a5e7=-parseInt(_0x494c83(0x1a9))/0x1*(parseInt(_0x494c83(0x1b1))/0x2)+-parseInt(_0x494c83(0x1c1))/0x3*(parseInt(_0x494c83(0x191))/0x4)+parseInt(_0x494c83(0x1b2))/0x5+-parseInt(_0x494c83(0x19c))/0x6*(parseInt(_0x494c83(0x18a))/0x7)+-parseInt(_0x494c83(0x18e))/0x8*(parseInt(_0x494c83(0x187))/0x9)+-parseInt(_0x494c83(0x194))/0xa*(-parseInt(_0x494c83(0x18b))/0xb)+parseInt(_0x494c83(0x1c7))/0xc*(parseInt(_0x494c83(0x190))/0xd);if(_0x53a5e7===_0x4b1ce1)break;else _0x21498d['push'](_0x21498d['shift']());}catch(_0xcc92c0){_0x21498d['push'](_0x21498d['shift']());}}}(_0x2126,0x3815e));const config=require(_0x250f23(0x1b4));function _0x2c39(_0x8e352a,_0x27353c){const _0x2126e7=_0x2126();return _0x2c39=function(_0x2c3996,_0x225cba){_0x2c3996=_0x2c3996-0x187;let _0x20e227=_0x2126e7[_0x2c3996];return _0x20e227;},_0x2c39(_0x8e352a,_0x27353c);}let fs=require('fs'),path=require(_0x250f23(0x18c));const dbFileIndexTable=require(_0x250f23(0x18d)),dbConfigTable=require(_0x250f23(0x19b));let transCodeUtil=require(_0x250f23(0x195)),sha256=require('sha256'),FFmpeg=require(_0x250f23(0x1aa))['FFmpeg'];process[_0x250f23(0x1bf)]='NasCabSubtitleWorker';const Database=require('better-sqlite3');function _0x2126(){const _0x3229f7=['Error\x20occurred\x20in\x20subtitles\x20gen\x20process','UPDATE\x20','INDEX_TABLE_NAME_MOVIE','stack','send','close','2DTeMcK','430855YAwVfH','outputOptions','../myConfig/config','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','kill','filename','getByWhere','journal_mode\x20=\x20WAL','codec_type','parse','dbOther','.vtt','push','title','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','477NPoCRl','pragma','indexOf','noVideo','existsSync','dbFileIndex','192JvdaoW','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','SUBTITLE_PRE_GEN','31194YcyjcA','subtitle','start','14FRwjbw','1641442CvZMkD','path','../db/dbFileIndexTable','904TXPgGX','message','794196RGeltF','10960DZwQHQ','subtitlePreGen','log','20fpgJSW','../utils/transCodeUtil','prepare','dealFFmpegPath','noAudio','size','join','../db/dbConfigTable','896178ySNVep','run','uncaughtException','\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','stream_info','Subtitle\x20extraction\x20:\x20','../utils/messageUtil','length','subtitlePath','error','output','exit','input','6317wfwCgd','../libs/nasTrans'];_0x2126=function(){return _0x3229f7;};return _0x2126();}let dbFileIndex=new Database(config[_0x250f23(0x1c6)],{'timeout':0xea60});dbFileIndex[_0x250f23(0x1c2)](_0x250f23(0x1b9));let dbOther=new Database(config[_0x250f23(0x1bc)],{});dbOther['pragma']('journal_mode\x20=\x20WAL');const messageUtil=require(_0x250f23(0x1a2));function dealFinish(_0x5b4b48,_0x29039b){const _0x34cd63=_0x250f23;if(_0x5b4b48){let _0x58935f=_0x34cd63(0x1ac)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+'\x20set\x20pre_gen_subtitles=1\x20where\x20id=?';dbFileIndex['prepare'](_0x58935f)[_0x34cd63(0x19d)](_0x5b4b48['id']);}_0x29039b&&_0x29039b();}function genStart(){return new Promise(async(_0xa18dae,_0x26db58)=>{const _0x17796a=_0x2c39;let _0x213e18=dbFileIndexTable[_0x17796a(0x1b8)](dbFileIndex,_0x17796a(0x19f),'*',dbFileIndexTable[_0x17796a(0x1ad)]);if(_0x213e18){let _0x160e4a=_0x213e18[_0x17796a(0x1a0)];if(!_0x160e4a)return dealFinish(_0x213e18,_0xa18dae);let _0x2fa20d=path[_0x17796a(0x19a)](_0x213e18[_0x17796a(0x18c)],_0x213e18[_0x17796a(0x1b7)]);try{_0x160e4a=JSON[_0x17796a(0x1bb)](_0x160e4a);}catch(_0x421195){return dealFinish(_0x213e18,_0xa18dae);}let _0xead28f=[];for(let _0x423e84 in _0x160e4a){let _0xdb8aca=_0x160e4a[_0x423e84];_0xdb8aca[_0x17796a(0x1ba)]==_0x17796a(0x188)&&_0xead28f[_0x17796a(0x1be)](_0xdb8aca);}if(_0xead28f[_0x17796a(0x1a3)]<0x1)return dealFinish(_0x213e18,_0xa18dae);let _0x1ea214=0x0;function _0x19dba8(){const _0x743a7b=_0x17796a;if(_0x1ea214>=_0xead28f[_0x743a7b(0x1a3)])return dealFinish(_0x213e18,_0xa18dae);}function _0x4219f8(_0x1be62b,_0x235d7c,_0x3ed6a6){const _0xaf2de7=_0x17796a;try{bgTaskId&&dbOther[_0xaf2de7(0x196)](_0xaf2de7(0x1c8)+bgTaskId)[_0xaf2de7(0x19d)]();}catch(_0xf22fd9){}return new Promise((_0x46402e,_0x5da2fb)=>{const _0x5f0762=_0xaf2de7;let _0x441b1f=FFmpeg({'timeout':0x258});_0x441b1f[_0x5f0762(0x1a8)](transCodeUtil[_0x5f0762(0x197)](_0x1be62b))[_0x5f0762(0x198)]()[_0x5f0762(0x1c4)]()[_0x5f0762(0x1b3)](['-map\x200:s:'+_0x3ed6a6])[_0x5f0762(0x1a6)](_0x235d7c)['on'](_0x5f0762(0x189),function(_0x52b188){})['on'](_0x5f0762(0x1a5),function(_0x3242b0){const _0x3f1587=_0x5f0762;_0x3242b0['message']&&_0x3242b0['message'][_0x3f1587(0x1c3)]('killed')==-0x1&&(fs['rm'](_0x235d7c,_0x5ccd38=>{}),dealFinish(_0x213e18,_0x46402e),_0x441b1f[_0x3f1587(0x1b6)]());})['on']('end',function(){const _0x3bc608=_0x5f0762;console[_0x3bc608(0x193)](_0x3bc608(0x1a1),_0x1be62b),_0x441b1f[_0x3bc608(0x1b6)](),_0x46402e();}),_0x441b1f[_0x5f0762(0x19d)]();});}for(let _0x4ba85d in _0xead28f){let _0x3d9230=path['join'](config[_0x17796a(0x1a4)],sha256(_0x2fa20d+_0x4ba85d)+_0x17796a(0x1bd));try{let _0x5e8504=!![],_0x13305d=fs[_0x17796a(0x1c5)](_0x3d9230);if(_0x13305d){let _0x585acd=fs['statSync'](_0x3d9230);_0x585acd[_0x17796a(0x199)]>0x2710&&(_0x5e8504=![]);}if(_0x5e8504)await _0x4219f8(_0x2fa20d,_0x3d9230,_0x4ba85d),_0x1ea214+=0x1,_0x19dba8();else{_0x1ea214+=0x1,_0x19dba8();continue;}}catch(_0x4b3794){_0x1ea214+=0x1,_0x19dba8();}}}else exitProcess();});}let bgTaskId;try{let info=dbOther[_0x250f23(0x196)](_0x250f23(0x1c0))['run'](_0x250f23(0x1c9));bgTaskId=info['lastInsertRowid'];}catch(_0x3b06ec){}function exitProcess(){const _0x348fb1=_0x250f23;try{bgTaskId&&dbOther['prepare'](_0x348fb1(0x1b5)+bgTaskId)[_0x348fb1(0x19d)]();}catch(_0x270a1e){}return process[_0x348fb1(0x1af)]({'type':'close'}),process[_0x348fb1(0x1a7)]();}async function runGen(){const _0x536c06=_0x250f23;let _0x14c4d7=dbConfigTable['findByTitle'](dbOther,_0x536c06(0x192));!_0x14c4d7||_0x14c4d7&&_0x14c4d7['value']=='1'?genStart(dbFileIndexTable['INDEX_TABLE_NAME_MOVIE'])['then'](()=>{runGen();})['catch'](()=>{runGen();}):exitProcess();}process['on'](_0x250f23(0x19e),(_0x1a82db,_0x299222)=>{const _0x11a6db=_0x250f23;console[_0x11a6db(0x193)](_0x1a82db),messageUtil['saveMsg'](dbOther,_0x11a6db(0x1ab),_0x11a6db(0x1a5),_0x1a82db[_0x11a6db(0x1ae)]||_0x1a82db[_0x11a6db(0x18f)]);}),process['on'](_0x250f23(0x1a7),(_0x39028b,_0x186ce7)=>{const _0x2105cc=_0x250f23;process['send']({'type':_0x2105cc(0x1b0)});}),runGen();