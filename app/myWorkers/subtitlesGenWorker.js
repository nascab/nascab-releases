const _0x4369ae=_0x1faf;(function(_0x415c20,_0x259092){const _0x51a86f=_0x1faf,_0x1fb76e=_0x415c20();while(!![]){try{const _0x145e8d=parseInt(_0x51a86f(0x1f9))/0x1*(parseInt(_0x51a86f(0x209))/0x2)+-parseInt(_0x51a86f(0x20d))/0x3*(-parseInt(_0x51a86f(0x1e2))/0x4)+-parseInt(_0x51a86f(0x216))/0x5*(parseInt(_0x51a86f(0x1df))/0x6)+-parseInt(_0x51a86f(0x203))/0x7*(parseInt(_0x51a86f(0x21f))/0x8)+parseInt(_0x51a86f(0x1e0))/0x9*(parseInt(_0x51a86f(0x21a))/0xa)+-parseInt(_0x51a86f(0x1e9))/0xb*(-parseInt(_0x51a86f(0x1fe))/0xc)+-parseInt(_0x51a86f(0x212))/0xd;if(_0x145e8d===_0x259092)break;else _0x1fb76e['push'](_0x1fb76e['shift']());}catch(_0x4c6a30){_0x1fb76e['push'](_0x1fb76e['shift']());}}}(_0x1229,0x37d51));const config=require(_0x4369ae(0x1dd));let fs=require('fs'),path=require(_0x4369ae(0x1f1));const dbFileIndexTable=require(_0x4369ae(0x217)),dbConfigTable=require(_0x4369ae(0x215));let transCodeUtil=require(_0x4369ae(0x1fd)),sha256=require(_0x4369ae(0x213)),FFmpeg=require(_0x4369ae(0x205))[_0x4369ae(0x21d)];process[_0x4369ae(0x1de)]=_0x4369ae(0x1e5);const Database=require(_0x4369ae(0x1ef));let dbFileIndex=new Database(config[_0x4369ae(0x204)],{'timeout':0xea60});dbFileIndex[_0x4369ae(0x221)](_0x4369ae(0x1f5));let dbOther=new Database(config[_0x4369ae(0x1ec)],{});dbOther[_0x4369ae(0x221)](_0x4369ae(0x1f5));function _0x1229(){const _0x4302eb=['INDEX_TABLE_NAME_MOVIE','error','parse','451wkvHgT','statSync','send','dbOther','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','saveMsg','better-sqlite3','stream_info','path','join','close','prepare','journal_mode\x20=\x20WAL','filename','getByWhere','exit','5rLFxUs','lastInsertRowid','\x20set\x20pre_gen_subtitles=1\x20where\x20id=?','findByTitle','../utils/transCodeUtil','62532JcsMLM','subtitlePreGen','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','SUBTITLE_PRE_GEN','size','47215wtjxot','dbFileIndex','../libs/nasTrans','\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','then','subtitlePath','145654Bngmsl','../utils/messageUtil','message','length','1182933kEEASm','indexOf','log','Error\x20occurred\x20in\x20subtitles\x20gen\x20process','run','2094183qEhLun','sha256','input','../db/dbConfigTable','34500aFKNNb','../db/dbFileIndexTable','kill','noVideo','91480qipTXB','end','uncaughtException','FFmpeg','catch','456yrOMvZ','outputOptions','pragma','UPDATE\x20','output','subtitle','../myConfig/config','title','180FXRHnH','9yDgqHx','existsSync','4QCsbFj','codec_type','noAudio','NasCabSubtitleWorker'];_0x1229=function(){return _0x4302eb;};return _0x1229();}const messageUtil=require(_0x4369ae(0x20a));function dealFinish(_0x50dd11,_0x5f4322){const _0x373b1b=_0x4369ae;if(_0x50dd11){let _0x6700ab=_0x373b1b(0x222)+dbFileIndexTable[_0x373b1b(0x1e6)]+_0x373b1b(0x1fb);dbFileIndex[_0x373b1b(0x1f4)](_0x6700ab)[_0x373b1b(0x211)](_0x50dd11['id']);}_0x5f4322&&_0x5f4322();}function _0x1faf(_0x40584c,_0x330cf3){const _0x1229bb=_0x1229();return _0x1faf=function(_0x1fafb7,_0x414f6d){_0x1fafb7=_0x1fafb7-0x1dd;let _0x1c31f6=_0x1229bb[_0x1fafb7];return _0x1c31f6;},_0x1faf(_0x40584c,_0x330cf3);}function genStart(){return new Promise(async(_0x1d1f20,_0x3a7014)=>{const _0x46becd=_0x1faf;let _0x3cb333=dbFileIndexTable[_0x46becd(0x1f7)](dbFileIndex,_0x46becd(0x206),'*',dbFileIndexTable[_0x46becd(0x1e6)]);if(_0x3cb333){let _0x50385a=_0x3cb333[_0x46becd(0x1f0)];if(!_0x50385a)return dealFinish(_0x3cb333,_0x1d1f20);let _0x1a6ffd=path[_0x46becd(0x1f2)](_0x3cb333[_0x46becd(0x1f1)],_0x3cb333[_0x46becd(0x1f6)]);try{_0x50385a=JSON[_0x46becd(0x1e8)](_0x50385a);}catch(_0x17dd1b){return dealFinish(_0x3cb333,_0x1d1f20);}let _0x525fb5=[];for(let _0x26c03c in _0x50385a){let _0x461d73=_0x50385a[_0x26c03c];_0x461d73[_0x46becd(0x1e3)]==_0x46becd(0x224)&&_0x525fb5['push'](_0x461d73);}if(_0x525fb5[_0x46becd(0x20c)]<0x1)return dealFinish(_0x3cb333,_0x1d1f20);let _0x19cf1a=0x0;function _0x53ac79(){const _0x31d0a6=_0x46becd;if(_0x19cf1a>=_0x525fb5[_0x31d0a6(0x20c)])return dealFinish(_0x3cb333,_0x1d1f20);}function _0x3c3a96(_0x4fff50,_0x20a34e,_0x2f819d){const _0x2503df=_0x46becd;try{bgTaskId&&dbOther[_0x2503df(0x1f4)](_0x2503df(0x200)+bgTaskId)['run']();}catch(_0x518ebd){}return new Promise((_0x174654,_0x208ed2)=>{const _0x1ecfe8=_0x2503df;let _0xb87212=FFmpeg({'timeout':0x258});_0xb87212[_0x1ecfe8(0x214)](transCodeUtil['dealFFmpegPath'](_0x4fff50))[_0x1ecfe8(0x1e4)]()[_0x1ecfe8(0x219)]()[_0x1ecfe8(0x220)](['-map\x200:s:'+_0x2f819d])[_0x1ecfe8(0x223)](_0x20a34e)['on']('start',function(_0x52f65b){})['on']('error',function(_0x2d53e0){const _0x21b66c=_0x1ecfe8;_0x2d53e0[_0x21b66c(0x20b)]&&_0x2d53e0[_0x21b66c(0x20b)][_0x21b66c(0x20e)]('killed')==-0x1&&(fs['rm'](_0x20a34e,_0x44a5eb=>{}),dealFinish(_0x3cb333,_0x174654),_0xb87212[_0x21b66c(0x218)]());})['on'](_0x1ecfe8(0x21b),function(){const _0x319d36=_0x1ecfe8;console[_0x319d36(0x20f)]('Subtitle\x20extraction\x20:\x20',_0x4fff50),_0xb87212['kill'](),_0x174654();}),_0xb87212[_0x1ecfe8(0x211)]();});}for(let _0x297e56 in _0x525fb5){let _0x2a4919=path[_0x46becd(0x1f2)](config[_0x46becd(0x208)],sha256(_0x1a6ffd+_0x297e56)+'.vtt');try{let _0x313221=!![],_0x32013d=fs[_0x46becd(0x1e1)](_0x2a4919);if(_0x32013d){let _0xb11fd6=fs[_0x46becd(0x1ea)](_0x2a4919);_0xb11fd6[_0x46becd(0x202)]>0x2710&&(_0x313221=![]);}if(_0x313221)await _0x3c3a96(_0x1a6ffd,_0x2a4919,_0x297e56),_0x19cf1a+=0x1,_0x53ac79();else{_0x19cf1a+=0x1,_0x53ac79();continue;}}catch(_0x53d0f0){_0x19cf1a+=0x1,_0x53ac79();}}}else exitProcess();});}let bgTaskId;try{let info=dbOther['prepare']('INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)')[_0x4369ae(0x211)](_0x4369ae(0x201));bgTaskId=info[_0x4369ae(0x1fa)];}catch(_0x4e02be){}function exitProcess(){const _0x479255=_0x4369ae;try{bgTaskId&&dbOther[_0x479255(0x1f4)](_0x479255(0x1ed)+bgTaskId)[_0x479255(0x211)]();}catch(_0x54fde1){}return process['send']({'type':_0x479255(0x1f3)}),process['exit']();}async function runGen(){const _0xd1ec22=_0x4369ae;let _0x99b914=dbConfigTable[_0xd1ec22(0x1fc)](dbOther,_0xd1ec22(0x1ff));!_0x99b914||_0x99b914&&_0x99b914['value']=='1'?genStart(dbFileIndexTable[_0xd1ec22(0x1e6)])[_0xd1ec22(0x207)](()=>{runGen();})[_0xd1ec22(0x21e)](()=>{runGen();}):exitProcess();}process['on'](_0x4369ae(0x21c),(_0x56074c,_0x318044)=>{const _0x269274=_0x4369ae;console[_0x269274(0x20f)](_0x56074c),messageUtil[_0x269274(0x1ee)](dbOther,_0x269274(0x210),_0x269274(0x1e7),_0x56074c['stack']||_0x56074c[_0x269274(0x20b)]);}),process['on'](_0x4369ae(0x1f8),(_0x1c3df7,_0x2cfc14)=>{const _0x237072=_0x4369ae;process[_0x237072(0x1eb)]({'type':'close'});}),runGen();