const _0x12150b=_0x2df8;(function(_0x129789,_0x16696e){const _0x551bd8=_0x2df8,_0x12b61a=_0x129789();while(!![]){try{const _0x22b33b=parseInt(_0x551bd8(0x149))/0x1*(-parseInt(_0x551bd8(0x12f))/0x2)+parseInt(_0x551bd8(0x122))/0x3*(-parseInt(_0x551bd8(0x12e))/0x4)+-parseInt(_0x551bd8(0x11b))/0x5+-parseInt(_0x551bd8(0x133))/0x6*(parseInt(_0x551bd8(0x10f))/0x7)+-parseInt(_0x551bd8(0x129))/0x8*(-parseInt(_0x551bd8(0x11d))/0x9)+parseInt(_0x551bd8(0x141))/0xa+parseInt(_0x551bd8(0x13f))/0xb;if(_0x22b33b===_0x16696e)break;else _0x12b61a['push'](_0x12b61a['shift']());}catch(_0x54314d){_0x12b61a['push'](_0x12b61a['shift']());}}}(_0x32b5,0x9cd53));const config=require(_0x12150b(0x13d));let fs=require('fs'),path=require(_0x12150b(0x12a));const dbFileIndexTable=require(_0x12150b(0x119)),dbConfigTable=require(_0x12150b(0x14e));function _0x2df8(_0xfeb7bc,_0x32c3e6){const _0x32b519=_0x32b5();return _0x2df8=function(_0x2df88a,_0x4f74da){_0x2df88a=_0x2df88a-0x109;let _0x3df902=_0x32b519[_0x2df88a];return _0x3df902;},_0x2df8(_0xfeb7bc,_0x32c3e6);}let transCodeUtil=require(_0x12150b(0x10e)),sha256=require(_0x12150b(0x111)),FFmpeg=require(_0x12150b(0x109))[_0x12150b(0x14c)];process['title']=_0x12150b(0x135);const Database=require(_0x12150b(0x13b));let dbFileIndex=new Database(config[_0x12150b(0x138)],{'timeout':0xea60});dbFileIndex[_0x12150b(0x125)]('journal_mode\x20=\x20WAL');let dbOther=new Database(config['dbOther'],{});dbOther['pragma'](_0x12150b(0x11f));const messageUtil=require('../utils/messageUtil');function dealFinish(_0x27378f,_0x4cc639){const _0x3c51fb=_0x12150b;if(_0x27378f){let _0x4ff2f3=_0x3c51fb(0x11c)+dbFileIndexTable[_0x3c51fb(0x147)]+_0x3c51fb(0x12b);dbFileIndex['prepare'](_0x4ff2f3)['run'](_0x27378f['id']);}_0x4cc639&&_0x4cc639();}function genStart(){return new Promise(async(_0x18177c,_0x2ba42e)=>{const _0x29d1b9=_0x2df8;let _0x42297c=dbFileIndexTable[_0x29d1b9(0x134)](dbFileIndex,_0x29d1b9(0x121),'*',dbFileIndexTable[_0x29d1b9(0x147)]);if(_0x42297c){let _0x351fda=_0x42297c['stream_info'];if(!_0x351fda)return dealFinish(_0x42297c,_0x18177c);let _0x33166c=path[_0x29d1b9(0x148)](_0x42297c[_0x29d1b9(0x12a)],_0x42297c[_0x29d1b9(0x126)]);try{_0x351fda=JSON[_0x29d1b9(0x137)](_0x351fda);}catch(_0x496aa7){return dealFinish(_0x42297c,_0x18177c);}let _0x368ea1=[];for(let _0xa52dc3 in _0x351fda){let _0x3a582c=_0x351fda[_0xa52dc3];_0x3a582c[_0x29d1b9(0x144)]==_0x29d1b9(0x14b)&&_0x368ea1[_0x29d1b9(0x14a)](_0x3a582c);}if(_0x368ea1[_0x29d1b9(0x14d)]<0x1)return dealFinish(_0x42297c,_0x18177c);let _0x47f2f6=0x0;function _0x3fae67(){const _0x397d69=_0x29d1b9;if(_0x47f2f6>=_0x368ea1[_0x397d69(0x14d)])return dealFinish(_0x42297c,_0x18177c);}function _0x2f63c7(_0x8eef83,_0xf77b67,_0x44ab64){const _0x565cf5=_0x29d1b9;try{bgTaskId&&dbOther['prepare']('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)[_0x565cf5(0x123)]();}catch(_0x367123){}return new Promise((_0x385f51,_0x131949)=>{const _0x318b82=_0x565cf5;let _0x53fa31=FFmpeg({'timeout':0x258});_0x53fa31[_0x318b82(0x112)](transCodeUtil[_0x318b82(0x14f)](_0x8eef83))[_0x318b82(0x150)]()[_0x318b82(0x128)]()['outputOptions']([_0x318b82(0x10c)+_0x44ab64])['output'](_0xf77b67)['on'](_0x318b82(0x136),function(_0x3affd9){})['on'](_0x318b82(0x13e),function(_0x233637){const _0x5175e3=_0x318b82;_0x233637[_0x5175e3(0x110)]&&_0x233637[_0x5175e3(0x110)][_0x5175e3(0x127)](_0x5175e3(0x113))==-0x1&&(fs['rm'](_0xf77b67,_0x40ef97=>{}),dealFinish(_0x42297c,_0x385f51),_0x53fa31[_0x5175e3(0x145)]());})['on'](_0x318b82(0x139),function(){const _0xb0333f=_0x318b82;console[_0xb0333f(0x12c)](_0xb0333f(0x13c),_0x8eef83),_0x53fa31[_0xb0333f(0x145)](),_0x385f51();}),_0x53fa31[_0x318b82(0x123)]();});}for(let _0x207d38 in _0x368ea1){let _0x28a5af=path[_0x29d1b9(0x148)](config[_0x29d1b9(0x11e)],sha256(_0x33166c+_0x207d38)+_0x29d1b9(0x131));try{let _0x4a69e2=!![],_0xe782ab=fs['existsSync'](_0x28a5af);if(_0xe782ab){let _0x3ea3b5=fs[_0x29d1b9(0x10d)](_0x28a5af);_0x3ea3b5[_0x29d1b9(0x13a)]>0x2710&&(_0x4a69e2=![]);}if(_0x4a69e2)await _0x2f63c7(_0x33166c,_0x28a5af,_0x207d38),_0x47f2f6+=0x1,_0x3fae67();else{_0x47f2f6+=0x1,_0x3fae67();continue;}}catch(_0x58a41d){_0x47f2f6+=0x1,_0x3fae67();}}}else exitProcess();});}let bgTaskId;try{let info=dbOther[_0x12150b(0x117)](_0x12150b(0x140))[_0x12150b(0x123)](_0x12150b(0x10b));bgTaskId=info[_0x12150b(0x11a)];}catch(_0x9a3d78){}function exitProcess(){const _0x39bd50=_0x12150b;try{bgTaskId&&dbOther[_0x39bd50(0x117)](_0x39bd50(0x132)+bgTaskId)[_0x39bd50(0x123)]();}catch(_0x5939be){}return process[_0x39bd50(0x114)]({'type':_0x39bd50(0x118)}),process[_0x39bd50(0x12d)]();}async function runGen(){const _0x5be8cf=_0x12150b;let _0x31c601=dbConfigTable[_0x5be8cf(0x146)](dbOther,_0x5be8cf(0x120));!_0x31c601||_0x31c601&&_0x31c601[_0x5be8cf(0x115)]=='1'?genStart(dbFileIndexTable[_0x5be8cf(0x147)])[_0x5be8cf(0x10a)](()=>{runGen();})[_0x5be8cf(0x124)](()=>{runGen();}):exitProcess();}function _0x32b5(){const _0x102a1e=['prepare','close','../db/dbFileIndexTable','lastInsertRowid','3324270LVeitI','UPDATE\x20','11053188NvbKoT','subtitlePath','journal_mode\x20=\x20WAL','subtitlePreGen','\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','59931gBUhbJ','run','catch','pragma','filename','indexOf','noVideo','8icGETw','path','\x20set\x20pre_gen_subtitles=1\x20where\x20id=?','log','exit','200PhwGKB','240742xPcbit','saveMsg','.vtt','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','61266lrLqhF','getByWhere','NasCabSubtitleWorker','start','parse','dbFileIndex','end','size','better-sqlite3','Subtitle\x20extraction\x20:\x20','../myConfig/config','error','19006328ZSDjRg','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','3486280eGnknw','Error\x20occurred\x20in\x20subtitles\x20gen\x20process','uncaughtException','codec_type','kill','findByTitle','INDEX_TABLE_NAME_MOVIE','join','1LFTagF','push','subtitle','FFmpeg','length','../db/dbConfigTable','dealFFmpegPath','noAudio','../libs/nasTrans','then','SUBTITLE_PRE_GEN','-map\x200:s:','statSync','../utils/transCodeUtil','602GVhQnz','message','sha256','input','killed','send','value','stack'];_0x32b5=function(){return _0x102a1e;};return _0x32b5();}process['on'](_0x12150b(0x143),(_0x1a0e41,_0x5f37b0)=>{const _0x273120=_0x12150b;console[_0x273120(0x12c)](_0x1a0e41),messageUtil[_0x273120(0x130)](dbOther,_0x273120(0x142),_0x273120(0x13e),_0x1a0e41[_0x273120(0x116)]||_0x1a0e41[_0x273120(0x110)]);}),process['on'](_0x12150b(0x12d),(_0x378e89,_0x2c5188)=>{process['send']({'type':'close'});}),runGen();