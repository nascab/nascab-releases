const _0x285cf7=_0x37ce;(function(_0x2b7fee,_0xb469cc){const _0x53d19b=_0x37ce,_0x38ea70=_0x2b7fee();while(!![]){try{const _0xd83e43=parseInt(_0x53d19b(0x1e5))/0x1*(parseInt(_0x53d19b(0x198))/0x2)+-parseInt(_0x53d19b(0x18b))/0x3*(-parseInt(_0x53d19b(0x16a))/0x4)+-parseInt(_0x53d19b(0x1ce))/0x5+-parseInt(_0x53d19b(0x1df))/0x6+-parseInt(_0x53d19b(0x1e9))/0x7*(parseInt(_0x53d19b(0x1d5))/0x8)+parseInt(_0x53d19b(0x1d0))/0x9+-parseInt(_0x53d19b(0x1d2))/0xa;if(_0xd83e43===_0xb469cc)break;else _0x38ea70['push'](_0x38ea70['shift']());}catch(_0x2c9b8e){_0x38ea70['push'](_0x38ea70['shift']());}}}(_0x38f6,0x3940e));const commonRouter=require(_0x285cf7(0x1db)),express=require('express'),app=express(),expressWs=require('express-ws');expressWs(app);const path=require(_0x285cf7(0x1e4)),cookieParser=require(_0x285cf7(0x167)),dbUtil=require(_0x285cf7(0x1a5)),dbu=new dbUtil(),netUtils=require(_0x285cf7(0x165)),config=require(_0x285cf7(0x188)),compression=require(_0x285cf7(0x1cc)),dbUserTable=require('../db/dbUserTable'),cors=require(_0x285cf7(0x18c)),encryptUtil=require(_0x285cf7(0x199));let sha256=require('sha256');app[_0x285cf7(0x1a4)](cors()),app[_0x285cf7(0x1a4)](compression());function _0x38f6(){const _0x3eb286=['query','white','headers','path','32ZRHIzF','indexOf','./routes/usersApi','/api/fileApi','91lXfCcs','TokenExpired','./utils/netUtils','setLocale','cookie-parser','/api/file/zipFile/','/api/nasAccountApi','4vYysAW','getUserByToken','/api/commonApi/refreshHomePage','from','value','shareToken','status','./routes/privateSpace','body-parser','returnErrMsg','getClientIp','./routes/addGpsApi','/api/file/customImageFile','./routes/zipFileApi','/api/usersApi/hasAdmin','appRootPath','/api/usersApi/tokenLogin','getAllIpListByWhere','startsWith','../utils/i18nUtil','push','dbOther','/api/usersApi/login','static','authorization','/api/ordinaryAlbumApi','get','json','dbFileIndex','/api/addGpsApi','../myConfig/config','headersSent','language','684582BYTAHl','cors','includes','getTime','/api/uploadApi','public_music','toString','isTempShare','/api/mapApi','token','127.0.0.1','./routes/messageApi','body','9278lGxSrd','./utils/encryptUtil','prepare','/api/commonApi','exports','./routes/transCodeApi','black','./routes/movieApi','password','./routes/fileRecordApi','./routes/mapApi','getServerRootPath','use','../db/dbUtil','dbCity','@tensorflow/tfjs','/api/fileRecordApi','ipMode','/api/zipFileApi','message','init','getLocale','refreshIpDetection','./routes/bookApi','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?','needRootPath','join','./routes/backupApi','../db/dbConfigTable','locals','public','currentUser','urlencoded','100gb','end','decryptParams','/api/messageApi','i18n','refreshIpList','/api/healthCheck','web','/api','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','findByTitle','/api/photoApi','./routes/movieInfoApi','404','/api/fileShareApi','getI18n','/api/sourceFolderApi','../db/dbLoginTable','login.cannotLogin','compression','/api/musicApi','168255mWWrIq','/api/usersApi','3061881FcVczf','public_book','2122680ZXUjcJ','/api/privateSpaceApi','./routes/fileApi','52152VaBqVn','security.ipNotInAllowList','/api/usersApi/resetPwd','base64','split','/api/bookApi','./routes/commonApi','log','172.','/api/backupApi','910050QFfAwF','app'];_0x38f6=function(){return _0x3eb286;};return _0x38f6();}let i18nUtil=require(_0x285cf7(0x17d)),i18n=i18nUtil[_0x285cf7(0x1c8)](dbu[_0x285cf7(0x17f)]);app['use'](i18n[_0x285cf7(0x1ac)]),app[_0x285cf7(0x1bd)]=i18n,app[_0x285cf7(0x173)]=function(_0x39a3b1,_0x11eee2,_0x162006){const _0x53f0ac=_0x285cf7;let _0x5c5d26={'code':0x1,'message':_0x11eee2};_0x162006&&(_0x5c5d26['alertType']=_0x162006);if(!_0x39a3b1[_0x53f0ac(0x189)])return _0x39a3b1['json'](_0x5c5d26);},app[_0x285cf7(0x186)]=dbu['dbFileIndex'],app[_0x285cf7(0x17f)]=dbu[_0x285cf7(0x17f)],app[_0x285cf7(0x1a6)]=dbu['dbCity'];const dbConfigTable=require(_0x285cf7(0x1b4)),dbLoginTable=require(_0x285cf7(0x1ca));let ipDetection=![];app['refreshIpDetection']=()=>{const _0x1ca4f9=_0x285cf7;let _0x14462b=dbConfigTable[_0x1ca4f9(0x1c3)](dbu[_0x1ca4f9(0x17f)],'ipDetection');_0x14462b&&(ipDetection=_0x14462b[_0x1ca4f9(0x16e)]=='1');},app[_0x285cf7(0x1ae)]();let ipMode=_0x285cf7(0x19e),ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app[_0x285cf7(0x1be)]=()=>{const _0x4968b9=_0x285cf7;let _0x4f0a5f=new Date()[_0x4968b9(0x18e)]();refreshIpTimestamp=_0x4f0a5f;let _0x525524=dbConfigTable[_0x4968b9(0x1c3)](dbu[_0x4968b9(0x17f)],_0x4968b9(0x1a9));_0x525524&&(ipMode=_0x525524[_0x4968b9(0x16e)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x4968b9(0x19e)){let _0x27825a=dbLoginTable[_0x4968b9(0x17b)](dbu[_0x4968b9(0x17f)],'\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>'+_0x4f0a5f+')');for(let _0x500032 in _0x27825a){ipBlackList[_0x4968b9(0x17e)](_0x27825a[_0x500032]['ip']);}}else{if(ipMode=='white'){let _0x5eb906=dbLoginTable['getAllIpListByWhere'](dbu[_0x4968b9(0x17f)],_0x4968b9(0x1c2)+_0x4f0a5f+')');for(let _0x3b512a in _0x5eb906){ipWhiteList['push'](_0x5eb906[_0x3b512a]['ip']);}}}},app['refreshIpList']();let serverRootPath=dbConfigTable[_0x285cf7(0x1a3)](dbu[_0x285cf7(0x17f)]);app[_0x285cf7(0x1a4)](''+serverRootPath,express['static'](path['join'](config[_0x285cf7(0x179)],_0x285cf7(0x1c0),_0x285cf7(0x1b6)))),app[_0x285cf7(0x1a4)](''+serverRootPath,express['static'](path[_0x285cf7(0x1b2)](config[_0x285cf7(0x179)],'web','public_pdf'))),app[_0x285cf7(0x1a4)](''+serverRootPath,express[_0x285cf7(0x181)](path[_0x285cf7(0x1b2)](config[_0x285cf7(0x179)],_0x285cf7(0x1c0),'public_viewer'))),app['use'](''+serverRootPath,express[_0x285cf7(0x181)](path['join'](config['appRootPath'],_0x285cf7(0x1c0),_0x285cf7(0x190)))),app[_0x285cf7(0x1a4)](''+serverRootPath,express[_0x285cf7(0x181)](path[_0x285cf7(0x1b2)](config[_0x285cf7(0x179)],_0x285cf7(0x1c0),_0x285cf7(0x1d1))));var bodyParser=require(_0x285cf7(0x172));app['use'](bodyParser[_0x285cf7(0x185)]({'limit':'100gb'})),app[_0x285cf7(0x1a4)](bodyParser[_0x285cf7(0x1b8)]({'limit':_0x285cf7(0x1b9),'extended':!![]})),app[_0x285cf7(0x1a4)](express[_0x285cf7(0x185)]()),app['use'](express[_0x285cf7(0x1b8)]({'extended':![]})),app[_0x285cf7(0x1a4)](cookieParser());const noCheckPathArr=[serverRootPath+_0x285cf7(0x1d7),serverRootPath+'/api/usersApi/resetPwdInfo',serverRootPath+_0x285cf7(0x178),serverRootPath+'/api/usersApi/registAdmin',serverRootPath+'/api/file/getTempShareFiles',serverRootPath+_0x285cf7(0x176),serverRootPath+_0x285cf7(0x180),serverRootPath+_0x285cf7(0x17a),serverRootPath+'/api/usersApi/checkIsNasServer',serverRootPath+'/api/commonApi/getLanguage',serverRootPath+_0x285cf7(0x16c)];let lastUpdateLastLoginTime={};app[_0x285cf7(0x1a4)](function(_0x4e32d1,_0x5ae3f8,_0x2e85ce){const _0x4f5da1=_0x285cf7;if(_0x4e32d1[_0x4f5da1(0x1e4)]==serverRootPath+_0x4f5da1(0x1bf))return _0x5ae3f8[_0x4f5da1(0x185)]({'code':0x0});let _0x40860e=new Date()[_0x4f5da1(0x18e)](),_0xd29a39=netUtils[_0x4f5da1(0x174)](_0x4e32d1);if(_0xd29a39!='localhost'&&_0xd29a39!=_0x4f5da1(0x195)){_0x40860e-refreshIpGap>refreshIpTimestamp&&app[_0x4f5da1(0x1be)]();if(ipMode==_0x4f5da1(0x19e)){if(ipBlackList[_0x4f5da1(0x18d)](_0xd29a39))return app[_0x4f5da1(0x173)](_0x5ae3f8,_0x5ae3f8['__']('security.ipNotInAllowList')+_0x5ae3f8['__']('login.cannotLogin'));}else{if(ipMode==_0x4f5da1(0x1e2)){if(!ipWhiteList[_0x4f5da1(0x18d)](_0xd29a39))return app[_0x4f5da1(0x173)](_0x5ae3f8,_0x5ae3f8['__'](_0x4f5da1(0x1d6))+_0x5ae3f8['__'](_0x4f5da1(0x1cb)));}}}encryptUtil[_0x4f5da1(0x1bb)](_0x4e32d1),_0x4e32d1[_0x4f5da1(0x166)](i18n[_0x4f5da1(0x1ad)]()),_0x5ae3f8[_0x4f5da1(0x1b5)][_0x4f5da1(0x18a)]=i18n[_0x4f5da1(0x1ad)]();let _0x7a5274=_0x4e32d1[_0x4f5da1(0x1e1)][_0x4f5da1(0x16f)]||_0x4e32d1['query']['st'];if(_0x7a5274&&(_0x4e32d1['path'][_0x4f5da1(0x17c)](serverRootPath+'/api/fileApi/tinyImgByPath/')||_0x4e32d1[_0x4f5da1(0x1e4)][_0x4f5da1(0x17c)](serverRootPath+'/api/fileApi/rawFileByPath/')||_0x4e32d1[_0x4f5da1(0x1e4)][_0x4f5da1(0x17c)](serverRootPath+'/api/file/rawFile/')||_0x4e32d1['path'][_0x4f5da1(0x17c)](serverRootPath+_0x4f5da1(0x168))))try{let _0x3404cd=_0x4e32d1[_0x4f5da1(0x1e1)]['sharePwd']||_0x4e32d1['query']['sp'];_0x3404cd&&(_0x4e32d1[_0x4f5da1(0x1e1)]['sp']=Buffer[_0x4f5da1(0x16d)](_0x3404cd,_0x4f5da1(0x1d8))[_0x4f5da1(0x191)]());let _0x106d4d=_0x4e32d1[_0x4f5da1(0x1e0)][_0x4f5da1(0x17f)][_0x4f5da1(0x19a)](_0x4f5da1(0x1b0))[_0x4f5da1(0x184)](_0x7a5274,new Date()['getTime']());if(!_0x106d4d)return _0x5ae3f8[_0x4f5da1(0x170)](0x194)['end']();if(_0x106d4d[_0x4f5da1(0x1a0)]&&_0x106d4d[_0x4f5da1(0x1a0)]!=_0x4e32d1['query']['sp'])return _0x5ae3f8['status'](0x194)[_0x4f5da1(0x1ba)]();return _0x4e32d1[_0x4f5da1(0x192)]=!![],_0x2e85ce();}catch(_0x5acb17){return _0x5ae3f8['status'](0x194)[_0x4f5da1(0x1ba)]();}if(noCheckPathArr[_0x4f5da1(0x1e6)](_0x4e32d1[_0x4f5da1(0x1e4)])==-0x1){let _0x225f5c=_0x4e32d1[_0x4f5da1(0x1e3)]['token']||_0x4e32d1[_0x4f5da1(0x1e1)][_0x4f5da1(0x194)]||_0x4e32d1[_0x4f5da1(0x197)][_0x4f5da1(0x194)];!_0x225f5c&&_0x4e32d1['headers'][_0x4f5da1(0x182)]&&(_0x225f5c=_0x4e32d1['headers'][_0x4f5da1(0x182)][_0x4f5da1(0x1d9)]('\x20')[0x1]);let _0xab80e3=dbUserTable[_0x4f5da1(0x16b)](_0x4e32d1[_0x4f5da1(0x1e0)][_0x4f5da1(0x17f)],_0x225f5c),_0x474c98=!![];ipDetection&&_0xab80e3&&_0xd29a39!=_0xab80e3['token_ip']&&_0xd29a39!='localhost'&&!_0xd29a39[_0x4f5da1(0x17c)]('192.')&&!_0xd29a39[_0x4f5da1(0x17c)]('10.')&&!_0xd29a39[_0x4f5da1(0x17c)](_0x4f5da1(0x1dd))&&(_0x474c98=![]);if(!_0xab80e3||!_0x474c98){if(serverRootPath&&_0x4e32d1[_0x4f5da1(0x1e4)][_0x4f5da1(0x17c)](_0x4f5da1(0x1c1)))return app[_0x4f5da1(0x173)](_0x5ae3f8,i18n['__'](_0x4f5da1(0x1b1)));return _0x5ae3f8[_0x4f5da1(0x185)]({'code':0x65,'message':i18n['__'](_0x4f5da1(0x1ea))});}let _0xb49f76=new Date()[_0x4f5da1(0x18e)](),_0x307194=0xa*0x3e8;(!lastUpdateLastLoginTime[_0xab80e3['id']]||_0xb49f76-lastUpdateLastLoginTime[_0xab80e3['id']]>_0x307194)&&(dbUserTable['updateLastLoginTimeByToken'](_0x4e32d1[_0x4f5da1(0x1e0)][_0x4f5da1(0x17f)],_0x225f5c,_0xb49f76),lastUpdateLastLoginTime[_0xab80e3['id']]=_0xb49f76),_0x4e32d1[_0x4f5da1(0x1b7)]=_0xab80e3,_0x2e85ce();}else _0x2e85ce();});let mapRouter=require(_0x285cf7(0x1a2));app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x193),mapRouter);let uploadRouter=require('./routes/uploadApi');app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x18f),uploadRouter);let transCodeRouter=require(_0x285cf7(0x19d));app[_0x285cf7(0x1a4)](serverRootPath+'/api/transCode',transCodeRouter);let pathFileRouter=require('./routes/file');app[_0x285cf7(0x1a4)](serverRootPath+'/api/file',pathFileRouter);let fileRecordApi=require(_0x285cf7(0x1a1));function _0x37ce(_0x28b05f,_0x268d42){const _0x38f6d1=_0x38f6();return _0x37ce=function(_0x37cec4,_0x1d690c){_0x37cec4=_0x37cec4-0x165;let _0x21a066=_0x38f6d1[_0x37cec4];return _0x21a066;},_0x37ce(_0x28b05f,_0x268d42);}app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x1a8),fileRecordApi);let fileRouter=require(_0x285cf7(0x1d4));app['use'](serverRootPath+_0x285cf7(0x1e8),fileRouter);let zipFileRouter=require(_0x285cf7(0x177));app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x1aa),zipFileRouter),app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x19b),commonRouter);let usersRouter=require(_0x285cf7(0x1e7));app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x1cf),usersRouter);let sourceFolderRouter=require('./routes/sourceFolderApi');app['use'](serverRootPath+_0x285cf7(0x1c9),sourceFolderRouter);let ordinaryRouter=require('./routes/ordinaryAlbumApi');app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x183),ordinaryRouter);let photoRouter=require('./routes/photoApi');app['use'](serverRootPath+_0x285cf7(0x1c4),photoRouter);let addGpsRouter=require(_0x285cf7(0x175));app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x187),addGpsRouter);let messageRouter=require(_0x285cf7(0x196));app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x1bc),messageRouter);let movieRouter=require(_0x285cf7(0x19f));app[_0x285cf7(0x1a4)](serverRootPath+'/api/movieApi',movieRouter);let movieInfoRouter=require(_0x285cf7(0x1c5));app[_0x285cf7(0x1a4)](serverRootPath+'/api/movieInfoApi',movieInfoRouter);let musicRouter=require('./routes/musicApi');app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x1cd),musicRouter);let bookRouter=require(_0x285cf7(0x1af));app['use'](serverRootPath+_0x285cf7(0x1da),bookRouter);let backupRouter=require(_0x285cf7(0x1b3));app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x1de),backupRouter);let fileShareRouter=require('./routes/fileShareApi');app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x1c7),fileShareRouter);let nasAccountRouter=require('./routes/nasAccountApi');app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x169),nasAccountRouter);let privateSpaceRouter=require(_0x285cf7(0x171));const {data}=require(_0x285cf7(0x1a7));app[_0x285cf7(0x1a4)](serverRootPath+_0x285cf7(0x1d3),privateSpaceRouter),app[_0x285cf7(0x1a4)](function(_0xbb501,_0x21bfa9,_0x1aaa7e){const _0x1f25f0=_0x285cf7;console[_0x1f25f0(0x1dc)](_0x1f25f0(0x1c6),_0xbb501[_0x1f25f0(0x1e4)]),_0x21bfa9['status'](0x194)[_0x1f25f0(0x1ba)]();}),app['use'](function(_0x21ad20,_0x50444a,_0x1e3ac7,_0x5c36f8){const _0x349b2f=_0x285cf7;_0x1e3ac7['locals'][_0x349b2f(0x1ab)]=_0x21ad20[_0x349b2f(0x1ab)],console[_0x349b2f(0x1dc)](_0x21ad20),_0x1e3ac7['status'](_0x21ad20[_0x349b2f(0x170)]||0x1f4)[_0x349b2f(0x1ba)]();}),module[_0x285cf7(0x19c)]=app;