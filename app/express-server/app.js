const _0x282741=_0x55f4;(function(_0x12f784,_0x2d52cb){const _0x3a8592=_0x55f4,_0x12166c=_0x12f784();while(!![]){try{const _0x29ed2d=parseInt(_0x3a8592(0xbc))/0x1*(-parseInt(_0x3a8592(0x88))/0x2)+parseInt(_0x3a8592(0xd0))/0x3+parseInt(_0x3a8592(0x90))/0x4*(parseInt(_0x3a8592(0xb8))/0x5)+parseInt(_0x3a8592(0xc8))/0x6+-parseInt(_0x3a8592(0xa0))/0x7+-parseInt(_0x3a8592(0x102))/0x8+parseInt(_0x3a8592(0x93))/0x9*(parseInt(_0x3a8592(0x84))/0xa);if(_0x29ed2d===_0x2d52cb)break;else _0x12166c['push'](_0x12166c['shift']());}catch(_0x471085){_0x12166c['push'](_0x12166c['shift']());}}}(_0x20e9,0x5e3dc));const commonRouter=require(_0x282741(0xad)),express=require('express'),app=express(),expressWs=require(_0x282741(0x9f));expressWs(app);const path=require(_0x282741(0xe0)),cookieParser=require(_0x282741(0xfc)),dbUtil=require('../db/dbUtil'),dbu=new dbUtil(),netUtils=require(_0x282741(0xb2)),config=require('../myConfig/config'),compression=require(_0x282741(0xd7)),dbUserTable=require('../db/dbUserTable'),cors=require(_0x282741(0xa8)),encryptUtil=require(_0x282741(0xe3));let sha256=require(_0x282741(0x9b));app[_0x282741(0xe1)](cors()),app[_0x282741(0xe1)](compression());let i18nUtil=require(_0x282741(0xa9)),i18n=i18nUtil[_0x282741(0xc9)](dbu[_0x282741(0xe9)]);app[_0x282741(0xe1)](i18n[_0x282741(0x100)]),app['i18n']=i18n,app['returnErrMsg']=function(_0x396a7a,_0x2c6cfa,_0x23524e){const _0x58119b=_0x282741;let _0x564217={'code':0x1,'message':_0x2c6cfa};_0x23524e&&(_0x564217['alertType']=_0x23524e);if(!_0x396a7a['headersSent'])return _0x396a7a[_0x58119b(0xa3)](_0x564217);},app[_0x282741(0xe7)]=dbu[_0x282741(0xe7)],app['dbOther']=dbu[_0x282741(0xe9)],app[_0x282741(0x104)]=dbu[_0x282741(0x104)];const dbConfigTable=require('../db/dbConfigTable'),dbLoginTable=require(_0x282741(0x94));let ipDetection=![];app[_0x282741(0xb3)]=()=>{const _0x1dce92=_0x282741;let _0x4ce5b3=dbConfigTable['findByTitle'](dbu[_0x1dce92(0xe9)],_0x1dce92(0xfb));_0x4ce5b3&&(ipDetection=_0x4ce5b3['value']=='1');},app[_0x282741(0xb3)]();let ipMode='black',ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app[_0x282741(0xcb)]=()=>{const _0x1cb4c0=_0x282741;let _0x530053=new Date()['getTime']();refreshIpTimestamp=_0x530053;let _0x2a0d2b=dbConfigTable[_0x1cb4c0(0xde)](dbu['dbOther'],_0x1cb4c0(0x95));_0x2a0d2b&&(ipMode=_0x2a0d2b[_0x1cb4c0(0x98)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x1cb4c0(0x80)){let _0x5b4c0e=dbLoginTable[_0x1cb4c0(0x99)](dbu[_0x1cb4c0(0xe9)],'\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>'+_0x530053+')');for(let _0xe2471c in _0x5b4c0e){ipBlackList['push'](_0x5b4c0e[_0xe2471c]['ip']);}}else{if(ipMode==_0x1cb4c0(0xfe)){let _0x328992=dbLoginTable[_0x1cb4c0(0x99)](dbu[_0x1cb4c0(0xe9)],_0x1cb4c0(0xc5)+_0x530053+')');for(let _0x19e019 in _0x328992){ipWhiteList['push'](_0x328992[_0x19e019]['ip']);}}}},app[_0x282741(0xcb)]();let serverRootPath=dbConfigTable[_0x282741(0xfa)](dbu[_0x282741(0xe9)]);app[_0x282741(0xe1)](''+serverRootPath,express[_0x282741(0xfd)](path[_0x282741(0xc6)](config[_0x282741(0xd6)],_0x282741(0xb4),_0x282741(0x9c)))),app['use'](''+serverRootPath,express[_0x282741(0xfd)](path[_0x282741(0xc6)](config[_0x282741(0xd6)],_0x282741(0xb4),_0x282741(0xac)))),app[_0x282741(0xe1)](''+serverRootPath,express[_0x282741(0xfd)](path['join'](config[_0x282741(0xd6)],_0x282741(0xb4),_0x282741(0x7c)))),app[_0x282741(0xe1)](''+serverRootPath,express[_0x282741(0xfd)](path[_0x282741(0xc6)](config[_0x282741(0xd6)],_0x282741(0xb4),_0x282741(0x8c)))),app[_0x282741(0xe1)](''+serverRootPath,express['static'](path['join'](config[_0x282741(0xd6)],'web',_0x282741(0x7e))));var bodyParser=require(_0x282741(0xf3));app[_0x282741(0xe1)](bodyParser[_0x282741(0xa3)]({'limit':_0x282741(0xef)})),app[_0x282741(0xe1)](bodyParser[_0x282741(0x8e)]({'limit':'100gb','extended':!![]})),app[_0x282741(0xe1)](express[_0x282741(0xa3)]()),app[_0x282741(0xe1)](express['urlencoded']({'extended':![]})),app[_0x282741(0xe1)](cookieParser());const noCheckPathArr=[serverRootPath+_0x282741(0x96),serverRootPath+_0x282741(0x9a),serverRootPath+_0x282741(0x7b),serverRootPath+_0x282741(0xf4),serverRootPath+_0x282741(0xba),serverRootPath+_0x282741(0xbf),serverRootPath+'/api/usersApi/login',serverRootPath+_0x282741(0xb9),serverRootPath+_0x282741(0xf2),serverRootPath+_0x282741(0xf5),serverRootPath+_0x282741(0x85)];let lastUpdateLastLoginTime={};app[_0x282741(0xe1)](function(_0x3b258a,_0x5c6acf,_0x3ed5ff){const _0x316dad=_0x282741;if(_0x3b258a[_0x316dad(0xe0)]==serverRootPath+_0x316dad(0xdb))return _0x5c6acf['json']({'code':0x0});let _0x460ec8=new Date()[_0x316dad(0xb0)](),_0x261c4b=netUtils[_0x316dad(0xe6)](_0x3b258a);if(_0x261c4b!=_0x316dad(0x101)&&_0x261c4b!=_0x316dad(0xd1)){_0x460ec8-refreshIpGap>refreshIpTimestamp&&app[_0x316dad(0xcb)]();if(ipMode==_0x316dad(0x80)){if(ipBlackList[_0x316dad(0xf6)](_0x261c4b))return app[_0x316dad(0xcd)](_0x5c6acf,_0x5c6acf['__'](_0x316dad(0xf1))+_0x5c6acf['__'](_0x316dad(0x103)));}else{if(ipMode==_0x316dad(0xfe)){if(!ipWhiteList[_0x316dad(0xf6)](_0x261c4b))return app[_0x316dad(0xcd)](_0x5c6acf,_0x5c6acf['__']('security.ipNotInAllowList')+_0x5c6acf['__'](_0x316dad(0x103)));}}}encryptUtil[_0x316dad(0x83)](_0x3b258a),_0x3b258a[_0x316dad(0x8d)](i18n[_0x316dad(0xf7)]()),_0x5c6acf['locals'][_0x316dad(0xe8)]=i18n[_0x316dad(0xf7)]();let _0x258675=_0x3b258a[_0x316dad(0xb7)][_0x316dad(0x79)]||_0x3b258a[_0x316dad(0xb7)]['st'];if(_0x258675&&(_0x3b258a[_0x316dad(0xe0)]['startsWith'](serverRootPath+_0x316dad(0x9e))||_0x3b258a['path'][_0x316dad(0x78)](serverRootPath+'/api/fileApi/rawFileByPath/')||_0x3b258a[_0x316dad(0xe0)][_0x316dad(0x78)](serverRootPath+_0x316dad(0x81))||_0x3b258a[_0x316dad(0xe0)][_0x316dad(0x78)](serverRootPath+_0x316dad(0xca))))try{let _0x180780=_0x3b258a[_0x316dad(0xb7)][_0x316dad(0x8f)]||_0x3b258a['query']['sp'];_0x180780&&(_0x3b258a[_0x316dad(0xb7)]['sp']=Buffer[_0x316dad(0xf9)](_0x180780,'base64')[_0x316dad(0xd4)]());let _0x5d60=_0x3b258a[_0x316dad(0xec)][_0x316dad(0xe9)][_0x316dad(0xda)]('SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?')['get'](_0x258675,new Date()[_0x316dad(0xb0)]());if(!_0x5d60)return _0x5c6acf['status'](0x194)[_0x316dad(0xc2)]();if(_0x5d60[_0x316dad(0xb6)]&&_0x5d60['password']!=_0x3b258a[_0x316dad(0xb7)]['sp'])return _0x5c6acf[_0x316dad(0x92)](0x194)['end']();return _0x3b258a[_0x316dad(0xd9)]=!![],_0x3ed5ff();}catch(_0xc6cefe){return _0x5c6acf[_0x316dad(0x92)](0x194)[_0x316dad(0xc2)]();}if(noCheckPathArr[_0x316dad(0x86)](_0x3b258a[_0x316dad(0xe0)])==-0x1){let _0x8db20f=_0x3b258a['headers'][_0x316dad(0xce)]||_0x3b258a[_0x316dad(0xb7)]['token']||_0x3b258a['body'][_0x316dad(0xce)];!_0x8db20f&&_0x3b258a['headers'][_0x316dad(0xa6)]&&(_0x8db20f=_0x3b258a[_0x316dad(0xf8)][_0x316dad(0xa6)][_0x316dad(0xc0)]('\x20')[0x1]);let _0x25f0e2=dbUserTable['getUserByToken'](_0x3b258a[_0x316dad(0xec)][_0x316dad(0xe9)],_0x8db20f),_0x1e0379=!![];ipDetection&&_0x25f0e2&&_0x261c4b!=_0x25f0e2[_0x316dad(0xdf)]&&_0x261c4b!=_0x316dad(0x101)&&!_0x261c4b[_0x316dad(0x78)]('192.')&&!_0x261c4b['startsWith'](_0x316dad(0xc7))&&!_0x261c4b['startsWith']('172.')&&(_0x1e0379=![]);if(!_0x25f0e2||!_0x1e0379){if(serverRootPath&&_0x3b258a[_0x316dad(0xe0)]['startsWith'](_0x316dad(0x105)))return app['returnErrMsg'](_0x5c6acf,i18n['__'](_0x316dad(0x77)));return _0x5c6acf['json']({'code':0x65,'message':i18n['__'](_0x316dad(0x7f))});}let _0x30ef55=new Date()[_0x316dad(0xb0)](),_0x300a88=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x25f0e2['id']]||_0x30ef55-lastUpdateLastLoginTime[_0x25f0e2['id']]>_0x300a88)&&(dbUserTable[_0x316dad(0x87)](_0x3b258a[_0x316dad(0xec)][_0x316dad(0xe9)],_0x8db20f,_0x30ef55),lastUpdateLastLoginTime[_0x25f0e2['id']]=_0x30ef55),_0x3b258a[_0x316dad(0xdc)]=_0x25f0e2,_0x3ed5ff();}else _0x3ed5ff();});let mapRouter=require(_0x282741(0x7a));app[_0x282741(0xe1)](serverRootPath+_0x282741(0x89),mapRouter);let uploadRouter=require(_0x282741(0xae));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xc4),uploadRouter);let transCodeRouter=require(_0x282741(0xb5));app['use'](serverRootPath+_0x282741(0xbe),transCodeRouter);let pathFileRouter=require(_0x282741(0xd3));app[_0x282741(0xe1)](serverRootPath+'/api/file',pathFileRouter);function _0x20e9(){const _0xdc575a=['static','white','./routes/ordinaryAlbumApi','init','localhost','4039328Bnynjw','login.cannotLogin','dbCity','/api','/api/fileRecordApi','needRootPath','startsWith','shareToken','./routes/mapApi','/api/usersApi/hasAdmin','public_viewer','exports','public_book','TokenExpired','black','/api/file/rawFile/','./routes/musicApi','decryptParams','10580750gqBQrA','/api/commonApi/refreshHomePage','indexOf','updateLastLoginTimeByToken','12RUzCJe','/api/mapApi','./routes/fileRecordApi','./routes/movieApi','public_music','setLocale','urlencoded','sharePwd','55984wViJet','/api/sourceFolderApi','status','9YhcuFp','../db/dbLoginTable','ipMode','/api/usersApi/resetPwd','locals','value','getAllIpListByWhere','/api/usersApi/resetPwdInfo','sha256','public','/api/movieApi','/api/fileApi/tinyImgByPath/','express-ws','4740183MOOLHE','/api/messageApi','./routes/bookApi','json','/api/bookApi','./routes/nasAccountApi','authorization','/api/movieInfoApi','cors','../utils/i18nUtil','./routes/zipFileApi','/api/usersApi','public_pdf','./routes/commonApi','./routes/uploadApi','./routes/fileShareApi','getTime','./routes/backupApi','./utils/netUtils','refreshIpDetection','web','./routes/transCodeApi','password','query','160YfJWYt','/api/usersApi/tokenLogin','/api/file/getTempShareFiles','@tensorflow/tfjs','114970IByPHE','/api/zipFileApi','/api/transCode','/api/file/customImageFile','split','./routes/movieInfoApi','end','/api/musicApi','/api/uploadApi','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','join','10.','2639718pZjGes','getI18n','/api/file/zipFile/','refreshIpList','./routes/fileApi','returnErrMsg','token','./routes/usersApi','936051ysRodn','127.0.0.1','/api/ordinaryAlbumApi','./routes/file','toString','log','appRootPath','compression','/api/addGpsApi','isTempShare','prepare','/api/healthCheck','currentUser','./routes/sourceFolderApi','findByTitle','token_ip','path','use','./routes/photoApi','./utils/encryptUtil','/api/privateSpaceApi','/api/photoApi','getClientIp','dbFileIndex','language','dbOther','message','/api/backupApi','app','./routes/addGpsApi','404','100gb','/api/commonApi','security.ipNotInAllowList','/api/usersApi/checkIsNasServer','body-parser','/api/usersApi/registAdmin','/api/commonApi/getLanguage','includes','getLocale','headers','from','getServerRootPath','ipDetection','cookie-parser'];_0x20e9=function(){return _0xdc575a;};return _0x20e9();}let fileRecordApi=require(_0x282741(0x8a));app[_0x282741(0xe1)](serverRootPath+_0x282741(0x76),fileRecordApi);let fileRouter=require(_0x282741(0xcc));app[_0x282741(0xe1)](serverRootPath+'/api/fileApi',fileRouter);let zipFileRouter=require(_0x282741(0xaa));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xbd),zipFileRouter),app[_0x282741(0xe1)](serverRootPath+_0x282741(0xf0),commonRouter);let usersRouter=require(_0x282741(0xcf));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xab),usersRouter);let sourceFolderRouter=require(_0x282741(0xdd));app['use'](serverRootPath+_0x282741(0x91),sourceFolderRouter);let ordinaryRouter=require(_0x282741(0xff));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xd2),ordinaryRouter);let photoRouter=require(_0x282741(0xe2));app['use'](serverRootPath+_0x282741(0xe5),photoRouter);let addGpsRouter=require(_0x282741(0xed));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xd8),addGpsRouter);let messageRouter=require('./routes/messageApi');app[_0x282741(0xe1)](serverRootPath+_0x282741(0xa1),messageRouter);let movieRouter=require(_0x282741(0x8b));app[_0x282741(0xe1)](serverRootPath+_0x282741(0x9d),movieRouter);let movieInfoRouter=require(_0x282741(0xc1));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xa7),movieInfoRouter);let musicRouter=require(_0x282741(0x82));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xc3),musicRouter);let bookRouter=require(_0x282741(0xa2));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xa4),bookRouter);let backupRouter=require(_0x282741(0xb1));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xeb),backupRouter);function _0x55f4(_0x21dde,_0x17399a){const _0x20e97f=_0x20e9();return _0x55f4=function(_0x55f410,_0x2fb8f3){_0x55f410=_0x55f410-0x76;let _0x2605dd=_0x20e97f[_0x55f410];return _0x2605dd;},_0x55f4(_0x21dde,_0x17399a);}let fileShareRouter=require(_0x282741(0xaf));app[_0x282741(0xe1)](serverRootPath+'/api/fileShareApi',fileShareRouter);let nasAccountRouter=require(_0x282741(0xa5));app['use'](serverRootPath+'/api/nasAccountApi',nasAccountRouter);let privateSpaceRouter=require('./routes/privateSpace');const {data}=require(_0x282741(0xbb));app[_0x282741(0xe1)](serverRootPath+_0x282741(0xe4),privateSpaceRouter),app[_0x282741(0xe1)](function(_0x17f8d2,_0x15b0d5,_0x3826d2){const _0x21a4f4=_0x282741;console[_0x21a4f4(0xd5)](_0x21a4f4(0xee),_0x17f8d2[_0x21a4f4(0xe0)]),_0x15b0d5[_0x21a4f4(0x92)](0x194)[_0x21a4f4(0xc2)]();}),app['use'](function(_0x7eb192,_0x1bd3c9,_0x20b8c9,_0x30f07e){const _0x2a9aac=_0x282741;_0x20b8c9[_0x2a9aac(0x97)][_0x2a9aac(0xea)]=_0x7eb192[_0x2a9aac(0xea)],console[_0x2a9aac(0xd5)](_0x7eb192),_0x20b8c9[_0x2a9aac(0x92)](_0x7eb192[_0x2a9aac(0x92)]||0x1f4)[_0x2a9aac(0xc2)]();}),module[_0x282741(0x7d)]=app;