const _0xfee37=_0x2c74;(function(_0x409f4e,_0x193229){const _0x5b0028=_0x2c74,_0x8d767b=_0x409f4e();while(!![]){try{const _0x2cb08c=parseInt(_0x5b0028(0x18f))/0x1*(parseInt(_0x5b0028(0x158))/0x2)+parseInt(_0x5b0028(0x174))/0x3*(-parseInt(_0x5b0028(0x125))/0x4)+parseInt(_0x5b0028(0x166))/0x5+-parseInt(_0x5b0028(0x133))/0x6+parseInt(_0x5b0028(0x15f))/0x7*(parseInt(_0x5b0028(0x118))/0x8)+-parseInt(_0x5b0028(0x134))/0x9+parseInt(_0x5b0028(0x169))/0xa;if(_0x2cb08c===_0x193229)break;else _0x8d767b['push'](_0x8d767b['shift']());}catch(_0x517d01){_0x8d767b['push'](_0x8d767b['shift']());}}}(_0x26fb,0x7174e));const commonRouter=require('./routes/commonApi'),express=require('express'),app=express(),expressWs=require(_0xfee37(0x159));expressWs(app);const path=require('path'),cookieParser=require(_0xfee37(0x197)),dbUtil=require(_0xfee37(0x11b)),dbu=new dbUtil(),netUtils=require(_0xfee37(0x148)),config=require(_0xfee37(0x149)),compression=require(_0xfee37(0x137)),dbUserTable=require(_0xfee37(0x122)),cors=require('cors'),encryptUtil=require('./utils/encryptUtil');let sha256=require(_0xfee37(0x14a));app[_0xfee37(0x140)](cors()),app[_0xfee37(0x140)](compression());let i18nUtil=require(_0xfee37(0x186)),i18n=i18nUtil[_0xfee37(0x188)](dbu['dbOther']);app[_0xfee37(0x140)](i18n[_0xfee37(0x11a)]),app['i18n']=i18n,app[_0xfee37(0x184)]=function(_0x287fb9,_0x3a2e2c,_0x499bdd){const _0x49df1e=_0xfee37;let _0x4f8857={'code':0x1,'message':_0x3a2e2c};_0x499bdd&&(_0x4f8857['alertType']=_0x499bdd);if(!_0x287fb9['headersSent'])return _0x287fb9[_0x49df1e(0x171)](_0x4f8857);},app['dbFileIndex']=dbu['dbFileIndex'],app[_0xfee37(0x13a)]=dbu[_0xfee37(0x13a)],app[_0xfee37(0x144)]=dbu[_0xfee37(0x144)];const dbConfigTable=require(_0xfee37(0x175)),dbLoginTable=require(_0xfee37(0x19a));let ipDetection=![];app[_0xfee37(0x14c)]=()=>{const _0x10a0b4=_0xfee37;let _0x2e659f=dbConfigTable[_0x10a0b4(0x130)](dbu[_0x10a0b4(0x13a)],'ipDetection');_0x2e659f&&(ipDetection=_0x2e659f['value']=='1');},app['refreshIpDetection']();let ipMode=_0xfee37(0x195),ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app[_0xfee37(0x198)]=()=>{const _0x13183d=_0xfee37;let _0x14caae=new Date()[_0x13183d(0x185)]();refreshIpTimestamp=_0x14caae;let _0x2da7f8=dbConfigTable[_0x13183d(0x130)](dbu[_0x13183d(0x13a)],_0x13183d(0x189));_0x2da7f8&&(ipMode=_0x2da7f8[_0x13183d(0x193)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x13183d(0x195)){let _0x3c87a0=dbLoginTable['getAllIpListByWhere'](dbu[_0x13183d(0x13a)],_0x13183d(0x145)+_0x14caae+')');for(let _0x806ba8 in _0x3c87a0){ipBlackList[_0x13183d(0x15b)](_0x3c87a0[_0x806ba8]['ip']);}}else{if(ipMode==_0x13183d(0x167)){let _0xe6db15=dbLoginTable['getAllIpListByWhere'](dbu[_0x13183d(0x13a)],_0x13183d(0x16d)+_0x14caae+')');for(let _0x331b0e in _0xe6db15){ipWhiteList['push'](_0xe6db15[_0x331b0e]['ip']);}}}},app[_0xfee37(0x198)]();let serverRootPath=dbConfigTable['getServerRootPath'](dbu[_0xfee37(0x13a)]);app[_0xfee37(0x140)](''+serverRootPath,express[_0xfee37(0x138)](path[_0xfee37(0x194)](config[_0xfee37(0x116)],_0xfee37(0x17d),'public'))),app[_0xfee37(0x140)](''+serverRootPath,express[_0xfee37(0x138)](path[_0xfee37(0x194)](config[_0xfee37(0x116)],'web',_0xfee37(0x162)))),app['use'](''+serverRootPath,express[_0xfee37(0x138)](path['join'](config['appRootPath'],_0xfee37(0x17d),'public_viewer'))),app['use'](''+serverRootPath,express[_0xfee37(0x138)](path[_0xfee37(0x194)](config[_0xfee37(0x116)],_0xfee37(0x17d),_0xfee37(0x183)))),app[_0xfee37(0x140)](''+serverRootPath,express[_0xfee37(0x138)](path[_0xfee37(0x194)](config[_0xfee37(0x116)],_0xfee37(0x17d),_0xfee37(0x157))));var bodyParser=require(_0xfee37(0x19c));app['use'](bodyParser[_0xfee37(0x171)]({'limit':_0xfee37(0x178)})),app[_0xfee37(0x140)](bodyParser[_0xfee37(0x19b)]({'limit':_0xfee37(0x178),'extended':!![]})),app[_0xfee37(0x140)](express['json']()),app[_0xfee37(0x140)](express['urlencoded']({'extended':![]})),app[_0xfee37(0x140)](cookieParser());const noCheckPathArr=[serverRootPath+'/api/usersApi/resetPwd',serverRootPath+'/api/usersApi/resetPwdInfo',serverRootPath+'/api/usersApi/hasAdmin',serverRootPath+_0xfee37(0x192),serverRootPath+'/api/file/getTempShareFiles',serverRootPath+_0xfee37(0x13c),serverRootPath+'/api/usersApi/login',serverRootPath+_0xfee37(0x150),serverRootPath+_0xfee37(0x155),serverRootPath+'/api/commonApi/getLanguage',serverRootPath+_0xfee37(0x15c)];let lastUpdateLastLoginTime={};app['use'](function(_0x5ac7d2,_0x14bb90,_0x18de31){const _0x423a26=_0xfee37;if(_0x5ac7d2[_0x423a26(0x17f)]==serverRootPath+_0x423a26(0x161))return _0x14bb90[_0x423a26(0x171)]({'code':0x0});let _0x3b6170=new Date()['getTime'](),_0x7d0f7a=netUtils[_0x423a26(0x142)](_0x5ac7d2);if(_0x7d0f7a!=_0x423a26(0x14f)&&_0x7d0f7a!=_0x423a26(0x127)){_0x3b6170-refreshIpGap>refreshIpTimestamp&&app['refreshIpList']();if(ipMode=='black'){if(ipBlackList[_0x423a26(0x176)](_0x7d0f7a))return app[_0x423a26(0x184)](_0x14bb90,_0x14bb90['__'](_0x423a26(0x11d))+_0x14bb90['__'](_0x423a26(0x12b)));}else{if(ipMode==_0x423a26(0x167)){if(!ipWhiteList[_0x423a26(0x176)](_0x7d0f7a))return app[_0x423a26(0x184)](_0x14bb90,_0x14bb90['__'](_0x423a26(0x11d))+_0x14bb90['__'](_0x423a26(0x12b)));}}}encryptUtil[_0x423a26(0x18c)](_0x5ac7d2),_0x5ac7d2[_0x423a26(0x141)](i18n[_0x423a26(0x16b)]()),_0x14bb90[_0x423a26(0x117)]['language']=i18n[_0x423a26(0x16b)]();let _0x141e03=_0x5ac7d2[_0x423a26(0x18d)][_0x423a26(0x139)]||_0x5ac7d2[_0x423a26(0x18d)]['st'];if(_0x141e03&&(_0x5ac7d2[_0x423a26(0x17f)][_0x423a26(0x13b)](serverRootPath+_0x423a26(0x15e))||_0x5ac7d2['path'][_0x423a26(0x13b)](serverRootPath+_0x423a26(0x154))||_0x5ac7d2[_0x423a26(0x17f)][_0x423a26(0x13b)](serverRootPath+_0x423a26(0x16e))||_0x5ac7d2[_0x423a26(0x17f)][_0x423a26(0x13b)](serverRootPath+_0x423a26(0x190))))try{let _0x15eb21=_0x5ac7d2[_0x423a26(0x18d)][_0x423a26(0x191)]||_0x5ac7d2[_0x423a26(0x18d)]['sp'];_0x15eb21&&(_0x5ac7d2[_0x423a26(0x18d)]['sp']=Buffer[_0x423a26(0x170)](_0x15eb21,_0x423a26(0x18e))[_0x423a26(0x156)]());let _0x34040b=_0x5ac7d2[_0x423a26(0x13f)][_0x423a26(0x13a)][_0x423a26(0x199)](_0x423a26(0x16f))[_0x423a26(0x126)](_0x141e03,new Date()[_0x423a26(0x185)]());if(!_0x34040b)return _0x14bb90[_0x423a26(0x12a)](0x194)['end']();if(_0x34040b[_0x423a26(0x12f)]&&_0x34040b['password']!=_0x5ac7d2['query']['sp'])return _0x14bb90['status'](0x194)['end']();return _0x5ac7d2[_0x423a26(0x182)]=!![],_0x18de31();}catch(_0x1ea2a5){return _0x14bb90[_0x423a26(0x12a)](0x194)[_0x423a26(0x15d)]();}if(noCheckPathArr[_0x423a26(0x14e)](_0x5ac7d2[_0x423a26(0x17f)])==-0x1){let _0x1008ec=_0x5ac7d2[_0x423a26(0x17e)][_0x423a26(0x173)]||_0x5ac7d2[_0x423a26(0x18d)][_0x423a26(0x173)]||_0x5ac7d2[_0x423a26(0x124)][_0x423a26(0x173)];!_0x1008ec&&_0x5ac7d2[_0x423a26(0x17e)][_0x423a26(0x164)]&&(_0x1008ec=_0x5ac7d2['headers']['authorization'][_0x423a26(0x121)]('\x20')[0x1]);let _0x40c766=dbUserTable[_0x423a26(0x11f)](_0x5ac7d2[_0x423a26(0x13f)]['dbOther'],_0x1008ec),_0x3e17e1=!![];ipDetection&&_0x40c766&&_0x7d0f7a!=_0x40c766['token_ip']&&_0x7d0f7a!='localhost'&&!_0x7d0f7a[_0x423a26(0x13b)](_0x423a26(0x129))&&!_0x7d0f7a[_0x423a26(0x13b)]('10.')&&!_0x7d0f7a[_0x423a26(0x13b)](_0x423a26(0x16c))&&(_0x3e17e1=![]);if(!_0x40c766||!_0x3e17e1){if(serverRootPath&&_0x5ac7d2[_0x423a26(0x17f)][_0x423a26(0x13b)](_0x423a26(0x163)))return app[_0x423a26(0x184)](_0x14bb90,i18n['__'](_0x423a26(0x17b)));else{if(serverRootPath)return _0x14bb90[_0x423a26(0x171)]({'code':0x65,'message':i18n['__'](_0x423a26(0x17b))});}return _0x14bb90['json']({'code':0x65,'message':i18n['__'](_0x423a26(0x181))});}let _0x4e04ac=new Date()[_0x423a26(0x185)](),_0x10a91f=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x40c766['id']]||_0x4e04ac-lastUpdateLastLoginTime[_0x40c766['id']]>_0x10a91f)&&(dbUserTable[_0x423a26(0x11c)](_0x5ac7d2[_0x423a26(0x13f)][_0x423a26(0x13a)],_0x1008ec,_0x4e04ac),lastUpdateLastLoginTime[_0x40c766['id']]=_0x4e04ac),_0x5ac7d2[_0x423a26(0x143)]=_0x40c766,_0x18de31();}else _0x18de31();});let mapRouter=require(_0xfee37(0x115));app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x153),mapRouter);let uploadRouter=require(_0xfee37(0x18b));function _0x2c74(_0x3703d7,_0x20cee8){const _0x26fbd5=_0x26fb();return _0x2c74=function(_0x2c7480,_0x11836b){_0x2c7480=_0x2c7480-0x114;let _0x1c6017=_0x26fbd5[_0x2c7480];return _0x1c6017;},_0x2c74(_0x3703d7,_0x20cee8);}app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x187),uploadRouter);let transCodeRouter=require(_0xfee37(0x132));app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x123),transCodeRouter);let pathFileRouter=require(_0xfee37(0x128));app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x151),pathFileRouter);let fileRecordApi=require(_0xfee37(0x119));app['use'](serverRootPath+_0xfee37(0x17c),fileRecordApi);let fileRouter=require('./routes/fileApi');app['use'](serverRootPath+_0xfee37(0x180),fileRouter);let zipFileRouter=require(_0xfee37(0x12e));app[_0xfee37(0x140)](serverRootPath+'/api/zipFileApi',zipFileRouter),app['use'](serverRootPath+_0xfee37(0x165),commonRouter);let usersRouter=require(_0xfee37(0x15a));app[_0xfee37(0x140)](serverRootPath+'/api/usersApi',usersRouter);let sourceFolderRouter=require(_0xfee37(0x16a));app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x172),sourceFolderRouter);let ordinaryRouter=require(_0xfee37(0x177));app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x17a),ordinaryRouter);let photoRouter=require(_0xfee37(0x13e));app[_0xfee37(0x140)](serverRootPath+'/api/photoApi',photoRouter);let addGpsRouter=require(_0xfee37(0x18a));app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x131),addGpsRouter);let messageRouter=require(_0xfee37(0x168));app[_0xfee37(0x140)](serverRootPath+'/api/messageApi',messageRouter);let movieRouter=require('./routes/movieApi');app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x146),movieRouter);let movieInfoRouter=require(_0xfee37(0x14d));app[_0xfee37(0x140)](serverRootPath+'/api/movieInfoApi',movieInfoRouter);let musicRouter=require(_0xfee37(0x196));app[_0xfee37(0x140)](serverRootPath+'/api/musicApi',musicRouter);let bookRouter=require(_0xfee37(0x120));app['use'](serverRootPath+_0xfee37(0x12d),bookRouter);let backupRouter=require(_0xfee37(0x135));app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x114),backupRouter);function _0x26fb(){const _0x30b108=['getUserByToken','./routes/bookApi','split','../db/dbUserTable','/api/transCode','body','83432moopNb','get','127.0.0.1','./routes/file','192.','status','login.cannotLogin','exports','/api/bookApi','./routes/zipFileApi','password','findByTitle','/api/addGpsApi','./routes/transCodeApi','736278BaLYTq','4967028eSPohm','./routes/backupApi','@tensorflow/tfjs','compression','static','shareToken','dbOther','startsWith','/api/file/customImageFile','/api/nasAccountApi','./routes/photoApi','app','use','setLocale','getClientIp','currentUser','dbCity','\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','/api/movieApi','404','./utils/netUtils','../myConfig/config','sha256','./routes/nasAccountApi','refreshIpDetection','./routes/movieInfoApi','indexOf','localhost','/api/usersApi/tokenLogin','/api/file','log','/api/mapApi','/api/fileApi/rawFileByPath/','/api/usersApi/checkIsNasServer','toString','public_book','44GmvlZM','express-ws','./routes/usersApi','push','/api/commonApi/refreshHomePage','end','/api/fileApi/tinyImgByPath/','7IPkDWs','/api/fileShareApi','/api/healthCheck','public_pdf','/api','authorization','/api/commonApi','4098075yMRyiD','white','./routes/messageApi','545790jszKCj','./routes/sourceFolderApi','getLocale','172.','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','/api/file/rawFile/','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?','from','json','/api/sourceFolderApi','token','93uNDCzD','../db/dbConfigTable','includes','./routes/ordinaryAlbumApi','100gb','message','/api/ordinaryAlbumApi','needRootPath','/api/fileRecordApi','web','headers','path','/api/fileApi','TokenExpired','isTempShare','public_music','returnErrMsg','getTime','../utils/i18nUtil','/api/uploadApi','getI18n','ipMode','./routes/addGpsApi','./routes/uploadApi','decryptParams','query','base64','26993NUHuWv','/api/file/zipFile/','sharePwd','/api/usersApi/registAdmin','value','join','black','./routes/musicApi','cookie-parser','refreshIpList','prepare','../db/dbLoginTable','urlencoded','body-parser','/api/backupApi','./routes/mapApi','appRootPath','locals','2543048HZWTZJ','./routes/fileRecordApi','init','../db/dbUtil','updateLastLoginTimeByToken','security.ipNotInAllowList','./routes/privateSpace'];_0x26fb=function(){return _0x30b108;};return _0x26fb();}let fileShareRouter=require('./routes/fileShareApi');app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x160),fileShareRouter);let nasAccountRouter=require(_0xfee37(0x14b));app[_0xfee37(0x140)](serverRootPath+_0xfee37(0x13d),nasAccountRouter);let privateSpaceRouter=require(_0xfee37(0x11e));const {data}=require(_0xfee37(0x136));app['use'](serverRootPath+'/api/privateSpaceApi',privateSpaceRouter),app[_0xfee37(0x140)](function(_0x3f56e0,_0x1b2ae1,_0x40e63f){const _0x68d8ff=_0xfee37;console[_0x68d8ff(0x152)](_0x68d8ff(0x147),_0x3f56e0[_0x68d8ff(0x17f)]),_0x1b2ae1['status'](0x194)[_0x68d8ff(0x15d)]();}),app[_0xfee37(0x140)](function(_0x246127,_0xb764eb,_0xf95bfe,_0x406b5b){const _0x48d8b2=_0xfee37;_0xf95bfe['locals'][_0x48d8b2(0x179)]=_0x246127[_0x48d8b2(0x179)],console[_0x48d8b2(0x152)](_0x246127),_0xf95bfe[_0x48d8b2(0x12a)](_0x246127[_0x48d8b2(0x12a)]||0x1f4)[_0x48d8b2(0x15d)]();}),module[_0xfee37(0x12c)]=app;