const _0x1e457e=_0x1c89;(function(_0x12d184,_0x4f7a3e){const _0x484111=_0x1c89,_0xf350da=_0x12d184();while(!![]){try{const _0x2c2c7c=-parseInt(_0x484111(0x1bd))/0x1+-parseInt(_0x484111(0x15a))/0x2+parseInt(_0x484111(0x1d3))/0x3+-parseInt(_0x484111(0x14b))/0x4*(parseInt(_0x484111(0x197))/0x5)+parseInt(_0x484111(0x1cd))/0x6*(parseInt(_0x484111(0x1b5))/0x7)+parseInt(_0x484111(0x1b9))/0x8+-parseInt(_0x484111(0x1b7))/0x9*(-parseInt(_0x484111(0x18e))/0xa);if(_0x2c2c7c===_0x4f7a3e)break;else _0xf350da['push'](_0xf350da['shift']());}catch(_0x423c85){_0xf350da['push'](_0xf350da['shift']());}}}(_0x19d4,0x83a00));const commonRouter=require('./routes/commonApi'),express=require(_0x1e457e(0x155)),app=express(),expressWs=require('express-ws');expressWs(app);const path=require('path'),cookieParser=require(_0x1e457e(0x1b8)),dbUtil=require(_0x1e457e(0x183)),dbu=new dbUtil(),netUtils=require(_0x1e457e(0x1ce)),config=require(_0x1e457e(0x16e)),compression=require('compression'),dbUserTable=require(_0x1e457e(0x164)),cors=require(_0x1e457e(0x1a9)),encryptUtil=require(_0x1e457e(0x1a1));let sha256=require(_0x1e457e(0x194));app['use'](cors()),app[_0x1e457e(0x172)](compression());let i18nUtil=require('../utils/i18nUtil'),i18n=i18nUtil[_0x1e457e(0x16b)](dbu[_0x1e457e(0x156)]);app[_0x1e457e(0x172)](i18n[_0x1e457e(0x17d)]),app[_0x1e457e(0x1a4)]=i18n,app['returnErrMsg']=function(_0x55322b,_0xdd3975,_0x660fca){const _0x2593e1=_0x1e457e;let _0x3f2a58={'code':0x1,'message':_0xdd3975};_0x660fca&&(_0x3f2a58[_0x2593e1(0x18b)]=_0x660fca);if(!_0x55322b[_0x2593e1(0x182)])return _0x55322b[_0x2593e1(0x1d2)](_0x3f2a58);},app[_0x1e457e(0x192)]=dbu['dbFileIndex'],app[_0x1e457e(0x156)]=dbu[_0x1e457e(0x156)],app['dbCity']=dbu['dbCity'];const dbConfigTable=require('../db/dbConfigTable'),dbLoginTable=require(_0x1e457e(0x191));let ipDetection=![];app[_0x1e457e(0x180)]=()=>{const _0x549e55=_0x1e457e;let _0x20643e=dbConfigTable[_0x549e55(0x162)](dbu[_0x549e55(0x156)],_0x549e55(0x171));_0x20643e&&(ipDetection=_0x20643e[_0x549e55(0x1a6)]=='1');},app[_0x1e457e(0x180)]();let ipMode=_0x1e457e(0x17f),ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;function _0x19d4(){const _0x36eaf1=['/api/addGpsApi','/api/mapApi','message','1314SeuAwu','./utils/netUtils','/api/fileApi','getUserByToken','/api/commonApi/refreshHomePage','json','763062TIEtqB','status','./routes/privateSpace','static','public_pdf','/api/sourceFolderApi','currentUser','/api/file/getTempShareFiles','145832IEYvwS','returnErrMsg','exports','locals','/api/usersApi/login','404','10.','getServerRootPath','needRootPath','172.','express','dbOther','public_book','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','path','1311934ZPonnR','push','localhost','/api/fileApi/rawFileByPath/','authorization','/api/bookApi','./routes/fileRecordApi','./routes/addGpsApi','findByTitle','shareToken','../db/dbUserTable','join','/api/fileApi/tinyImgByPath/','from','./routes/bookApi','sharePwd','public','getI18n','/api/usersApi','127.0.0.1','../myConfig/config','./routes/uploadApi','decryptParams','ipDetection','use','./routes/messageApi','web','getClientIp','./routes/photoApi','/api','/api/uploadApi','headers','isTempShare','startsWith','./routes/ordinaryAlbumApi','init','@tensorflow/tfjs','black','refreshIpDetection','token','headersSent','../db/dbUtil','./routes/fileApi','./routes/backupApi','body-parser','security.ipNotInAllowList','/api/movieInfoApi','refreshIpList','toString','alertType','/api/fileShareApi','password','10ZDStUM','/api/file/zipFile/','/api/file','../db/dbLoginTable','dbFileIndex','get','sha256','base64','./routes/musicApi','125RHOECt','/api/privateSpaceApi','./routes/movieInfoApi','login.cannotLogin','/api/healthCheck','prepare','/api/commonApi/getLanguage','includes','token_ip','urlencoded','./utils/encryptUtil','/api/photoApi','192.','i18n','white','value','query','getLocale','cors','/api/usersApi/hasAdmin','end','/api/musicApi','appRootPath','/api/file/rawFile/','./routes/mapApi','setLocale','/api/nasAccountApi','./routes/movieApi','/api/usersApi/resetPwd','body','28889hngVym','/api/transCode','10312452wThFpY','cookie-parser','2860280boNUrd','app','./routes/sourceFolderApi','/api/zipFileApi','554977ecGucS','/api/movieApi','getTime','100gb','/api/backupApi','/api/usersApi/resetPwdInfo','./routes/zipFileApi','getAllIpListByWhere','./routes/usersApi','./routes/file','/api/ordinaryAlbumApi','/api/usersApi/registAdmin','/api/messageApi'];_0x19d4=function(){return _0x36eaf1;};return _0x19d4();}app[_0x1e457e(0x189)]=()=>{const _0x3e3a6d=_0x1e457e;let _0xbc02a=new Date()[_0x3e3a6d(0x1bf)]();refreshIpTimestamp=_0xbc02a;let _0x388f22=dbConfigTable[_0x3e3a6d(0x162)](dbu[_0x3e3a6d(0x156)],'ipMode');_0x388f22&&(ipMode=_0x388f22[_0x3e3a6d(0x1a6)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x3e3a6d(0x17f)){let _0x1a4683=dbLoginTable[_0x3e3a6d(0x1c4)](dbu['dbOther'],'\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>'+_0xbc02a+')');for(let _0x51e380 in _0x1a4683){ipBlackList[_0x3e3a6d(0x15b)](_0x1a4683[_0x51e380]['ip']);}}else{if(ipMode==_0x3e3a6d(0x1a5)){let _0x23a9f6=dbLoginTable['getAllIpListByWhere'](dbu[_0x3e3a6d(0x156)],_0x3e3a6d(0x158)+_0xbc02a+')');for(let _0x3c891e in _0x23a9f6){ipWhiteList[_0x3e3a6d(0x15b)](_0x23a9f6[_0x3c891e]['ip']);}}}},app['refreshIpList']();let serverRootPath=dbConfigTable[_0x1e457e(0x152)](dbu[_0x1e457e(0x156)]);app['use'](''+serverRootPath,express[_0x1e457e(0x1d6)](path[_0x1e457e(0x165)](config[_0x1e457e(0x1ad)],_0x1e457e(0x174),_0x1e457e(0x16a)))),app[_0x1e457e(0x172)](''+serverRootPath,express[_0x1e457e(0x1d6)](path['join'](config['appRootPath'],_0x1e457e(0x174),_0x1e457e(0x1d7)))),app[_0x1e457e(0x172)](''+serverRootPath,express[_0x1e457e(0x1d6)](path['join'](config[_0x1e457e(0x1ad)],_0x1e457e(0x174),'public_viewer'))),app[_0x1e457e(0x172)](''+serverRootPath,express[_0x1e457e(0x1d6)](path[_0x1e457e(0x165)](config[_0x1e457e(0x1ad)],_0x1e457e(0x174),'public_music'))),app[_0x1e457e(0x172)](''+serverRootPath,express[_0x1e457e(0x1d6)](path['join'](config[_0x1e457e(0x1ad)],_0x1e457e(0x174),_0x1e457e(0x157))));var bodyParser=require(_0x1e457e(0x186));app[_0x1e457e(0x172)](bodyParser[_0x1e457e(0x1d2)]({'limit':_0x1e457e(0x1c0)})),app[_0x1e457e(0x172)](bodyParser['urlencoded']({'limit':_0x1e457e(0x1c0),'extended':!![]})),app[_0x1e457e(0x172)](express['json']()),app[_0x1e457e(0x172)](express[_0x1e457e(0x1a0)]({'extended':![]})),app[_0x1e457e(0x172)](cookieParser());const noCheckPathArr=[serverRootPath+_0x1e457e(0x1b3),serverRootPath+_0x1e457e(0x1c2),serverRootPath+_0x1e457e(0x1aa),serverRootPath+_0x1e457e(0x1c8),serverRootPath+_0x1e457e(0x1da),serverRootPath+'/api/file/customImageFile',serverRootPath+_0x1e457e(0x14f),serverRootPath+'/api/usersApi/tokenLogin',serverRootPath+'/api/usersApi/checkIsNasServer',serverRootPath+_0x1e457e(0x19d),serverRootPath+_0x1e457e(0x1d1)];let lastUpdateLastLoginTime={};app[_0x1e457e(0x172)](function(_0x2c965f,_0x47c2e4,_0x1661a8){const _0x5950cb=_0x1e457e;if(_0x2c965f[_0x5950cb(0x159)]==serverRootPath+_0x5950cb(0x19b))return _0x47c2e4[_0x5950cb(0x1d2)]({'code':0x0});let _0x1246e3=new Date()['getTime'](),_0x152261=netUtils[_0x5950cb(0x175)](_0x2c965f);if(_0x152261!=_0x5950cb(0x15c)&&_0x152261!=_0x5950cb(0x16d)){_0x1246e3-refreshIpGap>refreshIpTimestamp&&app['refreshIpList']();if(ipMode==_0x5950cb(0x17f)){if(ipBlackList[_0x5950cb(0x19e)](_0x152261))return app['returnErrMsg'](_0x47c2e4,_0x47c2e4['__'](_0x5950cb(0x187))+_0x47c2e4['__'](_0x5950cb(0x19a)));}else{if(ipMode=='white'){if(!ipWhiteList[_0x5950cb(0x19e)](_0x152261))return app[_0x5950cb(0x14c)](_0x47c2e4,_0x47c2e4['__']('security.ipNotInAllowList')+_0x47c2e4['__'](_0x5950cb(0x19a)));}}}encryptUtil[_0x5950cb(0x170)](_0x2c965f),_0x2c965f[_0x5950cb(0x1b0)](i18n[_0x5950cb(0x1a8)]()),_0x47c2e4[_0x5950cb(0x14e)]['language']=i18n[_0x5950cb(0x1a8)]();let _0x52c1ef=_0x2c965f[_0x5950cb(0x1a7)][_0x5950cb(0x163)]||_0x2c965f[_0x5950cb(0x1a7)]['st'];if(_0x52c1ef&&(_0x2c965f['path'][_0x5950cb(0x17b)](serverRootPath+_0x5950cb(0x166))||_0x2c965f['path'][_0x5950cb(0x17b)](serverRootPath+_0x5950cb(0x15d))||_0x2c965f[_0x5950cb(0x159)]['startsWith'](serverRootPath+_0x5950cb(0x1ae))||_0x2c965f[_0x5950cb(0x159)][_0x5950cb(0x17b)](serverRootPath+_0x5950cb(0x18f))))try{let _0x419505=_0x2c965f[_0x5950cb(0x1a7)][_0x5950cb(0x169)]||_0x2c965f[_0x5950cb(0x1a7)]['sp'];_0x419505&&(_0x2c965f[_0x5950cb(0x1a7)]['sp']=Buffer[_0x5950cb(0x167)](_0x419505,_0x5950cb(0x195))[_0x5950cb(0x18a)]());let _0x25a6a0=_0x2c965f['app']['dbOther'][_0x5950cb(0x19c)]('SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?')[_0x5950cb(0x193)](_0x52c1ef,new Date()[_0x5950cb(0x1bf)]());if(!_0x25a6a0)return _0x47c2e4[_0x5950cb(0x1d4)](0x194)[_0x5950cb(0x1ab)]();if(_0x25a6a0[_0x5950cb(0x18d)]&&_0x25a6a0[_0x5950cb(0x18d)]!=_0x2c965f['query']['sp'])return _0x47c2e4[_0x5950cb(0x1d4)](0x194)[_0x5950cb(0x1ab)]();return _0x2c965f[_0x5950cb(0x17a)]=!![],_0x1661a8();}catch(_0x58a75f){return _0x47c2e4[_0x5950cb(0x1d4)](0x194)[_0x5950cb(0x1ab)]();}if(noCheckPathArr['indexOf'](_0x2c965f[_0x5950cb(0x159)])==-0x1){let _0x280a62=_0x2c965f['headers'][_0x5950cb(0x181)]||_0x2c965f[_0x5950cb(0x1a7)][_0x5950cb(0x181)]||_0x2c965f[_0x5950cb(0x1b4)]['token'];!_0x280a62&&_0x2c965f[_0x5950cb(0x179)][_0x5950cb(0x15e)]&&(_0x280a62=_0x2c965f['headers'][_0x5950cb(0x15e)]['split']('\x20')[0x1]);let _0x355215=dbUserTable[_0x5950cb(0x1d0)](_0x2c965f[_0x5950cb(0x1ba)][_0x5950cb(0x156)],_0x280a62),_0x1d9f3c=!![];ipDetection&&_0x355215&&_0x152261!=_0x355215[_0x5950cb(0x19f)]&&_0x152261!='localhost'&&!_0x152261[_0x5950cb(0x17b)](_0x5950cb(0x1a3))&&!_0x152261[_0x5950cb(0x17b)](_0x5950cb(0x151))&&!_0x152261[_0x5950cb(0x17b)](_0x5950cb(0x154))&&(_0x1d9f3c=![]);if(!_0x355215||!_0x1d9f3c){if(serverRootPath&&_0x2c965f['path'][_0x5950cb(0x17b)](_0x5950cb(0x177)))return app[_0x5950cb(0x14c)](_0x47c2e4,i18n['__'](_0x5950cb(0x153)));return _0x47c2e4[_0x5950cb(0x1d2)]({'code':0x65,'message':i18n['__']('TokenExpired')});}let _0x598d95=new Date()['getTime'](),_0x4bb5ed=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x355215['id']]||_0x598d95-lastUpdateLastLoginTime[_0x355215['id']]>_0x4bb5ed)&&(dbUserTable['updateLastLoginTimeByToken'](_0x2c965f[_0x5950cb(0x1ba)][_0x5950cb(0x156)],_0x280a62,_0x598d95),lastUpdateLastLoginTime[_0x355215['id']]=_0x598d95),_0x2c965f[_0x5950cb(0x1d9)]=_0x355215,_0x1661a8();}else _0x1661a8();});let mapRouter=require(_0x1e457e(0x1af));app['use'](serverRootPath+_0x1e457e(0x1cb),mapRouter);let uploadRouter=require(_0x1e457e(0x16f));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x178),uploadRouter);let transCodeRouter=require('./routes/transCodeApi');app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x1b6),transCodeRouter);let pathFileRouter=require(_0x1e457e(0x1c6));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x190),pathFileRouter);let fileRecordApi=require(_0x1e457e(0x160));app[_0x1e457e(0x172)](serverRootPath+'/api/fileRecordApi',fileRecordApi);let fileRouter=require(_0x1e457e(0x184));app['use'](serverRootPath+_0x1e457e(0x1cf),fileRouter);let zipFileRouter=require(_0x1e457e(0x1c3));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x1bc),zipFileRouter),app[_0x1e457e(0x172)](serverRootPath+'/api/commonApi',commonRouter);let usersRouter=require(_0x1e457e(0x1c5));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x16c),usersRouter);let sourceFolderRouter=require(_0x1e457e(0x1bb));app['use'](serverRootPath+_0x1e457e(0x1d8),sourceFolderRouter);let ordinaryRouter=require(_0x1e457e(0x17c));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x1c7),ordinaryRouter);let photoRouter=require(_0x1e457e(0x176));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x1a2),photoRouter);let addGpsRouter=require(_0x1e457e(0x161));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x1ca),addGpsRouter);let messageRouter=require(_0x1e457e(0x173));app['use'](serverRootPath+_0x1e457e(0x1c9),messageRouter);let movieRouter=require(_0x1e457e(0x1b2));app['use'](serverRootPath+_0x1e457e(0x1be),movieRouter);let movieInfoRouter=require(_0x1e457e(0x199));app['use'](serverRootPath+_0x1e457e(0x188),movieInfoRouter);function _0x1c89(_0x3b0e16,_0x363a23){const _0x19d464=_0x19d4();return _0x1c89=function(_0x1c89f5,_0x4114fe){_0x1c89f5=_0x1c89f5-0x14b;let _0x1fa387=_0x19d464[_0x1c89f5];return _0x1fa387;},_0x1c89(_0x3b0e16,_0x363a23);}let musicRouter=require(_0x1e457e(0x196));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x1ac),musicRouter);let bookRouter=require(_0x1e457e(0x168));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x15f),bookRouter);let backupRouter=require(_0x1e457e(0x185));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x1c1),backupRouter);let fileShareRouter=require('./routes/fileShareApi');app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x18c),fileShareRouter);let nasAccountRouter=require('./routes/nasAccountApi');app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x1b1),nasAccountRouter);let privateSpaceRouter=require(_0x1e457e(0x1d5));const {data}=require(_0x1e457e(0x17e));app[_0x1e457e(0x172)](serverRootPath+_0x1e457e(0x198),privateSpaceRouter),app['use'](function(_0x2e45fd,_0x176e65,_0x5e336a){const _0x47d157=_0x1e457e;console['log'](_0x47d157(0x150),_0x2e45fd['path']),_0x176e65[_0x47d157(0x1d4)](0x194)[_0x47d157(0x1ab)]();}),app['use'](function(_0x562390,_0x28db61,_0x3062f6,_0x287f10){const _0x152a87=_0x1e457e;_0x3062f6['locals'][_0x152a87(0x1cc)]=_0x562390[_0x152a87(0x1cc)],console['log'](_0x562390),_0x3062f6[_0x152a87(0x1d4)](_0x562390[_0x152a87(0x1d4)]||0x1f4)['end']();}),module[_0x1e457e(0x14d)]=app;