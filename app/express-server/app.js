const _0x4d8950=_0x3ff4;(function(_0x299eaa,_0x3896a0){const _0x20bea5=_0x3ff4,_0x1e6403=_0x299eaa();while(!![]){try{const _0x42b1fc=parseInt(_0x20bea5(0x1cd))/0x1+parseInt(_0x20bea5(0x21d))/0x2+parseInt(_0x20bea5(0x1fe))/0x3*(parseInt(_0x20bea5(0x1ee))/0x4)+-parseInt(_0x20bea5(0x1cb))/0x5+-parseInt(_0x20bea5(0x1ce))/0x6+parseInt(_0x20bea5(0x20d))/0x7*(-parseInt(_0x20bea5(0x19d))/0x8)+parseInt(_0x20bea5(0x1ad))/0x9;if(_0x42b1fc===_0x3896a0)break;else _0x1e6403['push'](_0x1e6403['shift']());}catch(_0x4ee65a){_0x1e6403['push'](_0x1e6403['shift']());}}}(_0xf4fc,0x54b14));const commonRouter=require('./routes/commonApi'),express=require('express'),app=express(),expressWs=require('express-ws');expressWs(app);const path=require(_0x4d8950(0x1b7)),cookieParser=require(_0x4d8950(0x1c6)),dbUtil=require(_0x4d8950(0x1c8)),dbu=new dbUtil(),netUtils=require(_0x4d8950(0x1b3)),config=require(_0x4d8950(0x1d1)),compression=require(_0x4d8950(0x1c7)),dbUserTable=require(_0x4d8950(0x1e0)),cors=require(_0x4d8950(0x1a5)),encryptUtil=require(_0x4d8950(0x1cc));let sha256=require(_0x4d8950(0x1df));app[_0x4d8950(0x215)](cors()),app['use'](compression());let i18nUtil=require('../utils/i18nUtil'),i18n=i18nUtil[_0x4d8950(0x1fb)](dbu[_0x4d8950(0x1c9)]);app[_0x4d8950(0x215)](i18n['init']),app[_0x4d8950(0x1d2)]=i18n,app[_0x4d8950(0x193)]=function(_0x469d4c,_0x5c8a88,_0x5d07b0){const _0x598396=_0x4d8950;let _0xdda690={'code':0x1,'message':_0x5c8a88};_0x5d07b0&&(_0xdda690[_0x598396(0x1fa)]=_0x5d07b0);if(!_0x469d4c[_0x598396(0x21b)])return _0x469d4c[_0x598396(0x196)](_0xdda690);},app['dbFileIndex']=dbu['dbFileIndex'],app['dbOther']=dbu[_0x4d8950(0x1c9)],app[_0x4d8950(0x203)]=dbu['dbCity'];const dbConfigTable=require(_0x4d8950(0x1e3)),dbLoginTable=require('../db/dbLoginTable');let ipDetection=![];app[_0x4d8950(0x1ab)]=()=>{const _0x322116=_0x4d8950;let _0xdfb411=dbConfigTable[_0x322116(0x1c5)](dbu[_0x322116(0x1c9)],_0x322116(0x1c0));_0xdfb411&&(ipDetection=_0xdfb411['value']=='1');},app[_0x4d8950(0x1ab)]();let ipMode='black',ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app['refreshIpList']=()=>{const _0x2b5c62=_0x4d8950;let _0x49cf8d=new Date()['getTime']();refreshIpTimestamp=_0x49cf8d;let _0x2549f7=dbConfigTable[_0x2b5c62(0x1c5)](dbu[_0x2b5c62(0x1c9)],_0x2b5c62(0x1bb));_0x2549f7&&(ipMode=_0x2549f7[_0x2b5c62(0x21c)]);ipBlackList=[],ipWhiteList=[];if(ipMode=='black'){let _0x281ce2=dbLoginTable[_0x2b5c62(0x1e6)](dbu['dbOther'],_0x2b5c62(0x1e5)+_0x49cf8d+')');for(let _0x20b6e6 in _0x281ce2){ipBlackList[_0x2b5c62(0x1be)](_0x281ce2[_0x20b6e6]['ip']);}}else{if(ipMode==_0x2b5c62(0x1a3)){let _0x308ee3=dbLoginTable[_0x2b5c62(0x1e6)](dbu['dbOther'],_0x2b5c62(0x19c)+_0x49cf8d+')');for(let _0x184a6a in _0x308ee3){ipWhiteList[_0x2b5c62(0x1be)](_0x308ee3[_0x184a6a]['ip']);}}}},app[_0x4d8950(0x1cf)]();let serverRootPath=dbConfigTable[_0x4d8950(0x1da)](dbu[_0x4d8950(0x1c9)]);app[_0x4d8950(0x215)](''+serverRootPath,express[_0x4d8950(0x20a)](path[_0x4d8950(0x204)](config[_0x4d8950(0x1db)],_0x4d8950(0x1bd),_0x4d8950(0x192)))),app[_0x4d8950(0x215)](''+serverRootPath,express[_0x4d8950(0x20a)](path['join'](config[_0x4d8950(0x1db)],'web',_0x4d8950(0x1d8)))),app[_0x4d8950(0x215)](''+serverRootPath,express['static'](path[_0x4d8950(0x204)](config[_0x4d8950(0x1db)],_0x4d8950(0x1bd),_0x4d8950(0x208)))),app['use'](''+serverRootPath,express[_0x4d8950(0x20a)](path[_0x4d8950(0x204)](config[_0x4d8950(0x1db)],_0x4d8950(0x1bd),'public_music'))),app[_0x4d8950(0x215)](''+serverRootPath,express[_0x4d8950(0x20a)](path['join'](config[_0x4d8950(0x1db)],_0x4d8950(0x1bd),_0x4d8950(0x200))));var bodyParser=require(_0x4d8950(0x1ac));app[_0x4d8950(0x215)](bodyParser[_0x4d8950(0x196)]({'limit':'100gb'})),app[_0x4d8950(0x215)](bodyParser['urlencoded']({'limit':'100gb','extended':!![]})),app[_0x4d8950(0x215)](express[_0x4d8950(0x196)]()),app[_0x4d8950(0x215)](express['urlencoded']({'extended':![]})),app['use'](cookieParser());const noCheckPathArr=[serverRootPath+_0x4d8950(0x198),serverRootPath+_0x4d8950(0x1c2),serverRootPath+_0x4d8950(0x1ca),serverRootPath+_0x4d8950(0x1a8),serverRootPath+_0x4d8950(0x1d3),serverRootPath+_0x4d8950(0x1ea),serverRootPath+_0x4d8950(0x1b0),serverRootPath+_0x4d8950(0x21e),serverRootPath+_0x4d8950(0x1e9),serverRootPath+_0x4d8950(0x1b5),serverRootPath+_0x4d8950(0x195)];let lastUpdateLastLoginTime={};app['use'](function(_0x1b19b5,_0x230c89,_0x4c40cc){const _0x457ede=_0x4d8950;if(_0x1b19b5[_0x457ede(0x1b7)]==serverRootPath+'/api/healthCheck')return _0x230c89[_0x457ede(0x196)]({'code':0x0});let _0x3bfe7f=new Date()[_0x457ede(0x1eb)](),_0x188e5f=netUtils[_0x457ede(0x1f1)](_0x1b19b5);if(_0x188e5f!=_0x457ede(0x1ae)&&_0x188e5f!=_0x457ede(0x1aa)){_0x3bfe7f-refreshIpGap>refreshIpTimestamp&&app[_0x457ede(0x1cf)]();if(ipMode=='black'){if(ipBlackList[_0x457ede(0x1f9)](_0x188e5f))return app[_0x457ede(0x193)](_0x230c89,_0x230c89['__'](_0x457ede(0x1b9))+_0x230c89['__'](_0x457ede(0x1d9)));}else{if(ipMode=='white'){if(!ipWhiteList['includes'](_0x188e5f))return app[_0x457ede(0x193)](_0x230c89,_0x230c89['__'](_0x457ede(0x1b9))+_0x230c89['__'](_0x457ede(0x1d9)));}}}encryptUtil[_0x457ede(0x1a6)](_0x1b19b5),_0x1b19b5['setLocale'](i18n[_0x457ede(0x213)]()),_0x230c89[_0x457ede(0x1f5)][_0x457ede(0x1f0)]=i18n[_0x457ede(0x213)]();let _0x365097=_0x1b19b5[_0x457ede(0x1dc)]['shareToken']||_0x1b19b5[_0x457ede(0x1dc)]['st'];if(_0x365097&&(_0x1b19b5[_0x457ede(0x1b7)][_0x457ede(0x1ff)](serverRootPath+'/api/fileApi/tinyImgByPath/')||_0x1b19b5[_0x457ede(0x1b7)]['startsWith'](serverRootPath+'/api/fileApi/rawFileByPath/')||_0x1b19b5['path'][_0x457ede(0x1ff)](serverRootPath+_0x457ede(0x21a))||_0x1b19b5['path'][_0x457ede(0x1ff)](serverRootPath+_0x457ede(0x1a1))))try{let _0x8448a=_0x1b19b5[_0x457ede(0x1dc)][_0x457ede(0x1fd)]||_0x1b19b5[_0x457ede(0x1dc)]['sp'];_0x8448a&&(_0x1b19b5[_0x457ede(0x1dc)]['sp']=Buffer[_0x457ede(0x217)](_0x8448a,_0x457ede(0x210))[_0x457ede(0x206)]());let _0x244d21=_0x1b19b5[_0x457ede(0x1d5)][_0x457ede(0x1c9)]['prepare'](_0x457ede(0x1f6))['get'](_0x365097,new Date()[_0x457ede(0x1eb)]());if(!_0x244d21)return _0x230c89[_0x457ede(0x197)](0x194)['end']();if(_0x244d21[_0x457ede(0x1f3)]&&_0x244d21[_0x457ede(0x1f3)]!=_0x1b19b5['query']['sp'])return _0x230c89[_0x457ede(0x197)](0x194)[_0x457ede(0x1c3)]();return _0x1b19b5[_0x457ede(0x1e2)]=!![],_0x4c40cc();}catch(_0x1024db){return _0x230c89[_0x457ede(0x197)](0x194)[_0x457ede(0x1c3)]();}if(noCheckPathArr[_0x457ede(0x214)](_0x1b19b5[_0x457ede(0x1b7)])==-0x1){let _0x2e67ff=_0x1b19b5[_0x457ede(0x1ef)][_0x457ede(0x1e4)]||_0x1b19b5[_0x457ede(0x1dc)]['token']||_0x1b19b5[_0x457ede(0x205)][_0x457ede(0x1e4)];!_0x2e67ff&&_0x1b19b5[_0x457ede(0x1ef)][_0x457ede(0x1f8)]&&(_0x2e67ff=_0x1b19b5[_0x457ede(0x1ef)][_0x457ede(0x1f8)][_0x457ede(0x218)]('\x20')[0x1]);let _0x38a30f=dbUserTable[_0x457ede(0x1d7)](_0x1b19b5[_0x457ede(0x1d5)][_0x457ede(0x1c9)],_0x2e67ff),_0x39e4de=!![];ipDetection&&_0x38a30f&&_0x188e5f!=_0x38a30f[_0x457ede(0x216)]&&_0x188e5f!=_0x457ede(0x1ae)&&!_0x188e5f['startsWith'](_0x457ede(0x1ec))&&!_0x188e5f[_0x457ede(0x1ff)](_0x457ede(0x1bc))&&!_0x188e5f[_0x457ede(0x1ff)](_0x457ede(0x1b1))&&(_0x39e4de=![]);if(!_0x38a30f||!_0x39e4de){if(serverRootPath&&_0x1b19b5[_0x457ede(0x1b7)][_0x457ede(0x1ff)](_0x457ede(0x202)))return app[_0x457ede(0x193)](_0x230c89,i18n['__']('needRootPath'));else{if(serverRootPath)return _0x230c89['json']({'code':0x65,'message':i18n['__'](_0x457ede(0x199))});}return _0x230c89[_0x457ede(0x196)]({'code':0x65,'message':i18n['__']('TokenExpired')});}let _0x53176a=new Date()[_0x457ede(0x1eb)](),_0x3bca86=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x38a30f['id']]||_0x53176a-lastUpdateLastLoginTime[_0x38a30f['id']]>_0x3bca86)&&(dbUserTable[_0x457ede(0x1e7)](_0x1b19b5['app'][_0x457ede(0x1c9)],_0x2e67ff,_0x53176a),lastUpdateLastLoginTime[_0x38a30f['id']]=_0x53176a),_0x1b19b5['currentUser']=_0x38a30f,_0x4c40cc();}else _0x4c40cc();});let mapRouter=require(_0x4d8950(0x1b8));app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1dd),mapRouter);let uploadRouter=require(_0x4d8950(0x20c));app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1a9),uploadRouter);let transCodeRouter=require(_0x4d8950(0x212));function _0x3ff4(_0xcc9cf3,_0x461817){const _0xf4fccf=_0xf4fc();return _0x3ff4=function(_0x3ff473,_0x5c8c53){_0x3ff473=_0x3ff473-0x192;let _0x10490c=_0xf4fccf[_0x3ff473];return _0x10490c;},_0x3ff4(_0xcc9cf3,_0x461817);}app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1a4),transCodeRouter);let pathFileRouter=require(_0x4d8950(0x1f7));app['use'](serverRootPath+_0x4d8950(0x19b),pathFileRouter);let fileRecordApi=require('./routes/fileRecordApi');app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x219),fileRecordApi);let fileRouter=require(_0x4d8950(0x1f2));app['use'](serverRootPath+_0x4d8950(0x20f),fileRouter);let zipFileRouter=require(_0x4d8950(0x1c4));app['use'](serverRootPath+_0x4d8950(0x1ed),zipFileRouter),app['use'](serverRootPath+'/api/commonApi',commonRouter);let usersRouter=require(_0x4d8950(0x1d4));app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1c1),usersRouter);let sourceFolderRouter=require(_0x4d8950(0x1d0));app[_0x4d8950(0x215)](serverRootPath+'/api/sourceFolderApi',sourceFolderRouter);let ordinaryRouter=require(_0x4d8950(0x194));app['use'](serverRootPath+_0x4d8950(0x19e),ordinaryRouter);let photoRouter=require(_0x4d8950(0x1b4));app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1e8),photoRouter);let addGpsRouter=require(_0x4d8950(0x20e));app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1de),addGpsRouter);let messageRouter=require(_0x4d8950(0x1b6));app[_0x4d8950(0x215)](serverRootPath+'/api/messageApi',messageRouter);let movieRouter=require('./routes/movieApi');app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x201),movieRouter);let movieInfoRouter=require(_0x4d8950(0x211));app['use'](serverRootPath+_0x4d8950(0x1d6),movieInfoRouter);let musicRouter=require(_0x4d8950(0x1a7));app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1f4),musicRouter);function _0xf4fc(){const _0x475de1=['decryptParams','./routes/musicApi','/api/usersApi/registAdmin','/api/uploadApi','127.0.0.1','refreshIpDetection','body-parser','2286819hrxcqo','localhost','log','/api/usersApi/login','172.','/api/mediaToolsApi','./utils/netUtils','./routes/photoApi','/api/commonApi/getLanguage','./routes/messageApi','path','./routes/mapApi','security.ipNotInAllowList','./routes/fileShareApi','ipMode','10.','web','push','./routes/privateSpace','ipDetection','/api/usersApi','/api/usersApi/resetPwdInfo','end','./routes/zipFileApi','findByTitle','cookie-parser','compression','../db/dbUtil','dbOther','/api/usersApi/hasAdmin','1593805DjZPKa','./utils/encryptUtil','57775ADXGGQ','2006166LulzHE','refreshIpList','./routes/sourceFolderApi','../myConfig/config','i18n','/api/file/getTempShareFiles','./routes/usersApi','app','/api/movieInfoApi','getUserByToken','public_pdf','login.cannotLogin','getServerRootPath','appRootPath','query','/api/mapApi','/api/addGpsApi','sha256','../db/dbUserTable','/api/bookApi','isTempShare','../db/dbConfigTable','token','\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','getAllIpListByWhere','updateLastLoginTimeByToken','/api/photoApi','/api/usersApi/checkIsNasServer','/api/file/customImageFile','getTime','192.','/api/zipFileApi','116IUqAaj','headers','language','getClientIp','./routes/fileApi','password','/api/musicApi','locals','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?','./routes/file','authorization','includes','alertType','getI18n','/api/privateSpaceApi','sharePwd','48579zFZWPu','startsWith','public_book','/api/movieApi','/api','dbCity','join','body','toString','exports','public_viewer','@tensorflow/tfjs','static','/api/backupApi','./routes/uploadApi','1835827oOEqzC','./routes/addGpsApi','/api/fileApi','base64','./routes/movieInfoApi','./routes/transCodeApi','getLocale','indexOf','use','token_ip','from','split','/api/fileRecordApi','/api/file/rawFile/','headersSent','value','961640SgXJxU','/api/usersApi/tokenLogin','public','returnErrMsg','./routes/ordinaryAlbumApi','/api/commonApi/refreshHomePage','json','status','/api/usersApi/resetPwd','needRootPath','/api/fileShareApi','/api/file','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','8vCEUYf','/api/ordinaryAlbumApi','message','./routes/nasAccountApi','/api/file/zipFile/','./routes/mediaToolsApi','white','/api/transCode','cors'];_0xf4fc=function(){return _0x475de1;};return _0xf4fc();}let bookRouter=require('./routes/bookApi');app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1e1),bookRouter);let backupRouter=require('./routes/backupApi');app['use'](serverRootPath+_0x4d8950(0x20b),backupRouter);let fileShareRouter=require(_0x4d8950(0x1ba));app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x19a),fileShareRouter);let nasAccountRouter=require(_0x4d8950(0x1a0));app[_0x4d8950(0x215)](serverRootPath+'/api/nasAccountApi',nasAccountRouter);let mediaToolsRouter=require(_0x4d8950(0x1a2));app[_0x4d8950(0x215)](serverRootPath+_0x4d8950(0x1b2),mediaToolsRouter);let privateSpaceRouter=require(_0x4d8950(0x1bf));const {data}=require(_0x4d8950(0x209));app['use'](serverRootPath+_0x4d8950(0x1fc),privateSpaceRouter),app[_0x4d8950(0x215)](function(_0x58e3c9,_0x430a61,_0x174187){const _0x153325=_0x4d8950;console[_0x153325(0x1af)]('404',_0x58e3c9['path']),_0x430a61[_0x153325(0x197)](0x194)[_0x153325(0x1c3)]();}),app[_0x4d8950(0x215)](function(_0x3a96d0,_0x139b1d,_0x394a35,_0x8af580){const _0x65c7e5=_0x4d8950;_0x394a35[_0x65c7e5(0x1f5)][_0x65c7e5(0x19f)]=_0x3a96d0[_0x65c7e5(0x19f)],console['log'](_0x3a96d0),_0x394a35[_0x65c7e5(0x197)](_0x3a96d0[_0x65c7e5(0x197)]||0x1f4)[_0x65c7e5(0x1c3)]();}),module[_0x4d8950(0x207)]=app;