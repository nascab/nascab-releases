const _0x440ddf=_0x7f98;(function(_0x54a7b2,_0x9125dc){const _0x36d4b9=_0x7f98,_0x56bd0c=_0x54a7b2();while(!![]){try{const _0x18f2cb=-parseInt(_0x36d4b9(0x204))/0x1*(-parseInt(_0x36d4b9(0x210))/0x2)+-parseInt(_0x36d4b9(0x1ea))/0x3+parseInt(_0x36d4b9(0x19c))/0x4+-parseInt(_0x36d4b9(0x20c))/0x5*(-parseInt(_0x36d4b9(0x197))/0x6)+parseInt(_0x36d4b9(0x19d))/0x7+parseInt(_0x36d4b9(0x1b3))/0x8+-parseInt(_0x36d4b9(0x20b))/0x9*(parseInt(_0x36d4b9(0x1c6))/0xa);if(_0x18f2cb===_0x9125dc)break;else _0x56bd0c['push'](_0x56bd0c['shift']());}catch(_0x5576b6){_0x56bd0c['push'](_0x56bd0c['shift']());}}}(_0x3617,0x56145));const commonRouter=require(_0x440ddf(0x1c1)),express=require(_0x440ddf(0x218)),app=express(),expressWs=require(_0x440ddf(0x21e));expressWs(app);const path=require(_0x440ddf(0x20a)),cookieParser=require('cookie-parser'),dbUtil=require(_0x440ddf(0x1d1)),dbu=new dbUtil(),netUtils=require(_0x440ddf(0x1ba)),config=require(_0x440ddf(0x1a4)),compression=require('compression'),dbUserTable=require(_0x440ddf(0x1f5)),cors=require('cors'),encryptUtil=require(_0x440ddf(0x1c8));let sha256=require('sha256');app[_0x440ddf(0x1df)](cors()),app['use'](compression());let i18nUtil=require(_0x440ddf(0x19a)),i18n=i18nUtil['getI18n'](dbu[_0x440ddf(0x1a6)]);app[_0x440ddf(0x1df)](i18n[_0x440ddf(0x1a3)]),app[_0x440ddf(0x1dd)]=i18n,app[_0x440ddf(0x1c3)]=function(_0xcc8ce7,_0x50855d,_0x2ceafe){const _0x39741c=_0x440ddf;let _0x515195={'code':0x1,'message':_0x50855d};_0x2ceafe&&(_0x515195[_0x39741c(0x220)]=_0x2ceafe);if(!_0xcc8ce7[_0x39741c(0x205)])return _0xcc8ce7[_0x39741c(0x19e)](_0x515195);},app[_0x440ddf(0x19b)]=dbu[_0x440ddf(0x19b)],app[_0x440ddf(0x1a6)]=dbu['dbOther'],app['dbCity']=dbu[_0x440ddf(0x1d6)];const dbConfigTable=require(_0x440ddf(0x1f9)),dbLoginTable=require(_0x440ddf(0x1fd));let ipDetection=![];app[_0x440ddf(0x1b1)]=()=>{const _0x12ee6d=_0x440ddf;let _0x3e5e6e=dbConfigTable[_0x12ee6d(0x1ee)](dbu[_0x12ee6d(0x1a6)],_0x12ee6d(0x207));_0x3e5e6e&&(ipDetection=_0x3e5e6e[_0x12ee6d(0x1cf)]=='1');},app[_0x440ddf(0x1b1)]();let ipMode=_0x440ddf(0x1d5),ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app[_0x440ddf(0x1a2)]=()=>{const _0x1677e5=_0x440ddf;let _0xea48b2=new Date()[_0x1677e5(0x195)]();refreshIpTimestamp=_0xea48b2;let _0x248382=dbConfigTable[_0x1677e5(0x1ee)](dbu[_0x1677e5(0x1a6)],_0x1677e5(0x1c5));_0x248382&&(ipMode=_0x248382[_0x1677e5(0x1cf)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x1677e5(0x1d5)){let _0x58c9a3=dbLoginTable[_0x1677e5(0x1c4)](dbu[_0x1677e5(0x1a6)],_0x1677e5(0x1e9)+_0xea48b2+')');for(let _0x3a01e2 in _0x58c9a3){ipBlackList[_0x1677e5(0x1d7)](_0x58c9a3[_0x3a01e2]['ip']);}}else{if(ipMode==_0x1677e5(0x1ff)){let _0x1d8645=dbLoginTable[_0x1677e5(0x1c4)](dbu['dbOther'],'\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>'+_0xea48b2+')');for(let _0xa14fba in _0x1d8645){ipWhiteList[_0x1677e5(0x1d7)](_0x1d8645[_0xa14fba]['ip']);}}}},app[_0x440ddf(0x1a2)]();let serverRootPath=dbConfigTable[_0x440ddf(0x1b2)](dbu[_0x440ddf(0x1a6)]);app[_0x440ddf(0x1df)](''+serverRootPath,express[_0x440ddf(0x1e8)](path[_0x440ddf(0x1a0)](config['appRootPath'],'web',_0x440ddf(0x219)))),app[_0x440ddf(0x1df)](''+serverRootPath,express['static'](path[_0x440ddf(0x1a0)](config[_0x440ddf(0x1b7)],_0x440ddf(0x20d),_0x440ddf(0x214)))),app['use'](''+serverRootPath,express[_0x440ddf(0x1e8)](path['join'](config['appRootPath'],_0x440ddf(0x20d),_0x440ddf(0x1cb)))),app[_0x440ddf(0x1df)](''+serverRootPath,express[_0x440ddf(0x1e8)](path[_0x440ddf(0x1a0)](config[_0x440ddf(0x1b7)],_0x440ddf(0x20d),'public_music'))),app[_0x440ddf(0x1df)](''+serverRootPath,express[_0x440ddf(0x1e8)](path['join'](config[_0x440ddf(0x1b7)],_0x440ddf(0x20d),_0x440ddf(0x1e1))));var bodyParser=require(_0x440ddf(0x1d0));app['use'](bodyParser['json']({'limit':_0x440ddf(0x21f)})),app[_0x440ddf(0x1df)](bodyParser[_0x440ddf(0x1f0)]({'limit':_0x440ddf(0x21f),'extended':!![]})),app[_0x440ddf(0x1df)](express[_0x440ddf(0x19e)]()),app['use'](express[_0x440ddf(0x1f0)]({'extended':![]})),app['use'](cookieParser());const noCheckPathArr=[serverRootPath+_0x440ddf(0x201),serverRootPath+'/api/usersApi/resetPwdInfo',serverRootPath+_0x440ddf(0x1fa),serverRootPath+_0x440ddf(0x21c),serverRootPath+_0x440ddf(0x1fe),serverRootPath+_0x440ddf(0x199),serverRootPath+_0x440ddf(0x1b4),serverRootPath+_0x440ddf(0x216),serverRootPath+_0x440ddf(0x198),serverRootPath+'/api/commonApi/getLanguage',serverRootPath+'/api/commonApi/refreshHomePage'];let lastUpdateLastLoginTime={};app[_0x440ddf(0x1df)](function(_0x540773,_0x5014eb,_0x1e7f7a){const _0x3df2b4=_0x440ddf;if(_0x540773[_0x3df2b4(0x20a)]==serverRootPath+'/api/healthCheck')return _0x5014eb[_0x3df2b4(0x19e)]({'code':0x0});let _0x4bcfe8=new Date()[_0x3df2b4(0x195)](),_0x142d0e=netUtils['getClientIp'](_0x540773);if(_0x142d0e!=_0x3df2b4(0x1ce)&&_0x142d0e!=_0x3df2b4(0x206)){_0x4bcfe8-refreshIpGap>refreshIpTimestamp&&app[_0x3df2b4(0x1a2)]();if(ipMode==_0x3df2b4(0x1d5)){if(ipBlackList[_0x3df2b4(0x1b5)](_0x142d0e))return app[_0x3df2b4(0x1c3)](_0x5014eb,_0x5014eb['__'](_0x3df2b4(0x203))+_0x5014eb['__'](_0x3df2b4(0x1c0)));}else{if(ipMode=='white'){if(!ipWhiteList['includes'](_0x142d0e))return app['returnErrMsg'](_0x5014eb,_0x5014eb['__'](_0x3df2b4(0x203))+_0x5014eb['__']('login.cannotLogin'));}}}encryptUtil[_0x3df2b4(0x212)](_0x540773),_0x540773[_0x3df2b4(0x1d2)](i18n[_0x3df2b4(0x1bf)]()),_0x5014eb[_0x3df2b4(0x1e0)][_0x3df2b4(0x1b0)]=i18n[_0x3df2b4(0x1bf)]();let _0x5956fb=_0x540773['query'][_0x3df2b4(0x19f)]||_0x540773[_0x3df2b4(0x1f7)]['st'];if(_0x5956fb&&(_0x540773[_0x3df2b4(0x20a)][_0x3df2b4(0x1ad)](serverRootPath+'/api/fileApi/tinyImgByPath/')||_0x540773[_0x3df2b4(0x20a)][_0x3df2b4(0x1ad)](serverRootPath+_0x3df2b4(0x1ae))||_0x540773[_0x3df2b4(0x20a)][_0x3df2b4(0x1ad)](serverRootPath+_0x3df2b4(0x1e7))||_0x540773[_0x3df2b4(0x20a)][_0x3df2b4(0x1ad)](serverRootPath+_0x3df2b4(0x209))))try{let _0x41d0f6=_0x540773[_0x3df2b4(0x1f7)][_0x3df2b4(0x1ac)]||_0x540773[_0x3df2b4(0x1f7)]['sp'];_0x41d0f6&&(_0x540773['query']['sp']=Buffer[_0x3df2b4(0x1af)](_0x41d0f6,'base64')['toString']());let _0x588033=_0x540773['app'][_0x3df2b4(0x1a6)][_0x3df2b4(0x1ab)]('SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?')[_0x3df2b4(0x1bc)](_0x5956fb,new Date()[_0x3df2b4(0x195)]());if(!_0x588033)return _0x5014eb[_0x3df2b4(0x1c2)](0x194)[_0x3df2b4(0x1fb)]();if(_0x588033[_0x3df2b4(0x1eb)]&&_0x588033[_0x3df2b4(0x1eb)]!=_0x540773['query']['sp'])return _0x5014eb['status'](0x194)[_0x3df2b4(0x1fb)]();return _0x540773[_0x3df2b4(0x1b8)]=!![],_0x1e7f7a();}catch(_0x55293b){return _0x5014eb['status'](0x194)[_0x3df2b4(0x1fb)]();}if(noCheckPathArr['indexOf'](_0x540773[_0x3df2b4(0x20a)])==-0x1){let _0x58fa7c=_0x540773['headers'][_0x3df2b4(0x21b)]||_0x540773[_0x3df2b4(0x1f7)][_0x3df2b4(0x21b)]||_0x540773[_0x3df2b4(0x211)][_0x3df2b4(0x21b)];!_0x58fa7c&&_0x540773['headers'][_0x3df2b4(0x1d4)]&&(_0x58fa7c=_0x540773[_0x3df2b4(0x21d)][_0x3df2b4(0x1d4)]['split']('\x20')[0x1]);let _0x56a9ba=dbUserTable['getUserByToken'](_0x540773[_0x3df2b4(0x1a8)]['dbOther'],_0x58fa7c),_0x4f75e=!![];ipDetection&&_0x56a9ba&&_0x142d0e!=_0x56a9ba['token_ip']&&_0x142d0e!=_0x3df2b4(0x1ce)&&!_0x142d0e[_0x3df2b4(0x1ad)](_0x3df2b4(0x1e5))&&!_0x142d0e[_0x3df2b4(0x1ad)](_0x3df2b4(0x1db))&&!_0x142d0e[_0x3df2b4(0x1ad)]('172.')&&(_0x4f75e=![]);if(!_0x56a9ba||!_0x4f75e){if(serverRootPath&&_0x540773[_0x3df2b4(0x20a)][_0x3df2b4(0x1ad)](_0x3df2b4(0x1bb)))return app['returnErrMsg'](_0x5014eb,i18n['__'](_0x3df2b4(0x1aa)));else{if(serverRootPath)return _0x5014eb[_0x3df2b4(0x19e)]({'code':0x65,'message':i18n['__']('needRootPath')});}return _0x5014eb[_0x3df2b4(0x19e)]({'code':0x65,'message':i18n['__'](_0x3df2b4(0x1ed))});}let _0x2e1c40=new Date()[_0x3df2b4(0x195)](),_0x1c91f9=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x56a9ba['id']]||_0x2e1c40-lastUpdateLastLoginTime[_0x56a9ba['id']]>_0x1c91f9)&&(dbUserTable[_0x3df2b4(0x217)](_0x540773[_0x3df2b4(0x1a8)]['dbOther'],_0x58fa7c,_0x2e1c40),lastUpdateLastLoginTime[_0x56a9ba['id']]=_0x2e1c40),_0x540773[_0x3df2b4(0x202)]=_0x56a9ba,_0x1e7f7a();}else _0x1e7f7a();});let mapRouter=require(_0x440ddf(0x1a5));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x21a),mapRouter);let uploadRouter=require(_0x440ddf(0x1a7));function _0x3617(){const _0x954fd6=['join','/api/addGpsApi','refreshIpList','init','../myConfig/config','./routes/mapApi','dbOther','./routes/uploadApi','app','./routes/backupApi','needRootPath','prepare','sharePwd','startsWith','/api/fileApi/rawFileByPath/','from','language','refreshIpDetection','getServerRootPath','692680eWYwEX','/api/usersApi/login','includes','./routes/messageApi','appRootPath','isTempShare','./routes/fileApi','./utils/netUtils','/api','get','/api/file','./routes/musicApi','getLocale','login.cannotLogin','./routes/commonApi','status','returnErrMsg','getAllIpListByWhere','ipMode','101400uSOJzR','/api/photoApi','./utils/encryptUtil','./routes/usersApi','./routes/ordinaryAlbumApi','public_viewer','/api/privateSpaceApi','log','localhost','value','body-parser','../db/dbUtil','setLocale','/api/musicApi','authorization','black','dbCity','push','./routes/fileShareApi','./routes/mediaToolsApi','/api/transCode','10.','./routes/photoApi','i18n','/api/commonApi','use','locals','public_book','404','/api/zipFileApi','./routes/bookApi','192.','/api/nasAccountApi','/api/file/rawFile/','static','\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','154227JIJPaE','password','/api/fileApi','TokenExpired','findByTitle','/api/mediaToolsApi','urlencoded','./routes/zipFileApi','/api/uploadApi','@tensorflow/tfjs','/api/usersApi','../db/dbUserTable','./routes/sourceFolderApi','query','./routes/fileRecordApi','../db/dbConfigTable','/api/usersApi/hasAdmin','end','/api/fileShareApi','../db/dbLoginTable','/api/file/getTempShareFiles','white','./routes/addGpsApi','/api/usersApi/resetPwd','currentUser','security.ipNotInAllowList','22EeGQxU','headersSent','127.0.0.1','ipDetection','message','/api/file/zipFile/','path','729DpfTPC','829225GPSYPF','web','/api/sourceFolderApi','./routes/nasAccountApi','55346SRHwXg','body','decryptParams','exports','public_pdf','./routes/movieInfoApi','/api/usersApi/tokenLogin','updateLastLoginTimeByToken','express','public','/api/mapApi','token','/api/usersApi/registAdmin','headers','express-ws','100gb','alertType','getTime','./routes/transCodeApi','6zDULqt','/api/usersApi/checkIsNasServer','/api/file/customImageFile','../utils/i18nUtil','dbFileIndex','461440nbPHzO','1741138aQRpDI','json','shareToken'];_0x3617=function(){return _0x954fd6;};return _0x3617();}app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1f2),uploadRouter);let transCodeRouter=require(_0x440ddf(0x196));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1da),transCodeRouter);let pathFileRouter=require('./routes/file');app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1bd),pathFileRouter);let fileRecordApi=require(_0x440ddf(0x1f8));app[_0x440ddf(0x1df)](serverRootPath+'/api/fileRecordApi',fileRecordApi);let fileRouter=require(_0x440ddf(0x1b9));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1ec),fileRouter);let zipFileRouter=require(_0x440ddf(0x1f1));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1e3),zipFileRouter),app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1de),commonRouter);let usersRouter=require(_0x440ddf(0x1c9));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1f4),usersRouter);let sourceFolderRouter=require(_0x440ddf(0x1f6));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x20e),sourceFolderRouter);let ordinaryRouter=require(_0x440ddf(0x1ca));app[_0x440ddf(0x1df)](serverRootPath+'/api/ordinaryAlbumApi',ordinaryRouter);let photoRouter=require(_0x440ddf(0x1dc));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1c7),photoRouter);let addGpsRouter=require(_0x440ddf(0x200));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1a1),addGpsRouter);let messageRouter=require(_0x440ddf(0x1b6));app[_0x440ddf(0x1df)](serverRootPath+'/api/messageApi',messageRouter);let movieRouter=require('./routes/movieApi');app[_0x440ddf(0x1df)](serverRootPath+'/api/movieApi',movieRouter);let movieInfoRouter=require(_0x440ddf(0x215));app['use'](serverRootPath+'/api/movieInfoApi',movieInfoRouter);let musicRouter=require(_0x440ddf(0x1be));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1d3),musicRouter);let bookRouter=require(_0x440ddf(0x1e4));app['use'](serverRootPath+'/api/bookApi',bookRouter);let backupRouter=require(_0x440ddf(0x1a9));app[_0x440ddf(0x1df)](serverRootPath+'/api/backupApi',backupRouter);let fileShareRouter=require(_0x440ddf(0x1d8));app['use'](serverRootPath+_0x440ddf(0x1fc),fileShareRouter);let nasAccountRouter=require(_0x440ddf(0x20f));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1e6),nasAccountRouter);let mediaToolsRouter=require(_0x440ddf(0x1d9));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1ef),mediaToolsRouter);function _0x7f98(_0x330905,_0x48f592){const _0x3617c8=_0x3617();return _0x7f98=function(_0x7f98ee,_0x508e66){_0x7f98ee=_0x7f98ee-0x195;let _0x3c478c=_0x3617c8[_0x7f98ee];return _0x3c478c;},_0x7f98(_0x330905,_0x48f592);}let privateSpaceRouter=require('./routes/privateSpace');const {data}=require(_0x440ddf(0x1f3));app[_0x440ddf(0x1df)](serverRootPath+_0x440ddf(0x1cc),privateSpaceRouter),app['use'](function(_0x59aabe,_0x2057d4,_0x242fc5){const _0x57dd05=_0x440ddf;console[_0x57dd05(0x1cd)](_0x57dd05(0x1e2),_0x59aabe['path']),_0x2057d4[_0x57dd05(0x1c2)](0x194)[_0x57dd05(0x1fb)]();}),app[_0x440ddf(0x1df)](function(_0x2c4db3,_0x1c533b,_0x222732,_0x1ae5b8){const _0x3f5905=_0x440ddf;_0x222732['locals'][_0x3f5905(0x208)]=_0x2c4db3[_0x3f5905(0x208)],console[_0x3f5905(0x1cd)](_0x2c4db3),_0x222732['status'](_0x2c4db3[_0x3f5905(0x1c2)]||0x1f4)[_0x3f5905(0x1fb)]();}),module[_0x440ddf(0x213)]=app;