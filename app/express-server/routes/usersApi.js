const _0x4ff678=_0x1abd;(function(_0x2cdbde,_0x298d8e){const _0x52121d=_0x1abd,_0x59695b=_0x2cdbde();while(!![]){try{const _0x266eec=-parseInt(_0x52121d(0x1a7))/0x1+-parseInt(_0x52121d(0x149))/0x2+parseInt(_0x52121d(0x181))/0x3+-parseInt(_0x52121d(0x138))/0x4*(-parseInt(_0x52121d(0x175))/0x5)+-parseInt(_0x52121d(0x166))/0x6+parseInt(_0x52121d(0x14f))/0x7+parseInt(_0x52121d(0x152))/0x8;if(_0x266eec===_0x298d8e)break;else _0x59695b['push'](_0x59695b['shift']());}catch(_0xebb1b){_0x59695b['push'](_0x59695b['shift']());}}}(_0x58ae,0xdc5dc));let sha256=require('sha256'),express=require(_0x4ff678(0x124)),router=express['Router'](),cryptoUtils=require(_0x4ff678(0x1bd)),netUtils=require(_0x4ff678(0xf7)),config=require(_0x4ff678(0x1ac)),pathUtil=require('path'),checkUtil=require(_0x4ff678(0x1bb));var package=require(_0x4ff678(0x126));function _0x58ae(){const _0x4eaf4f=['/getIpList','../utils/checkUtil','asc','../utils/cryptoUtils','fileShareRestart','currentUser','updateRemarkByUsername','dialog','../utils/fileUtils','deleteByUid','login.pwdErrCountTooMuch','getAllIpListByWhere','getTime','DELETE\x20FROM\x20photo_faces2index','getIpListCountByWhere','DELETE\x20FROM\x20album','\x20id\x20in(SELECT\x20id\x20FROM\x20login_record\x20ORDER\x20BY\x20id\x20LIMIT\x20','log','path','../../myConfig/urlConfig','isIncludeChinese','security.thisIpCannotAddList','banTimeStamp','catch','exist','DELETE\x20FROM\x20music_playlist','DELETE\x20FROM\x20album_ordinary','getAdmin','returnErrMsg','/removeIp','../../db/dbMediaTools','../../db/dbUserTable','/setUserMenu','Error','httpsIsRunning','../../db/dbMovieFavorite','DELETE\x20FROM\x20music_playlist_index','customLogoImage','sep','../utils/netUtils','err','username\x20error','passwordKey','ipList','server_type','/setUserPower','SELECT\x20id,username,is_admin,user_remark\x20FROM\x20user\x20','orderType','startsWith','^[0-9a-zA-Z]*$','testCount','DELETE\x20FROM\x20source_folder','DELETE\x20FROM\x20file_operation_record','DELETE\x20FROM\x20book_favorite','ipv6','cancelUserPathPower','value','deleteIp','password','DELETE\x20FROM\x20book_read_record','is_admin','usernameReg','DELETE\x20FROM\x20file_share','banTime','../../db/dbConfigTable','apiPort','username','/changeQuestion','question','encryptString','DELETE\x20FROM\x20file_share_user','newPassword','remark','DELETE\x20FROM\x20ai_classes','DELETE\x20FROM\x20bg_task','status','DELETE\x20FROM\x20movie_collection','/changePassword','DELETE\x20FROM\x20movie_library','send','client','menus','get','publicUserName','express','deleteRecordByWhere','../../../package.json','findByTitleParamsList','globalIpList','DELETE\x20FROM\x20music_favorite','login.loginFailAlert','ipBan','deleteIpByWhere','stringify','body','getUserByUserName','region','updateById','\x20WHERE\x20username\x20like\x20?\x20or\x20user_remark\x20like\x20?','customHomeBgImage','changePassword','/getUserPower','login','findByTitle','8xoUSxt','login.oldPwdErr','delete','\x20WHERE\x20token\x20=?','/getRecordList','params\x20error','../../db/dbNoticeCenterTable','createUserFolder','/cancelUserPathPower','getAllRecordByWhere','You\x20can\x27t\x20delete\x20admin\x20account','deleteFavoriteByUid','DELETE\x20FROM\x20login_record','splice','run','/addUser','/logout','1130668mXuNbJ','DELETE\x20FROM\x20play_record','updateByUsername','/tokenLogin','TokenExpired','find','8206492zrmpVn','getUserPower','twoStepLogin','456312Tolslw','headers','push','DELETE\x20FROM\x20share_temp','deletePowerByUsername','json','need\x20username/menuList','DELETE\x20FROM\x20file_index_movie','DELETE\x20FROM\x20file_index_music','getUrlByUrlKey','/resetSystem','SELECT\x20*\x20FROM\x20user\x20WHERE\x20username=?','error','all','parse','login.adminAdded','then','answerNotSeqNumOrChar','\x20type=?','DELETE\x20FROM\x20movie_keys','7249542pdlRTv','updateQuestionById','login.sameUsernameExist','userNotExist','/login','hostname','\x201=1','localhost','\x20order\x20by\x20id\x20desc\x20limit\x20','black','cacheParentPath','getUserByToken','version','deleteUserTokenByWhere','newUserParamsNull','2337355EsPSAh','dbOther','post','language','DELETE\x20FROM\x20book_list','getClientIp','desc','DELETE\x20FROM\x20file_index_photo','addIpToList','create','join','customLoginImage','2711508RprxOP','createOrUpdatePower','token','test','\x20type=\x27','findByUsername','DELETE\x20FROM\x20file_record','dbFileIndex','pageSize','/checkIsNasServer','app','orderField','getRecordCountByWhere','127.0.0.1','user-agent','DELETE\x20FROM\x20photo_faces','WebDav','/registAdmin','login.answerIsWrong','isSameStr','login.adminExist','apiPortHttps','ceil','answer','operationFail','prepare','add','refreshIpList','pageUrl_agreement','\x20order\x20by\x20id\x20desc\x20limit\x20?\x20offset\x20?','/getAllUser','path.parentPathExist','DELETE\x20FROM\x20album_ordinary_index','DELETE\x20FROM\x20backup_task_msg','length','createToken','checkAnswer','isAdmin','391962pUWalG','pwdCannotBeChinese','end','user_remark','/removeUser','../../myConfig/config','changes','ddnsIpv6Address','type','\x20end_timestamp\x20is\x20not\x20null\x20and\x20end_timestamp<','NodeNasServer','answerQuestionCannotBeSame','DELETE\x20FROM\x20private_space_token','page','count','login.wrongNameOrPwd','/resetPwdInfo','query','includes'];_0x58ae=function(){return _0x4eaf4f;};return _0x58ae();}const OS=require('os'),urlConfig=require(_0x4ff678(0xe3)),dbUserTable=require(_0x4ff678(0xef)),dbLoginTable=require('../../db/dbLoginTable'),dbConfigTable=require(_0x4ff678(0x110)),dbNoticeCenterTable=require(_0x4ff678(0x13e)),dbMusicIndexTable=require('../../db/dbMusicIndexTable'),fileUtil=require(_0x4ff678(0x1c2)),fs=require('fs'),path=require(_0x4ff678(0xe2)),dbMovieFavorite=require(_0x4ff678(0xf3)),dbMusicFavorite=require('../../db/dbMusicFavorite'),dbMediaTools=require(_0x4ff678(0xee));router[_0x4ff678(0x177)]('/hasAdmin',(_0x439460,_0x3f790b,_0x3aa0e2)=>{const _0x470a29=_0x4ff678;let _0x839d9b=dbUserTable[_0x470a29(0xeb)](_0x439460[_0x470a29(0x18b)]['dbOther']),_0x4717bf=dbConfigTable[_0x470a29(0x127)](_0x439460['app'][_0x470a29(0x176)],[_0x470a29(0xf5),'customLoginTitle',_0x470a29(0x180),_0x470a29(0x133)]);_0x3f790b['json']({'code':0x0,'hasAdmin':_0x839d9b?'1':'0','customConfig':_0x4717bf,'pagePrivacyUrl':urlConfig[_0x470a29(0x15b)](_0x439460[_0x470a29(0x18b)][_0x470a29(0x176)],'pageUrl_privacy'),'pageAgreementUrl':urlConfig[_0x470a29(0x15b)](_0x439460[_0x470a29(0x18b)][_0x470a29(0x176)],_0x470a29(0x19d))});});let banIpList=[];function getIpBanConfig(_0x3a66d1,_0x1f92b2){const _0x418b23=_0x4ff678;let _0x2ce2be=![],_0xa43131=0x1,_0x4221b0=0x1;if(_0x1f92b2!=_0x418b23(0x16d)){let _0x44b556=dbConfigTable[_0x418b23(0x137)](_0x3a66d1[_0x418b23(0x18b)][_0x418b23(0x176)],_0x418b23(0x12b));_0x44b556&&(_0x44b556=JSON['parse'](_0x44b556[_0x418b23(0x108)]),_0x44b556&&(_0x44b556['enable']&&(_0x2ce2be=!![]),_0xa43131=_0x44b556[_0x418b23(0x102)],_0x4221b0=_0x44b556[_0x418b23(0x10f)]));}return{'enableBan':_0x2ce2be,'maxTestCount':_0xa43131,'banTimeMin':_0x4221b0};}function addBanIp(_0x56742c,_0x234bd3,_0x25d601){const _0x288c0f=_0x4ff678;let {enableBan:_0x4d65ed,maxTestCount:_0x31413f,banTimeMin:_0x2bc925}=getIpBanConfig(_0x56742c,_0x25d601);if(_0x4d65ed){let _0x260da8=null;for(let _0x7f971f in banIpList){banIpList[_0x7f971f]['ip']==_0x25d601&&(_0x260da8=banIpList[_0x7f971f],banIpList[_0x7f971f]['testCount']+=0x1);}!_0x260da8&&(_0x260da8={'ip':_0x25d601,'testCount':0x1},banIpList['push'](_0x260da8));if(_0x260da8[_0x288c0f(0x102)]>=_0x31413f){let _0x3d45d2=new Date()['getTime'](),_0x3677a2=_0x3d45d2+_0x2bc925*0x3c*0x3e8;dbLoginTable[_0x288c0f(0x17d)](_0x56742c['app']['dbOther'],_0x288c0f(0x16f),_0x25d601,_0x3677a2,_0x234bd3['__'](_0x288c0f(0x1c4))),_0x56742c[_0x288c0f(0x18b)][_0x288c0f(0x19c)](),dbNoticeCenterTable['create'](_0x56742c[_0x288c0f(0x18b)]['dbOther'],{'title':_0x234bd3['__'](_0x288c0f(0x12a)),'level':'error','content':_0x234bd3['__']('login.tooManyPwdTestIpBan')+('['+_0x25d601+']')});for(let _0x1b0eb0 in banIpList){banIpList[_0x1b0eb0]['ip']==_0x25d601&&banIpList[_0x288c0f(0x145)](_0x1b0eb0,0x1);}}}}router[_0x4ff678(0x177)](_0x4ff678(0x16a),(_0x53e90a,_0x3998bf,_0x5cb09f)=>{const _0x366d83=_0x4ff678;let _0x5c7458=_0x53e90a[_0x366d83(0x12e)][_0x366d83(0x112)],_0x5121f3=_0x53e90a[_0x366d83(0x12e)][_0x366d83(0x10a)];if(!_0x5c7458||!_0x5121f3)return _0x3998bf[_0x366d83(0x11b)](0x194)[_0x366d83(0x1a9)]();_0x5121f3=fileUtil['decodeBase64'](_0x5121f3);let _0xf16588=netUtils[_0x366d83(0x17a)](_0x53e90a);cryptoUtils[_0x366d83(0x115)](config[_0x366d83(0xfa)],_0x5121f3)['then'](_0x4c922c=>{const _0x4d6a74=_0x366d83;let _0x317a73=dbUserTable['login'](_0x53e90a['app'][_0x4d6a74(0x176)],_0x5c7458,_0x4c922c);if(_0x317a73){function _0x329c0e(){const _0x1af263=_0x4d6a74;if(_0xf16588!=_0x1af263(0x16d)){let _0x1cfa27=dbConfigTable[_0x1af263(0x137)](_0x53e90a['app'][_0x1af263(0x176)],_0x1af263(0x151));if(_0x1cfa27&&_0x1cfa27[_0x1af263(0x108)]=='1'){let _0x296a9a=_0x53e90a[_0x1af263(0x12e)][_0x1af263(0x198)];if(_0x296a9a){_0x296a9a=sha256(_0x296a9a);let _0x1e4db1=dbUserTable[_0x1af263(0x1a5)](_0x53e90a[_0x1af263(0x18b)]['dbOther'],_0x5c7458,_0x296a9a);if(!_0x1e4db1)return _0x53e90a[_0x1af263(0x18b)][_0x1af263(0xec)](_0x3998bf,_0x3998bf['__'](_0x1af263(0x193)));}else return _0x3998bf[_0x1af263(0x157)]({'code':0x2,'question':_0x317a73['question']});}}dbLoginTable['addLoginRecord'](_0x53e90a[_0x1af263(0x18b)][_0x1af263(0x176)],_0x1af263(0x136),_0x5c7458,_0xf16588,_0x53e90a[_0x1af263(0x12e)][_0x1af263(0x120)],_0x53e90a['headers'][_0x1af263(0x18f)]);let _0x34004a=sha256(new Date()[_0x1af263(0x1c6)]()+_0x5c7458+_0x4c922c);var _0x4a1528=_0x53e90a['headers'][_0x1af263(0x18f)];return dbUserTable[_0x1af263(0x1a4)](_0x53e90a[_0x1af263(0x18b)]['dbOther'],_0x317a73['id'],_0x34004a,_0xf16588,_0x4a1528),_0x317a73[_0x1af263(0x10a)]='',_0x317a73[_0x1af263(0x198)]='',_0x3998bf[_0x1af263(0x157)]({'code':0x0,'token':_0x34004a,'user':_0x317a73,'version':package['version'],'reqIp':_0xf16588});}return _0x329c0e();}else return addBanIp(_0x53e90a,_0x3998bf,_0xf16588),dbLoginTable['addLoginRecord'](_0x53e90a[_0x4d6a74(0x18b)][_0x4d6a74(0x176)],_0x3998bf['__']('login.wrongNameOrPwd'),_0x5c7458,_0xf16588,_0x53e90a[_0x4d6a74(0x12e)][_0x4d6a74(0x120)],_0x53e90a[_0x4d6a74(0x153)][_0x4d6a74(0x18f)]),_0x53e90a['app']['returnErrMsg'](_0x3998bf,_0x3998bf['__'](_0x4d6a74(0x1b6)));})[_0x366d83(0xe7)](_0x3983cb=>{const _0x446e37=_0x366d83;return console['log'](_0x3983cb),_0x53e90a[_0x446e37(0x18b)][_0x446e37(0xec)](_0x3998bf,_0x3998bf['__']('operationFail'));});}),router[_0x4ff678(0x177)](_0x4ff678(0x14c),(_0x367998,_0x32f9fe,_0x2ff783)=>{const _0x562f11=_0x4ff678;let _0x2fd1d7=netUtils[_0x562f11(0x17a)](_0x367998),_0x4442f3=_0x367998['body'][_0x562f11(0x183)];if(!_0x4442f3)return _0x367998[_0x562f11(0x18b)]['returnErrMsg'](_0x32f9fe,'Need\x20token');let _0x85cab2=dbUserTable[_0x562f11(0x171)](_0x367998['app'][_0x562f11(0x176)],_0x4442f3);if(!_0x85cab2)return _0x367998['app']['returnErrMsg'](_0x32f9fe,_0x32f9fe['__'](_0x562f11(0x14d)));return _0x85cab2[_0x562f11(0x10a)]='',_0x85cab2[_0x562f11(0x198)]='',_0x32f9fe[_0x562f11(0x157)]({'code':0x0,'token':_0x4442f3,'user':_0x85cab2,'reqIp':_0x2fd1d7});}),router[_0x4ff678(0x177)](_0x4ff678(0x15c),(_0xbbb8f0,_0x5627ac,_0x1e3f10)=>{const _0x11bfe8=_0x4ff678;let _0x380430=_0xbbb8f0[_0x11bfe8(0x12e)][_0x11bfe8(0x10a)];if(_0xbbb8f0[_0x11bfe8(0x1bf)]&&_0xbbb8f0[_0x11bfe8(0x1bf)][_0x11bfe8(0x10c)]!=0x1)return _0x5627ac[_0x11bfe8(0x157)]({'code':0x66});cryptoUtils['encryptString'](config[_0x11bfe8(0xfa)],_0x380430)[_0x11bfe8(0x162)](_0x29ade5=>{const _0x446b46=_0x11bfe8;if(_0xbbb8f0[_0x446b46(0x1bf)][_0x446b46(0x10a)]!=_0x29ade5)return _0x5627ac[_0x446b46(0x157)]({'code':0x1,'message':_0x5627ac['__']('login.pwdErr')});fs['rm'](path[_0x446b46(0x17f)](config[_0x446b46(0x170)]),{'recursive':!![]},_0x37eaee=>{const _0x51aab2=_0x446b46;if(_0x37eaee)return _0x5627ac[_0x51aab2(0x157)]({'code':0x1,'message':_0x51aab2(0xf1)});return _0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)][_0x51aab2(0x19a)]('DELETE\x20FROM\x20config')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)]['prepare'](_0x51aab2(0x1c9))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)][_0x51aab2(0x19a)]('DELETE\x20FROM\x20backup_task')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)]['prepare'](_0x51aab2(0x1a2))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)]['prepare']('DELETE\x20FROM\x20backup_task_record')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)][_0x51aab2(0x19a)](_0x51aab2(0x11a))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbOther'][_0x51aab2(0x19a)]('DELETE\x20FROM\x20config\x20where\x20title\x20in\x20(\x27nasAccountInfo\x27)')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)]['prepare'](_0x51aab2(0x104))['run'](),_0xbbb8f0[_0x51aab2(0x18b)]['dbOther'][_0x51aab2(0x19a)](_0x51aab2(0x187))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)]['prepare'](_0x51aab2(0x10e))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)][_0x51aab2(0x19a)](_0x51aab2(0x116))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)][_0x51aab2(0x19a)]('DELETE\x20FROM\x20login_ip_list')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbOther'][_0x51aab2(0x19a)](_0x51aab2(0x144))['run'](),_0xbbb8f0['app']['dbOther']['prepare']('DELETE\x20FROM\x20notice_center')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbOther'][_0x51aab2(0x19a)](_0x51aab2(0x14a))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbOther'][_0x51aab2(0x19a)]('DELETE\x20FROM\x20private_space')[_0x51aab2(0x146)](),_0xbbb8f0['app']['dbOther'][_0x51aab2(0x19a)](_0x51aab2(0x1b3))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbOther'][_0x51aab2(0x19a)](_0x51aab2(0x155))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbOther'][_0x51aab2(0x19a)](_0x51aab2(0x103))['run'](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)][_0x51aab2(0x19a)]('DELETE\x20FROM\x20user')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x176)][_0x51aab2(0x19a)]('DELETE\x20FROM\x20user_token')['run'](),_0xbbb8f0[_0x51aab2(0x18b)]['dbOther'][_0x51aab2(0x19a)]('DELETE\x20FROM\x20user_power')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x119))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbFileIndex'][_0x51aab2(0x19a)]('DELETE\x20FROM\x20ai_classes2index')['run'](),_0xbbb8f0[_0x51aab2(0x18b)]['dbFileIndex'][_0x51aab2(0x19a)](_0x51aab2(0xea))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x1a1))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x159))['run'](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x17c))[_0x51aab2(0x146)](),_0xbbb8f0['app'][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x15a))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbFileIndex'][_0x51aab2(0x19a)]('DELETE\x20FROM\x20file_index_book')['run'](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x190))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x1c7))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)]['dbFileIndex']['prepare'](_0x51aab2(0x165))[_0x51aab2(0x146)](),_0xbbb8f0['app'][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x11c))['run'](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)]('DELETE\x20FROM\x20movie_history')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x11e))[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)]('DELETE\x20FROM\x20photo_phash_similar')[_0x51aab2(0x146)](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)]['prepare'](_0x51aab2(0x129))['run'](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0xe9))['run'](),_0xbbb8f0[_0x51aab2(0x18b)]['dbFileIndex'][_0x51aab2(0x19a)](_0x51aab2(0xf4))['run'](),_0xbbb8f0['app'][_0x51aab2(0x188)]['prepare'](_0x51aab2(0x105))[_0x51aab2(0x146)](),_0xbbb8f0['app'][_0x51aab2(0x188)][_0x51aab2(0x19a)](_0x51aab2(0x179))['run'](),_0xbbb8f0[_0x51aab2(0x18b)]['dbFileIndex'][_0x51aab2(0x19a)]('DELETE\x20FROM\x20book_list_index')['run'](),_0xbbb8f0[_0x51aab2(0x18b)][_0x51aab2(0x188)]['prepare'](_0x51aab2(0x10b))['run'](),process[_0x51aab2(0x11f)]({'type':_0x51aab2(0x1be),'shareType':'FTP'}),process[_0x51aab2(0x11f)]({'type':_0x51aab2(0x1be),'shareType':_0x51aab2(0x191)}),process[_0x51aab2(0x11f)]({'type':'nasProxyRestart'}),process[_0x51aab2(0x11f)]({'type':_0x51aab2(0x13f)}),_0x5627ac[_0x51aab2(0x157)]({'code':0x0});});});}),router[_0x4ff678(0x177)](_0x4ff678(0x1b7),(_0x4ed909,_0x57881d,_0x4a3ab7)=>{const _0x3f815b=_0x4ff678;let _0x419ce0=netUtils['getClientIp'](_0x4ed909),_0x44df79=dbUserTable[_0x3f815b(0xeb)](_0x4ed909[_0x3f815b(0x18b)][_0x3f815b(0x176)]),_0x5c22ff={};_0x419ce0==_0x3f815b(0x16d)&&(_0x5c22ff[_0x3f815b(0x112)]=_0x44df79[_0x3f815b(0x112)]),_0x5c22ff[_0x3f815b(0x114)]=_0x44df79[_0x3f815b(0x114)],_0x57881d['json']({'code':0x0,'data':_0x5c22ff});}),router['all'](_0x4ff678(0x18a),(_0x177769,_0x3cb5b1,_0x3bc795)=>{const _0x3c04c9=_0x4ff678;let _0x39b11c={'code':0x0,'message':_0x3c04c9(0x1b1),'version':package[_0x3c04c9(0x172)],'hostName':OS[_0x3c04c9(0x16b)]()},_0x907f55=_0x177769[_0x3c04c9(0x1b8)]['ignoreIp'];if(_0x907f55&&_0x907f55==0x1)return _0x3cb5b1['json'](_0x39b11c);let _0x3fe277=0x50,_0x50832e=dbConfigTable[_0x3c04c9(0x137)](_0x177769[_0x3c04c9(0x18b)][_0x3c04c9(0x176)],_0x3c04c9(0x111));_0x50832e&&_0x50832e['value']&&(_0x3fe277=_0x50832e[_0x3c04c9(0x108)]);let _0x550f44=0x1bb,_0x564a75=dbConfigTable['findByTitle'](_0x177769['app']['dbOther'],_0x3c04c9(0x196));_0x564a75&&_0x564a75[_0x3c04c9(0x108)]&&_0x564a75[_0x3c04c9(0x108)]>0x0&&_0x564a75['value']<0xffff&&(_0x550f44=_0x564a75[_0x3c04c9(0x108)]);let _0x3109b3=0x0,_0x4bf315=dbConfigTable['findByTitle'](_0x177769[_0x3c04c9(0x18b)][_0x3c04c9(0x176)],'apiServerHttps');if(_0x4bf315&&_0x4bf315[_0x3c04c9(0x108)])try{_0x4bf315=JSON['parse'](_0x4bf315[_0x3c04c9(0x108)]),_0x4bf315['state']=='run'&&(_0x3109b3=0x1);}catch(_0xbdcd12){}try{let _0x2e64f6=dbConfigTable[_0x3c04c9(0x137)](_0x177769[_0x3c04c9(0x18b)]['dbOther'],_0x3c04c9(0x128)),_0x546928=dbConfigTable[_0x3c04c9(0x137)](_0x177769[_0x3c04c9(0x18b)][_0x3c04c9(0x176)],_0x3c04c9(0x1ae));if(_0x2e64f6){_0x2e64f6=JSON[_0x3c04c9(0x160)](_0x2e64f6[_0x3c04c9(0x108)]);let _0x197728=[];if(_0x546928&&_0x546928[_0x3c04c9(0x108)]){for(let _0x299651 in _0x2e64f6){let _0x366ccb=_0x2e64f6[_0x299651];_0x366ccb[_0x3c04c9(0x1af)]=='ipv4'&&_0x197728['push'](_0x366ccb);}_0x197728[_0x3c04c9(0x154)]({'type':_0x3c04c9(0x106),'ip':_0x546928[_0x3c04c9(0x108)],'ddns':0x1}),_0x2e64f6=_0x197728;}}return _0x39b11c[_0x3c04c9(0xfb)]=_0x2e64f6,_0x39b11c[_0x3c04c9(0x111)]=parseInt(_0x3fe277),_0x39b11c[_0x3c04c9(0x196)]=parseInt(_0x550f44),_0x39b11c[_0x3c04c9(0xf2)]=_0x3109b3,_0x3cb5b1[_0x3c04c9(0x157)](_0x39b11c);}catch(_0xd745c2){return _0x3cb5b1[_0x3c04c9(0x157)](_0x39b11c);}}),router['post']('/resetPwd',(_0x30a7ea,_0x350345,_0x49d396)=>{const _0x1d518e=_0x4ff678;let _0x52062c=_0x30a7ea['body'][_0x1d518e(0x112)],_0x29b692=_0x30a7ea[_0x1d518e(0x12e)][_0x1d518e(0x10a)],_0x599d8d=_0x30a7ea[_0x1d518e(0x12e)][_0x1d518e(0x198)],_0x248ee6=_0x30a7ea[_0x1d518e(0x18b)][_0x1d518e(0x176)][_0x1d518e(0x19a)](_0x1d518e(0x15d))[_0x1d518e(0x122)](_0x52062c);if(!_0x248ee6)return _0x30a7ea['app'][_0x1d518e(0xec)](_0x350345,_0x350345['__'](_0x1d518e(0x169)));try{_0x599d8d=sha256(_0x599d8d);let _0x24a8f5=dbUserTable[_0x1d518e(0x1a5)](_0x30a7ea[_0x1d518e(0x18b)][_0x1d518e(0x176)],_0x52062c,_0x599d8d);if(_0x24a8f5)cryptoUtils['encryptString'](config[_0x1d518e(0xfa)],_0x29b692)['then'](_0x24ae4a=>{const _0x2e0325=_0x1d518e;dbUserTable[_0x2e0325(0x14b)](_0x30a7ea[_0x2e0325(0x18b)][_0x2e0325(0x176)],_0x52062c,_0x2e0325(0x10a),_0x24ae4a);let _0x4dff98=sha256(new Date()['getTime']()+_0x52062c+_0x29b692);dbUserTable[_0x2e0325(0x14b)](_0x30a7ea[_0x2e0325(0x18b)][_0x2e0325(0x176)],_0x52062c,_0x2e0325(0x183),_0x4dff98),_0x350345[_0x2e0325(0x157)]({'code':0x0});})[_0x1d518e(0xe7)](_0xe5f6c0=>{const _0xe9f1e2=_0x1d518e;return console[_0xe9f1e2(0x1cb)](_0xe9f1e2(0x15e),_0xe5f6c0),_0x30a7ea[_0xe9f1e2(0x18b)][_0xe9f1e2(0xec)](_0x350345,_0x350345['__'](_0xe9f1e2(0x199)));});else return _0x30a7ea[_0x1d518e(0x18b)][_0x1d518e(0xec)](_0x350345,_0x350345['__'](_0x1d518e(0x193)));}catch(_0x5504f7){return console[_0x1d518e(0x1cb)](_0x1d518e(0xf8),_0x5504f7),_0x350345[_0x1d518e(0x11b)](0x194)['end']();}});function _0x1abd(_0x27e331,_0x382522){const _0x58aea6=_0x58ae();return _0x1abd=function(_0x1abddf,_0x211340){_0x1abddf=_0x1abddf-0xe2;let _0x4e5afa=_0x58aea6[_0x1abddf];return _0x4e5afa;},_0x1abd(_0x27e331,_0x382522);}function newUserCheck(_0x5ca935,_0x43690c,_0x16cb0f,_0x596f6f,_0x32a82c,_0x536e53){const _0x5a912c=_0x4ff678;if(!_0x596f6f||!_0x16cb0f||!_0x5ca935||!_0x43690c)return _0x32a82c[_0x5a912c(0x18b)][_0x5a912c(0xec)](_0x536e53,_0x536e53['__'](_0x5a912c(0x174)));let _0x4ddf7c=new RegExp(_0x5a912c(0x101));if(!_0x4ddf7c[_0x5a912c(0x184)](_0x5ca935)||_0x5ca935==config[_0x5a912c(0x123)])return _0x32a82c[_0x5a912c(0x18b)][_0x5a912c(0xec)](_0x536e53,_0x536e53['__'](_0x5a912c(0x10d)));if(_0x5ca935==_0x43690c)return _0x32a82c[_0x5a912c(0x18b)][_0x5a912c(0xec)](_0x536e53,_0x536e53['__']('usernameAndPwdCannotBeSame'));if(checkUtil['isEasyUsername'](_0x5ca935))return _0x32a82c[_0x5a912c(0x18b)][_0x5a912c(0xec)](_0x536e53,_0x536e53['__']('usernameTooEasy'));if(_0x16cb0f==_0x596f6f)return _0x32a82c[_0x5a912c(0x18b)][_0x5a912c(0xec)](_0x536e53,_0x536e53['__'](_0x5a912c(0x1b2)));if(checkUtil[_0x5a912c(0xe4)](_0x43690c))return _0x32a82c['app']['returnErrMsg'](_0x536e53,_0x536e53['__'](_0x5a912c(0x1a8)));return!![];}router[_0x4ff678(0x177)](_0x4ff678(0x192),(_0x45b6a1,_0x288eb6,_0x27da6b)=>{const _0x3b0fea=_0x4ff678;let _0x5e28e7=_0x45b6a1[_0x3b0fea(0x12e)][_0x3b0fea(0x112)],_0x538a08=_0x45b6a1['body'][_0x3b0fea(0x10a)],_0x43a96a=_0x45b6a1[_0x3b0fea(0x12e)][_0x3b0fea(0x114)],_0x14d9dc=_0x45b6a1[_0x3b0fea(0x12e)][_0x3b0fea(0x198)];if(!_0x14d9dc||!_0x43a96a||!_0x5e28e7||!_0x538a08)return _0x288eb6[_0x3b0fea(0x157)]({'code':0x1,'message':_0x3b0fea(0x13d)});let _0x522254=dbUserTable['getAdmin'](_0x45b6a1['app'][_0x3b0fea(0x176)]);if(_0x522254)_0x288eb6[_0x3b0fea(0x157)]({'code':0x1,'message':_0x288eb6['__'](_0x3b0fea(0x195))});else{if(newUserCheck(_0x5e28e7,_0x538a08,_0x43a96a,_0x14d9dc,_0x45b6a1,_0x288eb6)!==!![])return;_0x14d9dc=sha256(_0x14d9dc),cryptoUtils[_0x3b0fea(0x115)](config['passwordKey'],_0x538a08)[_0x3b0fea(0x162)](_0x167991=>{const _0x449118=_0x3b0fea;let _0x379952=dbUserTable['create'](_0x45b6a1[_0x449118(0x18b)][_0x449118(0x176)],{'username':_0x5e28e7,'password':_0x167991,'question':_0x43a96a,'answer':_0x14d9dc,'is_admin':0x1});if(_0x379952[_0x449118(0x1ad)]>0x0){let _0x229c7e=dbUserTable[_0x449118(0xeb)](_0x45b6a1['app'][_0x449118(0x176)]),_0x170279=sha256(new Date()[_0x449118(0x1c6)]()+_0x5e28e7+_0x167991),_0x2a9858=netUtils['getClientIp'](_0x45b6a1);var _0x46cbec=_0x45b6a1['headers'][_0x449118(0x18f)];dbUserTable[_0x449118(0x1a4)](_0x45b6a1['app'][_0x449118(0x176)],_0x229c7e['id'],_0x170279,_0x2a9858,_0x46cbec),_0x229c7e[_0x449118(0x10a)]='';let _0x48737c=_0x45b6a1['body'][_0x449118(0x178)],_0x174906=_0x45b6a1['body'][_0x449118(0x130)];return _0x48737c&&dbConfigTable[_0x449118(0x17e)](_0x45b6a1[_0x449118(0x18b)][_0x449118(0x176)],{'title':'language','value':_0x48737c}),_0x174906&&dbConfigTable[_0x449118(0x17e)](_0x45b6a1['app']['dbOther'],{'title':_0x449118(0x130),'value':_0x174906}),_0x288eb6[_0x449118(0x157)]({'code':0x0,'token':_0x170279,'user':_0x229c7e});}})['catch'](_0x590491=>{const _0x38ead4=_0x3b0fea;return console['log'](_0x38ead4(0x15e),_0x590491),_0x45b6a1[_0x38ead4(0x18b)][_0x38ead4(0xec)](_0x288eb6,_0x288eb6['__'](_0x38ead4(0x199)));});}}),router[_0x4ff678(0x177)]('/remarkUser',(_0x1a7993,_0x4cd5c6,_0x32563b)=>{const _0x3cea91=_0x4ff678;if(_0x1a7993['currentUser'][_0x3cea91(0x10c)]!=0x1)return _0x4cd5c6[_0x3cea91(0x157)]({'code':0x66});let _0x2441b9=_0x1a7993[_0x3cea91(0x12e)][_0x3cea91(0x112)],_0x4be8b6=_0x1a7993[_0x3cea91(0x12e)]['remark'];return _0x2441b9&&_0x4be8b6&&dbUserTable[_0x3cea91(0x1c0)](_0x1a7993[_0x3cea91(0x18b)][_0x3cea91(0x176)],_0x2441b9,_0x4be8b6),_0x4cd5c6['json']({'code':0x0});}),router['post'](_0x4ff678(0x147),(_0x98e0ee,_0x32d046,_0x27b885)=>{const _0x36cdea=_0x4ff678;let _0x34a687=_0x98e0ee[_0x36cdea(0x12e)][_0x36cdea(0x112)],_0x6c330e=_0x98e0ee[_0x36cdea(0x12e)][_0x36cdea(0x10a)],_0x13650e=_0x98e0ee[_0x36cdea(0x12e)][_0x36cdea(0x114)],_0x9b6da5=_0x98e0ee[_0x36cdea(0x12e)][_0x36cdea(0x198)],_0x53f7f8=_0x98e0ee['body'][_0x36cdea(0x118)];if(newUserCheck(_0x34a687,_0x6c330e,_0x13650e,_0x9b6da5,_0x98e0ee,_0x32d046)!==!![])return;let _0x313238=_0x98e0ee[_0x36cdea(0x12e)][_0x36cdea(0x1af)];if(dbUserTable[_0x36cdea(0x1a6)](_0x98e0ee,_0x32d046)===!![]){if(_0x313238==_0x36cdea(0x19b)){let _0x3df3e8=dbUserTable[_0x36cdea(0x186)](_0x98e0ee['app']['dbOther'],_0x34a687);if(_0x3df3e8)return _0x98e0ee[_0x36cdea(0x18b)][_0x36cdea(0xec)](_0x32d046,_0x32d046['__'](_0x36cdea(0x168)));}cryptoUtils[_0x36cdea(0x115)](config[_0x36cdea(0xfa)],_0x6c330e)[_0x36cdea(0x162)](_0x542c16=>{const _0x427eec=_0x36cdea;let _0xbb12e7=dbUserTable[_0x427eec(0x17e)](_0x98e0ee[_0x427eec(0x18b)]['dbOther'],{'username':_0x34a687,'password':_0x542c16,'question':_0x13650e,'answer':sha256(_0x9b6da5),'remark':_0x53f7f8});return _0xbb12e7[_0x427eec(0x1ad)]>=0x1?_0x32d046[_0x427eec(0x157)]({'code':0x0}):_0x98e0ee['app'][_0x427eec(0xec)](_0x32d046,_0x32d046['__'](_0x427eec(0x199)));})[_0x36cdea(0xe7)](_0x57435c=>{const _0x40fce1=_0x36cdea;return console[_0x40fce1(0x1cb)](_0x40fce1(0x15e),_0x57435c),_0x98e0ee[_0x40fce1(0x18b)][_0x40fce1(0xec)](_0x32d046,_0x32d046['__']('operationFail'));});}}),router[_0x4ff678(0x177)](_0x4ff678(0x1ab),(_0xb02db9,_0x4d639c,_0x35f9be)=>{const _0x3d5a10=_0x4ff678;let _0xdb86fc=_0xb02db9[_0x3d5a10(0x12e)]['uid'];if(dbUserTable['isAdmin'](_0xb02db9,_0x4d639c)===!![]){let _0x179b4f=dbUserTable[_0x3d5a10(0x14e)](_0xb02db9['app'][_0x3d5a10(0x176)],_0xdb86fc);if(_0x179b4f&&_0x179b4f[_0x3d5a10(0x10c)]==0x1)return _0x4d639c[_0x3d5a10(0x157)]({'code':0x1,'message':_0x3d5a10(0x142)});dbUserTable[_0x3d5a10(0x156)](_0xb02db9['app'][_0x3d5a10(0x176)],_0x179b4f[_0x3d5a10(0x112)]),dbMusicIndexTable['removeUserPlayList'](_0xb02db9[_0x3d5a10(0x18b)][_0x3d5a10(0x188)],_0x179b4f['id']),dbMusicFavorite[_0x3d5a10(0x143)](_0xb02db9[_0x3d5a10(0x18b)][_0x3d5a10(0x188)],_0x179b4f['id']),dbMovieFavorite['deleteFavoriteByUid'](_0xb02db9[_0x3d5a10(0x18b)][_0x3d5a10(0x188)],_0x179b4f['id']),dbMediaTools[_0x3d5a10(0x1c3)](_0xb02db9[_0x3d5a10(0x18b)][_0x3d5a10(0x176)],_0x179b4f['id']);let _0x12af9c=dbUserTable[_0x3d5a10(0x13a)](_0xb02db9[_0x3d5a10(0x18b)][_0x3d5a10(0x176)],_0xdb86fc);return _0x12af9c[_0x3d5a10(0x1ad)]>=0x1?_0x4d639c[_0x3d5a10(0x157)]({'code':0x0}):_0xb02db9[_0x3d5a10(0x18b)][_0x3d5a10(0xec)](_0x4d639c,_0x4d639c['__']('operationFail'));}}),router[_0x4ff678(0x177)](_0x4ff678(0x19f),(_0x5ae824,_0x55b38f,_0x57ceb9)=>{const _0x5b18dc=_0x4ff678;if(dbUserTable['isAdmin'](_0x5ae824,_0x55b38f)===!![]){let _0x3efad5=_0x5ae824['body'][_0x5b18dc(0x18c)]||'id',_0x15f00e=_0x5ae824[_0x5b18dc(0x12e)][_0x5b18dc(0xff)]||_0x5b18dc(0x1bc),_0x5be9b7=_0x5ae824[_0x5b18dc(0x12e)]['searchKey'];(!['id',_0x5b18dc(0x112),_0x5b18dc(0x1aa)][_0x5b18dc(0x1b9)](_0x3efad5)||![_0x5b18dc(0x1bc),_0x5b18dc(0x17b)]['includes'](_0x15f00e))&&(_0x3efad5='id',_0x15f00e=_0x5b18dc(0x1bc));let _0x2ffe1b=_0x5b18dc(0xfe),_0x4d9bb5=[];_0x5be9b7&&(_0x2ffe1b+=_0x5b18dc(0x132),_0x4d9bb5['push']('%'+_0x5be9b7+'%','%'+_0x5be9b7+'%'));_0x2ffe1b+='\x20ORDER\x20BY\x20'+_0x3efad5+'\x20'+_0x15f00e;let _0x23aa47=_0x5ae824[_0x5b18dc(0x18b)][_0x5b18dc(0x176)][_0x5b18dc(0x19a)](_0x2ffe1b)[_0x5b18dc(0x15f)](_0x4d9bb5);return _0x55b38f['json']({'code':0x0,'userList':_0x23aa47});}}),router['post'](_0x4ff678(0x135),(_0x526ecc,_0x3d5eb0,_0x580ce0)=>{const _0x35ecd0=_0x4ff678;let _0x4fe80d=_0x526ecc[_0x35ecd0(0x12e)][_0x35ecd0(0x112)],_0x373c45=null;if(_0x4fe80d!=config['publicUserName']){_0x373c45=dbUserTable[_0x35ecd0(0x12f)](_0x526ecc[_0x35ecd0(0x18b)]['dbOther'],_0x4fe80d);if(!_0x373c45)return _0x526ecc[_0x35ecd0(0x18b)]['returnErrMsg'](_0x3d5eb0,'username\x20error');}if(dbUserTable[_0x35ecd0(0x1a6)](_0x526ecc,_0x3d5eb0)===!![]||_0x4fe80d==_0x526ecc[_0x35ecd0(0x1bf)][_0x35ecd0(0x112)]){let _0x4aca5d=dbUserTable['getUserPower'](_0x526ecc[_0x35ecd0(0x18b)][_0x35ecd0(0x176)],_0x4fe80d,null,null,!![]),_0x1306cf=0x0;if(_0x4aca5d[_0x35ecd0(0x1a3)]<0x1)return _0x3d5eb0['json']({'code':0x0,'userPower':_0x4aca5d,'userMenu':_0x373c45?_0x373c45[_0x35ecd0(0x121)]:[]});for(let _0x490315=0x0;_0x490315<_0x4aca5d['length'];_0x490315++){let _0x4046b3=_0x4aca5d[_0x490315][_0x35ecd0(0xe2)];fs['stat'](_0x4046b3,(_0x29034a,_0xb97ebf)=>{const _0x21483c=_0x35ecd0;_0x1306cf+=0x1;_0x29034a?_0x4aca5d[_0x490315]['exist']=0x0:_0x4aca5d[_0x490315][_0x21483c(0xe8)]=0x1;if(_0x1306cf==_0x4aca5d[_0x21483c(0x1a3)])return _0x3d5eb0['json']({'code':0x0,'userPower':_0x4aca5d,'userMenu':_0x373c45?_0x373c45[_0x21483c(0x121)]:[]});});}}}),router['post'](_0x4ff678(0xfd),(_0x5252a2,_0x4e887d,_0x4511e7)=>{const _0x49a1ed=_0x4ff678;let _0x10de46=_0x5252a2[_0x49a1ed(0x12e)][_0x49a1ed(0x112)],_0x3237d6=_0x5252a2[_0x49a1ed(0x12e)]['path'],_0x26d241=_0x5252a2['body'][_0x49a1ed(0xfc)];if(!_0x10de46||!_0x3237d6||!_0x26d241)return _0x5252a2[_0x49a1ed(0x18b)][_0x49a1ed(0xec)](_0x4e887d,_0x4e887d['__'](_0x49a1ed(0x199)));let _0x1bad18=null;if(_0x10de46!=config[_0x49a1ed(0x123)]){_0x1bad18=dbUserTable[_0x49a1ed(0x12f)](_0x5252a2[_0x49a1ed(0x18b)][_0x49a1ed(0x176)],_0x10de46);if(!_0x1bad18)return _0x5252a2['app'][_0x49a1ed(0xec)](_0x4e887d,_0x49a1ed(0xf9));}_0x3237d6=pathUtil['join'](_0x3237d6);if(dbUserTable['isAdmin'](_0x5252a2,_0x4e887d)===!![]){let _0x112996=dbUserTable[_0x49a1ed(0x150)](_0x5252a2[_0x49a1ed(0x18b)][_0x49a1ed(0x176)],_0x10de46,_0x26d241,null,!![]);for(let _0x5dc145 of _0x112996){let _0x19a544=_0x5dc145['path'];if(_0x3237d6[_0x49a1ed(0x100)](pathUtil[_0x49a1ed(0x17f)](_0x19a544,pathUtil[_0x49a1ed(0xf6)]))&&_0x3237d6!=_0x19a544)return _0x5252a2['app'][_0x49a1ed(0xec)](_0x4e887d,_0x4e887d['__']('path.parentPathExist')+_0x19a544,'dialog');if(_0x19a544[_0x49a1ed(0x100)](pathUtil[_0x49a1ed(0x17f)](_0x3237d6,pathUtil[_0x49a1ed(0xf6)]))&&_0x3237d6!=_0x19a544)return _0x5252a2['app'][_0x49a1ed(0xec)](_0x4e887d,_0x4e887d['__'](_0x49a1ed(0x1a0))+_0x19a544,_0x49a1ed(0x1c1));}let _0x5ccc4c=dbUserTable[_0x49a1ed(0x182)](_0x5252a2[_0x49a1ed(0x18b)]['dbOther'],_0x5252a2[_0x49a1ed(0x12e)]);return _0x4e887d['json']({'code':0x0,'result':_0x5ccc4c});}}),router[_0x4ff678(0x177)](_0x4ff678(0xf0),(_0x56e6a6,_0xc63453,_0x48a99d)=>{const _0x566f04=_0x4ff678;let _0x27417b=_0x56e6a6[_0x566f04(0x12e)][_0x566f04(0x112)],_0x592cf6=_0x56e6a6['body']['menuList'];if(!_0x27417b||!(_0x592cf6 instanceof Array))return _0x56e6a6[_0x566f04(0x18b)][_0x566f04(0xec)](_0xc63453,_0x566f04(0x158));let _0x545cfa=dbUserTable[_0x566f04(0x12f)](_0x56e6a6[_0x566f04(0x18b)][_0x566f04(0x176)],_0x27417b);if(!_0x545cfa)return _0x56e6a6[_0x566f04(0x18b)][_0x566f04(0xec)](_0xc63453,'username\x20error');if(dbUserTable[_0x566f04(0x1a6)](_0x56e6a6,_0xc63453)===!![])return dbUserTable[_0x566f04(0x14b)](_0x56e6a6['app'][_0x566f04(0x176)],_0x27417b,'menus',JSON[_0x566f04(0x12d)](_0x592cf6)),_0xc63453[_0x566f04(0x157)]({'code':0x0});}),router[_0x4ff678(0x177)](_0x4ff678(0x140),(_0xdbab20,_0x5bb442,_0x586a2f)=>{const _0x20e496=_0x4ff678;let _0x22ac0a=dbUserTable[_0x20e496(0x107)](_0xdbab20[_0x20e496(0x18b)][_0x20e496(0x176)],_0xdbab20[_0x20e496(0x12e)]);return _0x22ac0a[_0x20e496(0x1ad)]>0x0?_0x5bb442[_0x20e496(0x157)]({'code':0x0}):_0xdbab20[_0x20e496(0x18b)][_0x20e496(0xec)](_0x5bb442,_0x5bb442['__'](_0x20e496(0x199)));}),router[_0x4ff678(0x177)](_0x4ff678(0x11d),(_0x334f41,_0x48248a,_0x520a25)=>{const _0x535116=_0x4ff678;let _0x2f076e=_0x334f41['body']['oldPassword'],_0x43ff70=_0x334f41[_0x535116(0x12e)][_0x535116(0x117)];cryptoUtils[_0x535116(0x115)](config[_0x535116(0xfa)],_0x2f076e)['then'](_0x3e5b4a=>{const _0x299743=_0x535116;if(_0x334f41[_0x299743(0x1bf)][_0x299743(0x10a)]!=_0x3e5b4a)return _0x48248a[_0x299743(0x157)]({'code':0x2,'message':_0x48248a['__'](_0x299743(0x139))});else cryptoUtils['encryptString'](config['passwordKey'],_0x43ff70)[_0x299743(0x162)](_0x5a64d8=>{const _0x35923e=_0x299743;dbUserTable[_0x35923e(0x131)](_0x334f41['app'][_0x35923e(0x176)],_0x334f41['currentUser']['id'],_0x35923e(0x10a),_0x5a64d8);let _0x40935b=sha256(new Date()[_0x35923e(0x1c6)]()+_0x334f41['currentUser']['username']+_0x334f41['currentUser'][_0x35923e(0x10a)]);dbUserTable[_0x35923e(0x131)](_0x334f41[_0x35923e(0x18b)][_0x35923e(0x176)],_0x334f41[_0x35923e(0x1bf)]['id'],_0x35923e(0x183),_0x40935b);let _0x10e669=netUtils[_0x35923e(0x17a)](_0x334f41);return dbLoginTable['addLoginRecord'](_0x334f41[_0x35923e(0x18b)][_0x35923e(0x176)],_0x35923e(0x134),_0x334f41[_0x35923e(0x1bf)]['id'],_0x10e669,_0x334f41['body'][_0x35923e(0x120)],''),_0x48248a[_0x35923e(0x157)]({'code':0x0});})[_0x299743(0xe7)](_0x2fd203=>{const _0x4d8b06=_0x299743;return console[_0x4d8b06(0x1cb)](_0x4d8b06(0x15e),_0x2fd203),_0x334f41[_0x4d8b06(0x18b)][_0x4d8b06(0xec)](_0x48248a,_0x48248a['__'](_0x4d8b06(0x199)));});});}),router['post'](_0x4ff678(0x113),(_0xe06ded,_0x26bfdc,_0x2c2330)=>{const _0x556366=_0x4ff678;let _0x1b6cdf=_0xe06ded[_0x556366(0x12e)]['newQuestion'],_0x34be42=_0xe06ded[_0x556366(0x12e)][_0x556366(0x198)];if(checkUtil[_0x556366(0x194)](_0x34be42))return _0xe06ded[_0x556366(0x18b)]['returnErrMsg'](_0x26bfdc,_0x26bfdc['__'](_0x556366(0x163)));if(_0x1b6cdf==_0x34be42)return _0xe06ded[_0x556366(0x18b)][_0x556366(0xec)](_0x26bfdc,_0x26bfdc['__'](_0x556366(0x1b2)));return dbUserTable[_0x556366(0x167)](_0xe06ded[_0x556366(0x18b)]['dbOther'],_0xe06ded[_0x556366(0x1bf)]['id'],_0x1b6cdf,sha256(_0x34be42)),_0x26bfdc[_0x556366(0x157)]({'code':0x0});}),router[_0x4ff678(0x177)](_0x4ff678(0x148),(_0xea294e,_0x33ddc8,_0x286157)=>{const _0x458a67=_0x4ff678;let _0x140336=_0xea294e['body']['token'];return _0x140336&&dbUserTable[_0x458a67(0x173)](_0xea294e['app']['dbOther'],_0x458a67(0x13b),[_0x140336]),_0x33ddc8[_0x458a67(0x157)]({'code':0x0});}),router[_0x4ff678(0x177)]('/getCurrentUserInfo',(_0x99d6b9,_0x318bf9,_0x35b647)=>{const _0x2515a4=_0x4ff678;let _0x5c2e4f=dbUserTable['find'](_0x99d6b9[_0x2515a4(0x18b)]['dbOther'],_0x99d6b9['currentUser']['id']);return _0x5c2e4f?(_0x5c2e4f[_0x2515a4(0x10a)]='',_0x5c2e4f[_0x2515a4(0x198)]='',_0x318bf9['json']({'code':0x0,'userInfo':_0x5c2e4f})):_0x318bf9[_0x2515a4(0x157)]({'code':0x65});}),router[_0x4ff678(0x177)]('/addIpToList',(_0x5d56d7,_0x41c03d,_0x36b24f)=>{const _0x452e0b=_0x4ff678;if(_0x5d56d7[_0x452e0b(0x1bf)][_0x452e0b(0x10c)]!=0x1)return _0x41c03d[_0x452e0b(0x157)]({'code':0x66});let _0x57aa8b=_0x5d56d7[_0x452e0b(0x12e)]['ip'];if(_0x57aa8b==_0x452e0b(0x16d)||_0x57aa8b==_0x452e0b(0x18e))return _0x5d56d7['app']['returnErrMsg'](_0x41c03d,_0x41c03d['__'](_0x452e0b(0xe5)));let _0x50c531=_0x5d56d7['body']['type'],_0xef6dbe=_0x5d56d7[_0x452e0b(0x12e)][_0x452e0b(0xe6)];return dbLoginTable['addIpToList'](_0x5d56d7[_0x452e0b(0x18b)][_0x452e0b(0x176)],_0x50c531,_0x57aa8b,_0xef6dbe,_0x41c03d['__'](_0x452e0b(0x161))),_0x5d56d7[_0x452e0b(0x18b)]['refreshIpList'](),_0x41c03d['json']({'code':0x0});}),router[_0x4ff678(0x177)](_0x4ff678(0xed),(_0x5dc7e0,_0x59e489,_0x134a3a)=>{const _0x2d2358=_0x4ff678;if(_0x5dc7e0[_0x2d2358(0x1bf)]['is_admin']!=0x1)return _0x59e489['json']({'code':0x66});let _0x2da2c4=_0x5dc7e0['body']['id'];return dbLoginTable[_0x2d2358(0x109)](_0x5dc7e0[_0x2d2358(0x18b)][_0x2d2358(0x176)],_0x2da2c4),_0x5dc7e0['app'][_0x2d2358(0x19c)](),_0x59e489['json']({'code':0x0});}),router[_0x4ff678(0x177)](_0x4ff678(0x1ba),(_0x1d2161,_0x1f3ca1,_0x5e9df8)=>{const _0x98bae4=_0x4ff678;let _0x110a28=_0x1d2161[_0x98bae4(0x12e)][_0x98bae4(0x1b4)],_0x548ca1=_0x1d2161['body'][_0x98bae4(0x189)],_0x3725a6=_0x1d2161['body'][_0x98bae4(0x1af)],_0x38a098=new Date()[_0x98bae4(0x1c6)]();dbLoginTable[_0x98bae4(0x12c)](_0x1d2161[_0x98bae4(0x18b)][_0x98bae4(0x176)],_0x98bae4(0x1b0)+_0x38a098);let _0x8a214f=_0x98bae4(0x185)+_0x3725a6+'\x27',_0x5eb7ea=dbLoginTable[_0x98bae4(0x1c8)](_0x1d2161['app']['dbOther'],_0x8a214f),_0x257c97=(_0x110a28-0x1)*_0x548ca1;_0x8a214f+=_0x98bae4(0x16e)+_0x548ca1+'\x20offset\x20'+_0x257c97;let _0x3ce80f=dbLoginTable[_0x98bae4(0x1c5)](_0x1d2161[_0x98bae4(0x18b)]['dbOther'],_0x8a214f);return _0x1f3ca1['json']({'code':0x0,'data':_0x3ce80f,'pageCount':Math[_0x98bae4(0x197)](_0x5eb7ea[_0x98bae4(0x1b5)]/_0x548ca1)});}),router[_0x4ff678(0x177)](_0x4ff678(0x13c),(_0xc6fba8,_0x5a180a,_0x1b485f)=>{const _0x9f3552=_0x4ff678;if(_0xc6fba8[_0x9f3552(0x1bf)][_0x9f3552(0x10c)]!=0x1)return _0x5a180a['json']({'code':0x66});let _0x4e872b=0x1388,_0x5a4d56=_0xc6fba8[_0x9f3552(0x12e)]['page'],_0x2822e4=_0xc6fba8[_0x9f3552(0x12e)][_0x9f3552(0x189)],_0x6e0d5c=_0xc6fba8[_0x9f3552(0x12e)][_0x9f3552(0x1af)],_0x48c3cf='',_0x2e1ad6=[];_0x6e0d5c?(_0x48c3cf+=_0x9f3552(0x164),_0x2e1ad6['push'](_0x6e0d5c)):_0x48c3cf=_0x9f3552(0x16c);let _0x5af4c9=dbLoginTable[_0x9f3552(0x18d)](_0xc6fba8[_0x9f3552(0x18b)][_0x9f3552(0x176)],_0x48c3cf,_0x2e1ad6)[_0x9f3552(0x1b5)];if(_0x5af4c9>_0x4e872b){let _0x2ad61f=0x64,_0x4661c6=dbLoginTable[_0x9f3552(0x125)](_0xc6fba8[_0x9f3552(0x18b)][_0x9f3552(0x176)],_0x9f3552(0x1ca)+_0x2ad61f+')');_0x4661c6[_0x9f3552(0x1ad)]>0x0&&(_0x5af4c9=_0x5af4c9-_0x4661c6[_0x9f3552(0x1ad)]);}let _0x236932=(_0x5a4d56-0x1)*_0x2822e4;_0x48c3cf+=_0x9f3552(0x19e),_0x2e1ad6[_0x9f3552(0x154)](_0x2822e4),_0x2e1ad6['push'](_0x236932);let _0x5121d2=dbLoginTable[_0x9f3552(0x141)](_0xc6fba8['app']['dbOther'],_0x48c3cf,_0x2e1ad6);return _0x5a180a[_0x9f3552(0x157)]({'code':0x0,'data':_0x5121d2,'pageCount':Math[_0x9f3552(0x197)](_0x5af4c9/_0x2822e4)});}),module['exports']=router;