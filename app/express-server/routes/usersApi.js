const _0x26231d=_0x294c;function _0x294c(_0x2cca6c,_0x51aa46){const _0x3eacb4=_0x3eac();return _0x294c=function(_0x294c2e,_0x5c51b3){_0x294c2e=_0x294c2e-0xd3;let _0x442b07=_0x3eacb4[_0x294c2e];return _0x442b07;},_0x294c(_0x2cca6c,_0x51aa46);}(function(_0x78deae,_0x3d5b32){const _0x53d746=_0x294c,_0x3a828d=_0x78deae();while(!![]){try{const _0x1d9508=parseInt(_0x53d746(0x169))/0x1+parseInt(_0x53d746(0x121))/0x2*(parseInt(_0x53d746(0x100))/0x3)+parseInt(_0x53d746(0x16a))/0x4*(-parseInt(_0x53d746(0xe4))/0x5)+-parseInt(_0x53d746(0x114))/0x6+parseInt(_0x53d746(0x13f))/0x7+-parseInt(_0x53d746(0x167))/0x8+-parseInt(_0x53d746(0x181))/0x9*(parseInt(_0x53d746(0xfc))/0xa);if(_0x1d9508===_0x3d5b32)break;else _0x3a828d['push'](_0x3a828d['shift']());}catch(_0x3834f4){_0x3a828d['push'](_0x3a828d['shift']());}}}(_0x3eac,0xabe63));let sha256=require(_0x26231d(0x12a)),express=require(_0x26231d(0x18f)),router=express[_0x26231d(0x132)](),cryptoUtils=require(_0x26231d(0x15d)),netUtils=require('../utils/netUtils'),config=require('../../myConfig/config'),pathUtil=require('path'),checkUtil=require(_0x26231d(0x18e));var package=require(_0x26231d(0x1a8));const OS=require('os'),urlConfig=require(_0x26231d(0xd6)),dbUserTable=require('../../db/dbUserTable'),dbLoginTable=require(_0x26231d(0x186)),dbConfigTable=require('../../db/dbConfigTable'),dbNoticeCenterTable=require(_0x26231d(0x171)),dbMusicIndexTable=require(_0x26231d(0x193)),fileUtil=require(_0x26231d(0x10a)),fs=require('fs'),path=require('path'),dbMovieFavorite=require(_0x26231d(0x137)),dbMusicFavorite=require('../../db/dbMusicFavorite');router[_0x26231d(0x105)](_0x26231d(0x14e),(_0x30153b,_0x593f23,_0x2fad5d)=>{const _0x130d54=_0x26231d;let _0x3a4f38=dbUserTable[_0x130d54(0xdd)](_0x30153b[_0x130d54(0x17e)][_0x130d54(0x150)]),_0x346fab=dbConfigTable[_0x130d54(0x1ad)](_0x30153b['app'][_0x130d54(0x150)],[_0x130d54(0xf6),_0x130d54(0x10b),'customLoginImage',_0x130d54(0x138)]);_0x593f23[_0x130d54(0x128)]({'code':0x0,'hasAdmin':_0x3a4f38?'1':'0','customConfig':_0x346fab,'pagePrivacyUrl':urlConfig['getUrlByUrlKey'](_0x30153b[_0x130d54(0x17e)][_0x130d54(0x150)],_0x130d54(0x117)),'pageAgreementUrl':urlConfig[_0x130d54(0x124)](_0x30153b['app'][_0x130d54(0x150)],_0x130d54(0xfe))});});let banIpList=[];function _0x3eac(){const _0x189df9=['DELETE\x20FROM\x20private_space_token','push','getUserByUserName','includes','server_type','then','ipv6','../../myConfig/urlConfig','currentUser','password','pageSize','token','login.loginFailAlert','\x20WHERE\x20token\x20=?','getAdmin','answerNotSeqNumOrChar','sep','/getUserPower','testCount','/addUser','/getAllUser','12905vGVwkB','DELETE\x20FROM\x20movie_library','You\x20can\x27t\x20delete\x20admin\x20account','findByUsername','Error','DELETE\x20FROM\x20album_ordinary','/setUserPower','version','getIpListCountByWhere','DELETE\x20FROM\x20book_favorite','login.pwdErr','DELETE\x20FROM\x20share_temp','value','prepare','DELETE\x20FROM\x20user_token','apiPortHttps','DELETE\x20FROM\x20config\x20where\x20title\x20in\x20(\x27nasAccountInfo\x27)','searchKey','customLogoImage','/checkIsNasServer','client','find','exports','log','1030Gakphr','body','pageUrl_agreement','delete','3480324yDLIWw','createOrUpdatePower','region','isAdmin','/logout','post','dialog','DELETE\x20FROM\x20album','/login','login.adminAdded','../utils/fileUtils','customLoginTitle','DELETE\x20FROM\x20album_ordinary_index','updateById','headers','login.pwdErrCountTooMuch','user_remark','getTime','^[0-9a-zA-Z]*$','newUserParamsNull','1782942dOCDCh','err','menus','pageUrl_privacy','DELETE\x20FROM\x20file_index_photo','username','DELETE\x20FROM\x20ai_classes','remark','SELECT\x20id,username,is_admin,user_remark\x20FROM\x20user\x20','DELETE\x20FROM\x20book_list_index','banTimeStamp','deleteIp','deleteUserTokenByWhere','2dUkAhC','/tokenLogin','DELETE\x20FROM\x20bg_task','getUrlByUrlKey','ceil','fileShareRestart','/changeQuestion','json','DELETE\x20FROM\x20movie_keys','sha256','refreshIpList','answer','DELETE\x20FROM\x20notice_center','send','DELETE\x20FROM\x20login_ip_list','passwordKey','\x20WHERE\x20username\x20like\x20?\x20or\x20user_remark\x20like\x20?','Router','addIpToList','usernameAndPwdCannotBeSame','params\x20error','localhost','../../db/dbMovieFavorite','customHomeBgImage','findByTitle','login.wrongNameOrPwd','stringify','DELETE\x20FROM\x20source_folder','DELETE\x20FROM\x20file_share_user','returnErrMsg','5512948OpcroI','/addIpToList','length','path','checkAnswer','DELETE\x20FROM\x20config','language','usernameTooEasy','isIncludeChinese','\x20order\x20by\x20id\x20desc\x20limit\x20?\x20offset\x20?','changes','\x20offset\x20','join','need\x20username/menuList','oldPassword','/hasAdmin','orderType','dbOther','removeUserPlayList','FTP','\x20order\x20by\x20id\x20desc\x20limit\x20','run','getUserPower','DELETE\x20FROM\x20file_share','login.answerIsWrong','path.parentPathExist','end','/resetPwd','/registAdmin','addLoginRecord','../utils/cryptoUtils','userNotExist','black','/getRecordList','answerQuestionCannotBeSame','isEasyUsername','deletePowerByUsername','login','Need\x20token','SELECT\x20*\x20FROM\x20user\x20WHERE\x20username=?','1935840DpOQka','127.0.0.1','764070NTwrsX','92yTnHWg','DELETE\x20FROM\x20music_playlist','twoStepLogin','deleteFavoriteByUid','add','httpsIsRunning','status','../../db/dbNoticeCenterTable','updateByUsername','DELETE\x20FROM\x20file_index_movie','error','get','\x201=1','desc','isSameStr','\x20end_timestamp\x20is\x20not\x20null\x20and\x20end_timestamp<','/changePassword','encryptString','create','/remarkUser','app','state','DELETE\x20FROM\x20backup_task_record','123129pbQPBT','startsWith','updateQuestionById','globalIpList','nasProxyRestart','../../db/dbLoginTable','createToken','catch','question','apiServerHttps','user-agent','DELETE\x20FROM\x20login_record','ipList','../utils/checkUtil','express','getRecordCountByWhere','username\x20error','deleteIpByWhere','../../db/dbMusicIndexTable','DELETE\x20FROM\x20file_record','DELETE\x20FROM\x20movie_history','orderField','DELETE\x20FROM\x20file_index_music','getAllRecordByWhere','\x20ORDER\x20BY\x20','ddnsIpv6Address','asc','publicUserName','newQuestion','getClientIp','DELETE\x20FROM\x20book_list','login.oldPwdErr','/removeIp','DELETE\x20FROM\x20backup_task','DELETE\x20FROM\x20backup_task_msg','dbFileIndex','type','operationFail','all','../../../package.json','ipv4','is_admin','DELETE\x20FROM\x20book_read_record','parse','findByTitleParamsList','count','page','ipBan'];_0x3eac=function(){return _0x189df9;};return _0x3eac();}function getIpBanConfig(_0x190627,_0x53673c){const _0x518eda=_0x26231d;let _0x4e892f=![],_0x15ade9=0x1,_0x244c51=0x1;if(_0x53673c!=_0x518eda(0x136)){let _0x575cc9=dbConfigTable['findByTitle'](_0x190627[_0x518eda(0x17e)][_0x518eda(0x150)],_0x518eda(0x1b0));_0x575cc9&&(_0x575cc9=JSON[_0x518eda(0x1ac)](_0x575cc9[_0x518eda(0xf0)]),_0x575cc9&&(_0x575cc9['enable']&&(_0x4e892f=!![]),_0x15ade9=_0x575cc9[_0x518eda(0xe1)],_0x244c51=_0x575cc9['banTime']));}return{'enableBan':_0x4e892f,'maxTestCount':_0x15ade9,'banTimeMin':_0x244c51};}function addBanIp(_0x16fa80,_0x20e150,_0x569313){const _0x4a39eb=_0x26231d;let {enableBan:_0x5655b9,maxTestCount:_0x51c419,banTimeMin:_0x3c32b2}=getIpBanConfig(_0x16fa80,_0x569313);if(_0x5655b9){let _0x41d25f=null;for(let _0x12d6dd in banIpList){banIpList[_0x12d6dd]['ip']==_0x569313&&(_0x41d25f=banIpList[_0x12d6dd],banIpList[_0x12d6dd][_0x4a39eb(0xe1)]+=0x1);}!_0x41d25f&&(_0x41d25f={'ip':_0x569313,'testCount':0x1},banIpList[_0x4a39eb(0x1b2)](_0x41d25f));if(_0x41d25f[_0x4a39eb(0xe1)]>=_0x51c419){let _0x8ed920=new Date()[_0x4a39eb(0x111)](),_0x4d28e5=_0x8ed920+_0x3c32b2*0x3c*0x3e8;dbLoginTable[_0x4a39eb(0x133)](_0x16fa80[_0x4a39eb(0x17e)][_0x4a39eb(0x150)],_0x4a39eb(0x15f),_0x569313,_0x4d28e5,_0x20e150['__'](_0x4a39eb(0x10f))),_0x16fa80[_0x4a39eb(0x17e)][_0x4a39eb(0x12b)](),dbNoticeCenterTable[_0x4a39eb(0x17c)](_0x16fa80[_0x4a39eb(0x17e)]['dbOther'],{'title':_0x20e150['__'](_0x4a39eb(0xdb)),'level':_0x4a39eb(0x174),'content':_0x20e150['__']('login.tooManyPwdTestIpBan')+('['+_0x569313+']')});for(let _0x2595cc in banIpList){banIpList[_0x2595cc]['ip']==_0x569313&&banIpList['splice'](_0x2595cc,0x1);}}}}router[_0x26231d(0x105)](_0x26231d(0x108),(_0x273ab9,_0x466606,_0x5f2fe3)=>{const _0x452c34=_0x26231d;let _0x1cd51a=_0x273ab9['body'][_0x452c34(0x119)],_0x64475a=_0x273ab9[_0x452c34(0xfd)][_0x452c34(0xd8)];if(!_0x1cd51a||!_0x64475a)return _0x466606['status'](0x194)[_0x452c34(0x159)]();_0x64475a=fileUtil['decodeBase64'](_0x64475a);let _0xc968a8=netUtils[_0x452c34(0x19e)](_0x273ab9);cryptoUtils[_0x452c34(0x17b)](config['passwordKey'],_0x64475a)[_0x452c34(0xd4)](_0x3e7ca8=>{const _0x448fdc=_0x452c34;let _0x369c70=dbUserTable['login'](_0x273ab9[_0x448fdc(0x17e)][_0x448fdc(0x150)],_0x1cd51a,_0x3e7ca8);if(_0x369c70){function _0x2dc0b(){const _0x5838c4=_0x448fdc;if(_0xc968a8!='localhost'){let _0x117bdd=dbConfigTable[_0x5838c4(0x139)](_0x273ab9[_0x5838c4(0x17e)]['dbOther'],_0x5838c4(0x16c));if(_0x117bdd&&_0x117bdd[_0x5838c4(0xf0)]=='1'){let _0x5e4d80=_0x273ab9[_0x5838c4(0xfd)][_0x5838c4(0x12c)];if(_0x5e4d80){_0x5e4d80=sha256(_0x5e4d80);let _0x42943d=dbUserTable[_0x5838c4(0x143)](_0x273ab9[_0x5838c4(0x17e)]['dbOther'],_0x1cd51a,_0x5e4d80);if(!_0x42943d)return _0x273ab9[_0x5838c4(0x17e)]['returnErrMsg'](_0x466606,_0x466606['__'](_0x5838c4(0x157)));}else return _0x466606['json']({'code':0x2,'question':_0x369c70['question']});}}dbLoginTable['addLoginRecord'](_0x273ab9[_0x5838c4(0x17e)]['dbOther'],_0x5838c4(0x164),_0x1cd51a,_0xc968a8,_0x273ab9[_0x5838c4(0xfd)][_0x5838c4(0xf8)],_0x273ab9[_0x5838c4(0x10e)][_0x5838c4(0x18b)]);let _0xf27510=sha256(new Date()[_0x5838c4(0x111)]()+_0x1cd51a+_0x3e7ca8);var _0x3acb5d=_0x273ab9[_0x5838c4(0x10e)][_0x5838c4(0x18b)];return dbUserTable[_0x5838c4(0x187)](_0x273ab9[_0x5838c4(0x17e)]['dbOther'],_0x369c70['id'],_0xf27510,_0xc968a8,_0x3acb5d),_0x369c70[_0x5838c4(0xd8)]='',_0x369c70[_0x5838c4(0x12c)]='',_0x466606[_0x5838c4(0x128)]({'code':0x0,'token':_0xf27510,'user':_0x369c70,'version':package[_0x5838c4(0xeb)],'reqIp':_0xc968a8});}return _0x2dc0b();}else return addBanIp(_0x273ab9,_0x466606,_0xc968a8),dbLoginTable[_0x448fdc(0x15c)](_0x273ab9[_0x448fdc(0x17e)][_0x448fdc(0x150)],_0x466606['__'](_0x448fdc(0x13a)),_0x1cd51a,_0xc968a8,_0x273ab9[_0x448fdc(0xfd)]['client'],_0x273ab9[_0x448fdc(0x10e)][_0x448fdc(0x18b)]),_0x273ab9['app'][_0x448fdc(0x13e)](_0x466606,_0x466606['__'](_0x448fdc(0x13a)));})['catch'](_0x4e1dce=>{const _0xea7c5e=_0x452c34;return console['log'](_0x4e1dce),_0x273ab9[_0xea7c5e(0x17e)]['returnErrMsg'](_0x466606,_0x466606['__'](_0xea7c5e(0x1a6)));});}),router['post'](_0x26231d(0x122),(_0x85e6dc,_0x19b091,_0x10c741)=>{const _0x483aed=_0x26231d;let _0x2ed92b=netUtils[_0x483aed(0x19e)](_0x85e6dc),_0x2db730=_0x85e6dc[_0x483aed(0xfd)]['token'];if(!_0x2db730)return _0x85e6dc[_0x483aed(0x17e)][_0x483aed(0x13e)](_0x19b091,_0x483aed(0x165));let _0x1020c4=dbUserTable['getUserByToken'](_0x85e6dc[_0x483aed(0x17e)][_0x483aed(0x150)],_0x2db730);if(!_0x1020c4)return _0x85e6dc[_0x483aed(0x17e)][_0x483aed(0x13e)](_0x19b091,_0x19b091['__']('TokenExpired'));return _0x1020c4['password']='',_0x1020c4[_0x483aed(0x12c)]='',_0x19b091['json']({'code':0x0,'token':_0x2db730,'user':_0x1020c4,'reqIp':_0x2ed92b});}),router['post']('/resetSystem',(_0x3598d4,_0x3451ff,_0xb8003d)=>{const _0x5be75a=_0x26231d;let _0x33493a=_0x3598d4[_0x5be75a(0xfd)][_0x5be75a(0xd8)];if(_0x3598d4['currentUser']&&_0x3598d4[_0x5be75a(0xd7)][_0x5be75a(0x1aa)]!=0x1)return _0x3451ff['json']({'code':0x66});cryptoUtils[_0x5be75a(0x17b)](config[_0x5be75a(0x130)],_0x33493a)[_0x5be75a(0xd4)](_0x5cc52c=>{const _0x134d17=_0x5be75a;if(_0x3598d4[_0x134d17(0xd7)][_0x134d17(0xd8)]!=_0x5cc52c)return _0x3451ff['json']({'code':0x1,'message':_0x3451ff['__'](_0x134d17(0xee))});fs['rm'](path[_0x134d17(0x14b)](config['cacheParentPath']),{'recursive':!![]},_0x1ba2a6=>{const _0x590876=_0x134d17;if(_0x1ba2a6)return _0x3451ff['json']({'code':0x1,'message':_0x590876(0xe8)});return _0x3598d4[_0x590876(0x17e)][_0x590876(0x150)]['prepare'](_0x590876(0x144))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0x107))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0x1a2))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0x1a3))[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x150)]['prepare'](_0x590876(0x180))[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0x123))[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0xf4))['run'](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)]('DELETE\x20FROM\x20file_operation_record')[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x150)]['prepare'](_0x590876(0x194))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)]['dbOther'][_0x590876(0xf1)](_0x590876(0x156))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)]['dbOther'][_0x590876(0xf1)](_0x590876(0x13d))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0x12f))['run'](),_0x3598d4['app'][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0x18c))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)]['dbOther'][_0x590876(0xf1)](_0x590876(0x12d))[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x150)]['prepare']('DELETE\x20FROM\x20play_record')[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)]('DELETE\x20FROM\x20private_space')[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0x1b1))[_0x590876(0x154)](),_0x3598d4['app']['dbOther'][_0x590876(0xf1)](_0x590876(0xef))[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0x13c))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)]('DELETE\x20FROM\x20user')[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)](_0x590876(0xf2))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x150)][_0x590876(0xf1)]('DELETE\x20FROM\x20user_power')['run'](),_0x3598d4['app'][_0x590876(0x1a4)][_0x590876(0xf1)](_0x590876(0x11a))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)]['prepare']('DELETE\x20FROM\x20ai_classes2index')[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)]['dbFileIndex']['prepare'](_0x590876(0xe9))['run'](),_0x3598d4['app'][_0x590876(0x1a4)][_0x590876(0xf1)](_0x590876(0x10c))['run'](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)][_0x590876(0xf1)](_0x590876(0x173))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)]['prepare'](_0x590876(0x118))['run'](),_0x3598d4[_0x590876(0x17e)]['dbFileIndex'][_0x590876(0xf1)](_0x590876(0x197))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)][_0x590876(0xf1)]('DELETE\x20FROM\x20file_index_book')[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)][_0x590876(0xf1)]('DELETE\x20FROM\x20photo_faces')[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)]['prepare']('DELETE\x20FROM\x20photo_faces2index')[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)]['dbFileIndex'][_0x590876(0xf1)](_0x590876(0x129))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)][_0x590876(0xf1)]('DELETE\x20FROM\x20movie_collection')[_0x590876(0x154)](),_0x3598d4['app']['dbFileIndex']['prepare'](_0x590876(0x195))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)]['prepare'](_0x590876(0xe5))[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x1a4)][_0x590876(0xf1)]('DELETE\x20FROM\x20photo_phash_similar')[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)]['prepare']('DELETE\x20FROM\x20music_favorite')[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)][_0x590876(0xf1)](_0x590876(0x16b))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)]['prepare']('DELETE\x20FROM\x20music_playlist_index')[_0x590876(0x154)](),_0x3598d4['app'][_0x590876(0x1a4)]['prepare'](_0x590876(0xed))['run'](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)]['prepare'](_0x590876(0x19f))[_0x590876(0x154)](),_0x3598d4[_0x590876(0x17e)][_0x590876(0x1a4)]['prepare'](_0x590876(0x11d))['run'](),_0x3598d4['app']['dbFileIndex'][_0x590876(0xf1)](_0x590876(0x1ab))[_0x590876(0x154)](),process[_0x590876(0x12e)]({'type':_0x590876(0x126),'shareType':_0x590876(0x152)}),process[_0x590876(0x12e)]({'type':'fileShareRestart','shareType':'WebDav'}),process[_0x590876(0x12e)]({'type':_0x590876(0x185)}),process['send']({'type':'createUserFolder'}),_0x3451ff[_0x590876(0x128)]({'code':0x0});});});}),router['post']('/resetPwdInfo',(_0x5c9055,_0x4cbc78,_0x350b5d)=>{const _0xcc3742=_0x26231d;let _0x26d804=netUtils[_0xcc3742(0x19e)](_0x5c9055),_0x3cc0c7=dbUserTable[_0xcc3742(0xdd)](_0x5c9055[_0xcc3742(0x17e)][_0xcc3742(0x150)]),_0x24bd3f={};_0x26d804==_0xcc3742(0x136)&&(_0x24bd3f[_0xcc3742(0x119)]=_0x3cc0c7['username']),_0x24bd3f[_0xcc3742(0x189)]=_0x3cc0c7[_0xcc3742(0x189)],_0x4cbc78[_0xcc3742(0x128)]({'code':0x0,'data':_0x24bd3f});}),router[_0x26231d(0x1a7)](_0x26231d(0xf7),(_0x33b9d1,_0x2faeca,_0x3546e3)=>{const _0x4957d5=_0x26231d;let _0x528846={'code':0x0,'message':'NodeNasServer','version':package[_0x4957d5(0xeb)],'hostName':OS['hostname']()},_0x60a679=_0x33b9d1['query']['ignoreIp'];if(_0x60a679&&_0x60a679==0x1)return _0x2faeca['json'](_0x528846);let _0x4b05c6=0x50,_0x3ad748=dbConfigTable['findByTitle'](_0x33b9d1[_0x4957d5(0x17e)][_0x4957d5(0x150)],'apiPort');_0x3ad748&&_0x3ad748[_0x4957d5(0xf0)]&&(_0x4b05c6=_0x3ad748['value']);let _0x345c8d=0x1bb,_0x438da4=dbConfigTable['findByTitle'](_0x33b9d1['app'][_0x4957d5(0x150)],_0x4957d5(0xf3));_0x438da4&&_0x438da4[_0x4957d5(0xf0)]&&_0x438da4[_0x4957d5(0xf0)]>0x0&&_0x438da4[_0x4957d5(0xf0)]<0xffff&&(_0x345c8d=_0x438da4[_0x4957d5(0xf0)]);let _0x33acca=0x0,_0x33a4c6=dbConfigTable[_0x4957d5(0x139)](_0x33b9d1['app'][_0x4957d5(0x150)],_0x4957d5(0x18a));if(_0x33a4c6&&_0x33a4c6[_0x4957d5(0xf0)])try{_0x33a4c6=JSON[_0x4957d5(0x1ac)](_0x33a4c6[_0x4957d5(0xf0)]),_0x33a4c6[_0x4957d5(0x17f)]==_0x4957d5(0x154)&&(_0x33acca=0x1);}catch(_0xc4abda){}try{let _0x54f467=dbConfigTable[_0x4957d5(0x139)](_0x33b9d1[_0x4957d5(0x17e)][_0x4957d5(0x150)],_0x4957d5(0x184)),_0x19637f=dbConfigTable['findByTitle'](_0x33b9d1[_0x4957d5(0x17e)]['dbOther'],_0x4957d5(0x19a));if(_0x54f467){_0x54f467=JSON[_0x4957d5(0x1ac)](_0x54f467[_0x4957d5(0xf0)]);let _0x597cc8=[];if(_0x19637f&&_0x19637f['value']){for(let _0x1bfd7b in _0x54f467){let _0x122936=_0x54f467[_0x1bfd7b];_0x122936['type']==_0x4957d5(0x1a9)&&_0x597cc8[_0x4957d5(0x1b2)](_0x122936);}_0x597cc8[_0x4957d5(0x1b2)]({'type':_0x4957d5(0xd5),'ip':_0x19637f[_0x4957d5(0xf0)],'ddns':0x1}),_0x54f467=_0x597cc8;}}return _0x528846[_0x4957d5(0x18d)]=_0x54f467,_0x528846['apiPort']=parseInt(_0x4b05c6),_0x528846[_0x4957d5(0xf3)]=parseInt(_0x345c8d),_0x528846[_0x4957d5(0x16f)]=_0x33acca,_0x2faeca[_0x4957d5(0x128)](_0x528846);}catch(_0x800525){return _0x2faeca[_0x4957d5(0x128)](_0x528846);}}),router['post'](_0x26231d(0x15a),(_0x45b3d9,_0x1e6e7c,_0x27afc3)=>{const _0x2c1d9b=_0x26231d;let _0x205ca3=_0x45b3d9[_0x2c1d9b(0xfd)][_0x2c1d9b(0x119)],_0x4d9214=_0x45b3d9[_0x2c1d9b(0xfd)][_0x2c1d9b(0xd8)],_0x25ae8b=_0x45b3d9[_0x2c1d9b(0xfd)][_0x2c1d9b(0x12c)],_0x11687b=_0x45b3d9[_0x2c1d9b(0x17e)][_0x2c1d9b(0x150)]['prepare'](_0x2c1d9b(0x166))[_0x2c1d9b(0x175)](_0x205ca3);if(!_0x11687b)return _0x45b3d9[_0x2c1d9b(0x17e)][_0x2c1d9b(0x13e)](_0x1e6e7c,_0x1e6e7c['__'](_0x2c1d9b(0x15e)));try{_0x25ae8b=sha256(_0x25ae8b);let _0x587a42=dbUserTable[_0x2c1d9b(0x143)](_0x45b3d9[_0x2c1d9b(0x17e)][_0x2c1d9b(0x150)],_0x205ca3,_0x25ae8b);if(_0x587a42)cryptoUtils['encryptString'](config[_0x2c1d9b(0x130)],_0x4d9214)[_0x2c1d9b(0xd4)](_0x447d92=>{const _0x3062fe=_0x2c1d9b;dbUserTable[_0x3062fe(0x172)](_0x45b3d9[_0x3062fe(0x17e)]['dbOther'],_0x205ca3,_0x3062fe(0xd8),_0x447d92);let _0x125810=sha256(new Date()[_0x3062fe(0x111)]()+_0x205ca3+_0x4d9214);dbUserTable[_0x3062fe(0x172)](_0x45b3d9['app']['dbOther'],_0x205ca3,_0x3062fe(0xda),_0x125810),_0x1e6e7c[_0x3062fe(0x128)]({'code':0x0});})[_0x2c1d9b(0x188)](_0x3c9a74=>{const _0x156808=_0x2c1d9b;return console[_0x156808(0xfb)]('error',_0x3c9a74),_0x45b3d9[_0x156808(0x17e)][_0x156808(0x13e)](_0x1e6e7c,_0x1e6e7c['__'](_0x156808(0x1a6)));});else return _0x45b3d9[_0x2c1d9b(0x17e)][_0x2c1d9b(0x13e)](_0x1e6e7c,_0x1e6e7c['__'](_0x2c1d9b(0x157)));}catch(_0x36073f){return console[_0x2c1d9b(0xfb)](_0x2c1d9b(0x115),_0x36073f),_0x1e6e7c[_0x2c1d9b(0x170)](0x194)[_0x2c1d9b(0x159)]();}});function newUserCheck(_0x5db9de,_0x2ae0c9,_0x17b5e8,_0x589d0b,_0x45099d,_0x4a472e){const _0x585c97=_0x26231d;if(!_0x589d0b||!_0x17b5e8||!_0x5db9de||!_0x2ae0c9)return _0x45099d[_0x585c97(0x17e)][_0x585c97(0x13e)](_0x4a472e,_0x4a472e['__'](_0x585c97(0x113)));let _0x16feb4=new RegExp(_0x585c97(0x112));if(!_0x16feb4['test'](_0x5db9de)||_0x5db9de==config[_0x585c97(0x19c)])return _0x45099d[_0x585c97(0x17e)][_0x585c97(0x13e)](_0x4a472e,_0x4a472e['__']('usernameReg'));if(_0x5db9de==_0x2ae0c9)return _0x45099d[_0x585c97(0x17e)]['returnErrMsg'](_0x4a472e,_0x4a472e['__'](_0x585c97(0x134)));if(checkUtil[_0x585c97(0x162)](_0x5db9de))return _0x45099d[_0x585c97(0x17e)]['returnErrMsg'](_0x4a472e,_0x4a472e['__'](_0x585c97(0x146)));if(_0x17b5e8==_0x589d0b)return _0x45099d['app'][_0x585c97(0x13e)](_0x4a472e,_0x4a472e['__'](_0x585c97(0x161)));if(checkUtil[_0x585c97(0x147)](_0x2ae0c9))return _0x45099d[_0x585c97(0x17e)][_0x585c97(0x13e)](_0x4a472e,_0x4a472e['__']('pwdCannotBeChinese'));return!![];}router[_0x26231d(0x105)](_0x26231d(0x15b),(_0x3e719d,_0x4b95ad,_0xbcdf1e)=>{const _0x81f6e7=_0x26231d;let _0x32c009=_0x3e719d['body']['username'],_0x8031b0=_0x3e719d[_0x81f6e7(0xfd)][_0x81f6e7(0xd8)],_0x1bad86=_0x3e719d['body'][_0x81f6e7(0x189)],_0x337eac=_0x3e719d[_0x81f6e7(0xfd)][_0x81f6e7(0x12c)];if(!_0x337eac||!_0x1bad86||!_0x32c009||!_0x8031b0)return _0x4b95ad[_0x81f6e7(0x128)]({'code':0x1,'message':_0x81f6e7(0x135)});let _0x24af3d=dbUserTable[_0x81f6e7(0xdd)](_0x3e719d[_0x81f6e7(0x17e)][_0x81f6e7(0x150)]);if(_0x24af3d)_0x4b95ad[_0x81f6e7(0x128)]({'code':0x1,'message':_0x4b95ad['__']('login.adminExist')});else{if(newUserCheck(_0x32c009,_0x8031b0,_0x1bad86,_0x337eac,_0x3e719d,_0x4b95ad)!==!![])return;_0x337eac=sha256(_0x337eac),cryptoUtils[_0x81f6e7(0x17b)](config[_0x81f6e7(0x130)],_0x8031b0)[_0x81f6e7(0xd4)](_0x2ef65a=>{const _0xecdf7=_0x81f6e7;let _0x38886e=dbUserTable['create'](_0x3e719d[_0xecdf7(0x17e)][_0xecdf7(0x150)],{'username':_0x32c009,'password':_0x2ef65a,'question':_0x1bad86,'answer':_0x337eac,'is_admin':0x1});if(_0x38886e[_0xecdf7(0x149)]>0x0){let _0x4de14d=dbUserTable['getAdmin'](_0x3e719d[_0xecdf7(0x17e)][_0xecdf7(0x150)]),_0x4bb05d=sha256(new Date()['getTime']()+_0x32c009+_0x2ef65a),_0x19549c=netUtils[_0xecdf7(0x19e)](_0x3e719d);var _0x3e917f=_0x3e719d[_0xecdf7(0x10e)][_0xecdf7(0x18b)];dbUserTable['createToken'](_0x3e719d[_0xecdf7(0x17e)][_0xecdf7(0x150)],_0x4de14d['id'],_0x4bb05d,_0x19549c,_0x3e917f),_0x4de14d[_0xecdf7(0xd8)]='';let _0x7604ef=_0x3e719d[_0xecdf7(0xfd)][_0xecdf7(0x145)],_0x3710c5=_0x3e719d['body'][_0xecdf7(0x102)];return _0x7604ef&&dbConfigTable[_0xecdf7(0x17c)](_0x3e719d['app'][_0xecdf7(0x150)],{'title':'language','value':_0x7604ef}),_0x3710c5&&dbConfigTable['create'](_0x3e719d[_0xecdf7(0x17e)][_0xecdf7(0x150)],{'title':_0xecdf7(0x102),'value':_0x3710c5}),_0x4b95ad[_0xecdf7(0x128)]({'code':0x0,'token':_0x4bb05d,'user':_0x4de14d});}})['catch'](_0x4a93ee=>{const _0x550005=_0x81f6e7;return console[_0x550005(0xfb)]('error',_0x4a93ee),_0x3e719d[_0x550005(0x17e)]['returnErrMsg'](_0x4b95ad,_0x4b95ad['__'](_0x550005(0x1a6)));});}}),router[_0x26231d(0x105)](_0x26231d(0x17d),(_0x3529a3,_0x592505,_0x553f36)=>{const _0x5bbf35=_0x26231d;if(_0x3529a3[_0x5bbf35(0xd7)]['is_admin']!=0x1)return _0x592505[_0x5bbf35(0x128)]({'code':0x66});let _0x5bedf9=_0x3529a3[_0x5bbf35(0xfd)][_0x5bbf35(0x119)],_0x2784ca=_0x3529a3[_0x5bbf35(0xfd)][_0x5bbf35(0x11b)];return _0x5bedf9&&_0x2784ca&&dbUserTable['updateRemarkByUsername'](_0x3529a3['app'][_0x5bbf35(0x150)],_0x5bedf9,_0x2784ca),_0x592505[_0x5bbf35(0x128)]({'code':0x0});}),router[_0x26231d(0x105)](_0x26231d(0xe2),(_0x3f872e,_0x32d1d4,_0x144d86)=>{const _0x1c576b=_0x26231d;let _0x6f10ac=_0x3f872e[_0x1c576b(0xfd)][_0x1c576b(0x119)],_0x149b79=_0x3f872e['body'][_0x1c576b(0xd8)],_0x51fecb=_0x3f872e[_0x1c576b(0xfd)][_0x1c576b(0x189)],_0x423b27=_0x3f872e[_0x1c576b(0xfd)][_0x1c576b(0x12c)],_0xfd9c64=_0x3f872e['body'][_0x1c576b(0x11b)];if(newUserCheck(_0x6f10ac,_0x149b79,_0x51fecb,_0x423b27,_0x3f872e,_0x32d1d4)!==!![])return;let _0x2ca750=_0x3f872e['body']['type'];if(dbUserTable[_0x1c576b(0x103)](_0x3f872e,_0x32d1d4)===!![]){if(_0x2ca750==_0x1c576b(0x16e)){let _0x29738f=dbUserTable[_0x1c576b(0xe7)](_0x3f872e[_0x1c576b(0x17e)][_0x1c576b(0x150)],_0x6f10ac);if(_0x29738f)return _0x3f872e['app'][_0x1c576b(0x13e)](_0x32d1d4,_0x32d1d4['__']('login.sameUsernameExist'));}cryptoUtils[_0x1c576b(0x17b)](config[_0x1c576b(0x130)],_0x149b79)[_0x1c576b(0xd4)](_0x797789=>{const _0x2091d7=_0x1c576b;let _0x3e788c=dbUserTable[_0x2091d7(0x17c)](_0x3f872e[_0x2091d7(0x17e)][_0x2091d7(0x150)],{'username':_0x6f10ac,'password':_0x797789,'question':_0x51fecb,'answer':sha256(_0x423b27),'remark':_0xfd9c64});return _0x3e788c['changes']>=0x1?_0x32d1d4['json']({'code':0x0}):_0x3f872e[_0x2091d7(0x17e)]['returnErrMsg'](_0x32d1d4,_0x32d1d4['__'](_0x2091d7(0x1a6)));})[_0x1c576b(0x188)](_0x3d4104=>{const _0x2bf470=_0x1c576b;return console[_0x2bf470(0xfb)](_0x2bf470(0x174),_0x3d4104),_0x3f872e[_0x2bf470(0x17e)][_0x2bf470(0x13e)](_0x32d1d4,_0x32d1d4['__'](_0x2bf470(0x1a6)));});}}),router[_0x26231d(0x105)]('/removeUser',(_0x5466f2,_0x1f414f,_0x5ae4eb)=>{const _0x2f8b5e=_0x26231d;let _0xe70a29=_0x5466f2[_0x2f8b5e(0xfd)]['uid'];if(dbUserTable[_0x2f8b5e(0x103)](_0x5466f2,_0x1f414f)===!![]){let _0x39a993=dbUserTable[_0x2f8b5e(0xf9)](_0x5466f2['app'][_0x2f8b5e(0x150)],_0xe70a29);if(_0x39a993&&_0x39a993['is_admin']==0x1)return _0x1f414f['json']({'code':0x1,'message':_0x2f8b5e(0xe6)});dbUserTable[_0x2f8b5e(0x163)](_0x5466f2[_0x2f8b5e(0x17e)][_0x2f8b5e(0x150)],_0x39a993[_0x2f8b5e(0x119)]),dbMusicIndexTable[_0x2f8b5e(0x151)](_0x5466f2[_0x2f8b5e(0x17e)][_0x2f8b5e(0x1a4)],_0x39a993['id']),dbMusicFavorite['deleteFavoriteByUid'](_0x5466f2[_0x2f8b5e(0x17e)]['dbFileIndex'],_0x39a993['id']),dbMovieFavorite[_0x2f8b5e(0x16d)](_0x5466f2[_0x2f8b5e(0x17e)][_0x2f8b5e(0x1a4)],_0x39a993['id']);let _0x828f8c=dbUserTable[_0x2f8b5e(0xff)](_0x5466f2[_0x2f8b5e(0x17e)][_0x2f8b5e(0x150)],_0xe70a29);return _0x828f8c[_0x2f8b5e(0x149)]>=0x1?_0x1f414f[_0x2f8b5e(0x128)]({'code':0x0}):_0x5466f2[_0x2f8b5e(0x17e)][_0x2f8b5e(0x13e)](_0x1f414f,_0x1f414f['__'](_0x2f8b5e(0x1a6)));}}),router[_0x26231d(0x105)](_0x26231d(0xe3),(_0x2510d8,_0x529d0c,_0x5ead4e)=>{const _0xdc4ce5=_0x26231d;if(dbUserTable[_0xdc4ce5(0x103)](_0x2510d8,_0x529d0c)===!![]){let _0x777819=_0x2510d8[_0xdc4ce5(0xfd)][_0xdc4ce5(0x196)]||'id',_0x3f75fa=_0x2510d8[_0xdc4ce5(0xfd)][_0xdc4ce5(0x14f)]||_0xdc4ce5(0x19b),_0x545bd4=_0x2510d8[_0xdc4ce5(0xfd)][_0xdc4ce5(0xf5)];(!['id','username',_0xdc4ce5(0x110)][_0xdc4ce5(0x1b4)](_0x777819)||!['asc',_0xdc4ce5(0x177)][_0xdc4ce5(0x1b4)](_0x3f75fa))&&(_0x777819='id',_0x3f75fa=_0xdc4ce5(0x19b));let _0x50c03b=_0xdc4ce5(0x11c),_0x671dc9=[];_0x545bd4&&(_0x50c03b+=_0xdc4ce5(0x131),_0x671dc9[_0xdc4ce5(0x1b2)]('%'+_0x545bd4+'%','%'+_0x545bd4+'%'));_0x50c03b+=_0xdc4ce5(0x199)+_0x777819+'\x20'+_0x3f75fa;let _0x2ee9d6=_0x2510d8['app']['dbOther'][_0xdc4ce5(0xf1)](_0x50c03b)[_0xdc4ce5(0x1a7)](_0x671dc9);return _0x529d0c[_0xdc4ce5(0x128)]({'code':0x0,'userList':_0x2ee9d6});}}),router['post'](_0x26231d(0xe0),(_0x1b5bde,_0x4cc161,_0x5be1c1)=>{const _0x869235=_0x26231d;let _0x419baa=_0x1b5bde[_0x869235(0xfd)][_0x869235(0x119)],_0x532b45=null;if(_0x419baa!=config[_0x869235(0x19c)]){_0x532b45=dbUserTable['getUserByUserName'](_0x1b5bde[_0x869235(0x17e)][_0x869235(0x150)],_0x419baa);if(!_0x532b45)return _0x1b5bde[_0x869235(0x17e)][_0x869235(0x13e)](_0x4cc161,_0x869235(0x191));}if(dbUserTable[_0x869235(0x103)](_0x1b5bde,_0x4cc161)===!![]||_0x419baa==_0x1b5bde['currentUser'][_0x869235(0x119)]){let _0xb99ec5=dbUserTable['getUserPower'](_0x1b5bde[_0x869235(0x17e)][_0x869235(0x150)],_0x419baa,null,null,!![]),_0x4f51db=0x0;if(_0xb99ec5[_0x869235(0x141)]<0x1)return _0x4cc161[_0x869235(0x128)]({'code':0x0,'userPower':_0xb99ec5,'userMenu':_0x532b45?_0x532b45['menus']:[]});for(let _0x3cfa5f=0x0;_0x3cfa5f<_0xb99ec5['length'];_0x3cfa5f++){let _0x1cf722=_0xb99ec5[_0x3cfa5f][_0x869235(0x142)];fs['stat'](_0x1cf722,(_0x504fb1,_0x426673)=>{const _0xda1063=_0x869235;_0x4f51db+=0x1;_0x504fb1?_0xb99ec5[_0x3cfa5f]['exist']=0x0:_0xb99ec5[_0x3cfa5f]['exist']=0x1;if(_0x4f51db==_0xb99ec5[_0xda1063(0x141)])return _0x4cc161[_0xda1063(0x128)]({'code':0x0,'userPower':_0xb99ec5,'userMenu':_0x532b45?_0x532b45['menus']:[]});});}}}),router[_0x26231d(0x105)](_0x26231d(0xea),(_0x2a1bbb,_0x3054b3,_0x2acf19)=>{const _0x1549ed=_0x26231d;let _0x7929b3=_0x2a1bbb[_0x1549ed(0xfd)]['username'],_0x5776d8=_0x2a1bbb[_0x1549ed(0xfd)]['path'],_0x2b3000=_0x2a1bbb[_0x1549ed(0xfd)][_0x1549ed(0xd3)];if(!_0x7929b3||!_0x5776d8||!_0x2b3000)return _0x2a1bbb[_0x1549ed(0x17e)]['returnErrMsg'](_0x3054b3,_0x3054b3['__'](_0x1549ed(0x1a6)));let _0x5c83a8=null;if(_0x7929b3!=config[_0x1549ed(0x19c)]){_0x5c83a8=dbUserTable[_0x1549ed(0x1b3)](_0x2a1bbb['app'][_0x1549ed(0x150)],_0x7929b3);if(!_0x5c83a8)return _0x2a1bbb['app'][_0x1549ed(0x13e)](_0x3054b3,_0x1549ed(0x191));}_0x5776d8=pathUtil[_0x1549ed(0x14b)](_0x5776d8);if(dbUserTable[_0x1549ed(0x103)](_0x2a1bbb,_0x3054b3)===!![]){let _0xab139d=dbUserTable[_0x1549ed(0x155)](_0x2a1bbb[_0x1549ed(0x17e)]['dbOther'],_0x7929b3,_0x2b3000,null,!![]);for(let _0xf9f3a0 of _0xab139d){let _0x511f1b=_0xf9f3a0[_0x1549ed(0x142)];if(_0x5776d8[_0x1549ed(0x182)](pathUtil['join'](_0x511f1b,pathUtil['sep']))&&_0x5776d8!=_0x511f1b)return _0x2a1bbb[_0x1549ed(0x17e)]['returnErrMsg'](_0x3054b3,_0x3054b3['__'](_0x1549ed(0x158))+_0x511f1b,_0x1549ed(0x106));if(_0x511f1b['startsWith'](pathUtil[_0x1549ed(0x14b)](_0x5776d8,pathUtil[_0x1549ed(0xdf)]))&&_0x5776d8!=_0x511f1b)return _0x2a1bbb[_0x1549ed(0x17e)]['returnErrMsg'](_0x3054b3,_0x3054b3['__'](_0x1549ed(0x158))+_0x511f1b,_0x1549ed(0x106));}let _0x3f93e1=dbUserTable[_0x1549ed(0x101)](_0x2a1bbb[_0x1549ed(0x17e)]['dbOther'],_0x2a1bbb['body']);return _0x3054b3[_0x1549ed(0x128)]({'code':0x0,'result':_0x3f93e1});}}),router['post']('/setUserMenu',(_0x566d48,_0x2de8e2,_0x5b695d)=>{const _0x30ad9c=_0x26231d;let _0x405460=_0x566d48[_0x30ad9c(0xfd)][_0x30ad9c(0x119)],_0x3d5e64=_0x566d48[_0x30ad9c(0xfd)]['menuList'];if(!_0x405460||!(_0x3d5e64 instanceof Array))return _0x566d48[_0x30ad9c(0x17e)][_0x30ad9c(0x13e)](_0x2de8e2,_0x30ad9c(0x14c));let _0x4b66b7=dbUserTable[_0x30ad9c(0x1b3)](_0x566d48['app'][_0x30ad9c(0x150)],_0x405460);if(!_0x4b66b7)return _0x566d48[_0x30ad9c(0x17e)][_0x30ad9c(0x13e)](_0x2de8e2,_0x30ad9c(0x191));if(dbUserTable['isAdmin'](_0x566d48,_0x2de8e2)===!![])return dbUserTable['updateByUsername'](_0x566d48[_0x30ad9c(0x17e)][_0x30ad9c(0x150)],_0x405460,_0x30ad9c(0x116),JSON[_0x30ad9c(0x13b)](_0x3d5e64)),_0x2de8e2['json']({'code':0x0});}),router['post']('/cancelUserPathPower',(_0x5ef0d3,_0xbb3518,_0x4a5f18)=>{const _0x5b5c30=_0x26231d;let _0x17afda=dbUserTable['cancelUserPathPower'](_0x5ef0d3['app'][_0x5b5c30(0x150)],_0x5ef0d3[_0x5b5c30(0xfd)]);return _0x17afda[_0x5b5c30(0x149)]>0x0?_0xbb3518[_0x5b5c30(0x128)]({'code':0x0}):_0x5ef0d3[_0x5b5c30(0x17e)][_0x5b5c30(0x13e)](_0xbb3518,_0xbb3518['__'](_0x5b5c30(0x1a6)));}),router[_0x26231d(0x105)](_0x26231d(0x17a),(_0x558fa1,_0x317108,_0x3a3c64)=>{const _0x4e788e=_0x26231d;let _0x5e0545=_0x558fa1[_0x4e788e(0xfd)][_0x4e788e(0x14d)],_0x539df0=_0x558fa1['body']['newPassword'];cryptoUtils[_0x4e788e(0x17b)](config['passwordKey'],_0x5e0545)[_0x4e788e(0xd4)](_0x5bcf65=>{const _0x528e6c=_0x4e788e;if(_0x558fa1[_0x528e6c(0xd7)][_0x528e6c(0xd8)]!=_0x5bcf65)return _0x317108[_0x528e6c(0x128)]({'code':0x2,'message':_0x317108['__'](_0x528e6c(0x1a0))});else cryptoUtils[_0x528e6c(0x17b)](config['passwordKey'],_0x539df0)[_0x528e6c(0xd4)](_0x67147f=>{const _0x40a842=_0x528e6c;dbUserTable[_0x40a842(0x10d)](_0x558fa1[_0x40a842(0x17e)][_0x40a842(0x150)],_0x558fa1['currentUser']['id'],_0x40a842(0xd8),_0x67147f);let _0x59114a=sha256(new Date()[_0x40a842(0x111)]()+_0x558fa1['currentUser'][_0x40a842(0x119)]+_0x558fa1[_0x40a842(0xd7)]['password']);dbUserTable['updateById'](_0x558fa1[_0x40a842(0x17e)][_0x40a842(0x150)],_0x558fa1['currentUser']['id'],_0x40a842(0xda),_0x59114a);let _0x5961e5=netUtils[_0x40a842(0x19e)](_0x558fa1);return dbLoginTable[_0x40a842(0x15c)](_0x558fa1['app'][_0x40a842(0x150)],'changePassword',_0x558fa1[_0x40a842(0xd7)]['id'],_0x5961e5,_0x558fa1[_0x40a842(0xfd)][_0x40a842(0xf8)],''),_0x317108[_0x40a842(0x128)]({'code':0x0});})[_0x528e6c(0x188)](_0xf0dad7=>{const _0x374acb=_0x528e6c;return console[_0x374acb(0xfb)]('error',_0xf0dad7),_0x558fa1[_0x374acb(0x17e)][_0x374acb(0x13e)](_0x317108,_0x317108['__'](_0x374acb(0x1a6)));});});}),router[_0x26231d(0x105)](_0x26231d(0x127),(_0xecad9c,_0x5d3d33,_0x6d7377)=>{const _0x59a3e1=_0x26231d;let _0x14e6a5=_0xecad9c['body'][_0x59a3e1(0x19d)],_0x3627a4=_0xecad9c[_0x59a3e1(0xfd)]['answer'];if(checkUtil[_0x59a3e1(0x178)](_0x3627a4))return _0xecad9c[_0x59a3e1(0x17e)][_0x59a3e1(0x13e)](_0x5d3d33,_0x5d3d33['__'](_0x59a3e1(0xde)));if(_0x14e6a5==_0x3627a4)return _0xecad9c[_0x59a3e1(0x17e)]['returnErrMsg'](_0x5d3d33,_0x5d3d33['__'](_0x59a3e1(0x161)));return dbUserTable[_0x59a3e1(0x183)](_0xecad9c[_0x59a3e1(0x17e)][_0x59a3e1(0x150)],_0xecad9c[_0x59a3e1(0xd7)]['id'],_0x14e6a5,sha256(_0x3627a4)),_0x5d3d33['json']({'code':0x0});}),router[_0x26231d(0x105)](_0x26231d(0x104),(_0x18a213,_0x2d5a74,_0x4be899)=>{const _0x1fcbfc=_0x26231d;let _0x59883c=_0x18a213[_0x1fcbfc(0xfd)][_0x1fcbfc(0xda)];return _0x59883c&&dbUserTable[_0x1fcbfc(0x120)](_0x18a213[_0x1fcbfc(0x17e)]['dbOther'],_0x1fcbfc(0xdc),[_0x59883c]),_0x2d5a74['json']({'code':0x0});}),router['post']('/getCurrentUserInfo',(_0x1fff4d,_0x3368a8,_0xee485a)=>{const _0x412c27=_0x26231d;let _0x5c15be=dbUserTable[_0x412c27(0xf9)](_0x1fff4d[_0x412c27(0x17e)][_0x412c27(0x150)],_0x1fff4d['currentUser']['id']);return _0x5c15be?(_0x5c15be[_0x412c27(0xd8)]='',_0x5c15be[_0x412c27(0x12c)]='',_0x3368a8['json']({'code':0x0,'userInfo':_0x5c15be})):_0x3368a8[_0x412c27(0x128)]({'code':0x65});}),router[_0x26231d(0x105)](_0x26231d(0x140),(_0x301aef,_0x59595f,_0x7e7f12)=>{const _0x12667e=_0x26231d;if(_0x301aef[_0x12667e(0xd7)]['is_admin']!=0x1)return _0x59595f[_0x12667e(0x128)]({'code':0x66});let _0x1217ed=_0x301aef[_0x12667e(0xfd)]['ip'];if(_0x1217ed==_0x12667e(0x136)||_0x1217ed==_0x12667e(0x168))return _0x301aef['app'][_0x12667e(0x13e)](_0x59595f,_0x59595f['__']('security.thisIpCannotAddList'));let _0x3cd739=_0x301aef[_0x12667e(0xfd)][_0x12667e(0x1a5)],_0x83b434=_0x301aef['body'][_0x12667e(0x11e)];return dbLoginTable[_0x12667e(0x133)](_0x301aef['app'][_0x12667e(0x150)],_0x3cd739,_0x1217ed,_0x83b434,_0x59595f['__'](_0x12667e(0x109))),_0x301aef[_0x12667e(0x17e)][_0x12667e(0x12b)](),_0x59595f['json']({'code':0x0});}),router[_0x26231d(0x105)](_0x26231d(0x1a1),(_0x3297d5,_0x4246d0,_0x1f33ef)=>{const _0x25a5ef=_0x26231d;if(_0x3297d5[_0x25a5ef(0xd7)][_0x25a5ef(0x1aa)]!=0x1)return _0x4246d0[_0x25a5ef(0x128)]({'code':0x66});let _0x4947cb=_0x3297d5['body']['id'];return dbLoginTable[_0x25a5ef(0x11f)](_0x3297d5[_0x25a5ef(0x17e)][_0x25a5ef(0x150)],_0x4947cb),_0x3297d5['app'][_0x25a5ef(0x12b)](),_0x4246d0['json']({'code':0x0});}),router[_0x26231d(0x105)]('/getIpList',(_0x28caaf,_0x4c1d3c,_0x3f926f)=>{const _0x6b828e=_0x26231d;let _0x28d39a=_0x28caaf[_0x6b828e(0xfd)][_0x6b828e(0x1af)],_0xfddcc1=_0x28caaf[_0x6b828e(0xfd)][_0x6b828e(0xd9)],_0x5ae3d8=_0x28caaf[_0x6b828e(0xfd)][_0x6b828e(0x1a5)],_0x53c765=new Date()[_0x6b828e(0x111)]();dbLoginTable[_0x6b828e(0x192)](_0x28caaf[_0x6b828e(0x17e)][_0x6b828e(0x150)],_0x6b828e(0x179)+_0x53c765);let _0x13b8a4='\x20type=\x27'+_0x5ae3d8+'\x27',_0x505c63=dbLoginTable[_0x6b828e(0xec)](_0x28caaf[_0x6b828e(0x17e)][_0x6b828e(0x150)],_0x13b8a4),_0x14e5b6=(_0x28d39a-0x1)*_0xfddcc1;_0x13b8a4+=_0x6b828e(0x153)+_0xfddcc1+_0x6b828e(0x14a)+_0x14e5b6;let _0x59b72b=dbLoginTable['getAllIpListByWhere'](_0x28caaf['app'][_0x6b828e(0x150)],_0x13b8a4);return _0x4c1d3c[_0x6b828e(0x128)]({'code':0x0,'data':_0x59b72b,'pageCount':Math[_0x6b828e(0x125)](_0x505c63['count']/_0xfddcc1)});}),router[_0x26231d(0x105)](_0x26231d(0x160),(_0x12f211,_0x41ef82,_0x214d23)=>{const _0x4bdafa=_0x26231d;if(_0x12f211['currentUser'][_0x4bdafa(0x1aa)]!=0x1)return _0x41ef82[_0x4bdafa(0x128)]({'code':0x66});let _0x9b2084=0x1388,_0x4eaefd=_0x12f211[_0x4bdafa(0xfd)][_0x4bdafa(0x1af)],_0x44a5d1=_0x12f211[_0x4bdafa(0xfd)]['pageSize'],_0x266070=_0x12f211['body'][_0x4bdafa(0x1a5)],_0x24ca4e='',_0x463245=[];_0x266070?(_0x24ca4e+='\x20type=?',_0x463245['push'](_0x266070)):_0x24ca4e=_0x4bdafa(0x176);let _0x3201e3=dbLoginTable[_0x4bdafa(0x190)](_0x12f211[_0x4bdafa(0x17e)]['dbOther'],_0x24ca4e,_0x463245)[_0x4bdafa(0x1ae)];if(_0x3201e3>_0x9b2084){let _0x5dca9e=0x64,_0x394339=dbLoginTable['deleteRecordByWhere'](_0x12f211[_0x4bdafa(0x17e)]['dbOther'],'\x20id\x20in(SELECT\x20id\x20FROM\x20login_record\x20ORDER\x20BY\x20id\x20LIMIT\x20'+_0x5dca9e+')');_0x394339['changes']>0x0&&(_0x3201e3=_0x3201e3-_0x394339[_0x4bdafa(0x149)]);}let _0x3d46c3=(_0x4eaefd-0x1)*_0x44a5d1;_0x24ca4e+=_0x4bdafa(0x148),_0x463245['push'](_0x44a5d1),_0x463245['push'](_0x3d46c3);let _0x30d4c1=dbLoginTable[_0x4bdafa(0x198)](_0x12f211[_0x4bdafa(0x17e)][_0x4bdafa(0x150)],_0x24ca4e,_0x463245);return _0x41ef82['json']({'code':0x0,'data':_0x30d4c1,'pageCount':Math[_0x4bdafa(0x125)](_0x3201e3/_0x44a5d1)});}),module[_0x26231d(0xfa)]=router;