const _0x2e1c8c=_0x156c;(function(_0x4f3fc1,_0x522271){const _0xe2bc87=_0x156c,_0x3ac157=_0x4f3fc1();while(!![]){try{const _0x8aa611=parseInt(_0xe2bc87(0x253))/0x1+parseInt(_0xe2bc87(0x1d3))/0x2*(-parseInt(_0xe2bc87(0x233))/0x3)+parseInt(_0xe2bc87(0x1a7))/0x4*(-parseInt(_0xe2bc87(0x21a))/0x5)+-parseInt(_0xe2bc87(0x211))/0x6+-parseInt(_0xe2bc87(0x26f))/0x7+parseInt(_0xe2bc87(0x22f))/0x8+parseInt(_0xe2bc87(0x24b))/0x9*(parseInt(_0xe2bc87(0x234))/0xa);if(_0x8aa611===_0x522271)break;else _0x3ac157['push'](_0x3ac157['shift']());}catch(_0x1ddfd0){_0x3ac157['push'](_0x3ac157['shift']());}}}(_0x4442,0x86858));let sha256=require(_0x2e1c8c(0x22d)),express=require(_0x2e1c8c(0x225)),router=express[_0x2e1c8c(0x217)](),cryptoUtils=require(_0x2e1c8c(0x241)),netUtils=require(_0x2e1c8c(0x248)),config=require(_0x2e1c8c(0x265)),pathUtil=require('path'),checkUtil=require(_0x2e1c8c(0x1d0));var package=require(_0x2e1c8c(0x22e));function _0x156c(_0x17cec1,_0x6379d6){const _0x44420b=_0x4442();return _0x156c=function(_0x156c25,_0xc6897b){_0x156c25=_0x156c25-0x188;let _0x2369fb=_0x44420b[_0x156c25];return _0x2369fb;},_0x156c(_0x17cec1,_0x6379d6);}function _0x4442(){const _0x4a8b93=['/getCurrentUserInfo','userNotExist','json','DELETE\x20FROM\x20file_index_book','client','returnErrMsg','user-agent','login.sameUsernameExist','DELETE\x20FROM\x20music_playlist_index','count','ipv4','dbOther','region','delete','newUserParamsNull','/getAllUser','findByUsername','state','2139654qmhSur','answerQuestionCannotBeSame','uid','/resetPwd','/removeUser','question','Router','DELETE\x20FROM\x20file_share_user','DELETE\x20FROM\x20backup_task','310GdMBxm','hostname','language','\x20order\x20by\x20id\x20desc\x20limit\x20?\x20offset\x20?','updateByUsername','\x20ORDER\x20BY\x20','encryptString','banTimeStamp','page','post','usernameTooEasy','express','/login','changePassword','deleteByUid','ceil','findByTitleParamsList','../../db/dbLoginTable','DELETE\x20FROM\x20private_space','sha256','../../../package.json','2572136XUYHxh','all','getRecordCountByWhere','answerNotSeqNumOrChar','321idMocx','13750420vtqiOA','DELETE\x20FROM\x20music_playlist','DELETE\x20FROM\x20movie_collection','changes','/getUserPower','user_remark','../../db/dbMusicFavorite','ipv6','updateRemarkByUsername','DELETE\x20FROM\x20file_operation_record','DELETE\x20FROM\x20book_read_record','path.parentPathExist','/hasAdmin','../utils/cryptoUtils','DELETE\x20FROM\x20album_ordinary_index','DELETE\x20FROM\x20photo_phash_similar','deleteFavoriteByUid','dialog','DELETE\x20FROM\x20album','Error','../utils/netUtils','SELECT\x20*\x20FROM\x20user\x20WHERE\x20username=?','body','9NqeSjH','DELETE\x20FROM\x20login_record','You\x20can\x27t\x20delete\x20admin\x20account','Need\x20token','/registAdmin','orderField','find','username','1017467QQrZEL','isIncludeChinese','end','value','prepare','passwordKey','\x20end_timestamp\x20is\x20not\x20null\x20and\x20end_timestamp<','isEasyUsername','pageUrl_agreement','/cancelUserPathPower','login.adminAdded','catch','version','DELETE\x20FROM\x20backup_task_msg','refreshIpList','createOrUpdatePower','menuList','updateById','../../myConfig/config','operationFail','DELETE\x20FROM\x20movie_library','token','error','createUserFolder','headers','../../db/dbMusicIndexTable','testCount','DELETE\x20FROM\x20file_index_music','3392193dqSlmQ','DELETE\x20FROM\x20photo_faces2index','getClientIp','localhost','getAllIpListByWhere','FTP','DELETE\x20FROM\x20notice_center','apiServerHttps','type','DELETE\x20FROM\x20share_temp','stat','../utils/fileUtils','exist','DELETE\x20FROM\x20movie_history','black','customLogoImage','httpsIsRunning','ipList','is_admin','banTime','customLoginTitle','/changeQuestion','ignoreIp','getUrlByUrlKey','query','login.adminExist','get','startsWith','getIpListCountByWhere','parse','create','includes','checkAnswer','asc','61352etzBsb','oldPassword','/resetSystem','DELETE\x20FROM\x20private_space_token','login.wrongNameOrPwd','DELETE\x20FROM\x20user_power','twoStepLogin','getUserPower','newPassword','DELETE\x20FROM\x20user','DELETE\x20FROM\x20user_token','publicUserName','isAdmin','password','getUserByToken','customHomeBgImage','cancelUserPathPower','deleteIpByWhere','login.tooManyPwdTestIpBan','addLoginRecord','getUserByUserName','/checkIsNasServer','send','/resetPwdInfo','DELETE\x20FROM\x20book_list_index','currentUser','WebDav','menus','searchKey','add','path','username\x20error','apiPortHttps','DELETE\x20FROM\x20file_index_photo','DELETE\x20FROM\x20config','getAllRecordByWhere','DELETE\x20FROM\x20file_index_movie','^[0-9a-zA-Z]*$','splice','run','dbFileIndex','../utils/checkUtil','security.thisIpCannotAddList','pageSize','6932mQFPRG','DELETE\x20FROM\x20book_favorite','deleteUserTokenByWhere','deletePowerByUsername','desc','DELETE\x20FROM\x20bg_task','answer','enable','decodeBase64','status','login','DELETE\x20FROM\x20music_favorite','then','deleteRecordByWhere','need\x20username/menuList','DELETE\x20FROM\x20album_ordinary','length','join','/addIpToList','getTime','log','exports','NodeNasServer','../../myConfig/urlConfig','DELETE\x20FROM\x20book_list','/removeIp','remark','login.answerIsWrong','sep','nasProxyRestart','push','createToken','cacheParentPath','test','findByTitle','apiPort','app','getAdmin','\x201=1','ddnsIpv6Address','/remarkUser','isSameStr','addIpToList','login.pwdErrCountTooMuch'];_0x4442=function(){return _0x4a8b93;};return _0x4442();}const OS=require('os'),urlConfig=require(_0x2e1c8c(0x1ea)),dbUserTable=require('../../db/dbUserTable'),dbLoginTable=require(_0x2e1c8c(0x22b)),dbConfigTable=require('../../db/dbConfigTable'),dbNoticeCenterTable=require('../../db/dbNoticeCenterTable'),dbMusicIndexTable=require(_0x2e1c8c(0x26c)),fileUtil=require(_0x2e1c8c(0x190)),fs=require('fs'),path=require('path'),dbMovieFavorite=require('../../db/dbMovieFavorite'),dbMusicFavorite=require(_0x2e1c8c(0x23a)),dbMediaTools=require('../../db/dbMediaTools');router[_0x2e1c8c(0x223)](_0x2e1c8c(0x240),(_0x5ee9a9,_0x4e496b,_0x14e9e5)=>{const _0x471c54=_0x2e1c8c;let _0x93ed0b=dbUserTable['getAdmin'](_0x5ee9a9[_0x471c54(0x1f7)][_0x471c54(0x20a)]),_0x256e54=dbConfigTable[_0x471c54(0x22a)](_0x5ee9a9[_0x471c54(0x1f7)]['dbOther'],[_0x471c54(0x194),_0x471c54(0x199),'customLoginImage',_0x471c54(0x1b6)]);_0x4e496b['json']({'code':0x0,'hasAdmin':_0x93ed0b?'1':'0','customConfig':_0x256e54,'pagePrivacyUrl':urlConfig['getUrlByUrlKey'](_0x5ee9a9[_0x471c54(0x1f7)][_0x471c54(0x20a)],'pageUrl_privacy'),'pageAgreementUrl':urlConfig[_0x471c54(0x19c)](_0x5ee9a9[_0x471c54(0x1f7)][_0x471c54(0x20a)],_0x471c54(0x25b))});});let banIpList=[];function getIpBanConfig(_0x2685bf,_0x1d0c6c){const _0x26b862=_0x2e1c8c;let _0x2a985c=![],_0x2f6bec=0x1,_0x590f31=0x1;if(_0x1d0c6c!=_0x26b862(0x188)){let _0x492f55=dbConfigTable[_0x26b862(0x1f5)](_0x2685bf[_0x26b862(0x1f7)][_0x26b862(0x20a)],'ipBan');_0x492f55&&(_0x492f55=JSON[_0x26b862(0x1a2)](_0x492f55['value']),_0x492f55&&(_0x492f55[_0x26b862(0x1da)]&&(_0x2a985c=!![]),_0x2f6bec=_0x492f55[_0x26b862(0x26d)],_0x590f31=_0x492f55[_0x26b862(0x198)]));}return{'enableBan':_0x2a985c,'maxTestCount':_0x2f6bec,'banTimeMin':_0x590f31};}function addBanIp(_0x383b27,_0x4d9411,_0x9cd400){const _0x460d50=_0x2e1c8c;let {enableBan:_0x2203de,maxTestCount:_0x39ea15,banTimeMin:_0x1f2f46}=getIpBanConfig(_0x383b27,_0x9cd400);if(_0x2203de){let _0x37fd9d=null;for(let _0x6f8014 in banIpList){banIpList[_0x6f8014]['ip']==_0x9cd400&&(_0x37fd9d=banIpList[_0x6f8014],banIpList[_0x6f8014][_0x460d50(0x26d)]+=0x1);}!_0x37fd9d&&(_0x37fd9d={'ip':_0x9cd400,'testCount':0x1},banIpList[_0x460d50(0x1f1)](_0x37fd9d));if(_0x37fd9d[_0x460d50(0x26d)]>=_0x39ea15){let _0x16db0d=new Date()[_0x460d50(0x1e6)](),_0x33dc27=_0x16db0d+_0x1f2f46*0x3c*0x3e8;dbLoginTable['addIpToList'](_0x383b27[_0x460d50(0x1f7)][_0x460d50(0x20a)],_0x460d50(0x193),_0x9cd400,_0x33dc27,_0x4d9411['__'](_0x460d50(0x1fe))),_0x383b27[_0x460d50(0x1f7)][_0x460d50(0x261)](),dbNoticeCenterTable[_0x460d50(0x1a3)](_0x383b27[_0x460d50(0x1f7)][_0x460d50(0x20a)],{'title':_0x4d9411['__']('login.loginFailAlert'),'level':'error','content':_0x4d9411['__'](_0x460d50(0x1b9))+('['+_0x9cd400+']')});for(let _0x230f63 in banIpList){banIpList[_0x230f63]['ip']==_0x9cd400&&banIpList[_0x460d50(0x1cd)](_0x230f63,0x1);}}}}router[_0x2e1c8c(0x223)](_0x2e1c8c(0x226),(_0x5834b3,_0x2336f3,_0x520040)=>{const _0x293f85=_0x2e1c8c;let _0x42ca0d=_0x5834b3[_0x293f85(0x24a)]['username'],_0x3278af=_0x5834b3[_0x293f85(0x24a)][_0x293f85(0x1b4)];if(!_0x42ca0d||!_0x3278af)return _0x2336f3[_0x293f85(0x1dc)](0x194)[_0x293f85(0x255)]();_0x3278af=fileUtil[_0x293f85(0x1db)](_0x3278af);let _0x1a7387=netUtils[_0x293f85(0x271)](_0x5834b3);cryptoUtils[_0x293f85(0x220)](config[_0x293f85(0x258)],_0x3278af)['then'](_0x1c9329=>{const _0x1fc1de=_0x293f85;let _0x2d835e=dbUserTable[_0x1fc1de(0x1dd)](_0x5834b3[_0x1fc1de(0x1f7)][_0x1fc1de(0x20a)],_0x42ca0d,_0x1c9329);if(_0x2d835e){function _0x54df64(){const _0x181ef4=_0x1fc1de;if(_0x1a7387!=_0x181ef4(0x188)){let _0x22e2fa=dbConfigTable[_0x181ef4(0x1f5)](_0x5834b3[_0x181ef4(0x1f7)][_0x181ef4(0x20a)],_0x181ef4(0x1ad));if(_0x22e2fa&&_0x22e2fa[_0x181ef4(0x256)]=='1'){let _0x582266=_0x5834b3['body'][_0x181ef4(0x1d9)];if(_0x582266){_0x582266=sha256(_0x582266);let _0xc6c0b1=dbUserTable[_0x181ef4(0x1a5)](_0x5834b3[_0x181ef4(0x1f7)][_0x181ef4(0x20a)],_0x42ca0d,_0x582266);if(!_0xc6c0b1)return _0x5834b3[_0x181ef4(0x1f7)][_0x181ef4(0x204)](_0x2336f3,_0x2336f3['__'](_0x181ef4(0x1ee)));}else return _0x2336f3[_0x181ef4(0x201)]({'code':0x2,'question':_0x2d835e[_0x181ef4(0x216)]});}}dbLoginTable[_0x181ef4(0x1ba)](_0x5834b3['app'][_0x181ef4(0x20a)],'login',_0x42ca0d,_0x1a7387,_0x5834b3['body'][_0x181ef4(0x203)],_0x5834b3[_0x181ef4(0x26b)][_0x181ef4(0x205)]);let _0x1f9810=sha256(new Date()[_0x181ef4(0x1e6)]()+_0x42ca0d+_0x1c9329);var _0x5e88d3=_0x5834b3[_0x181ef4(0x26b)][_0x181ef4(0x205)];return dbUserTable[_0x181ef4(0x1f2)](_0x5834b3[_0x181ef4(0x1f7)][_0x181ef4(0x20a)],_0x2d835e['id'],_0x1f9810,_0x1a7387,_0x5e88d3),_0x2d835e['password']='',_0x2d835e[_0x181ef4(0x1d9)]='',_0x2336f3[_0x181ef4(0x201)]({'code':0x0,'token':_0x1f9810,'user':_0x2d835e,'version':package[_0x181ef4(0x25f)],'reqIp':_0x1a7387});}return _0x54df64();}else return addBanIp(_0x5834b3,_0x2336f3,_0x1a7387),dbLoginTable[_0x1fc1de(0x1ba)](_0x5834b3[_0x1fc1de(0x1f7)][_0x1fc1de(0x20a)],_0x2336f3['__'](_0x1fc1de(0x1ab)),_0x42ca0d,_0x1a7387,_0x5834b3['body']['client'],_0x5834b3[_0x1fc1de(0x26b)]['user-agent']),_0x5834b3[_0x1fc1de(0x1f7)][_0x1fc1de(0x204)](_0x2336f3,_0x2336f3['__'](_0x1fc1de(0x1ab)));})[_0x293f85(0x25e)](_0x838ba5=>{const _0x2115c6=_0x293f85;return console[_0x2115c6(0x1e7)](_0x838ba5),_0x5834b3[_0x2115c6(0x1f7)]['returnErrMsg'](_0x2336f3,_0x2336f3['__']('operationFail'));});}),router[_0x2e1c8c(0x223)]('/tokenLogin',(_0x18a6cd,_0x3fccb3,_0x401557)=>{const _0xfed5a0=_0x2e1c8c;let _0x5d396c=netUtils[_0xfed5a0(0x271)](_0x18a6cd),_0x5ec45f=_0x18a6cd[_0xfed5a0(0x24a)][_0xfed5a0(0x268)];if(!_0x5ec45f)return _0x18a6cd[_0xfed5a0(0x1f7)][_0xfed5a0(0x204)](_0x3fccb3,_0xfed5a0(0x24e));let _0x33d026=dbUserTable[_0xfed5a0(0x1b5)](_0x18a6cd[_0xfed5a0(0x1f7)][_0xfed5a0(0x20a)],_0x5ec45f);if(!_0x33d026)return _0x18a6cd[_0xfed5a0(0x1f7)][_0xfed5a0(0x204)](_0x3fccb3,_0x3fccb3['__']('TokenExpired'));return _0x33d026['password']='',_0x33d026['answer']='',_0x3fccb3[_0xfed5a0(0x201)]({'code':0x0,'token':_0x5ec45f,'user':_0x33d026,'reqIp':_0x5d396c});}),router[_0x2e1c8c(0x223)](_0x2e1c8c(0x1a9),(_0x5df05b,_0x1fefae,_0x5ade12)=>{const _0x140a52=_0x2e1c8c;let _0x1ace25=_0x5df05b[_0x140a52(0x24a)]['password'];if(_0x5df05b[_0x140a52(0x1c0)]&&_0x5df05b[_0x140a52(0x1c0)][_0x140a52(0x197)]!=0x1)return _0x1fefae[_0x140a52(0x201)]({'code':0x66});cryptoUtils[_0x140a52(0x220)](config['passwordKey'],_0x1ace25)[_0x140a52(0x1df)](_0x525a21=>{const _0x47064d=_0x140a52;if(_0x5df05b['currentUser'][_0x47064d(0x1b4)]!=_0x525a21)return _0x1fefae[_0x47064d(0x201)]({'code':0x1,'message':_0x1fefae['__']('login.pwdErr')});fs['rm'](path[_0x47064d(0x1e4)](config[_0x47064d(0x1f3)]),{'recursive':!![]},_0xe3df91=>{const _0x2378b1=_0x47064d;if(_0xe3df91)return _0x1fefae[_0x2378b1(0x201)]({'code':0x1,'message':_0x2378b1(0x247)});return _0x5df05b['app'][_0x2378b1(0x20a)]['prepare'](_0x2378b1(0x1c9))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x246))['run'](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x219))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x260))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)]('DELETE\x20FROM\x20backup_task_record')['run'](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x1d8))['run'](),_0x5df05b['app']['dbOther'][_0x2378b1(0x257)]('DELETE\x20FROM\x20config\x20where\x20title\x20in\x20(\x27nasAccountInfo\x27)')[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x23d))['run'](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)]('DELETE\x20FROM\x20file_record')[_0x2378b1(0x1ce)](),_0x5df05b['app']['dbOther'][_0x2378b1(0x257)]('DELETE\x20FROM\x20file_share')['run'](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x218))['run'](),_0x5df05b['app'][_0x2378b1(0x20a)]['prepare']('DELETE\x20FROM\x20login_ip_list')[_0x2378b1(0x1ce)](),_0x5df05b['app'][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x24c))[_0x2378b1(0x1ce)](),_0x5df05b['app'][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x18b))[_0x2378b1(0x1ce)](),_0x5df05b['app']['dbOther']['prepare']('DELETE\x20FROM\x20play_record')[_0x2378b1(0x1ce)](),_0x5df05b['app']['dbOther'][_0x2378b1(0x257)](_0x2378b1(0x22c))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)](_0x2378b1(0x1aa))[_0x2378b1(0x1ce)](),_0x5df05b['app']['dbOther'][_0x2378b1(0x257)](_0x2378b1(0x18e))['run'](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x20a)][_0x2378b1(0x257)]('DELETE\x20FROM\x20source_folder')[_0x2378b1(0x1ce)](),_0x5df05b['app']['dbOther']['prepare'](_0x2378b1(0x1b0))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)]['dbOther'][_0x2378b1(0x257)](_0x2378b1(0x1b1))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)]['dbOther'][_0x2378b1(0x257)](_0x2378b1(0x1ac))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)][_0x2378b1(0x257)]('DELETE\x20FROM\x20ai_classes')[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)][_0x2378b1(0x257)]('DELETE\x20FROM\x20ai_classes2index')['run'](),_0x5df05b['app'][_0x2378b1(0x1cf)]['prepare'](_0x2378b1(0x1e2))['run'](),_0x5df05b['app'][_0x2378b1(0x1cf)][_0x2378b1(0x257)](_0x2378b1(0x242))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)][_0x2378b1(0x257)](_0x2378b1(0x1cb))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)]['prepare'](_0x2378b1(0x1c8))['run'](),_0x5df05b['app'][_0x2378b1(0x1cf)]['prepare'](_0x2378b1(0x26e))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)]['prepare'](_0x2378b1(0x202))['run'](),_0x5df05b[_0x2378b1(0x1f7)]['dbFileIndex'][_0x2378b1(0x257)]('DELETE\x20FROM\x20photo_faces')[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)]['dbFileIndex'][_0x2378b1(0x257)](_0x2378b1(0x270))['run'](),_0x5df05b['app'][_0x2378b1(0x1cf)][_0x2378b1(0x257)]('DELETE\x20FROM\x20movie_keys')[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)][_0x2378b1(0x257)](_0x2378b1(0x236))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)]['prepare'](_0x2378b1(0x192))[_0x2378b1(0x1ce)](),_0x5df05b['app']['dbFileIndex']['prepare'](_0x2378b1(0x267))[_0x2378b1(0x1ce)](),_0x5df05b['app']['dbFileIndex']['prepare'](_0x2378b1(0x243))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)]['prepare'](_0x2378b1(0x1de))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)]['dbFileIndex']['prepare'](_0x2378b1(0x235))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)][_0x2378b1(0x257)](_0x2378b1(0x207))[_0x2378b1(0x1ce)](),_0x5df05b['app'][_0x2378b1(0x1cf)][_0x2378b1(0x257)](_0x2378b1(0x1d4))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)][_0x2378b1(0x257)](_0x2378b1(0x1eb))[_0x2378b1(0x1ce)](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)][_0x2378b1(0x257)](_0x2378b1(0x1bf))['run'](),_0x5df05b[_0x2378b1(0x1f7)][_0x2378b1(0x1cf)][_0x2378b1(0x257)](_0x2378b1(0x23e))[_0x2378b1(0x1ce)](),process['send']({'type':'fileShareRestart','shareType':_0x2378b1(0x18a)}),process[_0x2378b1(0x1bd)]({'type':'fileShareRestart','shareType':_0x2378b1(0x1c1)}),process[_0x2378b1(0x1bd)]({'type':_0x2378b1(0x1f0)}),process['send']({'type':_0x2378b1(0x26a)}),_0x1fefae[_0x2378b1(0x201)]({'code':0x0});});});}),router['post'](_0x2e1c8c(0x1be),(_0x26ae63,_0xe18f4f,_0x140194)=>{const _0x2c2241=_0x2e1c8c;let _0xb2e7f=netUtils[_0x2c2241(0x271)](_0x26ae63),_0x3f85c6=dbUserTable[_0x2c2241(0x1f8)](_0x26ae63[_0x2c2241(0x1f7)]['dbOther']),_0x42ef22={};_0xb2e7f=='localhost'&&(_0x42ef22['username']=_0x3f85c6['username']),_0x42ef22[_0x2c2241(0x216)]=_0x3f85c6['question'],_0xe18f4f[_0x2c2241(0x201)]({'code':0x0,'data':_0x42ef22});}),router['all'](_0x2e1c8c(0x1bc),(_0x372f94,_0x367119,_0x4d4ee0)=>{const _0x37e183=_0x2e1c8c;let _0x3e276e={'code':0x0,'message':_0x37e183(0x1e9),'version':package[_0x37e183(0x25f)],'hostName':OS[_0x37e183(0x21b)]()},_0x223f96=_0x372f94[_0x37e183(0x19d)][_0x37e183(0x19b)];if(_0x223f96&&_0x223f96==0x1)return _0x367119['json'](_0x3e276e);let _0x243c9a=0x50,_0x4a8d4b=dbConfigTable[_0x37e183(0x1f5)](_0x372f94[_0x37e183(0x1f7)]['dbOther'],_0x37e183(0x1f6));_0x4a8d4b&&_0x4a8d4b[_0x37e183(0x256)]&&(_0x243c9a=_0x4a8d4b[_0x37e183(0x256)]);let _0x105000=0x1bb,_0x38b5a4=dbConfigTable[_0x37e183(0x1f5)](_0x372f94[_0x37e183(0x1f7)][_0x37e183(0x20a)],_0x37e183(0x1c7));_0x38b5a4&&_0x38b5a4[_0x37e183(0x256)]&&_0x38b5a4['value']>0x0&&_0x38b5a4[_0x37e183(0x256)]<0xffff&&(_0x105000=_0x38b5a4['value']);let _0x4540ff=0x0,_0x2f6355=dbConfigTable[_0x37e183(0x1f5)](_0x372f94[_0x37e183(0x1f7)]['dbOther'],_0x37e183(0x18c));if(_0x2f6355&&_0x2f6355[_0x37e183(0x256)])try{_0x2f6355=JSON[_0x37e183(0x1a2)](_0x2f6355[_0x37e183(0x256)]),_0x2f6355[_0x37e183(0x210)]=='run'&&(_0x4540ff=0x1);}catch(_0x585dd9){}try{let _0x2a4586=dbConfigTable['findByTitle'](_0x372f94['app'][_0x37e183(0x20a)],'globalIpList'),_0xf2f65b=dbConfigTable[_0x37e183(0x1f5)](_0x372f94[_0x37e183(0x1f7)]['dbOther'],_0x37e183(0x1fa));if(_0x2a4586){_0x2a4586=JSON[_0x37e183(0x1a2)](_0x2a4586[_0x37e183(0x256)]);let _0x5170d4=[];if(_0xf2f65b&&_0xf2f65b[_0x37e183(0x256)]){for(let _0x2cca6f in _0x2a4586){let _0x21ff51=_0x2a4586[_0x2cca6f];_0x21ff51['type']==_0x37e183(0x209)&&_0x5170d4[_0x37e183(0x1f1)](_0x21ff51);}_0x5170d4[_0x37e183(0x1f1)]({'type':_0x37e183(0x23b),'ip':_0xf2f65b[_0x37e183(0x256)],'ddns':0x1}),_0x2a4586=_0x5170d4;}}return _0x3e276e[_0x37e183(0x196)]=_0x2a4586,_0x3e276e[_0x37e183(0x1f6)]=parseInt(_0x243c9a),_0x3e276e[_0x37e183(0x1c7)]=parseInt(_0x105000),_0x3e276e[_0x37e183(0x195)]=_0x4540ff,_0x367119[_0x37e183(0x201)](_0x3e276e);}catch(_0x13a748){return _0x367119[_0x37e183(0x201)](_0x3e276e);}}),router[_0x2e1c8c(0x223)](_0x2e1c8c(0x214),(_0x44a815,_0xd34dc5,_0x3975e3)=>{const _0x10b3f4=_0x2e1c8c;let _0x1bb02a=_0x44a815[_0x10b3f4(0x24a)][_0x10b3f4(0x252)],_0xe2c670=_0x44a815['body']['password'],_0x5268a7=_0x44a815[_0x10b3f4(0x24a)][_0x10b3f4(0x1d9)],_0x45f3e1=_0x44a815[_0x10b3f4(0x1f7)][_0x10b3f4(0x20a)]['prepare'](_0x10b3f4(0x249))[_0x10b3f4(0x19f)](_0x1bb02a);if(!_0x45f3e1)return _0x44a815[_0x10b3f4(0x1f7)][_0x10b3f4(0x204)](_0xd34dc5,_0xd34dc5['__'](_0x10b3f4(0x200)));try{_0x5268a7=sha256(_0x5268a7);let _0x2debae=dbUserTable[_0x10b3f4(0x1a5)](_0x44a815[_0x10b3f4(0x1f7)][_0x10b3f4(0x20a)],_0x1bb02a,_0x5268a7);if(_0x2debae)cryptoUtils[_0x10b3f4(0x220)](config[_0x10b3f4(0x258)],_0xe2c670)['then'](_0x18a949=>{const _0x571b25=_0x10b3f4;dbUserTable[_0x571b25(0x21e)](_0x44a815[_0x571b25(0x1f7)][_0x571b25(0x20a)],_0x1bb02a,'password',_0x18a949);let _0x1ae4ad=sha256(new Date()[_0x571b25(0x1e6)]()+_0x1bb02a+_0xe2c670);dbUserTable[_0x571b25(0x21e)](_0x44a815['app'][_0x571b25(0x20a)],_0x1bb02a,'token',_0x1ae4ad),_0xd34dc5[_0x571b25(0x201)]({'code':0x0});})[_0x10b3f4(0x25e)](_0x3bd56a=>{const _0x51ed1c=_0x10b3f4;return console['log']('error',_0x3bd56a),_0x44a815['app'][_0x51ed1c(0x204)](_0xd34dc5,_0xd34dc5['__'](_0x51ed1c(0x266)));});else return _0x44a815[_0x10b3f4(0x1f7)][_0x10b3f4(0x204)](_0xd34dc5,_0xd34dc5['__']('login.answerIsWrong'));}catch(_0x35a940){return console['log']('err',_0x35a940),_0xd34dc5['status'](0x194)[_0x10b3f4(0x255)]();}});function newUserCheck(_0x1c37b6,_0x4af69a,_0x2e12e7,_0x3ac24c,_0x182676,_0x3197f4){const _0x1d13f3=_0x2e1c8c;if(!_0x3ac24c||!_0x2e12e7||!_0x1c37b6||!_0x4af69a)return _0x182676[_0x1d13f3(0x1f7)][_0x1d13f3(0x204)](_0x3197f4,_0x3197f4['__'](_0x1d13f3(0x20d)));let _0x2da271=new RegExp(_0x1d13f3(0x1cc));if(!_0x2da271[_0x1d13f3(0x1f4)](_0x1c37b6)||_0x1c37b6==config[_0x1d13f3(0x1b2)])return _0x182676['app']['returnErrMsg'](_0x3197f4,_0x3197f4['__']('usernameReg'));if(_0x1c37b6==_0x4af69a)return _0x182676[_0x1d13f3(0x1f7)][_0x1d13f3(0x204)](_0x3197f4,_0x3197f4['__']('usernameAndPwdCannotBeSame'));if(checkUtil[_0x1d13f3(0x25a)](_0x1c37b6))return _0x182676[_0x1d13f3(0x1f7)][_0x1d13f3(0x204)](_0x3197f4,_0x3197f4['__'](_0x1d13f3(0x224)));if(_0x2e12e7==_0x3ac24c)return _0x182676[_0x1d13f3(0x1f7)][_0x1d13f3(0x204)](_0x3197f4,_0x3197f4['__'](_0x1d13f3(0x212)));if(checkUtil[_0x1d13f3(0x254)](_0x4af69a))return _0x182676['app'][_0x1d13f3(0x204)](_0x3197f4,_0x3197f4['__']('pwdCannotBeChinese'));return!![];}router[_0x2e1c8c(0x223)](_0x2e1c8c(0x24f),(_0x23807e,_0x25799a,_0x198945)=>{const _0x5eceb6=_0x2e1c8c;let _0xddebcf=_0x23807e['body'][_0x5eceb6(0x252)],_0x2681b8=_0x23807e[_0x5eceb6(0x24a)]['password'],_0x14b77f=_0x23807e[_0x5eceb6(0x24a)]['question'],_0x9fbc4b=_0x23807e[_0x5eceb6(0x24a)]['answer'];if(!_0x9fbc4b||!_0x14b77f||!_0xddebcf||!_0x2681b8)return _0x25799a['json']({'code':0x1,'message':'params\x20error'});let _0x2a1ff2=dbUserTable[_0x5eceb6(0x1f8)](_0x23807e[_0x5eceb6(0x1f7)][_0x5eceb6(0x20a)]);if(_0x2a1ff2)_0x25799a[_0x5eceb6(0x201)]({'code':0x1,'message':_0x25799a['__'](_0x5eceb6(0x19e))});else{if(newUserCheck(_0xddebcf,_0x2681b8,_0x14b77f,_0x9fbc4b,_0x23807e,_0x25799a)!==!![])return;_0x9fbc4b=sha256(_0x9fbc4b),cryptoUtils[_0x5eceb6(0x220)](config[_0x5eceb6(0x258)],_0x2681b8)[_0x5eceb6(0x1df)](_0x3a2dd5=>{const _0x21f653=_0x5eceb6;let _0x3b05fe=dbUserTable['create'](_0x23807e[_0x21f653(0x1f7)]['dbOther'],{'username':_0xddebcf,'password':_0x3a2dd5,'question':_0x14b77f,'answer':_0x9fbc4b,'is_admin':0x1});if(_0x3b05fe[_0x21f653(0x237)]>0x0){let _0x3ee7f9=dbUserTable['getAdmin'](_0x23807e[_0x21f653(0x1f7)]['dbOther']),_0x148abe=sha256(new Date()[_0x21f653(0x1e6)]()+_0xddebcf+_0x3a2dd5),_0x4e7cd5=netUtils[_0x21f653(0x271)](_0x23807e);var _0x5232bb=_0x23807e[_0x21f653(0x26b)][_0x21f653(0x205)];dbUserTable[_0x21f653(0x1f2)](_0x23807e[_0x21f653(0x1f7)][_0x21f653(0x20a)],_0x3ee7f9['id'],_0x148abe,_0x4e7cd5,_0x5232bb),_0x3ee7f9[_0x21f653(0x1b4)]='';let _0x19ad89=_0x23807e['body'][_0x21f653(0x21c)],_0x53214f=_0x23807e['body'][_0x21f653(0x20b)];return _0x19ad89&&dbConfigTable[_0x21f653(0x1a3)](_0x23807e[_0x21f653(0x1f7)][_0x21f653(0x20a)],{'title':_0x21f653(0x21c),'value':_0x19ad89}),_0x53214f&&dbConfigTable['create'](_0x23807e[_0x21f653(0x1f7)][_0x21f653(0x20a)],{'title':'region','value':_0x53214f}),_0x25799a['json']({'code':0x0,'token':_0x148abe,'user':_0x3ee7f9});}})['catch'](_0x17a014=>{const _0x2ba386=_0x5eceb6;return console['log'](_0x2ba386(0x269),_0x17a014),_0x23807e[_0x2ba386(0x1f7)]['returnErrMsg'](_0x25799a,_0x25799a['__'](_0x2ba386(0x266)));});}}),router[_0x2e1c8c(0x223)](_0x2e1c8c(0x1fb),(_0x19620c,_0x4d1877,_0xc0b649)=>{const _0x55b725=_0x2e1c8c;if(_0x19620c[_0x55b725(0x1c0)][_0x55b725(0x197)]!=0x1)return _0x4d1877[_0x55b725(0x201)]({'code':0x66});let _0x5ba0f8=_0x19620c[_0x55b725(0x24a)][_0x55b725(0x252)],_0x12ddfe=_0x19620c[_0x55b725(0x24a)][_0x55b725(0x1ed)];return _0x5ba0f8&&_0x12ddfe&&dbUserTable[_0x55b725(0x23c)](_0x19620c[_0x55b725(0x1f7)][_0x55b725(0x20a)],_0x5ba0f8,_0x12ddfe),_0x4d1877[_0x55b725(0x201)]({'code':0x0});}),router['post']('/addUser',(_0x1d26bd,_0x4b5eab,_0x254305)=>{const _0xb2af3f=_0x2e1c8c;let _0x1d0cf0=_0x1d26bd[_0xb2af3f(0x24a)][_0xb2af3f(0x252)],_0x2943c0=_0x1d26bd[_0xb2af3f(0x24a)][_0xb2af3f(0x1b4)],_0x179e8e=_0x1d26bd['body']['question'],_0x767a4a=_0x1d26bd[_0xb2af3f(0x24a)][_0xb2af3f(0x1d9)],_0x44f589=_0x1d26bd[_0xb2af3f(0x24a)][_0xb2af3f(0x1ed)];if(newUserCheck(_0x1d0cf0,_0x2943c0,_0x179e8e,_0x767a4a,_0x1d26bd,_0x4b5eab)!==!![])return;let _0x14fa28=_0x1d26bd['body'][_0xb2af3f(0x18d)];if(dbUserTable['isAdmin'](_0x1d26bd,_0x4b5eab)===!![]){if(_0x14fa28==_0xb2af3f(0x1c4)){let _0x1a23c9=dbUserTable[_0xb2af3f(0x20f)](_0x1d26bd['app']['dbOther'],_0x1d0cf0);if(_0x1a23c9)return _0x1d26bd['app'][_0xb2af3f(0x204)](_0x4b5eab,_0x4b5eab['__'](_0xb2af3f(0x206)));}cryptoUtils['encryptString'](config[_0xb2af3f(0x258)],_0x2943c0)[_0xb2af3f(0x1df)](_0x388941=>{const _0x269c93=_0xb2af3f;let _0x38e911=dbUserTable['create'](_0x1d26bd[_0x269c93(0x1f7)][_0x269c93(0x20a)],{'username':_0x1d0cf0,'password':_0x388941,'question':_0x179e8e,'answer':sha256(_0x767a4a),'remark':_0x44f589});return _0x38e911['changes']>=0x1?_0x4b5eab[_0x269c93(0x201)]({'code':0x0}):_0x1d26bd['app'][_0x269c93(0x204)](_0x4b5eab,_0x4b5eab['__'](_0x269c93(0x266)));})[_0xb2af3f(0x25e)](_0x3ff5fa=>{const _0x4bfb11=_0xb2af3f;return console[_0x4bfb11(0x1e7)](_0x4bfb11(0x269),_0x3ff5fa),_0x1d26bd[_0x4bfb11(0x1f7)][_0x4bfb11(0x204)](_0x4b5eab,_0x4b5eab['__'](_0x4bfb11(0x266)));});}}),router['post'](_0x2e1c8c(0x215),(_0x583425,_0xd3d2e8,_0x1c8837)=>{const _0x56a0aa=_0x2e1c8c;let _0x5254c6=_0x583425['body'][_0x56a0aa(0x213)];if(dbUserTable[_0x56a0aa(0x1b3)](_0x583425,_0xd3d2e8)===!![]){let _0xb0b756=dbUserTable[_0x56a0aa(0x251)](_0x583425[_0x56a0aa(0x1f7)][_0x56a0aa(0x20a)],_0x5254c6);if(_0xb0b756&&_0xb0b756[_0x56a0aa(0x197)]==0x1)return _0xd3d2e8['json']({'code':0x1,'message':_0x56a0aa(0x24d)});dbUserTable[_0x56a0aa(0x1d6)](_0x583425[_0x56a0aa(0x1f7)][_0x56a0aa(0x20a)],_0xb0b756[_0x56a0aa(0x252)]),dbMusicIndexTable['removeUserPlayList'](_0x583425[_0x56a0aa(0x1f7)][_0x56a0aa(0x1cf)],_0xb0b756['id']),dbMusicFavorite['deleteFavoriteByUid'](_0x583425[_0x56a0aa(0x1f7)]['dbFileIndex'],_0xb0b756['id']),dbMovieFavorite[_0x56a0aa(0x244)](_0x583425['app'][_0x56a0aa(0x1cf)],_0xb0b756['id']),dbMediaTools[_0x56a0aa(0x228)](_0x583425[_0x56a0aa(0x1f7)][_0x56a0aa(0x20a)],_0xb0b756['id']);let _0x53d60b=dbUserTable[_0x56a0aa(0x20c)](_0x583425['app'][_0x56a0aa(0x20a)],_0x5254c6);return _0x53d60b[_0x56a0aa(0x237)]>=0x1?_0xd3d2e8[_0x56a0aa(0x201)]({'code':0x0}):_0x583425[_0x56a0aa(0x1f7)]['returnErrMsg'](_0xd3d2e8,_0xd3d2e8['__']('operationFail'));}}),router[_0x2e1c8c(0x223)](_0x2e1c8c(0x20e),(_0x53acf4,_0x101936,_0x38db4c)=>{const _0x15ac1a=_0x2e1c8c;if(dbUserTable[_0x15ac1a(0x1b3)](_0x53acf4,_0x101936)===!![]){let _0x3dec7e=_0x53acf4[_0x15ac1a(0x24a)][_0x15ac1a(0x250)]||'id',_0x569404=_0x53acf4[_0x15ac1a(0x24a)]['orderType']||_0x15ac1a(0x1a6),_0x169bd8=_0x53acf4['body'][_0x15ac1a(0x1c3)];(!['id','username',_0x15ac1a(0x239)][_0x15ac1a(0x1a4)](_0x3dec7e)||![_0x15ac1a(0x1a6),_0x15ac1a(0x1d7)][_0x15ac1a(0x1a4)](_0x569404))&&(_0x3dec7e='id',_0x569404='asc');let _0x1f2823='SELECT\x20id,username,is_admin,user_remark\x20FROM\x20user\x20',_0x342bae=[];_0x169bd8&&(_0x1f2823+='\x20WHERE\x20username\x20like\x20?\x20or\x20user_remark\x20like\x20?',_0x342bae[_0x15ac1a(0x1f1)]('%'+_0x169bd8+'%','%'+_0x169bd8+'%'));_0x1f2823+=_0x15ac1a(0x21f)+_0x3dec7e+'\x20'+_0x569404;let _0xf31412=_0x53acf4[_0x15ac1a(0x1f7)][_0x15ac1a(0x20a)][_0x15ac1a(0x257)](_0x1f2823)[_0x15ac1a(0x230)](_0x342bae);return _0x101936[_0x15ac1a(0x201)]({'code':0x0,'userList':_0xf31412});}}),router[_0x2e1c8c(0x223)](_0x2e1c8c(0x238),(_0x1e6a89,_0x5137ab,_0x3ff637)=>{const _0x511327=_0x2e1c8c;let _0x254e4c=_0x1e6a89[_0x511327(0x24a)][_0x511327(0x252)],_0x4761f2=null;if(_0x254e4c!=config[_0x511327(0x1b2)]){_0x4761f2=dbUserTable[_0x511327(0x1bb)](_0x1e6a89[_0x511327(0x1f7)]['dbOther'],_0x254e4c);if(!_0x4761f2)return _0x1e6a89[_0x511327(0x1f7)][_0x511327(0x204)](_0x5137ab,_0x511327(0x1c6));}if(dbUserTable[_0x511327(0x1b3)](_0x1e6a89,_0x5137ab)===!![]||_0x254e4c==_0x1e6a89[_0x511327(0x1c0)][_0x511327(0x252)]){let _0x5b0e60=dbUserTable['getUserPower'](_0x1e6a89[_0x511327(0x1f7)]['dbOther'],_0x254e4c,null,null,!![]),_0x3131b8=0x0;if(_0x5b0e60[_0x511327(0x1e3)]<0x1)return _0x5137ab[_0x511327(0x201)]({'code':0x0,'userPower':_0x5b0e60,'userMenu':_0x4761f2?_0x4761f2[_0x511327(0x1c2)]:[]});for(let _0x1900d1=0x0;_0x1900d1<_0x5b0e60['length'];_0x1900d1++){let _0x162504=_0x5b0e60[_0x1900d1][_0x511327(0x1c5)];fs[_0x511327(0x18f)](_0x162504,(_0x56f520,_0x2fc99b)=>{const _0x38c549=_0x511327;_0x3131b8+=0x1;_0x56f520?_0x5b0e60[_0x1900d1][_0x38c549(0x191)]=0x0:_0x5b0e60[_0x1900d1][_0x38c549(0x191)]=0x1;if(_0x3131b8==_0x5b0e60[_0x38c549(0x1e3)])return _0x5137ab[_0x38c549(0x201)]({'code':0x0,'userPower':_0x5b0e60,'userMenu':_0x4761f2?_0x4761f2[_0x38c549(0x1c2)]:[]});});}}}),router[_0x2e1c8c(0x223)]('/setUserPower',(_0x4abe2b,_0x402b8d,_0x48e1e7)=>{const _0x296834=_0x2e1c8c;let _0xc92cf9=_0x4abe2b[_0x296834(0x24a)][_0x296834(0x252)],_0x40700a=_0x4abe2b[_0x296834(0x24a)][_0x296834(0x1c5)],_0x38d2ed=_0x4abe2b[_0x296834(0x24a)]['server_type'];if(!_0xc92cf9||!_0x40700a||!_0x38d2ed)return _0x4abe2b[_0x296834(0x1f7)]['returnErrMsg'](_0x402b8d,_0x402b8d['__'](_0x296834(0x266)));let _0x22e781=null;if(_0xc92cf9!=config['publicUserName']){_0x22e781=dbUserTable['getUserByUserName'](_0x4abe2b[_0x296834(0x1f7)][_0x296834(0x20a)],_0xc92cf9);if(!_0x22e781)return _0x4abe2b[_0x296834(0x1f7)][_0x296834(0x204)](_0x402b8d,_0x296834(0x1c6));}_0x40700a=pathUtil[_0x296834(0x1e4)](_0x40700a);if(dbUserTable[_0x296834(0x1b3)](_0x4abe2b,_0x402b8d)===!![]){let _0x3cc7d8=dbUserTable[_0x296834(0x1ae)](_0x4abe2b[_0x296834(0x1f7)]['dbOther'],_0xc92cf9,_0x38d2ed,null,!![]);for(let _0x137fa9 of _0x3cc7d8){let _0xae77ee=_0x137fa9[_0x296834(0x1c5)];if(_0x40700a[_0x296834(0x1a0)](pathUtil[_0x296834(0x1e4)](_0xae77ee,pathUtil[_0x296834(0x1ef)]))&&_0x40700a!=_0xae77ee)return _0x4abe2b[_0x296834(0x1f7)][_0x296834(0x204)](_0x402b8d,_0x402b8d['__'](_0x296834(0x23f))+_0xae77ee,'dialog');if(_0xae77ee['startsWith'](pathUtil[_0x296834(0x1e4)](_0x40700a,pathUtil['sep']))&&_0x40700a!=_0xae77ee)return _0x4abe2b[_0x296834(0x1f7)][_0x296834(0x204)](_0x402b8d,_0x402b8d['__'](_0x296834(0x23f))+_0xae77ee,_0x296834(0x245));}let _0xec850b=dbUserTable[_0x296834(0x262)](_0x4abe2b['app']['dbOther'],_0x4abe2b[_0x296834(0x24a)]);return _0x402b8d['json']({'code':0x0,'result':_0xec850b});}}),router['post']('/setUserMenu',(_0x41eb2c,_0x49809f,_0x8898a9)=>{const _0x1fc2f9=_0x2e1c8c;let _0x2d6c13=_0x41eb2c[_0x1fc2f9(0x24a)][_0x1fc2f9(0x252)],_0x2c7544=_0x41eb2c[_0x1fc2f9(0x24a)][_0x1fc2f9(0x263)];if(!_0x2d6c13||!(_0x2c7544 instanceof Array))return _0x41eb2c[_0x1fc2f9(0x1f7)]['returnErrMsg'](_0x49809f,_0x1fc2f9(0x1e1));let _0x788905=dbUserTable[_0x1fc2f9(0x1bb)](_0x41eb2c[_0x1fc2f9(0x1f7)][_0x1fc2f9(0x20a)],_0x2d6c13);if(!_0x788905)return _0x41eb2c['app'][_0x1fc2f9(0x204)](_0x49809f,_0x1fc2f9(0x1c6));if(dbUserTable[_0x1fc2f9(0x1b3)](_0x41eb2c,_0x49809f)===!![])return dbUserTable[_0x1fc2f9(0x21e)](_0x41eb2c['app'][_0x1fc2f9(0x20a)],_0x2d6c13,_0x1fc2f9(0x1c2),JSON['stringify'](_0x2c7544)),_0x49809f[_0x1fc2f9(0x201)]({'code':0x0});}),router['post'](_0x2e1c8c(0x25c),(_0x16ca00,_0x5c7a27,_0x312351)=>{const _0x153325=_0x2e1c8c;let _0x12ac36=dbUserTable[_0x153325(0x1b7)](_0x16ca00[_0x153325(0x1f7)][_0x153325(0x20a)],_0x16ca00[_0x153325(0x24a)]);return _0x12ac36[_0x153325(0x237)]>0x0?_0x5c7a27[_0x153325(0x201)]({'code':0x0}):_0x16ca00[_0x153325(0x1f7)]['returnErrMsg'](_0x5c7a27,_0x5c7a27['__']('operationFail'));}),router[_0x2e1c8c(0x223)]('/changePassword',(_0x55e1c2,_0x327a2c,_0x1a79e4)=>{const _0x1d5bd8=_0x2e1c8c;let _0x514515=_0x55e1c2[_0x1d5bd8(0x24a)][_0x1d5bd8(0x1a8)],_0x1cd07d=_0x55e1c2[_0x1d5bd8(0x24a)][_0x1d5bd8(0x1af)];cryptoUtils[_0x1d5bd8(0x220)](config['passwordKey'],_0x514515)[_0x1d5bd8(0x1df)](_0xf0d360=>{const _0x581c67=_0x1d5bd8;if(_0x55e1c2[_0x581c67(0x1c0)]['password']!=_0xf0d360)return _0x327a2c[_0x581c67(0x201)]({'code':0x2,'message':_0x327a2c['__']('login.oldPwdErr')});else cryptoUtils[_0x581c67(0x220)](config[_0x581c67(0x258)],_0x1cd07d)[_0x581c67(0x1df)](_0x276f0c=>{const _0x58f02c=_0x581c67;dbUserTable[_0x58f02c(0x264)](_0x55e1c2[_0x58f02c(0x1f7)]['dbOther'],_0x55e1c2[_0x58f02c(0x1c0)]['id'],_0x58f02c(0x1b4),_0x276f0c);let _0x1a2142=sha256(new Date()['getTime']()+_0x55e1c2['currentUser']['username']+_0x55e1c2[_0x58f02c(0x1c0)][_0x58f02c(0x1b4)]);dbUserTable[_0x58f02c(0x264)](_0x55e1c2[_0x58f02c(0x1f7)][_0x58f02c(0x20a)],_0x55e1c2[_0x58f02c(0x1c0)]['id'],_0x58f02c(0x268),_0x1a2142);let _0x18c9b2=netUtils['getClientIp'](_0x55e1c2);return dbLoginTable[_0x58f02c(0x1ba)](_0x55e1c2[_0x58f02c(0x1f7)]['dbOther'],_0x58f02c(0x227),_0x55e1c2['currentUser']['id'],_0x18c9b2,_0x55e1c2[_0x58f02c(0x24a)]['client'],''),_0x327a2c[_0x58f02c(0x201)]({'code':0x0});})[_0x581c67(0x25e)](_0x581923=>{const _0x47599d=_0x581c67;return console[_0x47599d(0x1e7)](_0x47599d(0x269),_0x581923),_0x55e1c2[_0x47599d(0x1f7)][_0x47599d(0x204)](_0x327a2c,_0x327a2c['__'](_0x47599d(0x266)));});});}),router['post'](_0x2e1c8c(0x19a),(_0x1fe2fe,_0xa2690f,_0x43e58f)=>{const _0x6052c1=_0x2e1c8c;let _0x5e1f8b=_0x1fe2fe[_0x6052c1(0x24a)]['newQuestion'],_0x302e35=_0x1fe2fe[_0x6052c1(0x24a)][_0x6052c1(0x1d9)];if(checkUtil[_0x6052c1(0x1fc)](_0x302e35))return _0x1fe2fe[_0x6052c1(0x1f7)][_0x6052c1(0x204)](_0xa2690f,_0xa2690f['__'](_0x6052c1(0x232)));if(_0x5e1f8b==_0x302e35)return _0x1fe2fe[_0x6052c1(0x1f7)][_0x6052c1(0x204)](_0xa2690f,_0xa2690f['__'](_0x6052c1(0x212)));return dbUserTable['updateQuestionById'](_0x1fe2fe[_0x6052c1(0x1f7)]['dbOther'],_0x1fe2fe[_0x6052c1(0x1c0)]['id'],_0x5e1f8b,sha256(_0x302e35)),_0xa2690f[_0x6052c1(0x201)]({'code':0x0});}),router[_0x2e1c8c(0x223)]('/logout',(_0x37cd65,_0xdd48b6,_0x999663)=>{const _0x5e0b2f=_0x2e1c8c;let _0x48e57a=_0x37cd65[_0x5e0b2f(0x24a)][_0x5e0b2f(0x268)];return _0x48e57a&&dbUserTable[_0x5e0b2f(0x1d5)](_0x37cd65[_0x5e0b2f(0x1f7)][_0x5e0b2f(0x20a)],'\x20WHERE\x20token\x20=?',[_0x48e57a]),_0xdd48b6[_0x5e0b2f(0x201)]({'code':0x0});}),router['post'](_0x2e1c8c(0x1ff),(_0x221716,_0x67cb6f,_0x120b3f)=>{const _0x5e968c=_0x2e1c8c;let _0x18ca85=dbUserTable[_0x5e968c(0x251)](_0x221716[_0x5e968c(0x1f7)]['dbOther'],_0x221716[_0x5e968c(0x1c0)]['id']);return _0x18ca85?(_0x18ca85[_0x5e968c(0x1b4)]='',_0x18ca85[_0x5e968c(0x1d9)]='',_0x67cb6f[_0x5e968c(0x201)]({'code':0x0,'userInfo':_0x18ca85})):_0x67cb6f[_0x5e968c(0x201)]({'code':0x65});}),router[_0x2e1c8c(0x223)](_0x2e1c8c(0x1e5),(_0x3b9947,_0x4e7817,_0x55dd51)=>{const _0x3fd068=_0x2e1c8c;if(_0x3b9947[_0x3fd068(0x1c0)][_0x3fd068(0x197)]!=0x1)return _0x4e7817[_0x3fd068(0x201)]({'code':0x66});let _0x21973e=_0x3b9947[_0x3fd068(0x24a)]['ip'];if(_0x21973e=='localhost'||_0x21973e=='127.0.0.1')return _0x3b9947[_0x3fd068(0x1f7)][_0x3fd068(0x204)](_0x4e7817,_0x4e7817['__'](_0x3fd068(0x1d1)));let _0x1b056b=_0x3b9947['body'][_0x3fd068(0x18d)],_0x1c93b9=_0x3b9947['body'][_0x3fd068(0x221)];return dbLoginTable[_0x3fd068(0x1fd)](_0x3b9947[_0x3fd068(0x1f7)][_0x3fd068(0x20a)],_0x1b056b,_0x21973e,_0x1c93b9,_0x4e7817['__'](_0x3fd068(0x25d))),_0x3b9947[_0x3fd068(0x1f7)][_0x3fd068(0x261)](),_0x4e7817[_0x3fd068(0x201)]({'code':0x0});}),router['post'](_0x2e1c8c(0x1ec),(_0x4ef913,_0x5c9c7a,_0x3011c8)=>{const _0x53326e=_0x2e1c8c;if(_0x4ef913[_0x53326e(0x1c0)][_0x53326e(0x197)]!=0x1)return _0x5c9c7a['json']({'code':0x66});let _0x283004=_0x4ef913[_0x53326e(0x24a)]['id'];return dbLoginTable['deleteIp'](_0x4ef913['app'][_0x53326e(0x20a)],_0x283004),_0x4ef913[_0x53326e(0x1f7)][_0x53326e(0x261)](),_0x5c9c7a['json']({'code':0x0});}),router[_0x2e1c8c(0x223)]('/getIpList',(_0x364b63,_0x3db1c0,_0x2500f4)=>{const _0x2327fb=_0x2e1c8c;let _0x32bc88=_0x364b63[_0x2327fb(0x24a)][_0x2327fb(0x222)],_0x247d6e=_0x364b63[_0x2327fb(0x24a)][_0x2327fb(0x1d2)],_0x284951=_0x364b63[_0x2327fb(0x24a)][_0x2327fb(0x18d)],_0x11782d=new Date()[_0x2327fb(0x1e6)]();dbLoginTable[_0x2327fb(0x1b8)](_0x364b63['app']['dbOther'],_0x2327fb(0x259)+_0x11782d);let _0x494988='\x20type=\x27'+_0x284951+'\x27',_0x4874c7=dbLoginTable[_0x2327fb(0x1a1)](_0x364b63[_0x2327fb(0x1f7)][_0x2327fb(0x20a)],_0x494988),_0x21b440=(_0x32bc88-0x1)*_0x247d6e;_0x494988+='\x20order\x20by\x20id\x20desc\x20limit\x20'+_0x247d6e+'\x20offset\x20'+_0x21b440;let _0x2e4638=dbLoginTable[_0x2327fb(0x189)](_0x364b63[_0x2327fb(0x1f7)][_0x2327fb(0x20a)],_0x494988);return _0x3db1c0[_0x2327fb(0x201)]({'code':0x0,'data':_0x2e4638,'pageCount':Math[_0x2327fb(0x229)](_0x4874c7[_0x2327fb(0x208)]/_0x247d6e)});}),router[_0x2e1c8c(0x223)]('/getRecordList',(_0xcc416e,_0x30dcd6,_0x2f022d)=>{const _0x12f9bc=_0x2e1c8c;if(_0xcc416e[_0x12f9bc(0x1c0)][_0x12f9bc(0x197)]!=0x1)return _0x30dcd6[_0x12f9bc(0x201)]({'code':0x66});let _0x158d9e=0x1388,_0xe85073=_0xcc416e[_0x12f9bc(0x24a)][_0x12f9bc(0x222)],_0x2b3882=_0xcc416e[_0x12f9bc(0x24a)]['pageSize'],_0x403f0e=_0xcc416e[_0x12f9bc(0x24a)][_0x12f9bc(0x18d)],_0x2cb7e1='',_0x4bc96f=[];_0x403f0e?(_0x2cb7e1+='\x20type=?',_0x4bc96f['push'](_0x403f0e)):_0x2cb7e1=_0x12f9bc(0x1f9);let _0x20b33e=dbLoginTable[_0x12f9bc(0x231)](_0xcc416e[_0x12f9bc(0x1f7)]['dbOther'],_0x2cb7e1,_0x4bc96f)[_0x12f9bc(0x208)];if(_0x20b33e>_0x158d9e){let _0x30b74f=0x64,_0x34486a=dbLoginTable[_0x12f9bc(0x1e0)](_0xcc416e[_0x12f9bc(0x1f7)][_0x12f9bc(0x20a)],'\x20id\x20in(SELECT\x20id\x20FROM\x20login_record\x20ORDER\x20BY\x20id\x20LIMIT\x20'+_0x30b74f+')');_0x34486a[_0x12f9bc(0x237)]>0x0&&(_0x20b33e=_0x20b33e-_0x34486a[_0x12f9bc(0x237)]);}let _0x450e22=(_0xe85073-0x1)*_0x2b3882;_0x2cb7e1+=_0x12f9bc(0x21d),_0x4bc96f['push'](_0x2b3882),_0x4bc96f[_0x12f9bc(0x1f1)](_0x450e22);let _0x141e1d=dbLoginTable[_0x12f9bc(0x1ca)](_0xcc416e[_0x12f9bc(0x1f7)][_0x12f9bc(0x20a)],_0x2cb7e1,_0x4bc96f);return _0x30dcd6['json']({'code':0x0,'data':_0x141e1d,'pageCount':Math['ceil'](_0x20b33e/_0x2b3882)});}),module[_0x2e1c8c(0x1e8)]=router;