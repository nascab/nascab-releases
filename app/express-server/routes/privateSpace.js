const _0xf8d71=_0x59d3;(function(_0x461427,_0x203e5b){const _0x3ce9d2=_0x59d3,_0x322f1b=_0x461427();while(!![]){try{const _0x44abdf=-parseInt(_0x3ce9d2(0x145))/0x1+-parseInt(_0x3ce9d2(0x182))/0x2+-parseInt(_0x3ce9d2(0x129))/0x3+-parseInt(_0x3ce9d2(0x17e))/0x4*(parseInt(_0x3ce9d2(0xfc))/0x5)+parseInt(_0x3ce9d2(0x13c))/0x6*(parseInt(_0x3ce9d2(0x139))/0x7)+-parseInt(_0x3ce9d2(0x1ae))/0x8+-parseInt(_0x3ce9d2(0x141))/0x9*(-parseInt(_0x3ce9d2(0x146))/0xa);if(_0x44abdf===_0x203e5b)break;else _0x322f1b['push'](_0x322f1b['shift']());}catch(_0x128734){_0x322f1b['push'](_0x322f1b['shift']());}}}(_0x217a,0x1fb1a));let express=require(_0xf8d71(0x18a)),router=express[_0xf8d71(0x172)]();const Database=require('better-sqlite3');let dbPrivateSpaceTable=require(_0xf8d71(0x12a)),path=require('path'),fs=require('fs'),cryptoUtils=require(_0xf8d71(0x14d));const config=require(_0xf8d71(0x17f));let privateSpaceUtils=require(_0xf8d71(0x18f));function _0x59d3(_0x4baf9d,_0x34a3fc){const _0x217a20=_0x217a();return _0x59d3=function(_0x59d39e,_0x449b68){_0x59d39e=_0x59d39e-0xef;let _0x3f58f2=_0x217a20[_0x59d39e];return _0x3f58f2;},_0x59d3(_0x4baf9d,_0x34a3fc);}var faststart=require(_0xf8d71(0x123)),exifUtil=require('exifr');let uploadUtil=require('../utils/uploadUtils');const PassThrough=require(_0xf8d71(0x118))['PassThrough'],{Readable}=require('stream');let sha256=require(_0xf8d71(0x15d));const videoStreamUtil=require(_0xf8d71(0x14e));let fileUtil=require(_0xf8d71(0x10a));const folderSignString='nascabisthebest',folderSignFileName=_0xf8d71(0x181),configFolderName=_0xf8d71(0x16e),noCheckFileList=[_0xf8d71(0x163)];let FFmpeg=require(_0xf8d71(0x114))[_0xf8d71(0x15b)];function _0x217a(){const _0x184865=['send','getIndexByFileName','../../utils/transCodeUtil','json','encryptFileFromInputPipe','error','tokenPwdEncryptKey','dbOther','private.fileNameTooLong','encryptFile','savePath','create_uid','mkdir','genVideoTinyFile','toLowerCase','getAll','encryptString','tiny_path','catch','/deleteSpaceFiles','videoTypeList','message','dealFFmpegPath','992880WVyzqE','stat','not\x20found','base64','pipe','attachment;\x20filename*=UTF-8\x27\x27','/getDecodeFile*','readdir','length','private.spacePwdGtFour','rawImgTypeList','check_time','encodeFilename','changes','/updateSpaceName','orderField','deleteIndex','utf-8','journal_mode\x20=\x20WAL','toUpperCase','normalize','indexId','10OrBNIr','private.hasSameNameSpace','../utils/uploadPrivateUtils','download','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','space_token','private.passwordIncorrect','writeFile','ids','createReadStream','end','string','createToken','post','../utils/fileUtils','is_admin','count','uploadFile','private.onlyAdminCanDelete','headers','tiny-','error\x20space\x20id','filename_enc','desc','../../libs/nasTrans','resolve','space\x20id\x20is\x20null','app','stream','path','pragma','create','updateIndexField','needEmptyFolderPrivateSpace','body','sendFile','concat','getDurationFromStream','private.spaceNameCantNull','../utils/faststart','startsWith','checkStr','parse','\x27\x20where\x20id=','pwd','207090cYDuCP','../../db/dbPrivateSpaceTable','getTime','/importSpace','streams','genImageTinyFile','extname','type','join','replace','push','video','.mov','operationFail','currentUser','DateTimeOriginal','7ibUZgd','run','deleteSpaceToken','152886VZZpkk','spaceId','\x20id=','destroy','lastInsertRowid','9Fsypoa','UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?','close','private.configFileReadFail','22971AbGluK','7886120zNuUHL','exports','offsetCount','space\x20id\x20is\x20invalid','spacePwd','getIndexById','private.spaceFolderNotExist','../utils/cryptoUtils','../../utils/videoStreamUtil','size','includes','status','temp','filename','spaceName','noWritePermission','getAllByUid','ifExtIsSpecialFormat','log','decryptFileGetStream','folderPath','FFmpeg','getById','sha256','then','/addPrivateSpace','indexOf','/exportSpace','spaceToken','.DS_Store','space/index\x20id\x20is\x20null','from','W_OK','returnErrMsg','updateSpaceName','/checkPwd','image','decryptFile','toString','tiny','nascabconfig','UPDATE\x20private_space_index\x20SET\x20original_time=\x27','private.spaceConfigFileBroken','overMode','Router','private.uploadErrTryAgain','constants','prepare','START_WORKER_BG_TASK','EXPORT_PRIVATE_SPACE','privateSpaceKey','CreateDate','stringify','decryptString','getIndexByWhere','\x20order\x20by\x20','417204vAyPwZ','../../myConfig/config','query','nascabconfigenc','519124mMQSIq','ext','../utils/sharpUtils','access','/getAllSpace','getAllIndexByWhere','data','all','express','delete','unlink','/regularUpload','ffprobe','../utils/privateSpaceUtils','orderType','folder_path','private.noExist','getPrivateDbPath','createIndex','\x20limit\x20','over'];_0x217a=function(){return _0x184865;};return _0x217a();}const uploadPrivateUtil=require(_0xf8d71(0xfe)),privateSharpUtil=require(_0xf8d71(0x18f)),sharpUtil=require(_0xf8d71(0x184)),transCodeUtil=require(_0xf8d71(0x199));let dbArr=[];function checkSpaceId(_0x4dafa3,_0x57aa10){const _0x372fa0=_0xf8d71;let _0x456733=_0x4dafa3[_0x372fa0(0x11e)]['spaceId']||_0x4dafa3[_0x372fa0(0x180)][_0x372fa0(0x13d)];if(!_0x456733)return _0x4dafa3[_0x372fa0(0x117)]['returnErrMsg'](_0x57aa10,_0x372fa0(0x116));let _0x4d129b=dbPrivateSpaceTable[_0x372fa0(0x15c)](_0x4dafa3[_0x372fa0(0x117)][_0x372fa0(0x19e)],_0x456733);if(!_0x4d129b)return _0x4dafa3[_0x372fa0(0x117)][_0x372fa0(0x167)](_0x57aa10,_0x372fa0(0x149));return!![];}function checkSpaceName(_0x4692ea,_0x208ab1,_0x50675c){const _0x5e3ed2=_0xf8d71;if(!_0x50675c)return _0x4692ea[_0x5e3ed2(0x117)][_0x5e3ed2(0x167)](_0x208ab1,_0x208ab1['__'](_0x5e3ed2(0x122)));if(_0x50675c[_0x5e3ed2(0x1b6)]>0x1e)return _0x4692ea[_0x5e3ed2(0x117)][_0x5e3ed2(0x167)](_0x208ab1,_0x208ab1['__']('private.spaceNameTooLong'));return!![];}function getPrivateIndexDb(_0x2b29ea){const _0x312589=_0xf8d71;let _0x1c7d39=config[_0x312589(0x193)](_0x2b29ea);for(let _0x2aed1f in dbArr){if(dbArr[_0x2aed1f]['dbPath']==_0x1c7d39)return dbArr[_0x2aed1f]['db'];}let _0x2fddbb=new Database(_0x1c7d39,{});return _0x2fddbb[_0x312589(0x11a)](_0x312589(0xf8)),dbArr['push']({'dbPath':_0x1c7d39,'db':_0x2fddbb}),_0x2fddbb;}router[_0xf8d71(0x109)](_0xf8d71(0x15f),(_0x5a8f8b,_0x1555d0,_0x30d381)=>{const _0x5afb14=_0xf8d71;let _0x28c3a9=_0x5a8f8b[_0x5afb14(0x11e)][_0x5afb14(0x15a)],_0x444dca=_0x5a8f8b[_0x5afb14(0x11e)][_0x5afb14(0x154)],_0x17468a=_0x5a8f8b[_0x5afb14(0x137)],_0x3fd089=_0x5a8f8b[_0x5afb14(0x11e)]['spacePwd'];if(checkSpaceName(_0x5a8f8b,_0x1555d0,_0x444dca)!==!![])return;if(!_0x3fd089||_0x3fd089['length']<0x4)return _0x5a8f8b['app'][_0x5afb14(0x167)](_0x1555d0,_0x1555d0['__'](_0x5afb14(0xef)));function _0x1782cf(){return new Promise((_0x120cf3,_0x1e43a7)=>{const _0x2b802e=_0x59d3;fs[_0x2b802e(0x1af)](_0x28c3a9,(_0x60bb87,_0x586637)=>{const _0x555959=_0x2b802e;if(_0x60bb87)return _0x1e43a7(_0x1555d0['__'](_0x555959(0x11d)));if(_0x586637[_0x555959(0x14f)]>0x400*0x400*0x400)return _0x5a8f8b['app'][_0x555959(0x167)](_0x1555d0,_0x1555d0['__'](_0x555959(0x11d)));fs[_0x555959(0x1b5)](_0x28c3a9,(_0x4fce11,_0x4e3e57)=>{const _0x3e57fc=_0x555959;for(let _0x48c12a of _0x4e3e57){if(noCheckFileList[_0x3e57fc(0x150)](_0x48c12a)||_0x48c12a[_0x3e57fc(0x124)]('.')||_0x48c12a[_0x3e57fc(0x124)]('@'))continue;return _0x1e43a7(_0x1555d0['__'](_0x3e57fc(0x11d)));}_0x120cf3();});});});}fs['access'](_0x28c3a9,fs['constants']['R_OK']|fs[_0x5afb14(0x174)][_0x5afb14(0x166)],_0x1061b7=>{const _0x3ca136=_0x5afb14;if(_0x1061b7)return _0x5a8f8b[_0x3ca136(0x117)]['returnErrMsg'](_0x1555d0,_0x1555d0['__'](_0x3ca136(0x155)));_0x1782cf()[_0x3ca136(0x15e)](()=>{const _0x18e0ef=_0x3ca136;let _0x7ed558=dbPrivateSpaceTable['getBySpaceName'](_0x5a8f8b[_0x18e0ef(0x117)]['dbOther'],_0x444dca);if(_0x7ed558)return _0x5a8f8b['app'][_0x18e0ef(0x167)](_0x1555d0,_0x1555d0['__'](_0x18e0ef(0xfd)));let _0x2abbbc=path[_0x18e0ef(0x131)](_0x28c3a9,configFolderName);fs[_0x18e0ef(0x1a3)](_0x2abbbc,{'recursive':!![]},_0x5d61c6=>{const _0x42aace=_0x18e0ef;if(_0x5d61c6)return _0x5a8f8b['app'][_0x42aace(0x167)](_0x1555d0,_0x1555d0['__'](_0x42aace(0x136))+JSON['stringify'](_0x5d61c6));let _0x48026e=getPrivateIndexDb(_0x28c3a9);dbPrivateSpaceTable['createIndexDb'](_0x48026e,_0x28c3a9),cryptoUtils[_0x42aace(0x1a7)](_0x3fd089,folderSignString)[_0x42aace(0x15e)](_0x2c99ad=>{const _0x1ae159=_0x42aace;let _0xa0223f=path[_0x1ae159(0x131)](_0x2abbbc,folderSignFileName);fs[_0x1ae159(0x103)](_0xa0223f,_0x2c99ad,_0xc63d2a=>{const _0x2be587=_0x1ae159;if(_0xc63d2a)return _0x5a8f8b['app']['returnErrMsg'](_0x1555d0,_0x1555d0['__'](_0x2be587(0x136))+JSON['stringify'](_0xc63d2a));return dbPrivateSpaceTable[_0x2be587(0x11b)](_0x5a8f8b['app'][_0x2be587(0x19e)],{'folder_path':_0x28c3a9,'space_name':_0x444dca,'create_uid':_0x17468a['id']}),_0x1555d0[_0x2be587(0x19a)]({'code':0x0});});})[_0x42aace(0x1a9)](_0x2175ff=>{const _0x343b3f=_0x42aace;return console['log']('error',_0x2175ff),_0x5a8f8b[_0x343b3f(0x117)][_0x343b3f(0x167)](_0x1555d0,_0x1555d0['__'](_0x343b3f(0x136))+JSON[_0x343b3f(0x17a)](_0x2175ff));});});})['catch'](_0x2fdaa4=>{const _0x5f1d33=_0x3ca136;return _0x5a8f8b[_0x5f1d33(0x117)][_0x5f1d33(0x167)](_0x1555d0,_0x2fdaa4);});});}),router[_0xf8d71(0x109)](_0xf8d71(0x186),(_0x234dd6,_0x24fba8,_0x1790f7)=>{const _0x46b8ba=_0xf8d71;let _0x2bfacb=[];return _0x234dd6[_0x46b8ba(0x137)]['is_admin']==0x1?_0x2bfacb=dbPrivateSpaceTable[_0x46b8ba(0x1a6)](_0x234dd6[_0x46b8ba(0x117)][_0x46b8ba(0x19e)]):_0x2bfacb=dbPrivateSpaceTable[_0x46b8ba(0x156)](_0x234dd6[_0x46b8ba(0x117)][_0x46b8ba(0x19e)],_0x234dd6['currentUser']['id']),_0x24fba8[_0x46b8ba(0x19a)]({'code':0x0,'data':_0x2bfacb});});function checkSpacePwd(_0x54cb77,_0x36a623,_0x19700a){return new Promise((_0x54f3cf,_0x1d5d79)=>{const _0x14b72b=_0x59d3;_0x36a623=Buffer[_0x14b72b(0x165)](_0x36a623,'base64')[_0x14b72b(0x16c)]();let _0x36194c=path['join'](_0x19700a,configFolderName,folderSignFileName);fs[_0x14b72b(0x1af)](_0x36194c,(_0x350021,_0xdf6192)=>{const _0x1ebcc1=_0x14b72b;if(_0x350021)return _0x1d5d79(_0x54cb77['__'](_0x1ebcc1(0x144)));fs['readFile'](_0x36194c,_0x1ebcc1(0xf7),(_0x39db9e,_0x290ba0)=>{const _0xedcf65=_0x1ebcc1;if(_0x39db9e)return _0x1d5d79(_0x54cb77['__'](_0xedcf65(0x144)));else cryptoUtils[_0xedcf65(0x17b)](_0x36a623,_0x290ba0)['then'](_0x5098c3=>{const _0x1b1836=_0xedcf65;return _0x5098c3==folderSignString?_0x54f3cf(_0x36a623):_0x1d5d79(_0x54cb77['__'](_0x1b1836(0x102)));})[_0xedcf65(0x1a9)](_0x10ad74=>{const _0x286f5c=_0xedcf65;return console[_0x286f5c(0x158)]('error',_0x10ad74),_0x1d5d79(_0x54cb77['__'](_0x286f5c(0x102)));});});});});}router[_0xf8d71(0x109)](_0xf8d71(0x169),(_0x196707,_0x4e64f1,_0x3b2f0b)=>{const _0x4e6b3b=_0xf8d71;let _0x51769c=_0x196707[_0x4e6b3b(0x11e)][_0x4e6b3b(0x125)],_0x20523c=_0x196707[_0x4e6b3b(0x11e)][_0x4e6b3b(0x13d)],_0x199598=dbPrivateSpaceTable[_0x4e6b3b(0x15c)](_0x196707[_0x4e6b3b(0x117)]['dbOther'],_0x20523c);if(!_0x199598)return _0x196707[_0x4e6b3b(0x117)]['returnErrMsg'](_0x4e64f1,_0x4e6b3b(0x111));fs[_0x4e6b3b(0x1af)](_0x199598[_0x4e6b3b(0x191)],(_0x29394f,_0x38fab8)=>{const _0x5e89fe=_0x4e6b3b;if(_0x29394f)return _0x196707[_0x5e89fe(0x117)][_0x5e89fe(0x167)](_0x4e64f1,_0x4e64f1['__'](_0x5e89fe(0x14c)));checkSpacePwd(_0x4e64f1,_0x51769c,_0x199598[_0x5e89fe(0x191)])['then'](_0x26b218=>{const _0xcb75a6=_0x5e89fe;let _0x2b0bb0=sha256(new Date()[_0xcb75a6(0x12b)]()+_0x20523c+_0x26b218);cryptoUtils[_0xcb75a6(0x1a7)](config[_0xcb75a6(0x19d)],_0x26b218)['then'](_0x2c23c3=>{const _0x41b805=_0xcb75a6;return dbPrivateSpaceTable[_0x41b805(0x108)](_0x196707['app']['dbOther'],{'space_id':_0x20523c,'pwd':_0x2c23c3,'token':_0x2b0bb0}),_0x4e64f1[_0x41b805(0x19a)]({'code':0x0,'token':_0x2b0bb0});});})[_0x5e89fe(0x1a9)](_0x1000d6=>{const _0xc3c1b7=_0x5e89fe;return console[_0xc3c1b7(0x158)]('error',_0x1000d6),_0x196707[_0xc3c1b7(0x117)]['returnErrMsg'](_0x4e64f1,_0x1000d6);});});});function ffprobeSync(_0x5ac2e4){return new Promise((_0x1efd3f,_0x1db724)=>{const _0x8c5320=_0x59d3;try{FFmpeg(transCodeUtil[_0x8c5320(0x1ad)](_0x5ac2e4))[_0x8c5320(0x18e)]((_0x5aade0,_0x3b7817)=>{_0x5aade0?_0x1db724(_0x5aade0):_0x1efd3f(_0x3b7817);});}catch(_0x381e8a){console['log'](_0x8c5320(0x19c),_0x381e8a),_0x1db724(_0x381e8a);}});}function deleteFile(_0x2dd404){fs['rm'](_0x2dd404,{'maxRetries':0xa,'retryDelay':0x3e8},_0x53ff2b=>{});}function uploadFail(_0x3739e3,_0x3b0e57,_0x5ec931,_0x3b6ada){const _0x3eff72=_0xf8d71;return deleteFile(_0x3b0e57),_0x5ec931[_0x3eff72(0x117)][_0x3eff72(0x167)](_0x3b6ada,_0x3b6ada['__'](_0x3eff72(0x173)));}function dealUploadImageOrFile(_0x1577fa,_0x789ab5,_0x2b1e3c,_0x10d6d0,_0x548102,_0x2c09a3,_0x21eadd,_0x33bdaa,_0x1d5e59){uploadPrivateUtil['uploadFile'](_0x2b1e3c,_0x10d6d0,_0x548102,_0x2c09a3,_0x5a0632=>{const _0x31c954=_0x59d3;let _0x231961=_0x5a0632[_0x31c954(0x119)],_0xc04f4b=cryptoUtils[_0x31c954(0x159)](_0x2c09a3,_0x231961),_0x2132c4=dbPrivateSpaceTable[_0x31c954(0x194)](_0x1577fa,{'filename':new Buffer['from'](_0x33bdaa)[_0x31c954(0x16c)](_0x31c954(0x1b1)),'filename_enc':_0x548102,'file_type':_0x21eadd,'ext':_0x1d5e59});if(_0x2132c4[_0x31c954(0xf3)]<0x1)return uploadFail(_0x1577fa,_0x231961,_0x2b1e3c,_0x10d6d0);let _0x132d2b=_0x2132c4[_0x31c954(0x140)];_0x10d6d0[_0x31c954(0x19a)]({'code':0x0});let _0x5e6d85=new Date()['getTime']();if(_0x21eadd==_0x31c954(0x16a)){var _0x51ce05=[];let _0x3c17be=new PassThrough()[_0x31c954(0x1b2)](_0xc04f4b);_0x3c17be['on'](_0x31c954(0x188),function(_0x2fddd9){const _0x93febb=_0x31c954;_0x51ce05[_0x93febb(0x133)](_0x2fddd9);}),_0x3c17be['on'](_0x31c954(0x106),function(){const _0x3eb655=_0x31c954;var _0x268a1d=Buffer[_0x3eb655(0x120)](_0x51ce05);function _0x4b04d9(){const _0x441e65=_0x3eb655;exifUtil[_0x441e65(0x126)](_0x268a1d)[_0x441e65(0x15e)](_0x508715=>{const _0x4544b9=_0x441e65;if(_0x508715){let _0x1aa75c=_0x508715[_0x4544b9(0x138)];_0x508715[_0x4544b9(0x179)]&&!_0x1aa75c&&(_0x1aa75c=_0x508715[_0x4544b9(0x179)]),_0x1aa75c&&(_0x5e6d85=new Date(_0x1aa75c)[_0x4544b9(0x12b)](),_0x1577fa[_0x4544b9(0x175)](_0x4544b9(0x16f)+_0x5e6d85+_0x4544b9(0x127)+_0x132d2b)['run']());}})[_0x441e65(0x1a9)](_0x1538d7=>{});}privateSpaceUtils[_0x3eb655(0x12e)](_0x1d5e59,_0x268a1d,_0x13905d=>{const _0x451baf=_0x3eb655,_0x3559cc=Readable['from'](_0x13905d);let _0x228f70=path['join'](_0x789ab5,_0x548102);cryptoUtils['encryptFileFromInputPipe'](_0x2c09a3,_0x3559cc,_0x228f70)[_0x451baf(0x15e)](_0x193097=>{const _0xeaef1c=_0x451baf;let _0x32fb86=path[_0xeaef1c(0x131)](configFolderName,_0xeaef1c(0x16d),_0x548102);_0x1577fa[_0xeaef1c(0x175)](_0xeaef1c(0x100)+_0x32fb86+'\x27\x20where\x20id='+_0x132d2b)[_0xeaef1c(0x13a)](),_0x4b04d9();});},_0x4a8d48=>{_0x4b04d9();});});}});}function dealUploadVideo(_0x331699,_0x118540,_0x200233,_0x421172,_0x4b2e62,_0x4a80a9,_0x3b145f,_0x5683cb,_0x1ccd31,_0x39fa21,_0x8a44d3){const _0x11acea=_0xf8d71;_0x4b2e62['query'][_0x11acea(0x1a1)]=_0x421172,_0x4b2e62[_0x11acea(0x180)][_0x11acea(0x171)]=_0x11acea(0x196),uploadUtil[_0x11acea(0x10d)](_0x4b2e62,_0x4a80a9,![],!![],![],_0x280f48=>{const _0x466330=_0x11acea;let _0x2987f1=_0x280f48['path'],_0x3d258a=path[_0x466330(0x131)](_0x280f48['destination']);function _0x338cd3(_0x1e7420){const _0x35477d=_0x466330;ffprobeSync(_0x2987f1)[_0x35477d(0x15e)](_0x135b30=>{const _0x42eb2c=_0x35477d;let _0x8145f8=0x0;_0x8145f8=videoStreamUtil[_0x42eb2c(0x121)](_0x135b30);let _0x31906a=JSON[_0x42eb2c(0x17a)](_0x135b30[_0x42eb2c(0x12d)]),_0x268dc3=videoStreamUtil['getVideoOriginalTime'](_0x135b30);fs['stat'](_0x2987f1,(_0x2f4da6,_0x355ce7)=>{const _0x55e287=_0x42eb2c;if(_0x2f4da6){deleteFile(_0x2987f1);return;}let _0x34e979=_0x55e287(0x142);_0x331699['prepare'](_0x34e979)['run'](_0x268dc3,parseInt(_0x8145f8),_0x355ce7[_0x55e287(0x14f)],_0x31906a,_0x1e7420);let _0x5d78d9=_0x55e287(0x110)+Buffer['from'](_0x39fa21)[_0x55e287(0x16c)]('base64');privateSpaceUtils[_0x55e287(0x1a4)](_0x2987f1,_0x3d258a,_0x5d78d9,_0x4d14c1=>{const _0x8bdea=_0x55e287;fs[_0x8bdea(0x1af)](_0x4d14c1,(_0x148c26,_0x399bec)=>{const _0x21023d=_0x8bdea;if(_0x148c26){deleteFile(_0x2987f1);return;}let _0x332a93=path['join'](_0x200233,_0x3b145f);cryptoUtils[_0x21023d(0x1a0)](_0x5683cb,_0x4d14c1,_0x332a93)[_0x21023d(0x15e)](_0x2890e9=>{const _0x4991ee=_0x21023d;let _0x1e4a36=path[_0x4991ee(0x131)](configFolderName,'tiny',_0x3b145f);_0x331699[_0x4991ee(0x175)]('UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27'+_0x1e4a36+'\x27\x20where\x20id='+_0x1e7420)[_0x4991ee(0x13a)](),deleteFile(_0x4d14c1),deleteFile(_0x2987f1);});});},_0x2d6591=>{deleteFile(_0x2987f1);});});})[_0x35477d(0x1a9)](_0x471e57=>{deleteFile(_0x2987f1);});}function _0x39a581(){const _0x5ad54e=_0x466330;let _0x86979a=dbPrivateSpaceTable[_0x5ad54e(0x194)](_0x331699,{'filename':new Buffer['from'](_0x39fa21)[_0x5ad54e(0x16c)](_0x5ad54e(0x1b1)),'filename_enc':_0x3b145f,'file_type':_0x1ccd31,'ext':_0x8a44d3});return _0x86979a[_0x5ad54e(0xf3)]<0x1?uploadFail(_0x331699,_0x2987f1,_0x4b2e62,_0x4a80a9):(_0x338cd3(_0x86979a[_0x5ad54e(0x140)]),_0x4a80a9['json']({'code':0x0}));}function _0x4a8516(_0xc2b731,_0x11fbf7,_0x249bc8){const _0x4dec45=_0x466330;cryptoUtils[_0x4dec45(0x1a0)](_0x5683cb,_0xc2b731,_0x11fbf7)[_0x4dec45(0x15e)](_0x28c361=>{_0x249bc8(_0x28c361);})[_0x4dec45(0x1a9)](_0xd12556=>{const _0x2bbbc5=_0x4dec45;console[_0x2bbbc5(0x158)](_0xd12556),uploadFail(_0x331699,_0xc2b731,_0x4b2e62,_0x4a80a9);});}let _0x543bcb=path[_0x466330(0x131)](_0x118540[_0x466330(0x191)],_0x3b145f);if(_0x8a44d3=='.mp4'||_0x8a44d3==_0x466330(0x135)){var _0xa216b9=faststart[_0x466330(0x105)](_0x2987f1,{'errorCallBack':_0xe23210=>{_0x4a8516(_0x2987f1,_0x543bcb,_0x39a581);}});_0xa216b9['on'](_0x466330(0x143),function(){const _0x11a1f7=_0x466330;_0xa216b9[_0x11a1f7(0x13f)]();}),cryptoUtils[_0x466330(0x19b)](_0x5683cb,_0xa216b9,_0x543bcb)['then'](_0xbd23ad=>{_0x39a581();})[_0x466330(0x1a9)](_0x45a6f3=>{const _0x3be3b5=_0x466330;console[_0x3be3b5(0x158)](_0x3be3b5(0x19c),_0x45a6f3),uploadFail(_0x331699,_0x2987f1,_0x4b2e62,_0x4a80a9);});}else _0x4a8516(_0x2987f1,_0x543bcb,_0x39a581);});}router['post'](_0xf8d71(0x18d),function(_0x3f7fcb,_0x296bfc,_0x59f64f){const _0x353c67=_0xf8d71;let _0x24611e=_0x3f7fcb[_0x353c67(0x180)][_0x353c67(0x13d)]||_0x3f7fcb[_0x353c67(0x11e)][_0x353c67(0x13d)]||_0x3f7fcb[_0x353c67(0x10f)]['space_id'],_0x10b869=_0x3f7fcb[_0x353c67(0x180)][_0x353c67(0x153)]||_0x3f7fcb[_0x353c67(0x10f)][_0x353c67(0x153)],_0x39a780=decodeURIComponent(_0x10b869);_0x3f7fcb[_0x353c67(0x180)][_0x353c67(0xf2)]&&(_0x39a780=fileUtil['decodePath'](_0x3f7fcb[_0x353c67(0x180)][_0x353c67(0xf2)])),getPwdFromToken(_0x3f7fcb,_0x296bfc,_0xe19b6=>{const _0x46b3c0=_0x353c67;let _0x59f6e8=dbPrivateSpaceTable['getById'](_0x3f7fcb[_0x46b3c0(0x117)][_0x46b3c0(0x19e)],_0x24611e);if(!_0x59f6e8)return _0x3f7fcb[_0x46b3c0(0x117)][_0x46b3c0(0x167)](_0x296bfc,_0x296bfc['__'](_0x46b3c0(0x192)));_0x3f7fcb[_0x46b3c0(0x180)]['savePath']=_0x59f6e8['folder_path'];let _0x4706e8=getPrivateIndexDb(_0x59f6e8[_0x46b3c0(0x191)]),_0x18d59b=dbPrivateSpaceTable[_0x46b3c0(0x198)](_0x4706e8,new Buffer[(_0x46b3c0(0x165))](_0x39a780)[_0x46b3c0(0x16c)](_0x46b3c0(0x1b1)));if(_0x18d59b)return _0x3f7fcb[_0x46b3c0(0x117)][_0x46b3c0(0x167)](_0x296bfc,_0x296bfc['__']('private.alreadyHasSameNameFile'));let _0x4aec66=path[_0x46b3c0(0x12f)](_0x39a780)?path[_0x46b3c0(0x12f)](_0x39a780)['toLowerCase']():null,_0x70a6f7='other';if(_0x4aec66){if(config['imgTypeList'][_0x46b3c0(0x150)](_0x4aec66[_0x46b3c0(0x1a5)]())||config[_0x46b3c0(0xf0)][_0x46b3c0(0x150)](_0x4aec66[_0x46b3c0(0x1a5)]()))_0x70a6f7=_0x46b3c0(0x16a);else config[_0x46b3c0(0x1ab)]['includes'](_0x4aec66[_0x46b3c0(0x1a5)]())&&(_0x70a6f7='video');}let _0x48298d=path['join'](_0x59f6e8[_0x46b3c0(0x191)],configFolderName,_0x46b3c0(0x16d)),_0x471ef6=path[_0x46b3c0(0x131)](_0x59f6e8[_0x46b3c0(0x191)],configFolderName,_0x46b3c0(0x152));function _0x25df32(){const _0x457ee7=_0x46b3c0;cryptoUtils[_0x457ee7(0x1a7)](_0xe19b6,_0x39a780)[_0x457ee7(0x15e)](_0xc07541=>{const _0x462a62=_0x457ee7;if(_0xc07541[_0x462a62(0x1b6)]>0xf0)return _0x3f7fcb[_0x462a62(0x117)][_0x462a62(0x167)](_0x296bfc,_0x296bfc['__'](_0x462a62(0x19f)));_0x70a6f7==_0x462a62(0x134)?dealUploadVideo(_0x4706e8,_0x59f6e8,_0x48298d,_0x471ef6,_0x3f7fcb,_0x296bfc,_0xc07541,_0xe19b6,_0x70a6f7,_0x39a780,_0x4aec66):dealUploadImageOrFile(_0x4706e8,_0x48298d,_0x3f7fcb,_0x296bfc,_0xc07541,_0xe19b6,_0x70a6f7,_0x39a780,_0x4aec66);});}fs[_0x46b3c0(0x1af)](_0x48298d,(_0x254294,_0xfc377f)=>{const _0x19595e=_0x46b3c0;function _0x56fd50(){const _0x2562ff=_0x59d3;fs[_0x2562ff(0x1af)](_0x471ef6,(_0x29f333,_0x3372a3)=>{const _0x37bbc=_0x2562ff;_0x29f333?fs[_0x37bbc(0x1a3)](_0x471ef6,{'recursive':!![]},_0x1115e9=>{_0x25df32();}):_0x25df32();});}_0x254294?fs[_0x19595e(0x1a3)](_0x48298d,{'recursive':!![]},_0x43b699=>{_0x56fd50();}):_0x56fd50();});});}),router['post'](_0xf8d71(0x12c),(_0x396852,_0x4449a5,_0xc81c30)=>{const _0x575c61=_0xf8d71;let _0x5119ed=_0x396852['body']['folderPath'],_0x527f48=_0x396852[_0x575c61(0x11e)][_0x575c61(0x154)],_0x2e5899=_0x396852[_0x575c61(0x137)],_0x12ced4=_0x396852[_0x575c61(0x11e)]['spacePwd'];if(!_0x527f48)return _0x396852['app'][_0x575c61(0x167)](_0x4449a5,_0x4449a5['__'](_0x575c61(0x122)));let _0x3dec7c=dbPrivateSpaceTable['getBySpaceName'](_0x396852[_0x575c61(0x117)]['dbOther'],_0x527f48);if(_0x3dec7c)return _0x396852['app'][_0x575c61(0x167)](_0x4449a5,_0x4449a5['__'](_0x575c61(0xfd)));if(!_0x12ced4)return _0x396852['app'][_0x575c61(0x167)](_0x4449a5,_0x4449a5['__'](_0x575c61(0xef)));fs[_0x575c61(0x185)](_0x5119ed,_0x514608=>{const _0x24f0b3=_0x575c61;if(_0x514608)return _0x396852[_0x24f0b3(0x117)][_0x24f0b3(0x167)](_0x4449a5,_0x4449a5['__']('noWritePermission'));checkSpacePwd(_0x4449a5,_0x12ced4,_0x5119ed)[_0x24f0b3(0x15e)](()=>{const _0x29298f=_0x24f0b3;let _0x58ccfa=config[_0x29298f(0x193)](_0x5119ed);fs[_0x29298f(0x1af)](_0x58ccfa,(_0x5d7e24,_0x5eb910)=>{const _0x14fadb=_0x29298f;if(_0x5d7e24)return _0x396852[_0x14fadb(0x117)][_0x14fadb(0x167)](_0x4449a5,_0x4449a5['__'](_0x14fadb(0x170)));return dbPrivateSpaceTable[_0x14fadb(0x11b)](_0x396852[_0x14fadb(0x117)][_0x14fadb(0x19e)],{'folder_path':_0x5119ed,'space_name':_0x527f48,'create_uid':_0x2e5899['id']}),_0x4449a5[_0x14fadb(0x19a)]({'code':0x0});});})[_0x24f0b3(0x1a9)](_0x3c4681=>{const _0x1e5455=_0x24f0b3;return _0x396852[_0x1e5455(0x117)][_0x1e5455(0x167)](_0x4449a5,_0x3c4681);});});}),router[_0xf8d71(0x109)](_0xf8d71(0x161),(_0x2fbb4d,_0x1edc09,_0x10ccd6)=>{const _0x2acfd4=_0xf8d71;let _0x1fb6b3=_0x2fbb4d[_0x2acfd4(0x11e)][_0x2acfd4(0x15a)],_0x1c29ce=_0x2fbb4d[_0x2acfd4(0x11e)][_0x2acfd4(0x14a)],_0x6f526=_0x2fbb4d[_0x2acfd4(0x11e)]['targetFolderPath'];if(!_0x1c29ce)return _0x2fbb4d[_0x2acfd4(0x117)]['returnErrMsg'](_0x1edc09,_0x1edc09['__']('private.spacePwdGtFour'));fs['access'](_0x1fb6b3,fs[_0x2acfd4(0x174)]['R_OK'],_0x40acad=>{const _0x30b6e4=_0x2acfd4;if(_0x40acad)return _0x2fbb4d[_0x30b6e4(0x117)][_0x30b6e4(0x167)](_0x1edc09,_0x1edc09['__']('noWritePermission'));fs[_0x30b6e4(0x185)](_0x6f526,fs['constants'][_0x30b6e4(0x166)],_0x441060=>{const _0x15bee5=_0x30b6e4;if(_0x441060)return _0x2fbb4d[_0x15bee5(0x117)][_0x15bee5(0x167)](_0x1edc09,_0x1edc09['__'](_0x15bee5(0x155)));function _0x374883(_0x50c4a0){const _0x4e6762=_0x15bee5;cryptoUtils[_0x4e6762(0x1a7)](config[_0x4e6762(0x178)],_0x1c29ce)['then'](_0x2b8871=>{const _0x3d1cd7=_0x4e6762;return _0x50c4a0[_0x3d1cd7(0x117)]['dbOther']['prepare']('INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)')[_0x3d1cd7(0x13a)](_0x3d1cd7(0x177),JSON['stringify']({'folderPath':_0x1fb6b3,'targetFolderPath':_0x6f526,'spacePwd':_0x2b8871})),process[_0x3d1cd7(0x197)]({'type':_0x3d1cd7(0x176)}),_0x1edc09[_0x3d1cd7(0x19a)]({'code':0x0});});}let _0x12a864=path['join'](_0x1fb6b3,configFolderName,folderSignFileName);fs[_0x15bee5(0x1af)](_0x12a864,(_0x35c7f9,_0x441270)=>{const _0x5a2401=_0x15bee5;_0x35c7f9?_0x374883(_0x2fbb4d):checkSpacePwd(_0x1edc09,_0x1c29ce,_0x1fb6b3)[_0x5a2401(0x15e)](()=>{_0x374883(_0x2fbb4d);})[_0x5a2401(0x1a9)](_0xfc8241=>{const _0x51cd8a=_0x5a2401;return console[_0x51cd8a(0x158)](_0xfc8241),_0x2fbb4d[_0x51cd8a(0x117)][_0x51cd8a(0x167)](_0x1edc09,_0x1edc09['__'](_0x51cd8a(0x102)));});});});});}),router[_0xf8d71(0x109)](_0xf8d71(0x1aa),(_0x4e6f5e,_0x24f37b,_0xc6b402)=>{const _0x1595be=_0xf8d71;let _0x176f11=_0x4e6f5e[_0x1595be(0x11e)][_0x1595be(0x13d)],_0x2c3521=_0x4e6f5e[_0x1595be(0x11e)][_0x1595be(0x104)];if(!_0x2c3521||_0x2c3521['length']<0x1)return _0x24f37b[_0x1595be(0x151)](0x194)['end']();let _0x2a42f8=dbPrivateSpaceTable['getById'](_0x4e6f5e['app'][_0x1595be(0x19e)],_0x176f11);if(!_0x2a42f8)return _0x24f37b['status'](0x194)[_0x1595be(0x106)]();if(_0x4e6f5e['currentUser']['is_admin']!=0x1){if(_0x2a42f8[_0x1595be(0x1a2)]!=_0x4e6f5e[_0x1595be(0x137)]['id'])return _0x24f37b[_0x1595be(0x19a)]({'code':0x1,'message':_0x24f37b['__'](_0x1595be(0x10e))});}try{let _0x2ecc35=getPrivateIndexDb(_0x2a42f8['folder_path']),_0x60158=JSON[_0x1595be(0x126)](_0x2c3521),_0x2a83d4=0x0,_0x5a544a=[],_0x1f6f2a=0x0,_0x2e584a=0x0;if(_0x60158[_0x1595be(0x1b6)]<0x1)return _0x24f37b['json']({'code':0x0,'deleteList':_0x5a544a,'deleteCount':_0x2a83d4,'errCount':_0x1f6f2a});for(let _0x474eeb=0x0;_0x474eeb<_0x60158['length'];_0x474eeb++){let _0x3f5893=dbPrivateSpaceTable[_0x1595be(0x17c)](_0x2ecc35,_0x1595be(0x13e)+_0x60158[_0x474eeb]);if(!_0x3f5893)return _0x4e6f5e['app']['returnErrMsg'](_0x24f37b,_0x24f37b['__']('folderNotExist'));let _0x237379=path['join'](_0x2a42f8[_0x1595be(0x191)],_0x3f5893[_0x1595be(0x112)]);if(_0x3f5893[_0x1595be(0x1a8)]&&_0x3f5893[_0x1595be(0x1a8)]!='undefined'){let _0x51a094=path['join'](_0x2a42f8[_0x1595be(0x191)],_0x3f5893[_0x1595be(0x1a8)]);try{fs[_0x1595be(0x18c)](_0x51a094,_0x34fd46=>{});}catch(_0x54dcc5){}}fs[_0x1595be(0x18c)](_0x237379,_0x1f0044=>{const _0x1d9bbc=_0x1595be;_0x2e584a+=0x1;_0x1f0044?(console['log']('err',_0x1f0044[_0x1d9bbc(0x1ac)]),_0x1f6f2a+=0x1):(_0x2a83d4+=0x1,_0x5a544a['push'](_0x60158[_0x474eeb]));dbPrivateSpaceTable[_0x1d9bbc(0xf6)](_0x2ecc35,_0x60158[_0x474eeb]);if(_0x2e584a==_0x60158[_0x1d9bbc(0x1b6)])return _0x24f37b['json']({'code':0x0,'deleteList':_0x5a544a,'deleteCount':_0x2a83d4,'errCount':_0x1f6f2a});});}}catch(_0x438312){return console['log'](_0x1595be(0x19c),_0x438312),_0x24f37b['json']({'code':0x1,'message':JSON[_0x1595be(0x17a)](_0x438312)});}}),router[_0xf8d71(0x109)]('/deleteSpace',(_0x4b9df0,_0xdd6594,_0x17fa4e)=>{const _0x563588=_0xf8d71;if(checkSpaceId(_0x4b9df0,_0xdd6594)!==!![])return;let _0x46bb5f=_0x4b9df0[_0x563588(0x11e)]['spaceId'],_0x126fdc=dbPrivateSpaceTable[_0x563588(0x15c)](_0x4b9df0[_0x563588(0x117)][_0x563588(0x19e)],_0x46bb5f);if(_0x4b9df0[_0x563588(0x137)]['is_admin']!=0x1){if(_0x126fdc[_0x563588(0x1a2)]!=_0x4b9df0[_0x563588(0x137)]['id'])return _0xdd6594[_0x563588(0x19a)]({'code':0x1,'message':_0xdd6594['__'](_0x563588(0x10e))});}return dbPrivateSpaceTable[_0x563588(0x18b)](_0x4b9df0[_0x563588(0x117)][_0x563588(0x19e)],_0x46bb5f),_0xdd6594[_0x563588(0x19a)]({'code':0x0});}),router[_0xf8d71(0x109)](_0xf8d71(0xf4),(_0x603fc1,_0x19ca3e,_0x18e12e)=>{const _0x289c8f=_0xf8d71;let _0x4e7c93=_0x603fc1[_0x289c8f(0x11e)][_0x289c8f(0x154)],_0x3f8840=_0x603fc1['body'][_0x289c8f(0x13d)];if(checkSpaceId(_0x603fc1,_0x19ca3e)!==!![])return;if(checkSpaceName(_0x603fc1,_0x19ca3e,_0x4e7c93)!==!![])return;let _0x1a1661=dbPrivateSpaceTable[_0x289c8f(0x15c)](_0x603fc1[_0x289c8f(0x117)][_0x289c8f(0x19e)],_0x3f8840);if(_0x603fc1[_0x289c8f(0x137)][_0x289c8f(0x10b)]!=0x1){if(_0x1a1661[_0x289c8f(0x1a2)]!=_0x603fc1['currentUser']['id'])return _0x19ca3e[_0x289c8f(0x19a)]({'code':0x1,'message':_0x19ca3e['__'](_0x289c8f(0x10e))});}return dbPrivateSpaceTable[_0x289c8f(0x168)](_0x603fc1[_0x289c8f(0x117)][_0x289c8f(0x19e)],_0x4e7c93,_0x3f8840),_0x19ca3e['json']({'code':0x0});}),router['post']('/getFileList',(_0x49a4d1,_0x54c21b,_0xf2205e)=>{const _0x219794=_0xf8d71;let _0x19d503=_0x49a4d1[_0x219794(0x11e)]['spaceId'];if(!_0x19d503)return _0x49a4d1[_0x219794(0x117)][_0x219794(0x167)](_0x54c21b,_0x219794(0x116));let _0x4dd730=dbPrivateSpaceTable['getById'](_0x49a4d1[_0x219794(0x117)][_0x219794(0x19e)],_0x19d503);if(!_0x4dd730)return _0x49a4d1[_0x219794(0x117)]['returnErrMsg'](_0x54c21b,_0x219794(0x149));let _0x2d2413=config['getPrivateDbPath'](_0x4dd730[_0x219794(0x191)]);fs[_0x219794(0x1af)](_0x2d2413,(_0x5335f3,_0x335ae5)=>{const _0x2a9fb=_0x219794;if(_0x5335f3)return _0x49a4d1[_0x2a9fb(0x117)][_0x2a9fb(0x167)](_0x54c21b,_0x54c21b['__'](_0x2a9fb(0x170)));let _0x2d4120=_0x49a4d1[_0x2a9fb(0x11e)][_0x2a9fb(0x10c)]||0x64,_0x497651=_0x49a4d1['body'][_0x2a9fb(0x148)]||0x0,_0x2b1064=_0x49a4d1[_0x2a9fb(0x11e)][_0x2a9fb(0xf5)]||'id',_0x2c20a1=_0x49a4d1[_0x2a9fb(0x11e)][_0x2a9fb(0x190)]||_0x2a9fb(0x113),_0x5e06ac=_0x49a4d1[_0x2a9fb(0x11e)]['fileType'],_0x2acf0c=getPrivateIndexDb(_0x4dd730[_0x2a9fb(0x191)]),_0x596587='';_0x5e06ac&&_0x5e06ac!=_0x2a9fb(0x189)&&(_0x596587+='\x20WHERE\x20file_type=\x27'+_0x5e06ac+'\x27');_0x596587+=_0x2a9fb(0x17d)+_0x2b1064+'\x20'+_0x2c20a1+_0x2a9fb(0x195)+_0x2d4120+'\x20offset\x20'+_0x497651;let _0x4abc7c=dbPrivateSpaceTable[_0x2a9fb(0x187)](_0x2acf0c,_0x596587);return _0x54c21b['json']({'code':0x0,'data':_0x4abc7c});});});function getPwdFromToken(_0x2aee1b,_0x11c5a6,_0x464197){const _0x24fb38=_0xf8d71;let _0x497acd=_0x2aee1b[_0x24fb38(0x180)][_0x24fb38(0x162)]||_0x2aee1b[_0x24fb38(0x11e)][_0x24fb38(0x162)]||_0x2aee1b[_0x24fb38(0x10f)][_0x24fb38(0x101)],_0x17a279=dbPrivateSpaceTable['getTokenObjByToken'](_0x2aee1b[_0x24fb38(0x117)][_0x24fb38(0x19e)],_0x497acd);if(!_0x17a279)return _0x11c5a6[_0x24fb38(0x19a)]({'code':0x68});let _0x4d1c33=_0x17a279[_0x24fb38(0x128)];cryptoUtils[_0x24fb38(0x17b)](config[_0x24fb38(0x19d)],_0x4d1c33)[_0x24fb38(0x15e)](_0x5361fc=>{_0x464197(_0x5361fc);})['catch'](_0x5700b7=>{const _0x35b2db=_0x24fb38;console[_0x35b2db(0x158)](_0x5700b7);});}router['get'](_0xf8d71(0x1b4),(_0xb45fbd,_0x45f0b8,_0x1b9b88)=>{const _0x3c8229=_0xf8d71;try{let _0x2c1e4b=_0xb45fbd[_0x3c8229(0x180)][_0x3c8229(0x13d)],_0x2209fa=_0xb45fbd[_0x3c8229(0x180)][_0x3c8229(0xfb)],_0x488c02=_0xb45fbd['query'][_0x3c8229(0xff)],_0x3dae50=_0xb45fbd[_0x3c8229(0x180)][_0x3c8229(0x130)];if(!_0x2c1e4b||!_0x2209fa)return _0xb45fbd['app']['returnErrMsg'](_0x45f0b8,_0x3c8229(0x164));let _0x4b4c21=dbPrivateSpaceTable[_0x3c8229(0x15c)](_0xb45fbd[_0x3c8229(0x117)][_0x3c8229(0x19e)],_0x2c1e4b);if(!_0x4b4c21)return _0xb45fbd[_0x3c8229(0x117)]['returnErrMsg'](_0x45f0b8,'space\x20id\x20is\x20invalid');getPwdFromToken(_0xb45fbd,_0x45f0b8,_0x1164a1=>{const _0xbcaaa2=_0x3c8229;let _0x32707b=getPrivateIndexDb(_0x4b4c21[_0xbcaaa2(0x191)]),_0x21a10f=dbPrivateSpaceTable[_0xbcaaa2(0x14b)](_0x32707b,_0x2209fa);if(!_0x21a10f)return _0x45f0b8[_0xbcaaa2(0x151)](0x194)[_0xbcaaa2(0x106)]();let _0x1d59f0='';function _0x2179b0(_0x9d810f){return path['normalize'](_0x9d810f['replace'](/[\\/]/g,path['sep']));}_0x3dae50==_0xbcaaa2(0x16d)?_0x1d59f0=path[_0xbcaaa2(0x115)](path[_0xbcaaa2(0xfa)](path[_0xbcaaa2(0x131)](_0x4b4c21[_0xbcaaa2(0x191)],_0x2179b0(_0x21a10f['tiny_path'])))):_0x1d59f0=path['resolve'](path[_0xbcaaa2(0xfa)](path[_0xbcaaa2(0x131)](_0x4b4c21['folder_path'],_0x2179b0(_0x21a10f[_0xbcaaa2(0x112)]))));if(_0x488c02==0x1)try{let _0x3c28dc=Buffer[_0xbcaaa2(0x165)](_0x21a10f[_0xbcaaa2(0x153)],_0xbcaaa2(0x1b1))[_0xbcaaa2(0x16c)]();const _0x550501=encodeURIComponent(_0x3c28dc)[_0xbcaaa2(0x132)](/%([0-9A-F]{2})/g,(_0x392d8b,_0xd3f310)=>'%'+_0xd3f310[_0xbcaaa2(0xf9)]());_0x45f0b8['setHeader']('Content-Disposition',_0xbcaaa2(0x1b3)+_0x550501);}catch(_0x51b73d){console['log'](_0x51b73d);}fs[_0xbcaaa2(0x1af)](_0x1d59f0,(_0x51377c,_0x538a78)=>{const _0x4c6989=_0xbcaaa2;if(_0x51377c)return console['log'](_0x4c6989(0x1b0),_0x1d59f0),_0x45f0b8['status'](0x194)[_0x4c6989(0x106)]();if(_0x1d59f0[_0x4c6989(0x160)](_0x4c6989(0x16d))==-0x1){let _0x1411be=dbPrivateSpaceTable[_0x4c6989(0x11c)](_0x32707b,_0x4c6989(0xf1),new Date()[_0x4c6989(0x12b)](),_0x2209fa);}if(sharpUtil['ifExtIsSpecialFormat'](_0x21a10f[_0x4c6989(0x183)])&&_0x3dae50!='tiny'){let _0x3cc761=cryptoUtils[_0x4c6989(0x159)](_0x1164a1,_0x1d59f0);fileUtil['streamToBuffer'](_0x3cc761)[_0x4c6989(0x15e)](_0x20c5fd=>{sharpUtil['transSpcielFormatFromBuffer'](_0x21a10f['ext'],_0x20c5fd,(_0x1b9668,_0x53b737,_0x31d704)=>{const _0x373154=_0x59d3;sharpUtil[_0x373154(0x157)](_0x21a10f[_0x373154(0x183)][_0x373154(0x1a5)]())?sharpUtil['sharpDealImg'](_0x1b9668,null,![],null,'buffer',null,_0xed9f1d=>{const _0x5dd159=_0x373154;_0x45f0b8['send'](Buffer[_0x5dd159(0x165)](_0xed9f1d));},_0x343c91=>{const _0x39f022=_0x373154;return console[_0x39f022(0x158)](_0x343c91),_0x45f0b8[_0x39f022(0x151)](0x194)[_0x39f022(0x106)]();},_0x53b737,_0x31d704):typeof _0x1b9668==_0x373154(0x107)?(_0x45f0b8[_0x373154(0x11f)](_0x1b9668),_0x45f0b8['on'](_0x373154(0x143),()=>{_0x53b737&&fs['rm'](_0x1b9668,_0x1f32a9=>{});})):_0x45f0b8[_0x373154(0x197)](_0x1b9668);});});}else cryptoUtils[_0x4c6989(0x16b)](_0x1164a1,_0x1d59f0,_0x45f0b8,_0x45f0b8);return;});});}catch(_0x58f5a5){return console[_0x3c8229(0x158)](_0x58f5a5),_0x45f0b8[_0x3c8229(0x151)](0x194)[_0x3c8229(0x106)]();}}),router[_0xf8d71(0x109)]('/exitSpaceId',(_0x48a6a9,_0x4862d5,_0x14465b)=>{const _0x3de544=_0xf8d71;try{return dbPrivateSpaceTable[_0x3de544(0x13b)](_0x48a6a9[_0x3de544(0x117)][_0x3de544(0x19e)],_0x48a6a9[_0x3de544(0x11e)]['spaceId']),_0x4862d5['status'](0xc8)['end']();}catch(_0x51cfa2){return console['log'](_0x51cfa2),_0x4862d5[_0x3de544(0x151)](0x194)[_0x3de544(0x106)]();}}),module[_0xf8d71(0x147)]=router;