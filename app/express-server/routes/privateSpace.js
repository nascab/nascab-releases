const _0x5597bc=_0x9ab7;(function(_0x4b5fb5,_0x2f0a9d){const _0xea6a55=_0x9ab7,_0x3cf0fe=_0x4b5fb5();while(!![]){try{const _0x21c67e=parseInt(_0xea6a55(0x145))/0x1*(-parseInt(_0xea6a55(0xe1))/0x2)+parseInt(_0xea6a55(0x10b))/0x3+parseInt(_0xea6a55(0xc0))/0x4*(parseInt(_0xea6a55(0xc6))/0x5)+-parseInt(_0xea6a55(0x11e))/0x6*(-parseInt(_0xea6a55(0xed))/0x7)+parseInt(_0xea6a55(0xfe))/0x8+parseInt(_0xea6a55(0x16b))/0x9*(parseInt(_0xea6a55(0xe0))/0xa)+-parseInt(_0xea6a55(0xec))/0xb*(parseInt(_0xea6a55(0xe6))/0xc);if(_0x21c67e===_0x2f0a9d)break;else _0x3cf0fe['push'](_0x3cf0fe['shift']());}catch(_0x17347d){_0x3cf0fe['push'](_0x3cf0fe['shift']());}}}(_0x42a2,0x81ec5));let express=require(_0x5597bc(0xac)),router=express[_0x5597bc(0xff)]();const Database=require('better-sqlite3');let dbPrivateSpaceTable=require(_0x5597bc(0x11b)),path=require(_0x5597bc(0x131)),fs=require('fs'),cryptoUtils=require(_0x5597bc(0xe8));const config=require(_0x5597bc(0xd8));let privateSpaceUtils=require(_0x5597bc(0xf5));function _0x42a2(){const _0x57c4f5=['is_admin','create','Content-Disposition','space\x20id\x20is\x20invalid','UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?','7065GoTTOy','fileType','/getAllSpace','rawImgTypeList','pipe','mkdir','updateIndexField','createIndex','journal_mode\x20=\x20WAL','attachment;\x20filename*=UTF-8\x27\x27','nascabconfigenc','startsWith','readdir','getAllIndexByWhere','encryptString','getAllByUid','getTokenObjByToken','getVideoOriginalTime','folderNotExist','tiny-','express','targetFolderPath','../utils/uploadPrivateUtils','/deleteSpace','stringify','writeFile','space\x20id\x20is\x20null','space/index\x20id\x20is\x20null','../utils/sharpUtils','tiny','stat','indexOf','DateTimeOriginal','PassThrough','desc','folder_path','.mp4','create_uid','getTime','exifr','20lmLETt','image','all','returnErrMsg','destroy','CreateDate','602825vxNmAX','needEmptyFolderPrivateSpace','createReadStream','getAll','pragma','updateSpaceName','lastInsertRowid','prepare','unlink','query','/addPrivateSpace','indexId','run','streams','not\x20found','private.spaceFolderNotExist','\x20order\x20by\x20','privateSpaceKey','../../myConfig/config','getPrivateDbPath','spaceName','currentUser','overMode','private.spaceConfigFileBroken','encryptFileFromInputPipe','tiny_path','510mlCbRn','464FvNPCU','encodeFilename','body','decryptFile','stream','12WuSGDc','normalize','../utils/cryptoUtils','videoTypeList','headers','genVideoTinyFile','10321916KMWiHA','229817nSgEIR','../utils/fileUtils','message','\x27\x20where\x20id=','operationFail','checkStr','private.configFileReadFail','string','../utils/privateSpaceUtils','ids','private.spaceNameTooLong','../utils/faststart','push','\x20limit\x20','changes','/exitSpaceId','offsetCount','1077072FSqCQO','Router','sha256','filename','createToken','sendFile','concat','../../utils/transCodeUtil','private.hasSameNameSpace','over','decryptFileGetStream','orderType','readFile','1037061ewbuzJ','/getFileList','dbPath','private.spaceNameCantNull','../../libs/nasTrans','exports','error','access','filename_enc','resolve','buffer','length','getIndexById','join','encryptFile','getIndexByWhere','../../db/dbPrivateSpaceTable','spacePwd','deleteSpaceToken','72yXOLTe','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','getBySpaceName','undefined','dbOther','\x20offset\x20','getIndexByFileName','video','post','send','noWritePermission','then','other','log','parse','base64','get','private.uploadErrTryAgain','EXPORT_PRIVATE_SPACE','path','createIndexDb','sharpDealImg','FFmpeg','nascabconfig','end','status','app','check_time','err','W_OK','private.onlyAdminCanDelete','private.passwordIncorrect','ifExtIsSpecialFormat','tokenPwdEncryptKey','/importSpace','setHeader','private.spacePwdGtFour','genImageTinyFile','constants','201oZpxJD','toLowerCase','toUpperCase','../../utils/videoStreamUtil','/exportSpace','transSpcielFormatFromBuffer','/checkPwd','space_token','from','count','catch','data','uploadFile','nascabisthebest','replace','extname','spaceId','ext','getById','space_id','includes','START_WORKER_BG_TASK','temp','R_OK','type','dealFFmpegPath','json','pwd','orderField','decryptString','toString','close','private.fileNameTooLong'];_0x42a2=function(){return _0x57c4f5;};return _0x42a2();}var faststart=require(_0x5597bc(0xf8)),exifUtil=require(_0x5597bc(0xbf));let uploadUtil=require('../utils/uploadUtils');const PassThrough=require(_0x5597bc(0xe5))[_0x5597bc(0xb9)],{Readable}=require(_0x5597bc(0xe5));let sha256=require(_0x5597bc(0x100));const videoStreamUtil=require(_0x5597bc(0x148));let fileUtil=require(_0x5597bc(0xee));const folderSignString=_0x5597bc(0x152),folderSignFileName=_0x5597bc(0x175),configFolderName=_0x5597bc(0x135),noCheckFileList=['.DS_Store'];let FFmpeg=require(_0x5597bc(0x10f))[_0x5597bc(0x134)];function _0x9ab7(_0x54413c,_0x33f270){const _0x42a2a5=_0x42a2();return _0x9ab7=function(_0x9ab7f,_0xbf625c){_0x9ab7f=_0x9ab7f-0xa7;let _0x1c602d=_0x42a2a5[_0x9ab7f];return _0x1c602d;},_0x9ab7(_0x54413c,_0x33f270);}const uploadPrivateUtil=require(_0x5597bc(0xae)),privateSharpUtil=require('../utils/privateSpaceUtils'),sharpUtil=require(_0x5597bc(0xb4)),transCodeUtil=require(_0x5597bc(0x105));let dbArr=[];function checkSpaceId(_0x55238a,_0x30bf8c){const _0x4de409=_0x5597bc;let _0x3ff7b4=_0x55238a[_0x4de409(0xe3)][_0x4de409(0x155)]||_0x55238a[_0x4de409(0xcf)][_0x4de409(0x155)];if(!_0x3ff7b4)return _0x55238a['app'][_0x4de409(0xc3)](_0x30bf8c,_0x4de409(0xb2));let _0x542259=dbPrivateSpaceTable[_0x4de409(0x157)](_0x55238a[_0x4de409(0x138)]['dbOther'],_0x3ff7b4);if(!_0x542259)return _0x55238a['app'][_0x4de409(0xc3)](_0x30bf8c,_0x4de409(0x169));return!![];}function checkSpaceName(_0x470be,_0x2d98f9,_0x30a0d4){const _0xce0b4b=_0x5597bc;if(!_0x30a0d4)return _0x470be[_0xce0b4b(0x138)]['returnErrMsg'](_0x2d98f9,_0x2d98f9['__'](_0xce0b4b(0x10e)));if(_0x30a0d4['length']>0x1e)return _0x470be[_0xce0b4b(0x138)]['returnErrMsg'](_0x2d98f9,_0x2d98f9['__'](_0xce0b4b(0xf7)));return!![];}function getPrivateIndexDb(_0x383b13){const _0x4d92bd=_0x5597bc;let _0x2329e5=config[_0x4d92bd(0xd9)](_0x383b13);for(let _0x16c631 in dbArr){if(dbArr[_0x16c631][_0x4d92bd(0x10d)]==_0x2329e5)return dbArr[_0x16c631]['db'];}let _0x4d5c44=new Database(_0x2329e5,{});return _0x4d5c44[_0x4d92bd(0xca)](_0x4d92bd(0x173)),dbArr[_0x4d92bd(0xf9)]({'dbPath':_0x2329e5,'db':_0x4d5c44}),_0x4d5c44;}router[_0x5597bc(0x126)](_0x5597bc(0xd0),(_0x3638b4,_0x58b796,_0x19a4fa)=>{const _0xcdf196=_0x5597bc;let _0x26afeb=_0x3638b4[_0xcdf196(0xe3)]['folderPath'],_0x23ea78=_0x3638b4[_0xcdf196(0xe3)][_0xcdf196(0xda)],_0x336b33=_0x3638b4['currentUser'],_0x253c0f=_0x3638b4[_0xcdf196(0xe3)][_0xcdf196(0x11c)];if(checkSpaceName(_0x3638b4,_0x58b796,_0x23ea78)!==!![])return;if(!_0x253c0f||_0x253c0f[_0xcdf196(0x116)]<0x4)return _0x3638b4[_0xcdf196(0x138)][_0xcdf196(0xc3)](_0x58b796,_0x58b796['__']('private.spacePwdGtFour'));function _0x48ec0a(){return new Promise((_0x344bda,_0x58ce5e)=>{const _0x5b3b72=_0x9ab7;fs[_0x5b3b72(0xb6)](_0x26afeb,(_0x2c9a0b,_0x5d154b)=>{const _0x15c227=_0x5b3b72;if(_0x2c9a0b)return _0x58ce5e(_0x58b796['__'](_0x15c227(0xc7)));if(_0x5d154b['size']>0x400*0x400*0x400)return _0x3638b4[_0x15c227(0x138)][_0x15c227(0xc3)](_0x58b796,_0x58b796['__']('needEmptyFolderPrivateSpace'));fs[_0x15c227(0x177)](_0x26afeb,(_0x460e55,_0x55356d)=>{const _0x4c16f4=_0x15c227;for(let _0x300794 of _0x55356d){if(noCheckFileList[_0x4c16f4(0x159)](_0x300794)||_0x300794[_0x4c16f4(0x176)]('.')||_0x300794[_0x4c16f4(0x176)]('@'))continue;return _0x58ce5e(_0x58b796['__'](_0x4c16f4(0xc7)));}_0x344bda();});});});}fs['access'](_0x26afeb,fs[_0xcdf196(0x144)][_0xcdf196(0x15c)]|fs[_0xcdf196(0x144)][_0xcdf196(0x13b)],_0x6c1737=>{const _0x34ff65=_0xcdf196;if(_0x6c1737)return _0x3638b4[_0x34ff65(0x138)]['returnErrMsg'](_0x58b796,_0x58b796['__'](_0x34ff65(0x128)));_0x48ec0a()['then'](()=>{const _0xf0d40a=_0x34ff65;let _0x1ba72a=dbPrivateSpaceTable[_0xf0d40a(0x120)](_0x3638b4[_0xf0d40a(0x138)]['dbOther'],_0x23ea78);if(_0x1ba72a)return _0x3638b4[_0xf0d40a(0x138)][_0xf0d40a(0xc3)](_0x58b796,_0x58b796['__'](_0xf0d40a(0x106)));let _0x4b7bb2=path[_0xf0d40a(0x118)](_0x26afeb,configFolderName);fs[_0xf0d40a(0x170)](_0x4b7bb2,{'recursive':!![]},_0x3486cf=>{const _0x45d0dd=_0xf0d40a;if(_0x3486cf)return _0x3638b4[_0x45d0dd(0x138)][_0x45d0dd(0xc3)](_0x58b796,_0x58b796['__'](_0x45d0dd(0xf1))+JSON['stringify'](_0x3486cf));let _0x584e48=getPrivateIndexDb(_0x26afeb);dbPrivateSpaceTable[_0x45d0dd(0x132)](_0x584e48,_0x26afeb),cryptoUtils[_0x45d0dd(0x179)](_0x253c0f,folderSignString)['then'](_0x3d5984=>{const _0x5c528e=_0x45d0dd;let _0x1d4104=path[_0x5c528e(0x118)](_0x4b7bb2,folderSignFileName);fs[_0x5c528e(0xb1)](_0x1d4104,_0x3d5984,_0x5d40b4=>{const _0x18c6c5=_0x5c528e;if(_0x5d40b4)return _0x3638b4[_0x18c6c5(0x138)][_0x18c6c5(0xc3)](_0x58b796,_0x58b796['__'](_0x18c6c5(0xf1))+JSON['stringify'](_0x5d40b4));return dbPrivateSpaceTable[_0x18c6c5(0x167)](_0x3638b4[_0x18c6c5(0x138)][_0x18c6c5(0x122)],{'folder_path':_0x26afeb,'space_name':_0x23ea78,'create_uid':_0x336b33['id']}),_0x58b796[_0x18c6c5(0x15f)]({'code':0x0});});})[_0x45d0dd(0x14f)](_0x592cf2=>{const _0x13f347=_0x45d0dd;return console[_0x13f347(0x12b)](_0x13f347(0x111),_0x592cf2),_0x3638b4[_0x13f347(0x138)][_0x13f347(0xc3)](_0x58b796,_0x58b796['__']('operationFail')+JSON['stringify'](_0x592cf2));});});})[_0x34ff65(0x14f)](_0x544ef0=>{const _0x26b188=_0x34ff65;return _0x3638b4[_0x26b188(0x138)][_0x26b188(0xc3)](_0x58b796,_0x544ef0);});});}),router[_0x5597bc(0x126)](_0x5597bc(0x16d),(_0x586f95,_0x5cb441,_0x45cc1f)=>{const _0x3cd564=_0x5597bc;let _0x279e9a=[];return _0x586f95['currentUser']['is_admin']==0x1?_0x279e9a=dbPrivateSpaceTable[_0x3cd564(0xc9)](_0x586f95[_0x3cd564(0x138)][_0x3cd564(0x122)]):_0x279e9a=dbPrivateSpaceTable[_0x3cd564(0xa7)](_0x586f95['app']['dbOther'],_0x586f95[_0x3cd564(0xdb)]['id']),_0x5cb441['json']({'code':0x0,'data':_0x279e9a});});function checkSpacePwd(_0x46f013,_0x4c898a,_0x5a2359){return new Promise((_0x58b06c,_0x5abf79)=>{const _0x32e374=_0x9ab7;_0x4c898a=Buffer[_0x32e374(0x14d)](_0x4c898a,_0x32e374(0x12d))[_0x32e374(0x163)]();let _0x3fd5ce=path[_0x32e374(0x118)](_0x5a2359,configFolderName,folderSignFileName);fs[_0x32e374(0xb6)](_0x3fd5ce,(_0x2b5812,_0x2112e1)=>{const _0x2064b1=_0x32e374;if(_0x2b5812)return _0x5abf79(_0x46f013['__'](_0x2064b1(0xf3)));fs[_0x2064b1(0x10a)](_0x3fd5ce,'utf-8',(_0xa0ea8d,_0x22dea1)=>{const _0x3564d5=_0x2064b1;if(_0xa0ea8d)return _0x5abf79(_0x46f013['__'](_0x3564d5(0xf3)));else cryptoUtils[_0x3564d5(0x162)](_0x4c898a,_0x22dea1)[_0x3564d5(0x129)](_0x29c449=>{const _0x4e2a46=_0x3564d5;return _0x29c449==folderSignString?_0x58b06c(_0x4c898a):_0x5abf79(_0x46f013['__'](_0x4e2a46(0x13d)));})[_0x3564d5(0x14f)](_0x3a236f=>{const _0x2fccae=_0x3564d5;return console[_0x2fccae(0x12b)](_0x2fccae(0x111),_0x3a236f),_0x5abf79(_0x46f013['__'](_0x2fccae(0x13d)));});});});});}router[_0x5597bc(0x126)](_0x5597bc(0x14b),(_0x4e7a64,_0x149e33,_0x226c90)=>{const _0x13d18c=_0x5597bc;let _0xd06c1=_0x4e7a64[_0x13d18c(0xe3)][_0x13d18c(0xf2)],_0x5d06c4=_0x4e7a64[_0x13d18c(0xe3)][_0x13d18c(0x155)],_0x36dc71=dbPrivateSpaceTable['getById'](_0x4e7a64[_0x13d18c(0x138)][_0x13d18c(0x122)],_0x5d06c4);if(!_0x36dc71)return _0x4e7a64[_0x13d18c(0x138)]['returnErrMsg'](_0x149e33,'error\x20space\x20id');fs[_0x13d18c(0xb6)](_0x36dc71[_0x13d18c(0xbb)],(_0x31acca,_0x560a8a)=>{const _0x12eedd=_0x13d18c;if(_0x31acca)return _0x4e7a64[_0x12eedd(0x138)][_0x12eedd(0xc3)](_0x149e33,_0x149e33['__'](_0x12eedd(0xd5)));checkSpacePwd(_0x149e33,_0xd06c1,_0x36dc71[_0x12eedd(0xbb)])[_0x12eedd(0x129)](_0x5e017b=>{const _0x58d970=_0x12eedd;let _0x2eac0f=sha256(new Date()['getTime']()+_0x5d06c4+_0x5e017b);cryptoUtils[_0x58d970(0x179)](config[_0x58d970(0x13f)],_0x5e017b)[_0x58d970(0x129)](_0x3b9a4c=>{const _0x4ea751=_0x58d970;return dbPrivateSpaceTable[_0x4ea751(0x102)](_0x4e7a64['app'][_0x4ea751(0x122)],{'space_id':_0x5d06c4,'pwd':_0x3b9a4c,'token':_0x2eac0f}),_0x149e33[_0x4ea751(0x15f)]({'code':0x0,'token':_0x2eac0f});});})['catch'](_0x3e1c92=>{const _0x3ef5eb=_0x12eedd;return console[_0x3ef5eb(0x12b)](_0x3ef5eb(0x111),_0x3e1c92),_0x4e7a64['app'][_0x3ef5eb(0xc3)](_0x149e33,_0x3e1c92);});});});function ffprobeSync(_0x1893fd){return new Promise((_0xb4bb03,_0x24d703)=>{const _0x30934d=_0x9ab7;try{FFmpeg(transCodeUtil[_0x30934d(0x15e)](_0x1893fd))['ffprobe']((_0x17505d,_0x1cfe73)=>{_0x17505d?_0x24d703(_0x17505d):_0xb4bb03(_0x1cfe73);});}catch(_0x2aff56){console[_0x30934d(0x12b)](_0x30934d(0x111),_0x2aff56),_0x24d703(_0x2aff56);}});}function deleteFile(_0x10c088){fs['rm'](_0x10c088,{'maxRetries':0xa,'retryDelay':0x3e8},_0x32c395=>{});}function uploadFail(_0x22d3a0,_0x53ec75,_0x18151f,_0x8e586d){const _0x5d4ee9=_0x5597bc;return deleteFile(_0x53ec75),_0x18151f[_0x5d4ee9(0x138)]['returnErrMsg'](_0x8e586d,_0x8e586d['__'](_0x5d4ee9(0x12f)));}function dealUploadImageOrFile(_0x4e8eec,_0x15f2d6,_0x7b14f3,_0x478a3a,_0x1b1d7e,_0x2e1453,_0x5f82a4,_0x3458cc,_0x5425d2){const _0x1cc36a=_0x5597bc;uploadPrivateUtil[_0x1cc36a(0x151)](_0x7b14f3,_0x478a3a,_0x1b1d7e,_0x2e1453,_0x3e498a=>{const _0x2ebbbe=_0x1cc36a;let _0x20522e=_0x3e498a[_0x2ebbbe(0x131)],_0x225ab6=cryptoUtils[_0x2ebbbe(0x108)](_0x2e1453,_0x20522e),_0x5182ce=dbPrivateSpaceTable[_0x2ebbbe(0x172)](_0x4e8eec,{'filename':new Buffer[(_0x2ebbbe(0x14d))](_0x3458cc)[_0x2ebbbe(0x163)]('base64'),'filename_enc':_0x1b1d7e,'file_type':_0x5f82a4,'ext':_0x5425d2});if(_0x5182ce[_0x2ebbbe(0xfb)]<0x1)return uploadFail(_0x4e8eec,_0x20522e,_0x7b14f3,_0x478a3a);let _0x57bbe6=_0x5182ce[_0x2ebbbe(0xcc)];_0x478a3a['json']({'code':0x0});let _0x21b94b=new Date()[_0x2ebbbe(0xbe)]();if(_0x5f82a4==_0x2ebbbe(0xc1)){var _0x456d8d=[];let _0x18551f=new PassThrough()[_0x2ebbbe(0x16f)](_0x225ab6);_0x18551f['on'](_0x2ebbbe(0x150),function(_0x1c7aa3){const _0x22533d=_0x2ebbbe;_0x456d8d[_0x22533d(0xf9)](_0x1c7aa3);}),_0x18551f['on'](_0x2ebbbe(0x136),function(){const _0x3d7e87=_0x2ebbbe;var _0x310409=Buffer[_0x3d7e87(0x104)](_0x456d8d);function _0x30d592(){const _0x5a3224=_0x3d7e87;exifUtil[_0x5a3224(0x12c)](_0x310409)['then'](_0x5d9c7a=>{const _0x153b90=_0x5a3224;if(_0x5d9c7a){let _0x21362f=_0x5d9c7a[_0x153b90(0xb8)];_0x5d9c7a['CreateDate']&&!_0x21362f&&(_0x21362f=_0x5d9c7a[_0x153b90(0xc5)]),_0x21362f&&(_0x21b94b=new Date(_0x21362f)[_0x153b90(0xbe)](),_0x4e8eec[_0x153b90(0xcd)]('UPDATE\x20private_space_index\x20SET\x20original_time=\x27'+_0x21b94b+_0x153b90(0xf0)+_0x57bbe6)[_0x153b90(0xd2)]());}})[_0x5a3224(0x14f)](_0x592205=>{});}privateSpaceUtils[_0x3d7e87(0x143)](_0x5425d2,_0x310409,_0xbe8640=>{const _0x1cdf4a=_0x3d7e87,_0x4f7ad3=Readable['from'](_0xbe8640);let _0x113b1d=path['join'](_0x15f2d6,_0x1b1d7e);cryptoUtils[_0x1cdf4a(0xde)](_0x2e1453,_0x4f7ad3,_0x113b1d)[_0x1cdf4a(0x129)](_0x2fddfe=>{const _0x56322c=_0x1cdf4a;let _0x2be37a=path[_0x56322c(0x118)](configFolderName,_0x56322c(0xb5),_0x1b1d7e);_0x4e8eec['prepare'](_0x56322c(0x11f)+_0x2be37a+'\x27\x20where\x20id='+_0x57bbe6)['run'](),_0x30d592();});},_0x544ced=>{_0x30d592();});});}});}function dealUploadVideo(_0x59e8a1,_0x1efb1c,_0x30e8f3,_0x326bcc,_0x19df6c,_0x5b07bf,_0x5bc5f6,_0x50d425,_0x522b58,_0x5dc6e1,_0x5d77dd){const _0x49236d=_0x5597bc;_0x19df6c[_0x49236d(0xcf)]['savePath']=_0x326bcc,_0x19df6c[_0x49236d(0xcf)][_0x49236d(0xdc)]=_0x49236d(0x107),uploadUtil['uploadFile'](_0x19df6c,_0x5b07bf,![],!![],![],_0x395f37=>{const _0x3abc13=_0x49236d;let _0x5c8212=_0x395f37[_0x3abc13(0x131)],_0x59dbd5=path[_0x3abc13(0x118)](_0x395f37['destination']);function _0x2ac5cb(_0x16a270){const _0x23a551=_0x3abc13;ffprobeSync(_0x5c8212)[_0x23a551(0x129)](_0x57a9d5=>{const _0x2f219b=_0x23a551;let _0x51397c=0x0;_0x51397c=videoStreamUtil['getDurationFromStream'](_0x57a9d5);let _0x762b4b=JSON[_0x2f219b(0xb0)](_0x57a9d5[_0x2f219b(0xd3)]),_0x5eaf7b=videoStreamUtil[_0x2f219b(0xa9)](_0x57a9d5);fs[_0x2f219b(0xb6)](_0x5c8212,(_0x530cc4,_0x5d35dd)=>{const _0x448c66=_0x2f219b;if(_0x530cc4){deleteFile(_0x5c8212);return;}let _0xc8075d=_0x448c66(0x16a);_0x59e8a1['prepare'](_0xc8075d)[_0x448c66(0xd2)](_0x5eaf7b,parseInt(_0x51397c),_0x5d35dd['size'],_0x762b4b,_0x16a270);let _0x4c400f=_0x448c66(0xab)+Buffer[_0x448c66(0x14d)](_0x5dc6e1)['toString'](_0x448c66(0x12d));privateSpaceUtils[_0x448c66(0xeb)](_0x5c8212,_0x59dbd5,_0x4c400f,_0x614cf4=>{fs['stat'](_0x614cf4,(_0x44b00d,_0x3a7480)=>{const _0x53bd94=_0x9ab7;if(_0x44b00d){deleteFile(_0x5c8212);return;}let _0x2041b2=path[_0x53bd94(0x118)](_0x30e8f3,_0x5bc5f6);cryptoUtils[_0x53bd94(0x119)](_0x50d425,_0x614cf4,_0x2041b2)[_0x53bd94(0x129)](_0x387146=>{const _0xba8c65=_0x53bd94;let _0x25c459=path[_0xba8c65(0x118)](configFolderName,_0xba8c65(0xb5),_0x5bc5f6);_0x59e8a1[_0xba8c65(0xcd)](_0xba8c65(0x11f)+_0x25c459+'\x27\x20where\x20id='+_0x16a270)['run'](),deleteFile(_0x614cf4),deleteFile(_0x5c8212);});});},_0x49f710=>{deleteFile(_0x5c8212);});});})[_0x23a551(0x14f)](_0x2bd91d=>{deleteFile(_0x5c8212);});}function _0x1c4b6d(){const _0x41cc00=_0x3abc13;let _0x2875d2=dbPrivateSpaceTable[_0x41cc00(0x172)](_0x59e8a1,{'filename':new Buffer[(_0x41cc00(0x14d))](_0x5dc6e1)[_0x41cc00(0x163)]('base64'),'filename_enc':_0x5bc5f6,'file_type':_0x522b58,'ext':_0x5d77dd});return _0x2875d2[_0x41cc00(0xfb)]<0x1?uploadFail(_0x59e8a1,_0x5c8212,_0x19df6c,_0x5b07bf):(_0x2ac5cb(_0x2875d2[_0x41cc00(0xcc)]),_0x5b07bf['json']({'code':0x0}));}function _0xb7270c(_0x590d09,_0xf2fdc5,_0x7c011b){const _0xaddefb=_0x3abc13;cryptoUtils[_0xaddefb(0x119)](_0x50d425,_0x590d09,_0xf2fdc5)[_0xaddefb(0x129)](_0xf905de=>{_0x7c011b(_0xf905de);})[_0xaddefb(0x14f)](_0x21636e=>{console['log'](_0x21636e),uploadFail(_0x59e8a1,_0x590d09,_0x19df6c,_0x5b07bf);});}let _0x4390d9=path['join'](_0x1efb1c[_0x3abc13(0xbb)],_0x5bc5f6);if(_0x5d77dd==_0x3abc13(0xbc)||_0x5d77dd=='.mov'){var _0x2cabac=faststart[_0x3abc13(0xc8)](_0x5c8212,{'errorCallBack':_0x417569=>{_0xb7270c(_0x5c8212,_0x4390d9,_0x1c4b6d);}});_0x2cabac['on']('close',function(){const _0x3ac85a=_0x3abc13;_0x2cabac[_0x3ac85a(0xc4)]();}),cryptoUtils['encryptFileFromInputPipe'](_0x50d425,_0x2cabac,_0x4390d9)[_0x3abc13(0x129)](_0x5e8cab=>{_0x1c4b6d();})[_0x3abc13(0x14f)](_0x251d09=>{const _0x318b63=_0x3abc13;console['log'](_0x318b63(0x111),_0x251d09),uploadFail(_0x59e8a1,_0x5c8212,_0x19df6c,_0x5b07bf);});}else _0xb7270c(_0x5c8212,_0x4390d9,_0x1c4b6d);});}router['post']('/regularUpload',function(_0x5afa10,_0x46f126,_0x190ff8){const _0x1c401d=_0x5597bc;let _0x407f15=_0x5afa10['query']['spaceId']||_0x5afa10['body']['spaceId']||_0x5afa10[_0x1c401d(0xea)][_0x1c401d(0x158)],_0xfeaa04=_0x5afa10[_0x1c401d(0xcf)]['filename']||_0x5afa10[_0x1c401d(0xea)][_0x1c401d(0x101)],_0x238085=decodeURIComponent(_0xfeaa04);_0x5afa10['query'][_0x1c401d(0xe2)]&&(_0x238085=fileUtil['decodePath'](_0x5afa10[_0x1c401d(0xcf)][_0x1c401d(0xe2)])),getPwdFromToken(_0x5afa10,_0x46f126,_0x52afd3=>{const _0x1ee4ec=_0x1c401d;let _0x1d599a=dbPrivateSpaceTable[_0x1ee4ec(0x157)](_0x5afa10[_0x1ee4ec(0x138)][_0x1ee4ec(0x122)],_0x407f15);if(!_0x1d599a)return _0x5afa10[_0x1ee4ec(0x138)]['returnErrMsg'](_0x46f126,_0x46f126['__']('private.noExist'));_0x5afa10[_0x1ee4ec(0xcf)]['savePath']=_0x1d599a[_0x1ee4ec(0xbb)];let _0x41227e=getPrivateIndexDb(_0x1d599a[_0x1ee4ec(0xbb)]),_0x2a61ca=dbPrivateSpaceTable[_0x1ee4ec(0x124)](_0x41227e,new Buffer['from'](_0x238085)[_0x1ee4ec(0x163)](_0x1ee4ec(0x12d)));if(_0x2a61ca)return _0x5afa10[_0x1ee4ec(0x138)][_0x1ee4ec(0xc3)](_0x46f126,_0x46f126['__']('private.alreadyHasSameNameFile'));let _0x572c8c=path[_0x1ee4ec(0x154)](_0x238085)?path['extname'](_0x238085)[_0x1ee4ec(0x146)]():null,_0x172290=_0x1ee4ec(0x12a);if(_0x572c8c){if(config['imgTypeList'][_0x1ee4ec(0x159)](_0x572c8c[_0x1ee4ec(0x146)]())||config[_0x1ee4ec(0x16e)][_0x1ee4ec(0x159)](_0x572c8c['toLowerCase']()))_0x172290=_0x1ee4ec(0xc1);else config[_0x1ee4ec(0xe9)]['includes'](_0x572c8c['toLowerCase']())&&(_0x172290=_0x1ee4ec(0x125));}let _0x284fa4=path['join'](_0x1d599a[_0x1ee4ec(0xbb)],configFolderName,_0x1ee4ec(0xb5)),_0x53b041=path[_0x1ee4ec(0x118)](_0x1d599a['folder_path'],configFolderName,_0x1ee4ec(0x15b));function _0x300cf0(){const _0x391425=_0x1ee4ec;cryptoUtils['encryptString'](_0x52afd3,_0x238085)[_0x391425(0x129)](_0x2477ca=>{const _0x49ae1a=_0x391425;if(_0x2477ca[_0x49ae1a(0x116)]>0xf0)return _0x5afa10[_0x49ae1a(0x138)][_0x49ae1a(0xc3)](_0x46f126,_0x46f126['__'](_0x49ae1a(0x165)));_0x172290==_0x49ae1a(0x125)?dealUploadVideo(_0x41227e,_0x1d599a,_0x284fa4,_0x53b041,_0x5afa10,_0x46f126,_0x2477ca,_0x52afd3,_0x172290,_0x238085,_0x572c8c):dealUploadImageOrFile(_0x41227e,_0x284fa4,_0x5afa10,_0x46f126,_0x2477ca,_0x52afd3,_0x172290,_0x238085,_0x572c8c);});}fs[_0x1ee4ec(0xb6)](_0x284fa4,(_0x5a71c4,_0x4b1c05)=>{const _0x261d19=_0x1ee4ec;function _0xa05403(){fs['stat'](_0x53b041,(_0x2bf8a9,_0x185106)=>{const _0x47a640=_0x9ab7;_0x2bf8a9?fs[_0x47a640(0x170)](_0x53b041,{'recursive':!![]},_0x41a47b=>{_0x300cf0();}):_0x300cf0();});}_0x5a71c4?fs[_0x261d19(0x170)](_0x284fa4,{'recursive':!![]},_0x440968=>{_0xa05403();}):_0xa05403();});});}),router['post'](_0x5597bc(0x140),(_0x1cea77,_0x4655ee,_0x47bc35)=>{const _0x2426a0=_0x5597bc;let _0x5d1fd5=_0x1cea77['body']['folderPath'],_0x22de07=_0x1cea77['body'][_0x2426a0(0xda)],_0x29040f=_0x1cea77[_0x2426a0(0xdb)],_0x4d2c35=_0x1cea77[_0x2426a0(0xe3)]['spacePwd'];if(!_0x22de07)return _0x1cea77[_0x2426a0(0x138)][_0x2426a0(0xc3)](_0x4655ee,_0x4655ee['__']('private.spaceNameCantNull'));let _0x4a6126=dbPrivateSpaceTable[_0x2426a0(0x120)](_0x1cea77[_0x2426a0(0x138)][_0x2426a0(0x122)],_0x22de07);if(_0x4a6126)return _0x1cea77[_0x2426a0(0x138)]['returnErrMsg'](_0x4655ee,_0x4655ee['__'](_0x2426a0(0x106)));if(!_0x4d2c35)return _0x1cea77[_0x2426a0(0x138)]['returnErrMsg'](_0x4655ee,_0x4655ee['__']('private.spacePwdGtFour'));fs[_0x2426a0(0x112)](_0x5d1fd5,_0x126695=>{const _0xda41e0=_0x2426a0;if(_0x126695)return _0x1cea77['app'][_0xda41e0(0xc3)](_0x4655ee,_0x4655ee['__'](_0xda41e0(0x128)));checkSpacePwd(_0x4655ee,_0x4d2c35,_0x5d1fd5)['then'](()=>{const _0x4aa1b2=_0xda41e0;let _0x2ae71c=config[_0x4aa1b2(0xd9)](_0x5d1fd5);fs[_0x4aa1b2(0xb6)](_0x2ae71c,(_0x29b383,_0x3705e7)=>{const _0x2dd84d=_0x4aa1b2;if(_0x29b383)return _0x1cea77[_0x2dd84d(0x138)]['returnErrMsg'](_0x4655ee,_0x4655ee['__']('private.spaceConfigFileBroken'));return dbPrivateSpaceTable[_0x2dd84d(0x167)](_0x1cea77[_0x2dd84d(0x138)][_0x2dd84d(0x122)],{'folder_path':_0x5d1fd5,'space_name':_0x22de07,'create_uid':_0x29040f['id']}),_0x4655ee['json']({'code':0x0});});})[_0xda41e0(0x14f)](_0x410dd5=>{const _0x49dc3b=_0xda41e0;return _0x1cea77['app'][_0x49dc3b(0xc3)](_0x4655ee,_0x410dd5);});});}),router[_0x5597bc(0x126)](_0x5597bc(0x149),(_0x23aafa,_0x1d9f6e,_0x4c53d2)=>{const _0x28c345=_0x5597bc;let _0x1801c1=_0x23aafa[_0x28c345(0xe3)]['folderPath'],_0x4ee80a=_0x23aafa[_0x28c345(0xe3)][_0x28c345(0x11c)],_0x3ed001=_0x23aafa[_0x28c345(0xe3)][_0x28c345(0xad)];if(!_0x4ee80a)return _0x23aafa['app'][_0x28c345(0xc3)](_0x1d9f6e,_0x1d9f6e['__'](_0x28c345(0x142)));fs['access'](_0x1801c1,fs['constants'][_0x28c345(0x15c)],_0x47093d=>{const _0x3d85b8=_0x28c345;if(_0x47093d)return _0x23aafa['app'][_0x3d85b8(0xc3)](_0x1d9f6e,_0x1d9f6e['__'](_0x3d85b8(0x128)));fs[_0x3d85b8(0x112)](_0x3ed001,fs[_0x3d85b8(0x144)][_0x3d85b8(0x13b)],_0x593010=>{const _0x1cd29a=_0x3d85b8;if(_0x593010)return _0x23aafa[_0x1cd29a(0x138)][_0x1cd29a(0xc3)](_0x1d9f6e,_0x1d9f6e['__'](_0x1cd29a(0x128)));function _0x2581e4(_0x22a79f){const _0x869fbc=_0x1cd29a;cryptoUtils[_0x869fbc(0x179)](config[_0x869fbc(0xd7)],_0x4ee80a)[_0x869fbc(0x129)](_0x7c2b99=>{const _0x520267=_0x869fbc;return _0x22a79f['app']['dbOther']['prepare']('INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)')['run'](_0x520267(0x130),JSON[_0x520267(0xb0)]({'folderPath':_0x1801c1,'targetFolderPath':_0x3ed001,'spacePwd':_0x7c2b99})),process['send']({'type':_0x520267(0x15a)}),_0x1d9f6e[_0x520267(0x15f)]({'code':0x0});});}let _0x3f69a1=path['join'](_0x1801c1,configFolderName,folderSignFileName);fs['stat'](_0x3f69a1,(_0x5d14e3,_0x14e581)=>{const _0xbb28f0=_0x1cd29a;_0x5d14e3?_0x2581e4(_0x23aafa):checkSpacePwd(_0x1d9f6e,_0x4ee80a,_0x1801c1)['then'](()=>{_0x2581e4(_0x23aafa);})[_0xbb28f0(0x14f)](_0x45eee7=>{const _0xe2c7de=_0xbb28f0;return console['log'](_0x45eee7),_0x23aafa[_0xe2c7de(0x138)][_0xe2c7de(0xc3)](_0x1d9f6e,_0x1d9f6e['__'](_0xe2c7de(0x13d)));});});});});}),router[_0x5597bc(0x126)]('/deleteSpaceFiles',(_0x4350fd,_0x529552,_0x511e72)=>{const _0x135c65=_0x5597bc;let _0x33d511=_0x4350fd['body'][_0x135c65(0x155)],_0xed5160=_0x4350fd[_0x135c65(0xe3)][_0x135c65(0xf6)];if(!_0xed5160||_0xed5160[_0x135c65(0x116)]<0x1)return _0x529552['status'](0x194)['end']();let _0x4635e5=dbPrivateSpaceTable[_0x135c65(0x157)](_0x4350fd['app'][_0x135c65(0x122)],_0x33d511);if(!_0x4635e5)return _0x529552[_0x135c65(0x137)](0x194)[_0x135c65(0x136)]();if(_0x4350fd[_0x135c65(0xdb)][_0x135c65(0x166)]!=0x1){if(_0x4635e5[_0x135c65(0xbd)]!=_0x4350fd[_0x135c65(0xdb)]['id'])return _0x529552[_0x135c65(0x15f)]({'code':0x1,'message':_0x529552['__'](_0x135c65(0x13c))});}try{let _0x5d3028=getPrivateIndexDb(_0x4635e5['folder_path']),_0x53c154=JSON[_0x135c65(0x12c)](_0xed5160),_0x1b24ed=0x0,_0x1e8892=[],_0x2f58d8=0x0,_0x48cc11=0x0;if(_0x53c154[_0x135c65(0x116)]<0x1)return _0x529552[_0x135c65(0x15f)]({'code':0x0,'deleteList':_0x1e8892,'deleteCount':_0x1b24ed,'errCount':_0x2f58d8});for(let _0x1d7c84=0x0;_0x1d7c84<_0x53c154['length'];_0x1d7c84++){let _0x4d26f3=dbPrivateSpaceTable[_0x135c65(0x11a)](_0x5d3028,'\x20id='+_0x53c154[_0x1d7c84]);if(!_0x4d26f3)return _0x4350fd[_0x135c65(0x138)][_0x135c65(0xc3)](_0x529552,_0x529552['__'](_0x135c65(0xaa)));let _0x283f7c=path[_0x135c65(0x118)](_0x4635e5['folder_path'],_0x4d26f3[_0x135c65(0x113)]);if(_0x4d26f3[_0x135c65(0xdf)]&&_0x4d26f3[_0x135c65(0xdf)]!=_0x135c65(0x121)){let _0x403ab6=path[_0x135c65(0x118)](_0x4635e5[_0x135c65(0xbb)],_0x4d26f3[_0x135c65(0xdf)]);try{fs[_0x135c65(0xce)](_0x403ab6,_0x2b456=>{});}catch(_0x3fa255){}}fs[_0x135c65(0xce)](_0x283f7c,_0x3a8a09=>{const _0x360c6a=_0x135c65;_0x48cc11+=0x1;_0x3a8a09?(console[_0x360c6a(0x12b)](_0x360c6a(0x13a),_0x3a8a09[_0x360c6a(0xef)]),_0x2f58d8+=0x1):(_0x1b24ed+=0x1,_0x1e8892[_0x360c6a(0xf9)](_0x53c154[_0x1d7c84]));dbPrivateSpaceTable['deleteIndex'](_0x5d3028,_0x53c154[_0x1d7c84]);if(_0x48cc11==_0x53c154['length'])return _0x529552[_0x360c6a(0x15f)]({'code':0x0,'deleteList':_0x1e8892,'deleteCount':_0x1b24ed,'errCount':_0x2f58d8});});}}catch(_0x11649d){return console[_0x135c65(0x12b)](_0x135c65(0x111),_0x11649d),_0x529552[_0x135c65(0x15f)]({'code':0x1,'message':JSON['stringify'](_0x11649d)});}}),router['post'](_0x5597bc(0xaf),(_0x486834,_0x40772d,_0x2d2628)=>{const _0x354627=_0x5597bc;if(checkSpaceId(_0x486834,_0x40772d)!==!![])return;let _0x29e4c7=_0x486834[_0x354627(0xe3)]['spaceId'],_0x5c05ca=dbPrivateSpaceTable[_0x354627(0x157)](_0x486834[_0x354627(0x138)]['dbOther'],_0x29e4c7);if(_0x486834[_0x354627(0xdb)][_0x354627(0x166)]!=0x1){if(_0x5c05ca['create_uid']!=_0x486834[_0x354627(0xdb)]['id'])return _0x40772d[_0x354627(0x15f)]({'code':0x1,'message':_0x40772d['__'](_0x354627(0x13c))});}return dbPrivateSpaceTable['delete'](_0x486834[_0x354627(0x138)][_0x354627(0x122)],_0x29e4c7),_0x40772d[_0x354627(0x15f)]({'code':0x0});}),router[_0x5597bc(0x126)]('/updateSpaceName',(_0x3e0adc,_0x4344eb,_0x4c05f3)=>{const _0x38cf94=_0x5597bc;let _0x363bec=_0x3e0adc['body'][_0x38cf94(0xda)],_0x332213=_0x3e0adc[_0x38cf94(0xe3)][_0x38cf94(0x155)];if(checkSpaceId(_0x3e0adc,_0x4344eb)!==!![])return;if(checkSpaceName(_0x3e0adc,_0x4344eb,_0x363bec)!==!![])return;let _0x2cc247=dbPrivateSpaceTable[_0x38cf94(0x157)](_0x3e0adc[_0x38cf94(0x138)][_0x38cf94(0x122)],_0x332213);if(_0x3e0adc['currentUser'][_0x38cf94(0x166)]!=0x1){if(_0x2cc247[_0x38cf94(0xbd)]!=_0x3e0adc['currentUser']['id'])return _0x4344eb[_0x38cf94(0x15f)]({'code':0x1,'message':_0x4344eb['__']('private.onlyAdminCanDelete')});}return dbPrivateSpaceTable[_0x38cf94(0xcb)](_0x3e0adc[_0x38cf94(0x138)][_0x38cf94(0x122)],_0x363bec,_0x332213),_0x4344eb['json']({'code':0x0});}),router[_0x5597bc(0x126)](_0x5597bc(0x10c),(_0x3fb877,_0x1f755a,_0x41e977)=>{const _0x28b3b6=_0x5597bc;let _0x590ea8=_0x3fb877[_0x28b3b6(0xe3)][_0x28b3b6(0x155)];if(!_0x590ea8)return _0x3fb877[_0x28b3b6(0x138)][_0x28b3b6(0xc3)](_0x1f755a,_0x28b3b6(0xb2));let _0x2bf2c2=dbPrivateSpaceTable[_0x28b3b6(0x157)](_0x3fb877[_0x28b3b6(0x138)][_0x28b3b6(0x122)],_0x590ea8);if(!_0x2bf2c2)return _0x3fb877[_0x28b3b6(0x138)][_0x28b3b6(0xc3)](_0x1f755a,_0x28b3b6(0x169));let _0x2d15d9=config[_0x28b3b6(0xd9)](_0x2bf2c2[_0x28b3b6(0xbb)]);fs[_0x28b3b6(0xb6)](_0x2d15d9,(_0x385667,_0x2ce7a9)=>{const _0x194d90=_0x28b3b6;if(_0x385667)return _0x3fb877[_0x194d90(0x138)][_0x194d90(0xc3)](_0x1f755a,_0x1f755a['__'](_0x194d90(0xdd)));let _0x2a546f=_0x3fb877[_0x194d90(0xe3)][_0x194d90(0x14e)]||0x64,_0x59f969=_0x3fb877[_0x194d90(0xe3)][_0x194d90(0xfd)]||0x0,_0xbc389b=_0x3fb877[_0x194d90(0xe3)][_0x194d90(0x161)]||'id',_0x165ba4=_0x3fb877[_0x194d90(0xe3)][_0x194d90(0x109)]||_0x194d90(0xba),_0x562734=_0x3fb877[_0x194d90(0xe3)][_0x194d90(0x16c)],_0x36dcff=getPrivateIndexDb(_0x2bf2c2['folder_path']),_0x44347b='';_0x562734&&_0x562734!=_0x194d90(0xc2)&&(_0x44347b+='\x20WHERE\x20file_type=\x27'+_0x562734+'\x27');_0x44347b+=_0x194d90(0xd6)+_0xbc389b+'\x20'+_0x165ba4+_0x194d90(0xfa)+_0x2a546f+_0x194d90(0x123)+_0x59f969;let _0x20b2a6=dbPrivateSpaceTable[_0x194d90(0x178)](_0x36dcff,_0x44347b);return _0x1f755a[_0x194d90(0x15f)]({'code':0x0,'data':_0x20b2a6});});});function getPwdFromToken(_0x571440,_0x4cfdb2,_0x3680e2){const _0x42e74b=_0x5597bc;let _0x3f80bf=_0x571440['query']['spaceToken']||_0x571440[_0x42e74b(0xe3)]['spaceToken']||_0x571440[_0x42e74b(0xea)][_0x42e74b(0x14c)],_0x4dc5de=dbPrivateSpaceTable[_0x42e74b(0xa8)](_0x571440[_0x42e74b(0x138)][_0x42e74b(0x122)],_0x3f80bf);if(!_0x4dc5de)return _0x4cfdb2['json']({'code':0x68});let _0x5f334f=_0x4dc5de[_0x42e74b(0x160)];cryptoUtils['decryptString'](config[_0x42e74b(0x13f)],_0x5f334f)['then'](_0x36797a=>{_0x3680e2(_0x36797a);})[_0x42e74b(0x14f)](_0x3f5076=>{const _0x3e6843=_0x42e74b;console[_0x3e6843(0x12b)](_0x3f5076);});}router[_0x5597bc(0x12e)]('/getDecodeFile*',(_0x2caf9d,_0x2d832e,_0x52ed59)=>{const _0xa24d5a=_0x5597bc;try{let _0x5959fc=_0x2caf9d[_0xa24d5a(0xcf)][_0xa24d5a(0x155)],_0x455dd2=_0x2caf9d[_0xa24d5a(0xcf)][_0xa24d5a(0xd1)],_0x9b65d8=_0x2caf9d['query']['download'],_0x23aa96=_0x2caf9d[_0xa24d5a(0xcf)][_0xa24d5a(0x15d)];if(!_0x5959fc||!_0x455dd2)return _0x2caf9d[_0xa24d5a(0x138)]['returnErrMsg'](_0x2d832e,_0xa24d5a(0xb3));let _0x3c08bc=dbPrivateSpaceTable[_0xa24d5a(0x157)](_0x2caf9d[_0xa24d5a(0x138)][_0xa24d5a(0x122)],_0x5959fc);if(!_0x3c08bc)return _0x2caf9d[_0xa24d5a(0x138)][_0xa24d5a(0xc3)](_0x2d832e,_0xa24d5a(0x169));getPwdFromToken(_0x2caf9d,_0x2d832e,_0x17333a=>{const _0x179728=_0xa24d5a;let _0x4d5710=getPrivateIndexDb(_0x3c08bc[_0x179728(0xbb)]),_0x38e5d9=dbPrivateSpaceTable[_0x179728(0x117)](_0x4d5710,_0x455dd2);if(!_0x38e5d9)return _0x2d832e[_0x179728(0x137)](0x194)[_0x179728(0x136)]();let _0x510761='';function _0x422f39(_0x5c7f0e){const _0x106188=_0x179728;return path['normalize'](_0x5c7f0e[_0x106188(0x153)](/[\\/]/g,path['sep']));}_0x23aa96=='tiny'?_0x510761=path[_0x179728(0x114)](path['normalize'](path[_0x179728(0x118)](_0x3c08bc['folder_path'],_0x422f39(_0x38e5d9[_0x179728(0xdf)])))):_0x510761=path[_0x179728(0x114)](path[_0x179728(0xe7)](path[_0x179728(0x118)](_0x3c08bc[_0x179728(0xbb)],_0x422f39(_0x38e5d9['filename_enc']))));if(_0x9b65d8==0x1)try{let _0x572bb7=Buffer[_0x179728(0x14d)](_0x38e5d9[_0x179728(0x101)],_0x179728(0x12d))['toString']();const _0x245b08=encodeURIComponent(_0x572bb7)[_0x179728(0x153)](/%([0-9A-F]{2})/g,(_0x3da100,_0x57055e)=>'%'+_0x57055e[_0x179728(0x147)]());_0x2d832e[_0x179728(0x141)](_0x179728(0x168),_0x179728(0x174)+_0x245b08);}catch(_0x11e393){console[_0x179728(0x12b)](_0x11e393);}fs['stat'](_0x510761,(_0x2db993,_0x3e304d)=>{const _0x31f2fc=_0x179728;if(_0x2db993)return console[_0x31f2fc(0x12b)](_0x31f2fc(0xd4),_0x510761),_0x2d832e['status'](0x194)[_0x31f2fc(0x136)]();if(_0x510761[_0x31f2fc(0xb7)](_0x31f2fc(0xb5))==-0x1){let _0x42c491=dbPrivateSpaceTable[_0x31f2fc(0x171)](_0x4d5710,_0x31f2fc(0x139),new Date()[_0x31f2fc(0xbe)](),_0x455dd2);}if(sharpUtil['ifExtIsSpecialFormat'](_0x38e5d9['ext'])&&_0x23aa96!='tiny'){let _0x337aa9=cryptoUtils['decryptFileGetStream'](_0x17333a,_0x510761);fileUtil['streamToBuffer'](_0x337aa9)[_0x31f2fc(0x129)](_0x11727d=>{const _0x4305ba=_0x31f2fc;sharpUtil[_0x4305ba(0x14a)](_0x38e5d9[_0x4305ba(0x156)],_0x11727d,(_0x546562,_0x3b5403,_0x45c73e)=>{const _0x26b801=_0x4305ba;sharpUtil[_0x26b801(0x13e)](_0x38e5d9[_0x26b801(0x156)][_0x26b801(0x146)]())?sharpUtil[_0x26b801(0x133)](_0x546562,null,![],null,_0x26b801(0x115),null,_0x5d7b63=>{const _0x33166e=_0x26b801;_0x2d832e[_0x33166e(0x127)](Buffer[_0x33166e(0x14d)](_0x5d7b63));},_0x466d50=>{const _0x5edb58=_0x26b801;return console[_0x5edb58(0x12b)](_0x466d50),_0x2d832e['status'](0x194)[_0x5edb58(0x136)]();},_0x3b5403,_0x45c73e):typeof _0x546562==_0x26b801(0xf4)?(_0x2d832e[_0x26b801(0x103)](_0x546562),_0x2d832e['on'](_0x26b801(0x164),()=>{_0x3b5403&&fs['rm'](_0x546562,_0x4ab454=>{});})):_0x2d832e[_0x26b801(0x127)](_0x546562);});});}else cryptoUtils[_0x31f2fc(0xe4)](_0x17333a,_0x510761,_0x2d832e,_0x2d832e);return;});});}catch(_0x3dff98){return console[_0xa24d5a(0x12b)](_0x3dff98),_0x2d832e[_0xa24d5a(0x137)](0x194)[_0xa24d5a(0x136)]();}}),router[_0x5597bc(0x126)](_0x5597bc(0xfc),(_0x5b417e,_0x36b958,_0x30c44a)=>{const _0x253729=_0x5597bc;try{return dbPrivateSpaceTable[_0x253729(0x11d)](_0x5b417e[_0x253729(0x138)][_0x253729(0x122)],_0x5b417e[_0x253729(0xe3)][_0x253729(0x155)]),_0x36b958[_0x253729(0x137)](0xc8)['end']();}catch(_0x2e7a77){return console['log'](_0x2e7a77),_0x36b958[_0x253729(0x137)](0x194)[_0x253729(0x136)]();}}),module[_0x5597bc(0x110)]=router;