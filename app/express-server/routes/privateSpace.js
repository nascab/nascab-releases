const _0x28af54=_0x325a;(function(_0x260d97,_0x334e77){const _0x15f9ff=_0x325a,_0x1aa4c1=_0x260d97();while(!![]){try{const _0x2598d0=-parseInt(_0x15f9ff(0x1cc))/0x1+parseInt(_0x15f9ff(0x228))/0x2*(parseInt(_0x15f9ff(0x1b1))/0x3)+parseInt(_0x15f9ff(0x207))/0x4*(-parseInt(_0x15f9ff(0x1f0))/0x5)+parseInt(_0x15f9ff(0x22d))/0x6*(parseInt(_0x15f9ff(0x1e5))/0x7)+parseInt(_0x15f9ff(0x1e7))/0x8*(parseInt(_0x15f9ff(0x1b7))/0x9)+-parseInt(_0x15f9ff(0x211))/0xa*(parseInt(_0x15f9ff(0x222))/0xb)+-parseInt(_0x15f9ff(0x1a6))/0xc*(-parseInt(_0x15f9ff(0x1f4))/0xd);if(_0x2598d0===_0x334e77)break;else _0x1aa4c1['push'](_0x1aa4c1['shift']());}catch(_0x166628){_0x1aa4c1['push'](_0x1aa4c1['shift']());}}}(_0xa319,0x70f35));let express=require(_0x28af54(0x1fa)),router=express['Router']();const Database=require('better-sqlite3');let dbPrivateSpaceTable=require(_0x28af54(0x22b)),path=require(_0x28af54(0x1a3)),fs=require('fs'),cryptoUtils=require(_0x28af54(0x235));const config=require('../../myConfig/config');let privateSpaceUtils=require('../utils/privateSpaceUtils');var faststart=require(_0x28af54(0x19a)),exifUtil=require(_0x28af54(0x1d0));let uploadUtil=require(_0x28af54(0x1bc));const PassThrough=require(_0x28af54(0x247))[_0x28af54(0x246)],{Readable}=require('stream');let sha256=require('sha256');const videoStreamUtil=require(_0x28af54(0x1d6));let fileUtil=require('../utils/fileUtils');const folderSignString=_0x28af54(0x208),folderSignFileName=_0x28af54(0x218),configFolderName=_0x28af54(0x1fd),noCheckFileList=['.DS_Store'];let FFmpeg=require(_0x28af54(0x23a))[_0x28af54(0x242)];function _0x325a(_0x1a786b,_0x4b505e){const _0xa3190d=_0xa319();return _0x325a=function(_0x325abe,_0x48d8d1){_0x325abe=_0x325abe-0x192;let _0x5b9c03=_0xa3190d[_0x325abe];return _0x5b9c03;},_0x325a(_0x1a786b,_0x4b505e);}const uploadPrivateUtil=require('../utils/uploadPrivateUtils'),privateSharpUtil=require('../utils/privateSpaceUtils'),sharpUtil=require('../utils/sharpUtils'),transCodeUtil=require(_0x28af54(0x1bb));let dbArr=[];function checkSpaceId(_0x163d43,_0x1cc62d){const _0xfa72ff=_0x28af54;let _0x2bb31f=_0x163d43['body']['spaceId']||_0x163d43[_0xfa72ff(0x233)][_0xfa72ff(0x251)];if(!_0x2bb31f)return _0x163d43[_0xfa72ff(0x1de)][_0xfa72ff(0x248)](_0x1cc62d,_0xfa72ff(0x21b));let _0x1dd6e8=dbPrivateSpaceTable['getById'](_0x163d43['app']['dbOther'],_0x2bb31f);if(!_0x1dd6e8)return _0x163d43[_0xfa72ff(0x1de)][_0xfa72ff(0x248)](_0x1cc62d,_0xfa72ff(0x1df));return!![];}function checkSpaceName(_0x2cb2db,_0x10ef37,_0x14003c){const _0x44e1d0=_0x28af54;if(!_0x14003c)return _0x2cb2db[_0x44e1d0(0x1de)][_0x44e1d0(0x248)](_0x10ef37,_0x10ef37['__'](_0x44e1d0(0x1f7)));if(_0x14003c[_0x44e1d0(0x23d)]>0x1e)return _0x2cb2db['app'][_0x44e1d0(0x248)](_0x10ef37,_0x10ef37['__'](_0x44e1d0(0x19c)));return!![];}function getPrivateIndexDb(_0x24e368){const _0x5c85c3=_0x28af54;let _0x993b0b=config[_0x5c85c3(0x1f9)](_0x24e368);for(let _0x2d3e2e in dbArr){if(dbArr[_0x2d3e2e]['dbPath']==_0x993b0b)return dbArr[_0x2d3e2e]['db'];}let _0x2d0e28=new Database(_0x993b0b,{});return _0x2d0e28[_0x5c85c3(0x205)](_0x5c85c3(0x24d)),dbArr[_0x5c85c3(0x1c3)]({'dbPath':_0x993b0b,'db':_0x2d0e28}),_0x2d0e28;}router[_0x28af54(0x250)](_0x28af54(0x20e),(_0x2a19ca,_0x45e10f,_0x4917ac)=>{const _0x3dd3d6=_0x28af54;let _0x9c4293=_0x2a19ca[_0x3dd3d6(0x1a1)][_0x3dd3d6(0x1eb)],_0x2de374=_0x2a19ca[_0x3dd3d6(0x1a1)][_0x3dd3d6(0x20f)],_0x3f0f26=_0x2a19ca[_0x3dd3d6(0x1da)],_0xd09d88=_0x2a19ca[_0x3dd3d6(0x1a1)][_0x3dd3d6(0x1af)];if(checkSpaceName(_0x2a19ca,_0x45e10f,_0x2de374)!==!![])return;if(!_0xd09d88||_0xd09d88[_0x3dd3d6(0x23d)]<0x4)return _0x2a19ca['app'][_0x3dd3d6(0x248)](_0x45e10f,_0x45e10f['__'](_0x3dd3d6(0x1b4)));function _0x3494b4(){return new Promise((_0xe1c628,_0x52c46f)=>{const _0x10570b=_0x325a;fs[_0x10570b(0x1ae)](_0x9c4293,(_0xe4c593,_0x196578)=>{const _0x4e2c16=_0x10570b;if(_0xe4c593)return _0x52c46f(_0x45e10f['__'](_0x4e2c16(0x1b5)));if(_0x196578[_0x4e2c16(0x24a)]>0x400*0x400*0x400)return _0x2a19ca[_0x4e2c16(0x1de)][_0x4e2c16(0x248)](_0x45e10f,_0x45e10f['__'](_0x4e2c16(0x1b5)));fs['readdir'](_0x9c4293,(_0x5ba264,_0x2dddec)=>{const _0x1a1cd0=_0x4e2c16;for(let _0xe6577a of _0x2dddec){if(noCheckFileList[_0x1a1cd0(0x21c)](_0xe6577a)||_0xe6577a[_0x1a1cd0(0x1e8)]('.')||_0xe6577a[_0x1a1cd0(0x1e8)]('@'))continue;return _0x52c46f(_0x45e10f['__'](_0x1a1cd0(0x1b5)));}_0xe1c628();});});});}fs[_0x3dd3d6(0x1ec)](_0x9c4293,fs[_0x3dd3d6(0x24c)]['R_OK']|fs[_0x3dd3d6(0x24c)][_0x3dd3d6(0x258)],_0x41a5f4=>{const _0x1982c1=_0x3dd3d6;if(_0x41a5f4)return _0x2a19ca['app'][_0x1982c1(0x248)](_0x45e10f,_0x45e10f['__'](_0x1982c1(0x1ea)));_0x3494b4()[_0x1982c1(0x199)](()=>{const _0x3a554b=_0x1982c1;let _0x4d8fec=dbPrivateSpaceTable[_0x3a554b(0x1bf)](_0x2a19ca[_0x3a554b(0x1de)][_0x3a554b(0x206)],_0x2de374);if(_0x4d8fec)return _0x2a19ca[_0x3a554b(0x1de)]['returnErrMsg'](_0x45e10f,_0x45e10f['__'](_0x3a554b(0x230)));let _0x3b647=path[_0x3a554b(0x1b8)](_0x9c4293,configFolderName);fs[_0x3a554b(0x214)](_0x3b647,{'recursive':!![]},_0x2b12d9=>{const _0x494e20=_0x3a554b;if(_0x2b12d9)return _0x2a19ca[_0x494e20(0x1de)][_0x494e20(0x248)](_0x45e10f,_0x45e10f['__'](_0x494e20(0x1cb))+JSON[_0x494e20(0x241)](_0x2b12d9));let _0x21df33=getPrivateIndexDb(_0x9c4293);dbPrivateSpaceTable[_0x494e20(0x19f)](_0x21df33,_0x9c4293),cryptoUtils[_0x494e20(0x1c4)](_0xd09d88,folderSignString)['then'](_0x9c5242=>{const _0x2a193e=_0x494e20;let _0xd02102=path[_0x2a193e(0x1b8)](_0x3b647,folderSignFileName);fs['writeFile'](_0xd02102,_0x9c5242,_0x53ad09=>{const _0x4707f9=_0x2a193e;if(_0x53ad09)return _0x2a19ca['app']['returnErrMsg'](_0x45e10f,_0x45e10f['__'](_0x4707f9(0x1cb))+JSON[_0x4707f9(0x241)](_0x53ad09));return dbPrivateSpaceTable[_0x4707f9(0x21f)](_0x2a19ca[_0x4707f9(0x1de)][_0x4707f9(0x206)],{'folder_path':_0x9c4293,'space_name':_0x2de374,'create_uid':_0x3f0f26['id']}),_0x45e10f[_0x4707f9(0x210)]({'code':0x0});});})['catch'](_0x599fba=>{const _0x4992a0=_0x494e20;return console['log'](_0x4992a0(0x1d7),_0x599fba),_0x2a19ca[_0x4992a0(0x1de)][_0x4992a0(0x248)](_0x45e10f,_0x45e10f['__']('operationFail')+JSON[_0x4992a0(0x241)](_0x599fba));});});})[_0x1982c1(0x1ed)](_0x12f055=>{const _0x5e6899=_0x1982c1;return _0x2a19ca[_0x5e6899(0x1de)][_0x5e6899(0x248)](_0x45e10f,_0x12f055);});});}),router[_0x28af54(0x250)](_0x28af54(0x1ef),(_0x25743d,_0x389123,_0x50547e)=>{const _0x1da1aa=_0x28af54;let _0xb85430=[];return _0x25743d[_0x1da1aa(0x1da)][_0x1da1aa(0x1d8)]==0x1?_0xb85430=dbPrivateSpaceTable['getAll'](_0x25743d[_0x1da1aa(0x1de)]['dbOther']):_0xb85430=dbPrivateSpaceTable[_0x1da1aa(0x19d)](_0x25743d['app'][_0x1da1aa(0x206)],_0x25743d[_0x1da1aa(0x1da)]['id']),_0x389123['json']({'code':0x0,'data':_0xb85430});});function checkSpacePwd(_0x47f914,_0x1e97fb,_0x328d47){return new Promise((_0x224143,_0x1aaa30)=>{const _0x2283fd=_0x325a;_0x1e97fb=Buffer[_0x2283fd(0x1dd)](_0x1e97fb,_0x2283fd(0x232))[_0x2283fd(0x1d2)]();let _0x50e4e8=path[_0x2283fd(0x1b8)](_0x328d47,configFolderName,folderSignFileName);fs[_0x2283fd(0x1ae)](_0x50e4e8,(_0x16cff5,_0x427289)=>{const _0x2f5ee6=_0x2283fd;if(_0x16cff5)return _0x1aaa30(_0x47f914['__'](_0x2f5ee6(0x256)));fs[_0x2f5ee6(0x213)](_0x50e4e8,_0x2f5ee6(0x1fe),(_0x4daaa9,_0x304f77)=>{const _0x34d469=_0x2f5ee6;if(_0x4daaa9)return _0x1aaa30(_0x47f914['__'](_0x34d469(0x256)));else cryptoUtils[_0x34d469(0x1d4)](_0x1e97fb,_0x304f77)[_0x34d469(0x199)](_0x435e18=>{const _0x5ad3f6=_0x34d469;return _0x435e18==folderSignString?_0x224143(_0x1e97fb):_0x1aaa30(_0x47f914['__'](_0x5ad3f6(0x1ad)));})[_0x34d469(0x1ed)](_0xe9e51a=>{const _0x35fa85=_0x34d469;return console['log']('error',_0xe9e51a),_0x1aaa30(_0x47f914['__'](_0x35fa85(0x1ad)));});});});});}router[_0x28af54(0x250)](_0x28af54(0x1b3),(_0x3cbb88,_0x54b740,_0x3ab7b7)=>{const _0x3e95d7=_0x28af54;let _0x1dd0c2=_0x3cbb88[_0x3e95d7(0x1a1)][_0x3e95d7(0x1e1)],_0x54374e=_0x3cbb88[_0x3e95d7(0x1a1)][_0x3e95d7(0x251)],_0x116fff=dbPrivateSpaceTable[_0x3e95d7(0x24f)](_0x3cbb88[_0x3e95d7(0x1de)][_0x3e95d7(0x206)],_0x54374e);if(!_0x116fff)return _0x3cbb88[_0x3e95d7(0x1de)][_0x3e95d7(0x248)](_0x54b740,_0x3e95d7(0x244));fs[_0x3e95d7(0x1ae)](_0x116fff[_0x3e95d7(0x1a9)],(_0x1c0365,_0x4e7c39)=>{const _0x47ac46=_0x3e95d7;if(_0x1c0365)return _0x3cbb88[_0x47ac46(0x1de)][_0x47ac46(0x248)](_0x54b740,_0x54b740['__'](_0x47ac46(0x1d5)));checkSpacePwd(_0x54b740,_0x1dd0c2,_0x116fff[_0x47ac46(0x1a9)])[_0x47ac46(0x199)](_0x3adb73=>{const _0x29ad7c=_0x47ac46;let _0x362ce8=sha256(new Date()[_0x29ad7c(0x1c0)]()+_0x54374e+_0x3adb73);cryptoUtils[_0x29ad7c(0x1c4)](config['tokenPwdEncryptKey'],_0x3adb73)['then'](_0x15c189=>{const _0x4b7c9d=_0x29ad7c;return dbPrivateSpaceTable[_0x4b7c9d(0x252)](_0x3cbb88[_0x4b7c9d(0x1de)][_0x4b7c9d(0x206)],{'space_id':_0x54374e,'pwd':_0x15c189,'token':_0x362ce8}),_0x54b740['json']({'code':0x0,'token':_0x362ce8});});})[_0x47ac46(0x1ed)](_0x412e47=>{const _0x2fd0dc=_0x47ac46;return console[_0x2fd0dc(0x254)](_0x2fd0dc(0x1d7),_0x412e47),_0x3cbb88[_0x2fd0dc(0x1de)][_0x2fd0dc(0x248)](_0x54b740,_0x412e47);});});});function ffprobeSync(_0x1932db){return new Promise((_0x4e6fbd,_0x3855fa)=>{const _0x11dfd1=_0x325a;try{FFmpeg(transCodeUtil[_0x11dfd1(0x1dc)](_0x1932db))[_0x11dfd1(0x1c1)]((_0x193223,_0x16969f)=>{_0x193223?_0x3855fa(_0x193223):_0x4e6fbd(_0x16969f);});}catch(_0x19ad59){console[_0x11dfd1(0x254)](_0x11dfd1(0x1d7),_0x19ad59),_0x3855fa(_0x19ad59);}});}function deleteFile(_0x371be5){fs['rm'](_0x371be5,{'maxRetries':0xa,'retryDelay':0x3e8},_0x190362=>{});}function _0xa319(){const _0x530419=['decryptString','private.spaceFolderNotExist','../../utils/videoStreamUtil','error','is_admin','lastInsertRowid','currentUser','destination','dealFFmpegPath','from','app','space\x20id\x20is\x20invalid','private.fileNameTooLong','checkStr','private.spaceConfigFileBroken','videoTypeList','unlink','77MiCLSs','\x27\x20where\x20id=','8Hjoqjr','startsWith','genImageTinyFile','noWritePermission','folderPath','access','catch','toLowerCase','/getAllSpace','730XeOGJn','tiny_path','err','space_token','81523MOrjQj','buffer','createIndex','private.spaceNameCantNull','encryptFileFromInputPipe','getPrivateDbPath','express','run','savePath','nascabconfig','utf-8','transSpcielFormatFromBuffer','decryptFileGetStream','all','not\x20found','concat','ext','pragma','dbOther','20788NABjiS','nascabisthebest','CreateDate','create_uid','space_id','\x20offset\x20','deleteSpaceToken','/addPrivateSpace','spaceName','json','140CYEzQI','over','readFile','mkdir','pwd','/exitSpaceId','tiny','nascabconfigenc','EXPORT_PRIVATE_SPACE','spaceToken','space\x20id\x20is\x20null','includes','imgTypeList','prepare','create','message','streamToBuffer','490589WIGAIS','indexOf','overMode','changes','/deleteSpace','undefined','2rJyGXQ','getTokenObjByToken','folderNotExist','../../db/dbPrivateSpaceTable','/regularUpload','150222eGNfRb','ids','/getDecodeFile*','private.hasSameNameSpace','Content-Disposition','base64','query','rawImgTypeList','../utils/cryptoUtils','headers','filename','close','/deleteSpaceFiles','../../libs/nasTrans','ifExtIsSpecialFormat','delete','length','genVideoTinyFile','decryptFile','type','stringify','FFmpeg','/importSpace','error\x20space\x20id','decodePath','PassThrough','stream','returnErrMsg','send','size','UPDATE\x20private_space_index\x20SET\x20original_time=\x27','constants','journal_mode\x20=\x20WAL','getDurationFromStream','getById','post','spaceId','createToken','.mp4','log','private.noExist','private.configFileReadFail','image','W_OK','orderType','deleteIndex','space/index\x20id\x20is\x20null','check_time','sharpDealImg','private.onlyAdminCanDelete','/exportSpace','START_WORKER_BG_TASK','then','../utils/faststart','\x20order\x20by\x20','private.spaceNameTooLong','getAllByUid','\x20WHERE\x20file_type=\x27','createIndexDb','encryptFile','body','privateSpaceKey','path','temp','other','2244vykUjk','normalize','attachment;\x20filename*=UTF-8\x27\x27','folder_path','replace','orderField','desc','private.passwordIncorrect','stat','spacePwd','createReadStream','2658618hwjeSt','destroy','/checkPwd','private.spacePwdGtFour','needEmptyFolderPrivateSpace','encodeFilename','2423205irBWTe','join','uploadFile','end','../../utils/transCodeUtil','../utils/uploadUtils','getIndexByFileName','data','getBySpaceName','getTime','ffprobe','private.alreadyHasSameNameFile','push','encryptString','video','getAllIndexByWhere','\x20limit\x20','resolve','DateTimeOriginal','sendFile','operationFail','757742LGthmH','filename_enc','getVideoOriginalTime','status','exifr','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','toString','parse'];_0xa319=function(){return _0x530419;};return _0xa319();}function uploadFail(_0x41f99e,_0x56955a,_0x2a0174,_0xbeb0f5){const _0x54b96a=_0x28af54;return deleteFile(_0x56955a),_0x2a0174[_0x54b96a(0x1de)][_0x54b96a(0x248)](_0xbeb0f5,_0xbeb0f5['__']('private.uploadErrTryAgain'));}function dealUploadImageOrFile(_0x509638,_0x212a63,_0x3589a9,_0x12f316,_0x4ae36a,_0x3037ea,_0x4f574c,_0x3de597,_0x471c67){const _0x47452a=_0x28af54;uploadPrivateUtil[_0x47452a(0x1b9)](_0x3589a9,_0x12f316,_0x4ae36a,_0x3037ea,_0x4ea80e=>{const _0x262a39=_0x47452a;let _0x17a438=_0x4ea80e[_0x262a39(0x1a3)],_0x92205e=cryptoUtils[_0x262a39(0x200)](_0x3037ea,_0x17a438),_0x4bb2cd=dbPrivateSpaceTable[_0x262a39(0x1f6)](_0x509638,{'filename':new Buffer[(_0x262a39(0x1dd))](_0x3de597)[_0x262a39(0x1d2)](_0x262a39(0x232)),'filename_enc':_0x4ae36a,'file_type':_0x4f574c,'ext':_0x471c67});if(_0x4bb2cd[_0x262a39(0x225)]<0x1)return uploadFail(_0x509638,_0x17a438,_0x3589a9,_0x12f316);let _0x18e8b2=_0x4bb2cd[_0x262a39(0x1d9)];_0x12f316[_0x262a39(0x210)]({'code':0x0});let _0x14711f=new Date()[_0x262a39(0x1c0)]();if(_0x4f574c==_0x262a39(0x257)){var _0x1f6cb1=[];let _0x3840b7=new PassThrough()['pipe'](_0x92205e);_0x3840b7['on'](_0x262a39(0x1be),function(_0x47df67){const _0x122bac=_0x262a39;_0x1f6cb1[_0x122bac(0x1c3)](_0x47df67);}),_0x3840b7['on'](_0x262a39(0x1ba),function(){const _0x43b421=_0x262a39;var _0x233df4=Buffer[_0x43b421(0x203)](_0x1f6cb1);function _0x423102(){const _0x153a1a=_0x43b421;exifUtil[_0x153a1a(0x1d3)](_0x233df4)[_0x153a1a(0x199)](_0x855953=>{const _0xecbf61=_0x153a1a;if(_0x855953){let _0x23d697=_0x855953[_0xecbf61(0x1c9)];_0x855953[_0xecbf61(0x209)]&&!_0x23d697&&(_0x23d697=_0x855953[_0xecbf61(0x209)]),_0x23d697&&(_0x14711f=new Date(_0x23d697)[_0xecbf61(0x1c0)](),_0x509638[_0xecbf61(0x21e)](_0xecbf61(0x24b)+_0x14711f+_0xecbf61(0x1e6)+_0x18e8b2)[_0xecbf61(0x1fb)]());}})[_0x153a1a(0x1ed)](_0x5191cd=>{});}privateSpaceUtils[_0x43b421(0x1e9)](_0x471c67,_0x233df4,_0x2f54c2=>{const _0x4c5f03=_0x43b421,_0x501011=Readable[_0x4c5f03(0x1dd)](_0x2f54c2);let _0x40d185=path[_0x4c5f03(0x1b8)](_0x212a63,_0x4ae36a);cryptoUtils[_0x4c5f03(0x1f8)](_0x3037ea,_0x501011,_0x40d185)['then'](_0x2a1179=>{const _0x141be9=_0x4c5f03;let _0x367f72=path['join'](configFolderName,_0x141be9(0x217),_0x4ae36a);_0x509638[_0x141be9(0x21e)](_0x141be9(0x1d1)+_0x367f72+'\x27\x20where\x20id='+_0x18e8b2)[_0x141be9(0x1fb)](),_0x423102();});},_0x27a084=>{_0x423102();});});}});}function dealUploadVideo(_0x3768cd,_0x38b613,_0x360c1a,_0x62342e,_0x12ed5c,_0x5a6287,_0x4742fb,_0x3ffd26,_0x57acd5,_0x32a305,_0x4996e6){const _0x555f13=_0x28af54;_0x12ed5c[_0x555f13(0x233)]['savePath']=_0x62342e,_0x12ed5c[_0x555f13(0x233)][_0x555f13(0x224)]=_0x555f13(0x212),uploadUtil['uploadFile'](_0x12ed5c,_0x5a6287,![],!![],![],_0x26ea2f=>{const _0x4bb62b=_0x555f13;let _0x1ead85=_0x26ea2f[_0x4bb62b(0x1a3)],_0x4133ff=path[_0x4bb62b(0x1b8)](_0x26ea2f[_0x4bb62b(0x1db)]);function _0x3977bf(_0x44f4d4){const _0x2f3bd8=_0x4bb62b;ffprobeSync(_0x1ead85)[_0x2f3bd8(0x199)](_0xcf43af=>{const _0x4d4c2a=_0x2f3bd8;let _0x3cb73f=0x0;_0x3cb73f=videoStreamUtil[_0x4d4c2a(0x24e)](_0xcf43af);let _0x5777c2=JSON[_0x4d4c2a(0x241)](_0xcf43af['streams']),_0x2b78ea=videoStreamUtil[_0x4d4c2a(0x1ce)](_0xcf43af);fs[_0x4d4c2a(0x1ae)](_0x1ead85,(_0x3cb32f,_0x347fc2)=>{const _0xb49861=_0x4d4c2a;if(_0x3cb32f){deleteFile(_0x1ead85);return;}let _0x1e77b7='UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?';_0x3768cd['prepare'](_0x1e77b7)[_0xb49861(0x1fb)](_0x2b78ea,parseInt(_0x3cb73f),_0x347fc2[_0xb49861(0x24a)],_0x5777c2,_0x44f4d4);let _0x19792f='tiny-'+Buffer[_0xb49861(0x1dd)](_0x32a305)[_0xb49861(0x1d2)]('base64');privateSpaceUtils[_0xb49861(0x23e)](_0x1ead85,_0x4133ff,_0x19792f,_0x318d7f=>{const _0x455ea=_0xb49861;fs[_0x455ea(0x1ae)](_0x318d7f,(_0x463327,_0x474cb0)=>{const _0x1b1b43=_0x455ea;if(_0x463327){deleteFile(_0x1ead85);return;}let _0x50e724=path[_0x1b1b43(0x1b8)](_0x360c1a,_0x4742fb);cryptoUtils[_0x1b1b43(0x1a0)](_0x3ffd26,_0x318d7f,_0x50e724)[_0x1b1b43(0x199)](_0x3cb6df=>{const _0x30a3c9=_0x1b1b43;let _0x2cdee2=path[_0x30a3c9(0x1b8)](configFolderName,_0x30a3c9(0x217),_0x4742fb);_0x3768cd[_0x30a3c9(0x21e)](_0x30a3c9(0x1d1)+_0x2cdee2+'\x27\x20where\x20id='+_0x44f4d4)[_0x30a3c9(0x1fb)](),deleteFile(_0x318d7f),deleteFile(_0x1ead85);});});},_0x5673d3=>{deleteFile(_0x1ead85);});});})['catch'](_0x2a3027=>{deleteFile(_0x1ead85);});}function _0x3019b2(){const _0x819d8f=_0x4bb62b;let _0x13fd68=dbPrivateSpaceTable[_0x819d8f(0x1f6)](_0x3768cd,{'filename':new Buffer[(_0x819d8f(0x1dd))](_0x32a305)[_0x819d8f(0x1d2)](_0x819d8f(0x232)),'filename_enc':_0x4742fb,'file_type':_0x57acd5,'ext':_0x4996e6});return _0x13fd68[_0x819d8f(0x225)]<0x1?uploadFail(_0x3768cd,_0x1ead85,_0x12ed5c,_0x5a6287):(_0x3977bf(_0x13fd68['lastInsertRowid']),_0x5a6287[_0x819d8f(0x210)]({'code':0x0}));}function _0x3c60a5(_0x24d4c0,_0x45e750,_0x544758){const _0x1029f6=_0x4bb62b;cryptoUtils[_0x1029f6(0x1a0)](_0x3ffd26,_0x24d4c0,_0x45e750)[_0x1029f6(0x199)](_0x4675d7=>{_0x544758(_0x4675d7);})[_0x1029f6(0x1ed)](_0x4d1166=>{const _0x54aff7=_0x1029f6;console[_0x54aff7(0x254)](_0x4d1166),uploadFail(_0x3768cd,_0x24d4c0,_0x12ed5c,_0x5a6287);});}let _0x424209=path[_0x4bb62b(0x1b8)](_0x38b613[_0x4bb62b(0x1a9)],_0x4742fb);if(_0x4996e6==_0x4bb62b(0x253)||_0x4996e6=='.mov'){var _0x200f0b=faststart[_0x4bb62b(0x1b0)](_0x1ead85,{'errorCallBack':_0x3c9708=>{_0x3c60a5(_0x1ead85,_0x424209,_0x3019b2);}});_0x200f0b['on'](_0x4bb62b(0x238),function(){const _0x16880b=_0x4bb62b;_0x200f0b[_0x16880b(0x1b2)]();}),cryptoUtils[_0x4bb62b(0x1f8)](_0x3ffd26,_0x200f0b,_0x424209)[_0x4bb62b(0x199)](_0x38156d=>{_0x3019b2();})[_0x4bb62b(0x1ed)](_0x5a4132=>{const _0x123244=_0x4bb62b;console['log'](_0x123244(0x1d7),_0x5a4132),uploadFail(_0x3768cd,_0x1ead85,_0x12ed5c,_0x5a6287);});}else _0x3c60a5(_0x1ead85,_0x424209,_0x3019b2);});}router[_0x28af54(0x250)](_0x28af54(0x22c),function(_0x307358,_0x40a7ee,_0x3caa41){const _0x40a5e5=_0x28af54;let _0x14ae41=_0x307358['query'][_0x40a5e5(0x251)]||_0x307358[_0x40a5e5(0x1a1)][_0x40a5e5(0x251)]||_0x307358[_0x40a5e5(0x236)][_0x40a5e5(0x20b)],_0xc96727=_0x307358[_0x40a5e5(0x233)][_0x40a5e5(0x237)]||_0x307358['headers']['filename'],_0x36880e=decodeURIComponent(_0xc96727);_0x307358[_0x40a5e5(0x233)][_0x40a5e5(0x1b6)]&&(_0x36880e=fileUtil[_0x40a5e5(0x245)](_0x307358[_0x40a5e5(0x233)]['encodeFilename'])),getPwdFromToken(_0x307358,_0x40a7ee,_0x298141=>{const _0x3d02ee=_0x40a5e5;let _0x30e974=dbPrivateSpaceTable['getById'](_0x307358[_0x3d02ee(0x1de)][_0x3d02ee(0x206)],_0x14ae41);if(!_0x30e974)return _0x307358[_0x3d02ee(0x1de)][_0x3d02ee(0x248)](_0x40a7ee,_0x40a7ee['__'](_0x3d02ee(0x255)));_0x307358[_0x3d02ee(0x233)][_0x3d02ee(0x1fc)]=_0x30e974['folder_path'];let _0x1ffb4c=getPrivateIndexDb(_0x30e974[_0x3d02ee(0x1a9)]),_0x46f85c=dbPrivateSpaceTable[_0x3d02ee(0x1bd)](_0x1ffb4c,new Buffer[(_0x3d02ee(0x1dd))](_0x36880e)[_0x3d02ee(0x1d2)](_0x3d02ee(0x232)));if(_0x46f85c)return _0x307358[_0x3d02ee(0x1de)][_0x3d02ee(0x248)](_0x40a7ee,_0x40a7ee['__'](_0x3d02ee(0x1c2)));let _0x3ac451=path['extname'](_0x36880e)?path['extname'](_0x36880e)['toLowerCase']():null,_0x394d2e=_0x3d02ee(0x1a5);if(_0x3ac451){if(config[_0x3d02ee(0x21d)][_0x3d02ee(0x21c)](_0x3ac451[_0x3d02ee(0x1ee)]())||config[_0x3d02ee(0x234)][_0x3d02ee(0x21c)](_0x3ac451[_0x3d02ee(0x1ee)]()))_0x394d2e=_0x3d02ee(0x257);else config[_0x3d02ee(0x1e3)][_0x3d02ee(0x21c)](_0x3ac451[_0x3d02ee(0x1ee)]())&&(_0x394d2e='video');}let _0x28c6af=path['join'](_0x30e974[_0x3d02ee(0x1a9)],configFolderName,_0x3d02ee(0x217)),_0x38faca=path['join'](_0x30e974[_0x3d02ee(0x1a9)],configFolderName,_0x3d02ee(0x1a4));function _0x4c7a4d(){const _0xaab26=_0x3d02ee;cryptoUtils[_0xaab26(0x1c4)](_0x298141,_0x36880e)['then'](_0x479cc4=>{const _0x4f6f4f=_0xaab26;if(_0x479cc4[_0x4f6f4f(0x23d)]>0xf0)return _0x307358[_0x4f6f4f(0x1de)]['returnErrMsg'](_0x40a7ee,_0x40a7ee['__'](_0x4f6f4f(0x1e0)));_0x394d2e==_0x4f6f4f(0x1c5)?dealUploadVideo(_0x1ffb4c,_0x30e974,_0x28c6af,_0x38faca,_0x307358,_0x40a7ee,_0x479cc4,_0x298141,_0x394d2e,_0x36880e,_0x3ac451):dealUploadImageOrFile(_0x1ffb4c,_0x28c6af,_0x307358,_0x40a7ee,_0x479cc4,_0x298141,_0x394d2e,_0x36880e,_0x3ac451);});}fs[_0x3d02ee(0x1ae)](_0x28c6af,(_0x4bc0d9,_0x17bad3)=>{const _0x4f424b=_0x3d02ee;function _0xbce85c(){const _0x220770=_0x325a;fs[_0x220770(0x1ae)](_0x38faca,(_0x312e90,_0x37b7a6)=>{const _0x5572af=_0x220770;_0x312e90?fs[_0x5572af(0x214)](_0x38faca,{'recursive':!![]},_0x45eff7=>{_0x4c7a4d();}):_0x4c7a4d();});}_0x4bc0d9?fs[_0x4f424b(0x214)](_0x28c6af,{'recursive':!![]},_0x27f3be=>{_0xbce85c();}):_0xbce85c();});});}),router[_0x28af54(0x250)](_0x28af54(0x243),(_0x1baf3d,_0x19650c,_0x52f01f)=>{const _0x409ee5=_0x28af54;let _0x1f86b3=_0x1baf3d[_0x409ee5(0x1a1)][_0x409ee5(0x1eb)],_0x17c0a9=_0x1baf3d[_0x409ee5(0x1a1)]['spaceName'],_0xfed239=_0x1baf3d['currentUser'],_0x244aa1=_0x1baf3d[_0x409ee5(0x1a1)][_0x409ee5(0x1af)];if(!_0x17c0a9)return _0x1baf3d[_0x409ee5(0x1de)][_0x409ee5(0x248)](_0x19650c,_0x19650c['__'](_0x409ee5(0x1f7)));let _0x153fc3=dbPrivateSpaceTable['getBySpaceName'](_0x1baf3d[_0x409ee5(0x1de)]['dbOther'],_0x17c0a9);if(_0x153fc3)return _0x1baf3d[_0x409ee5(0x1de)][_0x409ee5(0x248)](_0x19650c,_0x19650c['__'](_0x409ee5(0x230)));if(!_0x244aa1)return _0x1baf3d[_0x409ee5(0x1de)][_0x409ee5(0x248)](_0x19650c,_0x19650c['__'](_0x409ee5(0x1b4)));fs[_0x409ee5(0x1ec)](_0x1f86b3,_0x115175=>{const _0x593b12=_0x409ee5;if(_0x115175)return _0x1baf3d[_0x593b12(0x1de)][_0x593b12(0x248)](_0x19650c,_0x19650c['__'](_0x593b12(0x1ea)));checkSpacePwd(_0x19650c,_0x244aa1,_0x1f86b3)['then'](()=>{const _0x27c0db=_0x593b12;let _0x19a28d=config[_0x27c0db(0x1f9)](_0x1f86b3);fs[_0x27c0db(0x1ae)](_0x19a28d,(_0x41a42b,_0x542a4e)=>{const _0x32be17=_0x27c0db;if(_0x41a42b)return _0x1baf3d[_0x32be17(0x1de)]['returnErrMsg'](_0x19650c,_0x19650c['__'](_0x32be17(0x1e2)));return dbPrivateSpaceTable['create'](_0x1baf3d[_0x32be17(0x1de)][_0x32be17(0x206)],{'folder_path':_0x1f86b3,'space_name':_0x17c0a9,'create_uid':_0xfed239['id']}),_0x19650c[_0x32be17(0x210)]({'code':0x0});});})[_0x593b12(0x1ed)](_0x4ee105=>{const _0x38c9e2=_0x593b12;return _0x1baf3d[_0x38c9e2(0x1de)][_0x38c9e2(0x248)](_0x19650c,_0x4ee105);});});}),router[_0x28af54(0x250)](_0x28af54(0x197),(_0xe0ca18,_0x4af9f0,_0x3e478b)=>{const _0x563184=_0x28af54;let _0x3bd1fc=_0xe0ca18[_0x563184(0x1a1)][_0x563184(0x1eb)],_0x1a3f9c=_0xe0ca18['body'][_0x563184(0x1af)],_0x38e1fd=_0xe0ca18[_0x563184(0x1a1)]['targetFolderPath'];if(!_0x1a3f9c)return _0xe0ca18[_0x563184(0x1de)][_0x563184(0x248)](_0x4af9f0,_0x4af9f0['__']('private.spacePwdGtFour'));fs[_0x563184(0x1ec)](_0x3bd1fc,fs[_0x563184(0x24c)]['R_OK'],_0x534714=>{const _0x5d644f=_0x563184;if(_0x534714)return _0xe0ca18[_0x5d644f(0x1de)][_0x5d644f(0x248)](_0x4af9f0,_0x4af9f0['__'](_0x5d644f(0x1ea)));fs[_0x5d644f(0x1ec)](_0x38e1fd,fs[_0x5d644f(0x24c)][_0x5d644f(0x258)],_0x135cd7=>{const _0x3cfd4e=_0x5d644f;if(_0x135cd7)return _0xe0ca18[_0x3cfd4e(0x1de)][_0x3cfd4e(0x248)](_0x4af9f0,_0x4af9f0['__'](_0x3cfd4e(0x1ea)));function _0x4f1f32(_0x35a869){const _0x17be06=_0x3cfd4e;cryptoUtils['encryptString'](config[_0x17be06(0x1a2)],_0x1a3f9c)[_0x17be06(0x199)](_0x501643=>{const _0xbc9a5b=_0x17be06;return _0x35a869[_0xbc9a5b(0x1de)][_0xbc9a5b(0x206)][_0xbc9a5b(0x21e)]('INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)')[_0xbc9a5b(0x1fb)](_0xbc9a5b(0x219),JSON[_0xbc9a5b(0x241)]({'folderPath':_0x3bd1fc,'targetFolderPath':_0x38e1fd,'spacePwd':_0x501643})),process[_0xbc9a5b(0x249)]({'type':_0xbc9a5b(0x198)}),_0x4af9f0[_0xbc9a5b(0x210)]({'code':0x0});});}let _0x5b96a0=path[_0x3cfd4e(0x1b8)](_0x3bd1fc,configFolderName,folderSignFileName);fs[_0x3cfd4e(0x1ae)](_0x5b96a0,(_0x326f75,_0x448402)=>{const _0x4c3951=_0x3cfd4e;_0x326f75?_0x4f1f32(_0xe0ca18):checkSpacePwd(_0x4af9f0,_0x1a3f9c,_0x3bd1fc)['then'](()=>{_0x4f1f32(_0xe0ca18);})[_0x4c3951(0x1ed)](_0x5cb9fb=>{const _0x461f79=_0x4c3951;return console[_0x461f79(0x254)](_0x5cb9fb),_0xe0ca18['app'][_0x461f79(0x248)](_0x4af9f0,_0x4af9f0['__'](_0x461f79(0x1ad)));});});});});}),router[_0x28af54(0x250)](_0x28af54(0x239),(_0x456716,_0x3796f0,_0xdd0970)=>{const _0x267c56=_0x28af54;let _0xd8c9a0=_0x456716[_0x267c56(0x1a1)][_0x267c56(0x251)],_0x51551f=_0x456716[_0x267c56(0x1a1)][_0x267c56(0x22e)];if(!_0x51551f||_0x51551f['length']<0x1)return _0x3796f0[_0x267c56(0x1cf)](0x194)[_0x267c56(0x1ba)]();let _0x23cdd0=dbPrivateSpaceTable['getById'](_0x456716[_0x267c56(0x1de)][_0x267c56(0x206)],_0xd8c9a0);if(!_0x23cdd0)return _0x3796f0[_0x267c56(0x1cf)](0x194)[_0x267c56(0x1ba)]();if(_0x456716[_0x267c56(0x1da)][_0x267c56(0x1d8)]!=0x1){if(_0x23cdd0[_0x267c56(0x20a)]!=_0x456716[_0x267c56(0x1da)]['id'])return _0x3796f0[_0x267c56(0x210)]({'code':0x1,'message':_0x3796f0['__']('private.onlyAdminCanDelete')});}try{let _0x202305=getPrivateIndexDb(_0x23cdd0['folder_path']),_0x292729=JSON[_0x267c56(0x1d3)](_0x51551f),_0x1d5323=0x0,_0x1f5024=[],_0x38c53d=0x0,_0x4fbb18=0x0;if(_0x292729['length']<0x1)return _0x3796f0[_0x267c56(0x210)]({'code':0x0,'deleteList':_0x1f5024,'deleteCount':_0x1d5323,'errCount':_0x38c53d});for(let _0x14d654=0x0;_0x14d654<_0x292729[_0x267c56(0x23d)];_0x14d654++){let _0x42327b=dbPrivateSpaceTable['getIndexByWhere'](_0x202305,'\x20id='+_0x292729[_0x14d654]);if(!_0x42327b)return _0x456716[_0x267c56(0x1de)][_0x267c56(0x248)](_0x3796f0,_0x3796f0['__'](_0x267c56(0x22a)));let _0x313676=path[_0x267c56(0x1b8)](_0x23cdd0[_0x267c56(0x1a9)],_0x42327b[_0x267c56(0x1cd)]);if(_0x42327b['tiny_path']&&_0x42327b[_0x267c56(0x1f1)]!=_0x267c56(0x227)){let _0x17cc7a=path[_0x267c56(0x1b8)](_0x23cdd0[_0x267c56(0x1a9)],_0x42327b[_0x267c56(0x1f1)]);try{fs['unlink'](_0x17cc7a,_0x49838b=>{});}catch(_0xf35d73){}}fs[_0x267c56(0x1e4)](_0x313676,_0x5c9b31=>{const _0x2b0571=_0x267c56;_0x4fbb18+=0x1;_0x5c9b31?(console['log'](_0x2b0571(0x1f2),_0x5c9b31[_0x2b0571(0x220)]),_0x38c53d+=0x1):(_0x1d5323+=0x1,_0x1f5024[_0x2b0571(0x1c3)](_0x292729[_0x14d654]));dbPrivateSpaceTable[_0x2b0571(0x192)](_0x202305,_0x292729[_0x14d654]);if(_0x4fbb18==_0x292729[_0x2b0571(0x23d)])return _0x3796f0[_0x2b0571(0x210)]({'code':0x0,'deleteList':_0x1f5024,'deleteCount':_0x1d5323,'errCount':_0x38c53d});});}}catch(_0x5e3c38){return console['log'](_0x267c56(0x1d7),_0x5e3c38),_0x3796f0[_0x267c56(0x210)]({'code':0x1,'message':JSON[_0x267c56(0x241)](_0x5e3c38)});}}),router[_0x28af54(0x250)](_0x28af54(0x226),(_0x25bc35,_0x5518b2,_0xe427a0)=>{const _0xad54f9=_0x28af54;if(checkSpaceId(_0x25bc35,_0x5518b2)!==!![])return;let _0x41620b=_0x25bc35[_0xad54f9(0x1a1)][_0xad54f9(0x251)],_0x482494=dbPrivateSpaceTable[_0xad54f9(0x24f)](_0x25bc35['app'][_0xad54f9(0x206)],_0x41620b);if(_0x25bc35[_0xad54f9(0x1da)][_0xad54f9(0x1d8)]!=0x1){if(_0x482494['create_uid']!=_0x25bc35[_0xad54f9(0x1da)]['id'])return _0x5518b2[_0xad54f9(0x210)]({'code':0x1,'message':_0x5518b2['__'](_0xad54f9(0x196))});}return dbPrivateSpaceTable[_0xad54f9(0x23c)](_0x25bc35[_0xad54f9(0x1de)][_0xad54f9(0x206)],_0x41620b),_0x5518b2['json']({'code':0x0});}),router[_0x28af54(0x250)]('/updateSpaceName',(_0x20bd02,_0x5f53ea,_0x308e04)=>{const _0x5cffeb=_0x28af54;let _0x11ae7e=_0x20bd02[_0x5cffeb(0x1a1)][_0x5cffeb(0x20f)],_0x56e4ef=_0x20bd02[_0x5cffeb(0x1a1)][_0x5cffeb(0x251)];if(checkSpaceId(_0x20bd02,_0x5f53ea)!==!![])return;if(checkSpaceName(_0x20bd02,_0x5f53ea,_0x11ae7e)!==!![])return;let _0x53ca43=dbPrivateSpaceTable['getById'](_0x20bd02[_0x5cffeb(0x1de)][_0x5cffeb(0x206)],_0x56e4ef);if(_0x20bd02[_0x5cffeb(0x1da)][_0x5cffeb(0x1d8)]!=0x1){if(_0x53ca43['create_uid']!=_0x20bd02[_0x5cffeb(0x1da)]['id'])return _0x5f53ea[_0x5cffeb(0x210)]({'code':0x1,'message':_0x5f53ea['__'](_0x5cffeb(0x196))});}return dbPrivateSpaceTable['updateSpaceName'](_0x20bd02[_0x5cffeb(0x1de)][_0x5cffeb(0x206)],_0x11ae7e,_0x56e4ef),_0x5f53ea[_0x5cffeb(0x210)]({'code':0x0});}),router[_0x28af54(0x250)]('/getFileList',(_0x545a3c,_0x2fd151,_0x531de1)=>{const _0x220742=_0x28af54;let _0x3f5c78=_0x545a3c['body'][_0x220742(0x251)];if(!_0x3f5c78)return _0x545a3c[_0x220742(0x1de)][_0x220742(0x248)](_0x2fd151,_0x220742(0x21b));let _0x22e4c3=dbPrivateSpaceTable[_0x220742(0x24f)](_0x545a3c[_0x220742(0x1de)][_0x220742(0x206)],_0x3f5c78);if(!_0x22e4c3)return _0x545a3c['app'][_0x220742(0x248)](_0x2fd151,_0x220742(0x1df));let _0x3c11a3=config[_0x220742(0x1f9)](_0x22e4c3['folder_path']);fs[_0x220742(0x1ae)](_0x3c11a3,(_0x12371a,_0x43804f)=>{const _0x51972c=_0x220742;if(_0x12371a)return _0x545a3c[_0x51972c(0x1de)]['returnErrMsg'](_0x2fd151,_0x2fd151['__'](_0x51972c(0x1e2)));let _0x3e6937=_0x545a3c['body']['count']||0x64,_0x32ecd5=_0x545a3c['body']['offsetCount']||0x0,_0x45b6cb=_0x545a3c[_0x51972c(0x1a1)][_0x51972c(0x1ab)]||'id',_0x523d85=_0x545a3c[_0x51972c(0x1a1)][_0x51972c(0x259)]||_0x51972c(0x1ac),_0x2baed1=_0x545a3c[_0x51972c(0x1a1)]['fileType'],_0x1b0dc2=getPrivateIndexDb(_0x22e4c3[_0x51972c(0x1a9)]),_0x113d72='';_0x2baed1&&_0x2baed1!=_0x51972c(0x201)&&(_0x113d72+=_0x51972c(0x19e)+_0x2baed1+'\x27');_0x113d72+=_0x51972c(0x19b)+_0x45b6cb+'\x20'+_0x523d85+_0x51972c(0x1c7)+_0x3e6937+_0x51972c(0x20c)+_0x32ecd5;let _0x39fb17=dbPrivateSpaceTable[_0x51972c(0x1c6)](_0x1b0dc2,_0x113d72);return _0x2fd151['json']({'code':0x0,'data':_0x39fb17});});});function getPwdFromToken(_0x24e713,_0x48a52a,_0x394fc6){const _0x914f09=_0x28af54;let _0x3b257d=_0x24e713[_0x914f09(0x233)][_0x914f09(0x21a)]||_0x24e713[_0x914f09(0x1a1)]['spaceToken']||_0x24e713[_0x914f09(0x236)][_0x914f09(0x1f3)],_0x17265b=dbPrivateSpaceTable[_0x914f09(0x229)](_0x24e713[_0x914f09(0x1de)][_0x914f09(0x206)],_0x3b257d);if(!_0x17265b)return _0x48a52a[_0x914f09(0x210)]({'code':0x68});let _0x715726=_0x17265b[_0x914f09(0x215)];cryptoUtils[_0x914f09(0x1d4)](config['tokenPwdEncryptKey'],_0x715726)[_0x914f09(0x199)](_0x138d5b=>{_0x394fc6(_0x138d5b);})[_0x914f09(0x1ed)](_0x2814f7=>{console['log'](_0x2814f7);});}router['get'](_0x28af54(0x22f),(_0x341559,_0x5e1d2c,_0x4aa536)=>{const _0x3ce19c=_0x28af54;try{let _0x292d9c=_0x341559[_0x3ce19c(0x233)]['spaceId'],_0xc4dabb=_0x341559['query']['indexId'],_0x2d2765=_0x341559[_0x3ce19c(0x233)]['download'],_0x50e0b3=_0x341559[_0x3ce19c(0x233)][_0x3ce19c(0x240)];if(!_0x292d9c||!_0xc4dabb)return _0x341559[_0x3ce19c(0x1de)][_0x3ce19c(0x248)](_0x5e1d2c,_0x3ce19c(0x193));let _0x415425=dbPrivateSpaceTable[_0x3ce19c(0x24f)](_0x341559['app'][_0x3ce19c(0x206)],_0x292d9c);if(!_0x415425)return _0x341559[_0x3ce19c(0x1de)][_0x3ce19c(0x248)](_0x5e1d2c,_0x3ce19c(0x1df));getPwdFromToken(_0x341559,_0x5e1d2c,_0x1ccd7f=>{const _0x1103f2=_0x3ce19c;let _0x375759=getPrivateIndexDb(_0x415425[_0x1103f2(0x1a9)]),_0x1f1dcd=dbPrivateSpaceTable['getIndexById'](_0x375759,_0xc4dabb);if(!_0x1f1dcd)return _0x5e1d2c['status'](0x194)[_0x1103f2(0x1ba)]();let _0x3b6119='';function _0x107c34(_0x94e57a){const _0x2b68bf=_0x1103f2;return path[_0x2b68bf(0x1a7)](_0x94e57a[_0x2b68bf(0x1aa)](/[\\/]/g,path['sep']));}_0x50e0b3=='tiny'?_0x3b6119=path[_0x1103f2(0x1c8)](path[_0x1103f2(0x1a7)](path[_0x1103f2(0x1b8)](_0x415425[_0x1103f2(0x1a9)],_0x107c34(_0x1f1dcd['tiny_path'])))):_0x3b6119=path[_0x1103f2(0x1c8)](path[_0x1103f2(0x1a7)](path[_0x1103f2(0x1b8)](_0x415425[_0x1103f2(0x1a9)],_0x107c34(_0x1f1dcd[_0x1103f2(0x1cd)]))));if(_0x2d2765==0x1)try{let _0x3522e5=Buffer[_0x1103f2(0x1dd)](_0x1f1dcd[_0x1103f2(0x237)],_0x1103f2(0x232))[_0x1103f2(0x1d2)]();const _0x5a2387=encodeURIComponent(_0x3522e5)[_0x1103f2(0x1aa)](/%([0-9A-F]{2})/g,(_0x1fc27d,_0x314958)=>'%'+_0x314958['toUpperCase']());_0x5e1d2c['setHeader'](_0x1103f2(0x231),_0x1103f2(0x1a8)+_0x5a2387);}catch(_0x5a7cf6){console[_0x1103f2(0x254)](_0x5a7cf6);}fs['stat'](_0x3b6119,(_0x4285c2,_0x39ed80)=>{const _0x579417=_0x1103f2;if(_0x4285c2)return console['log'](_0x579417(0x202),_0x3b6119),_0x5e1d2c[_0x579417(0x1cf)](0x194)['end']();if(_0x3b6119[_0x579417(0x223)](_0x579417(0x217))==-0x1){let _0x3ec255=dbPrivateSpaceTable['updateIndexField'](_0x375759,_0x579417(0x194),new Date()[_0x579417(0x1c0)](),_0xc4dabb);}if(sharpUtil[_0x579417(0x23b)](_0x1f1dcd[_0x579417(0x204)])&&_0x50e0b3!=_0x579417(0x217)){let _0x3147c4=cryptoUtils[_0x579417(0x200)](_0x1ccd7f,_0x3b6119);fileUtil[_0x579417(0x221)](_0x3147c4)[_0x579417(0x199)](_0x57d0ce=>{const _0xd885d2=_0x579417;sharpUtil[_0xd885d2(0x1ff)](_0x1f1dcd[_0xd885d2(0x204)],_0x57d0ce,(_0x1a71c8,_0x4c75e2,_0x1a7116)=>{const _0x4172db=_0xd885d2;sharpUtil['ifExtIsSpecialFormat'](_0x1f1dcd[_0x4172db(0x204)][_0x4172db(0x1ee)]())?sharpUtil[_0x4172db(0x195)](_0x1a71c8,null,![],null,_0x4172db(0x1f5),null,_0x4b1142=>{const _0x467e90=_0x4172db;_0x5e1d2c['send'](Buffer[_0x467e90(0x1dd)](_0x4b1142));},_0x27047c=>{const _0x5eb763=_0x4172db;return console[_0x5eb763(0x254)](_0x27047c),_0x5e1d2c['status'](0x194)['end']();},_0x4c75e2,_0x1a7116):typeof _0x1a71c8=='string'?(_0x5e1d2c[_0x4172db(0x1ca)](_0x1a71c8),_0x5e1d2c['on'](_0x4172db(0x238),()=>{_0x4c75e2&&fs['rm'](_0x1a71c8,_0x3ac903=>{});})):_0x5e1d2c['send'](_0x1a71c8);});});}else cryptoUtils[_0x579417(0x23f)](_0x1ccd7f,_0x3b6119,_0x5e1d2c,_0x5e1d2c);return;});});}catch(_0xcff8a){return console[_0x3ce19c(0x254)](_0xcff8a),_0x5e1d2c['status'](0x194)[_0x3ce19c(0x1ba)]();}}),router['post'](_0x28af54(0x216),(_0x43553e,_0x3be8f0,_0x3b2176)=>{const _0x5d91f8=_0x28af54;try{return dbPrivateSpaceTable[_0x5d91f8(0x20d)](_0x43553e[_0x5d91f8(0x1de)][_0x5d91f8(0x206)],_0x43553e[_0x5d91f8(0x1a1)]['spaceId']),_0x3be8f0[_0x5d91f8(0x1cf)](0xc8)[_0x5d91f8(0x1ba)]();}catch(_0x99a89){return console[_0x5d91f8(0x254)](_0x99a89),_0x3be8f0[_0x5d91f8(0x1cf)](0x194)[_0x5d91f8(0x1ba)]();}}),module['exports']=router;