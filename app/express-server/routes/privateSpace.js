const _0x2280f3=_0x3ca3;(function(_0xa16cb4,_0x1c1257){const _0x4ed99c=_0x3ca3,_0x2561da=_0xa16cb4();while(!![]){try{const _0x54fa42=parseInt(_0x4ed99c(0x238))/0x1*(parseInt(_0x4ed99c(0x1fa))/0x2)+-parseInt(_0x4ed99c(0x1fd))/0x3+parseInt(_0x4ed99c(0x184))/0x4+-parseInt(_0x4ed99c(0x18e))/0x5+parseInt(_0x4ed99c(0x1f0))/0x6*(-parseInt(_0x4ed99c(0x1df))/0x7)+parseInt(_0x4ed99c(0x1a4))/0x8+parseInt(_0x4ed99c(0x20b))/0x9;if(_0x54fa42===_0x1c1257)break;else _0x2561da['push'](_0x2561da['shift']());}catch(_0x314835){_0x2561da['push'](_0x2561da['shift']());}}}(_0x2f32,0x1f860));let express=require(_0x2280f3(0x1ab)),router=express['Router']();const Database=require(_0x2280f3(0x244));let dbPrivateSpaceTable=require(_0x2280f3(0x1f4)),path=require(_0x2280f3(0x197)),fs=require('fs'),cryptoUtils=require('../utils/cryptoUtils');function _0x2f32(){const _0x285ab3=['folderNotExist','private.passwordIncorrect','/getFileList','currentUser','updateIndexField','temp','/addPrivateSpace','over','log','sendFile','check_time','178tOEvbH','folder_path','error','parse','private.fileNameTooLong','../utils/uploadUtils','imgTypeList','private.spaceConfigFileBroken','START_WORKER_BG_TASK','normalize','toLowerCase','dbOther','better-sqlite3','decryptString','createToken','includes','getAll','pragma','../../utils/videoStreamUtil','spaceId','898580vOQCas','fileType','utf-8','R_OK','catch','err','tiny','stat','CreateDate','getTime','352030VxdpOJ','journal_mode\x20=\x20WAL','space\x20id\x20is\x20null','/exportSpace','\x20limit\x20','private.spaceNameTooLong','streamToBuffer','checkStr','sharpDealImg','path','image','desc','targetFolderPath','other','lastInsertRowid','../../utils/transCodeUtil','video','indexId','undefined','Content-Disposition','not\x20found','access','783472OpNrTr','private.configFileReadFail','createIndex','private.noExist','delete','create_uid','create','express','mkdir','/exitSpaceId','get','exifr','decryptFileGetStream','space\x20id\x20is\x20invalid','spacePwd','\x20WHERE\x20file_type=\x27','json','exports','send','\x20offset\x20','FFmpeg','../../myConfig/config','noWritePermission','tiny_path','end','private.uploadErrTryAgain','attachment;\x20filename*=UTF-8\x27\x27','.mov','ext','decryptFile','concat','rawImgTypeList','startsWith','sha256','W_OK','tiny-','PassThrough','UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?','.DS_Store','data','offsetCount','/importSpace','error\x20space\x20id','unlink','\x27\x20where\x20id=','overMode','type','run','status','ifExtIsSpecialFormat','getIndexByWhere','getById','../../libs/nasTrans','streams','operationFail','space_token','spaceName','getBySpaceName','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','123193lcJLQW','orderType','post','destination','../utils/sharpUtils','needEmptyFolderPrivateSpace','genImageTinyFile','genVideoTinyFile','getVideoOriginalTime','encryptFile','/regularUpload','size','private.onlyAdminCanDelete','tokenPwdEncryptKey','createReadStream','app','from','66bMWhtk','encodeFilename','deleteSpaceToken','updateSpaceName','../../db/dbPrivateSpaceTable','.mp4','prepare','ids','savePath','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','652JGBJTl','query','constants','717747NYUNrG','length','stringify','space/index\x20id\x20is\x20null','resolve','dbPath','getIndexById','headers','getDurationFromStream','all','returnErrMsg','/getAllSpace','orderField','download','2265813sXmjQp','privateSpaceKey','replace','string','private.spaceNameCantNull','private.hasSameNameSpace','then','pwd','join','base64','UPDATE\x20private_space_index\x20SET\x20original_time=\x27','filename','getPrivateDbPath','toString','../utils/privateSpaceUtils','../utils/fileUtils','is_admin','uploadFile','close','message','encryptString','nascabisthebest','stream','getTokenObjByToken','body','push','pipe','spaceToken','changes','/deleteSpace','private.spacePwdGtFour','folderPath','encryptFileFromInputPipe','extname'];_0x2f32=function(){return _0x285ab3;};return _0x2f32();}function _0x3ca3(_0x4c2d76,_0x3f98bb){const _0x2f3274=_0x2f32();return _0x3ca3=function(_0x3ca360,_0x373938){_0x3ca360=_0x3ca360-0x183;let _0x28bbca=_0x2f3274[_0x3ca360];return _0x28bbca;},_0x3ca3(_0x4c2d76,_0x3f98bb);}const config=require(_0x2280f3(0x1b9));let privateSpaceUtils=require(_0x2280f3(0x219));var faststart=require('../utils/faststart'),exifUtil=require(_0x2280f3(0x1af));let uploadUtil=require(_0x2280f3(0x23d));const PassThrough=require(_0x2280f3(0x221))[_0x2280f3(0x1c8)],{Readable}=require(_0x2280f3(0x221));let sha256=require(_0x2280f3(0x1c5));const videoStreamUtil=require(_0x2280f3(0x24a));let fileUtil=require(_0x2280f3(0x21a));const folderSignString=_0x2280f3(0x220),folderSignFileName='nascabconfigenc',configFolderName='nascabconfig',noCheckFileList=[_0x2280f3(0x1ca)];let FFmpeg=require(_0x2280f3(0x1d8))[_0x2280f3(0x1b8)];const uploadPrivateUtil=require('../utils/uploadPrivateUtils'),privateSharpUtil=require(_0x2280f3(0x219)),sharpUtil=require(_0x2280f3(0x1e3)),transCodeUtil=require(_0x2280f3(0x19d));let dbArr=[];function checkSpaceId(_0x1fbf19,_0x5221ee){const _0x31765e=_0x2280f3;let _0x3d46d6=_0x1fbf19[_0x31765e(0x223)][_0x31765e(0x183)]||_0x1fbf19[_0x31765e(0x1fb)][_0x31765e(0x183)];if(!_0x3d46d6)return _0x1fbf19['app'][_0x31765e(0x207)](_0x5221ee,_0x31765e(0x190));let _0x214932=dbPrivateSpaceTable[_0x31765e(0x1d7)](_0x1fbf19[_0x31765e(0x1ee)][_0x31765e(0x243)],_0x3d46d6);if(!_0x214932)return _0x1fbf19[_0x31765e(0x1ee)][_0x31765e(0x207)](_0x5221ee,_0x31765e(0x1b1));return!![];}function checkSpaceName(_0x1b438e,_0x50c0c7,_0x544877){const _0x150b03=_0x2280f3;if(!_0x544877)return _0x1b438e[_0x150b03(0x1ee)][_0x150b03(0x207)](_0x50c0c7,_0x50c0c7['__'](_0x150b03(0x20f)));if(_0x544877[_0x150b03(0x1fe)]>0x1e)return _0x1b438e[_0x150b03(0x1ee)][_0x150b03(0x207)](_0x50c0c7,_0x50c0c7['__'](_0x150b03(0x193)));return!![];}function getPrivateIndexDb(_0x423a4a){const _0x9fcdea=_0x2280f3;let _0x36b9ff=config[_0x9fcdea(0x217)](_0x423a4a);for(let _0x46b6d9 in dbArr){if(dbArr[_0x46b6d9][_0x9fcdea(0x202)]==_0x36b9ff)return dbArr[_0x46b6d9]['db'];}let _0x71b372=new Database(_0x36b9ff,{});return _0x71b372[_0x9fcdea(0x249)](_0x9fcdea(0x18f)),dbArr['push']({'dbPath':_0x36b9ff,'db':_0x71b372}),_0x71b372;}router[_0x2280f3(0x1e1)](_0x2280f3(0x233),(_0x3f6135,_0x1dd326,_0xe8b071)=>{const _0x5648f6=_0x2280f3;let _0x187b5f=_0x3f6135[_0x5648f6(0x223)][_0x5648f6(0x22a)],_0x5e09ba=_0x3f6135[_0x5648f6(0x223)]['spaceName'],_0x407b77=_0x3f6135[_0x5648f6(0x230)],_0x1a1bd0=_0x3f6135['body'][_0x5648f6(0x1b2)];if(checkSpaceName(_0x3f6135,_0x1dd326,_0x5e09ba)!==!![])return;if(!_0x1a1bd0||_0x1a1bd0[_0x5648f6(0x1fe)]<0x4)return _0x3f6135[_0x5648f6(0x1ee)][_0x5648f6(0x207)](_0x1dd326,_0x1dd326['__'](_0x5648f6(0x229)));function _0x3cbb67(){return new Promise((_0x31405f,_0x4b3035)=>{const _0x23a107=_0x3ca3;fs[_0x23a107(0x18b)](_0x187b5f,(_0x1e04d4,_0x3d7110)=>{const _0x57a70f=_0x23a107;if(_0x1e04d4)return _0x4b3035(_0x1dd326['__'](_0x57a70f(0x1e4)));if(_0x3d7110['size']>0x400*0x400*0x400)return _0x3f6135[_0x57a70f(0x1ee)][_0x57a70f(0x207)](_0x1dd326,_0x1dd326['__'](_0x57a70f(0x1e4)));fs['readdir'](_0x187b5f,(_0x188fc7,_0x50d8d3)=>{const _0x522a1b=_0x57a70f;for(let _0x2995be of _0x50d8d3){if(noCheckFileList[_0x522a1b(0x247)](_0x2995be)||_0x2995be[_0x522a1b(0x1c4)]('.')||_0x2995be['startsWith']('@'))continue;return _0x4b3035(_0x1dd326['__'](_0x522a1b(0x1e4)));}_0x31405f();});});});}fs[_0x5648f6(0x1a3)](_0x187b5f,fs[_0x5648f6(0x1fc)][_0x5648f6(0x187)]|fs[_0x5648f6(0x1fc)][_0x5648f6(0x1c6)],_0x3ffe39=>{const _0x4e4c5a=_0x5648f6;if(_0x3ffe39)return _0x3f6135[_0x4e4c5a(0x1ee)][_0x4e4c5a(0x207)](_0x1dd326,_0x1dd326['__']('noWritePermission'));_0x3cbb67()['then'](()=>{const _0x71dae3=_0x4e4c5a;let _0x2069a7=dbPrivateSpaceTable[_0x71dae3(0x1dd)](_0x3f6135[_0x71dae3(0x1ee)][_0x71dae3(0x243)],_0x5e09ba);if(_0x2069a7)return _0x3f6135['app'][_0x71dae3(0x207)](_0x1dd326,_0x1dd326['__']('private.hasSameNameSpace'));let _0x4c1581=path[_0x71dae3(0x213)](_0x187b5f,configFolderName);fs[_0x71dae3(0x1ac)](_0x4c1581,{'recursive':!![]},_0x2de0bb=>{const _0x502b9f=_0x71dae3;if(_0x2de0bb)return _0x3f6135[_0x502b9f(0x1ee)]['returnErrMsg'](_0x1dd326,_0x1dd326['__'](_0x502b9f(0x1da))+JSON['stringify'](_0x2de0bb));let _0x1db273=getPrivateIndexDb(_0x187b5f);dbPrivateSpaceTable['createIndexDb'](_0x1db273,_0x187b5f),cryptoUtils[_0x502b9f(0x21f)](_0x1a1bd0,folderSignString)[_0x502b9f(0x211)](_0x3953f8=>{const _0x528a40=_0x502b9f;let _0x3ac416=path[_0x528a40(0x213)](_0x4c1581,folderSignFileName);fs['writeFile'](_0x3ac416,_0x3953f8,_0x379f7f=>{const _0x45e383=_0x528a40;if(_0x379f7f)return _0x3f6135[_0x45e383(0x1ee)][_0x45e383(0x207)](_0x1dd326,_0x1dd326['__']('operationFail')+JSON[_0x45e383(0x1ff)](_0x379f7f));return dbPrivateSpaceTable[_0x45e383(0x1aa)](_0x3f6135['app'][_0x45e383(0x243)],{'folder_path':_0x187b5f,'space_name':_0x5e09ba,'create_uid':_0x407b77['id']}),_0x1dd326[_0x45e383(0x1b4)]({'code':0x0});});})[_0x502b9f(0x188)](_0x544151=>{const _0x15210b=_0x502b9f;return console[_0x15210b(0x235)]('error',_0x544151),_0x3f6135[_0x15210b(0x1ee)][_0x15210b(0x207)](_0x1dd326,_0x1dd326['__'](_0x15210b(0x1da))+JSON[_0x15210b(0x1ff)](_0x544151));});});})[_0x4e4c5a(0x188)](_0x319b8e=>{const _0x231d83=_0x4e4c5a;return _0x3f6135[_0x231d83(0x1ee)][_0x231d83(0x207)](_0x1dd326,_0x319b8e);});});}),router[_0x2280f3(0x1e1)](_0x2280f3(0x208),(_0x37223c,_0x6d219d,_0x4dd02f)=>{const _0x3e6d42=_0x2280f3;let _0x163646=[];return _0x37223c['currentUser']['is_admin']==0x1?_0x163646=dbPrivateSpaceTable[_0x3e6d42(0x248)](_0x37223c[_0x3e6d42(0x1ee)][_0x3e6d42(0x243)]):_0x163646=dbPrivateSpaceTable['getAllByUid'](_0x37223c[_0x3e6d42(0x1ee)]['dbOther'],_0x37223c['currentUser']['id']),_0x6d219d[_0x3e6d42(0x1b4)]({'code':0x0,'data':_0x163646});});function checkSpacePwd(_0x1d465e,_0x18b78f,_0x3fecff){return new Promise((_0xd1d315,_0x42433f)=>{const _0x289a24=_0x3ca3;_0x18b78f=Buffer[_0x289a24(0x1ef)](_0x18b78f,_0x289a24(0x214))['toString']();let _0x2716be=path[_0x289a24(0x213)](_0x3fecff,configFolderName,folderSignFileName);fs[_0x289a24(0x18b)](_0x2716be,(_0x27e8b9,_0x4fb58d)=>{const _0x5828bf=_0x289a24;if(_0x27e8b9)return _0x42433f(_0x1d465e['__'](_0x5828bf(0x1a5)));fs['readFile'](_0x2716be,_0x5828bf(0x186),(_0x3b46d1,_0x482b5c)=>{const _0x211168=_0x5828bf;if(_0x3b46d1)return _0x42433f(_0x1d465e['__']('private.configFileReadFail'));else cryptoUtils['decryptString'](_0x18b78f,_0x482b5c)['then'](_0x580c29=>{return _0x580c29==folderSignString?_0xd1d315(_0x18b78f):_0x42433f(_0x1d465e['__']('private.passwordIncorrect'));})[_0x211168(0x188)](_0x29dd77=>{const _0x5b1759=_0x211168;return console['log']('error',_0x29dd77),_0x42433f(_0x1d465e['__'](_0x5b1759(0x22e)));});});});});}router[_0x2280f3(0x1e1)]('/checkPwd',(_0x2c7006,_0x5633ac,_0x527759)=>{const _0x19a756=_0x2280f3;let _0x2dbb3f=_0x2c7006[_0x19a756(0x223)][_0x19a756(0x195)],_0x208903=_0x2c7006['body'][_0x19a756(0x183)],_0x28855c=dbPrivateSpaceTable[_0x19a756(0x1d7)](_0x2c7006['app'][_0x19a756(0x243)],_0x208903);if(!_0x28855c)return _0x2c7006['app'][_0x19a756(0x207)](_0x5633ac,_0x19a756(0x1ce));fs[_0x19a756(0x18b)](_0x28855c[_0x19a756(0x239)],(_0x50a9f2,_0x2b7235)=>{const _0x33954b=_0x19a756;if(_0x50a9f2)return _0x2c7006[_0x33954b(0x1ee)]['returnErrMsg'](_0x5633ac,_0x5633ac['__']('private.spaceFolderNotExist'));checkSpacePwd(_0x5633ac,_0x2dbb3f,_0x28855c[_0x33954b(0x239)])[_0x33954b(0x211)](_0x247365=>{const _0x2759d3=_0x33954b;let _0x746799=sha256(new Date()[_0x2759d3(0x18d)]()+_0x208903+_0x247365);cryptoUtils[_0x2759d3(0x21f)](config['tokenPwdEncryptKey'],_0x247365)['then'](_0x1f5522=>{const _0x6520fa=_0x2759d3;return dbPrivateSpaceTable[_0x6520fa(0x246)](_0x2c7006[_0x6520fa(0x1ee)][_0x6520fa(0x243)],{'space_id':_0x208903,'pwd':_0x1f5522,'token':_0x746799}),_0x5633ac['json']({'code':0x0,'token':_0x746799});});})[_0x33954b(0x188)](_0x1615d3=>{const _0x3ee430=_0x33954b;return console[_0x3ee430(0x235)](_0x3ee430(0x23a),_0x1615d3),_0x2c7006[_0x3ee430(0x1ee)][_0x3ee430(0x207)](_0x5633ac,_0x1615d3);});});});function ffprobeSync(_0x4532e1){return new Promise((_0x4d2e66,_0xe003a)=>{const _0x4ea3b4=_0x3ca3;try{FFmpeg(transCodeUtil['dealFFmpegPath'](_0x4532e1))['ffprobe']((_0x3e2994,_0xa4614)=>{_0x3e2994?_0xe003a(_0x3e2994):_0x4d2e66(_0xa4614);});}catch(_0x37cbef){console[_0x4ea3b4(0x235)](_0x4ea3b4(0x23a),_0x37cbef),_0xe003a(_0x37cbef);}});}function deleteFile(_0x3a600e){fs['rm'](_0x3a600e,{'maxRetries':0xa,'retryDelay':0x3e8},_0x1df605=>{});}function uploadFail(_0x34ff2d,_0x4f8a18,_0x29a7ee,_0x5667c6){const _0x162892=_0x2280f3;return deleteFile(_0x4f8a18),_0x29a7ee[_0x162892(0x1ee)][_0x162892(0x207)](_0x5667c6,_0x5667c6['__'](_0x162892(0x1bd)));}function dealUploadImageOrFile(_0x20d2c1,_0xc27830,_0xc11c82,_0x41432b,_0x5aab43,_0x1203f0,_0x55cbf1,_0x3115a7,_0x493a9a){const _0x3c306c=_0x2280f3;uploadPrivateUtil[_0x3c306c(0x21c)](_0xc11c82,_0x41432b,_0x5aab43,_0x1203f0,_0x4a70de=>{const _0x342b20=_0x3c306c;let _0x56f819=_0x4a70de['path'],_0x5acc96=cryptoUtils['decryptFileGetStream'](_0x1203f0,_0x56f819),_0x4f64ab=dbPrivateSpaceTable[_0x342b20(0x1a6)](_0x20d2c1,{'filename':new Buffer[(_0x342b20(0x1ef))](_0x3115a7)['toString'](_0x342b20(0x214)),'filename_enc':_0x5aab43,'file_type':_0x55cbf1,'ext':_0x493a9a});if(_0x4f64ab['changes']<0x1)return uploadFail(_0x20d2c1,_0x56f819,_0xc11c82,_0x41432b);let _0x489c18=_0x4f64ab[_0x342b20(0x19c)];_0x41432b[_0x342b20(0x1b4)]({'code':0x0});let _0x4231d1=new Date()[_0x342b20(0x18d)]();if(_0x55cbf1==_0x342b20(0x198)){var _0x546991=[];let _0x2836ac=new PassThrough()[_0x342b20(0x225)](_0x5acc96);_0x2836ac['on'](_0x342b20(0x1cb),function(_0x458fc1){const _0x1b5def=_0x342b20;_0x546991[_0x1b5def(0x224)](_0x458fc1);}),_0x2836ac['on'](_0x342b20(0x1bc),function(){const _0x5be996=_0x342b20;var _0x113c27=Buffer[_0x5be996(0x1c2)](_0x546991);function _0x5bbdec(){const _0x4ee155=_0x5be996;exifUtil[_0x4ee155(0x23b)](_0x113c27)[_0x4ee155(0x211)](_0xbcbd0f=>{const _0xf20040=_0x4ee155;if(_0xbcbd0f){let _0xb50524=_0xbcbd0f['DateTimeOriginal'];_0xbcbd0f[_0xf20040(0x18c)]&&!_0xb50524&&(_0xb50524=_0xbcbd0f[_0xf20040(0x18c)]),_0xb50524&&(_0x4231d1=new Date(_0xb50524)[_0xf20040(0x18d)](),_0x20d2c1[_0xf20040(0x1f6)](_0xf20040(0x215)+_0x4231d1+_0xf20040(0x1d0)+_0x489c18)[_0xf20040(0x1d3)]());}})[_0x4ee155(0x188)](_0x3af0e3=>{});}privateSpaceUtils[_0x5be996(0x1e5)](_0x493a9a,_0x113c27,_0x537d4a=>{const _0x283208=_0x5be996,_0x5b0c42=Readable[_0x283208(0x1ef)](_0x537d4a);let _0x309689=path[_0x283208(0x213)](_0xc27830,_0x5aab43);cryptoUtils[_0x283208(0x22b)](_0x1203f0,_0x5b0c42,_0x309689)[_0x283208(0x211)](_0xe00463=>{const _0x22980c=_0x283208;let _0x2f424f=path[_0x22980c(0x213)](configFolderName,_0x22980c(0x18a),_0x5aab43);_0x20d2c1[_0x22980c(0x1f6)](_0x22980c(0x1de)+_0x2f424f+_0x22980c(0x1d0)+_0x489c18)[_0x22980c(0x1d3)](),_0x5bbdec();});},_0x39d34a=>{_0x5bbdec();});});}});}function dealUploadVideo(_0x569c3f,_0xa640b3,_0x42904b,_0x10e4f3,_0x59fc66,_0x37011d,_0xe3e024,_0x3291b3,_0x2bc696,_0x34c95d,_0x472ab7){const _0x399814=_0x2280f3;_0x59fc66[_0x399814(0x1fb)]['savePath']=_0x10e4f3,_0x59fc66[_0x399814(0x1fb)][_0x399814(0x1d1)]=_0x399814(0x234),uploadUtil['uploadFile'](_0x59fc66,_0x37011d,![],!![],![],_0x11f5a7=>{const _0xc844c=_0x399814;let _0x26c437=_0x11f5a7[_0xc844c(0x197)],_0x2dd8ca=path['join'](_0x11f5a7[_0xc844c(0x1e2)]);function _0x21f32f(_0x1e3e4d){const _0x37c3b3=_0xc844c;ffprobeSync(_0x26c437)['then'](_0x53591b=>{const _0x3c69fb=_0x3ca3;let _0x1e5753=0x0;_0x1e5753=videoStreamUtil[_0x3c69fb(0x205)](_0x53591b);let _0x3ff22c=JSON[_0x3c69fb(0x1ff)](_0x53591b[_0x3c69fb(0x1d9)]),_0x5aca5a=videoStreamUtil[_0x3c69fb(0x1e7)](_0x53591b);fs['stat'](_0x26c437,(_0x2728ee,_0x12b4c9)=>{const _0x46b8d8=_0x3c69fb;if(_0x2728ee){deleteFile(_0x26c437);return;}let _0x4daa66=_0x46b8d8(0x1c9);_0x569c3f[_0x46b8d8(0x1f6)](_0x4daa66)['run'](_0x5aca5a,parseInt(_0x1e5753),_0x12b4c9[_0x46b8d8(0x1ea)],_0x3ff22c,_0x1e3e4d);let _0x3517af=_0x46b8d8(0x1c7)+Buffer['from'](_0x34c95d)[_0x46b8d8(0x218)]('base64');privateSpaceUtils[_0x46b8d8(0x1e6)](_0x26c437,_0x2dd8ca,_0x3517af,_0x571f08=>{const _0x17ed67=_0x46b8d8;fs[_0x17ed67(0x18b)](_0x571f08,(_0x17845e,_0x4d2166)=>{const _0x1b3964=_0x17ed67;if(_0x17845e){deleteFile(_0x26c437);return;}let _0x1bfd9a=path['join'](_0x42904b,_0xe3e024);cryptoUtils['encryptFile'](_0x3291b3,_0x571f08,_0x1bfd9a)[_0x1b3964(0x211)](_0x48608b=>{const _0x170d6=_0x1b3964;let _0x2c92bb=path[_0x170d6(0x213)](configFolderName,_0x170d6(0x18a),_0xe3e024);_0x569c3f['prepare'](_0x170d6(0x1de)+_0x2c92bb+_0x170d6(0x1d0)+_0x1e3e4d)['run'](),deleteFile(_0x571f08),deleteFile(_0x26c437);});});},_0x2b2480=>{deleteFile(_0x26c437);});});})[_0x37c3b3(0x188)](_0x9e0284=>{deleteFile(_0x26c437);});}function _0x20c591(){const _0x8ed027=_0xc844c;let _0x507b5c=dbPrivateSpaceTable[_0x8ed027(0x1a6)](_0x569c3f,{'filename':new Buffer[(_0x8ed027(0x1ef))](_0x34c95d)[_0x8ed027(0x218)]('base64'),'filename_enc':_0xe3e024,'file_type':_0x2bc696,'ext':_0x472ab7});return _0x507b5c[_0x8ed027(0x227)]<0x1?uploadFail(_0x569c3f,_0x26c437,_0x59fc66,_0x37011d):(_0x21f32f(_0x507b5c[_0x8ed027(0x19c)]),_0x37011d[_0x8ed027(0x1b4)]({'code':0x0}));}function _0x2f93bb(_0x448f57,_0x252659,_0x556574){const _0xcf7133=_0xc844c;cryptoUtils[_0xcf7133(0x1e8)](_0x3291b3,_0x448f57,_0x252659)[_0xcf7133(0x211)](_0x4f0f1d=>{_0x556574(_0x4f0f1d);})[_0xcf7133(0x188)](_0xf18d01=>{console['log'](_0xf18d01),uploadFail(_0x569c3f,_0x448f57,_0x59fc66,_0x37011d);});}let _0x2ad422=path[_0xc844c(0x213)](_0xa640b3['folder_path'],_0xe3e024);if(_0x472ab7==_0xc844c(0x1f5)||_0x472ab7==_0xc844c(0x1bf)){var _0x24b705=faststart[_0xc844c(0x1ed)](_0x26c437,{'errorCallBack':_0x2a79d9=>{_0x2f93bb(_0x26c437,_0x2ad422,_0x20c591);}});_0x24b705['on'](_0xc844c(0x21d),function(){_0x24b705['destroy']();}),cryptoUtils[_0xc844c(0x22b)](_0x3291b3,_0x24b705,_0x2ad422)[_0xc844c(0x211)](_0x4357ba=>{_0x20c591();})[_0xc844c(0x188)](_0x1d24ee=>{const _0x2fc0b2=_0xc844c;console[_0x2fc0b2(0x235)](_0x2fc0b2(0x23a),_0x1d24ee),uploadFail(_0x569c3f,_0x26c437,_0x59fc66,_0x37011d);});}else _0x2f93bb(_0x26c437,_0x2ad422,_0x20c591);});}router[_0x2280f3(0x1e1)](_0x2280f3(0x1e9),function(_0x4a70f2,_0x1069d1,_0xc949ff){const _0x41bb54=_0x2280f3;let _0x593573=_0x4a70f2[_0x41bb54(0x1fb)][_0x41bb54(0x183)]||_0x4a70f2[_0x41bb54(0x223)]['spaceId']||_0x4a70f2[_0x41bb54(0x204)]['space_id'],_0x3be4=_0x4a70f2[_0x41bb54(0x1fb)]['filename']||_0x4a70f2['headers'][_0x41bb54(0x216)],_0x259550=decodeURIComponent(_0x3be4);_0x4a70f2[_0x41bb54(0x1fb)][_0x41bb54(0x1f1)]&&(_0x259550=fileUtil['decodePath'](_0x4a70f2[_0x41bb54(0x1fb)][_0x41bb54(0x1f1)])),getPwdFromToken(_0x4a70f2,_0x1069d1,_0x4ae501=>{const _0x20109c=_0x41bb54;let _0x2bcce2=dbPrivateSpaceTable[_0x20109c(0x1d7)](_0x4a70f2[_0x20109c(0x1ee)][_0x20109c(0x243)],_0x593573);if(!_0x2bcce2)return _0x4a70f2[_0x20109c(0x1ee)][_0x20109c(0x207)](_0x1069d1,_0x1069d1['__'](_0x20109c(0x1a7)));_0x4a70f2[_0x20109c(0x1fb)][_0x20109c(0x1f8)]=_0x2bcce2[_0x20109c(0x239)];let _0x5f2802=getPrivateIndexDb(_0x2bcce2[_0x20109c(0x239)]),_0x4f1b8d=dbPrivateSpaceTable['getIndexByFileName'](_0x5f2802,new Buffer[(_0x20109c(0x1ef))](_0x259550)[_0x20109c(0x218)]('base64'));if(_0x4f1b8d)return _0x4a70f2[_0x20109c(0x1ee)]['returnErrMsg'](_0x1069d1,_0x1069d1['__']('private.alreadyHasSameNameFile'));let _0x1b7463=path[_0x20109c(0x22c)](_0x259550)?path['extname'](_0x259550)[_0x20109c(0x242)]():null,_0x372c1d=_0x20109c(0x19b);if(_0x1b7463){if(config[_0x20109c(0x23e)][_0x20109c(0x247)](_0x1b7463[_0x20109c(0x242)]())||config[_0x20109c(0x1c3)][_0x20109c(0x247)](_0x1b7463['toLowerCase']()))_0x372c1d=_0x20109c(0x198);else config['videoTypeList'][_0x20109c(0x247)](_0x1b7463[_0x20109c(0x242)]())&&(_0x372c1d=_0x20109c(0x19e));}let _0x22c695=path[_0x20109c(0x213)](_0x2bcce2[_0x20109c(0x239)],configFolderName,_0x20109c(0x18a)),_0x56d7aa=path[_0x20109c(0x213)](_0x2bcce2[_0x20109c(0x239)],configFolderName,_0x20109c(0x232));function _0x9b3f9c(){const _0xdccfa9=_0x20109c;cryptoUtils[_0xdccfa9(0x21f)](_0x4ae501,_0x259550)[_0xdccfa9(0x211)](_0x1e658c=>{const _0x5476b0=_0xdccfa9;if(_0x1e658c[_0x5476b0(0x1fe)]>0xf0)return _0x4a70f2[_0x5476b0(0x1ee)][_0x5476b0(0x207)](_0x1069d1,_0x1069d1['__'](_0x5476b0(0x23c)));_0x372c1d==_0x5476b0(0x19e)?dealUploadVideo(_0x5f2802,_0x2bcce2,_0x22c695,_0x56d7aa,_0x4a70f2,_0x1069d1,_0x1e658c,_0x4ae501,_0x372c1d,_0x259550,_0x1b7463):dealUploadImageOrFile(_0x5f2802,_0x22c695,_0x4a70f2,_0x1069d1,_0x1e658c,_0x4ae501,_0x372c1d,_0x259550,_0x1b7463);});}fs[_0x20109c(0x18b)](_0x22c695,(_0x366026,_0x1a2ec3)=>{const _0x3123f4=_0x20109c;function _0x27e21f(){const _0x86bdc3=_0x3ca3;fs[_0x86bdc3(0x18b)](_0x56d7aa,(_0x38df2d,_0x275961)=>{const _0x309916=_0x86bdc3;_0x38df2d?fs[_0x309916(0x1ac)](_0x56d7aa,{'recursive':!![]},_0x1d835f=>{_0x9b3f9c();}):_0x9b3f9c();});}_0x366026?fs[_0x3123f4(0x1ac)](_0x22c695,{'recursive':!![]},_0x45aae8=>{_0x27e21f();}):_0x27e21f();});});}),router[_0x2280f3(0x1e1)](_0x2280f3(0x1cd),(_0x12c7f3,_0xef4131,_0x14255c)=>{const _0x41344d=_0x2280f3;let _0x55b4be=_0x12c7f3[_0x41344d(0x223)][_0x41344d(0x22a)],_0x431c69=_0x12c7f3[_0x41344d(0x223)][_0x41344d(0x1dc)],_0x37c211=_0x12c7f3[_0x41344d(0x230)],_0x425888=_0x12c7f3[_0x41344d(0x223)][_0x41344d(0x1b2)];if(!_0x431c69)return _0x12c7f3[_0x41344d(0x1ee)][_0x41344d(0x207)](_0xef4131,_0xef4131['__'](_0x41344d(0x20f)));let _0x15fd69=dbPrivateSpaceTable[_0x41344d(0x1dd)](_0x12c7f3['app']['dbOther'],_0x431c69);if(_0x15fd69)return _0x12c7f3[_0x41344d(0x1ee)]['returnErrMsg'](_0xef4131,_0xef4131['__'](_0x41344d(0x210)));if(!_0x425888)return _0x12c7f3[_0x41344d(0x1ee)][_0x41344d(0x207)](_0xef4131,_0xef4131['__'](_0x41344d(0x229)));fs['access'](_0x55b4be,_0x34272c=>{const _0x5bee79=_0x41344d;if(_0x34272c)return _0x12c7f3[_0x5bee79(0x1ee)][_0x5bee79(0x207)](_0xef4131,_0xef4131['__'](_0x5bee79(0x1ba)));checkSpacePwd(_0xef4131,_0x425888,_0x55b4be)[_0x5bee79(0x211)](()=>{const _0x4995b7=_0x5bee79;let _0xe27471=config[_0x4995b7(0x217)](_0x55b4be);fs[_0x4995b7(0x18b)](_0xe27471,(_0x5b7bc2,_0x5dd6b5)=>{const _0x239e23=_0x4995b7;if(_0x5b7bc2)return _0x12c7f3[_0x239e23(0x1ee)][_0x239e23(0x207)](_0xef4131,_0xef4131['__'](_0x239e23(0x23f)));return dbPrivateSpaceTable['create'](_0x12c7f3[_0x239e23(0x1ee)][_0x239e23(0x243)],{'folder_path':_0x55b4be,'space_name':_0x431c69,'create_uid':_0x37c211['id']}),_0xef4131[_0x239e23(0x1b4)]({'code':0x0});});})['catch'](_0x43040e=>{const _0x5b95a1=_0x5bee79;return _0x12c7f3[_0x5b95a1(0x1ee)][_0x5b95a1(0x207)](_0xef4131,_0x43040e);});});}),router[_0x2280f3(0x1e1)](_0x2280f3(0x191),(_0x411ca6,_0x5f5872,_0x3c6c81)=>{const _0x56ed06=_0x2280f3;let _0x6c2399=_0x411ca6['body'][_0x56ed06(0x22a)],_0x2ef4c5=_0x411ca6['body'][_0x56ed06(0x1b2)],_0x2c6747=_0x411ca6[_0x56ed06(0x223)][_0x56ed06(0x19a)];if(!_0x2ef4c5)return _0x411ca6[_0x56ed06(0x1ee)]['returnErrMsg'](_0x5f5872,_0x5f5872['__'](_0x56ed06(0x229)));fs[_0x56ed06(0x1a3)](_0x6c2399,fs['constants'][_0x56ed06(0x187)],_0x3b2ed2=>{const _0x4eb8e3=_0x56ed06;if(_0x3b2ed2)return _0x411ca6[_0x4eb8e3(0x1ee)][_0x4eb8e3(0x207)](_0x5f5872,_0x5f5872['__'](_0x4eb8e3(0x1ba)));fs[_0x4eb8e3(0x1a3)](_0x2c6747,fs[_0x4eb8e3(0x1fc)][_0x4eb8e3(0x1c6)],_0x5e19b8=>{const _0x8cc528=_0x4eb8e3;if(_0x5e19b8)return _0x411ca6['app'][_0x8cc528(0x207)](_0x5f5872,_0x5f5872['__'](_0x8cc528(0x1ba)));function _0x4b2d5f(_0x446f5d){const _0x4a2bc1=_0x8cc528;cryptoUtils[_0x4a2bc1(0x21f)](config[_0x4a2bc1(0x20c)],_0x2ef4c5)[_0x4a2bc1(0x211)](_0x37e90c=>{const _0x1f277c=_0x4a2bc1;return _0x446f5d[_0x1f277c(0x1ee)][_0x1f277c(0x243)][_0x1f277c(0x1f6)](_0x1f277c(0x1f9))[_0x1f277c(0x1d3)]('EXPORT_PRIVATE_SPACE',JSON[_0x1f277c(0x1ff)]({'folderPath':_0x6c2399,'targetFolderPath':_0x2c6747,'spacePwd':_0x37e90c})),process['send']({'type':_0x1f277c(0x240)}),_0x5f5872[_0x1f277c(0x1b4)]({'code':0x0});});}let _0x16fa9c=path[_0x8cc528(0x213)](_0x6c2399,configFolderName,folderSignFileName);fs[_0x8cc528(0x18b)](_0x16fa9c,(_0x5161f9,_0xdd150)=>{const _0x313dbd=_0x8cc528;_0x5161f9?_0x4b2d5f(_0x411ca6):checkSpacePwd(_0x5f5872,_0x2ef4c5,_0x6c2399)[_0x313dbd(0x211)](()=>{_0x4b2d5f(_0x411ca6);})['catch'](_0x309f58=>{const _0x599d33=_0x313dbd;return console[_0x599d33(0x235)](_0x309f58),_0x411ca6[_0x599d33(0x1ee)][_0x599d33(0x207)](_0x5f5872,_0x5f5872['__'](_0x599d33(0x22e)));});});});});}),router[_0x2280f3(0x1e1)]('/deleteSpaceFiles',(_0x3e2042,_0x13c031,_0x54dbc8)=>{const _0x24709a=_0x2280f3;let _0x15f728=_0x3e2042[_0x24709a(0x223)][_0x24709a(0x183)],_0x5b6640=_0x3e2042[_0x24709a(0x223)][_0x24709a(0x1f7)];if(!_0x5b6640||_0x5b6640[_0x24709a(0x1fe)]<0x1)return _0x13c031[_0x24709a(0x1d4)](0x194)[_0x24709a(0x1bc)]();let _0x138e78=dbPrivateSpaceTable[_0x24709a(0x1d7)](_0x3e2042['app'][_0x24709a(0x243)],_0x15f728);if(!_0x138e78)return _0x13c031[_0x24709a(0x1d4)](0x194)[_0x24709a(0x1bc)]();if(_0x3e2042[_0x24709a(0x230)]['is_admin']!=0x1){if(_0x138e78[_0x24709a(0x1a9)]!=_0x3e2042['currentUser']['id'])return _0x13c031[_0x24709a(0x1b4)]({'code':0x1,'message':_0x13c031['__'](_0x24709a(0x1eb))});}try{let _0x2f692b=getPrivateIndexDb(_0x138e78[_0x24709a(0x239)]),_0x562d20=JSON[_0x24709a(0x23b)](_0x5b6640),_0x27e0c3=0x0,_0x1d156b=[],_0x659838=0x0,_0x14f4d6=0x0;if(_0x562d20['length']<0x1)return _0x13c031[_0x24709a(0x1b4)]({'code':0x0,'deleteList':_0x1d156b,'deleteCount':_0x27e0c3,'errCount':_0x659838});for(let _0x497752=0x0;_0x497752<_0x562d20['length'];_0x497752++){let _0x331589=dbPrivateSpaceTable[_0x24709a(0x1d6)](_0x2f692b,'\x20id='+_0x562d20[_0x497752]);if(!_0x331589)return _0x3e2042[_0x24709a(0x1ee)]['returnErrMsg'](_0x13c031,_0x13c031['__'](_0x24709a(0x22d)));let _0x7707d=path['join'](_0x138e78[_0x24709a(0x239)],_0x331589['filename_enc']);if(_0x331589[_0x24709a(0x1bb)]&&_0x331589[_0x24709a(0x1bb)]!=_0x24709a(0x1a0)){let _0x36e0d8=path[_0x24709a(0x213)](_0x138e78['folder_path'],_0x331589[_0x24709a(0x1bb)]);try{fs[_0x24709a(0x1cf)](_0x36e0d8,_0x1190c2=>{});}catch(_0x4f0aab){}}fs[_0x24709a(0x1cf)](_0x7707d,_0x47efe7=>{const _0x389ac9=_0x24709a;_0x14f4d6+=0x1;_0x47efe7?(console['log'](_0x389ac9(0x189),_0x47efe7[_0x389ac9(0x21e)]),_0x659838+=0x1):(_0x27e0c3+=0x1,_0x1d156b[_0x389ac9(0x224)](_0x562d20[_0x497752]));dbPrivateSpaceTable['deleteIndex'](_0x2f692b,_0x562d20[_0x497752]);if(_0x14f4d6==_0x562d20[_0x389ac9(0x1fe)])return _0x13c031['json']({'code':0x0,'deleteList':_0x1d156b,'deleteCount':_0x27e0c3,'errCount':_0x659838});});}}catch(_0x9ae32c){return console[_0x24709a(0x235)](_0x24709a(0x23a),_0x9ae32c),_0x13c031[_0x24709a(0x1b4)]({'code':0x1,'message':JSON[_0x24709a(0x1ff)](_0x9ae32c)});}}),router[_0x2280f3(0x1e1)](_0x2280f3(0x228),(_0x55d4c2,_0x223a7b,_0xcaca42)=>{const _0x5e7cce=_0x2280f3;if(checkSpaceId(_0x55d4c2,_0x223a7b)!==!![])return;let _0x32c0d5=_0x55d4c2[_0x5e7cce(0x223)][_0x5e7cce(0x183)],_0x238306=dbPrivateSpaceTable[_0x5e7cce(0x1d7)](_0x55d4c2['app'][_0x5e7cce(0x243)],_0x32c0d5);if(_0x55d4c2['currentUser'][_0x5e7cce(0x21b)]!=0x1){if(_0x238306[_0x5e7cce(0x1a9)]!=_0x55d4c2[_0x5e7cce(0x230)]['id'])return _0x223a7b[_0x5e7cce(0x1b4)]({'code':0x1,'message':_0x223a7b['__'](_0x5e7cce(0x1eb))});}return dbPrivateSpaceTable[_0x5e7cce(0x1a8)](_0x55d4c2[_0x5e7cce(0x1ee)][_0x5e7cce(0x243)],_0x32c0d5),_0x223a7b[_0x5e7cce(0x1b4)]({'code':0x0});}),router[_0x2280f3(0x1e1)]('/updateSpaceName',(_0x173406,_0x51a090,_0x2fa6af)=>{const _0x801e24=_0x2280f3;let _0x2186d3=_0x173406['body']['spaceName'],_0x35e638=_0x173406[_0x801e24(0x223)][_0x801e24(0x183)];if(checkSpaceId(_0x173406,_0x51a090)!==!![])return;if(checkSpaceName(_0x173406,_0x51a090,_0x2186d3)!==!![])return;let _0x5739e0=dbPrivateSpaceTable[_0x801e24(0x1d7)](_0x173406['app'][_0x801e24(0x243)],_0x35e638);if(_0x173406[_0x801e24(0x230)][_0x801e24(0x21b)]!=0x1){if(_0x5739e0[_0x801e24(0x1a9)]!=_0x173406[_0x801e24(0x230)]['id'])return _0x51a090[_0x801e24(0x1b4)]({'code':0x1,'message':_0x51a090['__'](_0x801e24(0x1eb))});}return dbPrivateSpaceTable[_0x801e24(0x1f3)](_0x173406[_0x801e24(0x1ee)][_0x801e24(0x243)],_0x2186d3,_0x35e638),_0x51a090['json']({'code':0x0});}),router[_0x2280f3(0x1e1)](_0x2280f3(0x22f),(_0x3deefa,_0x2544aa,_0x4e1c12)=>{const _0x121015=_0x2280f3;let _0x203173=_0x3deefa['body'][_0x121015(0x183)];if(!_0x203173)return _0x3deefa[_0x121015(0x1ee)][_0x121015(0x207)](_0x2544aa,_0x121015(0x190));let _0x16a9ae=dbPrivateSpaceTable[_0x121015(0x1d7)](_0x3deefa[_0x121015(0x1ee)][_0x121015(0x243)],_0x203173);if(!_0x16a9ae)return _0x3deefa[_0x121015(0x1ee)][_0x121015(0x207)](_0x2544aa,_0x121015(0x1b1));let _0x38cbc0=config[_0x121015(0x217)](_0x16a9ae[_0x121015(0x239)]);fs[_0x121015(0x18b)](_0x38cbc0,(_0x474324,_0x433f57)=>{const _0x3dcb80=_0x121015;if(_0x474324)return _0x3deefa[_0x3dcb80(0x1ee)]['returnErrMsg'](_0x2544aa,_0x2544aa['__'](_0x3dcb80(0x23f)));let _0x4ef236=_0x3deefa[_0x3dcb80(0x223)]['count']||0x64,_0x4a55b8=_0x3deefa['body'][_0x3dcb80(0x1cc)]||0x0,_0x1fd5ce=_0x3deefa['body'][_0x3dcb80(0x209)]||'id',_0x1eb0f4=_0x3deefa[_0x3dcb80(0x223)][_0x3dcb80(0x1e0)]||_0x3dcb80(0x199),_0x25a218=_0x3deefa['body'][_0x3dcb80(0x185)],_0x4e90dc=getPrivateIndexDb(_0x16a9ae[_0x3dcb80(0x239)]),_0x57b99b='';_0x25a218&&_0x25a218!=_0x3dcb80(0x206)&&(_0x57b99b+=_0x3dcb80(0x1b3)+_0x25a218+'\x27');_0x57b99b+='\x20order\x20by\x20'+_0x1fd5ce+'\x20'+_0x1eb0f4+_0x3dcb80(0x192)+_0x4ef236+_0x3dcb80(0x1b7)+_0x4a55b8;let _0x845a97=dbPrivateSpaceTable['getAllIndexByWhere'](_0x4e90dc,_0x57b99b);return _0x2544aa[_0x3dcb80(0x1b4)]({'code':0x0,'data':_0x845a97});});});function getPwdFromToken(_0x341ca4,_0x15dfaa,_0x531a53){const _0x404e27=_0x2280f3;let _0x222a04=_0x341ca4[_0x404e27(0x1fb)][_0x404e27(0x226)]||_0x341ca4[_0x404e27(0x223)]['spaceToken']||_0x341ca4[_0x404e27(0x204)][_0x404e27(0x1db)],_0x5e9d87=dbPrivateSpaceTable[_0x404e27(0x222)](_0x341ca4[_0x404e27(0x1ee)]['dbOther'],_0x222a04);if(!_0x5e9d87)return _0x15dfaa[_0x404e27(0x1b4)]({'code':0x68});let _0x5b8adf=_0x5e9d87[_0x404e27(0x212)];cryptoUtils[_0x404e27(0x245)](config[_0x404e27(0x1ec)],_0x5b8adf)['then'](_0x3fd7da=>{_0x531a53(_0x3fd7da);})[_0x404e27(0x188)](_0x1c9f84=>{console['log'](_0x1c9f84);});}router[_0x2280f3(0x1ae)]('/getDecodeFile*',(_0x437278,_0x2215a4,_0x28f85c)=>{const _0xfce08b=_0x2280f3;try{let _0x4c5630=_0x437278['query']['spaceId'],_0x276359=_0x437278[_0xfce08b(0x1fb)][_0xfce08b(0x19f)],_0x2666d6=_0x437278[_0xfce08b(0x1fb)][_0xfce08b(0x20a)],_0x415ec5=_0x437278[_0xfce08b(0x1fb)][_0xfce08b(0x1d2)];if(!_0x4c5630||!_0x276359)return _0x437278['app']['returnErrMsg'](_0x2215a4,_0xfce08b(0x200));let _0x5ea006=dbPrivateSpaceTable[_0xfce08b(0x1d7)](_0x437278['app'][_0xfce08b(0x243)],_0x4c5630);if(!_0x5ea006)return _0x437278[_0xfce08b(0x1ee)]['returnErrMsg'](_0x2215a4,_0xfce08b(0x1b1));getPwdFromToken(_0x437278,_0x2215a4,_0x4603be=>{const _0x21c14c=_0xfce08b;let _0x723f2e=getPrivateIndexDb(_0x5ea006['folder_path']),_0x21ea2e=dbPrivateSpaceTable[_0x21c14c(0x203)](_0x723f2e,_0x276359);if(!_0x21ea2e)return _0x2215a4[_0x21c14c(0x1d4)](0x194)[_0x21c14c(0x1bc)]();let _0x4a1bb8='';function _0x1e0991(_0xdb0f2){const _0x549369=_0x21c14c;return path[_0x549369(0x241)](_0xdb0f2['replace'](/[\\/]/g,path['sep']));}_0x415ec5==_0x21c14c(0x18a)?_0x4a1bb8=path[_0x21c14c(0x201)](path['normalize'](path['join'](_0x5ea006['folder_path'],_0x1e0991(_0x21ea2e[_0x21c14c(0x1bb)])))):_0x4a1bb8=path[_0x21c14c(0x201)](path[_0x21c14c(0x241)](path[_0x21c14c(0x213)](_0x5ea006[_0x21c14c(0x239)],_0x1e0991(_0x21ea2e['filename_enc']))));if(_0x2666d6==0x1)try{let _0x3e0af6=Buffer[_0x21c14c(0x1ef)](_0x21ea2e[_0x21c14c(0x216)],_0x21c14c(0x214))[_0x21c14c(0x218)]();const _0x4475a4=encodeURIComponent(_0x3e0af6)[_0x21c14c(0x20d)](/%([0-9A-F]{2})/g,(_0x5e60cf,_0x3860a3)=>'%'+_0x3860a3['toUpperCase']());_0x2215a4['setHeader'](_0x21c14c(0x1a1),_0x21c14c(0x1be)+_0x4475a4);}catch(_0x36ca2d){console[_0x21c14c(0x235)](_0x36ca2d);}fs[_0x21c14c(0x18b)](_0x4a1bb8,(_0x57a4b0,_0x3e0b55)=>{const _0x97be47=_0x21c14c;if(_0x57a4b0)return console[_0x97be47(0x235)](_0x97be47(0x1a2),_0x4a1bb8),_0x2215a4['status'](0x194)['end']();if(_0x4a1bb8['indexOf']('tiny')==-0x1){let _0x5d4974=dbPrivateSpaceTable[_0x97be47(0x231)](_0x723f2e,_0x97be47(0x237),new Date()[_0x97be47(0x18d)](),_0x276359);}if(sharpUtil[_0x97be47(0x1d5)](_0x21ea2e[_0x97be47(0x1c0)])&&_0x415ec5!='tiny'){let _0x106c9d=cryptoUtils[_0x97be47(0x1b0)](_0x4603be,_0x4a1bb8);fileUtil[_0x97be47(0x194)](_0x106c9d)['then'](_0x45fde1=>{const _0x3992ca=_0x97be47;sharpUtil['transSpcielFormatFromBuffer'](_0x21ea2e[_0x3992ca(0x1c0)],_0x45fde1,(_0x1beef1,_0xb5c221,_0x16dd2d)=>{const _0x2c12de=_0x3992ca;sharpUtil['ifExtIsSpecialFormat'](_0x21ea2e[_0x2c12de(0x1c0)][_0x2c12de(0x242)]())?sharpUtil[_0x2c12de(0x196)](_0x1beef1,null,![],null,'buffer',null,_0x338319=>{const _0x4f8b80=_0x2c12de;_0x2215a4['send'](Buffer[_0x4f8b80(0x1ef)](_0x338319));},_0x52149a=>{const _0x4ac871=_0x2c12de;return console[_0x4ac871(0x235)](_0x52149a),_0x2215a4[_0x4ac871(0x1d4)](0x194)['end']();},_0xb5c221,_0x16dd2d):typeof _0x1beef1==_0x2c12de(0x20e)?(_0x2215a4[_0x2c12de(0x236)](_0x1beef1),_0x2215a4['on'](_0x2c12de(0x21d),()=>{_0xb5c221&&fs['rm'](_0x1beef1,_0x249545=>{});})):_0x2215a4[_0x2c12de(0x1b6)](_0x1beef1);});});}else cryptoUtils[_0x97be47(0x1c1)](_0x4603be,_0x4a1bb8,_0x2215a4,_0x2215a4);return;});});}catch(_0x4bbc07){return console[_0xfce08b(0x235)](_0x4bbc07),_0x2215a4['status'](0x194)[_0xfce08b(0x1bc)]();}}),router['post'](_0x2280f3(0x1ad),(_0x4443db,_0x5d22cb,_0x2d0c43)=>{const _0x2d8910=_0x2280f3;try{return dbPrivateSpaceTable[_0x2d8910(0x1f2)](_0x4443db['app'][_0x2d8910(0x243)],_0x4443db[_0x2d8910(0x223)][_0x2d8910(0x183)]),_0x5d22cb['status'](0xc8)[_0x2d8910(0x1bc)]();}catch(_0x37301b){return console[_0x2d8910(0x235)](_0x37301b),_0x5d22cb[_0x2d8910(0x1d4)](0x194)['end']();}}),module[_0x2280f3(0x1b5)]=router;