const _0x43df68=_0x2ac4;(function(_0x197dce,_0x3ccba5){const _0xec52c7=_0x2ac4,_0x1b2042=_0x197dce();while(!![]){try{const _0x1ab81a=-parseInt(_0xec52c7(0x21e))/0x1+parseInt(_0xec52c7(0x222))/0x2+parseInt(_0xec52c7(0x1ce))/0x3+parseInt(_0xec52c7(0x206))/0x4*(parseInt(_0xec52c7(0x1e9))/0x5)+parseInt(_0xec52c7(0x1ae))/0x6*(parseInt(_0xec52c7(0x209))/0x7)+parseInt(_0xec52c7(0x207))/0x8*(-parseInt(_0xec52c7(0x210))/0x9)+parseInt(_0xec52c7(0x1e8))/0xa*(parseInt(_0xec52c7(0x237))/0xb);if(_0x1ab81a===_0x3ccba5)break;else _0x1b2042['push'](_0x1b2042['shift']());}catch(_0x538e36){_0x1b2042['push'](_0x1b2042['shift']());}}}(_0x38be,0x76590));function _0x38be(){const _0x5eac64=['Content-Disposition','prepare','START_WORKER_BG_TASK','../../libs/nasTrans','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','\x20WHERE\x20file_type=\x27','space\x20id\x20is\x20invalid','space_id','PassThrough','operationFail','/regularUpload','nascabconfig','93651XEBhHR','uploadFile','query','ext','private.configFileReadFail','mkdir','folderPath','image','private.spaceNameTooLong','space_token','normalize','DateTimeOriginal','sendFile','overMode','/getAllSpace','decryptFile','run','toLowerCase','replace','size','express','private.spacePwdGtFour','stream','folderNotExist','headers','orderType','19990ceojiB','20nfhMcP','spaceToken','ifExtIsSpecialFormat','getDurationFromStream','returnErrMsg','sharpDealImg','resolve','../../db/dbPrivateSpaceTable','checkStr','streams','send','filename','/importSpace','dbOther','get','end','streamToBuffer','tiny_path','stringify','../../utils/transCodeUtil','video','attachment;\x20filename*=UTF-8\x27\x27','currentUser','destination','base64','genVideoTinyFile','startsWith','all','W_OK','268036xHKYTQ','6856LkXlLl','/getFileList','1488011ETZbjH','folder_path','tiny','/checkPwd','../../utils/videoStreamUtil','private.hasSameNameSpace','spacePwd','5139CUzXuZ','create_uid','../utils/fileUtils','better-sqlite3','private.spaceConfigFileBroken','space\x20id\x20is\x20null','private.spaceNameCantNull','is_admin','spaceName','stat','/deleteSpace','lastInsertRowid','json','decryptFileGetStream','220934zppXBv','private.onlyAdminCanDelete','catch','pwd','1362416THOiqg','exifr','encodeFilename','create','spaceId','imgTypeList','error','not\x20found','updateSpaceName','transSpcielFormatFromBuffer','noWritePermission','constants','createIndex','desc','push','getBySpaceName','pipe','tiny-','R_OK','getAllIndexByWhere','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','11KqaoLU','../../myConfig/config','videoTypeList','close','body','readdir','private.noExist','data','/updateSpaceName','from','journal_mode\x20=\x20WAL','UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?','privateSpaceKey','post','other','pragma','path','dbPath','savePath','app','unlink','updateIndexField','access','log','sep','ids','CreateDate','encryptString','status','extname','join','count','type','../utils/cryptoUtils','getTime','getAll','download','utf-8','nascabconfigenc','getIndexByWhere','toString','dealFFmpegPath','toUpperCase','createReadStream','../utils/uploadUtils','then','private.fileNameTooLong','offsetCount','getIndexById','readFile','createToken','ffprobe','encryptFile','length','private.passwordIncorrect','private.spaceFolderNotExist','6yociNN','rawImgTypeList','includes','space/index\x20id\x20is\x20null','changes','getPrivateDbPath','parse','encryptFileFromInputPipe','../utils/privateSpaceUtils','getById','needEmptyFolderPrivateSpace','\x20id=','filename_enc','UPDATE\x20private_space_index\x20SET\x20original_time=\x27','\x20offset\x20','destroy','../utils/sharpUtils','targetFolderPath','../utils/uploadPrivateUtils','temp'];_0x38be=function(){return _0x5eac64;};return _0x38be();}let express=require(_0x43df68(0x1e2)),router=express['Router']();const Database=require(_0x43df68(0x213));let dbPrivateSpaceTable=require(_0x43df68(0x1f0)),path=require(_0x43df68(0x186)),fs=require('fs'),cryptoUtils=require(_0x43df68(0x197));const config=require(_0x43df68(0x238));let privateSpaceUtils=require(_0x43df68(0x1b6));var faststart=require('../utils/faststart'),exifUtil=require(_0x43df68(0x223));let uploadUtil=require(_0x43df68(0x1a2));const PassThrough=require(_0x43df68(0x1e4))[_0x43df68(0x1ca)],{Readable}=require(_0x43df68(0x1e4));let sha256=require('sha256');const videoStreamUtil=require(_0x43df68(0x20d));let fileUtil=require(_0x43df68(0x212));const folderSignString='nascabisthebest',folderSignFileName=_0x43df68(0x19c),configFolderName=_0x43df68(0x1cd),noCheckFileList=['.DS_Store'];function _0x2ac4(_0x367157,_0x302f5b){const _0x38be99=_0x38be();return _0x2ac4=function(_0x2ac413,_0x33701d){_0x2ac413=_0x2ac413-0x182;let _0x33be19=_0x38be99[_0x2ac413];return _0x33be19;},_0x2ac4(_0x367157,_0x302f5b);}let FFmpeg=require(_0x43df68(0x1c5))['FFmpeg'];const uploadPrivateUtil=require(_0x43df68(0x1c0)),privateSharpUtil=require(_0x43df68(0x1b6)),sharpUtil=require(_0x43df68(0x1be)),transCodeUtil=require(_0x43df68(0x1fc));let dbArr=[];function checkSpaceId(_0x21dd68,_0x3db297){const _0x493b78=_0x43df68;let _0x4bd172=_0x21dd68['body'][_0x493b78(0x226)]||_0x21dd68[_0x493b78(0x1d0)][_0x493b78(0x226)];if(!_0x4bd172)return _0x21dd68['app'][_0x493b78(0x1ed)](_0x3db297,_0x493b78(0x215));let _0x365d3f=dbPrivateSpaceTable[_0x493b78(0x1b7)](_0x21dd68[_0x493b78(0x189)]['dbOther'],_0x4bd172);if(!_0x365d3f)return _0x21dd68[_0x493b78(0x189)]['returnErrMsg'](_0x3db297,_0x493b78(0x1c8));return!![];}function checkSpaceName(_0x6a8328,_0x2ed081,_0x3b7de4){const _0x3630d1=_0x43df68;if(!_0x3b7de4)return _0x6a8328[_0x3630d1(0x189)][_0x3630d1(0x1ed)](_0x2ed081,_0x2ed081['__']('private.spaceNameCantNull'));if(_0x3b7de4[_0x3630d1(0x1ab)]>0x1e)return _0x6a8328[_0x3630d1(0x189)][_0x3630d1(0x1ed)](_0x2ed081,_0x2ed081['__'](_0x3630d1(0x1d6)));return!![];}function getPrivateIndexDb(_0x1f9e7c){const _0x2772ea=_0x43df68;let _0x126462=config[_0x2772ea(0x1b3)](_0x1f9e7c);for(let _0x4ec046 in dbArr){if(dbArr[_0x4ec046][_0x2772ea(0x187)]==_0x126462)return dbArr[_0x4ec046]['db'];}let _0x42bf38=new Database(_0x126462,{});return _0x42bf38[_0x2772ea(0x185)](_0x2772ea(0x241)),dbArr[_0x2772ea(0x230)]({'dbPath':_0x126462,'db':_0x42bf38}),_0x42bf38;}router[_0x43df68(0x183)]('/addPrivateSpace',(_0x23d9d6,_0x26673d,_0x36e239)=>{const _0x2c2c8a=_0x43df68;let _0x5dc63f=_0x23d9d6[_0x2c2c8a(0x23b)][_0x2c2c8a(0x1d4)],_0x2858ce=_0x23d9d6[_0x2c2c8a(0x23b)]['spaceName'],_0x467213=_0x23d9d6['currentUser'],_0x2b3dc0=_0x23d9d6[_0x2c2c8a(0x23b)][_0x2c2c8a(0x20f)];if(checkSpaceName(_0x23d9d6,_0x26673d,_0x2858ce)!==!![])return;if(!_0x2b3dc0||_0x2b3dc0[_0x2c2c8a(0x1ab)]<0x4)return _0x23d9d6['app']['returnErrMsg'](_0x26673d,_0x26673d['__'](_0x2c2c8a(0x1e3)));function _0x5ad0db(){return new Promise((_0x3f4520,_0x11939d)=>{const _0x2eaed0=_0x2ac4;fs[_0x2eaed0(0x219)](_0x5dc63f,(_0x5b4695,_0x2c2ad0)=>{const _0x3c2cb4=_0x2eaed0;if(_0x5b4695)return _0x11939d(_0x26673d['__'](_0x3c2cb4(0x1b8)));if(_0x2c2ad0[_0x3c2cb4(0x1e1)]>0x400*0x400*0x400)return _0x23d9d6[_0x3c2cb4(0x189)][_0x3c2cb4(0x1ed)](_0x26673d,_0x26673d['__'](_0x3c2cb4(0x1b8)));fs[_0x3c2cb4(0x23c)](_0x5dc63f,(_0x417151,_0x234419)=>{const _0x1f17e7=_0x3c2cb4;for(let _0x1fc9e0 of _0x234419){if(noCheckFileList['includes'](_0x1fc9e0)||_0x1fc9e0[_0x1f17e7(0x203)]('.')||_0x1fc9e0[_0x1f17e7(0x203)]('@'))continue;return _0x11939d(_0x26673d['__'](_0x1f17e7(0x1b8)));}_0x3f4520();});});});}fs[_0x2c2c8a(0x18c)](_0x5dc63f,fs[_0x2c2c8a(0x22d)][_0x2c2c8a(0x234)]|fs[_0x2c2c8a(0x22d)][_0x2c2c8a(0x205)],_0x5e1d2f=>{const _0x572790=_0x2c2c8a;if(_0x5e1d2f)return _0x23d9d6['app']['returnErrMsg'](_0x26673d,_0x26673d['__']('noWritePermission'));_0x5ad0db()[_0x572790(0x1a3)](()=>{const _0x5ad236=_0x572790;let _0x44936f=dbPrivateSpaceTable[_0x5ad236(0x231)](_0x23d9d6[_0x5ad236(0x189)][_0x5ad236(0x1f6)],_0x2858ce);if(_0x44936f)return _0x23d9d6['app'][_0x5ad236(0x1ed)](_0x26673d,_0x26673d['__'](_0x5ad236(0x20e)));let _0x4f06d1=path[_0x5ad236(0x194)](_0x5dc63f,configFolderName);fs[_0x5ad236(0x1d3)](_0x4f06d1,{'recursive':!![]},_0x13960d=>{const _0x548289=_0x5ad236;if(_0x13960d)return _0x23d9d6[_0x548289(0x189)][_0x548289(0x1ed)](_0x26673d,_0x26673d['__']('operationFail')+JSON['stringify'](_0x13960d));let _0x5669da=getPrivateIndexDb(_0x5dc63f);dbPrivateSpaceTable['createIndexDb'](_0x5669da,_0x5dc63f),cryptoUtils['encryptString'](_0x2b3dc0,folderSignString)[_0x548289(0x1a3)](_0x4eb809=>{const _0x4412e8=_0x548289;let _0x67c9b=path[_0x4412e8(0x194)](_0x4f06d1,folderSignFileName);fs['writeFile'](_0x67c9b,_0x4eb809,_0x250524=>{const _0x16ef93=_0x4412e8;if(_0x250524)return _0x23d9d6['app']['returnErrMsg'](_0x26673d,_0x26673d['__']('operationFail')+JSON[_0x16ef93(0x1fb)](_0x250524));return dbPrivateSpaceTable['create'](_0x23d9d6['app'][_0x16ef93(0x1f6)],{'folder_path':_0x5dc63f,'space_name':_0x2858ce,'create_uid':_0x467213['id']}),_0x26673d[_0x16ef93(0x21c)]({'code':0x0});});})[_0x548289(0x220)](_0x4d311b=>{const _0x56d8ec=_0x548289;return console[_0x56d8ec(0x18d)]('error',_0x4d311b),_0x23d9d6[_0x56d8ec(0x189)]['returnErrMsg'](_0x26673d,_0x26673d['__'](_0x56d8ec(0x1cb))+JSON[_0x56d8ec(0x1fb)](_0x4d311b));});});})[_0x572790(0x220)](_0x5622d3=>{const _0xf34c52=_0x572790;return _0x23d9d6[_0xf34c52(0x189)][_0xf34c52(0x1ed)](_0x26673d,_0x5622d3);});});}),router[_0x43df68(0x183)](_0x43df68(0x1dc),(_0x35daf6,_0x39050a,_0x517447)=>{const _0x47751b=_0x43df68;let _0x9621cf=[];return _0x35daf6[_0x47751b(0x1ff)][_0x47751b(0x217)]==0x1?_0x9621cf=dbPrivateSpaceTable[_0x47751b(0x199)](_0x35daf6[_0x47751b(0x189)][_0x47751b(0x1f6)]):_0x9621cf=dbPrivateSpaceTable['getAllByUid'](_0x35daf6['app'][_0x47751b(0x1f6)],_0x35daf6[_0x47751b(0x1ff)]['id']),_0x39050a[_0x47751b(0x21c)]({'code':0x0,'data':_0x9621cf});});function checkSpacePwd(_0x57dba5,_0x13cd87,_0x4b024e){return new Promise((_0x221941,_0x40f8e9)=>{const _0xb03fcb=_0x2ac4;_0x13cd87=Buffer[_0xb03fcb(0x240)](_0x13cd87,'base64')[_0xb03fcb(0x19e)]();let _0x1ec134=path[_0xb03fcb(0x194)](_0x4b024e,configFolderName,folderSignFileName);fs[_0xb03fcb(0x219)](_0x1ec134,(_0x1fe662,_0x290db8)=>{const _0x463071=_0xb03fcb;if(_0x1fe662)return _0x40f8e9(_0x57dba5['__']('private.configFileReadFail'));fs[_0x463071(0x1a7)](_0x1ec134,_0x463071(0x19b),(_0x320060,_0x3b5ea5)=>{const _0x3964f4=_0x463071;if(_0x320060)return _0x40f8e9(_0x57dba5['__'](_0x3964f4(0x1d2)));else cryptoUtils['decryptString'](_0x13cd87,_0x3b5ea5)[_0x3964f4(0x1a3)](_0x52b46f=>{const _0x211721=_0x3964f4;return _0x52b46f==folderSignString?_0x221941(_0x13cd87):_0x40f8e9(_0x57dba5['__'](_0x211721(0x1ac)));})[_0x3964f4(0x220)](_0x79ec9b=>{const _0x4f7d5b=_0x3964f4;return console['log'](_0x4f7d5b(0x228),_0x79ec9b),_0x40f8e9(_0x57dba5['__'](_0x4f7d5b(0x1ac)));});});});});}router['post'](_0x43df68(0x20c),(_0x162f81,_0x4b6b35,_0x21b3ee)=>{const _0x3a48e2=_0x43df68;let _0x5d9bd2=_0x162f81[_0x3a48e2(0x23b)][_0x3a48e2(0x1f1)],_0x476d34=_0x162f81[_0x3a48e2(0x23b)]['spaceId'],_0x4fcf3e=dbPrivateSpaceTable[_0x3a48e2(0x1b7)](_0x162f81['app']['dbOther'],_0x476d34);if(!_0x4fcf3e)return _0x162f81[_0x3a48e2(0x189)][_0x3a48e2(0x1ed)](_0x4b6b35,'error\x20space\x20id');fs[_0x3a48e2(0x219)](_0x4fcf3e['folder_path'],(_0x4a40b9,_0x24e05a)=>{const _0x2d28b7=_0x3a48e2;if(_0x4a40b9)return _0x162f81['app'][_0x2d28b7(0x1ed)](_0x4b6b35,_0x4b6b35['__'](_0x2d28b7(0x1ad)));checkSpacePwd(_0x4b6b35,_0x5d9bd2,_0x4fcf3e[_0x2d28b7(0x20a)])['then'](_0x3d5246=>{const _0x3841c3=_0x2d28b7;let _0x431ba8=sha256(new Date()[_0x3841c3(0x198)]()+_0x476d34+_0x3d5246);cryptoUtils[_0x3841c3(0x191)](config['tokenPwdEncryptKey'],_0x3d5246)[_0x3841c3(0x1a3)](_0x4093fb=>{const _0x40e8e4=_0x3841c3;return dbPrivateSpaceTable[_0x40e8e4(0x1a8)](_0x162f81[_0x40e8e4(0x189)][_0x40e8e4(0x1f6)],{'space_id':_0x476d34,'pwd':_0x4093fb,'token':_0x431ba8}),_0x4b6b35[_0x40e8e4(0x21c)]({'code':0x0,'token':_0x431ba8});});})[_0x2d28b7(0x220)](_0x48263f=>{const _0x559d9c=_0x2d28b7;return console['log'](_0x559d9c(0x228),_0x48263f),_0x162f81['app'][_0x559d9c(0x1ed)](_0x4b6b35,_0x48263f);});});});function ffprobeSync(_0x421f04){return new Promise((_0x2f5359,_0x31e5ea)=>{const _0x12d825=_0x2ac4;try{FFmpeg(transCodeUtil[_0x12d825(0x19f)](_0x421f04))[_0x12d825(0x1a9)]((_0x2bda01,_0x17027e)=>{_0x2bda01?_0x31e5ea(_0x2bda01):_0x2f5359(_0x17027e);});}catch(_0x12526f){console[_0x12d825(0x18d)](_0x12d825(0x228),_0x12526f),_0x31e5ea(_0x12526f);}});}function deleteFile(_0x22fefa){fs['rm'](_0x22fefa,{'maxRetries':0xa,'retryDelay':0x3e8},_0x17cd91=>{});}function uploadFail(_0xc76d7a,_0x2f32db,_0x4175e8,_0x46564a){const _0x2da060=_0x43df68;return deleteFile(_0x2f32db),_0x4175e8[_0x2da060(0x189)]['returnErrMsg'](_0x46564a,_0x46564a['__']('private.uploadErrTryAgain'));}function dealUploadImageOrFile(_0x1e4b51,_0x1c6508,_0x322f77,_0xb764b9,_0x18c2c5,_0x31c6a9,_0x257d1d,_0x55429a,_0x154985){uploadPrivateUtil['uploadFile'](_0x322f77,_0xb764b9,_0x18c2c5,_0x31c6a9,_0x2587db=>{const _0x5667f2=_0x2ac4;let _0x5744be=_0x2587db[_0x5667f2(0x186)],_0x192f08=cryptoUtils['decryptFileGetStream'](_0x31c6a9,_0x5744be),_0x1d8fcd=dbPrivateSpaceTable[_0x5667f2(0x22e)](_0x1e4b51,{'filename':new Buffer[(_0x5667f2(0x240))](_0x55429a)[_0x5667f2(0x19e)]('base64'),'filename_enc':_0x18c2c5,'file_type':_0x257d1d,'ext':_0x154985});if(_0x1d8fcd[_0x5667f2(0x1b2)]<0x1)return uploadFail(_0x1e4b51,_0x5744be,_0x322f77,_0xb764b9);let _0x5e61b4=_0x1d8fcd[_0x5667f2(0x21b)];_0xb764b9[_0x5667f2(0x21c)]({'code':0x0});let _0x305e84=new Date()[_0x5667f2(0x198)]();if(_0x257d1d==_0x5667f2(0x1d5)){var _0xc0a374=[];let _0x30b0ce=new PassThrough()[_0x5667f2(0x232)](_0x192f08);_0x30b0ce['on'](_0x5667f2(0x23e),function(_0x17c785){const _0x3f7bf7=_0x5667f2;_0xc0a374[_0x3f7bf7(0x230)](_0x17c785);}),_0x30b0ce['on'](_0x5667f2(0x1f8),function(){var _0x1e234a=Buffer['concat'](_0xc0a374);function _0xf988ee(){const _0x311171=_0x2ac4;exifUtil['parse'](_0x1e234a)[_0x311171(0x1a3)](_0x5c22b5=>{const _0x45e633=_0x311171;if(_0x5c22b5){let _0x10a2e0=_0x5c22b5[_0x45e633(0x1d9)];_0x5c22b5[_0x45e633(0x190)]&&!_0x10a2e0&&(_0x10a2e0=_0x5c22b5[_0x45e633(0x190)]),_0x10a2e0&&(_0x305e84=new Date(_0x10a2e0)[_0x45e633(0x198)](),_0x1e4b51[_0x45e633(0x1c3)](_0x45e633(0x1bb)+_0x305e84+'\x27\x20where\x20id='+_0x5e61b4)[_0x45e633(0x1de)]());}})['catch'](_0x3d288b=>{});}privateSpaceUtils['genImageTinyFile'](_0x154985,_0x1e234a,_0x24a18b=>{const _0x1fdec8=_0x2ac4,_0x72c2b8=Readable[_0x1fdec8(0x240)](_0x24a18b);let _0x4bb668=path[_0x1fdec8(0x194)](_0x1c6508,_0x18c2c5);cryptoUtils[_0x1fdec8(0x1b5)](_0x31c6a9,_0x72c2b8,_0x4bb668)[_0x1fdec8(0x1a3)](_0x5e7912=>{const _0xe99b81=_0x1fdec8;let _0x2f6e1d=path[_0xe99b81(0x194)](configFolderName,'tiny',_0x18c2c5);_0x1e4b51['prepare']('UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27'+_0x2f6e1d+'\x27\x20where\x20id='+_0x5e61b4)[_0xe99b81(0x1de)](),_0xf988ee();});},_0x3003a0=>{_0xf988ee();});});}});}function dealUploadVideo(_0x477200,_0x3d04ce,_0xc8efe2,_0x17997a,_0x5594c1,_0x4b7929,_0x4dd326,_0x4bf97e,_0x23d44e,_0x12b4be,_0x23bf79){const _0x59030e=_0x43df68;_0x5594c1[_0x59030e(0x1d0)][_0x59030e(0x188)]=_0x17997a,_0x5594c1[_0x59030e(0x1d0)][_0x59030e(0x1db)]='over',uploadUtil[_0x59030e(0x1cf)](_0x5594c1,_0x4b7929,![],!![],![],_0x1586f0=>{const _0x185f93=_0x59030e;let _0x1deb05=_0x1586f0[_0x185f93(0x186)],_0x502f11=path['join'](_0x1586f0[_0x185f93(0x200)]);function _0x1344bc(_0x44cd1d){const _0x29ba9c=_0x185f93;ffprobeSync(_0x1deb05)[_0x29ba9c(0x1a3)](_0x379db4=>{const _0x276c2b=_0x29ba9c;let _0x2c8b65=0x0;_0x2c8b65=videoStreamUtil[_0x276c2b(0x1ec)](_0x379db4);let _0x21738f=JSON['stringify'](_0x379db4[_0x276c2b(0x1f2)]),_0xac3208=videoStreamUtil['getVideoOriginalTime'](_0x379db4);fs[_0x276c2b(0x219)](_0x1deb05,(_0x16212b,_0x3d8cb1)=>{const _0x96c68b=_0x276c2b;if(_0x16212b){deleteFile(_0x1deb05);return;}let _0xde62de=_0x96c68b(0x242);_0x477200['prepare'](_0xde62de)['run'](_0xac3208,parseInt(_0x2c8b65),_0x3d8cb1['size'],_0x21738f,_0x44cd1d);let _0x472076=_0x96c68b(0x233)+Buffer['from'](_0x12b4be)['toString']('base64');privateSpaceUtils[_0x96c68b(0x202)](_0x1deb05,_0x502f11,_0x472076,_0x579a4a=>{fs['stat'](_0x579a4a,(_0x3da93f,_0x137b4d)=>{const _0xec04da=_0x2ac4;if(_0x3da93f){deleteFile(_0x1deb05);return;}let _0x483cd6=path['join'](_0xc8efe2,_0x4dd326);cryptoUtils[_0xec04da(0x1aa)](_0x4bf97e,_0x579a4a,_0x483cd6)[_0xec04da(0x1a3)](_0x4a18b6=>{const _0x452499=_0xec04da;let _0x41d547=path['join'](configFolderName,_0x452499(0x20b),_0x4dd326);_0x477200['prepare'](_0x452499(0x236)+_0x41d547+'\x27\x20where\x20id='+_0x44cd1d)[_0x452499(0x1de)](),deleteFile(_0x579a4a),deleteFile(_0x1deb05);});});},_0x4d408b=>{deleteFile(_0x1deb05);});});})[_0x29ba9c(0x220)](_0x72d8d0=>{deleteFile(_0x1deb05);});}function _0xb570cc(){const _0x44afca=_0x185f93;let _0x3c7313=dbPrivateSpaceTable[_0x44afca(0x22e)](_0x477200,{'filename':new Buffer[(_0x44afca(0x240))](_0x12b4be)[_0x44afca(0x19e)](_0x44afca(0x201)),'filename_enc':_0x4dd326,'file_type':_0x23d44e,'ext':_0x23bf79});return _0x3c7313[_0x44afca(0x1b2)]<0x1?uploadFail(_0x477200,_0x1deb05,_0x5594c1,_0x4b7929):(_0x1344bc(_0x3c7313[_0x44afca(0x21b)]),_0x4b7929[_0x44afca(0x21c)]({'code':0x0}));}function _0x355715(_0x164563,_0x1b41c9,_0x1c5368){const _0x13b35a=_0x185f93;cryptoUtils[_0x13b35a(0x1aa)](_0x4bf97e,_0x164563,_0x1b41c9)['then'](_0x458354=>{_0x1c5368(_0x458354);})['catch'](_0x43882f=>{const _0x15a273=_0x13b35a;console[_0x15a273(0x18d)](_0x43882f),uploadFail(_0x477200,_0x164563,_0x5594c1,_0x4b7929);});}let _0x24db5d=path[_0x185f93(0x194)](_0x3d04ce[_0x185f93(0x20a)],_0x4dd326);if(_0x23bf79=='.mp4'||_0x23bf79=='.mov'){var _0x5a9459=faststart[_0x185f93(0x1a1)](_0x1deb05,{'errorCallBack':_0x115aa9=>{_0x355715(_0x1deb05,_0x24db5d,_0xb570cc);}});_0x5a9459['on'](_0x185f93(0x23a),function(){const _0x5bbda6=_0x185f93;_0x5a9459[_0x5bbda6(0x1bd)]();}),cryptoUtils['encryptFileFromInputPipe'](_0x4bf97e,_0x5a9459,_0x24db5d)[_0x185f93(0x1a3)](_0x2e6fdf=>{_0xb570cc();})[_0x185f93(0x220)](_0x2d1815=>{const _0x5a7231=_0x185f93;console['log'](_0x5a7231(0x228),_0x2d1815),uploadFail(_0x477200,_0x1deb05,_0x5594c1,_0x4b7929);});}else _0x355715(_0x1deb05,_0x24db5d,_0xb570cc);});}router[_0x43df68(0x183)](_0x43df68(0x1cc),function(_0x41294c,_0x1a7ce6,_0x2cadef){const _0x49d9e7=_0x43df68;let _0x149113=_0x41294c[_0x49d9e7(0x1d0)][_0x49d9e7(0x226)]||_0x41294c[_0x49d9e7(0x23b)][_0x49d9e7(0x226)]||_0x41294c[_0x49d9e7(0x1e6)][_0x49d9e7(0x1c9)],_0x5aec66=_0x41294c[_0x49d9e7(0x1d0)][_0x49d9e7(0x1f4)]||_0x41294c[_0x49d9e7(0x1e6)][_0x49d9e7(0x1f4)],_0x13e1d0=decodeURIComponent(_0x5aec66);_0x41294c['query']['encodeFilename']&&(_0x13e1d0=fileUtil['decodePath'](_0x41294c[_0x49d9e7(0x1d0)][_0x49d9e7(0x224)])),getPwdFromToken(_0x41294c,_0x1a7ce6,_0x37d65b=>{const _0x202ca7=_0x49d9e7;let _0x290d12=dbPrivateSpaceTable[_0x202ca7(0x1b7)](_0x41294c['app'][_0x202ca7(0x1f6)],_0x149113);if(!_0x290d12)return _0x41294c[_0x202ca7(0x189)][_0x202ca7(0x1ed)](_0x1a7ce6,_0x1a7ce6['__'](_0x202ca7(0x23d)));_0x41294c[_0x202ca7(0x1d0)][_0x202ca7(0x188)]=_0x290d12[_0x202ca7(0x20a)];let _0x3dbba1=getPrivateIndexDb(_0x290d12['folder_path']),_0x5e531b=dbPrivateSpaceTable['getIndexByFileName'](_0x3dbba1,new Buffer['from'](_0x13e1d0)[_0x202ca7(0x19e)]('base64'));if(_0x5e531b)return _0x41294c[_0x202ca7(0x189)][_0x202ca7(0x1ed)](_0x1a7ce6,_0x1a7ce6['__']('private.alreadyHasSameNameFile'));let _0x129a8=path[_0x202ca7(0x193)](_0x13e1d0)?path[_0x202ca7(0x193)](_0x13e1d0)[_0x202ca7(0x1df)]():null,_0x136eaa=_0x202ca7(0x184);if(_0x129a8){if(config[_0x202ca7(0x227)][_0x202ca7(0x1b0)](_0x129a8['toLowerCase']())||config[_0x202ca7(0x1af)][_0x202ca7(0x1b0)](_0x129a8[_0x202ca7(0x1df)]()))_0x136eaa=_0x202ca7(0x1d5);else config[_0x202ca7(0x239)][_0x202ca7(0x1b0)](_0x129a8['toLowerCase']())&&(_0x136eaa=_0x202ca7(0x1fd));}let _0x3c5452=path[_0x202ca7(0x194)](_0x290d12['folder_path'],configFolderName,_0x202ca7(0x20b)),_0x44dfd6=path[_0x202ca7(0x194)](_0x290d12['folder_path'],configFolderName,_0x202ca7(0x1c1));function _0x34ef48(){const _0x5366a9=_0x202ca7;cryptoUtils[_0x5366a9(0x191)](_0x37d65b,_0x13e1d0)[_0x5366a9(0x1a3)](_0x3f3190=>{const _0x3cc4f4=_0x5366a9;if(_0x3f3190['length']>0xf0)return _0x41294c[_0x3cc4f4(0x189)][_0x3cc4f4(0x1ed)](_0x1a7ce6,_0x1a7ce6['__'](_0x3cc4f4(0x1a4)));_0x136eaa==_0x3cc4f4(0x1fd)?dealUploadVideo(_0x3dbba1,_0x290d12,_0x3c5452,_0x44dfd6,_0x41294c,_0x1a7ce6,_0x3f3190,_0x37d65b,_0x136eaa,_0x13e1d0,_0x129a8):dealUploadImageOrFile(_0x3dbba1,_0x3c5452,_0x41294c,_0x1a7ce6,_0x3f3190,_0x37d65b,_0x136eaa,_0x13e1d0,_0x129a8);});}fs[_0x202ca7(0x219)](_0x3c5452,(_0x243c22,_0x1b3a88)=>{const _0x1b4b65=_0x202ca7;function _0x21c322(){const _0x2dd864=_0x2ac4;fs[_0x2dd864(0x219)](_0x44dfd6,(_0x4faa25,_0x29a0a9)=>{const _0x174d3e=_0x2dd864;_0x4faa25?fs[_0x174d3e(0x1d3)](_0x44dfd6,{'recursive':!![]},_0x12f6b5=>{_0x34ef48();}):_0x34ef48();});}_0x243c22?fs[_0x1b4b65(0x1d3)](_0x3c5452,{'recursive':!![]},_0x341cbe=>{_0x21c322();}):_0x21c322();});});}),router[_0x43df68(0x183)](_0x43df68(0x1f5),(_0x42e85c,_0x2c3b10,_0x831c5b)=>{const _0x52d4a5=_0x43df68;let _0x20ae9f=_0x42e85c[_0x52d4a5(0x23b)][_0x52d4a5(0x1d4)],_0x16f1e0=_0x42e85c[_0x52d4a5(0x23b)][_0x52d4a5(0x218)],_0x1cec9d=_0x42e85c[_0x52d4a5(0x1ff)],_0x248e3a=_0x42e85c[_0x52d4a5(0x23b)][_0x52d4a5(0x20f)];if(!_0x16f1e0)return _0x42e85c[_0x52d4a5(0x189)]['returnErrMsg'](_0x2c3b10,_0x2c3b10['__'](_0x52d4a5(0x216)));let _0xc09aca=dbPrivateSpaceTable[_0x52d4a5(0x231)](_0x42e85c[_0x52d4a5(0x189)][_0x52d4a5(0x1f6)],_0x16f1e0);if(_0xc09aca)return _0x42e85c[_0x52d4a5(0x189)][_0x52d4a5(0x1ed)](_0x2c3b10,_0x2c3b10['__'](_0x52d4a5(0x20e)));if(!_0x248e3a)return _0x42e85c[_0x52d4a5(0x189)][_0x52d4a5(0x1ed)](_0x2c3b10,_0x2c3b10['__'](_0x52d4a5(0x1e3)));fs[_0x52d4a5(0x18c)](_0x20ae9f,_0x23ca1e=>{const _0x23525b=_0x52d4a5;if(_0x23ca1e)return _0x42e85c['app'][_0x23525b(0x1ed)](_0x2c3b10,_0x2c3b10['__'](_0x23525b(0x22c)));checkSpacePwd(_0x2c3b10,_0x248e3a,_0x20ae9f)['then'](()=>{const _0xf46ecc=_0x23525b;let _0x2fbf24=config[_0xf46ecc(0x1b3)](_0x20ae9f);fs[_0xf46ecc(0x219)](_0x2fbf24,(_0x55065f,_0x15ca41)=>{const _0x470060=_0xf46ecc;if(_0x55065f)return _0x42e85c[_0x470060(0x189)][_0x470060(0x1ed)](_0x2c3b10,_0x2c3b10['__'](_0x470060(0x214)));return dbPrivateSpaceTable[_0x470060(0x225)](_0x42e85c[_0x470060(0x189)][_0x470060(0x1f6)],{'folder_path':_0x20ae9f,'space_name':_0x16f1e0,'create_uid':_0x1cec9d['id']}),_0x2c3b10[_0x470060(0x21c)]({'code':0x0});});})[_0x23525b(0x220)](_0x17c5e5=>{const _0x2874af=_0x23525b;return _0x42e85c[_0x2874af(0x189)]['returnErrMsg'](_0x2c3b10,_0x17c5e5);});});}),router[_0x43df68(0x183)]('/exportSpace',(_0x4066b4,_0x38d429,_0x417361)=>{const _0x215f40=_0x43df68;let _0x31ebd4=_0x4066b4[_0x215f40(0x23b)][_0x215f40(0x1d4)],_0x299f86=_0x4066b4[_0x215f40(0x23b)][_0x215f40(0x20f)],_0x5bedd8=_0x4066b4[_0x215f40(0x23b)][_0x215f40(0x1bf)];if(!_0x299f86)return _0x4066b4[_0x215f40(0x189)][_0x215f40(0x1ed)](_0x38d429,_0x38d429['__'](_0x215f40(0x1e3)));fs[_0x215f40(0x18c)](_0x31ebd4,fs[_0x215f40(0x22d)][_0x215f40(0x234)],_0x48e076=>{const _0x2eaad4=_0x215f40;if(_0x48e076)return _0x4066b4['app'][_0x2eaad4(0x1ed)](_0x38d429,_0x38d429['__'](_0x2eaad4(0x22c)));fs[_0x2eaad4(0x18c)](_0x5bedd8,fs['constants']['W_OK'],_0x534cc6=>{const _0x4a0998=_0x2eaad4;if(_0x534cc6)return _0x4066b4[_0x4a0998(0x189)]['returnErrMsg'](_0x38d429,_0x38d429['__'](_0x4a0998(0x22c)));function _0x4a4bda(_0x5a0a3f){const _0x39b9f5=_0x4a0998;cryptoUtils[_0x39b9f5(0x191)](config[_0x39b9f5(0x182)],_0x299f86)[_0x39b9f5(0x1a3)](_0x1a2307=>{const _0x27ffb0=_0x39b9f5;return _0x5a0a3f[_0x27ffb0(0x189)][_0x27ffb0(0x1f6)][_0x27ffb0(0x1c3)](_0x27ffb0(0x1c6))[_0x27ffb0(0x1de)]('EXPORT_PRIVATE_SPACE',JSON[_0x27ffb0(0x1fb)]({'folderPath':_0x31ebd4,'targetFolderPath':_0x5bedd8,'spacePwd':_0x1a2307})),process[_0x27ffb0(0x1f3)]({'type':_0x27ffb0(0x1c4)}),_0x38d429['json']({'code':0x0});});}let _0x17e1e6=path[_0x4a0998(0x194)](_0x31ebd4,configFolderName,folderSignFileName);fs['stat'](_0x17e1e6,(_0x4f65a8,_0x329e7)=>{const _0x253c75=_0x4a0998;_0x4f65a8?_0x4a4bda(_0x4066b4):checkSpacePwd(_0x38d429,_0x299f86,_0x31ebd4)[_0x253c75(0x1a3)](()=>{_0x4a4bda(_0x4066b4);})[_0x253c75(0x220)](_0x41a286=>{const _0x1a288d=_0x253c75;return console[_0x1a288d(0x18d)](_0x41a286),_0x4066b4[_0x1a288d(0x189)][_0x1a288d(0x1ed)](_0x38d429,_0x38d429['__'](_0x1a288d(0x1ac)));});});});});}),router[_0x43df68(0x183)]('/deleteSpaceFiles',(_0x568661,_0x4ebf0f,_0x564a4c)=>{const _0x31a3db=_0x43df68;let _0x5b5394=_0x568661[_0x31a3db(0x23b)][_0x31a3db(0x226)],_0x5a6973=_0x568661[_0x31a3db(0x23b)][_0x31a3db(0x18f)];if(!_0x5a6973||_0x5a6973[_0x31a3db(0x1ab)]<0x1)return _0x4ebf0f[_0x31a3db(0x192)](0x194)['end']();let _0x68d0d0=dbPrivateSpaceTable['getById'](_0x568661[_0x31a3db(0x189)][_0x31a3db(0x1f6)],_0x5b5394);if(!_0x68d0d0)return _0x4ebf0f['status'](0x194)[_0x31a3db(0x1f8)]();if(_0x568661['currentUser'][_0x31a3db(0x217)]!=0x1){if(_0x68d0d0[_0x31a3db(0x211)]!=_0x568661['currentUser']['id'])return _0x4ebf0f[_0x31a3db(0x21c)]({'code':0x1,'message':_0x4ebf0f['__'](_0x31a3db(0x21f))});}try{let _0x3dde85=getPrivateIndexDb(_0x68d0d0[_0x31a3db(0x20a)]),_0x567405=JSON[_0x31a3db(0x1b4)](_0x5a6973),_0x522dc0=0x0,_0xd201aa=[],_0x4071fe=0x0,_0x3817b4=0x0;if(_0x567405[_0x31a3db(0x1ab)]<0x1)return _0x4ebf0f[_0x31a3db(0x21c)]({'code':0x0,'deleteList':_0xd201aa,'deleteCount':_0x522dc0,'errCount':_0x4071fe});for(let _0x5cd659=0x0;_0x5cd659<_0x567405[_0x31a3db(0x1ab)];_0x5cd659++){let _0x38a7e8=dbPrivateSpaceTable[_0x31a3db(0x19d)](_0x3dde85,_0x31a3db(0x1b9)+_0x567405[_0x5cd659]);if(!_0x38a7e8)return _0x568661['app']['returnErrMsg'](_0x4ebf0f,_0x4ebf0f['__'](_0x31a3db(0x1e5)));let _0x9eebfe=path[_0x31a3db(0x194)](_0x68d0d0['folder_path'],_0x38a7e8[_0x31a3db(0x1ba)]);if(_0x38a7e8[_0x31a3db(0x1fa)]&&_0x38a7e8[_0x31a3db(0x1fa)]!='undefined'){let _0x471dff=path[_0x31a3db(0x194)](_0x68d0d0['folder_path'],_0x38a7e8[_0x31a3db(0x1fa)]);try{fs[_0x31a3db(0x18a)](_0x471dff,_0x2f44df=>{});}catch(_0x4cbc58){}}fs[_0x31a3db(0x18a)](_0x9eebfe,_0x2bf054=>{const _0x4f955b=_0x31a3db;_0x3817b4+=0x1;_0x2bf054?(console[_0x4f955b(0x18d)]('err',_0x2bf054['message']),_0x4071fe+=0x1):(_0x522dc0+=0x1,_0xd201aa[_0x4f955b(0x230)](_0x567405[_0x5cd659]));dbPrivateSpaceTable['deleteIndex'](_0x3dde85,_0x567405[_0x5cd659]);if(_0x3817b4==_0x567405[_0x4f955b(0x1ab)])return _0x4ebf0f[_0x4f955b(0x21c)]({'code':0x0,'deleteList':_0xd201aa,'deleteCount':_0x522dc0,'errCount':_0x4071fe});});}}catch(_0x34fe74){return console[_0x31a3db(0x18d)](_0x31a3db(0x228),_0x34fe74),_0x4ebf0f[_0x31a3db(0x21c)]({'code':0x1,'message':JSON[_0x31a3db(0x1fb)](_0x34fe74)});}}),router[_0x43df68(0x183)](_0x43df68(0x21a),(_0x451658,_0x3d65d9,_0x3320fe)=>{const _0x4c6fcc=_0x43df68;if(checkSpaceId(_0x451658,_0x3d65d9)!==!![])return;let _0x28cd89=_0x451658['body'][_0x4c6fcc(0x226)],_0x325e3e=dbPrivateSpaceTable[_0x4c6fcc(0x1b7)](_0x451658[_0x4c6fcc(0x189)]['dbOther'],_0x28cd89);if(_0x451658[_0x4c6fcc(0x1ff)]['is_admin']!=0x1){if(_0x325e3e[_0x4c6fcc(0x211)]!=_0x451658[_0x4c6fcc(0x1ff)]['id'])return _0x3d65d9[_0x4c6fcc(0x21c)]({'code':0x1,'message':_0x3d65d9['__']('private.onlyAdminCanDelete')});}return dbPrivateSpaceTable['delete'](_0x451658[_0x4c6fcc(0x189)][_0x4c6fcc(0x1f6)],_0x28cd89),_0x3d65d9[_0x4c6fcc(0x21c)]({'code':0x0});}),router['post'](_0x43df68(0x23f),(_0x354845,_0x2f160e,_0x1ef225)=>{const _0x61c1f7=_0x43df68;let _0x4ef4ad=_0x354845[_0x61c1f7(0x23b)]['spaceName'],_0x4516d4=_0x354845[_0x61c1f7(0x23b)][_0x61c1f7(0x226)];if(checkSpaceId(_0x354845,_0x2f160e)!==!![])return;if(checkSpaceName(_0x354845,_0x2f160e,_0x4ef4ad)!==!![])return;let _0x3242cb=dbPrivateSpaceTable[_0x61c1f7(0x1b7)](_0x354845[_0x61c1f7(0x189)][_0x61c1f7(0x1f6)],_0x4516d4);if(_0x354845[_0x61c1f7(0x1ff)][_0x61c1f7(0x217)]!=0x1){if(_0x3242cb['create_uid']!=_0x354845['currentUser']['id'])return _0x2f160e['json']({'code':0x1,'message':_0x2f160e['__'](_0x61c1f7(0x21f))});}return dbPrivateSpaceTable[_0x61c1f7(0x22a)](_0x354845[_0x61c1f7(0x189)][_0x61c1f7(0x1f6)],_0x4ef4ad,_0x4516d4),_0x2f160e[_0x61c1f7(0x21c)]({'code':0x0});}),router[_0x43df68(0x183)](_0x43df68(0x208),(_0x18f41d,_0x3b51ef,_0x45ada1)=>{const _0x291722=_0x43df68;let _0x599423=_0x18f41d[_0x291722(0x23b)][_0x291722(0x226)];if(!_0x599423)return _0x18f41d[_0x291722(0x189)][_0x291722(0x1ed)](_0x3b51ef,_0x291722(0x215));let _0x42f537=dbPrivateSpaceTable['getById'](_0x18f41d['app'][_0x291722(0x1f6)],_0x599423);if(!_0x42f537)return _0x18f41d[_0x291722(0x189)][_0x291722(0x1ed)](_0x3b51ef,_0x291722(0x1c8));let _0x134b62=config[_0x291722(0x1b3)](_0x42f537[_0x291722(0x20a)]);fs[_0x291722(0x219)](_0x134b62,(_0x56d8fa,_0x1facae)=>{const _0x8ffdc4=_0x291722;if(_0x56d8fa)return _0x18f41d[_0x8ffdc4(0x189)][_0x8ffdc4(0x1ed)](_0x3b51ef,_0x3b51ef['__'](_0x8ffdc4(0x214)));let _0x24c470=_0x18f41d[_0x8ffdc4(0x23b)][_0x8ffdc4(0x195)]||0x64,_0x24e5f6=_0x18f41d[_0x8ffdc4(0x23b)][_0x8ffdc4(0x1a5)]||0x0,_0x312f16=_0x18f41d[_0x8ffdc4(0x23b)]['orderField']||'id',_0x206ebb=_0x18f41d[_0x8ffdc4(0x23b)][_0x8ffdc4(0x1e7)]||_0x8ffdc4(0x22f),_0x59929c=_0x18f41d[_0x8ffdc4(0x23b)]['fileType'],_0x796fbb=getPrivateIndexDb(_0x42f537[_0x8ffdc4(0x20a)]),_0x3e89ef='';_0x59929c&&_0x59929c!=_0x8ffdc4(0x204)&&(_0x3e89ef+=_0x8ffdc4(0x1c7)+_0x59929c+'\x27');_0x3e89ef+='\x20order\x20by\x20'+_0x312f16+'\x20'+_0x206ebb+'\x20limit\x20'+_0x24c470+_0x8ffdc4(0x1bc)+_0x24e5f6;let _0x246a54=dbPrivateSpaceTable[_0x8ffdc4(0x235)](_0x796fbb,_0x3e89ef);return _0x3b51ef[_0x8ffdc4(0x21c)]({'code':0x0,'data':_0x246a54});});});function getPwdFromToken(_0x411dd4,_0x2d953f,_0x267a22){const _0xd3e082=_0x43df68;let _0x15be76=_0x411dd4[_0xd3e082(0x1d0)]['spaceToken']||_0x411dd4['body'][_0xd3e082(0x1ea)]||_0x411dd4[_0xd3e082(0x1e6)][_0xd3e082(0x1d7)],_0x7db2df=dbPrivateSpaceTable['getTokenObjByToken'](_0x411dd4[_0xd3e082(0x189)][_0xd3e082(0x1f6)],_0x15be76);if(!_0x7db2df)return _0x2d953f[_0xd3e082(0x21c)]({'code':0x68});let _0x292e9c=_0x7db2df[_0xd3e082(0x221)];cryptoUtils['decryptString'](config['tokenPwdEncryptKey'],_0x292e9c)[_0xd3e082(0x1a3)](_0x3e920a=>{_0x267a22(_0x3e920a);})[_0xd3e082(0x220)](_0x3448ec=>{console['log'](_0x3448ec);});}router[_0x43df68(0x1f7)]('/getDecodeFile*',(_0x4131b7,_0x10e5d7,_0x14e667)=>{const _0x30f81f=_0x43df68;try{let _0x45d0de=_0x4131b7[_0x30f81f(0x1d0)][_0x30f81f(0x226)],_0x222de4=_0x4131b7['query']['indexId'],_0x1f733b=_0x4131b7[_0x30f81f(0x1d0)][_0x30f81f(0x19a)],_0x2c31ec=_0x4131b7[_0x30f81f(0x1d0)][_0x30f81f(0x196)];if(!_0x45d0de||!_0x222de4)return _0x4131b7[_0x30f81f(0x189)]['returnErrMsg'](_0x10e5d7,_0x30f81f(0x1b1));let _0x2dca33=dbPrivateSpaceTable[_0x30f81f(0x1b7)](_0x4131b7[_0x30f81f(0x189)]['dbOther'],_0x45d0de);if(!_0x2dca33)return _0x4131b7[_0x30f81f(0x189)][_0x30f81f(0x1ed)](_0x10e5d7,'space\x20id\x20is\x20invalid');getPwdFromToken(_0x4131b7,_0x10e5d7,_0x341079=>{const _0x497eee=_0x30f81f;let _0x41d0ee=getPrivateIndexDb(_0x2dca33['folder_path']),_0x21c25c=dbPrivateSpaceTable[_0x497eee(0x1a6)](_0x41d0ee,_0x222de4);if(!_0x21c25c)return _0x10e5d7[_0x497eee(0x192)](0x194)[_0x497eee(0x1f8)]();let _0x48447d='';function _0x4fc162(_0x48ab07){const _0x53a0a2=_0x497eee;return path[_0x53a0a2(0x1d8)](_0x48ab07[_0x53a0a2(0x1e0)](/[\\/]/g,path[_0x53a0a2(0x18e)]));}_0x2c31ec==_0x497eee(0x20b)?_0x48447d=path[_0x497eee(0x1ef)](path[_0x497eee(0x1d8)](path['join'](_0x2dca33[_0x497eee(0x20a)],_0x4fc162(_0x21c25c[_0x497eee(0x1fa)])))):_0x48447d=path['resolve'](path[_0x497eee(0x1d8)](path[_0x497eee(0x194)](_0x2dca33['folder_path'],_0x4fc162(_0x21c25c[_0x497eee(0x1ba)]))));if(_0x1f733b==0x1)try{let _0x44b7e6=Buffer[_0x497eee(0x240)](_0x21c25c[_0x497eee(0x1f4)],'base64')['toString']();const _0x90fd93=encodeURIComponent(_0x44b7e6)[_0x497eee(0x1e0)](/%([0-9A-F]{2})/g,(_0x42de38,_0x1f2f59)=>'%'+_0x1f2f59[_0x497eee(0x1a0)]());_0x10e5d7['setHeader'](_0x497eee(0x1c2),_0x497eee(0x1fe)+_0x90fd93);}catch(_0x21c68c){console[_0x497eee(0x18d)](_0x21c68c);}fs['stat'](_0x48447d,(_0x4e216e,_0x17c746)=>{const _0xb161bd=_0x497eee;if(_0x4e216e)return console['log'](_0xb161bd(0x229),_0x48447d),_0x10e5d7['status'](0x194)[_0xb161bd(0x1f8)]();if(_0x48447d['indexOf'](_0xb161bd(0x20b))==-0x1){let _0x3341b4=dbPrivateSpaceTable[_0xb161bd(0x18b)](_0x41d0ee,'check_time',new Date()[_0xb161bd(0x198)](),_0x222de4);}if(sharpUtil[_0xb161bd(0x1eb)](_0x21c25c[_0xb161bd(0x1d1)])&&_0x2c31ec!=_0xb161bd(0x20b)){let _0x51b464=cryptoUtils[_0xb161bd(0x21d)](_0x341079,_0x48447d);fileUtil[_0xb161bd(0x1f9)](_0x51b464)['then'](_0xe41676=>{const _0x373af2=_0xb161bd;sharpUtil[_0x373af2(0x22b)](_0x21c25c[_0x373af2(0x1d1)],_0xe41676,(_0x5d3f4a,_0x57281e,_0x4b0231)=>{const _0x59c3cc=_0x373af2;sharpUtil[_0x59c3cc(0x1eb)](_0x21c25c[_0x59c3cc(0x1d1)][_0x59c3cc(0x1df)]())?sharpUtil[_0x59c3cc(0x1ee)](_0x5d3f4a,null,![],null,'buffer',null,_0x1a57ed=>{const _0x501ce2=_0x59c3cc;_0x10e5d7[_0x501ce2(0x1f3)](Buffer[_0x501ce2(0x240)](_0x1a57ed));},_0x3dec0b=>{const _0x1300de=_0x59c3cc;return console[_0x1300de(0x18d)](_0x3dec0b),_0x10e5d7['status'](0x194)['end']();},_0x57281e,_0x4b0231):typeof _0x5d3f4a=='string'?(_0x10e5d7[_0x59c3cc(0x1da)](_0x5d3f4a),_0x10e5d7['on'](_0x59c3cc(0x23a),()=>{_0x57281e&&fs['rm'](_0x5d3f4a,_0x539c69=>{});})):_0x10e5d7[_0x59c3cc(0x1f3)](_0x5d3f4a);});});}else cryptoUtils[_0xb161bd(0x1dd)](_0x341079,_0x48447d,_0x10e5d7,_0x10e5d7);return;});});}catch(_0x3d0729){return console[_0x30f81f(0x18d)](_0x3d0729),_0x10e5d7['status'](0x194)[_0x30f81f(0x1f8)]();}}),router['post']('/exitSpaceId',(_0x45fe85,_0x50a4ec,_0x58e023)=>{const _0x31c152=_0x43df68;try{return dbPrivateSpaceTable['deleteSpaceToken'](_0x45fe85[_0x31c152(0x189)][_0x31c152(0x1f6)],_0x45fe85[_0x31c152(0x23b)][_0x31c152(0x226)]),_0x50a4ec[_0x31c152(0x192)](0xc8)[_0x31c152(0x1f8)]();}catch(_0x2dac4e){return console[_0x31c152(0x18d)](_0x2dac4e),_0x50a4ec[_0x31c152(0x192)](0x194)[_0x31c152(0x1f8)]();}}),module['exports']=router;