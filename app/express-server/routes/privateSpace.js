const _0x565cac=_0xa510;(function(_0x39d697,_0x5a8ec3){const _0x2f155b=_0xa510,_0x3e2d5d=_0x39d697();while(!![]){try{const _0x3e3657=-parseInt(_0x2f155b(0x267))/0x1+parseInt(_0x2f155b(0x25b))/0x2*(parseInt(_0x2f155b(0x221))/0x3)+-parseInt(_0x2f155b(0x27b))/0x4*(parseInt(_0x2f155b(0x255))/0x5)+parseInt(_0x2f155b(0x248))/0x6*(parseInt(_0x2f155b(0x226))/0x7)+parseInt(_0x2f155b(0x24d))/0x8+parseInt(_0x2f155b(0x244))/0x9+-parseInt(_0x2f155b(0x1f2))/0xa*(parseInt(_0x2f155b(0x256))/0xb);if(_0x3e3657===_0x5a8ec3)break;else _0x3e2d5d['push'](_0x3e2d5d['shift']());}catch(_0x878ee5){_0x3e2d5d['push'](_0x3e2d5d['shift']());}}}(_0x9ec2,0x8ee39));let express=require(_0x565cac(0x1ea)),router=express[_0x565cac(0x1f3)]();const Database=require('better-sqlite3');let dbPrivateSpaceTable=require(_0x565cac(0x209)),path=require(_0x565cac(0x26f)),fs=require('fs'),cryptoUtils=require(_0x565cac(0x22f));const config=require(_0x565cac(0x262));let privateSpaceUtils=require(_0x565cac(0x282));var faststart=require(_0x565cac(0x25e)),exifUtil=require(_0x565cac(0x281));let uploadUtil=require('../utils/uploadUtils');const PassThrough=require(_0x565cac(0x254))['PassThrough'],{Readable}=require(_0x565cac(0x254));let sha256=require(_0x565cac(0x206));const videoStreamUtil=require(_0x565cac(0x213));let fileUtil=require(_0x565cac(0x27c));const folderSignString=_0x565cac(0x21a),folderSignFileName=_0x565cac(0x1d1),configFolderName=_0x565cac(0x1db),noCheckFileList=[_0x565cac(0x28d)];let FFmpeg=require(_0x565cac(0x261))[_0x565cac(0x1e1)];const uploadPrivateUtil=require('../utils/uploadPrivateUtils'),privateSharpUtil=require(_0x565cac(0x282)),sharpUtil=require(_0x565cac(0x1f7)),transCodeUtil=require(_0x565cac(0x275));let dbArr=[];function checkSpaceId(_0x23dd0f,_0x31a64e){const _0x1e00e6=_0x565cac;let _0x3eba81=_0x23dd0f[_0x1e00e6(0x251)][_0x1e00e6(0x287)]||_0x23dd0f[_0x1e00e6(0x1cc)][_0x1e00e6(0x287)];if(!_0x3eba81)return _0x23dd0f[_0x1e00e6(0x1e4)]['returnErrMsg'](_0x31a64e,'space\x20id\x20is\x20null');let _0x4541b2=dbPrivateSpaceTable[_0x1e00e6(0x24a)](_0x23dd0f[_0x1e00e6(0x1e4)][_0x1e00e6(0x27a)],_0x3eba81);if(!_0x4541b2)return _0x23dd0f['app']['returnErrMsg'](_0x31a64e,'space\x20id\x20is\x20invalid');return!![];}function checkSpaceName(_0xb0d4e0,_0x1facb4,_0x45ccfb){const _0x40382b=_0x565cac;if(!_0x45ccfb)return _0xb0d4e0[_0x40382b(0x1e4)][_0x40382b(0x1f8)](_0x1facb4,_0x1facb4['__'](_0x40382b(0x245)));if(_0x45ccfb[_0x40382b(0x1d6)]>0x1e)return _0xb0d4e0[_0x40382b(0x1e4)]['returnErrMsg'](_0x1facb4,_0x1facb4['__'](_0x40382b(0x1eb)));return!![];}function getPrivateIndexDb(_0xecc463){const _0x265501=_0x565cac;let _0x541d18=config[_0x265501(0x280)](_0xecc463);for(let _0x1318a6 in dbArr){if(dbArr[_0x1318a6][_0x265501(0x222)]==_0x541d18)return dbArr[_0x1318a6]['db'];}let _0x32473d=new Database(_0x541d18,{});return _0x32473d['pragma'](_0x265501(0x283)),dbArr['push']({'dbPath':_0x541d18,'db':_0x32473d}),_0x32473d;}router['post'](_0x565cac(0x21d),(_0x52bbe9,_0x3b0d2f,_0x5aaeb6)=>{const _0x145d69=_0x565cac;let _0x44cb22=_0x52bbe9['body'][_0x145d69(0x1ec)],_0x527200=_0x52bbe9[_0x145d69(0x251)][_0x145d69(0x24f)],_0x5b8085=_0x52bbe9[_0x145d69(0x1d0)],_0x128157=_0x52bbe9[_0x145d69(0x251)]['spacePwd'];if(checkSpaceName(_0x52bbe9,_0x3b0d2f,_0x527200)!==!![])return;if(!_0x128157||_0x128157['length']<0x4)return _0x52bbe9['app'][_0x145d69(0x1f8)](_0x3b0d2f,_0x3b0d2f['__'](_0x145d69(0x1f5)));function _0x5a5abf(){return new Promise((_0x12b454,_0x586816)=>{const _0xd624f9=_0xa510;fs[_0xd624f9(0x208)](_0x44cb22,(_0xce87b1,_0x4bd78e)=>{const _0x5b48f7=_0xd624f9;if(_0xce87b1)return _0x586816(_0x3b0d2f['__'](_0x5b48f7(0x1f9)));if(_0x4bd78e['size']>0x400*0x400*0x400)return _0x52bbe9[_0x5b48f7(0x1e4)][_0x5b48f7(0x1f8)](_0x3b0d2f,_0x3b0d2f['__'](_0x5b48f7(0x1f9)));fs[_0x5b48f7(0x24b)](_0x44cb22,(_0x2d31b5,_0x157d21)=>{const _0x254d01=_0x5b48f7;for(let _0x1058c8 of _0x157d21){if(noCheckFileList[_0x254d01(0x220)](_0x1058c8)||_0x1058c8[_0x254d01(0x214)]('.')||_0x1058c8[_0x254d01(0x214)]('@'))continue;return _0x586816(_0x3b0d2f['__'](_0x254d01(0x1f9)));}_0x12b454();});});});}fs['access'](_0x44cb22,fs[_0x145d69(0x1d8)]['R_OK']|fs['constants']['W_OK'],_0x4486fc=>{const _0x1bad7c=_0x145d69;if(_0x4486fc)return _0x52bbe9[_0x1bad7c(0x1e4)]['returnErrMsg'](_0x3b0d2f,_0x3b0d2f['__'](_0x1bad7c(0x1da)));_0x5a5abf()['then'](()=>{const _0x19c2b2=_0x1bad7c;let _0x33fc29=dbPrivateSpaceTable['getBySpaceName'](_0x52bbe9['app'][_0x19c2b2(0x27a)],_0x527200);if(_0x33fc29)return _0x52bbe9['app'][_0x19c2b2(0x1f8)](_0x3b0d2f,_0x3b0d2f['__'](_0x19c2b2(0x200)));let _0x27cc8b=path[_0x19c2b2(0x21e)](_0x44cb22,configFolderName);fs[_0x19c2b2(0x260)](_0x27cc8b,{'recursive':!![]},_0x4d75b1=>{const _0x9e0c1c=_0x19c2b2;if(_0x4d75b1)return _0x52bbe9['app'][_0x9e0c1c(0x1f8)](_0x3b0d2f,_0x3b0d2f['__'](_0x9e0c1c(0x290))+JSON['stringify'](_0x4d75b1));let _0x67e5cd=getPrivateIndexDb(_0x44cb22);dbPrivateSpaceTable[_0x9e0c1c(0x23b)](_0x67e5cd,_0x44cb22),cryptoUtils[_0x9e0c1c(0x27d)](_0x128157,folderSignString)['then'](_0x4429c5=>{const _0x419021=_0x9e0c1c;let _0x52b43a=path[_0x419021(0x21e)](_0x27cc8b,folderSignFileName);fs['writeFile'](_0x52b43a,_0x4429c5,_0x2c4584=>{const _0x58b8bf=_0x419021;if(_0x2c4584)return _0x52bbe9['app'][_0x58b8bf(0x1f8)](_0x3b0d2f,_0x3b0d2f['__'](_0x58b8bf(0x290))+JSON['stringify'](_0x2c4584));return dbPrivateSpaceTable['create'](_0x52bbe9[_0x58b8bf(0x1e4)][_0x58b8bf(0x27a)],{'folder_path':_0x44cb22,'space_name':_0x527200,'create_uid':_0x5b8085['id']}),_0x3b0d2f[_0x58b8bf(0x239)]({'code':0x0});});})[_0x9e0c1c(0x278)](_0xb6fa72=>{const _0x10179b=_0x9e0c1c;return console[_0x10179b(0x27e)](_0x10179b(0x247),_0xb6fa72),_0x52bbe9[_0x10179b(0x1e4)][_0x10179b(0x1f8)](_0x3b0d2f,_0x3b0d2f['__'](_0x10179b(0x290))+JSON[_0x10179b(0x1fe)](_0xb6fa72));});});})[_0x1bad7c(0x278)](_0x469bc4=>{const _0x289a6b=_0x1bad7c;return _0x52bbe9[_0x289a6b(0x1e4)]['returnErrMsg'](_0x3b0d2f,_0x469bc4);});});}),router[_0x565cac(0x22d)](_0x565cac(0x238),(_0x4fa747,_0x12145b,_0x3792eb)=>{const _0x1593d6=_0x565cac;let _0x4becbe=[];return _0x4fa747[_0x1593d6(0x1d0)]['is_admin']==0x1?_0x4becbe=dbPrivateSpaceTable['getAll'](_0x4fa747[_0x1593d6(0x1e4)][_0x1593d6(0x27a)]):_0x4becbe=dbPrivateSpaceTable[_0x1593d6(0x23e)](_0x4fa747[_0x1593d6(0x1e4)]['dbOther'],_0x4fa747[_0x1593d6(0x1d0)]['id']),_0x12145b[_0x1593d6(0x239)]({'code':0x0,'data':_0x4becbe});});function checkSpacePwd(_0x750853,_0x4ae1dc,_0x548139){return new Promise((_0x2feb72,_0x57bbbc)=>{const _0xe5b6ef=_0xa510;_0x4ae1dc=Buffer[_0xe5b6ef(0x277)](_0x4ae1dc,_0xe5b6ef(0x1de))[_0xe5b6ef(0x1fa)]();let _0x1ff912=path['join'](_0x548139,configFolderName,folderSignFileName);fs[_0xe5b6ef(0x208)](_0x1ff912,(_0x5a6e2f,_0x59b242)=>{const _0x538c1c=_0xe5b6ef;if(_0x5a6e2f)return _0x57bbbc(_0x750853['__'](_0x538c1c(0x227)));fs[_0x538c1c(0x1f6)](_0x1ff912,_0x538c1c(0x242),(_0x158eae,_0x144ba0)=>{const _0x540e87=_0x538c1c;if(_0x158eae)return _0x57bbbc(_0x750853['__'](_0x540e87(0x227)));else cryptoUtils[_0x540e87(0x21f)](_0x4ae1dc,_0x144ba0)[_0x540e87(0x229)](_0x5d5683=>{const _0x3d3b41=_0x540e87;return _0x5d5683==folderSignString?_0x2feb72(_0x4ae1dc):_0x57bbbc(_0x750853['__'](_0x3d3b41(0x211)));})[_0x540e87(0x278)](_0x47904b=>{const _0x3bf4af=_0x540e87;return console[_0x3bf4af(0x27e)](_0x3bf4af(0x247),_0x47904b),_0x57bbbc(_0x750853['__'](_0x3bf4af(0x211)));});});});});}function _0x9ec2(){const _0x24bcac=['stream','4564525bbAcew','554312shCMcx','\x20WHERE\x20file_type=\x27','offsetCount','getTime','UPDATE\x20private_space_index\x20SET\x20original_time=\x27','4cmChwH','tiny','tokenPwdEncryptKey','../utils/faststart','video','mkdir','../../libs/nasTrans','../../myConfig/config','getDurationFromStream','temp','getIndexByWhere','size','135607ErgtoA','orderField','is_admin','private.spaceConfigFileBroken','status','tiny_path','genVideoTinyFile','sendFile','path','extname','private.fileNameTooLong','createIndex','filename','ids','../../utils/transCodeUtil','encryptFileFromInputPipe','from','catch','DateTimeOriginal','dbOther','4CZEFMi','../utils/fileUtils','encryptString','log','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','getPrivateDbPath','exifr','../utils/privateSpaceUtils','journal_mode\x20=\x20WAL','/updateSpaceName','private.noExist','folder_path','spaceId','uploadFile','/getFileList','encryptFile','START_WORKER_BG_TASK','space_token','.DS_Store','space_id','folderNotExist','operationFail','query','spacePwd','/deleteSpace','resolve','currentUser','nascabconfigenc','.mp4','streamToBuffer','\x20order\x20by\x20','space/index\x20id\x20is\x20null','length','dealFFmpegPath','constants','filename_enc','noWritePermission','nascabconfig','R_OK','CreateDate','base64','lastInsertRowid','attachment;\x20filename*=UTF-8\x27\x27','FFmpeg','\x20id=','message','app','delete','image','/exportSpace','desc','undefined','express','private.spaceNameTooLong','folderPath','getAllIndexByWhere','EXPORT_PRIVATE_SPACE','unlink','encodeFilename','toUpperCase','80pqyGuT','Router','ffprobe','private.spacePwdGtFour','readFile','../utils/sharpUtils','returnErrMsg','needEmptyFolderPrivateSpace','toString','close','over','createReadStream','stringify','end','private.hasSameNameSpace','\x20offset\x20','buffer','destination','getIndexByFileName','string','sha256','spaceToken','stat','../../db/dbPrivateSpaceTable','ifExtIsSpecialFormat','exports','updateIndexField','\x20limit\x20','space\x20id\x20is\x20invalid','savePath','toLowerCase','private.passwordIncorrect','indexId','../../utils/videoStreamUtil','startsWith','changes','private.spaceFolderNotExist','parse','private.uploadErrTryAgain','sep','nascabisthebest','targetFolderPath','other','/addPrivateSpace','join','decryptString','includes','268674rMdyry','dbPath','/getDecodeFile*','createToken','getVideoOriginalTime','889cMmiha','private.configFileReadFail','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','then','data','headers','/checkPwd','post','updateSpaceName','../utils/cryptoUtils','privateSpaceKey','create','private.onlyAdminCanDelete','normalize','getTokenObjByToken','check_time','push','access','/getAllSpace','json','ext','createIndexDb','\x27\x20where\x20id=','orderType','getAllByUid','indexOf','send','/regularUpload','utf-8','error\x20space\x20id','6681888TdZfCg','private.spaceNameCantNull','run','error','8634KXzuDO','W_OK','getById','readdir','prepare','7460960kjSCYU','deleteSpaceToken','spaceName','deleteIndex','body','download','destroy'];_0x9ec2=function(){return _0x24bcac;};return _0x9ec2();}router[_0x565cac(0x22d)](_0x565cac(0x22c),(_0x1ff351,_0x2a4f8f,_0x2f097d)=>{const _0x3db452=_0x565cac;let _0x4c4db2=_0x1ff351['body']['checkStr'],_0x34ea66=_0x1ff351[_0x3db452(0x251)]['spaceId'],_0x1958b0=dbPrivateSpaceTable['getById'](_0x1ff351['app'][_0x3db452(0x27a)],_0x34ea66);if(!_0x1958b0)return _0x1ff351[_0x3db452(0x1e4)][_0x3db452(0x1f8)](_0x2a4f8f,_0x3db452(0x243));fs['stat'](_0x1958b0[_0x3db452(0x286)],(_0xc11773,_0x3bd666)=>{const _0x54e438=_0x3db452;if(_0xc11773)return _0x1ff351[_0x54e438(0x1e4)][_0x54e438(0x1f8)](_0x2a4f8f,_0x2a4f8f['__'](_0x54e438(0x216)));checkSpacePwd(_0x2a4f8f,_0x4c4db2,_0x1958b0[_0x54e438(0x286)])[_0x54e438(0x229)](_0x308a50=>{const _0x23c88e=_0x54e438;let _0x7c579d=sha256(new Date()[_0x23c88e(0x259)]()+_0x34ea66+_0x308a50);cryptoUtils[_0x23c88e(0x27d)](config[_0x23c88e(0x25d)],_0x308a50)[_0x23c88e(0x229)](_0x49bb11=>{const _0x468ee8=_0x23c88e;return dbPrivateSpaceTable[_0x468ee8(0x224)](_0x1ff351['app']['dbOther'],{'space_id':_0x34ea66,'pwd':_0x49bb11,'token':_0x7c579d}),_0x2a4f8f[_0x468ee8(0x239)]({'code':0x0,'token':_0x7c579d});});})[_0x54e438(0x278)](_0x5b986f=>{const _0x261725=_0x54e438;return console[_0x261725(0x27e)](_0x261725(0x247),_0x5b986f),_0x1ff351[_0x261725(0x1e4)][_0x261725(0x1f8)](_0x2a4f8f,_0x5b986f);});});});function ffprobeSync(_0x305d13){return new Promise((_0x286f0d,_0x2d1caf)=>{const _0x2709e8=_0xa510;try{FFmpeg(transCodeUtil[_0x2709e8(0x1d7)](_0x305d13))[_0x2709e8(0x1f4)]((_0x4843ad,_0x30e031)=>{_0x4843ad?_0x2d1caf(_0x4843ad):_0x286f0d(_0x30e031);});}catch(_0x3411cb){console[_0x2709e8(0x27e)](_0x2709e8(0x247),_0x3411cb),_0x2d1caf(_0x3411cb);}});}function deleteFile(_0x4eb1da){fs['rm'](_0x4eb1da,{'maxRetries':0xa,'retryDelay':0x3e8},_0x28e86a=>{});}function uploadFail(_0x4866a4,_0x55c4da,_0x55e64a,_0xcbe762){const _0x2f8769=_0x565cac;return deleteFile(_0x55c4da),_0x55e64a['app'][_0x2f8769(0x1f8)](_0xcbe762,_0xcbe762['__'](_0x2f8769(0x218)));}function dealUploadImageOrFile(_0x28451b,_0x545d2b,_0x139f6b,_0x3bd726,_0x16e71a,_0x59eb39,_0x46611b,_0x18e744,_0x579f96){uploadPrivateUtil['uploadFile'](_0x139f6b,_0x3bd726,_0x16e71a,_0x59eb39,_0x188ea9=>{const _0x2c89c9=_0xa510;let _0x4b92f9=_0x188ea9[_0x2c89c9(0x26f)],_0x1eaf48=cryptoUtils['decryptFileGetStream'](_0x59eb39,_0x4b92f9),_0x415e6e=dbPrivateSpaceTable[_0x2c89c9(0x272)](_0x28451b,{'filename':new Buffer[(_0x2c89c9(0x277))](_0x18e744)[_0x2c89c9(0x1fa)]('base64'),'filename_enc':_0x16e71a,'file_type':_0x46611b,'ext':_0x579f96});if(_0x415e6e[_0x2c89c9(0x215)]<0x1)return uploadFail(_0x28451b,_0x4b92f9,_0x139f6b,_0x3bd726);let _0x4ea26a=_0x415e6e[_0x2c89c9(0x1df)];_0x3bd726[_0x2c89c9(0x239)]({'code':0x0});let _0x96771d=new Date()['getTime']();if(_0x46611b==_0x2c89c9(0x1e6)){var _0x42b1cc=[];let _0x21a08b=new PassThrough()['pipe'](_0x1eaf48);_0x21a08b['on'](_0x2c89c9(0x22a),function(_0x1aadd1){const _0x1f1f2a=_0x2c89c9;_0x42b1cc[_0x1f1f2a(0x236)](_0x1aadd1);}),_0x21a08b['on'](_0x2c89c9(0x1ff),function(){var _0x88eb1a=Buffer['concat'](_0x42b1cc);function _0x31cc4e(){const _0x1b972d=_0xa510;exifUtil[_0x1b972d(0x217)](_0x88eb1a)[_0x1b972d(0x229)](_0x5c058d=>{const _0x2c625f=_0x1b972d;if(_0x5c058d){let _0x505189=_0x5c058d[_0x2c625f(0x279)];_0x5c058d[_0x2c625f(0x1dd)]&&!_0x505189&&(_0x505189=_0x5c058d[_0x2c625f(0x1dd)]),_0x505189&&(_0x96771d=new Date(_0x505189)[_0x2c625f(0x259)](),_0x28451b[_0x2c625f(0x24c)](_0x2c625f(0x25a)+_0x96771d+_0x2c625f(0x23c)+_0x4ea26a)[_0x2c625f(0x246)]());}})[_0x1b972d(0x278)](_0x51bd44=>{});}privateSpaceUtils['genImageTinyFile'](_0x579f96,_0x88eb1a,_0x28bc6f=>{const _0x3f4323=_0xa510,_0x5d2531=Readable[_0x3f4323(0x277)](_0x28bc6f);let _0x318dc0=path[_0x3f4323(0x21e)](_0x545d2b,_0x16e71a);cryptoUtils['encryptFileFromInputPipe'](_0x59eb39,_0x5d2531,_0x318dc0)[_0x3f4323(0x229)](_0x4e1e83=>{const _0x5bbf49=_0x3f4323;let _0x12311a=path[_0x5bbf49(0x21e)](configFolderName,'tiny',_0x16e71a);_0x28451b[_0x5bbf49(0x24c)]('UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27'+_0x12311a+_0x5bbf49(0x23c)+_0x4ea26a)[_0x5bbf49(0x246)](),_0x31cc4e();});},_0x432dff=>{_0x31cc4e();});});}});}function dealUploadVideo(_0x5975c0,_0x6e0af0,_0x2dcca9,_0x26d2c9,_0x5b6e0a,_0x529d53,_0x4c74b4,_0x1187a3,_0x5f0256,_0x56582d,_0xcac924){const _0x390d87=_0x565cac;_0x5b6e0a[_0x390d87(0x1cc)][_0x390d87(0x20f)]=_0x26d2c9,_0x5b6e0a[_0x390d87(0x1cc)]['overMode']=_0x390d87(0x1fc),uploadUtil[_0x390d87(0x288)](_0x5b6e0a,_0x529d53,![],!![],![],_0x15a495=>{const _0x5d38c6=_0x390d87;let _0x8583ae=_0x15a495[_0x5d38c6(0x26f)],_0x71235a=path['join'](_0x15a495[_0x5d38c6(0x203)]);function _0x115999(_0x714cac){const _0x3e0b76=_0x5d38c6;ffprobeSync(_0x8583ae)[_0x3e0b76(0x229)](_0x2fc39d=>{const _0x369ad3=_0x3e0b76;let _0x567249=0x0;_0x567249=videoStreamUtil[_0x369ad3(0x263)](_0x2fc39d);let _0x1b3872=JSON[_0x369ad3(0x1fe)](_0x2fc39d['streams']),_0x4ce198=videoStreamUtil[_0x369ad3(0x225)](_0x2fc39d);fs[_0x369ad3(0x208)](_0x8583ae,(_0x4cf99,_0x3d6538)=>{const _0x2d2f4b=_0x369ad3;if(_0x4cf99){deleteFile(_0x8583ae);return;}let _0x3894cb='UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?';_0x5975c0['prepare'](_0x3894cb)[_0x2d2f4b(0x246)](_0x4ce198,parseInt(_0x567249),_0x3d6538[_0x2d2f4b(0x266)],_0x1b3872,_0x714cac);let _0x528f6e='tiny-'+Buffer[_0x2d2f4b(0x277)](_0x56582d)[_0x2d2f4b(0x1fa)](_0x2d2f4b(0x1de));privateSpaceUtils[_0x2d2f4b(0x26d)](_0x8583ae,_0x71235a,_0x528f6e,_0x4ebfcf=>{const _0x499bd7=_0x2d2f4b;fs[_0x499bd7(0x208)](_0x4ebfcf,(_0x20efa0,_0x11645d)=>{const _0xaffdcc=_0x499bd7;if(_0x20efa0){deleteFile(_0x8583ae);return;}let _0x3b24be=path[_0xaffdcc(0x21e)](_0x2dcca9,_0x4c74b4);cryptoUtils[_0xaffdcc(0x28a)](_0x1187a3,_0x4ebfcf,_0x3b24be)[_0xaffdcc(0x229)](_0x207cae=>{const _0x27aa47=_0xaffdcc;let _0x418756=path[_0x27aa47(0x21e)](configFolderName,_0x27aa47(0x25c),_0x4c74b4);_0x5975c0[_0x27aa47(0x24c)](_0x27aa47(0x27f)+_0x418756+'\x27\x20where\x20id='+_0x714cac)[_0x27aa47(0x246)](),deleteFile(_0x4ebfcf),deleteFile(_0x8583ae);});});},_0x32d29d=>{deleteFile(_0x8583ae);});});})['catch'](_0x1a957f=>{deleteFile(_0x8583ae);});}function _0x7d788c(){const _0x242706=_0x5d38c6;let _0x19bd3f=dbPrivateSpaceTable[_0x242706(0x272)](_0x5975c0,{'filename':new Buffer[(_0x242706(0x277))](_0x56582d)[_0x242706(0x1fa)]('base64'),'filename_enc':_0x4c74b4,'file_type':_0x5f0256,'ext':_0xcac924});return _0x19bd3f[_0x242706(0x215)]<0x1?uploadFail(_0x5975c0,_0x8583ae,_0x5b6e0a,_0x529d53):(_0x115999(_0x19bd3f[_0x242706(0x1df)]),_0x529d53['json']({'code':0x0}));}function _0x126555(_0x9a4941,_0x20bd74,_0x404ae5){const _0x14910b=_0x5d38c6;cryptoUtils['encryptFile'](_0x1187a3,_0x9a4941,_0x20bd74)['then'](_0x94d44e=>{_0x404ae5(_0x94d44e);})[_0x14910b(0x278)](_0x32c7a2=>{const _0x3b1e4d=_0x14910b;console[_0x3b1e4d(0x27e)](_0x32c7a2),uploadFail(_0x5975c0,_0x9a4941,_0x5b6e0a,_0x529d53);});}let _0x433cd6=path[_0x5d38c6(0x21e)](_0x6e0af0[_0x5d38c6(0x286)],_0x4c74b4);if(_0xcac924==_0x5d38c6(0x1d2)||_0xcac924=='.mov'){var _0x32808b=faststart[_0x5d38c6(0x1fd)](_0x8583ae,{'errorCallBack':_0x35c642=>{_0x126555(_0x8583ae,_0x433cd6,_0x7d788c);}});_0x32808b['on'](_0x5d38c6(0x1fb),function(){const _0x580d03=_0x5d38c6;_0x32808b[_0x580d03(0x253)]();}),cryptoUtils[_0x5d38c6(0x276)](_0x1187a3,_0x32808b,_0x433cd6)[_0x5d38c6(0x229)](_0x4ea4de=>{_0x7d788c();})[_0x5d38c6(0x278)](_0x4625aa=>{const _0x480383=_0x5d38c6;console[_0x480383(0x27e)](_0x480383(0x247),_0x4625aa),uploadFail(_0x5975c0,_0x8583ae,_0x5b6e0a,_0x529d53);});}else _0x126555(_0x8583ae,_0x433cd6,_0x7d788c);});}function _0xa510(_0xd89cdc,_0x55327c){const _0x9ec2e3=_0x9ec2();return _0xa510=function(_0xa51044,_0x117fa1){_0xa51044=_0xa51044-0x1cc;let _0x468013=_0x9ec2e3[_0xa51044];return _0x468013;},_0xa510(_0xd89cdc,_0x55327c);}router['post'](_0x565cac(0x241),function(_0x2579f1,_0x358461,_0x1e54b5){const _0x3820c9=_0x565cac;let _0x4b0b4e=_0x2579f1[_0x3820c9(0x1cc)][_0x3820c9(0x287)]||_0x2579f1['body'][_0x3820c9(0x287)]||_0x2579f1[_0x3820c9(0x22b)][_0x3820c9(0x28e)],_0x30b70a=_0x2579f1[_0x3820c9(0x1cc)]['filename']||_0x2579f1[_0x3820c9(0x22b)][_0x3820c9(0x273)],_0x2c2ea4=decodeURIComponent(_0x30b70a);_0x2579f1[_0x3820c9(0x1cc)]['encodeFilename']&&(_0x2c2ea4=fileUtil['decodePath'](_0x2579f1[_0x3820c9(0x1cc)][_0x3820c9(0x1f0)])),getPwdFromToken(_0x2579f1,_0x358461,_0x1b8407=>{const _0x2f78ed=_0x3820c9;let _0x30bc51=dbPrivateSpaceTable[_0x2f78ed(0x24a)](_0x2579f1[_0x2f78ed(0x1e4)][_0x2f78ed(0x27a)],_0x4b0b4e);if(!_0x30bc51)return _0x2579f1[_0x2f78ed(0x1e4)][_0x2f78ed(0x1f8)](_0x358461,_0x358461['__'](_0x2f78ed(0x285)));_0x2579f1[_0x2f78ed(0x1cc)][_0x2f78ed(0x20f)]=_0x30bc51['folder_path'];let _0x2c6243=getPrivateIndexDb(_0x30bc51[_0x2f78ed(0x286)]),_0x1d4da6=dbPrivateSpaceTable[_0x2f78ed(0x204)](_0x2c6243,new Buffer[(_0x2f78ed(0x277))](_0x2c2ea4)[_0x2f78ed(0x1fa)](_0x2f78ed(0x1de)));if(_0x1d4da6)return _0x2579f1[_0x2f78ed(0x1e4)][_0x2f78ed(0x1f8)](_0x358461,_0x358461['__']('private.alreadyHasSameNameFile'));let _0x3832ac=path[_0x2f78ed(0x270)](_0x2c2ea4)?path[_0x2f78ed(0x270)](_0x2c2ea4)['toLowerCase']():null,_0x2e7ffd=_0x2f78ed(0x21c);if(_0x3832ac){if(config['imgTypeList'][_0x2f78ed(0x220)](_0x3832ac['toLowerCase']())||config['rawImgTypeList'][_0x2f78ed(0x220)](_0x3832ac[_0x2f78ed(0x210)]()))_0x2e7ffd=_0x2f78ed(0x1e6);else config['videoTypeList']['includes'](_0x3832ac[_0x2f78ed(0x210)]())&&(_0x2e7ffd=_0x2f78ed(0x25f));}let _0x51c0e3=path[_0x2f78ed(0x21e)](_0x30bc51[_0x2f78ed(0x286)],configFolderName,_0x2f78ed(0x25c)),_0x1acf0b=path['join'](_0x30bc51[_0x2f78ed(0x286)],configFolderName,_0x2f78ed(0x264));function _0x23966b(){const _0x394ad6=_0x2f78ed;cryptoUtils[_0x394ad6(0x27d)](_0x1b8407,_0x2c2ea4)[_0x394ad6(0x229)](_0x5aadd7=>{const _0x20a731=_0x394ad6;if(_0x5aadd7[_0x20a731(0x1d6)]>0xf0)return _0x2579f1[_0x20a731(0x1e4)][_0x20a731(0x1f8)](_0x358461,_0x358461['__'](_0x20a731(0x271)));_0x2e7ffd==_0x20a731(0x25f)?dealUploadVideo(_0x2c6243,_0x30bc51,_0x51c0e3,_0x1acf0b,_0x2579f1,_0x358461,_0x5aadd7,_0x1b8407,_0x2e7ffd,_0x2c2ea4,_0x3832ac):dealUploadImageOrFile(_0x2c6243,_0x51c0e3,_0x2579f1,_0x358461,_0x5aadd7,_0x1b8407,_0x2e7ffd,_0x2c2ea4,_0x3832ac);});}fs['stat'](_0x51c0e3,(_0xfaf027,_0xaeb500)=>{function _0x25a432(){fs['stat'](_0x1acf0b,(_0x4b5534,_0x4251bf)=>{const _0x43e3e1=_0xa510;_0x4b5534?fs[_0x43e3e1(0x260)](_0x1acf0b,{'recursive':!![]},_0x3f5930=>{_0x23966b();}):_0x23966b();});}_0xfaf027?fs['mkdir'](_0x51c0e3,{'recursive':!![]},_0x2502e9=>{_0x25a432();}):_0x25a432();});});}),router[_0x565cac(0x22d)]('/importSpace',(_0x1c5da6,_0x704727,_0x1c1d45)=>{const _0x1f3f6e=_0x565cac;let _0x46e8c9=_0x1c5da6[_0x1f3f6e(0x251)][_0x1f3f6e(0x1ec)],_0x597550=_0x1c5da6[_0x1f3f6e(0x251)]['spaceName'],_0x5c8523=_0x1c5da6['currentUser'],_0x1e5ccb=_0x1c5da6[_0x1f3f6e(0x251)][_0x1f3f6e(0x1cd)];if(!_0x597550)return _0x1c5da6[_0x1f3f6e(0x1e4)][_0x1f3f6e(0x1f8)](_0x704727,_0x704727['__']('private.spaceNameCantNull'));let _0x238282=dbPrivateSpaceTable['getBySpaceName'](_0x1c5da6[_0x1f3f6e(0x1e4)][_0x1f3f6e(0x27a)],_0x597550);if(_0x238282)return _0x1c5da6[_0x1f3f6e(0x1e4)][_0x1f3f6e(0x1f8)](_0x704727,_0x704727['__'](_0x1f3f6e(0x200)));if(!_0x1e5ccb)return _0x1c5da6[_0x1f3f6e(0x1e4)][_0x1f3f6e(0x1f8)](_0x704727,_0x704727['__'](_0x1f3f6e(0x1f5)));fs[_0x1f3f6e(0x237)](_0x46e8c9,_0xa0611a=>{const _0x564437=_0x1f3f6e;if(_0xa0611a)return _0x1c5da6[_0x564437(0x1e4)][_0x564437(0x1f8)](_0x704727,_0x704727['__'](_0x564437(0x1da)));checkSpacePwd(_0x704727,_0x1e5ccb,_0x46e8c9)[_0x564437(0x229)](()=>{const _0x40d7ba=_0x564437;let _0x3681dc=config[_0x40d7ba(0x280)](_0x46e8c9);fs[_0x40d7ba(0x208)](_0x3681dc,(_0x505c8d,_0x2a9277)=>{const _0x4fcffc=_0x40d7ba;if(_0x505c8d)return _0x1c5da6['app'][_0x4fcffc(0x1f8)](_0x704727,_0x704727['__'](_0x4fcffc(0x26a)));return dbPrivateSpaceTable[_0x4fcffc(0x231)](_0x1c5da6[_0x4fcffc(0x1e4)][_0x4fcffc(0x27a)],{'folder_path':_0x46e8c9,'space_name':_0x597550,'create_uid':_0x5c8523['id']}),_0x704727[_0x4fcffc(0x239)]({'code':0x0});});})[_0x564437(0x278)](_0x27264f=>{const _0x1a5aa4=_0x564437;return _0x1c5da6[_0x1a5aa4(0x1e4)][_0x1a5aa4(0x1f8)](_0x704727,_0x27264f);});});}),router['post'](_0x565cac(0x1e7),(_0x15901c,_0x441f8c,_0x5b7cf2)=>{const _0x389260=_0x565cac;let _0x3d6f66=_0x15901c[_0x389260(0x251)][_0x389260(0x1ec)],_0x5b99a9=_0x15901c[_0x389260(0x251)][_0x389260(0x1cd)],_0x2074bc=_0x15901c[_0x389260(0x251)][_0x389260(0x21b)];if(!_0x5b99a9)return _0x15901c[_0x389260(0x1e4)][_0x389260(0x1f8)](_0x441f8c,_0x441f8c['__'](_0x389260(0x1f5)));fs[_0x389260(0x237)](_0x3d6f66,fs[_0x389260(0x1d8)][_0x389260(0x1dc)],_0x21dfc3=>{const _0x11bf24=_0x389260;if(_0x21dfc3)return _0x15901c['app']['returnErrMsg'](_0x441f8c,_0x441f8c['__'](_0x11bf24(0x1da)));fs[_0x11bf24(0x237)](_0x2074bc,fs[_0x11bf24(0x1d8)][_0x11bf24(0x249)],_0x36542c=>{const _0x39d0fd=_0x11bf24;if(_0x36542c)return _0x15901c[_0x39d0fd(0x1e4)][_0x39d0fd(0x1f8)](_0x441f8c,_0x441f8c['__'](_0x39d0fd(0x1da)));function _0x32f2d7(_0x3a3cf8){const _0x19408c=_0x39d0fd;cryptoUtils['encryptString'](config[_0x19408c(0x230)],_0x5b99a9)[_0x19408c(0x229)](_0x36968e=>{const _0x4fd6c2=_0x19408c;return _0x3a3cf8['app'][_0x4fd6c2(0x27a)][_0x4fd6c2(0x24c)](_0x4fd6c2(0x228))[_0x4fd6c2(0x246)](_0x4fd6c2(0x1ee),JSON[_0x4fd6c2(0x1fe)]({'folderPath':_0x3d6f66,'targetFolderPath':_0x2074bc,'spacePwd':_0x36968e})),process[_0x4fd6c2(0x240)]({'type':_0x4fd6c2(0x28b)}),_0x441f8c[_0x4fd6c2(0x239)]({'code':0x0});});}let _0x265b8a=path[_0x39d0fd(0x21e)](_0x3d6f66,configFolderName,folderSignFileName);fs[_0x39d0fd(0x208)](_0x265b8a,(_0x5a6e8f,_0x532da4)=>{const _0x93fbca=_0x39d0fd;_0x5a6e8f?_0x32f2d7(_0x15901c):checkSpacePwd(_0x441f8c,_0x5b99a9,_0x3d6f66)[_0x93fbca(0x229)](()=>{_0x32f2d7(_0x15901c);})[_0x93fbca(0x278)](_0x3e536e=>{const _0x57409d=_0x93fbca;return console['log'](_0x3e536e),_0x15901c[_0x57409d(0x1e4)][_0x57409d(0x1f8)](_0x441f8c,_0x441f8c['__']('private.passwordIncorrect'));});});});});}),router[_0x565cac(0x22d)]('/deleteSpaceFiles',(_0x2c013e,_0x18dd89,_0x48b275)=>{const _0x463232=_0x565cac;let _0x58356f=_0x2c013e[_0x463232(0x251)][_0x463232(0x287)],_0x283f3e=_0x2c013e[_0x463232(0x251)][_0x463232(0x274)];if(!_0x283f3e||_0x283f3e[_0x463232(0x1d6)]<0x1)return _0x18dd89['status'](0x194)[_0x463232(0x1ff)]();let _0x45052d=dbPrivateSpaceTable[_0x463232(0x24a)](_0x2c013e[_0x463232(0x1e4)][_0x463232(0x27a)],_0x58356f);if(!_0x45052d)return _0x18dd89[_0x463232(0x26b)](0x194)[_0x463232(0x1ff)]();if(_0x2c013e[_0x463232(0x1d0)][_0x463232(0x269)]!=0x1){if(_0x45052d['create_uid']!=_0x2c013e[_0x463232(0x1d0)]['id'])return _0x18dd89['json']({'code':0x1,'message':_0x18dd89['__'](_0x463232(0x232))});}try{let _0x21c18b=getPrivateIndexDb(_0x45052d[_0x463232(0x286)]),_0x34c69e=JSON[_0x463232(0x217)](_0x283f3e),_0x36b2e6=0x0,_0x1919b6=[],_0x1ee466=0x0,_0x12af22=0x0;if(_0x34c69e[_0x463232(0x1d6)]<0x1)return _0x18dd89[_0x463232(0x239)]({'code':0x0,'deleteList':_0x1919b6,'deleteCount':_0x36b2e6,'errCount':_0x1ee466});for(let _0x1b7968=0x0;_0x1b7968<_0x34c69e[_0x463232(0x1d6)];_0x1b7968++){let _0xfa03e8=dbPrivateSpaceTable[_0x463232(0x265)](_0x21c18b,_0x463232(0x1e2)+_0x34c69e[_0x1b7968]);if(!_0xfa03e8)return _0x2c013e[_0x463232(0x1e4)][_0x463232(0x1f8)](_0x18dd89,_0x18dd89['__'](_0x463232(0x28f)));let _0x1ab8b6=path[_0x463232(0x21e)](_0x45052d['folder_path'],_0xfa03e8[_0x463232(0x1d9)]);if(_0xfa03e8[_0x463232(0x26c)]&&_0xfa03e8['tiny_path']!=_0x463232(0x1e9)){let _0x51e277=path[_0x463232(0x21e)](_0x45052d['folder_path'],_0xfa03e8[_0x463232(0x26c)]);try{fs['unlink'](_0x51e277,_0x364808=>{});}catch(_0x5b2971){}}fs[_0x463232(0x1ef)](_0x1ab8b6,_0x20f8b5=>{const _0x3c865d=_0x463232;_0x12af22+=0x1;_0x20f8b5?(console[_0x3c865d(0x27e)]('err',_0x20f8b5[_0x3c865d(0x1e3)]),_0x1ee466+=0x1):(_0x36b2e6+=0x1,_0x1919b6['push'](_0x34c69e[_0x1b7968]));dbPrivateSpaceTable[_0x3c865d(0x250)](_0x21c18b,_0x34c69e[_0x1b7968]);if(_0x12af22==_0x34c69e[_0x3c865d(0x1d6)])return _0x18dd89[_0x3c865d(0x239)]({'code':0x0,'deleteList':_0x1919b6,'deleteCount':_0x36b2e6,'errCount':_0x1ee466});});}}catch(_0x511d36){return console[_0x463232(0x27e)](_0x463232(0x247),_0x511d36),_0x18dd89['json']({'code':0x1,'message':JSON[_0x463232(0x1fe)](_0x511d36)});}}),router[_0x565cac(0x22d)](_0x565cac(0x1ce),(_0x58728e,_0x36b8ae,_0x5ac410)=>{const _0x1b61f3=_0x565cac;if(checkSpaceId(_0x58728e,_0x36b8ae)!==!![])return;let _0x51129a=_0x58728e[_0x1b61f3(0x251)][_0x1b61f3(0x287)],_0x55ac7b=dbPrivateSpaceTable[_0x1b61f3(0x24a)](_0x58728e[_0x1b61f3(0x1e4)][_0x1b61f3(0x27a)],_0x51129a);if(_0x58728e[_0x1b61f3(0x1d0)]['is_admin']!=0x1){if(_0x55ac7b['create_uid']!=_0x58728e[_0x1b61f3(0x1d0)]['id'])return _0x36b8ae['json']({'code':0x1,'message':_0x36b8ae['__']('private.onlyAdminCanDelete')});}return dbPrivateSpaceTable[_0x1b61f3(0x1e5)](_0x58728e['app'][_0x1b61f3(0x27a)],_0x51129a),_0x36b8ae['json']({'code':0x0});}),router[_0x565cac(0x22d)](_0x565cac(0x284),(_0x4df200,_0x5b2c82,_0x26402d)=>{const _0x56bad4=_0x565cac;let _0x3d17e9=_0x4df200[_0x56bad4(0x251)][_0x56bad4(0x24f)],_0x1fe657=_0x4df200[_0x56bad4(0x251)]['spaceId'];if(checkSpaceId(_0x4df200,_0x5b2c82)!==!![])return;if(checkSpaceName(_0x4df200,_0x5b2c82,_0x3d17e9)!==!![])return;let _0x59d1fe=dbPrivateSpaceTable[_0x56bad4(0x24a)](_0x4df200[_0x56bad4(0x1e4)][_0x56bad4(0x27a)],_0x1fe657);if(_0x4df200[_0x56bad4(0x1d0)][_0x56bad4(0x269)]!=0x1){if(_0x59d1fe['create_uid']!=_0x4df200[_0x56bad4(0x1d0)]['id'])return _0x5b2c82[_0x56bad4(0x239)]({'code':0x1,'message':_0x5b2c82['__'](_0x56bad4(0x232))});}return dbPrivateSpaceTable[_0x56bad4(0x22e)](_0x4df200[_0x56bad4(0x1e4)][_0x56bad4(0x27a)],_0x3d17e9,_0x1fe657),_0x5b2c82['json']({'code':0x0});}),router['post'](_0x565cac(0x289),(_0x16ff07,_0x31ac34,_0xe22cf3)=>{const _0x4e7984=_0x565cac;let _0x353b39=_0x16ff07[_0x4e7984(0x251)][_0x4e7984(0x287)];if(!_0x353b39)return _0x16ff07[_0x4e7984(0x1e4)][_0x4e7984(0x1f8)](_0x31ac34,'space\x20id\x20is\x20null');let _0x2d85d3=dbPrivateSpaceTable[_0x4e7984(0x24a)](_0x16ff07['app'][_0x4e7984(0x27a)],_0x353b39);if(!_0x2d85d3)return _0x16ff07['app'][_0x4e7984(0x1f8)](_0x31ac34,_0x4e7984(0x20e));let _0x3d22fc=config[_0x4e7984(0x280)](_0x2d85d3[_0x4e7984(0x286)]);fs[_0x4e7984(0x208)](_0x3d22fc,(_0x34f7ee,_0x404080)=>{const _0x17cbcd=_0x4e7984;if(_0x34f7ee)return _0x16ff07[_0x17cbcd(0x1e4)]['returnErrMsg'](_0x31ac34,_0x31ac34['__'](_0x17cbcd(0x26a)));let _0x32a723=_0x16ff07[_0x17cbcd(0x251)]['count']||0x64,_0x1a731e=_0x16ff07['body'][_0x17cbcd(0x258)]||0x0,_0x2f499b=_0x16ff07['body'][_0x17cbcd(0x268)]||'id',_0x5b0917=_0x16ff07[_0x17cbcd(0x251)][_0x17cbcd(0x23d)]||_0x17cbcd(0x1e8),_0x99e3e3=_0x16ff07[_0x17cbcd(0x251)]['fileType'],_0x425b1c=getPrivateIndexDb(_0x2d85d3['folder_path']),_0x26a26f='';_0x99e3e3&&_0x99e3e3!='all'&&(_0x26a26f+=_0x17cbcd(0x257)+_0x99e3e3+'\x27');_0x26a26f+=_0x17cbcd(0x1d4)+_0x2f499b+'\x20'+_0x5b0917+_0x17cbcd(0x20d)+_0x32a723+_0x17cbcd(0x201)+_0x1a731e;let _0xbe22c9=dbPrivateSpaceTable[_0x17cbcd(0x1ed)](_0x425b1c,_0x26a26f);return _0x31ac34[_0x17cbcd(0x239)]({'code':0x0,'data':_0xbe22c9});});});function getPwdFromToken(_0x5bb1c6,_0x1e874c,_0x2c925e){const _0xa57b68=_0x565cac;let _0x4a704e=_0x5bb1c6[_0xa57b68(0x1cc)]['spaceToken']||_0x5bb1c6[_0xa57b68(0x251)][_0xa57b68(0x207)]||_0x5bb1c6[_0xa57b68(0x22b)][_0xa57b68(0x28c)],_0x71ea3f=dbPrivateSpaceTable[_0xa57b68(0x234)](_0x5bb1c6[_0xa57b68(0x1e4)][_0xa57b68(0x27a)],_0x4a704e);if(!_0x71ea3f)return _0x1e874c[_0xa57b68(0x239)]({'code':0x68});let _0x11a763=_0x71ea3f['pwd'];cryptoUtils[_0xa57b68(0x21f)](config[_0xa57b68(0x25d)],_0x11a763)[_0xa57b68(0x229)](_0x46fe83=>{_0x2c925e(_0x46fe83);})[_0xa57b68(0x278)](_0x5a6bd7=>{const _0x457838=_0xa57b68;console[_0x457838(0x27e)](_0x5a6bd7);});}router['get'](_0x565cac(0x223),(_0x331471,_0x55e831,_0x3eb6b9)=>{const _0xac3190=_0x565cac;try{let _0x313be2=_0x331471['query']['spaceId'],_0x1dafc1=_0x331471[_0xac3190(0x1cc)][_0xac3190(0x212)],_0x53095a=_0x331471[_0xac3190(0x1cc)][_0xac3190(0x252)],_0x58aba0=_0x331471[_0xac3190(0x1cc)]['type'];if(!_0x313be2||!_0x1dafc1)return _0x331471[_0xac3190(0x1e4)]['returnErrMsg'](_0x55e831,_0xac3190(0x1d5));let _0x3152da=dbPrivateSpaceTable['getById'](_0x331471['app'][_0xac3190(0x27a)],_0x313be2);if(!_0x3152da)return _0x331471[_0xac3190(0x1e4)][_0xac3190(0x1f8)](_0x55e831,'space\x20id\x20is\x20invalid');getPwdFromToken(_0x331471,_0x55e831,_0x7410a7=>{const _0x38026d=_0xac3190;let _0x4ae910=getPrivateIndexDb(_0x3152da['folder_path']),_0x9b017c=dbPrivateSpaceTable['getIndexById'](_0x4ae910,_0x1dafc1);if(!_0x9b017c)return _0x55e831[_0x38026d(0x26b)](0x194)[_0x38026d(0x1ff)]();let _0x589b47='';function _0x455c1f(_0x4bf902){const _0x18a5ee=_0x38026d;return path[_0x18a5ee(0x233)](_0x4bf902['replace'](/[\\/]/g,path[_0x18a5ee(0x219)]));}_0x58aba0==_0x38026d(0x25c)?_0x589b47=path[_0x38026d(0x1cf)](path[_0x38026d(0x233)](path[_0x38026d(0x21e)](_0x3152da[_0x38026d(0x286)],_0x455c1f(_0x9b017c[_0x38026d(0x26c)])))):_0x589b47=path[_0x38026d(0x1cf)](path[_0x38026d(0x233)](path['join'](_0x3152da[_0x38026d(0x286)],_0x455c1f(_0x9b017c['filename_enc']))));if(_0x53095a==0x1)try{let _0x4b50a0=Buffer['from'](_0x9b017c[_0x38026d(0x273)],_0x38026d(0x1de))['toString']();const _0x30ee2c=encodeURIComponent(_0x4b50a0)['replace'](/%([0-9A-F]{2})/g,(_0x369aa4,_0x78170a)=>'%'+_0x78170a[_0x38026d(0x1f1)]());_0x55e831['setHeader']('Content-Disposition',_0x38026d(0x1e0)+_0x30ee2c);}catch(_0x7d314f){console[_0x38026d(0x27e)](_0x7d314f);}fs[_0x38026d(0x208)](_0x589b47,(_0x5dfb7e,_0x29f895)=>{const _0x51e56d=_0x38026d;if(_0x5dfb7e)return console['log']('not\x20found',_0x589b47),_0x55e831['status'](0x194)[_0x51e56d(0x1ff)]();if(_0x589b47[_0x51e56d(0x23f)](_0x51e56d(0x25c))==-0x1){let _0x3f73a1=dbPrivateSpaceTable[_0x51e56d(0x20c)](_0x4ae910,_0x51e56d(0x235),new Date()[_0x51e56d(0x259)](),_0x1dafc1);}if(sharpUtil[_0x51e56d(0x20a)](_0x9b017c['ext'])&&_0x58aba0!='tiny'){let _0x5ca991=cryptoUtils['decryptFileGetStream'](_0x7410a7,_0x589b47);fileUtil[_0x51e56d(0x1d3)](_0x5ca991)[_0x51e56d(0x229)](_0x3712b0=>{const _0x2a811d=_0x51e56d;sharpUtil['transSpcielFormatFromBuffer'](_0x9b017c[_0x2a811d(0x23a)],_0x3712b0,(_0x2607e6,_0x3640eb,_0xef1e48)=>{const _0x4166f6=_0x2a811d;sharpUtil[_0x4166f6(0x20a)](_0x9b017c[_0x4166f6(0x23a)][_0x4166f6(0x210)]())?sharpUtil['sharpDealImg'](_0x2607e6,null,![],null,_0x4166f6(0x202),null,_0x36b100=>{const _0x510e62=_0x4166f6;_0x55e831['send'](Buffer[_0x510e62(0x277)](_0x36b100));},_0x1980fc=>{const _0x5446ed=_0x4166f6;return console[_0x5446ed(0x27e)](_0x1980fc),_0x55e831['status'](0x194)[_0x5446ed(0x1ff)]();},_0x3640eb,_0xef1e48):typeof _0x2607e6==_0x4166f6(0x205)?(_0x55e831[_0x4166f6(0x26e)](_0x2607e6),_0x55e831['on'](_0x4166f6(0x1fb),()=>{_0x3640eb&&fs['rm'](_0x2607e6,_0x5d4fe6=>{});})):_0x55e831[_0x4166f6(0x240)](_0x2607e6);});});}else cryptoUtils['decryptFile'](_0x7410a7,_0x589b47,_0x55e831,_0x55e831);return;});});}catch(_0x30c10f){return console[_0xac3190(0x27e)](_0x30c10f),_0x55e831[_0xac3190(0x26b)](0x194)[_0xac3190(0x1ff)]();}}),router['post']('/exitSpaceId',(_0x2d4316,_0x5cce94,_0x14b74e)=>{const _0x24ce70=_0x565cac;try{return dbPrivateSpaceTable[_0x24ce70(0x24e)](_0x2d4316['app'][_0x24ce70(0x27a)],_0x2d4316[_0x24ce70(0x251)][_0x24ce70(0x287)]),_0x5cce94[_0x24ce70(0x26b)](0xc8)['end']();}catch(_0x18150e){return console[_0x24ce70(0x27e)](_0x18150e),_0x5cce94[_0x24ce70(0x26b)](0x194)[_0x24ce70(0x1ff)]();}}),module[_0x565cac(0x20b)]=router;