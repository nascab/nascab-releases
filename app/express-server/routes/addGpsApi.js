function _0x4bd3(){const _0x135c33=['getAllByWhere','getByWhere','1451544DzsXvd','join','longitude','power_change','whereStr','GPSLongitude','mode','INDEX_TABLE_NAME_PHOTO','381scGvLn','substring','filename','run','3619bwxwzh','1997019yEJMeb','length','push','../../db/dbFileIndexTable','toString','paramsList','data','GPSLatitudeRef','35RcaUBU','76902BEymuq','mtime','json','indexIdList','sep','app','dbFileIndex','doUserCanGet','\x20order\x20by\x20abs(original_time-?)\x20asc\x20limit\x2050','40520pZWAHk','UPDATE\x20file_index_photo\x20set\x20add_gps_status=2\x20WHERE\x20id\x20IN\x20','\x20latitude=?,longitude=?,geohash=?,geohash5=?,geohash4=?,geohash3=?,geohash2=?\x20','body','fullPath','GPSIFD','binary','59311nBPSiV','encode','insert','updateById','original_time','GPSLongitudeRef','utimes','UPDATE\x20file_index_photo\x20set\x20add_gps_status=1\x20WHERE\x20id\x20IN\x20','writeFile','prepare','log','ngeohash','currentUser','abs','add_gps_status','is_admin','floor','1042rXrbPt','photo','undefined','GPS','statSync','post','updateBySql','\x20\x20latitude\x20is\x20not\x20null\x20and\x20latitude!=\x27undefined\x27\x20and\x20geohash5\x20!=\x27undefined\x27\x20and\x20original_time\x20between\x20?\x20and\x20?\x20\x20and\x20(width>=?\x20or\x20height>=?)\x20\x20','getUserPathWhere','stat','piexifjs','CONFIRM','Router','path','dump','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20(width>=?\x20and\x20height>=?)\x20','ctimeMs','from','1305291NCZnli','360QeVMyJ','type'];_0x4bd3=function(){return _0x135c33;};return _0x4bd3();}function _0x2270(_0x549401,_0x5ca521){const _0x4bd3c0=_0x4bd3();return _0x2270=function(_0x2270dd,_0x4c15a9){_0x2270dd=_0x2270dd-0x100;let _0x459214=_0x4bd3c0[_0x2270dd];return _0x459214;},_0x2270(_0x549401,_0x5ca521);}const _0x4a2c19=_0x2270;(function(_0x47f4ba,_0x297bcc){const _0x2a2b2e=_0x2270,_0x4cdf04=_0x47f4ba();while(!![]){try{const _0x40c510=-parseInt(_0x2a2b2e(0x130))/0x1*(parseInt(_0x2a2b2e(0x111))/0x2)+parseInt(_0x2a2b2e(0x123))/0x3+-parseInt(_0x2a2b2e(0x128))/0x4+-parseInt(_0x2a2b2e(0x13d))/0x5*(parseInt(_0x2a2b2e(0x13e))/0x6)+parseInt(_0x2a2b2e(0x100))/0x7*(-parseInt(_0x2a2b2e(0x124))/0x8)+-parseInt(_0x2a2b2e(0x135))/0x9+-parseInt(_0x2a2b2e(0x147))/0xa*(-parseInt(_0x2a2b2e(0x134))/0xb);if(_0x40c510===_0x297bcc)break;else _0x4cdf04['push'](_0x4cdf04['shift']());}catch(_0x32ac52){_0x4cdf04['push'](_0x4cdf04['shift']());}}}(_0x4bd3,0x7d783));let express=require('express'),router=express[_0x4a2c19(0x11d)](),path=require('path');const dbUserTable=require('../../db/dbUserTable'),dbFileIndexTable=require(_0x4a2c19(0x138));let fs=require('fs'),piexif=require(_0x4a2c19(0x11b)),geohash=require(_0x4a2c19(0x10b));function getWaitAddGpsIndex(_0x4c7761,_0x362c62,_0x51831a){const _0x2b5007=_0x4a2c19;let _0x463869=0x7d0,_0x38c146=_0x2b5007(0x120)+_0x362c62,_0x52cec0=[parseInt(_0x463869),parseInt(_0x463869),..._0x51831a],_0x2e8acc=dbFileIndexTable[_0x2b5007(0x127)](_0x4c7761,_0x38c146,'*',dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],_0x52cec0);if(_0x2e8acc){let _0x12b57c=_0x2e8acc[_0x2b5007(0x104)]-0xe10*0x3e8*0xc,_0xeb366c=_0x2e8acc['original_time']+0xe10*0x3e8*0xc,_0x4e6c45=_0x2b5007(0x118)+_0x362c62+_0x2b5007(0x146),_0x1e8bc3=[parseInt(_0x12b57c),parseInt(_0xeb366c),parseInt(_0x463869),parseInt(_0x463869),..._0x51831a,parseInt(_0x2e8acc['original_time'])],_0x487a32=dbFileIndexTable[_0x2b5007(0x126)](_0x4c7761,_0x4e6c45,'*',dbFileIndexTable[_0x2b5007(0x12f)],_0x1e8bc3);if(_0x487a32&&_0x487a32['length']>0x0){let _0x523f6f=[];if(_0x2e8acc[_0x2b5007(0x12e)]&&_0x2e8acc[_0x2b5007(0x12e)]!=_0x2b5007(0x113)){let _0x53fce3=0x32,_0x4d52d4=_0x2e8acc[_0x2b5007(0x104)]-0xe10*0x3e8*0x3,_0x59794e=_0x2e8acc[_0x2b5007(0x104)]+0xe10*0x3e8*0x3;if(_0x2e8acc[_0x2b5007(0x12e)]&&_0x2e8acc[_0x2b5007(0x12e)]!=_0x2b5007(0x113)){let _0x1baf48='\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20mode=?\x20and\x20original_time\x20between\x20?\x20and\x20?\x20\x20'+_0x362c62+'\x20order\x20by\x20original_time\x20limit\x20?',_0x24185d=[_0x2e8acc[_0x2b5007(0x12e)],parseInt(_0x4d52d4),parseInt(_0x59794e),..._0x51831a,parseInt(_0x53fce3)];_0x523f6f=dbFileIndexTable[_0x2b5007(0x126)](_0x4c7761,_0x1baf48,'*',dbFileIndexTable[_0x2b5007(0x12f)],_0x24185d);}}else _0x523f6f[_0x2b5007(0x137)](_0x2e8acc);for(let _0x1e71be in _0x523f6f){_0x523f6f[_0x1e71be][_0x2b5007(0x14b)]=path[_0x2b5007(0x129)](_0x523f6f[_0x1e71be]['path'],_0x523f6f[_0x1e71be][_0x2b5007(0x132)]);}if(_0x523f6f[_0x2b5007(0x136)]==0x1)return dbFileIndexTable[_0x2b5007(0x103)](_0x4c7761,_0x523f6f[0x0]['id'],_0x2b5007(0x10e),0x1,dbFileIndexTable[_0x2b5007(0x12f)]),getWaitAddGpsIndex(_0x4c7761,_0x362c62,_0x51831a);return{'dealList':_0x523f6f,'nearIndex':_0x487a32};}else return dbFileIndexTable[_0x2b5007(0x103)](_0x4c7761,_0x2e8acc['id'],_0x2b5007(0x10e),0x1,dbFileIndexTable[_0x2b5007(0x12f)]),getWaitAddGpsIndex(_0x4c7761,_0x362c62,_0x51831a);}else return![];}router[_0x4a2c19(0x116)]('/getWaitAddGpsIndex',(_0x2fd103,_0x268901,_0x3152f8)=>{const _0x39950b=_0x4a2c19;let _0x33a6e1={'code':0x0,'data':''};if(dbUserTable[_0x39950b(0x145)](_0x2fd103,_0x268901,'photo','power_get')==!![]){let _0x1f178f='',_0x576050=[];if(_0x2fd103[_0x39950b(0x10c)][_0x39950b(0x10f)]!=0x1){let _0x20d07d=dbUserTable[_0x39950b(0x119)](_0x2fd103,'photo','power_get',!![]);_0x1f178f=_0x20d07d[_0x39950b(0x12c)],_0x576050=_0x20d07d[_0x39950b(0x13a)];}let _0x317da9=getWaitAddGpsIndex(_0x2fd103[_0x39950b(0x143)][_0x39950b(0x144)],_0x1f178f,_0x576050);return _0x317da9&&(_0x33a6e1[_0x39950b(0x13b)]=_0x317da9),_0x268901[_0x39950b(0x140)](_0x33a6e1);}}),router[_0x4a2c19(0x116)]('/confirmAddGps',(_0x59a5cc,_0x302a14,_0x3d8051)=>{const _0x57ecb4=_0x4a2c19;let _0x3f8ab6=_0x59a5cc['body'][_0x57ecb4(0x125)],_0x3ecee2=_0x59a5cc['body'][_0x57ecb4(0x141)];if(_0x3ecee2[_0x57ecb4(0x136)]<0x1)return _0x302a14[_0x57ecb4(0x140)]({'code':0x0});_0x3c9215();function _0x3c9215(){const _0x325110=_0x57ecb4;if(dbUserTable['doUserCanGet'](_0x59a5cc,_0x302a14,_0x325110(0x112),_0x325110(0x12b))==!![]){let _0x23906f='(';for(let _0x403bf7 in _0x3ecee2){_0x23906f+=_0x3ecee2[_0x403bf7],_0x403bf7!=_0x3ecee2['length']-0x1&&(_0x23906f+=',');}_0x23906f+=')';if(_0x3f8ab6=='SKIP')return _0x59a5cc[_0x325110(0x143)]['dbFileIndex'][_0x325110(0x109)](_0x325110(0x148)+_0x23906f+'\x20')[_0x325110(0x133)](),_0x302a14[_0x325110(0x140)]({'code':0x0});else{if(_0x3f8ab6==_0x325110(0x11c)){let _0x2e06eb=_0x59a5cc[_0x325110(0x14a)]['latitude'],_0x3903f5=_0x59a5cc['body'][_0x325110(0x12a)];if(!_0x2e06eb||!_0x3903f5)return _0x302a14[_0x325110(0x140)]({'code':0x0});_0x59a5cc['app'][_0x325110(0x144)]['prepare'](_0x325110(0x107)+_0x23906f+'\x20')[_0x325110(0x133)]();let _0x15d410=0x0,_0x260b9b=0x0;for(let _0x4f142b in _0x3ecee2){let _0x5ba4d9=dbFileIndexTable['getById'](_0x59a5cc['app'][_0x325110(0x144)],_0x3ecee2[_0x4f142b]);if(!_0x5ba4d9)continue;let _0x585083=path['join'](_0x5ba4d9['path'],path[_0x325110(0x142)],_0x5ba4d9[_0x325110(0x132)]),_0x248464=fs[_0x325110(0x115)](_0x585083);if(!_0x248464['isFile']()){_0x260b9b+=0x1,_0x20bcdd();continue;}fs['readFile'](_0x585083,(_0xd67211,_0xa6e148)=>{const _0x2fa914=_0x325110;if(_0xd67211)return _0x260b9b+=0x1,_0x20bcdd();let _0x4b4714=null;try{_0x4b4714=piexif['load'](_0xa6e148[_0x2fa914(0x139)](_0x2fa914(0x14d)));}catch(_0x32427d){console[_0x2fa914(0x10a)](_0x32427d);}if(!_0x4b4714)return _0x260b9b+=0x1,_0x20bcdd();if(_0x2e06eb&&_0x3903f5){function _0x565c62(_0x2b7468){const _0x3cf64d=_0x2fa914;try{_0x2b7468=Number(_0x2b7468);let _0x1b8284=Math[_0x3cf64d(0x110)](Math[_0x3cf64d(0x10d)](_0x2b7468)),_0x2e9ad5=(Math[_0x3cf64d(0x10d)](_0x2b7468)-_0x1b8284)*0x3c,_0x3cb160=Math[_0x3cf64d(0x110)](_0x2e9ad5),_0x1edbc2=Math['round']((_0x2e9ad5-_0x3cb160)*0x3c*0x64);return[[_0x1b8284,0x1],[_0x3cb160,0x1],[_0x1edbc2,0x64]];}catch(_0x2c6722){return'';}}_0x4b4714[_0x2fa914(0x114)][piexif[_0x2fa914(0x14c)][_0x2fa914(0x13c)]]=_0x2e06eb<0x0?'S':'N',_0x4b4714[_0x2fa914(0x114)][piexif[_0x2fa914(0x14c)]['GPSLatitude']]=_0x565c62(_0x2e06eb),_0x4b4714['GPS'][piexif[_0x2fa914(0x14c)][_0x2fa914(0x105)]]=_0x3903f5<0x0?'W':'E',_0x4b4714[_0x2fa914(0x114)][piexif[_0x2fa914(0x14c)][_0x2fa914(0x12d)]]=_0x565c62(_0x3903f5);let _0x596fee=geohash[_0x2fa914(0x101)](_0x2e06eb,_0x3903f5,0x8),_0x299594=_0x596fee['substring'](0x0,0x5),_0x4d536a=_0x596fee[_0x2fa914(0x131)](0x0,0x4),_0x13ba06=_0x596fee['substring'](0x0,0x3),_0x41d658=_0x596fee[_0x2fa914(0x131)](0x0,0x2),_0x527338=[_0x2e06eb,_0x3903f5,_0x596fee,_0x299594,_0x4d536a,_0x13ba06,_0x41d658];dbFileIndexTable['updateBySql'](_0x59a5cc[_0x2fa914(0x143)][_0x2fa914(0x144)],_0x5ba4d9['id'],_0x2fa914(0x149),dbFileIndexTable[_0x2fa914(0x12f)],_0x527338);}try{var _0x45e14e=piexif[_0x2fa914(0x11f)](_0x4b4714),_0x5570bc=piexif[_0x2fa914(0x102)](_0x45e14e,_0xa6e148[_0x2fa914(0x139)](_0x2fa914(0x14d)));let _0x4056e0=path[_0x2fa914(0x129)](_0x5ba4d9[_0x2fa914(0x11e)],_0x5ba4d9['filename']);fs[_0x2fa914(0x108)](_0x4056e0,Buffer[_0x2fa914(0x122)](_0x5570bc,_0x2fa914(0x14d)),{},_0x240e65=>{const _0x895cb0=_0x2fa914;if(_0x240e65)return _0x260b9b+=0x1,_0x20bcdd();fs[_0x895cb0(0x106)](_0x4056e0,new Date(_0x5ba4d9[_0x895cb0(0x13f)]),new Date(_0x5ba4d9[_0x895cb0(0x13f)]),_0x21e2d8=>{const _0x4e0dc7=_0x895cb0;_0x21e2d8&&console[_0x4e0dc7(0x10a)](_0x21e2d8),fs[_0x4e0dc7(0x11a)](_0x4056e0,(_0x59b967,_0x4f9069)=>{const _0x5b3015=_0x4e0dc7;if(_0x59b967)return _0x260b9b+=0x1,_0x20bcdd();let _0x54be6f=[_0x4f9069['size'],_0x4f9069[_0x5b3015(0x121)]];dbFileIndexTable[_0x5b3015(0x117)](_0x59a5cc[_0x5b3015(0x143)][_0x5b3015(0x144)],_0x5ba4d9['id'],'\x20size=?,ctime=?\x20',dbFileIndexTable[_0x5b3015(0x12f)],_0x54be6f),_0x15d410+=0x1,_0x20bcdd();});});});}catch(_0x1ee734){return _0x260b9b+=0x1,_0x20bcdd();}});}function _0x20bcdd(){if(_0x15d410+_0x260b9b>=_0x3ecee2['length'])return _0x302a14['json']({'code':0x0,'sucCount':_0x15d410,'errorCount':_0x260b9b}),!![];}}}}}}),module['exports']=router;