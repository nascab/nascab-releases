function _0x2dd9(_0x594844,_0x1ea58c){const _0x7b867=_0x7b86();return _0x2dd9=function(_0x2dd984,_0x55a2f7){_0x2dd984=_0x2dd984-0xab;let _0x1bcd60=_0x7b867[_0x2dd984];return _0x1bcd60;},_0x2dd9(_0x594844,_0x1ea58c);}const _0x49e601=_0x2dd9;(function(_0x37eef3,_0x3b4e89){const _0x4e780b=_0x2dd9,_0x365bf9=_0x37eef3();while(!![]){try{const _0x333b0d=parseInt(_0x4e780b(0xe0))/0x1+parseInt(_0x4e780b(0xd5))/0x2*(parseInt(_0x4e780b(0xbd))/0x3)+parseInt(_0x4e780b(0xae))/0x4*(-parseInt(_0x4e780b(0xad))/0x5)+-parseInt(_0x4e780b(0xc0))/0x6+-parseInt(_0x4e780b(0xec))/0x7+parseInt(_0x4e780b(0xc1))/0x8+parseInt(_0x4e780b(0xf9))/0x9;if(_0x333b0d===_0x3b4e89)break;else _0x365bf9['push'](_0x365bf9['shift']());}catch(_0x627019){_0x365bf9['push'](_0x365bf9['shift']());}}}(_0x7b86,0xda275));let express=require('express'),router=express[_0x49e601(0xdb)](),path=require(_0x49e601(0xdd));const dbUserTable=require('../../db/dbUserTable'),dbFileIndexTable=require(_0x49e601(0xfa));function _0x7b86(){const _0x4c12f2=['GPSLongitudeRef','type','encode','undefined','getAllByWhere','370sVMdLx','60532AGjSGq','\x20size=?,ctime=?\x20','readFile','from','insert','ngeohash','push','join','data','sep','filename','json','ctimeMs','piexifjs','original_time','315654FiqSqo','abs','dbFileIndex','7325022oSDgFK','7087008GwLOLc','power_get','exports','\x20order\x20by\x20original_time\x20limit\x20?','photo','toString','getUserPathWhere','GPS','load','power_change','binary','GPSIFD','app','SKIP','prepare','size','writeFile','currentUser','GPSLongitude','\x20order\x20by\x20abs(original_time-?)\x20asc\x20limit\x2050','28UKoKlW','run','whereStr','/confirmAddGps','indexIdList','isFile','Router','updateBySql','path','/getWaitAddGpsIndex','add_gps_status','1504232srCjaO','getByWhere','is_admin','post','length','doUserCanGet','updateById','mode','CONFIRM','getById','body','dump','12124686WcYtOH','log','substring','stat','\x20\x20latitude\x20is\x20not\x20null\x20and\x20latitude!=\x27undefined\x27\x20and\x20geohash5\x20!=\x27undefined\x27\x20and\x20original_time\x20between\x20?\x20and\x20?\x20\x20and\x20(width>=?\x20or\x20height>=?)\x20\x20','longitude','INDEX_TABLE_NAME_PHOTO','mtime','statSync','round','fullPath','UPDATE\x20file_index_photo\x20set\x20add_gps_status=1\x20WHERE\x20id\x20IN\x20','floor','9928566ywGRqq','../../db/dbFileIndexTable'];_0x7b86=function(){return _0x4c12f2;};return _0x7b86();}let fs=require('fs'),piexif=require(_0x49e601(0xbb)),geohash=require(_0x49e601(0xb3));function getWaitAddGpsIndex(_0x3a6e6d,_0x2d97d3,_0x31591e){const _0x2e1c5a=_0x49e601;let _0x544c4e=0x7d0,_0x45b527='\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20(width>=?\x20and\x20height>=?)\x20'+_0x2d97d3,_0x40f71d=[parseInt(_0x544c4e),parseInt(_0x544c4e),..._0x31591e],_0x57dcab=dbFileIndexTable[_0x2e1c5a(0xe1)](_0x3a6e6d,_0x45b527,'*',dbFileIndexTable[_0x2e1c5a(0xf2)],_0x40f71d);if(_0x57dcab){let _0xd5872d=_0x57dcab[_0x2e1c5a(0xbc)]-0xe10*0x3e8*0xc,_0x1af41c=_0x57dcab['original_time']+0xe10*0x3e8*0xc,_0x438a3b=_0x2e1c5a(0xf0)+_0x2d97d3+_0x2e1c5a(0xd4),_0x539ada=[parseInt(_0xd5872d),parseInt(_0x1af41c),parseInt(_0x544c4e),parseInt(_0x544c4e),..._0x31591e,parseInt(_0x57dcab[_0x2e1c5a(0xbc)])],_0x23869b=dbFileIndexTable['getAllByWhere'](_0x3a6e6d,_0x438a3b,'*',dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],_0x539ada);if(_0x23869b&&_0x23869b[_0x2e1c5a(0xe4)]>0x0){let _0x41d8f7=[];if(_0x57dcab[_0x2e1c5a(0xe7)]&&_0x57dcab[_0x2e1c5a(0xe7)]!='undefined'){let _0x112f7a=0x32,_0x1b185b=_0x57dcab[_0x2e1c5a(0xbc)]-0xe10*0x3e8*0x3,_0x4d704e=_0x57dcab[_0x2e1c5a(0xbc)]+0xe10*0x3e8*0x3;if(_0x57dcab[_0x2e1c5a(0xe7)]&&_0x57dcab[_0x2e1c5a(0xe7)]!=_0x2e1c5a(0xab)){let _0x4c814a='\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20mode=?\x20and\x20original_time\x20between\x20?\x20and\x20?\x20\x20'+_0x2d97d3+_0x2e1c5a(0xc4),_0x5ce511=[_0x57dcab['mode'],parseInt(_0x1b185b),parseInt(_0x4d704e),..._0x31591e,parseInt(_0x112f7a)];_0x41d8f7=dbFileIndexTable[_0x2e1c5a(0xac)](_0x3a6e6d,_0x4c814a,'*',dbFileIndexTable[_0x2e1c5a(0xf2)],_0x5ce511);}}else _0x41d8f7[_0x2e1c5a(0xb4)](_0x57dcab);for(let _0x49225d in _0x41d8f7){_0x41d8f7[_0x49225d][_0x2e1c5a(0xf6)]=path[_0x2e1c5a(0xb5)](_0x41d8f7[_0x49225d][_0x2e1c5a(0xdd)],_0x41d8f7[_0x49225d]['filename']);}if(_0x41d8f7['length']==0x1)return dbFileIndexTable['updateById'](_0x3a6e6d,_0x41d8f7[0x0]['id'],_0x2e1c5a(0xdf),0x1,dbFileIndexTable[_0x2e1c5a(0xf2)]),getWaitAddGpsIndex(_0x3a6e6d,_0x2d97d3,_0x31591e);return{'dealList':_0x41d8f7,'nearIndex':_0x23869b};}else return dbFileIndexTable[_0x2e1c5a(0xe6)](_0x3a6e6d,_0x57dcab['id'],'add_gps_status',0x1,dbFileIndexTable[_0x2e1c5a(0xf2)]),getWaitAddGpsIndex(_0x3a6e6d,_0x2d97d3,_0x31591e);}else return![];}router[_0x49e601(0xe3)](_0x49e601(0xde),(_0x169a9c,_0x268802,_0xbf1ed4)=>{const _0x40947b=_0x49e601;let _0x3c7e0f={'code':0x0,'data':''};if(dbUserTable[_0x40947b(0xe5)](_0x169a9c,_0x268802,'photo',_0x40947b(0xc2))==!![]){let _0x4bee7a='',_0x4e36b4=[];if(_0x169a9c[_0x40947b(0xd2)][_0x40947b(0xe2)]!=0x1){let _0x1808b0=dbUserTable[_0x40947b(0xc7)](_0x169a9c,_0x40947b(0xc5),_0x40947b(0xc2),!![]);_0x4bee7a=_0x1808b0[_0x40947b(0xd7)],_0x4e36b4=_0x1808b0['paramsList'];}let _0x4fdb31=getWaitAddGpsIndex(_0x169a9c[_0x40947b(0xcd)][_0x40947b(0xbf)],_0x4bee7a,_0x4e36b4);return _0x4fdb31&&(_0x3c7e0f[_0x40947b(0xb6)]=_0x4fdb31),_0x268802[_0x40947b(0xb9)](_0x3c7e0f);}}),router['post'](_0x49e601(0xd8),(_0x54a471,_0x3f6781,_0x466b73)=>{const _0x4e6131=_0x49e601;let _0x1be7b2=_0x54a471[_0x4e6131(0xea)][_0x4e6131(0xfc)],_0xb7f6e6=_0x54a471[_0x4e6131(0xea)][_0x4e6131(0xd9)];if(_0xb7f6e6[_0x4e6131(0xe4)]<0x1)return _0x3f6781[_0x4e6131(0xb9)]({'code':0x0});_0x924b0a();function _0x924b0a(){const _0x173cbf=_0x4e6131;if(dbUserTable['doUserCanGet'](_0x54a471,_0x3f6781,_0x173cbf(0xc5),_0x173cbf(0xca))==!![]){let _0x4a048f='(';for(let _0x48a0ea in _0xb7f6e6){_0x4a048f+=_0xb7f6e6[_0x48a0ea],_0x48a0ea!=_0xb7f6e6[_0x173cbf(0xe4)]-0x1&&(_0x4a048f+=',');}_0x4a048f+=')';if(_0x1be7b2==_0x173cbf(0xce))return _0x54a471[_0x173cbf(0xcd)][_0x173cbf(0xbf)][_0x173cbf(0xcf)]('UPDATE\x20file_index_photo\x20set\x20add_gps_status=2\x20WHERE\x20id\x20IN\x20'+_0x4a048f+'\x20')[_0x173cbf(0xd6)](),_0x3f6781[_0x173cbf(0xb9)]({'code':0x0});else{if(_0x1be7b2==_0x173cbf(0xe8)){let _0x3853a0=_0x54a471[_0x173cbf(0xea)]['latitude'],_0x1d049c=_0x54a471[_0x173cbf(0xea)][_0x173cbf(0xf1)];if(!_0x3853a0||!_0x1d049c)return _0x3f6781[_0x173cbf(0xb9)]({'code':0x0});_0x54a471[_0x173cbf(0xcd)][_0x173cbf(0xbf)][_0x173cbf(0xcf)](_0x173cbf(0xf7)+_0x4a048f+'\x20')['run']();let _0x4bdb94=0x0,_0x3e8f3e=0x0;for(let _0x4e90a5 in _0xb7f6e6){let _0x3c7e91=dbFileIndexTable[_0x173cbf(0xe9)](_0x54a471[_0x173cbf(0xcd)][_0x173cbf(0xbf)],_0xb7f6e6[_0x4e90a5]);if(!_0x3c7e91)continue;let _0x2be223=path[_0x173cbf(0xb5)](_0x3c7e91[_0x173cbf(0xdd)],path[_0x173cbf(0xb7)],_0x3c7e91[_0x173cbf(0xb8)]),_0x2c0368=fs[_0x173cbf(0xf4)](_0x2be223);if(!_0x2c0368[_0x173cbf(0xda)]()){_0x3e8f3e+=0x1,_0x4773e4();continue;}fs[_0x173cbf(0xb0)](_0x2be223,(_0x1ee0e0,_0x287dd4)=>{const _0x10a714=_0x173cbf;if(_0x1ee0e0)return _0x3e8f3e+=0x1,_0x4773e4();let _0x495583=null;try{_0x495583=piexif[_0x10a714(0xc9)](_0x287dd4[_0x10a714(0xc6)](_0x10a714(0xcb)));}catch(_0x3fc202){console['log'](_0x3fc202);}if(!_0x495583)return _0x3e8f3e+=0x1,_0x4773e4();if(_0x3853a0&&_0x1d049c){function _0x3ff7c8(_0x508c19){const _0x723bdd=_0x10a714;try{_0x508c19=Number(_0x508c19);let _0x321e74=Math[_0x723bdd(0xf8)](Math[_0x723bdd(0xbe)](_0x508c19)),_0x16a22c=(Math[_0x723bdd(0xbe)](_0x508c19)-_0x321e74)*0x3c,_0xd932f3=Math[_0x723bdd(0xf8)](_0x16a22c),_0x21f035=Math[_0x723bdd(0xf5)]((_0x16a22c-_0xd932f3)*0x3c*0x64);return[[_0x321e74,0x1],[_0xd932f3,0x1],[_0x21f035,0x64]];}catch(_0x394d83){return'';}}_0x495583[_0x10a714(0xc8)][piexif['GPSIFD']['GPSLatitudeRef']]=_0x3853a0<0x0?'S':'N',_0x495583[_0x10a714(0xc8)][piexif['GPSIFD']['GPSLatitude']]=_0x3ff7c8(_0x3853a0),_0x495583['GPS'][piexif['GPSIFD'][_0x10a714(0xfb)]]=_0x1d049c<0x0?'W':'E',_0x495583[_0x10a714(0xc8)][piexif[_0x10a714(0xcc)][_0x10a714(0xd3)]]=_0x3ff7c8(_0x1d049c);let _0x18438c=geohash[_0x10a714(0xfd)](_0x3853a0,_0x1d049c,0x8),_0x26fc86=_0x18438c[_0x10a714(0xee)](0x0,0x5),_0x10c444=_0x18438c[_0x10a714(0xee)](0x0,0x4),_0x1e275a=_0x18438c['substring'](0x0,0x3),_0x2d035d=_0x18438c['substring'](0x0,0x2),_0x4d59af=[_0x3853a0,_0x1d049c,_0x18438c,_0x26fc86,_0x10c444,_0x1e275a,_0x2d035d];dbFileIndexTable[_0x10a714(0xdc)](_0x54a471[_0x10a714(0xcd)][_0x10a714(0xbf)],_0x3c7e91['id'],'\x20latitude=?,longitude=?,geohash=?,geohash5=?,geohash4=?,geohash3=?,geohash2=?\x20',dbFileIndexTable[_0x10a714(0xf2)],_0x4d59af);}try{var _0x335079=piexif[_0x10a714(0xeb)](_0x495583),_0x1e45b5=piexif[_0x10a714(0xb2)](_0x335079,_0x287dd4[_0x10a714(0xc6)](_0x10a714(0xcb)));let _0x15e0f4=path[_0x10a714(0xb5)](_0x3c7e91['path'],_0x3c7e91[_0x10a714(0xb8)]);fs[_0x10a714(0xd1)](_0x15e0f4,Buffer[_0x10a714(0xb1)](_0x1e45b5,_0x10a714(0xcb)),{},_0xf22a5b=>{const _0x64a95c=_0x10a714;if(_0xf22a5b)return _0x3e8f3e+=0x1,_0x4773e4();fs['utimes'](_0x15e0f4,new Date(_0x3c7e91['mtime']),new Date(_0x3c7e91[_0x64a95c(0xf3)]),_0x1f2f39=>{const _0x546c1f=_0x64a95c;_0x1f2f39&&console[_0x546c1f(0xed)](_0x1f2f39),fs[_0x546c1f(0xef)](_0x15e0f4,(_0x938319,_0x1be666)=>{const _0x2a7166=_0x546c1f;if(_0x938319)return _0x3e8f3e+=0x1,_0x4773e4();let _0x4d4267=[_0x1be666[_0x2a7166(0xd0)],_0x1be666[_0x2a7166(0xba)]];dbFileIndexTable[_0x2a7166(0xdc)](_0x54a471['app'][_0x2a7166(0xbf)],_0x3c7e91['id'],_0x2a7166(0xaf),dbFileIndexTable[_0x2a7166(0xf2)],_0x4d4267),_0x4bdb94+=0x1,_0x4773e4();});});});}catch(_0x125baf){return _0x3e8f3e+=0x1,_0x4773e4();}});}function _0x4773e4(){const _0x5d0485=_0x173cbf;if(_0x4bdb94+_0x3e8f3e>=_0xb7f6e6[_0x5d0485(0xe4)])return _0x3f6781[_0x5d0485(0xb9)]({'code':0x0,'sucCount':_0x4bdb94,'errorCount':_0x3e8f3e}),!![];}}}}}}),module[_0x49e601(0xc3)]=router;