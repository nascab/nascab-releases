const _0xf32a9d=_0x32b5;(function(_0x5148b4,_0x9ee8a2){const _0x5a81ca=_0x32b5,_0x4036ef=_0x5148b4();while(!![]){try{const _0x700df3=parseInt(_0x5a81ca(0x229))/0x1+parseInt(_0x5a81ca(0x1ef))/0x2*(parseInt(_0x5a81ca(0x211))/0x3)+parseInt(_0x5a81ca(0x201))/0x4*(-parseInt(_0x5a81ca(0x213))/0x5)+parseInt(_0x5a81ca(0x21e))/0x6+parseInt(_0x5a81ca(0x1fa))/0x7*(-parseInt(_0x5a81ca(0x240))/0x8)+-parseInt(_0x5a81ca(0x1ff))/0x9*(-parseInt(_0x5a81ca(0x233))/0xa)+parseInt(_0x5a81ca(0x218))/0xb*(-parseInt(_0x5a81ca(0x22d))/0xc);if(_0x700df3===_0x9ee8a2)break;else _0x4036ef['push'](_0x4036ef['shift']());}catch(_0x4c9299){_0x4036ef['push'](_0x4036ef['shift']());}}}(_0x3ca1,0x7d366));function _0x3ca1(){const _0x223f41=['indexIdList','join','../../db/dbFileIndexTable','GPSLongitude','sep','GPSLatitudeRef','is_admin','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20(width>=?\x20and\x20height>=?)\x20','updateBySql','post','7FeanwP','whereStr','mode','updateById','type','9uCkDfq','doUserCanGet','16UMsqHB','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20mode=?\x20and\x20original_time\x20between\x20?\x20and\x20?\x20\x20','dbFileIndex','getAllByWhere','add_gps_status','CONFIRM','floor','/confirmAddGps','getByWhere','Router','GPSLongitudeRef','app','/getWaitAddGpsIndex','longitude','SKIP','writeFile','9lGqyDu','abs','1168400AchgUW','toString','isFile','GPSIFD','fullPath','1661lYAkrN','UPDATE\x20file_index_photo\x20set\x20add_gps_status=2\x20WHERE\x20id\x20IN\x20','substring','latitude','INDEX_TABLE_NAME_PHOTO','\x20latitude=?,longitude=?,geohash=?,geohash5=?,geohash4=?,geohash3=?,geohash2=?\x20','5648268RdjNZa','insert','ngeohash','filename','\x20\x20latitude\x20is\x20not\x20null\x20and\x20latitude!=\x27undefined\x27\x20and\x20geohash5\x20!=\x27undefined\x27\x20and\x20original_time\x20between\x20?\x20and\x20?\x20\x20and\x20(width>=?\x20or\x20height>=?)\x20\x20','ctimeMs','original_time','express','binary','photo','length','40540JLzFME','getUserPathWhere','undefined','log','18432JHZMyP','getById','json','dump','../../db/dbUserTable','from','4385240celFYg','size','\x20order\x20by\x20abs(original_time-?)\x20asc\x20limit\x2050','statSync','GPS','push','run','mtime','path','prepare','UPDATE\x20file_index_photo\x20set\x20add_gps_status=1\x20WHERE\x20id\x20IN\x20','data','body','112120Itahzn','182066zWQkWL'];_0x3ca1=function(){return _0x223f41;};return _0x3ca1();}let express=require(_0xf32a9d(0x225)),router=express[_0xf32a9d(0x20a)](),path=require(_0xf32a9d(0x23b));const dbUserTable=require(_0xf32a9d(0x231)),dbFileIndexTable=require(_0xf32a9d(0x1f2));let fs=require('fs'),piexif=require('piexifjs'),geohash=require(_0xf32a9d(0x220));function getWaitAddGpsIndex(_0x591b57,_0x3a674e,_0xd33e5b){const _0x48f846=_0xf32a9d;let _0x1dfc8f=0x7d0,_0xaf502d=_0x48f846(0x1f7)+_0x3a674e,_0x93f539=[parseInt(_0x1dfc8f),parseInt(_0x1dfc8f),..._0xd33e5b],_0xeb381b=dbFileIndexTable[_0x48f846(0x209)](_0x591b57,_0xaf502d,'*',dbFileIndexTable[_0x48f846(0x21c)],_0x93f539);if(_0xeb381b){let _0x23c3b1=_0xeb381b[_0x48f846(0x224)]-0xe10*0x3e8*0xc,_0x25b74d=_0xeb381b[_0x48f846(0x224)]+0xe10*0x3e8*0xc,_0x2bd429=_0x48f846(0x222)+_0x3a674e+_0x48f846(0x235),_0x15dcb8=[parseInt(_0x23c3b1),parseInt(_0x25b74d),parseInt(_0x1dfc8f),parseInt(_0x1dfc8f),..._0xd33e5b,parseInt(_0xeb381b[_0x48f846(0x224)])],_0x15605c=dbFileIndexTable[_0x48f846(0x204)](_0x591b57,_0x2bd429,'*',dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],_0x15dcb8);if(_0x15605c&&_0x15605c[_0x48f846(0x228)]>0x0){let _0x1857d0=[];if(_0xeb381b[_0x48f846(0x1fc)]&&_0xeb381b[_0x48f846(0x1fc)]!=_0x48f846(0x22b)){let _0x3fa196=0x32,_0x1a913d=_0xeb381b[_0x48f846(0x224)]-0xe10*0x3e8*0x3,_0xb4007a=_0xeb381b[_0x48f846(0x224)]+0xe10*0x3e8*0x3;if(_0xeb381b['mode']&&_0xeb381b[_0x48f846(0x1fc)]!='undefined'){let _0x2496be=_0x48f846(0x202)+_0x3a674e+'\x20order\x20by\x20original_time\x20limit\x20?',_0x1a4550=[_0xeb381b[_0x48f846(0x1fc)],parseInt(_0x1a913d),parseInt(_0xb4007a),..._0xd33e5b,parseInt(_0x3fa196)];_0x1857d0=dbFileIndexTable[_0x48f846(0x204)](_0x591b57,_0x2496be,'*',dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],_0x1a4550);}}else _0x1857d0[_0x48f846(0x238)](_0xeb381b);for(let _0x327901 in _0x1857d0){_0x1857d0[_0x327901][_0x48f846(0x217)]=path[_0x48f846(0x1f1)](_0x1857d0[_0x327901]['path'],_0x1857d0[_0x327901]['filename']);}if(_0x1857d0[_0x48f846(0x228)]==0x1)return dbFileIndexTable[_0x48f846(0x1fd)](_0x591b57,_0x1857d0[0x0]['id'],_0x48f846(0x205),0x1,dbFileIndexTable[_0x48f846(0x21c)]),getWaitAddGpsIndex(_0x591b57,_0x3a674e,_0xd33e5b);return{'dealList':_0x1857d0,'nearIndex':_0x15605c};}else return dbFileIndexTable[_0x48f846(0x1fd)](_0x591b57,_0xeb381b['id'],'add_gps_status',0x1,dbFileIndexTable[_0x48f846(0x21c)]),getWaitAddGpsIndex(_0x591b57,_0x3a674e,_0xd33e5b);}else return![];}function _0x32b5(_0x4a1768,_0x1c796f){const _0x3ca1fe=_0x3ca1();return _0x32b5=function(_0x32b518,_0x37b343){_0x32b518=_0x32b518-0x1ef;let _0x375835=_0x3ca1fe[_0x32b518];return _0x375835;},_0x32b5(_0x4a1768,_0x1c796f);}router[_0xf32a9d(0x1f9)](_0xf32a9d(0x20d),(_0x177f41,_0x214044,_0xa32f61)=>{const _0x19b77f=_0xf32a9d;let _0x453e0b={'code':0x0,'data':''};if(dbUserTable[_0x19b77f(0x200)](_0x177f41,_0x214044,_0x19b77f(0x227),'power_get')==!![]){let _0x5ee5e='',_0xb26f5d=[];if(_0x177f41['currentUser'][_0x19b77f(0x1f6)]!=0x1){let _0x3aa656=dbUserTable[_0x19b77f(0x22a)](_0x177f41,_0x19b77f(0x227),'power_get',!![]);_0x5ee5e=_0x3aa656[_0x19b77f(0x1fb)],_0xb26f5d=_0x3aa656['paramsList'];}let _0x5d01e7=getWaitAddGpsIndex(_0x177f41['app']['dbFileIndex'],_0x5ee5e,_0xb26f5d);return _0x5d01e7&&(_0x453e0b[_0x19b77f(0x23e)]=_0x5d01e7),_0x214044[_0x19b77f(0x22f)](_0x453e0b);}}),router[_0xf32a9d(0x1f9)](_0xf32a9d(0x208),(_0x3b2787,_0x4a2ba,_0x5b21d1)=>{const _0x535cc7=_0xf32a9d;let _0x2a3395=_0x3b2787[_0x535cc7(0x23f)][_0x535cc7(0x1fe)],_0x50c5e1=_0x3b2787[_0x535cc7(0x23f)][_0x535cc7(0x1f0)];if(_0x50c5e1['length']<0x1)return _0x4a2ba[_0x535cc7(0x22f)]({'code':0x0});_0x1dc12f();function _0x1dc12f(){const _0x50b95a=_0x535cc7;if(dbUserTable[_0x50b95a(0x200)](_0x3b2787,_0x4a2ba,_0x50b95a(0x227),'power_change')==!![]){let _0x59c90c='(';for(let _0x35f641 in _0x50c5e1){_0x59c90c+=_0x50c5e1[_0x35f641],_0x35f641!=_0x50c5e1[_0x50b95a(0x228)]-0x1&&(_0x59c90c+=',');}_0x59c90c+=')';if(_0x2a3395==_0x50b95a(0x20f))return _0x3b2787[_0x50b95a(0x20c)][_0x50b95a(0x203)][_0x50b95a(0x23c)](_0x50b95a(0x219)+_0x59c90c+'\x20')[_0x50b95a(0x239)](),_0x4a2ba[_0x50b95a(0x22f)]({'code':0x0});else{if(_0x2a3395==_0x50b95a(0x206)){let _0x2c4e04=_0x3b2787['body'][_0x50b95a(0x21b)],_0xfe560d=_0x3b2787[_0x50b95a(0x23f)][_0x50b95a(0x20e)];if(!_0x2c4e04||!_0xfe560d)return _0x4a2ba[_0x50b95a(0x22f)]({'code':0x0});_0x3b2787[_0x50b95a(0x20c)][_0x50b95a(0x203)][_0x50b95a(0x23c)](_0x50b95a(0x23d)+_0x59c90c+'\x20')[_0x50b95a(0x239)]();let _0x814945=0x0,_0x1414da=0x0;for(let _0x10d5b3 in _0x50c5e1){let _0x45b370=dbFileIndexTable[_0x50b95a(0x22e)](_0x3b2787[_0x50b95a(0x20c)][_0x50b95a(0x203)],_0x50c5e1[_0x10d5b3]);if(!_0x45b370)continue;let _0x30257a=path['join'](_0x45b370[_0x50b95a(0x23b)],path[_0x50b95a(0x1f4)],_0x45b370['filename']),_0x349174=fs[_0x50b95a(0x236)](_0x30257a);if(!_0x349174[_0x50b95a(0x215)]()){_0x1414da+=0x1,_0x3bcefc();continue;}fs['readFile'](_0x30257a,(_0x1f5858,_0x1c66ae)=>{const _0x348b50=_0x50b95a;if(_0x1f5858)return _0x1414da+=0x1,_0x3bcefc();let _0x5cdeae=null;try{_0x5cdeae=piexif['load'](_0x1c66ae['toString'](_0x348b50(0x226)));}catch(_0x35ae21){console['log'](_0x35ae21);}if(!_0x5cdeae)return _0x1414da+=0x1,_0x3bcefc();if(_0x2c4e04&&_0xfe560d){function _0x16333f(_0x39dbe4){const _0x5aedfc=_0x348b50;try{_0x39dbe4=Number(_0x39dbe4);let _0x4ee67d=Math[_0x5aedfc(0x207)](Math[_0x5aedfc(0x212)](_0x39dbe4)),_0x1e22b2=(Math['abs'](_0x39dbe4)-_0x4ee67d)*0x3c,_0x261fb6=Math[_0x5aedfc(0x207)](_0x1e22b2),_0x3e56cc=Math['round']((_0x1e22b2-_0x261fb6)*0x3c*0x64);return[[_0x4ee67d,0x1],[_0x261fb6,0x1],[_0x3e56cc,0x64]];}catch(_0x277fbe){return'';}}_0x5cdeae['GPS'][piexif[_0x348b50(0x216)][_0x348b50(0x1f5)]]=_0x2c4e04<0x0?'S':'N',_0x5cdeae[_0x348b50(0x237)][piexif[_0x348b50(0x216)]['GPSLatitude']]=_0x16333f(_0x2c4e04),_0x5cdeae['GPS'][piexif[_0x348b50(0x216)][_0x348b50(0x20b)]]=_0xfe560d<0x0?'W':'E',_0x5cdeae[_0x348b50(0x237)][piexif['GPSIFD'][_0x348b50(0x1f3)]]=_0x16333f(_0xfe560d);let _0x2359de=geohash['encode'](_0x2c4e04,_0xfe560d,0x8),_0x4b125f=_0x2359de[_0x348b50(0x21a)](0x0,0x5),_0x24b30a=_0x2359de[_0x348b50(0x21a)](0x0,0x4),_0x4de2d1=_0x2359de[_0x348b50(0x21a)](0x0,0x3),_0x5cafd7=_0x2359de[_0x348b50(0x21a)](0x0,0x2),_0x1ab607=[_0x2c4e04,_0xfe560d,_0x2359de,_0x4b125f,_0x24b30a,_0x4de2d1,_0x5cafd7];dbFileIndexTable[_0x348b50(0x1f8)](_0x3b2787[_0x348b50(0x20c)][_0x348b50(0x203)],_0x45b370['id'],_0x348b50(0x21d),dbFileIndexTable[_0x348b50(0x21c)],_0x1ab607);}try{var _0xfeaf99=piexif[_0x348b50(0x230)](_0x5cdeae),_0x18d2e1=piexif[_0x348b50(0x21f)](_0xfeaf99,_0x1c66ae[_0x348b50(0x214)]('binary'));let _0x2b45b6=path[_0x348b50(0x1f1)](_0x45b370['path'],_0x45b370[_0x348b50(0x221)]);fs[_0x348b50(0x210)](_0x2b45b6,Buffer[_0x348b50(0x232)](_0x18d2e1,_0x348b50(0x226)),{},_0x357042=>{const _0x2586e8=_0x348b50;if(_0x357042)return _0x1414da+=0x1,_0x3bcefc();fs['utimes'](_0x2b45b6,new Date(_0x45b370[_0x2586e8(0x23a)]),new Date(_0x45b370[_0x2586e8(0x23a)]),_0x4afa03=>{const _0x51446e=_0x2586e8;_0x4afa03&&console[_0x51446e(0x22c)](_0x4afa03),fs['stat'](_0x2b45b6,(_0x58c495,_0x34b8c5)=>{const _0x3af1d1=_0x51446e;if(_0x58c495)return _0x1414da+=0x1,_0x3bcefc();let _0x25084a=[_0x34b8c5[_0x3af1d1(0x234)],_0x34b8c5[_0x3af1d1(0x223)]];dbFileIndexTable[_0x3af1d1(0x1f8)](_0x3b2787['app'][_0x3af1d1(0x203)],_0x45b370['id'],'\x20size=?,ctime=?\x20',dbFileIndexTable[_0x3af1d1(0x21c)],_0x25084a),_0x814945+=0x1,_0x3bcefc();});});});}catch(_0x3911e9){return _0x1414da+=0x1,_0x3bcefc();}});}function _0x3bcefc(){const _0x4f1534=_0x50b95a;if(_0x814945+_0x1414da>=_0x50c5e1[_0x4f1534(0x228)])return _0x4a2ba[_0x4f1534(0x22f)]({'code':0x0,'sucCount':_0x814945,'errorCount':_0x1414da}),!![];}}}}}}),module['exports']=router;