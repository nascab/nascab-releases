const _0x3ac71e=_0x1278;(function(_0x1ebea9,_0x3194c3){const _0x58a838=_0x1278,_0x48b713=_0x1ebea9();while(!![]){try{const _0xea4c8c=-parseInt(_0x58a838(0x145))/0x1+-parseInt(_0x58a838(0x149))/0x2+parseInt(_0x58a838(0x14c))/0x3*(-parseInt(_0x58a838(0x14e))/0x4)+parseInt(_0x58a838(0x12a))/0x5*(parseInt(_0x58a838(0x147))/0x6)+-parseInt(_0x58a838(0x156))/0x7+parseInt(_0x58a838(0x152))/0x8+parseInt(_0x58a838(0x144))/0x9;if(_0xea4c8c===_0x3194c3)break;else _0x48b713['push'](_0x48b713['shift']());}catch(_0x4524b2){_0x48b713['push'](_0x48b713['shift']());}}}(_0x3f3a,0x9256b));function _0x1278(_0x3beda7,_0x5ca7a6){const _0x3f3afc=_0x3f3a();return _0x1278=function(_0x127858,_0xb48a96){_0x127858=_0x127858-0x11e;let _0x43fc58=_0x3f3afc[_0x127858];return _0x43fc58;},_0x1278(_0x3beda7,_0x5ca7a6);}function _0x3f3a(){const _0x37b695=['dbOther','pathSignNoNull','11810016WGxWsg','122944IhyYLZ','deleteShareUser','6ChwTcm','W_OK','1175730eBuWNu','\x20path=?\x20and\x20server_type=?','find','1384143NJwhQT','port','4DUOwgK','is_admin','/create','/delete','1384808KCPbdd','post','createShareUser','length','4915274eznews','log','body','update','express','ftpHttp','ipv4','fileShareRestart','parse','webdavHttp','returnErrMsg','constants','app','findByTitle','\x20username,id','type','FTPServer','delete','json','\x20id\x20in\x20','https://','exports','server_type','webDavHttpsServer','path','getAllByWhere','R_OK','share.samePathSign','../../db/dbFileShare','user_id','userHasFtp','noWritePermission','4942250hELaPA','Router','access','currentUser','\x20path\x20is\x20not\x20directory','/getAll','lastInsertRowid','isDirectory','send','getByWhere','http://','users','pathSign','ftp://','\x20path_sign=?\x20and\x20server_type=\x27WebDav\x27','share.alreadyHasOtherFtp','../../db/dbUserTable','getById','create','value','FTP','/getById','serverType','username'];_0x3f3a=function(){return _0x37b695;};return _0x3f3a();}var express=require(_0x3ac71e(0x15a)),router=express[_0x3ac71e(0x12b)]();let path=require(_0x3ac71e(0x122)),fs=require('fs');const dbFileShare=require(_0x3ac71e(0x126)),dbUserTable=require(_0x3ac71e(0x13a));let dbConfigTable=require('../../db/dbConfigTable');router[_0x3ac71e(0x153)](_0x3ac71e(0x150),(_0x436e15,_0x254ed6,_0x30fef2)=>{const _0x26d391=_0x3ac71e;if(_0x436e15[_0x26d391(0x12d)]['is_admin']!=0x1)return _0x254ed6[_0x26d391(0x168)]({'code':0x66});let _0x2f4f40=_0x436e15[_0x26d391(0x158)][_0x26d391(0x165)],_0x152683=_0x436e15[_0x26d391(0x158)][_0x26d391(0x135)],_0x2d7886=_0x436e15[_0x26d391(0x158)][_0x26d391(0x122)],_0x5d997f=_0x436e15[_0x26d391(0x158)][_0x26d391(0x140)];fs[_0x26d391(0x12c)](_0x2d7886,fs[_0x26d391(0x161)][_0x26d391(0x148)]|fs['constants'][_0x26d391(0x124)],_0x129b93=>{const _0x3df833=_0x26d391;if(_0x129b93)return _0x436e15['app'][_0x3df833(0x160)](_0x254ed6,_0x254ed6['__'](_0x3df833(0x129))+':'+_0x2d7886);let _0x5b9b28=_0x436e15['body'][_0x3df833(0x136)];if(_0x5d997f=='WebDav'){if(!_0x5b9b28)return _0x436e15[_0x3df833(0x162)]['returnErrMsg'](_0x254ed6,_0x254ed6['__'](_0x3df833(0x143)));else{let _0x5d41a1=[_0x5b9b28],_0x5132ef=_0x3df833(0x138),_0x5a97fd=dbFileShare['getByWhere'](_0x436e15[_0x3df833(0x162)][_0x3df833(0x142)],_0x5132ef,_0x5d41a1);if(_0x5a97fd){if(_0x2f4f40==_0x3df833(0x13c)||_0x2f4f40==_0x3df833(0x159)&&_0x5a97fd['id']!=_0x436e15[_0x3df833(0x158)]['id'])return _0x436e15[_0x3df833(0x162)][_0x3df833(0x160)](_0x254ed6,_0x254ed6['__'](_0x3df833(0x125))+':'+_0x5b9b28);}}}fs['stat'](_0x2d7886,(_0x56d2bf,_0x3652ba)=>{const _0x112d4d=_0x3df833;if(_0x56d2bf)return _0x436e15[_0x112d4d(0x162)][_0x112d4d(0x160)](_0x254ed6,'Invalid\x20path');if(_0x3652ba[_0x112d4d(0x131)]()){let _0x5b075f=_0x2d7886,_0x546c3a=_0x112d4d(0x14a),_0x583700=[_0x5b075f,_0x5d997f],_0xd7f095=dbFileShare[_0x112d4d(0x133)](_0x436e15[_0x112d4d(0x162)][_0x112d4d(0x142)],_0x546c3a,_0x583700);if(_0xd7f095){if(_0x2f4f40==_0x112d4d(0x13c)||_0x2f4f40=='update'&&_0xd7f095['id']!=_0x436e15[_0x112d4d(0x158)]['id'])return _0x436e15[_0x112d4d(0x162)][_0x112d4d(0x160)](_0x254ed6,_0x254ed6['__']('share.samePathExist')+':'+_0x2d7886);}if(_0x5d997f==_0x112d4d(0x13e)&&_0x2f4f40==_0x112d4d(0x13c))for(let _0x53db79 in _0x152683){let _0x234918=_0x152683[_0x53db79]['id'],_0x1d564d=dbUserTable[_0x112d4d(0x14b)](_0x436e15[_0x112d4d(0x162)][_0x112d4d(0x142)],_0x234918),_0x4a1919=dbFileShare[_0x112d4d(0x128)](_0x436e15[_0x112d4d(0x162)][_0x112d4d(0x142)],_0x234918,_0x112d4d(0x13e));if(_0x4a1919)return _0x436e15['app'][_0x112d4d(0x160)](_0x254ed6,_0x254ed6['__'](_0x112d4d(0x139))+':'+_0x1d564d[_0x112d4d(0x141)]);}let _0x291662={'path':_0x2d7886,'path_sign':_0x5b9b28,'server_type':_0x5d997f};if(_0x2f4f40=='create'){let _0x1a9c5d=dbFileShare['create'](_0x436e15[_0x112d4d(0x162)]['dbOther'],_0x291662),_0x5ec500=_0x1a9c5d[_0x112d4d(0x130)];for(let _0xca4a38 in _0x152683){dbFileShare[_0x112d4d(0x154)](_0x436e15['app']['dbOther'],_0x5ec500,_0x152683[_0xca4a38]['id']);}}else{if(_0x2f4f40==_0x112d4d(0x159)){let _0x24b612=_0x436e15[_0x112d4d(0x158)]['id'];dbFileShare[_0x112d4d(0x159)](_0x436e15[_0x112d4d(0x162)]['dbOther'],_0x291662,_0x24b612),dbFileShare[_0x112d4d(0x146)](_0x436e15['app'][_0x112d4d(0x142)],_0x24b612);for(let _0x58f89d in _0x152683){dbFileShare[_0x112d4d(0x154)](_0x436e15[_0x112d4d(0x162)]['dbOther'],_0x24b612,_0x152683[_0x58f89d]['id']);}}}return process[_0x112d4d(0x132)]({'type':'fileShareRestart','shareType':_0x5d997f}),_0x254ed6['json']({'code':0x0});}else return _0x436e15[_0x112d4d(0x162)][_0x112d4d(0x160)](_0x254ed6,_0x112d4d(0x12e));});});}),router[_0x3ac71e(0x153)](_0x3ac71e(0x151),(_0x32eef1,_0x9e13b0,_0x48aae7)=>{const _0x2e9ac0=_0x3ac71e;if(_0x32eef1[_0x2e9ac0(0x12d)]['is_admin']!=0x1)return _0x9e13b0[_0x2e9ac0(0x168)]({'code':0x66});let _0x55589a=_0x32eef1[_0x2e9ac0(0x158)]['id'],_0x3bc61e=dbFileShare[_0x2e9ac0(0x13b)](_0x32eef1[_0x2e9ac0(0x162)][_0x2e9ac0(0x142)],_0x55589a);dbFileShare[_0x2e9ac0(0x167)](_0x32eef1[_0x2e9ac0(0x162)]['dbOther'],_0x55589a),process['send']({'type':_0x2e9ac0(0x15d),'shareType':_0x3bc61e[_0x2e9ac0(0x120)]}),_0x9e13b0['json']({'code':0x0});}),router['post'](_0x3ac71e(0x12f),(_0x5e688b,_0x3dbbb3,_0xa1f466)=>{const _0x98a43a=_0x3ac71e;if(_0x5e688b[_0x98a43a(0x12d)][_0x98a43a(0x14f)]!=0x1)return _0x3dbbb3['json']({'code':0x66});let _0x59e1a6=_0x5e688b[_0x98a43a(0x158)][_0x98a43a(0x140)],_0x2d76a5=dbFileShare[_0x98a43a(0x123)](_0x5e688b[_0x98a43a(0x162)][_0x98a43a(0x142)],'server_type=?\x20order\x20by\x20id\x20desc',[_0x59e1a6]);for(let _0x16074a in _0x2d76a5){let _0x5a7756=_0x2d76a5[_0x16074a],_0x8b7734=dbFileShare['getSharesUserByShareId'](_0x5e688b[_0x98a43a(0x162)]['dbOther'],_0x5a7756['id']),_0x5141bb='(';for(let _0x1761b5 in _0x8b7734){_0x5141bb+=_0x8b7734[_0x1761b5][_0x98a43a(0x127)],_0x1761b5!=_0x8b7734[_0x98a43a(0x155)]-0x1&&(_0x5141bb+=',');}_0x5141bb+=')';let _0x4b3d95=dbUserTable[_0x98a43a(0x123)](_0x5e688b[_0x98a43a(0x162)][_0x98a43a(0x142)],_0x98a43a(0x169)+_0x5141bb+'\x20',_0x98a43a(0x164));_0x2d76a5[_0x16074a]['users']=_0x4b3d95;}let _0x421a3f={'code':0x0,'data':_0x2d76a5},_0x3b1c76='',_0x132c0e='',_0x587273='';try{let _0x50d16a=dbConfigTable[_0x98a43a(0x163)](_0x5e688b[_0x98a43a(0x162)][_0x98a43a(0x142)],'webDavServer'),_0x132f98=dbConfigTable[_0x98a43a(0x163)](_0x5e688b[_0x98a43a(0x162)]['dbOther'],_0x98a43a(0x121)),_0x50cba0=dbConfigTable[_0x98a43a(0x163)](_0x5e688b[_0x98a43a(0x162)][_0x98a43a(0x142)],_0x98a43a(0x166)),_0x5240b8=dbConfigTable[_0x98a43a(0x163)](_0x5e688b[_0x98a43a(0x162)]['dbOther'],'globalIpList');if(_0x5240b8){_0x5240b8=JSON['parse'](_0x5240b8[_0x98a43a(0x13d)]);for(let _0x1b5902 of _0x5240b8){if(_0x1b5902[_0x98a43a(0x165)]==_0x98a43a(0x15c)){_0x3b1c76=_0x98a43a(0x134)+_0x1b5902['ip'],_0x132c0e=_0x98a43a(0x11e)+_0x1b5902['ip'],_0x587273=_0x98a43a(0x137)+_0x1b5902['ip'];break;}}}_0x50d16a&&(_0x50d16a=JSON['parse'](_0x50d16a['value']),_0x3b1c76+=':'+_0x50d16a[_0x98a43a(0x14d)],_0x421a3f[_0x98a43a(0x15f)]=_0x3b1c76),_0x132f98&&(_0x132f98=JSON[_0x98a43a(0x15e)](_0x132f98[_0x98a43a(0x13d)]),_0x132c0e+=':'+_0x132f98['port'],_0x421a3f['webdavHttps']=_0x132c0e),_0x50cba0&&(_0x50cba0=JSON[_0x98a43a(0x15e)](_0x50cba0[_0x98a43a(0x13d)]),_0x587273+=':'+_0x50cba0[_0x98a43a(0x14d)],_0x421a3f[_0x98a43a(0x15b)]=_0x587273);}catch(_0x14bcb7){console[_0x98a43a(0x157)](_0x14bcb7);}_0x3dbbb3[_0x98a43a(0x168)](_0x421a3f);}),router[_0x3ac71e(0x153)](_0x3ac71e(0x13f),(_0x26c90b,_0xb64c88,_0x551e49)=>{const _0x326b66=_0x3ac71e;if(_0x26c90b['currentUser']['is_admin']!=0x1)return _0xb64c88['json']({'code':0x66});let _0x3fde4b=_0x26c90b[_0x326b66(0x158)]['id'],_0x353a20=dbFileShare[_0x326b66(0x13b)](_0x26c90b[_0x326b66(0x162)][_0x326b66(0x142)],_0x3fde4b),_0x538491=dbFileShare['getSharesUserByShareId'](_0x26c90b[_0x326b66(0x162)]['dbOther'],_0x353a20['id']),_0x3d3c11='(';for(let _0x4912b4 in _0x538491){_0x3d3c11+=_0x538491[_0x4912b4]['user_id'],_0x4912b4!=_0x538491['length']-0x1&&(_0x3d3c11+=',');}_0x3d3c11+=')';let _0x436450=dbUserTable['getAllByWhere'](_0x26c90b[_0x326b66(0x162)][_0x326b66(0x142)],'\x20id\x20in\x20'+_0x3d3c11+'\x20','\x20username,id');_0x353a20[_0x326b66(0x135)]=_0x436450,_0xb64c88[_0x326b66(0x168)]({'code':0x0,'data':_0x353a20});}),module[_0x3ac71e(0x11f)]=router;