const _0x572a77=_0x33ac;function _0x14c1(){const _0x644ec=['221775zhNNrs','is_admin','10Mwvccz','\x20path\x20is\x20not\x20directory','update','delete','json','2799256oNAXYz','isDirectory','ftp://','getSharesUserByShareId','body','dbOther','findByTitle','noWritePermission','exports','\x20path=?\x20and\x20server_type=?','45DTEPob','post','pathSign','getByWhere','webDavServer','constants','value','/getAll','log','createShareUser','server_type','create','R_OK','share.alreadyHasOtherFtp','\x20username,id','user_id','send','webdavHttp','length','parse','9yvomGV','type','lastInsertRowid','share.samePathExist','currentUser','users','share.samePathSign','FTP','40iWMFoP','2792360HWWVNW','username','2889854wWSYNk','138242MiAtCx','serverType','getAllByWhere','path','returnErrMsg','stat','4337508RNCRSh','https://','../../db/dbUserTable','fileShareRestart','app','\x20id\x20in\x20','../../db/dbConfigTable','FTPServer','port','375054ZMxXmi','getById','WebDav','../../db/dbFileShare','W_OK','/create','webdavHttps','Router','globalIpList'];_0x14c1=function(){return _0x644ec;};return _0x14c1();}(function(_0x32720e,_0x2ef540){const _0x11f5e7=_0x33ac,_0x39df35=_0x32720e();while(!![]){try{const _0xbb6b33=-parseInt(_0x11f5e7(0x153))/0x1*(-parseInt(_0x11f5e7(0x139))/0x2)+-parseInt(_0x11f5e7(0x151))/0x3+-parseInt(_0x11f5e7(0x136))/0x4+parseInt(_0x11f5e7(0x119))/0x5*(parseInt(_0x11f5e7(0x148))/0x6)+parseInt(_0x11f5e7(0x13f))/0x7+parseInt(_0x11f5e7(0x10f))/0x8*(parseInt(_0x11f5e7(0x12d))/0x9)+parseInt(_0x11f5e7(0x135))/0xa*(-parseInt(_0x11f5e7(0x138))/0xb);if(_0xbb6b33===_0x2ef540)break;else _0x39df35['push'](_0x39df35['shift']());}catch(_0x31bdfa){_0x39df35['push'](_0x39df35['shift']());}}}(_0x14c1,0x61c57));function _0x33ac(_0x21e6a5,_0x5668d7){const _0x14c161=_0x14c1();return _0x33ac=function(_0x33ac6c,_0x4cabb3){_0x33ac6c=_0x33ac6c-0x10e;let _0x25f85b=_0x14c161[_0x33ac6c];return _0x25f85b;},_0x33ac(_0x21e6a5,_0x5668d7);}var express=require('express'),router=express[_0x572a77(0x14f)]();let path=require(_0x572a77(0x13c)),fs=require('fs');const dbFileShare=require(_0x572a77(0x14b)),dbUserTable=require(_0x572a77(0x141));let dbConfigTable=require(_0x572a77(0x145));router[_0x572a77(0x11a)](_0x572a77(0x14d),(_0x1f6841,_0x5fd2d3,_0x43649c)=>{const _0x4e1325=_0x572a77;if(_0x1f6841['currentUser']['is_admin']!=0x1)return _0x5fd2d3[_0x4e1325(0x10e)]({'code':0x66});let _0x3c60af=_0x1f6841[_0x4e1325(0x113)][_0x4e1325(0x12e)],_0x8b1fdd=_0x1f6841[_0x4e1325(0x113)][_0x4e1325(0x132)],_0x1ea04a=_0x1f6841[_0x4e1325(0x113)][_0x4e1325(0x13c)],_0x2972e1=_0x1f6841[_0x4e1325(0x113)]['serverType'];fs['access'](_0x1ea04a,fs[_0x4e1325(0x11e)][_0x4e1325(0x14c)]|fs['constants'][_0x4e1325(0x125)],_0x2a2cac=>{const _0x513f35=_0x4e1325;if(_0x2a2cac)return _0x1f6841['app']['returnErrMsg'](_0x5fd2d3,_0x5fd2d3['__'](_0x513f35(0x116))+':'+_0x1ea04a);let _0x5b8f45=_0x1f6841[_0x513f35(0x113)][_0x513f35(0x11b)];if(_0x2972e1==_0x513f35(0x14a)){if(!_0x5b8f45)return _0x1f6841[_0x513f35(0x143)][_0x513f35(0x13d)](_0x5fd2d3,_0x5fd2d3['__']('pathSignNoNull'));else{let _0x12fddd=[_0x5b8f45],_0x5d49b2='\x20path_sign=?\x20and\x20server_type=\x27WebDav\x27',_0x168a75=dbFileShare[_0x513f35(0x11c)](_0x1f6841[_0x513f35(0x143)][_0x513f35(0x114)],_0x5d49b2,_0x12fddd);if(_0x168a75){if(_0x3c60af==_0x513f35(0x124)||_0x3c60af==_0x513f35(0x155)&&_0x168a75['id']!=_0x1f6841[_0x513f35(0x113)]['id'])return _0x1f6841[_0x513f35(0x143)]['returnErrMsg'](_0x5fd2d3,_0x5fd2d3['__'](_0x513f35(0x133))+':'+_0x5b8f45);}}}fs[_0x513f35(0x13e)](_0x1ea04a,(_0x2cd290,_0x4f8fad)=>{const _0x1b668e=_0x513f35;if(_0x2cd290)return _0x1f6841['app'][_0x1b668e(0x13d)](_0x5fd2d3,'Invalid\x20path');if(_0x4f8fad[_0x1b668e(0x110)]()){let _0x430aeb=_0x1ea04a,_0x3c78d0=_0x1b668e(0x118),_0x32b85a=[_0x430aeb,_0x2972e1],_0x2003a3=dbFileShare[_0x1b668e(0x11c)](_0x1f6841[_0x1b668e(0x143)][_0x1b668e(0x114)],_0x3c78d0,_0x32b85a);if(_0x2003a3){if(_0x3c60af==_0x1b668e(0x124)||_0x3c60af==_0x1b668e(0x155)&&_0x2003a3['id']!=_0x1f6841['body']['id'])return _0x1f6841['app'][_0x1b668e(0x13d)](_0x5fd2d3,_0x5fd2d3['__'](_0x1b668e(0x130))+':'+_0x1ea04a);}if(_0x2972e1=='FTP'&&_0x3c60af==_0x1b668e(0x124))for(let _0x52eba3 in _0x8b1fdd){let _0x2e01c7=_0x8b1fdd[_0x52eba3]['id'],_0x1ef3eb=dbUserTable['find'](_0x1f6841[_0x1b668e(0x143)]['dbOther'],_0x2e01c7),_0x4b5f4a=dbFileShare['userHasFtp'](_0x1f6841[_0x1b668e(0x143)][_0x1b668e(0x114)],_0x2e01c7,_0x1b668e(0x134));if(_0x4b5f4a)return _0x1f6841[_0x1b668e(0x143)][_0x1b668e(0x13d)](_0x5fd2d3,_0x5fd2d3['__'](_0x1b668e(0x126))+':'+_0x1ef3eb[_0x1b668e(0x137)]);}let _0x84101={'path':_0x1ea04a,'path_sign':_0x5b8f45,'server_type':_0x2972e1};if(_0x3c60af==_0x1b668e(0x124)){let _0x30c54f=dbFileShare[_0x1b668e(0x124)](_0x1f6841['app'][_0x1b668e(0x114)],_0x84101),_0x1aaa14=_0x30c54f[_0x1b668e(0x12f)];for(let _0x1a5632 in _0x8b1fdd){dbFileShare[_0x1b668e(0x122)](_0x1f6841['app']['dbOther'],_0x1aaa14,_0x8b1fdd[_0x1a5632]['id']);}}else{if(_0x3c60af==_0x1b668e(0x155)){let _0x537ef5=_0x1f6841['body']['id'];dbFileShare['update'](_0x1f6841[_0x1b668e(0x143)]['dbOther'],_0x84101,_0x537ef5),dbFileShare['deleteShareUser'](_0x1f6841[_0x1b668e(0x143)][_0x1b668e(0x114)],_0x537ef5);for(let _0x2f0ce2 in _0x8b1fdd){dbFileShare['createShareUser'](_0x1f6841[_0x1b668e(0x143)]['dbOther'],_0x537ef5,_0x8b1fdd[_0x2f0ce2]['id']);}}}return process[_0x1b668e(0x129)]({'type':_0x1b668e(0x142),'shareType':_0x2972e1}),_0x5fd2d3[_0x1b668e(0x10e)]({'code':0x0});}else return _0x1f6841[_0x1b668e(0x143)]['returnErrMsg'](_0x5fd2d3,_0x1b668e(0x154));});});}),router[_0x572a77(0x11a)]('/delete',(_0x172ada,_0x4cd1f9,_0x27a34b)=>{const _0x6e62b1=_0x572a77;if(_0x172ada[_0x6e62b1(0x131)][_0x6e62b1(0x152)]!=0x1)return _0x4cd1f9['json']({'code':0x66});let _0x290be8=_0x172ada[_0x6e62b1(0x113)]['id'],_0x2fd493=dbFileShare[_0x6e62b1(0x149)](_0x172ada[_0x6e62b1(0x143)][_0x6e62b1(0x114)],_0x290be8);dbFileShare[_0x6e62b1(0x156)](_0x172ada[_0x6e62b1(0x143)][_0x6e62b1(0x114)],_0x290be8),process['send']({'type':_0x6e62b1(0x142),'shareType':_0x2fd493[_0x6e62b1(0x123)]}),_0x4cd1f9['json']({'code':0x0});}),router[_0x572a77(0x11a)](_0x572a77(0x120),(_0x231308,_0x497ec4,_0x35b143)=>{const _0xfd9686=_0x572a77;if(_0x231308[_0xfd9686(0x131)][_0xfd9686(0x152)]!=0x1)return _0x497ec4[_0xfd9686(0x10e)]({'code':0x66});let _0x4b100f=_0x231308[_0xfd9686(0x113)][_0xfd9686(0x13a)],_0x27b566=dbFileShare[_0xfd9686(0x13b)](_0x231308[_0xfd9686(0x143)][_0xfd9686(0x114)],'server_type=?\x20order\x20by\x20id\x20desc',[_0x4b100f]);for(let _0x5ae7e4 in _0x27b566){let _0x4e1d6a=_0x27b566[_0x5ae7e4],_0xe8f5c0=dbFileShare[_0xfd9686(0x112)](_0x231308['app'][_0xfd9686(0x114)],_0x4e1d6a['id']),_0x2600ca='(';for(let _0x451895 in _0xe8f5c0){_0x2600ca+=_0xe8f5c0[_0x451895][_0xfd9686(0x128)],_0x451895!=_0xe8f5c0[_0xfd9686(0x12b)]-0x1&&(_0x2600ca+=',');}_0x2600ca+=')';let _0x1f7906=dbUserTable[_0xfd9686(0x13b)](_0x231308['app']['dbOther'],_0xfd9686(0x144)+_0x2600ca+'\x20',_0xfd9686(0x127));_0x27b566[_0x5ae7e4][_0xfd9686(0x132)]=_0x1f7906;}let _0x32776d={'code':0x0,'data':_0x27b566},_0x2b3772='',_0x212eb7='',_0x958d99='';try{let _0x4d1bb3=dbConfigTable[_0xfd9686(0x115)](_0x231308['app']['dbOther'],_0xfd9686(0x11d)),_0x3d9bb5=dbConfigTable[_0xfd9686(0x115)](_0x231308[_0xfd9686(0x143)][_0xfd9686(0x114)],'webDavHttpsServer'),_0x3ca202=dbConfigTable['findByTitle'](_0x231308['app'][_0xfd9686(0x114)],_0xfd9686(0x146)),_0x2a7c9a=dbConfigTable[_0xfd9686(0x115)](_0x231308[_0xfd9686(0x143)][_0xfd9686(0x114)],_0xfd9686(0x150));if(_0x2a7c9a){_0x2a7c9a=JSON[_0xfd9686(0x12c)](_0x2a7c9a['value']);for(let _0x19e905 of _0x2a7c9a){if(_0x19e905['type']=='ipv4'){_0x2b3772='http://'+_0x19e905['ip'],_0x212eb7=_0xfd9686(0x140)+_0x19e905['ip'],_0x958d99=_0xfd9686(0x111)+_0x19e905['ip'];break;}}}_0x4d1bb3&&(_0x4d1bb3=JSON[_0xfd9686(0x12c)](_0x4d1bb3['value']),_0x2b3772+=':'+_0x4d1bb3[_0xfd9686(0x147)],_0x32776d[_0xfd9686(0x12a)]=_0x2b3772),_0x3d9bb5&&(_0x3d9bb5=JSON[_0xfd9686(0x12c)](_0x3d9bb5[_0xfd9686(0x11f)]),_0x212eb7+=':'+_0x3d9bb5[_0xfd9686(0x147)],_0x32776d[_0xfd9686(0x14e)]=_0x212eb7),_0x3ca202&&(_0x3ca202=JSON[_0xfd9686(0x12c)](_0x3ca202[_0xfd9686(0x11f)]),_0x958d99+=':'+_0x3ca202['port'],_0x32776d['ftpHttp']=_0x958d99);}catch(_0xbc8dd2){console[_0xfd9686(0x121)](_0xbc8dd2);}_0x497ec4[_0xfd9686(0x10e)](_0x32776d);}),router[_0x572a77(0x11a)]('/getById',(_0x7998a2,_0x1e71b0,_0xcb73c9)=>{const _0xc01c3f=_0x572a77;if(_0x7998a2[_0xc01c3f(0x131)][_0xc01c3f(0x152)]!=0x1)return _0x1e71b0[_0xc01c3f(0x10e)]({'code':0x66});let _0x213ff9=_0x7998a2[_0xc01c3f(0x113)]['id'],_0x5adc61=dbFileShare['getById'](_0x7998a2[_0xc01c3f(0x143)][_0xc01c3f(0x114)],_0x213ff9),_0x3c1818=dbFileShare[_0xc01c3f(0x112)](_0x7998a2[_0xc01c3f(0x143)][_0xc01c3f(0x114)],_0x5adc61['id']),_0x28a230='(';for(let _0x560872 in _0x3c1818){_0x28a230+=_0x3c1818[_0x560872][_0xc01c3f(0x128)],_0x560872!=_0x3c1818['length']-0x1&&(_0x28a230+=',');}_0x28a230+=')';let _0x14e6cb=dbUserTable[_0xc01c3f(0x13b)](_0x7998a2[_0xc01c3f(0x143)][_0xc01c3f(0x114)],_0xc01c3f(0x144)+_0x28a230+'\x20',_0xc01c3f(0x127));_0x5adc61[_0xc01c3f(0x132)]=_0x14e6cb,_0x1e71b0[_0xc01c3f(0x10e)]({'code':0x0,'data':_0x5adc61});}),module[_0x572a77(0x117)]=router;