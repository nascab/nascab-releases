const _0x519bb2=_0xcac1;(function(_0x5b5f60,_0x159fbd){const _0x4d9130=_0xcac1,_0x28f5fd=_0x5b5f60();while(!![]){try{const _0x40602f=parseInt(_0x4d9130(0x1b4))/0x1*(-parseInt(_0x4d9130(0x1df))/0x2)+parseInt(_0x4d9130(0x1cb))/0x3+-parseInt(_0x4d9130(0x1b2))/0x4+-parseInt(_0x4d9130(0x1ce))/0x5+parseInt(_0x4d9130(0x1e3))/0x6+-parseInt(_0x4d9130(0x1a6))/0x7*(-parseInt(_0x4d9130(0x1b3))/0x8)+parseInt(_0x4d9130(0x1cd))/0x9;if(_0x40602f===_0x159fbd)break;else _0x28f5fd['push'](_0x28f5fd['shift']());}catch(_0x2b3fd7){_0x28f5fd['push'](_0x28f5fd['shift']());}}}(_0x4110,0x1e82c));var express=require(_0x519bb2(0x1c2)),router=express[_0x519bb2(0x1b7)]();let path=require(_0x519bb2(0x1c1)),fs=require('fs');function _0x4110(){const _0x518b5d=['ipv4','879888flCOkv','56BeCemd','451acFEPM','pathSign','share.samePathExist','Router','share.alreadyHasOtherFtp','getByWhere','noWritePermission','/getById','dbOther','create','value','\x20id\x20in\x20','createShareUser','path','express','webDavHttpsServer','user_id','Invalid\x20path','app','is_admin','getById','isDirectory','userHasFtp','58428VTyOzn','pathSignNoNull','3814632QAxRey','41530zeelmG','serverType','getSharesUserByShareId','FTPServer','../../db/dbUserTable','update','../../db/dbFileShare','log','length','send','https://','json','/create','webdavHttp','returnErrMsg','currentUser','users','410rSSFrK','\x20username,id','username','lastInsertRowid','4584nbdJKl','type','deleteShareUser','port','W_OK','webDavServer','WebDav','FTP','stat','exports','webdavHttps','find','R_OK','/getAll','\x20path_sign=?\x20and\x20server_type=\x27WebDav\x27','getAllByWhere','1617uDYDDd','server_type','parse','findByTitle','fileShareRestart','constants','delete','access','body','ftpHttp','post'];_0x4110=function(){return _0x518b5d;};return _0x4110();}function _0xcac1(_0x5b5337,_0x1ff685){const _0x41102b=_0x4110();return _0xcac1=function(_0xcac177,_0x59e865){_0xcac177=_0xcac177-0x1a5;let _0x36350d=_0x41102b[_0xcac177];return _0x36350d;},_0xcac1(_0x5b5337,_0x1ff685);}const dbFileShare=require(_0x519bb2(0x1d4)),dbUserTable=require(_0x519bb2(0x1d2));let dbConfigTable=require('../../db/dbConfigTable');router[_0x519bb2(0x1b0)](_0x519bb2(0x1da),(_0x352373,_0x2b59ee,_0x1af5ec)=>{const _0x34cd7f=_0x519bb2;if(_0x352373[_0x34cd7f(0x1dd)][_0x34cd7f(0x1c7)]!=0x1)return _0x2b59ee[_0x34cd7f(0x1d9)]({'code':0x66});let _0x141f80=_0x352373[_0x34cd7f(0x1ae)][_0x34cd7f(0x1e4)],_0x305ea2=_0x352373[_0x34cd7f(0x1ae)][_0x34cd7f(0x1de)],_0x136af4=_0x352373[_0x34cd7f(0x1ae)][_0x34cd7f(0x1c1)],_0x2063d1=_0x352373[_0x34cd7f(0x1ae)][_0x34cd7f(0x1cf)];fs[_0x34cd7f(0x1ad)](_0x136af4,fs[_0x34cd7f(0x1ab)][_0x34cd7f(0x1e7)]|fs[_0x34cd7f(0x1ab)][_0x34cd7f(0x1ef)],_0x4880c8=>{const _0x5efd78=_0x34cd7f;if(_0x4880c8)return _0x352373[_0x5efd78(0x1c6)]['returnErrMsg'](_0x2b59ee,_0x2b59ee['__'](_0x5efd78(0x1ba))+':'+_0x136af4);let _0x1d7fbd=_0x352373[_0x5efd78(0x1ae)][_0x5efd78(0x1b5)];if(_0x2063d1==_0x5efd78(0x1e9)){if(!_0x1d7fbd)return _0x352373['app'][_0x5efd78(0x1dc)](_0x2b59ee,_0x2b59ee['__'](_0x5efd78(0x1cc)));else{let _0x2e6d53=[_0x1d7fbd],_0x5aded6=_0x5efd78(0x1f1),_0xf12b14=dbFileShare[_0x5efd78(0x1b9)](_0x352373[_0x5efd78(0x1c6)][_0x5efd78(0x1bc)],_0x5aded6,_0x2e6d53);if(_0xf12b14){if(_0x141f80=='create'||_0x141f80==_0x5efd78(0x1d3)&&_0xf12b14['id']!=_0x352373[_0x5efd78(0x1ae)]['id'])return _0x352373[_0x5efd78(0x1c6)][_0x5efd78(0x1dc)](_0x2b59ee,_0x2b59ee['__']('share.samePathSign')+':'+_0x1d7fbd);}}}fs[_0x5efd78(0x1eb)](_0x136af4,(_0x1a353b,_0x19d8d4)=>{const _0xdd66c5=_0x5efd78;if(_0x1a353b)return _0x352373[_0xdd66c5(0x1c6)]['returnErrMsg'](_0x2b59ee,_0xdd66c5(0x1c5));if(_0x19d8d4[_0xdd66c5(0x1c9)]()){let _0x569237=_0x136af4,_0x5a0a29='\x20path=?\x20and\x20server_type=?',_0x20c3e9=[_0x569237,_0x2063d1],_0x2559df=dbFileShare['getByWhere'](_0x352373[_0xdd66c5(0x1c6)]['dbOther'],_0x5a0a29,_0x20c3e9);if(_0x2559df){if(_0x141f80==_0xdd66c5(0x1bd)||_0x141f80==_0xdd66c5(0x1d3)&&_0x2559df['id']!=_0x352373['body']['id'])return _0x352373[_0xdd66c5(0x1c6)][_0xdd66c5(0x1dc)](_0x2b59ee,_0x2b59ee['__'](_0xdd66c5(0x1b6))+':'+_0x136af4);}if(_0x2063d1==_0xdd66c5(0x1ea)&&_0x141f80=='create')for(let _0x47558d in _0x305ea2){let _0x23880d=_0x305ea2[_0x47558d]['id'],_0x3253f6=dbUserTable[_0xdd66c5(0x1ee)](_0x352373[_0xdd66c5(0x1c6)]['dbOther'],_0x23880d),_0x21225b=dbFileShare[_0xdd66c5(0x1ca)](_0x352373[_0xdd66c5(0x1c6)][_0xdd66c5(0x1bc)],_0x23880d,_0xdd66c5(0x1ea));if(_0x21225b)return _0x352373[_0xdd66c5(0x1c6)][_0xdd66c5(0x1dc)](_0x2b59ee,_0x2b59ee['__'](_0xdd66c5(0x1b8))+':'+_0x3253f6[_0xdd66c5(0x1e1)]);}let _0x36dd18={'path':_0x136af4,'path_sign':_0x1d7fbd,'server_type':_0x2063d1};if(_0x141f80==_0xdd66c5(0x1bd)){let _0x1a3497=dbFileShare[_0xdd66c5(0x1bd)](_0x352373[_0xdd66c5(0x1c6)][_0xdd66c5(0x1bc)],_0x36dd18),_0x272274=_0x1a3497[_0xdd66c5(0x1e2)];for(let _0x5a74c0 in _0x305ea2){dbFileShare[_0xdd66c5(0x1c0)](_0x352373[_0xdd66c5(0x1c6)][_0xdd66c5(0x1bc)],_0x272274,_0x305ea2[_0x5a74c0]['id']);}}else{if(_0x141f80==_0xdd66c5(0x1d3)){let _0x113dc7=_0x352373[_0xdd66c5(0x1ae)]['id'];dbFileShare[_0xdd66c5(0x1d3)](_0x352373['app'][_0xdd66c5(0x1bc)],_0x36dd18,_0x113dc7),dbFileShare[_0xdd66c5(0x1e5)](_0x352373[_0xdd66c5(0x1c6)]['dbOther'],_0x113dc7);for(let _0x2887e4 in _0x305ea2){dbFileShare[_0xdd66c5(0x1c0)](_0x352373[_0xdd66c5(0x1c6)][_0xdd66c5(0x1bc)],_0x113dc7,_0x305ea2[_0x2887e4]['id']);}}}return process[_0xdd66c5(0x1d7)]({'type':_0xdd66c5(0x1aa),'shareType':_0x2063d1}),_0x2b59ee['json']({'code':0x0});}else return _0x352373[_0xdd66c5(0x1c6)][_0xdd66c5(0x1dc)](_0x2b59ee,'\x20path\x20is\x20not\x20directory');});});}),router[_0x519bb2(0x1b0)]('/delete',(_0x2250b2,_0x58c672,_0x75b4fd)=>{const _0x4cda19=_0x519bb2;if(_0x2250b2[_0x4cda19(0x1dd)][_0x4cda19(0x1c7)]!=0x1)return _0x58c672[_0x4cda19(0x1d9)]({'code':0x66});let _0x36e5bc=_0x2250b2[_0x4cda19(0x1ae)]['id'],_0x315d4c=dbFileShare['getById'](_0x2250b2[_0x4cda19(0x1c6)][_0x4cda19(0x1bc)],_0x36e5bc);dbFileShare[_0x4cda19(0x1ac)](_0x2250b2[_0x4cda19(0x1c6)][_0x4cda19(0x1bc)],_0x36e5bc),process[_0x4cda19(0x1d7)]({'type':_0x4cda19(0x1aa),'shareType':_0x315d4c[_0x4cda19(0x1a7)]}),_0x58c672['json']({'code':0x0});}),router[_0x519bb2(0x1b0)](_0x519bb2(0x1f0),(_0x2a4b60,_0x9a222b,_0x53b02a)=>{const _0x43d46d=_0x519bb2;if(_0x2a4b60[_0x43d46d(0x1dd)][_0x43d46d(0x1c7)]!=0x1)return _0x9a222b['json']({'code':0x66});let _0x4aab46=_0x2a4b60[_0x43d46d(0x1ae)][_0x43d46d(0x1cf)],_0x332908=dbFileShare[_0x43d46d(0x1a5)](_0x2a4b60[_0x43d46d(0x1c6)][_0x43d46d(0x1bc)],'server_type=?\x20order\x20by\x20id\x20desc',[_0x4aab46]);for(let _0x4e154f in _0x332908){let _0x530dd8=_0x332908[_0x4e154f],_0x46f50d=dbFileShare['getSharesUserByShareId'](_0x2a4b60[_0x43d46d(0x1c6)][_0x43d46d(0x1bc)],_0x530dd8['id']),_0x34f14b='(';for(let _0x6e344e in _0x46f50d){_0x34f14b+=_0x46f50d[_0x6e344e][_0x43d46d(0x1c4)],_0x6e344e!=_0x46f50d['length']-0x1&&(_0x34f14b+=',');}_0x34f14b+=')';let _0x279b6d=dbUserTable[_0x43d46d(0x1a5)](_0x2a4b60[_0x43d46d(0x1c6)][_0x43d46d(0x1bc)],_0x43d46d(0x1bf)+_0x34f14b+'\x20',_0x43d46d(0x1e0));_0x332908[_0x4e154f][_0x43d46d(0x1de)]=_0x279b6d;}let _0x1a378a={'code':0x0,'data':_0x332908},_0x3ab930='',_0x59d743='',_0x4d6b71='';try{let _0x4d47b3=dbConfigTable['findByTitle'](_0x2a4b60[_0x43d46d(0x1c6)][_0x43d46d(0x1bc)],_0x43d46d(0x1e8)),_0x905c79=dbConfigTable[_0x43d46d(0x1a9)](_0x2a4b60[_0x43d46d(0x1c6)][_0x43d46d(0x1bc)],_0x43d46d(0x1c3)),_0x11240c=dbConfigTable[_0x43d46d(0x1a9)](_0x2a4b60[_0x43d46d(0x1c6)]['dbOther'],_0x43d46d(0x1d1)),_0xc9d763=dbConfigTable[_0x43d46d(0x1a9)](_0x2a4b60['app'][_0x43d46d(0x1bc)],'globalIpList');if(_0xc9d763){_0xc9d763=JSON['parse'](_0xc9d763[_0x43d46d(0x1be)]);for(let _0x258890 of _0xc9d763){if(_0x258890[_0x43d46d(0x1e4)]==_0x43d46d(0x1b1)){_0x3ab930='http://'+_0x258890['ip'],_0x59d743=_0x43d46d(0x1d8)+_0x258890['ip'],_0x4d6b71='ftp://'+_0x258890['ip'];break;}}}_0x4d47b3&&(_0x4d47b3=JSON[_0x43d46d(0x1a8)](_0x4d47b3[_0x43d46d(0x1be)]),_0x3ab930+=':'+_0x4d47b3[_0x43d46d(0x1e6)],_0x1a378a[_0x43d46d(0x1db)]=_0x3ab930),_0x905c79&&(_0x905c79=JSON[_0x43d46d(0x1a8)](_0x905c79['value']),_0x59d743+=':'+_0x905c79[_0x43d46d(0x1e6)],_0x1a378a[_0x43d46d(0x1ed)]=_0x59d743),_0x11240c&&(_0x11240c=JSON[_0x43d46d(0x1a8)](_0x11240c[_0x43d46d(0x1be)]),_0x4d6b71+=':'+_0x11240c[_0x43d46d(0x1e6)],_0x1a378a[_0x43d46d(0x1af)]=_0x4d6b71);}catch(_0x452aac){console[_0x43d46d(0x1d5)](_0x452aac);}_0x9a222b[_0x43d46d(0x1d9)](_0x1a378a);}),router[_0x519bb2(0x1b0)](_0x519bb2(0x1bb),(_0x5a815d,_0x47cb51,_0x4bf14e)=>{const _0x203488=_0x519bb2;if(_0x5a815d[_0x203488(0x1dd)]['is_admin']!=0x1)return _0x47cb51['json']({'code':0x66});let _0x364cea=_0x5a815d[_0x203488(0x1ae)]['id'],_0x4706fb=dbFileShare[_0x203488(0x1c8)](_0x5a815d[_0x203488(0x1c6)][_0x203488(0x1bc)],_0x364cea),_0x5256ff=dbFileShare[_0x203488(0x1d0)](_0x5a815d['app']['dbOther'],_0x4706fb['id']),_0x50e591='(';for(let _0x2a9ddd in _0x5256ff){_0x50e591+=_0x5256ff[_0x2a9ddd]['user_id'],_0x2a9ddd!=_0x5256ff[_0x203488(0x1d6)]-0x1&&(_0x50e591+=',');}_0x50e591+=')';let _0x2e8263=dbUserTable[_0x203488(0x1a5)](_0x5a815d['app'][_0x203488(0x1bc)],_0x203488(0x1bf)+_0x50e591+'\x20',_0x203488(0x1e0));_0x4706fb[_0x203488(0x1de)]=_0x2e8263,_0x47cb51[_0x203488(0x1d9)]({'code':0x0,'data':_0x4706fb});}),module[_0x519bb2(0x1ec)]=router;