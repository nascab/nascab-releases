const _0xb2a202=_0x3c9d;(function(_0x542094,_0x416910){const _0x281314=_0x3c9d,_0x3c742a=_0x542094();while(!![]){try{const _0x510888=parseInt(_0x281314(0x198))/0x1+parseInt(_0x281314(0x16d))/0x2*(-parseInt(_0x281314(0x1a0))/0x3)+parseInt(_0x281314(0x1a1))/0x4*(parseInt(_0x281314(0x181))/0x5)+-parseInt(_0x281314(0x176))/0x6+-parseInt(_0x281314(0x1a7))/0x7*(parseInt(_0x281314(0x1b2))/0x8)+-parseInt(_0x281314(0x193))/0x9+-parseInt(_0x281314(0x18c))/0xa*(-parseInt(_0x281314(0x192))/0xb);if(_0x510888===_0x416910)break;else _0x3c742a['push'](_0x3c742a['shift']());}catch(_0x70fd0b){_0x3c742a['push'](_0x3c742a['shift']());}}}(_0x283c,0x364bd));var express=require(_0xb2a202(0x19f)),router=express[_0xb2a202(0x18d)]();let path=require(_0xb2a202(0x1ad)),fs=require('fs');function _0x3c9d(_0x45729c,_0x1b1445){const _0x283c4d=_0x283c();return _0x3c9d=function(_0x3c9df9,_0x1c1186){_0x3c9df9=_0x3c9df9-0x16b;let _0x1001b3=_0x283c4d[_0x3c9df9];return _0x1001b3;},_0x3c9d(_0x45729c,_0x1b1445);}const dbFileShare=require(_0xb2a202(0x16f)),dbUserTable=require(_0xb2a202(0x1b4));let dbConfigTable=require('../../db/dbConfigTable');router[_0xb2a202(0x186)]('/create',(_0x5471eb,_0x5bbd7c,_0x499be5)=>{const _0x29a99e=_0xb2a202;if(_0x5471eb[_0x29a99e(0x178)][_0x29a99e(0x17e)]!=0x1)return _0x5bbd7c[_0x29a99e(0x1a2)]({'code':0x66});let _0x840c47=_0x5471eb[_0x29a99e(0x16b)][_0x29a99e(0x17a)],_0x48393b=_0x5471eb[_0x29a99e(0x16b)]['users'],_0x319ae5=_0x5471eb[_0x29a99e(0x16b)]['path'],_0x14a0f2=_0x5471eb['body'][_0x29a99e(0x18f)];fs[_0x29a99e(0x180)](_0x319ae5,fs[_0x29a99e(0x187)][_0x29a99e(0x1ae)]|fs[_0x29a99e(0x187)][_0x29a99e(0x18b)],_0x555395=>{const _0x259b2a=_0x29a99e;if(_0x555395)return _0x5471eb[_0x259b2a(0x16e)][_0x259b2a(0x1a5)](_0x5bbd7c,_0x5bbd7c['__'](_0x259b2a(0x1a8))+':'+_0x319ae5);let _0x31da63=_0x5471eb['body'][_0x259b2a(0x194)];if(_0x14a0f2==_0x259b2a(0x173)){if(!_0x31da63)return _0x5471eb['app']['returnErrMsg'](_0x5bbd7c,_0x5bbd7c['__'](_0x259b2a(0x1aa)));else{let _0x114112=[_0x31da63],_0x477fe7=_0x259b2a(0x16c),_0x392654=dbFileShare[_0x259b2a(0x179)](_0x5471eb['app'][_0x259b2a(0x17d)],_0x477fe7,_0x114112);if(_0x392654){if(_0x840c47=='create'||_0x840c47==_0x259b2a(0x19a)&&_0x392654['id']!=_0x5471eb[_0x259b2a(0x16b)]['id'])return _0x5471eb['app'][_0x259b2a(0x1a5)](_0x5bbd7c,_0x5bbd7c['__'](_0x259b2a(0x171))+':'+_0x31da63);}}}fs[_0x259b2a(0x175)](_0x319ae5,(_0x31a1e3,_0x4b1060)=>{const _0x1e179=_0x259b2a;if(_0x31a1e3)return _0x5471eb['app'][_0x1e179(0x1a5)](_0x5bbd7c,'Invalid\x20path');if(_0x4b1060[_0x1e179(0x1a9)]()){let _0x1ad06d=_0x319ae5,_0x574901=_0x1e179(0x17b),_0x313620=[_0x1ad06d,_0x14a0f2],_0x37f39f=dbFileShare[_0x1e179(0x179)](_0x5471eb[_0x1e179(0x16e)][_0x1e179(0x17d)],_0x574901,_0x313620);if(_0x37f39f){if(_0x840c47=='create'||_0x840c47==_0x1e179(0x19a)&&_0x37f39f['id']!=_0x5471eb['body']['id'])return _0x5471eb['app']['returnErrMsg'](_0x5bbd7c,_0x5bbd7c['__'](_0x1e179(0x188))+':'+_0x319ae5);}if(_0x14a0f2=='FTP'&&_0x840c47==_0x1e179(0x184))for(let _0x1e34a0 in _0x48393b){let _0x2637cd=_0x48393b[_0x1e34a0]['id'],_0x414ceb=dbUserTable[_0x1e179(0x195)](_0x5471eb[_0x1e179(0x16e)][_0x1e179(0x17d)],_0x2637cd),_0x1b277b=dbFileShare[_0x1e179(0x19c)](_0x5471eb[_0x1e179(0x16e)]['dbOther'],_0x2637cd,'FTP');if(_0x1b277b)return _0x5471eb[_0x1e179(0x16e)]['returnErrMsg'](_0x5bbd7c,_0x5bbd7c['__'](_0x1e179(0x1b1))+':'+_0x414ceb[_0x1e179(0x19d)]);}let _0x375d49={'path':_0x319ae5,'path_sign':_0x31da63,'server_type':_0x14a0f2};if(_0x840c47==_0x1e179(0x184)){let _0x1268c4=dbFileShare['create'](_0x5471eb['app'][_0x1e179(0x17d)],_0x375d49),_0x492c1b=_0x1268c4['lastInsertRowid'];for(let _0x2708bb in _0x48393b){dbFileShare['createShareUser'](_0x5471eb[_0x1e179(0x16e)][_0x1e179(0x17d)],_0x492c1b,_0x48393b[_0x2708bb]['id']);}}else{if(_0x840c47=='update'){let _0x45c418=_0x5471eb[_0x1e179(0x16b)]['id'];dbFileShare[_0x1e179(0x19a)](_0x5471eb[_0x1e179(0x16e)][_0x1e179(0x17d)],_0x375d49,_0x45c418),dbFileShare['deleteShareUser'](_0x5471eb[_0x1e179(0x16e)][_0x1e179(0x17d)],_0x45c418);for(let _0x32a199 in _0x48393b){dbFileShare[_0x1e179(0x1a4)](_0x5471eb[_0x1e179(0x16e)][_0x1e179(0x17d)],_0x45c418,_0x48393b[_0x32a199]['id']);}}}return process['send']({'type':_0x1e179(0x189),'shareType':_0x14a0f2}),_0x5bbd7c[_0x1e179(0x1a2)]({'code':0x0});}else return _0x5471eb[_0x1e179(0x16e)][_0x1e179(0x1a5)](_0x5bbd7c,'\x20path\x20is\x20not\x20directory');});});}),router[_0xb2a202(0x186)](_0xb2a202(0x1ac),(_0x3d0f29,_0x3611c6,_0x2ba004)=>{const _0x58f6e6=_0xb2a202;if(_0x3d0f29[_0x58f6e6(0x178)][_0x58f6e6(0x17e)]!=0x1)return _0x3611c6[_0x58f6e6(0x1a2)]({'code':0x66});let _0x2150cb=_0x3d0f29[_0x58f6e6(0x16b)]['id'],_0x2e8cc2=dbFileShare['getById'](_0x3d0f29[_0x58f6e6(0x16e)][_0x58f6e6(0x17d)],_0x2150cb);dbFileShare['delete'](_0x3d0f29[_0x58f6e6(0x16e)][_0x58f6e6(0x17d)],_0x2150cb),process[_0x58f6e6(0x190)]({'type':_0x58f6e6(0x189),'shareType':_0x2e8cc2[_0x58f6e6(0x183)]}),_0x3611c6[_0x58f6e6(0x1a2)]({'code':0x0});}),router[_0xb2a202(0x186)](_0xb2a202(0x191),(_0x4f9507,_0x3a4895,_0x3ebe4f)=>{const _0x40ad46=_0xb2a202;if(_0x4f9507['currentUser']['is_admin']!=0x1)return _0x3a4895[_0x40ad46(0x1a2)]({'code':0x66});let _0x11f235=_0x4f9507[_0x40ad46(0x16b)][_0x40ad46(0x18f)],_0x2718de=dbFileShare[_0x40ad46(0x174)](_0x4f9507[_0x40ad46(0x16e)][_0x40ad46(0x17d)],_0x40ad46(0x196),[_0x11f235]);for(let _0x4d5650 in _0x2718de){let _0x1c0ab7=_0x2718de[_0x4d5650],_0x235962=dbFileShare[_0x40ad46(0x1a3)](_0x4f9507['app'][_0x40ad46(0x17d)],_0x1c0ab7['id']),_0x59fc65='(';for(let _0x3f18b6 in _0x235962){_0x59fc65+=_0x235962[_0x3f18b6][_0x40ad46(0x1b0)],_0x3f18b6!=_0x235962[_0x40ad46(0x19b)]-0x1&&(_0x59fc65+=',');}_0x59fc65+=')';let _0x35b219=dbUserTable[_0x40ad46(0x174)](_0x4f9507[_0x40ad46(0x16e)]['dbOther'],_0x40ad46(0x18e)+_0x59fc65+'\x20',_0x40ad46(0x199));_0x2718de[_0x4d5650][_0x40ad46(0x17c)]=_0x35b219;}let _0x3dc0bb={'code':0x0,'data':_0x2718de},_0xebad46='',_0x2816dd='',_0x167480='';try{let _0x262b7f=dbConfigTable[_0x40ad46(0x197)](_0x4f9507['app'][_0x40ad46(0x17d)],_0x40ad46(0x182)),_0x7576bf=dbConfigTable[_0x40ad46(0x197)](_0x4f9507[_0x40ad46(0x16e)][_0x40ad46(0x17d)],_0x40ad46(0x1a6)),_0x4ff1c8=dbConfigTable[_0x40ad46(0x197)](_0x4f9507[_0x40ad46(0x16e)][_0x40ad46(0x17d)],_0x40ad46(0x1af)),_0x18367a=dbConfigTable[_0x40ad46(0x197)](_0x4f9507[_0x40ad46(0x16e)][_0x40ad46(0x17d)],_0x40ad46(0x1b3));if(_0x18367a){_0x18367a=JSON[_0x40ad46(0x1ab)](_0x18367a[_0x40ad46(0x17f)]);for(let _0x33a5f5 of _0x18367a){if(_0x33a5f5[_0x40ad46(0x17a)]==_0x40ad46(0x18a)){_0xebad46='http://'+_0x33a5f5['ip'],_0x2816dd=_0x40ad46(0x177)+_0x33a5f5['ip'],_0x167480='ftp://'+_0x33a5f5['ip'];break;}}}_0x262b7f&&(_0x262b7f=JSON[_0x40ad46(0x1ab)](_0x262b7f[_0x40ad46(0x17f)]),_0xebad46+=':'+_0x262b7f[_0x40ad46(0x185)],_0x3dc0bb['webdavHttp']=_0xebad46),_0x7576bf&&(_0x7576bf=JSON[_0x40ad46(0x1ab)](_0x7576bf[_0x40ad46(0x17f)]),_0x2816dd+=':'+_0x7576bf[_0x40ad46(0x185)],_0x3dc0bb['webdavHttps']=_0x2816dd),_0x4ff1c8&&(_0x4ff1c8=JSON['parse'](_0x4ff1c8[_0x40ad46(0x17f)]),_0x167480+=':'+_0x4ff1c8[_0x40ad46(0x185)],_0x3dc0bb['ftpHttp']=_0x167480);}catch(_0x3d90b0){console[_0x40ad46(0x170)](_0x3d90b0);}_0x3a4895[_0x40ad46(0x1a2)](_0x3dc0bb);}),router['post'](_0xb2a202(0x19e),(_0x5cd171,_0xc72579,_0x120562)=>{const _0x236648=_0xb2a202;if(_0x5cd171[_0x236648(0x178)][_0x236648(0x17e)]!=0x1)return _0xc72579['json']({'code':0x66});let _0x1b8a3b=_0x5cd171[_0x236648(0x16b)]['id'],_0x45de24=dbFileShare[_0x236648(0x172)](_0x5cd171[_0x236648(0x16e)][_0x236648(0x17d)],_0x1b8a3b),_0xe5ec07=dbFileShare['getSharesUserByShareId'](_0x5cd171[_0x236648(0x16e)][_0x236648(0x17d)],_0x45de24['id']),_0x492dea='(';for(let _0xf6efda in _0xe5ec07){_0x492dea+=_0xe5ec07[_0xf6efda][_0x236648(0x1b0)],_0xf6efda!=_0xe5ec07['length']-0x1&&(_0x492dea+=',');}_0x492dea+=')';let _0x3919fd=dbUserTable[_0x236648(0x174)](_0x5cd171['app'][_0x236648(0x17d)],_0x236648(0x18e)+_0x492dea+'\x20','\x20username,id');_0x45de24[_0x236648(0x17c)]=_0x3919fd,_0xc72579[_0x236648(0x1a2)]({'code':0x0,'data':_0x45de24});}),module['exports']=router;function _0x283c(){const _0x52177f=['/getAll','1325489XWIOpF','3758724ORnNoi','pathSign','find','server_type=?\x20order\x20by\x20id\x20desc','findByTitle','217398EtRySU','\x20username,id','update','length','userHasFtp','username','/getById','express','33HDskXb','48RvwZsq','json','getSharesUserByShareId','createShareUser','returnErrMsg','webDavHttpsServer','133tmEsQH','noWritePermission','isDirectory','pathSignNoNull','parse','/delete','path','W_OK','FTPServer','user_id','share.alreadyHasOtherFtp','96392OMSPWF','globalIpList','../../db/dbUserTable','body','\x20path_sign=?\x20and\x20server_type=\x27WebDav\x27','5492hgDLPm','app','../../db/dbFileShare','log','share.samePathSign','getById','WebDav','getAllByWhere','stat','669930oHCRUj','https://','currentUser','getByWhere','type','\x20path=?\x20and\x20server_type=?','users','dbOther','is_admin','value','access','79555SdzNQu','webDavServer','server_type','create','port','post','constants','share.samePathExist','fileShareRestart','ipv4','R_OK','50TTBNXe','Router','\x20id\x20in\x20','serverType','send'];_0x283c=function(){return _0x52177f;};return _0x283c();}