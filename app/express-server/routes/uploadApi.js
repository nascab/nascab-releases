const _0x385e47=_0x5847;(function(_0x476d1d,_0x4f3192){const _0x4abae4=_0x5847,_0x1f00c7=_0x476d1d();while(!![]){try{const _0x294fab=parseInt(_0x4abae4(0x1dd))/0x1+parseInt(_0x4abae4(0x1e3))/0x2+parseInt(_0x4abae4(0x1e5))/0x3*(parseInt(_0x4abae4(0x1b7))/0x4)+-parseInt(_0x4abae4(0x1d9))/0x5*(parseInt(_0x4abae4(0x1ab))/0x6)+parseInt(_0x4abae4(0x1d5))/0x7*(parseInt(_0x4abae4(0x1db))/0x8)+-parseInt(_0x4abae4(0x1b4))/0x9*(parseInt(_0x4abae4(0x1df))/0xa)+-parseInt(_0x4abae4(0x1c1))/0xb;if(_0x294fab===_0x4f3192)break;else _0x1f00c7['push'](_0x1f00c7['shift']());}catch(_0x51c716){_0x1f00c7['push'](_0x1f00c7['shift']());}}}(_0xc1ab,0x41f6d));function _0xc1ab(){const _0x1d7c54=['noPermission','log','exports','lastIndexOf','savePath','folder','../utils/uploadUtils','书籍封面保存目录','join','../../db/dbUserTable','2233tnDVIO','headers','substring','over','25kZoikk','stat','11048yRNZkE','error\x20book\x20index\x20id','407983pxJMvQ','doUserCanGet','20Ubucaq','relativePath','operationFail','W_OK','1001722eUSKsr','access','39mDDGkf','uploadSubtitle','317064VNJQtJ','mkdirSync','/folderExist','uploadFile','path','returnErrMsg','nascab_torrentSavePath','../utils/fileUtils','R_OK','1124163sVDhYb','existsSync','post','155052PqZRVp','query','sameNameFileAlreadExist','express','constants','.jpg','INDEX_TABLE_NAME_BOOK','/regularUpload','overMode','skip','11759869XvqVKY','json','body','encodeFilename','app','uploadBookCover','filename','decodePath','returnFileError','getById'];_0xc1ab=function(){return _0x1d7c54;};return _0xc1ab();}let express=require(_0x385e47(0x1ba)),router=express['Router'](),uploadUtil=require(_0x385e47(0x1d1));const dbUserTable=require(_0x385e47(0x1d4));let fs=require('fs'),fileUtil=require(_0x385e47(0x1b2)),path=require('path'),config=require('../../myConfig/config');const dbFileIndexTable=require('../../db/dbFileIndexTable');function _0x5847(_0xb4983e,_0x5b730){const _0xc1abfb=_0xc1ab();return _0x5847=function(_0x584746,_0x3d79de){_0x584746=_0x584746-0x1ab;let _0x73e7f2=_0xc1abfb[_0x584746];return _0x73e7f2;},_0x5847(_0xb4983e,_0x5b730);}router[_0x385e47(0x1b6)](_0x385e47(0x1ad),function(_0x22e301,_0x582644){const _0xd6df00=_0x385e47;let _0x1ca37a=_0x22e301['body'][_0xd6df00(0x1cf)];fs[_0xd6df00(0x1da)](_0x1ca37a,(_0x18320b,_0x55b410)=>{const _0x591449=_0xd6df00;return _0x18320b?_0x22e301['app'][_0x591449(0x1b0)](_0x582644,_0x582644['__']('targetFolderNotExist')):_0x582644[_0x591449(0x1c2)]({'code':0x0});});}),router[_0x385e47(0x1b6)](_0x385e47(0x1be),function(_0xa76c49,_0x490f19){const _0x201f47=_0x385e47;if(_0xa76c49[_0x201f47(0x1d6)]['save_path']){let _0x463eb8=decodeURIComponent(_0xa76c49['headers']['save_path']);_0xa76c49[_0x201f47(0x1c3)][_0x201f47(0x1cf)]=_0x463eb8,_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1cf)]=_0x463eb8;}_0xa76c49[_0x201f47(0x1d6)]['over_mode']&&(_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1bf)]=_0xa76c49[_0x201f47(0x1d6)]['over_mode']);let _0x11ed68,_0x3c0b15,_0x3b89a9=!![];try{_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1cf)]&&(_0x11ed68=fileUtil['decodePath'](_0xa76c49[_0x201f47(0x1b8)]['savePath']));if(_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1c6)]==0x1){let _0x317695=_0xa76c49[_0x201f47(0x1b8)]['bookIndexId'];if(!_0x317695)return _0xa76c49[_0x201f47(0x1c5)][_0x201f47(0x1b0)](_0x490f19,'need\x20book\x20index\x20id');let _0xe94aa1=dbFileIndexTable[_0x201f47(0x1ca)](_0xa76c49[_0x201f47(0x1c5)]['dbFileIndex'],_0x317695,dbFileIndexTable[_0x201f47(0x1bd)]);if(!_0xe94aa1)return _0xa76c49[_0x201f47(0x1c5)][_0x201f47(0x1b0)](_0x490f19,_0x201f47(0x1dc));_0x11ed68=_0xe94aa1[_0x201f47(0x1af)],_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1cf)]=_0xe94aa1[_0x201f47(0x1af)],_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1bf)]=_0x201f47(0x1d8),_0x3b89a9=![];let _0x3581c9=path[_0x201f47(0x1d3)](_0xe94aa1[_0x201f47(0x1af)],_0xe94aa1['filename']),_0x10e291=_0x3581c9[_0x201f47(0x1d7)](0x0,_0x3581c9[_0x201f47(0x1ce)]('.'))+_0x201f47(0x1bc),_0x22c08c=path['basename'](_0x10e291);_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1c7)]=encodeURIComponent(_0x22c08c),console[_0x201f47(0x1cc)](_0x201f47(0x1d2),_0x11ed68,_0xa76c49['query'][_0x201f47(0x1c7)]);}if(_0xa76c49['query'][_0x201f47(0x1e0)]){_0x3c0b15=fileUtil[_0x201f47(0x1c8)](_0xa76c49[_0x201f47(0x1b8)]['relativePath']);let _0x11e86c=path['dirname'](path['join'](_0x11ed68,_0x3c0b15));!fs[_0x201f47(0x1b5)](_0x11e86c)&&fs[_0x201f47(0x1ac)](_0x11e86c,{'recursive':!![]}),_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1cf)]=_0x11e86c,_0x3b89a9=![];}if(_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1c4)]){_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1c7)]=fileUtil[_0x201f47(0x1c8)](_0xa76c49['query']['encodeFilename']);let _0x44b5a6=path['join'](_0x11ed68,_0xa76c49[_0x201f47(0x1b8)]['filename']);if(_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1bf)]&&_0xa76c49[_0x201f47(0x1b8)][_0x201f47(0x1bf)]==_0x201f47(0x1c0)&&fs['existsSync'](_0x44b5a6))return _0x490f19['json']({'code':0x1,'remark':'SAMENAME','message':_0x490f19['__'](_0x201f47(0x1b9))});}}catch(_0x1cf3d4){return console[_0x201f47(0x1cc)](_0x1cf3d4),_0xa76c49[_0x201f47(0x1c5)][_0x201f47(0x1b0)](_0x490f19,_0x490f19['__'](_0x201f47(0x1e1)));}if(_0x11ed68&&_0x11ed68!=_0x201f47(0x1b1))fs[_0x201f47(0x1e4)](_0x11ed68,fs[_0x201f47(0x1bb)][_0x201f47(0x1e2)]|fs[_0x201f47(0x1bb)][_0x201f47(0x1b3)],_0x538172=>{const _0x1877b2=_0x201f47;if(_0x538172)return fileUtil[_0x1877b2(0x1c9)](_0x490f19,_0x538172);if(dbUserTable[_0x1877b2(0x1de)](_0xa76c49,_0x490f19,_0x1877b2(0x1d0),'power_add',_0x11ed68,!![])==!![])uploadUtil[_0x1877b2(0x1ae)](_0xa76c49,_0x490f19,_0x3b89a9);else return _0xa76c49[_0x1877b2(0x1c5)][_0x1877b2(0x1b0)](_0x490f19,_0x490f19['__'](_0x1877b2(0x1cb)));});else _0xa76c49['query'][_0x201f47(0x1e6)]==0x1?uploadUtil['uploadFile'](_0xa76c49,_0x490f19,_0x3b89a9):uploadUtil[_0x201f47(0x1ae)](_0xa76c49,_0x490f19,_0x3b89a9);}),module[_0x385e47(0x1cd)]=router;