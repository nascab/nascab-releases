const _0x3cc632=_0x54e8;(function(_0x4acae7,_0x4a79b0){const _0x414ae9=_0x54e8,_0x4f905f=_0x4acae7();while(!![]){try{const _0x54ce95=-parseInt(_0x414ae9(0xf6))/0x1+-parseInt(_0x414ae9(0x88))/0x2+-parseInt(_0x414ae9(0xef))/0x3+-parseInt(_0x414ae9(0xbe))/0x4+parseInt(_0x414ae9(0x9b))/0x5+-parseInt(_0x414ae9(0x105))/0x6*(-parseInt(_0x414ae9(0x116))/0x7)+parseInt(_0x414ae9(0x102))/0x8;if(_0x54ce95===_0x4a79b0)break;else _0x4f905f['push'](_0x4f905f['shift']());}catch(_0x51ddd9){_0x4f905f['push'](_0x4f905f['shift']());}}}(_0x1604,0x7b543));let express=require('express'),router=express['Router'](),config=require(_0x3cc632(0x94)),path=require(_0x3cc632(0xaa)),fs=require('fs'),dbMusicIndexTable=require(_0x3cc632(0x12f)),dbFileIndexTable=require(_0x3cc632(0x9f)),dbMusicPlaylistTable=require('../../db/dbMusicPlaylistTable'),dbMusicFavorite=require(_0x3cc632(0x118)),jsmediatags=require(_0x3cc632(0x123));const dbUserTable=require(_0x3cc632(0xe9));function _0x1604(){const _0x3b8eab=['replace','cover_path','/getMusicCover','temp.','dbOther','platform','\x20AND\x20','filePath','existsSync','playlistId\x20no\x20exists','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','power_add','musicIsFavorite','post','log','/getMusicHomeData','\x20order\x20by\x20m.update_time\x20DESC\x20','dirname','filename','\x20order\x20by\x20f.album_fl\x20','recentMusic','utf-8','duration','picture','/getMusicList','../../db/dbUserTable','/operationPlaylist','APIC','inner','removeMusicFromPlaylist','\x20AND\x20album=?\x20','255048vraUhF','artistList','now','skipCount','removePlaylist','\x20(type=3\x20OR\x20is_file=0)','getPathByType','1004884mQKNBO','playlist','getPlaylistMusicCount','\x20LIMIT\x20?\x20OFFSET\x20?\x20','message','need\x20playlistId',',f.album\x20','searchMusicAlbum','\x20order\x20by\x20f.artist_fl\x20','desc','maxPlayMusic','lyrics_get_state','7347600DxCHOV','sendFile','favorite','5071296nbNutb','groupField','sha256','letterIndex','orderType','sep','paramsList','exports','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','app','listType','need\x20\x27name\x27','push','end','getFavoriteCount','currentUser','offset','7qFThZI','prepare','../../db/dbMusicFavorite','trim','\x20order\x20by\x20m.update_time\x20','SELECT\x20','lyricList','\x20is_file=1',',id\x20asc','lrc','length','status','name','jsmediatags','basename','/getMusicDetail','title','json','getMusicIndex','getFavorite','all','query','checkOrderParams','albumCount','=?\x20','../../db/dbMusicIndexTable','playlistId','getMediaCoverCachePath','file','NO\x20MUSIC\x20INDEX','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre','add','deleteFavorite','returnErrMsg','axios','includes','favorite_time','searchMusicName','play_count','/searchLyric','whereStr','size','getAllFavoriteByWhere','extname','createPlaylist','orderField/orderType\x20error','INDEX_TABLE_NAME_MUSIC','../../utils/musicUtil','toString','isSearch','body','440612nSkQcA','image','/getMusicIndexFileTree','/operationPlaylistIndex','run',',f.filename_fl\x20','getPlaylistById','UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?','operation','albumList','orderField','../utils/sharpUtils','../../myConfig/config','is_admin','tags','updatePlaylist','album','indexId','lyric','3335330iiFTRp','doUserCanGet','getGroupList','\x20FROM\x20file_index_music\x20WHERE\x20','../../db/dbFileIndexTable','getUserPower','need\x20musicIndexId\x20and\x20playlistId','base64','getCoverByField','parent','addFavorite','last_play_time','edit','music','coverList','path','uid','data','SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','username','artist','genTinyFile','delete','writeFile','list','operation\x20error','lyrics','/getGroupList','year','getMusicSameNameCover','file_cover_path','ORDER\x20BY\x20','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','from','\x20order\x20by\x20f.title_fl\x20','2461484ySXkte','stringify','music_count','getById',',f.artist\x20','/musicFavorite','count','getUserPathWhere','dbFileIndex','is_file','join','musicIndexId','power_get','asc','read','../../db/dbSourceFolderTable','transStringToUtf8','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)'];_0x1604=function(){return _0x3b8eab;};return _0x1604();}let musicUitls=require(_0x3cc632(0x84)),lyricUtils=require('../../utils/music/lyricUtils'),sharpUtil=require(_0x3cc632(0x93));const dbSourceFolderTable=require(_0x3cc632(0xcd));let axios=require(_0x3cc632(0x77)),sha256=require(_0x3cc632(0x107)),os=require('os');function _0x54e8(_0x4c7a61,_0x2afee3){const _0x160479=_0x1604();return _0x54e8=function(_0x54e890,_0x191525){_0x54e890=_0x54e890-0x72;let _0x32298e=_0x160479[_0x54e890];return _0x32298e;},_0x54e8(_0x4c7a61,_0x2afee3);}const urlConfig=require('../../myConfig/urlConfig');function getFavoriteMusicList(_0x5ac3e3,_0x2aa8f0,_0x18edc8,_0x1a7543,_0x598a70,_0x58816e,_0xb90ecb){const _0x8ef3e5=_0x3cc632;let _0xd94a87='',_0x111cca=[];_0xd94a87+=_0x8ef3e5(0x11d);_0x58816e&&(_0x58816e=_0x58816e[_0x8ef3e5(0xd0)]('\x27','')['replace']('â€™',''),_0xd94a87+=_0x8ef3e5(0xbb),_0x111cca[_0x8ef3e5(0x111)]('%'+_0x58816e+'%','%'+_0x58816e+'%','%'+_0x58816e+'%'));_0xb90ecb&&(_0xd94a87+=_0x8ef3e5(0xcf),_0x111cca[_0x8ef3e5(0x111)](_0xb90ecb,_0xb90ecb));if(_0x1a7543&&_0x598a70){if(_0x1a7543=='artist')_0xd94a87+=_0x8ef3e5(0xfe)+_0x598a70+_0x8ef3e5(0xc2)+_0x598a70+'\x20';else{if(_0x1a7543==_0x8ef3e5(0x98))_0xd94a87+=_0x8ef3e5(0xe3)+_0x598a70+_0x8ef3e5(0xfc)+_0x598a70+'\x20';else{if(_0x1a7543==_0x8ef3e5(0x126))_0xd94a87+=_0x8ef3e5(0xbd)+_0x598a70+',f.title\x20'+_0x598a70+_0x8ef3e5(0x8d)+_0x598a70+'\x20';else _0x1a7543==_0x8ef3e5(0x79)?_0xd94a87+=_0x8ef3e5(0x11a)+_0x598a70+'\x20':_0xd94a87+='\x20order\x20by\x20f.'+_0x1a7543+'\x20'+_0x598a70+'\x20';}}}else _0xd94a87+=_0x8ef3e5(0xe0);return _0xd94a87+=_0x8ef3e5(0xf9),_0x111cca[_0x8ef3e5(0x111)](_0x2aa8f0),_0x111cca[_0x8ef3e5(0x111)](_0x18edc8),result=dbMusicFavorite[_0x8ef3e5(0x7f)](_0x5ac3e3[_0x8ef3e5(0x10e)]['dbFileIndex'],_0x5ac3e3['currentUser']['id'],_0xd94a87,'*',_0x111cca),result=dealMusicList(_0x5ac3e3,result),result;}function dealMusicList(_0x11dec4,_0x363979){const _0x4bbd7b=_0x3cc632;for(let _0x99115b of _0x363979){_0x99115b[_0x4bbd7b(0x104)]=dbMusicFavorite[_0x4bbd7b(0xdc)](_0x11dec4[_0x4bbd7b(0x10e)][_0x4bbd7b(0xc6)],_0x99115b['id'],_0x11dec4['currentUser']['id'])?'1':'0';if(!_0x99115b[_0x4bbd7b(0xd1)]){let _0x1b1085=!![];_0x99115b['file_cover_path']&&fs['existsSync'](_0x99115b[_0x4bbd7b(0xb9)])&&(_0x1b1085=![]),_0x1b1085&&(_0x99115b[_0x4bbd7b(0xb9)]=musicUitls[_0x4bbd7b(0xb8)](_0x11dec4[_0x4bbd7b(0x10e)][_0x4bbd7b(0xc6)],_0x99115b));}_0x99115b[_0x4bbd7b(0xd7)]=path[_0x4bbd7b(0xc8)](_0x99115b[_0x4bbd7b(0xaa)],_0x99115b[_0x4bbd7b(0xe2)]),delete _0x99115b[_0x4bbd7b(0xaa)];}return _0x363979;}function getMusicListByParams(_0x227c2a,_0x135293,_0x545273,_0x75ad0c,_0xf9aab2,_0x5769e8,_0x3589ec,_0x31e5f5,_0x5e3f98,_0x22bea0,_0x5bc0c7,_0x106f9a,_0x5815ee){const _0x350a1d=_0x3cc632;let _0x3f8e90=_0x227c2a[_0x350a1d(0x10e)][_0x350a1d(0xc6)],_0x191057=[];return _0x191057=dbMusicIndexTable['getMusicList'](_0x3f8e90,_0x135293,_0x545273,_0x75ad0c,_0xf9aab2,_0x5769e8,_0x3589ec,_0x31e5f5,_0x5e3f98,_0x22bea0,_0x106f9a,_0x5bc0c7,_0x5815ee),_0x191057=dealMusicList(_0x227c2a,_0x191057),_0x191057;}router[_0x3cc632(0xdd)](_0x3cc632(0xdf),(_0x90c006,_0xcf69fb,_0x443fcf)=>{const _0x1cf934=_0x3cc632;let _0x45c1c2=_0x90c006[_0x1cf934(0x10e)][_0x1cf934(0xc6)],_0xeb12f9=_0x90c006[_0x1cf934(0x87)][_0x1cf934(0xc4)]?_0x90c006[_0x1cf934(0x87)][_0x1cf934(0xc4)]:0xc,_0x5082a0=_0x90c006[_0x1cf934(0x87)][_0x1cf934(0x12d)]?_0x90c006[_0x1cf934(0x87)]['albumCount']:0xc,_0x524aaa=dbUserTable[_0x1cf934(0xc5)](_0x90c006,_0x1cf934(0xa8),_0x1cf934(0xca),!![]);if(_0x90c006[_0x1cf934(0x114)]['is_admin']!=0x1&&!_0x524aaa[_0x1cf934(0x7d)])return _0xcf69fb[_0x1cf934(0x127)]({'code':0x0,'data':null});let _0xdb23e3=getMusicListByParams(_0x90c006,_0x524aaa,_0xeb12f9,0x0,_0x1cf934(0xa6),'desc'),_0x21add3=getMusicListByParams(_0x90c006,_0x524aaa,_0xeb12f9,0x0,'play_count\x20desc',_0x1cf934(0x11e)),_0x486e68=getMusicListByParams(_0x90c006,_0x524aaa,_0xeb12f9,0x0,'id','desc'),_0x54103f=dbMusicIndexTable['getGroupList'](_0x45c1c2,_0x524aaa,_0x1cf934(0xaf),_0x5082a0,0x0,_0x1cf934(0xa6),_0x1cf934(0xff));for(let _0x16246c of _0x54103f){let _0x42068c='\x20AND\x20artist=?\x20'+_0x524aaa[_0x1cf934(0x7d)],_0x4a0ef7=[_0x16246c[_0x1cf934(0xaf)],..._0x524aaa[_0x1cf934(0x10b)]];_0x16246c[_0x1cf934(0xa9)]=dbMusicIndexTable[_0x1cf934(0xa3)](_0x90c006[_0x1cf934(0x10e)]['dbFileIndex'],_0x42068c,_0x4a0ef7);}let _0x41da9f=dbMusicIndexTable['getGroupList'](_0x45c1c2,_0x524aaa,'album',_0x5082a0,0x0,'play_count',_0x1cf934(0xff));for(let _0x235927 of _0x41da9f){let _0x5d7ec7=_0x1cf934(0xee)+_0x524aaa['whereStr'],_0x2ad8b1=[_0x235927['album'],..._0x524aaa[_0x1cf934(0x10b)]];_0x235927[_0x1cf934(0xa9)]=dbMusicIndexTable[_0x1cf934(0xa3)](_0x90c006[_0x1cf934(0x10e)]['dbFileIndex'],_0x5d7ec7,_0x2ad8b1);}let _0x25bfbf={};return _0xdb23e3&&_0xdb23e3[_0x1cf934(0x120)]>0x0&&(_0x25bfbf[_0x1cf934(0xe4)]=_0xdb23e3),_0x21add3&&_0x21add3[_0x1cf934(0x120)]>0x0&&(_0x25bfbf[_0x1cf934(0x100)]=_0x21add3),_0x486e68&&_0x486e68[_0x1cf934(0x120)]>0x0&&(_0x25bfbf['recentAddList']=_0x486e68),_0x54103f&&_0x54103f[_0x1cf934(0x120)]>0x0&&(_0x25bfbf[_0x1cf934(0xf0)]=_0x54103f),_0x41da9f&&_0x41da9f['length']>0x0&&(_0x25bfbf[_0x1cf934(0x91)]=_0x41da9f),_0xcf69fb['json']({'code':0x0,'data':_0x25bfbf,'platform':os[_0x1cf934(0xd5)]()});}),router[_0x3cc632(0xdd)](_0x3cc632(0xe8),(_0x2e4173,_0x307002,_0x4f77d3)=>{const _0x438787=_0x3cc632;let _0x2160bb=_0x2e4173['body']['count']||0x32,_0x46106c=_0x2e4173[_0x438787(0x87)][_0x438787(0x115)]||0x0,_0x64b70c=_0x2e4173[_0x438787(0x87)][_0x438787(0x98)],_0x2502f0=_0x2e4173[_0x438787(0x87)][_0x438787(0xb7)],_0x2791bc=_0x2e4173[_0x438787(0x87)]['artist'],_0x4cd5d0=_0x2e4173[_0x438787(0x87)]['genre'],_0x1910a1=_0x2e4173[_0x438787(0x87)][_0x438787(0x92)]||'last_play_time',_0x5b8a56=_0x2e4173[_0x438787(0x87)][_0x438787(0x109)]||_0x438787(0xff),_0x55687a=[_0x438787(0xb3),_0x438787(0x104),_0x438787(0xf7)],_0xc81188=_0x2e4173['body'][_0x438787(0x10f)]||'list',_0x9fc299=_0x2e4173[_0x438787(0x87)]['search'],_0x2ab65a=_0x2e4173[_0x438787(0x87)][_0x438787(0x108)],_0x1da0a6=_0x2e4173['body']['playlistId'];if(dbMusicIndexTable['checkOrderParams'](_0x2e4173,_0x307002,_0x1910a1,_0x5b8a56)!==!![])return;if(_0xc81188=='playlist'){if(!_0x1da0a6)return _0x2e4173['app'][_0x438787(0x76)](_0x307002,_0x438787(0xfb));}!_0x55687a[_0x438787(0x78)](_0xc81188)&&(_0xc81188=_0x438787(0xb3));_0x2160bb>0x1f4&&(_0x2160bb=0x1f4);let _0x4a7f87=dbUserTable[_0x438787(0xc5)](_0x2e4173,'music',_0x438787(0xca),!![]);if(_0x2e4173[_0x438787(0x114)][_0x438787(0x95)]!=0x1&&!_0x4a7f87[_0x438787(0x7d)])return _0x307002[_0x438787(0x127)]({'code':0x0,'data':null});let _0x168cf2=[];if(_0xc81188==_0x438787(0xf7)||_0xc81188==_0x438787(0xb3))_0x168cf2=getMusicListByParams(_0x2e4173,_0x4a7f87,_0x2160bb,_0x46106c,_0x1910a1,_0x5b8a56,_0x64b70c,_0x2502f0,_0x2791bc,_0x4cd5d0,_0x9fc299,_0x1da0a6,_0x2ab65a);else _0xc81188==_0x438787(0x104)&&(_0x168cf2=getFavoriteMusicList(_0x2e4173,_0x2160bb,_0x46106c,_0x1910a1,_0x5b8a56,_0x9fc299,_0x2ab65a));let _0x30ff0d={'code':0x0,'data':_0x168cf2};if(_0xc81188==_0x438787(0x104))_0x30ff0d[_0x438787(0xc0)]=dbMusicFavorite[_0x438787(0x113)](_0x2e4173[_0x438787(0x10e)]['dbFileIndex'],_0x2e4173[_0x438787(0x114)]['id']);else{if(_0xc81188==_0x438787(0xb3))_0x30ff0d['music_count']=dbMusicIndexTable['getMusicListCount'](_0x2e4173[_0x438787(0x10e)][_0x438787(0xc6)],_0x4a7f87,_0x64b70c,_0x2502f0,_0x2791bc,_0x4cd5d0);else _0xc81188==_0x438787(0xf7)&&(_0x30ff0d[_0x438787(0xc0)]=dbMusicPlaylistTable[_0x438787(0xf8)](_0x2e4173['app'][_0x438787(0xc6)],_0x1da0a6));}return _0x307002[_0x438787(0x127)](_0x30ff0d);}),router['post'](_0x3cc632(0x125),(_0x3e1782,_0x4ddea6,_0xadd9e6)=>{const _0x35e07d=_0x3cc632;let _0x3c2d51=_0x3e1782['body']['id'],_0x1e8979=dbFileIndexTable[_0x35e07d(0xc1)](_0x3e1782[_0x35e07d(0x10e)][_0x35e07d(0xc6)],_0x3c2d51,dbFileIndexTable[_0x35e07d(0x83)]);if(!_0x1e8979)return _0x3e1782[_0x35e07d(0x10e)][_0x35e07d(0x76)](_0x4ddea6,_0x35e07d(0x72));if(dbUserTable[_0x35e07d(0x9c)](_0x3e1782,_0x4ddea6,_0x35e07d(0xa8),'power_get',_0x1e8979[_0x35e07d(0xaa)])==!![]){let _0x56dd6c=_0x3e1782[_0x35e07d(0x114)]['id'],_0xe0eea4=dbMusicFavorite['getFavorite'](_0x3e1782[_0x35e07d(0x10e)]['dbFileIndex'],_0x56dd6c,_0x3c2d51);_0x1e8979[_0x35e07d(0xb9)]=musicUitls[_0x35e07d(0xb8)](_0x3e1782['app'][_0x35e07d(0xc6)],_0x1e8979),_0x1e8979[_0x35e07d(0x104)]=_0xe0eea4?0x1:0x0,getLyrics(_0x1e8979,_0x59d445=>{const _0x5cbc55=_0x35e07d;return _0x1e8979[_0x5cbc55(0x11c)]=_0x59d445,_0x4ddea6[_0x5cbc55(0x127)]({'code':0x0,'data':_0x1e8979});});}});function updateIndexLyric(_0x59f88c,_0x227f71,_0x18072b,_0x322ff9){const _0x5101db=_0x3cc632;if(_0x18072b&&_0x18072b['length']>0x0){let _0x2e7a8b=_0x322ff9['filename']['replace'](path[_0x5101db(0x80)](_0x322ff9['filename']),''),_0x3b36be=_0x2e7a8b+'.lrc',_0x17f668=path[_0x5101db(0xc8)](_0x322ff9[_0x5101db(0xaa)],_0x3b36be);fs[_0x5101db(0xb2)](_0x17f668,_0x18072b,_0x5101db(0xe5),_0x46829f=>{if(!_0x46829f){}});}let _0x2884d1=JSON[_0x5101db(0xbf)]({'lyrics':_0x18072b?_0x18072b:''});_0x59f88c[_0x5101db(0x117)](_0x5101db(0x8f))[_0x5101db(0x8c)](_0x227f71,_0x2884d1,_0x322ff9['id']);}router[_0x3cc632(0xdd)]('/saveLyric',(_0x50d70c,_0x2a0b55,_0x11b9a)=>{const _0x5306f5=_0x3cc632;let _0x38ee68=_0x50d70c['body']['id'],_0x3533b3=_0x50d70c[_0x5306f5(0x87)][_0x5306f5(0x9a)],_0x4838e5=dbFileIndexTable[_0x5306f5(0xc1)](_0x50d70c[_0x5306f5(0x10e)][_0x5306f5(0xc6)],_0x38ee68,dbFileIndexTable[_0x5306f5(0x83)]);if(!_0x4838e5)return _0x50d70c[_0x5306f5(0x10e)][_0x5306f5(0x76)](_0x2a0b55,_0x5306f5(0x72));if(!_0x3533b3)return _0x50d70c[_0x5306f5(0x10e)][_0x5306f5(0x76)](_0x2a0b55,'Lyric\x20is\x20null');if(dbUserTable[_0x5306f5(0x9c)](_0x50d70c,_0x2a0b55,_0x5306f5(0xa8),_0x5306f5(0xdb),_0x4838e5[_0x5306f5(0xaa)])==!![])return updateIndexLyric(_0x50d70c[_0x5306f5(0x10e)][_0x5306f5(0xc6)],0x1,_0x3533b3,_0x4838e5),_0x2a0b55['json']({'code':0x0});}),router[_0x3cc632(0xdd)](_0x3cc632(0x7c),(_0x321e28,_0x4bc7d7,_0x154d4f)=>{const _0x4905e5=_0x3cc632;let _0xc7f4c4=_0x321e28[_0x4905e5(0x87)]['id'],_0x27aebb=dbFileIndexTable['getById'](_0x321e28['app'][_0x4905e5(0xc6)],_0xc7f4c4,dbFileIndexTable[_0x4905e5(0x83)]);if(!_0x27aebb)return _0x321e28['app'][_0x4905e5(0x76)](_0x4bc7d7,_0x4905e5(0x72));let _0x4d5068=_0x321e28[_0x4905e5(0x87)][_0x4905e5(0x7a)],_0x454103=_0x321e28['body']['searchMusicArtist'],_0x3cffe7=_0x321e28[_0x4905e5(0x87)][_0x4905e5(0xfd)],_0x17d76a=_0x321e28[_0x4905e5(0x87)][_0x4905e5(0x86)];if(dbUserTable['doUserCanGet'](_0x321e28,_0x4bc7d7,_0x4905e5(0xa8),_0x4905e5(0xca),_0x27aebb[_0x4905e5(0xaa)])==!![]){if(_0x27aebb[_0x4905e5(0x101)]==0x1&&!_0x17d76a)return _0x4bc7d7[_0x4905e5(0x127)]({'code':0x0,'data':[_0x27aebb[_0x4905e5(0xb5)]]});let _0x6873d1=_0x321e28['body'][_0x4905e5(0xf2)]||0x0;if(!_0x4d5068||!_0x4d5068[_0x4905e5(0x119)]())return _0x4bc7d7['json']([]);let _0x4b8812={'searchMusicName':_0x4d5068,'searchMusicArtist':_0x454103,'searchMusicAlbum':_0x3cffe7,'isSearch':_0x17d76a,'skipCount':_0x6873d1,'token':sha256(_0x4d5068+config['apiTokenKey'])};lyricUtils['searchLyric'](_0x4b8812)['then'](_0x3c3370=>{const _0x4b8857=_0x4905e5;if(_0x3c3370){if(_0x3c3370[_0x4b8857(0x120)]>0x0&&!_0x17d76a){let _0x1cea5d=![],_0x49b0ec=0x14,_0x2f28c6=0x64,_0x2dfa9e=null;for(let _0x3ba582 of _0x3c3370){if(_0x3ba582[_0x4b8857(0xe6)]){let _0x70b942=_0x3ba582[_0x4b8857(0xe6)]/0x3e8,_0xc02f65=Math['abs'](_0x70b942-_0x27aebb[_0x4b8857(0xe6)]);_0xc02f65<_0x2f28c6&&(_0x2f28c6=_0xc02f65,_0x2dfa9e=_0x3ba582['lrc']?_0x3ba582[_0x4b8857(0x11f)]:'');}}return _0x2f28c6<_0x49b0ec?(_0x1cea5d=!![],_0x27aebb[_0x4b8857(0xb5)]=JSON['stringify']({'lyrics':_0x2dfa9e?_0x2dfa9e:''}),updateIndexLyric(_0x321e28[_0x4b8857(0x10e)][_0x4b8857(0xc6)],0x1,_0x2dfa9e,_0x27aebb)):updateIndexLyric(_0x321e28[_0x4b8857(0x10e)][_0x4b8857(0xc6)],0x1,'',_0x27aebb),_0x4bc7d7[_0x4b8857(0x127)]({'code':0x0,'data':_0x1cea5d&&_0x27aebb[_0x4b8857(0xb5)]?[_0x27aebb[_0x4b8857(0xb5)]]:[]});}else return _0x4bc7d7[_0x4b8857(0x127)]({'code':0x0,'data':_0x3c3370});}})['catch'](_0x588dc4=>{const _0x4a0b15=_0x4905e5;return _0x321e28[_0x4a0b15(0x10e)][_0x4a0b15(0x76)](_0x4bc7d7,_0x588dc4[_0x4a0b15(0xfa)]);});}});function getLyrics(_0x3cebc2,_0x13f7f4){const _0x139db0=_0x3cc632;let _0x2b26d9=[];try{_0x3cebc2[_0x139db0(0xb5)]&&_0x3cebc2[_0x139db0(0xb5)][_0x139db0(0x120)]>0xa&&_0x2b26d9[_0x139db0(0x111)]({'type':_0x139db0(0xec),'content':_0x3cebc2[_0x139db0(0xb5)]});let _0xc6f2aa=_0x3cebc2[_0x139db0(0xe2)][_0x139db0(0xd0)](path[_0x139db0(0x80)](_0x3cebc2[_0x139db0(0xe2)]),''),_0x57d9fb=_0xc6f2aa+'.lrc',_0x376dac=path['join'](_0x3cebc2[_0x139db0(0xaa)],_0x57d9fb);fs[_0x139db0(0xd8)](_0x376dac)?fs['readFile'](_0x376dac,(_0x58621a,_0x2622ac)=>{const _0x4300f4=_0x139db0;let _0x1bf548=musicUitls[_0x4300f4(0xce)](_0x2622ac[_0x4300f4(0x85)](),_0x376dac);_0x2b26d9['push']({'type':_0x4300f4(0x132),'filename':_0x57d9fb,'content':_0x1bf548}),_0x13f7f4(_0x2b26d9);}):_0x13f7f4(_0x2b26d9);}catch(_0x344403){console[_0x139db0(0xde)](_0x344403),_0x13f7f4(_0x2b26d9);}}router[_0x3cc632(0xdd)](_0x3cc632(0xc3),(_0x422f88,_0x3f1591,_0x5eb9a1)=>{const _0x39063b=_0x3cc632;let _0x49e249=_0x422f88['currentUser']['id'];function _0x5af0e1(_0x283d0f){const _0x1c21d4=_0x54e8;let _0x2992b1=dbFileIndexTable[_0x1c21d4(0xc1)](_0x422f88['app'][_0x1c21d4(0xc6)],_0x283d0f,dbFileIndexTable[_0x1c21d4(0x83)]);if(!_0x2992b1)return;let _0x3155c1=new Date()['getTime']();_0x422f88[_0x1c21d4(0x10e)][_0x1c21d4(0xc6)][_0x1c21d4(0x117)](_0x1c21d4(0xda))[_0x1c21d4(0x8c)](_0x3155c1,_0x283d0f),dbMusicFavorite[_0x1c21d4(0xa5)](_0x422f88[_0x1c21d4(0x10e)][_0x1c21d4(0xc6)],_0x49e249,_0x283d0f);}if(_0x422f88['body'][_0x39063b(0xc9)]instanceof Array){let _0x332dcb=_0x422f88[_0x39063b(0x87)][_0x39063b(0x90)];if(_0x332dcb==_0x39063b(0x74))for(let _0x1b17f8 of _0x422f88[_0x39063b(0x87)][_0x39063b(0xc9)]){_0x5af0e1(_0x1b17f8);}else{if(_0x332dcb==_0x39063b(0xb1))for(let _0x3d7cbf of _0x422f88[_0x39063b(0x87)][_0x39063b(0xc9)]){dbMusicFavorite['deleteFavorite'](_0x422f88[_0x39063b(0x10e)][_0x39063b(0xc6)],_0x49e249,_0x3d7cbf);}}return _0x3f1591['json']({'code':0x0});}else{let _0x509b14=parseInt(_0x422f88[_0x39063b(0x87)][_0x39063b(0xc9)]),_0x25f069=dbMusicFavorite[_0x39063b(0x129)](_0x422f88[_0x39063b(0x10e)][_0x39063b(0xc6)],_0x49e249,_0x509b14),_0x42563a=0x0;return _0x25f069?dbMusicFavorite[_0x39063b(0x75)](_0x422f88[_0x39063b(0x10e)][_0x39063b(0xc6)],_0x49e249,_0x509b14):(_0x42563a=0x1,_0x5af0e1(_0x509b14)),_0x3f1591[_0x39063b(0x127)]({'code':0x0,'favorite':_0x42563a});}}),router['get'](_0x3cc632(0xd2),(_0x169d8e,_0x3fdab1,_0x411c24)=>{const _0x36aa0d=_0x3cc632;let _0x1cb2e5=_0x169d8e['query'][_0x36aa0d(0x99)],_0x45e193=dbMusicIndexTable[_0x36aa0d(0x128)](_0x169d8e[_0x36aa0d(0x10e)][_0x36aa0d(0xc6)],_0x1cb2e5),_0x3c9f70=_0x169d8e[_0x36aa0d(0x12b)][_0x36aa0d(0x7e)];!_0x3c9f70&&(_0x3c9f70=0x200);if(!_0x45e193||_0x45e193&&!_0x45e193[_0x36aa0d(0xd1)])return _0x3fdab1['status'](0x194)['end']();if(dbUserTable[_0x36aa0d(0x9c)](_0x169d8e,_0x3fdab1,'music','power_get',_0x45e193[_0x36aa0d(0xaa)])==!![]){let _0x17bf68=path['join'](_0x45e193[_0x36aa0d(0xaa)],_0x45e193[_0x36aa0d(0xe2)]),_0x3c5db4=config[_0x36aa0d(0x131)](_0x45e193,_0x3c9f70);if(fs[_0x36aa0d(0xd8)](_0x3c5db4))return _0x3fdab1[_0x36aa0d(0x103)](_0x3c5db4);jsmediatags[_0x36aa0d(0xcc)](_0x17bf68,{'onSuccess':function(_0x561c48){const _0x49c6d0=_0x36aa0d;let _0x21254f=_0x561c48[_0x49c6d0(0x96)];var _0x169484;_0x21254f['picture']&&_0x21254f[_0x49c6d0(0xe7)]['data']&&(_0x169484=_0x21254f[_0x49c6d0(0xe7)][_0x49c6d0(0xac)]);!_0x169484&&_0x21254f[_0x49c6d0(0xeb)]&&_0x21254f['APIC'][_0x49c6d0(0xac)]&&_0x21254f[_0x49c6d0(0xeb)]['data']['data']&&(_0x169484=_0x21254f[_0x49c6d0(0xeb)][_0x49c6d0(0xac)][_0x49c6d0(0xac)]);if(_0x169484){let _0x21b572=path[_0x49c6d0(0xc8)](path[_0x49c6d0(0xe1)](_0x3c5db4),_0x49c6d0(0xd3)+path['basename'](_0x3c5db4));fs['writeFile'](_0x21b572,Buffer[_0x49c6d0(0xbc)](_0x169484),{'encoding':_0x49c6d0(0xa2)},function(_0x2f4078){const _0xd8b90f=_0x49c6d0;if(!_0x2f4078)sharpUtil[_0xd8b90f(0xb0)](_0x21b572,path['dirname'](_0x3c5db4),path[_0xd8b90f(0x124)](_0x3c5db4),_0xd8b90f(0x89),null,_0x188044=>{const _0x9d344c=_0xd8b90f;return dbMusicIndexTable['updateByFiled'](_0x169d8e[_0x9d344c(0x10e)][_0x9d344c(0xc6)],_0x45e193['id'],_0x9d344c(0xd1),_0x3c5db4),fs['rm'](_0x21b572,_0xc10a43=>{}),_0x3fdab1[_0x9d344c(0x103)](_0x3c5db4);},_0x1e29a2=>{const _0x22a701=_0xd8b90f;return _0x3fdab1[_0x22a701(0x121)](0x194)[_0x22a701(0x112)]();},_0x3c9f70);else return _0x3fdab1[_0xd8b90f(0x121)](0x194)[_0xd8b90f(0x112)]();});}else return _0x3fdab1[_0x49c6d0(0x121)](0x194)[_0x49c6d0(0x112)]();},'onError':function(_0x15040a){const _0x151a0f=_0x36aa0d;return _0x3fdab1[_0x151a0f(0x121)](0x194)[_0x151a0f(0x112)]();}});}}),router['post'](_0x3cc632(0xb6),(_0x2f0c69,_0x5ac3c0,_0x1a9ec1)=>{const _0x703ba2=_0x3cc632;let _0x2a3dcd=_0x2f0c69[_0x703ba2(0x87)]['count']||0x32,_0x5d9a84=_0x2f0c69['body'][_0x703ba2(0x115)]||0x0,_0x4d21f6=_0x2f0c69[_0x703ba2(0x87)][_0x703ba2(0x106)]||_0x703ba2(0x98),_0x6c6b56=_0x2f0c69[_0x703ba2(0x87)]['orderField']||'check_time',_0x37c435=_0x2f0c69[_0x703ba2(0x87)]['orderType']||'desc',_0x39cea0=_0x2f0c69[_0x703ba2(0x87)]['search'],_0xadf3ae=_0x2f0c69[_0x703ba2(0x87)][_0x703ba2(0x108)];if(dbMusicIndexTable[_0x703ba2(0x12c)](_0x2f0c69,_0x5ac3c0,_0x6c6b56,_0x37c435)!==!![])return;let _0x2396f8=['check_time',_0x703ba2(0x7b),_0x703ba2(0xa6),_0x703ba2(0xe2),_0x703ba2(0x126),_0x703ba2(0x98),_0x703ba2(0xaf),'birthtime','id'],_0x2e0e4d=[_0x703ba2(0xcb),'desc'];if(!_0x2396f8[_0x703ba2(0x78)](_0x6c6b56)||!_0x2e0e4d[_0x703ba2(0x78)](_0x37c435))return _0x2f0c69[_0x703ba2(0x10e)][_0x703ba2(0x76)](_0x5ac3c0,_0x703ba2(0x82),_0x6c6b56,_0x37c435);let _0x34e516=dbUserTable[_0x703ba2(0xc5)](_0x2f0c69,_0x703ba2(0xa8),'power_get',!![]);if(_0x2f0c69[_0x703ba2(0x114)][_0x703ba2(0x95)]!=0x1&&!_0x34e516[_0x703ba2(0x7d)]&&_0x4d21f6!=_0x703ba2(0xf7))return _0x5ac3c0[_0x703ba2(0x127)]({'code':0x0,'data':null});let _0x23176e=[];if(_0x4d21f6==_0x703ba2(0x98)||_0x4d21f6==_0x703ba2(0xaf)){_0x23176e=dbMusicIndexTable[_0x703ba2(0x9d)](_0x2f0c69[_0x703ba2(0x10e)][_0x703ba2(0xc6)],_0x34e516,_0x4d21f6,_0x2a3dcd,_0x5d9a84,_0x6c6b56,_0x37c435,_0x39cea0,_0xadf3ae);for(let _0x3bcc79 of _0x23176e){let _0x951fae=_0x703ba2(0xd6)+_0x4d21f6+_0x703ba2(0x12e)+_0x34e516['whereStr'],_0x203b46=[_0x4d21f6,..._0x34e516[_0x703ba2(0x10b)]];_0x3bcc79['coverList']=dbMusicIndexTable['getCoverByField'](_0x2f0c69[_0x703ba2(0x10e)]['dbFileIndex'],_0x951fae,_0x203b46);}}else{if(_0x4d21f6==_0x703ba2(0xf7)){_0x23176e=dbMusicPlaylistTable['getPlaylistList'](_0x2f0c69[_0x703ba2(0x10e)][_0x703ba2(0xc6)],_0x2f0c69[_0x703ba2(0x114)]['id'],_0x2a3dcd,_0x5d9a84,'id','desc',_0x39cea0);for(let _0x10b47b of _0x23176e){_0x10b47b['coverList']=dbMusicIndexTable['getPlaylistCover'](_0x2f0c69['app'][_0x703ba2(0xc6)],_0x10b47b['id']);}}}return _0x5ac3c0[_0x703ba2(0x127)]({'code':0x0,'data':_0x23176e});}),router['post'](_0x3cc632(0xea),(_0x453e7c,_0x48d065,_0x35eb8c)=>{const _0x59e15b=_0x3cc632;let _0x259f4b=_0x453e7c[_0x59e15b(0x87)][_0x59e15b(0x122)],_0x55afae=_0x453e7c[_0x59e15b(0x87)]['operation'];if(_0x55afae==_0x59e15b(0x74)){if(!_0x259f4b)return _0x453e7c['app'][_0x59e15b(0x76)](_0x48d065,_0x59e15b(0x110));dbMusicPlaylistTable[_0x59e15b(0x81)](_0x453e7c[_0x59e15b(0x10e)][_0x59e15b(0xc6)],_0x453e7c['currentUser']['id'],_0x259f4b);}else{if(_0x55afae==_0x59e15b(0xa7)||_0x55afae=='delete'){let _0x5d2fa3=_0x453e7c[_0x59e15b(0x87)][_0x59e15b(0x130)],_0x4e73e6=dbMusicPlaylistTable['getPlaylistById'](_0x453e7c[_0x59e15b(0x10e)]['dbFileIndex'],_0x5d2fa3),_0x1d0f68=![];(_0x453e7c['currentUser'][_0x59e15b(0x95)]==0x1||_0x4e73e6[_0x59e15b(0xab)]==_0x453e7c[_0x59e15b(0x114)]['id'])&&(_0x1d0f68=!![]);if(!_0x1d0f68)return _0x48d065['json']({'code':0x66});if(_0x55afae==_0x59e15b(0xb1))dbMusicPlaylistTable[_0x59e15b(0xf3)](_0x453e7c['app'][_0x59e15b(0xc6)],_0x5d2fa3);else{if(_0x55afae==_0x59e15b(0xa7)){if(!_0x259f4b)return _0x453e7c['app'][_0x59e15b(0x76)](_0x48d065,'need\x20\x27name\x27');dbMusicPlaylistTable[_0x59e15b(0x97)](_0x453e7c[_0x59e15b(0x10e)]['dbFileIndex'],_0x5d2fa3,_0x259f4b);}}}else return _0x453e7c[_0x59e15b(0x10e)][_0x59e15b(0x76)](_0x48d065,_0x59e15b(0xb4));}return _0x48d065['json']({'code':0x0});}),router[_0x3cc632(0xdd)](_0x3cc632(0x8b),(_0xe86673,_0x4c4ca5,_0x47b8fa)=>{const _0x5e79c5=_0x3cc632;let _0x4e964b=_0xe86673[_0x5e79c5(0x87)]['musicIndexId'],_0x1ec8d6=_0xe86673[_0x5e79c5(0x87)]['playlistId'];if(!_0x4e964b||!_0x1ec8d6)return _0xe86673['app'][_0x5e79c5(0x76)](_0x4c4ca5,_0x5e79c5(0xa1));let _0x37d46d=dbMusicPlaylistTable[_0x5e79c5(0x8e)](_0xe86673[_0x5e79c5(0x10e)]['dbFileIndex'],_0x1ec8d6);if(!_0x37d46d)return _0xe86673['app'][_0x5e79c5(0x76)](_0x4c4ca5,_0x5e79c5(0xd9));let _0x4aeb59=_0xe86673[_0x5e79c5(0x87)][_0x5e79c5(0x90)];if(_0x4aeb59==_0x5e79c5(0x74)){function _0x4b7ab5(_0x5af86b){const _0x1efba6=_0x5e79c5;let _0x21c928=dbMusicIndexTable[_0x1efba6(0x128)](_0xe86673[_0x1efba6(0x10e)][_0x1efba6(0xc6)],_0x5af86b);if(!_0x21c928)return;if(_0x21c928[_0x1efba6(0xc7)]==0x1){dbMusicPlaylistTable['addMusicToPlaylist'](_0xe86673[_0x1efba6(0x10e)]['dbFileIndex'],_0x5af86b,_0x1ec8d6);let _0x12738e=Date[_0x1efba6(0xf1)]();_0xe86673[_0x1efba6(0x10e)][_0x1efba6(0xc6)]['prepare'](_0x1efba6(0xda))['run'](_0x12738e,_0x21c928['id']);}else{let _0x3df8a2=path[_0x1efba6(0xc8)](_0x21c928[_0x1efba6(0xaa)],_0x21c928[_0x1efba6(0xe2)]),_0x35791f=_0xe86673['app'][_0x1efba6(0xc6)]['prepare'](_0x1efba6(0xad))[_0x1efba6(0x12a)](_0x3df8a2,_0x3df8a2+path[_0x1efba6(0x10a)]+'%');for(let _0x565db9 of _0x35791f){dbMusicPlaylistTable['addMusicToPlaylist'](_0xe86673[_0x1efba6(0x10e)][_0x1efba6(0xc6)],_0x565db9['id'],_0x1ec8d6);}}}if(_0x4e964b instanceof Array)for(let _0x37603d of _0x4e964b){_0x4b7ab5(_0x37603d);}else _0x4b7ab5(_0x4e964b);}else{if(_0x4aeb59=='delete'){if(_0x4e964b instanceof Array)for(let _0x5043cb of _0x4e964b){dbMusicPlaylistTable[_0x5e79c5(0xed)](_0xe86673[_0x5e79c5(0x10e)]['dbFileIndex'],_0x5043cb,_0x1ec8d6);}else dbMusicPlaylistTable['removeMusicFromPlaylist'](_0xe86673['app'][_0x5e79c5(0xc6)],_0x4e964b,_0x1ec8d6);}else return _0xe86673[_0x5e79c5(0x10e)][_0x5e79c5(0x76)](_0x4c4ca5,_0x5e79c5(0xb4));}return _0x4c4ca5[_0x5e79c5(0x127)]({'code':0x0,'data':{}});}),router[_0x3cc632(0xdd)](_0x3cc632(0x8a),(_0x52a8e7,_0x856fa1,_0x5377f9)=>{const _0x5935b8=_0x3cc632;let _0xf23f7c=_0x52a8e7[_0x5935b8(0x87)][_0x5935b8(0xa4)],_0x3a07ca=_0x52a8e7[_0x5935b8(0x87)]['searchStr'],_0x4f1602='music',_0x27f179=_0x52a8e7[_0x5935b8(0x87)]['orderField']??_0x5935b8(0xe2),_0x133a80=_0x52a8e7[_0x5935b8(0x87)][_0x5935b8(0x109)]??_0x5935b8(0xcb);if(dbMusicIndexTable[_0x5935b8(0x12c)](_0x52a8e7,_0x856fa1,_0x27f179,_0x133a80)!==!![])return;if(dbUserTable[_0x5935b8(0x9c)](_0x52a8e7,_0x856fa1,_0x4f1602,_0x5935b8(0xca))==!![]){let _0x227d95=[];if(!_0xf23f7c){let _0x30afae=[];_0x52a8e7[_0x5935b8(0x114)][_0x5935b8(0x95)]==0x1?_0x30afae=dbSourceFolderTable[_0x5935b8(0xf5)](_0x52a8e7[_0x5935b8(0x10e)]['dbOther'],_0x4f1602):_0x30afae=dbUserTable[_0x5935b8(0xa0)](_0x52a8e7[_0x5935b8(0x10e)][_0x5935b8(0xd4)],_0x52a8e7['currentUser'][_0x5935b8(0xae)],_0x4f1602);if(_0x30afae)for(let _0x279e87=0x0;_0x279e87<_0x30afae[_0x5935b8(0x120)];_0x279e87++){_0x227d95[_0x5935b8(0x111)]({'path':_0x30afae[_0x279e87][_0x5935b8(0xaa)],'is_file':0x0,'filename':path[_0x5935b8(0x124)](_0x30afae[_0x279e87][_0x5935b8(0xaa)]),'root':!![]});}}else{let _0x2a3d91=[];if(_0x52a8e7[_0x5935b8(0x114)][_0x5935b8(0x95)]!=0x1){if(dbUserTable[_0x5935b8(0x9c)](_0x52a8e7,_0x856fa1,_0x4f1602,_0x5935b8(0xca),_0xf23f7c)!==!![])return;}_0xf23f7c=path[_0x5935b8(0xc8)](_0xf23f7c);let _0x8bafa7='\x20path=?\x20AND\x20';_0x2a3d91[_0x5935b8(0x111)](_0xf23f7c),_0x8bafa7+=_0x5935b8(0xf4);if(_0x3a07ca){let _0x32f414=_0x5935b8(0x10d);_0x8bafa7+=_0x32f414,_0x2a3d91[_0x5935b8(0x111)]('%'+_0x3a07ca+'%'),_0x2a3d91['push']('%'+_0x3a07ca+'%');}let _0x2f028f=_0x5935b8(0x73);_0x8bafa7+=_0x5935b8(0xba)+_0x27f179+'\x20'+_0x133a80,_0x227d95=_0x52a8e7['app']['dbFileIndex']['prepare'](_0x5935b8(0x11b)+_0x2f028f+_0x5935b8(0x9e)+_0x8bafa7)[_0x5935b8(0x12a)](_0x2a3d91);}for(let _0x5efc5e of _0x227d95){_0x5efc5e['favorite']=dbMusicFavorite[_0x5935b8(0xdc)](_0x52a8e7[_0x5935b8(0x10e)][_0x5935b8(0xc6)],_0x5efc5e['id'],_0x52a8e7[_0x5935b8(0x114)]['id'])?'1':'0';}let _0x4772d5=path[_0x5935b8(0x10a)],_0xc94e89={'code':0x0,'data':_0x227d95,'sep':_0x4772d5};return _0x856fa1[_0x5935b8(0x127)](_0xc94e89);}}),module[_0x3cc632(0x10c)]=router;