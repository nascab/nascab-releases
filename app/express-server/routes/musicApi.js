const _0x2b52a0=_0x23db;(function(_0x187e67,_0x2fdf45){const _0x1eb140=_0x23db,_0x4d122d=_0x187e67();while(!![]){try{const _0x10498d=-parseInt(_0x1eb140(0x2a9))/0x1*(parseInt(_0x1eb140(0x281))/0x2)+parseInt(_0x1eb140(0x25a))/0x3+-parseInt(_0x1eb140(0x289))/0x4+parseInt(_0x1eb140(0x274))/0x5*(parseInt(_0x1eb140(0x296))/0x6)+parseInt(_0x1eb140(0x2a8))/0x7+-parseInt(_0x1eb140(0x2a6))/0x8+parseInt(_0x1eb140(0x221))/0x9;if(_0x10498d===_0x2fdf45)break;else _0x4d122d['push'](_0x4d122d['shift']());}catch(_0x37f8ce){_0x4d122d['push'](_0x4d122d['shift']());}}}(_0x73f4,0xd2a42));function _0x23db(_0x226fa7,_0x3ffc98){const _0x73f4d0=_0x73f4();return _0x23db=function(_0x23dbe8,_0x5ca84f){_0x23dbe8=_0x23dbe8-0x1e0;let _0x1bdf5b=_0x73f4d0[_0x23dbe8];return _0x1bdf5b;},_0x23db(_0x226fa7,_0x3ffc98);}let express=require(_0x2b52a0(0x283)),router=express[_0x2b52a0(0x27d)](),config=require(_0x2b52a0(0x286)),path=require('path'),fs=require('fs'),dbMusicIndexTable=require(_0x2b52a0(0x225)),dbFileIndexTable=require(_0x2b52a0(0x207)),dbMusicPlaylistTable=require(_0x2b52a0(0x219)),dbMusicFavorite=require('../../db/dbMusicFavorite'),jsmediatags=require(_0x2b52a0(0x203));const dbUserTable=require(_0x2b52a0(0x21b));let musicUitls=require(_0x2b52a0(0x1e1)),lyricUtils=require('../../utils/music/lyricUtils'),sharpUtil=require(_0x2b52a0(0x22a));const dbSourceFolderTable=require(_0x2b52a0(0x252));let axios=require(_0x2b52a0(0x250)),sha256=require(_0x2b52a0(0x20d)),os=require('os');const urlConfig=require('../../myConfig/urlConfig');function getFavoriteMusicList(_0x118c6e,_0x2e6999,_0x1db993,_0x3b7864,_0x42721a,_0x1f6505,_0x9afd77){const _0x4ede4c=_0x2b52a0;let _0x56bb9e='',_0x1aaed5=[];_0x56bb9e+=_0x4ede4c(0x23d);_0x1f6505&&(_0x1f6505=_0x1f6505['replace']('\x27','')[_0x4ede4c(0x209)]('â€™',''),_0x56bb9e+=_0x4ede4c(0x215),_0x1aaed5['push']('%'+_0x1f6505+'%','%'+_0x1f6505+'%','%'+_0x1f6505+'%'));_0x9afd77&&(_0x56bb9e+=_0x4ede4c(0x29e),_0x1aaed5[_0x4ede4c(0x271)](_0x9afd77,_0x9afd77));if(_0x3b7864&&_0x42721a){if(_0x3b7864=='artist')_0x56bb9e+='\x20order\x20by\x20f.artist_fl\x20'+_0x42721a+_0x4ede4c(0x23a)+_0x42721a+'\x20';else{if(_0x3b7864=='album')_0x56bb9e+=_0x4ede4c(0x26c)+_0x42721a+_0x4ede4c(0x21a)+_0x42721a+'\x20';else{if(_0x3b7864==_0x4ede4c(0x1e3))_0x56bb9e+='\x20order\x20by\x20f.title_fl\x20'+_0x42721a+',f.title\x20'+_0x42721a+_0x4ede4c(0x29b)+_0x42721a+'\x20';else _0x3b7864==_0x4ede4c(0x256)?_0x56bb9e+=_0x4ede4c(0x244)+_0x42721a+'\x20':_0x56bb9e+='\x20order\x20by\x20f.'+_0x3b7864+'\x20'+_0x42721a+'\x20';}}}else _0x56bb9e+=_0x4ede4c(0x278);return _0x56bb9e+='\x20LIMIT\x20?\x20OFFSET\x20?\x20',_0x1aaed5[_0x4ede4c(0x271)](_0x2e6999),_0x1aaed5['push'](_0x1db993),result=dbMusicFavorite[_0x4ede4c(0x226)](_0x118c6e['app'][_0x4ede4c(0x2a0)],_0x118c6e['currentUser']['id'],_0x56bb9e,'*',_0x1aaed5),result=dealMusicList(_0x118c6e,result),result;}function dealMusicList(_0x26b57d,_0x407a23){const _0x58bbfa=_0x2b52a0;for(let _0x2a374a of _0x407a23){_0x2a374a[_0x58bbfa(0x26f)]=dbMusicFavorite[_0x58bbfa(0x233)](_0x26b57d[_0x58bbfa(0x222)][_0x58bbfa(0x2a0)],_0x2a374a['id'],_0x26b57d['currentUser']['id'])?'1':'0';if(!_0x2a374a[_0x58bbfa(0x1fe)]){let _0x2c13c0=!![];_0x2a374a[_0x58bbfa(0x1f3)]&&fs[_0x58bbfa(0x20e)](_0x2a374a['file_cover_path'])&&(_0x2c13c0=![]),_0x2c13c0&&(_0x2a374a['file_cover_path']=musicUitls[_0x58bbfa(0x1ee)](_0x26b57d['app']['dbFileIndex'],_0x2a374a));}_0x2a374a['filePath']=path[_0x58bbfa(0x232)](_0x2a374a[_0x58bbfa(0x29f)],_0x2a374a[_0x58bbfa(0x24f)]),delete _0x2a374a[_0x58bbfa(0x29f)];}return _0x407a23;}function getMusicListByParams(_0x58242a,_0x5b6316,_0x1d9c98,_0x203895,_0x21f492,_0x2e7d31,_0x395283,_0x5515b9,_0x53dc0e,_0x37a2a9,_0x106288,_0x29fbb2,_0x3c4ea2){const _0x1c6ef3=_0x2b52a0;let _0x2bcbca=_0x58242a['app'][_0x1c6ef3(0x2a0)],_0x3e50e1=[];return _0x3e50e1=dbMusicIndexTable[_0x1c6ef3(0x266)](_0x2bcbca,_0x5b6316,_0x1d9c98,_0x203895,_0x21f492,_0x2e7d31,_0x395283,_0x5515b9,_0x53dc0e,_0x37a2a9,_0x29fbb2,_0x106288,_0x3c4ea2),_0x3e50e1=dealMusicList(_0x58242a,_0x3e50e1),_0x3e50e1;}router[_0x2b52a0(0x27e)](_0x2b52a0(0x1f1),(_0x370be8,_0xc3387f,_0x1282cf)=>{const _0x51e102=_0x2b52a0;let _0x2a3ef4=_0x370be8[_0x51e102(0x222)][_0x51e102(0x2a0)],_0x1ad132=_0x370be8[_0x51e102(0x248)][_0x51e102(0x1f0)]?_0x370be8[_0x51e102(0x248)]['count']:0xc,_0x46cbd5=_0x370be8['body'][_0x51e102(0x26e)]?_0x370be8['body'][_0x51e102(0x26e)]:0xc,_0x3e5ecb=dbUserTable[_0x51e102(0x242)](_0x370be8,_0x51e102(0x2a2),_0x51e102(0x291),!![]);if(_0x370be8[_0x51e102(0x28c)][_0x51e102(0x1ea)]!=0x1&&!_0x3e5ecb[_0x51e102(0x2a3)])return _0xc3387f[_0x51e102(0x27f)]({'code':0x0,'data':null});let _0x26d30f=getMusicListByParams(_0x370be8,_0x3e5ecb,_0x1ad132,0x0,_0x51e102(0x282),_0x51e102(0x2a1)),_0x437488=getMusicListByParams(_0x370be8,_0x3e5ecb,_0x1ad132,0x0,_0x51e102(0x25e),_0x51e102(0x1e2)),_0x35a374=getMusicListByParams(_0x370be8,_0x3e5ecb,_0x1ad132,0x0,'id',_0x51e102(0x2a1)),_0x557288=dbMusicIndexTable[_0x51e102(0x23b)](_0x2a3ef4,_0x3e5ecb,_0x51e102(0x268),_0x46cbd5,0x0,_0x51e102(0x282),_0x51e102(0x2a1));for(let _0xb048a2 of _0x557288){let _0x517058='\x20AND\x20artist=?\x20'+_0x3e5ecb['whereStr'],_0x55f6a3=[_0xb048a2[_0x51e102(0x268)],..._0x3e5ecb[_0x51e102(0x294)]];_0xb048a2[_0x51e102(0x254)]=dbMusicIndexTable[_0x51e102(0x20f)](_0x370be8[_0x51e102(0x222)][_0x51e102(0x2a0)],_0x517058,_0x55f6a3);}let _0x2c1bf1=dbMusicIndexTable[_0x51e102(0x23b)](_0x2a3ef4,_0x3e5ecb,_0x51e102(0x263),_0x46cbd5,0x0,_0x51e102(0x298),'desc');for(let _0x848840 of _0x2c1bf1){let _0x818ec3=_0x51e102(0x212)+_0x3e5ecb['whereStr'],_0x39c55a=[_0x848840[_0x51e102(0x263)],..._0x3e5ecb[_0x51e102(0x294)]];_0x848840['coverList']=dbMusicIndexTable[_0x51e102(0x20f)](_0x370be8[_0x51e102(0x222)][_0x51e102(0x2a0)],_0x818ec3,_0x39c55a);}let _0x24f5ca={};return _0x26d30f&&_0x26d30f[_0x51e102(0x21e)]>0x0&&(_0x24f5ca[_0x51e102(0x258)]=_0x26d30f),_0x437488&&_0x437488[_0x51e102(0x21e)]>0x0&&(_0x24f5ca[_0x51e102(0x235)]=_0x437488),_0x35a374&&_0x35a374[_0x51e102(0x21e)]>0x0&&(_0x24f5ca[_0x51e102(0x220)]=_0x35a374),_0x557288&&_0x557288['length']>0x0&&(_0x24f5ca[_0x51e102(0x259)]=_0x557288),_0x2c1bf1&&_0x2c1bf1[_0x51e102(0x21e)]>0x0&&(_0x24f5ca[_0x51e102(0x21c)]=_0x2c1bf1),_0xc3387f['json']({'code':0x0,'data':_0x24f5ca,'platform':os['platform']()});}),router['post'](_0x2b52a0(0x1f5),(_0x3550d0,_0x2f276c,_0x351aa2)=>{const _0x5b855d=_0x2b52a0;let _0x1cd6de=_0x3550d0[_0x5b855d(0x248)][_0x5b855d(0x1f0)]||0x32,_0x4f643d=_0x3550d0['body'][_0x5b855d(0x1f8)]||0x0,_0x4eaf95=_0x3550d0[_0x5b855d(0x248)][_0x5b855d(0x263)],_0x58e5dc=_0x3550d0['body'][_0x5b855d(0x243)],_0x512afc=_0x3550d0[_0x5b855d(0x248)]['artist'],_0x394ca5=_0x3550d0['body'][_0x5b855d(0x1ef)],_0x199386=_0x3550d0[_0x5b855d(0x248)][_0x5b855d(0x239)]||_0x5b855d(0x282),_0x1d7b08=_0x3550d0[_0x5b855d(0x248)][_0x5b855d(0x287)]||'desc',_0x3c209b=[_0x5b855d(0x24d),_0x5b855d(0x26f),_0x5b855d(0x276)],_0x30fd73=_0x3550d0[_0x5b855d(0x248)][_0x5b855d(0x277)]||'list',_0xd0a4c2=_0x3550d0['body'][_0x5b855d(0x23e)],_0x31a477=_0x3550d0[_0x5b855d(0x248)]['letterIndex'],_0xd9ec27=_0x3550d0[_0x5b855d(0x248)]['playlistId'];if(dbMusicIndexTable[_0x5b855d(0x22e)](_0x3550d0,_0x2f276c,_0x199386,_0x1d7b08)!==!![])return;if(_0x30fd73==_0x5b855d(0x276)){if(!_0xd9ec27)return _0x3550d0[_0x5b855d(0x222)]['returnErrMsg'](_0x2f276c,_0x5b855d(0x272));}!_0x3c209b[_0x5b855d(0x1e6)](_0x30fd73)&&(_0x30fd73='list');_0x1cd6de>0x1f4&&(_0x1cd6de=0x1f4);let _0x5703b9=dbUserTable['getUserPathWhere'](_0x3550d0,_0x5b855d(0x2a2),_0x5b855d(0x291),!![]);if(_0x3550d0[_0x5b855d(0x28c)][_0x5b855d(0x1ea)]!=0x1&&!_0x5703b9[_0x5b855d(0x2a3)])return _0x2f276c[_0x5b855d(0x27f)]({'code':0x0,'data':null});let _0x5f02d9=[];if(_0x30fd73==_0x5b855d(0x276)||_0x30fd73==_0x5b855d(0x24d))_0x5f02d9=getMusicListByParams(_0x3550d0,_0x5703b9,_0x1cd6de,_0x4f643d,_0x199386,_0x1d7b08,_0x4eaf95,_0x58e5dc,_0x512afc,_0x394ca5,_0xd0a4c2,_0xd9ec27,_0x31a477);else _0x30fd73==_0x5b855d(0x26f)&&(_0x5f02d9=getFavoriteMusicList(_0x3550d0,_0x1cd6de,_0x4f643d,_0x199386,_0x1d7b08,_0xd0a4c2,_0x31a477));let _0x5dc2f9={'code':0x0,'data':_0x5f02d9};if(_0x30fd73=='favorite')_0x5dc2f9[_0x5b855d(0x1fb)]=dbMusicFavorite[_0x5b855d(0x217)](_0x3550d0[_0x5b855d(0x222)][_0x5b855d(0x2a0)],_0x3550d0[_0x5b855d(0x28c)]['id']);else{if(_0x30fd73==_0x5b855d(0x24d))_0x5dc2f9[_0x5b855d(0x1fb)]=dbMusicIndexTable[_0x5b855d(0x238)](_0x3550d0[_0x5b855d(0x222)][_0x5b855d(0x2a0)],_0x5703b9,_0x4eaf95,_0x58e5dc,_0x512afc,_0x394ca5);else _0x30fd73==_0x5b855d(0x276)&&(_0x5dc2f9[_0x5b855d(0x1fb)]=dbMusicPlaylistTable[_0x5b855d(0x20b)](_0x3550d0['app'][_0x5b855d(0x2a0)],_0xd9ec27));}return _0x2f276c[_0x5b855d(0x27f)](_0x5dc2f9);}),router['post'](_0x2b52a0(0x22b),(_0x93ccf5,_0x5566a5,_0x1ef426)=>{const _0x8619ab=_0x2b52a0;let _0x145fbb=_0x93ccf5[_0x8619ab(0x248)]['id'],_0x591ee7=dbFileIndexTable[_0x8619ab(0x22c)](_0x93ccf5[_0x8619ab(0x222)][_0x8619ab(0x2a0)],_0x145fbb,dbFileIndexTable[_0x8619ab(0x208)]);if(!_0x591ee7)return _0x93ccf5[_0x8619ab(0x222)][_0x8619ab(0x260)](_0x5566a5,_0x8619ab(0x280));if(dbUserTable['doUserCanGet'](_0x93ccf5,_0x5566a5,_0x8619ab(0x2a2),_0x8619ab(0x291),_0x591ee7['path'])==!![]){let _0xb3027b=_0x93ccf5[_0x8619ab(0x28c)]['id'],_0x14a149=dbMusicFavorite[_0x8619ab(0x22f)](_0x93ccf5[_0x8619ab(0x222)][_0x8619ab(0x2a0)],_0xb3027b,_0x145fbb);_0x591ee7[_0x8619ab(0x1f3)]=musicUitls['getMusicSameNameCover'](_0x93ccf5[_0x8619ab(0x222)][_0x8619ab(0x2a0)],_0x591ee7),_0x591ee7[_0x8619ab(0x26f)]=_0x14a149?0x1:0x0,getLyrics(_0x591ee7,_0x29f3fa=>{const _0x2dc400=_0x8619ab;return _0x591ee7[_0x2dc400(0x223)]=_0x29f3fa,_0x5566a5[_0x2dc400(0x27f)]({'code':0x0,'data':_0x591ee7});});}});function updateIndexLyric(_0x181862,_0x42e126,_0xaf8ce2,_0x2b87e3){const _0x39cdcd=_0x2b52a0;if(_0xaf8ce2&&_0xaf8ce2[_0x39cdcd(0x21e)]>0x0){let _0xb9e2a2=_0x2b87e3[_0x39cdcd(0x24f)][_0x39cdcd(0x209)](path[_0x39cdcd(0x2a4)](_0x2b87e3[_0x39cdcd(0x24f)]),''),_0x2233a4=_0xb9e2a2+_0x39cdcd(0x262),_0x524a6f=path[_0x39cdcd(0x232)](_0x2b87e3[_0x39cdcd(0x29f)],_0x2233a4);fs[_0x39cdcd(0x27b)](_0x524a6f,_0xaf8ce2,_0x39cdcd(0x213),_0x19b75d=>{if(!_0x19b75d){}});}let _0xe40560=JSON[_0x39cdcd(0x253)]({'lyrics':_0xaf8ce2?_0xaf8ce2:''});_0x181862[_0x39cdcd(0x269)]('UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?')['run'](_0x42e126,_0xe40560,_0x2b87e3['id']);}router[_0x2b52a0(0x27e)](_0x2b52a0(0x1e4),(_0x1e29bf,_0x22f979,_0x29d614)=>{const _0x1051ac=_0x2b52a0;let _0x1c43d4=_0x1e29bf[_0x1051ac(0x248)]['id'],_0x2793b8=_0x1e29bf['body'][_0x1051ac(0x227)],_0x4de044=dbFileIndexTable[_0x1051ac(0x22c)](_0x1e29bf[_0x1051ac(0x222)][_0x1051ac(0x2a0)],_0x1c43d4,dbFileIndexTable[_0x1051ac(0x208)]);if(!_0x4de044)return _0x1e29bf['app'][_0x1051ac(0x260)](_0x22f979,_0x1051ac(0x280));if(!_0x2793b8)return _0x1e29bf['app'][_0x1051ac(0x260)](_0x22f979,_0x1051ac(0x293));if(dbUserTable[_0x1051ac(0x20c)](_0x1e29bf,_0x22f979,_0x1051ac(0x2a2),_0x1051ac(0x1ec),_0x4de044[_0x1051ac(0x29f)])==!![])return updateIndexLyric(_0x1e29bf[_0x1051ac(0x222)][_0x1051ac(0x2a0)],0x1,_0x2793b8,_0x4de044),_0x22f979['json']({'code':0x0});}),router['post'](_0x2b52a0(0x22d),(_0x33b431,_0x2ed9c3,_0x1e15d7)=>{const _0x3bf760=_0x2b52a0;let _0x4fcb38=_0x33b431[_0x3bf760(0x248)]['id'],_0x10d00b=dbFileIndexTable['getById'](_0x33b431[_0x3bf760(0x222)]['dbFileIndex'],_0x4fcb38,dbFileIndexTable[_0x3bf760(0x208)]);if(!_0x10d00b)return _0x33b431['app'][_0x3bf760(0x260)](_0x2ed9c3,_0x3bf760(0x280));let _0x305182=_0x33b431[_0x3bf760(0x248)][_0x3bf760(0x284)],_0xb8b47=_0x33b431[_0x3bf760(0x248)][_0x3bf760(0x28e)],_0x456e37=_0x33b431[_0x3bf760(0x248)][_0x3bf760(0x2a5)],_0x51e5af=_0x33b431[_0x3bf760(0x248)][_0x3bf760(0x218)];if(dbUserTable[_0x3bf760(0x20c)](_0x33b431,_0x2ed9c3,_0x3bf760(0x2a2),'power_get',_0x10d00b[_0x3bf760(0x29f)])==!![]){if(_0x10d00b[_0x3bf760(0x1e0)]==0x1&&!_0x51e5af)return _0x2ed9c3[_0x3bf760(0x27f)]({'code':0x0,'data':[_0x10d00b[_0x3bf760(0x27c)]]});let _0x3d691f=_0x33b431[_0x3bf760(0x248)]['skipCount']||0x0;if(!_0x305182||!_0x305182['trim']())return _0x2ed9c3[_0x3bf760(0x27f)]([]);let _0x12499b={'searchMusicName':_0x305182,'searchMusicArtist':_0xb8b47,'searchMusicAlbum':_0x456e37,'isSearch':_0x51e5af,'skipCount':_0x3d691f,'token':sha256(_0x305182+config[_0x3bf760(0x211)])};lyricUtils[_0x3bf760(0x1f7)](_0x12499b)[_0x3bf760(0x257)](_0x31111d=>{const _0x3deacf=_0x3bf760;if(_0x31111d){if(_0x31111d[_0x3deacf(0x21e)]>0x0&&!_0x51e5af){let _0x55a563=![],_0x585bc2=0x14,_0x5f37fd=0x64,_0xcd61a3=null;for(let _0x5cc67a of _0x31111d){if(_0x5cc67a[_0x3deacf(0x1e8)]){let _0x3b016d=_0x5cc67a[_0x3deacf(0x1e8)]/0x3e8,_0x46b353=Math['abs'](_0x3b016d-_0x10d00b[_0x3deacf(0x1e8)]);_0x46b353<_0x5f37fd&&(_0x5f37fd=_0x46b353,_0xcd61a3=_0x5cc67a[_0x3deacf(0x292)]?_0x5cc67a['lrc']:'');}}return _0x5f37fd<_0x585bc2?(_0x55a563=!![],_0x10d00b['lyrics']=JSON[_0x3deacf(0x253)]({'lyrics':_0xcd61a3?_0xcd61a3:''}),updateIndexLyric(_0x33b431[_0x3deacf(0x222)][_0x3deacf(0x2a0)],0x1,_0xcd61a3,_0x10d00b)):updateIndexLyric(_0x33b431[_0x3deacf(0x222)]['dbFileIndex'],0x1,'',_0x10d00b),_0x2ed9c3['json']({'code':0x0,'data':_0x55a563&&_0x10d00b[_0x3deacf(0x27c)]?[_0x10d00b[_0x3deacf(0x27c)]]:[]});}else return _0x2ed9c3[_0x3deacf(0x27f)]({'code':0x0,'data':_0x31111d});}})[_0x3bf760(0x295)](_0x19f21f=>{const _0x4d8b4a=_0x3bf760;return _0x33b431['app'][_0x4d8b4a(0x260)](_0x2ed9c3,_0x19f21f['message']);});}});function getLyrics(_0x39409b,_0x3e9be7){const _0x22f0d3=_0x2b52a0;let _0x1a996f=[];try{_0x39409b['lyrics']&&_0x39409b[_0x22f0d3(0x27c)][_0x22f0d3(0x21e)]>0xa&&_0x1a996f[_0x22f0d3(0x271)]({'type':_0x22f0d3(0x1e5),'content':_0x39409b[_0x22f0d3(0x27c)]});let _0x9e66d0=_0x39409b[_0x22f0d3(0x24f)][_0x22f0d3(0x209)](path[_0x22f0d3(0x2a4)](_0x39409b['filename']),''),_0x2a3ba4=_0x9e66d0+_0x22f0d3(0x262),_0x394810=path[_0x22f0d3(0x232)](_0x39409b['path'],_0x2a3ba4);fs['existsSync'](_0x394810)?fs[_0x22f0d3(0x1f4)](_0x394810,(_0xc96c5,_0x32ae26)=>{const _0x45786c=_0x22f0d3;let _0x564775=musicUitls['transStringToUtf8'](_0x32ae26['toString'](),_0x394810);_0x1a996f['push']({'type':_0x45786c(0x237),'filename':_0x2a3ba4,'content':_0x564775}),_0x3e9be7(_0x1a996f);}):_0x3e9be7(_0x1a996f);}catch(_0x50b641){console[_0x22f0d3(0x251)](_0x50b641),_0x3e9be7(_0x1a996f);}}function _0x73f4(){const _0x2af8b4=['json','NO\x20MUSIC\x20INDEX','2238eTSnsr','last_play_time','express','searchMusicName','data','../../myConfig/config','orderType','\x20FROM\x20file_index_music\x20WHERE\x20','6859968qyTHwk','asc','addMusicToPlaylist','currentUser','getPlaylistById','searchMusicArtist','orderField/orderType\x20error','add','power_get','lrc','Lyric\x20is\x20null','paramsList','catch','18oNyCsQ','dirname','play_count','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','indexId',',f.filename_fl\x20','parent','playlistId\x20no\x20exists','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','path','dbFileIndex','desc','music','whereStr','extname','searchMusicAlbum','7699056QuzPom','/operationPlaylist','2444715aaxHKf','359Xqexbr','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','lyrics_get_state','../../utils/musicUtil',',id\x20asc','title','/saveLyric','inner','includes','check_time','duration','removePlaylist','is_admin','read','power_add','=?\x20','getMusicSameNameCover','genre','count','/getMusicHomeData','/operationPlaylistIndex','file_cover_path','readFile','/getMusicList','musicIndexId','searchLyric','offset','tags','deleteFavorite','music_count','delete','\x20AND\x20','cover_path','now','run','ORDER\x20BY\x20','get','jsmediatags','query','is_file','\x20path=?\x20AND\x20','../../db/dbFileIndexTable','INDEX_TABLE_NAME_MUSIC','replace','addFavorite','getPlaylistMusicCount','doUserCanGet','sha256','existsSync','getCoverByField','letterIndex','apiTokenKey','\x20AND\x20album=?\x20','utf-8','size','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','/getMusicCover','getFavoriteCount','isSearch','../../db/dbMusicPlaylistTable',',f.album\x20','../../db/dbUserTable','albumList','operation','length','groupField','recentAddList','14137074TAnGxv','app','lyricList','removeMusicFromPlaylist','../../db/dbMusicIndexTable','getAllFavoriteByWhere','lyric','basename','APIC','../utils/sharpUtils','/getMusicDetail','getById','/searchLyric','checkOrderParams','getFavorite','getUserPower','status','join','musicIsFavorite','\x20(type=3\x20OR\x20is_file=0)','maxPlayMusic','searchStr','file','getMusicListCount','orderField',',f.artist\x20','getGroupList','getPlaylistList','\x20is_file=1','search','createPlaylist','/musicFavorite','username','getUserPathWhere','year','\x20order\x20by\x20m.update_time\x20','need\x20\x27name\x27','genTinyFile','from','body','base64','birthtime','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre','sendFile','list','name','filename','axios','log','../../db/dbSourceFolderTable','stringify','coverList','edit','favorite_time','then','recentMusic','artistList','1084572GfkGwr','dbOther','getTime','updateByFiled','play_count\x20desc','operation\x20error','returnErrMsg','sep','.lrc','album','/getMusicIndexFileTree','playlistId','getMusicList','end','artist','prepare','need\x20musicIndexId\x20and\x20playlistId','all','\x20order\x20by\x20f.album_fl\x20','temp.','albumCount','favorite','uid','push','need\x20playlistId','getMusicIndex','2767210HUdZgh','SELECT\x20','playlist','listType','\x20order\x20by\x20m.update_time\x20DESC\x20','SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','picture','writeFile','lyrics','Router','post'];_0x73f4=function(){return _0x2af8b4;};return _0x73f4();}router['post'](_0x2b52a0(0x240),(_0x2d82d2,_0x12ca86,_0x51349b)=>{const _0x4cc502=_0x2b52a0;let _0x40211e=_0x2d82d2[_0x4cc502(0x28c)]['id'];function _0x4cb718(_0x15dbda){const _0x5e6dff=_0x4cc502;let _0x485f9b=dbFileIndexTable[_0x5e6dff(0x22c)](_0x2d82d2[_0x5e6dff(0x222)][_0x5e6dff(0x2a0)],_0x15dbda,dbFileIndexTable[_0x5e6dff(0x208)]);if(!_0x485f9b)return;let _0x36c962=new Date()[_0x5e6dff(0x25c)]();_0x2d82d2['app'][_0x5e6dff(0x2a0)][_0x5e6dff(0x269)](_0x5e6dff(0x299))[_0x5e6dff(0x200)](_0x36c962,_0x15dbda),dbMusicFavorite[_0x5e6dff(0x20a)](_0x2d82d2[_0x5e6dff(0x222)]['dbFileIndex'],_0x40211e,_0x15dbda);}if(_0x2d82d2[_0x4cc502(0x248)][_0x4cc502(0x1f6)]instanceof Array){let _0x3b77c7=_0x2d82d2[_0x4cc502(0x248)][_0x4cc502(0x21d)];if(_0x3b77c7=='add')for(let _0x205c4c of _0x2d82d2[_0x4cc502(0x248)]['musicIndexId']){_0x4cb718(_0x205c4c);}else{if(_0x3b77c7=='delete')for(let _0x4ee678 of _0x2d82d2[_0x4cc502(0x248)][_0x4cc502(0x1f6)]){dbMusicFavorite['deleteFavorite'](_0x2d82d2[_0x4cc502(0x222)][_0x4cc502(0x2a0)],_0x40211e,_0x4ee678);}}return _0x12ca86['json']({'code':0x0});}else{let _0x2766b2=parseInt(_0x2d82d2[_0x4cc502(0x248)][_0x4cc502(0x1f6)]),_0x1536a5=dbMusicFavorite[_0x4cc502(0x22f)](_0x2d82d2['app'][_0x4cc502(0x2a0)],_0x40211e,_0x2766b2),_0x3ef329=0x0;return _0x1536a5?dbMusicFavorite[_0x4cc502(0x1fa)](_0x2d82d2['app'][_0x4cc502(0x2a0)],_0x40211e,_0x2766b2):(_0x3ef329=0x1,_0x4cb718(_0x2766b2)),_0x12ca86['json']({'code':0x0,'favorite':_0x3ef329});}}),router[_0x2b52a0(0x202)](_0x2b52a0(0x216),(_0x3fa605,_0x161c9c,_0x318704)=>{const _0x4d0617=_0x2b52a0;let _0x35dcc6=_0x3fa605['query'][_0x4d0617(0x29a)],_0x6479ed=dbMusicIndexTable['getMusicIndex'](_0x3fa605[_0x4d0617(0x222)][_0x4d0617(0x2a0)],_0x35dcc6),_0x32c0c4=_0x3fa605[_0x4d0617(0x204)][_0x4d0617(0x214)];!_0x32c0c4&&(_0x32c0c4=0x200);if(!_0x6479ed||_0x6479ed&&!_0x6479ed[_0x4d0617(0x1fe)])return _0x161c9c[_0x4d0617(0x231)](0x194)[_0x4d0617(0x267)]();if(dbUserTable[_0x4d0617(0x20c)](_0x3fa605,_0x161c9c,_0x4d0617(0x2a2),_0x4d0617(0x291),_0x6479ed[_0x4d0617(0x29f)])==!![]){let _0x3a8661=path[_0x4d0617(0x232)](_0x6479ed[_0x4d0617(0x29f)],_0x6479ed['filename']),_0x19594e=config['getMediaCoverCachePath'](_0x6479ed,_0x32c0c4);if(fs['existsSync'](_0x19594e))return _0x161c9c['sendFile'](_0x19594e);jsmediatags[_0x4d0617(0x1eb)](_0x3a8661,{'onSuccess':function(_0x58aa44){const _0x430314=_0x4d0617;let _0x4e73b4=_0x58aa44[_0x430314(0x1f9)];var _0x3adb0d;_0x4e73b4['picture']&&_0x4e73b4[_0x430314(0x27a)]['data']&&(_0x3adb0d=_0x4e73b4[_0x430314(0x27a)][_0x430314(0x285)]);!_0x3adb0d&&_0x4e73b4[_0x430314(0x229)]&&_0x4e73b4[_0x430314(0x229)]['data']&&_0x4e73b4['APIC'][_0x430314(0x285)][_0x430314(0x285)]&&(_0x3adb0d=_0x4e73b4[_0x430314(0x229)][_0x430314(0x285)]['data']);if(_0x3adb0d){let _0x29fc71=path[_0x430314(0x232)](path['dirname'](_0x19594e),_0x430314(0x26d)+path[_0x430314(0x228)](_0x19594e));fs[_0x430314(0x27b)](_0x29fc71,Buffer[_0x430314(0x247)](_0x3adb0d),{'encoding':_0x430314(0x249)},function(_0xb560c5){const _0x6f4ece=_0x430314;if(!_0xb560c5)sharpUtil[_0x6f4ece(0x246)](_0x29fc71,path[_0x6f4ece(0x297)](_0x19594e),path[_0x6f4ece(0x228)](_0x19594e),'image',null,_0x4c7acb=>{const _0x2ae7d3=_0x6f4ece;return dbMusicIndexTable[_0x2ae7d3(0x25d)](_0x3fa605[_0x2ae7d3(0x222)][_0x2ae7d3(0x2a0)],_0x6479ed['id'],_0x2ae7d3(0x1fe),_0x19594e),fs['rm'](_0x29fc71,_0x372665=>{}),_0x161c9c[_0x2ae7d3(0x24c)](_0x19594e);},_0x5ef92f=>{return _0x161c9c['status'](0x194)['end']();},_0x32c0c4);else return _0x161c9c[_0x6f4ece(0x231)](0x194)[_0x6f4ece(0x267)]();});}else return _0x161c9c[_0x430314(0x231)](0x194)[_0x430314(0x267)]();},'onError':function(_0x369ca5){const _0x51d4c8=_0x4d0617;return _0x161c9c[_0x51d4c8(0x231)](0x194)[_0x51d4c8(0x267)]();}});}}),router[_0x2b52a0(0x27e)]('/getGroupList',(_0x5ef96f,_0x55eabc,_0x4c6a47)=>{const _0x2b35c8=_0x2b52a0;let _0x3bd4ef=_0x5ef96f['body'][_0x2b35c8(0x1f0)]||0x32,_0x466d9d=_0x5ef96f[_0x2b35c8(0x248)][_0x2b35c8(0x1f8)]||0x0,_0x3cff94=_0x5ef96f['body'][_0x2b35c8(0x21f)]||'album',_0x21f43c=_0x5ef96f[_0x2b35c8(0x248)][_0x2b35c8(0x239)]||_0x2b35c8(0x1e7),_0x492e50=_0x5ef96f[_0x2b35c8(0x248)][_0x2b35c8(0x287)]||_0x2b35c8(0x2a1),_0x28f2ff=_0x5ef96f[_0x2b35c8(0x248)][_0x2b35c8(0x23e)],_0x526d7d=_0x5ef96f['body'][_0x2b35c8(0x210)];if(dbMusicIndexTable['checkOrderParams'](_0x5ef96f,_0x55eabc,_0x21f43c,_0x492e50)!==!![])return;let _0x277987=[_0x2b35c8(0x1e7),'play_count',_0x2b35c8(0x282),_0x2b35c8(0x24f),_0x2b35c8(0x1e3),_0x2b35c8(0x263),_0x2b35c8(0x268),_0x2b35c8(0x24a),'id'],_0x3264ac=[_0x2b35c8(0x28a),'desc'];if(!_0x277987[_0x2b35c8(0x1e6)](_0x21f43c)||!_0x3264ac[_0x2b35c8(0x1e6)](_0x492e50))return _0x5ef96f[_0x2b35c8(0x222)][_0x2b35c8(0x260)](_0x55eabc,_0x2b35c8(0x28f),_0x21f43c,_0x492e50);let _0x129d35=dbUserTable[_0x2b35c8(0x242)](_0x5ef96f,'music',_0x2b35c8(0x291),!![]);if(_0x5ef96f['currentUser'][_0x2b35c8(0x1ea)]!=0x1&&!_0x129d35[_0x2b35c8(0x2a3)]&&_0x3cff94!='playlist')return _0x55eabc['json']({'code':0x0,'data':null});let _0x3bb5c0=[];if(_0x3cff94==_0x2b35c8(0x263)||_0x3cff94==_0x2b35c8(0x268)){_0x3bb5c0=dbMusicIndexTable[_0x2b35c8(0x23b)](_0x5ef96f['app'][_0x2b35c8(0x2a0)],_0x129d35,_0x3cff94,_0x3bd4ef,_0x466d9d,_0x21f43c,_0x492e50,_0x28f2ff,_0x526d7d);for(let _0x1e18cd of _0x3bb5c0){let _0x472bd7=_0x2b35c8(0x1fd)+_0x3cff94+_0x2b35c8(0x1ed)+_0x129d35[_0x2b35c8(0x2a3)],_0x4c4752=[_0x3cff94,..._0x129d35[_0x2b35c8(0x294)]];_0x1e18cd['coverList']=dbMusicIndexTable[_0x2b35c8(0x20f)](_0x5ef96f['app']['dbFileIndex'],_0x472bd7,_0x4c4752);}}else{if(_0x3cff94==_0x2b35c8(0x276)){_0x3bb5c0=dbMusicPlaylistTable[_0x2b35c8(0x23c)](_0x5ef96f[_0x2b35c8(0x222)][_0x2b35c8(0x2a0)],_0x5ef96f['currentUser']['id'],_0x3bd4ef,_0x466d9d,'id','desc',_0x28f2ff);for(let _0xfd8337 of _0x3bb5c0){_0xfd8337[_0x2b35c8(0x254)]=dbMusicIndexTable['getPlaylistCover'](_0x5ef96f['app'][_0x2b35c8(0x2a0)],_0xfd8337['id']);}}}return _0x55eabc[_0x2b35c8(0x27f)]({'code':0x0,'data':_0x3bb5c0});}),router['post'](_0x2b52a0(0x2a7),(_0x549e79,_0x521232,_0x4334dc)=>{const _0x4284b1=_0x2b52a0;let _0x13d3f4=_0x549e79[_0x4284b1(0x248)][_0x4284b1(0x24e)],_0x3aa65b=_0x549e79['body']['operation'];if(_0x3aa65b==_0x4284b1(0x290)){if(!_0x13d3f4)return _0x549e79[_0x4284b1(0x222)][_0x4284b1(0x260)](_0x521232,_0x4284b1(0x245));dbMusicPlaylistTable[_0x4284b1(0x23f)](_0x549e79[_0x4284b1(0x222)]['dbFileIndex'],_0x549e79[_0x4284b1(0x28c)]['id'],_0x13d3f4);}else{if(_0x3aa65b==_0x4284b1(0x255)||_0x3aa65b==_0x4284b1(0x1fc)){let _0x56b316=_0x549e79[_0x4284b1(0x248)][_0x4284b1(0x265)],_0x3f11fd=dbMusicPlaylistTable['getPlaylistById'](_0x549e79['app'][_0x4284b1(0x2a0)],_0x56b316),_0x25a416=![];(_0x549e79[_0x4284b1(0x28c)][_0x4284b1(0x1ea)]==0x1||_0x3f11fd[_0x4284b1(0x270)]==_0x549e79[_0x4284b1(0x28c)]['id'])&&(_0x25a416=!![]);if(!_0x25a416)return _0x521232[_0x4284b1(0x27f)]({'code':0x66});if(_0x3aa65b==_0x4284b1(0x1fc))dbMusicPlaylistTable[_0x4284b1(0x1e9)](_0x549e79[_0x4284b1(0x222)][_0x4284b1(0x2a0)],_0x56b316);else{if(_0x3aa65b=='edit'){if(!_0x13d3f4)return _0x549e79[_0x4284b1(0x222)][_0x4284b1(0x260)](_0x521232,_0x4284b1(0x245));dbMusicPlaylistTable['updatePlaylist'](_0x549e79[_0x4284b1(0x222)]['dbFileIndex'],_0x56b316,_0x13d3f4);}}}else return _0x549e79[_0x4284b1(0x222)][_0x4284b1(0x260)](_0x521232,_0x4284b1(0x25f));}return _0x521232[_0x4284b1(0x27f)]({'code':0x0});}),router[_0x2b52a0(0x27e)](_0x2b52a0(0x1f2),(_0x364a9c,_0x522377,_0x567e2c)=>{const _0x58a25d=_0x2b52a0;let _0x143793=_0x364a9c[_0x58a25d(0x248)][_0x58a25d(0x1f6)],_0x129cf3=_0x364a9c[_0x58a25d(0x248)]['playlistId'];if(!_0x143793||!_0x129cf3)return _0x364a9c[_0x58a25d(0x222)][_0x58a25d(0x260)](_0x522377,_0x58a25d(0x26a));let _0x12a040=dbMusicPlaylistTable[_0x58a25d(0x28d)](_0x364a9c[_0x58a25d(0x222)][_0x58a25d(0x2a0)],_0x129cf3);if(!_0x12a040)return _0x364a9c[_0x58a25d(0x222)][_0x58a25d(0x260)](_0x522377,_0x58a25d(0x29d));let _0x2273ee=_0x364a9c[_0x58a25d(0x248)]['operation'];if(_0x2273ee==_0x58a25d(0x290)){function _0x2c18b4(_0x1680eb){const _0xf60a2d=_0x58a25d;let _0x5d83de=dbMusicIndexTable[_0xf60a2d(0x273)](_0x364a9c[_0xf60a2d(0x222)][_0xf60a2d(0x2a0)],_0x1680eb);if(!_0x5d83de)return;if(_0x5d83de[_0xf60a2d(0x205)]==0x1){dbMusicPlaylistTable['addMusicToPlaylist'](_0x364a9c[_0xf60a2d(0x222)][_0xf60a2d(0x2a0)],_0x1680eb,_0x129cf3);let _0x6e74a0=Date[_0xf60a2d(0x1ff)]();_0x364a9c[_0xf60a2d(0x222)][_0xf60a2d(0x2a0)][_0xf60a2d(0x269)](_0xf60a2d(0x299))['run'](_0x6e74a0,_0x5d83de['id']);}else{let _0x1d5246=path[_0xf60a2d(0x232)](_0x5d83de[_0xf60a2d(0x29f)],_0x5d83de['filename']),_0xdd265d=_0x364a9c[_0xf60a2d(0x222)][_0xf60a2d(0x2a0)][_0xf60a2d(0x269)](_0xf60a2d(0x279))[_0xf60a2d(0x26b)](_0x1d5246,_0x1d5246+path[_0xf60a2d(0x261)]+'%');for(let _0x1bb717 of _0xdd265d){dbMusicPlaylistTable[_0xf60a2d(0x28b)](_0x364a9c[_0xf60a2d(0x222)][_0xf60a2d(0x2a0)],_0x1bb717['id'],_0x129cf3);}}}if(_0x143793 instanceof Array)for(let _0x4bdb79 of _0x143793){_0x2c18b4(_0x4bdb79);}else _0x2c18b4(_0x143793);}else{if(_0x2273ee==_0x58a25d(0x1fc)){if(_0x143793 instanceof Array)for(let _0x280d92 of _0x143793){dbMusicPlaylistTable['removeMusicFromPlaylist'](_0x364a9c[_0x58a25d(0x222)][_0x58a25d(0x2a0)],_0x280d92,_0x129cf3);}else dbMusicPlaylistTable[_0x58a25d(0x224)](_0x364a9c[_0x58a25d(0x222)]['dbFileIndex'],_0x143793,_0x129cf3);}else return _0x364a9c[_0x58a25d(0x222)][_0x58a25d(0x260)](_0x522377,_0x58a25d(0x25f));}return _0x522377['json']({'code':0x0,'data':{}});}),router[_0x2b52a0(0x27e)](_0x2b52a0(0x264),(_0x55ae5d,_0x472a63,_0x5c8274)=>{const _0x23f2ac=_0x2b52a0;let _0x974277=_0x55ae5d[_0x23f2ac(0x248)][_0x23f2ac(0x29c)],_0x10f557=_0x55ae5d[_0x23f2ac(0x248)][_0x23f2ac(0x236)],_0x2513cb=_0x23f2ac(0x2a2),_0x1424f7=_0x55ae5d[_0x23f2ac(0x248)]['orderField']??_0x23f2ac(0x24f),_0x11dcf6=_0x55ae5d[_0x23f2ac(0x248)][_0x23f2ac(0x287)]??_0x23f2ac(0x28a);if(dbMusicIndexTable[_0x23f2ac(0x22e)](_0x55ae5d,_0x472a63,_0x1424f7,_0x11dcf6)!==!![])return;if(dbUserTable[_0x23f2ac(0x20c)](_0x55ae5d,_0x472a63,_0x2513cb,_0x23f2ac(0x291))==!![]){let _0x37b4f0=[];if(!_0x974277){let _0x4cf4ba=[];_0x55ae5d[_0x23f2ac(0x28c)][_0x23f2ac(0x1ea)]==0x1?_0x4cf4ba=dbSourceFolderTable['getPathByType'](_0x55ae5d[_0x23f2ac(0x222)][_0x23f2ac(0x25b)],_0x2513cb):_0x4cf4ba=dbUserTable[_0x23f2ac(0x230)](_0x55ae5d['app'][_0x23f2ac(0x25b)],_0x55ae5d[_0x23f2ac(0x28c)][_0x23f2ac(0x241)],_0x2513cb);if(_0x4cf4ba)for(let _0x5ec3fc=0x0;_0x5ec3fc<_0x4cf4ba['length'];_0x5ec3fc++){_0x37b4f0[_0x23f2ac(0x271)]({'path':_0x4cf4ba[_0x5ec3fc][_0x23f2ac(0x29f)],'is_file':0x0,'filename':path[_0x23f2ac(0x228)](_0x4cf4ba[_0x5ec3fc][_0x23f2ac(0x29f)]),'root':!![]});}}else{let _0x3cb26b=[];if(_0x55ae5d[_0x23f2ac(0x28c)][_0x23f2ac(0x1ea)]!=0x1){if(dbUserTable[_0x23f2ac(0x20c)](_0x55ae5d,_0x472a63,_0x2513cb,_0x23f2ac(0x291),_0x974277)!==!![])return;}_0x974277=path[_0x23f2ac(0x232)](_0x974277);let _0x30cca2=_0x23f2ac(0x206);_0x3cb26b[_0x23f2ac(0x271)](_0x974277),_0x30cca2+=_0x23f2ac(0x234);if(_0x10f557){let _0x484b19=_0x23f2ac(0x2aa);_0x30cca2+=_0x484b19,_0x3cb26b[_0x23f2ac(0x271)]('%'+_0x10f557+'%'),_0x3cb26b[_0x23f2ac(0x271)]('%'+_0x10f557+'%');}let _0x9658e6=_0x23f2ac(0x24b);_0x30cca2+=_0x23f2ac(0x201)+_0x1424f7+'\x20'+_0x11dcf6,_0x37b4f0=_0x55ae5d[_0x23f2ac(0x222)][_0x23f2ac(0x2a0)][_0x23f2ac(0x269)](_0x23f2ac(0x275)+_0x9658e6+_0x23f2ac(0x288)+_0x30cca2)['all'](_0x3cb26b);}for(let _0x88e807 of _0x37b4f0){_0x88e807[_0x23f2ac(0x26f)]=dbMusicFavorite[_0x23f2ac(0x233)](_0x55ae5d[_0x23f2ac(0x222)][_0x23f2ac(0x2a0)],_0x88e807['id'],_0x55ae5d[_0x23f2ac(0x28c)]['id'])?'1':'0';}let _0x3741a0=path[_0x23f2ac(0x261)],_0x20d59a={'code':0x0,'data':_0x37b4f0,'sep':_0x3741a0};return _0x472a63[_0x23f2ac(0x27f)](_0x20d59a);}}),module['exports']=router;