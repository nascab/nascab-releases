const _0x5fcbe=_0x1e5c;function _0x1e5c(_0x5722a9,_0x55e603){const _0x500c51=_0x500c();return _0x1e5c=function(_0x1e5c2d,_0x15bbdf){_0x1e5c2d=_0x1e5c2d-0x19d;let _0x2f9106=_0x500c51[_0x1e5c2d];return _0x2f9106;},_0x1e5c(_0x5722a9,_0x55e603);}(function(_0x3c9b1b,_0x399d2e){const _0x501331=_0x1e5c,_0x35e88e=_0x3c9b1b();while(!![]){try{const _0xc911af=parseInt(_0x501331(0x1a4))/0x1+parseInt(_0x501331(0x250))/0x2+parseInt(_0x501331(0x203))/0x3*(-parseInt(_0x501331(0x22a))/0x4)+-parseInt(_0x501331(0x253))/0x5*(-parseInt(_0x501331(0x1bc))/0x6)+-parseInt(_0x501331(0x1c7))/0x7+parseInt(_0x501331(0x1c9))/0x8+parseInt(_0x501331(0x259))/0x9;if(_0xc911af===_0x399d2e)break;else _0x35e88e['push'](_0x35e88e['shift']());}catch(_0x139281){_0x35e88e['push'](_0x35e88e['shift']());}}}(_0x500c,0x9e8b8));let express=require(_0x5fcbe(0x231)),router=express['Router'](),config=require(_0x5fcbe(0x219)),path=require(_0x5fcbe(0x1fe)),fs=require('fs'),dbMusicIndexTable=require(_0x5fcbe(0x24a)),dbFileIndexTable=require(_0x5fcbe(0x1d1)),dbMusicPlaylistTable=require(_0x5fcbe(0x1ff)),dbMusicFavorite=require(_0x5fcbe(0x21a)),jsmediatags=require(_0x5fcbe(0x25c));const dbUserTable=require(_0x5fcbe(0x217));let musicUitls=require('../../utils/musicUtil'),lyricUtils=require(_0x5fcbe(0x1ed)),sharpUtil=require(_0x5fcbe(0x25a));const dbSourceFolderTable=require(_0x5fcbe(0x1a1));let axios=require(_0x5fcbe(0x1f2)),sha256=require(_0x5fcbe(0x22f)),os=require('os');const urlConfig=require('../../myConfig/urlConfig');function getFavoriteMusicList(_0x4f0eb9,_0x258b3c,_0x16374e,_0x2f67f8,_0x14c938,_0x1c9922,_0x339fb2){const _0x1d5733=_0x5fcbe;let _0x1f89ce='',_0x15bfb8=[];_0x1f89ce+=_0x1d5733(0x24c);_0x1c9922&&(_0x1c9922=_0x1c9922[_0x1d5733(0x225)]('\x27','')[_0x1d5733(0x225)]('â€™',''),_0x1f89ce+=_0x1d5733(0x22b),_0x15bfb8[_0x1d5733(0x202)]('%'+_0x1c9922+'%','%'+_0x1c9922+'%','%'+_0x1c9922+'%'));_0x339fb2&&(_0x1f89ce+=_0x1d5733(0x1f0),_0x15bfb8[_0x1d5733(0x202)](_0x339fb2,_0x339fb2));if(_0x2f67f8&&_0x14c938){if(_0x2f67f8=='artist')_0x1f89ce+='\x20order\x20by\x20f.artist_fl\x20'+_0x14c938+_0x1d5733(0x1d6)+_0x14c938+'\x20';else{if(_0x2f67f8==_0x1d5733(0x1ee))_0x1f89ce+=_0x1d5733(0x262)+_0x14c938+_0x1d5733(0x23c)+_0x14c938+'\x20';else{if(_0x2f67f8==_0x1d5733(0x204))_0x1f89ce+='\x20order\x20by\x20f.title_fl\x20'+_0x14c938+_0x1d5733(0x1aa)+_0x14c938+_0x1d5733(0x22e)+_0x14c938+'\x20';else _0x2f67f8==_0x1d5733(0x1a7)?_0x1f89ce+=_0x1d5733(0x21e)+_0x14c938+'\x20':_0x1f89ce+=_0x1d5733(0x245)+_0x2f67f8+'\x20'+_0x14c938+'\x20';}}}else _0x1f89ce+='\x20order\x20by\x20m.update_time\x20DESC\x20';return _0x1f89ce+=_0x1d5733(0x258),_0x15bfb8[_0x1d5733(0x202)](_0x258b3c),_0x15bfb8['push'](_0x16374e),result=dbMusicFavorite[_0x1d5733(0x1b7)](_0x4f0eb9[_0x1d5733(0x221)]['dbFileIndex'],_0x4f0eb9[_0x1d5733(0x261)]['id'],_0x1f89ce,'*',_0x15bfb8),result=dealMusicList(_0x4f0eb9,result),result;}function dealMusicList(_0x4a456c,_0x32290b){const _0x372396=_0x5fcbe;for(let _0x4853c2 of _0x32290b){_0x4853c2[_0x372396(0x25d)]=dbMusicFavorite[_0x372396(0x224)](_0x4a456c[_0x372396(0x221)]['dbFileIndex'],_0x4853c2['id'],_0x4a456c[_0x372396(0x261)]['id'])?'1':'0';if(!_0x4853c2[_0x372396(0x1de)]){let _0x5cf54b=!![];_0x4853c2[_0x372396(0x20a)]&&fs['existsSync'](_0x4853c2[_0x372396(0x20a)])&&(_0x5cf54b=![]),_0x5cf54b&&(_0x4853c2['file_cover_path']=musicUitls[_0x372396(0x1d2)](_0x4a456c[_0x372396(0x221)]['dbFileIndex'],_0x4853c2));}_0x4853c2[_0x372396(0x201)]=path[_0x372396(0x1a6)](_0x4853c2[_0x372396(0x1fe)],_0x4853c2[_0x372396(0x1db)]),delete _0x4853c2[_0x372396(0x1fe)];}return _0x32290b;}function getMusicListByParams(_0x2a0191,_0x8fefdb,_0x465265,_0x2f715d,_0x503604,_0x3bd4d7,_0x10a99b,_0x5f0175,_0x4533ab,_0x2b299e,_0xd5fc67,_0x34fdf0,_0x5e241b){const _0x3f6664=_0x5fcbe;let _0x241c7c=_0x2a0191[_0x3f6664(0x221)][_0x3f6664(0x1c6)],_0x10f60e=[];return _0x10f60e=dbMusicIndexTable[_0x3f6664(0x1b3)](_0x241c7c,_0x8fefdb,_0x465265,_0x2f715d,_0x503604,_0x3bd4d7,_0x10a99b,_0x5f0175,_0x4533ab,_0x2b299e,_0x34fdf0,_0xd5fc67,_0x5e241b),_0x10f60e=dealMusicList(_0x2a0191,_0x10f60e),_0x10f60e;}router['post'](_0x5fcbe(0x1ba),(_0x43f66a,_0x40854a,_0x213679)=>{const _0x2aaade=_0x5fcbe;let _0x2233b2=_0x43f66a[_0x2aaade(0x221)][_0x2aaade(0x1c6)],_0x4323fd=_0x43f66a[_0x2aaade(0x23f)][_0x2aaade(0x1b1)]?_0x43f66a[_0x2aaade(0x23f)][_0x2aaade(0x1b1)]:0xc,_0x2f5826=_0x43f66a[_0x2aaade(0x23f)]['albumCount']?_0x43f66a[_0x2aaade(0x23f)]['albumCount']:0xc,_0xe3b638=dbUserTable['getUserPathWhere'](_0x43f66a,_0x2aaade(0x1b8),_0x2aaade(0x1f6),!![]);if(_0x43f66a[_0x2aaade(0x261)][_0x2aaade(0x21f)]!=0x1&&!_0xe3b638[_0x2aaade(0x257)])return _0x40854a[_0x2aaade(0x20c)]({'code':0x0,'data':null});let _0x55da1b=getMusicListByParams(_0x43f66a,_0xe3b638,_0x4323fd,0x0,_0x2aaade(0x1c1),_0x2aaade(0x246)),_0x508f35=getMusicListByParams(_0x43f66a,_0xe3b638,_0x4323fd,0x0,_0x2aaade(0x1dc),_0x2aaade(0x1e9)),_0x3a250a=getMusicListByParams(_0x43f66a,_0xe3b638,_0x4323fd,0x0,'id',_0x2aaade(0x246)),_0x220b01=dbMusicIndexTable[_0x2aaade(0x1fa)](_0x2233b2,_0xe3b638,_0x2aaade(0x24d),_0x2f5826,0x0,_0x2aaade(0x1c1),_0x2aaade(0x246));for(let _0x56c406 of _0x220b01){let _0x1cdf36='\x20AND\x20artist=?\x20'+_0xe3b638[_0x2aaade(0x257)],_0x20111c=[_0x56c406[_0x2aaade(0x24d)],..._0xe3b638[_0x2aaade(0x223)]];_0x56c406[_0x2aaade(0x1b0)]=dbMusicIndexTable['getCoverByField'](_0x43f66a[_0x2aaade(0x221)]['dbFileIndex'],_0x1cdf36,_0x20111c);}let _0x7c036a=dbMusicIndexTable[_0x2aaade(0x1fa)](_0x2233b2,_0xe3b638,'album',_0x2f5826,0x0,'play_count','desc');for(let _0x1fd729 of _0x7c036a){let _0x533eee=_0x2aaade(0x215)+_0xe3b638[_0x2aaade(0x257)],_0x4ef4bd=[_0x1fd729[_0x2aaade(0x1ee)],..._0xe3b638[_0x2aaade(0x223)]];_0x1fd729[_0x2aaade(0x1b0)]=dbMusicIndexTable[_0x2aaade(0x22c)](_0x43f66a[_0x2aaade(0x221)][_0x2aaade(0x1c6)],_0x533eee,_0x4ef4bd);}let _0x4f3a81={};return _0x55da1b&&_0x55da1b[_0x2aaade(0x1d0)]>0x0&&(_0x4f3a81[_0x2aaade(0x1d4)]=_0x55da1b),_0x508f35&&_0x508f35['length']>0x0&&(_0x4f3a81['maxPlayMusic']=_0x508f35),_0x3a250a&&_0x3a250a[_0x2aaade(0x1d0)]>0x0&&(_0x4f3a81[_0x2aaade(0x230)]=_0x3a250a),_0x220b01&&_0x220b01[_0x2aaade(0x1d0)]>0x0&&(_0x4f3a81[_0x2aaade(0x208)]=_0x220b01),_0x7c036a&&_0x7c036a[_0x2aaade(0x1d0)]>0x0&&(_0x4f3a81[_0x2aaade(0x220)]=_0x7c036a),_0x40854a[_0x2aaade(0x20c)]({'code':0x0,'data':_0x4f3a81,'platform':os[_0x2aaade(0x211)]()});}),router[_0x5fcbe(0x20b)](_0x5fcbe(0x234),(_0x589856,_0x5ce569,_0x3b3f27)=>{const _0x4ee5f6=_0x5fcbe;let _0x5c2b0b=_0x589856[_0x4ee5f6(0x23f)][_0x4ee5f6(0x1b1)]||0x32,_0x4f2488=_0x589856[_0x4ee5f6(0x23f)][_0x4ee5f6(0x227)]||0x0,_0x4694bd=_0x589856[_0x4ee5f6(0x23f)][_0x4ee5f6(0x1ee)],_0x49dfb6=_0x589856[_0x4ee5f6(0x23f)]['year'],_0x9bc194=_0x589856['body'][_0x4ee5f6(0x24d)],_0x4d8d51=_0x589856[_0x4ee5f6(0x23f)][_0x4ee5f6(0x25e)],_0x581209=_0x589856['body']['orderField']||'last_play_time',_0x17f22f=_0x589856[_0x4ee5f6(0x23f)][_0x4ee5f6(0x252)]||_0x4ee5f6(0x246),_0x35a72d=[_0x4ee5f6(0x222),_0x4ee5f6(0x25d),_0x4ee5f6(0x23a)],_0xd04692=_0x589856[_0x4ee5f6(0x23f)][_0x4ee5f6(0x1ae)]||'list',_0x25470e=_0x589856[_0x4ee5f6(0x23f)][_0x4ee5f6(0x1fc)],_0x32e583=_0x589856[_0x4ee5f6(0x23f)][_0x4ee5f6(0x249)],_0x49d481=_0x589856['body'][_0x4ee5f6(0x251)];if(dbMusicIndexTable[_0x4ee5f6(0x19d)](_0x589856,_0x5ce569,_0x581209,_0x17f22f)!==!![])return;if(_0xd04692==_0x4ee5f6(0x23a)){if(!_0x49d481)return _0x589856[_0x4ee5f6(0x221)][_0x4ee5f6(0x23d)](_0x5ce569,_0x4ee5f6(0x1bd));}!_0x35a72d['includes'](_0xd04692)&&(_0xd04692=_0x4ee5f6(0x222));_0x5c2b0b>0x1f4&&(_0x5c2b0b=0x1f4);let _0x44d76b=dbUserTable['getUserPathWhere'](_0x589856,'music',_0x4ee5f6(0x1f6),!![]);if(_0x589856[_0x4ee5f6(0x261)][_0x4ee5f6(0x21f)]!=0x1&&!_0x44d76b['whereStr'])return _0x5ce569['json']({'code':0x0,'data':null});let _0x445a42=[];if(_0xd04692==_0x4ee5f6(0x23a)||_0xd04692=='list')_0x445a42=getMusicListByParams(_0x589856,_0x44d76b,_0x5c2b0b,_0x4f2488,_0x581209,_0x17f22f,_0x4694bd,_0x49dfb6,_0x9bc194,_0x4d8d51,_0x25470e,_0x49d481,_0x32e583);else _0xd04692=='favorite'&&(_0x445a42=getFavoriteMusicList(_0x589856,_0x5c2b0b,_0x4f2488,_0x581209,_0x17f22f,_0x25470e,_0x32e583));let _0x2f6a20={'code':0x0,'data':_0x445a42};if(_0xd04692==_0x4ee5f6(0x25d))_0x2f6a20[_0x4ee5f6(0x19f)]=dbMusicFavorite[_0x4ee5f6(0x1df)](_0x589856[_0x4ee5f6(0x221)]['dbFileIndex'],_0x589856[_0x4ee5f6(0x261)]['id']);else{if(_0xd04692==_0x4ee5f6(0x222))_0x2f6a20[_0x4ee5f6(0x19f)]=dbMusicIndexTable[_0x4ee5f6(0x1f4)](_0x589856[_0x4ee5f6(0x221)][_0x4ee5f6(0x1c6)],_0x44d76b,_0x4694bd,_0x49dfb6,_0x9bc194,_0x4d8d51);else _0xd04692==_0x4ee5f6(0x23a)&&(_0x2f6a20['music_count']=dbMusicPlaylistTable[_0x4ee5f6(0x233)](_0x589856[_0x4ee5f6(0x221)][_0x4ee5f6(0x1c6)],_0x49d481));}return _0x5ce569[_0x4ee5f6(0x20c)](_0x2f6a20);}),router[_0x5fcbe(0x20b)](_0x5fcbe(0x226),(_0x51e93d,_0x561761,_0x3a2966)=>{const _0x58aa6b=_0x5fcbe;let _0x44bfb1=_0x51e93d[_0x58aa6b(0x23f)]['id'],_0x3dce25=dbFileIndexTable[_0x58aa6b(0x210)](_0x51e93d['app'][_0x58aa6b(0x1c6)],_0x44bfb1,dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);if(!_0x3dce25)return _0x51e93d[_0x58aa6b(0x221)][_0x58aa6b(0x23d)](_0x561761,_0x58aa6b(0x20e));if(dbUserTable[_0x58aa6b(0x19e)](_0x51e93d,_0x561761,'music','power_get',_0x3dce25[_0x58aa6b(0x1fe)])==!![]){let _0x33f9ac=_0x51e93d['currentUser']['id'],_0x599ab4=dbMusicFavorite['getFavorite'](_0x51e93d[_0x58aa6b(0x221)][_0x58aa6b(0x1c6)],_0x33f9ac,_0x44bfb1);_0x3dce25[_0x58aa6b(0x20a)]=musicUitls[_0x58aa6b(0x1d2)](_0x51e93d[_0x58aa6b(0x221)][_0x58aa6b(0x1c6)],_0x3dce25),_0x3dce25[_0x58aa6b(0x25d)]=_0x599ab4?0x1:0x0,getLyrics(_0x3dce25,_0x34a65b=>{const _0x82580e=_0x58aa6b;return _0x3dce25[_0x82580e(0x1b5)]=_0x34a65b,_0x561761[_0x82580e(0x20c)]({'code':0x0,'data':_0x3dce25});});}});function updateIndexLyric(_0x33e64f,_0x5bdd08,_0x3cdcd5,_0x48a2d8){const _0x50ae83=_0x5fcbe;if(_0x3cdcd5&&_0x3cdcd5[_0x50ae83(0x1d0)]>0x0){let _0x1c8757=_0x48a2d8['filename'][_0x50ae83(0x225)](path['extname'](_0x48a2d8['filename']),''),_0x123a89=_0x1c8757+'.lrc',_0x3525f1=path['join'](_0x48a2d8[_0x50ae83(0x1fe)],_0x123a89);fs['writeFile'](_0x3525f1,_0x3cdcd5,_0x50ae83(0x1da),_0x3d0879=>{if(!_0x3d0879){}});}let _0x364aa1=JSON[_0x50ae83(0x1e6)]({'lyrics':_0x3cdcd5?_0x3cdcd5:''});_0x33e64f['prepare'](_0x50ae83(0x216))[_0x50ae83(0x22d)](_0x5bdd08,_0x364aa1,_0x48a2d8['id']);}function _0x500c(){const _0x383a0b=['../../db/dbMusicPlaylistTable','log','filePath','push','617703btednV','title','isSearch','uid','removePlaylist','artistList','power_add','file_cover_path','post','json','dbOther','NO\x20MUSIC\x20INDEX','orderField','getById','platform','need\x20\x27name\x27','createPlaylist','from','\x20AND\x20album=?\x20','UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?','../../db/dbUserTable','data','../../myConfig/config','../../db/dbMusicFavorite','searchStr','updateByFiled','Lyric\x20is\x20null','\x20order\x20by\x20m.update_time\x20','is_admin','albumList','app','list','paramsList','musicIsFavorite','replace','/getMusicDetail','offset','message','now','8CtAZHY','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','getCoverByField','run',',f.filename_fl\x20','sha256','recentAddList','express','trim','getPlaylistMusicCount','/getMusicList','getFavorite','abs','all','base64','query','playlist','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20',',f.album\x20','returnErrMsg','/searchLyric','body','sep','name','addMusicToPlaylist','check_time','searchMusicAlbum','\x20order\x20by\x20f.','desc','searchMusicArtist','parent','letterIndex','../../db/dbMusicIndexTable','status','\x20is_file=1','artist','toString','duration','146944NVRBIY','playlistId','orderType','25xUixAz','asc','\x20FROM\x20file_index_music\x20WHERE\x20','APIC','whereStr','\x20LIMIT\x20?\x20OFFSET\x20?\x20','219636udIBuw','../utils/sharpUtils','lrc','jsmediatags','favorite','genre','operation','file','currentUser','\x20order\x20by\x20f.album_fl\x20','/operationPlaylistIndex','checkOrderParams','doUserCanGet','music_count','end','../../db/dbSourceFolderTable','getPlaylistById','writeFile','526056UTaMPm','SELECT\x20','join','favorite_time','updatePlaylist','extname',',f.title\x20','skipCount','orderField/orderType\x20error','getPlaylistCover','listType','genTinyFile','coverList','count','birthtime','getMusicList','INDEX_TABLE_NAME_MUSIC','lyricList','/getGroupList','getAllFavoriteByWhere','music','indexId','/getMusicHomeData','getMusicIndex','917094KKhDBi','need\x20playlistId','transStringToUtf8','lyric','get','last_play_time','/saveLyric','picture','size','/getMusicCover','dbFileIndex','6519625UtBhZZ','getPathByType','4835200OIHXzp','dirname','apiTokenKey','removeMusicFromPlaylist','existsSync','then','exports','length','../../db/dbFileIndexTable','getMusicSameNameCover','includes','recentMusic','playlistId\x20no\x20exists',',f.artist\x20','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','deleteFavorite','groupField','utf-8','filename','play_count\x20desc','getPlaylistList','cover_path','getFavoriteCount','basename','ORDER\x20BY\x20','operation\x20error','prepare','lyrics_get_state','username','stringify','lyrics','\x20AND\x20',',id\x20asc','delete','musicIndexId','image','../../utils/music/lyricUtils','album','edit','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','addFavorite','axios','add','getMusicListCount','getTime','power_get','getUserPathWhere','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre','=?\x20','getGroupList','\x20(type=3\x20OR\x20is_file=0)','search','tags','path'];_0x500c=function(){return _0x383a0b;};return _0x500c();}router[_0x5fcbe(0x20b)](_0x5fcbe(0x1c2),(_0x2fbb08,_0x457942,_0xfe29e7)=>{const _0x8d4666=_0x5fcbe;let _0x1720a1=_0x2fbb08['body']['id'],_0x5cd7d3=_0x2fbb08[_0x8d4666(0x23f)][_0x8d4666(0x1bf)],_0x4e37f4=dbFileIndexTable[_0x8d4666(0x210)](_0x2fbb08[_0x8d4666(0x221)][_0x8d4666(0x1c6)],_0x1720a1,dbFileIndexTable[_0x8d4666(0x1b4)]);if(!_0x4e37f4)return _0x2fbb08[_0x8d4666(0x221)]['returnErrMsg'](_0x457942,_0x8d4666(0x20e));if(!_0x5cd7d3)return _0x2fbb08[_0x8d4666(0x221)][_0x8d4666(0x23d)](_0x457942,_0x8d4666(0x21d));if(dbUserTable['doUserCanGet'](_0x2fbb08,_0x457942,_0x8d4666(0x1b8),_0x8d4666(0x209),_0x4e37f4[_0x8d4666(0x1fe)])==!![])return updateIndexLyric(_0x2fbb08[_0x8d4666(0x221)][_0x8d4666(0x1c6)],0x1,_0x5cd7d3,_0x4e37f4),_0x457942[_0x8d4666(0x20c)]({'code':0x0});}),router[_0x5fcbe(0x20b)](_0x5fcbe(0x23e),(_0x1735bc,_0x24dfcb,_0x5c91c9)=>{const _0xe6b838=_0x5fcbe;let _0x5906fe=_0x1735bc['body']['id'],_0x5cc674=dbFileIndexTable[_0xe6b838(0x210)](_0x1735bc['app'][_0xe6b838(0x1c6)],_0x5906fe,dbFileIndexTable[_0xe6b838(0x1b4)]);if(!_0x5cc674)return _0x1735bc[_0xe6b838(0x221)][_0xe6b838(0x23d)](_0x24dfcb,_0xe6b838(0x20e));let _0x5be739=_0x1735bc['body']['searchMusicName'],_0x46d4bb=_0x1735bc[_0xe6b838(0x23f)][_0xe6b838(0x247)],_0x519ed8=_0x1735bc[_0xe6b838(0x23f)][_0xe6b838(0x244)],_0x1fcd7b=_0x1735bc['body'][_0xe6b838(0x205)];if(dbUserTable['doUserCanGet'](_0x1735bc,_0x24dfcb,'music','power_get',_0x5cc674['path'])==!![]){if(_0x5cc674[_0xe6b838(0x1e4)]==0x1&&!_0x1fcd7b)return _0x24dfcb[_0xe6b838(0x20c)]({'code':0x0,'data':[_0x5cc674['lyrics']]});let _0x2ccd26=_0x1735bc[_0xe6b838(0x23f)][_0xe6b838(0x1ab)]||0x0;if(!_0x5be739||!_0x5be739[_0xe6b838(0x232)]())return _0x24dfcb['json']([]);let _0x5e9e7c={'searchMusicName':_0x5be739,'searchMusicArtist':_0x46d4bb,'searchMusicAlbum':_0x519ed8,'isSearch':_0x1fcd7b,'skipCount':_0x2ccd26,'token':sha256(_0x5be739+config[_0xe6b838(0x1cb)])};lyricUtils['searchLyric'](_0x5e9e7c)[_0xe6b838(0x1ce)](_0x22bf13=>{const _0x5a9dbe=_0xe6b838;if(_0x22bf13){if(_0x22bf13[_0x5a9dbe(0x1d0)]>0x0&&!_0x1fcd7b){let _0x5777c3=![],_0x1e5a47=0x14,_0x16f7fd=0x64,_0x5ee757=null;for(let _0x1375a1 of _0x22bf13){if(_0x1375a1[_0x5a9dbe(0x24f)]){let _0x2883d3=_0x1375a1[_0x5a9dbe(0x24f)]/0x3e8,_0x2fd0d5=Math[_0x5a9dbe(0x236)](_0x2883d3-_0x5cc674['duration']);_0x2fd0d5<_0x16f7fd&&(_0x16f7fd=_0x2fd0d5,_0x5ee757=_0x1375a1[_0x5a9dbe(0x25b)]?_0x1375a1[_0x5a9dbe(0x25b)]:'');}}return _0x16f7fd<_0x1e5a47?(_0x5777c3=!![],_0x5cc674[_0x5a9dbe(0x1e7)]=JSON[_0x5a9dbe(0x1e6)]({'lyrics':_0x5ee757?_0x5ee757:''}),updateIndexLyric(_0x1735bc[_0x5a9dbe(0x221)][_0x5a9dbe(0x1c6)],0x1,_0x5ee757,_0x5cc674)):updateIndexLyric(_0x1735bc['app'][_0x5a9dbe(0x1c6)],0x1,'',_0x5cc674),_0x24dfcb[_0x5a9dbe(0x20c)]({'code':0x0,'data':_0x5777c3&&_0x5cc674[_0x5a9dbe(0x1e7)]?[_0x5cc674[_0x5a9dbe(0x1e7)]]:[]});}else return _0x24dfcb[_0x5a9dbe(0x20c)]({'code':0x0,'data':_0x22bf13});}})['catch'](_0x517726=>{const _0x2f5163=_0xe6b838;return _0x1735bc[_0x2f5163(0x221)][_0x2f5163(0x23d)](_0x24dfcb,_0x517726[_0x2f5163(0x228)]);});}});function getLyrics(_0x3413fe,_0x4e6c87){const _0x5a84d6=_0x5fcbe;let _0x26d9b5=[];try{_0x3413fe[_0x5a84d6(0x1e7)]&&_0x3413fe['lyrics'][_0x5a84d6(0x1d0)]>0xa&&_0x26d9b5[_0x5a84d6(0x202)]({'type':'inner','content':_0x3413fe[_0x5a84d6(0x1e7)]});let _0x585830=_0x3413fe[_0x5a84d6(0x1db)][_0x5a84d6(0x225)](path[_0x5a84d6(0x1a9)](_0x3413fe[_0x5a84d6(0x1db)]),''),_0x52ffa6=_0x585830+'.lrc',_0x4cd989=path[_0x5a84d6(0x1a6)](_0x3413fe[_0x5a84d6(0x1fe)],_0x52ffa6);fs[_0x5a84d6(0x1cd)](_0x4cd989)?fs['readFile'](_0x4cd989,(_0x29be1a,_0x3e53bb)=>{const _0xc904e6=_0x5a84d6;let _0x302ed7=musicUitls[_0xc904e6(0x1be)](_0x3e53bb[_0xc904e6(0x24e)](),_0x4cd989);_0x26d9b5[_0xc904e6(0x202)]({'type':_0xc904e6(0x260),'filename':_0x52ffa6,'content':_0x302ed7}),_0x4e6c87(_0x26d9b5);}):_0x4e6c87(_0x26d9b5);}catch(_0x2222a8){console[_0x5a84d6(0x200)](_0x2222a8),_0x4e6c87(_0x26d9b5);}}router[_0x5fcbe(0x20b)]('/musicFavorite',(_0x1db041,_0x58bae7,_0xebaba9)=>{const _0x54c654=_0x5fcbe;let _0x3ab2ba=_0x1db041['currentUser']['id'];function _0x35b200(_0x4d0a66){const _0x324e77=_0x1e5c;let _0x5b48a9=dbFileIndexTable[_0x324e77(0x210)](_0x1db041[_0x324e77(0x221)][_0x324e77(0x1c6)],_0x4d0a66,dbFileIndexTable[_0x324e77(0x1b4)]);if(!_0x5b48a9)return;let _0x2170ba=new Date()[_0x324e77(0x1f5)]();_0x1db041[_0x324e77(0x221)][_0x324e77(0x1c6)]['prepare'](_0x324e77(0x1d7))[_0x324e77(0x22d)](_0x2170ba,_0x4d0a66),dbMusicFavorite[_0x324e77(0x1f1)](_0x1db041['app']['dbFileIndex'],_0x3ab2ba,_0x4d0a66);}if(_0x1db041[_0x54c654(0x23f)][_0x54c654(0x1eb)]instanceof Array){let _0x261654=_0x1db041[_0x54c654(0x23f)]['operation'];if(_0x261654=='add')for(let _0x1cd82e of _0x1db041['body'][_0x54c654(0x1eb)]){_0x35b200(_0x1cd82e);}else{if(_0x261654==_0x54c654(0x1ea))for(let _0x4d2aed of _0x1db041[_0x54c654(0x23f)]['musicIndexId']){dbMusicFavorite[_0x54c654(0x1d8)](_0x1db041[_0x54c654(0x221)][_0x54c654(0x1c6)],_0x3ab2ba,_0x4d2aed);}}return _0x58bae7[_0x54c654(0x20c)]({'code':0x0});}else{let _0x4b61b1=parseInt(_0x1db041[_0x54c654(0x23f)][_0x54c654(0x1eb)]),_0x109bc7=dbMusicFavorite[_0x54c654(0x235)](_0x1db041[_0x54c654(0x221)]['dbFileIndex'],_0x3ab2ba,_0x4b61b1),_0x52fce6=0x0;return _0x109bc7?dbMusicFavorite[_0x54c654(0x1d8)](_0x1db041['app']['dbFileIndex'],_0x3ab2ba,_0x4b61b1):(_0x52fce6=0x1,_0x35b200(_0x4b61b1)),_0x58bae7[_0x54c654(0x20c)]({'code':0x0,'favorite':_0x52fce6});}}),router[_0x5fcbe(0x1c0)](_0x5fcbe(0x1c5),(_0x4f6b3c,_0x41dc1b,_0x41918a)=>{const _0x201cda=_0x5fcbe;let _0x44197f=_0x4f6b3c[_0x201cda(0x239)][_0x201cda(0x1b9)],_0x3d0800=dbMusicIndexTable[_0x201cda(0x1bb)](_0x4f6b3c[_0x201cda(0x221)]['dbFileIndex'],_0x44197f),_0x43ac4c=_0x4f6b3c[_0x201cda(0x239)][_0x201cda(0x1c4)];!_0x43ac4c&&(_0x43ac4c=0x200);if(!_0x3d0800||_0x3d0800&&!_0x3d0800['cover_path'])return _0x41dc1b[_0x201cda(0x24b)](0x194)[_0x201cda(0x1a0)]();if(dbUserTable[_0x201cda(0x19e)](_0x4f6b3c,_0x41dc1b,'music',_0x201cda(0x1f6),_0x3d0800[_0x201cda(0x1fe)])==!![]){let _0x32d273=path[_0x201cda(0x1a6)](_0x3d0800[_0x201cda(0x1fe)],_0x3d0800[_0x201cda(0x1db)]),_0x7c12e2=config['getMediaCoverCachePath'](_0x3d0800,_0x43ac4c);if(fs[_0x201cda(0x1cd)](_0x7c12e2))return _0x41dc1b['sendFile'](_0x7c12e2);jsmediatags['read'](_0x32d273,{'onSuccess':function(_0x56deaf){const _0xe17544=_0x201cda;let _0x51f6fa=_0x56deaf[_0xe17544(0x1fd)];var _0x32c38a;_0x51f6fa[_0xe17544(0x1c3)]&&_0x51f6fa['picture'][_0xe17544(0x218)]&&(_0x32c38a=_0x51f6fa[_0xe17544(0x1c3)][_0xe17544(0x218)]);!_0x32c38a&&_0x51f6fa['APIC']&&_0x51f6fa[_0xe17544(0x256)]['data']&&_0x51f6fa['APIC']['data'][_0xe17544(0x218)]&&(_0x32c38a=_0x51f6fa['APIC'][_0xe17544(0x218)][_0xe17544(0x218)]);if(_0x32c38a){let _0x48f694=path[_0xe17544(0x1a6)](path[_0xe17544(0x1ca)](_0x7c12e2),'temp.'+path[_0xe17544(0x1e0)](_0x7c12e2));fs[_0xe17544(0x1a3)](_0x48f694,Buffer[_0xe17544(0x214)](_0x32c38a),{'encoding':_0xe17544(0x238)},function(_0x143e12){const _0x4ed513=_0xe17544;if(!_0x143e12)sharpUtil[_0x4ed513(0x1af)](_0x48f694,path['dirname'](_0x7c12e2),path[_0x4ed513(0x1e0)](_0x7c12e2),_0x4ed513(0x1ec),null,_0x4eaf7e=>{const _0x20a523=_0x4ed513;return dbMusicIndexTable[_0x20a523(0x21c)](_0x4f6b3c['app']['dbFileIndex'],_0x3d0800['id'],'cover_path',_0x7c12e2),fs['rm'](_0x48f694,_0x1fe451=>{}),_0x41dc1b['sendFile'](_0x7c12e2);},_0x505d3d=>{const _0x413bb6=_0x4ed513;return _0x41dc1b['status'](0x194)[_0x413bb6(0x1a0)]();},_0x43ac4c);else return _0x41dc1b[_0x4ed513(0x24b)](0x194)[_0x4ed513(0x1a0)]();});}else return _0x41dc1b[_0xe17544(0x24b)](0x194)[_0xe17544(0x1a0)]();},'onError':function(_0x129c0d){const _0x134bad=_0x201cda;return _0x41dc1b[_0x134bad(0x24b)](0x194)[_0x134bad(0x1a0)]();}});}}),router[_0x5fcbe(0x20b)](_0x5fcbe(0x1b6),(_0xc89ad4,_0x1c0986,_0x2a0041)=>{const _0x47916b=_0x5fcbe;let _0x28ea91=_0xc89ad4[_0x47916b(0x23f)]['count']||0x32,_0x3c2851=_0xc89ad4['body']['offset']||0x0,_0x2965e0=_0xc89ad4[_0x47916b(0x23f)][_0x47916b(0x1d9)]||_0x47916b(0x1ee),_0x255a0b=_0xc89ad4[_0x47916b(0x23f)][_0x47916b(0x20f)]||_0x47916b(0x243),_0x1ea487=_0xc89ad4[_0x47916b(0x23f)][_0x47916b(0x252)]||_0x47916b(0x246),_0x5279ba=_0xc89ad4['body'][_0x47916b(0x1fc)],_0x4fbdf9=_0xc89ad4[_0x47916b(0x23f)][_0x47916b(0x249)];if(dbMusicIndexTable['checkOrderParams'](_0xc89ad4,_0x1c0986,_0x255a0b,_0x1ea487)!==!![])return;let _0x276d52=[_0x47916b(0x243),'play_count',_0x47916b(0x1c1),_0x47916b(0x1db),'title',_0x47916b(0x1ee),'artist',_0x47916b(0x1b2),'id'],_0x4efbec=[_0x47916b(0x254),_0x47916b(0x246)];if(!_0x276d52[_0x47916b(0x1d3)](_0x255a0b)||!_0x4efbec[_0x47916b(0x1d3)](_0x1ea487))return _0xc89ad4[_0x47916b(0x221)]['returnErrMsg'](_0x1c0986,_0x47916b(0x1ac),_0x255a0b,_0x1ea487);let _0x3b445f=dbUserTable[_0x47916b(0x1f7)](_0xc89ad4,_0x47916b(0x1b8),_0x47916b(0x1f6),!![]);if(_0xc89ad4['currentUser'][_0x47916b(0x21f)]!=0x1&&!_0x3b445f[_0x47916b(0x257)]&&_0x2965e0!='playlist')return _0x1c0986[_0x47916b(0x20c)]({'code':0x0,'data':null});let _0x438284=[];if(_0x2965e0==_0x47916b(0x1ee)||_0x2965e0==_0x47916b(0x24d)){_0x438284=dbMusicIndexTable['getGroupList'](_0xc89ad4[_0x47916b(0x221)]['dbFileIndex'],_0x3b445f,_0x2965e0,_0x28ea91,_0x3c2851,_0x255a0b,_0x1ea487,_0x5279ba,_0x4fbdf9);for(let _0x4e67d8 of _0x438284){let _0x3bc201=_0x47916b(0x1e8)+_0x2965e0+_0x47916b(0x1f9)+_0x3b445f[_0x47916b(0x257)],_0x1d7326=[_0x2965e0,..._0x3b445f['paramsList']];_0x4e67d8[_0x47916b(0x1b0)]=dbMusicIndexTable[_0x47916b(0x22c)](_0xc89ad4[_0x47916b(0x221)][_0x47916b(0x1c6)],_0x3bc201,_0x1d7326);}}else{if(_0x2965e0==_0x47916b(0x23a)){_0x438284=dbMusicPlaylistTable[_0x47916b(0x1dd)](_0xc89ad4[_0x47916b(0x221)][_0x47916b(0x1c6)],_0xc89ad4['currentUser']['id'],_0x28ea91,_0x3c2851,'id',_0x47916b(0x246),_0x5279ba);for(let _0x4c2e39 of _0x438284){_0x4c2e39[_0x47916b(0x1b0)]=dbMusicIndexTable[_0x47916b(0x1ad)](_0xc89ad4[_0x47916b(0x221)]['dbFileIndex'],_0x4c2e39['id']);}}}return _0x1c0986['json']({'code':0x0,'data':_0x438284});}),router[_0x5fcbe(0x20b)]('/operationPlaylist',(_0x5bc292,_0x218eeb,_0x3b08ba)=>{const _0x547f8d=_0x5fcbe;let _0x586b2e=_0x5bc292['body'][_0x547f8d(0x241)],_0x15acb3=_0x5bc292[_0x547f8d(0x23f)][_0x547f8d(0x25f)];if(_0x15acb3==_0x547f8d(0x1f3)){if(!_0x586b2e)return _0x5bc292[_0x547f8d(0x221)][_0x547f8d(0x23d)](_0x218eeb,_0x547f8d(0x212));dbMusicPlaylistTable[_0x547f8d(0x213)](_0x5bc292['app'][_0x547f8d(0x1c6)],_0x5bc292['currentUser']['id'],_0x586b2e);}else{if(_0x15acb3==_0x547f8d(0x1ef)||_0x15acb3=='delete'){let _0x143331=_0x5bc292[_0x547f8d(0x23f)]['playlistId'],_0x103833=dbMusicPlaylistTable[_0x547f8d(0x1a2)](_0x5bc292[_0x547f8d(0x221)][_0x547f8d(0x1c6)],_0x143331),_0x179659=![];(_0x5bc292['currentUser'][_0x547f8d(0x21f)]==0x1||_0x103833[_0x547f8d(0x206)]==_0x5bc292[_0x547f8d(0x261)]['id'])&&(_0x179659=!![]);if(!_0x179659)return _0x218eeb[_0x547f8d(0x20c)]({'code':0x66});if(_0x15acb3=='delete')dbMusicPlaylistTable[_0x547f8d(0x207)](_0x5bc292[_0x547f8d(0x221)]['dbFileIndex'],_0x143331);else{if(_0x15acb3==_0x547f8d(0x1ef)){if(!_0x586b2e)return _0x5bc292[_0x547f8d(0x221)][_0x547f8d(0x23d)](_0x218eeb,_0x547f8d(0x212));dbMusicPlaylistTable[_0x547f8d(0x1a8)](_0x5bc292['app'][_0x547f8d(0x1c6)],_0x143331,_0x586b2e);}}}else return _0x5bc292[_0x547f8d(0x221)]['returnErrMsg'](_0x218eeb,_0x547f8d(0x1e2));}return _0x218eeb[_0x547f8d(0x20c)]({'code':0x0});}),router[_0x5fcbe(0x20b)](_0x5fcbe(0x263),(_0x27f5e2,_0x4d5e23,_0x4cdcc0)=>{const _0x419924=_0x5fcbe;let _0x6e0ec4=_0x27f5e2[_0x419924(0x23f)][_0x419924(0x1eb)],_0x5e5b56=_0x27f5e2[_0x419924(0x23f)]['playlistId'];if(!_0x6e0ec4||!_0x5e5b56)return _0x27f5e2[_0x419924(0x221)]['returnErrMsg'](_0x4d5e23,'need\x20musicIndexId\x20and\x20playlistId');let _0x1a4ccb=dbMusicPlaylistTable[_0x419924(0x1a2)](_0x27f5e2['app']['dbFileIndex'],_0x5e5b56);if(!_0x1a4ccb)return _0x27f5e2[_0x419924(0x221)][_0x419924(0x23d)](_0x4d5e23,_0x419924(0x1d5));let _0x3bb02a=_0x27f5e2['body']['operation'];if(_0x3bb02a==_0x419924(0x1f3)){function _0x3573ad(_0x66c0be){const _0xef045f=_0x419924;let _0x2a5327=dbMusicIndexTable[_0xef045f(0x1bb)](_0x27f5e2['app'][_0xef045f(0x1c6)],_0x66c0be);if(!_0x2a5327)return;if(_0x2a5327['is_file']==0x1){dbMusicPlaylistTable[_0xef045f(0x242)](_0x27f5e2['app'][_0xef045f(0x1c6)],_0x66c0be,_0x5e5b56);let _0x8f7384=Date[_0xef045f(0x229)]();_0x27f5e2[_0xef045f(0x221)][_0xef045f(0x1c6)][_0xef045f(0x1e3)](_0xef045f(0x1d7))[_0xef045f(0x22d)](_0x8f7384,_0x2a5327['id']);}else{let _0x2c03eb=path[_0xef045f(0x1a6)](_0x2a5327[_0xef045f(0x1fe)],_0x2a5327[_0xef045f(0x1db)]),_0x33e568=_0x27f5e2[_0xef045f(0x221)]['dbFileIndex'][_0xef045f(0x1e3)]('SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?')[_0xef045f(0x237)](_0x2c03eb,_0x2c03eb+path[_0xef045f(0x240)]+'%');for(let _0x97aa8d of _0x33e568){dbMusicPlaylistTable[_0xef045f(0x242)](_0x27f5e2['app'][_0xef045f(0x1c6)],_0x97aa8d['id'],_0x5e5b56);}}}if(_0x6e0ec4 instanceof Array)for(let _0x2227b2 of _0x6e0ec4){_0x3573ad(_0x2227b2);}else _0x3573ad(_0x6e0ec4);}else{if(_0x3bb02a==_0x419924(0x1ea)){if(_0x6e0ec4 instanceof Array)for(let _0x1e4253 of _0x6e0ec4){dbMusicPlaylistTable[_0x419924(0x1cc)](_0x27f5e2['app'][_0x419924(0x1c6)],_0x1e4253,_0x5e5b56);}else dbMusicPlaylistTable[_0x419924(0x1cc)](_0x27f5e2[_0x419924(0x221)][_0x419924(0x1c6)],_0x6e0ec4,_0x5e5b56);}else return _0x27f5e2[_0x419924(0x221)][_0x419924(0x23d)](_0x4d5e23,_0x419924(0x1e2));}return _0x4d5e23[_0x419924(0x20c)]({'code':0x0,'data':{}});}),router[_0x5fcbe(0x20b)]('/getMusicIndexFileTree',(_0x565149,_0x14d591,_0x3133c2)=>{const _0x34354c=_0x5fcbe;let _0xdddc76=_0x565149[_0x34354c(0x23f)][_0x34354c(0x248)],_0x3f6aa5=_0x565149[_0x34354c(0x23f)][_0x34354c(0x21b)],_0x5c258d=_0x34354c(0x1b8),_0x2387fd=_0x565149[_0x34354c(0x23f)][_0x34354c(0x20f)]??_0x34354c(0x1db),_0x3a51e1=_0x565149[_0x34354c(0x23f)]['orderType']??_0x34354c(0x254);if(dbMusicIndexTable[_0x34354c(0x19d)](_0x565149,_0x14d591,_0x2387fd,_0x3a51e1)!==!![])return;if(dbUserTable['doUserCanGet'](_0x565149,_0x14d591,_0x5c258d,_0x34354c(0x1f6))==!![]){let _0x3acc3d=[];if(!_0xdddc76){let _0xf0960c=[];_0x565149[_0x34354c(0x261)][_0x34354c(0x21f)]==0x1?_0xf0960c=dbSourceFolderTable[_0x34354c(0x1c8)](_0x565149['app']['dbOther'],_0x5c258d):_0xf0960c=dbUserTable['getUserPower'](_0x565149[_0x34354c(0x221)][_0x34354c(0x20d)],_0x565149[_0x34354c(0x261)][_0x34354c(0x1e5)],_0x5c258d);if(_0xf0960c)for(let _0x27bbbd=0x0;_0x27bbbd<_0xf0960c[_0x34354c(0x1d0)];_0x27bbbd++){_0x3acc3d[_0x34354c(0x202)]({'path':_0xf0960c[_0x27bbbd]['path'],'is_file':0x0,'filename':path[_0x34354c(0x1e0)](_0xf0960c[_0x27bbbd][_0x34354c(0x1fe)]),'root':!![]});}}else{let _0x13a1b7=[];if(_0x565149['currentUser'][_0x34354c(0x21f)]!=0x1){if(dbUserTable[_0x34354c(0x19e)](_0x565149,_0x14d591,_0x5c258d,'power_get',_0xdddc76)!==!![])return;}_0xdddc76=path['join'](_0xdddc76);let _0x23207b='\x20path=?\x20AND\x20';_0x13a1b7[_0x34354c(0x202)](_0xdddc76),_0x23207b+=_0x34354c(0x1fb);if(_0x3f6aa5){let _0x16dc83=_0x34354c(0x23b);_0x23207b+=_0x16dc83,_0x13a1b7['push']('%'+_0x3f6aa5+'%'),_0x13a1b7['push']('%'+_0x3f6aa5+'%');}let _0x711d4e=_0x34354c(0x1f8);_0x23207b+=_0x34354c(0x1e1)+_0x2387fd+'\x20'+_0x3a51e1,_0x3acc3d=_0x565149['app'][_0x34354c(0x1c6)]['prepare'](_0x34354c(0x1a5)+_0x711d4e+_0x34354c(0x255)+_0x23207b)[_0x34354c(0x237)](_0x13a1b7);}for(let _0x322493 of _0x3acc3d){_0x322493['favorite']=dbMusicFavorite['musicIsFavorite'](_0x565149[_0x34354c(0x221)][_0x34354c(0x1c6)],_0x322493['id'],_0x565149['currentUser']['id'])?'1':'0';}let _0x27498d=path[_0x34354c(0x240)],_0x32b665={'code':0x0,'data':_0x3acc3d,'sep':_0x27498d};return _0x14d591[_0x34354c(0x20c)](_0x32b665);}}),module[_0x5fcbe(0x1cf)]=router;