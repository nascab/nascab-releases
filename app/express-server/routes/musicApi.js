const _0xe5ce2d=_0x3b85;(function(_0x524fc7,_0x4e5cf6){const _0x29c48e=_0x3b85,_0x9e0fc6=_0x524fc7();while(!![]){try{const _0x6d98a0=-parseInt(_0x29c48e(0x150))/0x1+parseInt(_0x29c48e(0x1c5))/0x2+parseInt(_0x29c48e(0x1e0))/0x3*(-parseInt(_0x29c48e(0x1ef))/0x4)+-parseInt(_0x29c48e(0x1bd))/0x5+parseInt(_0x29c48e(0x19d))/0x6*(parseInt(_0x29c48e(0x14a))/0x7)+-parseInt(_0x29c48e(0x169))/0x8+parseInt(_0x29c48e(0x162))/0x9;if(_0x6d98a0===_0x4e5cf6)break;else _0x9e0fc6['push'](_0x9e0fc6['shift']());}catch(_0x1a7b19){_0x9e0fc6['push'](_0x9e0fc6['shift']());}}}(_0x5621,0xeaf74));let express=require(_0xe5ce2d(0x147)),router=express[_0xe5ce2d(0x1cf)](),config=require(_0xe5ce2d(0x1f9)),path=require(_0xe5ce2d(0x1ff)),fs=require('fs'),dbMusicIndexTable=require('../../db/dbMusicIndexTable'),dbFileIndexTable=require(_0xe5ce2d(0x1fc)),dbMusicPlaylistTable=require('../../db/dbMusicPlaylistTable'),dbMusicFavorite=require('../../db/dbMusicFavorite'),jsmediatags=require('jsmediatags');const dbUserTable=require('../../db/dbUserTable');let musicUitls=require(_0xe5ce2d(0x1b9)),lyricUtils=require(_0xe5ce2d(0x1e8)),sharpUtil=require(_0xe5ce2d(0x1f8));const dbSourceFolderTable=require(_0xe5ce2d(0x185));let axios=require('axios'),sha256=require(_0xe5ce2d(0x1d6)),os=require('os');const urlConfig=require(_0xe5ce2d(0x1c3));function getFavoriteMusicList(_0x3b21ec,_0x487f6d,_0x4f9a46,_0x38572f,_0x26729c,_0x4df7d3,_0x5b62b6){const _0x2c4289=_0xe5ce2d;let _0x338283='',_0x3bc2ea=[];_0x338283+=_0x2c4289(0x1a6);_0x4df7d3&&(_0x4df7d3=_0x4df7d3[_0x2c4289(0x1da)]('\x27','')['replace']('â€™',''),_0x338283+=_0x2c4289(0x152),_0x3bc2ea[_0x2c4289(0x148)]('%'+_0x4df7d3+'%','%'+_0x4df7d3+'%','%'+_0x4df7d3+'%'));_0x5b62b6&&(_0x338283+=_0x2c4289(0x19f),_0x3bc2ea[_0x2c4289(0x148)](_0x5b62b6,_0x5b62b6));if(_0x38572f&&_0x26729c){if(_0x38572f=='artist')_0x338283+=_0x2c4289(0x1a8)+_0x26729c+_0x2c4289(0x179)+_0x26729c+'\x20';else{if(_0x38572f==_0x2c4289(0x1bb))_0x338283+=_0x2c4289(0x1f6)+_0x26729c+_0x2c4289(0x165)+_0x26729c+'\x20';else{if(_0x38572f==_0x2c4289(0x1ba))_0x338283+=_0x2c4289(0x166)+_0x26729c+_0x2c4289(0x1ad)+_0x26729c+',f.filename_fl\x20'+_0x26729c+'\x20';else _0x38572f==_0x2c4289(0x1c0)?_0x338283+=_0x2c4289(0x1cc)+_0x26729c+'\x20':_0x338283+=_0x2c4289(0x1fe)+_0x38572f+'\x20'+_0x26729c+'\x20';}}}else _0x338283+=_0x2c4289(0x197);return _0x338283+=_0x2c4289(0x178),_0x3bc2ea[_0x2c4289(0x148)](_0x487f6d),_0x3bc2ea[_0x2c4289(0x148)](_0x4f9a46),result=dbMusicFavorite[_0x2c4289(0x1f1)](_0x3b21ec[_0x2c4289(0x1b6)][_0x2c4289(0x196)],_0x3b21ec[_0x2c4289(0x193)]['id'],_0x338283,'*',_0x3bc2ea),result=dealMusicList(_0x3b21ec,result),result;}function dealMusicList(_0x427ac4,_0x1d54ad){const _0x2f7f9b=_0xe5ce2d;for(let _0x2ebb02 of _0x1d54ad){_0x2ebb02[_0x2f7f9b(0x1c8)]=dbMusicFavorite[_0x2f7f9b(0x15d)](_0x427ac4[_0x2f7f9b(0x1b6)][_0x2f7f9b(0x196)],_0x2ebb02['id'],_0x427ac4[_0x2f7f9b(0x193)]['id'])?'1':'0';if(!_0x2ebb02['cover_path']){let _0x5747b8=!![];_0x2ebb02[_0x2f7f9b(0x1b2)]&&fs[_0x2f7f9b(0x191)](_0x2ebb02[_0x2f7f9b(0x1b2)])&&(_0x5747b8=![]),_0x5747b8&&(_0x2ebb02[_0x2f7f9b(0x1b2)]=musicUitls[_0x2f7f9b(0x170)](_0x427ac4['app'][_0x2f7f9b(0x196)],_0x2ebb02));}_0x2ebb02[_0x2f7f9b(0x1d9)]=path[_0x2f7f9b(0x14b)](_0x2ebb02['path'],_0x2ebb02[_0x2f7f9b(0x1e3)]),delete _0x2ebb02[_0x2f7f9b(0x1ff)];}return _0x1d54ad;}function getMusicListByParams(_0x34dd44,_0x1c8f8b,_0x296855,_0x2c1b71,_0x66a98f,_0x25edf2,_0x402ac0,_0x28a090,_0x5e8f0c,_0x3f9524,_0x57aef8,_0x100f35,_0x288485){const _0x209622=_0xe5ce2d;let _0x42f20f=_0x34dd44[_0x209622(0x1b6)][_0x209622(0x196)],_0x4a63f5=[];return _0x4a63f5=dbMusicIndexTable[_0x209622(0x19c)](_0x42f20f,_0x1c8f8b,_0x296855,_0x2c1b71,_0x66a98f,_0x25edf2,_0x402ac0,_0x28a090,_0x5e8f0c,_0x3f9524,_0x100f35,_0x57aef8,_0x288485),_0x4a63f5=dealMusicList(_0x34dd44,_0x4a63f5),_0x4a63f5;}router[_0xe5ce2d(0x1d7)](_0xe5ce2d(0x1d4),(_0x4845ed,_0x4b23d5,_0x732057)=>{const _0x5049ef=_0xe5ce2d;let _0x4fa6cc=_0x4845ed[_0x5049ef(0x1b6)][_0x5049ef(0x196)],_0x367ffd=_0x4845ed['body'][_0x5049ef(0x1d2)]?_0x4845ed[_0x5049ef(0x1c6)][_0x5049ef(0x1d2)]:0xc,_0x25d0d5=_0x4845ed['body'][_0x5049ef(0x1c2)]?_0x4845ed['body']['albumCount']:0xc,_0x135e56=dbUserTable[_0x5049ef(0x1d0)](_0x4845ed,_0x5049ef(0x1e7),_0x5049ef(0x1b8),!![]);if(_0x4845ed[_0x5049ef(0x193)][_0x5049ef(0x19a)]!=0x1&&!_0x135e56[_0x5049ef(0x200)])return _0x4b23d5[_0x5049ef(0x17a)]({'code':0x0,'data':null});let _0x30a115=getMusicListByParams(_0x4845ed,_0x135e56,_0x367ffd,0x0,'last_play_time','desc'),_0x222914=getMusicListByParams(_0x4845ed,_0x135e56,_0x367ffd,0x0,_0x5049ef(0x14e),_0x5049ef(0x1b4)),_0x50f422=getMusicListByParams(_0x4845ed,_0x135e56,_0x367ffd,0x0,'id',_0x5049ef(0x14f)),_0x244e0a=dbMusicIndexTable['getGroupList'](_0x4fa6cc,_0x135e56,_0x5049ef(0x1aa),_0x25d0d5,0x0,'last_play_time',_0x5049ef(0x14f));for(let _0x440a00 of _0x244e0a){let _0x244e0e=_0x5049ef(0x174)+_0x135e56['whereStr'],_0x298660=[_0x440a00['artist'],..._0x135e56[_0x5049ef(0x161)]];_0x440a00['coverList']=dbMusicIndexTable[_0x5049ef(0x1a7)](_0x4845ed[_0x5049ef(0x1b6)]['dbFileIndex'],_0x244e0e,_0x298660);}let _0x13a3bb=dbMusicIndexTable[_0x5049ef(0x1f7)](_0x4fa6cc,_0x135e56,_0x5049ef(0x1bb),_0x25d0d5,0x0,'play_count',_0x5049ef(0x14f));for(let _0x19d499 of _0x13a3bb){let _0x7aaea1=_0x5049ef(0x15f)+_0x135e56[_0x5049ef(0x200)],_0x50c4f9=[_0x19d499[_0x5049ef(0x1bb)],..._0x135e56[_0x5049ef(0x161)]];_0x19d499[_0x5049ef(0x15e)]=dbMusicIndexTable[_0x5049ef(0x1a7)](_0x4845ed[_0x5049ef(0x1b6)][_0x5049ef(0x196)],_0x7aaea1,_0x50c4f9);}let _0x214e44={};return _0x30a115&&_0x30a115['length']>0x0&&(_0x214e44[_0x5049ef(0x189)]=_0x30a115),_0x222914&&_0x222914[_0x5049ef(0x202)]>0x0&&(_0x214e44['maxPlayMusic']=_0x222914),_0x50f422&&_0x50f422[_0x5049ef(0x202)]>0x0&&(_0x214e44[_0x5049ef(0x175)]=_0x50f422),_0x244e0a&&_0x244e0a[_0x5049ef(0x202)]>0x0&&(_0x214e44['artistList']=_0x244e0a),_0x13a3bb&&_0x13a3bb[_0x5049ef(0x202)]>0x0&&(_0x214e44[_0x5049ef(0x1b1)]=_0x13a3bb),_0x4b23d5[_0x5049ef(0x17a)]({'code':0x0,'data':_0x214e44,'platform':os['platform']()});}),router[_0xe5ce2d(0x1d7)](_0xe5ce2d(0x1ac),(_0x501207,_0xa4763d,_0x2f1a6c)=>{const _0x312a2d=_0xe5ce2d;let _0x39322a=_0x501207['body'][_0x312a2d(0x1d2)]||0x32,_0x1356c1=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x1be)]||0x0,_0x3438bc=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x1bb)],_0xac47d4=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x1a9)],_0x1a7c40=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x1aa)],_0x293556=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x186)],_0x282f44=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x190)]||_0x312a2d(0x18e),_0x2c0f4a=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x1a3)]||'desc',_0x55809d=[_0x312a2d(0x181),_0x312a2d(0x1c8),_0x312a2d(0x1cd)],_0x5d1dd8=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x1e5)]||'list',_0x468e72=_0x501207[_0x312a2d(0x1c6)]['search'],_0x3ea372=_0x501207[_0x312a2d(0x1c6)][_0x312a2d(0x14c)],_0x1c7b6f=_0x501207['body']['playlistId'];if(dbMusicIndexTable[_0x312a2d(0x14d)](_0x501207,_0xa4763d,_0x282f44,_0x2c0f4a)!==!![])return;if(_0x5d1dd8==_0x312a2d(0x1cd)){if(!_0x1c7b6f)return _0x501207['app'][_0x312a2d(0x154)](_0xa4763d,_0x312a2d(0x1bc));}!_0x55809d['includes'](_0x5d1dd8)&&(_0x5d1dd8='list');_0x39322a>0x1f4&&(_0x39322a=0x1f4);let _0x6678c4=dbUserTable[_0x312a2d(0x1d0)](_0x501207,'music','power_get',!![]);if(_0x501207[_0x312a2d(0x193)]['is_admin']!=0x1&&!_0x6678c4[_0x312a2d(0x200)])return _0xa4763d[_0x312a2d(0x17a)]({'code':0x0,'data':null});let _0x21b404=[];if(_0x5d1dd8==_0x312a2d(0x1cd)||_0x5d1dd8=='list')_0x21b404=getMusicListByParams(_0x501207,_0x6678c4,_0x39322a,_0x1356c1,_0x282f44,_0x2c0f4a,_0x3438bc,_0xac47d4,_0x1a7c40,_0x293556,_0x468e72,_0x1c7b6f,_0x3ea372);else _0x5d1dd8=='favorite'&&(_0x21b404=getFavoriteMusicList(_0x501207,_0x39322a,_0x1356c1,_0x282f44,_0x2c0f4a,_0x468e72,_0x3ea372));let _0x3aee77={'code':0x0,'data':_0x21b404};if(_0x5d1dd8=='favorite')_0x3aee77[_0x312a2d(0x1ee)]=dbMusicFavorite['getFavoriteCount'](_0x501207[_0x312a2d(0x1b6)]['dbFileIndex'],_0x501207[_0x312a2d(0x193)]['id']);else{if(_0x5d1dd8==_0x312a2d(0x181))_0x3aee77[_0x312a2d(0x1ee)]=dbMusicIndexTable['getMusicListCount'](_0x501207[_0x312a2d(0x1b6)][_0x312a2d(0x196)],_0x6678c4,_0x3438bc,_0xac47d4,_0x1a7c40,_0x293556);else _0x5d1dd8==_0x312a2d(0x1cd)&&(_0x3aee77[_0x312a2d(0x1ee)]=dbMusicPlaylistTable[_0x312a2d(0x183)](_0x501207[_0x312a2d(0x1b6)][_0x312a2d(0x196)],_0x1c7b6f));}return _0xa4763d['json'](_0x3aee77);}),router[_0xe5ce2d(0x1d7)](_0xe5ce2d(0x1fb),(_0x18474f,_0x3083a2,_0x4300a4)=>{const _0x99be43=_0xe5ce2d;let _0x5cac35=_0x18474f[_0x99be43(0x1c6)]['id'],_0x50e57c=dbFileIndexTable[_0x99be43(0x1b7)](_0x18474f[_0x99be43(0x1b6)]['dbFileIndex'],_0x5cac35,dbFileIndexTable[_0x99be43(0x1d8)]);if(!_0x50e57c)return _0x18474f['app']['returnErrMsg'](_0x3083a2,'NO\x20MUSIC\x20INDEX');if(dbUserTable[_0x99be43(0x1ed)](_0x18474f,_0x3083a2,_0x99be43(0x1e7),_0x99be43(0x1b8),_0x50e57c[_0x99be43(0x1ff)])==!![]){let _0x529f65=_0x18474f[_0x99be43(0x193)]['id'],_0x3fd372=dbMusicFavorite[_0x99be43(0x1a0)](_0x18474f[_0x99be43(0x1b6)][_0x99be43(0x196)],_0x529f65,_0x5cac35);_0x50e57c[_0x99be43(0x1b2)]=musicUitls[_0x99be43(0x170)](_0x18474f[_0x99be43(0x1b6)][_0x99be43(0x196)],_0x50e57c),_0x50e57c['favorite']=_0x3fd372?0x1:0x0,getLyrics(_0x50e57c,_0x2bb74f=>{return _0x50e57c['lyricList']=_0x2bb74f,_0x3083a2['json']({'code':0x0,'data':_0x50e57c});});}});function updateIndexLyric(_0x46cda5,_0x4c4d70,_0x4ba23b,_0x14f842){const _0x20c96c=_0xe5ce2d;if(_0x4ba23b&&_0x4ba23b['length']>0x0){let _0x44bb2c=_0x14f842[_0x20c96c(0x1e3)][_0x20c96c(0x1da)](path[_0x20c96c(0x163)](_0x14f842[_0x20c96c(0x1e3)]),''),_0xd6a944=_0x44bb2c+_0x20c96c(0x19e),_0xf3bd7=path['join'](_0x14f842[_0x20c96c(0x1ff)],_0xd6a944);fs[_0x20c96c(0x1af)](_0xf3bd7,_0x4ba23b,_0x20c96c(0x1de),_0xd31c94=>{if(!_0xd31c94){}});}let _0x41ebf9=JSON[_0x20c96c(0x146)]({'lyrics':_0x4ba23b?_0x4ba23b:''});_0x46cda5[_0x20c96c(0x1c7)](_0x20c96c(0x1bf))[_0x20c96c(0x195)](_0x4c4d70,_0x41ebf9,_0x14f842['id']);}router[_0xe5ce2d(0x1d7)](_0xe5ce2d(0x1c4),(_0x156f11,_0xe4e501,_0x2c2ee2)=>{const _0x442df2=_0xe5ce2d;let _0xaafcb=_0x156f11[_0x442df2(0x1c6)]['id'],_0x4ac6f1=_0x156f11[_0x442df2(0x1c6)][_0x442df2(0x1dd)],_0x21bebc=dbFileIndexTable[_0x442df2(0x1b7)](_0x156f11[_0x442df2(0x1b6)][_0x442df2(0x196)],_0xaafcb,dbFileIndexTable[_0x442df2(0x1d8)]);if(!_0x21bebc)return _0x156f11[_0x442df2(0x1b6)][_0x442df2(0x154)](_0xe4e501,_0x442df2(0x1f3));if(!_0x4ac6f1)return _0x156f11[_0x442df2(0x1b6)]['returnErrMsg'](_0xe4e501,_0x442df2(0x1d3));if(dbUserTable['doUserCanGet'](_0x156f11,_0xe4e501,_0x442df2(0x1e7),_0x442df2(0x1ae),_0x21bebc['path'])==!![])return updateIndexLyric(_0x156f11[_0x442df2(0x1b6)][_0x442df2(0x196)],0x1,_0x4ac6f1,_0x21bebc),_0xe4e501[_0x442df2(0x17a)]({'code':0x0});}),router[_0xe5ce2d(0x1d7)]('/searchLyric',(_0x2a5d20,_0x2f4cf8,_0x2005f3)=>{const _0x2616b2=_0xe5ce2d;let _0x271051=_0x2a5d20[_0x2616b2(0x1c6)]['id'],_0x305675=dbFileIndexTable[_0x2616b2(0x1b7)](_0x2a5d20[_0x2616b2(0x1b6)][_0x2616b2(0x196)],_0x271051,dbFileIndexTable[_0x2616b2(0x1d8)]);if(!_0x305675)return _0x2a5d20['app'][_0x2616b2(0x154)](_0x2f4cf8,_0x2616b2(0x1f3));let _0x4ab403=_0x2a5d20['body'][_0x2616b2(0x1d5)],_0x116955=_0x2a5d20[_0x2616b2(0x1c6)][_0x2616b2(0x153)],_0x3a105b=_0x2a5d20[_0x2616b2(0x1c6)][_0x2616b2(0x157)],_0x51e0f1=_0x2a5d20[_0x2616b2(0x1c6)]['isSearch'];if(dbUserTable['doUserCanGet'](_0x2a5d20,_0x2f4cf8,_0x2616b2(0x1e7),'power_get',_0x305675['path'])==!![]){if(_0x305675['lyrics_get_state']==0x1&&!_0x51e0f1)return _0x2f4cf8[_0x2616b2(0x17a)]({'code':0x0,'data':[_0x305675[_0x2616b2(0x1b0)]]});let _0x1d7dd4=_0x2a5d20['body'][_0x2616b2(0x159)]||0x0;if(!_0x4ab403||!_0x4ab403[_0x2616b2(0x15a)]())return _0x2f4cf8['json']([]);let _0x2c7e7a={'searchMusicName':_0x4ab403,'searchMusicArtist':_0x116955,'searchMusicAlbum':_0x3a105b,'isSearch':_0x51e0f1,'skipCount':_0x1d7dd4,'token':sha256(_0x4ab403+config['apiTokenKey'])};lyricUtils[_0x2616b2(0x1d1)](_0x2c7e7a)[_0x2616b2(0x17c)](_0x32ec08=>{const _0x35a306=_0x2616b2;if(_0x32ec08){if(_0x32ec08[_0x35a306(0x202)]>0x0&&!_0x51e0f1){let _0xa36549=![],_0x33d9ac=0x14,_0x17bc12=0x64,_0x39527f=null;for(let _0x3dedb5 of _0x32ec08){if(_0x3dedb5[_0x35a306(0x15b)]){let _0x4f6fa4=_0x3dedb5[_0x35a306(0x15b)]/0x3e8,_0x633678=Math['abs'](_0x4f6fa4-_0x305675[_0x35a306(0x15b)]);_0x633678<_0x17bc12&&(_0x17bc12=_0x633678,_0x39527f=_0x3dedb5[_0x35a306(0x155)]?_0x3dedb5['lrc']:'');}}return _0x17bc12<_0x33d9ac?(_0xa36549=!![],_0x305675[_0x35a306(0x1b0)]=JSON[_0x35a306(0x146)]({'lyrics':_0x39527f?_0x39527f:''}),updateIndexLyric(_0x2a5d20[_0x35a306(0x1b6)][_0x35a306(0x196)],0x1,_0x39527f,_0x305675)):updateIndexLyric(_0x2a5d20['app'][_0x35a306(0x196)],0x1,'',_0x305675),_0x2f4cf8['json']({'code':0x0,'data':_0xa36549&&_0x305675[_0x35a306(0x1b0)]?[_0x305675['lyrics']]:[]});}else return _0x2f4cf8[_0x35a306(0x17a)]({'code':0x0,'data':_0x32ec08});}})[_0x2616b2(0x1fa)](_0x468242=>{const _0xcecab8=_0x2616b2;return _0x2a5d20[_0xcecab8(0x1b6)][_0xcecab8(0x154)](_0x2f4cf8,_0x468242[_0xcecab8(0x1fd)]);});}});function getLyrics(_0x5bb76c,_0x53009a){const _0xdefa6e=_0xe5ce2d;let _0x392136=[];try{_0x5bb76c[_0xdefa6e(0x1b0)]&&_0x5bb76c[_0xdefa6e(0x1b0)]['length']>0xa&&_0x392136['push']({'type':'inner','content':_0x5bb76c[_0xdefa6e(0x1b0)]});let _0x2cb2aa=_0x5bb76c['filename'][_0xdefa6e(0x1da)](path[_0xdefa6e(0x163)](_0x5bb76c[_0xdefa6e(0x1e3)]),''),_0x1bf2f1=_0x2cb2aa+'.lrc',_0x5d035b=path[_0xdefa6e(0x14b)](_0x5bb76c[_0xdefa6e(0x1ff)],_0x1bf2f1);fs[_0xdefa6e(0x191)](_0x5d035b)?fs[_0xdefa6e(0x16c)](_0x5d035b,(_0x82723f,_0xba80d)=>{const _0x5cdda5=_0xdefa6e;let _0x1a094c=musicUitls['transStringToUtf8'](_0xba80d['toString'](),_0x5d035b);_0x392136[_0x5cdda5(0x148)]({'type':_0x5cdda5(0x192),'filename':_0x1bf2f1,'content':_0x1a094c}),_0x53009a(_0x392136);}):_0x53009a(_0x392136);}catch(_0x241b87){console[_0xdefa6e(0x1b3)](_0x241b87),_0x53009a(_0x392136);}}function _0x5621(){const _0x24204e=['playlistId','searchMusicAlbum','read','skipCount','trim','duration','/musicFavorite','musicIsFavorite','coverList','\x20AND\x20album=?\x20','\x20(type=3\x20OR\x20is_file=0)','paramsList','40140270AlksfZ','extname','/getGroupList',',f.album\x20','\x20order\x20by\x20f.title_fl\x20','addFavorite','musicIndexId','12525168iXmASt','get','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','readFile','genTinyFile','SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','name','getMusicSameNameCover','temp.','operation','removePlaylist','\x20AND\x20artist=?\x20','recentAddList','\x20path=?\x20AND\x20','need\x20\x27name\x27','\x20LIMIT\x20?\x20OFFSET\x20?\x20',',f.artist\x20','json','picture','then','=?\x20','getPlaylistList','includes','/getMusicCover','list','APIC','getPlaylistMusicCount','\x20AND\x20','../../db/dbSourceFolderTable','genre','operation\x20error','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','recentMusic','updatePlaylist','parent','dirname','getUserPower','last_play_time','tags','orderField','existsSync','file','currentUser','is_file','run','dbFileIndex','\x20order\x20by\x20m.update_time\x20DESC\x20','all','birthtime','is_admin','/operationPlaylist','getMusicList','27582GQJIgi','.lrc','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','getFavorite','orderField/orderType\x20error','searchStr','orderType','playlistId\x20no\x20exists','edit','\x20is_file=1','getCoverByField','\x20order\x20by\x20f.artist_fl\x20','year','artist','SELECT\x20','/getMusicList',',f.title\x20','power_add','writeFile','lyrics','albumList','file_cover_path','log',',id\x20asc','getPathByType','app','getById','power_get','../../utils/musicUtil','title','album','need\x20playlistId','7795435rYQyvl','offset','UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?','favorite_time','sep','albumCount','../../myConfig/urlConfig','/saveLyric','3756136zEZLHG','body','prepare','favorite','base64','delete','\x20FROM\x20file_index_music\x20WHERE\x20','\x20order\x20by\x20m.update_time\x20','playlist','data','Router','getUserPathWhere','searchLyric','count','Lyric\x20is\x20null','/getMusicHomeData','searchMusicName','sha256','post','INDEX_TABLE_NAME_MUSIC','filePath','replace','cover_path','groupField','lyric','utf-8','add','21nasYyW','status','end','filename','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre','listType','getMusicIndex','music','../../utils/music/lyricUtils','ORDER\x20BY\x20','dbOther','from','size','doUserCanGet','music_count','944848gQErmH','check_time','getAllFavoriteByWhere','username','NO\x20MUSIC\x20INDEX','play_count','uid','\x20order\x20by\x20f.album_fl\x20','getGroupList','../utils/sharpUtils','../../myConfig/config','catch','/getMusicDetail','../../db/dbFileIndexTable','message','\x20order\x20by\x20f.','path','whereStr','getPlaylistCover','length','asc','query','/operationPlaylistIndex','stringify','express','push','exports','294zPiIWQ','join','letterIndex','checkOrderParams','play_count\x20desc','desc','790535kYqbJu','createPlaylist','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','searchMusicArtist','returnErrMsg','lrc'];_0x5621=function(){return _0x24204e;};return _0x5621();}function _0x3b85(_0x4789d0,_0x14e894){const _0x562169=_0x5621();return _0x3b85=function(_0x3b8524,_0x2499b3){_0x3b8524=_0x3b8524-0x144;let _0x2b1338=_0x562169[_0x3b8524];return _0x2b1338;},_0x3b85(_0x4789d0,_0x14e894);}router[_0xe5ce2d(0x1d7)](_0xe5ce2d(0x15c),(_0x5bf48e,_0x18ff00,_0x2e9fbd)=>{const _0x3f8ebe=_0xe5ce2d;let _0x4cbfdc=_0x5bf48e['currentUser']['id'];function _0x2d266c(_0xf5eafd){const _0x41167d=_0x3b85;let _0x15ab76=dbFileIndexTable[_0x41167d(0x1b7)](_0x5bf48e[_0x41167d(0x1b6)][_0x41167d(0x196)],_0xf5eafd,dbFileIndexTable[_0x41167d(0x1d8)]);if(!_0x15ab76)return;let _0xc1a9e5=new Date()['getTime']();_0x5bf48e[_0x41167d(0x1b6)][_0x41167d(0x196)][_0x41167d(0x1c7)](_0x41167d(0x188))[_0x41167d(0x195)](_0xc1a9e5,_0xf5eafd),dbMusicFavorite[_0x41167d(0x167)](_0x5bf48e[_0x41167d(0x1b6)][_0x41167d(0x196)],_0x4cbfdc,_0xf5eafd);}if(_0x5bf48e[_0x3f8ebe(0x1c6)]['musicIndexId']instanceof Array){let _0x2080ac=_0x5bf48e[_0x3f8ebe(0x1c6)][_0x3f8ebe(0x172)];if(_0x2080ac=='add')for(let _0x36ba61 of _0x5bf48e['body'][_0x3f8ebe(0x168)]){_0x2d266c(_0x36ba61);}else{if(_0x2080ac==_0x3f8ebe(0x1ca))for(let _0x45c4ac of _0x5bf48e[_0x3f8ebe(0x1c6)][_0x3f8ebe(0x168)]){dbMusicFavorite['deleteFavorite'](_0x5bf48e[_0x3f8ebe(0x1b6)][_0x3f8ebe(0x196)],_0x4cbfdc,_0x45c4ac);}}return _0x18ff00[_0x3f8ebe(0x17a)]({'code':0x0});}else{let _0x5464b6=parseInt(_0x5bf48e[_0x3f8ebe(0x1c6)][_0x3f8ebe(0x168)]),_0x342cae=dbMusicFavorite[_0x3f8ebe(0x1a0)](_0x5bf48e['app'][_0x3f8ebe(0x196)],_0x4cbfdc,_0x5464b6),_0xc6d583=0x0;return _0x342cae?dbMusicFavorite['deleteFavorite'](_0x5bf48e[_0x3f8ebe(0x1b6)]['dbFileIndex'],_0x4cbfdc,_0x5464b6):(_0xc6d583=0x1,_0x2d266c(_0x5464b6)),_0x18ff00['json']({'code':0x0,'favorite':_0xc6d583});}}),router[_0xe5ce2d(0x16a)](_0xe5ce2d(0x180),(_0x3f4466,_0x2ef571,_0x39ea11)=>{const _0x58fbe9=_0xe5ce2d;let _0x6c8e36=_0x3f4466[_0x58fbe9(0x144)]['indexId'],_0x230ec4=dbMusicIndexTable[_0x58fbe9(0x1e6)](_0x3f4466[_0x58fbe9(0x1b6)][_0x58fbe9(0x196)],_0x6c8e36),_0xac9cbe=_0x3f4466[_0x58fbe9(0x144)][_0x58fbe9(0x1ec)];!_0xac9cbe&&(_0xac9cbe=0x200);if(!_0x230ec4||_0x230ec4&&!_0x230ec4[_0x58fbe9(0x1db)])return _0x2ef571[_0x58fbe9(0x1e1)](0x194)['end']();if(dbUserTable[_0x58fbe9(0x1ed)](_0x3f4466,_0x2ef571,'music',_0x58fbe9(0x1b8),_0x230ec4[_0x58fbe9(0x1ff)])==!![]){let _0x276c77=path['join'](_0x230ec4[_0x58fbe9(0x1ff)],_0x230ec4['filename']),_0x4ff4f4=config['getMediaCoverCachePath'](_0x230ec4,_0xac9cbe);if(fs[_0x58fbe9(0x191)](_0x4ff4f4))return _0x2ef571['sendFile'](_0x4ff4f4);jsmediatags[_0x58fbe9(0x158)](_0x276c77,{'onSuccess':function(_0x360183){const _0x43d331=_0x58fbe9;let _0x3cdda9=_0x360183[_0x43d331(0x18f)];var _0x26c4cb;_0x3cdda9[_0x43d331(0x17b)]&&_0x3cdda9['picture'][_0x43d331(0x1ce)]&&(_0x26c4cb=_0x3cdda9[_0x43d331(0x17b)][_0x43d331(0x1ce)]);!_0x26c4cb&&_0x3cdda9[_0x43d331(0x182)]&&_0x3cdda9['APIC'][_0x43d331(0x1ce)]&&_0x3cdda9['APIC'][_0x43d331(0x1ce)]['data']&&(_0x26c4cb=_0x3cdda9[_0x43d331(0x182)]['data']['data']);if(_0x26c4cb){let _0x13bed1=path[_0x43d331(0x14b)](path[_0x43d331(0x18c)](_0x4ff4f4),_0x43d331(0x171)+path['basename'](_0x4ff4f4));fs['writeFile'](_0x13bed1,Buffer[_0x43d331(0x1eb)](_0x26c4cb),{'encoding':_0x43d331(0x1c9)},function(_0x1f13fd){const _0x258896=_0x43d331;if(!_0x1f13fd)sharpUtil[_0x258896(0x16d)](_0x13bed1,path[_0x258896(0x18c)](_0x4ff4f4),path['basename'](_0x4ff4f4),'image',null,_0x4b6540=>{const _0x2c6792=_0x258896;return dbMusicIndexTable['updateByFiled'](_0x3f4466[_0x2c6792(0x1b6)][_0x2c6792(0x196)],_0x230ec4['id'],_0x2c6792(0x1db),_0x4ff4f4),fs['rm'](_0x13bed1,_0xec680f=>{}),_0x2ef571['sendFile'](_0x4ff4f4);},_0x45153e=>{const _0x38bde2=_0x258896;return _0x2ef571[_0x38bde2(0x1e1)](0x194)[_0x38bde2(0x1e2)]();},_0xac9cbe);else return _0x2ef571[_0x258896(0x1e1)](0x194)[_0x258896(0x1e2)]();});}else return _0x2ef571[_0x43d331(0x1e1)](0x194)[_0x43d331(0x1e2)]();},'onError':function(_0x5130ab){const _0x5c037d=_0x58fbe9;return _0x2ef571[_0x5c037d(0x1e1)](0x194)[_0x5c037d(0x1e2)]();}});}}),router[_0xe5ce2d(0x1d7)](_0xe5ce2d(0x164),(_0xdcc306,_0x501092,_0x5cbf34)=>{const _0x4ff134=_0xe5ce2d;let _0x2bf6a3=_0xdcc306[_0x4ff134(0x1c6)][_0x4ff134(0x1d2)]||0x32,_0x237221=_0xdcc306[_0x4ff134(0x1c6)][_0x4ff134(0x1be)]||0x0,_0x5897d7=_0xdcc306[_0x4ff134(0x1c6)][_0x4ff134(0x1dc)]||_0x4ff134(0x1bb),_0x1c96f9=_0xdcc306[_0x4ff134(0x1c6)][_0x4ff134(0x190)]||_0x4ff134(0x1f0),_0x1a470f=_0xdcc306[_0x4ff134(0x1c6)][_0x4ff134(0x1a3)]||'desc',_0x1f450a=_0xdcc306[_0x4ff134(0x1c6)]['search'],_0x59db4d=_0xdcc306[_0x4ff134(0x1c6)][_0x4ff134(0x14c)];if(dbMusicIndexTable[_0x4ff134(0x14d)](_0xdcc306,_0x501092,_0x1c96f9,_0x1a470f)!==!![])return;let _0x19d67e=[_0x4ff134(0x1f0),_0x4ff134(0x1f4),_0x4ff134(0x18e),'filename','title',_0x4ff134(0x1bb),_0x4ff134(0x1aa),_0x4ff134(0x199),'id'],_0x6c319a=['asc',_0x4ff134(0x14f)];if(!_0x19d67e[_0x4ff134(0x17f)](_0x1c96f9)||!_0x6c319a[_0x4ff134(0x17f)](_0x1a470f))return _0xdcc306['app']['returnErrMsg'](_0x501092,_0x4ff134(0x1a1),_0x1c96f9,_0x1a470f);let _0x5feb8b=dbUserTable[_0x4ff134(0x1d0)](_0xdcc306,_0x4ff134(0x1e7),_0x4ff134(0x1b8),!![]);if(_0xdcc306['currentUser'][_0x4ff134(0x19a)]!=0x1&&!_0x5feb8b['whereStr']&&_0x5897d7!='playlist')return _0x501092[_0x4ff134(0x17a)]({'code':0x0,'data':null});let _0x194dab=[];if(_0x5897d7==_0x4ff134(0x1bb)||_0x5897d7==_0x4ff134(0x1aa)){_0x194dab=dbMusicIndexTable[_0x4ff134(0x1f7)](_0xdcc306['app'][_0x4ff134(0x196)],_0x5feb8b,_0x5897d7,_0x2bf6a3,_0x237221,_0x1c96f9,_0x1a470f,_0x1f450a,_0x59db4d);for(let _0x21ef15 of _0x194dab){let _0x1ee8e0=_0x4ff134(0x184)+_0x5897d7+_0x4ff134(0x17d)+_0x5feb8b[_0x4ff134(0x200)],_0x53cbae=[_0x5897d7,..._0x5feb8b[_0x4ff134(0x161)]];_0x21ef15[_0x4ff134(0x15e)]=dbMusicIndexTable[_0x4ff134(0x1a7)](_0xdcc306[_0x4ff134(0x1b6)][_0x4ff134(0x196)],_0x1ee8e0,_0x53cbae);}}else{if(_0x5897d7==_0x4ff134(0x1cd)){_0x194dab=dbMusicPlaylistTable[_0x4ff134(0x17e)](_0xdcc306['app'][_0x4ff134(0x196)],_0xdcc306[_0x4ff134(0x193)]['id'],_0x2bf6a3,_0x237221,'id','desc',_0x1f450a);for(let _0x2b28be of _0x194dab){_0x2b28be[_0x4ff134(0x15e)]=dbMusicIndexTable[_0x4ff134(0x201)](_0xdcc306[_0x4ff134(0x1b6)][_0x4ff134(0x196)],_0x2b28be['id']);}}}return _0x501092[_0x4ff134(0x17a)]({'code':0x0,'data':_0x194dab});}),router['post'](_0xe5ce2d(0x19b),(_0x32bc89,_0x51cb3a,_0x33451f)=>{const _0xe0c6e3=_0xe5ce2d;let _0x1fee6e=_0x32bc89[_0xe0c6e3(0x1c6)][_0xe0c6e3(0x16f)],_0xb20369=_0x32bc89['body']['operation'];if(_0xb20369==_0xe0c6e3(0x1df)){if(!_0x1fee6e)return _0x32bc89[_0xe0c6e3(0x1b6)][_0xe0c6e3(0x154)](_0x51cb3a,_0xe0c6e3(0x177));dbMusicPlaylistTable[_0xe0c6e3(0x151)](_0x32bc89['app'][_0xe0c6e3(0x196)],_0x32bc89[_0xe0c6e3(0x193)]['id'],_0x1fee6e);}else{if(_0xb20369=='edit'||_0xb20369==_0xe0c6e3(0x1ca)){let _0x1db077=_0x32bc89['body']['playlistId'],_0x197845=dbMusicPlaylistTable['getPlaylistById'](_0x32bc89[_0xe0c6e3(0x1b6)]['dbFileIndex'],_0x1db077),_0x301fc4=![];(_0x32bc89[_0xe0c6e3(0x193)][_0xe0c6e3(0x19a)]==0x1||_0x197845[_0xe0c6e3(0x1f5)]==_0x32bc89[_0xe0c6e3(0x193)]['id'])&&(_0x301fc4=!![]);if(!_0x301fc4)return _0x51cb3a['json']({'code':0x66});if(_0xb20369==_0xe0c6e3(0x1ca))dbMusicPlaylistTable[_0xe0c6e3(0x173)](_0x32bc89['app'][_0xe0c6e3(0x196)],_0x1db077);else{if(_0xb20369==_0xe0c6e3(0x1a5)){if(!_0x1fee6e)return _0x32bc89['app'][_0xe0c6e3(0x154)](_0x51cb3a,_0xe0c6e3(0x177));dbMusicPlaylistTable[_0xe0c6e3(0x18a)](_0x32bc89[_0xe0c6e3(0x1b6)][_0xe0c6e3(0x196)],_0x1db077,_0x1fee6e);}}}else return _0x32bc89['app'][_0xe0c6e3(0x154)](_0x51cb3a,_0xe0c6e3(0x187));}return _0x51cb3a[_0xe0c6e3(0x17a)]({'code':0x0});}),router['post'](_0xe5ce2d(0x145),(_0x1f968b,_0x33f42d,_0x3c58c4)=>{const _0x2ed457=_0xe5ce2d;let _0x3c27d9=_0x1f968b['body'][_0x2ed457(0x168)],_0x3e4056=_0x1f968b[_0x2ed457(0x1c6)][_0x2ed457(0x156)];if(!_0x3c27d9||!_0x3e4056)return _0x1f968b[_0x2ed457(0x1b6)][_0x2ed457(0x154)](_0x33f42d,'need\x20musicIndexId\x20and\x20playlistId');let _0x340246=dbMusicPlaylistTable['getPlaylistById'](_0x1f968b[_0x2ed457(0x1b6)][_0x2ed457(0x196)],_0x3e4056);if(!_0x340246)return _0x1f968b[_0x2ed457(0x1b6)][_0x2ed457(0x154)](_0x33f42d,_0x2ed457(0x1a4));let _0x3d72e0=_0x1f968b[_0x2ed457(0x1c6)][_0x2ed457(0x172)];if(_0x3d72e0==_0x2ed457(0x1df)){function _0x35932d(_0x14dc17){const _0x1303ad=_0x2ed457;let _0x6062e9=dbMusicIndexTable[_0x1303ad(0x1e6)](_0x1f968b[_0x1303ad(0x1b6)]['dbFileIndex'],_0x14dc17);if(!_0x6062e9)return;if(_0x6062e9[_0x1303ad(0x194)]==0x1){dbMusicPlaylistTable['addMusicToPlaylist'](_0x1f968b['app'][_0x1303ad(0x196)],_0x14dc17,_0x3e4056);let _0xc9bb0e=Date['now']();_0x1f968b[_0x1303ad(0x1b6)][_0x1303ad(0x196)][_0x1303ad(0x1c7)](_0x1303ad(0x188))[_0x1303ad(0x195)](_0xc9bb0e,_0x6062e9['id']);}else{let _0x115d2b=path[_0x1303ad(0x14b)](_0x6062e9[_0x1303ad(0x1ff)],_0x6062e9[_0x1303ad(0x1e3)]),_0x591d1d=_0x1f968b[_0x1303ad(0x1b6)][_0x1303ad(0x196)][_0x1303ad(0x1c7)](_0x1303ad(0x16e))[_0x1303ad(0x198)](_0x115d2b,_0x115d2b+path[_0x1303ad(0x1c1)]+'%');for(let _0x338d6c of _0x591d1d){dbMusicPlaylistTable['addMusicToPlaylist'](_0x1f968b[_0x1303ad(0x1b6)][_0x1303ad(0x196)],_0x338d6c['id'],_0x3e4056);}}}if(_0x3c27d9 instanceof Array)for(let _0x1c90fa of _0x3c27d9){_0x35932d(_0x1c90fa);}else _0x35932d(_0x3c27d9);}else{if(_0x3d72e0=='delete'){if(_0x3c27d9 instanceof Array)for(let _0x1ec355 of _0x3c27d9){dbMusicPlaylistTable['removeMusicFromPlaylist'](_0x1f968b[_0x2ed457(0x1b6)][_0x2ed457(0x196)],_0x1ec355,_0x3e4056);}else dbMusicPlaylistTable['removeMusicFromPlaylist'](_0x1f968b[_0x2ed457(0x1b6)][_0x2ed457(0x196)],_0x3c27d9,_0x3e4056);}else return _0x1f968b[_0x2ed457(0x1b6)][_0x2ed457(0x154)](_0x33f42d,_0x2ed457(0x187));}return _0x33f42d[_0x2ed457(0x17a)]({'code':0x0,'data':{}});}),router[_0xe5ce2d(0x1d7)]('/getMusicIndexFileTree',(_0x2b0434,_0xbbd5cb,_0x4301a2)=>{const _0x20df46=_0xe5ce2d;let _0x313da0=_0x2b0434[_0x20df46(0x1c6)][_0x20df46(0x18b)],_0x216228=_0x2b0434[_0x20df46(0x1c6)][_0x20df46(0x1a2)],_0x15eefd='music',_0x2fb1c6=_0x2b0434[_0x20df46(0x1c6)][_0x20df46(0x190)]??_0x20df46(0x1e3),_0x4f914c=_0x2b0434[_0x20df46(0x1c6)][_0x20df46(0x1a3)]??_0x20df46(0x203);if(dbMusicIndexTable[_0x20df46(0x14d)](_0x2b0434,_0xbbd5cb,_0x2fb1c6,_0x4f914c)!==!![])return;if(dbUserTable[_0x20df46(0x1ed)](_0x2b0434,_0xbbd5cb,_0x15eefd,_0x20df46(0x1b8))==!![]){let _0x446527=[];if(!_0x313da0){let _0x10a450=[];_0x2b0434[_0x20df46(0x193)]['is_admin']==0x1?_0x10a450=dbSourceFolderTable[_0x20df46(0x1b5)](_0x2b0434['app'][_0x20df46(0x1ea)],_0x15eefd):_0x10a450=dbUserTable[_0x20df46(0x18d)](_0x2b0434['app']['dbOther'],_0x2b0434[_0x20df46(0x193)][_0x20df46(0x1f2)],_0x15eefd);if(_0x10a450)for(let _0x48eddc=0x0;_0x48eddc<_0x10a450[_0x20df46(0x202)];_0x48eddc++){_0x446527[_0x20df46(0x148)]({'path':_0x10a450[_0x48eddc][_0x20df46(0x1ff)],'is_file':0x0,'filename':path['basename'](_0x10a450[_0x48eddc][_0x20df46(0x1ff)]),'root':!![]});}}else{let _0x40c543=[];if(_0x2b0434[_0x20df46(0x193)]['is_admin']!=0x1){if(dbUserTable[_0x20df46(0x1ed)](_0x2b0434,_0xbbd5cb,_0x15eefd,'power_get',_0x313da0)!==!![])return;}_0x313da0=path[_0x20df46(0x14b)](_0x313da0);let _0x399fdb=_0x20df46(0x176);_0x40c543[_0x20df46(0x148)](_0x313da0),_0x399fdb+=_0x20df46(0x160);if(_0x216228){let _0x670b40=_0x20df46(0x16b);_0x399fdb+=_0x670b40,_0x40c543[_0x20df46(0x148)]('%'+_0x216228+'%'),_0x40c543['push']('%'+_0x216228+'%');}let _0x3bab07=_0x20df46(0x1e4);_0x399fdb+=_0x20df46(0x1e9)+_0x2fb1c6+'\x20'+_0x4f914c,_0x446527=_0x2b0434[_0x20df46(0x1b6)][_0x20df46(0x196)]['prepare'](_0x20df46(0x1ab)+_0x3bab07+_0x20df46(0x1cb)+_0x399fdb)[_0x20df46(0x198)](_0x40c543);}for(let _0x287019 of _0x446527){_0x287019[_0x20df46(0x1c8)]=dbMusicFavorite[_0x20df46(0x15d)](_0x2b0434[_0x20df46(0x1b6)][_0x20df46(0x196)],_0x287019['id'],_0x2b0434[_0x20df46(0x193)]['id'])?'1':'0';}let _0x6fbf78=path['sep'],_0x308101={'code':0x0,'data':_0x446527,'sep':_0x6fbf78};return _0xbbd5cb['json'](_0x308101);}}),module[_0xe5ce2d(0x149)]=router;