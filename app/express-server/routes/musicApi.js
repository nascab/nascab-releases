const _0x4c3a88=_0xa69a;function _0x51dd(){const _0x472e07=['getMusicIndex','searchMusicArtist','isSearch','getTime','addMusicToPlaylist','=?\x20','getAllFavoriteByWhere','getCoverByField','desc','power_add','2555npLbnW','genTinyFile','coverList','7lZyXJw','/getMusicIndexFileTree','body','../../utils/music/lyricUtils','stringify','search','sha256','power_get','orderType','base64','basename','/saveLyric','getGroupList','music_count','artistList','\x20order\x20by\x20m.update_time\x20','prepare',',f.album\x20','returnErrMsg','add','tags','filename','skipCount','post','/getMusicList','size','3106hIwHYN','list','3313310LdLLDD','/getGroupList','asc','inner','getUserPower','/getMusicHomeData','length','catch','SELECT\x20','../utils/sharpUtils','run','getPlaylistList','push',',f.artist\x20','playlist','music','\x20order\x20by\x20m.update_time\x20DESC\x20','getMusicListCount','../../db/dbMusicPlaylistTable','removeMusicFromPlaylist','sendFile','deleteFavorite','orderField','5262GkBPOx','lyricList','path','operation','last_play_time','parent','sep','getUserPathWhere','picture','whereStr','query','includes','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','\x20(type=3\x20OR\x20is_file=0)','\x20order\x20by\x20f.title_fl\x20','log','getPlaylistCover','play_count\x20desc','filePath','utf-8','5012432UlHLDi','/operationPlaylist','toString','/operationPlaylistIndex','musicIsFavorite',',f.title\x20','.lrc','getFavorite','/musicFavorite','dirname','maxPlayMusic','join','check_time','576yzNqzC','dbOther','need\x20musicIndexId\x20and\x20playlistId','\x20order\x20by\x20f.album_fl\x20',',f.filename_fl\x20','lyrics_get_state','year','replace','717081IoqTXc','dbFileIndex','updateByFiled','searchStr','lrc','updatePlaylist','../../db/dbUserTable','/searchLyric','\x20FROM\x20file_index_music\x20WHERE\x20','\x20AND\x20artist=?\x20','file_cover_path','\x20is_file=1','json','musicIndexId','playlistId','albumList','get','8926029UzIfhf','app','favorite','searchMusicName','recentAddList','getMusicSameNameCover','\x20path=?\x20AND\x20','readFile','indexId','all','getPlaylistById','temp.','getFavoriteCount','getPlaylistMusicCount','checkOrderParams','album','../../db/dbMusicFavorite','data','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','searchMusicAlbum','duration','abs','NO\x20MUSIC\x20INDEX','Router','13990256VvRdZT','apiTokenKey','cover_path','Lyric\x20is\x20null','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','\x20order\x20by\x20f.','read','existsSync','playlistId\x20no\x20exists','status','is_file','../../myConfig/config',',id\x20asc','trim','artist','../../db/dbFileIndexTable','end','count','is_admin','offset','listType','birthtime','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','name','edit','from','writeFile','\x20AND\x20','searchLyric','title','\x20order\x20by\x20f.artist_fl\x20','lyrics','currentUser','addFavorite','APIC','need\x20\x27name\x27','paramsList','letterIndex','INDEX_TABLE_NAME_MUSIC','getMusicList','/getMusicCover','albumCount','doUserCanGet','file','delete','then'];_0x51dd=function(){return _0x472e07;};return _0x51dd();}(function(_0x45ea29,_0x12244e){const _0x59b957=_0xa69a,_0x5f4384=_0x45ea29();while(!![]){try{const _0x2ca7a7=-parseInt(_0x59b957(0x177))/0x1*(-parseInt(_0x59b957(0x13d))/0x2)+-parseInt(_0x59b957(0x17f))/0x3+-parseInt(_0x59b957(0x16a))/0x4+-parseInt(_0x59b957(0x1e0))/0x5*(-parseInt(_0x59b957(0x156))/0x6)+parseInt(_0x59b957(0x123))/0x7*(parseInt(_0x59b957(0x1a8))/0x8)+-parseInt(_0x59b957(0x190))/0x9+parseInt(_0x59b957(0x13f))/0xa;if(_0x2ca7a7===_0x12244e)break;else _0x5f4384['push'](_0x5f4384['shift']());}catch(_0x5579fb){_0x5f4384['push'](_0x5f4384['shift']());}}}(_0x51dd,0xe5378));let express=require('express'),router=express[_0x4c3a88(0x1a7)](),config=require(_0x4c3a88(0x1b3)),path=require(_0x4c3a88(0x158)),fs=require('fs'),dbMusicIndexTable=require('../../db/dbMusicIndexTable'),dbFileIndexTable=require(_0x4c3a88(0x1b7)),dbMusicPlaylistTable=require(_0x4c3a88(0x151)),dbMusicFavorite=require(_0x4c3a88(0x1a0)),jsmediatags=require('jsmediatags');function _0xa69a(_0xf912d,_0x4b950c){const _0x51dde5=_0x51dd();return _0xa69a=function(_0xa69a8a,_0x5241fe){_0xa69a8a=_0xa69a8a-0x123;let _0x4f9820=_0x51dde5[_0xa69a8a];return _0x4f9820;},_0xa69a(_0xf912d,_0x4b950c);}const dbUserTable=require(_0x4c3a88(0x185));let musicUitls=require('../../utils/musicUtil'),lyricUtils=require(_0x4c3a88(0x126)),sharpUtil=require(_0x4c3a88(0x148));const dbSourceFolderTable=require('../../db/dbSourceFolderTable');let axios=require('axios'),sha256=require(_0x4c3a88(0x129)),os=require('os');const urlConfig=require('../../myConfig/urlConfig');function getFavoriteMusicList(_0x4dec90,_0x1e154c,_0x569cfd,_0x24f02b,_0x133aa5,_0x3db5e1,_0xb4880c){const _0x8c60f2=_0x4c3a88;let _0x44d661='',_0x55e000=[];_0x44d661+=_0x8c60f2(0x18a);_0x3db5e1&&(_0x3db5e1=_0x3db5e1[_0x8c60f2(0x17e)]('\x27','')[_0x8c60f2(0x17e)]('â€™',''),_0x44d661+=_0x8c60f2(0x162),_0x55e000['push']('%'+_0x3db5e1+'%','%'+_0x3db5e1+'%','%'+_0x3db5e1+'%'));_0xb4880c&&(_0x44d661+=_0x8c60f2(0x1a2),_0x55e000['push'](_0xb4880c,_0xb4880c));if(_0x24f02b&&_0x133aa5){if(_0x24f02b==_0x8c60f2(0x1b6))_0x44d661+=_0x8c60f2(0x1c6)+_0x133aa5+_0x8c60f2(0x14c)+_0x133aa5+'\x20';else{if(_0x24f02b==_0x8c60f2(0x19f))_0x44d661+=_0x8c60f2(0x17a)+_0x133aa5+_0x8c60f2(0x134)+_0x133aa5+'\x20';else{if(_0x24f02b==_0x8c60f2(0x1c5))_0x44d661+=_0x8c60f2(0x164)+_0x133aa5+_0x8c60f2(0x16f)+_0x133aa5+_0x8c60f2(0x17b)+_0x133aa5+'\x20';else _0x24f02b=='favorite_time'?_0x44d661+=_0x8c60f2(0x132)+_0x133aa5+'\x20':_0x44d661+=_0x8c60f2(0x1ad)+_0x24f02b+'\x20'+_0x133aa5+'\x20';}}}else _0x44d661+=_0x8c60f2(0x14f);return _0x44d661+='\x20LIMIT\x20?\x20OFFSET\x20?\x20',_0x55e000['push'](_0x1e154c),_0x55e000['push'](_0x569cfd),result=dbMusicFavorite[_0x8c60f2(0x1dc)](_0x4dec90[_0x8c60f2(0x191)][_0x8c60f2(0x180)],_0x4dec90['currentUser']['id'],_0x44d661,'*',_0x55e000),result=dealMusicList(_0x4dec90,result),result;}function dealMusicList(_0x383ca2,_0x38cd1a){const _0x43bf8c=_0x4c3a88;for(let _0x2f0392 of _0x38cd1a){_0x2f0392[_0x43bf8c(0x192)]=dbMusicFavorite['musicIsFavorite'](_0x383ca2[_0x43bf8c(0x191)][_0x43bf8c(0x180)],_0x2f0392['id'],_0x383ca2[_0x43bf8c(0x1c8)]['id'])?'1':'0';if(!_0x2f0392['cover_path']){let _0x1e92b8=!![];_0x2f0392[_0x43bf8c(0x189)]&&fs[_0x43bf8c(0x1af)](_0x2f0392['file_cover_path'])&&(_0x1e92b8=![]),_0x1e92b8&&(_0x2f0392[_0x43bf8c(0x189)]=musicUitls[_0x43bf8c(0x195)](_0x383ca2['app'][_0x43bf8c(0x180)],_0x2f0392));}_0x2f0392[_0x43bf8c(0x168)]=path[_0x43bf8c(0x175)](_0x2f0392[_0x43bf8c(0x158)],_0x2f0392[_0x43bf8c(0x138)]),delete _0x2f0392['path'];}return _0x38cd1a;}function getMusicListByParams(_0x4aecd6,_0x3c2fc2,_0x5f8512,_0x3c6ac8,_0x410194,_0x83144c,_0x368a5d,_0x4b9e13,_0x18ce42,_0x3ce72d,_0xe78cf8,_0x355af7,_0x454f44){const _0x46db61=_0x4c3a88;let _0x509e91=_0x4aecd6[_0x46db61(0x191)]['dbFileIndex'],_0x5b44f1=[];return _0x5b44f1=dbMusicIndexTable[_0x46db61(0x1cf)](_0x509e91,_0x3c2fc2,_0x5f8512,_0x3c6ac8,_0x410194,_0x83144c,_0x368a5d,_0x4b9e13,_0x18ce42,_0x3ce72d,_0x355af7,_0xe78cf8,_0x454f44),_0x5b44f1=dealMusicList(_0x4aecd6,_0x5b44f1),_0x5b44f1;}router[_0x4c3a88(0x13a)](_0x4c3a88(0x144),(_0x2a41dc,_0x13a40e,_0x15479a)=>{const _0x493191=_0x4c3a88;let _0x2aa0ba=_0x2a41dc[_0x493191(0x191)]['dbFileIndex'],_0xa5cee0=_0x2a41dc['body'][_0x493191(0x1b9)]?_0x2a41dc[_0x493191(0x125)][_0x493191(0x1b9)]:0xc,_0x47d88b=_0x2a41dc[_0x493191(0x125)][_0x493191(0x1d1)]?_0x2a41dc[_0x493191(0x125)][_0x493191(0x1d1)]:0xc,_0x52dba2=dbUserTable[_0x493191(0x15d)](_0x2a41dc,'music',_0x493191(0x12a),!![]);if(_0x2a41dc[_0x493191(0x1c8)][_0x493191(0x1ba)]!=0x1&&!_0x52dba2['whereStr'])return _0x13a40e[_0x493191(0x18b)]({'code':0x0,'data':null});let _0x4c78cc=getMusicListByParams(_0x2a41dc,_0x52dba2,_0xa5cee0,0x0,_0x493191(0x15a),_0x493191(0x1de)),_0x44f844=getMusicListByParams(_0x2a41dc,_0x52dba2,_0xa5cee0,0x0,_0x493191(0x167),_0x493191(0x1b4)),_0x589d41=getMusicListByParams(_0x2a41dc,_0x52dba2,_0xa5cee0,0x0,'id',_0x493191(0x1de)),_0x3d3f62=dbMusicIndexTable['getGroupList'](_0x2aa0ba,_0x52dba2,'artist',_0x47d88b,0x0,_0x493191(0x15a),'desc');for(let _0x461fb7 of _0x3d3f62){let _0x7d53f9=_0x493191(0x188)+_0x52dba2[_0x493191(0x15f)],_0x139b57=[_0x461fb7[_0x493191(0x1b6)],..._0x52dba2[_0x493191(0x1cc)]];_0x461fb7[_0x493191(0x1e2)]=dbMusicIndexTable[_0x493191(0x1dd)](_0x2a41dc[_0x493191(0x191)][_0x493191(0x180)],_0x7d53f9,_0x139b57);}let _0x33352c=dbMusicIndexTable['getGroupList'](_0x2aa0ba,_0x52dba2,'album',_0x47d88b,0x0,'play_count',_0x493191(0x1de));for(let _0x3e14b3 of _0x33352c){let _0x51e5d7='\x20AND\x20album=?\x20'+_0x52dba2[_0x493191(0x15f)],_0x52ab2b=[_0x3e14b3['album'],..._0x52dba2['paramsList']];_0x3e14b3[_0x493191(0x1e2)]=dbMusicIndexTable[_0x493191(0x1dd)](_0x2a41dc[_0x493191(0x191)][_0x493191(0x180)],_0x51e5d7,_0x52ab2b);}let _0x3a73ad={};return _0x4c78cc&&_0x4c78cc[_0x493191(0x145)]>0x0&&(_0x3a73ad['recentMusic']=_0x4c78cc),_0x44f844&&_0x44f844[_0x493191(0x145)]>0x0&&(_0x3a73ad[_0x493191(0x174)]=_0x44f844),_0x589d41&&_0x589d41[_0x493191(0x145)]>0x0&&(_0x3a73ad[_0x493191(0x194)]=_0x589d41),_0x3d3f62&&_0x3d3f62['length']>0x0&&(_0x3a73ad[_0x493191(0x131)]=_0x3d3f62),_0x33352c&&_0x33352c['length']>0x0&&(_0x3a73ad[_0x493191(0x18e)]=_0x33352c),_0x13a40e[_0x493191(0x18b)]({'code':0x0,'data':_0x3a73ad,'platform':os['platform']()});}),router[_0x4c3a88(0x13a)](_0x4c3a88(0x13b),(_0x3d4ed4,_0x5e46f6,_0x3d610e)=>{const _0x5d1f62=_0x4c3a88;let _0x396e12=_0x3d4ed4[_0x5d1f62(0x125)]['count']||0x32,_0x5905bb=_0x3d4ed4['body'][_0x5d1f62(0x1bb)]||0x0,_0x455802=_0x3d4ed4['body'][_0x5d1f62(0x19f)],_0x103aa2=_0x3d4ed4['body'][_0x5d1f62(0x17d)],_0x123261=_0x3d4ed4[_0x5d1f62(0x125)][_0x5d1f62(0x1b6)],_0x5a9dd4=_0x3d4ed4[_0x5d1f62(0x125)]['genre'],_0x4a3c5b=_0x3d4ed4[_0x5d1f62(0x125)][_0x5d1f62(0x155)]||'last_play_time',_0x2c8e77=_0x3d4ed4['body'][_0x5d1f62(0x12b)]||_0x5d1f62(0x1de),_0x5695a8=[_0x5d1f62(0x13e),_0x5d1f62(0x192),'playlist'],_0xb0ef32=_0x3d4ed4[_0x5d1f62(0x125)][_0x5d1f62(0x1bc)]||_0x5d1f62(0x13e),_0x495096=_0x3d4ed4['body'][_0x5d1f62(0x128)],_0xa489f6=_0x3d4ed4[_0x5d1f62(0x125)]['letterIndex'],_0x466207=_0x3d4ed4['body'][_0x5d1f62(0x18d)];if(dbMusicIndexTable[_0x5d1f62(0x19e)](_0x3d4ed4,_0x5e46f6,_0x4a3c5b,_0x2c8e77)!==!![])return;if(_0xb0ef32=='playlist'){if(!_0x466207)return _0x3d4ed4[_0x5d1f62(0x191)][_0x5d1f62(0x135)](_0x5e46f6,'need\x20playlistId');}!_0x5695a8[_0x5d1f62(0x161)](_0xb0ef32)&&(_0xb0ef32=_0x5d1f62(0x13e));_0x396e12>0x1f4&&(_0x396e12=0x1f4);let _0x26bfd4=dbUserTable['getUserPathWhere'](_0x3d4ed4,_0x5d1f62(0x14e),_0x5d1f62(0x12a),!![]);if(_0x3d4ed4['currentUser']['is_admin']!=0x1&&!_0x26bfd4[_0x5d1f62(0x15f)])return _0x5e46f6[_0x5d1f62(0x18b)]({'code':0x0,'data':null});let _0x5bd6bb=[];if(_0xb0ef32==_0x5d1f62(0x14d)||_0xb0ef32==_0x5d1f62(0x13e))_0x5bd6bb=getMusicListByParams(_0x3d4ed4,_0x26bfd4,_0x396e12,_0x5905bb,_0x4a3c5b,_0x2c8e77,_0x455802,_0x103aa2,_0x123261,_0x5a9dd4,_0x495096,_0x466207,_0xa489f6);else _0xb0ef32==_0x5d1f62(0x192)&&(_0x5bd6bb=getFavoriteMusicList(_0x3d4ed4,_0x396e12,_0x5905bb,_0x4a3c5b,_0x2c8e77,_0x495096,_0xa489f6));let _0x5bc81b={'code':0x0,'data':_0x5bd6bb};if(_0xb0ef32==_0x5d1f62(0x192))_0x5bc81b[_0x5d1f62(0x130)]=dbMusicFavorite[_0x5d1f62(0x19c)](_0x3d4ed4[_0x5d1f62(0x191)][_0x5d1f62(0x180)],_0x3d4ed4[_0x5d1f62(0x1c8)]['id']);else{if(_0xb0ef32==_0x5d1f62(0x13e))_0x5bc81b['music_count']=dbMusicIndexTable[_0x5d1f62(0x150)](_0x3d4ed4['app'][_0x5d1f62(0x180)],_0x26bfd4,_0x455802,_0x103aa2,_0x123261,_0x5a9dd4);else _0xb0ef32==_0x5d1f62(0x14d)&&(_0x5bc81b[_0x5d1f62(0x130)]=dbMusicPlaylistTable[_0x5d1f62(0x19d)](_0x3d4ed4[_0x5d1f62(0x191)][_0x5d1f62(0x180)],_0x466207));}return _0x5e46f6['json'](_0x5bc81b);}),router[_0x4c3a88(0x13a)]('/getMusicDetail',(_0x2806db,_0x376ac4,_0x40ad29)=>{const _0x526c6d=_0x4c3a88;let _0x548136=_0x2806db[_0x526c6d(0x125)]['id'],_0x5f0522=dbFileIndexTable['getById'](_0x2806db['app']['dbFileIndex'],_0x548136,dbFileIndexTable[_0x526c6d(0x1ce)]);if(!_0x5f0522)return _0x2806db[_0x526c6d(0x191)][_0x526c6d(0x135)](_0x376ac4,_0x526c6d(0x1a6));if(dbUserTable[_0x526c6d(0x1d2)](_0x2806db,_0x376ac4,_0x526c6d(0x14e),_0x526c6d(0x12a),_0x5f0522['path'])==!![]){let _0x595b7c=_0x2806db[_0x526c6d(0x1c8)]['id'],_0x5e5712=dbMusicFavorite['getFavorite'](_0x2806db[_0x526c6d(0x191)][_0x526c6d(0x180)],_0x595b7c,_0x548136);_0x5f0522[_0x526c6d(0x189)]=musicUitls['getMusicSameNameCover'](_0x2806db[_0x526c6d(0x191)]['dbFileIndex'],_0x5f0522),_0x5f0522[_0x526c6d(0x192)]=_0x5e5712?0x1:0x0,getLyrics(_0x5f0522,_0x3b41cf=>{const _0x562ff3=_0x526c6d;return _0x5f0522[_0x562ff3(0x157)]=_0x3b41cf,_0x376ac4[_0x562ff3(0x18b)]({'code':0x0,'data':_0x5f0522});});}});function updateIndexLyric(_0x51f136,_0x5df8e8,_0x118f52,_0x270e3f){const _0x894e6a=_0x4c3a88;if(_0x118f52&&_0x118f52[_0x894e6a(0x145)]>0x0){let _0x28ab73=_0x270e3f['filename']['replace'](path['extname'](_0x270e3f[_0x894e6a(0x138)]),''),_0x29e613=_0x28ab73+_0x894e6a(0x170),_0x9241f0=path[_0x894e6a(0x175)](_0x270e3f['path'],_0x29e613);fs['writeFile'](_0x9241f0,_0x118f52,_0x894e6a(0x169),_0x4f91e5=>{if(!_0x4f91e5){}});}let _0x167daf=JSON[_0x894e6a(0x127)]({'lyrics':_0x118f52?_0x118f52:''});_0x51f136[_0x894e6a(0x133)]('UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?')['run'](_0x5df8e8,_0x167daf,_0x270e3f['id']);}router['post'](_0x4c3a88(0x12e),(_0x50e01d,_0x5f00ac,_0x5260bf)=>{const _0x1952b6=_0x4c3a88;let _0x13f2af=_0x50e01d[_0x1952b6(0x125)]['id'],_0x5bd924=_0x50e01d[_0x1952b6(0x125)]['lyric'],_0x4ae819=dbFileIndexTable['getById'](_0x50e01d[_0x1952b6(0x191)]['dbFileIndex'],_0x13f2af,dbFileIndexTable[_0x1952b6(0x1ce)]);if(!_0x4ae819)return _0x50e01d[_0x1952b6(0x191)]['returnErrMsg'](_0x5f00ac,'NO\x20MUSIC\x20INDEX');if(!_0x5bd924)return _0x50e01d[_0x1952b6(0x191)]['returnErrMsg'](_0x5f00ac,_0x1952b6(0x1ab));if(dbUserTable[_0x1952b6(0x1d2)](_0x50e01d,_0x5f00ac,'music',_0x1952b6(0x1df),_0x4ae819[_0x1952b6(0x158)])==!![])return updateIndexLyric(_0x50e01d[_0x1952b6(0x191)]['dbFileIndex'],0x1,_0x5bd924,_0x4ae819),_0x5f00ac[_0x1952b6(0x18b)]({'code':0x0});}),router['post'](_0x4c3a88(0x186),(_0x1978b2,_0x477c5e,_0x15ae33)=>{const _0x5e08b6=_0x4c3a88;let _0x472aaa=_0x1978b2[_0x5e08b6(0x125)]['id'],_0xecf3b6=dbFileIndexTable['getById'](_0x1978b2['app'][_0x5e08b6(0x180)],_0x472aaa,dbFileIndexTable[_0x5e08b6(0x1ce)]);if(!_0xecf3b6)return _0x1978b2[_0x5e08b6(0x191)]['returnErrMsg'](_0x477c5e,_0x5e08b6(0x1a6));let _0x4ee17c=_0x1978b2[_0x5e08b6(0x125)][_0x5e08b6(0x193)],_0xd6d5ae=_0x1978b2['body'][_0x5e08b6(0x1d7)],_0x623d53=_0x1978b2[_0x5e08b6(0x125)][_0x5e08b6(0x1a3)],_0x586386=_0x1978b2[_0x5e08b6(0x125)][_0x5e08b6(0x1d8)];if(dbUserTable['doUserCanGet'](_0x1978b2,_0x477c5e,'music',_0x5e08b6(0x12a),_0xecf3b6[_0x5e08b6(0x158)])==!![]){if(_0xecf3b6[_0x5e08b6(0x17c)]==0x1&&!_0x586386)return _0x477c5e[_0x5e08b6(0x18b)]({'code':0x0,'data':[_0xecf3b6[_0x5e08b6(0x1c7)]]});let _0x56a6c3=_0x1978b2[_0x5e08b6(0x125)][_0x5e08b6(0x139)]||0x0;if(!_0x4ee17c||!_0x4ee17c[_0x5e08b6(0x1b5)]())return _0x477c5e[_0x5e08b6(0x18b)]([]);let _0x5a972a={'searchMusicName':_0x4ee17c,'searchMusicArtist':_0xd6d5ae,'searchMusicAlbum':_0x623d53,'isSearch':_0x586386,'skipCount':_0x56a6c3,'token':sha256(_0x4ee17c+config[_0x5e08b6(0x1a9)])};lyricUtils[_0x5e08b6(0x1c4)](_0x5a972a)[_0x5e08b6(0x1d5)](_0x325579=>{const _0x1c2dc2=_0x5e08b6;if(_0x325579){if(_0x325579['length']>0x0&&!_0x586386){let _0x323d16=![],_0x48b4e9=0x14,_0x19b76e=0x64,_0x12981b=null;for(let _0x1d77fa of _0x325579){if(_0x1d77fa[_0x1c2dc2(0x1a4)]){let _0x111dad=_0x1d77fa['duration']/0x3e8,_0x1e4d9d=Math[_0x1c2dc2(0x1a5)](_0x111dad-_0xecf3b6['duration']);_0x1e4d9d<_0x19b76e&&(_0x19b76e=_0x1e4d9d,_0x12981b=_0x1d77fa[_0x1c2dc2(0x183)]?_0x1d77fa[_0x1c2dc2(0x183)]:'');}}return _0x19b76e<_0x48b4e9?(_0x323d16=!![],_0xecf3b6['lyrics']=JSON[_0x1c2dc2(0x127)]({'lyrics':_0x12981b?_0x12981b:''}),updateIndexLyric(_0x1978b2[_0x1c2dc2(0x191)][_0x1c2dc2(0x180)],0x1,_0x12981b,_0xecf3b6)):updateIndexLyric(_0x1978b2[_0x1c2dc2(0x191)][_0x1c2dc2(0x180)],0x1,'',_0xecf3b6),_0x477c5e['json']({'code':0x0,'data':_0x323d16&&_0xecf3b6[_0x1c2dc2(0x1c7)]?[_0xecf3b6[_0x1c2dc2(0x1c7)]]:[]});}else return _0x477c5e[_0x1c2dc2(0x18b)]({'code':0x0,'data':_0x325579});}})[_0x5e08b6(0x146)](_0x70a08d=>{const _0x5e4730=_0x5e08b6;return _0x1978b2[_0x5e4730(0x191)][_0x5e4730(0x135)](_0x477c5e,_0x70a08d['message']);});}});function getLyrics(_0xc8d9f,_0x5ab75f){const _0x39d2d9=_0x4c3a88;let _0x3f828b=[];try{_0xc8d9f[_0x39d2d9(0x1c7)]&&_0xc8d9f[_0x39d2d9(0x1c7)][_0x39d2d9(0x145)]>0xa&&_0x3f828b['push']({'type':_0x39d2d9(0x142),'content':_0xc8d9f['lyrics']});let _0x2260ef=_0xc8d9f['filename'][_0x39d2d9(0x17e)](path['extname'](_0xc8d9f['filename']),''),_0x3b0133=_0x2260ef+_0x39d2d9(0x170),_0x4f0900=path[_0x39d2d9(0x175)](_0xc8d9f[_0x39d2d9(0x158)],_0x3b0133);fs[_0x39d2d9(0x1af)](_0x4f0900)?fs[_0x39d2d9(0x197)](_0x4f0900,(_0x499b93,_0x342a55)=>{const _0x5b4e21=_0x39d2d9;let _0x5c2c82=musicUitls['transStringToUtf8'](_0x342a55[_0x5b4e21(0x16c)](),_0x4f0900);_0x3f828b[_0x5b4e21(0x14b)]({'type':_0x5b4e21(0x1d3),'filename':_0x3b0133,'content':_0x5c2c82}),_0x5ab75f(_0x3f828b);}):_0x5ab75f(_0x3f828b);}catch(_0x302c6e){console[_0x39d2d9(0x165)](_0x302c6e),_0x5ab75f(_0x3f828b);}}router[_0x4c3a88(0x13a)](_0x4c3a88(0x172),(_0x41d7db,_0x3eb2e6,_0x52cbaf)=>{const _0x1812ba=_0x4c3a88;let _0x39691f=_0x41d7db[_0x1812ba(0x1c8)]['id'];function _0x44be9e(_0x2c6e76){const _0x593084=_0x1812ba;let _0x2ff92d=dbFileIndexTable['getById'](_0x41d7db['app'][_0x593084(0x180)],_0x2c6e76,dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);if(!_0x2ff92d)return;let _0x2af5c8=new Date()[_0x593084(0x1d9)]();_0x41d7db[_0x593084(0x191)]['dbFileIndex'][_0x593084(0x133)](_0x593084(0x1ac))[_0x593084(0x149)](_0x2af5c8,_0x2c6e76),dbMusicFavorite[_0x593084(0x1c9)](_0x41d7db[_0x593084(0x191)][_0x593084(0x180)],_0x39691f,_0x2c6e76);}if(_0x41d7db[_0x1812ba(0x125)]['musicIndexId']instanceof Array){let _0x193c89=_0x41d7db['body'][_0x1812ba(0x159)];if(_0x193c89==_0x1812ba(0x136))for(let _0x4077ac of _0x41d7db[_0x1812ba(0x125)]['musicIndexId']){_0x44be9e(_0x4077ac);}else{if(_0x193c89==_0x1812ba(0x1d4))for(let _0x465f0f of _0x41d7db[_0x1812ba(0x125)][_0x1812ba(0x18c)]){dbMusicFavorite[_0x1812ba(0x154)](_0x41d7db[_0x1812ba(0x191)][_0x1812ba(0x180)],_0x39691f,_0x465f0f);}}return _0x3eb2e6['json']({'code':0x0});}else{let _0x23aa30=parseInt(_0x41d7db[_0x1812ba(0x125)][_0x1812ba(0x18c)]),_0x511391=dbMusicFavorite[_0x1812ba(0x171)](_0x41d7db[_0x1812ba(0x191)][_0x1812ba(0x180)],_0x39691f,_0x23aa30),_0x3c2942=0x0;return _0x511391?dbMusicFavorite['deleteFavorite'](_0x41d7db[_0x1812ba(0x191)]['dbFileIndex'],_0x39691f,_0x23aa30):(_0x3c2942=0x1,_0x44be9e(_0x23aa30)),_0x3eb2e6[_0x1812ba(0x18b)]({'code':0x0,'favorite':_0x3c2942});}}),router[_0x4c3a88(0x18f)](_0x4c3a88(0x1d0),(_0x46a066,_0x2e5edc,_0x210c35)=>{const _0x213f21=_0x4c3a88;let _0x2bcb64=_0x46a066['query'][_0x213f21(0x198)],_0x787003=dbMusicIndexTable[_0x213f21(0x1d6)](_0x46a066[_0x213f21(0x191)][_0x213f21(0x180)],_0x2bcb64),_0x4f67ef=_0x46a066[_0x213f21(0x160)][_0x213f21(0x13c)];!_0x4f67ef&&(_0x4f67ef=0x200);if(!_0x787003||_0x787003&&!_0x787003[_0x213f21(0x1aa)])return _0x2e5edc[_0x213f21(0x1b1)](0x194)[_0x213f21(0x1b8)]();if(dbUserTable['doUserCanGet'](_0x46a066,_0x2e5edc,'music',_0x213f21(0x12a),_0x787003['path'])==!![]){let _0x4035d8=path['join'](_0x787003[_0x213f21(0x158)],_0x787003['filename']),_0x9555a=config['getMediaCoverCachePath'](_0x787003,_0x4f67ef);if(fs[_0x213f21(0x1af)](_0x9555a))return _0x2e5edc[_0x213f21(0x153)](_0x9555a);jsmediatags[_0x213f21(0x1ae)](_0x4035d8,{'onSuccess':function(_0x9dd4b6){const _0x564c28=_0x213f21;let _0x3683c8=_0x9dd4b6[_0x564c28(0x137)];var _0x3659b;_0x3683c8[_0x564c28(0x15e)]&&_0x3683c8[_0x564c28(0x15e)][_0x564c28(0x1a1)]&&(_0x3659b=_0x3683c8['picture']['data']);!_0x3659b&&_0x3683c8[_0x564c28(0x1ca)]&&_0x3683c8[_0x564c28(0x1ca)][_0x564c28(0x1a1)]&&_0x3683c8[_0x564c28(0x1ca)][_0x564c28(0x1a1)][_0x564c28(0x1a1)]&&(_0x3659b=_0x3683c8['APIC'][_0x564c28(0x1a1)][_0x564c28(0x1a1)]);if(_0x3659b){let _0x5bc567=path[_0x564c28(0x175)](path[_0x564c28(0x173)](_0x9555a),_0x564c28(0x19b)+path[_0x564c28(0x12d)](_0x9555a));fs[_0x564c28(0x1c2)](_0x5bc567,Buffer[_0x564c28(0x1c1)](_0x3659b),{'encoding':_0x564c28(0x12c)},function(_0x1d905d){const _0x8d6949=_0x564c28;if(!_0x1d905d)sharpUtil[_0x8d6949(0x1e1)](_0x5bc567,path['dirname'](_0x9555a),path['basename'](_0x9555a),'image',null,_0x5e1a60=>{const _0x225627=_0x8d6949;return dbMusicIndexTable[_0x225627(0x181)](_0x46a066[_0x225627(0x191)][_0x225627(0x180)],_0x787003['id'],_0x225627(0x1aa),_0x9555a),fs['rm'](_0x5bc567,_0x40babd=>{}),_0x2e5edc['sendFile'](_0x9555a);},_0x298c98=>{const _0xf2b35c=_0x8d6949;return _0x2e5edc['status'](0x194)[_0xf2b35c(0x1b8)]();},_0x4f67ef);else return _0x2e5edc[_0x8d6949(0x1b1)](0x194)[_0x8d6949(0x1b8)]();});}else return _0x2e5edc['status'](0x194)['end']();},'onError':function(_0xaece34){const _0x2299e1=_0x213f21;return _0x2e5edc[_0x2299e1(0x1b1)](0x194)[_0x2299e1(0x1b8)]();}});}}),router[_0x4c3a88(0x13a)](_0x4c3a88(0x140),(_0xe3cae8,_0x24c7bf,_0x1add5e)=>{const _0x21f078=_0x4c3a88;let _0x4987bf=_0xe3cae8[_0x21f078(0x125)][_0x21f078(0x1b9)]||0x32,_0x11b781=_0xe3cae8['body'][_0x21f078(0x1bb)]||0x0,_0x52b895=_0xe3cae8[_0x21f078(0x125)]['groupField']||_0x21f078(0x19f),_0x115ec1=_0xe3cae8[_0x21f078(0x125)][_0x21f078(0x155)]||_0x21f078(0x176),_0xd42ad5=_0xe3cae8['body'][_0x21f078(0x12b)]||'desc',_0x33f2ff=_0xe3cae8['body'][_0x21f078(0x128)],_0x1ebd88=_0xe3cae8[_0x21f078(0x125)][_0x21f078(0x1cd)];if(dbMusicIndexTable['checkOrderParams'](_0xe3cae8,_0x24c7bf,_0x115ec1,_0xd42ad5)!==!![])return;let _0x1668c1=[_0x21f078(0x176),'play_count','last_play_time','filename',_0x21f078(0x1c5),_0x21f078(0x19f),'artist',_0x21f078(0x1bd),'id'],_0x52f24e=[_0x21f078(0x141),_0x21f078(0x1de)];if(!_0x1668c1[_0x21f078(0x161)](_0x115ec1)||!_0x52f24e[_0x21f078(0x161)](_0xd42ad5))return _0xe3cae8[_0x21f078(0x191)]['returnErrMsg'](_0x24c7bf,'orderField/orderType\x20error',_0x115ec1,_0xd42ad5);let _0x2492dc=dbUserTable[_0x21f078(0x15d)](_0xe3cae8,_0x21f078(0x14e),'power_get',!![]);if(_0xe3cae8[_0x21f078(0x1c8)][_0x21f078(0x1ba)]!=0x1&&!_0x2492dc[_0x21f078(0x15f)]&&_0x52b895!=_0x21f078(0x14d))return _0x24c7bf[_0x21f078(0x18b)]({'code':0x0,'data':null});let _0x143d10=[];if(_0x52b895==_0x21f078(0x19f)||_0x52b895=='artist'){_0x143d10=dbMusicIndexTable[_0x21f078(0x12f)](_0xe3cae8[_0x21f078(0x191)][_0x21f078(0x180)],_0x2492dc,_0x52b895,_0x4987bf,_0x11b781,_0x115ec1,_0xd42ad5,_0x33f2ff,_0x1ebd88);for(let _0xa46e2e of _0x143d10){let _0x65dc35=_0x21f078(0x1c3)+_0x52b895+_0x21f078(0x1db)+_0x2492dc['whereStr'],_0x108918=[_0x52b895,..._0x2492dc[_0x21f078(0x1cc)]];_0xa46e2e[_0x21f078(0x1e2)]=dbMusicIndexTable[_0x21f078(0x1dd)](_0xe3cae8[_0x21f078(0x191)][_0x21f078(0x180)],_0x65dc35,_0x108918);}}else{if(_0x52b895==_0x21f078(0x14d)){_0x143d10=dbMusicPlaylistTable[_0x21f078(0x14a)](_0xe3cae8[_0x21f078(0x191)]['dbFileIndex'],_0xe3cae8[_0x21f078(0x1c8)]['id'],_0x4987bf,_0x11b781,'id',_0x21f078(0x1de),_0x33f2ff);for(let _0x42940d of _0x143d10){_0x42940d[_0x21f078(0x1e2)]=dbMusicIndexTable[_0x21f078(0x166)](_0xe3cae8['app']['dbFileIndex'],_0x42940d['id']);}}}return _0x24c7bf[_0x21f078(0x18b)]({'code':0x0,'data':_0x143d10});}),router[_0x4c3a88(0x13a)](_0x4c3a88(0x16b),(_0x19d740,_0xb4f4e3,_0x4bc1dc)=>{const _0x31fb13=_0x4c3a88;let _0x1dd249=_0x19d740['body'][_0x31fb13(0x1bf)],_0x422af8=_0x19d740['body'][_0x31fb13(0x159)];if(_0x422af8==_0x31fb13(0x136)){if(!_0x1dd249)return _0x19d740[_0x31fb13(0x191)][_0x31fb13(0x135)](_0xb4f4e3,_0x31fb13(0x1cb));dbMusicPlaylistTable['createPlaylist'](_0x19d740['app'][_0x31fb13(0x180)],_0x19d740[_0x31fb13(0x1c8)]['id'],_0x1dd249);}else{if(_0x422af8==_0x31fb13(0x1c0)||_0x422af8==_0x31fb13(0x1d4)){let _0x31887f=_0x19d740[_0x31fb13(0x125)][_0x31fb13(0x18d)],_0x2f0c76=dbMusicPlaylistTable[_0x31fb13(0x19a)](_0x19d740[_0x31fb13(0x191)][_0x31fb13(0x180)],_0x31887f),_0x2b98f0=![];(_0x19d740[_0x31fb13(0x1c8)][_0x31fb13(0x1ba)]==0x1||_0x2f0c76['uid']==_0x19d740[_0x31fb13(0x1c8)]['id'])&&(_0x2b98f0=!![]);if(!_0x2b98f0)return _0xb4f4e3[_0x31fb13(0x18b)]({'code':0x66});if(_0x422af8==_0x31fb13(0x1d4))dbMusicPlaylistTable['removePlaylist'](_0x19d740[_0x31fb13(0x191)][_0x31fb13(0x180)],_0x31887f);else{if(_0x422af8=='edit'){if(!_0x1dd249)return _0x19d740[_0x31fb13(0x191)][_0x31fb13(0x135)](_0xb4f4e3,_0x31fb13(0x1cb));dbMusicPlaylistTable[_0x31fb13(0x184)](_0x19d740['app'][_0x31fb13(0x180)],_0x31887f,_0x1dd249);}}}else return _0x19d740[_0x31fb13(0x191)]['returnErrMsg'](_0xb4f4e3,'operation\x20error');}return _0xb4f4e3[_0x31fb13(0x18b)]({'code':0x0});}),router[_0x4c3a88(0x13a)](_0x4c3a88(0x16d),(_0x1a19ff,_0x4eb5fc,_0x40de31)=>{const _0x4b580f=_0x4c3a88;let _0x1d55b3=_0x1a19ff[_0x4b580f(0x125)]['musicIndexId'],_0x44b4d6=_0x1a19ff[_0x4b580f(0x125)][_0x4b580f(0x18d)];if(!_0x1d55b3||!_0x44b4d6)return _0x1a19ff[_0x4b580f(0x191)]['returnErrMsg'](_0x4eb5fc,_0x4b580f(0x179));let _0x13d52f=dbMusicPlaylistTable['getPlaylistById'](_0x1a19ff[_0x4b580f(0x191)]['dbFileIndex'],_0x44b4d6);if(!_0x13d52f)return _0x1a19ff[_0x4b580f(0x191)]['returnErrMsg'](_0x4eb5fc,_0x4b580f(0x1b0));let _0x317983=_0x1a19ff[_0x4b580f(0x125)]['operation'];if(_0x317983==_0x4b580f(0x136)){function _0x2c66c6(_0xd00c3e){const _0xa34b7f=_0x4b580f;let _0x2a3435=dbMusicIndexTable[_0xa34b7f(0x1d6)](_0x1a19ff['app'][_0xa34b7f(0x180)],_0xd00c3e);if(!_0x2a3435)return;if(_0x2a3435[_0xa34b7f(0x1b2)]==0x1){dbMusicPlaylistTable[_0xa34b7f(0x1da)](_0x1a19ff[_0xa34b7f(0x191)][_0xa34b7f(0x180)],_0xd00c3e,_0x44b4d6);let _0x15b42a=Date['now']();_0x1a19ff[_0xa34b7f(0x191)][_0xa34b7f(0x180)][_0xa34b7f(0x133)](_0xa34b7f(0x1ac))['run'](_0x15b42a,_0x2a3435['id']);}else{let _0x21fe40=path['join'](_0x2a3435[_0xa34b7f(0x158)],_0x2a3435[_0xa34b7f(0x138)]),_0x5ca9c2=_0x1a19ff['app'][_0xa34b7f(0x180)][_0xa34b7f(0x133)]('SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?')[_0xa34b7f(0x199)](_0x21fe40,_0x21fe40+path[_0xa34b7f(0x15c)]+'%');for(let _0xdbb002 of _0x5ca9c2){dbMusicPlaylistTable['addMusicToPlaylist'](_0x1a19ff[_0xa34b7f(0x191)][_0xa34b7f(0x180)],_0xdbb002['id'],_0x44b4d6);}}}if(_0x1d55b3 instanceof Array)for(let _0x1f85dd of _0x1d55b3){_0x2c66c6(_0x1f85dd);}else _0x2c66c6(_0x1d55b3);}else{if(_0x317983==_0x4b580f(0x1d4)){if(_0x1d55b3 instanceof Array)for(let _0x43db23 of _0x1d55b3){dbMusicPlaylistTable['removeMusicFromPlaylist'](_0x1a19ff[_0x4b580f(0x191)]['dbFileIndex'],_0x43db23,_0x44b4d6);}else dbMusicPlaylistTable[_0x4b580f(0x152)](_0x1a19ff['app'][_0x4b580f(0x180)],_0x1d55b3,_0x44b4d6);}else return _0x1a19ff[_0x4b580f(0x191)]['returnErrMsg'](_0x4eb5fc,'operation\x20error');}return _0x4eb5fc[_0x4b580f(0x18b)]({'code':0x0,'data':{}});}),router['post'](_0x4c3a88(0x124),(_0x8837fb,_0x466b1f,_0x12360f)=>{const _0x59852c=_0x4c3a88;let _0x401402=_0x8837fb[_0x59852c(0x125)][_0x59852c(0x15b)],_0x4c7f07=_0x8837fb[_0x59852c(0x125)][_0x59852c(0x182)],_0x3db1c9=_0x59852c(0x14e),_0x15c3b9=_0x8837fb[_0x59852c(0x125)][_0x59852c(0x155)]??_0x59852c(0x138),_0x57da35=_0x8837fb[_0x59852c(0x125)][_0x59852c(0x12b)]??_0x59852c(0x141);if(dbMusicIndexTable['checkOrderParams'](_0x8837fb,_0x466b1f,_0x15c3b9,_0x57da35)!==!![])return;if(dbUserTable['doUserCanGet'](_0x8837fb,_0x466b1f,_0x3db1c9,_0x59852c(0x12a))==!![]){let _0x3d51e4=[];if(!_0x401402){let _0x1c5af0=[];_0x8837fb[_0x59852c(0x1c8)][_0x59852c(0x1ba)]==0x1?_0x1c5af0=dbSourceFolderTable['getPathByType'](_0x8837fb['app'][_0x59852c(0x178)],_0x3db1c9):_0x1c5af0=dbUserTable[_0x59852c(0x143)](_0x8837fb[_0x59852c(0x191)]['dbOther'],_0x8837fb[_0x59852c(0x1c8)]['username'],_0x3db1c9);if(_0x1c5af0)for(let _0x5cc693=0x0;_0x5cc693<_0x1c5af0[_0x59852c(0x145)];_0x5cc693++){_0x3d51e4['push']({'path':_0x1c5af0[_0x5cc693][_0x59852c(0x158)],'is_file':0x0,'filename':path['basename'](_0x1c5af0[_0x5cc693][_0x59852c(0x158)]),'root':!![]});}}else{let _0x10f74f=[];if(_0x8837fb[_0x59852c(0x1c8)]['is_admin']!=0x1){if(dbUserTable[_0x59852c(0x1d2)](_0x8837fb,_0x466b1f,_0x3db1c9,_0x59852c(0x12a),_0x401402)!==!![])return;}_0x401402=path[_0x59852c(0x175)](_0x401402);let _0x103741=_0x59852c(0x196);_0x10f74f[_0x59852c(0x14b)](_0x401402),_0x103741+=_0x59852c(0x163);if(_0x4c7f07){let _0x240467=_0x59852c(0x1be);_0x103741+=_0x240467,_0x10f74f['push']('%'+_0x4c7f07+'%'),_0x10f74f[_0x59852c(0x14b)]('%'+_0x4c7f07+'%');}let _0xdd181b='\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre';_0x103741+='ORDER\x20BY\x20'+_0x15c3b9+'\x20'+_0x57da35,_0x3d51e4=_0x8837fb[_0x59852c(0x191)]['dbFileIndex'][_0x59852c(0x133)](_0x59852c(0x147)+_0xdd181b+_0x59852c(0x187)+_0x103741)['all'](_0x10f74f);}for(let _0xa78319 of _0x3d51e4){_0xa78319[_0x59852c(0x192)]=dbMusicFavorite[_0x59852c(0x16e)](_0x8837fb['app'][_0x59852c(0x180)],_0xa78319['id'],_0x8837fb['currentUser']['id'])?'1':'0';}let _0xdf0cd6=path[_0x59852c(0x15c)],_0x1dfafa={'code':0x0,'data':_0x3d51e4,'sep':_0xdf0cd6};return _0x466b1f['json'](_0x1dfafa);}}),module['exports']=router;