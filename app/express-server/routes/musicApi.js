const _0x464e49=_0x3c16;(function(_0x355ff8,_0x28d74a){const _0x4c4e9b=_0x3c16,_0x50f1d0=_0x355ff8();while(!![]){try{const _0x4b3e5b=parseInt(_0x4c4e9b(0xda))/0x1+-parseInt(_0x4c4e9b(0x12a))/0x2*(parseInt(_0x4c4e9b(0xe1))/0x3)+parseInt(_0x4c4e9b(0x160))/0x4*(-parseInt(_0x4c4e9b(0x108))/0x5)+-parseInt(_0x4c4e9b(0xee))/0x6*(-parseInt(_0x4c4e9b(0x14f))/0x7)+parseInt(_0x4c4e9b(0x105))/0x8+-parseInt(_0x4c4e9b(0x135))/0x9+parseInt(_0x4c4e9b(0x109))/0xa*(-parseInt(_0x4c4e9b(0xb5))/0xb);if(_0x4b3e5b===_0x28d74a)break;else _0x50f1d0['push'](_0x50f1d0['shift']());}catch(_0xc2317d){_0x50f1d0['push'](_0x50f1d0['shift']());}}}(_0x2e08,0x4ae52));let express=require(_0x464e49(0xae)),router=express['Router'](),config=require(_0x464e49(0xcc)),path=require(_0x464e49(0xd3)),fs=require('fs'),dbMusicIndexTable=require('../../db/dbMusicIndexTable'),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbMusicPlaylistTable=require(_0x464e49(0xea)),dbMusicFavorite=require(_0x464e49(0x128)),jsmediatags=require(_0x464e49(0xeb));const dbUserTable=require(_0x464e49(0xf7));let musicUitls=require('../../utils/musicUtil'),lyricUtils=require(_0x464e49(0x148)),sharpUtil=require(_0x464e49(0x130));const dbSourceFolderTable=require(_0x464e49(0xaa));function _0x3c16(_0x5c9c33,_0x190e83){const _0x2e0878=_0x2e08();return _0x3c16=function(_0x5a3109,_0x28a3bd){_0x5a3109=_0x5a3109-0xa1;let _0x12fd82=_0x2e0878[_0x5a3109];return _0x12fd82;},_0x3c16(_0x5c9c33,_0x190e83);}function _0x2e08(){const _0x32edc0=['lyrics_get_state','search','platform','message','../../db/dbUserTable','deleteFavorite','getMusicList','prepare','letterIndex','count','searchMusicAlbum','operation\x20error','image','getMusicIndex','playlist','INDEX_TABLE_NAME_MUSIC','currentUser','orderField/orderType\x20error','2609608gIldPu','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','all','95pfelej','587030IRyyXD','isSearch','orderField','length','filename','/saveLyric','searchStr','whereStr','recentAddList','asc','getGroupList','checkOrderParams','returnErrMsg','removeMusicFromPlaylist','ORDER\x20BY\x20','\x20path=?\x20AND\x20','album','genre','getMusicSameNameCover','artistList','includes','\x20is_file=1','getTime','.lrc','/getMusicIndexFileTree','run','searchMusicName','base64','searchLyric','push','\x20AND\x20album=?\x20','../../db/dbMusicFavorite','power_get','32DnRBCe','is_admin','albumList','need\x20musicIndexId\x20and\x20playlistId',',f.artist\x20','filePath','../utils/sharpUtils','dirname','addMusicToPlaylist','lrc','paramsList','732141FqTyrN','edit','getById','indexId','addFavorite','need\x20playlistId','utf-8','/operationPlaylist','stringify','transStringToUtf8','SELECT\x20','\x20LIMIT\x20?\x20OFFSET\x20?\x20','file','lyric','size','list','data','favorite_time','add','../../utils/music/lyricUtils','status','musicIsFavorite','favorite','from','delete','getMusicListCount','1042090WXIqGy','get','sha256','extname','\x20order\x20by\x20m.update_time\x20DESC\x20','cover_path','tags','getPlaylistCover','APIC','music','need\x20\x27name\x27','getPlaylistList','\x20order\x20by\x20f.album_fl\x20','genTinyFile','music_count','Lyric\x20is\x20null','trim','52044dXAdmZ','title','\x20AND\x20','operation','existsSync','desc','query','name','lyricList','musicIndexId','play_count','updateByFiled','../../db/dbSourceFolderTable','end','temp.','last_play_time','express','albumCount','join','dbOther','/getMusicHomeData','../../myConfig/urlConfig','picture','22mrSjiA','year','\x20(type=3\x20OR\x20is_file=0)','artist','check_time','getAllFavoriteByWhere','duration','writeFile','skipCount','dbFileIndex',',f.title\x20','getFavorite','\x20order\x20by\x20f.','getUserPower','json','UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?','createPlaylist','orderType','app','parent','body','play_count\x20desc','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','../../myConfig/config','playlistId','\x20order\x20by\x20f.title_fl\x20','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre','inner','getCoverByField','post','path','file_cover_path','apiTokenKey','coverList','\x20order\x20by\x20f.artist_fl\x20','getUserPathWhere','doUserCanGet','291951DiqvZR','NO\x20MUSIC\x20INDEX','basename','playlistId\x20no\x20exists','sep','sendFile','maxPlayMusic','2679oWOjpf','read','recentMusic','getPlaylistById','replace','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','uid','axios','getFavoriteCount','../../db/dbMusicPlaylistTable','jsmediatags','abs','lyrics','6rcETbG','/getMusicCover','offset','groupField',',f.filename_fl\x20'];_0x2e08=function(){return _0x32edc0;};return _0x2e08();}let axios=require(_0x464e49(0xe8)),sha256=require(_0x464e49(0x151)),os=require('os');const urlConfig=require(_0x464e49(0xb3));function getFavoriteMusicList(_0x1b3a52,_0x585f4c,_0x44c757,_0x945937,_0x248c73,_0x24ad32,_0x586f4a){const _0x2c69cf=_0x464e49;let _0x3d84cc='',_0x4b55ec=[];_0x3d84cc+=_0x2c69cf(0x11e);_0x24ad32&&(_0x24ad32=_0x24ad32[_0x2c69cf(0xe5)]('\x27','')[_0x2c69cf(0xe5)]('â€™',''),_0x3d84cc+=_0x2c69cf(0xcb),_0x4b55ec['push']('%'+_0x24ad32+'%','%'+_0x24ad32+'%','%'+_0x24ad32+'%'));_0x586f4a&&(_0x3d84cc+='\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)',_0x4b55ec[_0x2c69cf(0x126)](_0x586f4a,_0x586f4a));if(_0x945937&&_0x248c73){if(_0x945937==_0x2c69cf(0xb8))_0x3d84cc+=_0x2c69cf(0xd7)+_0x248c73+_0x2c69cf(0x12e)+_0x248c73+'\x20';else{if(_0x945937==_0x2c69cf(0x119))_0x3d84cc+=_0x2c69cf(0x15b)+_0x248c73+',f.album\x20'+_0x248c73+'\x20';else{if(_0x945937==_0x2c69cf(0x161))_0x3d84cc+=_0x2c69cf(0xce)+_0x248c73+_0x2c69cf(0xbf)+_0x248c73+_0x2c69cf(0xf2)+_0x248c73+'\x20';else _0x945937==_0x2c69cf(0x146)?_0x3d84cc+='\x20order\x20by\x20m.update_time\x20'+_0x248c73+'\x20':_0x3d84cc+=_0x2c69cf(0xc1)+_0x945937+'\x20'+_0x248c73+'\x20';}}}else _0x3d84cc+=_0x2c69cf(0x153);return _0x3d84cc+=_0x2c69cf(0x140),_0x4b55ec[_0x2c69cf(0x126)](_0x585f4c),_0x4b55ec['push'](_0x44c757),result=dbMusicFavorite[_0x2c69cf(0xba)](_0x1b3a52['app'][_0x2c69cf(0xbe)],_0x1b3a52[_0x2c69cf(0x103)]['id'],_0x3d84cc,'*',_0x4b55ec),result=dealMusicList(_0x1b3a52,result),result;}function dealMusicList(_0x5b9d3e,_0xee795d){const _0x4eef56=_0x464e49;for(let _0x5561d2 of _0xee795d){_0x5561d2[_0x4eef56(0x14b)]=dbMusicFavorite[_0x4eef56(0x14a)](_0x5b9d3e[_0x4eef56(0xc7)][_0x4eef56(0xbe)],_0x5561d2['id'],_0x5b9d3e[_0x4eef56(0x103)]['id'])?'1':'0';if(!_0x5561d2[_0x4eef56(0x154)]){let _0x2bc269=!![];_0x5561d2[_0x4eef56(0xd4)]&&fs[_0x4eef56(0xa2)](_0x5561d2[_0x4eef56(0xd4)])&&(_0x2bc269=![]),_0x2bc269&&(_0x5561d2[_0x4eef56(0xd4)]=musicUitls[_0x4eef56(0x11b)](_0x5b9d3e[_0x4eef56(0xc7)][_0x4eef56(0xbe)],_0x5561d2));}_0x5561d2[_0x4eef56(0x12f)]=path[_0x4eef56(0xb0)](_0x5561d2[_0x4eef56(0xd3)],_0x5561d2['filename']),delete _0x5561d2[_0x4eef56(0xd3)];}return _0xee795d;}function getMusicListByParams(_0xaf32fa,_0x669b99,_0x28f76e,_0x36181d,_0x42c088,_0x33279a,_0x387d0b,_0x4b1924,_0xd3cbf3,_0x3c08d8,_0x3a148b,_0x34c8d9,_0x4556ab){const _0x4e7479=_0x464e49;let _0x585e9d=_0xaf32fa[_0x4e7479(0xc7)][_0x4e7479(0xbe)],_0x4e69e3=[];return _0x4e69e3=dbMusicIndexTable[_0x4e7479(0xf9)](_0x585e9d,_0x669b99,_0x28f76e,_0x36181d,_0x42c088,_0x33279a,_0x387d0b,_0x4b1924,_0xd3cbf3,_0x3c08d8,_0x34c8d9,_0x3a148b,_0x4556ab),_0x4e69e3=dealMusicList(_0xaf32fa,_0x4e69e3),_0x4e69e3;}router[_0x464e49(0xd2)](_0x464e49(0xb2),(_0x4d1563,_0x555f0f,_0x4db4cf)=>{const _0xe8e247=_0x464e49;let _0x5cbd73=_0x4d1563[_0xe8e247(0xc7)][_0xe8e247(0xbe)],_0x98b4b=_0x4d1563[_0xe8e247(0xc9)][_0xe8e247(0xfc)]?_0x4d1563[_0xe8e247(0xc9)][_0xe8e247(0xfc)]:0xc,_0x29994d=_0x4d1563[_0xe8e247(0xc9)]['albumCount']?_0x4d1563[_0xe8e247(0xc9)][_0xe8e247(0xaf)]:0xc,_0x29de2c=dbUserTable[_0xe8e247(0xd8)](_0x4d1563,_0xe8e247(0x158),_0xe8e247(0x129),!![]);if(_0x4d1563[_0xe8e247(0x103)][_0xe8e247(0x12b)]!=0x1&&!_0x29de2c[_0xe8e247(0x110)])return _0x555f0f[_0xe8e247(0xc3)]({'code':0x0,'data':null});let _0x428fad=getMusicListByParams(_0x4d1563,_0x29de2c,_0x98b4b,0x0,'last_play_time',_0xe8e247(0xa3)),_0x258996=getMusicListByParams(_0x4d1563,_0x29de2c,_0x98b4b,0x0,_0xe8e247(0xca),',id\x20asc'),_0x1cccfc=getMusicListByParams(_0x4d1563,_0x29de2c,_0x98b4b,0x0,'id',_0xe8e247(0xa3)),_0xc9b786=dbMusicIndexTable[_0xe8e247(0x113)](_0x5cbd73,_0x29de2c,_0xe8e247(0xb8),_0x29994d,0x0,_0xe8e247(0xad),_0xe8e247(0xa3));for(let _0x316521 of _0xc9b786){let _0x24d9f4='\x20AND\x20artist=?\x20'+_0x29de2c[_0xe8e247(0x110)],_0x1cb543=[_0x316521[_0xe8e247(0xb8)],..._0x29de2c['paramsList']];_0x316521[_0xe8e247(0xd6)]=dbMusicIndexTable[_0xe8e247(0xd1)](_0x4d1563[_0xe8e247(0xc7)][_0xe8e247(0xbe)],_0x24d9f4,_0x1cb543);}let _0x1a1878=dbMusicIndexTable[_0xe8e247(0x113)](_0x5cbd73,_0x29de2c,'album',_0x29994d,0x0,'play_count',_0xe8e247(0xa3));for(let _0x4ba350 of _0x1a1878){let _0x4e84fd=_0xe8e247(0x127)+_0x29de2c[_0xe8e247(0x110)],_0x2685a7=[_0x4ba350['album'],..._0x29de2c['paramsList']];_0x4ba350[_0xe8e247(0xd6)]=dbMusicIndexTable[_0xe8e247(0xd1)](_0x4d1563[_0xe8e247(0xc7)][_0xe8e247(0xbe)],_0x4e84fd,_0x2685a7);}let _0x1be02d={};return _0x428fad&&_0x428fad[_0xe8e247(0x10c)]>0x0&&(_0x1be02d[_0xe8e247(0xe3)]=_0x428fad),_0x258996&&_0x258996[_0xe8e247(0x10c)]>0x0&&(_0x1be02d[_0xe8e247(0xe0)]=_0x258996),_0x1cccfc&&_0x1cccfc['length']>0x0&&(_0x1be02d[_0xe8e247(0x111)]=_0x1cccfc),_0xc9b786&&_0xc9b786[_0xe8e247(0x10c)]>0x0&&(_0x1be02d[_0xe8e247(0x11c)]=_0xc9b786),_0x1a1878&&_0x1a1878['length']>0x0&&(_0x1be02d[_0xe8e247(0x12c)]=_0x1a1878),_0x555f0f['json']({'code':0x0,'data':_0x1be02d,'platform':os[_0xe8e247(0xf5)]()});}),router[_0x464e49(0xd2)]('/getMusicList',(_0x9d2fd,_0x5ac3e8,_0x379907)=>{const _0x3ae634=_0x464e49;let _0x58b4a3=_0x9d2fd[_0x3ae634(0xc9)][_0x3ae634(0xfc)]||0x32,_0x168f30=_0x9d2fd['body'][_0x3ae634(0xf0)]||0x0,_0x19c34d=_0x9d2fd['body'][_0x3ae634(0x119)],_0x1b4f87=_0x9d2fd[_0x3ae634(0xc9)][_0x3ae634(0xb6)],_0x308810=_0x9d2fd[_0x3ae634(0xc9)][_0x3ae634(0xb8)],_0x5df9e7=_0x9d2fd[_0x3ae634(0xc9)][_0x3ae634(0x11a)],_0x468aee=_0x9d2fd[_0x3ae634(0xc9)][_0x3ae634(0x10b)]||'last_play_time',_0x4f010e=_0x9d2fd[_0x3ae634(0xc9)][_0x3ae634(0xc6)]||_0x3ae634(0xa3),_0xf38a17=[_0x3ae634(0x144),_0x3ae634(0x14b),_0x3ae634(0x101)],_0x218241=_0x9d2fd['body']['listType']||_0x3ae634(0x144),_0x5d0e9a=_0x9d2fd[_0x3ae634(0xc9)][_0x3ae634(0xf4)],_0x4f8c5e=_0x9d2fd[_0x3ae634(0xc9)][_0x3ae634(0xfb)],_0x13ad5f=_0x9d2fd['body'][_0x3ae634(0xcd)];if(dbMusicIndexTable[_0x3ae634(0x114)](_0x9d2fd,_0x5ac3e8,_0x468aee,_0x4f010e)!==!![])return;if(_0x218241=='playlist'){if(!_0x13ad5f)return _0x9d2fd[_0x3ae634(0xc7)][_0x3ae634(0x115)](_0x5ac3e8,_0x3ae634(0x13a));}!_0xf38a17['includes'](_0x218241)&&(_0x218241='list');_0x58b4a3>0x1f4&&(_0x58b4a3=0x1f4);let _0x4cbb18=dbUserTable[_0x3ae634(0xd8)](_0x9d2fd,_0x3ae634(0x158),_0x3ae634(0x129),!![]);if(_0x9d2fd[_0x3ae634(0x103)][_0x3ae634(0x12b)]!=0x1&&!_0x4cbb18[_0x3ae634(0x110)])return _0x5ac3e8[_0x3ae634(0xc3)]({'code':0x0,'data':null});let _0x3d0e08=[];if(_0x218241==_0x3ae634(0x101)||_0x218241=='list')_0x3d0e08=getMusicListByParams(_0x9d2fd,_0x4cbb18,_0x58b4a3,_0x168f30,_0x468aee,_0x4f010e,_0x19c34d,_0x1b4f87,_0x308810,_0x5df9e7,_0x5d0e9a,_0x13ad5f,_0x4f8c5e);else _0x218241==_0x3ae634(0x14b)&&(_0x3d0e08=getFavoriteMusicList(_0x9d2fd,_0x58b4a3,_0x168f30,_0x468aee,_0x4f010e,_0x5d0e9a,_0x4f8c5e));let _0x69cee4={'code':0x0,'data':_0x3d0e08};if(_0x218241==_0x3ae634(0x14b))_0x69cee4[_0x3ae634(0x15d)]=dbMusicFavorite[_0x3ae634(0xe9)](_0x9d2fd[_0x3ae634(0xc7)][_0x3ae634(0xbe)],_0x9d2fd[_0x3ae634(0x103)]['id']);else{if(_0x218241==_0x3ae634(0x144))_0x69cee4[_0x3ae634(0x15d)]=dbMusicIndexTable[_0x3ae634(0x14e)](_0x9d2fd[_0x3ae634(0xc7)]['dbFileIndex'],_0x4cbb18,_0x19c34d,_0x1b4f87,_0x308810,_0x5df9e7);else _0x218241==_0x3ae634(0x101)&&(_0x69cee4[_0x3ae634(0x15d)]=dbMusicPlaylistTable['getPlaylistMusicCount'](_0x9d2fd[_0x3ae634(0xc7)][_0x3ae634(0xbe)],_0x13ad5f));}return _0x5ac3e8['json'](_0x69cee4);}),router[_0x464e49(0xd2)]('/getMusicDetail',(_0x4b93fa,_0x1cebd4,_0x340bc6)=>{const _0x337ce9=_0x464e49;let _0x567935=_0x4b93fa[_0x337ce9(0xc9)]['id'],_0x2601eb=dbFileIndexTable[_0x337ce9(0x137)](_0x4b93fa[_0x337ce9(0xc7)]['dbFileIndex'],_0x567935,dbFileIndexTable[_0x337ce9(0x102)]);if(!_0x2601eb)return _0x4b93fa[_0x337ce9(0xc7)][_0x337ce9(0x115)](_0x1cebd4,_0x337ce9(0xdb));if(dbUserTable[_0x337ce9(0xd9)](_0x4b93fa,_0x1cebd4,'music',_0x337ce9(0x129),_0x2601eb[_0x337ce9(0xd3)])==!![]){let _0x269d8f=_0x4b93fa[_0x337ce9(0x103)]['id'],_0x4aa763=dbMusicFavorite[_0x337ce9(0xc0)](_0x4b93fa[_0x337ce9(0xc7)][_0x337ce9(0xbe)],_0x269d8f,_0x567935);_0x2601eb['file_cover_path']=musicUitls['getMusicSameNameCover'](_0x4b93fa[_0x337ce9(0xc7)][_0x337ce9(0xbe)],_0x2601eb),_0x2601eb[_0x337ce9(0x14b)]=_0x4aa763?0x1:0x0,getLyrics(_0x2601eb,_0x34268b=>{const _0x3b21c2=_0x337ce9;return _0x2601eb[_0x3b21c2(0xa6)]=_0x34268b,_0x1cebd4[_0x3b21c2(0xc3)]({'code':0x0,'data':_0x2601eb});});}});function updateIndexLyric(_0xcd7b9f,_0xe677d2,_0x4f0831,_0x13c602){const _0x4d8185=_0x464e49;if(_0x4f0831&&_0x4f0831[_0x4d8185(0x10c)]>0x0){let _0xd4a6c5=_0x13c602[_0x4d8185(0x10d)][_0x4d8185(0xe5)](path[_0x4d8185(0x152)](_0x13c602[_0x4d8185(0x10d)]),''),_0x528a95=_0xd4a6c5+_0x4d8185(0x120),_0xb4f1d9=path[_0x4d8185(0xb0)](_0x13c602[_0x4d8185(0xd3)],_0x528a95);fs['writeFile'](_0xb4f1d9,_0x4f0831,_0x4d8185(0x13b),_0x342f5f=>{if(!_0x342f5f){}});}let _0x4f030b=JSON['stringify']({'lyrics':_0x4f0831?_0x4f0831:''});_0xcd7b9f['prepare'](_0x4d8185(0xc4))[_0x4d8185(0x122)](_0xe677d2,_0x4f030b,_0x13c602['id']);}router[_0x464e49(0xd2)](_0x464e49(0x10e),(_0x206a2a,_0x561d2b,_0x98aaea)=>{const _0x47add3=_0x464e49;let _0x16ffa1=_0x206a2a[_0x47add3(0xc9)]['id'],_0x3586bb=_0x206a2a['body'][_0x47add3(0x142)],_0x4c5793=dbFileIndexTable['getById'](_0x206a2a['app']['dbFileIndex'],_0x16ffa1,dbFileIndexTable[_0x47add3(0x102)]);if(!_0x4c5793)return _0x206a2a[_0x47add3(0xc7)][_0x47add3(0x115)](_0x561d2b,_0x47add3(0xdb));if(!_0x3586bb)return _0x206a2a[_0x47add3(0xc7)][_0x47add3(0x115)](_0x561d2b,_0x47add3(0x15e));if(dbUserTable['doUserCanGet'](_0x206a2a,_0x561d2b,_0x47add3(0x158),'power_add',_0x4c5793['path'])==!![])return updateIndexLyric(_0x206a2a[_0x47add3(0xc7)]['dbFileIndex'],0x1,_0x3586bb,_0x4c5793),_0x561d2b[_0x47add3(0xc3)]({'code':0x0});}),router[_0x464e49(0xd2)]('/searchLyric',(_0x271122,_0x4bb87d,_0x1f42bc)=>{const _0x10b2e9=_0x464e49;let _0x5a5b6c=_0x271122[_0x10b2e9(0xc9)]['id'],_0x57d2d3=dbFileIndexTable[_0x10b2e9(0x137)](_0x271122['app'][_0x10b2e9(0xbe)],_0x5a5b6c,dbFileIndexTable[_0x10b2e9(0x102)]);if(!_0x57d2d3)return _0x271122[_0x10b2e9(0xc7)][_0x10b2e9(0x115)](_0x4bb87d,'NO\x20MUSIC\x20INDEX');let _0x2dd77a=_0x271122[_0x10b2e9(0xc9)][_0x10b2e9(0x123)],_0x192c01=_0x271122[_0x10b2e9(0xc9)]['searchMusicArtist'],_0x55ccce=_0x271122[_0x10b2e9(0xc9)][_0x10b2e9(0xfd)],_0x6d177f=_0x271122[_0x10b2e9(0xc9)][_0x10b2e9(0x10a)];if(dbUserTable[_0x10b2e9(0xd9)](_0x271122,_0x4bb87d,'music',_0x10b2e9(0x129),_0x57d2d3[_0x10b2e9(0xd3)])==!![]){if(_0x57d2d3[_0x10b2e9(0xf3)]==0x1&&!_0x6d177f)return _0x4bb87d['json']({'code':0x0,'data':[_0x57d2d3['lyrics']]});let _0x138359=_0x271122[_0x10b2e9(0xc9)][_0x10b2e9(0xbd)]||0x0;if(!_0x2dd77a||!_0x2dd77a[_0x10b2e9(0x15f)]())return _0x4bb87d[_0x10b2e9(0xc3)]([]);let _0x3233b1={'searchMusicName':_0x2dd77a,'searchMusicArtist':_0x192c01,'searchMusicAlbum':_0x55ccce,'isSearch':_0x6d177f,'skipCount':_0x138359,'token':sha256(_0x2dd77a+config[_0x10b2e9(0xd5)])};lyricUtils[_0x10b2e9(0x125)](_0x3233b1)['then'](_0x26bf2a=>{const _0x858301=_0x10b2e9;if(_0x26bf2a){if(_0x26bf2a['length']>0x0&&!_0x6d177f){let _0x2d12de=![],_0xc74703=0x14,_0x4aae8b=0x64,_0x3b1110=null;for(let _0x155364 of _0x26bf2a){if(_0x155364[_0x858301(0xbb)]){let _0x2b2b2a=_0x155364['duration']/0x3e8,_0x3f2331=Math[_0x858301(0xec)](_0x2b2b2a-_0x57d2d3[_0x858301(0xbb)]);_0x3f2331<_0x4aae8b&&(_0x4aae8b=_0x3f2331,_0x3b1110=_0x155364[_0x858301(0x133)]?_0x155364['lrc']:'');}}return _0x4aae8b<_0xc74703?(_0x2d12de=!![],_0x57d2d3[_0x858301(0xed)]=JSON[_0x858301(0x13d)]({'lyrics':_0x3b1110?_0x3b1110:''}),updateIndexLyric(_0x271122[_0x858301(0xc7)][_0x858301(0xbe)],0x1,_0x3b1110,_0x57d2d3)):updateIndexLyric(_0x271122[_0x858301(0xc7)][_0x858301(0xbe)],0x1,'',_0x57d2d3),_0x4bb87d[_0x858301(0xc3)]({'code':0x0,'data':_0x2d12de&&_0x57d2d3[_0x858301(0xed)]?[_0x57d2d3[_0x858301(0xed)]]:[]});}else return _0x4bb87d[_0x858301(0xc3)]({'code':0x0,'data':_0x26bf2a});}})['catch'](_0x406712=>{const _0x4cd79c=_0x10b2e9;return _0x271122['app'][_0x4cd79c(0x115)](_0x4bb87d,_0x406712[_0x4cd79c(0xf6)]);});}});function getLyrics(_0x506a60,_0x2e6896){const _0x187588=_0x464e49;let _0x4f83cc=[];try{_0x506a60[_0x187588(0xed)]&&_0x506a60[_0x187588(0xed)]['length']>0xa&&_0x4f83cc['push']({'type':_0x187588(0xd0),'content':_0x506a60['lyrics']});let _0x30155f=_0x506a60[_0x187588(0x10d)][_0x187588(0xe5)](path[_0x187588(0x152)](_0x506a60['filename']),''),_0x3f9e67=_0x30155f+_0x187588(0x120),_0x126bd4=path[_0x187588(0xb0)](_0x506a60['path'],_0x3f9e67);fs['existsSync'](_0x126bd4)?fs['readFile'](_0x126bd4,(_0x44b944,_0x22d824)=>{const _0x4ddc28=_0x187588;let _0x5ae9b2=musicUitls[_0x4ddc28(0x13e)](_0x22d824['toString'](),_0x126bd4);_0x4f83cc[_0x4ddc28(0x126)]({'type':_0x4ddc28(0x141),'filename':_0x3f9e67,'content':_0x5ae9b2}),_0x2e6896(_0x4f83cc);}):_0x2e6896(_0x4f83cc);}catch(_0x20414a){console['log'](_0x20414a),_0x2e6896(_0x4f83cc);}}router[_0x464e49(0xd2)]('/musicFavorite',(_0x153158,_0x59a060,_0xcc6944)=>{const _0x1b1fc4=_0x464e49;let _0x24690f=_0x153158[_0x1b1fc4(0x103)]['id'];function _0x3032e4(_0x322276){const _0x5f15d9=_0x1b1fc4;let _0x2270f6=dbFileIndexTable['getById'](_0x153158['app'][_0x5f15d9(0xbe)],_0x322276,dbFileIndexTable[_0x5f15d9(0x102)]);if(!_0x2270f6)return;let _0x2de34b=new Date()[_0x5f15d9(0x11f)]();_0x153158[_0x5f15d9(0xc7)][_0x5f15d9(0xbe)][_0x5f15d9(0xfa)](_0x5f15d9(0x106))[_0x5f15d9(0x122)](_0x2de34b,_0x322276),dbMusicFavorite[_0x5f15d9(0x139)](_0x153158['app'][_0x5f15d9(0xbe)],_0x24690f,_0x322276);}if(_0x153158['body'][_0x1b1fc4(0xa7)]instanceof Array){let _0xe5f6b=_0x153158[_0x1b1fc4(0xc9)][_0x1b1fc4(0xa1)];if(_0xe5f6b=='add')for(let _0x3eb2fb of _0x153158[_0x1b1fc4(0xc9)]['musicIndexId']){_0x3032e4(_0x3eb2fb);}else{if(_0xe5f6b==_0x1b1fc4(0x14d))for(let _0x5c1d02 of _0x153158[_0x1b1fc4(0xc9)]['musicIndexId']){dbMusicFavorite[_0x1b1fc4(0xf8)](_0x153158[_0x1b1fc4(0xc7)][_0x1b1fc4(0xbe)],_0x24690f,_0x5c1d02);}}return _0x59a060[_0x1b1fc4(0xc3)]({'code':0x0});}else{let _0x45bea1=parseInt(_0x153158['body']['musicIndexId']),_0x3bf0b9=dbMusicFavorite[_0x1b1fc4(0xc0)](_0x153158[_0x1b1fc4(0xc7)][_0x1b1fc4(0xbe)],_0x24690f,_0x45bea1),_0x1cca09=0x0;return _0x3bf0b9?dbMusicFavorite['deleteFavorite'](_0x153158['app']['dbFileIndex'],_0x24690f,_0x45bea1):(_0x1cca09=0x1,_0x3032e4(_0x45bea1)),_0x59a060[_0x1b1fc4(0xc3)]({'code':0x0,'favorite':_0x1cca09});}}),router[_0x464e49(0x150)](_0x464e49(0xef),(_0x1d7bb1,_0x1d6b70,_0x3e9706)=>{const _0x53fed9=_0x464e49;let _0x227698=_0x1d7bb1[_0x53fed9(0xa4)][_0x53fed9(0x138)],_0x28cf22=dbMusicIndexTable['getMusicIndex'](_0x1d7bb1[_0x53fed9(0xc7)][_0x53fed9(0xbe)],_0x227698),_0x50b348=_0x1d7bb1['query'][_0x53fed9(0x143)];!_0x50b348&&(_0x50b348=0x200);if(!_0x28cf22||_0x28cf22&&!_0x28cf22['cover_path'])return _0x1d6b70['status'](0x194)[_0x53fed9(0xab)]();if(dbUserTable[_0x53fed9(0xd9)](_0x1d7bb1,_0x1d6b70,_0x53fed9(0x158),_0x53fed9(0x129),_0x28cf22['path'])==!![]){let _0x25d28b=path[_0x53fed9(0xb0)](_0x28cf22[_0x53fed9(0xd3)],_0x28cf22[_0x53fed9(0x10d)]),_0x4d6702=config['getMediaCoverCachePath'](_0x28cf22,_0x50b348);if(fs[_0x53fed9(0xa2)](_0x4d6702))return _0x1d6b70[_0x53fed9(0xdf)](_0x4d6702);jsmediatags[_0x53fed9(0xe2)](_0x25d28b,{'onSuccess':function(_0x562052){const _0x3bddd8=_0x53fed9;let _0x3b6588=_0x562052[_0x3bddd8(0x155)];var _0x414d7b;_0x3b6588[_0x3bddd8(0xb4)]&&_0x3b6588[_0x3bddd8(0xb4)][_0x3bddd8(0x145)]&&(_0x414d7b=_0x3b6588[_0x3bddd8(0xb4)]['data']);!_0x414d7b&&_0x3b6588['APIC']&&_0x3b6588[_0x3bddd8(0x157)][_0x3bddd8(0x145)]&&_0x3b6588[_0x3bddd8(0x157)][_0x3bddd8(0x145)][_0x3bddd8(0x145)]&&(_0x414d7b=_0x3b6588[_0x3bddd8(0x157)][_0x3bddd8(0x145)][_0x3bddd8(0x145)]);if(_0x414d7b){let _0x476713=path['join'](path[_0x3bddd8(0x131)](_0x4d6702),_0x3bddd8(0xac)+path[_0x3bddd8(0xdc)](_0x4d6702));fs[_0x3bddd8(0xbc)](_0x476713,Buffer[_0x3bddd8(0x14c)](_0x414d7b),{'encoding':_0x3bddd8(0x124)},function(_0x3a735c){const _0x370330=_0x3bddd8;if(!_0x3a735c)sharpUtil[_0x370330(0x15c)](_0x476713,path[_0x370330(0x131)](_0x4d6702),path['basename'](_0x4d6702),_0x370330(0xff),null,_0x1f4bef=>{const _0x4e9271=_0x370330;return dbMusicIndexTable[_0x4e9271(0xa9)](_0x1d7bb1[_0x4e9271(0xc7)][_0x4e9271(0xbe)],_0x28cf22['id'],_0x4e9271(0x154),_0x4d6702),fs['rm'](_0x476713,_0x2a965b=>{}),_0x1d6b70['sendFile'](_0x4d6702);},_0xfd8994=>{const _0x47ebe4=_0x370330;return _0x1d6b70[_0x47ebe4(0x149)](0x194)[_0x47ebe4(0xab)]();},_0x50b348);else return _0x1d6b70[_0x370330(0x149)](0x194)['end']();});}else return _0x1d6b70[_0x3bddd8(0x149)](0x194)[_0x3bddd8(0xab)]();},'onError':function(_0x1824c3){const _0x1f7672=_0x53fed9;return _0x1d6b70[_0x1f7672(0x149)](0x194)['end']();}});}}),router[_0x464e49(0xd2)]('/getGroupList',(_0x19eb2d,_0x1ac28d,_0x1abab9)=>{const _0x1d5295=_0x464e49;let _0x1b4e96=_0x19eb2d['body'][_0x1d5295(0xfc)]||0x32,_0x2da4a7=_0x19eb2d['body'][_0x1d5295(0xf0)]||0x0,_0x4e8c7f=_0x19eb2d[_0x1d5295(0xc9)][_0x1d5295(0xf1)]||_0x1d5295(0x119),_0x278ad1=_0x19eb2d[_0x1d5295(0xc9)][_0x1d5295(0x10b)]||_0x1d5295(0xb9),_0x4e1764=_0x19eb2d[_0x1d5295(0xc9)][_0x1d5295(0xc6)]||'desc',_0x3ac03a=_0x19eb2d[_0x1d5295(0xc9)]['search'],_0x1e389d=_0x19eb2d['body']['letterIndex'];if(dbMusicIndexTable[_0x1d5295(0x114)](_0x19eb2d,_0x1ac28d,_0x278ad1,_0x4e1764)!==!![])return;let _0x14bce1=[_0x1d5295(0xb9),_0x1d5295(0xa8),'last_play_time','filename','title',_0x1d5295(0x119),_0x1d5295(0xb8),'birthtime','id'],_0x388e3f=[_0x1d5295(0x112),_0x1d5295(0xa3)];if(!_0x14bce1[_0x1d5295(0x11d)](_0x278ad1)||!_0x388e3f['includes'](_0x4e1764))return _0x19eb2d['app'][_0x1d5295(0x115)](_0x1ac28d,_0x1d5295(0x104),_0x278ad1,_0x4e1764);let _0x82516f=dbUserTable[_0x1d5295(0xd8)](_0x19eb2d,_0x1d5295(0x158),_0x1d5295(0x129),!![]);if(_0x19eb2d[_0x1d5295(0x103)][_0x1d5295(0x12b)]!=0x1&&!_0x82516f['whereStr']&&_0x4e8c7f!=_0x1d5295(0x101))return _0x1ac28d[_0x1d5295(0xc3)]({'code':0x0,'data':null});let _0x3b3875=[];if(_0x4e8c7f==_0x1d5295(0x119)||_0x4e8c7f==_0x1d5295(0xb8)){_0x3b3875=dbMusicIndexTable[_0x1d5295(0x113)](_0x19eb2d['app'][_0x1d5295(0xbe)],_0x82516f,_0x4e8c7f,_0x1b4e96,_0x2da4a7,_0x278ad1,_0x4e1764,_0x3ac03a,_0x1e389d);for(let _0x264d7a of _0x3b3875){let _0x3202ec=_0x1d5295(0x162)+_0x4e8c7f+'=?\x20'+_0x82516f[_0x1d5295(0x110)],_0x1b742c=[_0x4e8c7f,..._0x82516f[_0x1d5295(0x134)]];_0x264d7a[_0x1d5295(0xd6)]=dbMusicIndexTable[_0x1d5295(0xd1)](_0x19eb2d[_0x1d5295(0xc7)]['dbFileIndex'],_0x3202ec,_0x1b742c);}}else{if(_0x4e8c7f==_0x1d5295(0x101)){_0x3b3875=dbMusicPlaylistTable[_0x1d5295(0x15a)](_0x19eb2d['app']['dbFileIndex'],_0x19eb2d[_0x1d5295(0x103)]['id'],_0x1b4e96,_0x2da4a7,'id',_0x1d5295(0xa3),_0x3ac03a);for(let _0x424cf1 of _0x3b3875){_0x424cf1['coverList']=dbMusicIndexTable[_0x1d5295(0x156)](_0x19eb2d[_0x1d5295(0xc7)][_0x1d5295(0xbe)],_0x424cf1['id']);}}}return _0x1ac28d[_0x1d5295(0xc3)]({'code':0x0,'data':_0x3b3875});}),router[_0x464e49(0xd2)](_0x464e49(0x13c),(_0x9a603b,_0x3a0c36,_0xf65bd7)=>{const _0x1dd7e7=_0x464e49;let _0x1fdada=_0x9a603b[_0x1dd7e7(0xc9)][_0x1dd7e7(0xa5)],_0xb64a09=_0x9a603b[_0x1dd7e7(0xc9)][_0x1dd7e7(0xa1)];if(_0xb64a09==_0x1dd7e7(0x147)){if(!_0x1fdada)return _0x9a603b[_0x1dd7e7(0xc7)][_0x1dd7e7(0x115)](_0x3a0c36,_0x1dd7e7(0x159));dbMusicPlaylistTable[_0x1dd7e7(0xc5)](_0x9a603b[_0x1dd7e7(0xc7)][_0x1dd7e7(0xbe)],_0x9a603b[_0x1dd7e7(0x103)]['id'],_0x1fdada);}else{if(_0xb64a09==_0x1dd7e7(0x136)||_0xb64a09=='delete'){let _0x3e0a74=_0x9a603b['body'][_0x1dd7e7(0xcd)],_0x1eb9c4=dbMusicPlaylistTable[_0x1dd7e7(0xe4)](_0x9a603b[_0x1dd7e7(0xc7)][_0x1dd7e7(0xbe)],_0x3e0a74),_0xe03d7c=![];(_0x9a603b[_0x1dd7e7(0x103)][_0x1dd7e7(0x12b)]==0x1||_0x1eb9c4[_0x1dd7e7(0xe7)]==_0x9a603b[_0x1dd7e7(0x103)]['id'])&&(_0xe03d7c=!![]);if(!_0xe03d7c)return _0x3a0c36['json']({'code':0x66});if(_0xb64a09==_0x1dd7e7(0x14d))dbMusicPlaylistTable['removePlaylist'](_0x9a603b['app'][_0x1dd7e7(0xbe)],_0x3e0a74);else{if(_0xb64a09==_0x1dd7e7(0x136)){if(!_0x1fdada)return _0x9a603b['app'][_0x1dd7e7(0x115)](_0x3a0c36,_0x1dd7e7(0x159));dbMusicPlaylistTable['updatePlaylist'](_0x9a603b[_0x1dd7e7(0xc7)][_0x1dd7e7(0xbe)],_0x3e0a74,_0x1fdada);}}}else return _0x9a603b[_0x1dd7e7(0xc7)][_0x1dd7e7(0x115)](_0x3a0c36,_0x1dd7e7(0xfe));}return _0x3a0c36[_0x1dd7e7(0xc3)]({'code':0x0});}),router[_0x464e49(0xd2)]('/operationPlaylistIndex',(_0x3b5049,_0x16dea0,_0x24c09c)=>{const _0x40c7c0=_0x464e49;let _0x238563=_0x3b5049[_0x40c7c0(0xc9)][_0x40c7c0(0xa7)],_0x4928b4=_0x3b5049[_0x40c7c0(0xc9)]['playlistId'];if(!_0x238563||!_0x4928b4)return _0x3b5049[_0x40c7c0(0xc7)]['returnErrMsg'](_0x16dea0,_0x40c7c0(0x12d));let _0x37a3e3=dbMusicPlaylistTable[_0x40c7c0(0xe4)](_0x3b5049[_0x40c7c0(0xc7)][_0x40c7c0(0xbe)],_0x4928b4);if(!_0x37a3e3)return _0x3b5049[_0x40c7c0(0xc7)][_0x40c7c0(0x115)](_0x16dea0,_0x40c7c0(0xdd));let _0x5bc76e=_0x3b5049[_0x40c7c0(0xc9)][_0x40c7c0(0xa1)];if(_0x5bc76e=='add'){function _0xa580bc(_0x17488a){const _0x5a4dac=_0x40c7c0;let _0x312d31=dbMusicIndexTable[_0x5a4dac(0x100)](_0x3b5049[_0x5a4dac(0xc7)][_0x5a4dac(0xbe)],_0x17488a);if(!_0x312d31)return;if(_0x312d31['is_file']==0x1){dbMusicPlaylistTable[_0x5a4dac(0x132)](_0x3b5049['app'][_0x5a4dac(0xbe)],_0x17488a,_0x4928b4);let _0x49d3aa=Date['now']();_0x3b5049['app']['dbFileIndex'][_0x5a4dac(0xfa)](_0x5a4dac(0x106))[_0x5a4dac(0x122)](_0x49d3aa,_0x312d31['id']);}else{let _0x2e7844=path[_0x5a4dac(0xb0)](_0x312d31[_0x5a4dac(0xd3)],_0x312d31[_0x5a4dac(0x10d)]),_0x36ef3b=_0x3b5049[_0x5a4dac(0xc7)]['dbFileIndex'][_0x5a4dac(0xfa)]('SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?')[_0x5a4dac(0x107)](_0x2e7844,_0x2e7844+path[_0x5a4dac(0xde)]+'%');for(let _0x24d0c8 of _0x36ef3b){dbMusicPlaylistTable[_0x5a4dac(0x132)](_0x3b5049[_0x5a4dac(0xc7)][_0x5a4dac(0xbe)],_0x24d0c8['id'],_0x4928b4);}}}if(_0x238563 instanceof Array)for(let _0x476857 of _0x238563){_0xa580bc(_0x476857);}else _0xa580bc(_0x238563);}else{if(_0x5bc76e=='delete'){if(_0x238563 instanceof Array)for(let _0x4b9de6 of _0x238563){dbMusicPlaylistTable[_0x40c7c0(0x116)](_0x3b5049['app']['dbFileIndex'],_0x4b9de6,_0x4928b4);}else dbMusicPlaylistTable['removeMusicFromPlaylist'](_0x3b5049[_0x40c7c0(0xc7)][_0x40c7c0(0xbe)],_0x238563,_0x4928b4);}else return _0x3b5049[_0x40c7c0(0xc7)]['returnErrMsg'](_0x16dea0,'operation\x20error');}return _0x16dea0[_0x40c7c0(0xc3)]({'code':0x0,'data':{}});}),router['post'](_0x464e49(0x121),(_0x1fc73c,_0x5bbadb,_0x280b7c)=>{const _0x48e439=_0x464e49;let _0x2e5437=_0x1fc73c[_0x48e439(0xc9)][_0x48e439(0xc8)],_0x5a811e=_0x1fc73c[_0x48e439(0xc9)][_0x48e439(0x10f)],_0x3fc0de=_0x48e439(0x158),_0x4fa6dd=_0x1fc73c[_0x48e439(0xc9)][_0x48e439(0x10b)]??_0x48e439(0x10d),_0x39fa8a=_0x1fc73c[_0x48e439(0xc9)][_0x48e439(0xc6)]??_0x48e439(0x112);if(dbMusicIndexTable['checkOrderParams'](_0x1fc73c,_0x5bbadb,_0x4fa6dd,_0x39fa8a)!==!![])return;if(dbUserTable[_0x48e439(0xd9)](_0x1fc73c,_0x5bbadb,_0x3fc0de,'power_get')==!![]){let _0xedb1e=[];if(!_0x2e5437){let _0x4e6fe6=[];_0x1fc73c[_0x48e439(0x103)][_0x48e439(0x12b)]==0x1?_0x4e6fe6=dbSourceFolderTable['getPathByType'](_0x1fc73c['app'][_0x48e439(0xb1)],_0x3fc0de):_0x4e6fe6=dbUserTable[_0x48e439(0xc2)](_0x1fc73c[_0x48e439(0xc7)][_0x48e439(0xb1)],_0x1fc73c[_0x48e439(0x103)]['username'],_0x3fc0de);if(_0x4e6fe6)for(let _0x41e181=0x0;_0x41e181<_0x4e6fe6[_0x48e439(0x10c)];_0x41e181++){_0xedb1e[_0x48e439(0x126)]({'path':_0x4e6fe6[_0x41e181]['path'],'is_file':0x0,'filename':path[_0x48e439(0xdc)](_0x4e6fe6[_0x41e181][_0x48e439(0xd3)]),'root':!![]});}}else{let _0x2fd9cf=[];if(_0x1fc73c[_0x48e439(0x103)][_0x48e439(0x12b)]!=0x1){if(dbUserTable[_0x48e439(0xd9)](_0x1fc73c,_0x5bbadb,_0x3fc0de,'power_get',_0x2e5437)!==!![])return;}_0x2e5437=path[_0x48e439(0xb0)](_0x2e5437);let _0x21facd=_0x48e439(0x118);_0x2fd9cf[_0x48e439(0x126)](_0x2e5437),_0x21facd+=_0x48e439(0xb7);if(_0x5a811e){let _0x1ae2eb=_0x48e439(0xe6);_0x21facd+=_0x1ae2eb,_0x2fd9cf[_0x48e439(0x126)]('%'+_0x5a811e+'%'),_0x2fd9cf[_0x48e439(0x126)]('%'+_0x5a811e+'%');}let _0x3093b0=_0x48e439(0xcf);_0x21facd+=_0x48e439(0x117)+_0x4fa6dd+'\x20'+_0x39fa8a,_0xedb1e=_0x1fc73c[_0x48e439(0xc7)][_0x48e439(0xbe)]['prepare'](_0x48e439(0x13f)+_0x3093b0+'\x20FROM\x20file_index_music\x20WHERE\x20'+_0x21facd)[_0x48e439(0x107)](_0x2fd9cf);}for(let _0x32f1e7 of _0xedb1e){_0x32f1e7[_0x48e439(0x14b)]=dbMusicFavorite[_0x48e439(0x14a)](_0x1fc73c[_0x48e439(0xc7)]['dbFileIndex'],_0x32f1e7['id'],_0x1fc73c[_0x48e439(0x103)]['id'])?'1':'0';}let _0x6fdadf=path[_0x48e439(0xde)],_0x32bdc6={'code':0x0,'data':_0xedb1e,'sep':_0x6fdadf};return _0x5bbadb[_0x48e439(0xc3)](_0x32bdc6);}}),module['exports']=router;