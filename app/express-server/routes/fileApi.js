const _0x107b11=_0x2647;(function(_0x4c3122,_0x44fde4){const _0x1d2838=_0x2647,_0xbf9a87=_0x4c3122();while(!![]){try{const _0x305b07=parseInt(_0x1d2838(0x184))/0x1+-parseInt(_0x1d2838(0x157))/0x2*(-parseInt(_0x1d2838(0x19c))/0x3)+-parseInt(_0x1d2838(0x171))/0x4+parseInt(_0x1d2838(0x136))/0x5*(parseInt(_0x1d2838(0x164))/0x6)+parseInt(_0x1d2838(0x177))/0x7+parseInt(_0x1d2838(0x179))/0x8*(parseInt(_0x1d2838(0x159))/0x9)+-parseInt(_0x1d2838(0x163))/0xa;if(_0x305b07===_0x44fde4)break;else _0xbf9a87['push'](_0xbf9a87['shift']());}catch(_0x427e45){_0xbf9a87['push'](_0xbf9a87['shift']());}}}(_0x33f3,0x2f23f));let express=require('express'),router=express['Router'](),path=require('path'),fs=require('fs');const sharp=require(_0x107b11(0x18f));let sharpUtil=require('../utils/sharpUtils'),exifUtil=require(_0x107b11(0x144)),fileUtil=require(_0x107b11(0x15d));function _0x2647(_0x21afc6,_0x456a2f){const _0x33f339=_0x33f3();return _0x2647=function(_0x26472c,_0x25bab7){_0x26472c=_0x26472c-0x12f;let _0x28e9ec=_0x33f339[_0x26472c];return _0x28e9ec;},_0x2647(_0x21afc6,_0x456a2f);}const config=require(_0x107b11(0x15a)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbFileOperationRecord=require(_0x107b11(0x19f)),dbUserTable=require('../../db/dbUserTable'),dbMusicIndexTable=require(_0x107b11(0x17a));let musicTransCodeUtil=require(_0x107b11(0x1a3));const encodingUtil=require('../../utils/encodingUtil');function getIndexTableName(_0x15b6ec){const _0x521d98=_0x107b11;let _0x511d48=dbFileIndexTable[_0x521d98(0x16c)](_0x15b6ec);return _0x511d48;}function getIndexObj(_0x536980,_0x9e8aa8){const _0x3c8c35=_0x107b11;let _0x503e6c=_0x536980['body'][_0x3c8c35(0x133)]||_0x536980[_0x3c8c35(0x13a)][_0x3c8c35(0x133)],_0xedbf9f=getIndexTableName(_0x503e6c);return dbFileIndexTable[_0x3c8c35(0x16e)](_0x536980[_0x3c8c35(0x193)][_0x3c8c35(0x146)],_0x9e8aa8,_0xedbf9f);}function _0x33f3(){const _0x191246=['LEVEL_MAIN_OPERATION','decodePath','isFile','Convert\x20to\x20utf8\x20','returnDealedFile','cachePath','STATE_FAIL','serverType','body','join','1631230SYMNRV','replace','dirname','dbOther','query','raw','is_file','fullPath','params\x20is\x20not\x20valid','raw_filename','quality','changes','utf8','STATE_SUC','exifr','filename','dbFileIndex','exifInfo','.MP4','deletePathAll','getFileHashName','code','get','/clearTinyImg','UPDATE\x20file_index_photo\x20SET\x20is_show=1\x20WHERE\x20path=?\x20AND\x20filename\x20=?','photo','stat','path','setHeader','includes','status','getTime','length','8906nfYENX','send','249381hlCwQe','../../myConfig/config','ignoreLivephoto','audio/mpeg','../utils/fileUtils','sendStatus','Unable\x20to\x20read\x20file','power_delete','addFileOperationRecord','returnFileError','3849300KaXKMB','6SAnnCs','power_get','imgTypeList','then','catch','log','music','existsSync','getIndexTableNameByType','image','getById','genTinyFile','run','888344gigETe','basename','size','/tinyImg*','toUpperCase','type','1178884qDkVDh','videoTypeList','8enphUH','../../db/dbMusicIndexTable','/getInfo','delete','doUserCanGet','post','headers','json','sep','/deleteFromDisk','video','139693eANNYr','download','updateById','getFileHashNameByPathAndStat','username','rawImgTypeList','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','bytes=0-1','maxPsdSize','prepare','extname','sharp','increasePlayCount','PSD文件过大，不生成缩略图','sendFile','app','Content-Disposition','ext','tiny_path','trash','indexId','pipe','set','push','93aAVbSQ','end','TYPE_DELETE','../../db/dbFileOperationRecord','toLowerCase','attachment;\x20filename*=UTF-8\x27\x27','.psd','../../utils/musicTransCodeUtil','/inOutTrash'];_0x33f3=function(){return _0x191246;};return _0x33f3();}router[_0x107b11(0x17e)](_0x107b11(0x1a4),(_0x12e08a,_0xc0fc8b,_0x158b1b)=>{const _0x55926d=_0x107b11;let _0xed8751=_0x12e08a['body']['ids'],_0x4bf3b8=_0x12e08a[_0x55926d(0x134)][_0x55926d(0x197)];if(dbUserTable[_0x55926d(0x17d)](_0x12e08a,_0xc0fc8b,_0x55926d(0x14f),_0x55926d(0x160))==!![]){if(_0xed8751&&_0xed8751[_0x55926d(0x156)]>0x0){let _0x6a5471='(';for(let _0x23e55c=0x0;_0x23e55c<_0xed8751['length'];_0x23e55c++){let _0x35cd38=getIndexObj(_0x12e08a,_0xed8751[_0x23e55c]);if(!_0x35cd38)continue;_0x35cd38[_0x55926d(0x13f)]!=null&&_0x35cd38['raw_filename']!=''&&_0x35cd38[_0x55926d(0x13c)]&&(_0x4bf3b8==0x1?_0x12e08a[_0x55926d(0x193)][_0x55926d(0x146)][_0x55926d(0x18d)](_0x55926d(0x14e))[_0x55926d(0x170)](_0x35cd38[_0x55926d(0x151)],_0x35cd38['raw_filename']):_0x12e08a[_0x55926d(0x193)][_0x55926d(0x146)][_0x55926d(0x18d)](_0x55926d(0x18a))[_0x55926d(0x170)](_0x35cd38[_0x55926d(0x151)],_0x35cd38['raw_filename'])),_0x6a5471+=_0xed8751[_0x23e55c],_0x23e55c!=_0xed8751[_0x55926d(0x156)]-0x1&&(_0x6a5471+=',');}_0x6a5471+=')';let _0x1452dc=dbFileIndexTable['inOutTrash'](_0x12e08a[_0x55926d(0x193)][_0x55926d(0x146)],_0x6a5471,_0x4bf3b8,getIndexTableName(_0x12e08a[_0x55926d(0x134)][_0x55926d(0x133)]));_0x1452dc[_0x55926d(0x141)]>0x0&&_0xc0fc8b['json']({'code':0x0,'count':_0x1452dc[_0x55926d(0x141)]});}else{_0xc0fc8b[_0x55926d(0x180)]({'code':0x1,'message':_0x55926d(0x13e)});return;}}}),router[_0x107b11(0x17e)](_0x107b11(0x182),(_0x5131f6,_0x1fc34a,_0x43960f)=>{const _0x9a06f8=_0x107b11;let _0x1d27a4=_0x5131f6[_0x9a06f8(0x134)]['ids'],_0x56366f=_0x5131f6[_0x9a06f8(0x134)][_0x9a06f8(0x133)],_0x3638b8=_0x5131f6[_0x9a06f8(0x134)]['deleteIndexFolder']==0x1,_0x45c50b=_0x5131f6['body'][_0x9a06f8(0x15b)]==0x1,_0x4820a5=_0x5131f6[_0x9a06f8(0x134)]['putInSystemTrash'],_0x46584b=getIndexTableName(_0x56366f);function _0x43d2f7(_0x59cc76,_0x50ee59){const _0x495ed5=_0x9a06f8;dbFileOperationRecord[_0x495ed5(0x161)](_0x5131f6[_0x495ed5(0x193)][_0x495ed5(0x139)],{'username':_0x5131f6['currentUser'][_0x495ed5(0x188)],'targetPath':_0x59cc76,'level':dbFileOperationRecord[_0x495ed5(0x1a5)],'type':dbFileOperationRecord[_0x495ed5(0x19e)],'state':_0x50ee59?dbFileOperationRecord[_0x495ed5(0x143)]:dbFileOperationRecord[_0x495ed5(0x132)]});}function _0x224c16(_0x171edc){const _0x5df55d=_0x9a06f8;if(_0x171edc[_0x5df55d(0x13c)]==0x1&&_0x171edc['is_livephoto']==0x1){let _0x38836a=path['join'](_0x171edc['path'],_0x171edc[_0x5df55d(0x145)][_0x5df55d(0x137)]('.MOV','')+'.HEIC');_0x171edc[_0x5df55d(0x145)]['endsWith'](_0x5df55d(0x148))&&(_0x38836a=path['join'](_0x171edc[_0x5df55d(0x151)],_0x171edc[_0x5df55d(0x145)][_0x5df55d(0x137)](_0x5df55d(0x148),'')+'.JPG')),fs[_0x5df55d(0x16b)](_0x38836a)&&_0x25548e(_0x171edc,_0x38836a,![]);}}function _0x25548e(_0x241493,_0xf58c27,_0x2fe63c){const _0x59408b=_0x9a06f8;_0x4820a5==0x1?(process[_0x59408b(0x158)]({'type':'shell','shellType':_0x59408b(0x197),'path':_0xf58c27}),_0x43d2f7(_0xf58c27,!![])):fs['rm'](_0xf58c27,{'recursive':!![]},_0x5520b1=>{_0x5520b1?_0x43d2f7(_0xf58c27,![]):_0x43d2f7(_0xf58c27,!![]);}),_0x2fe63c&&_0x224c16(_0x241493);}function _0xada106(_0x385750){const _0x57cc73=_0x9a06f8;dbFileIndexTable[_0x57cc73(0x17c)](_0x5131f6['app'][_0x57cc73(0x146)],_0x385750,_0x46584b);}function _0x364ac9(_0xe68571,_0x3cb829){const _0x4a6c14=_0x9a06f8;if(!_0x3cb829)return;dbFileIndexTable['delete'](_0x5131f6[_0x4a6c14(0x193)][_0x4a6c14(0x146)],_0xe68571,_0x46584b),dbFileIndexTable[_0x4a6c14(0x149)](_0x5131f6[_0x4a6c14(0x193)][_0x4a6c14(0x146)],_0x3cb829,_0x46584b);}if(_0x1d27a4&&_0x1d27a4[_0x9a06f8(0x156)]>0x0){let _0x5542d2=0x0,_0x66bb50=0x0,_0x50fe41=[];for(let _0xfc0510=0x0;_0xfc0510<_0x1d27a4[_0x9a06f8(0x156)];_0xfc0510++){let _0x34a321=_0x1d27a4[_0xfc0510],_0x356d1b=getIndexObj(_0x5131f6,_0x34a321,_0x46584b);if(_0x356d1b){if(dbUserTable[_0x9a06f8(0x17d)](_0x5131f6,_0x1fc34a,_0x56366f,_0x9a06f8(0x160),_0x356d1b['path'])==!![]){_0x5542d2+=0x1,_0x50fe41[_0x9a06f8(0x19b)](_0x34a321);let _0x152df3=path[_0x9a06f8(0x135)](_0x356d1b[_0x9a06f8(0x151)],path[_0x9a06f8(0x181)],_0x356d1b[_0x9a06f8(0x145)]),_0x22208b=_0x356d1b['is_file']==0x0;_0x3638b8&&(_0x152df3=_0x356d1b[_0x9a06f8(0x151)],_0x22208b=!![]),_0x22208b?_0x364ac9(_0x34a321,_0x152df3):_0xada106(_0x34a321),_0x25548e(_0x356d1b,_0x152df3,!_0x45c50b);}else _0x66bb50+=0x1;}}return _0x1fc34a[_0x9a06f8(0x180)]({'code':0x0,'deletedIds':_0x50fe41,'deleteCount':_0x5542d2,'errCount':_0x66bb50});}else return _0x5131f6[_0x9a06f8(0x193)]['returnErrMsg'](_0x1fc34a,_0x9a06f8(0x13e));});function genTinyForFilePath(_0x192bb9,_0x4bedc6,_0x27b31c,_0xd79a5d){const _0x403313=_0x107b11;let _0x2284d4=path[_0x403313(0x18e)](_0x4bedc6)?path[_0x403313(0x18e)](_0x4bedc6)[_0x403313(0x1a0)]():null,_0x34b5c7=![];if(config[_0x403313(0x166)][_0x403313(0x153)](_0x2284d4)||config[_0x403313(0x189)]['includes'](_0x2284d4[_0x403313(0x1a0)]()))_0x34b5c7='image';else{if(config[_0x403313(0x178)]['includes'](_0x2284d4))_0x34b5c7='video';else return _0x192bb9[_0x403313(0x154)](0x194)['end']();}sharpUtil[_0x403313(0x16f)](_0x4bedc6,path[_0x403313(0x138)](_0x27b31c),path[_0x403313(0x172)](_0x27b31c),_0x34b5c7,null,_0x4118b0=>{const _0x347ce0=_0x403313;_0x192bb9[_0x347ce0(0x192)](_0x4118b0);},_0x2a1c87=>{return _0x192bb9['status'](0x194)['end']();},_0xd79a5d);}function genTiny(_0x1f8e43,_0x640345,_0x58e3b7,_0x279c6e,_0xe9e896,_0x5cbdb0){const _0x3f641a=_0x107b11;let _0x49f2fc=_0x3f641a(0x16d);_0x279c6e[_0x3f641a(0x176)]==0x2&&(_0x49f2fc=_0x3f641a(0x183)),sharpUtil[_0x3f641a(0x16f)](_0x58e3b7,path['dirname'](_0x5cbdb0),path[_0x3f641a(0x172)](_0x5cbdb0),_0x49f2fc,_0x279c6e,_0x1e421b=>{const _0x1e0667=_0x3f641a;dbFileIndexTable[_0x1e0667(0x186)](_0x640345,_0x279c6e['id'],_0x1e0667(0x196),_0x1e421b,_0xe9e896),_0x1f8e43[_0x1e0667(0x192)](_0x1e421b);},_0x29cbdf=>{const _0x4e0f3b=_0x3f641a;return _0x1f8e43[_0x4e0f3b(0x154)](0x194)[_0x4e0f3b(0x19d)]();});}router[_0x107b11(0x14c)]('/rawFileByPath*',(_0x4a267e,_0x297a95,_0x17f1d5)=>{const _0x5486dc=_0x107b11;let _0x1b8160=_0x4a267e[_0x5486dc(0x13a)][_0x5486dc(0x13d)];_0x1b8160=fileUtil['decodePath'](_0x1b8160);let _0x4ffb5a=_0x4a267e[_0x5486dc(0x13a)][_0x5486dc(0x185)]==0x1,_0x370ae0=_0x4a267e[_0x5486dc(0x13a)][_0x5486dc(0x173)],_0x336541=_0x4a267e[_0x5486dc(0x13a)][_0x5486dc(0x140)];fs[_0x5486dc(0x150)](_0x1b8160,(_0x27da47,_0x54f6f9)=>{const _0x2779ac=_0x5486dc;if(_0x27da47)return _0x297a95['sendStatus'](0x194);if(dbUserTable[_0x2779ac(0x17d)](_0x4a267e,_0x297a95,'',_0x2779ac(0x165),_0x1b8160)==!![])try{let _0x4978de=_0x4a267e[_0x2779ac(0x13a)][_0x2779ac(0x13b)];if(_0x4978de&&_0x4978de==0x1){if(_0x4ffb5a){const _0x3560b7=encodeURIComponent(path[_0x2779ac(0x172)](_0x1b8160))['replace'](/%([0-9A-F]{2})/g,(_0x2562cb,_0x1716b2)=>'%'+_0x1716b2[_0x2779ac(0x175)]());_0x297a95[_0x2779ac(0x152)](_0x2779ac(0x194),_0x2779ac(0x1a1)+_0x3560b7);}return _0x297a95[_0x2779ac(0x192)](_0x1b8160);}sharpUtil['returnDealedFile'](_0x297a95,_0x1b8160,_0x4ffb5a,_0x370ae0,_0x336541);}catch(_0x3fb958){return _0x297a95[_0x2779ac(0x154)](0x194)[_0x2779ac(0x19d)]();}});}),router[_0x107b11(0x14c)]('/tinyImgByPath*',(_0x2291ed,_0x463518,_0x424e3d)=>{const _0x44b90c=_0x107b11;let _0x524da9=_0x2291ed[_0x44b90c(0x13a)][_0x44b90c(0x13d)];_0x524da9=fileUtil[_0x44b90c(0x1a6)](_0x524da9);let _0x587eff=_0x2291ed[_0x44b90c(0x13a)][_0x44b90c(0x173)];fs[_0x44b90c(0x150)](_0x524da9,(_0x5aba94,_0x5efd59)=>{const _0x477308=_0x44b90c;if(_0x5aba94)return _0x463518[_0x477308(0x15e)](0x194);config[_0x477308(0x187)](_0x587eff,_0x524da9,_0x21df66=>{const _0x276859=_0x477308;if(!_0x21df66)return _0x463518[_0x276859(0x15e)](0x194);let _0x866027=path[_0x276859(0x135)](config['cachePath'],_0x21df66);dbUserTable['doUserCanGet'](_0x2291ed,_0x463518,'','power_get',_0x524da9,!![])==!![]&&fs[_0x276859(0x150)](_0x866027,(_0x28f5b7,_0x13ce28)=>{const _0x44ed16=_0x276859;if(_0x28f5b7)return genTinyForFilePath(_0x463518,_0x524da9,_0x866027,_0x587eff);return _0x13ce28[_0x44ed16(0x1a7)]()?_0x463518[_0x44ed16(0x192)](_0x866027):genTinyForFilePath(_0x463518,_0x524da9,_0x866027,_0x587eff);});});});}),router['get'](_0x107b11(0x174),(_0x40dd7d,_0x32bbdf,_0x2c2234)=>{const _0x1e8abb=_0x107b11;let _0x552a63=_0x40dd7d[_0x1e8abb(0x13a)]['indexId'],_0x95c328=_0x40dd7d['query'][_0x1e8abb(0x133)],_0x5b9a9d=getIndexTableName(_0x95c328),_0x5098ef=getIndexObj(_0x40dd7d,_0x552a63);if(!_0x5098ef)return _0x32bbdf[_0x1e8abb(0x154)](0x194)[_0x1e8abb(0x19d)]();let _0x25f48d=config[_0x1e8abb(0x14a)](_0x5098ef),_0x1de664=path[_0x1e8abb(0x135)](config[_0x1e8abb(0x131)],_0x25f48d);if(dbUserTable[_0x1e8abb(0x17d)](_0x40dd7d,_0x32bbdf,_0x95c328,_0x1e8abb(0x165),_0x5098ef[_0x1e8abb(0x151)])==!![]){let _0x4ac1a9=path[_0x1e8abb(0x135)](_0x5098ef[_0x1e8abb(0x151)],path['sep'],_0x5098ef[_0x1e8abb(0x145)]);fs[_0x1e8abb(0x150)](_0x4ac1a9,(_0x18ecf4,_0x4f342b)=>{const _0x504802=_0x1e8abb;if(_0x18ecf4)return!_0x5098ef[_0x504802(0x196)]?_0x32bbdf[_0x504802(0x154)](0x194)[_0x504802(0x19d)]():fs[_0x504802(0x150)](_0x5098ef[_0x504802(0x196)],(_0xa1d38b,_0x145ea5)=>{const _0x2893fd=_0x504802;return _0xa1d38b||_0x145ea5&&!_0x145ea5[_0x2893fd(0x1a7)]()?_0x32bbdf[_0x2893fd(0x154)](0x194)[_0x2893fd(0x19d)]():_0x32bbdf[_0x2893fd(0x192)](_0x5098ef[_0x2893fd(0x196)]);});if(!_0x4f342b['isFile']())return _0x32bbdf[_0x504802(0x154)](0x194)['end']();if(!_0x5098ef[_0x504802(0x196)]){if(_0x5098ef[_0x504802(0x195)]==_0x504802(0x1a2)&&_0x5098ef['size']>config[_0x504802(0x18c)])return console['log'](_0x504802(0x191),_0x5098ef['filename']),_0x32bbdf[_0x504802(0x154)](0x194)[_0x504802(0x19d)]();fs['stat'](_0x1de664,(_0x187f6d,_0x1cd5d0)=>{const _0x47b24a=_0x504802;if(_0x187f6d)return genTiny(_0x32bbdf,_0x40dd7d[_0x47b24a(0x193)][_0x47b24a(0x146)],_0x4ac1a9,_0x5098ef,_0x5b9a9d,_0x1de664);return _0x1cd5d0[_0x47b24a(0x1a7)]()&&_0x1cd5d0[_0x47b24a(0x173)]>0x7d0?(dbFileIndexTable[_0x47b24a(0x186)](_0x40dd7d[_0x47b24a(0x193)][_0x47b24a(0x146)],_0x5098ef['id'],_0x47b24a(0x196),_0x1de664,_0x5b9a9d),_0x32bbdf[_0x47b24a(0x192)](_0x1de664)):genTiny(_0x32bbdf,_0x40dd7d[_0x47b24a(0x193)]['dbFileIndex'],_0x4ac1a9,_0x5098ef,_0x5b9a9d,_0x1de664);});}else fs[_0x504802(0x150)](_0x5098ef[_0x504802(0x196)],(_0x3c67bb,_0x379cab)=>{const _0x281e63=_0x504802;return _0x3c67bb||!_0x379cab[_0x281e63(0x1a7)]()?genTiny(_0x32bbdf,_0x40dd7d[_0x281e63(0x193)][_0x281e63(0x146)],_0x4ac1a9,_0x5098ef,_0x5b9a9d,_0x1de664):_0x32bbdf[_0x281e63(0x192)](_0x5098ef['tiny_path']);});});}}),router[_0x107b11(0x14c)]('/rawFile*',(_0x41080a,_0xd757f0,_0x1ec0fb)=>{const _0x2434f6=_0x107b11;let _0x506a76=_0x41080a[_0x2434f6(0x13a)][_0x2434f6(0x198)],_0x1ebfd9=_0x41080a[_0x2434f6(0x13a)]['serverType'],_0x3b46aa=getIndexObj(_0x41080a,_0x506a76),_0x3f1e11=getIndexTableName(_0x1ebfd9),_0x37df9e=_0x41080a[_0x2434f6(0x13a)]['download']==0x1,_0x3b3881=_0x41080a[_0x2434f6(0x13a)][_0x2434f6(0x173)],_0x5e2479=_0x41080a['query'][_0x2434f6(0x140)];if(!_0x3b46aa)return _0xd757f0[_0x2434f6(0x154)](0x194)[_0x2434f6(0x19d)]();if(dbUserTable['doUserCanGet'](_0x41080a,_0xd757f0,_0x1ebfd9,'power_get',_0x3b46aa[_0x2434f6(0x151)])==!![]){_0x1ebfd9==_0x2434f6(0x16a)&&(dbMusicIndexTable[_0x2434f6(0x190)](_0x41080a[_0x2434f6(0x193)][_0x2434f6(0x146)],_0x506a76),dbMusicIndexTable['updatePlayTime'](_0x41080a[_0x2434f6(0x193)][_0x2434f6(0x146)],_0x506a76));dbFileIndexTable[_0x2434f6(0x186)](_0x41080a[_0x2434f6(0x193)][_0x2434f6(0x146)],_0x506a76,'check_time',new Date()[_0x2434f6(0x155)](),_0x3f1e11);let _0x1f4e9f=_0x3b46aa[_0x2434f6(0x151)]+path[_0x2434f6(0x181)]+_0x3b46aa[_0x2434f6(0x145)];fs['stat'](_0x1f4e9f,(_0x477dc9,_0x3094fe)=>{const _0x44ae55=_0x2434f6;if(_0x477dc9||!_0x3094fe[_0x44ae55(0x1a7)]())return _0xd757f0[_0x44ae55(0x154)](0x194)['end']();let _0x1bdda3=_0x41080a['query'][_0x44ae55(0x13b)];if(_0x1bdda3&&_0x1bdda3==0x1){if(_0x37df9e){const _0x104f6e=encodeURIComponent(path['basename'](_0x1f4e9f))[_0x44ae55(0x137)](/%([0-9A-F]{2})/g,(_0x619db1,_0x124809)=>'%'+_0x124809[_0x44ae55(0x175)]());_0xd757f0[_0x44ae55(0x152)](_0x44ae55(0x194),_0x44ae55(0x1a1)+_0x104f6e);}return _0xd757f0[_0x44ae55(0x192)](_0x1f4e9f);}if(_0x41080a['query']['transToMp3']==0x1){_0xd757f0[_0x44ae55(0x19a)]('Content-Type',_0x44ae55(0x15c));const _0x443600=_0x41080a[_0x44ae55(0x17f)]['range'];if(_0x44ae55(0x18b)==_0x443600)return _0xd757f0[_0x44ae55(0x192)](_0x1f4e9f);return musicTransCodeUtil['transToMp3'](_0xd757f0,_0x1f4e9f);}else _0x41080a[_0x44ae55(0x13a)][_0x44ae55(0x14b)]&&_0x41080a['query'][_0x44ae55(0x14b)]==_0x44ae55(0x142)&&path[_0x44ae55(0x18e)](_0x1f4e9f)&&path[_0x44ae55(0x18e)](_0x1f4e9f)[_0x44ae55(0x1a0)]()=='.txt'?(console[_0x44ae55(0x169)](_0x44ae55(0x12f),_0x1f4e9f),encodingUtil['getUtf8FileStream'](_0x1f4e9f)[_0x44ae55(0x167)](_0x172ec6=>{const _0xf99904=_0x44ae55;return _0x172ec6?_0x172ec6[_0xf99904(0x199)](_0xd757f0):(console[_0xf99904(0x169)](_0xf99904(0x15f),_0x1f4e9f),_0xd757f0[_0xf99904(0x192)](_0x1f4e9f));})):sharpUtil[_0x44ae55(0x130)](_0xd757f0,_0x1f4e9f,_0x37df9e,_0x3b3881,_0x5e2479);});}}),router['post'](_0x107b11(0x17b),(_0x197707,_0x28e4d0,_0x64f786)=>{const _0x1f316d=_0x107b11;let _0x1271b3=_0x197707[_0x1f316d(0x134)][_0x1f316d(0x198)],_0x8dfc3a=getIndexObj(_0x197707,_0x1271b3);if(!_0x8dfc3a)return _0x28e4d0[_0x1f316d(0x154)](0x194)[_0x1f316d(0x19d)]();if(dbUserTable[_0x1f316d(0x17d)](_0x197707,_0x28e4d0,'',_0x1f316d(0x165),_0x8dfc3a['path'])==!![]){let _0x528e77=_0x8dfc3a[_0x1f316d(0x151)]+path[_0x1f316d(0x181)]+_0x8dfc3a[_0x1f316d(0x145)];exifUtil['parse'](_0x528e77)[_0x1f316d(0x167)](_0x41b7ae=>{const _0x4dd584=_0x1f316d;_0x8dfc3a['exifInfo']=_0x41b7ae,_0x28e4d0[_0x4dd584(0x180)]({'code':0x0,'data':_0x8dfc3a});})[_0x1f316d(0x168)](_0x3bf113=>{const _0x189390=_0x1f316d;_0x8dfc3a[_0x189390(0x147)]=![],_0x28e4d0[_0x189390(0x180)]({'code':0x0,'data':_0x8dfc3a});});}}),router['post'](_0x107b11(0x14d),(_0x13f0f3,_0xe614a9,_0xdbf12d)=>{const _0x302538=_0x107b11;let _0xdc6a7=_0x13f0f3[_0x302538(0x134)][_0x302538(0x198)],_0xf56f8=getIndexObj(_0x13f0f3,_0xdc6a7),_0x44f8d2=getIndexTableName(_0x13f0f3[_0x302538(0x13a)][_0x302538(0x133)]);if(!_0xf56f8)return _0xe614a9[_0x302538(0x180)]({'code':0x2,'message':'file\x20not\x20found'});try{fs['rm'](_0xf56f8['tiny_path'],_0x5646f9=>{const _0x3999e0=_0x302538;return _0x5646f9?fileUtil[_0x3999e0(0x162)](_0xe614a9,_0x5646f9):(dbFileIndexTable[_0x3999e0(0x186)](_0x13f0f3[_0x3999e0(0x193)][_0x3999e0(0x146)],_0xdc6a7,_0x3999e0(0x196),'',_0x44f8d2),_0xe614a9[_0x3999e0(0x180)]({'code':0x0}));});}catch(_0x2ef780){return _0xe614a9['json']({'code':0x2,'message':'operation\x20fail'});}}),module['exports']=router;