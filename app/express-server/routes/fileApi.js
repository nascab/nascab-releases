const _0x3157c4=_0x4157;function _0x38b8(){const _0x35ddf8=['audio/mpeg','power_delete','ignoreLivephoto','end','exifr','/rawFile*','imgTypeList','deletePathAll','../../myConfig/config','/inOutTrash','existsSync','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','photo','getById','is_livephoto','raw_filename','videoTypeList','params\x20is\x20not\x20valid','get','../../utils/encodingUtil','../../db/dbUserTable','indexId','filename','download','image','operation\x20fail','body','exifInfo','257553xNBqok','deleteIndexFolder','endsWith','pipe','utf8','3001280jzWfUJ','maxPsdSize','run','Content-Disposition','.psd','returnDealedFile','shell','sendFile','query','type','dirname','username','video','16uhNxlT','extname','369970ykAXmk','STATE_SUC','3467072NnOehT','toLowerCase','../../db/dbMusicIndexTable','status','includes','genTinyFile','1XIsPbK','catch','decodePath','12dHxWTV','updateById','../../db/dbFileIndexTable','tiny_path','changes','getTime','getFileHashNameByPathAndStat','setHeader','cachePath','returnErrMsg','trash','attachment;\x20filename*=UTF-8\x27\x27','exports','TYPE_DELETE','toUpperCase','Router','.MP4','1439904xTyExa','.JPG','json','sep','post','is_file','basename','join','check_time','raw','../utils/fileUtils','UPDATE\x20file_index_photo\x20SET\x20is_show=1\x20WHERE\x20path=?\x20AND\x20filename\x20=?','power_get','file\x20not\x20found','code','log','serverType','Unable\x20to\x20read\x20file','app','/getInfo','bytes=0-1','/deleteFromDisk','.txt','dbOther','length','parse','Convert\x20to\x20utf8\x20','currentUser','352NjawKU','size','sendStatus','music','path','addFileOperationRecord','isFile','/tinyImgByPath*','quality','express','945486NRTDfR','../../db/dbFileOperationRecord','/tinyImg*','../utils/sharpUtils','prepare','doUserCanGet','replace','136924oJEAXh','ids','sharp','transToMp3','ext','delete','fullPath','then','headers','dbFileIndex','rawImgTypeList','getFileHashName','stat'];_0x38b8=function(){return _0x35ddf8;};return _0x38b8();}(function(_0x1b6390,_0x2e41dd){const _0x37e5bc=_0x4157,_0x41d628=_0x1b6390();while(!![]){try{const _0x260520=-parseInt(_0x37e5bc(0x137))/0x1*(parseInt(_0x37e5bc(0xf2))/0x2)+-parseInt(_0x37e5bc(0x11b))/0x3*(-parseInt(_0x37e5bc(0x13a))/0x4)+-parseInt(_0x37e5bc(0x120))/0x5+parseInt(_0x37e5bc(0x14b))/0x6+-parseInt(_0x37e5bc(0x131))/0x7+parseInt(_0x37e5bc(0x12d))/0x8*(-parseInt(_0x37e5bc(0xeb))/0x9)+-parseInt(_0x37e5bc(0x12f))/0xa*(-parseInt(_0x37e5bc(0xe1))/0xb);if(_0x260520===_0x2e41dd)break;else _0x41d628['push'](_0x41d628['shift']());}catch(_0x44664f){_0x41d628['push'](_0x41d628['shift']());}}}(_0x38b8,0x4b077));let express=require(_0x3157c4(0xea)),router=express[_0x3157c4(0x149)](),path=require('path'),fs=require('fs');const sharp=require(_0x3157c4(0xf4));let sharpUtil=require(_0x3157c4(0xee)),exifUtil=require(_0x3157c4(0x103)),fileUtil=require(_0x3157c4(0x155));const config=require(_0x3157c4(0x107)),dbFileIndexTable=require(_0x3157c4(0x13c)),dbFileOperationRecord=require(_0x3157c4(0xec)),dbUserTable=require(_0x3157c4(0x113)),dbMusicIndexTable=require(_0x3157c4(0x133));function _0x4157(_0x34c713,_0x29644a){const _0x38b8d7=_0x38b8();return _0x4157=function(_0x415760,_0x443964){_0x415760=_0x415760-0xd3;let _0x59164e=_0x38b8d7[_0x415760];return _0x59164e;},_0x4157(_0x34c713,_0x29644a);}let musicTransCodeUtil=require('../../utils/musicTransCodeUtil');const encodingUtil=require(_0x3157c4(0x112));function getIndexTableName(_0x1bc7b7){let _0x4f206c=dbFileIndexTable['getIndexTableNameByType'](_0x1bc7b7);return _0x4f206c;}function getIndexObj(_0x3681cd,_0x42e791){const _0x574c37=_0x3157c4;let _0x4030a4=_0x3681cd[_0x574c37(0x119)][_0x574c37(0xd5)]||_0x3681cd[_0x574c37(0x128)][_0x574c37(0xd5)],_0xd70b7f=getIndexTableName(_0x4030a4);return dbFileIndexTable[_0x574c37(0x10c)](_0x3681cd[_0x574c37(0xd7)][_0x574c37(0xfb)],_0x42e791,_0xd70b7f);}router[_0x3157c4(0x14f)](_0x3157c4(0x108),(_0x4b0ebe,_0x4392e6,_0x2e926a)=>{const _0x3c709e=_0x3157c4;let _0x1b27d3=_0x4b0ebe[_0x3c709e(0x119)][_0x3c709e(0xf3)],_0x1fdb58=_0x4b0ebe[_0x3c709e(0x119)][_0x3c709e(0x144)];if(dbUserTable[_0x3c709e(0xf0)](_0x4b0ebe,_0x4392e6,_0x3c709e(0x10b),_0x3c709e(0x100))==!![]){if(_0x1b27d3&&_0x1b27d3[_0x3c709e(0xdd)]>0x0){let _0x24b910='(';for(let _0x22d2bf=0x0;_0x22d2bf<_0x1b27d3['length'];_0x22d2bf++){let _0x544b92=getIndexObj(_0x4b0ebe,_0x1b27d3[_0x22d2bf]);if(!_0x544b92)continue;_0x544b92[_0x3c709e(0x10e)]!=null&&_0x544b92[_0x3c709e(0x10e)]!=''&&_0x544b92[_0x3c709e(0x150)]&&(_0x1fdb58==0x1?_0x4b0ebe['app'][_0x3c709e(0xfb)]['prepare'](_0x3c709e(0x156))[_0x3c709e(0x122)](_0x544b92[_0x3c709e(0xe5)],_0x544b92[_0x3c709e(0x10e)]):_0x4b0ebe[_0x3c709e(0xd7)][_0x3c709e(0xfb)][_0x3c709e(0xef)](_0x3c709e(0x10a))['run'](_0x544b92[_0x3c709e(0xe5)],_0x544b92[_0x3c709e(0x10e)])),_0x24b910+=_0x1b27d3[_0x22d2bf],_0x22d2bf!=_0x1b27d3[_0x3c709e(0xdd)]-0x1&&(_0x24b910+=',');}_0x24b910+=')';let _0x2dd867=dbFileIndexTable['inOutTrash'](_0x4b0ebe[_0x3c709e(0xd7)][_0x3c709e(0xfb)],_0x24b910,_0x1fdb58,getIndexTableName(_0x4b0ebe['body'][_0x3c709e(0xd5)]));_0x2dd867[_0x3c709e(0x13e)]>0x0&&_0x4392e6[_0x3c709e(0x14d)]({'code':0x0,'count':_0x2dd867[_0x3c709e(0x13e)]});}else{_0x4392e6[_0x3c709e(0x14d)]({'code':0x1,'message':_0x3c709e(0x110)});return;}}}),router[_0x3157c4(0x14f)](_0x3157c4(0xda),(_0x2d8583,_0x5bc2d5,_0x1bc104)=>{const _0x45e022=_0x3157c4;let _0x91c1a8=_0x2d8583[_0x45e022(0x119)][_0x45e022(0xf3)],_0x13c4dd=_0x2d8583[_0x45e022(0x119)][_0x45e022(0xd5)],_0x307165=_0x2d8583[_0x45e022(0x119)][_0x45e022(0x11c)]==0x1,_0x3b1f53=_0x2d8583[_0x45e022(0x119)][_0x45e022(0x101)]==0x1,_0x1e4249=_0x2d8583['body']['putInSystemTrash'],_0x8aec22=getIndexTableName(_0x13c4dd);function _0x5e9f96(_0x4dc42b,_0xf0e08f){const _0x50ed9a=_0x45e022;dbFileOperationRecord[_0x50ed9a(0xe6)](_0x2d8583[_0x50ed9a(0xd7)][_0x50ed9a(0xdc)],{'username':_0x2d8583[_0x50ed9a(0xe0)][_0x50ed9a(0x12b)],'targetPath':_0x4dc42b,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x50ed9a(0x147)],'state':_0xf0e08f?dbFileOperationRecord[_0x50ed9a(0x130)]:dbFileOperationRecord['STATE_FAIL']});}function _0x532ceb(_0x35151f){const _0x17a921=_0x45e022;if(_0x35151f[_0x17a921(0x150)]==0x1&&_0x35151f[_0x17a921(0x10d)]==0x1){let _0x5974c1=path['join'](_0x35151f['path'],_0x35151f[_0x17a921(0x115)][_0x17a921(0xf1)]('.MOV','')+'.HEIC');_0x35151f[_0x17a921(0x115)][_0x17a921(0x11d)](_0x17a921(0x14a))&&(_0x5974c1=path[_0x17a921(0x152)](_0x35151f[_0x17a921(0xe5)],_0x35151f[_0x17a921(0x115)]['replace']('.MP4','')+_0x17a921(0x14c))),fs[_0x17a921(0x109)](_0x5974c1)&&_0x2c80e1(_0x35151f,_0x5974c1,![]);}}function _0x2c80e1(_0x484eec,_0x47a80a,_0x3538d1){const _0x4a14f1=_0x45e022;_0x1e4249==0x1?(process['send']({'type':_0x4a14f1(0x126),'shellType':'trash','path':_0x47a80a}),_0x5e9f96(_0x47a80a,!![])):fs['rm'](_0x47a80a,{'recursive':!![]},_0x24160f=>{_0x24160f?_0x5e9f96(_0x47a80a,![]):_0x5e9f96(_0x47a80a,!![]);}),_0x3538d1&&_0x532ceb(_0x484eec);}function _0x4e03a7(_0x3ca29a){const _0x31fa0b=_0x45e022;dbFileIndexTable[_0x31fa0b(0xf7)](_0x2d8583[_0x31fa0b(0xd7)][_0x31fa0b(0xfb)],_0x3ca29a,_0x8aec22);}function _0x46f91e(_0x2a02bc,_0x2be121){const _0xc8eb6b=_0x45e022;if(!_0x2be121)return;dbFileIndexTable[_0xc8eb6b(0xf7)](_0x2d8583[_0xc8eb6b(0xd7)][_0xc8eb6b(0xfb)],_0x2a02bc,_0x8aec22),dbFileIndexTable[_0xc8eb6b(0x106)](_0x2d8583[_0xc8eb6b(0xd7)][_0xc8eb6b(0xfb)],_0x2be121,_0x8aec22);}if(_0x91c1a8&&_0x91c1a8[_0x45e022(0xdd)]>0x0){let _0x235bcf=0x0,_0xf4d3fc=0x0,_0x5c31c9=[];for(let _0x1a1e7e=0x0;_0x1a1e7e<_0x91c1a8[_0x45e022(0xdd)];_0x1a1e7e++){let _0x3a0fe2=_0x91c1a8[_0x1a1e7e],_0x3de904=getIndexObj(_0x2d8583,_0x3a0fe2,_0x8aec22);if(_0x3de904){if(dbUserTable['doUserCanGet'](_0x2d8583,_0x5bc2d5,_0x13c4dd,'power_delete',_0x3de904[_0x45e022(0xe5)])==!![]){_0x235bcf+=0x1,_0x5c31c9['push'](_0x3a0fe2);let _0x2b325b=path['join'](_0x3de904[_0x45e022(0xe5)],path[_0x45e022(0x14e)],_0x3de904[_0x45e022(0x115)]),_0x1ac118=_0x3de904[_0x45e022(0x150)]==0x0;_0x307165&&(_0x2b325b=_0x3de904[_0x45e022(0xe5)],_0x1ac118=!![]),_0x1ac118?_0x46f91e(_0x3a0fe2,_0x2b325b):_0x4e03a7(_0x3a0fe2),_0x2c80e1(_0x3de904,_0x2b325b,!_0x3b1f53);}else _0xf4d3fc+=0x1;}}return _0x5bc2d5[_0x45e022(0x14d)]({'code':0x0,'deletedIds':_0x5c31c9,'deleteCount':_0x235bcf,'errCount':_0xf4d3fc});}else return _0x2d8583[_0x45e022(0xd7)][_0x45e022(0x143)](_0x5bc2d5,_0x45e022(0x110));});function genTinyForFilePath(_0x5eb5a0,_0x4b35c,_0x4d585a,_0x5c67ff){const _0x21e286=_0x3157c4;let _0x4874de=path[_0x21e286(0x12e)](_0x4b35c)?path[_0x21e286(0x12e)](_0x4b35c)['toLowerCase']():null,_0x544cff=![];if(config[_0x21e286(0x105)][_0x21e286(0x135)](_0x4874de)||config[_0x21e286(0xfc)]['includes'](_0x4874de[_0x21e286(0x132)]()))_0x544cff=_0x21e286(0x117);else{if(config[_0x21e286(0x10f)][_0x21e286(0x135)](_0x4874de))_0x544cff=_0x21e286(0x12c);else return _0x5eb5a0['status'](0x194)[_0x21e286(0x102)]();}sharpUtil['genTinyFile'](_0x4b35c,path[_0x21e286(0x12a)](_0x4d585a),path['basename'](_0x4d585a),_0x544cff,null,_0xbb3a7=>{const _0x2a4efa=_0x21e286;_0x5eb5a0[_0x2a4efa(0x127)](_0xbb3a7);},_0x58ca2c=>{const _0x35a5cd=_0x21e286;return _0x5eb5a0[_0x35a5cd(0x134)](0x194)[_0x35a5cd(0x102)]();},_0x5c67ff);}function genTiny(_0x4d184f,_0xcf4cc9,_0x386425,_0x215903,_0x44d57b,_0x1482bb){const _0x4a2360=_0x3157c4;let _0xc6a2f3=_0x4a2360(0x117);_0x215903[_0x4a2360(0x129)]==0x2&&(_0xc6a2f3=_0x4a2360(0x12c)),sharpUtil[_0x4a2360(0x136)](_0x386425,path[_0x4a2360(0x12a)](_0x1482bb),path[_0x4a2360(0x151)](_0x1482bb),_0xc6a2f3,_0x215903,_0x29e948=>{const _0x1e1189=_0x4a2360;dbFileIndexTable[_0x1e1189(0x13b)](_0xcf4cc9,_0x215903['id'],_0x1e1189(0x13d),_0x29e948,_0x44d57b),_0x4d184f[_0x1e1189(0x127)](_0x29e948);},_0x2f9355=>{return _0x4d184f['status'](0x194)['end']();});}router[_0x3157c4(0x111)]('/rawFileByPath*',(_0xd9fb59,_0xb8234d,_0x131df8)=>{const _0x5ebc18=_0x3157c4;let _0x457bc5=_0xd9fb59['query'][_0x5ebc18(0xf8)];_0x457bc5=fileUtil[_0x5ebc18(0x139)](_0x457bc5);let _0x5be8ca=_0xd9fb59[_0x5ebc18(0x128)][_0x5ebc18(0x116)]==0x1,_0x106fdc=_0xd9fb59['query'][_0x5ebc18(0xe2)],_0x1ead81=_0xd9fb59[_0x5ebc18(0x128)]['quality'];fs[_0x5ebc18(0xfe)](_0x457bc5,(_0x3b62fa,_0x4601b2)=>{const _0xe4f805=_0x5ebc18;if(_0x3b62fa)return _0xb8234d['sendStatus'](0x194);if(dbUserTable['doUserCanGet'](_0xd9fb59,_0xb8234d,'',_0xe4f805(0x157),_0x457bc5)==!![])try{let _0x29fda9=_0xd9fb59['query'][_0xe4f805(0x154)];if(_0x29fda9&&_0x29fda9==0x1){if(_0x5be8ca){const _0x58b877=encodeURIComponent(path[_0xe4f805(0x151)](_0x457bc5))['replace'](/%([0-9A-F]{2})/g,(_0x19baa5,_0x33b09a)=>'%'+_0x33b09a['toUpperCase']());_0xb8234d['setHeader'](_0xe4f805(0x123),'attachment;\x20filename*=UTF-8\x27\x27'+_0x58b877);}return _0xb8234d['sendFile'](_0x457bc5);}sharpUtil[_0xe4f805(0x125)](_0xb8234d,_0x457bc5,_0x5be8ca,_0x106fdc,_0x1ead81);}catch(_0x390962){return _0xb8234d[_0xe4f805(0x134)](0x194)[_0xe4f805(0x102)]();}});}),router[_0x3157c4(0x111)](_0x3157c4(0xe8),(_0xc335fe,_0x1c7dee,_0x4bd445)=>{const _0x51ff14=_0x3157c4;let _0x59c9c2=_0xc335fe[_0x51ff14(0x128)][_0x51ff14(0xf8)];_0x59c9c2=fileUtil['decodePath'](_0x59c9c2);let _0x37508f=_0xc335fe['query']['size'];fs[_0x51ff14(0xfe)](_0x59c9c2,(_0x2e4419,_0x55d1e4)=>{const _0x2944d9=_0x51ff14;if(_0x2e4419)return _0x1c7dee[_0x2944d9(0xe3)](0x194);config[_0x2944d9(0x140)](_0x37508f,_0x59c9c2,_0x20dfcd=>{const _0x5df4b1=_0x2944d9;if(!_0x20dfcd)return _0x1c7dee[_0x5df4b1(0xe3)](0x194);let _0x2c2b4e=path[_0x5df4b1(0x152)](config[_0x5df4b1(0x142)],_0x20dfcd);dbUserTable[_0x5df4b1(0xf0)](_0xc335fe,_0x1c7dee,'',_0x5df4b1(0x157),_0x59c9c2,!![])==!![]&&fs[_0x5df4b1(0xfe)](_0x2c2b4e,(_0x3f9f0e,_0x563b88)=>{const _0xba2268=_0x5df4b1;if(_0x3f9f0e)return genTinyForFilePath(_0x1c7dee,_0x59c9c2,_0x2c2b4e,_0x37508f);return _0x563b88[_0xba2268(0xe7)]()?_0x1c7dee[_0xba2268(0x127)](_0x2c2b4e):genTinyForFilePath(_0x1c7dee,_0x59c9c2,_0x2c2b4e,_0x37508f);});});});}),router['get'](_0x3157c4(0xed),(_0x338a3c,_0x34f671,_0x5e4de4)=>{const _0x2ed9c0=_0x3157c4;let _0x42f31b=_0x338a3c['query']['indexId'],_0x21bf65=_0x338a3c[_0x2ed9c0(0x128)][_0x2ed9c0(0xd5)],_0x1c34b1=getIndexTableName(_0x21bf65),_0x4eb568=getIndexObj(_0x338a3c,_0x42f31b);if(!_0x4eb568)return _0x34f671['status'](0x194)['end']();let _0x1e5eb2=config[_0x2ed9c0(0xfd)](_0x4eb568),_0x69fe90=path[_0x2ed9c0(0x152)](config[_0x2ed9c0(0x142)],_0x1e5eb2);if(dbUserTable['doUserCanGet'](_0x338a3c,_0x34f671,_0x21bf65,_0x2ed9c0(0x157),_0x4eb568[_0x2ed9c0(0xe5)])==!![]){let _0x124409=path[_0x2ed9c0(0x152)](_0x4eb568['path'],path[_0x2ed9c0(0x14e)],_0x4eb568['filename']);fs[_0x2ed9c0(0xfe)](_0x124409,(_0x3164ca,_0x403347)=>{const _0x5afa2d=_0x2ed9c0;if(_0x3164ca)return!_0x4eb568[_0x5afa2d(0x13d)]?_0x34f671[_0x5afa2d(0x134)](0x194)[_0x5afa2d(0x102)]():fs[_0x5afa2d(0xfe)](_0x4eb568[_0x5afa2d(0x13d)],(_0xc5c0f2,_0x13ea77)=>{const _0x41b86a=_0x5afa2d;return _0xc5c0f2||_0x13ea77&&!_0x13ea77[_0x41b86a(0xe7)]()?_0x34f671[_0x41b86a(0x134)](0x194)[_0x41b86a(0x102)]():_0x34f671[_0x41b86a(0x127)](_0x4eb568['tiny_path']);});if(!_0x403347[_0x5afa2d(0xe7)]())return _0x34f671[_0x5afa2d(0x134)](0x194)[_0x5afa2d(0x102)]();if(!_0x4eb568[_0x5afa2d(0x13d)]){if(_0x4eb568[_0x5afa2d(0xf6)]==_0x5afa2d(0x124)&&_0x4eb568['size']>config[_0x5afa2d(0x121)])return console[_0x5afa2d(0xd4)]('PSD文件过大，不生成缩略图',_0x4eb568[_0x5afa2d(0x115)]),_0x34f671[_0x5afa2d(0x134)](0x194)['end']();fs[_0x5afa2d(0xfe)](_0x69fe90,(_0x465a99,_0x498859)=>{const _0x40da96=_0x5afa2d;if(_0x465a99)return genTiny(_0x34f671,_0x338a3c[_0x40da96(0xd7)][_0x40da96(0xfb)],_0x124409,_0x4eb568,_0x1c34b1,_0x69fe90);return _0x498859[_0x40da96(0xe7)]()&&_0x498859[_0x40da96(0xe2)]>0x7d0?(dbFileIndexTable['updateById'](_0x338a3c[_0x40da96(0xd7)][_0x40da96(0xfb)],_0x4eb568['id'],'tiny_path',_0x69fe90,_0x1c34b1),_0x34f671[_0x40da96(0x127)](_0x69fe90)):genTiny(_0x34f671,_0x338a3c[_0x40da96(0xd7)][_0x40da96(0xfb)],_0x124409,_0x4eb568,_0x1c34b1,_0x69fe90);});}else fs[_0x5afa2d(0xfe)](_0x4eb568[_0x5afa2d(0x13d)],(_0x13d39e,_0x465560)=>{const _0x5088bf=_0x5afa2d;return _0x13d39e||!_0x465560['isFile']()?genTiny(_0x34f671,_0x338a3c[_0x5088bf(0xd7)][_0x5088bf(0xfb)],_0x124409,_0x4eb568,_0x1c34b1,_0x69fe90):_0x34f671[_0x5088bf(0x127)](_0x4eb568[_0x5088bf(0x13d)]);});});}}),router[_0x3157c4(0x111)](_0x3157c4(0x104),(_0x16b2f0,_0x4e69c5,_0x266dd6)=>{const _0x40a42d=_0x3157c4;let _0xc562f4=_0x16b2f0[_0x40a42d(0x128)][_0x40a42d(0x114)],_0x54e50b=_0x16b2f0[_0x40a42d(0x128)][_0x40a42d(0xd5)],_0x5db793=getIndexObj(_0x16b2f0,_0xc562f4),_0x16b65b=getIndexTableName(_0x54e50b),_0x150693=_0x16b2f0[_0x40a42d(0x128)][_0x40a42d(0x116)]==0x1,_0x3ac5fe=_0x16b2f0[_0x40a42d(0x128)]['size'],_0x4c1261=_0x16b2f0['query'][_0x40a42d(0xe9)];if(!_0x5db793)return _0x4e69c5['status'](0x194)['end']();if(dbUserTable[_0x40a42d(0xf0)](_0x16b2f0,_0x4e69c5,_0x54e50b,_0x40a42d(0x157),_0x5db793[_0x40a42d(0xe5)])==!![]){_0x54e50b==_0x40a42d(0xe4)&&(dbMusicIndexTable['increasePlayCount'](_0x16b2f0['app'][_0x40a42d(0xfb)],_0xc562f4),dbMusicIndexTable['updatePlayTime'](_0x16b2f0['app'][_0x40a42d(0xfb)],_0xc562f4));dbFileIndexTable[_0x40a42d(0x13b)](_0x16b2f0[_0x40a42d(0xd7)][_0x40a42d(0xfb)],_0xc562f4,_0x40a42d(0x153),new Date()[_0x40a42d(0x13f)](),_0x16b65b);let _0x44bd55=_0x5db793[_0x40a42d(0xe5)]+path[_0x40a42d(0x14e)]+_0x5db793[_0x40a42d(0x115)];fs[_0x40a42d(0xfe)](_0x44bd55,(_0x33d1d0,_0x212380)=>{const _0x4d7e5f=_0x40a42d;if(_0x33d1d0||!_0x212380[_0x4d7e5f(0xe7)]())return _0x4e69c5[_0x4d7e5f(0x134)](0x194)[_0x4d7e5f(0x102)]();let _0x147a89=_0x16b2f0[_0x4d7e5f(0x128)][_0x4d7e5f(0x154)];if(_0x147a89&&_0x147a89==0x1){if(_0x150693){const _0x4c8c13=encodeURIComponent(path[_0x4d7e5f(0x151)](_0x44bd55))[_0x4d7e5f(0xf1)](/%([0-9A-F]{2})/g,(_0x32a704,_0x3e9244)=>'%'+_0x3e9244[_0x4d7e5f(0x148)]());_0x4e69c5[_0x4d7e5f(0x141)](_0x4d7e5f(0x123),_0x4d7e5f(0x145)+_0x4c8c13);}return _0x4e69c5[_0x4d7e5f(0x127)](_0x44bd55);}if(_0x16b2f0['query'][_0x4d7e5f(0xf5)]==0x1){_0x4e69c5['set']('Content-Type',_0x4d7e5f(0xff));const _0x6fcdc6=_0x16b2f0[_0x4d7e5f(0xfa)]['range'];if(_0x4d7e5f(0xd9)==_0x6fcdc6)return _0x4e69c5[_0x4d7e5f(0x127)](_0x44bd55);return musicTransCodeUtil[_0x4d7e5f(0xf5)](_0x4e69c5,_0x44bd55);}else _0x16b2f0[_0x4d7e5f(0x128)][_0x4d7e5f(0xd3)]&&_0x16b2f0[_0x4d7e5f(0x128)][_0x4d7e5f(0xd3)]==_0x4d7e5f(0x11f)&&path[_0x4d7e5f(0x12e)](_0x44bd55)&&path['extname'](_0x44bd55)['toLowerCase']()==_0x4d7e5f(0xdb)?(console['log'](_0x4d7e5f(0xdf),_0x44bd55),encodingUtil['getUtf8FileStream'](_0x44bd55)['then'](_0x12174b=>{const _0x4abd0c=_0x4d7e5f;return _0x12174b?_0x12174b[_0x4abd0c(0x11e)](_0x4e69c5):(console['log'](_0x4abd0c(0xd6),_0x44bd55),_0x4e69c5[_0x4abd0c(0x127)](_0x44bd55));})):sharpUtil[_0x4d7e5f(0x125)](_0x4e69c5,_0x44bd55,_0x150693,_0x3ac5fe,_0x4c1261);});}}),router[_0x3157c4(0x14f)](_0x3157c4(0xd8),(_0x31b0e0,_0x11aebf,_0x31fae4)=>{const _0x1a9b41=_0x3157c4;let _0x1493fc=_0x31b0e0['body'][_0x1a9b41(0x114)],_0x152300=getIndexObj(_0x31b0e0,_0x1493fc);if(!_0x152300)return _0x11aebf[_0x1a9b41(0x134)](0x194)[_0x1a9b41(0x102)]();if(dbUserTable['doUserCanGet'](_0x31b0e0,_0x11aebf,'',_0x1a9b41(0x157),_0x152300[_0x1a9b41(0xe5)])==!![]){let _0x4f7e7f=_0x152300[_0x1a9b41(0xe5)]+path[_0x1a9b41(0x14e)]+_0x152300[_0x1a9b41(0x115)];exifUtil[_0x1a9b41(0xde)](_0x4f7e7f)[_0x1a9b41(0xf9)](_0x82c6ec=>{const _0xf5d483=_0x1a9b41;_0x152300[_0xf5d483(0x11a)]=_0x82c6ec,_0x11aebf[_0xf5d483(0x14d)]({'code':0x0,'data':_0x152300});})[_0x1a9b41(0x138)](_0x3a7355=>{const _0x400753=_0x1a9b41;_0x152300['exifInfo']=![],_0x11aebf[_0x400753(0x14d)]({'code':0x0,'data':_0x152300});});}}),router[_0x3157c4(0x14f)]('/clearTinyImg',(_0x32a07a,_0x30137e,_0x10afdc)=>{const _0x3e02d6=_0x3157c4;let _0x179961=_0x32a07a[_0x3e02d6(0x119)][_0x3e02d6(0x114)],_0x4b17d5=getIndexObj(_0x32a07a,_0x179961),_0x59e6f5=getIndexTableName(_0x32a07a['query']['serverType']);if(!_0x4b17d5)return _0x30137e[_0x3e02d6(0x14d)]({'code':0x2,'message':_0x3e02d6(0x158)});try{fs['rm'](_0x4b17d5[_0x3e02d6(0x13d)],_0x299008=>{const _0x147479=_0x3e02d6;return _0x299008?fileUtil['returnFileError'](_0x30137e,_0x299008):(dbFileIndexTable[_0x147479(0x13b)](_0x32a07a[_0x147479(0xd7)][_0x147479(0xfb)],_0x179961,_0x147479(0x13d),'',_0x59e6f5),_0x30137e[_0x147479(0x14d)]({'code':0x0}));});}catch(_0x17d9d3){return _0x30137e[_0x3e02d6(0x14d)]({'code':0x2,'message':_0x3e02d6(0x118)});}}),module[_0x3157c4(0x146)]=router;