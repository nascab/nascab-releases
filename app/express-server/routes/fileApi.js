const _0x295d4f=_0x7e52;(function(_0x38c7ab,_0x105a7a){const _0x194ae5=_0x7e52,_0x231754=_0x38c7ab();while(!![]){try{const _0x160163=-parseInt(_0x194ae5(0x25d))/0x1*(parseInt(_0x194ae5(0x1e0))/0x2)+parseInt(_0x194ae5(0x200))/0x3*(-parseInt(_0x194ae5(0x1e7))/0x4)+parseInt(_0x194ae5(0x236))/0x5+parseInt(_0x194ae5(0x20c))/0x6+-parseInt(_0x194ae5(0x25f))/0x7*(-parseInt(_0x194ae5(0x258))/0x8)+-parseInt(_0x194ae5(0x259))/0x9+parseInt(_0x194ae5(0x24e))/0xa*(parseInt(_0x194ae5(0x1eb))/0xb);if(_0x160163===_0x105a7a)break;else _0x231754['push'](_0x231754['shift']());}catch(_0x2f1ace){_0x231754['push'](_0x231754['shift']());}}}(_0x1e38,0xe6ce5));let express=require(_0x295d4f(0x262)),router=express[_0x295d4f(0x207)](),path=require('path'),fs=require('fs');const sharp=require(_0x295d4f(0x261));let sharpUtil=require(_0x295d4f(0x241)),exifUtil=require(_0x295d4f(0x1e1)),fileUtil=require(_0x295d4f(0x225));function _0x7e52(_0x35c11c,_0x310fd3){const _0x1e3895=_0x1e38();return _0x7e52=function(_0x7e52e8,_0x432d7e){_0x7e52e8=_0x7e52e8-0x1da;let _0x6f75d9=_0x1e3895[_0x7e52e8];return _0x6f75d9;},_0x7e52(_0x35c11c,_0x310fd3);}const config=require(_0x295d4f(0x234)),dbFileIndexTable=require(_0x295d4f(0x211)),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),dbUserTable=require(_0x295d4f(0x26b)),dbMusicIndexTable=require(_0x295d4f(0x1fc));let musicTransCodeUtil=require(_0x295d4f(0x230));const encodingUtil=require(_0x295d4f(0x233));function getIndexTableName(_0x388683){const _0x4ea6f0=_0x295d4f;let _0x5a8ae3=dbFileIndexTable[_0x4ea6f0(0x269)](_0x388683);return _0x5a8ae3;}function getIndexObj(_0x4e2669,_0x2b776e){const _0x2d249d=_0x295d4f;let _0x4feb2c=_0x4e2669['body']['serverType']||_0x4e2669['query'][_0x2d249d(0x228)],_0x274695=getIndexTableName(_0x4feb2c);return dbFileIndexTable[_0x2d249d(0x1f3)](_0x4e2669[_0x2d249d(0x1f8)][_0x2d249d(0x1fd)],_0x2b776e,_0x274695);}router[_0x295d4f(0x1df)](_0x295d4f(0x1ec),(_0xd1620e,_0x4dc018,_0x2c619b)=>{const _0x28b3fd=_0x295d4f;let _0xc3af4b=_0xd1620e['body'][_0x28b3fd(0x227)],_0x216a82=_0xd1620e[_0x28b3fd(0x25b)]['trash'];if(dbUserTable[_0x28b3fd(0x1fa)](_0xd1620e,_0x4dc018,_0x28b3fd(0x1f1),_0x28b3fd(0x1e2))==!![]){if(_0xc3af4b&&_0xc3af4b[_0x28b3fd(0x235)]>0x0){let _0x3dac6a='(';for(let _0x36750a=0x0;_0x36750a<_0xc3af4b[_0x28b3fd(0x235)];_0x36750a++){let _0x5b9664=getIndexObj(_0xd1620e,_0xc3af4b[_0x36750a]);if(!_0x5b9664)continue;_0x5b9664[_0x28b3fd(0x1dc)]!=null&&_0x5b9664['raw_filename']!=''&&_0x5b9664[_0x28b3fd(0x251)]&&(_0x216a82==0x1?_0xd1620e[_0x28b3fd(0x1f8)][_0x28b3fd(0x1fd)][_0x28b3fd(0x237)](_0x28b3fd(0x208))['run'](_0x5b9664[_0x28b3fd(0x253)],_0x5b9664[_0x28b3fd(0x1dc)]):_0xd1620e['app'][_0x28b3fd(0x1fd)]['prepare'](_0x28b3fd(0x254))['run'](_0x5b9664[_0x28b3fd(0x253)],_0x5b9664[_0x28b3fd(0x1dc)])),_0x3dac6a+=_0xc3af4b[_0x36750a],_0x36750a!=_0xc3af4b[_0x28b3fd(0x235)]-0x1&&(_0x3dac6a+=',');}_0x3dac6a+=')';let _0x2549d6=dbFileIndexTable[_0x28b3fd(0x20d)](_0xd1620e[_0x28b3fd(0x1f8)][_0x28b3fd(0x1fd)],_0x3dac6a,_0x216a82,getIndexTableName(_0xd1620e[_0x28b3fd(0x25b)][_0x28b3fd(0x228)]));_0x2549d6[_0x28b3fd(0x1ef)]>0x0&&_0x4dc018[_0x28b3fd(0x242)]({'code':0x0,'count':_0x2549d6['changes']});}else{_0x4dc018[_0x28b3fd(0x242)]({'code':0x1,'message':_0x28b3fd(0x205)});return;}}}),router[_0x295d4f(0x1df)](_0x295d4f(0x26c),(_0x255f83,_0x2bc7fd,_0x52f43f)=>{const _0x21c783=_0x295d4f;let _0x4e7d25=_0x255f83[_0x21c783(0x25b)][_0x21c783(0x227)],_0xd01b29=_0x255f83[_0x21c783(0x25b)][_0x21c783(0x228)],_0x266187=_0x255f83[_0x21c783(0x25b)][_0x21c783(0x22b)]==0x1,_0x27f75d=_0x255f83[_0x21c783(0x25b)][_0x21c783(0x231)]==0x1,_0x3387e5=_0x255f83['body']['putInSystemTrash'],_0x39ec33=getIndexTableName(_0xd01b29),_0x1cb07f=_0x255f83[_0x21c783(0x25b)][_0x21c783(0x266)]==0x1,_0x32f297=_0x255f83[_0x21c783(0x25b)][_0x21c783(0x1ff)]==0x1;function _0x3e24a5(_0x391ae6,_0x770371){const _0xe6c84d=_0x21c783;dbFileOperationRecord[_0xe6c84d(0x264)](_0x255f83[_0xe6c84d(0x1f8)][_0xe6c84d(0x21d)],{'username':_0x255f83[_0xe6c84d(0x1ed)][_0xe6c84d(0x1e3)],'targetPath':_0x391ae6,'level':dbFileOperationRecord[_0xe6c84d(0x23a)],'type':dbFileOperationRecord[_0xe6c84d(0x23b)],'state':_0x770371?dbFileOperationRecord[_0xe6c84d(0x1e8)]:dbFileOperationRecord[_0xe6c84d(0x260)]});}function _0x45e5fd(_0xe18b24){const _0x5c7aca=_0x21c783;if(_0xe18b24[_0x5c7aca(0x251)]==0x1&&_0xe18b24[_0x5c7aca(0x239)]==0x1){let _0x1dc1a3=path[_0x5c7aca(0x1f9)](_0xe18b24[_0x5c7aca(0x253)],_0xe18b24['filename'][_0x5c7aca(0x203)](_0x5c7aca(0x219),'')+'.HEIC');_0xe18b24[_0x5c7aca(0x229)][_0x5c7aca(0x232)](_0x5c7aca(0x1db))&&(_0x1dc1a3=path[_0x5c7aca(0x1f9)](_0xe18b24['path'],_0xe18b24[_0x5c7aca(0x229)]['replace'](_0x5c7aca(0x1db),'')+'.JPG')),fs[_0x5c7aca(0x244)](_0x1dc1a3)&&_0x40ffa0(_0xe18b24,_0x1dc1a3,![]);}}function _0x40ffa0(_0x22022f,_0xee194d,_0x50af40){const _0x5b27d7=_0x21c783;_0x3387e5==0x1?(process['send']({'type':_0x5b27d7(0x21b),'shellType':_0x5b27d7(0x21a),'path':_0xee194d}),_0x3e24a5(_0xee194d,!![])):fs['rm'](_0xee194d,{'recursive':!![]},_0x163173=>{_0x163173?_0x3e24a5(_0xee194d,![]):_0x3e24a5(_0xee194d,!![]);}),_0x22022f&&_0x50af40&&_0x45e5fd(_0x22022f);}function _0x4d56e3(_0x50fe2f){const _0x110d6a=_0x21c783;dbFileIndexTable['delete'](_0x255f83[_0x110d6a(0x1f8)][_0x110d6a(0x1fd)],_0x50fe2f,_0x39ec33);}function _0x324065(_0x1bcbd5,_0x3a4999){const _0x312a86=_0x21c783;if(!_0x3a4999)return;dbFileIndexTable[_0x312a86(0x268)](_0x255f83['app'][_0x312a86(0x1fd)],_0x1bcbd5,_0x39ec33),dbFileIndexTable[_0x312a86(0x24d)](_0x255f83[_0x312a86(0x1f8)][_0x312a86(0x1fd)],_0x3a4999,_0x39ec33);}if(_0x4e7d25&&_0x4e7d25['length']>0x0){let _0x262409=0x0,_0x234207=0x0,_0xd7a42d=[];for(let _0x138c14=0x0;_0x138c14<_0x4e7d25[_0x21c783(0x235)];_0x138c14++){let _0x4e9aab=_0x4e7d25[_0x138c14],_0x47d316=getIndexObj(_0x255f83,_0x4e9aab,_0x39ec33);if(_0x47d316){let _0x4a9891=_0x47d316[_0x21c783(0x253)];_0x32f297&&(_0x4a9891=path[_0x21c783(0x24c)](_0x47d316[_0x21c783(0x253)]));if(dbUserTable[_0x21c783(0x1fa)](_0x255f83,_0x2bc7fd,_0xd01b29,'power_delete',_0x4a9891)==!![]){_0x262409+=0x1,_0xd7a42d[_0x21c783(0x209)](_0x4e9aab);let _0x2019ad=path[_0x21c783(0x1f9)](_0x47d316[_0x21c783(0x253)],path[_0x21c783(0x1ea)],_0x47d316['filename']),_0x2c25a6=_0x47d316[_0x21c783(0x251)]==0x0;_0x266187&&(_0x2019ad=_0x47d316[_0x21c783(0x253)],_0x2c25a6=!![]);_0x32f297&&(_0x2019ad=path[_0x21c783(0x24c)](_0x47d316[_0x21c783(0x253)]),_0x2c25a6=!![]);_0x2c25a6?_0x324065(_0x4e9aab,_0x2019ad):_0x4d56e3(_0x4e9aab);_0x40ffa0(_0x47d316,_0x2019ad,!_0x27f75d);if(_0x1cb07f){let _0x2a7399=path['join'](_0x47d316['path'],_0x47d316[_0x21c783(0x229)][_0x21c783(0x203)](path[_0x21c783(0x212)](_0x47d316[_0x21c783(0x229)]),_0x21c783(0x23c))),_0x682ad8=path[_0x21c783(0x1f9)](_0x47d316[_0x21c783(0x253)],_0x47d316[_0x21c783(0x229)]['replace'](path[_0x21c783(0x212)](_0x47d316['filename']),_0x21c783(0x24f))),_0x12d278=path[_0x21c783(0x1f9)](_0x47d316['path'],_0x47d316['filename'][_0x21c783(0x203)](path['extname'](_0x47d316['filename']),'-fanart.jpg'));fs[_0x21c783(0x244)](_0x2a7399)&&(console[_0x21c783(0x249)](_0x21c783(0x220),_0x2a7399),_0x40ffa0(null,_0x2a7399)),fs['existsSync'](_0x682ad8)&&(console['log'](_0x21c783(0x1e4),_0x682ad8),_0x40ffa0(null,_0x682ad8)),fs[_0x21c783(0x244)](_0x12d278)&&(console[_0x21c783(0x249)](_0x21c783(0x20a),_0x12d278),_0x40ffa0(null,_0x12d278));}}else _0x234207+=0x1;}}return _0x2bc7fd[_0x21c783(0x242)]({'code':0x0,'deletedIds':_0xd7a42d,'deleteCount':_0x262409,'errCount':_0x234207});}else return _0x255f83[_0x21c783(0x1f8)]['returnErrMsg'](_0x2bc7fd,_0x21c783(0x205));});function genTinyForFilePath(_0xd8b890,_0x38ab60,_0x3ffe8e,_0x38a9f8){const _0x393b19=_0x295d4f;let _0x3024ed=path['extname'](_0x38ab60)?path[_0x393b19(0x212)](_0x38ab60)[_0x393b19(0x257)]():null,_0x47cd8f=![];if(config[_0x393b19(0x23e)][_0x393b19(0x23f)](_0x3024ed)||config[_0x393b19(0x25c)][_0x393b19(0x23f)](_0x3024ed['toLowerCase']()))_0x47cd8f=_0x393b19(0x226);else{if(config['videoTypeList'][_0x393b19(0x23f)](_0x3024ed))_0x47cd8f=_0x393b19(0x215);else return _0xd8b890['status'](0x194)[_0x393b19(0x20b)]();}sharpUtil[_0x393b19(0x1e9)](_0x38ab60,path['dirname'](_0x3ffe8e),path[_0x393b19(0x25e)](_0x3ffe8e),_0x47cd8f,null,_0x45ff4d=>{const _0x3173b8=_0x393b19;_0xd8b890[_0x3173b8(0x221)](_0x45ff4d);},_0x957f9=>{return _0xd8b890['status'](0x194)['end']();},_0x38a9f8);}function genTiny(_0x55d058,_0x185250,_0x32f9ab,_0x520757,_0x5b062b,_0x3a2bad){const _0x1a2d0e=_0x295d4f;let _0x37e69f=_0x1a2d0e(0x226);_0x520757[_0x1a2d0e(0x238)]==0x2&&(_0x37e69f=_0x1a2d0e(0x215)),sharpUtil[_0x1a2d0e(0x1e9)](_0x32f9ab,path['dirname'](_0x3a2bad),path['basename'](_0x3a2bad),_0x37e69f,_0x520757,_0x5beb2a=>{const _0x3275b3=_0x1a2d0e;dbFileIndexTable[_0x3275b3(0x243)](_0x185250,_0x520757['id'],_0x3275b3(0x255),_0x5beb2a,_0x5b062b),_0x55d058[_0x3275b3(0x221)](_0x5beb2a);},_0x19dd97=>{const _0x2dc0b8=_0x1a2d0e;return _0x55d058[_0x2dc0b8(0x1de)](0x194)['end']();});}function _0x1e38(){const _0x56ea00=['getIndexTableNameByType','getTime','../../db/dbUserTable','/deleteFromDisk','updatePlayTime','.MP4','raw_filename','operation\x20fail','status','post','106kxikOq','exifr','power_delete','username','delete\x20poster:','.txt','utf8','4UTosDy','STATE_SUC','genTinyFile','sep','2662418UkVBDz','/inOutTrash','currentUser','sendStatus','changes','decodePath','photo','ext','getById','indexId','/tinyImgByPath*','power_get','returnDealedFile','app','join','doUserCanGet','stat','../../db/dbMusicIndexTable','dbFileIndex','returnFileError','deleteTvServies','3111921fYNVCi','query','/clearTinyImg','replace','Content-Disposition','params\x20is\x20not\x20valid','cachePath','Router','UPDATE\x20file_index_photo\x20SET\x20is_show=1\x20WHERE\x20path=?\x20AND\x20filename\x20=?','push','delete\x20fanart:','end','1443324vdDMzk','inOutTrash','range','PSD文件过大，不生成缩略图','Content-Type','../../db/dbFileIndexTable','extname','parse','exports','video','increasePlayCount','music','transToMp3','.MOV','trash','shell','toUpperCase','dbOther','quality','exifInfo','delete\x20nfo:','sendFile','.psd','get','size','../utils/fileUtils','image','ids','serverType','filename','isFile','deleteIndexFolder','/rawFile*','getFileHashNameByPathAndStat','set','Unable\x20to\x20read\x20file','../../utils/musicTransCodeUtil','ignoreLivephoto','endsWith','../../utils/encodingUtil','../../myConfig/config','length','8653135GRSrBx','prepare','type','is_livephoto','LEVEL_MAIN_OPERATION','TYPE_DELETE','.nfo','/tinyImg*','imgTypeList','includes','download','../utils/sharpUtils','json','updateById','existsSync','Convert\x20to\x20utf8\x20','code','fullPath','bytes=0-1','log','/rawFileByPath*','/getInfo','dirname','deletePathAll','30NOjnfG','.jpg','attachment;\x20filename*=UTF-8\x27\x27','is_file','raw','path','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','tiny_path','then','toLowerCase','8jBAycC','6954768uPOMzz','maxPsdSize','body','rawImgTypeList','19056UMBapN','basename','7476791GgAEIu','STATE_FAIL','sharp','express','file\x20not\x20found','addFileOperationRecord','headers','deleteNfoAndPoster','check_time','delete'];_0x1e38=function(){return _0x56ea00;};return _0x1e38();}router['get'](_0x295d4f(0x24a),(_0x171d76,_0x4b8ff9,_0x5dd2d9)=>{const _0x2d6db2=_0x295d4f;let _0x49f62e=_0x171d76['query'][_0x2d6db2(0x247)];_0x49f62e=fileUtil[_0x2d6db2(0x1f0)](_0x49f62e);let _0x41bb16=_0x171d76[_0x2d6db2(0x201)][_0x2d6db2(0x240)]==0x1,_0x3788e1=_0x171d76[_0x2d6db2(0x201)][_0x2d6db2(0x224)],_0x91b1f0=_0x171d76[_0x2d6db2(0x201)][_0x2d6db2(0x21e)];fs[_0x2d6db2(0x1fb)](_0x49f62e,(_0x18c796,_0x15012d)=>{const _0x5669bd=_0x2d6db2;if(_0x18c796)return _0x4b8ff9[_0x5669bd(0x1ee)](0x194);if(dbUserTable['doUserCanGet'](_0x171d76,_0x4b8ff9,'','power_get',_0x49f62e)==!![])try{let _0x5b4d4b=_0x171d76[_0x5669bd(0x201)][_0x5669bd(0x252)];if(_0x5b4d4b&&_0x5b4d4b==0x1){if(_0x41bb16){const _0x2643d2=encodeURIComponent(path[_0x5669bd(0x25e)](_0x49f62e))[_0x5669bd(0x203)](/%([0-9A-F]{2})/g,(_0x5261a3,_0x18100f)=>'%'+_0x18100f[_0x5669bd(0x21c)]());_0x4b8ff9['setHeader'](_0x5669bd(0x204),_0x5669bd(0x250)+_0x2643d2);}return _0x4b8ff9['sendFile'](_0x49f62e);}sharpUtil[_0x5669bd(0x1f7)](_0x4b8ff9,_0x49f62e,_0x41bb16,_0x3788e1,_0x91b1f0);}catch(_0x57ff59){return _0x4b8ff9[_0x5669bd(0x1de)](0x194)[_0x5669bd(0x20b)]();}});}),router['get'](_0x295d4f(0x1f5),(_0x4c1989,_0x58e79d,_0x31b9f1)=>{const _0x5423a5=_0x295d4f;let _0x44a474=_0x4c1989[_0x5423a5(0x201)][_0x5423a5(0x247)];_0x44a474=fileUtil[_0x5423a5(0x1f0)](_0x44a474);let _0x18e79d=_0x4c1989[_0x5423a5(0x201)][_0x5423a5(0x224)];fs[_0x5423a5(0x1fb)](_0x44a474,(_0x2d871a,_0xf5d9c1)=>{const _0x2688ae=_0x5423a5;if(_0x2d871a)return _0x58e79d['sendStatus'](0x194);config[_0x2688ae(0x22d)](_0x18e79d,_0x44a474,_0x5631fc=>{const _0x7f670b=_0x2688ae;if(!_0x5631fc)return _0x58e79d[_0x7f670b(0x1ee)](0x194);let _0x3c7d4a=path['join'](config[_0x7f670b(0x206)],_0x5631fc);dbUserTable[_0x7f670b(0x1fa)](_0x4c1989,_0x58e79d,'','power_get',_0x44a474,!![])==!![]&&fs['stat'](_0x3c7d4a,(_0x4fc566,_0x420475)=>{const _0x5d3abf=_0x7f670b;if(_0x4fc566)return genTinyForFilePath(_0x58e79d,_0x44a474,_0x3c7d4a,_0x18e79d);return _0x420475['isFile']()?_0x58e79d[_0x5d3abf(0x221)](_0x3c7d4a):genTinyForFilePath(_0x58e79d,_0x44a474,_0x3c7d4a,_0x18e79d);});});});}),router[_0x295d4f(0x223)](_0x295d4f(0x23d),(_0xf79944,_0x50b40c,_0x60c8ce)=>{const _0x7f8dea=_0x295d4f;let _0x5a955b=_0xf79944[_0x7f8dea(0x201)]['indexId'],_0x3cdeeb=_0xf79944[_0x7f8dea(0x201)][_0x7f8dea(0x228)],_0x5bc79e=getIndexTableName(_0x3cdeeb),_0x53dcb4=getIndexObj(_0xf79944,_0x5a955b);if(!_0x53dcb4)return _0x50b40c['status'](0x194)[_0x7f8dea(0x20b)]();let _0x730623=config['getFileHashName'](_0x53dcb4),_0x53fbff=path['join'](config[_0x7f8dea(0x206)],_0x730623);if(dbUserTable[_0x7f8dea(0x1fa)](_0xf79944,_0x50b40c,_0x3cdeeb,_0x7f8dea(0x1f6),_0x53dcb4['path'])==!![]){let _0x2207a6=path['join'](_0x53dcb4['path'],path[_0x7f8dea(0x1ea)],_0x53dcb4['filename']);fs[_0x7f8dea(0x1fb)](_0x2207a6,(_0x3edf69,_0x1abcf5)=>{const _0xce369f=_0x7f8dea;if(_0x3edf69)return!_0x53dcb4[_0xce369f(0x255)]?_0x50b40c['status'](0x194)[_0xce369f(0x20b)]():fs[_0xce369f(0x1fb)](_0x53dcb4[_0xce369f(0x255)],(_0xbbf745,_0xb725d6)=>{const _0x4ba491=_0xce369f;return _0xbbf745||_0xb725d6&&!_0xb725d6[_0x4ba491(0x22a)]()?_0x50b40c[_0x4ba491(0x1de)](0x194)[_0x4ba491(0x20b)]():_0x50b40c[_0x4ba491(0x221)](_0x53dcb4[_0x4ba491(0x255)]);});if(!_0x1abcf5[_0xce369f(0x22a)]())return _0x50b40c['status'](0x194)['end']();if(!_0x53dcb4['tiny_path']){if(_0x53dcb4[_0xce369f(0x1f2)]==_0xce369f(0x222)&&_0x53dcb4['size']>config[_0xce369f(0x25a)])return console[_0xce369f(0x249)](_0xce369f(0x20f),_0x53dcb4[_0xce369f(0x229)]),_0x50b40c[_0xce369f(0x1de)](0x194)[_0xce369f(0x20b)]();fs['stat'](_0x53fbff,(_0x78119,_0x109395)=>{const _0x4b46d5=_0xce369f;if(_0x78119)return genTiny(_0x50b40c,_0xf79944[_0x4b46d5(0x1f8)]['dbFileIndex'],_0x2207a6,_0x53dcb4,_0x5bc79e,_0x53fbff);return _0x109395['isFile']()&&_0x109395[_0x4b46d5(0x224)]>0x7d0?(dbFileIndexTable[_0x4b46d5(0x243)](_0xf79944['app'][_0x4b46d5(0x1fd)],_0x53dcb4['id'],_0x4b46d5(0x255),_0x53fbff,_0x5bc79e),_0x50b40c[_0x4b46d5(0x221)](_0x53fbff)):genTiny(_0x50b40c,_0xf79944['app'][_0x4b46d5(0x1fd)],_0x2207a6,_0x53dcb4,_0x5bc79e,_0x53fbff);});}else fs[_0xce369f(0x1fb)](_0x53dcb4[_0xce369f(0x255)],(_0x1d679c,_0x5b5bbf)=>{const _0x40b6d5=_0xce369f;return _0x1d679c||!_0x5b5bbf[_0x40b6d5(0x22a)]()?genTiny(_0x50b40c,_0xf79944[_0x40b6d5(0x1f8)][_0x40b6d5(0x1fd)],_0x2207a6,_0x53dcb4,_0x5bc79e,_0x53fbff):_0x50b40c['sendFile'](_0x53dcb4['tiny_path']);});});}}),router[_0x295d4f(0x223)](_0x295d4f(0x22c),(_0x2ff97f,_0x846290,_0x1ce922)=>{const _0x2694ba=_0x295d4f;let _0x4222b1=_0x2ff97f[_0x2694ba(0x201)][_0x2694ba(0x1f4)],_0x4fc2a5=_0x2ff97f['query'][_0x2694ba(0x228)],_0x35d7ba=getIndexObj(_0x2ff97f,_0x4222b1),_0x1a69d1=getIndexTableName(_0x4fc2a5),_0x2f7977=_0x2ff97f[_0x2694ba(0x201)]['download']==0x1,_0x122716=_0x2ff97f['query']['size'],_0x11c2b9=_0x2ff97f[_0x2694ba(0x201)][_0x2694ba(0x21e)];if(!_0x35d7ba)return _0x846290[_0x2694ba(0x1de)](0x194)[_0x2694ba(0x20b)]();if(dbUserTable[_0x2694ba(0x1fa)](_0x2ff97f,_0x846290,_0x4fc2a5,_0x2694ba(0x1f6),_0x35d7ba['path'])==!![]){_0x4fc2a5==_0x2694ba(0x217)&&(dbMusicIndexTable[_0x2694ba(0x216)](_0x2ff97f[_0x2694ba(0x1f8)][_0x2694ba(0x1fd)],_0x4222b1),dbMusicIndexTable[_0x2694ba(0x1da)](_0x2ff97f[_0x2694ba(0x1f8)]['dbFileIndex'],_0x4222b1));dbFileIndexTable[_0x2694ba(0x243)](_0x2ff97f[_0x2694ba(0x1f8)]['dbFileIndex'],_0x4222b1,_0x2694ba(0x267),new Date()[_0x2694ba(0x26a)](),_0x1a69d1);let _0xa4c9ff=_0x35d7ba[_0x2694ba(0x253)]+path[_0x2694ba(0x1ea)]+_0x35d7ba[_0x2694ba(0x229)];fs[_0x2694ba(0x1fb)](_0xa4c9ff,(_0x437a54,_0x44ba5e)=>{const _0x6761ac=_0x2694ba;if(_0x437a54||!_0x44ba5e[_0x6761ac(0x22a)]())return _0x846290[_0x6761ac(0x1de)](0x194)['end']();let _0x10e8ac=_0x2ff97f[_0x6761ac(0x201)][_0x6761ac(0x252)];if(_0x10e8ac&&_0x10e8ac==0x1){if(_0x2f7977){const _0x267c7d=encodeURIComponent(path[_0x6761ac(0x25e)](_0xa4c9ff))[_0x6761ac(0x203)](/%([0-9A-F]{2})/g,(_0x35fbfe,_0x1149cd)=>'%'+_0x1149cd[_0x6761ac(0x21c)]());_0x846290['setHeader']('Content-Disposition',_0x6761ac(0x250)+_0x267c7d);}return _0x846290['sendFile'](_0xa4c9ff);}if(_0x2ff97f[_0x6761ac(0x201)]['transToMp3']==0x1){_0x846290[_0x6761ac(0x22e)](_0x6761ac(0x210),'audio/mpeg');const _0x4af6df=_0x2ff97f[_0x6761ac(0x265)][_0x6761ac(0x20e)];if(_0x6761ac(0x248)==_0x4af6df)return _0x846290['sendFile'](_0xa4c9ff);return musicTransCodeUtil[_0x6761ac(0x218)](_0x846290,_0xa4c9ff);}else _0x2ff97f[_0x6761ac(0x201)][_0x6761ac(0x246)]&&_0x2ff97f['query'][_0x6761ac(0x246)]==_0x6761ac(0x1e6)&&path[_0x6761ac(0x212)](_0xa4c9ff)&&path[_0x6761ac(0x212)](_0xa4c9ff)[_0x6761ac(0x257)]()==_0x6761ac(0x1e5)?(console[_0x6761ac(0x249)](_0x6761ac(0x245),_0xa4c9ff),encodingUtil['getUtf8FileStream'](_0xa4c9ff)[_0x6761ac(0x256)](_0x3aa285=>{const _0x26e12a=_0x6761ac;return _0x3aa285?_0x3aa285['pipe'](_0x846290):(console[_0x26e12a(0x249)](_0x26e12a(0x22f),_0xa4c9ff),_0x846290[_0x26e12a(0x221)](_0xa4c9ff));})):sharpUtil['returnDealedFile'](_0x846290,_0xa4c9ff,_0x2f7977,_0x122716,_0x11c2b9);});}}),router[_0x295d4f(0x1df)](_0x295d4f(0x24b),(_0x162a4d,_0x28c71a,_0x3c2b90)=>{const _0x3e6fc3=_0x295d4f;let _0xfa3a3=_0x162a4d['body'][_0x3e6fc3(0x1f4)],_0x3b0454=getIndexObj(_0x162a4d,_0xfa3a3);if(!_0x3b0454)return _0x28c71a[_0x3e6fc3(0x1de)](0x194)[_0x3e6fc3(0x20b)]();if(dbUserTable['doUserCanGet'](_0x162a4d,_0x28c71a,'','power_get',_0x3b0454['path'])==!![]){let _0x24d61d=_0x3b0454[_0x3e6fc3(0x253)]+path[_0x3e6fc3(0x1ea)]+_0x3b0454['filename'];exifUtil[_0x3e6fc3(0x213)](_0x24d61d)[_0x3e6fc3(0x256)](_0x257efa=>{const _0x429522=_0x3e6fc3;_0x3b0454[_0x429522(0x21f)]=_0x257efa,_0x28c71a[_0x429522(0x242)]({'code':0x0,'data':_0x3b0454});})['catch'](_0x2c1720=>{const _0x26fab9=_0x3e6fc3;_0x3b0454[_0x26fab9(0x21f)]=![],_0x28c71a['json']({'code':0x0,'data':_0x3b0454});});}}),router[_0x295d4f(0x1df)](_0x295d4f(0x202),(_0x53616f,_0x5238d3,_0x1d2e27)=>{const _0x58ad08=_0x295d4f;let _0x1acda8=_0x53616f['body'][_0x58ad08(0x1f4)],_0x11b1a7=getIndexObj(_0x53616f,_0x1acda8),_0x498cb2=getIndexTableName(_0x53616f['query'][_0x58ad08(0x228)]);if(!_0x11b1a7)return _0x5238d3[_0x58ad08(0x242)]({'code':0x2,'message':_0x58ad08(0x263)});try{fs['rm'](_0x11b1a7[_0x58ad08(0x255)],_0xbc1bf6=>{const _0x59e796=_0x58ad08;return _0xbc1bf6?fileUtil[_0x59e796(0x1fe)](_0x5238d3,_0xbc1bf6):(dbFileIndexTable[_0x59e796(0x243)](_0x53616f[_0x59e796(0x1f8)][_0x59e796(0x1fd)],_0x1acda8,_0x59e796(0x255),'',_0x498cb2),_0x5238d3[_0x59e796(0x242)]({'code':0x0}));});}catch(_0x4dc865){return _0x5238d3[_0x58ad08(0x242)]({'code':0x2,'message':_0x58ad08(0x1dd)});}}),module[_0x295d4f(0x214)]=router;