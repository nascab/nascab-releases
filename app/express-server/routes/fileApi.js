const _0x3f9d73=_0xb866;function _0xe43f(){const _0x4d8532=['dbFileIndex','Content-Disposition','size','then','trash','1678224dykZUw','returnDealedFile','/getInfo','/rawFile*','/clearTinyImg','updateById','../utils/fileUtils','power_get','increasePlayCount','123327lsapBi','status','attachment;\x20filename*=UTF-8\x27\x27','dbOther','range','setHeader','code','app','end','body','push','includes','.HEIC','../../myConfig/config','.nfo','getUtf8FileStream','headers','2228368eYmvXI','.txt','videoTypeList','raw_filename','type','join','dirname','../../db/dbUserTable','delete\x20poster:','../../db/dbFileIndexTable','genTinyFile','run','600210OPhDOg','ignoreLivephoto','../../db/dbMusicIndexTable','../../db/dbFileOperationRecord','toLowerCase','getById','Convert\x20to\x20utf8\x20','shell','/tinyImgByPath*','exifInfo','log','decodePath','transToMp3','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','returnErrMsg','PSD文件过大，不生成缩略图','utf8','get','tiny_path','maxPsdSize','deleteIndexFolder','json','ext','inOutTrash','isFile','updatePlayTime','cachePath','quality','getFileHashName','download','is_file','.MOV','path','returnFileError','deleteTvServies','exifr','is_livephoto','/inOutTrash','deleteNfoAndPoster','ids','152vFHFGk','express','delete\x20nfo:','LEVEL_MAIN_OPERATION','sendFile','query','STATE_FAIL','power_delete','toUpperCase','4259724GZPkiE','STATE_SUC','currentUser','Content-Type','video','existsSync','putInSystemTrash','502010bpYOKv','prepare','pipe','changes','audio/mpeg','getFileHashNameByPathAndStat','basename','addFileOperationRecord','3gTCdYm','Router','username','delete','catch','raw','5599629pBNkrG','sendStatus','../../utils/encodingUtil','replace','serverType','deletePathAll','stat','doUserCanGet','.MP4','file\x20not\x20found','image','sep','.psd','indexId','imgTypeList','.JPG','length','post','filename','rawImgTypeList','/rawFileByPath*','parse','photo','extname','bytes=0-1','../../utils/musicTransCodeUtil'];_0xe43f=function(){return _0x4d8532;};return _0xe43f();}function _0xb866(_0x1092e3,_0x4b6e42){const _0xe43ff5=_0xe43f();return _0xb866=function(_0xb866d7,_0x3aea1b){_0xb866d7=_0xb866d7-0x1e1;let _0x38c2d6=_0xe43ff5[_0xb866d7];return _0x38c2d6;},_0xb866(_0x1092e3,_0x4b6e42);}(function(_0x87830b,_0xc3fc24){const _0x21123d=_0xb866,_0x329495=_0x87830b();while(!![]){try{const _0x3d0f91=parseInt(_0x21123d(0x209))/0x1+-parseInt(_0x21123d(0x236))/0x2+-parseInt(_0x21123d(0x211))/0x3*(-parseInt(_0x21123d(0x250))/0x4)+-parseInt(_0x21123d(0x25c))/0x5+-parseInt(_0x21123d(0x202))/0x6+parseInt(_0x21123d(0x217))/0x7+parseInt(_0x21123d(0x1f9))/0x8*(parseInt(_0x21123d(0x23f))/0x9);if(_0x3d0f91===_0xc3fc24)break;else _0x329495['push'](_0x329495['shift']());}catch(_0x23d6cb){_0x329495['push'](_0x329495['shift']());}}}(_0xe43f,0x6defa));let express=require(_0x3f9d73(0x1fa)),router=express[_0x3f9d73(0x212)](),path=require(_0x3f9d73(0x1f1)),fs=require('fs');const sharp=require('sharp');let sharpUtil=require('../utils/sharpUtils'),exifUtil=require(_0x3f9d73(0x1f4)),fileUtil=require(_0x3f9d73(0x23c));const config=require(_0x3f9d73(0x24c)),dbFileIndexTable=require(_0x3f9d73(0x259)),dbFileOperationRecord=require(_0x3f9d73(0x25f)),dbUserTable=require(_0x3f9d73(0x257)),dbMusicIndexTable=require(_0x3f9d73(0x25e));let musicTransCodeUtil=require(_0x3f9d73(0x230));const encodingUtil=require(_0x3f9d73(0x219));function getIndexTableName(_0x3bbfea){let _0x3d3209=dbFileIndexTable['getIndexTableNameByType'](_0x3bbfea);return _0x3d3209;}function getIndexObj(_0x57dd6c,_0x26c57c){const _0x28b28d=_0x3f9d73;let _0x5d4d9b=_0x57dd6c['body'][_0x28b28d(0x21b)]||_0x57dd6c['query'][_0x28b28d(0x21b)],_0xffc585=getIndexTableName(_0x5d4d9b);return dbFileIndexTable[_0x28b28d(0x261)](_0x57dd6c[_0x28b28d(0x246)][_0x28b28d(0x231)],_0x26c57c,_0xffc585);}router['post'](_0x3f9d73(0x1f6),(_0x3c1985,_0x110945,_0x1e25db)=>{const _0x277c5f=_0x3f9d73;let _0x34991f=_0x3c1985['body'][_0x277c5f(0x1f8)],_0x16330d=_0x3c1985['body'][_0x277c5f(0x235)];if(dbUserTable[_0x277c5f(0x21e)](_0x3c1985,_0x110945,_0x277c5f(0x22d),_0x277c5f(0x200))==!![]){if(_0x34991f&&_0x34991f['length']>0x0){let _0x5d0a4f='(';for(let _0x7792af=0x0;_0x7792af<_0x34991f[_0x277c5f(0x227)];_0x7792af++){let _0x2b150d=getIndexObj(_0x3c1985,_0x34991f[_0x7792af]);if(!_0x2b150d)continue;_0x2b150d[_0x277c5f(0x253)]!=null&&_0x2b150d[_0x277c5f(0x253)]!=''&&_0x2b150d['is_file']&&(_0x16330d==0x1?_0x3c1985[_0x277c5f(0x246)]['dbFileIndex'][_0x277c5f(0x20a)]('UPDATE\x20file_index_photo\x20SET\x20is_show=1\x20WHERE\x20path=?\x20AND\x20filename\x20=?')[_0x277c5f(0x25b)](_0x2b150d[_0x277c5f(0x1f1)],_0x2b150d[_0x277c5f(0x253)]):_0x3c1985[_0x277c5f(0x246)][_0x277c5f(0x231)][_0x277c5f(0x20a)](_0x277c5f(0x269))[_0x277c5f(0x25b)](_0x2b150d[_0x277c5f(0x1f1)],_0x2b150d[_0x277c5f(0x253)])),_0x5d0a4f+=_0x34991f[_0x7792af],_0x7792af!=_0x34991f['length']-0x1&&(_0x5d0a4f+=',');}_0x5d0a4f+=')';let _0x135a42=dbFileIndexTable[_0x277c5f(0x1e8)](_0x3c1985[_0x277c5f(0x246)][_0x277c5f(0x231)],_0x5d0a4f,_0x16330d,getIndexTableName(_0x3c1985[_0x277c5f(0x248)][_0x277c5f(0x21b)]));_0x135a42[_0x277c5f(0x20c)]>0x0&&_0x110945[_0x277c5f(0x1e6)]({'code':0x0,'count':_0x135a42[_0x277c5f(0x20c)]});}else{_0x110945[_0x277c5f(0x1e6)]({'code':0x1,'message':'params\x20is\x20not\x20valid'});return;}}}),router[_0x3f9d73(0x228)]('/deleteFromDisk',(_0x45e02d,_0x132c7d,_0x428dd6)=>{const _0x15389e=_0x3f9d73;let _0xc0e839=_0x45e02d[_0x15389e(0x248)][_0x15389e(0x1f8)],_0x2730b1=_0x45e02d[_0x15389e(0x248)]['serverType'],_0x4cdb8f=_0x45e02d[_0x15389e(0x248)][_0x15389e(0x1e5)]==0x1,_0x151a25=_0x45e02d[_0x15389e(0x248)][_0x15389e(0x25d)]==0x1,_0x5627e2=_0x45e02d[_0x15389e(0x248)][_0x15389e(0x208)],_0x169707=getIndexTableName(_0x2730b1),_0x458b75=_0x45e02d[_0x15389e(0x248)][_0x15389e(0x1f7)]==0x1,_0x409da6=_0x45e02d['body'][_0x15389e(0x1f3)]==0x1;function _0x42f15f(_0x48ac83,_0x2e51c8){const _0x314753=_0x15389e;dbFileOperationRecord[_0x314753(0x210)](_0x45e02d[_0x314753(0x246)][_0x314753(0x242)],{'username':_0x45e02d[_0x314753(0x204)][_0x314753(0x213)],'targetPath':_0x48ac83,'level':dbFileOperationRecord[_0x314753(0x1fc)],'type':dbFileOperationRecord['TYPE_DELETE'],'state':_0x2e51c8?dbFileOperationRecord[_0x314753(0x203)]:dbFileOperationRecord[_0x314753(0x1ff)]});}function _0x229a76(_0x303bc6){const _0x156102=_0x15389e;if(_0x303bc6['is_file']==0x1&&_0x303bc6[_0x156102(0x1f5)]==0x1){let _0x2e6b5a=path[_0x156102(0x255)](_0x303bc6[_0x156102(0x1f1)],_0x303bc6[_0x156102(0x229)][_0x156102(0x21a)](_0x156102(0x1f0),'')+_0x156102(0x24b));_0x303bc6['filename']['endsWith'](_0x156102(0x21f))&&(_0x2e6b5a=path[_0x156102(0x255)](_0x303bc6[_0x156102(0x1f1)],_0x303bc6[_0x156102(0x229)][_0x156102(0x21a)](_0x156102(0x21f),'')+_0x156102(0x226))),fs[_0x156102(0x207)](_0x2e6b5a)&&_0x2f804b(_0x303bc6,_0x2e6b5a,![]);}}function _0x2f804b(_0x24a08b,_0x264c02,_0x100f41){const _0x2f7518=_0x15389e;_0x5627e2==0x1?(process['send']({'type':_0x2f7518(0x263),'shellType':'trash','path':_0x264c02}),_0x42f15f(_0x264c02,!![])):fs['rm'](_0x264c02,{'recursive':!![]},_0x20d569=>{_0x20d569?_0x42f15f(_0x264c02,![]):_0x42f15f(_0x264c02,!![]);}),_0x24a08b&&_0x100f41&&_0x229a76(_0x24a08b);}function _0x2680d5(_0x463494){const _0x266245=_0x15389e;dbFileIndexTable['delete'](_0x45e02d[_0x266245(0x246)]['dbFileIndex'],_0x463494,_0x169707);}function _0x33df51(_0x204c66,_0xf41c61){const _0x5f00ea=_0x15389e;if(!_0xf41c61)return;dbFileIndexTable[_0x5f00ea(0x214)](_0x45e02d[_0x5f00ea(0x246)][_0x5f00ea(0x231)],_0x204c66,_0x169707),dbFileIndexTable[_0x5f00ea(0x21c)](_0x45e02d[_0x5f00ea(0x246)][_0x5f00ea(0x231)],_0xf41c61,_0x169707);}if(_0xc0e839&&_0xc0e839['length']>0x0){let _0x1d2ef6=0x0,_0x2e277d=0x0,_0x3ea5c6=[];for(let _0x370b2b=0x0;_0x370b2b<_0xc0e839[_0x15389e(0x227)];_0x370b2b++){let _0x401589=_0xc0e839[_0x370b2b],_0x16eb1b=getIndexObj(_0x45e02d,_0x401589,_0x169707);if(_0x16eb1b){let _0x3eff71=_0x16eb1b[_0x15389e(0x1f1)];_0x409da6&&(_0x3eff71=path['dirname'](_0x16eb1b['path']));if(dbUserTable[_0x15389e(0x21e)](_0x45e02d,_0x132c7d,_0x2730b1,_0x15389e(0x200),_0x3eff71)==!![]){_0x1d2ef6+=0x1,_0x3ea5c6[_0x15389e(0x249)](_0x401589);let _0x34533c=path[_0x15389e(0x255)](_0x16eb1b[_0x15389e(0x1f1)],path[_0x15389e(0x222)],_0x16eb1b[_0x15389e(0x229)]),_0x293dc8=_0x16eb1b[_0x15389e(0x1ef)]==0x0;_0x4cdb8f&&(_0x34533c=_0x16eb1b[_0x15389e(0x1f1)],_0x293dc8=!![]);_0x409da6&&(_0x34533c=path['dirname'](_0x16eb1b['path']),_0x293dc8=!![]);_0x293dc8?_0x33df51(_0x401589,_0x34533c):_0x2680d5(_0x401589);_0x2f804b(_0x16eb1b,_0x34533c,!_0x151a25);if(_0x458b75){let _0x1991d9=path[_0x15389e(0x255)](_0x16eb1b[_0x15389e(0x1f1)],_0x16eb1b['filename'][_0x15389e(0x21a)](path[_0x15389e(0x22e)](_0x16eb1b[_0x15389e(0x229)]),_0x15389e(0x24d))),_0x52cd28=path[_0x15389e(0x255)](_0x16eb1b[_0x15389e(0x1f1)],_0x16eb1b[_0x15389e(0x229)][_0x15389e(0x21a)](path[_0x15389e(0x22e)](_0x16eb1b[_0x15389e(0x229)]),'.jpg')),_0x168885=path[_0x15389e(0x255)](_0x16eb1b[_0x15389e(0x1f1)],_0x16eb1b['filename'][_0x15389e(0x21a)](path['extname'](_0x16eb1b[_0x15389e(0x229)]),'-fanart.jpg'));fs['existsSync'](_0x1991d9)&&(console['log'](_0x15389e(0x1fb),_0x1991d9),_0x2f804b(null,_0x1991d9)),fs[_0x15389e(0x207)](_0x52cd28)&&(console['log'](_0x15389e(0x258),_0x52cd28),_0x2f804b(null,_0x52cd28)),fs[_0x15389e(0x207)](_0x168885)&&(console[_0x15389e(0x266)]('delete\x20fanart:',_0x168885),_0x2f804b(null,_0x168885));}}else _0x2e277d+=0x1;}}return _0x132c7d[_0x15389e(0x1e6)]({'code':0x0,'deletedIds':_0x3ea5c6,'deleteCount':_0x1d2ef6,'errCount':_0x2e277d});}else return _0x45e02d[_0x15389e(0x246)][_0x15389e(0x26a)](_0x132c7d,'params\x20is\x20not\x20valid');});function genTinyForFilePath(_0x4772ed,_0x52c868,_0x192a80,_0x1b6f4b){const _0x46dc93=_0x3f9d73;let _0x1b7a26=path[_0x46dc93(0x22e)](_0x52c868)?path[_0x46dc93(0x22e)](_0x52c868)[_0x46dc93(0x260)]():null,_0x510105=![];if(config[_0x46dc93(0x225)]['includes'](_0x1b7a26)||config[_0x46dc93(0x22a)][_0x46dc93(0x24a)](_0x1b7a26[_0x46dc93(0x260)]()))_0x510105='image';else{if(config[_0x46dc93(0x252)][_0x46dc93(0x24a)](_0x1b7a26))_0x510105=_0x46dc93(0x206);else return _0x4772ed[_0x46dc93(0x240)](0x194)[_0x46dc93(0x247)]();}sharpUtil[_0x46dc93(0x25a)](_0x52c868,path['dirname'](_0x192a80),path[_0x46dc93(0x20f)](_0x192a80),_0x510105,null,_0x3da796=>{const _0x34e677=_0x46dc93;_0x4772ed[_0x34e677(0x1fd)](_0x3da796);},_0x19933c=>{const _0x31da6f=_0x46dc93;return _0x4772ed[_0x31da6f(0x240)](0x194)[_0x31da6f(0x247)]();},_0x1b6f4b);}function genTiny(_0x14f0a0,_0x3f0573,_0x4e9cb3,_0x3084c8,_0x16953c,_0x54b974){const _0x4675a4=_0x3f9d73;let _0x464b85=_0x4675a4(0x221);_0x3084c8[_0x4675a4(0x254)]==0x2&&(_0x464b85=_0x4675a4(0x206)),sharpUtil[_0x4675a4(0x25a)](_0x4e9cb3,path[_0x4675a4(0x256)](_0x54b974),path[_0x4675a4(0x20f)](_0x54b974),_0x464b85,_0x3084c8,_0x41af32=>{const _0xbefd06=_0x4675a4;dbFileIndexTable[_0xbefd06(0x23b)](_0x3f0573,_0x3084c8['id'],_0xbefd06(0x1e3),_0x41af32,_0x16953c),_0x14f0a0[_0xbefd06(0x1fd)](_0x41af32);},_0x51fc7f=>{const _0x5a910f=_0x4675a4;return _0x14f0a0['status'](0x194)[_0x5a910f(0x247)]();});}router[_0x3f9d73(0x1e2)](_0x3f9d73(0x22b),(_0x17cb25,_0x392fa7,_0x484472)=>{const _0x3e97f4=_0x3f9d73;let _0x1f9b9f=_0x17cb25[_0x3e97f4(0x1fe)]['fullPath'];_0x1f9b9f=fileUtil['decodePath'](_0x1f9b9f);let _0x29a666=_0x17cb25[_0x3e97f4(0x1fe)][_0x3e97f4(0x1ee)]==0x1,_0x644771=_0x17cb25['query']['size'],_0x490434=_0x17cb25[_0x3e97f4(0x1fe)]['quality'];fs[_0x3e97f4(0x21d)](_0x1f9b9f,(_0x457148,_0x1d7eeb)=>{const _0x262b01=_0x3e97f4;if(_0x457148)return _0x392fa7[_0x262b01(0x218)](0x194);if(dbUserTable[_0x262b01(0x21e)](_0x17cb25,_0x392fa7,'',_0x262b01(0x23d),_0x1f9b9f)==!![])try{let _0x46f036=_0x17cb25[_0x262b01(0x1fe)][_0x262b01(0x216)];if(_0x46f036&&_0x46f036==0x1){if(_0x29a666){const _0x54a97b=encodeURIComponent(path[_0x262b01(0x20f)](_0x1f9b9f))[_0x262b01(0x21a)](/%([0-9A-F]{2})/g,(_0x2ebb01,_0x31a7f6)=>'%'+_0x31a7f6[_0x262b01(0x201)]());_0x392fa7['setHeader'](_0x262b01(0x232),'attachment;\x20filename*=UTF-8\x27\x27'+_0x54a97b);}return _0x392fa7[_0x262b01(0x1fd)](_0x1f9b9f);}sharpUtil[_0x262b01(0x237)](_0x392fa7,_0x1f9b9f,_0x29a666,_0x644771,_0x490434);}catch(_0x44c103){return _0x392fa7[_0x262b01(0x240)](0x194)['end']();}});}),router[_0x3f9d73(0x1e2)](_0x3f9d73(0x264),(_0x1dc019,_0x45401e,_0x8825ad)=>{const _0x348de3=_0x3f9d73;let _0x3937ae=_0x1dc019[_0x348de3(0x1fe)]['fullPath'];_0x3937ae=fileUtil[_0x348de3(0x267)](_0x3937ae);let _0x30fc35=_0x1dc019['query'][_0x348de3(0x233)];fs[_0x348de3(0x21d)](_0x3937ae,(_0x1822cc,_0x42304e)=>{const _0xc3a86=_0x348de3;if(_0x1822cc)return _0x45401e[_0xc3a86(0x218)](0x194);config[_0xc3a86(0x20e)](_0x30fc35,_0x3937ae,_0x5f266c=>{const _0x3112ed=_0xc3a86;if(!_0x5f266c)return _0x45401e[_0x3112ed(0x218)](0x194);let _0x226068=path['join'](config[_0x3112ed(0x1eb)],_0x5f266c);dbUserTable[_0x3112ed(0x21e)](_0x1dc019,_0x45401e,'','power_get',_0x3937ae,!![])==!![]&&fs[_0x3112ed(0x21d)](_0x226068,(_0xa3ac01,_0x33c002)=>{const _0x5e1407=_0x3112ed;if(_0xa3ac01)return genTinyForFilePath(_0x45401e,_0x3937ae,_0x226068,_0x30fc35);return _0x33c002[_0x5e1407(0x1e9)]()?_0x45401e[_0x5e1407(0x1fd)](_0x226068):genTinyForFilePath(_0x45401e,_0x3937ae,_0x226068,_0x30fc35);});});});}),router['get']('/tinyImg*',(_0x4bc273,_0x168f98,_0x2a0c13)=>{const _0x2e6558=_0x3f9d73;let _0x2edb40=_0x4bc273[_0x2e6558(0x1fe)][_0x2e6558(0x224)],_0xd2f47=_0x4bc273['query'][_0x2e6558(0x21b)],_0x41c321=getIndexTableName(_0xd2f47),_0x7d5c30=getIndexObj(_0x4bc273,_0x2edb40);if(!_0x7d5c30)return _0x168f98[_0x2e6558(0x240)](0x194)[_0x2e6558(0x247)]();let _0x50b83c=config[_0x2e6558(0x1ed)](_0x7d5c30),_0x21c1f1=path[_0x2e6558(0x255)](config['cachePath'],_0x50b83c);if(dbUserTable['doUserCanGet'](_0x4bc273,_0x168f98,_0xd2f47,'power_get',_0x7d5c30['path'])==!![]){let _0x5a9a39=path['join'](_0x7d5c30[_0x2e6558(0x1f1)],path[_0x2e6558(0x222)],_0x7d5c30[_0x2e6558(0x229)]);fs[_0x2e6558(0x21d)](_0x5a9a39,(_0x53c4ae,_0x5b1114)=>{const _0x341e9c=_0x2e6558;if(_0x53c4ae)return!_0x7d5c30['tiny_path']?_0x168f98[_0x341e9c(0x240)](0x194)['end']():fs[_0x341e9c(0x21d)](_0x7d5c30['tiny_path'],(_0x4c41ba,_0x1d74a7)=>{const _0x58e890=_0x341e9c;return _0x4c41ba||_0x1d74a7&&!_0x1d74a7[_0x58e890(0x1e9)]()?_0x168f98['status'](0x194)[_0x58e890(0x247)]():_0x168f98['sendFile'](_0x7d5c30['tiny_path']);});if(!_0x5b1114[_0x341e9c(0x1e9)]())return _0x168f98[_0x341e9c(0x240)](0x194)[_0x341e9c(0x247)]();if(!_0x7d5c30[_0x341e9c(0x1e3)]){if(_0x7d5c30[_0x341e9c(0x1e7)]==_0x341e9c(0x223)&&_0x7d5c30['size']>config[_0x341e9c(0x1e4)])return console[_0x341e9c(0x266)](_0x341e9c(0x26b),_0x7d5c30[_0x341e9c(0x229)]),_0x168f98[_0x341e9c(0x240)](0x194)[_0x341e9c(0x247)]();fs['stat'](_0x21c1f1,(_0x152396,_0x588bda)=>{const _0x7469f0=_0x341e9c;if(_0x152396)return genTiny(_0x168f98,_0x4bc273['app'][_0x7469f0(0x231)],_0x5a9a39,_0x7d5c30,_0x41c321,_0x21c1f1);return _0x588bda[_0x7469f0(0x1e9)]()&&_0x588bda[_0x7469f0(0x233)]>0x7d0?(dbFileIndexTable['updateById'](_0x4bc273[_0x7469f0(0x246)][_0x7469f0(0x231)],_0x7d5c30['id'],_0x7469f0(0x1e3),_0x21c1f1,_0x41c321),_0x168f98['sendFile'](_0x21c1f1)):genTiny(_0x168f98,_0x4bc273[_0x7469f0(0x246)]['dbFileIndex'],_0x5a9a39,_0x7d5c30,_0x41c321,_0x21c1f1);});}else fs[_0x341e9c(0x21d)](_0x7d5c30[_0x341e9c(0x1e3)],(_0x395e25,_0x302e36)=>{const _0x344f74=_0x341e9c;return _0x395e25||!_0x302e36[_0x344f74(0x1e9)]()?genTiny(_0x168f98,_0x4bc273[_0x344f74(0x246)][_0x344f74(0x231)],_0x5a9a39,_0x7d5c30,_0x41c321,_0x21c1f1):_0x168f98[_0x344f74(0x1fd)](_0x7d5c30[_0x344f74(0x1e3)]);});});}}),router[_0x3f9d73(0x1e2)](_0x3f9d73(0x239),(_0x3fa091,_0x5a3c55,_0x5ec586)=>{const _0xfe2bed=_0x3f9d73;let _0x4d090e=_0x3fa091[_0xfe2bed(0x1fe)]['indexId'],_0x21027b=_0x3fa091[_0xfe2bed(0x1fe)][_0xfe2bed(0x21b)],_0x204fcb=getIndexObj(_0x3fa091,_0x4d090e),_0x88f579=getIndexTableName(_0x21027b),_0x58e1cb=_0x3fa091[_0xfe2bed(0x1fe)][_0xfe2bed(0x1ee)]==0x1,_0x148ea5=_0x3fa091['query'][_0xfe2bed(0x233)],_0x413de1=_0x3fa091[_0xfe2bed(0x1fe)][_0xfe2bed(0x1ec)];if(!_0x204fcb)return _0x5a3c55[_0xfe2bed(0x240)](0x194)['end']();if(dbUserTable[_0xfe2bed(0x21e)](_0x3fa091,_0x5a3c55,_0x21027b,'power_get',_0x204fcb[_0xfe2bed(0x1f1)])==!![]){_0x21027b=='music'&&(dbMusicIndexTable[_0xfe2bed(0x23e)](_0x3fa091['app']['dbFileIndex'],_0x4d090e),dbMusicIndexTable[_0xfe2bed(0x1ea)](_0x3fa091['app']['dbFileIndex'],_0x4d090e));dbFileIndexTable['updateById'](_0x3fa091[_0xfe2bed(0x246)][_0xfe2bed(0x231)],_0x4d090e,'check_time',new Date()['getTime'](),_0x88f579);let _0x8f222c=_0x204fcb[_0xfe2bed(0x1f1)]+path['sep']+_0x204fcb[_0xfe2bed(0x229)];fs[_0xfe2bed(0x21d)](_0x8f222c,(_0x5b4ad1,_0x26d7ff)=>{const _0x38c5ff=_0xfe2bed;if(_0x5b4ad1||!_0x26d7ff[_0x38c5ff(0x1e9)]())return _0x5a3c55[_0x38c5ff(0x240)](0x194)[_0x38c5ff(0x247)]();let _0x2b22cd=_0x3fa091[_0x38c5ff(0x1fe)][_0x38c5ff(0x216)];if(_0x2b22cd&&_0x2b22cd==0x1){if(_0x58e1cb){const _0x243bff=encodeURIComponent(path[_0x38c5ff(0x20f)](_0x8f222c))[_0x38c5ff(0x21a)](/%([0-9A-F]{2})/g,(_0x5654ea,_0x30f4a0)=>'%'+_0x30f4a0['toUpperCase']());_0x5a3c55[_0x38c5ff(0x244)]('Content-Disposition',_0x38c5ff(0x241)+_0x243bff);}return _0x5a3c55['sendFile'](_0x8f222c);}if(_0x3fa091[_0x38c5ff(0x1fe)][_0x38c5ff(0x268)]==0x1){_0x5a3c55['set'](_0x38c5ff(0x205),_0x38c5ff(0x20d));const _0x28e393=_0x3fa091[_0x38c5ff(0x24f)][_0x38c5ff(0x243)];if(_0x38c5ff(0x22f)==_0x28e393)return _0x5a3c55[_0x38c5ff(0x1fd)](_0x8f222c);return musicTransCodeUtil[_0x38c5ff(0x268)](_0x5a3c55,_0x8f222c);}else _0x3fa091[_0x38c5ff(0x1fe)][_0x38c5ff(0x245)]&&_0x3fa091[_0x38c5ff(0x1fe)][_0x38c5ff(0x245)]==_0x38c5ff(0x1e1)&&path[_0x38c5ff(0x22e)](_0x8f222c)&&path[_0x38c5ff(0x22e)](_0x8f222c)['toLowerCase']()==_0x38c5ff(0x251)?(console[_0x38c5ff(0x266)](_0x38c5ff(0x262),_0x8f222c),encodingUtil[_0x38c5ff(0x24e)](_0x8f222c)[_0x38c5ff(0x234)](_0x36af06=>{const _0x5dddbf=_0x38c5ff;return _0x36af06?_0x36af06[_0x5dddbf(0x20b)](_0x5a3c55):(console[_0x5dddbf(0x266)]('Unable\x20to\x20read\x20file',_0x8f222c),_0x5a3c55['sendFile'](_0x8f222c));})):sharpUtil['returnDealedFile'](_0x5a3c55,_0x8f222c,_0x58e1cb,_0x148ea5,_0x413de1);});}}),router[_0x3f9d73(0x228)](_0x3f9d73(0x238),(_0x53adac,_0x419fb3,_0x2324bb)=>{const _0x33ad5f=_0x3f9d73;let _0x5a62e1=_0x53adac['body'][_0x33ad5f(0x224)],_0x472fe3=getIndexObj(_0x53adac,_0x5a62e1);if(!_0x472fe3)return _0x419fb3['status'](0x194)[_0x33ad5f(0x247)]();if(dbUserTable[_0x33ad5f(0x21e)](_0x53adac,_0x419fb3,'',_0x33ad5f(0x23d),_0x472fe3[_0x33ad5f(0x1f1)])==!![]){let _0x2309a7=_0x472fe3[_0x33ad5f(0x1f1)]+path[_0x33ad5f(0x222)]+_0x472fe3[_0x33ad5f(0x229)];exifUtil[_0x33ad5f(0x22c)](_0x2309a7)['then'](_0x3cd7ee=>{const _0x26f9f1=_0x33ad5f;_0x472fe3[_0x26f9f1(0x265)]=_0x3cd7ee,_0x419fb3[_0x26f9f1(0x1e6)]({'code':0x0,'data':_0x472fe3});})[_0x33ad5f(0x215)](_0x57397c=>{const _0x2c4113=_0x33ad5f;_0x472fe3[_0x2c4113(0x265)]=![],_0x419fb3['json']({'code':0x0,'data':_0x472fe3});});}}),router['post'](_0x3f9d73(0x23a),(_0x113dd2,_0x3424cc,_0x4e1bdd)=>{const _0x3319d4=_0x3f9d73;let _0x136420=_0x113dd2['body'][_0x3319d4(0x224)],_0x184c3e=getIndexObj(_0x113dd2,_0x136420),_0x4d058f=getIndexTableName(_0x113dd2[_0x3319d4(0x1fe)][_0x3319d4(0x21b)]);if(!_0x184c3e)return _0x3424cc[_0x3319d4(0x1e6)]({'code':0x2,'message':_0x3319d4(0x220)});try{fs['rm'](_0x184c3e[_0x3319d4(0x1e3)],_0x148ff4=>{const _0x513a59=_0x3319d4;return _0x148ff4?fileUtil[_0x513a59(0x1f2)](_0x3424cc,_0x148ff4):(dbFileIndexTable['updateById'](_0x113dd2[_0x513a59(0x246)][_0x513a59(0x231)],_0x136420,_0x513a59(0x1e3),'',_0x4d058f),_0x3424cc[_0x513a59(0x1e6)]({'code':0x0}));});}catch(_0x14ec06){return _0x3424cc[_0x3319d4(0x1e6)]({'code':0x2,'message':'operation\x20fail'});}}),module['exports']=router;