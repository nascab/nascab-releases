const _0x877192=_0x128e;(function(_0x7c2d8f,_0x9916ee){const _0x3b1b67=_0x128e,_0x340f5f=_0x7c2d8f();while(!![]){try{const _0x48ce6=parseInt(_0x3b1b67(0x107))/0x1*(parseInt(_0x3b1b67(0xd7))/0x2)+parseInt(_0x3b1b67(0xdd))/0x3+parseInt(_0x3b1b67(0xe3))/0x4+-parseInt(_0x3b1b67(0x141))/0x5+-parseInt(_0x3b1b67(0xcd))/0x6*(-parseInt(_0x3b1b67(0x129))/0x7)+-parseInt(_0x3b1b67(0x10c))/0x8*(-parseInt(_0x3b1b67(0xc3))/0x9)+-parseInt(_0x3b1b67(0x134))/0xa;if(_0x48ce6===_0x9916ee)break;else _0x340f5f['push'](_0x340f5f['shift']());}catch(_0x42f3d4){_0x340f5f['push'](_0x340f5f['shift']());}}}(_0x4f69,0xb6c18));let express=require(_0x877192(0x128)),router=express[_0x877192(0x13f)](),path=require(_0x877192(0x143)),fs=require('fs');const sharp=require(_0x877192(0x105));let sharpUtil=require('../utils/sharpUtils'),exifUtil=require('exifr'),fileUtil=require('../utils/fileUtils');const config=require(_0x877192(0x140)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbFileOperationRecord=require(_0x877192(0xca)),dbUserTable=require(_0x877192(0xfa)),dbMusicIndexTable=require(_0x877192(0xeb));let musicTransCodeUtil=require(_0x877192(0xf0));function _0x4f69(){const _0x4d0f73=['LEVEL_MAIN_OPERATION','getIndexTableNameByType','putInSystemTrash','replace','power_get','sendFile','addFileOperationRecord','deleteIndexFolder','quality','get','ext','filename','post','delete\x20poster:','deleteTvServies','/deleteFromDisk','Content-Disposition','dirname','video','run','pipe','.txt','image','express','812MlLmgM','/rawFile*','existsSync','toLowerCase','audio/mpeg','../../utils/encodingUtil','videoTypeList','currentUser','prepare','TYPE_DELETE','then','23136530whomMR','is_livephoto','/clearTinyImg','doUserCanGet','sep','length','end','.nfo','.psd','json','returnDealedFile','Router','../../myConfig/config','7393545kbDHtB','music','path','.jpg','file\x20not\x20found','utf8','params\x20is\x20not\x20valid','getUtf8FileStream','raw_filename','/tinyImgByPath*','delete','69381wjonIo','raw','dbFileIndex','toUpperCase','returnFileError','log','power_delete','../../db/dbFileOperationRecord','exifInfo','attachment;\x20filename*=UTF-8\x27\x27','20586rYHrAN','updatePlayTime','sendStatus','setHeader','deletePathAll','UPDATE\x20file_index_photo\x20SET\x20is_show=1\x20WHERE\x20path=?\x20AND\x20filename\x20=?','exports','/getInfo','body','tiny_path','456vSbMqV','code','transToMp3','getFileHashName','-fanart.jpg','includes','2756949HHJgLu','changes','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','download','basename','Convert\x20to\x20utf8\x20','5134144FvoUuC','fullPath','decodePath','/rawFileByPath*','join','stat','extname','maxPsdSize','../../db/dbMusicIndexTable','.MOV','status','getTime','isFile','../../utils/musicTransCodeUtil','genTinyFile','push','type','dbOther','app','STATE_SUC','query','ids','delete\x20fanart:','../../db/dbUserTable','delete\x20nfo:','size','deleteNfoAndPoster','trash','.JPG','getFileHashNameByPathAndStat','returnErrMsg','range','indexId','rawImgTypeList','sharp','cachePath','5569ytGrFQ','serverType','.HEIC','STATE_FAIL','is_file','696UOkzIH','.MP4','/tinyImg*','PSD文件过大，不生成缩略图','updateById'];_0x4f69=function(){return _0x4d0f73;};return _0x4f69();}const encodingUtil=require(_0x877192(0x12e));function getIndexTableName(_0x3afa84){const _0x3644e3=_0x877192;let _0x3a470d=dbFileIndexTable[_0x3644e3(0x112)](_0x3afa84);return _0x3a470d;}function getIndexObj(_0xa6c295,_0x58a410){const _0x7e0665=_0x877192;let _0x2c7d0e=_0xa6c295[_0x7e0665(0xd5)][_0x7e0665(0x108)]||_0xa6c295['query'][_0x7e0665(0x108)],_0x4dd604=getIndexTableName(_0x2c7d0e);return dbFileIndexTable['getById'](_0xa6c295[_0x7e0665(0xf5)]['dbFileIndex'],_0x58a410,_0x4dd604);}function _0x128e(_0x1d45f3,_0x1af9a0){const _0x4f69c4=_0x4f69();return _0x128e=function(_0x128e58,_0x1b6e71){_0x128e58=_0x128e58-0xbd;let _0x36301d=_0x4f69c4[_0x128e58];return _0x36301d;},_0x128e(_0x1d45f3,_0x1af9a0);}router[_0x877192(0x11d)]('/inOutTrash',(_0x1a5f59,_0x4d2661,_0x310deb)=>{const _0x49672b=_0x877192;let _0xf857d6=_0x1a5f59[_0x49672b(0xd5)][_0x49672b(0xf8)],_0x56c4f=_0x1a5f59[_0x49672b(0xd5)][_0x49672b(0xfe)];if(dbUserTable['doUserCanGet'](_0x1a5f59,_0x4d2661,'photo',_0x49672b(0xc9))==!![]){if(_0xf857d6&&_0xf857d6[_0x49672b(0x139)]>0x0){let _0x563c1e='(';for(let _0x5e12e2=0x0;_0x5e12e2<_0xf857d6[_0x49672b(0x139)];_0x5e12e2++){let _0x4f21db=getIndexObj(_0x1a5f59,_0xf857d6[_0x5e12e2]);if(!_0x4f21db)continue;_0x4f21db[_0x49672b(0xc0)]!=null&&_0x4f21db[_0x49672b(0xc0)]!=''&&_0x4f21db['is_file']&&(_0x56c4f==0x1?_0x1a5f59[_0x49672b(0xf5)]['dbFileIndex'][_0x49672b(0x131)](_0x49672b(0xd2))[_0x49672b(0x124)](_0x4f21db[_0x49672b(0x143)],_0x4f21db['raw_filename']):_0x1a5f59[_0x49672b(0xf5)][_0x49672b(0xc5)][_0x49672b(0x131)](_0x49672b(0xdf))[_0x49672b(0x124)](_0x4f21db[_0x49672b(0x143)],_0x4f21db[_0x49672b(0xc0)])),_0x563c1e+=_0xf857d6[_0x5e12e2],_0x5e12e2!=_0xf857d6[_0x49672b(0x139)]-0x1&&(_0x563c1e+=',');}_0x563c1e+=')';let _0x139483=dbFileIndexTable['inOutTrash'](_0x1a5f59[_0x49672b(0xf5)][_0x49672b(0xc5)],_0x563c1e,_0x56c4f,getIndexTableName(_0x1a5f59[_0x49672b(0xd5)][_0x49672b(0x108)]));_0x139483[_0x49672b(0xde)]>0x0&&_0x4d2661[_0x49672b(0x13d)]({'code':0x0,'count':_0x139483[_0x49672b(0xde)]});}else{_0x4d2661[_0x49672b(0x13d)]({'code':0x1,'message':_0x49672b(0xbe)});return;}}}),router[_0x877192(0x11d)](_0x877192(0x120),(_0x52813c,_0x1f0da4,_0x3f808b)=>{const _0x3b56a0=_0x877192;let _0x43cb85=_0x52813c[_0x3b56a0(0xd5)][_0x3b56a0(0xf8)],_0x5d7d00=_0x52813c['body'][_0x3b56a0(0x108)],_0x22013a=_0x52813c[_0x3b56a0(0xd5)][_0x3b56a0(0x118)]==0x1,_0x161454=_0x52813c[_0x3b56a0(0xd5)]['ignoreLivephoto']==0x1,_0x3f85e0=_0x52813c[_0x3b56a0(0xd5)][_0x3b56a0(0x113)],_0x1d4bf3=getIndexTableName(_0x5d7d00),_0x22a50d=_0x52813c['body'][_0x3b56a0(0xfd)]==0x1,_0x21d2e7=_0x52813c[_0x3b56a0(0xd5)][_0x3b56a0(0x11f)]==0x1;function _0x1fdd4e(_0x189810,_0x57262d){const _0xefac85=_0x3b56a0;dbFileOperationRecord[_0xefac85(0x117)](_0x52813c[_0xefac85(0xf5)][_0xefac85(0xf4)],{'username':_0x52813c[_0xefac85(0x130)]['username'],'targetPath':_0x189810,'level':dbFileOperationRecord[_0xefac85(0x111)],'type':dbFileOperationRecord[_0xefac85(0x132)],'state':_0x57262d?dbFileOperationRecord[_0xefac85(0xf6)]:dbFileOperationRecord[_0xefac85(0x10a)]});}function _0x26e1f4(_0x4d1ada){const _0x480533=_0x3b56a0;if(_0x4d1ada[_0x480533(0x10b)]==0x1&&_0x4d1ada[_0x480533(0x135)]==0x1){let _0x8d973f=path['join'](_0x4d1ada['path'],_0x4d1ada[_0x480533(0x11c)][_0x480533(0x114)](_0x480533(0xec),'')+_0x480533(0x109));_0x4d1ada[_0x480533(0x11c)]['endsWith'](_0x480533(0x10d))&&(_0x8d973f=path[_0x480533(0xe7)](_0x4d1ada['path'],_0x4d1ada['filename'][_0x480533(0x114)]('.MP4','')+_0x480533(0xff))),fs[_0x480533(0x12b)](_0x8d973f)&&_0x30579d(_0x4d1ada,_0x8d973f,![]);}}function _0x30579d(_0x565b48,_0x3572ae,_0x31baa0){_0x3f85e0==0x1?(process['send']({'type':'shell','shellType':'trash','path':_0x3572ae}),_0x1fdd4e(_0x3572ae,!![])):fs['rm'](_0x3572ae,{'recursive':!![]},_0x25ffdb=>{_0x25ffdb?_0x1fdd4e(_0x3572ae,![]):_0x1fdd4e(_0x3572ae,!![]);}),_0x565b48&&_0x31baa0&&_0x26e1f4(_0x565b48);}function _0x3080a0(_0x466cf7){const _0x59d16e=_0x3b56a0;dbFileIndexTable[_0x59d16e(0xc2)](_0x52813c[_0x59d16e(0xf5)][_0x59d16e(0xc5)],_0x466cf7,_0x1d4bf3);}function _0x24d9d5(_0x4f6de8,_0x46b4f3){const _0x435f02=_0x3b56a0;if(!_0x46b4f3)return;dbFileIndexTable[_0x435f02(0xc2)](_0x52813c[_0x435f02(0xf5)]['dbFileIndex'],_0x4f6de8,_0x1d4bf3),dbFileIndexTable[_0x435f02(0xd1)](_0x52813c[_0x435f02(0xf5)]['dbFileIndex'],_0x46b4f3,_0x1d4bf3);}if(_0x43cb85&&_0x43cb85['length']>0x0){let _0x5a02cb=0x0,_0xd8cd73=0x0,_0x51083b=[];for(let _0x35ab72=0x0;_0x35ab72<_0x43cb85[_0x3b56a0(0x139)];_0x35ab72++){let _0x325ae3=_0x43cb85[_0x35ab72],_0x4a4c7b=getIndexObj(_0x52813c,_0x325ae3,_0x1d4bf3);if(_0x4a4c7b){let _0xb746ef=_0x4a4c7b['path'];_0x21d2e7&&(_0xb746ef=path[_0x3b56a0(0x122)](_0x4a4c7b['path']));if(dbUserTable[_0x3b56a0(0x137)](_0x52813c,_0x1f0da4,_0x5d7d00,_0x3b56a0(0xc9),_0xb746ef)==!![]){_0x5a02cb+=0x1,_0x51083b[_0x3b56a0(0xf2)](_0x325ae3);let _0x1982ed=path[_0x3b56a0(0xe7)](_0x4a4c7b[_0x3b56a0(0x143)],path[_0x3b56a0(0x138)],_0x4a4c7b[_0x3b56a0(0x11c)]),_0x5500c3=_0x4a4c7b['is_file']==0x0;_0x22013a&&(_0x1982ed=_0x4a4c7b[_0x3b56a0(0x143)],_0x5500c3=!![]);_0x21d2e7&&(_0x1982ed=path[_0x3b56a0(0x122)](_0x4a4c7b[_0x3b56a0(0x143)]),_0x5500c3=!![]);_0x5500c3?_0x24d9d5(_0x325ae3,_0x1982ed):_0x3080a0(_0x325ae3);_0x30579d(_0x4a4c7b,_0x1982ed,!_0x161454);if(_0x22a50d){let _0xc7831e=path[_0x3b56a0(0xe7)](_0x4a4c7b[_0x3b56a0(0x143)],_0x4a4c7b[_0x3b56a0(0x11c)][_0x3b56a0(0x114)](path[_0x3b56a0(0xe9)](_0x4a4c7b['filename']),_0x3b56a0(0x13b))),_0x4d9391=path[_0x3b56a0(0xe7)](_0x4a4c7b[_0x3b56a0(0x143)],_0x4a4c7b[_0x3b56a0(0x11c)]['replace'](path[_0x3b56a0(0xe9)](_0x4a4c7b[_0x3b56a0(0x11c)]),_0x3b56a0(0x144))),_0x1f62e2=path[_0x3b56a0(0xe7)](_0x4a4c7b[_0x3b56a0(0x143)],_0x4a4c7b[_0x3b56a0(0x11c)]['replace'](path[_0x3b56a0(0xe9)](_0x4a4c7b[_0x3b56a0(0x11c)]),_0x3b56a0(0xdb)));fs[_0x3b56a0(0x12b)](_0xc7831e)&&(console[_0x3b56a0(0xc8)](_0x3b56a0(0xfb),_0xc7831e),_0x30579d(null,_0xc7831e)),fs[_0x3b56a0(0x12b)](_0x4d9391)&&(console[_0x3b56a0(0xc8)](_0x3b56a0(0x11e),_0x4d9391),_0x30579d(null,_0x4d9391)),fs[_0x3b56a0(0x12b)](_0x1f62e2)&&(console['log'](_0x3b56a0(0xf9),_0x1f62e2),_0x30579d(null,_0x1f62e2));}}else _0xd8cd73+=0x1;}}return _0x1f0da4[_0x3b56a0(0x13d)]({'code':0x0,'deletedIds':_0x51083b,'deleteCount':_0x5a02cb,'errCount':_0xd8cd73});}else return _0x52813c[_0x3b56a0(0xf5)][_0x3b56a0(0x101)](_0x1f0da4,_0x3b56a0(0xbe));});function genTinyForFilePath(_0x4964f2,_0x2bf9f0,_0xbb74f2,_0x5a74ba){const _0x2db657=_0x877192;let _0x22b0a8=path[_0x2db657(0xe9)](_0x2bf9f0)?path[_0x2db657(0xe9)](_0x2bf9f0)[_0x2db657(0x12c)]():null,_0x47f82d=![];if(config['imgTypeList'][_0x2db657(0xdc)](_0x22b0a8)||config[_0x2db657(0x104)][_0x2db657(0xdc)](_0x22b0a8[_0x2db657(0x12c)]()))_0x47f82d=_0x2db657(0x127);else{if(config[_0x2db657(0x12f)]['includes'](_0x22b0a8))_0x47f82d=_0x2db657(0x123);else return _0x4964f2['status'](0x194)[_0x2db657(0x13a)]();}sharpUtil[_0x2db657(0xf1)](_0x2bf9f0,path[_0x2db657(0x122)](_0xbb74f2),path[_0x2db657(0xe1)](_0xbb74f2),_0x47f82d,null,_0x188692=>{const _0x4bd4d0=_0x2db657;_0x4964f2[_0x4bd4d0(0x116)](_0x188692);},_0x495b77=>{const _0x5262ee=_0x2db657;return _0x4964f2[_0x5262ee(0xed)](0x194)['end']();},_0x5a74ba);}function genTiny(_0x36e858,_0x202c80,_0xdcf28d,_0x35c8ad,_0x28444a,_0x4ab9ea){const _0x594c49=_0x877192;let _0x22cdcc='image';_0x35c8ad[_0x594c49(0xf3)]==0x2&&(_0x22cdcc=_0x594c49(0x123)),sharpUtil[_0x594c49(0xf1)](_0xdcf28d,path[_0x594c49(0x122)](_0x4ab9ea),path[_0x594c49(0xe1)](_0x4ab9ea),_0x22cdcc,_0x35c8ad,_0x210806=>{const _0x5c86d9=_0x594c49;dbFileIndexTable[_0x5c86d9(0x110)](_0x202c80,_0x35c8ad['id'],'tiny_path',_0x210806,_0x28444a),_0x36e858[_0x5c86d9(0x116)](_0x210806);},_0x1d0f00=>{const _0xde293e=_0x594c49;return _0x36e858[_0xde293e(0xed)](0x194)[_0xde293e(0x13a)]();});}router[_0x877192(0x11a)](_0x877192(0xe6),(_0x4e894f,_0x2b247f,_0x5ae5d7)=>{const _0x3cf40f=_0x877192;let _0x43589f=_0x4e894f[_0x3cf40f(0xf7)][_0x3cf40f(0xe4)];_0x43589f=fileUtil[_0x3cf40f(0xe5)](_0x43589f);let _0x22c2df=_0x4e894f[_0x3cf40f(0xf7)][_0x3cf40f(0xe0)]==0x1,_0x34a930=_0x4e894f[_0x3cf40f(0xf7)][_0x3cf40f(0xfc)],_0x406e3e=_0x4e894f['query'][_0x3cf40f(0x119)];fs[_0x3cf40f(0xe8)](_0x43589f,(_0x1e9c21,_0x401d00)=>{const _0x9d8cbe=_0x3cf40f;if(_0x1e9c21)return _0x2b247f[_0x9d8cbe(0xcf)](0x194);if(dbUserTable[_0x9d8cbe(0x137)](_0x4e894f,_0x2b247f,'',_0x9d8cbe(0x115),_0x43589f)==!![])try{let _0x791084=_0x4e894f[_0x9d8cbe(0xf7)][_0x9d8cbe(0xc4)];if(_0x791084&&_0x791084==0x1){if(_0x22c2df){const _0x2f3f98=encodeURIComponent(path[_0x9d8cbe(0xe1)](_0x43589f))[_0x9d8cbe(0x114)](/%([0-9A-F]{2})/g,(_0x35b2a2,_0x135281)=>'%'+_0x135281[_0x9d8cbe(0xc6)]());_0x2b247f[_0x9d8cbe(0xd0)](_0x9d8cbe(0x121),_0x9d8cbe(0xcc)+_0x2f3f98);}return _0x2b247f[_0x9d8cbe(0x116)](_0x43589f);}sharpUtil[_0x9d8cbe(0x13e)](_0x2b247f,_0x43589f,_0x22c2df,_0x34a930,_0x406e3e);}catch(_0x4addb1){return _0x2b247f['status'](0x194)[_0x9d8cbe(0x13a)]();}});}),router[_0x877192(0x11a)](_0x877192(0xc1),(_0x390e88,_0x46c1be,_0x94d134)=>{const _0x4135c1=_0x877192;let _0x4a62ff=_0x390e88[_0x4135c1(0xf7)][_0x4135c1(0xe4)];_0x4a62ff=fileUtil[_0x4135c1(0xe5)](_0x4a62ff);let _0x2368d8=_0x390e88['query'][_0x4135c1(0xfc)];fs[_0x4135c1(0xe8)](_0x4a62ff,(_0x51a6b6,_0x3f9bd7)=>{const _0x1b44a5=_0x4135c1;if(_0x51a6b6)return _0x46c1be[_0x1b44a5(0xcf)](0x194);config[_0x1b44a5(0x100)](_0x2368d8,_0x4a62ff,_0x2055e1=>{const _0x35fee5=_0x1b44a5;if(!_0x2055e1)return _0x46c1be['sendStatus'](0x194);let _0x40d63c=path[_0x35fee5(0xe7)](config[_0x35fee5(0x106)],_0x2055e1);dbUserTable[_0x35fee5(0x137)](_0x390e88,_0x46c1be,'',_0x35fee5(0x115),_0x4a62ff,!![])==!![]&&fs['stat'](_0x40d63c,(_0x26596e,_0x4a3c46)=>{if(_0x26596e)return genTinyForFilePath(_0x46c1be,_0x4a62ff,_0x40d63c,_0x2368d8);return _0x4a3c46['isFile']()?_0x46c1be['sendFile'](_0x40d63c):genTinyForFilePath(_0x46c1be,_0x4a62ff,_0x40d63c,_0x2368d8);});});});}),router['get'](_0x877192(0x10e),(_0x487a71,_0x34a7a6,_0x33afe6)=>{const _0x5088ef=_0x877192;let _0x13c555=_0x487a71[_0x5088ef(0xf7)]['indexId'],_0x49f537=_0x487a71[_0x5088ef(0xf7)][_0x5088ef(0x108)],_0x6edf6c=getIndexTableName(_0x49f537),_0x192c2e=getIndexObj(_0x487a71,_0x13c555);if(!_0x192c2e)return _0x34a7a6[_0x5088ef(0xed)](0x194)[_0x5088ef(0x13a)]();let _0x137b79=config[_0x5088ef(0xda)](_0x192c2e),_0x185dc7=path[_0x5088ef(0xe7)](config[_0x5088ef(0x106)],_0x137b79);if(dbUserTable[_0x5088ef(0x137)](_0x487a71,_0x34a7a6,_0x49f537,_0x5088ef(0x115),_0x192c2e[_0x5088ef(0x143)])==!![]){let _0x94034e=path[_0x5088ef(0xe7)](_0x192c2e[_0x5088ef(0x143)],path[_0x5088ef(0x138)],_0x192c2e[_0x5088ef(0x11c)]);fs['stat'](_0x94034e,(_0x4c0064,_0x203240)=>{const _0x4c0e63=_0x5088ef;if(_0x4c0064)return!_0x192c2e['tiny_path']?_0x34a7a6[_0x4c0e63(0xed)](0x194)[_0x4c0e63(0x13a)]():fs[_0x4c0e63(0xe8)](_0x192c2e[_0x4c0e63(0xd6)],(_0x2a9bcd,_0x509b04)=>{const _0x23f190=_0x4c0e63;return _0x2a9bcd||_0x509b04&&!_0x509b04['isFile']()?_0x34a7a6[_0x23f190(0xed)](0x194)[_0x23f190(0x13a)]():_0x34a7a6['sendFile'](_0x192c2e[_0x23f190(0xd6)]);});if(!_0x203240[_0x4c0e63(0xef)]())return _0x34a7a6['status'](0x194)[_0x4c0e63(0x13a)]();if(!_0x192c2e[_0x4c0e63(0xd6)]){if(_0x192c2e[_0x4c0e63(0x11b)]==_0x4c0e63(0x13c)&&_0x192c2e['size']>config[_0x4c0e63(0xea)])return console[_0x4c0e63(0xc8)](_0x4c0e63(0x10f),_0x192c2e['filename']),_0x34a7a6['status'](0x194)[_0x4c0e63(0x13a)]();fs[_0x4c0e63(0xe8)](_0x185dc7,(_0x5a631c,_0x61ea1a)=>{const _0x4eeeb6=_0x4c0e63;if(_0x5a631c)return genTiny(_0x34a7a6,_0x487a71[_0x4eeeb6(0xf5)]['dbFileIndex'],_0x94034e,_0x192c2e,_0x6edf6c,_0x185dc7);return _0x61ea1a[_0x4eeeb6(0xef)]()&&_0x61ea1a['size']>0x7d0?(dbFileIndexTable['updateById'](_0x487a71['app'][_0x4eeeb6(0xc5)],_0x192c2e['id'],_0x4eeeb6(0xd6),_0x185dc7,_0x6edf6c),_0x34a7a6[_0x4eeeb6(0x116)](_0x185dc7)):genTiny(_0x34a7a6,_0x487a71[_0x4eeeb6(0xf5)][_0x4eeeb6(0xc5)],_0x94034e,_0x192c2e,_0x6edf6c,_0x185dc7);});}else fs['stat'](_0x192c2e[_0x4c0e63(0xd6)],(_0x2651cb,_0x109116)=>{const _0x4d0e68=_0x4c0e63;return _0x2651cb||!_0x109116['isFile']()?genTiny(_0x34a7a6,_0x487a71[_0x4d0e68(0xf5)][_0x4d0e68(0xc5)],_0x94034e,_0x192c2e,_0x6edf6c,_0x185dc7):_0x34a7a6['sendFile'](_0x192c2e[_0x4d0e68(0xd6)]);});});}}),router[_0x877192(0x11a)](_0x877192(0x12a),(_0x509b49,_0x185f03,_0x364833)=>{const _0x577ca8=_0x877192;let _0x5a666b=_0x509b49[_0x577ca8(0xf7)][_0x577ca8(0x103)],_0x3fe8cd=_0x509b49[_0x577ca8(0xf7)][_0x577ca8(0x108)],_0x34a7d0=getIndexObj(_0x509b49,_0x5a666b),_0x4ab1c9=getIndexTableName(_0x3fe8cd),_0x5a18f1=_0x509b49[_0x577ca8(0xf7)]['download']==0x1,_0x354f24=_0x509b49[_0x577ca8(0xf7)][_0x577ca8(0xfc)],_0x36d04e=_0x509b49['query'][_0x577ca8(0x119)];if(!_0x34a7d0)return _0x185f03[_0x577ca8(0xed)](0x194)[_0x577ca8(0x13a)]();if(dbUserTable[_0x577ca8(0x137)](_0x509b49,_0x185f03,_0x3fe8cd,_0x577ca8(0x115),_0x34a7d0['path'])==!![]){_0x3fe8cd==_0x577ca8(0x142)&&(dbMusicIndexTable['increasePlayCount'](_0x509b49[_0x577ca8(0xf5)][_0x577ca8(0xc5)],_0x5a666b),dbMusicIndexTable[_0x577ca8(0xce)](_0x509b49[_0x577ca8(0xf5)][_0x577ca8(0xc5)],_0x5a666b));dbFileIndexTable[_0x577ca8(0x110)](_0x509b49['app'][_0x577ca8(0xc5)],_0x5a666b,'check_time',new Date()[_0x577ca8(0xee)](),_0x4ab1c9);let _0x32e153=_0x34a7d0[_0x577ca8(0x143)]+path[_0x577ca8(0x138)]+_0x34a7d0[_0x577ca8(0x11c)];fs['stat'](_0x32e153,(_0xb29521,_0x4069f2)=>{const _0x2e9da1=_0x577ca8;if(_0xb29521||!_0x4069f2['isFile']())return _0x185f03[_0x2e9da1(0xed)](0x194)[_0x2e9da1(0x13a)]();let _0x27a466=_0x509b49[_0x2e9da1(0xf7)][_0x2e9da1(0xc4)];if(_0x27a466&&_0x27a466==0x1){if(_0x5a18f1){const _0x326ce3=encodeURIComponent(path['basename'](_0x32e153))[_0x2e9da1(0x114)](/%([0-9A-F]{2})/g,(_0x1463bd,_0x30f8fb)=>'%'+_0x30f8fb[_0x2e9da1(0xc6)]());_0x185f03[_0x2e9da1(0xd0)](_0x2e9da1(0x121),_0x2e9da1(0xcc)+_0x326ce3);}return _0x185f03['sendFile'](_0x32e153);}if(_0x509b49[_0x2e9da1(0xf7)][_0x2e9da1(0xd9)]==0x1){_0x185f03['set']('Content-Type',_0x2e9da1(0x12d));const _0x5bbf99=_0x509b49['headers'][_0x2e9da1(0x102)];if('bytes=0-1'==_0x5bbf99)return _0x185f03[_0x2e9da1(0x116)](_0x32e153);return musicTransCodeUtil['transToMp3'](_0x185f03,_0x32e153);}else _0x509b49[_0x2e9da1(0xf7)][_0x2e9da1(0xd8)]&&_0x509b49['query'][_0x2e9da1(0xd8)]==_0x2e9da1(0xbd)&&path[_0x2e9da1(0xe9)](_0x32e153)&&path[_0x2e9da1(0xe9)](_0x32e153)[_0x2e9da1(0x12c)]()==_0x2e9da1(0x126)?(console['log'](_0x2e9da1(0xe2),_0x32e153),encodingUtil[_0x2e9da1(0xbf)](_0x32e153)[_0x2e9da1(0x133)](_0x23abf8=>{const _0x40bb7d=_0x2e9da1;return _0x23abf8?_0x23abf8[_0x40bb7d(0x125)](_0x185f03):(console[_0x40bb7d(0xc8)]('Unable\x20to\x20read\x20file',_0x32e153),_0x185f03[_0x40bb7d(0x116)](_0x32e153));})):sharpUtil[_0x2e9da1(0x13e)](_0x185f03,_0x32e153,_0x5a18f1,_0x354f24,_0x36d04e);});}}),router[_0x877192(0x11d)](_0x877192(0xd4),(_0x4f5ac2,_0x58a233,_0x3aa891)=>{const _0x2b0fe7=_0x877192;let _0x3fa89b=_0x4f5ac2[_0x2b0fe7(0xd5)]['indexId'],_0x60ca42=getIndexObj(_0x4f5ac2,_0x3fa89b);if(!_0x60ca42)return _0x58a233['status'](0x194)[_0x2b0fe7(0x13a)]();if(dbUserTable[_0x2b0fe7(0x137)](_0x4f5ac2,_0x58a233,'',_0x2b0fe7(0x115),_0x60ca42[_0x2b0fe7(0x143)])==!![]){let _0x2ba245=_0x60ca42['path']+path[_0x2b0fe7(0x138)]+_0x60ca42[_0x2b0fe7(0x11c)];exifUtil['parse'](_0x2ba245)[_0x2b0fe7(0x133)](_0x1b3500=>{const _0x2431e6=_0x2b0fe7;_0x60ca42[_0x2431e6(0xcb)]=_0x1b3500,_0x58a233[_0x2431e6(0x13d)]({'code':0x0,'data':_0x60ca42});})['catch'](_0x4524c1=>{const _0x25b9f7=_0x2b0fe7;_0x60ca42[_0x25b9f7(0xcb)]=![],_0x58a233[_0x25b9f7(0x13d)]({'code':0x0,'data':_0x60ca42});});}}),router[_0x877192(0x11d)](_0x877192(0x136),(_0x145c1f,_0x26a0bc,_0x326351)=>{const _0xc17335=_0x877192;let _0xe5744b=_0x145c1f[_0xc17335(0xd5)]['indexId'],_0xde2c66=getIndexObj(_0x145c1f,_0xe5744b),_0x1c941d=getIndexTableName(_0x145c1f['query'][_0xc17335(0x108)]);if(!_0xde2c66)return _0x26a0bc['json']({'code':0x2,'message':_0xc17335(0x145)});try{fs['rm'](_0xde2c66[_0xc17335(0xd6)],_0x8da73=>{const _0x11c38b=_0xc17335;return _0x8da73?fileUtil[_0x11c38b(0xc7)](_0x26a0bc,_0x8da73):(dbFileIndexTable[_0x11c38b(0x110)](_0x145c1f[_0x11c38b(0xf5)][_0x11c38b(0xc5)],_0xe5744b,_0x11c38b(0xd6),'',_0x1c941d),_0x26a0bc[_0x11c38b(0x13d)]({'code':0x0}));});}catch(_0x5cf574){return _0x26a0bc[_0xc17335(0x13d)]({'code':0x2,'message':'operation\x20fail'});}}),module[_0x877192(0xd3)]=router;