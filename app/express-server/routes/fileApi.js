const _0x5f575b=_0x48c2;(function(_0x2a0d1d,_0x4238ab){const _0x46f8b7=_0x48c2,_0x4c2355=_0x2a0d1d();while(!![]){try{const _0x4bc06a=parseInt(_0x46f8b7(0x1a7))/0x1*(-parseInt(_0x46f8b7(0x1a6))/0x2)+-parseInt(_0x46f8b7(0x1e9))/0x3+-parseInt(_0x46f8b7(0x1cc))/0x4+-parseInt(_0x46f8b7(0x20c))/0x5+-parseInt(_0x46f8b7(0x1e0))/0x6+-parseInt(_0x46f8b7(0x19d))/0x7+parseInt(_0x46f8b7(0x1db))/0x8*(parseInt(_0x46f8b7(0x1ad))/0x9);if(_0x4bc06a===_0x4238ab)break;else _0x4c2355['push'](_0x4c2355['shift']());}catch(_0x1fd921){_0x4c2355['push'](_0x4c2355['shift']());}}}(_0x2753,0x3ddaf));let express=require('express'),router=express[_0x5f575b(0x1b6)](),path=require(_0x5f575b(0x1d3)),fs=require('fs');const sharp=require('sharp');let sharpUtil=require('../utils/sharpUtils'),exifUtil=require('exifr'),fileUtil=require(_0x5f575b(0x1fd));function _0x48c2(_0x14fcab,_0x4ed29c){const _0x2753d4=_0x2753();return _0x48c2=function(_0x48c270,_0x17a336){_0x48c270=_0x48c270-0x191;let _0x410a44=_0x2753d4[_0x48c270];return _0x410a44;},_0x48c2(_0x14fcab,_0x4ed29c);}const config=require(_0x5f575b(0x200)),dbFileIndexTable=require(_0x5f575b(0x1da)),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),dbUserTable=require(_0x5f575b(0x1ea)),dbMusicIndexTable=require(_0x5f575b(0x1be));let musicTransCodeUtil=require(_0x5f575b(0x1f3));function _0x2753(){const _0x3ab86f=['291752eIIaAv','dbFileIndex','serverType','file\x20not\x20found','log','388416cJqsmm','run','dirname','exifInfo','type','catch','indexId','end','audio/mpeg','1338360ddbWFh','../../db/dbUserTable','stat','currentUser','exports','Unable\x20to\x20read\x20file','cachePath','sendStatus','then','ids','../../utils/musicTransCodeUtil','power_delete','STATE_FAIL','filename','sendFile','dbOther','sep','power_get','getTime','/tinyImg*','../utils/fileUtils','/rawFile*','getFileHashName','../../myConfig/config','.MP4','raw_filename','quality','setHeader','code','username','/tinyImgByPath*','json','genTinyFile','TYPE_DELETE','bytes=0-1','980445MHtEQa','get','Content-Type','extname','trash','Content-Disposition','prepare','Convert\x20to\x20utf8\x20','.txt','params\x20is\x20not\x20valid','range','replace','image','.MOV','221613xSmHnf','endsWith','send','basename','updatePlayTime','ignoreLivephoto','tiny_path','.psd','attachment;\x20filename*=UTF-8\x27\x27','606IZDTCd','50ABKWjS','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','/getInfo','post','doUserCanGet','putInSystemTrash','369vaeeuu','pipe','operation\x20fail','returnErrMsg','body','../../utils/encodingUtil','STATE_SUC','addFileOperationRecord','videoTypeList','Router','deletePathAll','is_file','returnDealedFile','fullPath','toUpperCase','returnFileError','status','../../db/dbMusicIndexTable','includes','/inOutTrash','toLowerCase','set','getUtf8FileStream','download','delete','raw','check_time','query','isFile','video','changes','1952464aAdIFo','size','headers','deleteIndexFolder','transToMp3','join','rawImgTypeList','path','decodePath','length','increasePlayCount','updateById','/deleteFromDisk','app','../../db/dbFileIndexTable'];_0x2753=function(){return _0x3ab86f;};return _0x2753();}const encodingUtil=require(_0x5f575b(0x1b2));function getIndexTableName(_0x12c9a2){let _0xd4938e=dbFileIndexTable['getIndexTableNameByType'](_0x12c9a2);return _0xd4938e;}function getIndexObj(_0x3b9c74,_0x42271f){const _0x30ccb1=_0x5f575b;let _0x3caf15=_0x3b9c74[_0x30ccb1(0x1b1)][_0x30ccb1(0x1dd)]||_0x3b9c74[_0x30ccb1(0x1c8)][_0x30ccb1(0x1dd)],_0xcdf827=getIndexTableName(_0x3caf15);return dbFileIndexTable['getById'](_0x3b9c74[_0x30ccb1(0x1d9)]['dbFileIndex'],_0x42271f,_0xcdf827);}router[_0x5f575b(0x1aa)](_0x5f575b(0x1c0),(_0x2ac4cc,_0x3480e6,_0x52eb17)=>{const _0x10ec1c=_0x5f575b;let _0x2e844e=_0x2ac4cc[_0x10ec1c(0x1b1)][_0x10ec1c(0x1f2)],_0x47d6cb=_0x2ac4cc[_0x10ec1c(0x1b1)]['trash'];if(dbUserTable[_0x10ec1c(0x1ab)](_0x2ac4cc,_0x3480e6,'photo','power_delete')==!![]){if(_0x2e844e&&_0x2e844e[_0x10ec1c(0x1d5)]>0x0){let _0xb0d474='(';for(let _0x51e559=0x0;_0x51e559<_0x2e844e[_0x10ec1c(0x1d5)];_0x51e559++){let _0x2ff042=getIndexObj(_0x2ac4cc,_0x2e844e[_0x51e559]);if(!_0x2ff042)continue;_0x2ff042['raw_filename']!=null&&_0x2ff042[_0x10ec1c(0x202)]!=''&&_0x2ff042[_0x10ec1c(0x1b8)]&&(_0x47d6cb==0x1?_0x2ac4cc[_0x10ec1c(0x1d9)][_0x10ec1c(0x1dc)][_0x10ec1c(0x195)]('UPDATE\x20file_index_photo\x20SET\x20is_show=1\x20WHERE\x20path=?\x20AND\x20filename\x20=?')[_0x10ec1c(0x1e1)](_0x2ff042['path'],_0x2ff042[_0x10ec1c(0x202)]):_0x2ac4cc[_0x10ec1c(0x1d9)][_0x10ec1c(0x1dc)][_0x10ec1c(0x195)](_0x10ec1c(0x1a8))[_0x10ec1c(0x1e1)](_0x2ff042[_0x10ec1c(0x1d3)],_0x2ff042['raw_filename'])),_0xb0d474+=_0x2e844e[_0x51e559],_0x51e559!=_0x2e844e[_0x10ec1c(0x1d5)]-0x1&&(_0xb0d474+=',');}_0xb0d474+=')';let _0x89c6ff=dbFileIndexTable['inOutTrash'](_0x2ac4cc[_0x10ec1c(0x1d9)]['dbFileIndex'],_0xb0d474,_0x47d6cb,getIndexTableName(_0x2ac4cc[_0x10ec1c(0x1b1)][_0x10ec1c(0x1dd)]));_0x89c6ff['changes']>0x0&&_0x3480e6[_0x10ec1c(0x208)]({'code':0x0,'count':_0x89c6ff[_0x10ec1c(0x1cb)]});}else{_0x3480e6[_0x10ec1c(0x208)]({'code':0x1,'message':_0x10ec1c(0x198)});return;}}}),router['post'](_0x5f575b(0x1d8),(_0x2a8752,_0x1cd1ef,_0x242a2c)=>{const _0x4f512d=_0x5f575b;let _0x5bf221=_0x2a8752['body'][_0x4f512d(0x1f2)],_0xfe2157=_0x2a8752[_0x4f512d(0x1b1)][_0x4f512d(0x1dd)],_0x381609=_0x2a8752['body'][_0x4f512d(0x1cf)]==0x1,_0x1aab53=_0x2a8752[_0x4f512d(0x1b1)][_0x4f512d(0x1a2)]==0x1,_0xa48e8d=_0x2a8752['body'][_0x4f512d(0x1ac)],_0xad868e=getIndexTableName(_0xfe2157);function _0x493247(_0x278c39,_0x32b8e6){const _0xdc0de4=_0x4f512d;dbFileOperationRecord[_0xdc0de4(0x1b4)](_0x2a8752['app'][_0xdc0de4(0x1f8)],{'username':_0x2a8752[_0xdc0de4(0x1ec)][_0xdc0de4(0x206)],'targetPath':_0x278c39,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0xdc0de4(0x20a)],'state':_0x32b8e6?dbFileOperationRecord[_0xdc0de4(0x1b3)]:dbFileOperationRecord[_0xdc0de4(0x1f5)]});}function _0x30371b(_0x4af76b){const _0x22c09d=_0x4f512d;if(_0x4af76b['is_file']==0x1&&_0x4af76b['is_livephoto']==0x1){let _0x48ca79=path[_0x22c09d(0x1d1)](_0x4af76b[_0x22c09d(0x1d3)],_0x4af76b[_0x22c09d(0x1f6)][_0x22c09d(0x19a)](_0x22c09d(0x19c),'')+'.HEIC');_0x4af76b[_0x22c09d(0x1f6)][_0x22c09d(0x19e)]('.MP4')&&(_0x48ca79=path[_0x22c09d(0x1d1)](_0x4af76b[_0x22c09d(0x1d3)],_0x4af76b['filename'][_0x22c09d(0x19a)](_0x22c09d(0x201),'')+'.JPG')),fs['existsSync'](_0x48ca79)&&_0x255fb2(_0x4af76b,_0x48ca79,![]);}}function _0x255fb2(_0x4c83ae,_0x43191d,_0x5bf1b6){const _0x3fa2bf=_0x4f512d;_0xa48e8d==0x1?(process[_0x3fa2bf(0x19f)]({'type':'shell','shellType':_0x3fa2bf(0x193),'path':_0x43191d}),_0x493247(_0x43191d,!![])):fs['rm'](_0x43191d,{'recursive':!![]},_0x548972=>{_0x548972?_0x493247(_0x43191d,![]):_0x493247(_0x43191d,!![]);}),_0x5bf1b6&&_0x30371b(_0x4c83ae);}function _0x5c00c5(_0x17959f){const _0x37ad66=_0x4f512d;dbFileIndexTable[_0x37ad66(0x1c5)](_0x2a8752['app'][_0x37ad66(0x1dc)],_0x17959f,_0xad868e);}function _0x186f72(_0x4af30a,_0xdadcf1){const _0x753bf9=_0x4f512d;if(!_0xdadcf1)return;dbFileIndexTable[_0x753bf9(0x1c5)](_0x2a8752[_0x753bf9(0x1d9)][_0x753bf9(0x1dc)],_0x4af30a,_0xad868e),dbFileIndexTable[_0x753bf9(0x1b7)](_0x2a8752['app'][_0x753bf9(0x1dc)],_0xdadcf1,_0xad868e);}if(_0x5bf221&&_0x5bf221['length']>0x0){let _0x30e9c6=0x0,_0x4a4de0=0x0,_0x51da05=[];for(let _0x40673c=0x0;_0x40673c<_0x5bf221['length'];_0x40673c++){let _0x515575=_0x5bf221[_0x40673c],_0x1d6490=getIndexObj(_0x2a8752,_0x515575,_0xad868e);if(_0x1d6490){if(dbUserTable[_0x4f512d(0x1ab)](_0x2a8752,_0x1cd1ef,_0xfe2157,_0x4f512d(0x1f4),_0x1d6490[_0x4f512d(0x1d3)])==!![]){_0x30e9c6+=0x1,_0x51da05['push'](_0x515575);let _0x5f55f9=path[_0x4f512d(0x1d1)](_0x1d6490[_0x4f512d(0x1d3)],path[_0x4f512d(0x1f9)],_0x1d6490[_0x4f512d(0x1f6)]),_0x383397=_0x1d6490[_0x4f512d(0x1b8)]==0x0;_0x381609&&(_0x5f55f9=_0x1d6490[_0x4f512d(0x1d3)],_0x383397=!![]),_0x383397?_0x186f72(_0x515575,_0x5f55f9):_0x5c00c5(_0x515575),_0x255fb2(_0x1d6490,_0x5f55f9,!_0x1aab53);}else _0x4a4de0+=0x1;}}return _0x1cd1ef['json']({'code':0x0,'deletedIds':_0x51da05,'deleteCount':_0x30e9c6,'errCount':_0x4a4de0});}else return _0x2a8752[_0x4f512d(0x1d9)][_0x4f512d(0x1b0)](_0x1cd1ef,_0x4f512d(0x198));});function genTinyForFilePath(_0x480aae,_0xd86e04,_0x48ed65,_0x315cac){const _0x48a759=_0x5f575b;let _0x107229=path[_0x48a759(0x192)](_0xd86e04)?path[_0x48a759(0x192)](_0xd86e04)[_0x48a759(0x1c1)]():null,_0x4d9a8f=![];if(config['imgTypeList'][_0x48a759(0x1bf)](_0x107229)||config[_0x48a759(0x1d2)]['includes'](_0x107229['toLowerCase']()))_0x4d9a8f=_0x48a759(0x19b);else{if(config[_0x48a759(0x1b5)][_0x48a759(0x1bf)](_0x107229))_0x4d9a8f=_0x48a759(0x1ca);else return _0x480aae[_0x48a759(0x1bd)](0x194)[_0x48a759(0x1e7)]();}sharpUtil[_0x48a759(0x209)](_0xd86e04,path[_0x48a759(0x1e2)](_0x48ed65),path[_0x48a759(0x1a0)](_0x48ed65),_0x4d9a8f,null,_0x4db417=>{const _0x2fc6cf=_0x48a759;_0x480aae[_0x2fc6cf(0x1f7)](_0x4db417);},_0x2353dd=>{const _0x27d325=_0x48a759;return _0x480aae[_0x27d325(0x1bd)](0x194)['end']();},_0x315cac);}function genTiny(_0xa3692d,_0x437d0a,_0x41f751,_0x3e989d,_0x2f3e7c,_0x1734fc){const _0x4b410a=_0x5f575b;let _0xff8693=_0x4b410a(0x19b);_0x3e989d[_0x4b410a(0x1e4)]==0x2&&(_0xff8693=_0x4b410a(0x1ca)),sharpUtil[_0x4b410a(0x209)](_0x41f751,path[_0x4b410a(0x1e2)](_0x1734fc),path['basename'](_0x1734fc),_0xff8693,_0x3e989d,_0x403ce5=>{const _0x4aa751=_0x4b410a;dbFileIndexTable[_0x4aa751(0x1d7)](_0x437d0a,_0x3e989d['id'],_0x4aa751(0x1a3),_0x403ce5,_0x2f3e7c),_0xa3692d[_0x4aa751(0x1f7)](_0x403ce5);},_0x75c095=>{const _0x4dd25e=_0x4b410a;return _0xa3692d[_0x4dd25e(0x1bd)](0x194)[_0x4dd25e(0x1e7)]();});}router[_0x5f575b(0x20d)]('/rawFileByPath*',(_0x3cb08e,_0x494f3e,_0x5d9597)=>{const _0x4cfb97=_0x5f575b;let _0x438a8f=_0x3cb08e[_0x4cfb97(0x1c8)][_0x4cfb97(0x1ba)];_0x438a8f=fileUtil[_0x4cfb97(0x1d4)](_0x438a8f);let _0x4e2541=_0x3cb08e[_0x4cfb97(0x1c8)][_0x4cfb97(0x1c4)]==0x1,_0x5930ed=_0x3cb08e['query'][_0x4cfb97(0x1cd)],_0x1132b5=_0x3cb08e['query'][_0x4cfb97(0x203)];fs[_0x4cfb97(0x1eb)](_0x438a8f,(_0xeabc5f,_0x2a251b)=>{const _0x34c76b=_0x4cfb97;if(_0xeabc5f)return _0x494f3e[_0x34c76b(0x1f0)](0x194);if(dbUserTable[_0x34c76b(0x1ab)](_0x3cb08e,_0x494f3e,'',_0x34c76b(0x1fa),_0x438a8f)==!![])try{let _0x279e57=_0x3cb08e[_0x34c76b(0x1c8)][_0x34c76b(0x1c6)];if(_0x279e57&&_0x279e57==0x1){if(_0x4e2541){const _0xebd937=encodeURIComponent(path[_0x34c76b(0x1a0)](_0x438a8f))[_0x34c76b(0x19a)](/%([0-9A-F]{2})/g,(_0x16f3f0,_0x1b8677)=>'%'+_0x1b8677[_0x34c76b(0x1bb)]());_0x494f3e[_0x34c76b(0x204)](_0x34c76b(0x194),_0x34c76b(0x1a5)+_0xebd937);}return _0x494f3e[_0x34c76b(0x1f7)](_0x438a8f);}sharpUtil[_0x34c76b(0x1b9)](_0x494f3e,_0x438a8f,_0x4e2541,_0x5930ed,_0x1132b5);}catch(_0x2fe028){return _0x494f3e[_0x34c76b(0x1bd)](0x194)[_0x34c76b(0x1e7)]();}});}),router[_0x5f575b(0x20d)](_0x5f575b(0x207),(_0x35b296,_0x5a2a62,_0x125eeb)=>{const _0x26fc3d=_0x5f575b;let _0xdd9f3a=_0x35b296['query'][_0x26fc3d(0x1ba)];_0xdd9f3a=fileUtil[_0x26fc3d(0x1d4)](_0xdd9f3a);let _0x4c4942=_0x35b296[_0x26fc3d(0x1c8)]['size'];fs[_0x26fc3d(0x1eb)](_0xdd9f3a,(_0x540a96,_0x323288)=>{if(_0x540a96)return _0x5a2a62['sendStatus'](0x194);config['getFileHashNameByPathAndStat'](_0x4c4942,_0xdd9f3a,_0x168639=>{const _0x135105=_0x48c2;if(!_0x168639)return _0x5a2a62[_0x135105(0x1f0)](0x194);let _0x1c8ca4=path[_0x135105(0x1d1)](config[_0x135105(0x1ef)],_0x168639);dbUserTable[_0x135105(0x1ab)](_0x35b296,_0x5a2a62,'',_0x135105(0x1fa),_0xdd9f3a,!![])==!![]&&fs[_0x135105(0x1eb)](_0x1c8ca4,(_0x56d4a9,_0x1ab0b3)=>{const _0x279e40=_0x135105;if(_0x56d4a9)return genTinyForFilePath(_0x5a2a62,_0xdd9f3a,_0x1c8ca4,_0x4c4942);return _0x1ab0b3[_0x279e40(0x1c9)]()?_0x5a2a62[_0x279e40(0x1f7)](_0x1c8ca4):genTinyForFilePath(_0x5a2a62,_0xdd9f3a,_0x1c8ca4,_0x4c4942);});});});}),router[_0x5f575b(0x20d)](_0x5f575b(0x1fc),(_0x283844,_0x5ae658,_0x5f3b0a)=>{const _0x20e8f2=_0x5f575b;let _0x29d6d1=_0x283844['query']['indexId'],_0x25d491=_0x283844['query'][_0x20e8f2(0x1dd)],_0xd341f0=getIndexTableName(_0x25d491),_0x5b8ddf=getIndexObj(_0x283844,_0x29d6d1);if(!_0x5b8ddf)return _0x5ae658[_0x20e8f2(0x1bd)](0x194)['end']();let _0x812574=config[_0x20e8f2(0x1ff)](_0x5b8ddf),_0x2fcff3=path[_0x20e8f2(0x1d1)](config[_0x20e8f2(0x1ef)],_0x812574);if(dbUserTable[_0x20e8f2(0x1ab)](_0x283844,_0x5ae658,_0x25d491,_0x20e8f2(0x1fa),_0x5b8ddf[_0x20e8f2(0x1d3)])==!![]){let _0x42edd=path[_0x20e8f2(0x1d1)](_0x5b8ddf[_0x20e8f2(0x1d3)],path['sep'],_0x5b8ddf[_0x20e8f2(0x1f6)]);fs[_0x20e8f2(0x1eb)](_0x42edd,(_0x5572a0,_0x3fa901)=>{const _0xc6f1e=_0x20e8f2;if(_0x5572a0)return!_0x5b8ddf[_0xc6f1e(0x1a3)]?_0x5ae658[_0xc6f1e(0x1bd)](0x194)['end']():fs[_0xc6f1e(0x1eb)](_0x5b8ddf[_0xc6f1e(0x1a3)],(_0xb07e1b,_0x1a6e67)=>{const _0x48f91e=_0xc6f1e;return _0xb07e1b||_0x1a6e67&&!_0x1a6e67[_0x48f91e(0x1c9)]()?_0x5ae658[_0x48f91e(0x1bd)](0x194)[_0x48f91e(0x1e7)]():_0x5ae658[_0x48f91e(0x1f7)](_0x5b8ddf['tiny_path']);});if(!_0x3fa901[_0xc6f1e(0x1c9)]())return _0x5ae658[_0xc6f1e(0x1bd)](0x194)[_0xc6f1e(0x1e7)]();if(!_0x5b8ddf[_0xc6f1e(0x1a3)]){if(_0x5b8ddf['ext']==_0xc6f1e(0x1a4)&&_0x5b8ddf[_0xc6f1e(0x1cd)]>config['maxPsdSize'])return console[_0xc6f1e(0x1df)]('PSD文件过大，不生成缩略图',_0x5b8ddf[_0xc6f1e(0x1f6)]),_0x5ae658['status'](0x194)[_0xc6f1e(0x1e7)]();fs[_0xc6f1e(0x1eb)](_0x2fcff3,(_0x6c3862,_0x4f112d)=>{const _0x44f620=_0xc6f1e;if(_0x6c3862)return genTiny(_0x5ae658,_0x283844['app']['dbFileIndex'],_0x42edd,_0x5b8ddf,_0xd341f0,_0x2fcff3);return _0x4f112d['isFile']()&&_0x4f112d[_0x44f620(0x1cd)]>0x7d0?(dbFileIndexTable[_0x44f620(0x1d7)](_0x283844['app'][_0x44f620(0x1dc)],_0x5b8ddf['id'],_0x44f620(0x1a3),_0x2fcff3,_0xd341f0),_0x5ae658[_0x44f620(0x1f7)](_0x2fcff3)):genTiny(_0x5ae658,_0x283844['app']['dbFileIndex'],_0x42edd,_0x5b8ddf,_0xd341f0,_0x2fcff3);});}else fs[_0xc6f1e(0x1eb)](_0x5b8ddf[_0xc6f1e(0x1a3)],(_0x3e385e,_0x433dbf)=>{const _0x4d079d=_0xc6f1e;return _0x3e385e||!_0x433dbf[_0x4d079d(0x1c9)]()?genTiny(_0x5ae658,_0x283844['app'][_0x4d079d(0x1dc)],_0x42edd,_0x5b8ddf,_0xd341f0,_0x2fcff3):_0x5ae658[_0x4d079d(0x1f7)](_0x5b8ddf['tiny_path']);});});}}),router[_0x5f575b(0x20d)](_0x5f575b(0x1fe),(_0x1ef67f,_0x3e098e,_0x3ff3d7)=>{const _0xe7dac7=_0x5f575b;let _0x482c2f=_0x1ef67f[_0xe7dac7(0x1c8)][_0xe7dac7(0x1e6)],_0x5ea278=_0x1ef67f[_0xe7dac7(0x1c8)]['serverType'],_0xfedff1=getIndexObj(_0x1ef67f,_0x482c2f),_0x1881a7=getIndexTableName(_0x5ea278),_0x2d76a6=_0x1ef67f[_0xe7dac7(0x1c8)]['download']==0x1,_0x304e43=_0x1ef67f[_0xe7dac7(0x1c8)]['size'],_0x42d24a=_0x1ef67f[_0xe7dac7(0x1c8)][_0xe7dac7(0x203)];if(!_0xfedff1)return _0x3e098e[_0xe7dac7(0x1bd)](0x194)[_0xe7dac7(0x1e7)]();if(dbUserTable['doUserCanGet'](_0x1ef67f,_0x3e098e,_0x5ea278,_0xe7dac7(0x1fa),_0xfedff1[_0xe7dac7(0x1d3)])==!![]){_0x5ea278=='music'&&(dbMusicIndexTable[_0xe7dac7(0x1d6)](_0x1ef67f['app']['dbFileIndex'],_0x482c2f),dbMusicIndexTable[_0xe7dac7(0x1a1)](_0x1ef67f['app']['dbFileIndex'],_0x482c2f));dbFileIndexTable[_0xe7dac7(0x1d7)](_0x1ef67f[_0xe7dac7(0x1d9)][_0xe7dac7(0x1dc)],_0x482c2f,_0xe7dac7(0x1c7),new Date()[_0xe7dac7(0x1fb)](),_0x1881a7);let _0x172843=_0xfedff1['path']+path[_0xe7dac7(0x1f9)]+_0xfedff1['filename'];fs[_0xe7dac7(0x1eb)](_0x172843,(_0x444cae,_0x111d5c)=>{const _0x50750d=_0xe7dac7;if(_0x444cae||!_0x111d5c[_0x50750d(0x1c9)]())return _0x3e098e[_0x50750d(0x1bd)](0x194)[_0x50750d(0x1e7)]();let _0x49f418=_0x1ef67f['query'][_0x50750d(0x1c6)];if(_0x49f418&&_0x49f418==0x1){if(_0x2d76a6){const _0x5e09ee=encodeURIComponent(path[_0x50750d(0x1a0)](_0x172843))[_0x50750d(0x19a)](/%([0-9A-F]{2})/g,(_0x237825,_0x48cba5)=>'%'+_0x48cba5['toUpperCase']());_0x3e098e['setHeader']('Content-Disposition',_0x50750d(0x1a5)+_0x5e09ee);}return _0x3e098e['sendFile'](_0x172843);}if(_0x1ef67f['query'][_0x50750d(0x1d0)]==0x1){_0x3e098e[_0x50750d(0x1c2)](_0x50750d(0x191),_0x50750d(0x1e8));const _0x3cb807=_0x1ef67f[_0x50750d(0x1ce)][_0x50750d(0x199)];if(_0x50750d(0x20b)==_0x3cb807)return _0x3e098e[_0x50750d(0x1f7)](_0x172843);return musicTransCodeUtil['transToMp3'](_0x3e098e,_0x172843);}else _0x1ef67f[_0x50750d(0x1c8)]['code']&&_0x1ef67f['query'][_0x50750d(0x205)]=='utf8'&&path['extname'](_0x172843)&&path[_0x50750d(0x192)](_0x172843)['toLowerCase']()==_0x50750d(0x197)?(console[_0x50750d(0x1df)](_0x50750d(0x196),_0x172843),encodingUtil[_0x50750d(0x1c3)](_0x172843)[_0x50750d(0x1f1)](_0x595301=>{const _0x58a283=_0x50750d;return _0x595301?_0x595301[_0x58a283(0x1ae)](_0x3e098e):(console['log'](_0x58a283(0x1ee),_0x172843),_0x3e098e[_0x58a283(0x1f7)](_0x172843));})):sharpUtil[_0x50750d(0x1b9)](_0x3e098e,_0x172843,_0x2d76a6,_0x304e43,_0x42d24a);});}}),router[_0x5f575b(0x1aa)](_0x5f575b(0x1a9),(_0x195915,_0x5f2d89,_0x267298)=>{const _0x4f80b1=_0x5f575b;let _0x4691b7=_0x195915[_0x4f80b1(0x1b1)][_0x4f80b1(0x1e6)],_0x2cf822=getIndexObj(_0x195915,_0x4691b7);if(!_0x2cf822)return _0x5f2d89[_0x4f80b1(0x1bd)](0x194)[_0x4f80b1(0x1e7)]();if(dbUserTable[_0x4f80b1(0x1ab)](_0x195915,_0x5f2d89,'','power_get',_0x2cf822[_0x4f80b1(0x1d3)])==!![]){let _0x20ac19=_0x2cf822['path']+path['sep']+_0x2cf822['filename'];exifUtil['parse'](_0x20ac19)[_0x4f80b1(0x1f1)](_0x52199b=>{const _0x1a57c9=_0x4f80b1;_0x2cf822[_0x1a57c9(0x1e3)]=_0x52199b,_0x5f2d89[_0x1a57c9(0x208)]({'code':0x0,'data':_0x2cf822});})[_0x4f80b1(0x1e5)](_0x282f04=>{const _0x4485af=_0x4f80b1;_0x2cf822[_0x4485af(0x1e3)]=![],_0x5f2d89[_0x4485af(0x208)]({'code':0x0,'data':_0x2cf822});});}}),router[_0x5f575b(0x1aa)]('/clearTinyImg',(_0x2991fc,_0x1e1aef,_0x3862f5)=>{const _0x397b88=_0x5f575b;let _0x489993=_0x2991fc[_0x397b88(0x1b1)][_0x397b88(0x1e6)],_0x146f21=getIndexObj(_0x2991fc,_0x489993),_0x54c115=getIndexTableName(_0x2991fc[_0x397b88(0x1c8)][_0x397b88(0x1dd)]);if(!_0x146f21)return _0x1e1aef[_0x397b88(0x208)]({'code':0x2,'message':_0x397b88(0x1de)});try{fs['rm'](_0x146f21[_0x397b88(0x1a3)],_0x50c1ae=>{const _0x4c729a=_0x397b88;return _0x50c1ae?fileUtil[_0x4c729a(0x1bc)](_0x1e1aef,_0x50c1ae):(dbFileIndexTable[_0x4c729a(0x1d7)](_0x2991fc[_0x4c729a(0x1d9)][_0x4c729a(0x1dc)],_0x489993,_0x4c729a(0x1a3),'',_0x54c115),_0x1e1aef[_0x4c729a(0x208)]({'code':0x0}));});}catch(_0x436aee){return _0x1e1aef[_0x397b88(0x208)]({'code':0x2,'message':_0x397b88(0x1af)});}}),module[_0x5f575b(0x1ed)]=router;