function _0x1f7a(){const _0x1c6856=['noContent','&token=','../../utils/transCodeUtil','streams','-sub_charenc\x20','videoBitrate','dealFFmpegPath','dbFileIndex','encoderName','addOption','87OTthJe','kill','format','638744aAmwBU','ts_name','DELETE\x20FROM\x20play_record\x20WHERE\x20play_id=?','&ac=','stype','need\x20play\x20id','post','prepare','.0,\x0astream','Content-disposition','subtitleIndex','encoding','outputFormat','filePath','error','/play*','access','stat','M3u8Transcode','Content-type','.vtt','parseVideoFullPath','Router','decodePath','playId','&spaceToken=','killed','53702kTLKAO','outputOptions','body','doUserCanGet','currentUser','../utils/cryptoUtils','moviePreferLanguage','run','close','stream','&spaceIndexId=','burn','length','sep','constants','stringify','sha256','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?\x20and\x20ts_type=?\x20ORDER\x20BY\x20create_time\x20DESC','findByTitle','log','REPLACE\x20INTO\x20play_record(play_id,args,uid)\x20VALUES(?,?,?)','catch','.m3u8','serverType','../../libs/nasTrans','confidence','exports',',\x0a#EXT-X-MEDIA-SEQUENCE:0\x0a#EXT-X-ALLOW-CACHE:YES\x0a#EXT-X-START:TIME-OFFSET=','字幕文件存在缓存','27hUwWYw','SELECT\x20*\x20FROM\x20play_record\x20WHERE\x20play_id=?','\x0a#EXT-X-ENDLIST\x0a','videoCodec','audioIndex','&indexId=','R_OK','videobit','sendFile','json','message','indexId','dbOther','extname','getIndexTableNameByType','cannotReadFile','1795872axiYIl','mp4','readFile','\x0a#EXTINF:','/getVideoInfoByPath','app','getTime','sendStatus','&seq=','.ts','filename','then','faidLoadSubtitle','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?\x20and\x20ts_type=?','waiting','生成字幕文件','m3u8segmentDuration','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_type=?\x20ORDER\x20BY\x20create_time\x20DESC','join','-map\x200:s:','&burn=','DELETE\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?','/subtitle*','size','m3u8','returnErrMsg','3255170CrFjsW','parseStreamList','inputOption','seekInput','getVideoMeta','getDurationFromStream','pipe','setHeader','914321OdVAVO','spaceId','-map\x200:v:0?','../../utils/videoStreamUtil','spaceIndexId','m3u8TmpPath','decoderCommand','jschardet','lastIndexOf','token','noVideo','application/octet-stream','path','gen','#EXTM3U\x0a#EXT-X-PLAYLIST-TYPE:VOD\x20\x20\x20\x20\x20\x20\x20\x20\x0a#EXT-X-VERSION:3\x0a#EXT-X-TARGETDURATION:','&videobit=','input','seek','EventEmitter','&subtitleIndex=','&spaceId=','value','duration','decryptFileGetStream','73402jnFUAF','492uibnJL','../utils/fileUtils','subtitleFile','chi','../../db/dbConfigTable','send','end','indexOf','&filePath=','index\x20no\x20permission','floor','replace','getVideoBitrate','seq','events','noAudio','spaceToken','power_get','../../db/dbPrivateSpaceTable','endsWith','.ts?playId=','startsWith','start','detect','audioCodec','query','get','aac','subtitlePath','status','77990mwDKIw','-movflags\x20frag_keyframe+empty_moov'];_0x1f7a=function(){return _0x1c6856;};return _0x1f7a();}const _0x4b9429=_0x3bfe;(function(_0x180d53,_0x16fd22){const _0x5db0f8=_0x3bfe,_0x5342ae=_0x180d53();while(!![]){try{const _0x3b2dd8=parseInt(_0x5db0f8(0x1cf))/0x1+parseInt(_0x5db0f8(0x230))/0x2*(-parseInt(_0x5db0f8(0x212))/0x3)+-parseInt(_0x5db0f8(0x25d))/0x4+parseInt(_0x5db0f8(0x206))/0x5+-parseInt(_0x5db0f8(0x1e8))/0x6*(-parseInt(_0x5db0f8(0x1e7))/0x7)+parseInt(_0x5db0f8(0x215))/0x8*(parseInt(_0x5db0f8(0x24d))/0x9)+-parseInt(_0x5db0f8(0x1c7))/0xa;if(_0x3b2dd8===_0x16fd22)break;else _0x5342ae['push'](_0x5342ae['shift']());}catch(_0x1b6ce9){_0x5342ae['push'](_0x5342ae['shift']());}}}(_0x1f7a,0x743e8));let express=require('express'),router=express[_0x4b9429(0x22b)](),path=require(_0x4b9429(0x1db)),fs=require('fs'),transCodeUtil=require(_0x4b9429(0x20a)),fileUtil=require(_0x4b9429(0x1e9));const config=require('../../myConfig/config');let videoStreamUtil=require(_0x4b9429(0x1d2)),FFmpeg=require(_0x4b9429(0x248))['FFmpeg'],cryptoUtils=require(_0x4b9429(0x235)),sha256=require(_0x4b9429(0x240));require(_0x4b9429(0x1f6))[_0x4b9429(0x1e1)]['defaultMaxListeners']=0x0;const dbUserTable=require('../../db/dbUserTable'),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbConfigTable=require(_0x4b9429(0x1ec)),dbPrivateSpaceTable=require(_0x4b9429(0x1fa));var jschardet=require(_0x4b9429(0x1d6));function MP4FfmpegTrans(_0x48ec1b,_0x418434,_0x12f87d,_0x2c7d4e,_0x5d7c09,_0x4acf5d){const _0x188a45=_0x4b9429;let _0x1bfd15=_0x48ec1b['query'],_0x3f719a=FFmpeg(),_0x2f2d3c;if(_0x5d7c09)_0x2f2d3c=cryptoUtils[_0x188a45(0x1e6)](_0x4acf5d,_0x12f87d);let _0x27a188=_0x5d7c09?_0x2f2d3c:_0x12f87d,{videoStream:_0x2bcf38,videoWidth:_0x2f0513,videoHeight:_0x2b34d2}=transCodeUtil[_0x188a45(0x1c8)](_0x2c7d4e);_0x3f719a[_0x188a45(0x1df)](transCodeUtil[_0x188a45(0x20e)](_0x27a188));try{_0x3f719a['on'](_0x188a45(0x1fe),function(_0x49d699){const _0x1eafe5=_0x188a45;console[_0x1eafe5(0x243)](_0x49d699);}),_0x3f719a['on'](_0x188a45(0x223),function(_0x4113f6){const _0x345d40=_0x188a45;if(_0x4113f6['message']&&_0x4113f6[_0x345d40(0x257)][_0x345d40(0x1ef)](_0x345d40(0x22f))==-0x1)_0x3f719a[_0x345d40(0x213)](),_0x3f719a=null,_0x418434[_0x345d40(0x205)](0x1f4)[_0x345d40(0x1ee)]();else{}}),_0x3f719a['on'](_0x188a45(0x1ee),function(_0x4a4695){const _0x462a7e=_0x188a45;_0x3f719a&&(_0x3f719a[_0x462a7e(0x213)](),_0x3f719a=null);if(_0x418434)_0x418434[_0x462a7e(0x205)](0xc8)[_0x462a7e(0x1ee)]();}),_0x418434['on']('close',function(){});let _0x23e3fe=transCodeUtil['getCoderConfig'](_0x48ec1b[_0x188a45(0x262)][_0x188a45(0x259)],_0x2bcf38);_0x23e3fe[_0x188a45(0x1d5)]&&_0x3f719a['addInputOption'](_0x23e3fe[_0x188a45(0x1d5)]);let _0x52c92f=_0x1bfd15[_0x188a45(0x1f5)]*config[_0x188a45(0x1bd)];_0x52c92f&&!_0x5d7c09&&_0x3f719a[_0x188a45(0x1ca)](''+parseInt(_0x52c92f));_0x23e3fe[_0x188a45(0x210)]&&_0x3f719a[_0x188a45(0x250)](_0x23e3fe[_0x188a45(0x210)]);let _0x44e2c6=transCodeUtil[_0x188a45(0x1f4)](_0x2bcf38,_0x1bfd15['videobit']);!_0x44e2c6&&(_0x44e2c6=0x1800),_0x3f719a[_0x188a45(0x20d)](''+_0x44e2c6),_0x3f719a[_0x188a45(0x211)](_0x188a45(0x1d1)),_0x3f719a[_0x188a45(0x211)]('-map\x200:a:'+(_0x1bfd15[_0x188a45(0x251)]?_0x1bfd15[_0x188a45(0x251)]:0x0)+'?'),_0x3f719a['outputFormat']('mp4'),_0x3f719a[_0x188a45(0x200)](_0x188a45(0x203)),_0x3f719a[_0x188a45(0x231)]([_0x188a45(0x207)]),_0x3f719a[_0x188a45(0x221)](_0x188a45(0x25e)),_0x3f719a['pipe'](_0x418434,{'end':!![]});}catch(_0x3518cf){console[_0x188a45(0x243)](_0x3518cf),_0x3f719a[_0x188a45(0x213)](),_0x418434['sendStatus'](0x1f4);}}router['all']('/stopPlay',(_0x2a53c2,_0x3a58a7,_0x122d7b)=>{const _0x57773a=_0x4b9429;let _0x38f7fb=_0x2a53c2[_0x57773a(0x201)]['playId']||_0x2a53c2[_0x57773a(0x232)]['playId'];process[_0x57773a(0x1ed)]({'type':_0x57773a(0x227),'playId':_0x38f7fb,'action':'stop'});let _0x4e437f=path[_0x57773a(0x1bf)](config[_0x57773a(0x1d4)],_0x38f7fb);return fs['rm'](_0x4e437f,{'recursive':!![],'force':!![],'maxRetries':0xa},_0x12b4a9=>{const _0x1758ca=_0x57773a;if(_0x12b4a9)console[_0x1758ca(0x243)](_0x12b4a9);}),_0x2a53c2['app'][_0x57773a(0x259)][_0x57773a(0x21c)](_0x57773a(0x217))[_0x57773a(0x237)](_0x2a53c2[_0x57773a(0x201)][_0x57773a(0x22d)]),_0x3a58a7[_0x57773a(0x256)]({'code':0x0});}),router[_0x4b9429(0x202)](_0x4b9429(0x1c3),(_0x1a5c27,_0x4ef67d,_0x51ce5d)=>{const _0x5eb5ad=_0x4b9429;let _0xbd5271=_0x1a5c27[_0x5eb5ad(0x201)],_0x2d11eb=_0xbd5271[_0x5eb5ad(0x21f)],_0x2c1dc6=_0xbd5271[_0x5eb5ad(0x1ea)];if(_0x2c1dc6&&_0x2c1dc6[_0x5eb5ad(0x23c)]>0x2){let _0x52ae49=fileUtil[_0x5eb5ad(0x22c)](_0x2c1dc6);fs[_0x5eb5ad(0x225)](_0x52ae49,fs['constants']['R_OK'],_0x3a6faa=>{const _0x2c1f3=_0x5eb5ad;if(_0x3a6faa)return _0x1a5c27[_0x2c1f3(0x262)][_0x2c1f3(0x1c6)](_0x4ef67d,_0x4ef67d['__'](_0x2c1f3(0x25c)));path[_0x2c1f3(0x25a)](_0x52ae49)==_0x2c1f3(0x229)&&_0x4ef67d[_0x2c1f3(0x255)](_0x52ae49),fs[_0x2c1f3(0x25f)](_0x52ae49,(_0x4f3d84,_0x22f7af)=>{const _0x4d26b2=_0x2c1f3;if(_0x4f3d84)return _0x1a5c27[_0x4d26b2(0x262)][_0x4d26b2(0x1c6)](_0x4ef67d,_0x4ef67d['__'](_0x4d26b2(0x25c)));try{let _0x25eb10=jschardet[_0x4d26b2(0x1ff)](_0x22f7af);!_0x25eb10[_0x4d26b2(0x220)][_0x4d26b2(0x1fd)]('UTF-')&&_0x25eb10[_0x4d26b2(0x249)]>0.95?_0x3f8046(_0x25eb10[_0x4d26b2(0x220)]):_0x3f8046();}catch(_0x1c05d7){console[_0x4d26b2(0x243)](_0x1c05d7),_0x3f8046();}function _0x3f8046(_0x3c2c25){const _0x8ed271=_0x4d26b2;let _0xe50a5c=FFmpeg();_0xe50a5c[_0x8ed271(0x1df)](transCodeUtil['dealFFmpegPath'](_0x52ae49))[_0x8ed271(0x1f7)]()[_0x8ed271(0x1d9)]()[_0x8ed271(0x214)]('webvtt'),_0x3c2c25&&_0xe50a5c[_0x8ed271(0x1c9)](_0x8ed271(0x20c)+_0x3c2c25),_0xe50a5c['on'](_0x8ed271(0x1fe),function(_0x2b1ef8){const _0x345a6c=_0x8ed271;console[_0x345a6c(0x243)](_0x2b1ef8);})['on'](_0x8ed271(0x223),function(_0x1f6567){const _0x5585de=_0x8ed271;_0xe50a5c[_0x5585de(0x213)]();})['on'](_0x8ed271(0x1ee),function(){const _0x15e1c9=_0x8ed271;_0xe50a5c[_0x15e1c9(0x213)]();})[_0x8ed271(0x1cd)](_0x4ef67d);}});});}else{let _0xce75c6=_0xbd5271[_0x5eb5ad(0x219)];transCodeUtil[_0x5eb5ad(0x22a)](_0x1a5c27['app'][_0x5eb5ad(0x20f)],_0x1a5c27['app'][_0x5eb5ad(0x259)],_0xbd5271)[_0x5eb5ad(0x1b8)](_0x48c829=>{const _0x3a8ae5=_0x5eb5ad;let {fullpath:_0x3dc3fe,needDecrypt:_0x2f0ff3,pwd:_0x410a71,streamList:_0x2b4d38}=_0x48c829;fs[_0x3a8ae5(0x225)](_0x3dc3fe,fs['constants'][_0x3a8ae5(0x253)],_0x43924a=>{const _0x44c5e5=_0x3a8ae5;if(_0x43924a)return _0x1a5c27[_0x44c5e5(0x262)]['returnErrMsg'](_0x4ef67d,_0x4ef67d['__'](_0x44c5e5(0x25c)));if(!_0xce75c6)_0xce75c6='vtt';let _0x100fc5=path[_0x44c5e5(0x1bf)](config[_0x44c5e5(0x204)],sha256(_0x3dc3fe+_0x2d11eb)+'.'+_0xce75c6);fs[_0x44c5e5(0x226)](_0x100fc5,(_0x4b03b3,_0x3df9c6)=>{const _0x2d224d=_0x44c5e5;if(_0x4b03b3||_0x3df9c6[_0x2d224d(0x1c4)]<0x3e8){console[_0x2d224d(0x243)](_0x2d224d(0x1bc),_0x100fc5);let _0x4cac60=_0x2f0ff3?cryptoUtils[_0x2d224d(0x1e6)](_0x410a71,_0x3dc3fe):_0x3dc3fe,_0x3b7171=FFmpeg({'timeout':0x258});_0x3b7171[_0x2d224d(0x1df)](transCodeUtil[_0x2d224d(0x20e)](_0x4cac60))[_0x2d224d(0x1f7)]()[_0x2d224d(0x1d9)]()['outputOptions']([_0x2d224d(0x1c0)+_0x2d11eb])['output'](_0x100fc5)['on'](_0x2d224d(0x1fe),function(_0x56c503){const _0x20ec3b=_0x2d224d;console[_0x20ec3b(0x243)](_0x56c503);})['on'](_0x2d224d(0x223),function(_0xe82ba5){const _0x20a9fa=_0x2d224d;console[_0x20a9fa(0x243)](_0xe82ba5),_0x3b7171[_0x20a9fa(0x213)](),fs['rm'](_0x100fc5,_0x5b63c1=>{}),_0x1a5c27['app'][_0x20a9fa(0x1c6)](_0x4ef67d,_0x4ef67d['__'](_0x20a9fa(0x1b9)));})['on'](_0x2d224d(0x1ee),function(){const _0x273124=_0x2d224d;return _0x3b7171[_0x273124(0x213)](),_0xbd5271['noContent']?_0x4ef67d[_0x273124(0x256)]({'code':0x0}):_0x4ef67d['sendFile'](_0x100fc5);}),_0x3b7171[_0x2d224d(0x237)](),_0x4ef67d['on'](_0x2d224d(0x238),function(){const _0x419804=_0x2d224d;_0x3b7171[_0x419804(0x213)]();});}else{console[_0x2d224d(0x243)](_0x2d224d(0x24c),_0x100fc5);if(_0xbd5271[_0x2d224d(0x208)])return _0x4ef67d[_0x2d224d(0x256)]({'code':0x0});return _0x4ef67d[_0x2d224d(0x255)](_0x100fc5);}});});})['catch'](_0x33c269=>{const _0x1a345d=_0x5eb5ad;console[_0x1a345d(0x243)](_0x33c269),_0x1a5c27[_0x1a345d(0x262)][_0x1a345d(0x1c6)](_0x4ef67d,_0x33c269);});}});function sendTsFile(_0x337328,_0x758c54,_0x489978,_0x476ea2,_0x54c9f9,_0x26b9a3=0x1){const _0x158167=_0x4b9429;if(_0x26b9a3>0x28)return;let _0xdd3a51=_0x489978[_0x158167(0x22d)];if(!_0xdd3a51)return;let _0x38bc61=_0x337328[_0x158167(0x262)]['dbOther'][_0x158167(0x21c)](_0x158167(0x241))[_0x158167(0x202)](_0xdd3a51,_0x54c9f9,_0x158167(0x1dc));if(_0x38bc61)fs[_0x158167(0x226)](_0x476ea2,(_0x766349,_0x33f483)=>{const _0x1237ef=_0x158167;_0x766349?(_0x337328[_0x1237ef(0x262)][_0x1237ef(0x259)][_0x1237ef(0x21c)](_0x1237ef(0x1c2))[_0x1237ef(0x237)](_0xdd3a51,_0x54c9f9),sendTsFile(_0x337328,_0x758c54,_0x489978,_0x476ea2,_0x54c9f9,_0x26b9a3+0x1)):(_0x337328[_0x1237ef(0x262)][_0x1237ef(0x259)][_0x1237ef(0x21c)]('DELETE\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_type=\x27waiting\x27')[_0x1237ef(0x237)](_0xdd3a51),_0x758c54[_0x1237ef(0x255)](_0x476ea2));});else{function _0x51cf62(){const _0x4c36eb=_0x158167;let _0x5c208f=setTimeout(()=>{clearTimeout(_0x5c208f),sendTsFile(_0x337328,_0x758c54,_0x489978,_0x476ea2,_0x54c9f9,_0x26b9a3+0x1);},0x1f4);_0x758c54['on'](_0x4c36eb(0x238),()=>clearTimeout(_0x5c208f));}let _0x16e1ed=_0x337328[_0x158167(0x262)][_0x158167(0x259)][_0x158167(0x21c)](_0x158167(0x1be))[_0x158167(0x202)](_0xdd3a51,_0x158167(0x1dc));if(!_0x16e1ed)return _0x51cf62();else{let _0x2d69e7=_0x337328['app'][_0x158167(0x259)][_0x158167(0x21c)](_0x158167(0x1ba))['get'](_0xdd3a51,_0x54c9f9,'waiting');if(_0x2d69e7)return _0x51cf62();else{let _0x5745e6=parseInt(_0x16e1ed[_0x158167(0x216)][_0x158167(0x1f3)](_0x158167(0x239),'')[_0x158167(0x1f3)](_0x158167(0x266),''));return _0x489978[_0x158167(0x1f5)]>_0x5745e6+0xf||_0x489978[_0x158167(0x1f5)]<_0x5745e6?(process[_0x158167(0x1ed)]({'type':_0x158167(0x227),'playId':_0xdd3a51,'action':'stop'}),process[_0x158167(0x1ed)]({'type':_0x158167(0x227),'playId':_0xdd3a51,'args':_0x489978,'action':'start'}),_0x337328[_0x158167(0x262)]['dbOther']['prepare']('REPLACE\x20INTO\x20play_record_ts(play_id,ts_name,ts_type)\x20VALUES(?,?,?)')['run'](_0xdd3a51,_0x54c9f9,_0x158167(0x1bb)),_0x51cf62()):_0x51cf62();}}}}function hasPermission(_0x50437a,_0x1fa4ae,_0x489ac7){const _0xdaa233=_0x4b9429;if(_0x489ac7[_0xdaa233(0x258)]&&!_0x489ac7['spaceId']){let _0x372f92=dbFileIndexTable[_0xdaa233(0x25b)](_0x489ac7[_0xdaa233(0x247)]),_0x1c3e26=dbFileIndexTable['getById'](_0x50437a['app'][_0xdaa233(0x20f)],_0x489ac7[_0xdaa233(0x258)],_0x372f92);if(!_0x1c3e26)return reject('index\x20does\x20not\x20exist');let _0x40cb83=_0x1c3e26['path']+path[_0xdaa233(0x23d)]+_0x1c3e26[_0xdaa233(0x267)];if(dbUserTable[_0xdaa233(0x233)](_0x50437a,_0x1fa4ae,_0x489ac7['serverType'],_0xdaa233(0x1f9),_0x40cb83,!![])!==!![])return console[_0xdaa233(0x243)](_0xdaa233(0x1f1)),![];return!![];}else{if(_0x489ac7['filePath']&&!_0x489ac7[_0xdaa233(0x1d0)]){let _0x526d79=fileUtil['decodePath'](_0x489ac7['filePath']);if(dbUserTable[_0xdaa233(0x233)](_0x50437a,_0x1fa4ae,'',_0xdaa233(0x1f9),_0x526d79,!![])!==!![])return console[_0xdaa233(0x243)]('index\x20no\x20permission'),![];return!![];}else{if(_0x489ac7['spaceId']&&_0x489ac7['spaceToken']){let _0x379758=dbPrivateSpaceTable['getTokenObjByToken'](_0x50437a['app'][_0xdaa233(0x259)],_0x489ac7['spaceToken']);if(!_0x379758||_0x379758['space_id']!=_0x489ac7[_0xdaa233(0x1d0)])return![];return!![];}else return console[_0xdaa233(0x243)]('args',_0x489ac7),![];}}}router[_0x4b9429(0x202)](_0x4b9429(0x224),(_0x3c011f,_0x1a2ed3,_0x5188f3)=>{const _0xbe1398=_0x4b9429;let _0x48ce47=_0x3c011f['query'];if(_0x3c011f[_0xbe1398(0x1db)]['endsWith']('ts')){let _0x42e615=_0x3c011f[_0xbe1398(0x1db)]['substring'](_0x3c011f[_0xbe1398(0x1db)][_0xbe1398(0x1d7)]('/')+0x1),_0x546d40=_0x48ce47[_0xbe1398(0x22d)],_0x2ec757=path['join'](config['m3u8TmpPath'],_0x546d40,_0x42e615),_0x4f7035=_0x3c011f['app'][_0xbe1398(0x259)][_0xbe1398(0x21c)](_0xbe1398(0x24e))[_0xbe1398(0x202)](_0x546d40);!_0x4f7035&&(_0x48ce47[_0xbe1398(0x1e0)]=_0x48ce47['seq']*config[_0xbe1398(0x1bd)],_0x3c011f[_0xbe1398(0x262)]['dbOther'][_0xbe1398(0x21c)]('REPLACE\x20INTO\x20play_record(play_id,args,uid)\x20VALUES(?,?,?)')[_0xbe1398(0x237)](_0x546d40,JSON['stringify'](_0x48ce47),_0x3c011f[_0xbe1398(0x234)]['id']));if(!hasPermission(_0x3c011f,_0x1a2ed3,_0x48ce47))return _0x1a2ed3[_0xbe1398(0x256)]({'code':0x66});return process[_0xbe1398(0x1ed)]({'type':_0xbe1398(0x227),'playId':_0x546d40,'args':_0x48ce47,'action':_0xbe1398(0x1fe)}),sendTsFile(_0x3c011f,_0x1a2ed3,_0x48ce47,_0x2ec757,_0x42e615);}else{if(_0x3c011f[_0xbe1398(0x1db)][_0xbe1398(0x1fb)](_0xbe1398(0x1c5))){let _0xdbb048=_0x48ce47[_0xbe1398(0x22d)];if(!_0xdbb048)return _0x3c011f[_0xbe1398(0x262)][_0xbe1398(0x1c6)](_0x1a2ed3,_0xbe1398(0x21a));if(!hasPermission(_0x3c011f,_0x1a2ed3,_0x48ce47))return _0x1a2ed3[_0xbe1398(0x256)]({'code':0x66});transCodeUtil[_0xbe1398(0x22a)](_0x3c011f[_0xbe1398(0x262)][_0xbe1398(0x20f)],_0x3c011f[_0xbe1398(0x262)][_0xbe1398(0x259)],_0x48ce47)['then'](_0x32f092=>{const _0x52925d=_0xbe1398;let {fullpath:_0x419e1d,duration:_0x578aa3}=_0x32f092;fs[_0x52925d(0x225)](_0x419e1d,fs[_0x52925d(0x23e)]['R_OK'],_0x1d6de1=>{const _0x3dc35e=_0x52925d;if(_0x1d6de1)return _0x3c011f[_0x3dc35e(0x262)][_0x3dc35e(0x1c6)](_0x1a2ed3,_0x1a2ed3['__'](_0x3dc35e(0x25c)));_0x3c011f[_0x3dc35e(0x262)][_0x3dc35e(0x259)][_0x3dc35e(0x21c)](_0x3dc35e(0x244))[_0x3dc35e(0x237)](_0xdbb048,JSON[_0x3dc35e(0x23f)](_0x48ce47),_0x3c011f[_0x3dc35e(0x234)]['id']),process[_0x3dc35e(0x1ed)]({'type':_0x3dc35e(0x227),'playId':_0xdbb048,'args':_0x48ce47,'action':_0x3dc35e(0x1fe)}),getM3U8(_0x48ce47,_0x578aa3,_0x1a2ed3);});})[_0xbe1398(0x245)](_0x4080f6=>{const _0x35ea0a=_0xbe1398;console['log'](_0x35ea0a(0x223),_0x4080f6),_0x3c011f[_0x35ea0a(0x262)][_0x35ea0a(0x1c6)](_0x1a2ed3,_0x4080f6);});}else{if(_0x3c011f[_0xbe1398(0x1db)]['endsWith'](_0xbe1398(0x25e))){if(!hasPermission(_0x3c011f,_0x1a2ed3,_0x48ce47))return _0x1a2ed3['json']({'code':0x66});transCodeUtil[_0xbe1398(0x22a)](_0x3c011f[_0xbe1398(0x262)]['dbFileIndex'],_0x3c011f[_0xbe1398(0x262)][_0xbe1398(0x259)],_0x48ce47)[_0xbe1398(0x1b8)](_0x1c65bc=>{const _0x3202cd=_0xbe1398;let {fullpath:_0x3cfacb,streamList:_0xbe4a74,needDecrypt:_0x383fdd,pwd:_0x3a3dd3}=_0x1c65bc;fs[_0x3202cd(0x225)](_0x3cfacb,fs[_0x3202cd(0x23e)]['R_OK'],_0xe92732=>{const _0xbd2fa0=_0x3202cd;if(_0xe92732)return _0x3c011f[_0xbd2fa0(0x262)][_0xbd2fa0(0x1c6)](_0x1a2ed3,_0x1a2ed3['__']('cannotReadFile'));MP4FfmpegTrans(_0x3c011f,_0x1a2ed3,_0x3cfacb,_0xbe4a74,_0x383fdd,_0x3a3dd3);});})['catch'](_0x5b603b=>{const _0x36e20c=_0xbe1398;console['log'](_0x36e20c(0x223),_0x5b603b),_0x3c011f[_0x36e20c(0x262)][_0x36e20c(0x1c6)](_0x1a2ed3,_0x5b603b);});}}}}),router[_0x4b9429(0x21b)](_0x4b9429(0x261),(_0x5a9b17,_0x3367fa,_0x444249)=>{const _0x52f898=_0x4b9429;if(!_0x5a9b17[_0x52f898(0x232)]['filePath'])return _0x3367fa[_0x52f898(0x264)](0x1f4);let _0x2cdff5=fileUtil[_0x52f898(0x22c)](_0x5a9b17[_0x52f898(0x232)]['filePath']),_0x48f00d={'code':0x0,'streams':[],'duration':0x0},_0x54df73=dbConfigTable[_0x52f898(0x242)](_0x5a9b17[_0x52f898(0x262)]['dbOther'],_0x52f898(0x236));_0x48f00d[_0x52f898(0x236)]=_0x54df73?_0x54df73[_0x52f898(0x1e4)]:_0x52f898(0x1eb),_0x2cdff5=transCodeUtil[_0x52f898(0x20e)](_0x2cdff5),videoStreamUtil[_0x52f898(0x1cb)](_0x2cdff5)[_0x52f898(0x1b8)](_0x86bf97=>{const _0x46a934=_0x52f898;_0x48f00d['streams']=_0x86bf97[_0x46a934(0x20b)],_0x48f00d[_0x46a934(0x1e5)]=videoStreamUtil[_0x46a934(0x1cc)](_0x86bf97),_0x3367fa[_0x46a934(0x256)](_0x48f00d);})[_0x52f898(0x245)](_0x30d83e=>{const _0x517504=_0x52f898;return console['log'](_0x30d83e),_0x5a9b17[_0x517504(0x262)][_0x517504(0x1c6)](_0x3367fa,_0x30d83e);});});function getM3U8(_0x389a27,_0x4df397,_0x1e6a19){const _0x31e73f=_0x4b9429;let _0x274212=Math[_0x31e73f(0x1f2)](_0x4df397/config['m3u8segmentDuration']),_0x443ead=_0x4df397-_0x274212*_0x4df397;if(_0x443ead>0x0){try{_0x443ead=parseInt(_0x443ead);}catch(_0xc29716){console[_0x31e73f(0x243)](_0xc29716);}_0x274212+=0x1;}let _0x48665b=_0x31e73f(0x1dd)+config[_0x31e73f(0x1bd)]+_0x31e73f(0x24b)+_0x389a27['seek']+'\x0a';_0x389a27[_0x31e73f(0x1e0)]&&(segmentStartNum=parseInt(_0x389a27['seek']/config[_0x31e73f(0x1bd)]));for(let _0x23aa74=0x0;_0x23aa74<_0x274212;_0x23aa74++){let _0x5f1689=_0x31e73f(0x260)+(_0x23aa74==_0x274212-0x1&&_0x443ead>0x0?_0x443ead:config[_0x31e73f(0x1bd)])+_0x31e73f(0x21d)+_0x23aa74+_0x31e73f(0x1fc)+_0x389a27[_0x31e73f(0x22d)]+_0x31e73f(0x209)+_0x389a27[_0x31e73f(0x1d8)]+_0x31e73f(0x265)+_0x23aa74;_0x389a27[_0x31e73f(0x1c4)]&&(_0x5f1689+='&size='+_0x389a27[_0x31e73f(0x1c4)]),_0x389a27[_0x31e73f(0x254)]&&(_0x5f1689+=_0x31e73f(0x1de)+_0x389a27[_0x31e73f(0x254)]),_0x389a27[_0x31e73f(0x21f)]&&(_0x5f1689+=_0x31e73f(0x1e2)+_0x389a27[_0x31e73f(0x21f)]),_0x389a27['serverType']&&(_0x5f1689+='&serverType='+_0x389a27[_0x31e73f(0x247)]),_0x389a27[_0x31e73f(0x251)]&&(_0x5f1689+='&audioIndex='+_0x389a27['audioIndex']),_0x389a27[_0x31e73f(0x258)]&&(_0x5f1689+=_0x31e73f(0x252)+_0x389a27[_0x31e73f(0x258)]),_0x389a27['ac']&&(_0x5f1689+=_0x31e73f(0x218)+_0x389a27['ac']),_0x389a27[_0x31e73f(0x222)]&&(_0x5f1689+=_0x31e73f(0x1f0)+_0x389a27['filePath']),_0x389a27[_0x31e73f(0x1d0)]&&(_0x5f1689+=_0x31e73f(0x1e3)+_0x389a27[_0x31e73f(0x1d0)]),_0x389a27[_0x31e73f(0x1f8)]&&(_0x5f1689+=_0x31e73f(0x22e)+_0x389a27['spaceToken']),_0x389a27[_0x31e73f(0x1d3)]&&(_0x5f1689+=_0x31e73f(0x23a)+_0x389a27['spaceIndexId']),_0x389a27[_0x31e73f(0x23b)]&&(_0x5f1689+=_0x31e73f(0x1c1)+_0x389a27[_0x31e73f(0x23b)]),_0x48665b+=_0x5f1689;}_0x48665b+=_0x31e73f(0x24f),_0x1e6a19[_0x31e73f(0x1ce)](_0x31e73f(0x228),_0x31e73f(0x1da));let _0x9f2cf0=new Date()[_0x31e73f(0x263)]()+_0x31e73f(0x246);_0x1e6a19[_0x31e73f(0x1ce)](_0x31e73f(0x21e),'attachment;\x20filename='+_0x9f2cf0),_0x1e6a19[_0x31e73f(0x1ed)](_0x48665b);}function _0x3bfe(_0x5b715d,_0x1ac4cc){const _0x1f7a31=_0x1f7a();return _0x3bfe=function(_0x3bfec0,_0x10cd94){_0x3bfec0=_0x3bfec0-0x1b8;let _0x271fbb=_0x1f7a31[_0x3bfec0];return _0x271fbb;},_0x3bfe(_0x5b715d,_0x1ac4cc);}module[_0x4b9429(0x24a)]=router;