const _0x16fc4b=_0x5a7f;(function(_0x3349ce,_0x2f2a67){const _0x2e2bd4=_0x5a7f,_0x513003=_0x3349ce();while(!![]){try{const _0x501518=parseInt(_0x2e2bd4(0xed))/0x1+-parseInt(_0x2e2bd4(0x154))/0x2*(parseInt(_0x2e2bd4(0xba))/0x3)+parseInt(_0x2e2bd4(0x15e))/0x4+-parseInt(_0x2e2bd4(0x10d))/0x5+-parseInt(_0x2e2bd4(0xff))/0x6*(-parseInt(_0x2e2bd4(0xbc))/0x7)+-parseInt(_0x2e2bd4(0xd8))/0x8+parseInt(_0x2e2bd4(0x14a))/0x9;if(_0x501518===_0x2f2a67)break;else _0x513003['push'](_0x513003['shift']());}catch(_0x32c871){_0x513003['push'](_0x513003['shift']());}}}(_0x2b96,0xdf215));let express=require(_0x16fc4b(0xc5)),router=express[_0x16fc4b(0x140)](),path=require(_0x16fc4b(0x109)),fs=require('fs'),transCodeUtil=require(_0x16fc4b(0x103)),fileUtil=require(_0x16fc4b(0xca));const config=require(_0x16fc4b(0xb7));let videoStreamUtil=require(_0x16fc4b(0x135)),FFmpeg=require('../../libs/nasTrans')[_0x16fc4b(0xd2)],cryptoUtils=require(_0x16fc4b(0x13b)),sha256=require(_0x16fc4b(0x14b));require(_0x16fc4b(0x14e))[_0x16fc4b(0x148)]['defaultMaxListeners']=0x0;const dbUserTable=require(_0x16fc4b(0xf4)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbConfigTable=require(_0x16fc4b(0x160));var jschardet=require(_0x16fc4b(0x116));function MP4FfmpegTrans(_0x442cdf,_0x1b0723,_0x276fe5,_0x349b65,_0xcff07e,_0x3a2fcd){const _0x21ca2e=_0x16fc4b;let _0x477e07=_0x442cdf[_0x21ca2e(0x10b)],_0x4cc20c=FFmpeg(),_0x32feac;if(_0xcff07e)_0x32feac=cryptoUtils[_0x21ca2e(0x119)](_0x3a2fcd,_0x276fe5);let _0x3bcd36=_0xcff07e?_0x32feac:_0x276fe5,{videoStream:_0x5aa7b1,videoWidth:_0x93238f,videoHeight:_0x5cd270}=transCodeUtil['parseStreamList'](_0x349b65);_0x4cc20c[_0x21ca2e(0xdc)](transCodeUtil[_0x21ca2e(0x12b)](_0x3bcd36));try{_0x4cc20c['on'](_0x21ca2e(0x107),function(_0x56cfba){const _0x3bffc6=_0x21ca2e;console[_0x3bffc6(0x139)](_0x56cfba);}),_0x4cc20c['on'](_0x21ca2e(0x15d),function(_0x465af9){const _0xdb8e7e=_0x21ca2e;if(_0x465af9[_0xdb8e7e(0xea)]&&_0x465af9[_0xdb8e7e(0xea)][_0xdb8e7e(0xd1)](_0xdb8e7e(0x153))==-0x1)_0x4cc20c[_0xdb8e7e(0x10c)](),_0x4cc20c=null,_0x1b0723[_0xdb8e7e(0xeb)](0x1f4)[_0xdb8e7e(0xdf)]();else{}}),_0x4cc20c['on'](_0x21ca2e(0xdf),function(_0x156271){const _0xa8c87d=_0x21ca2e;_0x4cc20c&&(_0x4cc20c[_0xa8c87d(0x10c)](),_0x4cc20c=null);if(_0x1b0723)_0x1b0723[_0xa8c87d(0xeb)](0xc8)[_0xa8c87d(0xdf)]();}),_0x1b0723['on'](_0x21ca2e(0xfe),function(){});let _0x2dbcc8=transCodeUtil['getCoderConfig'](_0x442cdf[_0x21ca2e(0xf6)][_0x21ca2e(0xce)],_0x5aa7b1);_0x2dbcc8[_0x21ca2e(0xd4)]&&_0x4cc20c[_0x21ca2e(0x145)](_0x2dbcc8[_0x21ca2e(0xd4)]);let _0x15717f=_0x477e07[_0x21ca2e(0xe4)]*config[_0x21ca2e(0xda)];_0x15717f&&!_0xcff07e&&_0x4cc20c[_0x21ca2e(0x101)](''+parseInt(_0x15717f));_0x2dbcc8[_0x21ca2e(0xd6)]&&_0x4cc20c['videoCodec'](_0x2dbcc8[_0x21ca2e(0xd6)]);let _0x2e8c29=transCodeUtil[_0x21ca2e(0x142)](_0x5aa7b1,_0x477e07[_0x21ca2e(0x114)]);!_0x2e8c29&&(_0x2e8c29=0x1800),_0x4cc20c[_0x21ca2e(0xb3)](''+_0x2e8c29),_0x4cc20c[_0x21ca2e(0x11f)](_0x21ca2e(0x156)),_0x4cc20c['addOption'](_0x21ca2e(0x158)+(_0x477e07[_0x21ca2e(0xe6)]?_0x477e07['audioIndex']:0x0)+'?'),_0x4cc20c['outputFormat']('mp4'),_0x4cc20c[_0x21ca2e(0x125)](_0x21ca2e(0x100)),_0x4cc20c[_0x21ca2e(0x152)]([_0x21ca2e(0xe5)]),_0x4cc20c[_0x21ca2e(0xc4)](_0x21ca2e(0xfd)),_0x4cc20c[_0x21ca2e(0xec)](_0x1b0723,{'end':!![]});}catch(_0x3df45c){console[_0x21ca2e(0x139)](_0x3df45c),_0x4cc20c['kill'](),_0x1b0723[_0x21ca2e(0xd9)](0x1f4);}}function _0x5a7f(_0x58ac06,_0x4c48db){const _0x2b96b4=_0x2b96();return _0x5a7f=function(_0x5a7fef,_0x2c61bd){_0x5a7fef=_0x5a7fef-0xb3;let _0x4a4110=_0x2b96b4[_0x5a7fef];return _0x4a4110;},_0x5a7f(_0x58ac06,_0x4c48db);}router[_0x16fc4b(0xf3)](_0x16fc4b(0x12d),(_0x3f8e09,_0x98cd7e,_0xaf441d)=>{const _0x10c307=_0x16fc4b;let _0x2af30b=_0x3f8e09[_0x10c307(0x10b)][_0x10c307(0x11a)]||_0x3f8e09[_0x10c307(0xe1)][_0x10c307(0x11a)];process[_0x10c307(0x146)]({'type':_0x10c307(0xde),'playId':_0x2af30b,'action':_0x10c307(0xf0)});let _0x3cec33=path[_0x10c307(0xdd)](config[_0x10c307(0x13e)],_0x2af30b);return fs['rm'](_0x3cec33,{'recursive':!![],'force':!![],'maxRetries':0xa},_0x1413f6=>{if(_0x1413f6)console['log'](_0x1413f6);}),_0x3f8e09['app'][_0x10c307(0xce)][_0x10c307(0x13a)](_0x10c307(0xf8))[_0x10c307(0x118)](_0x3f8e09[_0x10c307(0x10b)]['playId']),_0x98cd7e[_0x10c307(0x15b)]({'code':0x0});}),router[_0x16fc4b(0x133)](_0x16fc4b(0x128),(_0x1298ee,_0x3825d9,_0x38c468)=>{const _0x2ed52f=_0x16fc4b;let _0x40071e=_0x1298ee[_0x2ed52f(0x10b)],_0x4e8330=_0x40071e[_0x2ed52f(0xf5)],_0xdc36f1=_0x40071e['subtitleFile'];if(_0xdc36f1&&_0xdc36f1['length']>0x2){let _0x2d97b2=fileUtil[_0x2ed52f(0xc7)](_0xdc36f1);fs['access'](_0x2d97b2,fs['constants'][_0x2ed52f(0x13d)],_0x5f0248=>{const _0x41b6b2=_0x2ed52f;if(_0x5f0248)return _0x1298ee[_0x41b6b2(0xf6)]['returnErrMsg'](_0x3825d9,_0x3825d9['__'](_0x41b6b2(0xe0)));path['extname'](_0x2d97b2)==_0x41b6b2(0x12c)&&_0x3825d9[_0x41b6b2(0x10e)](_0x2d97b2),fs['readFile'](_0x2d97b2,(_0x53a8ab,_0x116c6f)=>{const _0x5021a3=_0x41b6b2;if(_0x53a8ab)return _0x1298ee['app'][_0x5021a3(0x143)](_0x3825d9,_0x3825d9['__'](_0x5021a3(0xe0)));try{let _0x4d7c38=jschardet['detect'](_0x116c6f);!_0x4d7c38[_0x5021a3(0x130)][_0x5021a3(0x15a)](_0x5021a3(0xcc))&&_0x4d7c38['confidence']>0.95?_0x226fc0(_0x4d7c38[_0x5021a3(0x130)]):_0x226fc0();}catch(_0x4c85a8){console[_0x5021a3(0x139)](_0x4c85a8),_0x226fc0();}function _0x226fc0(_0x2e933c){const _0x9b163f=_0x5021a3;let _0x47c081=FFmpeg();_0x47c081[_0x9b163f(0xdc)](transCodeUtil[_0x9b163f(0x12b)](_0x2d97b2))[_0x9b163f(0x134)]()['noVideo']()[_0x9b163f(0x131)](_0x9b163f(0xdb)),_0x2e933c&&_0x47c081[_0x9b163f(0xcd)](_0x9b163f(0xc8)+_0x2e933c),_0x47c081['on']('start',function(_0x4ffc00){const _0xa769c9=_0x9b163f;console[_0xa769c9(0x139)](_0x4ffc00);})['on']('error',function(_0x5d2848){const _0x432c59=_0x9b163f;_0x47c081[_0x432c59(0x10c)]();})['on'](_0x9b163f(0xdf),function(){_0x47c081['kill']();})[_0x9b163f(0xec)](_0x3825d9);}});});}else{let _0x164fae=_0x40071e[_0x2ed52f(0x104)];transCodeUtil[_0x2ed52f(0x123)](_0x1298ee['app']['dbFileIndex'],_0x1298ee['app'][_0x2ed52f(0xce)],_0x40071e)[_0x2ed52f(0x121)](_0x3bfe82=>{const _0x1c49a3=_0x2ed52f;let {fullpath:_0x47f5ed,needDecrypt:_0x3b879a,pwd:_0x4cffdd,streamList:_0x50c860}=_0x3bfe82;fs[_0x1c49a3(0xd3)](_0x47f5ed,fs[_0x1c49a3(0xd5)][_0x1c49a3(0x13d)],_0x2f6883=>{const _0x1fbf8d=_0x1c49a3;if(_0x2f6883)return _0x1298ee[_0x1fbf8d(0xf6)][_0x1fbf8d(0x143)](_0x3825d9,_0x3825d9['__']('cannotReadFile'));if(!_0x164fae)_0x164fae='vtt';let _0x125925=path['join'](config[_0x1fbf8d(0xf7)],sha256(_0x47f5ed+_0x4e8330)+'.'+_0x164fae);fs[_0x1fbf8d(0xf2)](_0x125925,(_0x1b0726,_0x5ab36f)=>{const _0x6f5e7a=_0x1fbf8d;if(_0x1b0726||_0x5ab36f['size']<0x3e8){console[_0x6f5e7a(0x139)]('生成字幕文件',_0x125925);let _0x47193e=_0x3b879a?cryptoUtils[_0x6f5e7a(0x119)](_0x4cffdd,_0x47f5ed):_0x47f5ed,_0xd1819=FFmpeg({'timeout':0x258});_0xd1819[_0x6f5e7a(0xdc)](transCodeUtil[_0x6f5e7a(0x12b)](_0x47193e))['noAudio']()['noVideo']()[_0x6f5e7a(0x152)]([_0x6f5e7a(0xbf)+_0x4e8330])[_0x6f5e7a(0x15f)](_0x125925)['on'](_0x6f5e7a(0x107),function(_0x14d2d5){const _0x8bed8c=_0x6f5e7a;console[_0x8bed8c(0x139)](_0x14d2d5);})['on'](_0x6f5e7a(0x15d),function(_0x5238ee){const _0xa1c089=_0x6f5e7a;console[_0xa1c089(0x139)](_0x5238ee),_0xd1819[_0xa1c089(0x10c)](),fs['rm'](_0x125925,_0x4229ce=>{}),_0x1298ee['app'][_0xa1c089(0x143)](_0x3825d9,_0x3825d9['__'](_0xa1c089(0xb6)));})['on'](_0x6f5e7a(0xdf),function(){const _0x453e1c=_0x6f5e7a;return _0xd1819[_0x453e1c(0x10c)](),_0x40071e[_0x453e1c(0xe8)]?_0x3825d9[_0x453e1c(0x15b)]({'code':0x0}):_0x3825d9['sendFile'](_0x125925);}),_0xd1819[_0x6f5e7a(0x118)](),_0x3825d9['on']('close',function(){const _0x4c13e7=_0x6f5e7a;_0xd1819[_0x4c13e7(0x10c)]();});}else{console['log'](_0x6f5e7a(0xe2),_0x125925);if(_0x40071e[_0x6f5e7a(0xe8)])return _0x3825d9['json']({'code':0x0});return _0x3825d9['sendFile'](_0x125925);}});});})[_0x2ed52f(0x144)](_0x32ab00=>{const _0x354d2c=_0x2ed52f;console['log'](_0x32ab00),_0x1298ee['app'][_0x354d2c(0x143)](_0x3825d9,_0x32ab00);});}});function sendTsFile(_0x292cf9,_0x534f1b,_0x3f6dda,_0x3b13c4,_0x4ca43e,_0x45e6ec=0x1){const _0x5b830e=_0x16fc4b;if(_0x45e6ec>0x28)return;let _0x40afdc=_0x3f6dda[_0x5b830e(0x11a)];if(!_0x40afdc)return;let _0x3df6a6=_0x292cf9['app']['dbOther'][_0x5b830e(0x13a)](_0x5b830e(0xc3))[_0x5b830e(0x133)](_0x40afdc,_0x4ca43e,_0x5b830e(0xcb));if(_0x3df6a6)fs[_0x5b830e(0xf2)](_0x3b13c4,(_0xd0f02a,_0x13d70e)=>{const _0x3ab098=_0x5b830e;_0xd0f02a?(_0x292cf9[_0x3ab098(0xf6)][_0x3ab098(0xce)]['prepare'](_0x3ab098(0xf1))['run'](_0x40afdc,_0x4ca43e),sendTsFile(_0x292cf9,_0x534f1b,_0x3f6dda,_0x3b13c4,_0x4ca43e,_0x45e6ec+0x1)):(_0x292cf9[_0x3ab098(0xf6)][_0x3ab098(0xce)][_0x3ab098(0x13a)](_0x3ab098(0x126))[_0x3ab098(0x118)](_0x40afdc),_0x534f1b['sendFile'](_0x3b13c4));});else{function _0x16b115(){let _0x538fd5=setTimeout(()=>{clearTimeout(_0x538fd5),sendTsFile(_0x292cf9,_0x534f1b,_0x3f6dda,_0x3b13c4,_0x4ca43e,_0x45e6ec+0x1);},0x1f4);_0x534f1b['on']('close',()=>clearTimeout(_0x538fd5));}let _0x4a3015=_0x292cf9[_0x5b830e(0xf6)][_0x5b830e(0xce)][_0x5b830e(0x13a)](_0x5b830e(0x137))[_0x5b830e(0x133)](_0x40afdc,_0x5b830e(0xcb));if(!_0x4a3015)return _0x16b115();else{let _0x418e70=_0x292cf9[_0x5b830e(0xf6)][_0x5b830e(0xce)]['prepare'](_0x5b830e(0xbd))[_0x5b830e(0x133)](_0x40afdc,_0x4ca43e,_0x5b830e(0xd0));if(_0x418e70)return _0x16b115();else{let _0x3c911e=parseInt(_0x4a3015[_0x5b830e(0xbe)][_0x5b830e(0x138)](_0x5b830e(0x12a),'')['replace'](_0x5b830e(0x12f),''));return _0x3f6dda[_0x5b830e(0xe4)]>_0x3c911e+0xf||_0x3f6dda[_0x5b830e(0xe4)]<_0x3c911e?(process[_0x5b830e(0x146)]({'type':_0x5b830e(0xde),'playId':_0x40afdc,'action':_0x5b830e(0xf0)}),process[_0x5b830e(0x146)]({'type':_0x5b830e(0xde),'playId':_0x40afdc,'args':_0x3f6dda,'action':'start'}),_0x292cf9[_0x5b830e(0xf6)][_0x5b830e(0xce)][_0x5b830e(0x13a)](_0x5b830e(0x122))[_0x5b830e(0x118)](_0x40afdc,_0x4ca43e,_0x5b830e(0xd0)),_0x16b115()):_0x16b115();}}}}function hasPermission(_0x594cec,_0x30a65e,_0x46d78d){const _0x3ff730=_0x16fc4b;if(_0x46d78d[_0x3ff730(0x13f)]&&!_0x46d78d[_0x3ff730(0xe3)]){let _0x2b4de9=dbFileIndexTable['getIndexTableNameByType'](_0x46d78d[_0x3ff730(0xe9)]),_0x30a2e4=dbFileIndexTable[_0x3ff730(0xfc)](_0x594cec[_0x3ff730(0xf6)][_0x3ff730(0x111)],_0x46d78d[_0x3ff730(0x13f)],_0x2b4de9);if(!_0x30a2e4)return reject(_0x3ff730(0x149));let _0x3f0081=_0x30a2e4['path']+path[_0x3ff730(0x150)]+_0x30a2e4['filename'];if(dbUserTable[_0x3ff730(0x14d)](_0x594cec,_0x30a65e,_0x46d78d[_0x3ff730(0xe9)],'power_get',_0x3f0081,!![])!==!![])return console[_0x3ff730(0x139)](_0x3ff730(0x11d)),![];return!![];}else{if(_0x46d78d[_0x3ff730(0x12e)]&&!_0x46d78d['spaceId']){let _0x70ad83=fileUtil[_0x3ff730(0xc7)](_0x46d78d[_0x3ff730(0x12e)]);if(dbUserTable[_0x3ff730(0x14d)](_0x594cec,_0x30a65e,'',_0x3ff730(0xbb),_0x70ad83,!![])!==!![])return console[_0x3ff730(0x139)](_0x3ff730(0x11d)),![];return!![];}else return![];}}router[_0x16fc4b(0x133)](_0x16fc4b(0xb5),(_0x5a7aa3,_0xfe3b1,_0x95c874)=>{const _0x4ce5a2=_0x16fc4b;let _0x2f4f26=_0x5a7aa3['query'];if(_0x5a7aa3[_0x4ce5a2(0x109)]['endsWith']('ts')){let _0x34c251=_0x5a7aa3[_0x4ce5a2(0x109)][_0x4ce5a2(0x136)](_0x5a7aa3['path'][_0x4ce5a2(0xb4)]('/')+0x1),_0x199cdf=_0x2f4f26[_0x4ce5a2(0x11a)],_0x54ff03=path['join'](config[_0x4ce5a2(0x13e)],_0x199cdf,_0x34c251),_0x2bd633=_0x5a7aa3[_0x4ce5a2(0xf6)]['dbOther']['prepare']('SELECT\x20*\x20FROM\x20play_record\x20WHERE\x20play_id=?')[_0x4ce5a2(0x133)](_0x199cdf);!_0x2bd633&&(_0x2f4f26[_0x4ce5a2(0x151)]=_0x2f4f26[_0x4ce5a2(0xe4)]*config[_0x4ce5a2(0xda)],_0x5a7aa3[_0x4ce5a2(0xf6)][_0x4ce5a2(0xce)][_0x4ce5a2(0x13a)](_0x4ce5a2(0x159))['run'](_0x199cdf,JSON[_0x4ce5a2(0xd7)](_0x2f4f26),_0x5a7aa3[_0x4ce5a2(0xe7)]['id']));if(!hasPermission(_0x5a7aa3,_0xfe3b1,_0x2f4f26))return _0xfe3b1[_0x4ce5a2(0x15b)]({'code':0x66});return process[_0x4ce5a2(0x146)]({'type':_0x4ce5a2(0xde),'playId':_0x199cdf,'args':_0x2f4f26,'action':'start'}),sendTsFile(_0x5a7aa3,_0xfe3b1,_0x2f4f26,_0x54ff03,_0x34c251);}else{if(_0x5a7aa3[_0x4ce5a2(0x109)]['endsWith'](_0x4ce5a2(0xc6))){let _0x481454=_0x2f4f26[_0x4ce5a2(0x11a)];if(!_0x481454)return _0x5a7aa3[_0x4ce5a2(0xf6)][_0x4ce5a2(0x143)](_0xfe3b1,'need\x20play\x20id');if(!hasPermission(_0x5a7aa3,_0xfe3b1,_0x2f4f26))return _0xfe3b1[_0x4ce5a2(0x15b)]({'code':0x66});transCodeUtil[_0x4ce5a2(0x123)](_0x5a7aa3[_0x4ce5a2(0xf6)][_0x4ce5a2(0x111)],_0x5a7aa3['app'][_0x4ce5a2(0xce)],_0x2f4f26)['then'](_0x546177=>{const _0x83f0e5=_0x4ce5a2;let {fullpath:_0x27cfc5,duration:_0x59a5d2}=_0x546177;fs[_0x83f0e5(0xd3)](_0x27cfc5,fs[_0x83f0e5(0xd5)][_0x83f0e5(0x13d)],_0x4f32d6=>{const _0x28ebf5=_0x83f0e5;if(_0x4f32d6)return _0x5a7aa3[_0x28ebf5(0xf6)][_0x28ebf5(0x143)](_0xfe3b1,_0xfe3b1['__'](_0x28ebf5(0xe0)));_0x5a7aa3[_0x28ebf5(0xf6)][_0x28ebf5(0xce)][_0x28ebf5(0x13a)](_0x28ebf5(0x159))[_0x28ebf5(0x118)](_0x481454,JSON[_0x28ebf5(0xd7)](_0x2f4f26),_0x5a7aa3[_0x28ebf5(0xe7)]['id']),process[_0x28ebf5(0x146)]({'type':_0x28ebf5(0xde),'playId':_0x481454,'args':_0x2f4f26,'action':'start'}),getM3U8(_0x2f4f26,_0x59a5d2,_0xfe3b1);});})[_0x4ce5a2(0x144)](_0x2ed6b1=>{const _0x16550f=_0x4ce5a2;console['log']('error',_0x2ed6b1),_0x5a7aa3['app'][_0x16550f(0x143)](_0xfe3b1,_0x2ed6b1);});}else{if(_0x5a7aa3['path'][_0x4ce5a2(0x124)](_0x4ce5a2(0xfd))){if(!hasPermission(_0x5a7aa3,_0xfe3b1,_0x2f4f26))return _0xfe3b1[_0x4ce5a2(0x15b)]({'code':0x66});transCodeUtil[_0x4ce5a2(0x123)](_0x5a7aa3['app'][_0x4ce5a2(0x111)],_0x5a7aa3['app'][_0x4ce5a2(0xce)],_0x2f4f26)[_0x4ce5a2(0x121)](_0x24f500=>{const _0x5b1b8e=_0x4ce5a2;let {fullpath:_0x1550b8,streamList:_0xac66a6,needDecrypt:_0x1741dd,pwd:_0x203681}=_0x24f500;fs[_0x5b1b8e(0xd3)](_0x1550b8,fs[_0x5b1b8e(0xd5)][_0x5b1b8e(0x13d)],_0x112cd0=>{const _0x281930=_0x5b1b8e;if(_0x112cd0)return _0x5a7aa3[_0x281930(0xf6)][_0x281930(0x143)](_0xfe3b1,_0xfe3b1['__'](_0x281930(0xe0)));MP4FfmpegTrans(_0x5a7aa3,_0xfe3b1,_0x1550b8,_0xac66a6,_0x1741dd,_0x203681);});})[_0x4ce5a2(0x144)](_0x3418e7=>{const _0x19bcff=_0x4ce5a2;console[_0x19bcff(0x139)](_0x19bcff(0x15d),_0x3418e7),_0x5a7aa3[_0x19bcff(0xf6)]['returnErrMsg'](_0xfe3b1,_0x3418e7);});}}}}),router[_0x16fc4b(0xc0)](_0x16fc4b(0x14f),(_0x28e43c,_0x16b07d,_0x4b5f32)=>{const _0x4f9878=_0x16fc4b;if(!_0x28e43c[_0x4f9878(0xe1)][_0x4f9878(0x12e)])return _0x16b07d[_0x4f9878(0xd9)](0x1f4);let _0x178614=fileUtil[_0x4f9878(0xc7)](_0x28e43c[_0x4f9878(0xe1)][_0x4f9878(0x12e)]),_0x17c31b={'code':0x0,'streams':[],'duration':0x0},_0x67168c=dbConfigTable[_0x4f9878(0x15c)](_0x28e43c[_0x4f9878(0xf6)][_0x4f9878(0xce)],_0x4f9878(0x115));_0x17c31b[_0x4f9878(0x115)]=_0x67168c?_0x67168c[_0x4f9878(0x120)]:_0x4f9878(0xf9),_0x178614=transCodeUtil[_0x4f9878(0x12b)](_0x178614),videoStreamUtil[_0x4f9878(0x13c)](_0x178614)[_0x4f9878(0x121)](_0x49fd37=>{const _0x25f163=_0x4f9878;_0x17c31b[_0x25f163(0xfa)]=_0x49fd37[_0x25f163(0xfa)],_0x17c31b['duration']=videoStreamUtil[_0x25f163(0xcf)](_0x49fd37),_0x16b07d['json'](_0x17c31b);})[_0x4f9878(0x144)](_0xfa6f76=>{const _0x2f5ba6=_0x4f9878;return console[_0x2f5ba6(0x139)](_0xfa6f76),_0x28e43c['app'][_0x2f5ba6(0x143)](_0x16b07d,_0xfa6f76);});});function getM3U8(_0x29be98,_0x425872,_0x5530d7){const _0x2dd0cf=_0x16fc4b;let _0x478c1f=Math[_0x2dd0cf(0xfb)](_0x425872/config[_0x2dd0cf(0xda)]),_0x3ed768=_0x425872-_0x478c1f*_0x425872;if(_0x3ed768>0x0){try{_0x3ed768=parseInt(_0x3ed768);}catch(_0x5a410f){console[_0x2dd0cf(0x139)](_0x5a410f);}_0x478c1f+=0x1;}let _0x63068b=_0x2dd0cf(0x157)+config[_0x2dd0cf(0xda)]+_0x2dd0cf(0x127)+_0x29be98[_0x2dd0cf(0x151)]+'\x0a';_0x29be98[_0x2dd0cf(0x151)]&&(segmentStartNum=parseInt(_0x29be98[_0x2dd0cf(0x151)]/config[_0x2dd0cf(0xda)]));for(let _0x2691c7=0x0;_0x2691c7<_0x478c1f;_0x2691c7++){let _0x2425e6=_0x2dd0cf(0x132)+(_0x2691c7==_0x478c1f-0x1&&_0x3ed768>0x0?_0x3ed768:config[_0x2dd0cf(0xda)])+_0x2dd0cf(0xc1)+_0x2691c7+_0x2dd0cf(0x10f)+_0x29be98[_0x2dd0cf(0x11a)]+_0x2dd0cf(0x129)+_0x29be98['token']+_0x2dd0cf(0xb8)+_0x2691c7;_0x29be98[_0x2dd0cf(0x11e)]&&(_0x2425e6+=_0x2dd0cf(0x102)+_0x29be98['size']),_0x29be98[_0x2dd0cf(0x114)]&&(_0x2425e6+=_0x2dd0cf(0x11b)+_0x29be98['videobit']),_0x29be98[_0x2dd0cf(0xf5)]&&(_0x2425e6+=_0x2dd0cf(0x141)+_0x29be98[_0x2dd0cf(0xf5)]),_0x29be98[_0x2dd0cf(0xe9)]&&(_0x2425e6+='&serverType='+_0x29be98[_0x2dd0cf(0xe9)]),_0x29be98[_0x2dd0cf(0xe6)]&&(_0x2425e6+=_0x2dd0cf(0x113)+_0x29be98[_0x2dd0cf(0xe6)]),_0x29be98[_0x2dd0cf(0x13f)]&&(_0x2425e6+=_0x2dd0cf(0x147)+_0x29be98[_0x2dd0cf(0x13f)]),_0x29be98['ac']&&(_0x2425e6+=_0x2dd0cf(0x108)+_0x29be98['ac']),_0x29be98['filePath']&&(_0x2425e6+=_0x2dd0cf(0x155)+_0x29be98['filePath']),_0x29be98[_0x2dd0cf(0xe3)]&&(_0x2425e6+=_0x2dd0cf(0xb9)+_0x29be98[_0x2dd0cf(0xe3)]),_0x29be98[_0x2dd0cf(0xc9)]&&(_0x2425e6+=_0x2dd0cf(0x14c)+_0x29be98[_0x2dd0cf(0xc9)]),_0x29be98['spaceIndexId']&&(_0x2425e6+=_0x2dd0cf(0x110)+_0x29be98['spaceIndexId']),_0x29be98[_0x2dd0cf(0x105)]&&(_0x2425e6+=_0x2dd0cf(0xef)+_0x29be98[_0x2dd0cf(0x105)]),_0x63068b+=_0x2425e6;}_0x63068b+=_0x2dd0cf(0x112),_0x5530d7[_0x2dd0cf(0xc2)](_0x2dd0cf(0x117),_0x2dd0cf(0x106));let _0x3f1742=new Date()[_0x2dd0cf(0xee)]()+'.m3u8';_0x5530d7[_0x2dd0cf(0xc2)](_0x2dd0cf(0x10a),_0x2dd0cf(0x11c)+_0x3f1742),_0x5530d7[_0x2dd0cf(0x146)](_0x63068b);}module['exports']=router;function _0x2b96(){const _0x17432f=['indexId','Router','&subtitleIndex=','getVideoBitrate','returnErrMsg','catch','addInputOption','send','&indexId=','EventEmitter','index\x20does\x20not\x20exist','8952003oencHs','sha256','&spaceToken=','doUserCanGet','events','/getVideoInfoByPath','sep','seek','outputOptions','killed','490778OsagUk','&filePath=','-map\x200:v:0?','#EXTM3U\x0a#EXT-X-PLAYLIST-TYPE:VOD\x20\x20\x20\x20\x20\x20\x20\x20\x0a#EXT-X-VERSION:3\x0a#EXT-X-TARGETDURATION:','-map\x200:a:','REPLACE\x20INTO\x20play_record(play_id,args,uid)\x20VALUES(?,?,?)','startsWith','json','findByTitle','error','1546832HWZDlS','output','../../db/dbConfigTable','videoBitrate','lastIndexOf','/play*','faidLoadSubtitle','../../myConfig/config','&seq=','&spaceId=','15zbQfnk','power_get','203XBgwMG','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?\x20and\x20ts_type=?','ts_name','-map\x200:s:','post','.0,\x0astream','setHeader','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?\x20and\x20ts_type=?\x20ORDER\x20BY\x20create_time\x20DESC','outputFormat','express','m3u8','decodePath','-sub_charenc\x20','spaceToken','../utils/fileUtils','gen','UTF-','inputOption','dbOther','getDurationFromStream','waiting','indexOf','FFmpeg','access','decoderCommand','constants','encoderName','stringify','8726424swuMEK','sendStatus','m3u8segmentDuration','webvtt','input','join','M3u8Transcode','end','cannotReadFile','body','字幕文件存在缓存','spaceId','seq','-movflags\x20frag_keyframe+empty_moov','audioIndex','currentUser','noContent','serverType','message','status','pipe','1469021vqBCWr','getTime','&burn=','stop','DELETE\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?','stat','all','../../db/dbUserTable','subtitleIndex','app','subtitlePath','DELETE\x20FROM\x20play_record\x20WHERE\x20play_id=?','chi','streams','floor','getById','mp4','close','115956LgShTA','aac','seekInput','&size=','../../utils/transCodeUtil','stype','burn','application/octet-stream','start','&ac=','path','Content-disposition','query','kill','895805VqGUHL','sendFile','.ts?playId=','&spaceIndexId=','dbFileIndex','\x0a#EXT-X-ENDLIST\x0a','&audioIndex=','videobit','moviePreferLanguage','jschardet','Content-type','run','decryptFileGetStream','playId','&videobit=','attachment;\x20filename=','index\x20no\x20permission','size','addOption','value','then','REPLACE\x20INTO\x20play_record_ts(play_id,ts_name,ts_type)\x20VALUES(?,?,?)','parseVideoFullPath','endsWith','audioCodec','DELETE\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_type=\x27waiting\x27',',\x0a#EXT-X-MEDIA-SEQUENCE:0\x0a#EXT-X-ALLOW-CACHE:YES\x0a#EXT-X-START:TIME-OFFSET=','/subtitle*','&token=','stream','dealFFmpegPath','.vtt','/stopPlay','filePath','.ts','encoding','format','\x0a#EXTINF:','get','noAudio','../../utils/videoStreamUtil','substring','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_type=?\x20ORDER\x20BY\x20create_time\x20DESC','replace','log','prepare','../utils/cryptoUtils','getVideoMeta','R_OK','m3u8TmpPath'];_0x2b96=function(){return _0x17432f;};return _0x2b96();}