function _0x35cc(_0x118d20,_0xe84bcc){const _0x243dd8=_0x243d();return _0x35cc=function(_0x35cc4b,_0x2a0543){_0x35cc4b=_0x35cc4b-0x1ea;let _0x50b607=_0x243dd8[_0x35cc4b];return _0x50b607;},_0x35cc(_0x118d20,_0xe84bcc);}const _0x5bb5cc=_0x35cc;(function(_0x165dd6,_0x2145b8){const _0xae0e76=_0x35cc,_0x76a8ba=_0x165dd6();while(!![]){try{const _0x3a8d63=-parseInt(_0xae0e76(0x208))/0x1+parseInt(_0xae0e76(0x278))/0x2*(parseInt(_0xae0e76(0x27a))/0x3)+-parseInt(_0xae0e76(0x219))/0x4*(parseInt(_0xae0e76(0x25a))/0x5)+parseInt(_0xae0e76(0x257))/0x6+-parseInt(_0xae0e76(0x242))/0x7+-parseInt(_0xae0e76(0x247))/0x8*(parseInt(_0xae0e76(0x22c))/0x9)+parseInt(_0xae0e76(0x1f7))/0xa*(parseInt(_0xae0e76(0x25d))/0xb);if(_0x3a8d63===_0x2145b8)break;else _0x76a8ba['push'](_0x76a8ba['shift']());}catch(_0x33fc68){_0x76a8ba['push'](_0x76a8ba['shift']());}}}(_0x243d,0xa4858));let express=require(_0x5bb5cc(0x253)),router=express['Router'](),path=require(_0x5bb5cc(0x258)),fs=require('fs'),transCodeUtil=require(_0x5bb5cc(0x20d)),fileUtil=require(_0x5bb5cc(0x245));const config=require(_0x5bb5cc(0x1f2));let videoStreamUtil=require(_0x5bb5cc(0x205)),FFmpeg=require('../../libs/nasTrans')['FFmpeg'],cryptoUtils=require(_0x5bb5cc(0x234)),sha256=require(_0x5bb5cc(0x229));require(_0x5bb5cc(0x252))[_0x5bb5cc(0x215)][_0x5bb5cc(0x269)]=0x0;const dbUserTable=require(_0x5bb5cc(0x23d)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbConfigTable=require(_0x5bb5cc(0x222));var jschardet=require(_0x5bb5cc(0x27d));function MP4FfmpegTrans(_0x522917,_0xcfa829,_0x5c9332,_0x42be19,_0x5d4a04,_0x214eeb){const _0x180a96=_0x5bb5cc;let _0x5c9a05=_0x522917['query'],_0x38453b=FFmpeg(),_0x35259c;if(_0x5d4a04)_0x35259c=cryptoUtils['decryptFileGetStream'](_0x214eeb,_0x5c9332);let _0x5ddd2a=_0x5d4a04?_0x35259c:_0x5c9332,{videoStream:_0x1e9a14,videoWidth:_0x1bab80,videoHeight:_0x4ec57d}=transCodeUtil[_0x180a96(0x27f)](_0x42be19);_0x38453b[_0x180a96(0x1f0)](transCodeUtil[_0x180a96(0x22e)](_0x5ddd2a));try{_0x38453b['on'](_0x180a96(0x22a),function(_0x4ab306){const _0x5d5d51=_0x180a96;console[_0x5d5d51(0x233)](_0x4ab306);}),_0x38453b['on']('error',function(_0x4490d2){const _0x390b58=_0x180a96;if(_0x4490d2[_0x390b58(0x248)]&&_0x4490d2[_0x390b58(0x248)][_0x390b58(0x23c)](_0x390b58(0x21c))==-0x1)_0x38453b[_0x390b58(0x28e)](),_0x38453b=null,_0xcfa829[_0x390b58(0x227)](0x1f4)['end']();else{}}),_0x38453b['on'](_0x180a96(0x202),function(_0x1f6817){const _0xb6eb13=_0x180a96;_0x38453b&&(_0x38453b[_0xb6eb13(0x28e)](),_0x38453b=null);if(_0xcfa829)_0xcfa829[_0xb6eb13(0x227)](0xc8)['end']();}),_0xcfa829['on'](_0x180a96(0x26b),function(){});let _0x234985=transCodeUtil[_0x180a96(0x26d)](_0x522917[_0x180a96(0x25b)][_0x180a96(0x209)],_0x1e9a14);_0x234985[_0x180a96(0x246)]&&_0x38453b[_0x180a96(0x21d)](_0x234985[_0x180a96(0x246)]);let _0xe395a3=_0x5c9a05[_0x180a96(0x255)]*config[_0x180a96(0x220)];_0xe395a3&&!_0x5d4a04&&_0x38453b[_0x180a96(0x263)](''+parseInt(_0xe395a3));_0x234985[_0x180a96(0x212)]&&_0x38453b[_0x180a96(0x236)](_0x234985['encoderName']);let _0x1abe81=transCodeUtil[_0x180a96(0x1ff)](_0x1e9a14,_0x5c9a05['videobit']);!_0x1abe81&&(_0x1abe81=0x1800),_0x38453b[_0x180a96(0x201)](''+_0x1abe81),_0x38453b['addOption'](_0x180a96(0x1fe)),_0x38453b[_0x180a96(0x1fc)]('-map\x200:a:'+(_0x5c9a05['audioIndex']?_0x5c9a05[_0x180a96(0x20b)]:0x0)+'?'),_0x38453b[_0x180a96(0x293)]('mp4'),_0x38453b[_0x180a96(0x1f9)](_0x180a96(0x1ef)),_0x38453b['outputOptions']([_0x180a96(0x20c)]),_0x38453b['outputFormat'](_0x180a96(0x273)),_0x38453b[_0x180a96(0x21e)](_0xcfa829,{'end':!![]});}catch(_0x448fdc){console[_0x180a96(0x233)](_0x448fdc),_0x38453b[_0x180a96(0x28e)](),_0xcfa829[_0x180a96(0x290)](0x1f4);}}router[_0x5bb5cc(0x1f3)](_0x5bb5cc(0x1f8),(_0x5a3f8c,_0x3f6591,_0x28b83b)=>{const _0x1b675f=_0x5bb5cc;let _0x37283e=_0x5a3f8c[_0x1b675f(0x274)]['playId']||_0x5a3f8c[_0x1b675f(0x232)][_0x1b675f(0x28d)];process['send']({'type':_0x1b675f(0x28b),'playId':_0x37283e,'action':_0x1b675f(0x279)});let _0x27599a=path[_0x1b675f(0x26f)](config[_0x1b675f(0x294)],_0x37283e);return fs['rm'](_0x27599a,{'recursive':!![],'force':!![],'maxRetries':0xa},_0x4fa0d8=>{const _0x1764ab=_0x1b675f;if(_0x4fa0d8)console[_0x1764ab(0x233)](_0x4fa0d8);}),_0x5a3f8c['app'][_0x1b675f(0x209)]['prepare'](_0x1b675f(0x266))[_0x1b675f(0x23a)](_0x5a3f8c[_0x1b675f(0x274)]['playId']),_0x3f6591['json']({'code':0x0});}),router['get'](_0x5bb5cc(0x1fd),(_0x2f37a6,_0xbd2857,_0x523f8d)=>{const _0x15d208=_0x5bb5cc;let _0x466afd=_0x2f37a6[_0x15d208(0x274)],_0x5c2ab3=_0x466afd[_0x15d208(0x224)],_0x3856cb=_0x466afd[_0x15d208(0x28c)];if(_0x3856cb&&_0x3856cb[_0x15d208(0x240)]>0x2){let _0x24681d=fileUtil['decodePath'](_0x3856cb);fs['access'](_0x24681d,fs['constants'][_0x15d208(0x223)],_0x302bd0=>{const _0x4eb4f4=_0x15d208;if(_0x302bd0)return _0x2f37a6[_0x4eb4f4(0x25b)][_0x4eb4f4(0x20a)](_0xbd2857,_0xbd2857['__'](_0x4eb4f4(0x225)));path[_0x4eb4f4(0x262)](_0x24681d)==_0x4eb4f4(0x1f1)&&_0xbd2857['sendFile'](_0x24681d),fs['readFile'](_0x24681d,(_0x50e40d,_0x32efdf)=>{const _0x1401de=_0x4eb4f4;if(_0x50e40d)return _0x2f37a6[_0x1401de(0x25b)][_0x1401de(0x20a)](_0xbd2857,_0xbd2857['__'](_0x1401de(0x225)));try{let _0x5e0b4c=jschardet[_0x1401de(0x277)](_0x32efdf);!_0x5e0b4c['encoding'][_0x1401de(0x24c)](_0x1401de(0x27e))&&_0x5e0b4c[_0x1401de(0x221)]>0.95?_0xa6a593(_0x5e0b4c['encoding']):_0xa6a593();}catch(_0x30b1be){console['log'](_0x30b1be),_0xa6a593();}function _0xa6a593(_0x3eb924){const _0x21e64e=_0x1401de;let _0x54127d=FFmpeg();_0x54127d[_0x21e64e(0x1f0)](transCodeUtil[_0x21e64e(0x22e)](_0x24681d))[_0x21e64e(0x1f5)]()['noVideo']()[_0x21e64e(0x204)](_0x21e64e(0x292)),_0x3eb924&&_0x54127d[_0x21e64e(0x244)](_0x21e64e(0x1ea)+_0x3eb924),_0x54127d['on'](_0x21e64e(0x22a),function(_0x291f74){const _0x15adce=_0x21e64e;console[_0x15adce(0x233)](_0x291f74);})['on'](_0x21e64e(0x286),function(_0x3057d2){const _0xbe43e2=_0x21e64e;_0x54127d[_0xbe43e2(0x28e)]();})['on'](_0x21e64e(0x202),function(){_0x54127d['kill']();})[_0x21e64e(0x21e)](_0xbd2857);}});});}else{let _0x3e04fb=_0x466afd[_0x15d208(0x267)];transCodeUtil['parseVideoFullPath'](_0x2f37a6[_0x15d208(0x25b)]['dbFileIndex'],_0x2f37a6['app'][_0x15d208(0x209)],_0x466afd)['then'](_0xb1e84c=>{const _0xb35b7b=_0x15d208;let {fullpath:_0x39ec93,needDecrypt:_0x32f217,pwd:_0x519c94,streamList:_0x37fdfc}=_0xb1e84c;fs['access'](_0x39ec93,fs[_0xb35b7b(0x24d)]['R_OK'],_0x5458e9=>{const _0x4a6a8f=_0xb35b7b;if(_0x5458e9)return _0x2f37a6[_0x4a6a8f(0x25b)][_0x4a6a8f(0x20a)](_0xbd2857,_0xbd2857['__'](_0x4a6a8f(0x225)));if(!_0x3e04fb)_0x3e04fb=_0x4a6a8f(0x241);let _0x8eba5d=path[_0x4a6a8f(0x26f)](config[_0x4a6a8f(0x250)],sha256(_0x39ec93+_0x5c2ab3)+'.'+_0x3e04fb);fs[_0x4a6a8f(0x206)](_0x8eba5d,(_0x12a769,_0x28d583)=>{const _0x377a72=_0x4a6a8f;if(_0x12a769||_0x28d583[_0x377a72(0x28f)]<0x3e8){console['log'](_0x377a72(0x275),_0x8eba5d);let _0x3eac14=_0x32f217?cryptoUtils['decryptFileGetStream'](_0x519c94,_0x39ec93):_0x39ec93,_0x56a316=FFmpeg({'timeout':0x258});_0x56a316['input'](transCodeUtil[_0x377a72(0x22e)](_0x3eac14))[_0x377a72(0x1f5)]()[_0x377a72(0x27c)]()[_0x377a72(0x25f)](['-map\x200:s:'+_0x5c2ab3])[_0x377a72(0x25c)](_0x8eba5d)['on'](_0x377a72(0x22a),function(_0x31246f){const _0x3ec4a8=_0x377a72;console[_0x3ec4a8(0x233)](_0x31246f);})['on'](_0x377a72(0x286),function(_0x59d124){const _0x38dfc0=_0x377a72;console[_0x38dfc0(0x233)](_0x59d124),_0x56a316[_0x38dfc0(0x28e)](),fs['rm'](_0x8eba5d,_0x342e35=>{}),_0x2f37a6[_0x38dfc0(0x25b)][_0x38dfc0(0x20a)](_0xbd2857,_0xbd2857['__']('faidLoadSubtitle'));})['on'](_0x377a72(0x202),function(){const _0x894fbb=_0x377a72;return _0x56a316['kill'](),_0x466afd[_0x894fbb(0x284)]?_0xbd2857[_0x894fbb(0x259)]({'code':0x0}):_0xbd2857[_0x894fbb(0x26c)](_0x8eba5d);}),_0x56a316['run'](),_0xbd2857['on'](_0x377a72(0x26b),function(){const _0x586198=_0x377a72;_0x56a316[_0x586198(0x28e)]();});}else{console[_0x377a72(0x233)](_0x377a72(0x243),_0x8eba5d);if(_0x466afd[_0x377a72(0x284)])return _0xbd2857[_0x377a72(0x259)]({'code':0x0});return _0xbd2857[_0x377a72(0x26c)](_0x8eba5d);}});});})[_0x15d208(0x1ec)](_0x335e98=>{const _0x398ad6=_0x15d208;console[_0x398ad6(0x233)](_0x335e98),_0x2f37a6[_0x398ad6(0x25b)][_0x398ad6(0x20a)](_0xbd2857,_0x335e98);});}});function sendTsFile(_0x47da85,_0x495715,_0x217fff,_0x196f11,_0xc7cb45,_0x27b961=0x1){const _0x278c41=_0x5bb5cc;if(_0x27b961>0x28)return;let _0xa48ec9=_0x217fff[_0x278c41(0x28d)];if(!_0xa48ec9)return;let _0xb56f34=_0x47da85['app']['dbOther']['prepare'](_0x278c41(0x218))[_0x278c41(0x200)](_0xa48ec9,_0xc7cb45,_0x278c41(0x1ed));if(_0xb56f34)fs[_0x278c41(0x206)](_0x196f11,(_0x295055,_0x12e4c2)=>{const _0x2ec58b=_0x278c41;_0x295055?(_0x47da85['app'][_0x2ec58b(0x209)][_0x2ec58b(0x254)]('DELETE\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?')[_0x2ec58b(0x23a)](_0xa48ec9,_0xc7cb45),sendTsFile(_0x47da85,_0x495715,_0x217fff,_0x196f11,_0xc7cb45,_0x27b961+0x1)):(_0x47da85[_0x2ec58b(0x25b)][_0x2ec58b(0x209)]['prepare'](_0x2ec58b(0x24e))[_0x2ec58b(0x23a)](_0xa48ec9),_0x495715['sendFile'](_0x196f11));});else{function _0x5815f4(){let _0x2d5209=setTimeout(()=>{clearTimeout(_0x2d5209),sendTsFile(_0x47da85,_0x495715,_0x217fff,_0x196f11,_0xc7cb45,_0x27b961+0x1);},0x1f4);_0x495715['on']('close',()=>clearTimeout(_0x2d5209));}let _0x46bdac=_0x47da85[_0x278c41(0x25b)][_0x278c41(0x209)]['prepare']('SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_type=?\x20ORDER\x20BY\x20create_time\x20DESC')[_0x278c41(0x200)](_0xa48ec9,_0x278c41(0x1ed));if(!_0x46bdac)return _0x5815f4();else{let _0x5f2ce0=_0x47da85[_0x278c41(0x25b)][_0x278c41(0x209)][_0x278c41(0x254)](_0x278c41(0x283))[_0x278c41(0x200)](_0xa48ec9,_0xc7cb45,_0x278c41(0x207));if(_0x5f2ce0)return _0x5815f4();else{let _0x3ef390=parseInt(_0x46bdac[_0x278c41(0x260)]['replace']('stream','')['replace'](_0x278c41(0x203),''));return _0x217fff['seq']>_0x3ef390+0xf||_0x217fff[_0x278c41(0x255)]<_0x3ef390?(process[_0x278c41(0x1f4)]({'type':_0x278c41(0x28b),'playId':_0xa48ec9,'action':_0x278c41(0x279)}),process[_0x278c41(0x1f4)]({'type':_0x278c41(0x28b),'playId':_0xa48ec9,'args':_0x217fff,'action':_0x278c41(0x22a)}),_0x47da85[_0x278c41(0x25b)][_0x278c41(0x209)]['prepare']('REPLACE\x20INTO\x20play_record_ts(play_id,ts_name,ts_type)\x20VALUES(?,?,?)')[_0x278c41(0x23a)](_0xa48ec9,_0xc7cb45,_0x278c41(0x207)),_0x5815f4()):_0x5815f4();}}}}function _0x243d(){const _0x502b4e=['seek','m3u8','mp4','query','生成字幕文件','&spaceIndexId=','detect','801544KghQlJ','stop','9qCZRnm','indexId','noVideo','jschardet','UTF-','parseStreamList','#EXTM3U\x0a#EXT-X-PLAYLIST-TYPE:VOD\x20\x20\x20\x20\x20\x20\x20\x20\x0a#EXT-X-VERSION:3\x0a#EXT-X-TARGETDURATION:','.m3u8',',\x0a#EXT-X-MEDIA-SEQUENCE:0\x0a#EXT-X-ALLOW-CACHE:YES\x0a#EXT-X-START:TIME-OFFSET=','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?\x20and\x20ts_type=?','noContent','decodePath','error','parseVideoFullPath','then','attachment;\x20filename=','spaceIndexId','M3u8Transcode','subtitleFile','playId','kill','size','sendStatus','videobit','webvtt','outputFormat','m3u8TmpPath','-sub_charenc\x20','token','catch','gen','duration','aac','input','.vtt','../../myConfig/config','all','send','noAudio','/play*','10SibeZo','/stopPlay','audioCodec','&videobit=','value','addOption','/subtitle*','-map\x200:v:0?','getVideoBitrate','get','videoBitrate','end','.ts','format','../../utils/videoStreamUtil','stat','waiting','761252cCuyAG','dbOther','returnErrMsg','audioIndex','-movflags\x20frag_keyframe+empty_moov','../../utils/transCodeUtil','need\x20play\x20id','&spaceToken=','&subtitleIndex=','getVideoMeta','encoderName','Content-disposition','filePath','EventEmitter','getDurationFromStream','spaceToken','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?\x20and\x20ts_type=?\x20ORDER\x20BY\x20create_time\x20DESC','52WtOCpe','currentUser','getById','killed','addInputOption','pipe','&filePath=','m3u8segmentDuration','confidence','../../db/dbConfigTable','R_OK','subtitleIndex','cannotReadFile','getIndexTableNameByType','status','burn','sha256','start','\x0a#EXTINF:','344214AIxEBM','application/octet-stream','dealFFmpegPath','endsWith','&indexId=','substring','body','log','../utils/cryptoUtils','chi','videoCodec','power_get','&burn=','&audioIndex=','run','spaceId','indexOf','../../db/dbUserTable','REPLACE\x20INTO\x20play_record(play_id,args,uid)\x20VALUES(?,?,?)','index\x20no\x20permission','length','vtt','4562670Oppzgx','字幕文件存在缓存','inputOption','../utils/fileUtils','decoderCommand','280KTmIgI','message','dbFileIndex','&spaceId=','stringify','startsWith','constants','DELETE\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_type=\x27waiting\x27','lastIndexOf','subtitlePath','floor','events','express','prepare','seq','streams','6844482xPXMnn','path','json','219430QAwjkK','app','output','18183077vCvzav','serverType','outputOptions','ts_name','filename','extname','seekInput','&seq=','&size=','DELETE\x20FROM\x20play_record\x20WHERE\x20play_id=?','stype','moviePreferLanguage','defaultMaxListeners','getTime','close','sendFile','getCoderConfig','setHeader','join','sep'];_0x243d=function(){return _0x502b4e;};return _0x243d();}function hasPermission(_0x484114,_0x2ee4bf,_0x359147){const _0x578a15=_0x5bb5cc;if(_0x359147[_0x578a15(0x27b)]&&!_0x359147[_0x578a15(0x23b)]){let _0x540fd4=dbFileIndexTable[_0x578a15(0x226)](_0x359147[_0x578a15(0x25e)]),_0x156fd1=dbFileIndexTable[_0x578a15(0x21b)](_0x484114[_0x578a15(0x25b)]['dbFileIndex'],_0x359147[_0x578a15(0x27b)],_0x540fd4);if(!_0x156fd1)return reject('index\x20does\x20not\x20exist');let _0x4837a2=_0x156fd1[_0x578a15(0x258)]+path[_0x578a15(0x270)]+_0x156fd1[_0x578a15(0x261)];if(dbUserTable['doUserCanGet'](_0x484114,_0x2ee4bf,_0x359147['serverType'],_0x578a15(0x237),_0x4837a2,!![])!==!![])return console['log'](_0x578a15(0x23f)),![];return!![];}else{if(_0x359147['filePath']&&!_0x359147[_0x578a15(0x23b)]){let _0x357c0d=fileUtil[_0x578a15(0x285)](_0x359147[_0x578a15(0x214)]);if(dbUserTable['doUserCanGet'](_0x484114,_0x2ee4bf,'',_0x578a15(0x237),_0x357c0d,!![])!==!![])return console[_0x578a15(0x233)](_0x578a15(0x23f)),![];return!![];}else return![];}}router[_0x5bb5cc(0x200)](_0x5bb5cc(0x1f6),(_0x299d11,_0x22a2f6,_0x29b150)=>{const _0x60bab3=_0x5bb5cc;let _0x1ea553=_0x299d11['query'];if(_0x299d11['path'][_0x60bab3(0x22f)]('ts')){let _0x733273=_0x299d11[_0x60bab3(0x258)][_0x60bab3(0x231)](_0x299d11['path'][_0x60bab3(0x24f)]('/')+0x1),_0x2c1e52=_0x1ea553['playId'],_0x5bca14=path['join'](config['m3u8TmpPath'],_0x2c1e52,_0x733273),_0x5b134a=_0x299d11[_0x60bab3(0x25b)]['dbOther'][_0x60bab3(0x254)]('SELECT\x20*\x20FROM\x20play_record\x20WHERE\x20play_id=?')[_0x60bab3(0x200)](_0x2c1e52);!_0x5b134a&&(_0x1ea553[_0x60bab3(0x271)]=_0x1ea553[_0x60bab3(0x255)]*config[_0x60bab3(0x220)],_0x299d11[_0x60bab3(0x25b)]['dbOther']['prepare'](_0x60bab3(0x23e))[_0x60bab3(0x23a)](_0x2c1e52,JSON['stringify'](_0x1ea553),_0x299d11[_0x60bab3(0x21a)]['id']));if(!hasPermission(_0x299d11,_0x22a2f6,_0x1ea553))return _0x22a2f6[_0x60bab3(0x259)]({'code':0x66});return process['send']({'type':_0x60bab3(0x28b),'playId':_0x2c1e52,'args':_0x1ea553,'action':_0x60bab3(0x22a)}),sendTsFile(_0x299d11,_0x22a2f6,_0x1ea553,_0x5bca14,_0x733273);}else{if(_0x299d11['path'][_0x60bab3(0x22f)](_0x60bab3(0x272))){let _0x310692=_0x1ea553[_0x60bab3(0x28d)];if(!_0x310692)return _0x299d11[_0x60bab3(0x25b)][_0x60bab3(0x20a)](_0x22a2f6,_0x60bab3(0x20e));if(!hasPermission(_0x299d11,_0x22a2f6,_0x1ea553))return _0x22a2f6[_0x60bab3(0x259)]({'code':0x66});transCodeUtil[_0x60bab3(0x287)](_0x299d11[_0x60bab3(0x25b)]['dbFileIndex'],_0x299d11[_0x60bab3(0x25b)][_0x60bab3(0x209)],_0x1ea553)[_0x60bab3(0x288)](_0x119e28=>{const _0x18c5fe=_0x60bab3;let {fullpath:_0x3830e7,duration:_0x19432c}=_0x119e28;fs['access'](_0x3830e7,fs[_0x18c5fe(0x24d)][_0x18c5fe(0x223)],_0x58d497=>{const _0x95488=_0x18c5fe;if(_0x58d497)return _0x299d11[_0x95488(0x25b)]['returnErrMsg'](_0x22a2f6,_0x22a2f6['__'](_0x95488(0x225)));_0x299d11[_0x95488(0x25b)][_0x95488(0x209)][_0x95488(0x254)]('REPLACE\x20INTO\x20play_record(play_id,args,uid)\x20VALUES(?,?,?)')[_0x95488(0x23a)](_0x310692,JSON[_0x95488(0x24b)](_0x1ea553),_0x299d11[_0x95488(0x21a)]['id']),process['send']({'type':_0x95488(0x28b),'playId':_0x310692,'args':_0x1ea553,'action':'start'}),getM3U8(_0x1ea553,_0x19432c,_0x22a2f6);});})[_0x60bab3(0x1ec)](_0x17d4db=>{const _0xebb5c4=_0x60bab3;console[_0xebb5c4(0x233)](_0xebb5c4(0x286),_0x17d4db),_0x299d11[_0xebb5c4(0x25b)][_0xebb5c4(0x20a)](_0x22a2f6,_0x17d4db);});}else{if(_0x299d11[_0x60bab3(0x258)][_0x60bab3(0x22f)](_0x60bab3(0x273))){if(!hasPermission(_0x299d11,_0x22a2f6,_0x1ea553))return _0x22a2f6['json']({'code':0x66});transCodeUtil[_0x60bab3(0x287)](_0x299d11[_0x60bab3(0x25b)][_0x60bab3(0x249)],_0x299d11[_0x60bab3(0x25b)][_0x60bab3(0x209)],_0x1ea553)['then'](_0x1eeda0=>{const _0x2358fe=_0x60bab3;let {fullpath:_0x21f6c9,streamList:_0x46117d,needDecrypt:_0x22e33f,pwd:_0x320dc6}=_0x1eeda0;fs['access'](_0x21f6c9,fs[_0x2358fe(0x24d)][_0x2358fe(0x223)],_0x4f42cf=>{const _0x2d1643=_0x2358fe;if(_0x4f42cf)return _0x299d11[_0x2d1643(0x25b)]['returnErrMsg'](_0x22a2f6,_0x22a2f6['__'](_0x2d1643(0x225)));MP4FfmpegTrans(_0x299d11,_0x22a2f6,_0x21f6c9,_0x46117d,_0x22e33f,_0x320dc6);});})['catch'](_0x33adca=>{const _0x34151f=_0x60bab3;console['log'](_0x34151f(0x286),_0x33adca),_0x299d11[_0x34151f(0x25b)][_0x34151f(0x20a)](_0x22a2f6,_0x33adca);});}}}}),router['post']('/getVideoInfoByPath',(_0x395856,_0x756f5b,_0x1d35f4)=>{const _0x443d82=_0x5bb5cc;if(!_0x395856[_0x443d82(0x232)][_0x443d82(0x214)])return _0x756f5b[_0x443d82(0x290)](0x1f4);let _0x3f1cef=fileUtil[_0x443d82(0x285)](_0x395856[_0x443d82(0x232)][_0x443d82(0x214)]),_0x1eab2c={'code':0x0,'streams':[],'duration':0x0},_0x3bb803=dbConfigTable['findByTitle'](_0x395856[_0x443d82(0x25b)][_0x443d82(0x209)],_0x443d82(0x268));_0x1eab2c[_0x443d82(0x268)]=_0x3bb803?_0x3bb803[_0x443d82(0x1fb)]:_0x443d82(0x235),_0x3f1cef=transCodeUtil['dealFFmpegPath'](_0x3f1cef),videoStreamUtil[_0x443d82(0x211)](_0x3f1cef)[_0x443d82(0x288)](_0x146919=>{const _0x736fa8=_0x443d82;_0x1eab2c['streams']=_0x146919[_0x736fa8(0x256)],_0x1eab2c[_0x736fa8(0x1ee)]=videoStreamUtil[_0x736fa8(0x216)](_0x146919),_0x756f5b[_0x736fa8(0x259)](_0x1eab2c);})[_0x443d82(0x1ec)](_0x13f707=>{const _0x152c3e=_0x443d82;return console[_0x152c3e(0x233)](_0x13f707),_0x395856['app'][_0x152c3e(0x20a)](_0x756f5b,_0x13f707);});});function getM3U8(_0x2d3ee5,_0x1c6084,_0xe7b402){const _0x514b18=_0x5bb5cc;let _0x27c19c=Math[_0x514b18(0x251)](_0x1c6084/config[_0x514b18(0x220)]),_0x4223f4=_0x1c6084-_0x27c19c*_0x1c6084;if(_0x4223f4>0x0){try{_0x4223f4=parseInt(_0x4223f4);}catch(_0x3433c9){console[_0x514b18(0x233)](_0x3433c9);}_0x27c19c+=0x1;}let _0x38a990=_0x514b18(0x280)+config[_0x514b18(0x220)]+_0x514b18(0x282)+_0x2d3ee5[_0x514b18(0x271)]+'\x0a';_0x2d3ee5[_0x514b18(0x271)]&&(segmentStartNum=parseInt(_0x2d3ee5[_0x514b18(0x271)]/config[_0x514b18(0x220)]));for(let _0x50ba8b=0x0;_0x50ba8b<_0x27c19c;_0x50ba8b++){let _0x1c187b=_0x514b18(0x22b)+(_0x50ba8b==_0x27c19c-0x1&&_0x4223f4>0x0?_0x4223f4:config[_0x514b18(0x220)])+'.0,\x0astream'+_0x50ba8b+'.ts?playId='+_0x2d3ee5[_0x514b18(0x28d)]+'&token='+_0x2d3ee5[_0x514b18(0x1eb)]+_0x514b18(0x264)+_0x50ba8b;_0x2d3ee5[_0x514b18(0x28f)]&&(_0x1c187b+=_0x514b18(0x265)+_0x2d3ee5[_0x514b18(0x28f)]),_0x2d3ee5[_0x514b18(0x291)]&&(_0x1c187b+=_0x514b18(0x1fa)+_0x2d3ee5[_0x514b18(0x291)]),_0x2d3ee5['subtitleIndex']&&(_0x1c187b+=_0x514b18(0x210)+_0x2d3ee5['subtitleIndex']),_0x2d3ee5['serverType']&&(_0x1c187b+='&serverType='+_0x2d3ee5[_0x514b18(0x25e)]),_0x2d3ee5[_0x514b18(0x20b)]&&(_0x1c187b+=_0x514b18(0x239)+_0x2d3ee5[_0x514b18(0x20b)]),_0x2d3ee5[_0x514b18(0x27b)]&&(_0x1c187b+=_0x514b18(0x230)+_0x2d3ee5[_0x514b18(0x27b)]),_0x2d3ee5['ac']&&(_0x1c187b+='&ac='+_0x2d3ee5['ac']),_0x2d3ee5[_0x514b18(0x214)]&&(_0x1c187b+=_0x514b18(0x21f)+_0x2d3ee5[_0x514b18(0x214)]),_0x2d3ee5[_0x514b18(0x23b)]&&(_0x1c187b+=_0x514b18(0x24a)+_0x2d3ee5[_0x514b18(0x23b)]),_0x2d3ee5['spaceToken']&&(_0x1c187b+=_0x514b18(0x20f)+_0x2d3ee5[_0x514b18(0x217)]),_0x2d3ee5[_0x514b18(0x28a)]&&(_0x1c187b+=_0x514b18(0x276)+_0x2d3ee5[_0x514b18(0x28a)]),_0x2d3ee5[_0x514b18(0x228)]&&(_0x1c187b+=_0x514b18(0x238)+_0x2d3ee5[_0x514b18(0x228)]),_0x38a990+=_0x1c187b;}_0x38a990+='\x0a#EXT-X-ENDLIST\x0a',_0xe7b402['setHeader']('Content-type',_0x514b18(0x22d));let _0x4cc26f=new Date()[_0x514b18(0x26a)]()+_0x514b18(0x281);_0xe7b402[_0x514b18(0x26e)](_0x514b18(0x213),_0x514b18(0x289)+_0x4cc26f),_0xe7b402[_0x514b18(0x1f4)](_0x38a990);}module['exports']=router;