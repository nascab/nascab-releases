const _0x3ed520=_0x37c5;(function(_0x5f2691,_0x471d3c){const _0x281506=_0x37c5,_0x2a8750=_0x5f2691();while(!![]){try{const _0xdf9005=-parseInt(_0x281506(0x95))/0x1*(parseInt(_0x281506(0x98))/0x2)+parseInt(_0x281506(0x8b))/0x3+parseInt(_0x281506(0x85))/0x4+parseInt(_0x281506(0x73))/0x5+parseInt(_0x281506(0xaa))/0x6*(-parseInt(_0x281506(0x6e))/0x7)+parseInt(_0x281506(0x74))/0x8*(parseInt(_0x281506(0xad))/0x9)+-parseInt(_0x281506(0x7a))/0xa*(parseInt(_0x281506(0x8f))/0xb);if(_0xdf9005===_0x471d3c)break;else _0x2a8750['push'](_0x2a8750['shift']());}catch(_0x2903c6){_0x2a8750['push'](_0x2a8750['shift']());}}}(_0x2ec8,0xb216b));var express=require('express'),router=express[_0x3ed520(0xb0)]();let path=require('path'),fs=require('fs');const dbBackupTask=require('../../db/dbBackupTask');let moment=require('moment');function _0x37c5(_0x5c180a,_0x7b34b0){const _0x2ec8c3=_0x2ec8();return _0x37c5=function(_0x37c54d,_0x23d440){_0x37c54d=_0x37c54d-0x67;let _0x134301=_0x2ec8c3[_0x37c54d];return _0x134301;},_0x37c5(_0x5c180a,_0x7b34b0);}router[_0x3ed520(0x78)](_0x3ed520(0xb3),(_0x3a56bc,_0x54dd6a,_0xff0f9c)=>{const _0x6efd62=_0x3ed520;if(_0x3a56bc['currentUser']['is_admin']!=0x1)return _0x54dd6a[_0x6efd62(0x88)]({'code':0x66});let _0x263839=_0x3a56bc['body']['type'],_0x30c8b8=_0x3a56bc[_0x6efd62(0xb5)][_0x6efd62(0x9f)],_0x5b1aeb=_0x3a56bc['body'][_0x6efd62(0x91)],_0x5e8c85=_0x3a56bc[_0x6efd62(0xb5)][_0x6efd62(0xab)],_0x5ac605=path['join'](_0x3a56bc[_0x6efd62(0xb5)][_0x6efd62(0x81)]),_0x5e2640=_0x3a56bc[_0x6efd62(0xb5)][_0x6efd62(0x67)],_0x473280=_0x3a56bc['body'][_0x6efd62(0xa1)],_0x19aa99=_0x3a56bc[_0x6efd62(0xb5)][_0x6efd62(0x90)];if(/^\w\:\\$/[_0x6efd62(0x7e)](_0x5ac605))return _0x3a56bc['app']['returnErrMsg'](_0x54dd6a,_0x54dd6a['__']('cannotUseRootPathAsBackupTarget'),'dialog');let _0x2f017c=0x0;for(let _0x49ab9a in _0x5b1aeb){_0x5b1aeb[_0x49ab9a]=path['join'](_0x5b1aeb[_0x49ab9a]);if(/^\w\:\\$/[_0x6efd62(0x7e)](_0x5b1aeb[_0x49ab9a]))return _0x3a56bc[_0x6efd62(0xa2)][_0x6efd62(0x99)](_0x54dd6a,_0x54dd6a['__'](_0x6efd62(0x87)),_0x6efd62(0x70));fs[_0x6efd62(0x83)](_0x5b1aeb[_0x49ab9a],fs[_0x6efd62(0x6b)]['R_OK'],_0x103eff=>{const _0x46f6d2=_0x6efd62;if(_0x103eff)return _0x3a56bc['app']['returnErrMsg'](_0x54dd6a,_0x54dd6a['__'](_0x46f6d2(0x79))+':'+_0x5b1aeb[_0x49ab9a]);_0x2f017c+=0x1,_0x2f017c==_0x5b1aeb['length']&&_0x548a91();});}function _0x548a91(){const _0x1a8ffb=_0x6efd62;fs[_0x1a8ffb(0x83)](_0x5ac605,fs[_0x1a8ffb(0x6b)][_0x1a8ffb(0xa0)]|fs[_0x1a8ffb(0x6b)][_0x1a8ffb(0x9e)],_0x30d298=>{const _0x46c5d1=_0x1a8ffb;if(_0x30d298)return console[_0x46c5d1(0xa7)](_0x30d298),_0x3a56bc[_0x46c5d1(0xa2)][_0x46c5d1(0x99)](_0x54dd6a,_0x54dd6a['__'](_0x46c5d1(0x6c))+':'+_0x5ac605);fs[_0x46c5d1(0x76)](_0x5ac605,(_0x38fa9c,_0x4cac61)=>{const _0x38af49=_0x46c5d1;if(_0x38fa9c||!_0x4cac61[_0x38af49(0x9a)]())return _0x3a56bc[_0x38af49(0xa2)]['returnErrMsg'](_0x54dd6a,_0x54dd6a['__']('noGetFolderStat'));let _0x103814={'task_name':_0x30c8b8,'source_list':JSON[_0x38af49(0x8d)](_0x5b1aeb),'exclude_list':JSON[_0x38af49(0x8d)](_0x5e8c85),'target_path':_0x5ac605,'task_type':_0x5e2640,'task_day':_0x473280,'task_time':_0x19aa99};if(_0x263839==_0x38af49(0xa4))dbBackupTask['create'](_0x3a56bc['app'][_0x38af49(0x8a)],_0x103814);else{if(_0x263839==_0x38af49(0x8e)){let _0x90295b=_0x3a56bc['body']['id'];dbBackupTask[_0x38af49(0x8e)](_0x3a56bc[_0x38af49(0xa2)][_0x38af49(0x8a)],_0x103814,_0x90295b);}}return process[_0x38af49(0x84)]({'type':_0x38af49(0x68)}),_0x54dd6a['json']({'code':0x0});});});}}),router[_0x3ed520(0x78)](_0x3ed520(0xb4),(_0x13df5c,_0x5b8ea4,_0x53afae)=>{const _0x51fb22=_0x3ed520;if(_0x13df5c['currentUser'][_0x51fb22(0x80)]!=0x1)return _0x5b8ea4['json']({'code':0x66});let _0x1b394e=_0x13df5c['body']['id'];dbBackupTask[_0x51fb22(0x97)](_0x13df5c[_0x51fb22(0xa2)][_0x51fb22(0x8a)],_0x1b394e),process['send']({'type':_0x51fb22(0x68)}),_0x5b8ea4['json']({'code':0x0});}),router[_0x3ed520(0x78)](_0x3ed520(0xb1),(_0x45e268,_0x2b0f50,_0x43d1b9)=>{const _0x472468=_0x3ed520;if(_0x45e268[_0x472468(0x89)][_0x472468(0x80)]!=0x1)return _0x2b0f50[_0x472468(0x88)]({'code':0x66});let _0x170931=_0x45e268[_0x472468(0xb5)]['type'],_0x2b749d=_0x45e268[_0x472468(0xb5)]['taskId'],_0x5202f4=dbBackupTask[_0x472468(0x77)](_0x45e268[_0x472468(0xa2)][_0x472468(0x8a)],_0x2b749d);if(!_0x5202f4)return _0x2b0f50[_0x472468(0x88)]({'code':0x1,'message':_0x472468(0x75)});if(_0x170931==_0x472468(0x96)){let _0x4831bc=dbBackupTask['getRecordByWhere'](_0x45e268[_0x472468(0xa2)][_0x472468(0x8a)],_0x472468(0x93),[_0x2b749d]);if(_0x4831bc){if(_0x4831bc['status']==_0x472468(0x9d))return _0x2b0f50[_0x472468(0x88)]({'code':0x1,'message':_0x2b0f50['__'](_0x472468(0x71)),'task_record':_0x4831bc});else{if(_0x4831bc[_0x472468(0x9c)]=='running')return _0x2b0f50['json']({'code':0x1,'message':_0x2b0f50['__'](_0x472468(0x72)),'task_record':_0x4831bc});else _0x4831bc[_0x472468(0x9c)]=='stop'&&dbBackupTask['updateRecord'](_0x45e268[_0x472468(0xa2)][_0x472468(0x8a)],_0x4831bc['id'],_0x472468(0xae));}}else{let _0x3eeaee=moment()[_0x472468(0x86)](_0x472468(0x7d));dbBackupTask[_0x472468(0x69)](_0x45e268['app']['dbOther'],_0x2b749d,_0x472468(0x9d),_0x3eeaee);}}else{if(_0x170931==_0x472468(0x7c)){let _0x4de0b9=dbBackupTask[_0x472468(0xa3)](_0x45e268['app'][_0x472468(0x8a)],'\x20task_id=?\x20and\x20status=\x27running\x27',[_0x2b749d]);if(!_0x4de0b9)return _0x2b0f50[_0x472468(0x88)]({'code':0x1,'message':_0x2b0f50['__'](_0x472468(0x82)),'task_record':_0x4de0b9});else dbBackupTask[_0x472468(0x6a)](_0x45e268[_0x472468(0xa2)][_0x472468(0x8a)],_0x4de0b9['id'],_0x472468(0xaf));}}process[_0x472468(0x84)]({'type':_0x472468(0x68)}),_0x2b0f50[_0x472468(0x88)]({'code':0x0});}),router[_0x3ed520(0x78)]('/getAllTask',(_0x1b63f1,_0x4b6106,_0x1c2740)=>{const _0x117d94=_0x3ed520;if(_0x1b63f1[_0x117d94(0x89)][_0x117d94(0x80)]!=0x1)return _0x4b6106['json']({'code':0x66});let _0x4afb25=_0x1b63f1[_0x117d94(0xb5)][_0x117d94(0x67)],_0x40e0f7=[];_0x4afb25=parseInt(_0x4afb25);_0x4afb25?_0x40e0f7=dbBackupTask[_0x117d94(0xac)](_0x1b63f1['app']['dbOther'],_0x4afb25):_0x40e0f7=dbBackupTask[_0x117d94(0xa5)](_0x1b63f1[_0x117d94(0xa2)]['dbOther']);for(let _0x445f40 in _0x40e0f7){let _0x16de2c=dbBackupTask[_0x117d94(0xa3)](_0x1b63f1[_0x117d94(0xa2)][_0x117d94(0x8a)],_0x117d94(0xa8),[_0x40e0f7[_0x445f40]['id']]);_0x40e0f7[_0x445f40][_0x117d94(0x9b)]=_0x16de2c;}_0x4b6106[_0x117d94(0x88)]({'code':0x0,'data':_0x40e0f7});}),router[_0x3ed520(0x78)](_0x3ed520(0x8c),(_0x44bfac,_0x3028d9,_0x32e767)=>{const _0x4f0212=_0x3ed520;if(_0x44bfac['currentUser'][_0x4f0212(0x80)]!=0x1)return _0x3028d9[_0x4f0212(0x88)]({'code':0x66});let _0x188d4b=_0x44bfac[_0x4f0212(0xb5)]['id'],_0x551b16=dbBackupTask[_0x4f0212(0x77)](_0x44bfac[_0x4f0212(0xa2)][_0x4f0212(0x8a)],_0x188d4b);_0x3028d9[_0x4f0212(0x88)]({'code':0x0,'data':_0x551b16});}),router[_0x3ed520(0x78)](_0x3ed520(0x6d),(_0x46a12d,_0x587960,_0x241566)=>{const _0xbe5fcd=_0x3ed520;if(_0x46a12d[_0xbe5fcd(0x89)][_0xbe5fcd(0x80)]!=0x1)return _0x587960[_0xbe5fcd(0x88)]({'code':0x66});let _0x2a0e10=_0x46a12d[_0xbe5fcd(0xb5)]['id'],_0x49b893=dbBackupTask['getAllRecordByWhere'](_0x46a12d[_0xbe5fcd(0xa2)][_0xbe5fcd(0x8a)],_0xbe5fcd(0x7b),[_0x2a0e10]);_0x587960[_0xbe5fcd(0x88)]({'code':0x0,'data':_0x49b893});}),router[_0x3ed520(0x78)](_0x3ed520(0xb2),(_0x4702ff,_0xedfde9,_0x325edd)=>{const _0x55e34e=_0x3ed520;if(_0x4702ff[_0x55e34e(0x89)]['is_admin']!=0x1)return _0xedfde9[_0x55e34e(0x88)]({'code':0x66});let _0x94984b=_0x4702ff['body'][_0x55e34e(0xa6)],_0x461a14=dbBackupTask[_0x55e34e(0x7f)](_0x4702ff[_0x55e34e(0xa2)][_0x55e34e(0x8a)],_0x55e34e(0x94),[_0x94984b]);_0xedfde9['json']({'code':0x0,'data':_0x461a14});}),router[_0x3ed520(0x78)](_0x3ed520(0xa9),(_0x1cb1fa,_0x2908b2,_0x2ee70f)=>{const _0x1880ec=_0x3ed520;if(_0x1cb1fa['currentUser']['is_admin']!=0x1)return _0x2908b2[_0x1880ec(0x88)]({'code':0x66});let _0x19a9c4=_0x1cb1fa[_0x1880ec(0xb5)]['recordId'],_0x3e3327=dbBackupTask['getAllRecordByWhere'](_0x1cb1fa[_0x1880ec(0xa2)][_0x1880ec(0x8a)],_0x1880ec(0x6f),[]);_0x2908b2['json']({'code':0x0,'data':_0x3e3327});}),module[_0x3ed520(0x92)]=router;function _0x2ec8(){const _0x4c946b=['/deleteTask','body','taskType','initBackupWorker','createRecord','updateRecord','constants','noWritePermission','/getTaskRecords','14LsJwaF','\x20status=\x27running\x27\x20or\x20status=\x27waiting\x27','dialog','taskAlreadQueued','taskAlreadyRunning','6549340ERbCvN','14960UmqLSd','task\x20id\x20is\x20error','stat','getById','post','noReadPermission','56310pRyEdi','\x20task_id=?\x20and\x20status=\x27done\x27\x20order\x20by\x20id\x20desc\x20limit\x20100','stop','YYYY-MM-DD\x20HH:mm:ss','test','getAllRecordMsgByWhere','is_admin','targetPath','noRunningTasks','access','send','1576924cqgFhA','format','cannotUseRootPathAsBackupTarget','json','currentUser','dbOther','2028273GNNyKz','/getTaskById','stringify','update','1496bWRMbS','taskTime','sourceList','exports','\x20task_id=?\x20and\x20(status=\x27stop\x27\x20or\x20status=\x27waiting\x27\x20or\x20status=\x27running\x27)','\x20task_record_id=?\x20order\x20by\x20id\x20desc\x20limit\x20100','1PkaECG','start','delete','1618366crdlrb','returnErrMsg','isDirectory','lastRecord','status','waiting','R_OK','taskName','W_OK','taskDay','app','getRecordByWhere','create','getAll','recordId','log','\x20task_id=?\x20order\x20by\x20id\x20desc\x20limit\x201','/getRunningTaskList','4131780sqUVcr','excludeList','getAllByTaskType','6264tvPFhv','\x20status=\x27waiting\x27','\x20status=\x27stop\x27','Router','/operationTask','/getTaskRecordMsg','/createTask'];_0x2ec8=function(){return _0x4c946b;};return _0x2ec8();}