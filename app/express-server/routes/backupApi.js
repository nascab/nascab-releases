function _0x5a50(_0x104448,_0x35d6f8){const _0x14bebc=_0x14be();return _0x5a50=function(_0x5a5014,_0x108d20){_0x5a5014=_0x5a5014-0x127;let _0x3b8347=_0x14bebc[_0x5a5014];return _0x3b8347;},_0x5a50(_0x104448,_0x35d6f8);}const _0xdbecc1=_0x5a50;(function(_0x5dd5a0,_0x41b06a){const _0x5265db=_0x5a50,_0x3a6133=_0x5dd5a0();while(!![]){try{const _0x34f7a0=-parseInt(_0x5265db(0x139))/0x1*(parseInt(_0x5265db(0x14e))/0x2)+parseInt(_0x5265db(0x128))/0x3+-parseInt(_0x5265db(0x129))/0x4+-parseInt(_0x5265db(0x147))/0x5+parseInt(_0x5265db(0x161))/0x6*(-parseInt(_0x5265db(0x15b))/0x7)+-parseInt(_0x5265db(0x171))/0x8*(-parseInt(_0x5265db(0x13f))/0x9)+parseInt(_0x5265db(0x167))/0xa;if(_0x34f7a0===_0x41b06a)break;else _0x3a6133['push'](_0x3a6133['shift']());}catch(_0x19f3f3){_0x3a6133['push'](_0x3a6133['shift']());}}}(_0x14be,0xc6dfe));function _0x14be(){const _0x514595=['currentUser','express','returnErrMsg','getRecordByWhere','790376RdnwPx','path','recordId','2034996yDPpTR','3567876lVjGvq','noWritePermission','\x20status=\x27running\x27\x20or\x20status=\x27waiting\x27','\x20task_record_id=?\x20order\x20by\x20id\x20desc\x20limit\x20100','test','excludeList','post','targetPath','getAll','taskAlreadQueued','constants','app','dialog','taskTime','getAllRecordByWhere','W_OK','69ZeaIVe','\x20status=\x27stop\x27','dbOther','json','stringify','getById','117lawhdE','is_admin','R_OK','/getTaskRecords','noRunningTasks','/getAllTask','type','update','2332190WTAWNC','YYYY-MM-DD\x20HH:mm:ss','status','\x20task_id=?\x20order\x20by\x20id\x20desc\x20limit\x201','/getTaskById','getAllByTaskType','exports','1292WXZkar','noGetFolderStat','createRecord','length','../../db/dbBackupTask','join','running','Router','getAllRecordMsgByWhere','\x20task_id=?\x20and\x20status=\x27done\x27\x20order\x20by\x20id\x20desc\x20limit\x20100','taskType','taskId','/getTaskRecordMsg','1092LPGkqq','\x20task_id=?\x20and\x20status=\x27running\x27','stop','/operationTask','create','initBackupWorker','6276fQKTqM','noReadPermission','updateRecord','send','cannotUseRootPathAsBackupTarget','isDirectory','4180540YyvyFd','\x20task_id=?\x20and\x20(status=\x27stop\x27\x20or\x20status=\x27waiting\x27\x20or\x20status=\x27running\x27)','/getRunningTaskList','moment','format','body'];_0x14be=function(){return _0x514595;};return _0x14be();}var express=require(_0xdbecc1(0x16e)),router=express[_0xdbecc1(0x155)]();let path=require(_0xdbecc1(0x172)),fs=require('fs');const dbBackupTask=require(_0xdbecc1(0x152));let moment=require(_0xdbecc1(0x16a));router[_0xdbecc1(0x12f)]('/createTask',(_0x5a9538,_0xe6ace5,_0x38770c)=>{const _0x33dee4=_0xdbecc1;if(_0x5a9538['currentUser'][_0x33dee4(0x140)]!=0x1)return _0xe6ace5[_0x33dee4(0x13c)]({'code':0x66});let _0x2d9b43=_0x5a9538[_0x33dee4(0x16c)][_0x33dee4(0x145)],_0x405552=_0x5a9538[_0x33dee4(0x16c)]['taskName'],_0x318132=_0x5a9538[_0x33dee4(0x16c)]['sourceList'],_0x23480d=_0x5a9538[_0x33dee4(0x16c)][_0x33dee4(0x12e)],_0x49a2be=path['join'](_0x5a9538[_0x33dee4(0x16c)][_0x33dee4(0x130)]),_0x17b10d=_0x5a9538['body']['taskType'],_0x288275=_0x5a9538['body']['taskDay'],_0x1d045a=_0x5a9538[_0x33dee4(0x16c)][_0x33dee4(0x136)];if(/^\w\:\\$/[_0x33dee4(0x12d)](_0x49a2be))return _0x5a9538[_0x33dee4(0x134)][_0x33dee4(0x16f)](_0xe6ace5,_0xe6ace5['__'](_0x33dee4(0x165)),_0x33dee4(0x135));let _0x4321a8=0x0;for(let _0x5b256e in _0x318132){_0x318132[_0x5b256e]=path[_0x33dee4(0x153)](_0x318132[_0x5b256e]);if(/^\w\:\\$/[_0x33dee4(0x12d)](_0x318132[_0x5b256e]))return _0x5a9538[_0x33dee4(0x134)]['returnErrMsg'](_0xe6ace5,_0xe6ace5['__']('cannotUseRootPathAsBackupTarget'),_0x33dee4(0x135));fs['access'](_0x318132[_0x5b256e],fs[_0x33dee4(0x133)][_0x33dee4(0x141)],_0x2ce0d8=>{const _0x26dd32=_0x33dee4;if(_0x2ce0d8)return _0x5a9538[_0x26dd32(0x134)]['returnErrMsg'](_0xe6ace5,_0xe6ace5['__'](_0x26dd32(0x162))+':'+_0x318132[_0x5b256e]);_0x4321a8+=0x1,_0x4321a8==_0x318132[_0x26dd32(0x151)]&&_0x2c0e6a();});}function _0x2c0e6a(){const _0x4fb686=_0x33dee4;fs['access'](_0x49a2be,fs['constants'][_0x4fb686(0x138)]|fs[_0x4fb686(0x133)][_0x4fb686(0x141)],_0xd77574=>{const _0x46ece0=_0x4fb686;if(_0xd77574)return console['log'](_0xd77574),_0x5a9538[_0x46ece0(0x134)][_0x46ece0(0x16f)](_0xe6ace5,_0xe6ace5['__'](_0x46ece0(0x12a))+':'+_0x49a2be);fs['stat'](_0x49a2be,(_0x4a8926,_0x4be5fc)=>{const _0xc767b8=_0x46ece0;if(_0x4a8926||!_0x4be5fc[_0xc767b8(0x166)]())return _0x5a9538[_0xc767b8(0x134)][_0xc767b8(0x16f)](_0xe6ace5,_0xe6ace5['__'](_0xc767b8(0x14f)));let _0x57c0e8={'task_name':_0x405552,'source_list':JSON[_0xc767b8(0x13d)](_0x318132),'exclude_list':JSON['stringify'](_0x23480d),'target_path':_0x49a2be,'task_type':_0x17b10d,'task_day':_0x288275,'task_time':_0x1d045a};if(_0x2d9b43==_0xc767b8(0x15f))dbBackupTask[_0xc767b8(0x15f)](_0x5a9538[_0xc767b8(0x134)][_0xc767b8(0x13b)],_0x57c0e8);else{if(_0x2d9b43=='update'){let _0x4f4808=_0x5a9538[_0xc767b8(0x16c)]['id'];dbBackupTask[_0xc767b8(0x146)](_0x5a9538[_0xc767b8(0x134)][_0xc767b8(0x13b)],_0x57c0e8,_0x4f4808);}}return process['send']({'type':_0xc767b8(0x160)}),_0xe6ace5['json']({'code':0x0});});});}}),router['post']('/deleteTask',(_0x21fe38,_0x2b7e48,_0x44b1ab)=>{const _0x459aa1=_0xdbecc1;if(_0x21fe38[_0x459aa1(0x16d)][_0x459aa1(0x140)]!=0x1)return _0x2b7e48[_0x459aa1(0x13c)]({'code':0x66});let _0x1bc74e=_0x21fe38['body']['id'];dbBackupTask['delete'](_0x21fe38[_0x459aa1(0x134)][_0x459aa1(0x13b)],_0x1bc74e),process[_0x459aa1(0x164)]({'type':_0x459aa1(0x160)}),_0x2b7e48[_0x459aa1(0x13c)]({'code':0x0});}),router[_0xdbecc1(0x12f)](_0xdbecc1(0x15e),(_0xd0547b,_0x3d867e,_0x5a27fe)=>{const _0xb4fc7d=_0xdbecc1;if(_0xd0547b[_0xb4fc7d(0x16d)][_0xb4fc7d(0x140)]!=0x1)return _0x3d867e[_0xb4fc7d(0x13c)]({'code':0x66});let _0xfd88a8=_0xd0547b[_0xb4fc7d(0x16c)][_0xb4fc7d(0x145)],_0x1529f6=_0xd0547b[_0xb4fc7d(0x16c)][_0xb4fc7d(0x159)],_0x3fbd64=dbBackupTask[_0xb4fc7d(0x13e)](_0xd0547b[_0xb4fc7d(0x134)]['dbOther'],_0x1529f6);if(!_0x3fbd64)return _0x3d867e[_0xb4fc7d(0x13c)]({'code':0x1,'message':'task\x20id\x20is\x20error'});if(_0xfd88a8=='start'){let _0x2cc312=dbBackupTask[_0xb4fc7d(0x170)](_0xd0547b[_0xb4fc7d(0x134)]['dbOther'],_0xb4fc7d(0x168),[_0x1529f6]);if(_0x2cc312){if(_0x2cc312[_0xb4fc7d(0x149)]=='waiting')return _0x3d867e[_0xb4fc7d(0x13c)]({'code':0x1,'message':_0x3d867e['__'](_0xb4fc7d(0x132)),'task_record':_0x2cc312});else{if(_0x2cc312[_0xb4fc7d(0x149)]==_0xb4fc7d(0x154))return _0x3d867e['json']({'code':0x1,'message':_0x3d867e['__']('taskAlreadyRunning'),'task_record':_0x2cc312});else _0x2cc312[_0xb4fc7d(0x149)]==_0xb4fc7d(0x15d)&&dbBackupTask[_0xb4fc7d(0x163)](_0xd0547b[_0xb4fc7d(0x134)][_0xb4fc7d(0x13b)],_0x2cc312['id'],'\x20status=\x27waiting\x27');}}else{let _0x54a660=moment()[_0xb4fc7d(0x16b)](_0xb4fc7d(0x148));dbBackupTask[_0xb4fc7d(0x150)](_0xd0547b[_0xb4fc7d(0x134)]['dbOther'],_0x1529f6,'waiting',_0x54a660);}}else{if(_0xfd88a8=='stop'){let _0x410b20=dbBackupTask[_0xb4fc7d(0x170)](_0xd0547b['app'][_0xb4fc7d(0x13b)],_0xb4fc7d(0x15c),[_0x1529f6]);if(!_0x410b20)return _0x3d867e[_0xb4fc7d(0x13c)]({'code':0x1,'message':_0x3d867e['__'](_0xb4fc7d(0x143)),'task_record':_0x410b20});else dbBackupTask[_0xb4fc7d(0x163)](_0xd0547b[_0xb4fc7d(0x134)]['dbOther'],_0x410b20['id'],_0xb4fc7d(0x13a));}}process[_0xb4fc7d(0x164)]({'type':_0xb4fc7d(0x160)}),_0x3d867e[_0xb4fc7d(0x13c)]({'code':0x0});}),router['post'](_0xdbecc1(0x144),(_0x1ffdfd,_0x4bd59a,_0xab1fc6)=>{const _0x490e94=_0xdbecc1;if(_0x1ffdfd[_0x490e94(0x16d)][_0x490e94(0x140)]!=0x1)return _0x4bd59a[_0x490e94(0x13c)]({'code':0x66});let _0x1731ae=_0x1ffdfd[_0x490e94(0x16c)][_0x490e94(0x158)],_0x444c9d=[];_0x1731ae=parseInt(_0x1731ae);_0x1731ae?_0x444c9d=dbBackupTask[_0x490e94(0x14c)](_0x1ffdfd[_0x490e94(0x134)]['dbOther'],_0x1731ae):_0x444c9d=dbBackupTask[_0x490e94(0x131)](_0x1ffdfd['app'][_0x490e94(0x13b)]);for(let _0x3c3a4a in _0x444c9d){let _0x466a70=dbBackupTask['getRecordByWhere'](_0x1ffdfd[_0x490e94(0x134)][_0x490e94(0x13b)],_0x490e94(0x14a),[_0x444c9d[_0x3c3a4a]['id']]);_0x444c9d[_0x3c3a4a]['lastRecord']=_0x466a70;}_0x4bd59a[_0x490e94(0x13c)]({'code':0x0,'data':_0x444c9d});}),router[_0xdbecc1(0x12f)](_0xdbecc1(0x14b),(_0x323b52,_0x1fab19,_0x1ebd52)=>{const _0x3fc598=_0xdbecc1;if(_0x323b52[_0x3fc598(0x16d)][_0x3fc598(0x140)]!=0x1)return _0x1fab19[_0x3fc598(0x13c)]({'code':0x66});let _0xd694f3=_0x323b52[_0x3fc598(0x16c)]['id'],_0x5b4ed2=dbBackupTask[_0x3fc598(0x13e)](_0x323b52[_0x3fc598(0x134)][_0x3fc598(0x13b)],_0xd694f3);_0x1fab19[_0x3fc598(0x13c)]({'code':0x0,'data':_0x5b4ed2});}),router[_0xdbecc1(0x12f)](_0xdbecc1(0x142),(_0x4bf9d8,_0x98622,_0x109284)=>{const _0x3a6332=_0xdbecc1;if(_0x4bf9d8['currentUser'][_0x3a6332(0x140)]!=0x1)return _0x98622[_0x3a6332(0x13c)]({'code':0x66});let _0x4334c4=_0x4bf9d8[_0x3a6332(0x16c)]['id'],_0x4cbe79=dbBackupTask[_0x3a6332(0x137)](_0x4bf9d8[_0x3a6332(0x134)][_0x3a6332(0x13b)],_0x3a6332(0x157),[_0x4334c4]);_0x98622['json']({'code':0x0,'data':_0x4cbe79});}),router[_0xdbecc1(0x12f)](_0xdbecc1(0x15a),(_0x4bc4b6,_0x4b052a,_0x4ac155)=>{const _0x129867=_0xdbecc1;if(_0x4bc4b6[_0x129867(0x16d)][_0x129867(0x140)]!=0x1)return _0x4b052a[_0x129867(0x13c)]({'code':0x66});let _0x45fbe4=_0x4bc4b6['body'][_0x129867(0x127)],_0x2041a4=dbBackupTask[_0x129867(0x156)](_0x4bc4b6[_0x129867(0x134)][_0x129867(0x13b)],_0x129867(0x12c),[_0x45fbe4]);_0x4b052a['json']({'code':0x0,'data':_0x2041a4});}),router['post'](_0xdbecc1(0x169),(_0x53a7a9,_0x5eaf10,_0x933ded)=>{const _0x222b6a=_0xdbecc1;if(_0x53a7a9['currentUser']['is_admin']!=0x1)return _0x5eaf10[_0x222b6a(0x13c)]({'code':0x66});let _0x256f54=_0x53a7a9['body'][_0x222b6a(0x127)],_0x13ee5b=dbBackupTask['getAllRecordByWhere'](_0x53a7a9[_0x222b6a(0x134)][_0x222b6a(0x13b)],_0x222b6a(0x12b),[]);_0x5eaf10[_0x222b6a(0x13c)]({'code':0x0,'data':_0x13ee5b});}),module[_0xdbecc1(0x14d)]=router;