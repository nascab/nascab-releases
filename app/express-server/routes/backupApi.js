function _0x4d1f(_0x140bd5,_0x4c0e8a){const _0x56d276=_0x56d2();return _0x4d1f=function(_0x4d1fa8,_0x54ac1c){_0x4d1fa8=_0x4d1fa8-0x96;let _0x59e365=_0x56d276[_0x4d1fa8];return _0x59e365;},_0x4d1f(_0x140bd5,_0x4c0e8a);}function _0x56d2(){const _0x1ccb75=['/getTaskById','delete','\x20status=\x27waiting\x27','3092299owXMfU','sourceList','../../db/dbBackupTask','send','length','getAllRecordByWhere','returnErrMsg','/getTaskRecords','update','cannotUseRootPathAsBackupTarget','post','access','\x20task_id=?\x20order\x20by\x20id\x20desc\x20limit\x201','257614TmnOSZ','\x20task_id=?\x20and\x20(status=\x27stop\x27\x20or\x20status=\x27waiting\x27\x20or\x20status=\x27running\x27)','/getTaskRecordMsg','create','311734rlWylK','task\x20id\x20is\x20error','taskId','initBackupWorker','join','932420XsHEbF','app','dialog','taskAlreadQueued','1225640SYOKsT','stringify','stat','/operationTask','constants','noWritePermission','getAll','log','path','getAllRecordMsgByWhere','\x20task_id=?\x20and\x20status=\x27done\x27\x20order\x20by\x20id\x20desc\x20limit\x20100','stop','status','recordId','noRunningTasks','taskName','4792854lPNQDv','excludeList','getRecordByWhere','\x20task_id=?\x20and\x20status=\x27running\x27','\x20status=\x27stop\x27','noReadPermission','taskType','/deleteTask','waiting','dbOther','is_admin','1940946YLnBIY','/getRunningTaskList','8KqOyTo','targetPath','body','json','test','YYYY-MM-DD\x20HH:mm:ss','Router','type','currentUser','createRecord','/createTask','isDirectory','\x20task_record_id=?\x20order\x20by\x20id\x20desc\x20limit\x20100'];_0x56d2=function(){return _0x1ccb75;};return _0x56d2();}const _0x4110e6=_0x4d1f;(function(_0x40ccd9,_0x57145b){const _0x34dc2b=_0x4d1f,_0x36be43=_0x40ccd9();while(!![]){try{const _0x306380=parseInt(_0x34dc2b(0x96))/0x1+-parseInt(_0x34dc2b(0xd9))/0x2+-parseInt(_0x34dc2b(0xba))/0x3+-parseInt(_0x34dc2b(0x9f))/0x4+parseInt(_0x34dc2b(0x9b))/0x5+parseInt(_0x34dc2b(0xaf))/0x6+parseInt(_0x34dc2b(0xcc))/0x7*(parseInt(_0x34dc2b(0xbc))/0x8);if(_0x306380===_0x57145b)break;else _0x36be43['push'](_0x36be43['shift']());}catch(_0x2ae632){_0x36be43['push'](_0x36be43['shift']());}}}(_0x56d2,0xa04c9));var express=require('express'),router=express[_0x4110e6(0xc2)]();let path=require(_0x4110e6(0xa7)),fs=require('fs');const dbBackupTask=require(_0x4110e6(0xce));let moment=require('moment');router[_0x4110e6(0xd6)](_0x4110e6(0xc6),(_0x1da47d,_0x37571b,_0x165424)=>{const _0xbfa894=_0x4110e6;if(_0x1da47d[_0xbfa894(0xc4)][_0xbfa894(0xb9)]!=0x1)return _0x37571b['json']({'code':0x66});let _0x43c384=_0x1da47d[_0xbfa894(0xbe)][_0xbfa894(0xc3)],_0x414e7c=_0x1da47d[_0xbfa894(0xbe)][_0xbfa894(0xae)],_0x298841=_0x1da47d[_0xbfa894(0xbe)][_0xbfa894(0xcd)],_0x1699d4=_0x1da47d[_0xbfa894(0xbe)][_0xbfa894(0xb0)],_0x16b1b5=path['join'](_0x1da47d['body'][_0xbfa894(0xbd)]),_0x403987=_0x1da47d[_0xbfa894(0xbe)][_0xbfa894(0xb5)],_0x77fcae=_0x1da47d[_0xbfa894(0xbe)]['taskDay'],_0x30e052=_0x1da47d[_0xbfa894(0xbe)]['taskTime'];if(/^\w\:\\$/[_0xbfa894(0xc0)](_0x16b1b5))return _0x1da47d['app'][_0xbfa894(0xd2)](_0x37571b,_0x37571b['__'](_0xbfa894(0xd5)),_0xbfa894(0x9d));let _0x482303=0x0;for(let _0x42bb7e in _0x298841){_0x298841[_0x42bb7e]=path[_0xbfa894(0x9a)](_0x298841[_0x42bb7e]);if(/^\w\:\\$/[_0xbfa894(0xc0)](_0x298841[_0x42bb7e]))return _0x1da47d[_0xbfa894(0x9c)][_0xbfa894(0xd2)](_0x37571b,_0x37571b['__'](_0xbfa894(0xd5)),'dialog');fs[_0xbfa894(0xd7)](_0x298841[_0x42bb7e],fs['constants']['R_OK'],_0x5520e1=>{const _0x3b7444=_0xbfa894;if(_0x5520e1)return _0x1da47d[_0x3b7444(0x9c)][_0x3b7444(0xd2)](_0x37571b,_0x37571b['__'](_0x3b7444(0xb4))+':'+_0x298841[_0x42bb7e]);_0x482303+=0x1,_0x482303==_0x298841[_0x3b7444(0xd0)]&&_0x1d9bb3();});}function _0x1d9bb3(){const _0x332cec=_0xbfa894;fs[_0x332cec(0xd7)](_0x16b1b5,fs[_0x332cec(0xa3)]['W_OK']|fs['constants']['R_OK'],_0x442ddb=>{const _0x408803=_0x332cec;if(_0x442ddb)return console[_0x408803(0xa6)](_0x442ddb),_0x1da47d[_0x408803(0x9c)]['returnErrMsg'](_0x37571b,_0x37571b['__'](_0x408803(0xa4))+':'+_0x16b1b5);fs[_0x408803(0xa1)](_0x16b1b5,(_0x180767,_0x2515f5)=>{const _0x26f39a=_0x408803;if(_0x180767||!_0x2515f5[_0x26f39a(0xc7)]())return _0x1da47d['app'][_0x26f39a(0xd2)](_0x37571b,_0x37571b['__']('noGetFolderStat'));let _0x1d1ac3={'task_name':_0x414e7c,'source_list':JSON[_0x26f39a(0xa0)](_0x298841),'exclude_list':JSON[_0x26f39a(0xa0)](_0x1699d4),'target_path':_0x16b1b5,'task_type':_0x403987,'task_day':_0x77fcae,'task_time':_0x30e052};if(_0x43c384==_0x26f39a(0xdc))dbBackupTask[_0x26f39a(0xdc)](_0x1da47d[_0x26f39a(0x9c)][_0x26f39a(0xb8)],_0x1d1ac3);else{if(_0x43c384==_0x26f39a(0xd4)){let _0x1f9f14=_0x1da47d[_0x26f39a(0xbe)]['id'];dbBackupTask['update'](_0x1da47d[_0x26f39a(0x9c)][_0x26f39a(0xb8)],_0x1d1ac3,_0x1f9f14);}}return process[_0x26f39a(0xcf)]({'type':_0x26f39a(0x99)}),_0x37571b[_0x26f39a(0xbf)]({'code':0x0});});});}}),router['post'](_0x4110e6(0xb6),(_0x4c8e07,_0x33010f,_0x1d799d)=>{const _0x58ce46=_0x4110e6;if(_0x4c8e07['currentUser'][_0x58ce46(0xb9)]!=0x1)return _0x33010f[_0x58ce46(0xbf)]({'code':0x66});let _0x397547=_0x4c8e07[_0x58ce46(0xbe)]['id'];dbBackupTask[_0x58ce46(0xca)](_0x4c8e07['app'][_0x58ce46(0xb8)],_0x397547),process[_0x58ce46(0xcf)]({'type':_0x58ce46(0x99)}),_0x33010f['json']({'code':0x0});}),router[_0x4110e6(0xd6)](_0x4110e6(0xa2),(_0x211a84,_0x57a802,_0x1da09d)=>{const _0x5085c8=_0x4110e6;if(_0x211a84[_0x5085c8(0xc4)][_0x5085c8(0xb9)]!=0x1)return _0x57a802[_0x5085c8(0xbf)]({'code':0x66});let _0x525902=_0x211a84[_0x5085c8(0xbe)][_0x5085c8(0xc3)],_0x18e019=_0x211a84['body'][_0x5085c8(0x98)],_0x481f7b=dbBackupTask['getById'](_0x211a84[_0x5085c8(0x9c)][_0x5085c8(0xb8)],_0x18e019);if(!_0x481f7b)return _0x57a802['json']({'code':0x1,'message':_0x5085c8(0x97)});if(_0x525902=='start'){let _0x156f58=dbBackupTask[_0x5085c8(0xb1)](_0x211a84['app'][_0x5085c8(0xb8)],_0x5085c8(0xda),[_0x18e019]);if(_0x156f58){if(_0x156f58[_0x5085c8(0xab)]==_0x5085c8(0xb7))return _0x57a802['json']({'code':0x1,'message':_0x57a802['__'](_0x5085c8(0x9e)),'task_record':_0x156f58});else{if(_0x156f58[_0x5085c8(0xab)]=='running')return _0x57a802[_0x5085c8(0xbf)]({'code':0x1,'message':_0x57a802['__']('taskAlreadyRunning'),'task_record':_0x156f58});else _0x156f58[_0x5085c8(0xab)]==_0x5085c8(0xaa)&&dbBackupTask['updateRecord'](_0x211a84[_0x5085c8(0x9c)][_0x5085c8(0xb8)],_0x156f58['id'],_0x5085c8(0xcb));}}else{let _0x44d400=moment()['format'](_0x5085c8(0xc1));dbBackupTask[_0x5085c8(0xc5)](_0x211a84['app'][_0x5085c8(0xb8)],_0x18e019,_0x5085c8(0xb7),_0x44d400);}}else{if(_0x525902==_0x5085c8(0xaa)){let _0x9fa1fe=dbBackupTask[_0x5085c8(0xb1)](_0x211a84[_0x5085c8(0x9c)][_0x5085c8(0xb8)],_0x5085c8(0xb2),[_0x18e019]);if(!_0x9fa1fe)return _0x57a802['json']({'code':0x1,'message':_0x57a802['__'](_0x5085c8(0xad)),'task_record':_0x9fa1fe});else dbBackupTask['updateRecord'](_0x211a84['app'][_0x5085c8(0xb8)],_0x9fa1fe['id'],_0x5085c8(0xb3));}}process['send']({'type':_0x5085c8(0x99)}),_0x57a802['json']({'code':0x0});}),router[_0x4110e6(0xd6)]('/getAllTask',(_0x1de4dd,_0x14d817,_0xee6345)=>{const _0x120fcf=_0x4110e6;if(_0x1de4dd[_0x120fcf(0xc4)][_0x120fcf(0xb9)]!=0x1)return _0x14d817['json']({'code':0x66});let _0x20c0f4=_0x1de4dd[_0x120fcf(0xbe)]['taskType'],_0x170ec6=[];_0x20c0f4=parseInt(_0x20c0f4);_0x20c0f4?_0x170ec6=dbBackupTask['getAllByTaskType'](_0x1de4dd[_0x120fcf(0x9c)][_0x120fcf(0xb8)],_0x20c0f4):_0x170ec6=dbBackupTask[_0x120fcf(0xa5)](_0x1de4dd[_0x120fcf(0x9c)][_0x120fcf(0xb8)]);for(let _0x4c2153 in _0x170ec6){let _0x277e87=dbBackupTask[_0x120fcf(0xb1)](_0x1de4dd[_0x120fcf(0x9c)][_0x120fcf(0xb8)],_0x120fcf(0xd8),[_0x170ec6[_0x4c2153]['id']]);_0x170ec6[_0x4c2153]['lastRecord']=_0x277e87;}_0x14d817[_0x120fcf(0xbf)]({'code':0x0,'data':_0x170ec6});}),router[_0x4110e6(0xd6)](_0x4110e6(0xc9),(_0x349825,_0x5a1148,_0x217805)=>{const _0x388a49=_0x4110e6;if(_0x349825['currentUser']['is_admin']!=0x1)return _0x5a1148['json']({'code':0x66});let _0x3ec3b3=_0x349825['body']['id'],_0x3704bf=dbBackupTask['getById'](_0x349825['app'][_0x388a49(0xb8)],_0x3ec3b3);_0x5a1148[_0x388a49(0xbf)]({'code':0x0,'data':_0x3704bf});}),router[_0x4110e6(0xd6)](_0x4110e6(0xd3),(_0x115668,_0x5d145e,_0x3e7a51)=>{const _0x18ce64=_0x4110e6;if(_0x115668[_0x18ce64(0xc4)][_0x18ce64(0xb9)]!=0x1)return _0x5d145e[_0x18ce64(0xbf)]({'code':0x66});let _0x2aef60=_0x115668[_0x18ce64(0xbe)]['id'],_0x35561c=dbBackupTask[_0x18ce64(0xd1)](_0x115668[_0x18ce64(0x9c)]['dbOther'],_0x18ce64(0xa9),[_0x2aef60]);_0x5d145e[_0x18ce64(0xbf)]({'code':0x0,'data':_0x35561c});}),router[_0x4110e6(0xd6)](_0x4110e6(0xdb),(_0x5e7940,_0x1a6031,_0x5c2125)=>{const _0x37b368=_0x4110e6;if(_0x5e7940[_0x37b368(0xc4)][_0x37b368(0xb9)]!=0x1)return _0x1a6031[_0x37b368(0xbf)]({'code':0x66});let _0x1daca3=_0x5e7940[_0x37b368(0xbe)][_0x37b368(0xac)],_0x140ec7=dbBackupTask[_0x37b368(0xa8)](_0x5e7940[_0x37b368(0x9c)][_0x37b368(0xb8)],_0x37b368(0xc8),[_0x1daca3]);_0x1a6031[_0x37b368(0xbf)]({'code':0x0,'data':_0x140ec7});}),router[_0x4110e6(0xd6)](_0x4110e6(0xbb),(_0x1249b5,_0x5c5f6c,_0x10f02b)=>{const _0x4c00a3=_0x4110e6;if(_0x1249b5[_0x4c00a3(0xc4)][_0x4c00a3(0xb9)]!=0x1)return _0x5c5f6c[_0x4c00a3(0xbf)]({'code':0x66});let _0x4e67f9=_0x1249b5[_0x4c00a3(0xbe)]['recordId'],_0x2449e6=dbBackupTask[_0x4c00a3(0xd1)](_0x1249b5['app'][_0x4c00a3(0xb8)],'\x20status=\x27running\x27\x20or\x20status=\x27waiting\x27',[]);_0x5c5f6c['json']({'code':0x0,'data':_0x2449e6});}),module['exports']=router;