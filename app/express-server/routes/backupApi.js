function _0x2cf7(_0x127ed4,_0x12194d){const _0x4aa645=_0x4aa6();return _0x2cf7=function(_0x2cf783,_0x5e87d1){_0x2cf783=_0x2cf783-0x73;let _0x11bd16=_0x4aa645[_0x2cf783];return _0x11bd16;},_0x2cf7(_0x127ed4,_0x12194d);}const _0xb5916f=_0x2cf7;function _0x4aa6(){const _0x1432df=['../../db/dbBackupTask','createRecord','941898SyTNfE','app','taskTime','12ICXVPy','recordId','task\x20id\x20is\x20error','body','3206268YLyKhC','noWritePermission','status','802788SeTwJw','noReadPermission','2uJtTVJ','\x20task_id=?\x20order\x20by\x20id\x20desc\x20limit\x201','json','express','taskAlreadQueued','getAllRecordByWhere','create','stringify','/getTaskRecords','stop','2753199fNwirp','start','excludeList','delete','update','277992ifSxdM','getRecordByWhere','\x20task_record_id=?\x20order\x20by\x20id\x20desc\x20limit\x20100','test','taskId','W_OK','taskAlreadyRunning','dbOther','cannotUseRootPathAsBackupTarget','noGetFolderStat','constants','post','R_OK','198aZJvgU','getAllRecordMsgByWhere','/deleteTask','sourceList','targetPath','getById','send','/getAllTask','866114MpuIFT','2125690vUqXSB','getAll','length','noRunningTasks','type','\x20status=\x27stop\x27','initBackupWorker','\x20status=\x27running\x27\x20or\x20status=\x27waiting\x27','dialog','updateRecord','join','log','Router','10jtHhGT','waiting','taskType','is_admin','currentUser','YYYY-MM-DD\x20HH:mm:ss','/createTask','189NbGhPi','access','returnErrMsg','path'];_0x4aa6=function(){return _0x1432df;};return _0x4aa6();}(function(_0x47e922,_0x3194d9){const _0x4469f7=_0x2cf7,_0x2ce195=_0x47e922();while(!![]){try{const _0x1c538b=-parseInt(_0x4469f7(0x82))/0x1*(parseInt(_0x4469f7(0xa6))/0x2)+parseInt(_0x4469f7(0x76))/0x3*(parseInt(_0x4469f7(0x79))/0x4)+parseInt(_0x4469f7(0xa7))/0x5+-parseInt(_0x4469f7(0x7d))/0x6+-parseInt(_0x4469f7(0xbb))/0x7*(parseInt(_0x4469f7(0x91))/0x8)+-parseInt(_0x4469f7(0x8c))/0x9*(-parseInt(_0x4469f7(0xb4))/0xa)+parseInt(_0x4469f7(0x9e))/0xb*(parseInt(_0x4469f7(0x80))/0xc);if(_0x1c538b===_0x3194d9)break;else _0x2ce195['push'](_0x2ce195['shift']());}catch(_0x24dc23){_0x2ce195['push'](_0x2ce195['shift']());}}}(_0x4aa6,0x8372e));var express=require(_0xb5916f(0x85)),router=express[_0xb5916f(0xb3)]();let path=require(_0xb5916f(0x73)),fs=require('fs');const dbBackupTask=require(_0xb5916f(0x74));let moment=require('moment');router[_0xb5916f(0x9c)](_0xb5916f(0xba),(_0x3adf0d,_0x5393f8,_0x4b1d16)=>{const _0x3458cf=_0xb5916f;if(_0x3adf0d[_0x3458cf(0xb8)][_0x3458cf(0xb7)]!=0x1)return _0x5393f8[_0x3458cf(0x84)]({'code':0x66});let _0x7380e2=_0x3adf0d[_0x3458cf(0x7c)][_0x3458cf(0xab)],_0x130a1d=_0x3adf0d['body']['taskName'],_0xf9829e=_0x3adf0d[_0x3458cf(0x7c)][_0x3458cf(0xa1)],_0x588ec8=_0x3adf0d[_0x3458cf(0x7c)][_0x3458cf(0x8e)],_0x47ae85=path[_0x3458cf(0xb1)](_0x3adf0d[_0x3458cf(0x7c)][_0x3458cf(0xa2)]),_0x57ab7d=_0x3adf0d[_0x3458cf(0x7c)]['taskType'],_0x408341=_0x3adf0d[_0x3458cf(0x7c)]['taskDay'],_0x156515=_0x3adf0d['body'][_0x3458cf(0x78)];if(/^\w\:\\$/[_0x3458cf(0x94)](_0x47ae85))return _0x3adf0d[_0x3458cf(0x77)][_0x3458cf(0xbd)](_0x5393f8,_0x5393f8['__'](_0x3458cf(0x99)),_0x3458cf(0xaf));let _0x2ef17e=0x0;for(let _0x1a862d in _0xf9829e){_0xf9829e[_0x1a862d]=path[_0x3458cf(0xb1)](_0xf9829e[_0x1a862d]);if(/^\w\:\\$/['test'](_0xf9829e[_0x1a862d]))return _0x3adf0d['app'][_0x3458cf(0xbd)](_0x5393f8,_0x5393f8['__'](_0x3458cf(0x99)),_0x3458cf(0xaf));fs['access'](_0xf9829e[_0x1a862d],fs[_0x3458cf(0x9b)][_0x3458cf(0x9d)],_0x47fbb7=>{const _0x488a55=_0x3458cf;if(_0x47fbb7)return _0x3adf0d[_0x488a55(0x77)][_0x488a55(0xbd)](_0x5393f8,_0x5393f8['__'](_0x488a55(0x81))+':'+_0xf9829e[_0x1a862d]);_0x2ef17e+=0x1,_0x2ef17e==_0xf9829e[_0x488a55(0xa9)]&&_0xbe5ad2();});}function _0xbe5ad2(){const _0x5419fb=_0x3458cf;fs[_0x5419fb(0xbc)](_0x47ae85,fs[_0x5419fb(0x9b)][_0x5419fb(0x96)]|fs[_0x5419fb(0x9b)][_0x5419fb(0x9d)],_0x3a2ce2=>{const _0x428174=_0x5419fb;if(_0x3a2ce2)return console[_0x428174(0xb2)](_0x3a2ce2),_0x3adf0d['app']['returnErrMsg'](_0x5393f8,_0x5393f8['__'](_0x428174(0x7e))+':'+_0x47ae85);fs['stat'](_0x47ae85,(_0x3c02c1,_0x502346)=>{const _0x21ee1e=_0x428174;if(_0x3c02c1||!_0x502346['isDirectory']())return _0x3adf0d[_0x21ee1e(0x77)]['returnErrMsg'](_0x5393f8,_0x5393f8['__'](_0x21ee1e(0x9a)));let _0x4310fd={'task_name':_0x130a1d,'source_list':JSON[_0x21ee1e(0x89)](_0xf9829e),'exclude_list':JSON[_0x21ee1e(0x89)](_0x588ec8),'target_path':_0x47ae85,'task_type':_0x57ab7d,'task_day':_0x408341,'task_time':_0x156515};if(_0x7380e2==_0x21ee1e(0x88))dbBackupTask[_0x21ee1e(0x88)](_0x3adf0d['app'][_0x21ee1e(0x98)],_0x4310fd);else{if(_0x7380e2==_0x21ee1e(0x90)){let _0x23e57b=_0x3adf0d['body']['id'];dbBackupTask[_0x21ee1e(0x90)](_0x3adf0d[_0x21ee1e(0x77)][_0x21ee1e(0x98)],_0x4310fd,_0x23e57b);}}return process['send']({'type':_0x21ee1e(0xad)}),_0x5393f8[_0x21ee1e(0x84)]({'code':0x0});});});}}),router[_0xb5916f(0x9c)](_0xb5916f(0xa0),(_0xa02ea1,_0x1f4d69,_0x17b57a)=>{const _0x4793ce=_0xb5916f;if(_0xa02ea1['currentUser'][_0x4793ce(0xb7)]!=0x1)return _0x1f4d69[_0x4793ce(0x84)]({'code':0x66});let _0x2eaf82=_0xa02ea1[_0x4793ce(0x7c)]['id'];dbBackupTask[_0x4793ce(0x8f)](_0xa02ea1[_0x4793ce(0x77)][_0x4793ce(0x98)],_0x2eaf82),process[_0x4793ce(0xa4)]({'type':'initBackupWorker'}),_0x1f4d69[_0x4793ce(0x84)]({'code':0x0});}),router[_0xb5916f(0x9c)]('/operationTask',(_0x2066da,_0x192f4a,_0x21007c)=>{const _0xe24e18=_0xb5916f;if(_0x2066da[_0xe24e18(0xb8)]['is_admin']!=0x1)return _0x192f4a[_0xe24e18(0x84)]({'code':0x66});let _0xfe9277=_0x2066da[_0xe24e18(0x7c)][_0xe24e18(0xab)],_0x303705=_0x2066da[_0xe24e18(0x7c)][_0xe24e18(0x95)],_0x53d891=dbBackupTask[_0xe24e18(0xa3)](_0x2066da[_0xe24e18(0x77)]['dbOther'],_0x303705);if(!_0x53d891)return _0x192f4a[_0xe24e18(0x84)]({'code':0x1,'message':_0xe24e18(0x7b)});if(_0xfe9277==_0xe24e18(0x8d)){let _0x5d71f8=dbBackupTask[_0xe24e18(0x92)](_0x2066da[_0xe24e18(0x77)][_0xe24e18(0x98)],'\x20task_id=?\x20and\x20(status=\x27stop\x27\x20or\x20status=\x27waiting\x27\x20or\x20status=\x27running\x27)',[_0x303705]);if(_0x5d71f8){if(_0x5d71f8['status']==_0xe24e18(0xb5))return _0x192f4a['json']({'code':0x1,'message':_0x192f4a['__'](_0xe24e18(0x86)),'task_record':_0x5d71f8});else{if(_0x5d71f8[_0xe24e18(0x7f)]=='running')return _0x192f4a[_0xe24e18(0x84)]({'code':0x1,'message':_0x192f4a['__'](_0xe24e18(0x97)),'task_record':_0x5d71f8});else _0x5d71f8[_0xe24e18(0x7f)]==_0xe24e18(0x8b)&&dbBackupTask['updateRecord'](_0x2066da[_0xe24e18(0x77)][_0xe24e18(0x98)],_0x5d71f8['id'],'\x20status=\x27waiting\x27');}}else{let _0x19d7e1=moment()['format'](_0xe24e18(0xb9));dbBackupTask[_0xe24e18(0x75)](_0x2066da['app'][_0xe24e18(0x98)],_0x303705,_0xe24e18(0xb5),_0x19d7e1);}}else{if(_0xfe9277=='stop'){let _0x41fc86=dbBackupTask[_0xe24e18(0x92)](_0x2066da[_0xe24e18(0x77)][_0xe24e18(0x98)],'\x20task_id=?\x20and\x20status=\x27running\x27',[_0x303705]);if(!_0x41fc86)return _0x192f4a[_0xe24e18(0x84)]({'code':0x1,'message':_0x192f4a['__'](_0xe24e18(0xaa)),'task_record':_0x41fc86});else dbBackupTask[_0xe24e18(0xb0)](_0x2066da[_0xe24e18(0x77)][_0xe24e18(0x98)],_0x41fc86['id'],_0xe24e18(0xac));}}process[_0xe24e18(0xa4)]({'type':_0xe24e18(0xad)}),_0x192f4a['json']({'code':0x0});}),router[_0xb5916f(0x9c)](_0xb5916f(0xa5),(_0x435e66,_0x33da5c,_0x13e540)=>{const _0x1c7b5f=_0xb5916f;if(_0x435e66[_0x1c7b5f(0xb8)][_0x1c7b5f(0xb7)]!=0x1)return _0x33da5c[_0x1c7b5f(0x84)]({'code':0x66});let _0x404b14=_0x435e66['body'][_0x1c7b5f(0xb6)],_0x2d8389=[];_0x404b14=parseInt(_0x404b14);_0x404b14?_0x2d8389=dbBackupTask['getAllByTaskType'](_0x435e66[_0x1c7b5f(0x77)]['dbOther'],_0x404b14):_0x2d8389=dbBackupTask[_0x1c7b5f(0xa8)](_0x435e66[_0x1c7b5f(0x77)]['dbOther']);for(let _0x576211 in _0x2d8389){let _0x95b8ee=dbBackupTask[_0x1c7b5f(0x92)](_0x435e66[_0x1c7b5f(0x77)][_0x1c7b5f(0x98)],_0x1c7b5f(0x83),[_0x2d8389[_0x576211]['id']]);_0x2d8389[_0x576211]['lastRecord']=_0x95b8ee;}_0x33da5c[_0x1c7b5f(0x84)]({'code':0x0,'data':_0x2d8389});}),router[_0xb5916f(0x9c)]('/getTaskById',(_0x5b7695,_0x2f7e55,_0x1ef360)=>{const _0x516f33=_0xb5916f;if(_0x5b7695[_0x516f33(0xb8)]['is_admin']!=0x1)return _0x2f7e55[_0x516f33(0x84)]({'code':0x66});let _0x29a782=_0x5b7695[_0x516f33(0x7c)]['id'],_0x5f1547=dbBackupTask[_0x516f33(0xa3)](_0x5b7695[_0x516f33(0x77)]['dbOther'],_0x29a782);_0x2f7e55[_0x516f33(0x84)]({'code':0x0,'data':_0x5f1547});}),router[_0xb5916f(0x9c)](_0xb5916f(0x8a),(_0x3bc32e,_0x358241,_0x5651e2)=>{const _0x2020e9=_0xb5916f;if(_0x3bc32e[_0x2020e9(0xb8)][_0x2020e9(0xb7)]!=0x1)return _0x358241[_0x2020e9(0x84)]({'code':0x66});let _0x13affd=_0x3bc32e[_0x2020e9(0x7c)]['id'],_0x3e1860=dbBackupTask[_0x2020e9(0x87)](_0x3bc32e[_0x2020e9(0x77)][_0x2020e9(0x98)],'\x20task_id=?\x20and\x20status=\x27done\x27\x20order\x20by\x20id\x20desc\x20limit\x20100',[_0x13affd]);_0x358241['json']({'code':0x0,'data':_0x3e1860});}),router[_0xb5916f(0x9c)]('/getTaskRecordMsg',(_0x14db7d,_0xc78308,_0x298e1f)=>{const _0x24ef79=_0xb5916f;if(_0x14db7d[_0x24ef79(0xb8)][_0x24ef79(0xb7)]!=0x1)return _0xc78308[_0x24ef79(0x84)]({'code':0x66});let _0x3120ac=_0x14db7d[_0x24ef79(0x7c)][_0x24ef79(0x7a)],_0xe070b2=dbBackupTask[_0x24ef79(0x9f)](_0x14db7d['app'][_0x24ef79(0x98)],_0x24ef79(0x93),[_0x3120ac]);_0xc78308['json']({'code':0x0,'data':_0xe070b2});}),router[_0xb5916f(0x9c)]('/getRunningTaskList',(_0x3d27ff,_0x457dcf,_0xee3278)=>{const _0x69b034=_0xb5916f;if(_0x3d27ff[_0x69b034(0xb8)][_0x69b034(0xb7)]!=0x1)return _0x457dcf[_0x69b034(0x84)]({'code':0x66});let _0x18b3d0=_0x3d27ff[_0x69b034(0x7c)]['recordId'],_0x3eb9b0=dbBackupTask['getAllRecordByWhere'](_0x3d27ff[_0x69b034(0x77)][_0x69b034(0x98)],_0x69b034(0xae),[]);_0x457dcf[_0x69b034(0x84)]({'code':0x0,'data':_0x3eb9b0});}),module['exports']=router;