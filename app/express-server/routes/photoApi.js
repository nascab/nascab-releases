const _0x20551a=_0x30f5;(function(_0x5156e9,_0x4cdb8d){const _0x636577=_0x30f5,_0x2e3286=_0x5156e9();while(!![]){try{const _0x149b62=parseInt(_0x636577(0x291))/0x1*(parseInt(_0x636577(0x20a))/0x2)+parseInt(_0x636577(0x268))/0x3*(-parseInt(_0x636577(0x221))/0x4)+parseInt(_0x636577(0x17a))/0x5*(parseInt(_0x636577(0x27a))/0x6)+parseInt(_0x636577(0x242))/0x7*(parseInt(_0x636577(0x1eb))/0x8)+-parseInt(_0x636577(0x24b))/0x9*(-parseInt(_0x636577(0x1f8))/0xa)+parseInt(_0x636577(0x229))/0xb*(parseInt(_0x636577(0x298))/0xc)+-parseInt(_0x636577(0x2cb))/0xd*(parseInt(_0x636577(0x23c))/0xe);if(_0x149b62===_0x4cdb8d)break;else _0x2e3286['push'](_0x2e3286['shift']());}catch(_0x53cf2b){_0x2e3286['push'](_0x2e3286['shift']());}}}(_0x52f7,0x9c7c1));let express=require(_0x20551a(0x246)),router=express[_0x20551a(0x230)](),path=require(_0x20551a(0x247));const config=require('../../myConfig/config'),dbFileIndexTable=require(_0x20551a(0x2b4)),dbSourceFolderTable=require('../../db/dbSourceFolderTable'),dbFileOperationRecord=require(_0x20551a(0x2cd)),sqliteUtil=require(_0x20551a(0x1d0)),exifUtils=require(_0x20551a(0x1c8)),dbUserTable=require(_0x20551a(0x222)),dbAlbumTable=require('../../db/dbAlbumTable');let geohash=require(_0x20551a(0x1a4)),fs=require('fs');function _0x52f7(){const _0x9f0b3c=['insert','data','id,is_file,is_livephoto,path,filename,raw_filename,is_raw','piexifjs','dbFileIndex','year','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20face_name=?\x20and\x20belong_face_id\x20is\x20null','encode','SELECT\x20f.id\x20FROM\x20photo_faces2index\x20as\x20p\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20p.photo_index_id=f.id\x20WHERE\x20p.face_id=?\x20','.MP4','rawFile','8394830HsEXcV','mtime','orderField','create_time','imgList','startFaceAiWork','status','/getAiDealState','/switchFaceId','join','\x20and\x20a.is_face_poster=1\x20limit\x201','TYPE_DELETE','getById','/getPhotoClasses','run','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20geohash=?','faceapi','timeType','49704Jhblac','imagePreviewType','path_list','maxLng','faceIdList','similarIndexList','delete','UPDATE\x20photo_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','getMonth','indexId','\x20\x20\x20AND\x20in_trash!=1\x20','delete\x20from\x20photo_faces2index\x20where\x201=1','dbCity','desc','zoom','geoHashList','update\x20file_index_photo\x20set\x20phash=null,phash_compare=0','genTinyFile','returnErrMsg','/getPhotoByTime','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time,latitude,longitude\x20','getPhotoByParams','timestamp','4UqhooG','../../db/dbUserTable','.HEIC','/updateAlbum','libraryId','aiClassesEnable','video','/updatePhotoFace','2054041DEtOvK','getAllByWhereAndField','getTime','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20','dirname','\x20AND\x20\x20is_file=1\x20','\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)','Router','sendFile','is_admin','\x20AND\x20','\x20and\x20face_id=','paramsList','body','/resetSimilarPhotoAi','rawFaceIndexIdList','file_index_photo-indexing','abs','/resetFaceAi','56UdukXD','SELECT\x20*\x20FROM\x20ai_classes\x20where\x20\x20class_name\x20not\x20in\x20','geohash3\x20=\x20?','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20id\x20=\x20?','atleastChooseTwoFaces','\x20in_trash=1\x20and\x20is_file=1\x20','28bUuOLc','similar_index_id','/operationLibrary','album.sameNameExist','express','path','update\x20file_index_photo\x20set\x20ai_face_detect_state=0','power_get','post','9INhfFw','cachePath','indexObj','getFaceInSql','music','\x20id,geohash,latitude,longitude,original_time\x20','/addAlbum','\x20type=1\x20','LEVEL_MAIN_OPERATION','stat','chi','keepIndexList','\x20latitude=?,longitude=?,geohash=?,geohash5=?,geohash4=?,geohash3=?,geohash2=?\x20','latitude','replace','username','locationList','prepare','toLowerCase','title','\x20AND\x20geohash2!=\x27undefined\x27\x20GROUP\x20BY\x20geohash2','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20id=?','mode','create','isAdmin','similarWaitDealCount','getByName','.jpg','\x20original_time=?,original_date=?\x20','920364rqHyGD','dbOther','ctimeMs','/mergeFace','sourceFolderList','movie','INDEX_TABLE_NAME_BOOK','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_class_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27','\x20path=\x20?\x20AND\x20','sortField','doUserCanGet','photo','/restoreTrashBinFiles','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27','toString','operation','endsWith','resolve','844746pHZpGM','Cleaning\x20out\x20the\x20recycle\x20bin\x20:\x20','SELECT\x20f.id,f.path,f.filename,f.original_date,f.size\x20FROM\x20photo_phash_similar\x20as\x20a\x20inner\x20join\x20file_index_photo\x20as\x20f\x20on\x20a.similar_index_id=f.id\x20where\x20a.index_id=','.MOV','GPS','setFaceId','sep','basename','searchValue','showFileType','orderType','extract','close','update','count','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20photo_faces2index\x20WHERE\x20compare_state=0','INDEX_TABLE_NAME_PHOTO','getSharpInstanceFromInput','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=0\x20where\x20is_face_poster=1\x20and\x20face_id\x20in\x20','/clearTrashBin','addFileOperationRecord','geohash','getAllByWhereAndFieldFromOrdinaryAlbum','17AVLWty','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)\x20','getTimeLineDateList','getAllByWhereAndFieldFromOrdinaryAlbumCount','newDate','ordinaryAlbumId','findByTitle','12tkvhAr','\x20and\x20title\x20like\x20?','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27\x27\x20where\x20id=','dealList','aiFaceMinPhotoCount','query','文件写入成功','(\x27mouse\x27,\x27person\x27,\x27traffic\x20light\x27,\x27stop\x20sign\x27,\x27parking\x20meter\x27,\x27fire\x20hydrant\x27)','putInSystemTrash','class_id','f2y','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?','rotate','index_id','SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id\x20limit\x20','searchMode','存在livephoto','folderNotExist','\x20AND\x20geohash5!=\x27undefined\x27\x20GROUP\x20BY\x20geohash5','from','getPathWhere','\x20AND\x20geohash3!=\x27undefined\x27\x20GROUP\x20BY\x20geohash3','COCO_CLASS_MIN_SCORE','DELETE\x20FROM\x20photo_library\x20\x20WHERE\x20id=?','/getFaceImg/*','original_date','\x20AND\x20filename\x20LIKE\x20?\x20','checkSqlInjection','../../db/dbFileIndexTable','transSpcielFormat','ADD','STATE_SUC','targetFaceId','SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id','substring','splice','floor','moviePlaylongPressRate','\x20ORDER\x20BY\x20is_file\x20asc,\x20','GPSIFD','getRotateFromTags','get','INDEX_TABLE_NAME_MOVIE','disabled','faceName','\x20SET\x20in_trash=0\x20WHERE\x20in_trash=1','book','push','error\x20pathList','name','excludeFilenamePhoto','2915744ubZRXW','face_id','../../db/dbFileOperationRecord','f2height','search','/searchMode','indexOf','/getFileTreePhoto','existsSync','/getTimeLineDateList','dataPreview','operation\x20fail','\x20SET\x20in_trash=1,in_trash_time=','/dealSimilarPhoto','photoIndexId','sortType','getDate','minLng','SELECT\x20*\x20from\x20photo_phash_similar\x20where\x20index_id=','send','UPDATE\x20photo_faces\x20SET\x20face_name=null\x20where\x20face_name\x20=\x20?','key','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time\x20','f2x','jpeg','log','data_value','excludePathPhoto','DELETE\x20FROM\x20photo_faces2index\x20where\x20face_id=?\x20and\x20photo_index_id\x20=?','../../db/dbConfigTable','delete\x20from\x20photo_faces\x20where\x201=1','deleteRawTempFile','face_img_path','operationFail','albumId','whereStr','now','.JPG','changes','faceId','\x20order\x20by\x20f.original_time\x20desc\x20limit\x201','\x20AND\x20geohash4!=\x27undefined\x27\x20GROUP\x20BY\x20geohash4','getFileHashName','deleteList','5NJQpuu','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','facesPath','cocossd','resize','GPSLongitudeRef','type','DELETE\x20FROM\x20photo_phash_similar\x20where\x20index_id=?','\x20type=2\x20\x20','platform','\x20LIMIT\x20','REPLACE\x20INTO\x20photo_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','\x20OFFSET\x20','GET','utimes','shareForSubUser','\x20LIMIT\x20?\x20OFFSET\x20?','all','defaultMoviePlay','/deleteAlbum','trim','power_delete','getAllByWhere','extname','binary','SELECT\x20f.*,a.id\x20as\x20f2id,a.width\x20as\x20f2width,a.height\x20as\x20f2height,a.x\x20as\x20f2x,a.y\x20as\x20f2y\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20photo_faces2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20a.photo_index_id=f.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20a.face_id\x20in\x20','UPDATE\x20photo_faces2index\x20SET\x20face_id=?\x20WHERE\x20face_id=?\x20and\x20photo_index_id=?','raw_filename','value','DELETE','getCountByWhere','/getPhotoFaces','faceApiWaitCompareCount','\x20ORDER\x20BY\x20','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','GPSDateStamp','getPathByType','length','\x20WHERE\x20title\x20like\x20?','isIndexing','getAlbumWhereStr','minIndexId','ngeohash','/removeFromFace','updateBySql','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20share_for_subuser=1','includes','\x20in_trash=0\x20AND\x20latitude!=\x27undefined\x27\x20AND\x20longitude!=\x27undefined\x27\x20AND\x20latitude\x20is\x20not\x20null','app','/getSimilarPhoto','\x20WHERE\x20id\x20=\x20','fileExist','ERROR\x20GPS\x20LOCATION','rawFaceId','offset','json','geohash5\x20=\x20?','../utils/sharpUtils','SELECT\x20*\x20FROM\x20photo_faces\x20where\x20id\x20=?','Image\x20format\x20not\x20support','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_face_detect_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20','filename','stringify','noPermission','parse','power_change','\x20id\x20in\x20(','longitude','defaultTranscodeResolution','getUserPathWhere','toFile','photoPreviewSize','SELECT\x20*\x20FROM\x20file_index_photo\x20WHERE\x20in_trash=1\x20AND\x20is_file=1\x20AND\x20raw_filename\x20is\x20not\x20null\x20AND\x20raw_filename!=\x27\x27\x20AND\x20type=1','CUSTOM','indexFullPath','currentUser','getIndexTableNameByType','round','../../utils/exifUtils','end','is_livephoto','GPSLatitudeRef','geohash4\x20=\x20?','maxLat','aiFaceEnable','dialog','../utils/sqliteUtil','UPDATE\x20','getExcludePathWhereStr','trash','getList','is_file','EDIT','udpateName','INDEX_TABLE_NAME_MUSIC','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?\x20or\x20belong_face_id=?','/getBoundsPhoto','\x20AND\x20geohash\x20LIKE\x20?\x20','\x20LIMIT\x201','similar','/setFacePoster','readFile','original_time','shell','filename_number','geoInfoWriteErr','imagePreviewSize','./photoApiUtils','moviePreferLanguage','editId','GPSLongitude','UPDATE\x20photo_faces\x20SET\x20face_name=?\x20where\x20id\x20=\x20?','photo_index_id','510824kyFEGv','/getAlbumPhotoForMap'];_0x52f7=function(){return _0x9f0b3c;};return _0x52f7();}const dbConfigTable=require(_0x20551a(0x16b));let sharpUtil=require(_0x20551a(0x1b3));const photoApiUtil=require(_0x20551a(0x1e5)),platform=require('os')[_0x20551a(0x183)]();let piexif=require(_0x20551a(0x1f0));router[_0x20551a(0x24a)](_0x20551a(0x2d4),(_0x16eb43,_0x5807f0,_0x55627e)=>{const _0x2dc1d6=_0x20551a;if(dbUserTable[_0x2dc1d6(0x272)](_0x16eb43,_0x5807f0,_0x2dc1d6(0x273),_0x2dc1d6(0x249))==!![]){let _0x3a043c=_0x16eb43[_0x2dc1d6(0x236)][_0x2dc1d6(0x1f2)],_0x196ea0=_0x16eb43[_0x2dc1d6(0x236)]['type'],_0x36d69f=_0x16eb43[_0x2dc1d6(0x236)][_0x2dc1d6(0x28f)],_0x4f20dd=_0x16eb43[_0x2dc1d6(0x236)]['albumId'],_0x20c034=_0x16eb43[_0x2dc1d6(0x236)]['searchStr'],_0x20e862=_0x16eb43[_0x2dc1d6(0x236)]['ordinaryAlbumId'],_0x436fcb=_0x16eb43['body']['aiClassId'],_0x1799d1=_0x16eb43[_0x2dc1d6(0x236)][_0x2dc1d6(0x225)],_0x7396b8=_0x16eb43[_0x2dc1d6(0x236)][_0x2dc1d6(0x175)],_0x521c5d=_0x16eb43[_0x2dc1d6(0x236)]['timeOrder'],_0x160536=_0x16eb43[_0x2dc1d6(0x236)][_0x2dc1d6(0x26c)],_0x12094f=dbUserTable[_0x2dc1d6(0x1bf)](_0x16eb43,_0x2dc1d6(0x273),_0x2dc1d6(0x249),!![],_0x160536),_0x7500f=_0x12094f[_0x2dc1d6(0x171)],_0x5ecaaa=[..._0x12094f[_0x2dc1d6(0x235)]];_0x36d69f&&(_0x7500f+=_0x2dc1d6(0x1db),_0x5ecaaa[_0x2dc1d6(0x2c7)](_0x36d69f+'%'));let _0x449b16=dbSourceFolderTable[_0x2dc1d6(0x1d2)](_0x16eb43[_0x2dc1d6(0x1aa)][_0x2dc1d6(0x269)],'path',_0x2dc1d6(0x2e6));_0x449b16&&(_0x7500f+=_0x2dc1d6(0x233)+_0x449b16);let _0x2e4454=dbSourceFolderTable['getExcludePathWhereStr'](_0x16eb43[_0x2dc1d6(0x1aa)][_0x2dc1d6(0x269)],_0x2dc1d6(0x1b7),_0x2dc1d6(0x2ca));_0x2e4454&&(_0x7500f+=_0x2dc1d6(0x233)+_0x2e4454);if(_0x1799d1){let _0x4e0ac8=_0x16eb43[_0x2dc1d6(0x1aa)][_0x2dc1d6(0x1f1)]['prepare'](_0x2dc1d6(0x260))[_0x2dc1d6(0x2c1)](_0x1799d1);if(_0x4e0ac8)try{let _0x1a7178=JSON['parse'](_0x4e0ac8[_0x2dc1d6(0x20c)]),_0x5ea855=dbUserTable[_0x2dc1d6(0x2ac)](!![],_0x1a7178);_0x7500f+=_0x5ea855[_0x2dc1d6(0x171)],_0x5ecaaa=_0x5ecaaa['concat'](_0x5ea855[_0x2dc1d6(0x235)]);}catch(_0x5d4465){console[_0x2dc1d6(0x2e4)](_0x5d4465);}}if(_0x4f20dd){let _0x1d2a85=dbAlbumTable['getAlbumWhereStr'](_0x16eb43[_0x2dc1d6(0x1aa)][_0x2dc1d6(0x269)],_0x4f20dd);_0x1d2a85&&(_0x7500f+='\x20AND\x20'+_0x1d2a85);}_0x20c034&&(_0x7500f+=_0x2dc1d6(0x22f),_0x5ecaaa[_0x2dc1d6(0x2c7)]('%'+_0x20c034+'%'),_0x5ecaaa[_0x2dc1d6(0x2c7)]('%'+_0x20c034+'%'));_0x7500f+=_0x2dc1d6(0x214);let _0x9ddc73=dbFileIndexTable[_0x2dc1d6(0x293)](_0x16eb43[_0x2dc1d6(0x1aa)]['dbFileIndex'],_0x3a043c,_0x196ea0,_0x7500f,_0x20e862,_0x436fcb,_0x7396b8,_0x5ecaaa,_0x521c5d);_0x5807f0[_0x2dc1d6(0x1b1)]({'code':0x0,'data':_0x9ddc73});}});function _0x30f5(_0x401ff6,_0xc6a16d){const _0x52f73d=_0x52f7();return _0x30f5=function(_0x30f5e7,_0x247315){_0x30f5e7=_0x30f5e7-0x16b;let _0x317996=_0x52f73d[_0x30f5e7];return _0x317996;},_0x30f5(_0x401ff6,_0xc6a16d);}let geoDbCache={};router[_0x20551a(0x24a)](_0x20551a(0x21d),(_0x495343,_0x5d59f6,_0x5bb961)=>{const _0x5ab698=_0x20551a;if(dbUserTable[_0x5ab698(0x272)](_0x495343,_0x5d59f6,_0x5ab698(0x273),'power_get')==!![]){result=photoApiUtil[_0x5ab698(0x21f)](_0x495343,_0x5d59f6);let _0x2a439b=[],_0x6f85b9=[];try{let _0x1bbf18=Date[_0x5ab698(0x172)]();if(result&&result[_0x5ab698(0x19f)]>0x0){for(let _0x14597c of result){!_0x2a439b[_0x5ab698(0x1a8)](_0x14597c[_0x5ab698(0x2b1)])&&(_0x2a439b[_0x5ab698(0x2c7)](_0x14597c[_0x5ab698(0x2b1)]),_0x6f85b9[_0x5ab698(0x2c7)]({'date':_0x14597c['original_date'],'geoHashList':[],'locationList':[]}));if(_0x14597c[_0x5ab698(0x28f)]&&_0x14597c[_0x5ab698(0x28f)]!='undefined'&&_0x14597c['geohash'][_0x5ab698(0x19f)]>0x4){let _0x519d63=_0x6f85b9[_0x2a439b[_0x5ab698(0x2d1)](_0x14597c[_0x5ab698(0x2b1)])]['geoHashList'],_0x378de2=_0x14597c[_0x5ab698(0x28f)][_0x5ab698(0x2ba)](0x0,0x5);!_0x519d63[_0x5ab698(0x1a8)](_0x378de2)&&_0x519d63[_0x5ab698(0x19f)]<0x5&&_0x519d63['push'](_0x378de2);}}for(let _0xc8c514 of _0x6f85b9){if(_0xc8c514[_0x5ab698(0x219)]['length']<0x1)continue;for(let _0x358fc8 in _0xc8c514[_0x5ab698(0x219)]){let _0x26c519=_0xc8c514[_0x5ab698(0x219)][_0x358fc8][_0x5ab698(0x2ba)](0x0,0x5),_0xd0efa0=null;if(geoDbCache[_0x26c519])_0xd0efa0=geoDbCache[_0x26c519];else{let _0xfea392=_0x5ab698(0x207);_0xd0efa0=_0x495343[_0x5ab698(0x1aa)][_0x5ab698(0x216)][_0x5ab698(0x25c)](_0xfea392)['get'](_0x26c519),geoDbCache[_0x26c519]=_0xd0efa0;}_0xd0efa0&&_0xc8c514[_0x5ab698(0x25b)][_0x5ab698(0x2c7)](_0xd0efa0);}delete _0xc8c514[_0x5ab698(0x219)];}for(let _0x2a3f64=_0x6f85b9['length']-0x1;_0x2a3f64>=0x0;_0x2a3f64--){_0x6f85b9[_0x2a3f64][_0x5ab698(0x25b)][_0x5ab698(0x19f)]<0x1&&_0x6f85b9[_0x5ab698(0x2bb)](_0x2a3f64,0x1);}}}catch(_0x3cee59){console['log'](_0x3cee59);}let _0x10592c={'code':0x0,'data':result,'originalDateItemList':_0x6f85b9},_0x4c9223=dbConfigTable['findByTitle'](_0x495343[_0x5ab698(0x1aa)][_0x5ab698(0x269)],'photoPreviewType'),_0x21cef7=dbConfigTable[_0x5ab698(0x297)](_0x495343[_0x5ab698(0x1aa)][_0x5ab698(0x269)],_0x5ab698(0x1c1));_0x10592c[_0x5ab698(0x20b)]='RAW';if(_0x4c9223&&_0x4c9223[_0x5ab698(0x196)]=='CUSTOM'&&_0x21cef7&&_0x21cef7[_0x5ab698(0x196)])try{let _0x26b179=parseInt(_0x21cef7[_0x5ab698(0x196)]);_0x10592c[_0x5ab698(0x20b)]=_0x5ab698(0x1c3),_0x10592c[_0x5ab698(0x1e4)]=_0x26b179;}catch(_0x36f62c){console[_0x5ab698(0x2e4)](_0x36f62c);}_0x5d59f6[_0x5ab698(0x1b1)](_0x10592c);}}),router[_0x20551a(0x24a)](_0x20551a(0x1ec),(_0x27b3dd,_0x18f109,_0x497d00)=>{const _0x23068f=_0x20551a;let _0x45029a=_0x23068f(0x1a9),_0x702f48=[],_0x5f591c=_0x27b3dd[_0x23068f(0x236)][_0x23068f(0x225)];if(_0x27b3dd[_0x23068f(0x236)][_0x23068f(0x170)]){let _0x5d8663=dbAlbumTable[_0x23068f(0x1a2)](_0x27b3dd[_0x23068f(0x1aa)][_0x23068f(0x269)],_0x27b3dd[_0x23068f(0x236)][_0x23068f(0x170)]);_0x5d8663&&(_0x45029a+=_0x23068f(0x233)+_0x5d8663);}if(_0x5f591c){let _0x1ea5f9=_0x27b3dd[_0x23068f(0x1aa)][_0x23068f(0x1f1)][_0x23068f(0x25c)](_0x23068f(0x260))['get'](_0x5f591c);if(_0x1ea5f9)try{let _0x3cd281=JSON[_0x23068f(0x1ba)](_0x1ea5f9[_0x23068f(0x20c)]),_0x23a6e4=dbUserTable['getPathWhere'](!![],_0x3cd281);_0x45029a+=_0x23a6e4[_0x23068f(0x171)],_0x702f48[_0x23068f(0x2c7)](..._0x23a6e4[_0x23068f(0x235)]);}catch(_0x4afc6e){console['log'](_0x4afc6e);}}function _0x5a4bf7(_0x299f52,_0x3f2d81,_0x22be72){const _0x284544=_0x23068f;if(_0x22be72){let _0x16b93a=0x0;if(_0x27b3dd[_0x284544(0x236)][_0x284544(0x296)]){let _0x47b83b=dbFileIndexTable[_0x284544(0x294)](_0x27b3dd[_0x284544(0x1aa)][_0x284544(0x1f1)],_0x299f52,[parseInt(_0x27b3dd[_0x284544(0x236)][_0x284544(0x296)]),..._0x702f48]);_0x16b93a=_0x47b83b[_0x284544(0x288)];}else{let _0x7ff36a=dbFileIndexTable[_0x284544(0x198)](_0x27b3dd[_0x284544(0x1aa)][_0x284544(0x1f1)],_0x299f52,dbFileIndexTable[_0x284544(0x28a)],_0x702f48);_0x16b93a=_0x7ff36a[_0x284544(0x288)];}return _0x16b93a;}else{let _0x8c970=[];return _0x27b3dd[_0x284544(0x236)]['ordinaryAlbumId']?_0x8c970=dbFileIndexTable[_0x284544(0x290)](_0x27b3dd['app'][_0x284544(0x1f1)],_0x299f52,_0x3f2d81,[parseInt(_0x27b3dd[_0x284544(0x236)][_0x284544(0x296)]),..._0x702f48]):_0x8c970=dbFileIndexTable[_0x284544(0x22a)](_0x27b3dd[_0x284544(0x1aa)]['dbFileIndex'],_0x299f52,_0x3f2d81,dbFileIndexTable[_0x284544(0x28a)],_0x702f48),_0x8c970;}}let _0xfd6633=dbUserTable[_0x23068f(0x1bf)](_0x27b3dd,_0x23068f(0x273),_0x23068f(0x249),!![]),_0x50ee75=_0xfd6633[_0x23068f(0x171)];_0x45029a+=_0x50ee75,_0x702f48[_0x23068f(0x2c7)](..._0xfd6633[_0x23068f(0x235)]),_0x45029a+=_0x23068f(0x22e);let _0x20bce6=0xc8,_0x48ddd5=[],_0x280dba=_0x5a4bf7(_0x45029a,null,!![]);if(_0x280dba<_0x20bce6)_0x48ddd5=_0x5a4bf7(_0x45029a,'*');else{let _0x461a24=_0x45029a+_0x23068f(0x2aa),_0x214711=_0x5a4bf7(_0x461a24,'*');if(_0x214711&&_0x214711[_0x23068f(0x19f)]<_0x20bce6)_0x48ddd5=_0x214711;else{let _0x4c92ab=_0x45029a+_0x23068f(0x177),_0x5cad9f=_0x5a4bf7(_0x4c92ab,'*');if(_0x5cad9f&&_0x5cad9f[_0x23068f(0x19f)]<_0x20bce6)_0x48ddd5=_0x5cad9f;else{let _0x5adab9=_0x45029a+_0x23068f(0x2ad),_0x2e9f4b=_0x5a4bf7(_0x5adab9,'*');if(_0x2e9f4b&&_0x2e9f4b[_0x23068f(0x19f)]<_0x20bce6)_0x48ddd5=_0x2e9f4b;else{let _0xa542e7=_0x45029a+_0x23068f(0x25f);_0x48ddd5=_0x5a4bf7(_0xa542e7,'*');}}}}return _0x18f109[_0x23068f(0x1b1)]({'code':0x0,'mapPhoto':_0x48ddd5});}),router[_0x20551a(0x24a)](_0x20551a(0x1da),(_0x2ab6c1,_0x1023d3,_0x511067)=>{const _0x4a1fe2=_0x20551a;if(dbUserTable[_0x4a1fe2(0x272)](_0x2ab6c1,_0x1023d3,_0x4a1fe2(0x273),_0x4a1fe2(0x249))==!![]){let _0x4de383=_0x2ab6c1['body']['minLat'],_0x5ab2eb=_0x2ab6c1['body'][_0x4a1fe2(0x2dc)],_0x4caf62=_0x2ab6c1['body'][_0x4a1fe2(0x1cd)],_0x3ef6ea=_0x2ab6c1[_0x4a1fe2(0x236)][_0x4a1fe2(0x20d)],_0x560fde=_0x2ab6c1[_0x4a1fe2(0x236)][_0x4a1fe2(0x218)],_0x499cfa='',_0x2e8253=0x2;if(_0x560fde<=0x4)_0x2e8253=0x2,_0x499cfa='geohash2\x20=\x20?';else{if(_0x560fde<=0x6)_0x2e8253=0x3,_0x499cfa=_0x4a1fe2(0x23e);else _0x560fde<=0x8?(_0x2e8253=0x4,_0x499cfa=_0x4a1fe2(0x1cc)):(_0x2e8253=0x5,_0x499cfa=_0x4a1fe2(0x1b2));}let _0x47eaff=geohash['bboxes'](_0x4de383,_0x5ab2eb,_0x4caf62,_0x3ef6ea,_0x2e8253),_0x26b696=_0x4a1fe2(0x250),_0x15712b=[],_0x389f14=dbUserTable[_0x4a1fe2(0x1bf)](_0x2ab6c1,'photo',_0x4a1fe2(0x249),!![]);for(let _0x28ac8d=0x0;_0x28ac8d<_0x47eaff[_0x4a1fe2(0x19f)];_0x28ac8d++){let _0x85ba98=_0x47eaff[_0x28ac8d],_0x3d0fe3=[_0x85ba98,..._0x389f14[_0x4a1fe2(0x235)]],_0x509057='\x20'+_0x499cfa+'\x20'+_0x389f14[_0x4a1fe2(0x171)]+'\x20AND\x20in_trash=0\x20\x20AND\x20is_file=1\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20limit\x201',_0x104eb3=dbFileIndexTable['getByWhere'](_0x2ab6c1['app'][_0x4a1fe2(0x1f1)],_0x509057,_0x26b696,dbFileIndexTable[_0x4a1fe2(0x28a)],_0x3d0fe3);_0x104eb3&&_0x15712b[_0x4a1fe2(0x2c7)](_0x104eb3);}_0x1023d3['json']({'code':0x0,'mapPhoto':_0x15712b});}}),router['post'](_0x20551a(0x251),(_0x35f3e3,_0x126f73,_0x519e6a)=>{const _0x2ad497=_0x20551a;if(dbUserTable[_0x2ad497(0x272)](_0x35f3e3,_0x126f73,_0x2ad497(0x273),'power_add')==!![]){let _0x1b6d8b=_0x35f3e3['body'][_0x2ad497(0x180)],_0x221513=_0x35f3e3[_0x2ad497(0x236)]['data'],_0x2c0308=_0x35f3e3['body'][_0x2ad497(0x2e5)],_0xf4300e=_0x35f3e3[_0x2ad497(0x236)][_0x2ad497(0x2c9)],_0x2e06b1=_0x35f3e3['body'][_0x2ad497(0x1e7)];if(!_0x221513||!_0x221513[_0x2ad497(0x282)]||sqliteUtil[_0x2ad497(0x2b3)](_0x221513[_0x2ad497(0x282)])==!![])return _0x35f3e3['app'][_0x2ad497(0x21c)](_0x126f73,'error\x20data');if(!_0x2e06b1){let _0x34c809=dbAlbumTable[_0x2ad497(0x265)](_0x35f3e3[_0x2ad497(0x1aa)]['dbOther'],_0xf4300e);if(_0x34c809)return _0x35f3e3[_0x2ad497(0x1aa)][_0x2ad497(0x21c)](_0x126f73,_0x126f73['__'](_0x2ad497(0x245)));}let _0x28b2d6=null;_0x2e06b1?_0x28b2d6=dbAlbumTable[_0x2ad497(0x287)](_0x35f3e3[_0x2ad497(0x1aa)][_0x2ad497(0x269)],{'type':_0x1b6d8b,'data':_0x221513,'data_value':_0x2c0308,'name':_0xf4300e},_0x2e06b1):_0x28b2d6=dbAlbumTable[_0x2ad497(0x262)](_0x35f3e3['app']['dbOther'],{'type':_0x1b6d8b,'data':_0x221513,'data_value':_0x2c0308,'name':_0xf4300e}),_0x126f73[_0x2ad497(0x1b1)]({'code':0x0,'result':_0x28b2d6});}}),router[_0x20551a(0x24a)](_0x20551a(0x18d),(_0x39aef6,_0x185db0,_0x57ad68)=>{const _0x46f5e4=_0x20551a;if(dbUserTable[_0x46f5e4(0x272)](_0x39aef6,_0x185db0,_0x46f5e4(0x273),_0x46f5e4(0x18f))==!![]){let _0x5bd5bb=_0x39aef6[_0x46f5e4(0x236)]['id'],_0xe76bad=dbAlbumTable[_0x46f5e4(0x210)](_0x39aef6[_0x46f5e4(0x1aa)][_0x46f5e4(0x269)],_0x5bd5bb);_0xe76bad[_0x46f5e4(0x174)]>0x0?_0x185db0['json']({'code':0x0,'result':_0xe76bad}):_0x185db0[_0x46f5e4(0x1b1)]({'code':0x1,'message':_0x46f5e4(0x2d6)});}}),router['post'](_0x20551a(0x224),(_0x334290,_0x1bb408,_0x5550c9)=>{const _0x1279d0=_0x20551a;if(dbUserTable[_0x1279d0(0x272)](_0x334290,_0x1bb408,_0x1279d0(0x273),'power_change')==!![]){let _0x431e1c=_0x334290[_0x1279d0(0x236)]['id'],_0x488e10=_0x334290[_0x1279d0(0x236)][_0x1279d0(0x2c9)],_0x2155fc=dbAlbumTable[_0x1279d0(0x265)](_0x334290['app'][_0x1279d0(0x269)],_0x488e10);if(_0x2155fc)return _0x334290[_0x1279d0(0x1aa)][_0x1279d0(0x21c)](_0x1bb408,_0x1bb408['__'](_0x1279d0(0x245)));let _0x3c9ded=dbAlbumTable[_0x1279d0(0x1d7)](_0x334290[_0x1279d0(0x1aa)]['dbOther'],_0x431e1c,_0x488e10);_0x3c9ded['changes']>0x0?_0x1bb408[_0x1279d0(0x1b1)]({'code':0x0,'result':_0x3c9ded}):_0x1bb408[_0x1279d0(0x1b1)]({'code':0x1,'message':_0x1279d0(0x2d6)});}}),router[_0x20551a(0x24a)]('/getAllAlbum',(_0x305f75,_0x519eb6,_0xdc6bfb)=>{const _0x58169a=_0x20551a;if(dbUserTable[_0x58169a(0x272)](_0x305f75,_0x519eb6,_0x58169a(0x273),_0x58169a(0x249))==!![]){let _0x4ab0db=_0x305f75[_0x58169a(0x236)][_0x58169a(0x288)]||0x32,_0x1ba782=_0x305f75[_0x58169a(0x236)][_0x58169a(0x1b0)]||0x0,_0x33666f=_0x305f75['body'][_0x58169a(0x1fa)]||'id',_0x238f98=_0x305f75[_0x58169a(0x236)]['orderType']||_0x58169a(0x217),_0x56b144=_0x305f75[_0x58169a(0x236)][_0x58169a(0x2cf)],_0x2ae88a=dbAlbumTable[_0x58169a(0x1d4)](_0x305f75[_0x58169a(0x1aa)][_0x58169a(0x269)],_0x4ab0db,_0x1ba782,_0x33666f,_0x238f98,_0x56b144),_0x4b9b2f=dbUserTable[_0x58169a(0x1bf)](_0x305f75,'photo','power_get',!![]);for(let _0x53c37a=0x0;_0x53c37a<_0x2ae88a[_0x58169a(0x19f)];_0x53c37a++){let _0x44dea4='\x20is_file=1\x20';_0x44dea4+=_0x4b9b2f[_0x58169a(0x171)];let _0x490cbf=[..._0x4b9b2f[_0x58169a(0x235)]],_0x471207=dbAlbumTable[_0x58169a(0x1a2)](_0x305f75['app'][_0x58169a(0x269)],_0x2ae88a[_0x53c37a]['id']);_0x471207&&(_0x44dea4+=_0x58169a(0x233)+_0x471207);_0x44dea4+=_0x58169a(0x17b),_0x44dea4+='\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201';try{let _0x5271cb=dbFileIndexTable[_0x58169a(0x190)](_0x305f75[_0x58169a(0x1aa)]['dbFileIndex'],_0x44dea4,'*',dbFileIndexTable[_0x58169a(0x28a)],_0x490cbf);_0x2ae88a[_0x53c37a]['imgList']=_0x5271cb;}catch(_0x1f5e65){console[_0x58169a(0x2e4)](_0x1f5e65),_0x2ae88a[_0x53c37a][_0x58169a(0x1fc)]=[];}}_0x519eb6[_0x58169a(0x1b1)]({'code':0x0,'data':_0x2ae88a});}}),router[_0x20551a(0x24a)](_0x20551a(0x2d0),(_0x26ba34,_0x1be5b3,_0x14a7ac)=>{const _0x30ba57=_0x20551a;let _0x41bc1c=_0x26ba34['body'][_0x30ba57(0x2e0)],_0x40b4d3=dbFileIndexTable[_0x30ba57(0x2a7)](_0x26ba34['app'][_0x30ba57(0x1f1)],_0x41bc1c),_0x274028=[];for(let _0x1a2b53=0x0;_0x1a2b53<_0x40b4d3[_0x30ba57(0x19f)];_0x1a2b53++){_0x274028[_0x30ba57(0x2c7)](_0x40b4d3[_0x1a2b53][_0x30ba57(0x261)]);}_0x1be5b3[_0x30ba57(0x1b1)]({'code':0x0,'data':_0x274028});}),router[_0x20551a(0x24a)](_0x20551a(0x2d2),(_0x38249f,_0x3c18e3,_0x4f47b7)=>{const _0x27f672=_0x20551a;let _0x583d33=_0x38249f[_0x27f672(0x236)]['parent'],_0x280a39=_0x38249f['body']['serveType'],_0x37ed47=_0x38249f['body'][_0x27f672(0x288)],_0x2d6aac=_0x38249f[_0x27f672(0x236)][_0x27f672(0x1b0)]||0x0;_0x2d6aac=parseInt(_0x2d6aac);let _0x1580d4=parseInt(_0x38249f[_0x27f672(0x236)][_0x27f672(0x283)]),_0x40d194=_0x38249f[_0x27f672(0x236)]['searchStr'],_0xecfd9d=['filename',_0x27f672(0x1e0),'size',_0x27f672(0x1fb),_0x27f672(0x1e2)],_0x207f11=['asc',_0x27f672(0x217)],_0x2eb732=_0x38249f['body'][_0x27f672(0x1fa)]||'id',_0x4d7eed=_0x38249f['body'][_0x27f672(0x284)]||_0x27f672(0x217);!_0xecfd9d[_0x27f672(0x1a8)](_0x2eb732)&&(_0x2eb732='id');!_0x207f11[_0x27f672(0x1a8)](_0x4d7eed)&&(_0x2eb732=_0x27f672(0x217));if(dbUserTable[_0x27f672(0x272)](_0x38249f,_0x3c18e3,_0x280a39,'power_get')==!![]){let _0x17573a=[];if(!_0x583d33){let _0x30d001=[];_0x38249f['currentUser']['is_admin']==0x1?_0x30d001=dbSourceFolderTable[_0x27f672(0x19e)](_0x38249f[_0x27f672(0x1aa)]['dbOther'],_0x280a39):_0x30d001=dbUserTable['getUserPower'](_0x38249f['app'][_0x27f672(0x269)],_0x38249f[_0x27f672(0x1c5)][_0x27f672(0x25a)],_0x280a39);if(_0x30d001)for(let _0x29f219=0x0;_0x29f219<_0x30d001[_0x27f672(0x19f)];_0x29f219++){_0x17573a[_0x27f672(0x2c7)]({'path':_0x30d001[_0x29f219][_0x27f672(0x247)],'is_file':0x0,'filename':path[_0x27f672(0x281)](_0x30d001[_0x29f219][_0x27f672(0x247)]),'root':!![]});}}else{if(_0x38249f[_0x27f672(0x1c5)][_0x27f672(0x232)]!=0x1){if(dbUserTable[_0x27f672(0x272)](_0x38249f,_0x3c18e3,_0x280a39,_0x27f672(0x249),_0x583d33)!==!![])return;}_0x583d33=path[_0x27f672(0x279)](path['normalize'](_0x583d33));let _0x4cfb3a=_0x27f672(0x270),_0x460e54=[_0x583d33];if(_0x1580d4==0x0)_0x4cfb3a+='\x20(((type=1\x20or\x20type=2)\x20\x20)\x20OR\x20is_file=0\x20)\x20';else{if(_0x1580d4==0x1)_0x4cfb3a+=_0x27f672(0x252);else{if(_0x1580d4==0x2)_0x4cfb3a+=_0x27f672(0x182);else _0x1580d4==0x3&&(_0x4cfb3a+='\x20is_file=0\x20');}}if(_0x40d194){let _0x5e993a=_0x27f672(0x292);_0x460e54[_0x27f672(0x2c7)]('%'+_0x40d194+'%','\x27%'+_0x40d194+'%\x27'),_0x280a39=='movie'&&(_0x5e993a=_0x27f672(0x2b2),_0x460e54[_0x27f672(0x2c7)]('\x27%'+_0x40d194+'%\x27')),_0x4cfb3a+=_0x5e993a;}let _0x16ee3=_0x27f672(0x21e),_0x143d68=dbFileIndexTable[_0x27f672(0x1c6)](_0x280a39);if(_0x280a39==_0x27f672(0x26d))_0x16ee3=_0x27f672(0x2e1);else _0x280a39==_0x27f672(0x24f)&&(_0x16ee3='\x20is_file,id,path,filename,ext,duration,size\x20');_0x4cfb3a+=_0x27f672(0x2be)+_0x2eb732+'\x20'+_0x4d7eed+_0x27f672(0x184)+_0x37ed47+_0x27f672(0x186)+_0x2d6aac,_0x17573a=dbFileIndexTable[_0x27f672(0x190)](_0x38249f[_0x27f672(0x1aa)][_0x27f672(0x1f1)],_0x4cfb3a,_0x16ee3,_0x143d68,_0x460e54);}let _0x6789f8=path[_0x27f672(0x280)],_0x41d128={'platform':platform,'code':0x0,'data':_0x17573a,'sep':_0x6789f8};return _0x3c18e3[_0x27f672(0x1b1)](_0x41d128);}}),router['post']('/getIndexDetail',(_0x295308,_0x520d77,_0x43bb93)=>{const _0x479266=_0x20551a;let _0x388ce9=_0x295308[_0x479266(0x236)]['id'],_0x5d40cb=_0x295308['body']['serverType'],_0x59f958=dbFileIndexTable[_0x479266(0x28a)];if(_0x5d40cb==_0x479266(0x26d))_0x59f958=dbFileIndexTable[_0x479266(0x2c2)];else{if(_0x5d40cb=='music')_0x59f958=dbFileIndexTable[_0x479266(0x1d8)];else _0x5d40cb==_0x479266(0x2c6)&&(_0x59f958=dbFileIndexTable[_0x479266(0x26e)]);}let _0x4d1633=dbFileIndexTable[_0x479266(0x204)](_0x295308['app'][_0x479266(0x1f1)],_0x388ce9,_0x59f958);if(!_0x4d1633)return _0x520d77['status'](0x194)['end']();if(dbUserTable[_0x479266(0x272)](_0x295308,_0x520d77,'',_0x479266(0x249),_0x4d1633[_0x479266(0x247)])==!![]){let _0x4d51c6={'code':0x0,'data':_0x4d1633};if(_0x5d40cb==_0x479266(0x26d)){let _0x2cd22b=dbConfigTable[_0x479266(0x297)](_0x295308[_0x479266(0x1aa)]['dbOther'],_0x479266(0x1e6));_0x4d51c6[_0x479266(0x1e6)]=_0x2cd22b?_0x2cd22b['value']:_0x479266(0x255),_0x4d51c6[_0x479266(0x1ee)][_0x479266(0x1e6)]=_0x4d51c6['moviePreferLanguage'];let _0x4e3c04=dbConfigTable[_0x479266(0x297)](_0x295308[_0x479266(0x1aa)][_0x479266(0x269)],_0x479266(0x2bd));_0x4d51c6[_0x479266(0x2bd)]=_0x4e3c04?_0x4e3c04[_0x479266(0x196)]:'2',_0x4d51c6[_0x479266(0x1ee)]['moviePlaylongPressRate']=_0x4d51c6[_0x479266(0x2bd)];let _0x28e88e=dbConfigTable[_0x479266(0x297)](_0x295308[_0x479266(0x1aa)][_0x479266(0x269)],_0x479266(0x1be));_0x4d51c6[_0x479266(0x1be)]=_0x28e88e?_0x28e88e['value']:'3';let _0x2ca48a=dbConfigTable[_0x479266(0x297)](_0x295308['app'][_0x479266(0x269)],_0x479266(0x18c));_0x4d51c6[_0x479266(0x18c)]=_0x2ca48a?_0x2ca48a['value']:_0x479266(0x1f7);let _0x516dd3=path[_0x479266(0x201)](_0x4d1633[_0x479266(0x247)],_0x4d1633[_0x479266(0x1b7)]);fs[_0x479266(0x254)](_0x516dd3,(_0x31df97,_0x4cdf18)=>{const _0x41b1fa=_0x479266;return _0x31df97?(_0x4d51c6[_0x41b1fa(0x1ad)]=0x0,_0x4d51c6[_0x41b1fa(0x1c4)]=_0x516dd3):(_0x4d51c6[_0x41b1fa(0x1ad)]=0x1,_0x4d51c6[_0x41b1fa(0x1c4)]=_0x516dd3),_0x520d77[_0x41b1fa(0x1b1)](_0x4d51c6);});}else return _0x520d77[_0x479266(0x1b1)](_0x4d51c6);}}),router[_0x20551a(0x24a)]('/editExifByIndexId',(_0x2dc219,_0xedd3ae,_0x1e4abc)=>{const _0x1b5381=_0x20551a;if(dbUserTable[_0x1b5381(0x272)](_0x2dc219,_0xedd3ae,_0x1b5381(0x273),'power_change')==!![]){let _0x1593e0=_0x2dc219[_0x1b5381(0x236)]['id'],_0x11b58a=_0x2dc219[_0x1b5381(0x236)][_0x1b5381(0x258)],_0x4bdb02=_0x2dc219[_0x1b5381(0x236)][_0x1b5381(0x1bd)],_0x5c9f44=_0x2dc219['body'][_0x1b5381(0x295)],_0x3da277=dbFileIndexTable[_0x1b5381(0x204)](_0x2dc219['app']['dbFileIndex'],_0x1593e0);if(!_0x3da277)return _0x2dc219['app'][_0x1b5381(0x21c)](_0xedd3ae,_0xedd3ae['__']('photoSavedAsNewFile'));let _0x521f2b=path[_0x1b5381(0x201)](_0x3da277['path'],path['sep'],_0x3da277[_0x1b5381(0x1b7)]),_0x31c5c2=path[_0x1b5381(0x191)](_0x521f2b)?path[_0x1b5381(0x191)](_0x521f2b)[_0x1b5381(0x25d)]():'';if(_0x31c5c2!=_0x1b5381(0x266)&&_0x31c5c2!='.jpeg')return _0x2dc219[_0x1b5381(0x1aa)]['returnErrMsg'](_0xedd3ae,_0x1b5381(0x1b5));fs[_0x1b5381(0x254)](_0x521f2b,(_0x58515e,_0x42a5ac)=>{const _0x3bda65=_0x1b5381;if(_0x58515e||!_0x42a5ac['isFile']())return _0x2dc219[_0x3bda65(0x1aa)][_0x3bda65(0x21c)](_0xedd3ae,_0xedd3ae['__'](_0x3bda65(0x2a9)));if(_0x58515e||!_0x42a5ac['isFile']())return _0x2dc219[_0x3bda65(0x1aa)]['returnErrMsg'](_0xedd3ae,_0xedd3ae['__']('folderNotExist'));fs[_0x3bda65(0x1df)](_0x521f2b,(_0x19eada,_0x2ca0a5)=>{const _0x1506e2=_0x3bda65;if(_0x19eada)return _0x2dc219[_0x1506e2(0x1aa)][_0x1506e2(0x21c)](_0xedd3ae,_0xedd3ae['__'](_0x1506e2(0x16f)));var _0x5aea76=piexif['load'](_0x2ca0a5[_0x1506e2(0x276)](_0x1506e2(0x192)));if(_0x11b58a&&_0x4bdb02){function _0x3b084b(_0x252f5d){const _0x3aee70=_0x1506e2;try{_0x252f5d=Number(_0x252f5d);let _0x43a89d=Math[_0x3aee70(0x2bc)](Math[_0x3aee70(0x23a)](_0x252f5d)),_0x5374c6=(Math[_0x3aee70(0x23a)](_0x252f5d)-_0x43a89d)*0x3c,_0x76558e=Math[_0x3aee70(0x2bc)](_0x5374c6),_0xcaa219=Math[_0x3aee70(0x1c7)]((_0x5374c6-_0x76558e)*0x3c*0x64);return[[_0x43a89d,0x1],[_0x76558e,0x1],[_0xcaa219,0x64]];}catch(_0x26c970){return'';}}let _0x3bf2db=_0x3b084b(_0x11b58a),_0x9882ed=_0x3b084b(_0x4bdb02);if(!_0x9882ed||!_0x3bf2db)return _0x2dc219['app'][_0x1506e2(0x21c)](_0xedd3ae,_0x1506e2(0x1ae));_0x5aea76[_0x1506e2(0x27e)][piexif[_0x1506e2(0x2bf)][_0x1506e2(0x1cb)]]=_0x11b58a>=0x0?'N':'S',_0x5aea76[_0x1506e2(0x27e)][piexif[_0x1506e2(0x2bf)]['GPSLatitude']]=_0x3bf2db,(_0x5aea76[_0x1506e2(0x27e)][piexif['GPSIFD'][_0x1506e2(0x17f)]]=_0x4bdb02>=0x0?'E':'W',_0x5aea76[_0x1506e2(0x27e)][piexif[_0x1506e2(0x2bf)][_0x1506e2(0x1e8)]]=_0x9882ed);let _0xc08556=geohash[_0x1506e2(0x1f4)](_0x11b58a,_0x4bdb02,0x8),_0x466780=_0xc08556['substring'](0x0,0x5),_0x2e401d=_0xc08556[_0x1506e2(0x2ba)](0x0,0x4),_0x5f0048=_0xc08556[_0x1506e2(0x2ba)](0x0,0x3),_0x565399=_0xc08556[_0x1506e2(0x2ba)](0x0,0x2),_0x3c3870=[_0x11b58a,_0x4bdb02,_0xc08556,_0x466780,_0x2e401d,_0x5f0048,_0x565399];dbFileIndexTable[_0x1506e2(0x1a6)](_0x2dc219['app'][_0x1506e2(0x1f1)],_0x3da277['id'],_0x1506e2(0x257),dbFileIndexTable[_0x1506e2(0x28a)],_0x3c3870);}if(_0x5c9f44){_0x5aea76['Exif'][piexif['ExifIFD']['DateTimeOriginal']]=_0x5c9f44,_0x5aea76[_0x1506e2(0x27e)][piexif[_0x1506e2(0x2bf)][_0x1506e2(0x19d)]]=_0x5c9f44;let _0x293764=new Date(_0x5c9f44),_0x2298da=_0x293764[_0x1506e2(0x22b)](),_0x2783c1=_0x293764['getFullYear'](),_0x4b551e=_0x293764[_0x1506e2(0x212)]()+0x1;_0x4b551e=_0x4b551e>=0xa?_0x4b551e:'0'+_0x4b551e;let _0x5e7816=_0x293764[_0x1506e2(0x2db)]();_0x5e7816=_0x5e7816>=0xa?_0x5e7816:'0'+_0x5e7816;let _0xe166a=_0x2783c1+'-'+_0x4b551e+'-'+_0x5e7816,_0x23f9c8=[_0x2298da,_0xe166a];dbFileIndexTable[_0x1506e2(0x1a6)](_0x2dc219[_0x1506e2(0x1aa)][_0x1506e2(0x1f1)],_0x3da277['id'],_0x1506e2(0x267),dbFileIndexTable[_0x1506e2(0x28a)],_0x23f9c8);}try{var _0x26f44a=piexif['dump'](_0x5aea76),_0x32dc7f=piexif[_0x1506e2(0x1ed)](_0x26f44a,_0x2ca0a5[_0x1506e2(0x276)](_0x1506e2(0x192)));let _0x425bdb=path[_0x1506e2(0x201)](_0x3da277['path'],_0x3da277[_0x1506e2(0x1b7)]);fs['writeFile'](_0x425bdb,Buffer[_0x1506e2(0x2ab)](_0x32dc7f,_0x1506e2(0x192)),{},_0x21f098=>{const _0xa28c8c=_0x1506e2;if(_0x21f098)return console[_0xa28c8c(0x2e4)](_0x21f098),_0x2dc219[_0xa28c8c(0x1aa)][_0xa28c8c(0x21c)](_0xedd3ae,_0xedd3ae['__'](_0xa28c8c(0x16f)));console[_0xa28c8c(0x2e4)](_0xa28c8c(0x29e)),fs[_0xa28c8c(0x188)](_0x425bdb,new Date(_0x3da277[_0xa28c8c(0x1f9)]),new Date(_0x3da277['mtime']),_0x18c709=>{const _0x17607d=_0xa28c8c;_0x18c709&&console[_0x17607d(0x2e4)](_0x18c709),fs['stat'](_0x425bdb,(_0x199c68,_0x320946)=>{const _0x5718a1=_0x17607d;if(_0x199c68)return _0x2dc219['app'][_0x5718a1(0x21c)](_0xedd3ae,_0xedd3ae['__'](_0x5718a1(0x16f)));let _0x255fff=[_0x320946['size'],_0x320946['ctimeMs']];return dbFileIndexTable['updateBySql'](_0x2dc219[_0x5718a1(0x1aa)]['dbFileIndex'],_0x3da277['id'],'\x20size=?,ctime=?\x20',dbFileIndexTable[_0x5718a1(0x28a)],_0x255fff),_0xedd3ae[_0x5718a1(0x1b1)]({'code':0x0,'newIndex':dbFileIndexTable[_0x5718a1(0x204)](_0x2dc219['app'][_0x5718a1(0x1f1)],_0x3da277['id'])});});});});}catch(_0x1941f9){return console[_0x1506e2(0x2e4)](_0x1941f9),_0x2dc219[_0x1506e2(0x1aa)][_0x1506e2(0x21c)](_0xedd3ae,_0xedd3ae['__'](_0x1506e2(0x1e3)));}});});}}),router[_0x20551a(0x24a)](_0x20551a(0x205),(_0x318fe4,_0x50e1b5,_0x313f8b)=>{const _0x320b6f=_0x20551a;if(dbUserTable['doUserCanGet'](_0x318fe4,_0x50e1b5,_0x320b6f(0x273),_0x320b6f(0x249))==!![]){let _0x81b33=dbConfigTable[_0x320b6f(0x297)](_0x318fe4['app'][_0x320b6f(0x269)],_0x320b6f(0x226));if(!_0x81b33||_0x81b33[_0x320b6f(0x196)]!='1')return _0x50e1b5[_0x320b6f(0x1b1)]({'code':0x0,'data':[],'enable':![]});let _0x1f11a3=_0x320b6f(0x29f),_0xf1477f=dbUserTable[_0x320b6f(0x1bf)](_0x318fe4,_0x320b6f(0x273),_0x320b6f(0x249),!![]),_0x1e4c93=[],_0x141484=_0x318fe4[_0x320b6f(0x1aa)]['dbFileIndex'][_0x320b6f(0x25c)](_0x320b6f(0x23d)+_0x1f11a3)[_0x320b6f(0x18b)](),_0x12da67=[];for(let _0x5ae283 in _0x141484){let _0x1052b3=_0x141484[_0x5ae283];_0x1e4c93=[_0x1052b3['id'],dbFileIndexTable[_0x320b6f(0x2ae)],..._0xf1477f[_0x320b6f(0x235)]];let _0x391fa5=_0x318fe4['app'][_0x320b6f(0x1f1)][_0x320b6f(0x25c)]('SELECT\x20f.id\x20as\x20photo_index_id\x20FROM\x20ai_classes2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20a.photo_index_id=f.id\x20WHERE\x20a.class_id=?\x20and\x20score>?\x20and\x20\x20f.in_trash=0\x20\x20and\x20f.tiny_path\x20is\x20not\x20null\x20AND\x20f.tiny_path\x20!=\x20\x270\x27\x20\x20'+_0xf1477f['whereStr']+'\x20order\x20by\x20score\x20desc')[_0x320b6f(0x2c1)](_0x1e4c93);if(_0x391fa5)_0x141484[_0x5ae283][_0x320b6f(0x1ea)]=_0x391fa5[_0x320b6f(0x1ea)],_0x141484[_0x5ae283][_0x320b6f(0x2a1)]=_0x141484[_0x5ae283]['id'],_0x12da67[_0x320b6f(0x2c7)](_0x141484[_0x5ae283]);else continue;}_0x50e1b5['json']({'code':0x0,'data':_0x12da67,'enable':!![]});}}),router[_0x20551a(0x24a)](_0x20551a(0x199),(_0x9949dd,_0x499955,_0x39d727)=>{const _0x4c5a1a=_0x20551a;if(dbUserTable[_0x4c5a1a(0x272)](_0x9949dd,_0x499955,'photo',_0x4c5a1a(0x249))==!![]){let _0x21f182=dbConfigTable[_0x4c5a1a(0x297)](_0x9949dd['app'][_0x4c5a1a(0x269)],_0x4c5a1a(0x1ce));if(!_0x21f182||_0x21f182['value']!='1')return _0x499955[_0x4c5a1a(0x1b1)]({'code':0x0,'data':[],'enable':![]});let _0x33e6cf=0x5,_0x15d9d0=dbConfigTable[_0x4c5a1a(0x297)](_0x9949dd[_0x4c5a1a(0x1aa)]['dbOther'],_0x4c5a1a(0x29c));_0x15d9d0&&_0x15d9d0['value']&&(_0x15d9d0[_0x4c5a1a(0x196)]>0x0&&(_0x33e6cf=_0x15d9d0[_0x4c5a1a(0x196)]));let _0x5b92a6=_0x9949dd[_0x4c5a1a(0x1aa)][_0x4c5a1a(0x1f1)][_0x4c5a1a(0x25c)]('SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20disabled=0\x20and\x20belong_face_id\x20is\x20null\x20and\x20face_photo_count>=?\x20order\x20by\x20face_photo_count\x20desc\x20limit\x20500')['all'](parseInt(_0x33e6cf)),_0x5f4bb6=[];if(_0x9949dd[_0x4c5a1a(0x1c5)]['is_admin']==0x1)_0x5f4bb6=_0x5b92a6;else{let _0x37b6a3=dbUserTable[_0x4c5a1a(0x1bf)](_0x9949dd,'photo',_0x4c5a1a(0x249),!![]);for(let _0x215c6b of _0x5b92a6){try{let _0x5091cc=[_0x215c6b['id'],..._0x37b6a3['paramsList']],_0x26c69e=_0x9949dd['app'][_0x4c5a1a(0x1f1)][_0x4c5a1a(0x25c)](_0x4c5a1a(0x1f5)+_0x37b6a3['whereStr']+_0x4c5a1a(0x1dc))[_0x4c5a1a(0x2c1)](_0x5091cc);_0x26c69e&&_0x5f4bb6[_0x4c5a1a(0x2c7)](_0x215c6b);}catch(_0x1860ee){console[_0x4c5a1a(0x2e4)](_0x1860ee),_0x5f4bb6[_0x4c5a1a(0x2c7)](_0x215c6b);}}}_0x499955[_0x4c5a1a(0x1b1)]({'code':0x0,'data':_0x5f4bb6,'enable':!![]});}}),router['post'](_0x20551a(0x1de),(_0x108975,_0x2b420a,_0x7c4701)=>{const _0x46a6fe=_0x20551a;let _0xd1d1cc=_0x108975[_0x46a6fe(0x236)][_0x46a6fe(0x27f)],_0x5d303b=_0x108975[_0x46a6fe(0x236)][_0x46a6fe(0x1af)],_0x1d3842=_0x108975[_0x46a6fe(0x236)][_0x46a6fe(0x2d9)];if(dbUserTable[_0x46a6fe(0x272)](_0x108975,_0x2b420a,_0x46a6fe(0x273),_0x46a6fe(0x1bb))==!![]){let _0x38c22d=dbFileIndexTable[_0x46a6fe(0x24e)](_0x108975[_0x46a6fe(0x1aa)][_0x46a6fe(0x1f1)],_0xd1d1cc);_0x108975['app'][_0x46a6fe(0x1f1)]['prepare'](_0x46a6fe(0x28c)+_0x38c22d)[_0x46a6fe(0x206)](),_0x108975[_0x46a6fe(0x1aa)][_0x46a6fe(0x1f1)][_0x46a6fe(0x25c)]('UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=1\x20where\x20photo_index_id\x20=\x20'+_0x1d3842+_0x46a6fe(0x234)+_0x5d303b)[_0x46a6fe(0x206)](),_0x108975[_0x46a6fe(0x1aa)][_0x46a6fe(0x1f1)]['prepare'](_0x46a6fe(0x29a)+_0xd1d1cc)[_0x46a6fe(0x206)](),_0x2b420a['json']({'code':0x0});}}),router[_0x20551a(0x24a)](_0x20551a(0x1a5),(_0x4c8086,_0x25e624,_0x454bcc)=>{const _0x54a0b7=_0x20551a;let _0xe7d968=_0x4c8086['body'][_0x54a0b7(0x179)];try{_0xe7d968=JSON['parse'](_0xe7d968);}catch(_0x5c3b28){console['log'](_0x5c3b28);}if(dbUserTable[_0x54a0b7(0x272)](_0x4c8086,_0x25e624,_0x54a0b7(0x273),_0x54a0b7(0x1bb))==!![]){for(let _0x4bc3fa of _0xe7d968){_0x4c8086['app'][_0x54a0b7(0x1f1)]['prepare'](_0x54a0b7(0x2e7))['run'](parseInt(_0x4bc3fa[_0x54a0b7(0x175)]),parseInt(_0x4bc3fa[_0x54a0b7(0x213)]));}_0x25e624['json']({'code':0x0});}}),router[_0x20551a(0x24a)](_0x20551a(0x228),(_0xc9417a,_0x33c2a9,_0x411547)=>{const _0x2b774a=_0x20551a;if(dbUserTable[_0x2b774a(0x272)](_0xc9417a,_0x33c2a9,_0x2b774a(0x273),_0x2b774a(0x1bb))==!![]){let _0x44f54f=_0xc9417a[_0x2b774a(0x236)][_0x2b774a(0x2c4)],_0x26af35=_0xc9417a[_0x2b774a(0x236)][_0x2b774a(0x2c3)],_0x1ea5fb=_0xc9417a[_0x2b774a(0x236)][_0x2b774a(0x175)],_0x1e6de3=_0xc9417a['body']['faceIdList'];if(_0x44f54f){_0x44f54f=_0x44f54f[_0x2b774a(0x18e)]();let _0x4d99c6=_0xc9417a['app'][_0x2b774a(0x1f1)][_0x2b774a(0x25c)](_0x2b774a(0x1f3))[_0x2b774a(0x2c1)](_0x44f54f);_0x4d99c6&&_0x4d99c6['id']!=_0x1ea5fb?_0xc9417a[_0x2b774a(0x1aa)][_0x2b774a(0x1f1)][_0x2b774a(0x25c)](_0x2b774a(0x2a3))['run'](_0x4d99c6['id'],_0x1ea5fb):(_0xc9417a[_0x2b774a(0x1aa)]['dbFileIndex']['prepare'](_0x2b774a(0x2df))['run'](_0x44f54f),_0xc9417a[_0x2b774a(0x1aa)][_0x2b774a(0x1f1)][_0x2b774a(0x25c)](_0x2b774a(0x1e9))[_0x2b774a(0x206)](_0x44f54f,_0x1ea5fb));}if(parseInt(_0x26af35)==0x0||parseInt(_0x26af35)==0x1){if(_0x1e6de3){let _0x1fdbbe=_0x2b774a(0x1bc);for(let _0x3b2c0a in _0x1e6de3){_0x1fdbbe+=_0x1e6de3[_0x3b2c0a],_0x3b2c0a!=_0x1e6de3['length']-0x1&&(_0x1fdbbe+=',');}_0x1fdbbe+=')';let _0x17001a=_0x2b774a(0x22c)+_0x1fdbbe;_0xc9417a[_0x2b774a(0x1aa)][_0x2b774a(0x1f1)]['prepare'](_0x17001a)[_0x2b774a(0x206)](_0x26af35);}else _0xc9417a['app'][_0x2b774a(0x1f1)]['prepare'](_0x2b774a(0x23f))[_0x2b774a(0x206)](_0x26af35,_0x1ea5fb);}return _0x33c2a9[_0x2b774a(0x1b1)]({'code':0x0});}}),router[_0x20551a(0x24a)](_0x20551a(0x26b),(_0x13db55,_0x467f71,_0x47eff4)=>{const _0x3d578d=_0x20551a;if(dbUserTable[_0x3d578d(0x272)](_0x13db55,_0x467f71,_0x3d578d(0x273),_0x3d578d(0x1bb))==!![]){let _0x85a479=_0x13db55[_0x3d578d(0x236)][_0x3d578d(0x20e)];if(!_0x85a479||_0x85a479[_0x3d578d(0x19f)]<0x2)return _0x13db55[_0x3d578d(0x1aa)][_0x3d578d(0x21c)](_0x467f71,_0x467f71['__'](_0x3d578d(0x240)));let _0x46dbe5=_0x13db55[_0x3d578d(0x1aa)]['dbFileIndex']['prepare']('SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20id=?')['get'](_0x85a479[0x0]);if(!_0x46dbe5)return _0x13db55[_0x3d578d(0x1aa)]['returnErrMsg'](_0x467f71,_0x467f71['__'](_0x3d578d(0x16f)));for(let _0x13294d=0x1;_0x13294d<_0x85a479['length'];_0x13294d++){let _0x339434=_0x85a479[_0x13294d];_0x13db55[_0x3d578d(0x1aa)]['dbFileIndex'][_0x3d578d(0x25c)](_0x3d578d(0x1d9))[_0x3d578d(0x206)](_0x46dbe5['id'],_0x339434,_0x339434);}return process[_0x3d578d(0x2de)]({'type':_0x3d578d(0x1fd)}),_0x467f71[_0x3d578d(0x1b1)]({'code':0x0});}}),router[_0x20551a(0x2c1)](_0x20551a(0x2b0),(_0x2f7d2f,_0x8ea978,_0x3f8331)=>{const _0x1046db=_0x20551a;let _0x5a63b2=_0x2f7d2f[_0x1046db(0x29d)][_0x1046db(0x175)];if(dbUserTable[_0x1046db(0x272)](_0x2f7d2f,_0x8ea978,'photo',_0x1046db(0x249))==!![]){let _0x13d1b8=_0x2f7d2f[_0x1046db(0x1aa)][_0x1046db(0x1f1)][_0x1046db(0x25c)](_0x1046db(0x1b4))[_0x1046db(0x2c1)](_0x5a63b2);if(!_0x13d1b8)return _0x8ea978[_0x1046db(0x1fe)](0x194)[_0x1046db(0x1c9)]();_0x2f7d2f[_0x1046db(0x1c5)]['is_admin']!=0x1?_0x15800e(![]):!_0x13d1b8[_0x1046db(0x16e)]?_0x15800e(!![]):fs[_0x1046db(0x254)](_0x13d1b8[_0x1046db(0x16e)],(_0x4ac07a,_0x3e4f91)=>{const _0x4f17c3=_0x1046db;if(!_0x4ac07a){let _0xbace6b=new Date()[_0x4f17c3(0x22b)](),_0x5a6ee3=0x48*0xe10*0x3e8;if(_0x3e4f91[_0x4f17c3(0x26a)]){let _0xe966b2=_0xbace6b-_0x3e4f91[_0x4f17c3(0x26a)];if(_0xe966b2>_0x5a6ee3)return _0x15800e(!![]);}return _0x8ea978[_0x4f17c3(0x231)](_0x13d1b8[_0x4f17c3(0x16e)]);}_0x15800e(!![]);});function _0x15800e(_0xc27933){const _0x28ec7f=_0x1046db;let _0x5e5d4c=dbFileIndexTable['getFaceInSql'](_0x2f7d2f['app'][_0x28ec7f(0x1f1)],_0x5a63b2),_0x554908=_0x28ec7f(0x193)+_0x5e5d4c+'\x20',_0x241d3c=[];if(_0x2f7d2f[_0x28ec7f(0x1c5)][_0x28ec7f(0x232)]!=0x1){let _0x4033b2=dbUserTable[_0x28ec7f(0x1bf)](_0x2f7d2f,_0x28ec7f(0x273),_0x28ec7f(0x249),!![]);_0x554908+=_0x4033b2[_0x28ec7f(0x171)],_0x241d3c=_0x241d3c['concat'](_0x4033b2[_0x28ec7f(0x235)]);}let _0x522705=_0x2f7d2f[_0x28ec7f(0x1aa)]['dbFileIndex']['prepare'](_0x554908+_0x28ec7f(0x202))[_0x28ec7f(0x2c1)](_0x241d3c);if(!_0x522705){_0x522705=_0x2f7d2f[_0x28ec7f(0x1aa)]['dbFileIndex'][_0x28ec7f(0x25c)](_0x554908+_0x28ec7f(0x176))['get'](_0x241d3c);if(!_0x522705)return _0x8ea978[_0x28ec7f(0x1fe)](0x194)['end']();}if(!_0x522705)return _0x8ea978[_0x28ec7f(0x1fe)](0x194)[_0x28ec7f(0x1c9)]();let _0x4cf526=path[_0x28ec7f(0x201)](_0x522705['path'],_0x522705[_0x28ec7f(0x1b7)]);if(parseInt(_0x522705[_0x28ec7f(0x180)])==0x2){let _0x3c9d43=config[_0x28ec7f(0x178)](_0x522705),_0x33c761=path[_0x28ec7f(0x201)](config[_0x28ec7f(0x24c)],_0x3c9d43);sharpUtil[_0x28ec7f(0x21b)](_0x4cf526,path[_0x28ec7f(0x22d)](_0x33c761),path[_0x28ec7f(0x281)](_0x33c761),_0x28ec7f(0x227),_0x522705,_0xeaaf8b=>{_0x4cf526=_0x33c761,_0x2c9b3b();},_0x3a078c=>{const _0x1e4b79=_0x28ec7f;return _0x8ea978['status'](0x194)[_0x1e4b79(0x1c9)]();});}else _0x2c9b3b();function _0x2c9b3b(){const _0x53ca31=_0x28ec7f;let _0x556f21=path[_0x53ca31(0x201)](config[_0x53ca31(0x17c)],_0x522705['f2id']+new Date()['getTime']()+_0x53ca31(0x266)),_0x234c1e=0x7d0;sharpUtil[_0x53ca31(0x2b5)](_0x4cf526,(_0x2772bb,_0x4932ed,_0x573aeb)=>{const _0xc2bfbd=_0x53ca31;let _0x5a674d=parseInt(_0x522705['f2width']*1.4),_0x48ee48=parseInt(_0x522705['f2height']*1.4),_0x440ab3=parseInt(_0x522705['f2x']-_0x5a674d*0.2),_0x3bd506=parseInt(_0x522705[_0xc2bfbd(0x2a2)]-_0x48ee48*0.2);if(_0x3bd506<0x0)_0x3bd506=0x0;if(_0x440ab3<0x0)_0x440ab3=0x0;_0x2d6c9d(_0x2772bb,_0x4932ed,_0x573aeb,_0x440ab3,_0x3bd506,_0x5a674d,_0x48ee48,()=>{const _0xb954a1=_0xc2bfbd;let _0x570dd8=parseInt(_0x522705['f2width']),_0x6d725a=parseInt(_0x522705[_0xb954a1(0x2ce)]),_0xb7ce2=parseInt(_0x522705[_0xb954a1(0x2e2)]),_0x1d1de3=parseInt(_0x522705[_0xb954a1(0x2a2)]);if(_0x1d1de3<0x0)_0x1d1de3=0x0;if(_0xb7ce2<0x0)_0xb7ce2=0x0;_0x2d6c9d(_0x2772bb,_0x4932ed,_0x573aeb,_0xb7ce2,_0x1d1de3,_0x570dd8,_0x6d725a);});});function _0x2d6c9d(_0x12919a,_0x1a2feb,_0x52fe19,_0x3b3f07,_0x286c28,_0x4497ab,_0x11b4da,_0x29c600){const _0x355672=_0x53ca31;let _0x4edb96=sharpUtil[_0x355672(0x28b)](_0x12919a),_0x3d0b6b=exifUtils[_0x355672(0x2c0)](_0x52fe19);_0x3d0b6b?_0x4edb96=_0x4edb96[_0x355672(0x2a4)](_0x3d0b6b):_0x4edb96=_0x4edb96[_0x355672(0x2a4)](),_0x4edb96[_0x355672(0x17e)]({'width':_0x234c1e,'height':_0x234c1e,'withoutEnlargement':!![]})[_0x355672(0x2e3)]()[_0x355672(0x285)]({'left':_0x3b3f07,'top':_0x286c28,'width':_0x4497ab,'height':_0x11b4da})[_0x355672(0x1c0)](_0x556f21,function(_0x3aee83){const _0x540ea6=_0x355672;if(_0x3aee83){_0x1a2feb&&sharpUtil[_0x540ea6(0x16d)](_0x12919a);if(_0x29c600)_0x29c600();else return _0x8ea978['status'](0x194)[_0x540ea6(0x1c9)]();}else{_0x1a2feb&&sharpUtil[_0x540ea6(0x16d)](_0x12919a);if(_0xc27933)return _0x2f7d2f[_0x540ea6(0x1aa)][_0x540ea6(0x1f1)][_0x540ea6(0x25c)](_0x540ea6(0x275)+_0x556f21+'\x27\x20where\x20id='+_0x5a63b2)[_0x540ea6(0x206)](),_0x8ea978[_0x540ea6(0x231)](_0x556f21);else _0x8ea978[_0x540ea6(0x231)](_0x556f21),_0x8ea978['on'](_0x540ea6(0x286),()=>{fs['rm'](_0x556f21,_0x38af12=>{});});}});}}}}}),router[_0x20551a(0x24a)](_0x20551a(0x200),(_0x4c9ce4,_0x2fbcc2,_0x532fcd)=>{const _0x2a35c1=_0x20551a;let _0x3ef47f=_0x4c9ce4[_0x2a35c1(0x236)][_0x2a35c1(0x2b8)],_0x16ddb1=_0x4c9ce4[_0x2a35c1(0x236)][_0x2a35c1(0x238)],_0x1062db=[];if(!_0x3ef47f||!_0x16ddb1)return _0x2fbcc2[_0x2a35c1(0x1b1)]({'code':0x0,'sucIdList':_0x1062db});try{_0x16ddb1=JSON['parse'](_0x16ddb1);for(let _0x2c0ffd in _0x16ddb1){let _0x535077=_0x16ddb1[_0x2c0ffd],_0x1ea3b9=_0x4c9ce4[_0x2a35c1(0x1aa)][_0x2a35c1(0x1f1)][_0x2a35c1(0x25c)](_0x2a35c1(0x194))[_0x2a35c1(0x206)](parseInt(_0x3ef47f),parseInt(_0x535077[_0x2a35c1(0x2cc)]),parseInt(_0x535077[_0x2a35c1(0x1ea)]));_0x1062db['push'](_0x535077['photo_index_id']);}return _0x2fbcc2[_0x2a35c1(0x1b1)]({'code':0x0,'sucIdList':_0x1062db});}catch(_0x37562b){return console['log'](_0x37562b),_0x2fbcc2[_0x2a35c1(0x1b1)]({'code':0x0,'sucIdList':_0x1062db});}}),router['post'](_0x20551a(0x1ff),(_0xf4d738,_0x14cd65,_0x5967cf)=>{const _0x29f116=_0x20551a;let _0x59a5c5=_0xf4d738[_0x29f116(0x236)]['type'],_0x2984b9={};if(_0xf4d738[_0x29f116(0x1c5)][_0x29f116(0x232)]==0x1){if(!_0x59a5c5||_0x59a5c5==_0x29f116(0x208)){let _0x321a5c=_0xf4d738[_0x29f116(0x1aa)][_0x29f116(0x1f1)][_0x29f116(0x25c)](_0x29f116(0x1b6))[_0x29f116(0x2c1)]();_0x2984b9['faceApiWaitDealCount']=_0x321a5c[_0x29f116(0x288)];if(_0x321a5c[_0x29f116(0x288)]<0x1){let _0x1d3dbe=_0xf4d738['app']['dbFileIndex']['prepare'](_0x29f116(0x289))[_0x29f116(0x2c1)]();_0x2984b9[_0x29f116(0x19a)]=_0x1d3dbe['count'];}}if(!_0x59a5c5||_0x59a5c5==_0x29f116(0x17d)){let _0xb39245=_0xf4d738[_0x29f116(0x1aa)][_0x29f116(0x1f1)]['prepare'](_0x29f116(0x26f))[_0x29f116(0x2c1)]();_0x2984b9['cocossdWaitDealCount']=_0xb39245[_0x29f116(0x288)];}if(!_0x59a5c5||_0x59a5c5==_0x29f116(0x1dd)){let _0x528514=_0xf4d738[_0x29f116(0x1aa)][_0x29f116(0x1f1)][_0x29f116(0x25c)]('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20phash\x20is\x20null\x20and\x20type=1')[_0x29f116(0x2c1)]();_0x2984b9[_0x29f116(0x264)]=_0x528514['count'];}}let _0x5f1a07=dbConfigTable[_0x29f116(0x297)](_0xf4d738[_0x29f116(0x1aa)][_0x29f116(0x269)],_0x29f116(0x239)),_0x5ef84f=0x0;return!_0x5f1a07?_0x5ef84f=0x0:_0x5ef84f=_0x5f1a07[_0x29f116(0x196)],_0x2984b9[_0x29f116(0x1a1)]=_0x5ef84f,_0x14cd65[_0x29f116(0x1b1)]({'code':0x0,'data':_0x2984b9});}),router[_0x20551a(0x24a)](_0x20551a(0x23b),(_0x58036a,_0x141cb7,_0x595026)=>{const _0x42da5b=_0x20551a;if(dbUserTable[_0x42da5b(0x272)](_0x58036a,_0x141cb7,_0x42da5b(0x273),_0x42da5b(0x1bb))==!![])try{fs['rm'](config[_0x42da5b(0x17c)],{'recursive':!![]},_0x451b4e=>{const _0x3aa73f=_0x42da5b;if(_0x451b4e)return console[_0x3aa73f(0x2e4)](_0x451b4e),_0x58036a['app'][_0x3aa73f(0x21c)](_0x141cb7,_0x141cb7['__']('cacheDeleteFail')+':'+config[_0x3aa73f(0x17c)],_0x3aa73f(0x1cf));fs['mkdir'](config['facesPath'],_0x34d28a=>{const _0x5df8f2=_0x3aa73f;if(_0x34d28a)return _0x58036a[_0x5df8f2(0x1aa)][_0x5df8f2(0x21c)](_0x141cb7,_0x141cb7['__'](_0x5df8f2(0x16f)),'dialog');let _0x8a461a=_0x58036a[_0x5df8f2(0x1aa)][_0x5df8f2(0x1f1)]['transaction'](()=>{const _0x30b536=_0x5df8f2;return _0x58036a[_0x30b536(0x1aa)][_0x30b536(0x1f1)][_0x30b536(0x25c)](_0x30b536(0x16c))[_0x30b536(0x206)](),_0x58036a['app']['dbFileIndex'][_0x30b536(0x25c)](_0x30b536(0x215))[_0x30b536(0x206)](),_0x58036a[_0x30b536(0x1aa)][_0x30b536(0x1f1)][_0x30b536(0x25c)](_0x30b536(0x248))[_0x30b536(0x206)](),process[_0x30b536(0x2de)]({'type':_0x30b536(0x1fd)}),_0x141cb7[_0x30b536(0x1b1)]({'code':0x0});});_0x8a461a();});});}catch(_0x566761){return _0x58036a[_0x42da5b(0x1aa)]['returnErrMsg'](_0x141cb7,_0x141cb7['__'](_0x42da5b(0x16f)),_0x42da5b(0x1cf));}}),router[_0x20551a(0x24a)](_0x20551a(0x237),(_0x58903a,_0x511a1b,_0x4364a6)=>{const _0x19a465=_0x20551a;if(dbUserTable['doUserCanGet'](_0x58903a,_0x511a1b,_0x19a465(0x273),_0x19a465(0x1bb))==!![])try{let _0x2477d2=_0x58903a['app'][_0x19a465(0x1f1)]['transaction'](()=>{const _0x572671=_0x19a465;return _0x58903a['app'][_0x572671(0x1f1)][_0x572671(0x25c)]('delete\x20from\x20photo_phash_similar\x20where\x201=1')[_0x572671(0x206)](),_0x58903a[_0x572671(0x1aa)][_0x572671(0x1f1)]['prepare'](_0x572671(0x21a))[_0x572671(0x206)](),process[_0x572671(0x2de)]({'type':'startSimilarPhotoWork'}),_0x511a1b['json']({'code':0x0});});_0x2477d2();}catch(_0x24ff44){return _0x58903a[_0x19a465(0x1aa)]['returnErrMsg'](_0x511a1b,_0x511a1b['__'](_0x19a465(0x16f)),_0x19a465(0x1cf));}}),router['post'](_0x20551a(0x1ab),(_0x2debf7,_0xfb10ed,_0x17cb4e)=>{const _0xe97f48=_0x20551a;if(dbUserTable[_0xe97f48(0x263)](_0x2debf7,_0xfb10ed)!==!![])return;let _0x3939f9=dbConfigTable['findByTitle'](_0x2debf7[_0xe97f48(0x1aa)]['dbOther'],'aiSimilarPhotoEnable');if(!_0x3939f9||_0x3939f9[_0xe97f48(0x196)]!='1')return _0xfb10ed[_0xe97f48(0x1b1)]({'code':0x0,'data':[],'enable':![]});let _0x1ea1b4=_0x2debf7[_0xe97f48(0x236)][_0xe97f48(0x1a3)];if(!_0x1ea1b4)_0x1ea1b4=0x0;let _0x557de9=_0x2debf7[_0xe97f48(0x236)][_0xe97f48(0x288)];if(!_0x557de9||_0x557de9>0x64)_0x557de9=0x64;let _0x39809d=[],_0x54d178=_0x2debf7[_0xe97f48(0x1aa)][_0xe97f48(0x1f1)][_0xe97f48(0x25c)](_0xe97f48(0x2b9))[_0xe97f48(0x18b)](),_0x283ac7=_0x2debf7[_0xe97f48(0x1aa)][_0xe97f48(0x1f1)][_0xe97f48(0x25c)](_0xe97f48(0x2a6)+_0x557de9)[_0xe97f48(0x18b)]();for(let _0x5ec06b in _0x283ac7){let _0x5b49de=_0x283ac7[_0x5ec06b],_0x2f6e07=_0x2debf7[_0xe97f48(0x1aa)][_0xe97f48(0x1f1)][_0xe97f48(0x25c)]('SELECT\x20id,path,filename,original_date,size\x20FROM\x20file_index_photo\x20where\x20id='+_0x5b49de[_0xe97f48(0x2a5)])[_0xe97f48(0x2c1)](),_0x551485=_0x2debf7[_0xe97f48(0x1aa)][_0xe97f48(0x1f1)]['prepare'](_0xe97f48(0x27c)+_0x5b49de[_0xe97f48(0x2a5)])['all']();_0x283ac7[_0x5ec06b][_0xe97f48(0x24d)]=_0x2f6e07,_0x283ac7[_0x5ec06b][_0xe97f48(0x20f)]=[_0x2f6e07],_0x283ac7[_0x5ec06b][_0xe97f48(0x20f)][_0xe97f48(0x2c7)](..._0x551485),_0x283ac7[_0x5ec06b][_0xe97f48(0x20f)]['length']>0x1?_0x39809d['push'](_0x283ac7[_0x5ec06b]):_0x2debf7[_0xe97f48(0x1aa)][_0xe97f48(0x1f1)][_0xe97f48(0x25c)](_0xe97f48(0x181))[_0xe97f48(0x206)](_0x5b49de['index_id']);}return _0xfb10ed[_0xe97f48(0x1b1)]({'code':0x0,'data':_0x39809d,'enable':!![],'waitDealCount':_0x54d178[_0xe97f48(0x19f)]});}),router[_0x20551a(0x24a)](_0x20551a(0x2d8),(_0xd18549,_0x452035,_0x525599)=>{const _0x550d7c=_0x20551a;if(dbUserTable[_0x550d7c(0x263)](_0xd18549,_0x452035)!==!![])return;let _0x3da564=_0xd18549[_0x550d7c(0x236)][_0x550d7c(0x29b)];for(let _0x1309dd in _0x3da564){let _0x4813b0=_0xd18549[_0x550d7c(0x1aa)][_0x550d7c(0x1f1)]['prepare'](_0x550d7c(0x2dd)+_0x3da564[_0x1309dd]['index_id'])[_0x550d7c(0x18b)]();for(let _0x3846c3 in _0x4813b0){if(!_0x3da564[_0x1309dd][_0x550d7c(0x256)][_0x550d7c(0x1a8)](parseInt(_0x4813b0[_0x3846c3]['similar_index_id']))){let _0xa1845d=new Date()[_0x550d7c(0x22b)]();_0xd18549[_0x550d7c(0x1aa)][_0x550d7c(0x1f1)][_0x550d7c(0x25c)](_0x550d7c(0x1d1)+dbFileIndexTable[_0x550d7c(0x28a)]+_0x550d7c(0x2d7)+_0xa1845d+_0x550d7c(0x1ac)+_0x4813b0[_0x3846c3][_0x550d7c(0x243)])[_0x550d7c(0x206)]();}}if(!_0x3da564[_0x1309dd][_0x550d7c(0x256)][_0x550d7c(0x1a8)](parseInt(_0x3da564[_0x1309dd][_0x550d7c(0x2a5)]))){let _0x17f1ac=new Date()[_0x550d7c(0x22b)]();_0xd18549['app'][_0x550d7c(0x1f1)][_0x550d7c(0x25c)]('UPDATE\x20'+dbFileIndexTable[_0x550d7c(0x28a)]+'\x20SET\x20in_trash=1,in_trash_time='+_0x17f1ac+_0x550d7c(0x1ac)+_0x3da564[_0x1309dd][_0x550d7c(0x2a5)])[_0x550d7c(0x206)]();}_0xd18549[_0x550d7c(0x1aa)]['dbFileIndex'][_0x550d7c(0x25c)]('delete\x20from\x20photo_phash_similar\x20where\x20index_id='+_0x3da564[_0x1309dd][_0x550d7c(0x2a5)])[_0x550d7c(0x206)]();}return _0x452035[_0x550d7c(0x1b1)]({'code':0x0});}),router[_0x20551a(0x24a)](_0x20551a(0x274),(_0x841769,_0x4bc288,_0xbb6f43)=>{const _0x127d00=_0x20551a;if(dbUserTable[_0x127d00(0x272)](_0x841769,_0x4bc288,_0x127d00(0x273),_0x127d00(0x1bb),'')==!![]){let _0x3578cf=_0x841769[_0x127d00(0x1aa)][_0x127d00(0x1f1)]['prepare'](_0x127d00(0x1c2))[_0x127d00(0x18b)]();for(let _0x312624 of _0x3578cf){_0x841769['app'][_0x127d00(0x1f1)]['prepare'](_0x127d00(0x19c))['run'](_0x312624[_0x127d00(0x247)],_0x312624[_0x127d00(0x195)]);}return _0x841769[_0x127d00(0x1aa)][_0x127d00(0x1f1)][_0x127d00(0x25c)](_0x127d00(0x1d1)+dbFileIndexTable[_0x127d00(0x28a)]+_0x127d00(0x2c5))[_0x127d00(0x206)](),_0x4bc288[_0x127d00(0x1b1)]({'code':0x0});}}),router[_0x20551a(0x24a)](_0x20551a(0x28d),(_0x4ebad2,_0x4b7425,_0x4108cb)=>{const _0x518079=_0x20551a;let _0x1b57a6=_0x4ebad2[_0x518079(0x236)][_0x518079(0x2a0)],_0x1c48b5=dbFileIndexTable[_0x518079(0x190)](_0x4ebad2[_0x518079(0x1aa)][_0x518079(0x1f1)],_0x518079(0x241),_0x518079(0x1ef),dbFileIndexTable[_0x518079(0x28a)]),_0x49e1c7=dbFileIndexTable[_0x518079(0x28a)];console['log'](_0x518079(0x27b)+_0x1c48b5[_0x518079(0x19f)]);function _0x10d32d(_0x1306fd,_0x376536){const _0x6212a8=_0x518079;dbFileOperationRecord[_0x6212a8(0x28e)](_0x4ebad2['app'][_0x6212a8(0x269)],{'username':_0x4ebad2[_0x6212a8(0x1c5)][_0x6212a8(0x25a)],'targetPath':_0x1306fd,'level':dbFileOperationRecord[_0x6212a8(0x253)],'type':dbFileOperationRecord[_0x6212a8(0x203)],'state':_0x376536?dbFileOperationRecord[_0x6212a8(0x2b7)]:dbFileOperationRecord['STATE_FAIL']});}function _0x1272e5(_0x5b9e89){const _0x38fdab=_0x518079;if(_0x5b9e89[_0x38fdab(0x1d5)]==0x1&&_0x5b9e89[_0x38fdab(0x1ca)]==0x1){let _0x360d2c=path['join'](_0x5b9e89[_0x38fdab(0x247)],_0x5b9e89['filename'][_0x38fdab(0x259)](_0x38fdab(0x27d),'')+_0x38fdab(0x223));_0x5b9e89[_0x38fdab(0x1b7)][_0x38fdab(0x278)](_0x38fdab(0x1f6))&&(_0x360d2c=path[_0x38fdab(0x201)](_0x5b9e89[_0x38fdab(0x247)],_0x5b9e89[_0x38fdab(0x1b7)][_0x38fdab(0x259)]('.MP4','')+_0x38fdab(0x173))),fs[_0x38fdab(0x2d3)](_0x360d2c)&&(console[_0x38fdab(0x2e4)](_0x38fdab(0x2a8),_0x360d2c),_0xf5d10d(_0x5b9e89,_0x360d2c,![]));}}function _0xf5d10d(_0x2cde81,_0x24499d,_0x14621f){const _0x196b3a=_0x518079;_0x1b57a6==0x1?(process[_0x196b3a(0x2de)]({'type':_0x196b3a(0x1e1),'shellType':'trash','path':_0x24499d}),_0x10d32d(_0x24499d,!![])):fs['rm'](_0x24499d,{'recursive':!![]},_0x269d28=>{_0x269d28?_0x10d32d(_0x24499d,![]):_0x10d32d(_0x24499d,!![]);}),_0x14621f&&_0x1272e5(_0x2cde81);}function _0x8caead(_0x2dbe5e){const _0x52ca4b=_0x518079;dbFileIndexTable[_0x52ca4b(0x210)](_0x4ebad2[_0x52ca4b(0x1aa)]['dbFileIndex'],_0x2dbe5e['id'],_0x49e1c7);}for(let _0x5b7978 in _0x1c48b5){let _0x4944a6=_0x1c48b5[_0x5b7978];if(_0x4944a6){if(dbUserTable[_0x518079(0x272)](_0x4ebad2,_0x4b7425,'photo',_0x518079(0x18f),_0x4944a6['path'])==!![]){let _0x413918=path['join'](_0x4944a6['path'],path[_0x518079(0x280)],_0x4944a6[_0x518079(0x1b7)]);_0x8caead(_0x4944a6),_0xf5d10d(_0x4944a6,_0x413918,!![]);}}}return _0x4b7425['json']({'code':0x0});}),router[_0x20551a(0x24a)](_0x20551a(0x244),(_0x281a93,_0x53df6d,_0x3e6226)=>{const _0x2a6c4c=_0x20551a;let _0x28f52b=_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x25e)],_0x238dff=_0x281a93['body'][_0x2a6c4c(0x225)],_0x3e4848=_0x281a93['body']['pathList'],_0x11b7e3=_0x281a93[_0x2a6c4c(0x236)]['shareUidList'],_0x188004=_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x189)],_0x589e06=_0x281a93['body'][_0x2a6c4c(0x277)];if(_0x589e06==_0x2a6c4c(0x187)){let _0x283c34=_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x1b0)]||0x0,_0x54424f=_0x281a93[_0x2a6c4c(0x236)]['count']||0x32,_0x1ebf08=_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x2cf)]||'',_0x9bfeb1=_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x1fa)]||'create_time',_0x2f6883=_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x284)]||_0x2a6c4c(0x217);if(!['create_time','title'][_0x2a6c4c(0x1a8)](_0x9bfeb1))return console[_0x2a6c4c(0x2e4)]('order\x20field\x20error',_0x9bfeb1),[];let _0x49aca7=[],_0x32eabb=[],_0x4e24b6='SELECT\x20*\x20FROM\x20photo_library\x20';_0x281a93[_0x2a6c4c(0x1c5)][_0x2a6c4c(0x232)]==0x1?_0x1ebf08&&(_0x4e24b6+=_0x2a6c4c(0x1a0),_0x32eabb[_0x2a6c4c(0x2c7)]('%'+_0x1ebf08+'%')):(_0x4e24b6=_0x2a6c4c(0x1a7),_0x1ebf08&&(_0x4e24b6+=_0x2a6c4c(0x299),_0x32eabb['push']('%'+_0x1ebf08+'%')));_0x4e24b6+=_0x2a6c4c(0x19b)+_0x9bfeb1+'\x20'+_0x2f6883+_0x2a6c4c(0x18a),_0x32eabb[_0x2a6c4c(0x2c7)](_0x54424f),_0x32eabb[_0x2a6c4c(0x2c7)](_0x283c34),_0x49aca7=_0x281a93[_0x2a6c4c(0x1aa)][_0x2a6c4c(0x1f1)]['prepare'](_0x4e24b6)['all'](_0x32eabb);if(_0x49aca7[_0x2a6c4c(0x19f)]<0x1)return _0x53df6d[_0x2a6c4c(0x1b1)]({'code':0x0,'data':[]});for(let _0x5af25b in _0x49aca7){let _0x15c876=_0x49aca7[_0x5af25b];try{let _0x1a3f20=JSON[_0x2a6c4c(0x1ba)](_0x15c876['share_uid']),_0x50801a=[];for(let _0x175308 of _0x1a3f20){let _0x4fede7=dbUserTable['findWithField'](_0x281a93[_0x2a6c4c(0x1aa)][_0x2a6c4c(0x269)],_0x175308,'id,username');_0x50801a[_0x2a6c4c(0x2c7)](_0x4fede7);}_0x49aca7[_0x5af25b]['user_list']=_0x50801a;}catch(_0x1b1291){console[_0x2a6c4c(0x2e4)](_0x1b1291);}_0x281a93['body'][_0x2a6c4c(0x288)]=0x4,_0x281a93['body']['excludeIds']=[],_0x281a93['body']['fileType']=0x0,_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x271)]='original_time',_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x2da)]='desc',_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x209)]=0x1,_0x281a93['body'][_0x2a6c4c(0x220)]=0x9184e729fff,_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x1d3)]=0x0,_0x281a93[_0x2a6c4c(0x236)][_0x2a6c4c(0x225)]=_0x49aca7[_0x5af25b]['id'],_0x49aca7[_0x5af25b][_0x2a6c4c(0x2d5)]=photoApiUtil[_0x2a6c4c(0x21f)](_0x281a93,_0x53df6d);}return _0x53df6d[_0x2a6c4c(0x1b1)]({'code':0x0,'data':_0x49aca7});}else{if(_0x281a93[_0x2a6c4c(0x1c5)][_0x2a6c4c(0x232)]!=0x1)return _0x281a93[_0x2a6c4c(0x1aa)][_0x2a6c4c(0x21c)](_0x53df6d,_0x53df6d['__']('noPermission'));if(_0x589e06=='ADD'||_0x589e06==_0x2a6c4c(0x1d6)){if(!_0x3e4848||!_0x3e4848 instanceof Array||_0x3e4848[_0x2a6c4c(0x19f)]<0x1)return _0x281a93[_0x2a6c4c(0x1aa)]['returnErrMsg'](_0x53df6d,_0x53df6d['__'](_0x2a6c4c(0x16f)));if(_0x188004){if(_0x11b7e3!=null&&!_0x11b7e3 instanceof Array)return _0x281a93['app'][_0x2a6c4c(0x21c)](_0x53df6d,_0x53df6d['__']('operationFail'));}if(sqliteUtil[_0x2a6c4c(0x2b3)](JSON[_0x2a6c4c(0x1b8)](_0x3e4848))==!![])return _0x281a93[_0x2a6c4c(0x1aa)][_0x2a6c4c(0x21c)](_0x53df6d,_0x2a6c4c(0x2c8));}if(_0x589e06==_0x2a6c4c(0x1d6)&&_0x238dff)_0x281a93[_0x2a6c4c(0x1aa)][_0x2a6c4c(0x1f1)][_0x2a6c4c(0x25c)](_0x2a6c4c(0x211))[_0x2a6c4c(0x206)](_0x28f52b,JSON['stringify'](_0x3e4848),_0x188004,JSON[_0x2a6c4c(0x1b8)](_0x11b7e3),_0x238dff);else{if(_0x589e06==_0x2a6c4c(0x197)&&_0x238dff)_0x281a93['app'][_0x2a6c4c(0x1f1)][_0x2a6c4c(0x25c)](_0x2a6c4c(0x2af))[_0x2a6c4c(0x206)](_0x238dff);else{if(_0x589e06==_0x2a6c4c(0x2b6))_0x281a93['app'][_0x2a6c4c(0x1f1)]['prepare'](_0x2a6c4c(0x185))[_0x2a6c4c(0x206)](_0x28f52b,JSON[_0x2a6c4c(0x1b8)](_0x3e4848),_0x188004,JSON[_0x2a6c4c(0x1b8)](_0x11b7e3),_0x281a93[_0x2a6c4c(0x1c5)]['id']);else return _0x281a93[_0x2a6c4c(0x1aa)][_0x2a6c4c(0x21c)](_0x53df6d,_0x53df6d['__'](_0x2a6c4c(0x1b9)));}}return _0x53df6d['json']({'code':0x0});}}),module['exports']=router;