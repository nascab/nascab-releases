const _0x1cd93a=_0x42c2;(function(_0x108ca7,_0x501d95){const _0x23c224=_0x42c2,_0x271337=_0x108ca7();while(!![]){try{const _0x2c81af=-parseInt(_0x23c224(0x2d4))/0x1*(parseInt(_0x23c224(0x2bb))/0x2)+parseInt(_0x23c224(0x1de))/0x3*(parseInt(_0x23c224(0x214))/0x4)+parseInt(_0x23c224(0x2bc))/0x5*(parseInt(_0x23c224(0x312))/0x6)+parseInt(_0x23c224(0x308))/0x7*(parseInt(_0x23c224(0x284))/0x8)+-parseInt(_0x23c224(0x295))/0x9+-parseInt(_0x23c224(0x2c9))/0xa*(-parseInt(_0x23c224(0x258))/0xb)+parseInt(_0x23c224(0x2dd))/0xc*(-parseInt(_0x23c224(0x340))/0xd);if(_0x2c81af===_0x501d95)break;else _0x271337['push'](_0x271337['shift']());}catch(_0x4989a2){_0x271337['push'](_0x271337['shift']());}}}(_0x2c14,0x74770));let express=require('express'),router=express[_0x1cd93a(0x2dc)](),path=require(_0x1cd93a(0x231));function _0x42c2(_0x1eb778,_0x41281f){const _0x2c1436=_0x2c14();return _0x42c2=function(_0x42c26c,_0x370b9f){_0x42c26c=_0x42c26c-0x1de;let _0x2b23fb=_0x2c1436[_0x42c26c];return _0x2b23fb;},_0x42c2(_0x1eb778,_0x41281f);}const config=require(_0x1cd93a(0x2c5)),dbFileIndexTable=require(_0x1cd93a(0x269)),dbSourceFolderTable=require(_0x1cd93a(0x2d2)),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),sqliteUtil=require('../utils/sqliteUtil'),exifUtils=require('../../utils/exifUtils'),dbUserTable=require(_0x1cd93a(0x2cf)),dbAlbumTable=require('../../db/dbAlbumTable');let geohash=require(_0x1cd93a(0x1ea)),fs=require('fs');const dbConfigTable=require(_0x1cd93a(0x334));let sharpUtil=require(_0x1cd93a(0x23d));function _0x2c14(){const _0x946d72=['geohash3\x20=\x20?','SELECT\x20f.id,f.path,f.filename,f.original_date,f.size\x20FROM\x20photo_phash_similar\x20as\x20a\x20inner\x20join\x20file_index_photo\x20as\x20f\x20on\x20a.similar_index_id=f.id\x20where\x20a.index_id=','floor','EDIT','error\x20pathList','whereStr','f2width','rawFaceIndexIdList','rawFile','UPDATE\x20photo_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','getList','abs','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20phash\x20is\x20null\x20and\x20type=1','/mergeFace','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time,latitude,longitude\x20','is_livephoto','transaction','concat','checkSqlInjection','dbOther','defaultMoviePlay','GPSLongitudeRef','\x20and\x20a.is_face_poster=1\x20limit\x201','addFileOperationRecord','share_uid','includes','returnErrMsg','/setFacePoster','paramsList','path_list','searchStr','f2y','aiClassId','存在livephoto','INDEX_TABLE_NAME_MUSIC','desc','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','40gunfBh','imgList','operationFail','faceapi','geohash5\x20=\x20?','TYPE_DELETE','getTimeLineDateList','\x20id\x20in\x20(','stat','insert','delete\x20from\x20photo_phash_similar\x20where\x201=1','similarIndexList','/switchFaceId','UPDATE\x20photo_faces\x20SET\x20face_name=?\x20where\x20id\x20=\x20?','excludeFilenamePhoto','imagePreviewType','rotate','SELECT\x20*\x20from\x20photo_phash_similar\x20where\x20index_id=','setFaceId','indexFullPath','isFile','jpeg','undefined','targetFaceId','INDEX_TABLE_NAME_MOVIE','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27\x27\x20where\x20id=','defaultTranscodeResolution','photoPreviewType','value','path','trash','\x20AND\x20geohash\x20LIKE\x20?\x20','dump','create_time','getPhotoByParams','getPathByType','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','delete','round','body','aiFaceMinPhotoCount','../utils/sharpUtils','\x20type=2\x20\x20','aiClassesEnable','platform','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27','data_value','timeType','findWithField','.MP4','getAllByWhereAndField','splice','\x20AND\x20in_trash=0\x20\x20AND\x20is_file=1\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20limit\x201','doUserCanGet','/searchMode','shareUidList','photo_index_id','/getAiDealState','face_img_path','ctimeMs','latitude','f2height','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20id=?','is_file','chi','join','resize','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20','11saynLQ','\x20and\x20title\x20like\x20?','power_get','getDate','faceIdList','findByTitle','/operationLibrary','文件写入成功','folderNotExist','REPLACE\x20INTO\x20photo_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','run','\x20size=?,ctime=?\x20','minIndexId','atleastChooseTwoFaces','imagePreviewSize','isAdmin','\x20AND\x20geohash3!=\x27undefined\x27\x20GROUP\x20BY\x20geohash3','../../db/dbFileIndexTable','DELETE\x20FROM\x20photo_phash_similar\x20where\x20index_id=?','\x20AND\x20\x20is_file=1\x20','\x20AND\x20','parent','updateBySql','get','geoInfoWriteErr','endsWith','photo','ExifIFD','index_id','getUserPathWhere','size','\x20LIMIT\x20?\x20OFFSET\x20?','Exif','album.sameNameExist','type','serveType','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=1\x20where\x20photo_index_id\x20=\x20','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?\x20or\x20belong_face_id=?','\x20AND\x20geohash4!=\x27undefined\x27\x20GROUP\x20BY\x20geohash4','deleteList','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?','dataPreview','UPDATE\x20photo_faces\x20SET\x20face_name=null\x20where\x20face_name\x20=\x20?','GPSLatitude','428056vRiXbS','dbFileIndex','keepIndexList','DELETE\x20FROM\x20photo_faces2index\x20where\x20face_id=?\x20and\x20photo_index_id\x20=?','sendFile','all','\x20SET\x20in_trash=0\x20WHERE\x20in_trash=1','substring','toString','Image\x20format\x20not\x20support','original_date','delete\x20from\x20photo_phash_similar\x20where\x20index_id=','ordinaryAlbumId','end','post','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20id=?','fileExist','4123917WfLpFZ','\x20SET\x20in_trash=1,in_trash_time=','GPSLatitudeRef','maxLng','book','exports','id,username','STATE_FAIL','.jpeg','SELECT\x20f.id\x20FROM\x20photo_faces2index\x20as\x20p\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20p.photo_index_id=f.id\x20WHERE\x20p.face_id=?\x20','getCountByWhere','encode','maxLat','\x27\x20where\x20id=','similarWaitDealCount','searchMode','prepare','getTime','startSimilarPhotoWork','\x20id,geohash,latitude,longitude,original_time\x20','Cleaning\x20out\x20the\x20recycle\x20bin\x20:\x20','mtime','albumId','filename','\x20WHERE\x20id\x20=\x20','length','getAlbumWhereStr','getByWhere','update\x20file_index_photo\x20set\x20phash=null,phash_compare=0','app','\x20AND\x20filename\x20LIKE\x20?\x20','STATE_SUC','toLowerCase','writeFile','trim','/resetSimilarPhotoAi','/getPhotoFaces','dealList','6NwGbel','1926215skTNFB','serverType','dirname','sortType','cacheDeleteFail','SELECT\x20id,path,filename,original_date,size\x20FROM\x20file_index_photo\x20where\x20id=','facesPath','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_class_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27','geohash','../../myConfig/config','aiSimilarPhotoEnable','shell','isIndexing','1882180TEhmMJ','SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id\x20limit\x20','transSpcielFormat','toFile','.jpg','\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)','../../db/dbUserTable','\x20is_file,id,path,filename,ext,duration,size\x20','/deleteAlbum','../../db/dbSourceFolderTable','faceName','31267JxlZms','mode','searchValue','log','video','replace','cachePath','startFaceAiWork','Router','1224mZxHtC','\x20LIMIT\x201','\x20latitude=?,longitude=?,geohash=?,geohash5=?,geohash4=?,geohash3=?,geohash2=?\x20','getPathWhere','power_add','music','filename_number','movie','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20id\x20=\x20?','sortField','getFaceInSql','readFile','GET','similar','is_admin','DateTimeOriginal','sourceFolderList','INDEX_TABLE_NAME_BOOK','putInSystemTrash','DELETE','.HEIC','SELECT\x20f.*,a.id\x20as\x20f2id,a.width\x20as\x20f2width,a.height\x20as\x20f2height,a.x\x20as\x20f2x,a.y\x20as\x20f2y\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20photo_faces2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20a.photo_index_id=f.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20a.face_id\x20in\x20','showFileType','GPS','parse','SELECT\x20*\x20FROM\x20photo_faces\x20where\x20id\x20=?','faceId','getFullYear','editId','currentUser','getFileHashName','getUserPower','binary','orderType','basename','name','original_time','UPDATE\x20','\x20OFFSET\x20','\x20is_file=0\x20','operation\x20fail','/resetFaceAi','faceApiWaitCompareCount','21oFcGch','zoom','close','count','geoHashList','search','orderField','power_delete','update','\x20is_file=1\x20','6YApWgC','(\x27mouse\x27,\x27person\x27,\x27traffic\x20light\x27,\x27stop\x20sign\x27,\x27parking\x20meter\x27,\x27fire\x20hydrant\x27)','/getBoundsPhoto','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20photo_faces2index\x20WHERE\x20compare_state=0','\x20AND\x20geohash2!=\x27undefined\x27\x20GROUP\x20BY\x20geohash2','disabled','/updatePhotoFace','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20face_name=?\x20and\x20belong_face_id\x20is\x20null','normalize','CUSTOM','error\x20data','offset','power_change','/removeFromFace','/getFileTreePhoto','/getTimeLineDateList','GPSIFD','f2x','minLng','noPermission','indexObj','getExcludePathWhereStr','username','sep','from','\x20ORDER\x20BY\x20','\x20AND\x20geohash5!=\x27undefined\x27\x20GROUP\x20BY\x20geohash5','\x20type=1\x20','\x20LIMIT\x20','.MOV','moviePreferLanguage','\x20order\x20by\x20score\x20desc','locationList','rawFaceId','../../db/dbConfigTable','getByName','excludePathPhoto','INDEX_TABLE_NAME_PHOTO','fileType','send','.JPG','getAllByWhereAndFieldFromOrdinaryAlbumCount','ERROR\x20GPS\x20LOCATION','extname','/getAlbumPhotoForMap','year','73177qgIgry','moviePlaylongPressRate','cocossd','SELECT\x20*\x20FROM\x20ai_classes\x20where\x20\x20class_name\x20not\x20in\x20','\x20in_trash=0\x20AND\x20latitude!=\x27undefined\x27\x20AND\x20longitude!=\x27undefined\x27\x20AND\x20latitude\x20is\x20not\x20null','stringify','260769WOcBFr','getAllByWhere','data','libraryId','mkdir','shareForSubUser','face_id','UPDATE\x20photo_faces2index\x20SET\x20face_id=?\x20WHERE\x20face_id=?\x20and\x20photo_index_id=?','push','/getSimilarPhoto','\x20WHERE\x20title\x20like\x20?','status','ngeohash','photoSavedAsNewFile','json','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','changes'];_0x2c14=function(){return _0x946d72;};return _0x2c14();}const photoApiUtil=require('./photoApiUtils'),platform=require('os')[_0x1cd93a(0x240)]();let piexif=require('piexifjs');router[_0x1cd93a(0x292)](_0x1cd93a(0x321),(_0x45cc2d,_0x1d16ea,_0x53ac3e)=>{const _0x458365=_0x1cd93a;if(dbUserTable[_0x458365(0x249)](_0x45cc2d,_0x1d16ea,_0x458365(0x272),_0x458365(0x25a))==!![]){let _0x18299b=_0x45cc2d[_0x458365(0x23b)][_0x458365(0x33f)],_0x597497=_0x45cc2d[_0x458365(0x23b)]['type'],_0x1e896a=_0x45cc2d[_0x458365(0x23b)][_0x458365(0x2c4)],_0xb1184b=_0x45cc2d['body'][_0x458365(0x2ab)],_0x2689d0=_0x45cc2d[_0x458365(0x23b)]['searchStr'],_0x47ec26=_0x45cc2d['body'][_0x458365(0x290)],_0xfa26c9=_0x45cc2d['body'][_0x458365(0x20f)],_0x35961a=_0x45cc2d[_0x458365(0x23b)]['libraryId'],_0x30e349=_0x45cc2d[_0x458365(0x23b)]['faceId'],_0x58b3a6=_0x45cc2d[_0x458365(0x23b)]['timeOrder'],_0x55c072=_0x45cc2d['body'][_0x458365(0x2ed)],_0x14cd84=dbUserTable['getUserPathWhere'](_0x45cc2d,_0x458365(0x272),'power_get',!![],_0x55c072),_0x503dc1=_0x14cd84['whereStr'],_0x412933=[..._0x14cd84[_0x458365(0x20b)]];_0x1e896a&&(_0x503dc1+=_0x458365(0x233),_0x412933[_0x458365(0x1e6)](_0x1e896a+'%'));let _0x34c19c=dbSourceFolderTable['getExcludePathWhereStr'](_0x45cc2d[_0x458365(0x2b2)][_0x458365(0x202)],_0x458365(0x231),_0x458365(0x336));_0x34c19c&&(_0x503dc1+='\x20AND\x20'+_0x34c19c);let _0x2c0064=dbSourceFolderTable[_0x458365(0x327)](_0x45cc2d[_0x458365(0x2b2)][_0x458365(0x202)],_0x458365(0x2ac),_0x458365(0x222));_0x2c0064&&(_0x503dc1+='\x20AND\x20'+_0x2c0064);if(_0x35961a){let _0x7574f=_0x45cc2d[_0x458365(0x2b2)]['dbFileIndex'][_0x458365(0x2a5)](_0x458365(0x293))[_0x458365(0x26f)](_0x35961a);if(_0x7574f)try{let _0x27b831=JSON['parse'](_0x7574f['path_list']),_0x2fa725=dbUserTable[_0x458365(0x2e0)](!![],_0x27b831);_0x503dc1+=_0x2fa725['whereStr'],_0x412933=_0x412933[_0x458365(0x200)](_0x2fa725[_0x458365(0x20b)]);}catch(_0x12fb0e){console[_0x458365(0x2d7)](_0x12fb0e);}}if(_0xb1184b){let _0x6ce107=dbAlbumTable[_0x458365(0x2af)](_0x45cc2d[_0x458365(0x2b2)][_0x458365(0x202)],_0xb1184b);_0x6ce107&&(_0x503dc1+=_0x458365(0x26c)+_0x6ce107);}_0x2689d0&&(_0x503dc1+=_0x458365(0x2ce),_0x412933[_0x458365(0x1e6)]('%'+_0x2689d0+'%'),_0x412933[_0x458365(0x1e6)]('%'+_0x2689d0+'%'));_0x503dc1+='\x20\x20\x20AND\x20in_trash!=1\x20';let _0x39be9d=dbFileIndexTable[_0x458365(0x21a)](_0x45cc2d[_0x458365(0x2b2)]['dbFileIndex'],_0x18299b,_0x597497,_0x503dc1,_0x47ec26,_0xfa26c9,_0x30e349,_0x412933,_0x58b3a6);_0x1d16ea[_0x458365(0x1ec)]({'code':0x0,'data':_0x39be9d});}});let geoDbCache={};router['post']('/getPhotoByTime',(_0x211e9d,_0x502b88,_0x38b057)=>{const _0x427428=_0x1cd93a;if(dbUserTable[_0x427428(0x249)](_0x211e9d,_0x502b88,_0x427428(0x272),'power_get')==!![]){result=photoApiUtil[_0x427428(0x236)](_0x211e9d,_0x502b88);let _0x4fd379=[],_0x3dd499=[];try{let _0x4a007d=Date['now']();if(result&&result['length']>0x0){for(let _0x137223 of result){!_0x4fd379['includes'](_0x137223[_0x427428(0x28e)])&&(_0x4fd379['push'](_0x137223['original_date']),_0x3dd499[_0x427428(0x1e6)]({'date':_0x137223['original_date'],'geoHashList':[],'locationList':[]}));if(_0x137223[_0x427428(0x2c4)]&&_0x137223['geohash']!=_0x427428(0x22a)&&_0x137223[_0x427428(0x2c4)][_0x427428(0x2ae)]>0x4){let _0x55ef5e=_0x3dd499[_0x4fd379['indexOf'](_0x137223['original_date'])][_0x427428(0x30c)],_0x5d4ff1=_0x137223['geohash']['substring'](0x0,0x5);!_0x55ef5e[_0x427428(0x208)](_0x5d4ff1)&&_0x55ef5e[_0x427428(0x2ae)]<0x5&&_0x55ef5e['push'](_0x5d4ff1);}}for(let _0x4fad31 of _0x3dd499){if(_0x4fad31[_0x427428(0x30c)]['length']<0x1)continue;for(let _0x364ed3 in _0x4fad31[_0x427428(0x30c)]){let _0xdb93e0=_0x4fad31['geoHashList'][_0x364ed3][_0x427428(0x28b)](0x0,0x5),_0x50c078=null;if(geoDbCache[_0xdb93e0])_0x50c078=geoDbCache[_0xdb93e0];else{let _0x212458='SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20geohash=?';_0x50c078=_0x211e9d[_0x427428(0x2b2)]['dbCity'][_0x427428(0x2a5)](_0x212458)[_0x427428(0x26f)](_0xdb93e0),geoDbCache[_0xdb93e0]=_0x50c078;}_0x50c078&&_0x4fad31[_0x427428(0x332)][_0x427428(0x1e6)](_0x50c078);}delete _0x4fad31[_0x427428(0x30c)];}for(let _0x2d9e6b=_0x3dd499[_0x427428(0x2ae)]-0x1;_0x2d9e6b>=0x0;_0x2d9e6b--){_0x3dd499[_0x2d9e6b][_0x427428(0x332)]['length']<0x1&&_0x3dd499[_0x427428(0x247)](_0x2d9e6b,0x1);}}}catch(_0x249fd1){console['log'](_0x249fd1);}let _0x8fb361={'code':0x0,'data':result,'originalDateItemList':_0x3dd499},_0x26110f=dbConfigTable['findByTitle'](_0x211e9d[_0x427428(0x2b2)][_0x427428(0x202)],_0x427428(0x22f)),_0x146590=dbConfigTable['findByTitle'](_0x211e9d[_0x427428(0x2b2)]['dbOther'],'photoPreviewSize');_0x8fb361[_0x427428(0x223)]='RAW';if(_0x26110f&&_0x26110f['value']==_0x427428(0x31b)&&_0x146590&&_0x146590[_0x427428(0x230)])try{let _0x13ca04=parseInt(_0x146590[_0x427428(0x230)]);_0x8fb361['imagePreviewType']=_0x427428(0x31b),_0x8fb361[_0x427428(0x266)]=_0x13ca04;}catch(_0x4a98a4){console[_0x427428(0x2d7)](_0x4a98a4);}_0x502b88['json'](_0x8fb361);}}),router['post'](_0x1cd93a(0x33e),(_0x1d6c9f,_0x325a34,_0xa25181)=>{const _0x19f864=_0x1cd93a;let _0x42b568=_0x19f864(0x344),_0x3f4e98=[],_0x27dc76=_0x1d6c9f[_0x19f864(0x23b)]['libraryId'];if(_0x1d6c9f[_0x19f864(0x23b)][_0x19f864(0x2ab)]){let _0x1e3945=dbAlbumTable[_0x19f864(0x2af)](_0x1d6c9f[_0x19f864(0x2b2)]['dbOther'],_0x1d6c9f[_0x19f864(0x23b)][_0x19f864(0x2ab)]);_0x1e3945&&(_0x42b568+=_0x19f864(0x26c)+_0x1e3945);}if(_0x27dc76){let _0x4d8dc2=_0x1d6c9f[_0x19f864(0x2b2)][_0x19f864(0x285)][_0x19f864(0x2a5)](_0x19f864(0x293))['get'](_0x27dc76);if(_0x4d8dc2)try{let _0x43738b=JSON[_0x19f864(0x2f5)](_0x4d8dc2[_0x19f864(0x20c)]),_0x502de=dbUserTable[_0x19f864(0x2e0)](!![],_0x43738b);_0x42b568+=_0x502de[_0x19f864(0x1f4)],_0x3f4e98[_0x19f864(0x1e6)](..._0x502de[_0x19f864(0x20b)]);}catch(_0x15d80f){console[_0x19f864(0x2d7)](_0x15d80f);}}function _0x5aeaa7(_0x5beaca,_0x924879,_0x54560c){const _0x41615b=_0x19f864;if(_0x54560c){let _0x118ffa=0x0;if(_0x1d6c9f['body'][_0x41615b(0x290)]){let _0x5ef0d2=dbFileIndexTable[_0x41615b(0x33b)](_0x1d6c9f['app']['dbFileIndex'],_0x5beaca,[parseInt(_0x1d6c9f['body'][_0x41615b(0x290)]),..._0x3f4e98]);_0x118ffa=_0x5ef0d2[_0x41615b(0x30b)];}else{let _0x2d7074=dbFileIndexTable[_0x41615b(0x29f)](_0x1d6c9f[_0x41615b(0x2b2)][_0x41615b(0x285)],_0x5beaca,dbFileIndexTable[_0x41615b(0x337)],_0x3f4e98);_0x118ffa=_0x2d7074[_0x41615b(0x30b)];}return _0x118ffa;}else{let _0x5a4032=[];return _0x1d6c9f[_0x41615b(0x23b)][_0x41615b(0x290)]?_0x5a4032=dbFileIndexTable['getAllByWhereAndFieldFromOrdinaryAlbum'](_0x1d6c9f[_0x41615b(0x2b2)][_0x41615b(0x285)],_0x5beaca,_0x924879,[parseInt(_0x1d6c9f[_0x41615b(0x23b)][_0x41615b(0x290)]),..._0x3f4e98]):_0x5a4032=dbFileIndexTable[_0x41615b(0x246)](_0x1d6c9f[_0x41615b(0x2b2)]['dbFileIndex'],_0x5beaca,_0x924879,dbFileIndexTable[_0x41615b(0x337)],_0x3f4e98),_0x5a4032;}}let _0x2fa5ea=dbUserTable['getUserPathWhere'](_0x1d6c9f,_0x19f864(0x272),_0x19f864(0x25a),!![]),_0xcb2ce9=_0x2fa5ea[_0x19f864(0x1f4)];_0x42b568+=_0xcb2ce9,_0x3f4e98[_0x19f864(0x1e6)](..._0x2fa5ea[_0x19f864(0x20b)]),_0x42b568+=_0x19f864(0x26b);let _0x32f603=0xc8,_0xd11095=[],_0x325c38=_0x5aeaa7(_0x42b568,null,!![]);if(_0x325c38<_0x32f603)_0xd11095=_0x5aeaa7(_0x42b568,'*');else{let _0x1959cf=_0x42b568+_0x19f864(0x32c),_0x2bb1bd=_0x5aeaa7(_0x1959cf,'*');if(_0x2bb1bd&&_0x2bb1bd['length']<_0x32f603)_0xd11095=_0x2bb1bd;else{let _0x409f93=_0x42b568+_0x19f864(0x27e),_0x389cad=_0x5aeaa7(_0x409f93,'*');if(_0x389cad&&_0x389cad[_0x19f864(0x2ae)]<_0x32f603)_0xd11095=_0x389cad;else{let _0x26a6c7=_0x42b568+_0x19f864(0x268),_0x46d382=_0x5aeaa7(_0x26a6c7,'*');if(_0x46d382&&_0x46d382[_0x19f864(0x2ae)]<_0x32f603)_0xd11095=_0x46d382;else{let _0x5edcf5=_0x42b568+_0x19f864(0x316);_0xd11095=_0x5aeaa7(_0x5edcf5,'*');}}}}return _0x325a34[_0x19f864(0x1ec)]({'code':0x0,'mapPhoto':_0xd11095});}),router[_0x1cd93a(0x292)](_0x1cd93a(0x314),(_0x109e90,_0x4e2c3d,_0xd593ae)=>{const _0x1d0f52=_0x1cd93a;if(dbUserTable[_0x1d0f52(0x249)](_0x109e90,_0x4e2c3d,_0x1d0f52(0x272),'power_get')==!![]){let _0x1c60d0=_0x109e90[_0x1d0f52(0x23b)]['minLat'],_0x154907=_0x109e90[_0x1d0f52(0x23b)][_0x1d0f52(0x324)],_0x162d4c=_0x109e90[_0x1d0f52(0x23b)][_0x1d0f52(0x2a1)],_0x3500fb=_0x109e90[_0x1d0f52(0x23b)][_0x1d0f52(0x298)],_0x89026f=_0x109e90[_0x1d0f52(0x23b)][_0x1d0f52(0x309)],_0x4d471f='',_0x54b517=0x2;if(_0x89026f<=0x4)_0x54b517=0x2,_0x4d471f='geohash2\x20=\x20?';else{if(_0x89026f<=0x6)_0x54b517=0x3,_0x4d471f=_0x1d0f52(0x1ef);else _0x89026f<=0x8?(_0x54b517=0x4,_0x4d471f='geohash4\x20=\x20?'):(_0x54b517=0x5,_0x4d471f=_0x1d0f52(0x218));}let _0xedeb57=geohash['bboxes'](_0x1c60d0,_0x154907,_0x162d4c,_0x3500fb,_0x54b517),_0x1f43f9=_0x1d0f52(0x2a8),_0x26e0f1=[],_0x45c089=dbUserTable['getUserPathWhere'](_0x109e90,_0x1d0f52(0x272),_0x1d0f52(0x25a),!![]);for(let _0x4c827a=0x0;_0x4c827a<_0xedeb57[_0x1d0f52(0x2ae)];_0x4c827a++){let _0x26d22a=_0xedeb57[_0x4c827a],_0xa45fa6=[_0x26d22a,..._0x45c089[_0x1d0f52(0x20b)]],_0x1f3888='\x20'+_0x4d471f+'\x20'+_0x45c089[_0x1d0f52(0x1f4)]+_0x1d0f52(0x248),_0x4b6f32=dbFileIndexTable[_0x1d0f52(0x2b0)](_0x109e90[_0x1d0f52(0x2b2)]['dbFileIndex'],_0x1f3888,_0x1f43f9,dbFileIndexTable[_0x1d0f52(0x337)],_0xa45fa6);_0x4b6f32&&_0x26e0f1['push'](_0x4b6f32);}_0x4e2c3d[_0x1d0f52(0x1ec)]({'code':0x0,'mapPhoto':_0x26e0f1});}}),router['post']('/addAlbum',(_0x5054df,_0x452505,_0x369a03)=>{const _0x1a7349=_0x1cd93a;if(dbUserTable[_0x1a7349(0x249)](_0x5054df,_0x452505,_0x1a7349(0x272),_0x1a7349(0x2e1))==!![]){let _0x37e1e1=_0x5054df[_0x1a7349(0x23b)][_0x1a7349(0x27a)],_0x2ae97f=_0x5054df[_0x1a7349(0x23b)][_0x1a7349(0x1e0)],_0x3aacb8=_0x5054df[_0x1a7349(0x23b)][_0x1a7349(0x242)],_0x51d38a=_0x5054df['body'][_0x1a7349(0x300)],_0x38d4b7=_0x5054df[_0x1a7349(0x23b)][_0x1a7349(0x2f9)];if(!_0x2ae97f||!_0x2ae97f[_0x1a7349(0x2d6)]||sqliteUtil[_0x1a7349(0x201)](_0x2ae97f[_0x1a7349(0x2d6)])==!![])return _0x5054df[_0x1a7349(0x2b2)]['returnErrMsg'](_0x452505,_0x1a7349(0x31c));if(!_0x38d4b7){let _0x3bd7ee=dbAlbumTable[_0x1a7349(0x335)](_0x5054df[_0x1a7349(0x2b2)]['dbOther'],_0x51d38a);if(_0x3bd7ee)return _0x5054df[_0x1a7349(0x2b2)][_0x1a7349(0x209)](_0x452505,_0x452505['__'](_0x1a7349(0x279)));}let _0x5f14aa=null;_0x38d4b7?_0x5f14aa=dbAlbumTable[_0x1a7349(0x310)](_0x5054df['app'][_0x1a7349(0x202)],{'type':_0x37e1e1,'data':_0x2ae97f,'data_value':_0x3aacb8,'name':_0x51d38a},_0x38d4b7):_0x5f14aa=dbAlbumTable['create'](_0x5054df['app'][_0x1a7349(0x202)],{'type':_0x37e1e1,'data':_0x2ae97f,'data_value':_0x3aacb8,'name':_0x51d38a}),_0x452505[_0x1a7349(0x1ec)]({'code':0x0,'result':_0x5f14aa});}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x2d1),(_0x15f356,_0x50d3bc,_0xb8d830)=>{const _0x22d2fc=_0x1cd93a;if(dbUserTable[_0x22d2fc(0x249)](_0x15f356,_0x50d3bc,_0x22d2fc(0x272),'power_delete')==!![]){let _0x19f596=_0x15f356[_0x22d2fc(0x23b)]['id'],_0x4be655=dbAlbumTable[_0x22d2fc(0x239)](_0x15f356[_0x22d2fc(0x2b2)][_0x22d2fc(0x202)],_0x19f596);_0x4be655[_0x22d2fc(0x1ee)]>0x0?_0x50d3bc[_0x22d2fc(0x1ec)]({'code':0x0,'result':_0x4be655}):_0x50d3bc[_0x22d2fc(0x1ec)]({'code':0x1,'message':'operation\x20fail'});}}),router[_0x1cd93a(0x292)]('/updateAlbum',(_0x4040fa,_0x328ac8,_0x566399)=>{const _0x291807=_0x1cd93a;if(dbUserTable['doUserCanGet'](_0x4040fa,_0x328ac8,_0x291807(0x272),'power_change')==!![]){let _0x283cf2=_0x4040fa[_0x291807(0x23b)]['id'],_0x513091=_0x4040fa[_0x291807(0x23b)][_0x291807(0x300)],_0x193ba5=dbAlbumTable[_0x291807(0x335)](_0x4040fa[_0x291807(0x2b2)][_0x291807(0x202)],_0x513091);if(_0x193ba5)return _0x4040fa[_0x291807(0x2b2)][_0x291807(0x209)](_0x328ac8,_0x328ac8['__']('album.sameNameExist'));let _0x53f67e=dbAlbumTable['udpateName'](_0x4040fa[_0x291807(0x2b2)][_0x291807(0x202)],_0x283cf2,_0x513091);_0x53f67e[_0x291807(0x1ee)]>0x0?_0x328ac8[_0x291807(0x1ec)]({'code':0x0,'result':_0x53f67e}):_0x328ac8['json']({'code':0x1,'message':_0x291807(0x305)});}}),router[_0x1cd93a(0x292)]('/getAllAlbum',(_0xc29493,_0x148409,_0xa219c8)=>{const _0x5205d0=_0x1cd93a;if(dbUserTable[_0x5205d0(0x249)](_0xc29493,_0x148409,_0x5205d0(0x272),_0x5205d0(0x25a))==!![]){let _0x1b8b5e=_0xc29493[_0x5205d0(0x23b)][_0x5205d0(0x30b)]||0x32,_0x573246=_0xc29493[_0x5205d0(0x23b)][_0x5205d0(0x31d)]||0x0,_0x12b1c4=_0xc29493['body'][_0x5205d0(0x30e)]||'id',_0x3bc1d1=_0xc29493[_0x5205d0(0x23b)][_0x5205d0(0x2fe)]||_0x5205d0(0x212),_0x3cd16e=_0xc29493[_0x5205d0(0x23b)][_0x5205d0(0x30d)],_0x46cdc1=dbAlbumTable[_0x5205d0(0x1f9)](_0xc29493[_0x5205d0(0x2b2)]['dbOther'],_0x1b8b5e,_0x573246,_0x12b1c4,_0x3bc1d1,_0x3cd16e),_0x2671e7=dbUserTable[_0x5205d0(0x275)](_0xc29493,_0x5205d0(0x272),'power_get',!![]);for(let _0x1e6173=0x0;_0x1e6173<_0x46cdc1[_0x5205d0(0x2ae)];_0x1e6173++){let _0x59042b=_0x5205d0(0x311);_0x59042b+=_0x2671e7[_0x5205d0(0x1f4)];let _0x2d2a94=[..._0x2671e7[_0x5205d0(0x20b)]],_0x30c431=dbAlbumTable['getAlbumWhereStr'](_0xc29493[_0x5205d0(0x2b2)]['dbOther'],_0x46cdc1[_0x1e6173]['id']);_0x30c431&&(_0x59042b+=_0x5205d0(0x26c)+_0x30c431);_0x59042b+=_0x5205d0(0x1ed),_0x59042b+=_0x5205d0(0x238);try{let _0x5d7b48=dbFileIndexTable[_0x5205d0(0x1df)](_0xc29493[_0x5205d0(0x2b2)][_0x5205d0(0x285)],_0x59042b,'*',dbFileIndexTable[_0x5205d0(0x337)],_0x2d2a94);_0x46cdc1[_0x1e6173][_0x5205d0(0x215)]=_0x5d7b48;}catch(_0x3fb273){console[_0x5205d0(0x2d7)](_0x3fb273),_0x46cdc1[_0x1e6173][_0x5205d0(0x215)]=[];}}_0x148409[_0x5205d0(0x1ec)]({'code':0x0,'data':_0x46cdc1});}}),router['post'](_0x1cd93a(0x24a),(_0x1f0d18,_0x2d8891,_0x206aab)=>{const _0x19346d=_0x1cd93a;let _0x2013d8=_0x1f0d18[_0x19346d(0x23b)]['key'],_0x4e4d81=dbFileIndexTable[_0x19346d(0x2a4)](_0x1f0d18[_0x19346d(0x2b2)]['dbFileIndex'],_0x2013d8),_0x453fe3=[];for(let _0x24e137=0x0;_0x24e137<_0x4e4d81[_0x19346d(0x2ae)];_0x24e137++){_0x453fe3[_0x19346d(0x1e6)](_0x4e4d81[_0x24e137][_0x19346d(0x2d5)]);}_0x2d8891[_0x19346d(0x1ec)]({'code':0x0,'data':_0x453fe3});}),router[_0x1cd93a(0x292)](_0x1cd93a(0x320),(_0x367366,_0x4f76e7,_0x505cbb)=>{const _0x14ae22=_0x1cd93a;let _0x5cd31c=_0x367366['body'][_0x14ae22(0x26d)],_0x527f54=_0x367366['body'][_0x14ae22(0x27b)],_0x16e047=_0x367366[_0x14ae22(0x23b)][_0x14ae22(0x30b)],_0x5e5ec0=_0x367366[_0x14ae22(0x23b)]['offset']||0x0;_0x5e5ec0=parseInt(_0x5e5ec0);let _0x29197f=parseInt(_0x367366[_0x14ae22(0x23b)][_0x14ae22(0x2f3)]),_0x569015=_0x367366[_0x14ae22(0x23b)][_0x14ae22(0x20d)],_0x2d5902=[_0x14ae22(0x2ac),_0x14ae22(0x301),_0x14ae22(0x276),_0x14ae22(0x235),_0x14ae22(0x2e3)],_0x1472af=['asc','desc'],_0x31e3b9=_0x367366['body'][_0x14ae22(0x30e)]||'id',_0x280613=_0x367366['body'][_0x14ae22(0x2fe)]||_0x14ae22(0x212);!_0x2d5902[_0x14ae22(0x208)](_0x31e3b9)&&(_0x31e3b9='id');!_0x1472af[_0x14ae22(0x208)](_0x280613)&&(_0x31e3b9=_0x14ae22(0x212));if(dbUserTable[_0x14ae22(0x249)](_0x367366,_0x4f76e7,_0x527f54,'power_get')==!![]){let _0x4acd05=[];if(!_0x5cd31c){let _0x4eb0a8=[];_0x367366['currentUser'][_0x14ae22(0x2eb)]==0x1?_0x4eb0a8=dbSourceFolderTable[_0x14ae22(0x237)](_0x367366[_0x14ae22(0x2b2)][_0x14ae22(0x202)],_0x527f54):_0x4eb0a8=dbUserTable[_0x14ae22(0x2fc)](_0x367366[_0x14ae22(0x2b2)][_0x14ae22(0x202)],_0x367366[_0x14ae22(0x2fa)][_0x14ae22(0x328)],_0x527f54);if(_0x4eb0a8)for(let _0x553a5c=0x0;_0x553a5c<_0x4eb0a8[_0x14ae22(0x2ae)];_0x553a5c++){_0x4acd05[_0x14ae22(0x1e6)]({'path':_0x4eb0a8[_0x553a5c][_0x14ae22(0x231)],'is_file':0x0,'filename':path[_0x14ae22(0x2ff)](_0x4eb0a8[_0x553a5c]['path']),'root':!![]});}}else{if(_0x367366['currentUser'][_0x14ae22(0x2eb)]!=0x1){if(dbUserTable[_0x14ae22(0x249)](_0x367366,_0x4f76e7,_0x527f54,_0x14ae22(0x25a),_0x5cd31c)!==!![])return;}_0x5cd31c=path['resolve'](path[_0x14ae22(0x31a)](_0x5cd31c));let _0x101f1f='\x20path=\x20?\x20AND\x20',_0x53d201=[_0x5cd31c];if(_0x29197f==0x0)_0x101f1f+='\x20(((type=1\x20or\x20type=2)\x20\x20)\x20OR\x20is_file=0\x20)\x20';else{if(_0x29197f==0x1)_0x101f1f+=_0x14ae22(0x32d);else{if(_0x29197f==0x2)_0x101f1f+=_0x14ae22(0x23e);else _0x29197f==0x3&&(_0x101f1f+=_0x14ae22(0x304));}}if(_0x569015){let _0x5b6f8b='\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)\x20';_0x53d201[_0x14ae22(0x1e6)]('%'+_0x569015+'%','\x27%'+_0x569015+'%\x27'),_0x527f54=='movie'&&(_0x5b6f8b=_0x14ae22(0x2b3),_0x53d201[_0x14ae22(0x1e6)]('\x27%'+_0x569015+'%\x27')),_0x101f1f+=_0x5b6f8b;}let _0x3b2608=_0x14ae22(0x1fd),_0x342054=dbFileIndexTable['getIndexTableNameByType'](_0x527f54);if(_0x527f54=='movie')_0x3b2608='\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time\x20';else _0x527f54==_0x14ae22(0x2e2)&&(_0x3b2608=_0x14ae22(0x2d0));_0x101f1f+='\x20ORDER\x20BY\x20is_file\x20asc,\x20'+_0x31e3b9+'\x20'+_0x280613+_0x14ae22(0x32e)+_0x16e047+_0x14ae22(0x303)+_0x5e5ec0,_0x4acd05=dbFileIndexTable[_0x14ae22(0x1df)](_0x367366['app'][_0x14ae22(0x285)],_0x101f1f,_0x3b2608,_0x342054,_0x53d201);}let _0x8fe697=path[_0x14ae22(0x329)],_0x14dbd2={'platform':platform,'code':0x0,'data':_0x4acd05,'sep':_0x8fe697};return _0x4f76e7[_0x14ae22(0x1ec)](_0x14dbd2);}}),router[_0x1cd93a(0x292)]('/getIndexDetail',(_0x15169e,_0xd23c11,_0x42ed45)=>{const _0x3dba89=_0x1cd93a;let _0x32715b=_0x15169e[_0x3dba89(0x23b)]['id'],_0x265249=_0x15169e[_0x3dba89(0x23b)][_0x3dba89(0x2bd)],_0x2c9a5f=dbFileIndexTable[_0x3dba89(0x337)];if(_0x265249==_0x3dba89(0x2e4))_0x2c9a5f=dbFileIndexTable[_0x3dba89(0x22c)];else{if(_0x265249==_0x3dba89(0x2e2))_0x2c9a5f=dbFileIndexTable[_0x3dba89(0x211)];else _0x265249==_0x3dba89(0x299)&&(_0x2c9a5f=dbFileIndexTable[_0x3dba89(0x2ee)]);}let _0x55edd5=dbFileIndexTable['getById'](_0x15169e[_0x3dba89(0x2b2)][_0x3dba89(0x285)],_0x32715b,_0x2c9a5f);if(!_0x55edd5)return _0xd23c11[_0x3dba89(0x1e9)](0x194)[_0x3dba89(0x291)]();if(dbUserTable[_0x3dba89(0x249)](_0x15169e,_0xd23c11,'',_0x3dba89(0x25a),_0x55edd5[_0x3dba89(0x231)])==!![]){let _0x5d3314={'code':0x0,'data':_0x55edd5};if(_0x265249=='movie'){let _0x5ded9b=dbConfigTable[_0x3dba89(0x25d)](_0x15169e[_0x3dba89(0x2b2)][_0x3dba89(0x202)],'moviePreferLanguage');_0x5d3314['moviePreferLanguage']=_0x5ded9b?_0x5ded9b[_0x3dba89(0x230)]:_0x3dba89(0x254),_0x5d3314[_0x3dba89(0x1e0)][_0x3dba89(0x330)]=_0x5d3314[_0x3dba89(0x330)];let _0x228d49=dbConfigTable[_0x3dba89(0x25d)](_0x15169e[_0x3dba89(0x2b2)][_0x3dba89(0x202)],_0x3dba89(0x341));_0x5d3314[_0x3dba89(0x341)]=_0x228d49?_0x228d49[_0x3dba89(0x230)]:'2',_0x5d3314[_0x3dba89(0x1e0)][_0x3dba89(0x341)]=_0x5d3314['moviePlaylongPressRate'];let _0x592693=dbConfigTable['findByTitle'](_0x15169e[_0x3dba89(0x2b2)]['dbOther'],'defaultTranscodeResolution');_0x5d3314[_0x3dba89(0x22e)]=_0x592693?_0x592693[_0x3dba89(0x230)]:'3';let _0x3e509f=dbConfigTable[_0x3dba89(0x25d)](_0x15169e['app'][_0x3dba89(0x202)],_0x3dba89(0x203));_0x5d3314['defaultMoviePlay']=_0x3e509f?_0x3e509f[_0x3dba89(0x230)]:_0x3dba89(0x1f7);let _0x48c354=path[_0x3dba89(0x255)](_0x55edd5['path'],_0x55edd5[_0x3dba89(0x2ac)]);fs[_0x3dba89(0x21c)](_0x48c354,(_0x4afea8,_0x51a55d)=>{const _0x1301f1=_0x3dba89;return _0x4afea8?(_0x5d3314[_0x1301f1(0x294)]=0x0,_0x5d3314[_0x1301f1(0x227)]=_0x48c354):(_0x5d3314[_0x1301f1(0x294)]=0x1,_0x5d3314[_0x1301f1(0x227)]=_0x48c354),_0xd23c11['json'](_0x5d3314);});}else return _0xd23c11['json'](_0x5d3314);}}),router[_0x1cd93a(0x292)]('/editExifByIndexId',(_0x3b59bb,_0x37b5c9,_0x41c8b6)=>{const _0x4442e8=_0x1cd93a;if(dbUserTable['doUserCanGet'](_0x3b59bb,_0x37b5c9,_0x4442e8(0x272),_0x4442e8(0x31e))==!![]){let _0x462445=_0x3b59bb['body']['id'],_0x10771b=_0x3b59bb[_0x4442e8(0x23b)][_0x4442e8(0x250)],_0x1b5b51=_0x3b59bb['body']['longitude'],_0xa414c8=_0x3b59bb[_0x4442e8(0x23b)]['newDate'],_0x290c64=dbFileIndexTable['getById'](_0x3b59bb['app'][_0x4442e8(0x285)],_0x462445);if(!_0x290c64)return _0x3b59bb['app']['returnErrMsg'](_0x37b5c9,_0x37b5c9['__'](_0x4442e8(0x1eb)));let _0x4c9cf8=path['join'](_0x290c64[_0x4442e8(0x231)],path[_0x4442e8(0x329)],_0x290c64[_0x4442e8(0x2ac)]),_0x14b3fb=path[_0x4442e8(0x33d)](_0x4c9cf8)?path['extname'](_0x4c9cf8)[_0x4442e8(0x2b5)]():'';if(_0x14b3fb!=_0x4442e8(0x2cd)&&_0x14b3fb!=_0x4442e8(0x29d))return _0x3b59bb[_0x4442e8(0x2b2)][_0x4442e8(0x209)](_0x37b5c9,_0x4442e8(0x28d));fs['stat'](_0x4c9cf8,(_0x33c5ce,_0x402779)=>{const _0x175a6c=_0x4442e8;if(_0x33c5ce||!_0x402779[_0x175a6c(0x228)]())return _0x3b59bb[_0x175a6c(0x2b2)][_0x175a6c(0x209)](_0x37b5c9,_0x37b5c9['__'](_0x175a6c(0x260)));if(_0x33c5ce||!_0x402779['isFile']())return _0x3b59bb[_0x175a6c(0x2b2)]['returnErrMsg'](_0x37b5c9,_0x37b5c9['__']('folderNotExist'));fs[_0x175a6c(0x2e8)](_0x4c9cf8,(_0x298652,_0x3a955e)=>{const _0xe1a328=_0x175a6c;if(_0x298652)return _0x3b59bb['app'][_0xe1a328(0x209)](_0x37b5c9,_0x37b5c9['__'](_0xe1a328(0x216)));var _0x2feed2=piexif['load'](_0x3a955e[_0xe1a328(0x28c)](_0xe1a328(0x2fd)));if(_0x10771b&&_0x1b5b51){function _0x5cc0fc(_0x229a6a){const _0x19ded5=_0xe1a328;try{_0x229a6a=Number(_0x229a6a);let _0x6c4ee0=Math['floor'](Math['abs'](_0x229a6a)),_0x117815=(Math[_0x19ded5(0x1fa)](_0x229a6a)-_0x6c4ee0)*0x3c,_0x198998=Math[_0x19ded5(0x1f1)](_0x117815),_0x3d1512=Math[_0x19ded5(0x23a)]((_0x117815-_0x198998)*0x3c*0x64);return[[_0x6c4ee0,0x1],[_0x198998,0x1],[_0x3d1512,0x64]];}catch(_0x859dcc){return'';}}let _0x36f755=_0x5cc0fc(_0x10771b),_0x44ceba=_0x5cc0fc(_0x1b5b51);if(!_0x44ceba||!_0x36f755)return _0x3b59bb[_0xe1a328(0x2b2)][_0xe1a328(0x209)](_0x37b5c9,_0xe1a328(0x33c));_0x2feed2[_0xe1a328(0x2f4)][piexif[_0xe1a328(0x322)][_0xe1a328(0x297)]]=_0x10771b>=0x0?'N':'S',_0x2feed2['GPS'][piexif[_0xe1a328(0x322)][_0xe1a328(0x283)]]=_0x36f755,(_0x2feed2[_0xe1a328(0x2f4)][piexif[_0xe1a328(0x322)][_0xe1a328(0x204)]]=_0x1b5b51>=0x0?'E':'W',_0x2feed2[_0xe1a328(0x2f4)][piexif[_0xe1a328(0x322)]['GPSLongitude']]=_0x44ceba);let _0x2225ef=geohash[_0xe1a328(0x2a0)](_0x10771b,_0x1b5b51,0x8),_0x439cc2=_0x2225ef[_0xe1a328(0x28b)](0x0,0x5),_0x6af08e=_0x2225ef[_0xe1a328(0x28b)](0x0,0x4),_0xac4030=_0x2225ef[_0xe1a328(0x28b)](0x0,0x3),_0x1f21ca=_0x2225ef['substring'](0x0,0x2),_0x5b4069=[_0x10771b,_0x1b5b51,_0x2225ef,_0x439cc2,_0x6af08e,_0xac4030,_0x1f21ca];dbFileIndexTable[_0xe1a328(0x26e)](_0x3b59bb[_0xe1a328(0x2b2)][_0xe1a328(0x285)],_0x290c64['id'],_0xe1a328(0x2df),dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],_0x5b4069);}if(_0xa414c8){_0x2feed2[_0xe1a328(0x278)][piexif[_0xe1a328(0x273)][_0xe1a328(0x2ec)]]=_0xa414c8,_0x2feed2[_0xe1a328(0x2f4)][piexif[_0xe1a328(0x322)]['GPSDateStamp']]=_0xa414c8;let _0x248f12=new Date(_0xa414c8),_0x2f5123=_0x248f12[_0xe1a328(0x2a6)](),_0x574f21=_0x248f12[_0xe1a328(0x2f8)](),_0x419b1d=_0x248f12['getMonth']()+0x1;_0x419b1d=_0x419b1d>=0xa?_0x419b1d:'0'+_0x419b1d;let _0x5c2965=_0x248f12[_0xe1a328(0x25b)]();_0x5c2965=_0x5c2965>=0xa?_0x5c2965:'0'+_0x5c2965;let _0x436f1f=_0x574f21+'-'+_0x419b1d+'-'+_0x5c2965,_0x51f82d=[_0x2f5123,_0x436f1f];dbFileIndexTable[_0xe1a328(0x26e)](_0x3b59bb[_0xe1a328(0x2b2)][_0xe1a328(0x285)],_0x290c64['id'],'\x20original_time=?,original_date=?\x20',dbFileIndexTable[_0xe1a328(0x337)],_0x51f82d);}try{var _0x6a583=piexif[_0xe1a328(0x234)](_0x2feed2),_0x2ccbb5=piexif[_0xe1a328(0x21d)](_0x6a583,_0x3a955e[_0xe1a328(0x28c)]('binary'));let _0x30d6ed=path[_0xe1a328(0x255)](_0x290c64[_0xe1a328(0x231)],_0x290c64[_0xe1a328(0x2ac)]);fs[_0xe1a328(0x2b6)](_0x30d6ed,Buffer[_0xe1a328(0x32a)](_0x2ccbb5,_0xe1a328(0x2fd)),{},_0x412b93=>{const _0xa3f0a5=_0xe1a328;if(_0x412b93)return console['log'](_0x412b93),_0x3b59bb[_0xa3f0a5(0x2b2)][_0xa3f0a5(0x209)](_0x37b5c9,_0x37b5c9['__'](_0xa3f0a5(0x216)));console[_0xa3f0a5(0x2d7)](_0xa3f0a5(0x25f)),fs['utimes'](_0x30d6ed,new Date(_0x290c64[_0xa3f0a5(0x2aa)]),new Date(_0x290c64[_0xa3f0a5(0x2aa)]),_0x5adb6c=>{_0x5adb6c&&console['log'](_0x5adb6c),fs['stat'](_0x30d6ed,(_0x1591b4,_0x4740ed)=>{const _0x4a7750=_0x42c2;if(_0x1591b4)return _0x3b59bb['app'][_0x4a7750(0x209)](_0x37b5c9,_0x37b5c9['__'](_0x4a7750(0x216)));let _0x591810=[_0x4740ed[_0x4a7750(0x276)],_0x4740ed[_0x4a7750(0x24f)]];return dbFileIndexTable['updateBySql'](_0x3b59bb[_0x4a7750(0x2b2)][_0x4a7750(0x285)],_0x290c64['id'],_0x4a7750(0x263),dbFileIndexTable[_0x4a7750(0x337)],_0x591810),_0x37b5c9[_0x4a7750(0x1ec)]({'code':0x0,'newIndex':dbFileIndexTable['getById'](_0x3b59bb[_0x4a7750(0x2b2)][_0x4a7750(0x285)],_0x290c64['id'])});});});});}catch(_0x571ff9){return console[_0xe1a328(0x2d7)](_0x571ff9),_0x3b59bb[_0xe1a328(0x2b2)][_0xe1a328(0x209)](_0x37b5c9,_0x37b5c9['__'](_0xe1a328(0x270)));}});});}}),router[_0x1cd93a(0x292)]('/getPhotoClasses',(_0xcfb813,_0x9751c,_0xa80b28)=>{const _0x2c66be=_0x1cd93a;if(dbUserTable[_0x2c66be(0x249)](_0xcfb813,_0x9751c,_0x2c66be(0x272),_0x2c66be(0x25a))==!![]){let _0x574e6a=dbConfigTable[_0x2c66be(0x25d)](_0xcfb813[_0x2c66be(0x2b2)][_0x2c66be(0x202)],_0x2c66be(0x23f));if(!_0x574e6a||_0x574e6a['value']!='1')return _0x9751c[_0x2c66be(0x1ec)]({'code':0x0,'data':[],'enable':![]});let _0x3f8976=_0x2c66be(0x313),_0x4c13ee=dbUserTable['getUserPathWhere'](_0xcfb813,_0x2c66be(0x272),_0x2c66be(0x25a),!![]),_0x45ee73=[],_0x5d1c88=_0xcfb813[_0x2c66be(0x2b2)]['dbFileIndex'][_0x2c66be(0x2a5)](_0x2c66be(0x343)+_0x3f8976)[_0x2c66be(0x289)](),_0x564eee=[];for(let _0x2ad52f in _0x5d1c88){let _0x3a595f=_0x5d1c88[_0x2ad52f];_0x45ee73=[_0x3a595f['id'],dbFileIndexTable['COCO_CLASS_MIN_SCORE'],..._0x4c13ee[_0x2c66be(0x20b)]];let _0x3fb675=_0xcfb813[_0x2c66be(0x2b2)][_0x2c66be(0x285)]['prepare']('SELECT\x20f.id\x20as\x20photo_index_id\x20FROM\x20ai_classes2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20a.photo_index_id=f.id\x20WHERE\x20a.class_id=?\x20and\x20score>?\x20and\x20\x20f.in_trash=0\x20\x20and\x20f.tiny_path\x20is\x20not\x20null\x20AND\x20f.tiny_path\x20!=\x20\x270\x27\x20\x20'+_0x4c13ee[_0x2c66be(0x1f4)]+_0x2c66be(0x331))[_0x2c66be(0x26f)](_0x45ee73);if(_0x3fb675)_0x5d1c88[_0x2ad52f][_0x2c66be(0x24c)]=_0x3fb675[_0x2c66be(0x24c)],_0x5d1c88[_0x2ad52f]['class_id']=_0x5d1c88[_0x2ad52f]['id'],_0x564eee[_0x2c66be(0x1e6)](_0x5d1c88[_0x2ad52f]);else continue;}_0x9751c[_0x2c66be(0x1ec)]({'code':0x0,'data':_0x564eee,'enable':!![]});}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x2b9),(_0x3aff99,_0x1f0db0,_0x56b85b)=>{const _0x179bc3=_0x1cd93a;if(dbUserTable[_0x179bc3(0x249)](_0x3aff99,_0x1f0db0,_0x179bc3(0x272),_0x179bc3(0x25a))==!![]){let _0x32a1fb=dbConfigTable['findByTitle'](_0x3aff99[_0x179bc3(0x2b2)]['dbOther'],'aiFaceEnable');if(!_0x32a1fb||_0x32a1fb['value']!='1')return _0x1f0db0[_0x179bc3(0x1ec)]({'code':0x0,'data':[],'enable':![]});let _0x4485ac=0x5,_0x1f3987=dbConfigTable[_0x179bc3(0x25d)](_0x3aff99[_0x179bc3(0x2b2)]['dbOther'],_0x179bc3(0x23c));_0x1f3987&&_0x1f3987[_0x179bc3(0x230)]&&(_0x1f3987['value']>0x0&&(_0x4485ac=_0x1f3987['value']));let _0x4ecffa=_0x3aff99[_0x179bc3(0x2b2)][_0x179bc3(0x285)][_0x179bc3(0x2a5)]('SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20disabled=0\x20and\x20belong_face_id\x20is\x20null\x20and\x20face_photo_count>=?\x20order\x20by\x20face_photo_count\x20desc\x20limit\x20500')['all'](parseInt(_0x4485ac)),_0x5d54aa=[];if(_0x3aff99[_0x179bc3(0x2fa)][_0x179bc3(0x2eb)]==0x1)_0x5d54aa=_0x4ecffa;else{let _0x383dd2=dbUserTable[_0x179bc3(0x275)](_0x3aff99,_0x179bc3(0x272),_0x179bc3(0x25a),!![]);for(let _0x11e8aa of _0x4ecffa){try{let _0x449b61=[_0x11e8aa['id'],..._0x383dd2[_0x179bc3(0x20b)]],_0x5ded65=_0x3aff99[_0x179bc3(0x2b2)][_0x179bc3(0x285)]['prepare'](_0x179bc3(0x29e)+_0x383dd2[_0x179bc3(0x1f4)]+_0x179bc3(0x2de))['get'](_0x449b61);_0x5ded65&&_0x5d54aa[_0x179bc3(0x1e6)](_0x11e8aa);}catch(_0x59a290){console['log'](_0x59a290),_0x5d54aa[_0x179bc3(0x1e6)](_0x11e8aa);}}}_0x1f0db0['json']({'code':0x0,'data':_0x5d54aa,'enable':!![]});}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x20a),(_0x46f505,_0x4a72fe,_0x33ba46)=>{const _0x2b6731=_0x1cd93a;let _0x24b988=_0x46f505['body'][_0x2b6731(0x226)],_0x518f64=_0x46f505['body'][_0x2b6731(0x333)],_0x1e76df=_0x46f505[_0x2b6731(0x23b)]['photoIndexId'];if(dbUserTable[_0x2b6731(0x249)](_0x46f505,_0x4a72fe,_0x2b6731(0x272),_0x2b6731(0x31e))==!![]){let _0x50bad7=dbFileIndexTable[_0x2b6731(0x2e7)](_0x46f505[_0x2b6731(0x2b2)][_0x2b6731(0x285)],_0x24b988);_0x46f505[_0x2b6731(0x2b2)][_0x2b6731(0x285)]['prepare']('UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=0\x20where\x20is_face_poster=1\x20and\x20face_id\x20in\x20'+_0x50bad7)[_0x2b6731(0x262)](),_0x46f505[_0x2b6731(0x2b2)]['dbFileIndex'][_0x2b6731(0x2a5)](_0x2b6731(0x27c)+_0x1e76df+'\x20and\x20face_id='+_0x518f64)['run'](),_0x46f505['app'][_0x2b6731(0x285)]['prepare'](_0x2b6731(0x22d)+_0x24b988)[_0x2b6731(0x262)](),_0x4a72fe['json']({'code':0x0});}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x31f),(_0x270dc7,_0x12fce1,_0x2ba747)=>{const _0x5bc02b=_0x1cd93a;let _0x3497d0=_0x270dc7['body'][_0x5bc02b(0x27f)];try{_0x3497d0=JSON[_0x5bc02b(0x2f5)](_0x3497d0);}catch(_0x50d631){console[_0x5bc02b(0x2d7)](_0x50d631);}if(dbUserTable[_0x5bc02b(0x249)](_0x270dc7,_0x12fce1,'photo',_0x5bc02b(0x31e))==!![]){for(let _0x2cfdcd of _0x3497d0){_0x270dc7['app'][_0x5bc02b(0x285)][_0x5bc02b(0x2a5)](_0x5bc02b(0x287))[_0x5bc02b(0x262)](parseInt(_0x2cfdcd[_0x5bc02b(0x2f7)]),parseInt(_0x2cfdcd['indexId']));}_0x12fce1[_0x5bc02b(0x1ec)]({'code':0x0});}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x318),(_0x282b50,_0x37c023,_0x378304)=>{const _0x3f7a8c=_0x1cd93a;if(dbUserTable[_0x3f7a8c(0x249)](_0x282b50,_0x37c023,_0x3f7a8c(0x272),_0x3f7a8c(0x31e))==!![]){let _0x533338=_0x282b50[_0x3f7a8c(0x23b)][_0x3f7a8c(0x2d3)],_0x544ea0=_0x282b50[_0x3f7a8c(0x23b)][_0x3f7a8c(0x317)],_0x302956=_0x282b50[_0x3f7a8c(0x23b)][_0x3f7a8c(0x2f7)],_0x3fd560=_0x282b50['body'][_0x3f7a8c(0x25c)];if(_0x533338){_0x533338=_0x533338[_0x3f7a8c(0x2b7)]();let _0x51ae45=_0x282b50[_0x3f7a8c(0x2b2)][_0x3f7a8c(0x285)][_0x3f7a8c(0x2a5)](_0x3f7a8c(0x319))[_0x3f7a8c(0x26f)](_0x533338);_0x51ae45&&_0x51ae45['id']!=_0x302956?_0x282b50[_0x3f7a8c(0x2b2)]['dbFileIndex'][_0x3f7a8c(0x2a5)](_0x3f7a8c(0x280))[_0x3f7a8c(0x262)](_0x51ae45['id'],_0x302956):(_0x282b50[_0x3f7a8c(0x2b2)][_0x3f7a8c(0x285)][_0x3f7a8c(0x2a5)](_0x3f7a8c(0x282))[_0x3f7a8c(0x262)](_0x533338),_0x282b50['app']['dbFileIndex'][_0x3f7a8c(0x2a5)](_0x3f7a8c(0x221))['run'](_0x533338,_0x302956));}if(parseInt(_0x544ea0)==0x0||parseInt(_0x544ea0)==0x1){if(_0x3fd560){let _0x1c6aa8=_0x3f7a8c(0x21b);for(let _0x243fb7 in _0x3fd560){_0x1c6aa8+=_0x3fd560[_0x243fb7],_0x243fb7!=_0x3fd560[_0x3f7a8c(0x2ae)]-0x1&&(_0x1c6aa8+=',');}_0x1c6aa8+=')';let _0x239435=_0x3f7a8c(0x257)+_0x1c6aa8;_0x282b50['app']['dbFileIndex'][_0x3f7a8c(0x2a5)](_0x239435)['run'](_0x544ea0);}else _0x282b50['app']['dbFileIndex'][_0x3f7a8c(0x2a5)](_0x3f7a8c(0x2e5))[_0x3f7a8c(0x262)](_0x544ea0,_0x302956);}return _0x37c023[_0x3f7a8c(0x1ec)]({'code':0x0});}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x1fc),(_0x5714b5,_0x3c22cc,_0x978402)=>{const _0x128ffe=_0x1cd93a;if(dbUserTable[_0x128ffe(0x249)](_0x5714b5,_0x3c22cc,_0x128ffe(0x272),_0x128ffe(0x31e))==!![]){let _0x489610=_0x5714b5['body']['faceIdList'];if(!_0x489610||_0x489610[_0x128ffe(0x2ae)]<0x2)return _0x5714b5[_0x128ffe(0x2b2)][_0x128ffe(0x209)](_0x3c22cc,_0x3c22cc['__'](_0x128ffe(0x265)));let _0x25a41e=_0x5714b5[_0x128ffe(0x2b2)][_0x128ffe(0x285)]['prepare'](_0x128ffe(0x252))[_0x128ffe(0x26f)](_0x489610[0x0]);if(!_0x25a41e)return _0x5714b5[_0x128ffe(0x2b2)][_0x128ffe(0x209)](_0x3c22cc,_0x3c22cc['__']('operationFail'));for(let _0x48ed44=0x1;_0x48ed44<_0x489610[_0x128ffe(0x2ae)];_0x48ed44++){let _0x300166=_0x489610[_0x48ed44];_0x5714b5[_0x128ffe(0x2b2)][_0x128ffe(0x285)]['prepare'](_0x128ffe(0x27d))[_0x128ffe(0x262)](_0x25a41e['id'],_0x300166,_0x300166);}return process['send']({'type':_0x128ffe(0x2db)}),_0x3c22cc[_0x128ffe(0x1ec)]({'code':0x0});}}),router[_0x1cd93a(0x26f)]('/getFaceImg/*',(_0x6d62e9,_0x2b99cd,_0x52fd2c)=>{const _0x1e251c=_0x1cd93a;let _0x496664=_0x6d62e9['query'][_0x1e251c(0x2f7)];if(dbUserTable[_0x1e251c(0x249)](_0x6d62e9,_0x2b99cd,_0x1e251c(0x272),_0x1e251c(0x25a))==!![]){let _0x12e018=_0x6d62e9['app'][_0x1e251c(0x285)][_0x1e251c(0x2a5)](_0x1e251c(0x2f6))[_0x1e251c(0x26f)](_0x496664);if(!_0x12e018)return _0x2b99cd['status'](0x194)[_0x1e251c(0x291)]();_0x6d62e9[_0x1e251c(0x2fa)][_0x1e251c(0x2eb)]!=0x1?_0x191b79(![]):!_0x12e018['face_img_path']?_0x191b79(!![]):fs[_0x1e251c(0x21c)](_0x12e018[_0x1e251c(0x24e)],(_0x2680a6,_0x2b84fb)=>{const _0x4eb654=_0x1e251c;if(!_0x2680a6){let _0x4bd82e=new Date()[_0x4eb654(0x2a6)](),_0x2668c5=0x48*0xe10*0x3e8;if(_0x2b84fb[_0x4eb654(0x24f)]){let _0x35404a=_0x4bd82e-_0x2b84fb[_0x4eb654(0x24f)];if(_0x35404a>_0x2668c5)return _0x191b79(!![]);}return _0x2b99cd[_0x4eb654(0x288)](_0x12e018[_0x4eb654(0x24e)]);}_0x191b79(!![]);});function _0x191b79(_0x41a6cc){const _0x472f59=_0x1e251c;let _0x2435ff=dbFileIndexTable['getFaceInSql'](_0x6d62e9[_0x472f59(0x2b2)][_0x472f59(0x285)],_0x496664),_0xe8f689=_0x472f59(0x2f2)+_0x2435ff+'\x20',_0x445cd6=[];if(_0x6d62e9[_0x472f59(0x2fa)][_0x472f59(0x2eb)]!=0x1){let _0x1c4cd3=dbUserTable[_0x472f59(0x275)](_0x6d62e9,_0x472f59(0x272),_0x472f59(0x25a),!![]);_0xe8f689+=_0x1c4cd3[_0x472f59(0x1f4)],_0x445cd6=_0x445cd6[_0x472f59(0x200)](_0x1c4cd3[_0x472f59(0x20b)]);}let _0x147219=_0x6d62e9[_0x472f59(0x2b2)][_0x472f59(0x285)][_0x472f59(0x2a5)](_0xe8f689+_0x472f59(0x205))[_0x472f59(0x26f)](_0x445cd6);if(!_0x147219){_0x147219=_0x6d62e9[_0x472f59(0x2b2)]['dbFileIndex'][_0x472f59(0x2a5)](_0xe8f689+'\x20order\x20by\x20f.original_time\x20desc\x20limit\x201')[_0x472f59(0x26f)](_0x445cd6);if(!_0x147219)return _0x2b99cd[_0x472f59(0x1e9)](0x194)[_0x472f59(0x291)]();}if(!_0x147219)return _0x2b99cd[_0x472f59(0x1e9)](0x194)[_0x472f59(0x291)]();let _0x325a9f=path['join'](_0x147219[_0x472f59(0x231)],_0x147219[_0x472f59(0x2ac)]);if(parseInt(_0x147219[_0x472f59(0x27a)])==0x2){let _0x44b15f=config[_0x472f59(0x2fb)](_0x147219),_0x1ca9f2=path['join'](config[_0x472f59(0x2da)],_0x44b15f);sharpUtil['genTinyFile'](_0x325a9f,path[_0x472f59(0x2be)](_0x1ca9f2),path[_0x472f59(0x2ff)](_0x1ca9f2),_0x472f59(0x2d8),_0x147219,_0x1ea3b5=>{_0x325a9f=_0x1ca9f2,_0xfd627e();},_0x1de1dc=>{const _0x27787c=_0x472f59;return _0x2b99cd[_0x27787c(0x1e9)](0x194)['end']();});}else _0xfd627e();function _0xfd627e(){const _0x16a332=_0x472f59;let _0x439e8b=path[_0x16a332(0x255)](config[_0x16a332(0x2c2)],_0x147219['f2id']+new Date()[_0x16a332(0x2a6)]()+_0x16a332(0x2cd)),_0x4d86bf=0x7d0;sharpUtil[_0x16a332(0x2cb)](_0x325a9f,(_0x1da6f2,_0x127b07,_0x4d254a)=>{const _0x55459d=_0x16a332;let _0x20d698=parseInt(_0x147219[_0x55459d(0x1f5)]*1.4),_0x541687=parseInt(_0x147219[_0x55459d(0x251)]*1.4),_0x2fe0d6=parseInt(_0x147219['f2x']-_0x20d698*0.2),_0x116234=parseInt(_0x147219[_0x55459d(0x20e)]-_0x541687*0.2);if(_0x116234<0x0)_0x116234=0x0;if(_0x2fe0d6<0x0)_0x2fe0d6=0x0;_0x4a112e(_0x1da6f2,_0x127b07,_0x4d254a,_0x2fe0d6,_0x116234,_0x20d698,_0x541687,()=>{const _0x407d20=_0x55459d;let _0x356e76=parseInt(_0x147219['f2width']),_0x540cc5=parseInt(_0x147219[_0x407d20(0x251)]),_0x57d03c=parseInt(_0x147219[_0x407d20(0x323)]),_0x400450=parseInt(_0x147219['f2y']);if(_0x400450<0x0)_0x400450=0x0;if(_0x57d03c<0x0)_0x57d03c=0x0;_0x4a112e(_0x1da6f2,_0x127b07,_0x4d254a,_0x57d03c,_0x400450,_0x356e76,_0x540cc5);});});function _0x4a112e(_0x42826a,_0x462762,_0x4d4400,_0x172031,_0x17c923,_0x51c804,_0x465730,_0x2ccc1a){const _0x1adbdb=_0x16a332;let _0x3f3fcc=sharpUtil['getSharpInstanceFromInput'](_0x42826a),_0x5cd0b5=exifUtils['getRotateFromTags'](_0x4d4400);_0x5cd0b5?_0x3f3fcc=_0x3f3fcc[_0x1adbdb(0x224)](_0x5cd0b5):_0x3f3fcc=_0x3f3fcc[_0x1adbdb(0x224)](),_0x3f3fcc[_0x1adbdb(0x256)]({'width':_0x4d86bf,'height':_0x4d86bf,'withoutEnlargement':!![]})[_0x1adbdb(0x229)]()['extract']({'left':_0x172031,'top':_0x17c923,'width':_0x51c804,'height':_0x465730})[_0x1adbdb(0x2cc)](_0x439e8b,function(_0x1005a9){const _0x3faca7=_0x1adbdb;if(_0x1005a9){_0x462762&&sharpUtil['deleteRawTempFile'](_0x42826a);if(_0x2ccc1a)_0x2ccc1a();else return _0x2b99cd[_0x3faca7(0x1e9)](0x194)[_0x3faca7(0x291)]();}else{_0x462762&&sharpUtil['deleteRawTempFile'](_0x42826a);if(_0x41a6cc)return _0x6d62e9[_0x3faca7(0x2b2)][_0x3faca7(0x285)][_0x3faca7(0x2a5)](_0x3faca7(0x241)+_0x439e8b+_0x3faca7(0x2a2)+_0x496664)[_0x3faca7(0x262)](),_0x2b99cd['sendFile'](_0x439e8b);else _0x2b99cd[_0x3faca7(0x288)](_0x439e8b),_0x2b99cd['on'](_0x3faca7(0x30a),()=>{fs['rm'](_0x439e8b,_0x1d81c1=>{});});}});}}}}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x220),(_0x1ec51a,_0x3335aa,_0x33791f)=>{const _0xac94d=_0x1cd93a;let _0x3cf313=_0x1ec51a[_0xac94d(0x23b)][_0xac94d(0x22b)],_0x42ced1=_0x1ec51a[_0xac94d(0x23b)][_0xac94d(0x1f6)],_0x13cdf2=[];if(!_0x3cf313||!_0x42ced1)return _0x3335aa[_0xac94d(0x1ec)]({'code':0x0,'sucIdList':_0x13cdf2});try{_0x42ced1=JSON['parse'](_0x42ced1);for(let _0x1d4318 in _0x42ced1){let _0x31a76a=_0x42ced1[_0x1d4318],_0x766eb2=_0x1ec51a['app'][_0xac94d(0x285)][_0xac94d(0x2a5)](_0xac94d(0x1e5))[_0xac94d(0x262)](parseInt(_0x3cf313),parseInt(_0x31a76a[_0xac94d(0x1e4)]),parseInt(_0x31a76a[_0xac94d(0x24c)]));_0x13cdf2[_0xac94d(0x1e6)](_0x31a76a[_0xac94d(0x24c)]);}return _0x3335aa[_0xac94d(0x1ec)]({'code':0x0,'sucIdList':_0x13cdf2});}catch(_0x11f21e){return console[_0xac94d(0x2d7)](_0x11f21e),_0x3335aa[_0xac94d(0x1ec)]({'code':0x0,'sucIdList':_0x13cdf2});}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x24d),(_0x5d493a,_0x34ae87,_0x5468e3)=>{const _0x707260=_0x1cd93a;let _0x54e7fb=_0x5d493a[_0x707260(0x23b)][_0x707260(0x27a)],_0x5aaf58={};if(_0x5d493a[_0x707260(0x2fa)][_0x707260(0x2eb)]==0x1){if(!_0x54e7fb||_0x54e7fb==_0x707260(0x217)){let _0x1e5ad5=_0x5d493a['app'][_0x707260(0x285)]['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_face_detect_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20')[_0x707260(0x26f)]();_0x5aaf58['faceApiWaitDealCount']=_0x1e5ad5[_0x707260(0x30b)];if(_0x1e5ad5['count']<0x1){let _0x34a043=_0x5d493a['app'][_0x707260(0x285)][_0x707260(0x2a5)](_0x707260(0x315))[_0x707260(0x26f)]();_0x5aaf58[_0x707260(0x307)]=_0x34a043[_0x707260(0x30b)];}}if(!_0x54e7fb||_0x54e7fb==_0x707260(0x342)){let _0x1d743a=_0x5d493a['app']['dbFileIndex'][_0x707260(0x2a5)](_0x707260(0x2c3))[_0x707260(0x26f)]();_0x5aaf58['cocossdWaitDealCount']=_0x1d743a[_0x707260(0x30b)];}if(!_0x54e7fb||_0x54e7fb==_0x707260(0x2ea)){let _0x5c7a73=_0x5d493a[_0x707260(0x2b2)][_0x707260(0x285)][_0x707260(0x2a5)](_0x707260(0x1fb))['get']();_0x5aaf58[_0x707260(0x2a3)]=_0x5c7a73[_0x707260(0x30b)];}}let _0x4486d7=dbConfigTable[_0x707260(0x25d)](_0x5d493a['app'][_0x707260(0x202)],'file_index_photo-indexing'),_0x1e41b6=0x0;return!_0x4486d7?_0x1e41b6=0x0:_0x1e41b6=_0x4486d7[_0x707260(0x230)],_0x5aaf58[_0x707260(0x2c8)]=_0x1e41b6,_0x34ae87[_0x707260(0x1ec)]({'code':0x0,'data':_0x5aaf58});}),router['post'](_0x1cd93a(0x306),(_0x696408,_0x25b635,_0x1491b6)=>{const _0x579c09=_0x1cd93a;if(dbUserTable[_0x579c09(0x249)](_0x696408,_0x25b635,'photo',_0x579c09(0x31e))==!![])try{fs['rm'](config[_0x579c09(0x2c2)],{'recursive':!![]},_0x38c250=>{const _0x263ffc=_0x579c09;if(_0x38c250)return console[_0x263ffc(0x2d7)](_0x38c250),_0x696408[_0x263ffc(0x2b2)][_0x263ffc(0x209)](_0x25b635,_0x25b635['__'](_0x263ffc(0x2c0))+':'+config[_0x263ffc(0x2c2)],'dialog');fs[_0x263ffc(0x1e2)](config['facesPath'],_0x275ebe=>{const _0x44437b=_0x263ffc;if(_0x275ebe)return _0x696408[_0x44437b(0x2b2)][_0x44437b(0x209)](_0x25b635,_0x25b635['__'](_0x44437b(0x216)),'dialog');let _0x5aba92=_0x696408[_0x44437b(0x2b2)]['dbFileIndex'][_0x44437b(0x1ff)](()=>{const _0xa23d71=_0x44437b;return _0x696408[_0xa23d71(0x2b2)]['dbFileIndex'][_0xa23d71(0x2a5)]('delete\x20from\x20photo_faces\x20where\x201=1')[_0xa23d71(0x262)](),_0x696408[_0xa23d71(0x2b2)]['dbFileIndex'][_0xa23d71(0x2a5)]('delete\x20from\x20photo_faces2index\x20where\x201=1')['run'](),_0x696408[_0xa23d71(0x2b2)][_0xa23d71(0x285)][_0xa23d71(0x2a5)]('update\x20file_index_photo\x20set\x20ai_face_detect_state=0')[_0xa23d71(0x262)](),process[_0xa23d71(0x339)]({'type':'startFaceAiWork'}),_0x25b635[_0xa23d71(0x1ec)]({'code':0x0});});_0x5aba92();});});}catch(_0x29e831){return _0x696408[_0x579c09(0x2b2)][_0x579c09(0x209)](_0x25b635,_0x25b635['__'](_0x579c09(0x216)),'dialog');}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x2b8),(_0x698e05,_0x17b130,_0x34d58a)=>{const _0x12ad5e=_0x1cd93a;if(dbUserTable[_0x12ad5e(0x249)](_0x698e05,_0x17b130,_0x12ad5e(0x272),'power_change')==!![])try{let _0x5cd386=_0x698e05['app'][_0x12ad5e(0x285)]['transaction'](()=>{const _0x4f3be1=_0x12ad5e;return _0x698e05['app'][_0x4f3be1(0x285)][_0x4f3be1(0x2a5)](_0x4f3be1(0x21e))[_0x4f3be1(0x262)](),_0x698e05[_0x4f3be1(0x2b2)]['dbFileIndex'][_0x4f3be1(0x2a5)](_0x4f3be1(0x2b1))[_0x4f3be1(0x262)](),process[_0x4f3be1(0x339)]({'type':_0x4f3be1(0x2a7)}),_0x17b130[_0x4f3be1(0x1ec)]({'code':0x0});});_0x5cd386();}catch(_0x51a7f1){return _0x698e05[_0x12ad5e(0x2b2)]['returnErrMsg'](_0x17b130,_0x17b130['__'](_0x12ad5e(0x216)),'dialog');}}),router[_0x1cd93a(0x292)](_0x1cd93a(0x1e7),(_0x47584b,_0x2d5ed3,_0x3912e4)=>{const _0x28b8d7=_0x1cd93a;if(dbUserTable[_0x28b8d7(0x267)](_0x47584b,_0x2d5ed3)!==!![])return;let _0x4f1801=dbConfigTable[_0x28b8d7(0x25d)](_0x47584b[_0x28b8d7(0x2b2)][_0x28b8d7(0x202)],_0x28b8d7(0x2c6));if(!_0x4f1801||_0x4f1801['value']!='1')return _0x2d5ed3[_0x28b8d7(0x1ec)]({'code':0x0,'data':[],'enable':![]});let _0x29a1c7=_0x47584b[_0x28b8d7(0x23b)][_0x28b8d7(0x264)];if(!_0x29a1c7)_0x29a1c7=0x0;let _0x28babe=_0x47584b[_0x28b8d7(0x23b)][_0x28b8d7(0x30b)];if(!_0x28babe||_0x28babe>0x64)_0x28babe=0x64;let _0x2f2d1b=[],_0x48915c=_0x47584b[_0x28b8d7(0x2b2)]['dbFileIndex'][_0x28b8d7(0x2a5)]('SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id')[_0x28b8d7(0x289)](),_0x380f1=_0x47584b['app'][_0x28b8d7(0x285)][_0x28b8d7(0x2a5)](_0x28b8d7(0x2ca)+_0x28babe)[_0x28b8d7(0x289)]();for(let _0x5ca65c in _0x380f1){let _0x57def7=_0x380f1[_0x5ca65c],_0x4117c6=_0x47584b['app'][_0x28b8d7(0x285)][_0x28b8d7(0x2a5)](_0x28b8d7(0x2c1)+_0x57def7[_0x28b8d7(0x274)])[_0x28b8d7(0x26f)](),_0x200d9f=_0x47584b[_0x28b8d7(0x2b2)][_0x28b8d7(0x285)][_0x28b8d7(0x2a5)](_0x28b8d7(0x1f0)+_0x57def7[_0x28b8d7(0x274)])[_0x28b8d7(0x289)]();_0x380f1[_0x5ca65c][_0x28b8d7(0x326)]=_0x4117c6,_0x380f1[_0x5ca65c]['similarIndexList']=[_0x4117c6],_0x380f1[_0x5ca65c][_0x28b8d7(0x21f)][_0x28b8d7(0x1e6)](..._0x200d9f),_0x380f1[_0x5ca65c]['similarIndexList'][_0x28b8d7(0x2ae)]>0x1?_0x2f2d1b['push'](_0x380f1[_0x5ca65c]):_0x47584b[_0x28b8d7(0x2b2)][_0x28b8d7(0x285)][_0x28b8d7(0x2a5)](_0x28b8d7(0x26a))['run'](_0x57def7[_0x28b8d7(0x274)]);}return _0x2d5ed3['json']({'code':0x0,'data':_0x2f2d1b,'enable':!![],'waitDealCount':_0x48915c[_0x28b8d7(0x2ae)]});}),router[_0x1cd93a(0x292)]('/dealSimilarPhoto',(_0x28defa,_0x59e12c,_0x476c07)=>{const _0x1bd16c=_0x1cd93a;if(dbUserTable[_0x1bd16c(0x267)](_0x28defa,_0x59e12c)!==!![])return;let _0x4b34f8=_0x28defa['body'][_0x1bd16c(0x2ba)];for(let _0x4e262a in _0x4b34f8){let _0x17039a=_0x28defa[_0x1bd16c(0x2b2)][_0x1bd16c(0x285)][_0x1bd16c(0x2a5)](_0x1bd16c(0x225)+_0x4b34f8[_0x4e262a][_0x1bd16c(0x274)])['all']();for(let _0x1a99d4 in _0x17039a){if(!_0x4b34f8[_0x4e262a][_0x1bd16c(0x286)][_0x1bd16c(0x208)](parseInt(_0x17039a[_0x1a99d4]['similar_index_id']))){let _0x572a99=new Date()['getTime']();_0x28defa[_0x1bd16c(0x2b2)][_0x1bd16c(0x285)]['prepare'](_0x1bd16c(0x302)+dbFileIndexTable[_0x1bd16c(0x337)]+_0x1bd16c(0x296)+_0x572a99+_0x1bd16c(0x2ad)+_0x17039a[_0x1a99d4]['similar_index_id'])[_0x1bd16c(0x262)]();}}if(!_0x4b34f8[_0x4e262a][_0x1bd16c(0x286)]['includes'](parseInt(_0x4b34f8[_0x4e262a][_0x1bd16c(0x274)]))){let _0x448a54=new Date()['getTime']();_0x28defa[_0x1bd16c(0x2b2)]['dbFileIndex'][_0x1bd16c(0x2a5)](_0x1bd16c(0x302)+dbFileIndexTable[_0x1bd16c(0x337)]+_0x1bd16c(0x296)+_0x448a54+'\x20WHERE\x20id\x20=\x20'+_0x4b34f8[_0x4e262a][_0x1bd16c(0x274)])[_0x1bd16c(0x262)]();}_0x28defa[_0x1bd16c(0x2b2)][_0x1bd16c(0x285)][_0x1bd16c(0x2a5)](_0x1bd16c(0x28f)+_0x4b34f8[_0x4e262a][_0x1bd16c(0x274)])['run']();}return _0x59e12c[_0x1bd16c(0x1ec)]({'code':0x0});}),router[_0x1cd93a(0x292)]('/restoreTrashBinFiles',(_0x4e9ff0,_0x572a72,_0x250e25)=>{const _0x42e41d=_0x1cd93a;if(dbUserTable[_0x42e41d(0x249)](_0x4e9ff0,_0x572a72,_0x42e41d(0x272),_0x42e41d(0x31e),'')==!![]){let _0x42f5c7=_0x4e9ff0[_0x42e41d(0x2b2)][_0x42e41d(0x285)]['prepare']('SELECT\x20*\x20FROM\x20file_index_photo\x20WHERE\x20in_trash=1\x20AND\x20is_file=1\x20AND\x20raw_filename\x20is\x20not\x20null\x20AND\x20raw_filename!=\x27\x27\x20AND\x20type=1')[_0x42e41d(0x289)]();for(let _0xa5ec2a of _0x42f5c7){_0x4e9ff0[_0x42e41d(0x2b2)][_0x42e41d(0x285)][_0x42e41d(0x2a5)](_0x42e41d(0x213))[_0x42e41d(0x262)](_0xa5ec2a['path'],_0xa5ec2a['raw_filename']);}return _0x4e9ff0[_0x42e41d(0x2b2)][_0x42e41d(0x285)]['prepare'](_0x42e41d(0x302)+dbFileIndexTable[_0x42e41d(0x337)]+_0x42e41d(0x28a))['run'](),_0x572a72[_0x42e41d(0x1ec)]({'code':0x0});}}),router[_0x1cd93a(0x292)]('/clearTrashBin',(_0x34c441,_0x21d5cd,_0xf05378)=>{const _0x23a416=_0x1cd93a;let _0x581db2=_0x34c441[_0x23a416(0x23b)][_0x23a416(0x2ef)],_0x1b96ba=dbFileIndexTable[_0x23a416(0x1df)](_0x34c441[_0x23a416(0x2b2)]['dbFileIndex'],'\x20in_trash=1\x20and\x20is_file=1\x20','id,is_file,is_livephoto,path,filename,raw_filename,is_raw',dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']),_0xbf3a32=dbFileIndexTable[_0x23a416(0x337)];console[_0x23a416(0x2d7)](_0x23a416(0x2a9)+_0x1b96ba['length']);function _0x22cf45(_0x8af76d,_0x2e709e){const _0x286826=_0x23a416;dbFileOperationRecord[_0x286826(0x206)](_0x34c441[_0x286826(0x2b2)]['dbOther'],{'username':_0x34c441['currentUser'][_0x286826(0x328)],'targetPath':_0x8af76d,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x286826(0x219)],'state':_0x2e709e?dbFileOperationRecord[_0x286826(0x2b4)]:dbFileOperationRecord[_0x286826(0x29c)]});}function _0x5a5ee3(_0x2f5b9a){const _0x4b2f82=_0x23a416;if(_0x2f5b9a[_0x4b2f82(0x253)]==0x1&&_0x2f5b9a[_0x4b2f82(0x1fe)]==0x1){let _0x55b957=path[_0x4b2f82(0x255)](_0x2f5b9a[_0x4b2f82(0x231)],_0x2f5b9a[_0x4b2f82(0x2ac)]['replace'](_0x4b2f82(0x32f),'')+_0x4b2f82(0x2f1));_0x2f5b9a[_0x4b2f82(0x2ac)][_0x4b2f82(0x271)](_0x4b2f82(0x245))&&(_0x55b957=path[_0x4b2f82(0x255)](_0x2f5b9a[_0x4b2f82(0x231)],_0x2f5b9a[_0x4b2f82(0x2ac)][_0x4b2f82(0x2d9)](_0x4b2f82(0x245),'')+_0x4b2f82(0x33a))),fs['existsSync'](_0x55b957)&&(console[_0x4b2f82(0x2d7)](_0x4b2f82(0x210),_0x55b957),_0x16199b(_0x2f5b9a,_0x55b957,![]));}}function _0x16199b(_0x269307,_0x5894c3,_0x866042){const _0x5d72dc=_0x23a416;_0x581db2==0x1?(process[_0x5d72dc(0x339)]({'type':_0x5d72dc(0x2c7),'shellType':_0x5d72dc(0x232),'path':_0x5894c3}),_0x22cf45(_0x5894c3,!![])):fs['rm'](_0x5894c3,{'recursive':!![]},_0x5fb391=>{_0x5fb391?_0x22cf45(_0x5894c3,![]):_0x22cf45(_0x5894c3,!![]);}),_0x866042&&_0x5a5ee3(_0x269307);}function _0x22d572(_0x12f86b){const _0x4248f5=_0x23a416;dbFileIndexTable['delete'](_0x34c441[_0x4248f5(0x2b2)][_0x4248f5(0x285)],_0x12f86b['id'],_0xbf3a32);}for(let _0x379e5e in _0x1b96ba){let _0x23e6aa=_0x1b96ba[_0x379e5e];if(_0x23e6aa){if(dbUserTable[_0x23a416(0x249)](_0x34c441,_0x21d5cd,_0x23a416(0x272),_0x23a416(0x30f),_0x23e6aa[_0x23a416(0x231)])==!![]){let _0x4536c0=path[_0x23a416(0x255)](_0x23e6aa[_0x23a416(0x231)],path['sep'],_0x23e6aa[_0x23a416(0x2ac)]);_0x22d572(_0x23e6aa),_0x16199b(_0x23e6aa,_0x4536c0,!![]);}}}return _0x21d5cd[_0x23a416(0x1ec)]({'code':0x0});}),router['post'](_0x1cd93a(0x25e),(_0x32573e,_0x262a06,_0x26a2b4)=>{const _0x55e547=_0x1cd93a;let _0x158181=_0x32573e[_0x55e547(0x23b)]['title'],_0x1d3e09=_0x32573e['body']['libraryId'],_0x129e48=_0x32573e['body']['pathList'],_0x53faf3=_0x32573e[_0x55e547(0x23b)][_0x55e547(0x24b)],_0x25af2f=_0x32573e[_0x55e547(0x23b)][_0x55e547(0x1e3)],_0x2b26b5=_0x32573e[_0x55e547(0x23b)]['operation'];if(_0x2b26b5==_0x55e547(0x2e9)){let _0xd08880=_0x32573e[_0x55e547(0x23b)]['offset']||0x0,_0x34425c=_0x32573e[_0x55e547(0x23b)][_0x55e547(0x30b)]||0x32,_0x1d08c3=_0x32573e[_0x55e547(0x23b)][_0x55e547(0x30d)]||'',_0x45adfd=_0x32573e[_0x55e547(0x23b)]['orderField']||_0x55e547(0x235),_0x8d0505=_0x32573e[_0x55e547(0x23b)][_0x55e547(0x2fe)]||_0x55e547(0x212);if(![_0x55e547(0x235),'title']['includes'](_0x45adfd))return console[_0x55e547(0x2d7)]('order\x20field\x20error',_0x45adfd),[];let _0x29e088=[],_0x872377=[],_0x147876='SELECT\x20*\x20FROM\x20photo_library\x20';_0x32573e[_0x55e547(0x2fa)]['is_admin']==0x1?_0x1d08c3&&(_0x147876+=_0x55e547(0x1e8),_0x872377['push']('%'+_0x1d08c3+'%')):(_0x147876='SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20share_for_subuser=1',_0x1d08c3&&(_0x147876+=_0x55e547(0x259),_0x872377[_0x55e547(0x1e6)]('%'+_0x1d08c3+'%')));_0x147876+=_0x55e547(0x32b)+_0x45adfd+'\x20'+_0x8d0505+_0x55e547(0x277),_0x872377[_0x55e547(0x1e6)](_0x34425c),_0x872377[_0x55e547(0x1e6)](_0xd08880),_0x29e088=_0x32573e[_0x55e547(0x2b2)][_0x55e547(0x285)][_0x55e547(0x2a5)](_0x147876)[_0x55e547(0x289)](_0x872377);if(_0x29e088[_0x55e547(0x2ae)]<0x1)return _0x262a06['json']({'code':0x0,'data':[]});for(let _0x14d699 in _0x29e088){let _0xd6a5ef=_0x29e088[_0x14d699];try{let _0x51e5d1=JSON['parse'](_0xd6a5ef[_0x55e547(0x207)]),_0x464e36=[];for(let _0x13943a of _0x51e5d1){let _0x5df9a0=dbUserTable[_0x55e547(0x244)](_0x32573e['app']['dbOther'],_0x13943a,_0x55e547(0x29b));_0x464e36[_0x55e547(0x1e6)](_0x5df9a0);}_0x29e088[_0x14d699]['user_list']=_0x464e36;}catch(_0x575d3f){console[_0x55e547(0x2d7)](_0x575d3f);}_0x32573e[_0x55e547(0x23b)]['count']=0x4,_0x32573e[_0x55e547(0x23b)]['excludeIds']=[],_0x32573e[_0x55e547(0x23b)][_0x55e547(0x338)]=0x0,_0x32573e['body'][_0x55e547(0x2e6)]=_0x55e547(0x301),_0x32573e['body'][_0x55e547(0x2bf)]=_0x55e547(0x212),_0x32573e[_0x55e547(0x23b)][_0x55e547(0x243)]=0x1,_0x32573e[_0x55e547(0x23b)]['timestamp']=0x9184e729fff,_0x32573e[_0x55e547(0x23b)][_0x55e547(0x232)]=0x0,_0x32573e['body'][_0x55e547(0x1e1)]=_0x29e088[_0x14d699]['id'],_0x29e088[_0x14d699][_0x55e547(0x281)]=photoApiUtil[_0x55e547(0x236)](_0x32573e,_0x262a06);}return _0x262a06[_0x55e547(0x1ec)]({'code':0x0,'data':_0x29e088});}else{if(_0x32573e[_0x55e547(0x2fa)]['is_admin']!=0x1)return _0x32573e['app']['returnErrMsg'](_0x262a06,_0x262a06['__'](_0x55e547(0x325)));if(_0x2b26b5=='ADD'||_0x2b26b5==_0x55e547(0x1f2)){if(!_0x129e48||!_0x129e48 instanceof Array||_0x129e48[_0x55e547(0x2ae)]<0x1)return _0x32573e[_0x55e547(0x2b2)][_0x55e547(0x209)](_0x262a06,_0x262a06['__'](_0x55e547(0x216)));if(_0x25af2f){if(_0x53faf3!=null&&!_0x53faf3 instanceof Array)return _0x32573e[_0x55e547(0x2b2)][_0x55e547(0x209)](_0x262a06,_0x262a06['__'](_0x55e547(0x216)));}if(sqliteUtil[_0x55e547(0x201)](JSON[_0x55e547(0x345)](_0x129e48))==!![])return _0x32573e[_0x55e547(0x2b2)][_0x55e547(0x209)](_0x262a06,_0x55e547(0x1f3));}if(_0x2b26b5==_0x55e547(0x1f2)&&_0x1d3e09)_0x32573e['app'][_0x55e547(0x285)][_0x55e547(0x2a5)](_0x55e547(0x1f8))['run'](_0x158181,JSON['stringify'](_0x129e48),_0x25af2f,JSON['stringify'](_0x53faf3),_0x1d3e09);else{if(_0x2b26b5==_0x55e547(0x2f0)&&_0x1d3e09)_0x32573e[_0x55e547(0x2b2)][_0x55e547(0x285)][_0x55e547(0x2a5)]('DELETE\x20FROM\x20photo_library\x20\x20WHERE\x20id=?')['run'](_0x1d3e09);else{if(_0x2b26b5=='ADD')_0x32573e[_0x55e547(0x2b2)]['dbFileIndex']['prepare'](_0x55e547(0x261))[_0x55e547(0x262)](_0x158181,JSON[_0x55e547(0x345)](_0x129e48),_0x25af2f,JSON[_0x55e547(0x345)](_0x53faf3),_0x32573e[_0x55e547(0x2fa)]['id']);else return _0x32573e[_0x55e547(0x2b2)][_0x55e547(0x209)](_0x262a06,_0x262a06['__'](_0x55e547(0x325)));}}return _0x262a06['json']({'code':0x0});}}),module[_0x1cd93a(0x29a)]=router;