const _0x2b76de=_0x26ac;function _0x4277(){const _0x347fc=['excludeIds','photoSavedAsNewFile','utimes','/clearTrashBin','/resetFaceAi','defaultMoviePlay','aiFaceMinPhotoCount','geohash4\x20=\x20?','operation\x20fail','\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)','DELETE\x20FROM\x20photo_faces2index\x20where\x20face_id=?\x20and\x20photo_index_id\x20=?','isFile','extract','getTimeLineDateList','getMonth','\x20in_trash=1\x20and\x20is_file=1\x20','imagePreviewType','sendFile','3cquuVJ','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27\x27\x20where\x20id=','fileExist','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20disabled=0\x20and\x20belong_face_id\x20is\x20null\x20and\x20face_photo_count>=?\x20order\x20by\x20face_photo_count\x20desc\x20limit\x20500','../../db/dbUserTable','dealList','cocossdWaitDealCount','246712bdKtEH','f2id','whereStr','getIndexTableNameByType','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20phash\x20is\x20null\x20and\x20type=1','transaction','moviePreferLanguage','json','app','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20id=?','../../db/dbFileIndexTable','user_list','aiFaceEnable','shareUidList','searchStr','error\x20data','addFileOperationRecord','photo','rawFaceIndexIdList','\x20AND\x20geohash4!=\x27undefined\x27\x20GROUP\x20BY\x20geohash4','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_face_detect_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20','f2y','geoInfoWriteErr','create_time','/getPhotoFaces','\x20type=2\x20\x20','faceId','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_class_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27','DateTimeOriginal','CUSTOM','albumId','\x20is_file=1\x20','value','searchValue','UPDATE\x20','filename_number','GPSLatitude','photoPreviewType','/getPhotoClasses','INDEX_TABLE_NAME_BOOK','RAW','replace','getRotateFromTags','orderType','operationFail','getPathWhere','desc','serverType','GPS','ctimeMs','file_index_photo-indexing','atleastChooseTwoFaces','cacheDeleteFail','f2x','.jpeg','doUserCanGet','\x20in_trash=0\x20AND\x20latitude!=\x27undefined\x27\x20AND\x20longitude!=\x27undefined\x27\x20AND\x20latitude\x20is\x20not\x20null','concat','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=1\x20where\x20photo_index_id\x20=\x20','targetFaceId','basename','query','abs','\x20latitude=?,longitude=?,geohash=?,geohash5=?,geohash4=?,geohash3=?,geohash2=?\x20','body','endsWith','\x20AND\x20geohash3!=\x27undefined\x27\x20GROUP\x20BY\x20geohash3','raw_filename','UPDATE\x20photo_faces2index\x20SET\x20face_id=?\x20WHERE\x20face_id=?\x20and\x20photo_index_id=?','.MOV','length','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20id\x20=\x20?','id,is_file,is_livephoto,path,filename,raw_filename,is_raw','\x20WHERE\x20id\x20=\x20','bboxes','getPhotoByParams','GPSIFD','GPSLongitudeRef','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','getAllByWhereAndFieldFromOrdinaryAlbumCount','4wArGtP','startFaceAiWork','video','getTime','all','extname','path','sortField','\x20and\x20title\x20like\x20?','editId','indexId','deleteRawTempFile','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20','geohash5\x20=\x20?','libraryId','getExcludePathWhereStr','class_id','moviePlaylongPressRate','platform','stat','album.sameNameExist','INDEX_TABLE_NAME_MOVIE','original_time','/getFileTreePhoto','\x20ORDER\x20BY\x20','DELETE\x20FROM\x20photo_library\x20\x20WHERE\x20id=?','year','aiClassesEnable','/searchMode','status','latitude','offset','writeFile','\x20and\x20face_id=','power_get','maxLng','existsSync','../../db/dbFileOperationRecord','load','noPermission','828556RXgPFp','genTinyFile','\x20AND\x20\x20is_file=1\x20','SELECT\x20*\x20FROM\x20ai_classes\x20where\x20\x20class_name\x20not\x20in\x20','order\x20field\x20error','dialog','../utils/sharpUtils','UPDATE\x20photo_faces\x20SET\x20face_name=?\x20where\x20id\x20=\x20?','\x20LIMIT\x20?\x20OFFSET\x20?','getAllByWhere','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20face_name=?\x20and\x20belong_face_id\x20is\x20null','index_id','normalize','end','getPathByType','delete\x20from\x20photo_faces2index\x20where\x201=1','type','faceApiWaitDealCount','power_change','filename','GPSLatitudeRef','436537mBwDiC','exports','similar_index_id','geohash2\x20=\x20?','maxLat','count','sortType','EDIT','./photoApiUtils','rotate','setFaceId','LEVEL_MAIN_OPERATION','3780612vIhFBw','ngeohash','search','minLat','facesPath','includes','\x20ORDER\x20BY\x20is_file\x20asc,\x20','encode','/deleteAlbum','7EGEytp','\x20order\x20by\x20score\x20desc','parent','../../db/dbSourceFolderTable','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20id=?','locationList','create','getSharpInstanceFromInput','\x20id\x20in\x20(','send','post','photoPreviewSize','/operationLibrary','longitude','getById','currentUser','excludeFilenamePhoto','f2width','/getAlbumPhotoForMap','getCountByWhere','\x20AND\x20geohash5!=\x27undefined\x27\x20GROUP\x20BY\x20geohash5','imgList','SELECT\x20*\x20FROM\x20photo_library\x20','startSimilarPhotoWork','dbOther','.HEIC','data_value','prepare','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time\x20','face_id','aiClassId','ADD','is_admin','Router','findWithField','\x20SET\x20in_trash=1,in_trash_time=','minIndexId','/getPhotoByTime','substring','toString','faceApiWaitCompareCount','dbFileIndex','getAlbumWhereStr','asc','\x20id,geohash,latitude,longitude,original_time\x20','minLng','\x20original_time=?,original_date=?\x20','timestamp','toFile','keepIndexList','mtime','存在livephoto','sourceFolderList','UPDATE\x20photo_faces\x20SET\x20face_name=null\x20where\x20face_name\x20=\x20?','8195ZeMYDQ','getByName','id,username','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20photo_faces2index\x20WHERE\x20compare_state=0','../../utils/exifUtils','.jpg','geohash3\x20=\x20?','\x20AND\x20geohash2!=\x27undefined\x27\x20GROUP\x20BY\x20geohash2','ordinaryAlbumId','/getIndexDetail','UPDATE\x20photo_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','getUserPower','/removeFromFace','faceIdList','ERROR\x20GPS\x20LOCATION','findByTitle','SELECT\x20f.id,f.path,f.filename,f.original_date,f.size\x20FROM\x20photo_phash_similar\x20as\x20a\x20inner\x20join\x20file_index_photo\x20as\x20f\x20on\x20a.similar_index_id=f.id\x20where\x20a.index_id=','shell','SELECT\x20id,path,filename,original_date,size\x20FROM\x20file_index_photo\x20where\x20id=','trash','TYPE_DELETE','indexObj','face_img_path','stringify','paramsList','music','mkdir','geohash','readFile','\x20type=1\x20','photo_index_id','\x20OFFSET\x20','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20share_for_subuser=1','\x20(((type=1\x20or\x20type=2)\x20\x20)\x20OR\x20is_file=0\x20)\x20','faceapi','/updatePhotoFace','/getFaceImg/*','timeOrder','f2height','data','\x20is_file=0\x20','power_add','getFaceInSql','timeType','changes','/addAlbum','cocossd','now','/getTimeLineDateList','movie','isIndexing','3950WFDGwC','INDEX_TABLE_NAME_PHOTO','username','book','1867968DFFUgO','updateBySql','indexFullPath','\x20WHERE\x20title\x20like\x20?','\x20AND\x20filename\x20LIKE\x20?\x20','is_file','.JPG','showFileType','path_list','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?\x20or\x20belong_face_id=?','STATE_FAIL','resize','delete','update\x20file_index_photo\x20set\x20phash=null,phash_compare=0','power_delete','\x20size=?,ctime=?\x20','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=0\x20where\x20is_face_poster=1\x20and\x20face_id\x20in\x20','(\x27mouse\x27,\x27person\x27,\x27traffic\x20light\x27,\x27stop\x20sign\x27,\x27parking\x20meter\x27,\x27fire\x20hydrant\x27)','zoom','title','SELECT\x20*\x20FROM\x20photo_faces\x20where\x20id\x20=?','resolve','update\x20file_index_photo\x20set\x20ai_face_detect_state=0','parse','from','indexOf','dbCity','folderNotExist','Image\x20format\x20not\x20support','checkSqlInjection','searchMode','original_date','getUserPathWhere','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20geohash=?','round','get','/getAllAlbum','geoHashList','join','DELETE','SELECT\x20f.id\x20FROM\x20photo_faces2index\x20as\x20p\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20p.photo_index_id=f.id\x20WHERE\x20p.face_id=?\x20','/switchFaceId','SELECT\x20f.id\x20as\x20photo_index_id\x20FROM\x20ai_classes2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20a.photo_index_id=f.id\x20WHERE\x20a.class_id=?\x20and\x20score>?\x20and\x20\x20f.in_trash=0\x20\x20and\x20f.tiny_path\x20is\x20not\x20null\x20AND\x20f.tiny_path\x20!=\x20\x270\x27\x20\x20','splice','getFileHashName','getList','run','udpateName','similarWaitDealCount','\x20order\x20by\x20f.original_time\x20desc\x20limit\x201','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27','\x20LIMIT\x201','Cleaning\x20out\x20the\x20recycle\x20bin\x20:\x20','express','\x20\x20\x20AND\x20in_trash!=1\x20','文件写入成功','\x20AND\x20','returnErrMsg','/getBoundsPhoto','sep','name','getByWhere','toLowerCase','excludePathPhoto','binary','SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id\x20limit\x20','INDEX_TABLE_NAME_MUSIC','log','undefined','transSpcielFormat','GET','4287805ERtxkk','SELECT\x20f.*,a.id\x20as\x20f2id,a.width\x20as\x20f2width,a.height\x20as\x20f2height,a.x\x20as\x20f2x,a.y\x20as\x20f2y\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20photo_faces2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20a.photo_index_id=f.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20a.face_id\x20in\x20','push','similar','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time,latitude,longitude\x20','similarIndexList','orderField','\x20AND\x20in_trash=0\x20\x20AND\x20is_file=1\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20limit\x201','/getAiDealState','close','/getSimilarPhoto','defaultTranscodeResolution','pathList','isAdmin','cachePath','SELECT\x20*\x20FROM\x20file_index_photo\x20WHERE\x20in_trash=1\x20AND\x20is_file=1\x20AND\x20raw_filename\x20is\x20not\x20null\x20AND\x20raw_filename!=\x27\x27\x20AND\x20type=1'];_0x4277=function(){return _0x347fc;};return _0x4277();}(function(_0x4ff032,_0x179ac1){const _0x5e1472=_0x26ac,_0x22bebf=_0x4ff032();while(!![]){try{const _0x34f36c=parseInt(_0x5e1472(0x20f))/0x1+parseInt(_0x5e1472(0x1fa))/0x2*(-parseInt(_0x5e1472(0x2fa))/0x3)+-parseInt(_0x5e1472(0x1d2))/0x4*(-parseInt(_0x5e1472(0x2d8))/0x5)+parseInt(_0x5e1472(0x291))/0x6+parseInt(_0x5e1472(0x224))/0x7*(-parseInt(_0x5e1472(0x301))/0x8)+-parseInt(_0x5e1472(0x21b))/0x9+-parseInt(_0x5e1472(0x28d))/0xa*(parseInt(_0x5e1472(0x25a))/0xb);if(_0x34f36c===_0x179ac1)break;else _0x22bebf['push'](_0x22bebf['shift']());}catch(_0x251f0d){_0x22bebf['push'](_0x22bebf['shift']());}}}(_0x4277,0x6ce0e));let express=require(_0x2b76de(0x2c6)),router=express[_0x2b76de(0x245)](),path=require(_0x2b76de(0x1d8));const config=require('../../myConfig/config'),dbFileIndexTable=require(_0x2b76de(0x30c)),dbSourceFolderTable=require(_0x2b76de(0x227)),dbFileOperationRecord=require(_0x2b76de(0x1f7)),sqliteUtil=require('../utils/sqliteUtil'),exifUtils=require(_0x2b76de(0x25e)),dbUserTable=require(_0x2b76de(0x2fe)),dbAlbumTable=require('../../db/dbAlbumTable');let geohash=require(_0x2b76de(0x21c)),fs=require('fs');const dbConfigTable=require('../../db/dbConfigTable');let sharpUtil=require(_0x2b76de(0x200));function _0x26ac(_0x50fb7d,_0x2f7531){const _0x42773a=_0x4277();return _0x26ac=function(_0x26aca8,_0x479bf4){_0x26aca8=_0x26aca8-0x1b9;let _0x1cd190=_0x42773a[_0x26aca8];return _0x1cd190;},_0x26ac(_0x50fb7d,_0x2f7531);}const photoApiUtil=require(_0x2b76de(0x217)),platform=require('os')[_0x2b76de(0x1e4)]();let piexif=require('piexifjs');router[_0x2b76de(0x22e)](_0x2b76de(0x28a),(_0x5d5a55,_0x4a7233,_0x1e34f7)=>{const _0x4e424e=_0x2b76de;if(dbUserTable[_0x4e424e(0x1b9)](_0x5d5a55,_0x4a7233,_0x4e424e(0x313),_0x4e424e(0x1f4))==!![]){let _0x7c5622=_0x5d5a55['body'][_0x4e424e(0x1ec)],_0x18dea0=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x20a)],_0x1cab4a=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x275)],_0x558433=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x320)],_0x37cdb5=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x310)],_0x55042a=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x262)],_0x9d8b7d=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x242)],_0x1677ec=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x1e0)],_0x499ad5=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x31c)],_0x11bdb3=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x27f)],_0x16fde8=_0x5d5a55[_0x4e424e(0x1c2)][_0x4e424e(0x258)],_0x278192=dbUserTable['getUserPathWhere'](_0x5d5a55,_0x4e424e(0x313),_0x4e424e(0x1f4),!![],_0x16fde8),_0x1fd07f=_0x278192[_0x4e424e(0x303)],_0x4c136e=[..._0x278192[_0x4e424e(0x272)]];_0x1cab4a&&(_0x1fd07f+='\x20AND\x20geohash\x20LIKE\x20?\x20',_0x4c136e[_0x4e424e(0x2da)](_0x1cab4a+'%'));let _0x18452d=dbSourceFolderTable[_0x4e424e(0x1e1)](_0x5d5a55['app'][_0x4e424e(0x23c)],_0x4e424e(0x1d8),_0x4e424e(0x2d0));_0x18452d&&(_0x1fd07f+=_0x4e424e(0x2c9)+_0x18452d);let _0x3e14b0=dbSourceFolderTable[_0x4e424e(0x1e1)](_0x5d5a55[_0x4e424e(0x30a)][_0x4e424e(0x23c)],_0x4e424e(0x20d),_0x4e424e(0x234));_0x3e14b0&&(_0x1fd07f+=_0x4e424e(0x2c9)+_0x3e14b0);if(_0x1677ec){let _0x5d5848=_0x5d5a55[_0x4e424e(0x30a)][_0x4e424e(0x24d)][_0x4e424e(0x23f)]('SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20id=?')['get'](_0x1677ec);if(_0x5d5848)try{let _0x35da55=JSON[_0x4e424e(0x2a8)](_0x5d5848[_0x4e424e(0x299)]),_0x1f937a=dbUserTable[_0x4e424e(0x32f)](!![],_0x35da55);_0x1fd07f+=_0x1f937a[_0x4e424e(0x303)],_0x4c136e=_0x4c136e[_0x4e424e(0x1bb)](_0x1f937a[_0x4e424e(0x272)]);}catch(_0x199b4b){console[_0x4e424e(0x2d4)](_0x199b4b);}}if(_0x558433){let _0x51c12d=dbAlbumTable[_0x4e424e(0x24e)](_0x5d5a55[_0x4e424e(0x30a)][_0x4e424e(0x23c)],_0x558433);_0x51c12d&&(_0x1fd07f+=_0x4e424e(0x2c9)+_0x51c12d);}_0x37cdb5&&(_0x1fd07f+=_0x4e424e(0x2f1),_0x4c136e[_0x4e424e(0x2da)]('%'+_0x37cdb5+'%'),_0x4c136e['push']('%'+_0x37cdb5+'%'));_0x1fd07f+=_0x4e424e(0x2c7);let _0x20c3b4=dbFileIndexTable[_0x4e424e(0x2f5)](_0x5d5a55[_0x4e424e(0x30a)][_0x4e424e(0x24d)],_0x7c5622,_0x18dea0,_0x1fd07f,_0x55042a,_0x9d8b7d,_0x499ad5,_0x4c136e,_0x11bdb3);_0x4a7233['json']({'code':0x0,'data':_0x20c3b4});}});let geoDbCache={};router[_0x2b76de(0x22e)](_0x2b76de(0x249),(_0x539232,_0x4eff63,_0x196353)=>{const _0x4e8566=_0x2b76de;if(dbUserTable['doUserCanGet'](_0x539232,_0x4eff63,'photo','power_get')==!![]){result=photoApiUtil['getPhotoByParams'](_0x539232,_0x4eff63);let _0x5786dc=[],_0x366fdb=[];try{let _0x2a4f46=Date[_0x4e8566(0x289)]();if(result&&result['length']>0x0){for(let _0x3af2bc of result){!_0x5786dc['includes'](_0x3af2bc[_0x4e8566(0x2b0)])&&(_0x5786dc[_0x4e8566(0x2da)](_0x3af2bc[_0x4e8566(0x2b0)]),_0x366fdb[_0x4e8566(0x2da)]({'date':_0x3af2bc[_0x4e8566(0x2b0)],'geoHashList':[],'locationList':[]}));if(_0x3af2bc[_0x4e8566(0x275)]&&_0x3af2bc['geohash']!=_0x4e8566(0x2d5)&&_0x3af2bc['geohash'][_0x4e8566(0x1c8)]>0x4){let _0x296864=_0x366fdb[_0x5786dc[_0x4e8566(0x2aa)](_0x3af2bc[_0x4e8566(0x2b0)])][_0x4e8566(0x2b6)],_0x1dba28=_0x3af2bc['geohash']['substring'](0x0,0x5);!_0x296864['includes'](_0x1dba28)&&_0x296864['length']<0x5&&_0x296864[_0x4e8566(0x2da)](_0x1dba28);}}for(let _0x54413e of _0x366fdb){if(_0x54413e['geoHashList']['length']<0x1)continue;for(let _0x36d936 in _0x54413e[_0x4e8566(0x2b6)]){let _0x1d39ea=_0x54413e['geoHashList'][_0x36d936]['substring'](0x0,0x5),_0x3bdb26=null;if(geoDbCache[_0x1d39ea])_0x3bdb26=geoDbCache[_0x1d39ea];else{let _0x54d80d=_0x4e8566(0x2b2);_0x3bdb26=_0x539232[_0x4e8566(0x30a)][_0x4e8566(0x2ab)][_0x4e8566(0x23f)](_0x54d80d)[_0x4e8566(0x2b4)](_0x1d39ea),geoDbCache[_0x1d39ea]=_0x3bdb26;}_0x3bdb26&&_0x54413e[_0x4e8566(0x229)][_0x4e8566(0x2da)](_0x3bdb26);}delete _0x54413e['geoHashList'];}for(let _0x3c3d44=_0x366fdb['length']-0x1;_0x3c3d44>=0x0;_0x3c3d44--){_0x366fdb[_0x3c3d44]['locationList']['length']<0x1&&_0x366fdb[_0x4e8566(0x2bc)](_0x3c3d44,0x1);}}}catch(_0x4a09b3){console[_0x4e8566(0x2d4)](_0x4a09b3);}let _0x3a4501={'code':0x0,'data':result,'originalDateItemList':_0x366fdb},_0x56997e=dbConfigTable[_0x4e8566(0x269)](_0x539232['app'][_0x4e8566(0x23c)],_0x4e8566(0x327)),_0x25eb8f=dbConfigTable[_0x4e8566(0x269)](_0x539232['app']['dbOther'],_0x4e8566(0x22f));_0x3a4501['imagePreviewType']=_0x4e8566(0x32a);if(_0x56997e&&_0x56997e[_0x4e8566(0x322)]==_0x4e8566(0x31f)&&_0x25eb8f&&_0x25eb8f[_0x4e8566(0x322)])try{let _0x42787a=parseInt(_0x25eb8f[_0x4e8566(0x322)]);_0x3a4501[_0x4e8566(0x2f8)]=_0x4e8566(0x31f),_0x3a4501['imagePreviewSize']=_0x42787a;}catch(_0x53fd1d){console[_0x4e8566(0x2d4)](_0x53fd1d);}_0x4eff63[_0x4e8566(0x309)](_0x3a4501);}}),router[_0x2b76de(0x22e)](_0x2b76de(0x236),(_0x5d4689,_0x1d0d57,_0x106a4c)=>{const _0x21d053=_0x2b76de;let _0x29167b=_0x21d053(0x1ba),_0x5665ff=[],_0x528b16=_0x5d4689[_0x21d053(0x1c2)][_0x21d053(0x1e0)];if(_0x5d4689[_0x21d053(0x1c2)][_0x21d053(0x320)]){let _0x30e96f=dbAlbumTable[_0x21d053(0x24e)](_0x5d4689['app'][_0x21d053(0x23c)],_0x5d4689[_0x21d053(0x1c2)][_0x21d053(0x320)]);_0x30e96f&&(_0x29167b+=_0x21d053(0x2c9)+_0x30e96f);}if(_0x528b16){let _0x4c671f=_0x5d4689[_0x21d053(0x30a)]['dbFileIndex']['prepare'](_0x21d053(0x228))[_0x21d053(0x2b4)](_0x528b16);if(_0x4c671f)try{let _0x1ac6d7=JSON[_0x21d053(0x2a8)](_0x4c671f[_0x21d053(0x299)]),_0x2f9a25=dbUserTable[_0x21d053(0x32f)](!![],_0x1ac6d7);_0x29167b+=_0x2f9a25['whereStr'],_0x5665ff[_0x21d053(0x2da)](..._0x2f9a25[_0x21d053(0x272)]);}catch(_0xdbff7c){console[_0x21d053(0x2d4)](_0xdbff7c);}}function _0x460ea7(_0x1edeca,_0x452366,_0x3412f6){const _0x16171d=_0x21d053;if(_0x3412f6){let _0x35160e=0x0;if(_0x5d4689['body'][_0x16171d(0x262)]){let _0x1da9b2=dbFileIndexTable[_0x16171d(0x1d1)](_0x5d4689[_0x16171d(0x30a)][_0x16171d(0x24d)],_0x1edeca,[parseInt(_0x5d4689[_0x16171d(0x1c2)][_0x16171d(0x262)]),..._0x5665ff]);_0x35160e=_0x1da9b2[_0x16171d(0x214)];}else{let _0xea294c=dbFileIndexTable[_0x16171d(0x237)](_0x5d4689[_0x16171d(0x30a)]['dbFileIndex'],_0x1edeca,dbFileIndexTable[_0x16171d(0x28e)],_0x5665ff);_0x35160e=_0xea294c[_0x16171d(0x214)];}return _0x35160e;}else{let _0x331acd=[];return _0x5d4689[_0x16171d(0x1c2)][_0x16171d(0x262)]?_0x331acd=dbFileIndexTable['getAllByWhereAndFieldFromOrdinaryAlbum'](_0x5d4689[_0x16171d(0x30a)][_0x16171d(0x24d)],_0x1edeca,_0x452366,[parseInt(_0x5d4689[_0x16171d(0x1c2)]['ordinaryAlbumId']),..._0x5665ff]):_0x331acd=dbFileIndexTable['getAllByWhereAndField'](_0x5d4689[_0x16171d(0x30a)][_0x16171d(0x24d)],_0x1edeca,_0x452366,dbFileIndexTable[_0x16171d(0x28e)],_0x5665ff),_0x331acd;}}let _0x2fbb87=dbUserTable[_0x21d053(0x2b1)](_0x5d4689,_0x21d053(0x313),'power_get',!![]),_0x564474=_0x2fbb87[_0x21d053(0x303)];_0x29167b+=_0x564474,_0x5665ff[_0x21d053(0x2da)](..._0x2fbb87['paramsList']),_0x29167b+=_0x21d053(0x1fc);let _0x3f8a07=0xc8,_0x112679=[],_0x4d06f1=_0x460ea7(_0x29167b,null,!![]);if(_0x4d06f1<_0x3f8a07)_0x112679=_0x460ea7(_0x29167b,'*');else{let _0x2812f6=_0x29167b+_0x21d053(0x238),_0x53fcfd=_0x460ea7(_0x2812f6,'*');if(_0x53fcfd&&_0x53fcfd[_0x21d053(0x1c8)]<_0x3f8a07)_0x112679=_0x53fcfd;else{let _0x43763c=_0x29167b+_0x21d053(0x315),_0x1b379a=_0x460ea7(_0x43763c,'*');if(_0x1b379a&&_0x1b379a[_0x21d053(0x1c8)]<_0x3f8a07)_0x112679=_0x1b379a;else{let _0x8f249e=_0x29167b+_0x21d053(0x1c4),_0x36217c=_0x460ea7(_0x8f249e,'*');if(_0x36217c&&_0x36217c[_0x21d053(0x1c8)]<_0x3f8a07)_0x112679=_0x36217c;else{let _0x4c18d1=_0x29167b+_0x21d053(0x261);_0x112679=_0x460ea7(_0x4c18d1,'*');}}}}return _0x1d0d57['json']({'code':0x0,'mapPhoto':_0x112679});}),router[_0x2b76de(0x22e)](_0x2b76de(0x2cb),(_0x5172a5,_0x59433b,_0x20f945)=>{const _0x248196=_0x2b76de;if(dbUserTable[_0x248196(0x1b9)](_0x5172a5,_0x59433b,_0x248196(0x313),'power_get')==!![]){let _0x122639=_0x5172a5[_0x248196(0x1c2)][_0x248196(0x21e)],_0x4f2ee0=_0x5172a5[_0x248196(0x1c2)][_0x248196(0x251)],_0x50b3cc=_0x5172a5['body'][_0x248196(0x213)],_0x5a383e=_0x5172a5[_0x248196(0x1c2)][_0x248196(0x1f5)],_0x21838f=_0x5172a5[_0x248196(0x1c2)][_0x248196(0x2a3)],_0x444184='',_0x3f810d=0x2;if(_0x21838f<=0x4)_0x3f810d=0x2,_0x444184=_0x248196(0x212);else{if(_0x21838f<=0x6)_0x3f810d=0x3,_0x444184=_0x248196(0x260);else _0x21838f<=0x8?(_0x3f810d=0x4,_0x444184=_0x248196(0x2ef)):(_0x3f810d=0x5,_0x444184=_0x248196(0x1df));}let _0x11725c=geohash[_0x248196(0x1cc)](_0x122639,_0x4f2ee0,_0x50b3cc,_0x5a383e,_0x3f810d),_0x19cd49=_0x248196(0x250),_0x28f845=[],_0x176381=dbUserTable[_0x248196(0x2b1)](_0x5172a5,_0x248196(0x313),_0x248196(0x1f4),!![]);for(let _0x48d8b7=0x0;_0x48d8b7<_0x11725c['length'];_0x48d8b7++){let _0xbe2967=_0x11725c[_0x48d8b7],_0x493e12=[_0xbe2967,..._0x176381[_0x248196(0x272)]],_0x3b7e1f='\x20'+_0x444184+'\x20'+_0x176381[_0x248196(0x303)]+_0x248196(0x2df),_0x98e369=dbFileIndexTable[_0x248196(0x2ce)](_0x5172a5['app'][_0x248196(0x24d)],_0x3b7e1f,_0x19cd49,dbFileIndexTable[_0x248196(0x28e)],_0x493e12);_0x98e369&&_0x28f845[_0x248196(0x2da)](_0x98e369);}_0x59433b[_0x248196(0x309)]({'code':0x0,'mapPhoto':_0x28f845});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x287),(_0x719cbb,_0x1e070f,_0x45b6fb)=>{const _0x16bb09=_0x2b76de;if(dbUserTable[_0x16bb09(0x1b9)](_0x719cbb,_0x1e070f,_0x16bb09(0x313),_0x16bb09(0x283))==!![]){let _0x372f86=_0x719cbb['body'][_0x16bb09(0x20a)],_0x1d07a3=_0x719cbb[_0x16bb09(0x1c2)][_0x16bb09(0x281)],_0x328265=_0x719cbb[_0x16bb09(0x1c2)][_0x16bb09(0x23e)],_0x268d5a=_0x719cbb[_0x16bb09(0x1c2)][_0x16bb09(0x2cd)],_0x4924db=_0x719cbb[_0x16bb09(0x1c2)][_0x16bb09(0x1db)];if(!_0x1d07a3||!_0x1d07a3[_0x16bb09(0x323)]||sqliteUtil[_0x16bb09(0x2ae)](_0x1d07a3['searchValue'])==!![])return _0x719cbb[_0x16bb09(0x30a)][_0x16bb09(0x2ca)](_0x1e070f,_0x16bb09(0x311));if(!_0x4924db){let _0x26c676=dbAlbumTable[_0x16bb09(0x25b)](_0x719cbb[_0x16bb09(0x30a)][_0x16bb09(0x23c)],_0x268d5a);if(_0x26c676)return _0x719cbb['app']['returnErrMsg'](_0x1e070f,_0x1e070f['__'](_0x16bb09(0x1e6)));}let _0x8d4b77=null;_0x4924db?_0x8d4b77=dbAlbumTable['update'](_0x719cbb[_0x16bb09(0x30a)][_0x16bb09(0x23c)],{'type':_0x372f86,'data':_0x1d07a3,'data_value':_0x328265,'name':_0x268d5a},_0x4924db):_0x8d4b77=dbAlbumTable[_0x16bb09(0x22a)](_0x719cbb[_0x16bb09(0x30a)][_0x16bb09(0x23c)],{'type':_0x372f86,'data':_0x1d07a3,'data_value':_0x328265,'name':_0x268d5a}),_0x1e070f[_0x16bb09(0x309)]({'code':0x0,'result':_0x8d4b77});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x223),(_0x3c125a,_0x400113,_0x2fb800)=>{const _0x5eebec=_0x2b76de;if(dbUserTable[_0x5eebec(0x1b9)](_0x3c125a,_0x400113,_0x5eebec(0x313),_0x5eebec(0x29f))==!![]){let _0x32b82f=_0x3c125a[_0x5eebec(0x1c2)]['id'],_0x2e6581=dbAlbumTable[_0x5eebec(0x29d)](_0x3c125a[_0x5eebec(0x30a)]['dbOther'],_0x32b82f);_0x2e6581[_0x5eebec(0x286)]>0x0?_0x400113['json']({'code':0x0,'result':_0x2e6581}):_0x400113[_0x5eebec(0x309)]({'code':0x1,'message':_0x5eebec(0x2f0)});}}),router[_0x2b76de(0x22e)]('/updateAlbum',(_0x28daff,_0x3db2a8,_0x29650c)=>{const _0x1f7508=_0x2b76de;if(dbUserTable[_0x1f7508(0x1b9)](_0x28daff,_0x3db2a8,_0x1f7508(0x313),_0x1f7508(0x20c))==!![]){let _0x131433=_0x28daff['body']['id'],_0xa7267=_0x28daff[_0x1f7508(0x1c2)][_0x1f7508(0x2cd)],_0x5ebb48=dbAlbumTable[_0x1f7508(0x25b)](_0x28daff['app']['dbOther'],_0xa7267);if(_0x5ebb48)return _0x28daff[_0x1f7508(0x30a)][_0x1f7508(0x2ca)](_0x3db2a8,_0x3db2a8['__']('album.sameNameExist'));let _0x9ecff4=dbAlbumTable[_0x1f7508(0x2c0)](_0x28daff[_0x1f7508(0x30a)]['dbOther'],_0x131433,_0xa7267);_0x9ecff4[_0x1f7508(0x286)]>0x0?_0x3db2a8[_0x1f7508(0x309)]({'code':0x0,'result':_0x9ecff4}):_0x3db2a8['json']({'code':0x1,'message':_0x1f7508(0x2f0)});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x2b5),(_0x1dcbcc,_0x3b4c6e,_0x2eb66c)=>{const _0x569ff4=_0x2b76de;if(dbUserTable['doUserCanGet'](_0x1dcbcc,_0x3b4c6e,_0x569ff4(0x313),_0x569ff4(0x1f4))==!![]){let _0x21def5=_0x1dcbcc[_0x569ff4(0x1c2)][_0x569ff4(0x214)]||0x32,_0x167436=_0x1dcbcc[_0x569ff4(0x1c2)]['offset']||0x0,_0x5d061b=_0x1dcbcc[_0x569ff4(0x1c2)]['orderField']||'id',_0x50a866=_0x1dcbcc[_0x569ff4(0x1c2)][_0x569ff4(0x32d)]||_0x569ff4(0x330),_0x6ca2ea=_0x1dcbcc[_0x569ff4(0x1c2)][_0x569ff4(0x21d)],_0x5ee852=dbAlbumTable[_0x569ff4(0x2be)](_0x1dcbcc[_0x569ff4(0x30a)]['dbOther'],_0x21def5,_0x167436,_0x5d061b,_0x50a866,_0x6ca2ea),_0x530d06=dbUserTable[_0x569ff4(0x2b1)](_0x1dcbcc,_0x569ff4(0x313),_0x569ff4(0x1f4),!![]);for(let _0xa7dfe9=0x0;_0xa7dfe9<_0x5ee852[_0x569ff4(0x1c8)];_0xa7dfe9++){let _0x210984=_0x569ff4(0x321);_0x210984+=_0x530d06[_0x569ff4(0x303)];let _0x213a19=[..._0x530d06['paramsList']],_0x3fe245=dbAlbumTable['getAlbumWhereStr'](_0x1dcbcc['app'][_0x569ff4(0x23c)],_0x5ee852[_0xa7dfe9]['id']);_0x3fe245&&(_0x210984+=_0x569ff4(0x2c9)+_0x3fe245);_0x210984+='\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0',_0x210984+='\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201';try{let _0x3b1470=dbFileIndexTable[_0x569ff4(0x203)](_0x1dcbcc[_0x569ff4(0x30a)][_0x569ff4(0x24d)],_0x210984,'*',dbFileIndexTable[_0x569ff4(0x28e)],_0x213a19);_0x5ee852[_0xa7dfe9][_0x569ff4(0x239)]=_0x3b1470;}catch(_0x5fa861){console[_0x569ff4(0x2d4)](_0x5fa861),_0x5ee852[_0xa7dfe9][_0x569ff4(0x239)]=[];}}_0x3b4c6e[_0x569ff4(0x309)]({'code':0x0,'data':_0x5ee852});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x1ee),(_0x520226,_0xfbf14,_0x5d05b0)=>{const _0x18647d=_0x2b76de;let _0x108a71=_0x520226[_0x18647d(0x1c2)]['key'],_0x509900=dbFileIndexTable[_0x18647d(0x2af)](_0x520226[_0x18647d(0x30a)][_0x18647d(0x24d)],_0x108a71),_0x199c48=[];for(let _0x1a646b=0x0;_0x1a646b<_0x509900['length'];_0x1a646b++){_0x199c48[_0x18647d(0x2da)](_0x509900[_0x1a646b]['mode']);}_0xfbf14[_0x18647d(0x309)]({'code':0x0,'data':_0x199c48});}),router[_0x2b76de(0x22e)](_0x2b76de(0x1e9),(_0x5b8d4d,_0x848e14,_0x4be7c4)=>{const _0x50b37b=_0x2b76de;let _0x506a7d=_0x5b8d4d['body'][_0x50b37b(0x226)],_0x209ee7=_0x5b8d4d[_0x50b37b(0x1c2)]['serveType'],_0x2f7269=_0x5b8d4d['body'][_0x50b37b(0x214)],_0x401527=_0x5b8d4d[_0x50b37b(0x1c2)][_0x50b37b(0x1f1)]||0x0;_0x401527=parseInt(_0x401527);let _0x2223ba=parseInt(_0x5b8d4d[_0x50b37b(0x1c2)][_0x50b37b(0x298)]),_0x1cea47=_0x5b8d4d[_0x50b37b(0x1c2)][_0x50b37b(0x310)],_0x18d8c5=[_0x50b37b(0x20d),_0x50b37b(0x1e8),'size',_0x50b37b(0x319),_0x50b37b(0x325)],_0x518ac7=[_0x50b37b(0x24f),'desc'],_0x1b4f9b=_0x5b8d4d[_0x50b37b(0x1c2)][_0x50b37b(0x2de)]||'id',_0x26193b=_0x5b8d4d[_0x50b37b(0x1c2)]['orderType']||'desc';!_0x18d8c5['includes'](_0x1b4f9b)&&(_0x1b4f9b='id');!_0x518ac7[_0x50b37b(0x220)](_0x26193b)&&(_0x1b4f9b=_0x50b37b(0x330));if(dbUserTable[_0x50b37b(0x1b9)](_0x5b8d4d,_0x848e14,_0x209ee7,_0x50b37b(0x1f4))==!![]){let _0x347239=[];if(!_0x506a7d){let _0x34b320=[];_0x5b8d4d[_0x50b37b(0x233)][_0x50b37b(0x244)]==0x1?_0x34b320=dbSourceFolderTable[_0x50b37b(0x208)](_0x5b8d4d[_0x50b37b(0x30a)][_0x50b37b(0x23c)],_0x209ee7):_0x34b320=dbUserTable[_0x50b37b(0x265)](_0x5b8d4d[_0x50b37b(0x30a)]['dbOther'],_0x5b8d4d['currentUser'][_0x50b37b(0x28f)],_0x209ee7);if(_0x34b320)for(let _0x3b284e=0x0;_0x3b284e<_0x34b320['length'];_0x3b284e++){_0x347239[_0x50b37b(0x2da)]({'path':_0x34b320[_0x3b284e][_0x50b37b(0x1d8)],'is_file':0x0,'filename':path[_0x50b37b(0x1be)](_0x34b320[_0x3b284e][_0x50b37b(0x1d8)]),'root':!![]});}}else{if(_0x5b8d4d[_0x50b37b(0x233)][_0x50b37b(0x244)]!=0x1){if(dbUserTable[_0x50b37b(0x1b9)](_0x5b8d4d,_0x848e14,_0x209ee7,_0x50b37b(0x1f4),_0x506a7d)!==!![])return;}_0x506a7d=path[_0x50b37b(0x2a6)](path[_0x50b37b(0x206)](_0x506a7d));let _0x175c27='\x20path=\x20?\x20AND\x20',_0x17c64e=[_0x506a7d];if(_0x2223ba==0x0)_0x175c27+=_0x50b37b(0x27b);else{if(_0x2223ba==0x1)_0x175c27+=_0x50b37b(0x277);else{if(_0x2223ba==0x2)_0x175c27+=_0x50b37b(0x31b);else _0x2223ba==0x3&&(_0x175c27+=_0x50b37b(0x282));}}if(_0x1cea47){let _0x5e2c11='\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)\x20';_0x17c64e[_0x50b37b(0x2da)]('%'+_0x1cea47+'%','\x27%'+_0x1cea47+'%\x27'),_0x209ee7==_0x50b37b(0x28b)&&(_0x5e2c11=_0x50b37b(0x295),_0x17c64e['push']('\x27%'+_0x1cea47+'%\x27')),_0x175c27+=_0x5e2c11;}let _0x89c273=_0x50b37b(0x2dc),_0x1ad3b2=dbFileIndexTable[_0x50b37b(0x304)](_0x209ee7);if(_0x209ee7==_0x50b37b(0x28b))_0x89c273=_0x50b37b(0x240);else _0x209ee7==_0x50b37b(0x273)&&(_0x89c273='\x20is_file,id,path,filename,ext,duration,size\x20');_0x175c27+=_0x50b37b(0x221)+_0x1b4f9b+'\x20'+_0x26193b+'\x20LIMIT\x20'+_0x2f7269+_0x50b37b(0x279)+_0x401527,_0x347239=dbFileIndexTable[_0x50b37b(0x203)](_0x5b8d4d['app']['dbFileIndex'],_0x175c27,_0x89c273,_0x1ad3b2,_0x17c64e);}let _0x4964f3=path['sep'],_0x86c73f={'platform':platform,'code':0x0,'data':_0x347239,'sep':_0x4964f3};return _0x848e14[_0x50b37b(0x309)](_0x86c73f);}}),router['post'](_0x2b76de(0x263),(_0x3f9157,_0x160c55,_0x4aae98)=>{const _0x35a44d=_0x2b76de;let _0xd7f225=_0x3f9157[_0x35a44d(0x1c2)]['id'],_0x13c556=_0x3f9157[_0x35a44d(0x1c2)][_0x35a44d(0x331)],_0x73f52c=dbFileIndexTable[_0x35a44d(0x28e)];if(_0x13c556=='movie')_0x73f52c=dbFileIndexTable[_0x35a44d(0x1e7)];else{if(_0x13c556=='music')_0x73f52c=dbFileIndexTable[_0x35a44d(0x2d3)];else _0x13c556==_0x35a44d(0x290)&&(_0x73f52c=dbFileIndexTable[_0x35a44d(0x329)]);}let _0x2bde24=dbFileIndexTable[_0x35a44d(0x232)](_0x3f9157['app']['dbFileIndex'],_0xd7f225,_0x73f52c);if(!_0x2bde24)return _0x160c55[_0x35a44d(0x1ef)](0x194)[_0x35a44d(0x207)]();if(dbUserTable['doUserCanGet'](_0x3f9157,_0x160c55,'',_0x35a44d(0x1f4),_0x2bde24[_0x35a44d(0x1d8)])==!![]){let _0x1ad5cc={'code':0x0,'data':_0x2bde24};if(_0x13c556=='movie'){let _0x488ae8=dbConfigTable[_0x35a44d(0x269)](_0x3f9157[_0x35a44d(0x30a)]['dbOther'],_0x35a44d(0x308));_0x1ad5cc[_0x35a44d(0x308)]=_0x488ae8?_0x488ae8[_0x35a44d(0x322)]:'chi',_0x1ad5cc[_0x35a44d(0x281)][_0x35a44d(0x308)]=_0x1ad5cc[_0x35a44d(0x308)];let _0x3d5739=dbConfigTable[_0x35a44d(0x269)](_0x3f9157[_0x35a44d(0x30a)]['dbOther'],_0x35a44d(0x1e3));_0x1ad5cc[_0x35a44d(0x1e3)]=_0x3d5739?_0x3d5739['value']:'2',_0x1ad5cc[_0x35a44d(0x281)]['moviePlaylongPressRate']=_0x1ad5cc[_0x35a44d(0x1e3)];let _0x2c2a22=dbConfigTable[_0x35a44d(0x269)](_0x3f9157['app'][_0x35a44d(0x23c)],_0x35a44d(0x2e3));_0x1ad5cc[_0x35a44d(0x2e3)]=_0x2c2a22?_0x2c2a22['value']:'3';let _0x1e32d9=dbConfigTable[_0x35a44d(0x269)](_0x3f9157['app'][_0x35a44d(0x23c)],'defaultMoviePlay');_0x1ad5cc[_0x35a44d(0x2ed)]=_0x1e32d9?_0x1e32d9[_0x35a44d(0x322)]:'rawFile';let _0x1d0329=path[_0x35a44d(0x2b7)](_0x2bde24[_0x35a44d(0x1d8)],_0x2bde24['filename']);fs[_0x35a44d(0x1e5)](_0x1d0329,(_0x1bbcea,_0x361833)=>{const _0x1e92c5=_0x35a44d;return _0x1bbcea?(_0x1ad5cc[_0x1e92c5(0x2fc)]=0x0,_0x1ad5cc[_0x1e92c5(0x293)]=_0x1d0329):(_0x1ad5cc[_0x1e92c5(0x2fc)]=0x1,_0x1ad5cc[_0x1e92c5(0x293)]=_0x1d0329),_0x160c55[_0x1e92c5(0x309)](_0x1ad5cc);});}else return _0x160c55['json'](_0x1ad5cc);}}),router['post']('/editExifByIndexId',(_0x589703,_0x4ff9f3,_0x3778a6)=>{const _0xfa5611=_0x2b76de;if(dbUserTable[_0xfa5611(0x1b9)](_0x589703,_0x4ff9f3,_0xfa5611(0x313),_0xfa5611(0x20c))==!![]){let _0x1af8e7=_0x589703[_0xfa5611(0x1c2)]['id'],_0xed2528=_0x589703[_0xfa5611(0x1c2)][_0xfa5611(0x1f0)],_0x1cee98=_0x589703[_0xfa5611(0x1c2)][_0xfa5611(0x231)],_0x350133=_0x589703[_0xfa5611(0x1c2)]['newDate'],_0x456f7a=dbFileIndexTable[_0xfa5611(0x232)](_0x589703[_0xfa5611(0x30a)][_0xfa5611(0x24d)],_0x1af8e7);if(!_0x456f7a)return _0x589703['app'][_0xfa5611(0x2ca)](_0x4ff9f3,_0x4ff9f3['__'](_0xfa5611(0x2e9)));let _0x4415c8=path[_0xfa5611(0x2b7)](_0x456f7a[_0xfa5611(0x1d8)],path['sep'],_0x456f7a['filename']),_0x3119b1=path[_0xfa5611(0x1d7)](_0x4415c8)?path['extname'](_0x4415c8)[_0xfa5611(0x2cf)]():'';if(_0x3119b1!=_0xfa5611(0x25f)&&_0x3119b1!=_0xfa5611(0x338))return _0x589703['app'][_0xfa5611(0x2ca)](_0x4ff9f3,_0xfa5611(0x2ad));fs[_0xfa5611(0x1e5)](_0x4415c8,(_0x36e49d,_0x26c811)=>{const _0x2aec60=_0xfa5611;if(_0x36e49d||!_0x26c811['isFile']())return _0x589703[_0x2aec60(0x30a)]['returnErrMsg'](_0x4ff9f3,_0x4ff9f3['__'](_0x2aec60(0x2ac)));if(_0x36e49d||!_0x26c811[_0x2aec60(0x2f3)]())return _0x589703[_0x2aec60(0x30a)][_0x2aec60(0x2ca)](_0x4ff9f3,_0x4ff9f3['__'](_0x2aec60(0x2ac)));fs[_0x2aec60(0x276)](_0x4415c8,(_0x33fe56,_0x200d43)=>{const _0x423d9f=_0x2aec60;if(_0x33fe56)return _0x589703[_0x423d9f(0x30a)]['returnErrMsg'](_0x4ff9f3,_0x4ff9f3['__'](_0x423d9f(0x32e)));var _0x3ccf15=piexif[_0x423d9f(0x1f8)](_0x200d43[_0x423d9f(0x24b)](_0x423d9f(0x2d1)));if(_0xed2528&&_0x1cee98){function _0x37941b(_0x3a39d0){const _0xf980c9=_0x423d9f;try{_0x3a39d0=Number(_0x3a39d0);let _0x5f5b3d=Math['floor'](Math[_0xf980c9(0x1c0)](_0x3a39d0)),_0x2f0fe8=(Math[_0xf980c9(0x1c0)](_0x3a39d0)-_0x5f5b3d)*0x3c,_0x15f672=Math['floor'](_0x2f0fe8),_0x2cd57f=Math[_0xf980c9(0x2b3)]((_0x2f0fe8-_0x15f672)*0x3c*0x64);return[[_0x5f5b3d,0x1],[_0x15f672,0x1],[_0x2cd57f,0x64]];}catch(_0x3eeb85){return'';}}let _0x347477=_0x37941b(_0xed2528),_0x2f419d=_0x37941b(_0x1cee98);if(!_0x2f419d||!_0x347477)return _0x589703['app']['returnErrMsg'](_0x4ff9f3,_0x423d9f(0x268));_0x3ccf15[_0x423d9f(0x332)][piexif['GPSIFD'][_0x423d9f(0x20e)]]=_0xed2528>=0x0?'N':'S',_0x3ccf15[_0x423d9f(0x332)][piexif[_0x423d9f(0x1ce)][_0x423d9f(0x326)]]=_0x347477,(_0x3ccf15['GPS'][piexif[_0x423d9f(0x1ce)][_0x423d9f(0x1cf)]]=_0x1cee98>=0x0?'E':'W',_0x3ccf15[_0x423d9f(0x332)][piexif['GPSIFD']['GPSLongitude']]=_0x2f419d);let _0x3e8e2d=geohash[_0x423d9f(0x222)](_0xed2528,_0x1cee98,0x8),_0x348edf=_0x3e8e2d[_0x423d9f(0x24a)](0x0,0x5),_0x2b2ce0=_0x3e8e2d[_0x423d9f(0x24a)](0x0,0x4),_0xde82a3=_0x3e8e2d['substring'](0x0,0x3),_0x1868be=_0x3e8e2d[_0x423d9f(0x24a)](0x0,0x2),_0xe10851=[_0xed2528,_0x1cee98,_0x3e8e2d,_0x348edf,_0x2b2ce0,_0xde82a3,_0x1868be];dbFileIndexTable[_0x423d9f(0x292)](_0x589703[_0x423d9f(0x30a)][_0x423d9f(0x24d)],_0x456f7a['id'],_0x423d9f(0x1c1),dbFileIndexTable[_0x423d9f(0x28e)],_0xe10851);}if(_0x350133){_0x3ccf15['Exif'][piexif['ExifIFD'][_0x423d9f(0x31e)]]=_0x350133,_0x3ccf15[_0x423d9f(0x332)][piexif['GPSIFD']['GPSDateStamp']]=_0x350133;let _0x43d7ec=new Date(_0x350133),_0x1382f6=_0x43d7ec[_0x423d9f(0x1d5)](),_0x4aec86=_0x43d7ec['getFullYear'](),_0xbf18ce=_0x43d7ec[_0x423d9f(0x2f6)]()+0x1;_0xbf18ce=_0xbf18ce>=0xa?_0xbf18ce:'0'+_0xbf18ce;let _0x3acae6=_0x43d7ec['getDate']();_0x3acae6=_0x3acae6>=0xa?_0x3acae6:'0'+_0x3acae6;let _0x3530cf=_0x4aec86+'-'+_0xbf18ce+'-'+_0x3acae6,_0x2cd574=[_0x1382f6,_0x3530cf];dbFileIndexTable['updateBySql'](_0x589703['app']['dbFileIndex'],_0x456f7a['id'],_0x423d9f(0x252),dbFileIndexTable[_0x423d9f(0x28e)],_0x2cd574);}try{var _0x37e569=piexif['dump'](_0x3ccf15),_0x5eff31=piexif['insert'](_0x37e569,_0x200d43[_0x423d9f(0x24b)](_0x423d9f(0x2d1)));let _0x7aba5d=path['join'](_0x456f7a[_0x423d9f(0x1d8)],_0x456f7a['filename']);fs[_0x423d9f(0x1f2)](_0x7aba5d,Buffer[_0x423d9f(0x2a9)](_0x5eff31,_0x423d9f(0x2d1)),{},_0x9f08c=>{const _0x1b5292=_0x423d9f;if(_0x9f08c)return console[_0x1b5292(0x2d4)](_0x9f08c),_0x589703[_0x1b5292(0x30a)][_0x1b5292(0x2ca)](_0x4ff9f3,_0x4ff9f3['__'](_0x1b5292(0x32e)));console[_0x1b5292(0x2d4)](_0x1b5292(0x2c8)),fs[_0x1b5292(0x2ea)](_0x7aba5d,new Date(_0x456f7a[_0x1b5292(0x256)]),new Date(_0x456f7a[_0x1b5292(0x256)]),_0x1d29cd=>{const _0x360dee=_0x1b5292;_0x1d29cd&&console[_0x360dee(0x2d4)](_0x1d29cd),fs[_0x360dee(0x1e5)](_0x7aba5d,(_0x33329e,_0x199bdd)=>{const _0x4590f2=_0x360dee;if(_0x33329e)return _0x589703[_0x4590f2(0x30a)]['returnErrMsg'](_0x4ff9f3,_0x4ff9f3['__'](_0x4590f2(0x32e)));let _0x1d337d=[_0x199bdd['size'],_0x199bdd[_0x4590f2(0x333)]];return dbFileIndexTable['updateBySql'](_0x589703[_0x4590f2(0x30a)]['dbFileIndex'],_0x456f7a['id'],_0x4590f2(0x2a0),dbFileIndexTable[_0x4590f2(0x28e)],_0x1d337d),_0x4ff9f3[_0x4590f2(0x309)]({'code':0x0,'newIndex':dbFileIndexTable[_0x4590f2(0x232)](_0x589703[_0x4590f2(0x30a)][_0x4590f2(0x24d)],_0x456f7a['id'])});});});});}catch(_0x12d3ff){return console[_0x423d9f(0x2d4)](_0x12d3ff),_0x589703[_0x423d9f(0x30a)][_0x423d9f(0x2ca)](_0x4ff9f3,_0x4ff9f3['__'](_0x423d9f(0x318)));}});});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x328),(_0x4371fe,_0x4ca2b6,_0x57fa7d)=>{const _0x2b8ee7=_0x2b76de;if(dbUserTable[_0x2b8ee7(0x1b9)](_0x4371fe,_0x4ca2b6,_0x2b8ee7(0x313),_0x2b8ee7(0x1f4))==!![]){let _0x2ecf2d=dbConfigTable[_0x2b8ee7(0x269)](_0x4371fe[_0x2b8ee7(0x30a)][_0x2b8ee7(0x23c)],_0x2b8ee7(0x1ed));if(!_0x2ecf2d||_0x2ecf2d['value']!='1')return _0x4ca2b6[_0x2b8ee7(0x309)]({'code':0x0,'data':[],'enable':![]});let _0x2b0df=_0x2b8ee7(0x2a2),_0x16d4b8=dbUserTable['getUserPathWhere'](_0x4371fe,'photo',_0x2b8ee7(0x1f4),!![]),_0x2eac5c=[],_0xe4a364=_0x4371fe[_0x2b8ee7(0x30a)][_0x2b8ee7(0x24d)][_0x2b8ee7(0x23f)](_0x2b8ee7(0x1fd)+_0x2b0df)[_0x2b8ee7(0x1d6)](),_0x33cbac=[];for(let _0x25b8b9 in _0xe4a364){let _0x4a3580=_0xe4a364[_0x25b8b9];_0x2eac5c=[_0x4a3580['id'],dbFileIndexTable['COCO_CLASS_MIN_SCORE'],..._0x16d4b8[_0x2b8ee7(0x272)]];let _0x47aa4d=_0x4371fe[_0x2b8ee7(0x30a)]['dbFileIndex']['prepare'](_0x2b8ee7(0x2bb)+_0x16d4b8[_0x2b8ee7(0x303)]+_0x2b8ee7(0x225))['get'](_0x2eac5c);if(_0x47aa4d)_0xe4a364[_0x25b8b9][_0x2b8ee7(0x278)]=_0x47aa4d[_0x2b8ee7(0x278)],_0xe4a364[_0x25b8b9][_0x2b8ee7(0x1e2)]=_0xe4a364[_0x25b8b9]['id'],_0x33cbac[_0x2b8ee7(0x2da)](_0xe4a364[_0x25b8b9]);else continue;}_0x4ca2b6['json']({'code':0x0,'data':_0x33cbac,'enable':!![]});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x31a),(_0x4badeb,_0x5b1b50,_0x455048)=>{const _0x503bd8=_0x2b76de;if(dbUserTable[_0x503bd8(0x1b9)](_0x4badeb,_0x5b1b50,_0x503bd8(0x313),_0x503bd8(0x1f4))==!![]){let _0x25dad9=dbConfigTable[_0x503bd8(0x269)](_0x4badeb['app'][_0x503bd8(0x23c)],_0x503bd8(0x30e));if(!_0x25dad9||_0x25dad9[_0x503bd8(0x322)]!='1')return _0x5b1b50[_0x503bd8(0x309)]({'code':0x0,'data':[],'enable':![]});let _0x3188c2=0x5,_0x3c90a0=dbConfigTable[_0x503bd8(0x269)](_0x4badeb[_0x503bd8(0x30a)]['dbOther'],_0x503bd8(0x2ee));_0x3c90a0&&_0x3c90a0[_0x503bd8(0x322)]&&(_0x3c90a0[_0x503bd8(0x322)]>0x0&&(_0x3188c2=_0x3c90a0[_0x503bd8(0x322)]));let _0x552ad7=_0x4badeb['app']['dbFileIndex'][_0x503bd8(0x23f)](_0x503bd8(0x2fd))['all'](parseInt(_0x3188c2)),_0x58db83=[];if(_0x4badeb['currentUser'][_0x503bd8(0x244)]==0x1)_0x58db83=_0x552ad7;else{let _0xdf07b5=dbUserTable[_0x503bd8(0x2b1)](_0x4badeb,_0x503bd8(0x313),_0x503bd8(0x1f4),!![]);for(let _0x9357e6 of _0x552ad7){try{let _0x547d50=[_0x9357e6['id'],..._0xdf07b5[_0x503bd8(0x272)]],_0x37285c=_0x4badeb[_0x503bd8(0x30a)][_0x503bd8(0x24d)]['prepare'](_0x503bd8(0x2b9)+_0xdf07b5[_0x503bd8(0x303)]+_0x503bd8(0x2c4))[_0x503bd8(0x2b4)](_0x547d50);_0x37285c&&_0x58db83[_0x503bd8(0x2da)](_0x9357e6);}catch(_0x3597d0){console[_0x503bd8(0x2d4)](_0x3597d0),_0x58db83[_0x503bd8(0x2da)](_0x9357e6);}}}_0x5b1b50['json']({'code':0x0,'data':_0x58db83,'enable':!![]});}}),router[_0x2b76de(0x22e)]('/setFacePoster',(_0x4dc14a,_0x2447bb,_0xf30636)=>{const _0x431811=_0x2b76de;let _0x42e3ee=_0x4dc14a[_0x431811(0x1c2)][_0x431811(0x219)],_0x47a947=_0x4dc14a[_0x431811(0x1c2)]['rawFaceId'],_0x2c0854=_0x4dc14a[_0x431811(0x1c2)]['photoIndexId'];if(dbUserTable[_0x431811(0x1b9)](_0x4dc14a,_0x2447bb,_0x431811(0x313),_0x431811(0x20c))==!![]){let _0x55e2a0=dbFileIndexTable[_0x431811(0x284)](_0x4dc14a['app']['dbFileIndex'],_0x42e3ee);_0x4dc14a[_0x431811(0x30a)][_0x431811(0x24d)]['prepare'](_0x431811(0x2a1)+_0x55e2a0)['run'](),_0x4dc14a['app'][_0x431811(0x24d)][_0x431811(0x23f)](_0x431811(0x1bc)+_0x2c0854+_0x431811(0x1f3)+_0x47a947)[_0x431811(0x2bf)](),_0x4dc14a['app'][_0x431811(0x24d)][_0x431811(0x23f)](_0x431811(0x2fb)+_0x42e3ee)[_0x431811(0x2bf)](),_0x2447bb[_0x431811(0x309)]({'code':0x0});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x266),(_0x27df86,_0x246e95,_0x28dbc9)=>{const _0x2e2fa6=_0x2b76de;let _0x31e3f3=_0x27df86[_0x2e2fa6(0x1c2)]['deleteList'];try{_0x31e3f3=JSON['parse'](_0x31e3f3);}catch(_0x51da00){console[_0x2e2fa6(0x2d4)](_0x51da00);}if(dbUserTable[_0x2e2fa6(0x1b9)](_0x27df86,_0x246e95,_0x2e2fa6(0x313),_0x2e2fa6(0x20c))==!![]){for(let _0x57356e of _0x31e3f3){_0x27df86[_0x2e2fa6(0x30a)][_0x2e2fa6(0x24d)][_0x2e2fa6(0x23f)](_0x2e2fa6(0x2f2))['run'](parseInt(_0x57356e[_0x2e2fa6(0x31c)]),parseInt(_0x57356e[_0x2e2fa6(0x1dc)]));}_0x246e95[_0x2e2fa6(0x309)]({'code':0x0});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x27d),(_0x1b9bcc,_0x241d0a,_0x3cba20)=>{const _0x49a3f3=_0x2b76de;if(dbUserTable[_0x49a3f3(0x1b9)](_0x1b9bcc,_0x241d0a,_0x49a3f3(0x313),_0x49a3f3(0x20c))==!![]){let _0x37133d=_0x1b9bcc['body']['faceName'],_0x3d376c=_0x1b9bcc['body']['disabled'],_0x3dbc97=_0x1b9bcc[_0x49a3f3(0x1c2)][_0x49a3f3(0x31c)],_0x461cfa=_0x1b9bcc['body']['faceIdList'];if(_0x37133d){_0x37133d=_0x37133d['trim']();let _0xa37950=_0x1b9bcc['app'][_0x49a3f3(0x24d)][_0x49a3f3(0x23f)](_0x49a3f3(0x204))[_0x49a3f3(0x2b4)](_0x37133d);_0xa37950&&_0xa37950['id']!=_0x3dbc97?_0x1b9bcc['app'][_0x49a3f3(0x24d)]['prepare'](_0x49a3f3(0x305))[_0x49a3f3(0x2bf)](_0xa37950['id'],_0x3dbc97):(_0x1b9bcc[_0x49a3f3(0x30a)][_0x49a3f3(0x24d)][_0x49a3f3(0x23f)](_0x49a3f3(0x259))[_0x49a3f3(0x2bf)](_0x37133d),_0x1b9bcc['app'][_0x49a3f3(0x24d)][_0x49a3f3(0x23f)](_0x49a3f3(0x201))[_0x49a3f3(0x2bf)](_0x37133d,_0x3dbc97));}if(parseInt(_0x3d376c)==0x0||parseInt(_0x3d376c)==0x1){if(_0x461cfa){let _0x43ee8=_0x49a3f3(0x22c);for(let _0x528574 in _0x461cfa){_0x43ee8+=_0x461cfa[_0x528574],_0x528574!=_0x461cfa[_0x49a3f3(0x1c8)]-0x1&&(_0x43ee8+=',');}_0x43ee8+=')';let _0x5ff53d=_0x49a3f3(0x1de)+_0x43ee8;_0x1b9bcc[_0x49a3f3(0x30a)][_0x49a3f3(0x24d)][_0x49a3f3(0x23f)](_0x5ff53d)[_0x49a3f3(0x2bf)](_0x3d376c);}else _0x1b9bcc[_0x49a3f3(0x30a)]['dbFileIndex'][_0x49a3f3(0x23f)](_0x49a3f3(0x1c9))['run'](_0x3d376c,_0x3dbc97);}return _0x241d0a[_0x49a3f3(0x309)]({'code':0x0});}}),router[_0x2b76de(0x22e)]('/mergeFace',(_0x12c83c,_0x1d97ca,_0x3f62a1)=>{const _0x5f0bf9=_0x2b76de;if(dbUserTable[_0x5f0bf9(0x1b9)](_0x12c83c,_0x1d97ca,_0x5f0bf9(0x313),'power_change')==!![]){let _0x4a7763=_0x12c83c[_0x5f0bf9(0x1c2)][_0x5f0bf9(0x267)];if(!_0x4a7763||_0x4a7763[_0x5f0bf9(0x1c8)]<0x2)return _0x12c83c[_0x5f0bf9(0x30a)][_0x5f0bf9(0x2ca)](_0x1d97ca,_0x1d97ca['__'](_0x5f0bf9(0x335)));let _0x2c6500=_0x12c83c[_0x5f0bf9(0x30a)][_0x5f0bf9(0x24d)]['prepare'](_0x5f0bf9(0x30b))[_0x5f0bf9(0x2b4)](_0x4a7763[0x0]);if(!_0x2c6500)return _0x12c83c['app']['returnErrMsg'](_0x1d97ca,_0x1d97ca['__']('operationFail'));for(let _0x15511a=0x1;_0x15511a<_0x4a7763['length'];_0x15511a++){let _0x3c2210=_0x4a7763[_0x15511a];_0x12c83c[_0x5f0bf9(0x30a)][_0x5f0bf9(0x24d)]['prepare'](_0x5f0bf9(0x29a))[_0x5f0bf9(0x2bf)](_0x2c6500['id'],_0x3c2210,_0x3c2210);}return process[_0x5f0bf9(0x22d)]({'type':_0x5f0bf9(0x1d3)}),_0x1d97ca[_0x5f0bf9(0x309)]({'code':0x0});}}),router['get'](_0x2b76de(0x27e),(_0x4fd767,_0x3c1f98,_0x40b238)=>{const _0x5d3b66=_0x2b76de;let _0x3fb094=_0x4fd767[_0x5d3b66(0x1bf)]['faceId'];if(dbUserTable['doUserCanGet'](_0x4fd767,_0x3c1f98,_0x5d3b66(0x313),_0x5d3b66(0x1f4))==!![]){let _0x2b0cad=_0x4fd767['app'][_0x5d3b66(0x24d)][_0x5d3b66(0x23f)](_0x5d3b66(0x2a5))[_0x5d3b66(0x2b4)](_0x3fb094);if(!_0x2b0cad)return _0x3c1f98['status'](0x194)[_0x5d3b66(0x207)]();_0x4fd767[_0x5d3b66(0x233)][_0x5d3b66(0x244)]!=0x1?_0x1ef0aa(![]):!_0x2b0cad[_0x5d3b66(0x270)]?_0x1ef0aa(!![]):fs[_0x5d3b66(0x1e5)](_0x2b0cad[_0x5d3b66(0x270)],(_0x3327dc,_0x290e48)=>{const _0x25cd59=_0x5d3b66;if(!_0x3327dc){let _0x20febf=new Date()['getTime'](),_0x564cec=0x48*0xe10*0x3e8;if(_0x290e48[_0x25cd59(0x333)]){let _0x129a2a=_0x20febf-_0x290e48['ctimeMs'];if(_0x129a2a>_0x564cec)return _0x1ef0aa(!![]);}return _0x3c1f98[_0x25cd59(0x2f9)](_0x2b0cad[_0x25cd59(0x270)]);}_0x1ef0aa(!![]);});function _0x1ef0aa(_0x48b3e5){const _0xe9edf2=_0x5d3b66;let _0x54d3ef=dbFileIndexTable[_0xe9edf2(0x284)](_0x4fd767[_0xe9edf2(0x30a)]['dbFileIndex'],_0x3fb094),_0x3af040=_0xe9edf2(0x2d9)+_0x54d3ef+'\x20',_0x5d5b6f=[];if(_0x4fd767[_0xe9edf2(0x233)][_0xe9edf2(0x244)]!=0x1){let _0x2f5ed2=dbUserTable[_0xe9edf2(0x2b1)](_0x4fd767,'photo','power_get',!![]);_0x3af040+=_0x2f5ed2[_0xe9edf2(0x303)],_0x5d5b6f=_0x5d5b6f[_0xe9edf2(0x1bb)](_0x2f5ed2['paramsList']);}let _0x424d4e=_0x4fd767['app'][_0xe9edf2(0x24d)]['prepare'](_0x3af040+'\x20and\x20a.is_face_poster=1\x20limit\x201')['get'](_0x5d5b6f);if(!_0x424d4e){_0x424d4e=_0x4fd767[_0xe9edf2(0x30a)]['dbFileIndex'][_0xe9edf2(0x23f)](_0x3af040+_0xe9edf2(0x2c2))[_0xe9edf2(0x2b4)](_0x5d5b6f);if(!_0x424d4e)return _0x3c1f98['status'](0x194)['end']();}if(!_0x424d4e)return _0x3c1f98[_0xe9edf2(0x1ef)](0x194)[_0xe9edf2(0x207)]();let _0x597168=path['join'](_0x424d4e['path'],_0x424d4e[_0xe9edf2(0x20d)]);if(parseInt(_0x424d4e[_0xe9edf2(0x20a)])==0x2){let _0x3db139=config[_0xe9edf2(0x2bd)](_0x424d4e),_0x422083=path[_0xe9edf2(0x2b7)](config[_0xe9edf2(0x2e6)],_0x3db139);sharpUtil[_0xe9edf2(0x1fb)](_0x597168,path['dirname'](_0x422083),path[_0xe9edf2(0x1be)](_0x422083),_0xe9edf2(0x1d4),_0x424d4e,_0x1fae0f=>{_0x597168=_0x422083,_0x576a88();},_0x1b739f=>{const _0x1597ea=_0xe9edf2;return _0x3c1f98[_0x1597ea(0x1ef)](0x194)[_0x1597ea(0x207)]();});}else _0x576a88();function _0x576a88(){const _0x2320f3=_0xe9edf2;let _0x36beef=path[_0x2320f3(0x2b7)](config[_0x2320f3(0x21f)],_0x424d4e[_0x2320f3(0x302)]+new Date()[_0x2320f3(0x1d5)]()+'.jpg'),_0x31cc19=0x7d0;sharpUtil[_0x2320f3(0x2d6)](_0x597168,(_0x5ef96b,_0x5b5822,_0x320f4b)=>{const _0x5d6be2=_0x2320f3;let _0x156d82=parseInt(_0x424d4e['f2width']*1.4),_0x56dd19=parseInt(_0x424d4e['f2height']*1.4),_0x1c5a91=parseInt(_0x424d4e[_0x5d6be2(0x337)]-_0x156d82*0.2),_0x5ca0b4=parseInt(_0x424d4e['f2y']-_0x56dd19*0.2);if(_0x5ca0b4<0x0)_0x5ca0b4=0x0;if(_0x1c5a91<0x0)_0x1c5a91=0x0;_0x394f1c(_0x5ef96b,_0x5b5822,_0x320f4b,_0x1c5a91,_0x5ca0b4,_0x156d82,_0x56dd19,()=>{const _0x483840=_0x5d6be2;let _0x52b392=parseInt(_0x424d4e[_0x483840(0x235)]),_0x20b849=parseInt(_0x424d4e[_0x483840(0x280)]),_0x1904d6=parseInt(_0x424d4e[_0x483840(0x337)]),_0x3c0ebb=parseInt(_0x424d4e[_0x483840(0x317)]);if(_0x3c0ebb<0x0)_0x3c0ebb=0x0;if(_0x1904d6<0x0)_0x1904d6=0x0;_0x394f1c(_0x5ef96b,_0x5b5822,_0x320f4b,_0x1904d6,_0x3c0ebb,_0x52b392,_0x20b849);});});function _0x394f1c(_0x282bbd,_0x10821e,_0x369f6f,_0x2b4100,_0x12d705,_0x4dd9af,_0x1029e4,_0x465110){const _0x4214db=_0x2320f3;let _0xc38ae9=sharpUtil[_0x4214db(0x22b)](_0x282bbd),_0x5a3a0b=exifUtils[_0x4214db(0x32c)](_0x369f6f);_0x5a3a0b?_0xc38ae9=_0xc38ae9['rotate'](_0x5a3a0b):_0xc38ae9=_0xc38ae9[_0x4214db(0x218)](),_0xc38ae9[_0x4214db(0x29c)]({'width':_0x31cc19,'height':_0x31cc19,'withoutEnlargement':!![]})['jpeg']()[_0x4214db(0x2f4)]({'left':_0x2b4100,'top':_0x12d705,'width':_0x4dd9af,'height':_0x1029e4})[_0x4214db(0x254)](_0x36beef,function(_0x56cb50){const _0x1beab8=_0x4214db;if(_0x56cb50){_0x10821e&&sharpUtil[_0x1beab8(0x1dd)](_0x282bbd);if(_0x465110)_0x465110();else return _0x3c1f98[_0x1beab8(0x1ef)](0x194)['end']();}else{_0x10821e&&sharpUtil['deleteRawTempFile'](_0x282bbd);if(_0x48b3e5)return _0x4fd767[_0x1beab8(0x30a)][_0x1beab8(0x24d)][_0x1beab8(0x23f)](_0x1beab8(0x2c3)+_0x36beef+'\x27\x20where\x20id='+_0x3fb094)[_0x1beab8(0x2bf)](),_0x3c1f98[_0x1beab8(0x2f9)](_0x36beef);else _0x3c1f98[_0x1beab8(0x2f9)](_0x36beef),_0x3c1f98['on'](_0x1beab8(0x2e1),()=>{fs['rm'](_0x36beef,_0x27fd11=>{});});}});}}}}}),router[_0x2b76de(0x22e)](_0x2b76de(0x2ba),(_0xfd37f5,_0x43da26,_0x96e0d6)=>{const _0x260f8b=_0x2b76de;let _0x2011ff=_0xfd37f5[_0x260f8b(0x1c2)][_0x260f8b(0x1bd)],_0x1d1915=_0xfd37f5[_0x260f8b(0x1c2)][_0x260f8b(0x314)],_0xa5c1ca=[];if(!_0x2011ff||!_0x1d1915)return _0x43da26['json']({'code':0x0,'sucIdList':_0xa5c1ca});try{_0x1d1915=JSON['parse'](_0x1d1915);for(let _0xdaa2ee in _0x1d1915){let _0x53525c=_0x1d1915[_0xdaa2ee],_0x46f5db=_0xfd37f5[_0x260f8b(0x30a)][_0x260f8b(0x24d)][_0x260f8b(0x23f)](_0x260f8b(0x1c6))[_0x260f8b(0x2bf)](parseInt(_0x2011ff),parseInt(_0x53525c[_0x260f8b(0x241)]),parseInt(_0x53525c[_0x260f8b(0x278)]));_0xa5c1ca[_0x260f8b(0x2da)](_0x53525c[_0x260f8b(0x278)]);}return _0x43da26[_0x260f8b(0x309)]({'code':0x0,'sucIdList':_0xa5c1ca});}catch(_0x5b7847){return console[_0x260f8b(0x2d4)](_0x5b7847),_0x43da26[_0x260f8b(0x309)]({'code':0x0,'sucIdList':_0xa5c1ca});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x2e0),(_0x24633b,_0x38b06c,_0x1064a7)=>{const _0x58a096=_0x2b76de;let _0xe1a34b=_0x24633b[_0x58a096(0x1c2)][_0x58a096(0x20a)],_0x4a3e19={};if(_0x24633b[_0x58a096(0x233)][_0x58a096(0x244)]==0x1){if(!_0xe1a34b||_0xe1a34b==_0x58a096(0x27c)){let _0x1e3c7a=_0x24633b[_0x58a096(0x30a)][_0x58a096(0x24d)][_0x58a096(0x23f)](_0x58a096(0x316))[_0x58a096(0x2b4)]();_0x4a3e19[_0x58a096(0x20b)]=_0x1e3c7a[_0x58a096(0x214)];if(_0x1e3c7a[_0x58a096(0x214)]<0x1){let _0x37207f=_0x24633b[_0x58a096(0x30a)][_0x58a096(0x24d)]['prepare'](_0x58a096(0x25d))['get']();_0x4a3e19[_0x58a096(0x24c)]=_0x37207f[_0x58a096(0x214)];}}if(!_0xe1a34b||_0xe1a34b==_0x58a096(0x288)){let _0x22f998=_0x24633b[_0x58a096(0x30a)]['dbFileIndex'][_0x58a096(0x23f)](_0x58a096(0x31d))[_0x58a096(0x2b4)]();_0x4a3e19[_0x58a096(0x300)]=_0x22f998[_0x58a096(0x214)];}if(!_0xe1a34b||_0xe1a34b==_0x58a096(0x2db)){let _0xa1eac9=_0x24633b['app']['dbFileIndex'][_0x58a096(0x23f)](_0x58a096(0x306))['get']();_0x4a3e19[_0x58a096(0x2c1)]=_0xa1eac9['count'];}}let _0x40a282=dbConfigTable[_0x58a096(0x269)](_0x24633b[_0x58a096(0x30a)][_0x58a096(0x23c)],_0x58a096(0x334)),_0x3b5750=0x0;return!_0x40a282?_0x3b5750=0x0:_0x3b5750=_0x40a282['value'],_0x4a3e19[_0x58a096(0x28c)]=_0x3b5750,_0x38b06c[_0x58a096(0x309)]({'code':0x0,'data':_0x4a3e19});}),router[_0x2b76de(0x22e)](_0x2b76de(0x2ec),(_0x22ee1e,_0x1d2f10,_0x4741b2)=>{const _0x22fae0=_0x2b76de;if(dbUserTable['doUserCanGet'](_0x22ee1e,_0x1d2f10,'photo','power_change')==!![])try{fs['rm'](config['facesPath'],{'recursive':!![]},_0x519461=>{const _0x2ab482=_0x26ac;if(_0x519461)return console[_0x2ab482(0x2d4)](_0x519461),_0x22ee1e['app'][_0x2ab482(0x2ca)](_0x1d2f10,_0x1d2f10['__'](_0x2ab482(0x336))+':'+config[_0x2ab482(0x21f)],_0x2ab482(0x1ff));fs[_0x2ab482(0x274)](config[_0x2ab482(0x21f)],_0x3b9dbe=>{const _0x2f9e3a=_0x2ab482;if(_0x3b9dbe)return _0x22ee1e['app'][_0x2f9e3a(0x2ca)](_0x1d2f10,_0x1d2f10['__']('operationFail'),_0x2f9e3a(0x1ff));let _0x5d359f=_0x22ee1e[_0x2f9e3a(0x30a)][_0x2f9e3a(0x24d)][_0x2f9e3a(0x307)](()=>{const _0x4c63c2=_0x2f9e3a;return _0x22ee1e[_0x4c63c2(0x30a)][_0x4c63c2(0x24d)][_0x4c63c2(0x23f)]('delete\x20from\x20photo_faces\x20where\x201=1')[_0x4c63c2(0x2bf)](),_0x22ee1e[_0x4c63c2(0x30a)][_0x4c63c2(0x24d)][_0x4c63c2(0x23f)](_0x4c63c2(0x209))[_0x4c63c2(0x2bf)](),_0x22ee1e[_0x4c63c2(0x30a)][_0x4c63c2(0x24d)][_0x4c63c2(0x23f)](_0x4c63c2(0x2a7))['run'](),process[_0x4c63c2(0x22d)]({'type':'startFaceAiWork'}),_0x1d2f10[_0x4c63c2(0x309)]({'code':0x0});});_0x5d359f();});});}catch(_0x16d435){return _0x22ee1e[_0x22fae0(0x30a)][_0x22fae0(0x2ca)](_0x1d2f10,_0x1d2f10['__'](_0x22fae0(0x32e)),'dialog');}}),router['post']('/resetSimilarPhotoAi',(_0x413298,_0x2e2182,_0x3f6c80)=>{const _0x391d5a=_0x2b76de;if(dbUserTable[_0x391d5a(0x1b9)](_0x413298,_0x2e2182,_0x391d5a(0x313),_0x391d5a(0x20c))==!![])try{let _0x305500=_0x413298[_0x391d5a(0x30a)][_0x391d5a(0x24d)]['transaction'](()=>{const _0x411d03=_0x391d5a;return _0x413298[_0x411d03(0x30a)]['dbFileIndex'][_0x411d03(0x23f)]('delete\x20from\x20photo_phash_similar\x20where\x201=1')[_0x411d03(0x2bf)](),_0x413298['app'][_0x411d03(0x24d)]['prepare'](_0x411d03(0x29e))[_0x411d03(0x2bf)](),process[_0x411d03(0x22d)]({'type':_0x411d03(0x23b)}),_0x2e2182[_0x411d03(0x309)]({'code':0x0});});_0x305500();}catch(_0x2258e9){return _0x413298['app'][_0x391d5a(0x2ca)](_0x2e2182,_0x2e2182['__']('operationFail'),_0x391d5a(0x1ff));}}),router[_0x2b76de(0x22e)](_0x2b76de(0x2e2),(_0x1cb19b,_0x11f065,_0x227c70)=>{const _0x45d16d=_0x2b76de;if(dbUserTable[_0x45d16d(0x2e5)](_0x1cb19b,_0x11f065)!==!![])return;let _0x564591=dbConfigTable['findByTitle'](_0x1cb19b[_0x45d16d(0x30a)][_0x45d16d(0x23c)],'aiSimilarPhotoEnable');if(!_0x564591||_0x564591[_0x45d16d(0x322)]!='1')return _0x11f065[_0x45d16d(0x309)]({'code':0x0,'data':[],'enable':![]});let _0x47aa4b=_0x1cb19b[_0x45d16d(0x1c2)][_0x45d16d(0x248)];if(!_0x47aa4b)_0x47aa4b=0x0;let _0x3f991d=_0x1cb19b[_0x45d16d(0x1c2)]['count'];if(!_0x3f991d||_0x3f991d>0x64)_0x3f991d=0x64;let _0x4aa50e=[],_0x3f28fb=_0x1cb19b[_0x45d16d(0x30a)][_0x45d16d(0x24d)][_0x45d16d(0x23f)]('SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id')['all'](),_0xfe5d7b=_0x1cb19b[_0x45d16d(0x30a)]['dbFileIndex']['prepare'](_0x45d16d(0x2d2)+_0x3f991d)[_0x45d16d(0x1d6)]();for(let _0x39eadc in _0xfe5d7b){let _0x1f697d=_0xfe5d7b[_0x39eadc],_0xd6b4b6=_0x1cb19b[_0x45d16d(0x30a)]['dbFileIndex'][_0x45d16d(0x23f)](_0x45d16d(0x26c)+_0x1f697d[_0x45d16d(0x205)])[_0x45d16d(0x2b4)](),_0x5aa5b0=_0x1cb19b[_0x45d16d(0x30a)]['dbFileIndex'][_0x45d16d(0x23f)](_0x45d16d(0x26a)+_0x1f697d[_0x45d16d(0x205)])['all']();_0xfe5d7b[_0x39eadc][_0x45d16d(0x26f)]=_0xd6b4b6,_0xfe5d7b[_0x39eadc][_0x45d16d(0x2dd)]=[_0xd6b4b6],_0xfe5d7b[_0x39eadc][_0x45d16d(0x2dd)][_0x45d16d(0x2da)](..._0x5aa5b0),_0xfe5d7b[_0x39eadc]['similarIndexList'][_0x45d16d(0x1c8)]>0x1?_0x4aa50e[_0x45d16d(0x2da)](_0xfe5d7b[_0x39eadc]):_0x1cb19b[_0x45d16d(0x30a)][_0x45d16d(0x24d)][_0x45d16d(0x23f)]('DELETE\x20FROM\x20photo_phash_similar\x20where\x20index_id=?')['run'](_0x1f697d[_0x45d16d(0x205)]);}return _0x11f065[_0x45d16d(0x309)]({'code':0x0,'data':_0x4aa50e,'enable':!![],'waitDealCount':_0x3f28fb['length']});}),router[_0x2b76de(0x22e)]('/dealSimilarPhoto',(_0x1613b8,_0x3663ef,_0x31c436)=>{const _0x151368=_0x2b76de;if(dbUserTable[_0x151368(0x2e5)](_0x1613b8,_0x3663ef)!==!![])return;let _0x12a7bc=_0x1613b8[_0x151368(0x1c2)][_0x151368(0x2ff)];for(let _0x5ce755 in _0x12a7bc){let _0x1802f3=_0x1613b8['app'][_0x151368(0x24d)]['prepare']('SELECT\x20*\x20from\x20photo_phash_similar\x20where\x20index_id='+_0x12a7bc[_0x5ce755]['index_id'])[_0x151368(0x1d6)]();for(let _0x3fddbc in _0x1802f3){if(!_0x12a7bc[_0x5ce755][_0x151368(0x255)][_0x151368(0x220)](parseInt(_0x1802f3[_0x3fddbc]['similar_index_id']))){let _0x48532e=new Date()[_0x151368(0x1d5)]();_0x1613b8[_0x151368(0x30a)][_0x151368(0x24d)][_0x151368(0x23f)](_0x151368(0x324)+dbFileIndexTable[_0x151368(0x28e)]+_0x151368(0x247)+_0x48532e+_0x151368(0x1cb)+_0x1802f3[_0x3fddbc][_0x151368(0x211)])['run']();}}if(!_0x12a7bc[_0x5ce755]['keepIndexList'][_0x151368(0x220)](parseInt(_0x12a7bc[_0x5ce755]['index_id']))){let _0x519f09=new Date()[_0x151368(0x1d5)]();_0x1613b8[_0x151368(0x30a)][_0x151368(0x24d)]['prepare'](_0x151368(0x324)+dbFileIndexTable[_0x151368(0x28e)]+_0x151368(0x247)+_0x519f09+_0x151368(0x1cb)+_0x12a7bc[_0x5ce755]['index_id'])[_0x151368(0x2bf)]();}_0x1613b8['app'][_0x151368(0x24d)]['prepare']('delete\x20from\x20photo_phash_similar\x20where\x20index_id='+_0x12a7bc[_0x5ce755][_0x151368(0x205)])[_0x151368(0x2bf)]();}return _0x3663ef[_0x151368(0x309)]({'code':0x0});}),router['post']('/restoreTrashBinFiles',(_0x3ddb14,_0x418bb7,_0x906dcb)=>{const _0x311f3e=_0x2b76de;if(dbUserTable['doUserCanGet'](_0x3ddb14,_0x418bb7,_0x311f3e(0x313),_0x311f3e(0x20c),'')==!![]){let _0x15f905=_0x3ddb14[_0x311f3e(0x30a)]['dbFileIndex'][_0x311f3e(0x23f)](_0x311f3e(0x2e7))['all']();for(let _0x2ca24f of _0x15f905){_0x3ddb14['app'][_0x311f3e(0x24d)]['prepare'](_0x311f3e(0x1d0))[_0x311f3e(0x2bf)](_0x2ca24f[_0x311f3e(0x1d8)],_0x2ca24f[_0x311f3e(0x1c5)]);}return _0x3ddb14[_0x311f3e(0x30a)][_0x311f3e(0x24d)][_0x311f3e(0x23f)](_0x311f3e(0x324)+dbFileIndexTable[_0x311f3e(0x28e)]+'\x20SET\x20in_trash=0\x20WHERE\x20in_trash=1')[_0x311f3e(0x2bf)](),_0x418bb7[_0x311f3e(0x309)]({'code':0x0});}}),router[_0x2b76de(0x22e)](_0x2b76de(0x2eb),(_0x3ada93,_0x378fab,_0x52c370)=>{const _0x5f3ddd=_0x2b76de;let _0x54b833=_0x3ada93[_0x5f3ddd(0x1c2)]['putInSystemTrash'],_0x244630=dbFileIndexTable[_0x5f3ddd(0x203)](_0x3ada93['app'][_0x5f3ddd(0x24d)],_0x5f3ddd(0x2f7),_0x5f3ddd(0x1ca),dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']),_0x3c8d2c=dbFileIndexTable[_0x5f3ddd(0x28e)];console[_0x5f3ddd(0x2d4)](_0x5f3ddd(0x2c5)+_0x244630[_0x5f3ddd(0x1c8)]);function _0xdf8982(_0x208d4a,_0x425a9e){const _0x265b43=_0x5f3ddd;dbFileOperationRecord[_0x265b43(0x312)](_0x3ada93['app']['dbOther'],{'username':_0x3ada93[_0x265b43(0x233)]['username'],'targetPath':_0x208d4a,'level':dbFileOperationRecord[_0x265b43(0x21a)],'type':dbFileOperationRecord[_0x265b43(0x26e)],'state':_0x425a9e?dbFileOperationRecord['STATE_SUC']:dbFileOperationRecord[_0x265b43(0x29b)]});}function _0x157506(_0x35a52e){const _0x4b8d01=_0x5f3ddd;if(_0x35a52e[_0x4b8d01(0x296)]==0x1&&_0x35a52e['is_livephoto']==0x1){let _0x19419c=path[_0x4b8d01(0x2b7)](_0x35a52e[_0x4b8d01(0x1d8)],_0x35a52e[_0x4b8d01(0x20d)][_0x4b8d01(0x32b)](_0x4b8d01(0x1c7),'')+_0x4b8d01(0x23d));_0x35a52e['filename'][_0x4b8d01(0x1c3)]('.MP4')&&(_0x19419c=path['join'](_0x35a52e[_0x4b8d01(0x1d8)],_0x35a52e[_0x4b8d01(0x20d)][_0x4b8d01(0x32b)]('.MP4','')+_0x4b8d01(0x297))),fs[_0x4b8d01(0x1f6)](_0x19419c)&&(console[_0x4b8d01(0x2d4)](_0x4b8d01(0x257),_0x19419c),_0x2b6723(_0x35a52e,_0x19419c,![]));}}function _0x2b6723(_0x525835,_0x4b0a9f,_0x7698ef){const _0x3772bd=_0x5f3ddd;_0x54b833==0x1?(process[_0x3772bd(0x22d)]({'type':_0x3772bd(0x26b),'shellType':_0x3772bd(0x26d),'path':_0x4b0a9f}),_0xdf8982(_0x4b0a9f,!![])):fs['rm'](_0x4b0a9f,{'recursive':!![]},_0x5a5fa5=>{_0x5a5fa5?_0xdf8982(_0x4b0a9f,![]):_0xdf8982(_0x4b0a9f,!![]);}),_0x7698ef&&_0x157506(_0x525835);}function _0x492a75(_0x43242e){const _0x349adb=_0x5f3ddd;dbFileIndexTable[_0x349adb(0x29d)](_0x3ada93['app']['dbFileIndex'],_0x43242e['id'],_0x3c8d2c);}for(let _0x1e9f14 in _0x244630){let _0x2f71aa=_0x244630[_0x1e9f14];if(_0x2f71aa){if(dbUserTable[_0x5f3ddd(0x1b9)](_0x3ada93,_0x378fab,_0x5f3ddd(0x313),'power_delete',_0x2f71aa[_0x5f3ddd(0x1d8)])==!![]){let _0x318d96=path[_0x5f3ddd(0x2b7)](_0x2f71aa[_0x5f3ddd(0x1d8)],path[_0x5f3ddd(0x2cc)],_0x2f71aa['filename']);_0x492a75(_0x2f71aa),_0x2b6723(_0x2f71aa,_0x318d96,!![]);}}}return _0x378fab[_0x5f3ddd(0x309)]({'code':0x0});}),router['post'](_0x2b76de(0x230),(_0x384cce,_0x2435e8,_0x9d7675)=>{const _0xbcbbb3=_0x2b76de;let _0x25b22d=_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x2a4)],_0x466729=_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x1e0)],_0x12c126=_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x2e4)],_0x55e3b7=_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x30f)],_0xfaadf9=_0x384cce['body']['shareForSubUser'],_0x34a988=_0x384cce['body']['operation'];if(_0x34a988==_0xbcbbb3(0x2d7)){let _0x210d8f=_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x1f1)]||0x0,_0x5ba33b=_0x384cce['body']['count']||0x32,_0x9216bb=_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x21d)]||'',_0x45c140=_0x384cce[_0xbcbbb3(0x1c2)]['orderField']||_0xbcbbb3(0x319),_0x364d4c=_0x384cce['body'][_0xbcbbb3(0x32d)]||_0xbcbbb3(0x330);if(!['create_time','title'][_0xbcbbb3(0x220)](_0x45c140))return console['log'](_0xbcbbb3(0x1fe),_0x45c140),[];let _0x3016de=[],_0xc350e9=[],_0x5c7b72=_0xbcbbb3(0x23a);_0x384cce['currentUser']['is_admin']==0x1?_0x9216bb&&(_0x5c7b72+=_0xbcbbb3(0x294),_0xc350e9[_0xbcbbb3(0x2da)]('%'+_0x9216bb+'%')):(_0x5c7b72=_0xbcbbb3(0x27a),_0x9216bb&&(_0x5c7b72+=_0xbcbbb3(0x1da),_0xc350e9['push']('%'+_0x9216bb+'%')));_0x5c7b72+=_0xbcbbb3(0x1ea)+_0x45c140+'\x20'+_0x364d4c+_0xbcbbb3(0x202),_0xc350e9[_0xbcbbb3(0x2da)](_0x5ba33b),_0xc350e9[_0xbcbbb3(0x2da)](_0x210d8f),_0x3016de=_0x384cce[_0xbcbbb3(0x30a)][_0xbcbbb3(0x24d)][_0xbcbbb3(0x23f)](_0x5c7b72)[_0xbcbbb3(0x1d6)](_0xc350e9);if(_0x3016de[_0xbcbbb3(0x1c8)]<0x1)return _0x2435e8['json']({'code':0x0,'data':[]});for(let _0x19c86f in _0x3016de){let _0x3db4cd=_0x3016de[_0x19c86f];try{let _0x5a3d3f=JSON[_0xbcbbb3(0x2a8)](_0x3db4cd['share_uid']),_0x43168f=[];for(let _0x25dc38 of _0x5a3d3f){let _0x55e3ac=dbUserTable[_0xbcbbb3(0x246)](_0x384cce[_0xbcbbb3(0x30a)][_0xbcbbb3(0x23c)],_0x25dc38,_0xbcbbb3(0x25c));_0x43168f['push'](_0x55e3ac);}_0x3016de[_0x19c86f][_0xbcbbb3(0x30d)]=_0x43168f;}catch(_0x1aaa00){console[_0xbcbbb3(0x2d4)](_0x1aaa00);}_0x384cce['body'][_0xbcbbb3(0x214)]=0x4,_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x2e8)]=[],_0x384cce[_0xbcbbb3(0x1c2)]['fileType']=0x0,_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x1d9)]=_0xbcbbb3(0x1e8),_0x384cce['body'][_0xbcbbb3(0x215)]=_0xbcbbb3(0x330),_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x285)]=0x1,_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x253)]=0x9184e729fff,_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x26d)]=0x0,_0x384cce[_0xbcbbb3(0x1c2)][_0xbcbbb3(0x1e0)]=_0x3016de[_0x19c86f]['id'],_0x3016de[_0x19c86f]['dataPreview']=photoApiUtil[_0xbcbbb3(0x1cd)](_0x384cce,_0x2435e8);}return _0x2435e8[_0xbcbbb3(0x309)]({'code':0x0,'data':_0x3016de});}else{if(_0x384cce[_0xbcbbb3(0x233)]['is_admin']!=0x1)return _0x384cce[_0xbcbbb3(0x30a)][_0xbcbbb3(0x2ca)](_0x2435e8,_0x2435e8['__'](_0xbcbbb3(0x1f9)));if(_0x34a988==_0xbcbbb3(0x243)||_0x34a988==_0xbcbbb3(0x216)){if(!_0x12c126||!_0x12c126 instanceof Array||_0x12c126[_0xbcbbb3(0x1c8)]<0x1)return _0x384cce[_0xbcbbb3(0x30a)]['returnErrMsg'](_0x2435e8,_0x2435e8['__'](_0xbcbbb3(0x32e)));if(_0xfaadf9){if(_0x55e3b7!=null&&!_0x55e3b7 instanceof Array)return _0x384cce[_0xbcbbb3(0x30a)][_0xbcbbb3(0x2ca)](_0x2435e8,_0x2435e8['__'](_0xbcbbb3(0x32e)));}if(sqliteUtil[_0xbcbbb3(0x2ae)](JSON['stringify'](_0x12c126))==!![])return _0x384cce['app'][_0xbcbbb3(0x2ca)](_0x2435e8,'error\x20pathList');}if(_0x34a988==_0xbcbbb3(0x216)&&_0x466729)_0x384cce['app'][_0xbcbbb3(0x24d)][_0xbcbbb3(0x23f)](_0xbcbbb3(0x264))[_0xbcbbb3(0x2bf)](_0x25b22d,JSON[_0xbcbbb3(0x271)](_0x12c126),_0xfaadf9,JSON['stringify'](_0x55e3b7),_0x466729);else{if(_0x34a988==_0xbcbbb3(0x2b8)&&_0x466729)_0x384cce[_0xbcbbb3(0x30a)][_0xbcbbb3(0x24d)][_0xbcbbb3(0x23f)](_0xbcbbb3(0x1eb))[_0xbcbbb3(0x2bf)](_0x466729);else{if(_0x34a988=='ADD')_0x384cce['app'][_0xbcbbb3(0x24d)][_0xbcbbb3(0x23f)]('REPLACE\x20INTO\x20photo_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)')[_0xbcbbb3(0x2bf)](_0x25b22d,JSON['stringify'](_0x12c126),_0xfaadf9,JSON[_0xbcbbb3(0x271)](_0x55e3b7),_0x384cce['currentUser']['id']);else return _0x384cce[_0xbcbbb3(0x30a)]['returnErrMsg'](_0x2435e8,_0x2435e8['__'](_0xbcbbb3(0x1f9)));}}return _0x2435e8[_0xbcbbb3(0x309)]({'code':0x0});}}),module[_0x2b76de(0x210)]=router;