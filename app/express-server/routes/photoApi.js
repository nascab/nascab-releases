const _0x5169d3=_0x5e89;(function(_0x602f45,_0x159015){const _0x1bdec4=_0x5e89,_0x22a409=_0x602f45();while(!![]){try{const _0x3445eb=parseInt(_0x1bdec4(0x305))/0x1*(parseInt(_0x1bdec4(0x2bc))/0x2)+-parseInt(_0x1bdec4(0x26d))/0x3*(-parseInt(_0x1bdec4(0x320))/0x4)+-parseInt(_0x1bdec4(0x22b))/0x5+-parseInt(_0x1bdec4(0x224))/0x6+-parseInt(_0x1bdec4(0x2b0))/0x7*(-parseInt(_0x1bdec4(0x310))/0x8)+parseInt(_0x1bdec4(0x2c5))/0x9+-parseInt(_0x1bdec4(0x223))/0xa*(parseInt(_0x1bdec4(0x289))/0xb);if(_0x3445eb===_0x159015)break;else _0x22a409['push'](_0x22a409['shift']());}catch(_0x30d049){_0x22a409['push'](_0x22a409['shift']());}}}(_0x473b,0x87769));let express=require(_0x5169d3(0x297)),router=express['Router'](),path=require(_0x5169d3(0x2ef));const config=require(_0x5169d3(0x2ff)),dbFileIndexTable=require(_0x5169d3(0x295)),dbSourceFolderTable=require('../../db/dbSourceFolderTable'),dbFileOperationRecord=require(_0x5169d3(0x2e0)),sqliteUtil=require(_0x5169d3(0x205)),exifUtils=require(_0x5169d3(0x21f)),dbUserTable=require(_0x5169d3(0x329)),dbAlbumTable=require(_0x5169d3(0x269));let geohash=require(_0x5169d3(0x246)),fs=require('fs');const dbConfigTable=require(_0x5169d3(0x21a));function _0x5e89(_0x41521c,_0x4480bc){const _0x473ba1=_0x473b();return _0x5e89=function(_0x5e8969,_0x372310){_0x5e8969=_0x5e8969-0x1ee;let _0x2552e6=_0x473ba1[_0x5e8969];return _0x2552e6;},_0x5e89(_0x41521c,_0x4480bc);}let sharpUtil=require(_0x5169d3(0x34e));const photoApiUtil=require(_0x5169d3(0x1fc)),platform=require('os')[_0x5169d3(0x20f)]();let piexif=require(_0x5169d3(0x204));router[_0x5169d3(0x1fb)]('/getTimeLineDateList',(_0x44ac61,_0x526258,_0x2ddc78)=>{const _0x39c2d8=_0x5169d3;if(dbUserTable[_0x39c2d8(0x298)](_0x44ac61,_0x526258,_0x39c2d8(0x226),_0x39c2d8(0x2d8))==!![]){let _0x544157=_0x44ac61[_0x39c2d8(0x255)][_0x39c2d8(0x215)],_0x218a13=_0x44ac61[_0x39c2d8(0x255)][_0x39c2d8(0x2cc)],_0x142c2b=_0x44ac61[_0x39c2d8(0x255)][_0x39c2d8(0x351)],_0x5c8a77=_0x44ac61['body'][_0x39c2d8(0x345)],_0x4115f6=_0x44ac61[_0x39c2d8(0x255)][_0x39c2d8(0x1f8)],_0x337357=_0x44ac61[_0x39c2d8(0x255)][_0x39c2d8(0x241)],_0x35dd35=_0x44ac61[_0x39c2d8(0x255)]['aiClassId'],_0x3ccbea=_0x44ac61[_0x39c2d8(0x255)][_0x39c2d8(0x262)],_0x2b3f73=_0x44ac61[_0x39c2d8(0x255)]['faceId'],_0x1bd50d=_0x44ac61[_0x39c2d8(0x255)][_0x39c2d8(0x350)],_0x355a50=_0x44ac61['body'][_0x39c2d8(0x32e)],_0x5ec928=dbUserTable[_0x39c2d8(0x210)](_0x44ac61,_0x39c2d8(0x226),_0x39c2d8(0x2d8),!![],_0x355a50),_0xcde593=_0x5ec928[_0x39c2d8(0x299)],_0x57aead=[..._0x5ec928[_0x39c2d8(0x240)]];_0x142c2b&&(_0xcde593+=_0x39c2d8(0x2d1),_0x57aead[_0x39c2d8(0x23b)](_0x142c2b+'%'));let _0x5a1b11=dbSourceFolderTable['getExcludePathWhereStr'](_0x44ac61['app'][_0x39c2d8(0x290)],'path','excludePathPhoto');_0x5a1b11&&(_0xcde593+=_0x39c2d8(0x30e)+_0x5a1b11);let _0x4c6d25=dbSourceFolderTable[_0x39c2d8(0x307)](_0x44ac61[_0x39c2d8(0x2a8)]['dbOther'],_0x39c2d8(0x248),_0x39c2d8(0x2df));_0x4c6d25&&(_0xcde593+=_0x39c2d8(0x30e)+_0x4c6d25);if(_0x3ccbea){let _0x4d5801=_0x44ac61[_0x39c2d8(0x2a8)][_0x39c2d8(0x251)][_0x39c2d8(0x2fb)](_0x39c2d8(0x21b))[_0x39c2d8(0x344)](_0x3ccbea);if(_0x4d5801)try{let _0x437beb=JSON[_0x39c2d8(0x23c)](_0x4d5801[_0x39c2d8(0x235)]),_0x5b406d=dbUserTable['getPathWhere'](!![],_0x437beb);_0xcde593+=_0x5b406d[_0x39c2d8(0x299)],_0x57aead=_0x57aead[_0x39c2d8(0x314)](_0x5b406d['paramsList']);}catch(_0x556b4b){console[_0x39c2d8(0x24e)](_0x556b4b);}}if(_0x5c8a77){let _0x51b601=dbAlbumTable[_0x39c2d8(0x23d)](_0x44ac61[_0x39c2d8(0x2a8)][_0x39c2d8(0x290)],_0x5c8a77);_0x51b601&&(_0xcde593+=_0x39c2d8(0x30e)+_0x51b601);}_0x4115f6&&(_0xcde593+='\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)',_0x57aead[_0x39c2d8(0x23b)]('%'+_0x4115f6+'%'),_0x57aead[_0x39c2d8(0x23b)]('%'+_0x4115f6+'%'));_0xcde593+=_0x39c2d8(0x340);let _0x4cd34e=dbFileIndexTable[_0x39c2d8(0x31e)](_0x44ac61[_0x39c2d8(0x2a8)][_0x39c2d8(0x251)],_0x544157,_0x218a13,_0xcde593,_0x337357,_0x35dd35,_0x2b3f73,_0x57aead,_0x1bd50d);_0x526258['json']({'code':0x0,'data':_0x4cd34e});}});let geoDbCache={};function _0x473b(){const _0x4b7200=['similarWaitDealCount','keepIndexList','UPDATE\x20photo_faces\x20SET\x20face_name=?\x20where\x20id\x20=\x20?','ngeohash','imagePreviewSize','filename','\x20AND\x20\x20is_file=1\x20','parent','aiFaceMinPhotoCount','moviePreferLanguage','\x20LIMIT\x201','log','searchMode','SELECT\x20*\x20FROM\x20photo_library\x20','dbFileIndex','timeType','Exif','f2x','body','search','\x20and\x20face_id=','GPSLongitudeRef','returnErrMsg','TYPE_DELETE','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20id\x20=\x20?','/getSimilarPhoto','maxLat','/getFileTreePhoto','SELECT\x20f.id\x20FROM\x20photo_faces2index\x20as\x20p\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20p.photo_index_id=f.id\x20WHERE\x20p.face_id=?\x20','key','updateBySql','libraryId','is_admin','\x20is_file=0\x20','CUSTOM','editId','end','\x20order\x20by\x20f.original_time\x20desc\x20limit\x201','../../db/dbAlbumTable','/restoreTrashBinFiles','getUserPower','sep','3KbOySo','mode','value','SELECT\x20*\x20FROM\x20photo_faces\x20where\x20id\x20=?','id,is_file,is_livephoto,path,filename,raw_filename,is_raw','insert','id,username','index_id','minLng','DELETE\x20FROM\x20photo_phash_similar\x20where\x20index_id=?','\x20latitude=?,longitude=?,geohash=?,geohash5=?,geohash4=?,geohash3=?,geohash2=?\x20','GET','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20phash\x20is\x20null\x20and\x20type=1','/mergeFace','face_id','sortField','join','from','close','getAllByWhereAndFieldFromOrdinaryAlbumCount','music','getSharpInstanceFromInput','\x20LIMIT\x20','power_change','f2width','photoPreviewSize','geohash4\x20=\x20?','\x20and\x20title\x20like\x20?','1083126UNCvsv','update\x20file_index_photo\x20set\x20phash=null,phash_compare=0','geoHashList','putInSystemTrash','username','stat','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27\x27\x20where\x20id=','dbOther','rotate','/getBoundsPhoto','encode','\x20order\x20by\x20score\x20desc','../../db/dbFileIndexTable','similar_index_id','express','doUserCanGet','whereStr','\x27\x20where\x20id=','GPSLatitude','error\x20pathList','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time,latitude,longitude\x20','GPSLongitude','facesPath','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20face_name=?\x20and\x20belong_face_id\x20is\x20null','basename','album.sameNameExist','readFile','mkdir','send','SELECT\x20f.id,f.path,f.filename,f.original_date,f.size\x20FROM\x20photo_phash_similar\x20as\x20a\x20inner\x20join\x20file_index_photo\x20as\x20f\x20on\x20a.similar_index_id=f.id\x20where\x20a.index_id=','resolve','app','udpateName','sendFile','\x20size=?,ctime=?\x20','.jpeg','original_time','getPhotoByParams','INDEX_TABLE_NAME_MUSIC','4041093RJilnj','\x20AND\x20geohash5!=\x27undefined\x27\x20GROUP\x20BY\x20geohash5','is_file','/removeFromFace','data_value','noPermission','Image\x20format\x20not\x20support','shareUidList','isAdmin','/getIndexDetail','indexObj','substring','430fRhuzv','GPSIFD','offset','includes','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20disabled=0\x20and\x20belong_face_id\x20is\x20null\x20and\x20face_photo_count>=?\x20order\x20by\x20face_photo_count\x20desc\x20limit\x20500','exports','REPLACE\x20INTO\x20photo_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','cachePath','aiSimilarPhotoEnable','4244382gHoYFn','DELETE','photoIndexId','faceapi','jpeg','SELECT\x20*\x20FROM\x20ai_classes\x20where\x20\x20class_name\x20not\x20in\x20','fileType','type','orderType','create_time','splice','changes','\x20AND\x20geohash\x20LIKE\x20?\x20','GPSDateStamp','movie','bboxes','getTime','\x20AND\x20filename\x20LIKE\x20?\x20','getAllByWhereAndFieldFromOrdinaryAlbum','power_get','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?','/getPhotoByTime','\x20and\x20a.is_face_poster=1\x20limit\x201','存在livephoto','\x20is_file=1\x20','resize','excludeFilenamePhoto','../../db/dbFileOperationRecord','getList','(\x27mouse\x27,\x27person\x27,\x27traffic\x20light\x27,\x27stop\x20sign\x27,\x27parking\x20meter\x27,\x27fire\x20hydrant\x27)','findByTitle','\x20SET\x20in_trash=0\x20WHERE\x20in_trash=1','status','rawFile','DELETE\x20FROM\x20photo_faces2index\x20where\x20face_id=?\x20and\x20photo_index_id\x20=?','run','photoPreviewType','\x20AND\x20geohash2!=\x27undefined\x27\x20GROUP\x20BY\x20geohash2','share_uid','SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id','getRotateFromTags','writeFile','path','extract','abs','power_add','STATE_SUC','serveType','UPDATE\x20photo_faces2index\x20SET\x20face_id=?\x20WHERE\x20face_id=?\x20and\x20photo_index_id=?','ctimeMs','json','/updateAlbum','INDEX_TABLE_NAME_PHOTO','dirname','prepare','chi','dialog','\x20in_trash=0\x20AND\x20latitude!=\x27undefined\x27\x20AND\x20longitude!=\x27undefined\x27\x20AND\x20latitude\x20is\x20not\x20null','../../myConfig/config','name','aiClassesEnable','/getPhotoFaces','operation\x20fail','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27','1945pPMztZ','mtime','getExcludePathWhereStr','imgList','/setFacePoster','original_date','count','geohash5\x20=\x20?','faceId','\x20AND\x20','isFile','8MHONCD','.MP4','query','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20id=?','concat','atleastChooseTwoFaces','defaultMoviePlay','operationFail','stringify','\x20ORDER\x20BY\x20','dealList','geohash3\x20=\x20?','getFullYear','getMonth','getTimeLineDateList','getById','2765564tficgv','getCountByWhere','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)\x20','STATE_FAIL','moviePlaylongPressRate','power_delete','UPDATE\x20photo_faces\x20SET\x20face_name=null\x20where\x20face_name\x20=\x20?','utimes','length','../../db/dbUserTable','folderNotExist','COCO_CLASS_MIN_SCORE','similarIndexList','disabled','sourceFolderList','filename_number','getAllByWhere','toString','\x20AND\x20in_trash=0\x20\x20AND\x20is_file=1\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20limit\x201','UPDATE\x20','defaultTranscodeResolution','floor','SELECT\x20*\x20from\x20photo_phash_similar\x20where\x20index_id=','desc','getDate','indexFullPath','.JPG','\x20WHERE\x20id\x20=\x20','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20','transaction','fileExist','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','\x20\x20\x20AND\x20in_trash!=1\x20','toLowerCase','serverType','/dealSimilarPhoto','get','albumId','GPS','pathList','data','/resetSimilarPhotoAi','Cleaning\x20out\x20the\x20recycle\x20bin\x20:\x20','\x20WHERE\x20title\x20like\x20?','dataPreview','faceName','../utils/sharpUtils','photoSavedAsNewFile','timeOrder','geohash','aiFaceEnable','delete','.jpg','startFaceAiWork','\x20in_trash=1\x20and\x20is_file=1\x20','geoInfoWriteErr','getByName','SELECT\x20f.id\x20as\x20photo_index_id\x20FROM\x20ai_classes2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20a.photo_index_id=f.id\x20WHERE\x20a.class_id=?\x20and\x20score>?\x20and\x20\x20f.in_trash=0\x20\x20and\x20f.tiny_path\x20is\x20not\x20null\x20AND\x20f.tiny_path\x20!=\x20\x270\x27\x20\x20','title','cacheDeleteFail','searchStr','user_list','trash','post','./photoApiUtils','getFaceInSql','\x20type=2\x20\x20','sortType','face_img_path','/operationLibrary','\x20ORDER\x20BY\x20is_file\x20asc,\x20','checkSqlInjection','piexifjs','../utils/sqliteUtil','orderField','delete\x20from\x20photo_faces2index\x20where\x201=1','targetFaceId','\x20(((type=1\x20or\x20type=2)\x20\x20)\x20OR\x20is_file=0\x20)\x20','indexId','minLat','shareForSubUser','rawFaceIndexIdList','replace','platform','getUserPathWhere','RAW','size','binary','currentUser','year','round','\x20AND\x20geohash4!=\x27undefined\x27\x20GROUP\x20BY\x20geohash4','all','f2id','../../db/dbConfigTable','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20id=?','\x20LIMIT\x20?\x20OFFSET\x20?','\x20AND\x20geohash3!=\x27undefined\x27\x20GROUP\x20BY\x20geohash3','book','../../utils/exifUtils','/getAllAlbum','GPSLatitudeRef','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_face_detect_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20','90jwtsBs','3782088ZwzZhP','f2height','photo','\x20id,geohash,latitude,longitude,original_time\x20','deleteList','rawFaceId','deleteRawTempFile','435320xbPbIU','\x20SET\x20in_trash=1,in_trash_time=','error\x20data','ADD','delete\x20from\x20photo_phash_similar\x20where\x20index_id=','\x20type=1\x20','photo_index_id','create','/getFaceImg/*','latitude','path_list','update','faceIdList','is_livephoto','/addAlbum','ExifIFD','push','parse','getAlbumWhereStr','\x20id\x20in\x20(','imagePreviewType','paramsList','ordinaryAlbumId','extname'];_0x473b=function(){return _0x4b7200;};return _0x473b();}router[_0x5169d3(0x1fb)](_0x5169d3(0x2da),(_0x166d6e,_0x43c6b1,_0x22fe01)=>{const _0x25f3af=_0x5169d3;if(dbUserTable[_0x25f3af(0x298)](_0x166d6e,_0x43c6b1,_0x25f3af(0x226),'power_get')==!![]){result=photoApiUtil[_0x25f3af(0x2ae)](_0x166d6e,_0x43c6b1);let _0x380c8b=[],_0x2e73a0=[];try{if(result&&result[_0x25f3af(0x328)]>0x0){for(let _0x147166 of result){!_0x380c8b[_0x25f3af(0x2bf)](_0x147166['original_date'])&&(_0x380c8b['push'](_0x147166[_0x25f3af(0x30a)]),_0x2e73a0[_0x25f3af(0x23b)]({'date':_0x147166[_0x25f3af(0x30a)],'geoHashList':[],'locationList':[]}));if(_0x147166['geohash']&&_0x147166[_0x25f3af(0x351)]!='undefined'&&_0x147166['geohash'][_0x25f3af(0x328)]>0x4){let _0x284874=_0x2e73a0[_0x380c8b['indexOf'](_0x147166[_0x25f3af(0x30a)])]['geoHashList'],_0x1386f1=_0x147166[_0x25f3af(0x351)][_0x25f3af(0x2bb)](0x0,0x5);!_0x284874[_0x25f3af(0x2bf)](_0x1386f1)&&_0x284874[_0x25f3af(0x328)]<0x5&&_0x284874[_0x25f3af(0x23b)](_0x1386f1);}}for(let _0x5553d0 of _0x2e73a0){if(_0x5553d0[_0x25f3af(0x28b)][_0x25f3af(0x328)]<0x1)continue;for(let _0x32ab32 in _0x5553d0[_0x25f3af(0x28b)]){let _0x5bb117=_0x5553d0[_0x25f3af(0x28b)][_0x32ab32][_0x25f3af(0x2bb)](0x0,0x5),_0x2d4af0=null;if(geoDbCache[_0x5bb117])_0x2d4af0=geoDbCache[_0x5bb117];else{let _0x4960da='SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20geohash=?';_0x2d4af0=_0x166d6e[_0x25f3af(0x2a8)]['dbCity'][_0x25f3af(0x2fb)](_0x4960da)[_0x25f3af(0x344)](_0x5bb117),geoDbCache[_0x5bb117]=_0x2d4af0;}_0x2d4af0&&_0x5553d0['locationList'][_0x25f3af(0x23b)](_0x2d4af0);}delete _0x5553d0['geoHashList'];}for(let _0x355015=_0x2e73a0[_0x25f3af(0x328)]-0x1;_0x355015>=0x0;_0x355015--){_0x2e73a0[_0x355015]['locationList'][_0x25f3af(0x328)]<0x1&&_0x2e73a0[_0x25f3af(0x2cf)](_0x355015,0x1);}}}catch(_0x3583e8){console[_0x25f3af(0x24e)](_0x3583e8);}let _0x51a3d0={'code':0x0,'data':result,'originalDateItemList':_0x2e73a0},_0x59c609=dbConfigTable['findByTitle'](_0x166d6e[_0x25f3af(0x2a8)][_0x25f3af(0x290)],_0x25f3af(0x2e9)),_0x376ac7=dbConfigTable['findByTitle'](_0x166d6e[_0x25f3af(0x2a8)]['dbOther'],_0x25f3af(0x286));_0x51a3d0[_0x25f3af(0x23f)]=_0x25f3af(0x211);if(_0x59c609&&_0x59c609[_0x25f3af(0x26f)]==_0x25f3af(0x265)&&_0x376ac7&&_0x376ac7['value'])try{let _0x40b2e8=parseInt(_0x376ac7[_0x25f3af(0x26f)]);_0x51a3d0[_0x25f3af(0x23f)]=_0x25f3af(0x265),_0x51a3d0[_0x25f3af(0x247)]=_0x40b2e8;}catch(_0x4b86c9){console[_0x25f3af(0x24e)](_0x4b86c9);}_0x43c6b1[_0x25f3af(0x2f7)](_0x51a3d0);}}),router[_0x5169d3(0x1fb)]('/getAlbumPhotoForMap',(_0x35a71a,_0x3710e6,_0x79ce49)=>{const _0xb57c57=_0x5169d3;let _0x1430c3=_0xb57c57(0x2fe),_0x1dc685=[],_0x37243b=_0x35a71a['body']['libraryId'];if(_0x35a71a[_0xb57c57(0x255)][_0xb57c57(0x345)]){let _0x51ab59=dbAlbumTable['getAlbumWhereStr'](_0x35a71a[_0xb57c57(0x2a8)][_0xb57c57(0x290)],_0x35a71a[_0xb57c57(0x255)][_0xb57c57(0x345)]);_0x51ab59&&(_0x1430c3+=_0xb57c57(0x30e)+_0x51ab59);}if(_0x37243b){let _0x320b9d=_0x35a71a['app']['dbFileIndex'][_0xb57c57(0x2fb)](_0xb57c57(0x21b))['get'](_0x37243b);if(_0x320b9d)try{let _0x5f0937=JSON['parse'](_0x320b9d['path_list']),_0x1eb46b=dbUserTable['getPathWhere'](!![],_0x5f0937);_0x1430c3+=_0x1eb46b[_0xb57c57(0x299)],_0x1dc685[_0xb57c57(0x23b)](..._0x1eb46b[_0xb57c57(0x240)]);}catch(_0x591348){console[_0xb57c57(0x24e)](_0x591348);}}function _0x14a2db(_0x5d62c0,_0x24c3f2,_0xbab4f3){const _0x2ee200=_0xb57c57;if(_0xbab4f3){let _0x52c94b=0x0;if(_0x35a71a[_0x2ee200(0x255)]['ordinaryAlbumId']){let _0x4a529a=dbFileIndexTable[_0x2ee200(0x280)](_0x35a71a[_0x2ee200(0x2a8)][_0x2ee200(0x251)],_0x5d62c0,[parseInt(_0x35a71a[_0x2ee200(0x255)][_0x2ee200(0x241)]),..._0x1dc685]);_0x52c94b=_0x4a529a['count'];}else{let _0x533c59=dbFileIndexTable[_0x2ee200(0x321)](_0x35a71a[_0x2ee200(0x2a8)]['dbFileIndex'],_0x5d62c0,dbFileIndexTable[_0x2ee200(0x2f9)],_0x1dc685);_0x52c94b=_0x533c59[_0x2ee200(0x30b)];}return _0x52c94b;}else{let _0x6bd21=[];return _0x35a71a['body'][_0x2ee200(0x241)]?_0x6bd21=dbFileIndexTable[_0x2ee200(0x2d7)](_0x35a71a[_0x2ee200(0x2a8)][_0x2ee200(0x251)],_0x5d62c0,_0x24c3f2,[parseInt(_0x35a71a['body']['ordinaryAlbumId']),..._0x1dc685]):_0x6bd21=dbFileIndexTable['getAllByWhereAndField'](_0x35a71a['app'][_0x2ee200(0x251)],_0x5d62c0,_0x24c3f2,dbFileIndexTable[_0x2ee200(0x2f9)],_0x1dc685),_0x6bd21;}}let _0x5488e7=dbUserTable[_0xb57c57(0x210)](_0x35a71a,'photo',_0xb57c57(0x2d8),!![]),_0x2bfa61=_0x5488e7[_0xb57c57(0x299)];_0x1430c3+=_0x2bfa61,_0x1dc685[_0xb57c57(0x23b)](..._0x5488e7['paramsList']),_0x1430c3+=_0xb57c57(0x249);let _0x25f792=0xc8,_0x4321e9=[],_0xc29600=_0x14a2db(_0x1430c3,null,!![]);if(_0xc29600<_0x25f792)_0x4321e9=_0x14a2db(_0x1430c3,'*');else{let _0x1d5af4=_0x1430c3+_0xb57c57(0x2b1),_0x378006=_0x14a2db(_0x1d5af4,'*');if(_0x378006&&_0x378006[_0xb57c57(0x328)]<_0x25f792)_0x4321e9=_0x378006;else{let _0x3b3072=_0x1430c3+_0xb57c57(0x217),_0x249f80=_0x14a2db(_0x3b3072,'*');if(_0x249f80&&_0x249f80[_0xb57c57(0x328)]<_0x25f792)_0x4321e9=_0x249f80;else{let _0x294963=_0x1430c3+_0xb57c57(0x21d),_0x2d1f4a=_0x14a2db(_0x294963,'*');if(_0x2d1f4a&&_0x2d1f4a[_0xb57c57(0x328)]<_0x25f792)_0x4321e9=_0x2d1f4a;else{let _0x200812=_0x1430c3+_0xb57c57(0x2ea);_0x4321e9=_0x14a2db(_0x200812,'*');}}}}return _0x3710e6[_0xb57c57(0x2f7)]({'code':0x0,'mapPhoto':_0x4321e9});}),router[_0x5169d3(0x1fb)](_0x5169d3(0x292),(_0x50dc9c,_0x165502,_0x4fbecf)=>{const _0x386ed4=_0x5169d3;if(dbUserTable[_0x386ed4(0x298)](_0x50dc9c,_0x165502,_0x386ed4(0x226),_0x386ed4(0x2d8))==!![]){let _0x3f320f=_0x50dc9c[_0x386ed4(0x255)][_0x386ed4(0x20b)],_0x3bb5ff=_0x50dc9c['body'][_0x386ed4(0x275)],_0x50e93c=_0x50dc9c[_0x386ed4(0x255)][_0x386ed4(0x25d)],_0x175143=_0x50dc9c[_0x386ed4(0x255)]['maxLng'],_0x2becb1=_0x50dc9c['body']['zoom'],_0x507bac='',_0x29cb0a=0x2;if(_0x2becb1<=0x4)_0x29cb0a=0x2,_0x507bac='geohash2\x20=\x20?';else{if(_0x2becb1<=0x6)_0x29cb0a=0x3,_0x507bac=_0x386ed4(0x31b);else _0x2becb1<=0x8?(_0x29cb0a=0x4,_0x507bac=_0x386ed4(0x287)):(_0x29cb0a=0x5,_0x507bac=_0x386ed4(0x30c));}let _0xa0605f=geohash[_0x386ed4(0x2d4)](_0x3f320f,_0x3bb5ff,_0x50e93c,_0x175143,_0x29cb0a),_0x409754=_0x386ed4(0x227),_0x2682a8=[],_0x168347=dbUserTable[_0x386ed4(0x210)](_0x50dc9c,_0x386ed4(0x226),_0x386ed4(0x2d8),!![]);for(let _0x27d0c9=0x0;_0x27d0c9<_0xa0605f[_0x386ed4(0x328)];_0x27d0c9++){let _0x2b6c31=_0xa0605f[_0x27d0c9],_0x1e8fb0=[_0x2b6c31,..._0x168347[_0x386ed4(0x240)]],_0x318a99='\x20'+_0x507bac+'\x20'+_0x168347[_0x386ed4(0x299)]+_0x386ed4(0x332),_0x5aacc5=dbFileIndexTable['getByWhere'](_0x50dc9c['app']['dbFileIndex'],_0x318a99,_0x409754,dbFileIndexTable[_0x386ed4(0x2f9)],_0x1e8fb0);_0x5aacc5&&_0x2682a8[_0x386ed4(0x23b)](_0x5aacc5);}_0x165502[_0x386ed4(0x2f7)]({'code':0x0,'mapPhoto':_0x2682a8});}}),router[_0x5169d3(0x1fb)](_0x5169d3(0x239),(_0x35e974,_0x1d6696,_0x4adff3)=>{const _0x365f13=_0x5169d3;if(dbUserTable[_0x365f13(0x298)](_0x35e974,_0x1d6696,_0x365f13(0x226),_0x365f13(0x2f2))==!![]){let _0x398c08=_0x35e974[_0x365f13(0x255)][_0x365f13(0x2cc)],_0x1e65d2=_0x35e974['body'][_0x365f13(0x348)],_0x4e4bd3=_0x35e974[_0x365f13(0x255)][_0x365f13(0x2b4)],_0x5bded5=_0x35e974[_0x365f13(0x255)]['name'],_0x4d0185=_0x35e974[_0x365f13(0x255)][_0x365f13(0x266)];if(!_0x1e65d2||!_0x1e65d2['searchValue']||sqliteUtil['checkSqlInjection'](_0x1e65d2['searchValue'])==!![])return _0x35e974[_0x365f13(0x2a8)][_0x365f13(0x259)](_0x1d6696,_0x365f13(0x22d));if(!_0x4d0185){let _0x507d21=dbAlbumTable[_0x365f13(0x1f4)](_0x35e974['app'][_0x365f13(0x290)],_0x5bded5);if(_0x507d21)return _0x35e974[_0x365f13(0x2a8)][_0x365f13(0x259)](_0x1d6696,_0x1d6696['__'](_0x365f13(0x2a2)));}let _0x477cd1=null;_0x4d0185?_0x477cd1=dbAlbumTable[_0x365f13(0x236)](_0x35e974[_0x365f13(0x2a8)][_0x365f13(0x290)],{'type':_0x398c08,'data':_0x1e65d2,'data_value':_0x4e4bd3,'name':_0x5bded5},_0x4d0185):_0x477cd1=dbAlbumTable[_0x365f13(0x232)](_0x35e974[_0x365f13(0x2a8)][_0x365f13(0x290)],{'type':_0x398c08,'data':_0x1e65d2,'data_value':_0x4e4bd3,'name':_0x5bded5}),_0x1d6696['json']({'code':0x0,'result':_0x477cd1});}}),router[_0x5169d3(0x1fb)]('/deleteAlbum',(_0x2395f8,_0x36c6d0,_0x320428)=>{const _0x26ffa7=_0x5169d3;if(dbUserTable[_0x26ffa7(0x298)](_0x2395f8,_0x36c6d0,_0x26ffa7(0x226),_0x26ffa7(0x325))==!![]){let _0x5e0853=_0x2395f8[_0x26ffa7(0x255)]['id'],_0x5f6306=dbAlbumTable[_0x26ffa7(0x1ef)](_0x2395f8[_0x26ffa7(0x2a8)][_0x26ffa7(0x290)],_0x5e0853);_0x5f6306[_0x26ffa7(0x2d0)]>0x0?_0x36c6d0[_0x26ffa7(0x2f7)]({'code':0x0,'result':_0x5f6306}):_0x36c6d0[_0x26ffa7(0x2f7)]({'code':0x1,'message':_0x26ffa7(0x303)});}}),router[_0x5169d3(0x1fb)](_0x5169d3(0x2f8),(_0xefb6e5,_0x3ecb37,_0x2f9547)=>{const _0x1d8c7c=_0x5169d3;if(dbUserTable['doUserCanGet'](_0xefb6e5,_0x3ecb37,_0x1d8c7c(0x226),_0x1d8c7c(0x284))==!![]){let _0x405638=_0xefb6e5[_0x1d8c7c(0x255)]['id'],_0x535c4f=_0xefb6e5[_0x1d8c7c(0x255)][_0x1d8c7c(0x300)],_0x4f691a=dbAlbumTable['getByName'](_0xefb6e5[_0x1d8c7c(0x2a8)]['dbOther'],_0x535c4f);if(_0x4f691a)return _0xefb6e5[_0x1d8c7c(0x2a8)][_0x1d8c7c(0x259)](_0x3ecb37,_0x3ecb37['__'](_0x1d8c7c(0x2a2)));let _0x5e199c=dbAlbumTable[_0x1d8c7c(0x2a9)](_0xefb6e5[_0x1d8c7c(0x2a8)][_0x1d8c7c(0x290)],_0x405638,_0x535c4f);_0x5e199c['changes']>0x0?_0x3ecb37[_0x1d8c7c(0x2f7)]({'code':0x0,'result':_0x5e199c}):_0x3ecb37['json']({'code':0x1,'message':_0x1d8c7c(0x303)});}}),router[_0x5169d3(0x1fb)](_0x5169d3(0x220),(_0x50ef4f,_0x588a8e,_0x4ada45)=>{const _0x21d648=_0x5169d3;if(dbUserTable[_0x21d648(0x298)](_0x50ef4f,_0x588a8e,'photo','power_get')==!![]){let _0x3d0b84=_0x50ef4f[_0x21d648(0x255)]['count']||0x32,_0x139290=_0x50ef4f[_0x21d648(0x255)][_0x21d648(0x2be)]||0x0,_0x37c788=_0x50ef4f[_0x21d648(0x255)][_0x21d648(0x206)]||'id',_0x35ad6a=_0x50ef4f[_0x21d648(0x255)][_0x21d648(0x2cd)]||_0x21d648(0x337),_0x448a33=_0x50ef4f[_0x21d648(0x255)][_0x21d648(0x256)],_0x4ebb6d=dbAlbumTable[_0x21d648(0x2e1)](_0x50ef4f[_0x21d648(0x2a8)][_0x21d648(0x290)],_0x3d0b84,_0x139290,_0x37c788,_0x35ad6a,_0x448a33),_0x313677=dbUserTable[_0x21d648(0x210)](_0x50ef4f,'photo',_0x21d648(0x2d8),!![]);for(let _0x3aba77=0x0;_0x3aba77<_0x4ebb6d[_0x21d648(0x328)];_0x3aba77++){let _0x28f1af=_0x21d648(0x2dd);_0x28f1af+=_0x313677[_0x21d648(0x299)];let _0x48b23b=[..._0x313677[_0x21d648(0x240)]],_0x123b37=dbAlbumTable[_0x21d648(0x23d)](_0x50ef4f['app'][_0x21d648(0x290)],_0x4ebb6d[_0x3aba77]['id']);_0x123b37&&(_0x28f1af+=_0x21d648(0x30e)+_0x123b37);_0x28f1af+='\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0',_0x28f1af+=_0x21d648(0x33f);try{let _0x36a8a6=dbFileIndexTable[_0x21d648(0x330)](_0x50ef4f[_0x21d648(0x2a8)][_0x21d648(0x251)],_0x28f1af,'*',dbFileIndexTable[_0x21d648(0x2f9)],_0x48b23b);_0x4ebb6d[_0x3aba77][_0x21d648(0x308)]=_0x36a8a6;}catch(_0x104822){console[_0x21d648(0x24e)](_0x104822),_0x4ebb6d[_0x3aba77][_0x21d648(0x308)]=[];}}_0x588a8e[_0x21d648(0x2f7)]({'code':0x0,'data':_0x4ebb6d});}}),router['post']('/searchMode',(_0x49f074,_0x250ad7,_0x3d231e)=>{const _0x5eb124=_0x5169d3;let _0x54dcf8=_0x49f074[_0x5eb124(0x255)][_0x5eb124(0x260)],_0x561e53=dbFileIndexTable[_0x5eb124(0x24f)](_0x49f074['app'][_0x5eb124(0x251)],_0x54dcf8),_0x3632d9=[];for(let _0x111b29=0x0;_0x111b29<_0x561e53['length'];_0x111b29++){_0x3632d9[_0x5eb124(0x23b)](_0x561e53[_0x111b29][_0x5eb124(0x26e)]);}_0x250ad7[_0x5eb124(0x2f7)]({'code':0x0,'data':_0x3632d9});}),router[_0x5169d3(0x1fb)](_0x5169d3(0x25e),(_0x577d64,_0x5387bb,_0x3f8ff2)=>{const _0x24599c=_0x5169d3;let _0x4607e0=_0x577d64[_0x24599c(0x255)][_0x24599c(0x24a)],_0x4775db=_0x577d64[_0x24599c(0x255)][_0x24599c(0x2f4)],_0x275b26=_0x577d64[_0x24599c(0x255)][_0x24599c(0x30b)],_0x289451=_0x577d64[_0x24599c(0x255)]['offset']||0x0;_0x289451=parseInt(_0x289451);let _0x248250=parseInt(_0x577d64['body']['showFileType']),_0x52528c=_0x577d64['body'][_0x24599c(0x1f8)],_0x41839c=['filename','original_time',_0x24599c(0x212),_0x24599c(0x2ce),_0x24599c(0x32f)],_0x1eecb9=['asc',_0x24599c(0x337)],_0x90801=_0x577d64['body'][_0x24599c(0x206)]||'id',_0x2dee34=_0x577d64['body'][_0x24599c(0x2cd)]||_0x24599c(0x337);!_0x41839c[_0x24599c(0x2bf)](_0x90801)&&(_0x90801='id');!_0x1eecb9[_0x24599c(0x2bf)](_0x2dee34)&&(_0x90801=_0x24599c(0x337));if(dbUserTable[_0x24599c(0x298)](_0x577d64,_0x5387bb,_0x4775db,_0x24599c(0x2d8))==!![]){let _0x4995e7=[];if(!_0x4607e0){let _0x3b8b42=[];_0x577d64['currentUser'][_0x24599c(0x263)]==0x1?_0x3b8b42=dbSourceFolderTable['getPathByType'](_0x577d64[_0x24599c(0x2a8)][_0x24599c(0x290)],_0x4775db):_0x3b8b42=dbUserTable[_0x24599c(0x26b)](_0x577d64[_0x24599c(0x2a8)][_0x24599c(0x290)],_0x577d64['currentUser'][_0x24599c(0x28d)],_0x4775db);if(_0x3b8b42)for(let _0x5e088a=0x0;_0x5e088a<_0x3b8b42[_0x24599c(0x328)];_0x5e088a++){_0x4995e7['push']({'path':_0x3b8b42[_0x5e088a][_0x24599c(0x2ef)],'is_file':0x0,'filename':path[_0x24599c(0x2a1)](_0x3b8b42[_0x5e088a]['path']),'root':!![]});}}else{if(_0x577d64['currentUser'][_0x24599c(0x263)]!=0x1){if(dbUserTable[_0x24599c(0x298)](_0x577d64,_0x5387bb,_0x4775db,_0x24599c(0x2d8),_0x4607e0)!==!![])return;}_0x4607e0=path[_0x24599c(0x2a7)](path['normalize'](_0x4607e0));let _0x4cec00='\x20path=\x20?\x20AND\x20',_0x142329=[_0x4607e0];if(_0x248250==0x0)_0x4cec00+=_0x24599c(0x209);else{if(_0x248250==0x1)_0x4cec00+=_0x24599c(0x230);else{if(_0x248250==0x2)_0x4cec00+=_0x24599c(0x1fe);else _0x248250==0x3&&(_0x4cec00+=_0x24599c(0x264));}}if(_0x52528c){let _0x295fc8=_0x24599c(0x322);_0x142329[_0x24599c(0x23b)]('%'+_0x52528c+'%','\x27%'+_0x52528c+'%\x27'),_0x4775db==_0x24599c(0x2d3)&&(_0x295fc8=_0x24599c(0x2d6),_0x142329[_0x24599c(0x23b)]('\x27%'+_0x52528c+'%\x27')),_0x4cec00+=_0x295fc8;}let _0x166e53=_0x24599c(0x29d),_0x4d9512=dbFileIndexTable['getIndexTableNameByType'](_0x4775db);if(_0x4775db=='movie')_0x166e53='\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time\x20';else _0x4775db=='music'&&(_0x166e53='\x20is_file,id,path,filename,ext,duration,size\x20');_0x4cec00+=_0x24599c(0x202)+_0x90801+'\x20'+_0x2dee34+_0x24599c(0x283)+_0x275b26+'\x20OFFSET\x20'+_0x289451,_0x4995e7=dbFileIndexTable[_0x24599c(0x330)](_0x577d64[_0x24599c(0x2a8)][_0x24599c(0x251)],_0x4cec00,_0x166e53,_0x4d9512,_0x142329);}let _0x23ee18=path['sep'],_0x4a4190={'platform':platform,'code':0x0,'data':_0x4995e7,'sep':_0x23ee18};return _0x5387bb['json'](_0x4a4190);}}),router['post'](_0x5169d3(0x2b9),(_0x439ae3,_0x5815cf,_0x1f3220)=>{const _0x278041=_0x5169d3;let _0x3bd29f=_0x439ae3[_0x278041(0x255)]['id'],_0x3720e4=_0x439ae3[_0x278041(0x255)][_0x278041(0x342)],_0x9d4599=dbFileIndexTable[_0x278041(0x2f9)];if(_0x3720e4==_0x278041(0x2d3))_0x9d4599=dbFileIndexTable['INDEX_TABLE_NAME_MOVIE'];else{if(_0x3720e4==_0x278041(0x281))_0x9d4599=dbFileIndexTable[_0x278041(0x2af)];else _0x3720e4==_0x278041(0x21e)&&(_0x9d4599=dbFileIndexTable['INDEX_TABLE_NAME_BOOK']);}let _0x2b77a2=dbFileIndexTable[_0x278041(0x31f)](_0x439ae3[_0x278041(0x2a8)]['dbFileIndex'],_0x3bd29f,_0x9d4599);if(!_0x2b77a2)return _0x5815cf[_0x278041(0x2e5)](0x194)[_0x278041(0x267)]();if(dbUserTable[_0x278041(0x298)](_0x439ae3,_0x5815cf,'','power_get',_0x2b77a2[_0x278041(0x2ef)])==!![]){let _0x156bb3={'code':0x0,'data':_0x2b77a2};if(_0x3720e4=='movie'){let _0x4ac472=dbConfigTable[_0x278041(0x2e3)](_0x439ae3[_0x278041(0x2a8)]['dbOther'],_0x278041(0x24c));_0x156bb3[_0x278041(0x24c)]=_0x4ac472?_0x4ac472[_0x278041(0x26f)]:_0x278041(0x2fc),_0x156bb3[_0x278041(0x348)]['moviePreferLanguage']=_0x156bb3[_0x278041(0x24c)];let _0x4ba3f0=dbConfigTable['findByTitle'](_0x439ae3[_0x278041(0x2a8)][_0x278041(0x290)],_0x278041(0x324));_0x156bb3[_0x278041(0x324)]=_0x4ba3f0?_0x4ba3f0[_0x278041(0x26f)]:'2',_0x156bb3[_0x278041(0x348)][_0x278041(0x324)]=_0x156bb3[_0x278041(0x324)];let _0x5b360c=dbConfigTable['findByTitle'](_0x439ae3[_0x278041(0x2a8)]['dbOther'],_0x278041(0x334));_0x156bb3['defaultTranscodeResolution']=_0x5b360c?_0x5b360c[_0x278041(0x26f)]:'3';let _0x3ea972=dbConfigTable[_0x278041(0x2e3)](_0x439ae3['app'][_0x278041(0x290)],_0x278041(0x316));_0x156bb3['defaultMoviePlay']=_0x3ea972?_0x3ea972[_0x278041(0x26f)]:_0x278041(0x2e6);let _0x3f5280=path[_0x278041(0x27d)](_0x2b77a2[_0x278041(0x2ef)],_0x2b77a2['filename']);fs[_0x278041(0x28e)](_0x3f5280,(_0x7de420,_0x5483fc)=>{const _0x5a478c=_0x278041;return _0x7de420?(_0x156bb3['fileExist']=0x0,_0x156bb3[_0x5a478c(0x339)]=_0x3f5280):(_0x156bb3[_0x5a478c(0x33e)]=0x1,_0x156bb3[_0x5a478c(0x339)]=_0x3f5280),_0x5815cf[_0x5a478c(0x2f7)](_0x156bb3);});}else return _0x5815cf[_0x278041(0x2f7)](_0x156bb3);}}),router[_0x5169d3(0x1fb)]('/editExifByIndexId',(_0x760261,_0x716d27,_0x4ce61f)=>{const _0x7c06a5=_0x5169d3;if(dbUserTable[_0x7c06a5(0x298)](_0x760261,_0x716d27,_0x7c06a5(0x226),_0x7c06a5(0x284))==!![]){let _0x2bf529=_0x760261[_0x7c06a5(0x255)]['id'],_0x49ef73=_0x760261[_0x7c06a5(0x255)][_0x7c06a5(0x234)],_0x2b2366=_0x760261['body']['longitude'],_0x4edb41=_0x760261[_0x7c06a5(0x255)]['newDate'],_0x30f4c2=dbFileIndexTable['getById'](_0x760261[_0x7c06a5(0x2a8)]['dbFileIndex'],_0x2bf529);if(!_0x30f4c2)return _0x760261['app'][_0x7c06a5(0x259)](_0x716d27,_0x716d27['__'](_0x7c06a5(0x34f)));let _0x40c463=path[_0x7c06a5(0x27d)](_0x30f4c2[_0x7c06a5(0x2ef)],path[_0x7c06a5(0x26c)],_0x30f4c2[_0x7c06a5(0x248)]),_0x510f14=path[_0x7c06a5(0x242)](_0x40c463)?path[_0x7c06a5(0x242)](_0x40c463)[_0x7c06a5(0x341)]():'';if(_0x510f14!=_0x7c06a5(0x1f0)&&_0x510f14!=_0x7c06a5(0x2ac))return _0x760261[_0x7c06a5(0x2a8)][_0x7c06a5(0x259)](_0x716d27,_0x7c06a5(0x2b6));fs[_0x7c06a5(0x28e)](_0x40c463,(_0x9a1e90,_0xe33190)=>{const _0x59b024=_0x7c06a5;if(_0x9a1e90||!_0xe33190[_0x59b024(0x30f)]())return _0x760261[_0x59b024(0x2a8)]['returnErrMsg'](_0x716d27,_0x716d27['__'](_0x59b024(0x32a)));if(_0x9a1e90||!_0xe33190[_0x59b024(0x30f)]())return _0x760261['app'][_0x59b024(0x259)](_0x716d27,_0x716d27['__'](_0x59b024(0x32a)));fs[_0x59b024(0x2a3)](_0x40c463,(_0x19f4db,_0x226c5a)=>{const _0x656d5d=_0x59b024;if(_0x19f4db)return _0x760261[_0x656d5d(0x2a8)][_0x656d5d(0x259)](_0x716d27,_0x716d27['__'](_0x656d5d(0x317)));var _0x331388=piexif['load'](_0x226c5a[_0x656d5d(0x331)]('binary'));if(_0x49ef73&&_0x2b2366){function _0x12ef73(_0x5990f7){const _0x5c11d0=_0x656d5d;try{_0x5990f7=Number(_0x5990f7);let _0x1f2ad5=Math[_0x5c11d0(0x335)](Math[_0x5c11d0(0x2f1)](_0x5990f7)),_0xb42144=(Math[_0x5c11d0(0x2f1)](_0x5990f7)-_0x1f2ad5)*0x3c,_0x2a436f=Math[_0x5c11d0(0x335)](_0xb42144),_0x381057=Math[_0x5c11d0(0x216)]((_0xb42144-_0x2a436f)*0x3c*0x64);return[[_0x1f2ad5,0x1],[_0x2a436f,0x1],[_0x381057,0x64]];}catch(_0x1114f2){return'';}}let _0x8e73cb=_0x12ef73(_0x49ef73),_0x4b8178=_0x12ef73(_0x2b2366);if(!_0x4b8178||!_0x8e73cb)return _0x760261[_0x656d5d(0x2a8)][_0x656d5d(0x259)](_0x716d27,'ERROR\x20GPS\x20LOCATION');_0x331388['GPS'][piexif[_0x656d5d(0x2bd)][_0x656d5d(0x221)]]=_0x49ef73>=0x0?'N':'S',_0x331388[_0x656d5d(0x346)][piexif['GPSIFD'][_0x656d5d(0x29b)]]=_0x8e73cb,(_0x331388[_0x656d5d(0x346)][piexif['GPSIFD'][_0x656d5d(0x258)]]=_0x2b2366>=0x0?'E':'W',_0x331388['GPS'][piexif[_0x656d5d(0x2bd)][_0x656d5d(0x29e)]]=_0x4b8178);let _0x283993=geohash[_0x656d5d(0x293)](_0x49ef73,_0x2b2366,0x8),_0x1a6420=_0x283993[_0x656d5d(0x2bb)](0x0,0x5),_0x3f64e9=_0x283993[_0x656d5d(0x2bb)](0x0,0x4),_0x1293c5=_0x283993['substring'](0x0,0x3),_0x470754=_0x283993[_0x656d5d(0x2bb)](0x0,0x2),_0xdf1627=[_0x49ef73,_0x2b2366,_0x283993,_0x1a6420,_0x3f64e9,_0x1293c5,_0x470754];dbFileIndexTable[_0x656d5d(0x261)](_0x760261['app']['dbFileIndex'],_0x30f4c2['id'],_0x656d5d(0x277),dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],_0xdf1627);}if(_0x4edb41){_0x331388[_0x656d5d(0x253)][piexif[_0x656d5d(0x23a)]['DateTimeOriginal']]=_0x4edb41,_0x331388['GPS'][piexif[_0x656d5d(0x2bd)][_0x656d5d(0x2d2)]]=_0x4edb41;let _0x12e965=new Date(_0x4edb41),_0x5bea99=_0x12e965[_0x656d5d(0x2d5)](),_0xb29e8a=_0x12e965[_0x656d5d(0x31c)](),_0x42ea58=_0x12e965[_0x656d5d(0x31d)]()+0x1;_0x42ea58=_0x42ea58>=0xa?_0x42ea58:'0'+_0x42ea58;let _0x19d7d8=_0x12e965[_0x656d5d(0x338)]();_0x19d7d8=_0x19d7d8>=0xa?_0x19d7d8:'0'+_0x19d7d8;let _0x2da68d=_0xb29e8a+'-'+_0x42ea58+'-'+_0x19d7d8,_0x156ccf=[_0x5bea99,_0x2da68d];dbFileIndexTable[_0x656d5d(0x261)](_0x760261[_0x656d5d(0x2a8)][_0x656d5d(0x251)],_0x30f4c2['id'],'\x20original_time=?,original_date=?\x20',dbFileIndexTable[_0x656d5d(0x2f9)],_0x156ccf);}try{var _0xe77ea6=piexif['dump'](_0x331388),_0x407cb5=piexif[_0x656d5d(0x272)](_0xe77ea6,_0x226c5a[_0x656d5d(0x331)]('binary'));let _0x26cc84=path[_0x656d5d(0x27d)](_0x30f4c2[_0x656d5d(0x2ef)],_0x30f4c2[_0x656d5d(0x248)]);fs[_0x656d5d(0x2ee)](_0x26cc84,Buffer[_0x656d5d(0x27e)](_0x407cb5,_0x656d5d(0x213)),{},_0x39b732=>{const _0x23b5ac=_0x656d5d;if(_0x39b732)return console[_0x23b5ac(0x24e)](_0x39b732),_0x760261[_0x23b5ac(0x2a8)]['returnErrMsg'](_0x716d27,_0x716d27['__'](_0x23b5ac(0x317)));console[_0x23b5ac(0x24e)]('文件写入成功'),fs[_0x23b5ac(0x327)](_0x26cc84,new Date(_0x30f4c2['mtime']),new Date(_0x30f4c2[_0x23b5ac(0x306)]),_0x3bd491=>{const _0x147a7e=_0x23b5ac;_0x3bd491&&console[_0x147a7e(0x24e)](_0x3bd491),fs[_0x147a7e(0x28e)](_0x26cc84,(_0x53a600,_0x41ac59)=>{const _0x4b75ce=_0x147a7e;if(_0x53a600)return _0x760261[_0x4b75ce(0x2a8)][_0x4b75ce(0x259)](_0x716d27,_0x716d27['__'](_0x4b75ce(0x317)));let _0x3c4c06=[_0x41ac59[_0x4b75ce(0x212)],_0x41ac59[_0x4b75ce(0x2f6)]];return dbFileIndexTable[_0x4b75ce(0x261)](_0x760261[_0x4b75ce(0x2a8)][_0x4b75ce(0x251)],_0x30f4c2['id'],_0x4b75ce(0x2ab),dbFileIndexTable[_0x4b75ce(0x2f9)],_0x3c4c06),_0x716d27[_0x4b75ce(0x2f7)]({'code':0x0,'newIndex':dbFileIndexTable[_0x4b75ce(0x31f)](_0x760261[_0x4b75ce(0x2a8)][_0x4b75ce(0x251)],_0x30f4c2['id'])});});});});}catch(_0x5c5e2a){return console[_0x656d5d(0x24e)](_0x5c5e2a),_0x760261[_0x656d5d(0x2a8)][_0x656d5d(0x259)](_0x716d27,_0x716d27['__'](_0x656d5d(0x1f3)));}});});}}),router[_0x5169d3(0x1fb)]('/getPhotoClasses',(_0xb2bec2,_0x33370b,_0x2d185b)=>{const _0x2ac087=_0x5169d3;if(dbUserTable[_0x2ac087(0x298)](_0xb2bec2,_0x33370b,'photo',_0x2ac087(0x2d8))==!![]){let _0x4eb46c=dbConfigTable[_0x2ac087(0x2e3)](_0xb2bec2[_0x2ac087(0x2a8)][_0x2ac087(0x290)],_0x2ac087(0x301));if(!_0x4eb46c||_0x4eb46c['value']!='1')return _0x33370b[_0x2ac087(0x2f7)]({'code':0x0,'data':[],'enable':![]});let _0x59aab5=_0x2ac087(0x2e2),_0x1addb5=dbUserTable[_0x2ac087(0x210)](_0xb2bec2,_0x2ac087(0x226),_0x2ac087(0x2d8),!![]),_0x50e51f=[],_0x4a6cc2=_0xb2bec2[_0x2ac087(0x2a8)][_0x2ac087(0x251)]['prepare'](_0x2ac087(0x2ca)+_0x59aab5)['all'](),_0x1b5422=[];for(let _0x149bbe in _0x4a6cc2){let _0x169e74=_0x4a6cc2[_0x149bbe];_0x50e51f=[_0x169e74['id'],dbFileIndexTable[_0x2ac087(0x32b)],..._0x1addb5[_0x2ac087(0x240)]];let _0x523e14=_0xb2bec2[_0x2ac087(0x2a8)][_0x2ac087(0x251)][_0x2ac087(0x2fb)](_0x2ac087(0x1f5)+_0x1addb5['whereStr']+_0x2ac087(0x294))[_0x2ac087(0x344)](_0x50e51f);if(_0x523e14)_0x4a6cc2[_0x149bbe]['photo_index_id']=_0x523e14[_0x2ac087(0x231)],_0x4a6cc2[_0x149bbe]['class_id']=_0x4a6cc2[_0x149bbe]['id'],_0x1b5422[_0x2ac087(0x23b)](_0x4a6cc2[_0x149bbe]);else continue;}_0x33370b[_0x2ac087(0x2f7)]({'code':0x0,'data':_0x1b5422,'enable':!![]});}}),router[_0x5169d3(0x1fb)](_0x5169d3(0x302),(_0x4041d9,_0x320990,_0x558666)=>{const _0x1e57c9=_0x5169d3;if(dbUserTable[_0x1e57c9(0x298)](_0x4041d9,_0x320990,'photo',_0x1e57c9(0x2d8))==!![]){let _0x37e46d=dbConfigTable['findByTitle'](_0x4041d9[_0x1e57c9(0x2a8)]['dbOther'],_0x1e57c9(0x1ee));if(!_0x37e46d||_0x37e46d['value']!='1')return _0x320990[_0x1e57c9(0x2f7)]({'code':0x0,'data':[],'enable':![]});let _0x1d1312=0x5,_0x5d680d=dbConfigTable['findByTitle'](_0x4041d9[_0x1e57c9(0x2a8)]['dbOther'],_0x1e57c9(0x24b));_0x5d680d&&_0x5d680d['value']&&(_0x5d680d[_0x1e57c9(0x26f)]>0x0&&(_0x1d1312=_0x5d680d[_0x1e57c9(0x26f)]));let _0x54daf9=_0x4041d9['app'][_0x1e57c9(0x251)][_0x1e57c9(0x2fb)](_0x1e57c9(0x2c0))['all'](parseInt(_0x1d1312)),_0x1f5047=[];if(_0x4041d9[_0x1e57c9(0x214)][_0x1e57c9(0x263)]==0x1)_0x1f5047=_0x54daf9;else{let _0x3366b9=dbUserTable[_0x1e57c9(0x210)](_0x4041d9,_0x1e57c9(0x226),'power_get',!![]);for(let _0x470e6e of _0x54daf9){try{let _0x4fd34a=[_0x470e6e['id'],..._0x3366b9['paramsList']],_0x435a31=_0x4041d9[_0x1e57c9(0x2a8)]['dbFileIndex'][_0x1e57c9(0x2fb)](_0x1e57c9(0x25f)+_0x3366b9[_0x1e57c9(0x299)]+_0x1e57c9(0x24d))['get'](_0x4fd34a);_0x435a31&&_0x1f5047[_0x1e57c9(0x23b)](_0x470e6e);}catch(_0x2f2640){console[_0x1e57c9(0x24e)](_0x2f2640),_0x1f5047[_0x1e57c9(0x23b)](_0x470e6e);}}}_0x320990[_0x1e57c9(0x2f7)]({'code':0x0,'data':_0x1f5047,'enable':!![]});}}),router[_0x5169d3(0x1fb)](_0x5169d3(0x309),(_0x30e450,_0x1e9666,_0x3cb9bc)=>{const _0x4a3306=_0x5169d3;let _0x359056=_0x30e450[_0x4a3306(0x255)]['setFaceId'],_0x429105=_0x30e450[_0x4a3306(0x255)][_0x4a3306(0x229)],_0x78bb88=_0x30e450[_0x4a3306(0x255)][_0x4a3306(0x2c7)];if(dbUserTable[_0x4a3306(0x298)](_0x30e450,_0x1e9666,_0x4a3306(0x226),_0x4a3306(0x284))==!![]){let _0x53236d=dbFileIndexTable[_0x4a3306(0x1fd)](_0x30e450[_0x4a3306(0x2a8)][_0x4a3306(0x251)],_0x359056);_0x30e450[_0x4a3306(0x2a8)][_0x4a3306(0x251)][_0x4a3306(0x2fb)]('UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=0\x20where\x20is_face_poster=1\x20and\x20face_id\x20in\x20'+_0x53236d)[_0x4a3306(0x2e8)](),_0x30e450['app']['dbFileIndex'][_0x4a3306(0x2fb)]('UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=1\x20where\x20photo_index_id\x20=\x20'+_0x78bb88+_0x4a3306(0x257)+_0x429105)[_0x4a3306(0x2e8)](),_0x30e450[_0x4a3306(0x2a8)][_0x4a3306(0x251)]['prepare'](_0x4a3306(0x28f)+_0x359056)[_0x4a3306(0x2e8)](),_0x1e9666[_0x4a3306(0x2f7)]({'code':0x0});}}),router[_0x5169d3(0x1fb)](_0x5169d3(0x2b3),(_0x1df97c,_0x5d21a0,_0x421bea)=>{const _0x474055=_0x5169d3;let _0x44097e=_0x1df97c[_0x474055(0x255)][_0x474055(0x228)];try{_0x44097e=JSON[_0x474055(0x23c)](_0x44097e);}catch(_0x15ec5d){console[_0x474055(0x24e)](_0x15ec5d);}if(dbUserTable[_0x474055(0x298)](_0x1df97c,_0x5d21a0,_0x474055(0x226),_0x474055(0x284))==!![]){for(let _0x392d1 of _0x44097e){_0x1df97c[_0x474055(0x2a8)][_0x474055(0x251)][_0x474055(0x2fb)](_0x474055(0x2e7))[_0x474055(0x2e8)](parseInt(_0x392d1[_0x474055(0x30d)]),parseInt(_0x392d1[_0x474055(0x20a)]));}_0x5d21a0[_0x474055(0x2f7)]({'code':0x0});}}),router['post']('/updatePhotoFace',(_0x1ab8a9,_0x22212c,_0x364394)=>{const _0x4d19c1=_0x5169d3;if(dbUserTable['doUserCanGet'](_0x1ab8a9,_0x22212c,_0x4d19c1(0x226),_0x4d19c1(0x284))==!![]){let _0x45c025=_0x1ab8a9['body'][_0x4d19c1(0x34d)],_0x526244=_0x1ab8a9['body'][_0x4d19c1(0x32d)],_0x1314fc=_0x1ab8a9['body'][_0x4d19c1(0x30d)],_0x423123=_0x1ab8a9[_0x4d19c1(0x255)][_0x4d19c1(0x237)];if(_0x45c025){_0x45c025=_0x45c025['trim']();let _0x186013=_0x1ab8a9['app']['dbFileIndex'][_0x4d19c1(0x2fb)](_0x4d19c1(0x2a0))[_0x4d19c1(0x344)](_0x45c025);_0x186013&&_0x186013['id']!=_0x1314fc?_0x1ab8a9[_0x4d19c1(0x2a8)]['dbFileIndex'][_0x4d19c1(0x2fb)](_0x4d19c1(0x2d9))['run'](_0x186013['id'],_0x1314fc):(_0x1ab8a9['app'][_0x4d19c1(0x251)]['prepare'](_0x4d19c1(0x326))[_0x4d19c1(0x2e8)](_0x45c025),_0x1ab8a9[_0x4d19c1(0x2a8)][_0x4d19c1(0x251)][_0x4d19c1(0x2fb)](_0x4d19c1(0x245))[_0x4d19c1(0x2e8)](_0x45c025,_0x1314fc));}if(parseInt(_0x526244)==0x0||parseInt(_0x526244)==0x1){if(_0x423123){let _0x27fe04=_0x4d19c1(0x23e);for(let _0x4400a9 in _0x423123){_0x27fe04+=_0x423123[_0x4400a9],_0x4400a9!=_0x423123[_0x4d19c1(0x328)]-0x1&&(_0x27fe04+=',');}_0x27fe04+=')';let _0x2ea871=_0x4d19c1(0x33c)+_0x27fe04;_0x1ab8a9[_0x4d19c1(0x2a8)][_0x4d19c1(0x251)][_0x4d19c1(0x2fb)](_0x2ea871)['run'](_0x526244);}else _0x1ab8a9[_0x4d19c1(0x2a8)][_0x4d19c1(0x251)][_0x4d19c1(0x2fb)](_0x4d19c1(0x25b))[_0x4d19c1(0x2e8)](_0x526244,_0x1314fc);}return _0x22212c[_0x4d19c1(0x2f7)]({'code':0x0});}}),router[_0x5169d3(0x1fb)](_0x5169d3(0x27a),(_0x4d6477,_0x405453,_0x178529)=>{const _0x5d1ce5=_0x5169d3;if(dbUserTable[_0x5d1ce5(0x298)](_0x4d6477,_0x405453,_0x5d1ce5(0x226),'power_change')==!![]){let _0x495eae=_0x4d6477[_0x5d1ce5(0x255)][_0x5d1ce5(0x237)];if(!_0x495eae||_0x495eae[_0x5d1ce5(0x328)]<0x2)return _0x4d6477[_0x5d1ce5(0x2a8)][_0x5d1ce5(0x259)](_0x405453,_0x405453['__'](_0x5d1ce5(0x315)));let _0xfb7d3e=_0x4d6477[_0x5d1ce5(0x2a8)][_0x5d1ce5(0x251)][_0x5d1ce5(0x2fb)](_0x5d1ce5(0x313))[_0x5d1ce5(0x344)](_0x495eae[0x0]);if(!_0xfb7d3e)return _0x4d6477[_0x5d1ce5(0x2a8)][_0x5d1ce5(0x259)](_0x405453,_0x405453['__'](_0x5d1ce5(0x317)));for(let _0x3f0e67=0x1;_0x3f0e67<_0x495eae[_0x5d1ce5(0x328)];_0x3f0e67++){let _0x36fd62=_0x495eae[_0x3f0e67];_0x4d6477[_0x5d1ce5(0x2a8)][_0x5d1ce5(0x251)][_0x5d1ce5(0x2fb)]('UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?\x20or\x20belong_face_id=?')['run'](_0xfb7d3e['id'],_0x36fd62,_0x36fd62);}return process[_0x5d1ce5(0x2a5)]({'type':_0x5d1ce5(0x1f1)}),_0x405453[_0x5d1ce5(0x2f7)]({'code':0x0});}}),router[_0x5169d3(0x344)](_0x5169d3(0x233),(_0x571424,_0x47592d,_0x590021)=>{const _0x1ebaf5=_0x5169d3;let _0x59ec49=_0x571424[_0x1ebaf5(0x312)][_0x1ebaf5(0x30d)];if(dbUserTable['doUserCanGet'](_0x571424,_0x47592d,_0x1ebaf5(0x226),'power_get')==!![]){let _0x4e3638=_0x571424[_0x1ebaf5(0x2a8)][_0x1ebaf5(0x251)][_0x1ebaf5(0x2fb)](_0x1ebaf5(0x270))[_0x1ebaf5(0x344)](_0x59ec49);if(!_0x4e3638)return _0x47592d['status'](0x194)[_0x1ebaf5(0x267)]();_0x571424[_0x1ebaf5(0x214)][_0x1ebaf5(0x263)]!=0x1?_0x27725c(![]):!_0x4e3638[_0x1ebaf5(0x200)]?_0x27725c(!![]):fs[_0x1ebaf5(0x28e)](_0x4e3638[_0x1ebaf5(0x200)],(_0x4507cd,_0x41daf5)=>{const _0x2beb39=_0x1ebaf5;if(!_0x4507cd){let _0x21b4e0=new Date()[_0x2beb39(0x2d5)](),_0x240cf8=0x48*0xe10*0x3e8;if(_0x41daf5['ctimeMs']){let _0x7667f1=_0x21b4e0-_0x41daf5['ctimeMs'];if(_0x7667f1>_0x240cf8)return _0x27725c(!![]);}return _0x47592d[_0x2beb39(0x2aa)](_0x4e3638[_0x2beb39(0x200)]);}_0x27725c(!![]);});function _0x27725c(_0x382621){const _0xfe8ee2=_0x1ebaf5;let _0x2290bc=dbFileIndexTable[_0xfe8ee2(0x1fd)](_0x571424[_0xfe8ee2(0x2a8)]['dbFileIndex'],_0x59ec49),_0x2dfa95='SELECT\x20f.*,a.id\x20as\x20f2id,a.width\x20as\x20f2width,a.height\x20as\x20f2height,a.x\x20as\x20f2x,a.y\x20as\x20f2y\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20photo_faces2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20a.photo_index_id=f.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20a.face_id\x20in\x20'+_0x2290bc+'\x20',_0x4c0226=[];if(_0x571424[_0xfe8ee2(0x214)]['is_admin']!=0x1){let _0x1ab38a=dbUserTable[_0xfe8ee2(0x210)](_0x571424,_0xfe8ee2(0x226),_0xfe8ee2(0x2d8),!![]);_0x2dfa95+=_0x1ab38a[_0xfe8ee2(0x299)],_0x4c0226=_0x4c0226[_0xfe8ee2(0x314)](_0x1ab38a['paramsList']);}let _0x242e82=_0x571424['app']['dbFileIndex'][_0xfe8ee2(0x2fb)](_0x2dfa95+_0xfe8ee2(0x2db))[_0xfe8ee2(0x344)](_0x4c0226);if(!_0x242e82){_0x242e82=_0x571424[_0xfe8ee2(0x2a8)][_0xfe8ee2(0x251)][_0xfe8ee2(0x2fb)](_0x2dfa95+_0xfe8ee2(0x268))['get'](_0x4c0226);if(!_0x242e82)return _0x47592d['status'](0x194)[_0xfe8ee2(0x267)]();}if(!_0x242e82)return _0x47592d[_0xfe8ee2(0x2e5)](0x194)[_0xfe8ee2(0x267)]();let _0x1e21c8=path['join'](_0x242e82[_0xfe8ee2(0x2ef)],_0x242e82[_0xfe8ee2(0x248)]);if(parseInt(_0x242e82[_0xfe8ee2(0x2cc)])==0x2){let _0x15fd72=config['getFileHashName'](_0x242e82),_0x3549ce=path[_0xfe8ee2(0x27d)](config[_0xfe8ee2(0x2c3)],_0x15fd72);sharpUtil['genTinyFile'](_0x1e21c8,path[_0xfe8ee2(0x2fa)](_0x3549ce),path[_0xfe8ee2(0x2a1)](_0x3549ce),'video',_0x242e82,_0x11d28a=>{_0x1e21c8=_0x3549ce,_0x43038d();},_0x100e67=>{const _0x50cbcf=_0xfe8ee2;return _0x47592d[_0x50cbcf(0x2e5)](0x194)['end']();});}else _0x43038d();function _0x43038d(){const _0x419c90=_0xfe8ee2;let _0x369c62=path[_0x419c90(0x27d)](config['facesPath'],_0x242e82[_0x419c90(0x219)]+new Date()[_0x419c90(0x2d5)]()+_0x419c90(0x1f0)),_0x109189=0x7d0;sharpUtil['transSpcielFormat'](_0x1e21c8,(_0x5762fc,_0xe04615,_0x297098)=>{const _0x7c9d4a=_0x419c90;let _0x58e5ca=parseInt(_0x242e82[_0x7c9d4a(0x285)]*1.4),_0x2fd2f0=parseInt(_0x242e82[_0x7c9d4a(0x225)]*1.4),_0x3433f3=parseInt(_0x242e82[_0x7c9d4a(0x254)]-_0x58e5ca*0.2),_0x22e540=parseInt(_0x242e82['f2y']-_0x2fd2f0*0.2);if(_0x22e540<0x0)_0x22e540=0x0;if(_0x3433f3<0x0)_0x3433f3=0x0;_0x50ed84(_0x5762fc,_0xe04615,_0x297098,_0x3433f3,_0x22e540,_0x58e5ca,_0x2fd2f0,()=>{const _0x4ae375=_0x7c9d4a;let _0x5a2c59=parseInt(_0x242e82[_0x4ae375(0x285)]),_0x55c7fe=parseInt(_0x242e82[_0x4ae375(0x225)]),_0x1ca6e8=parseInt(_0x242e82['f2x']),_0x49d5b7=parseInt(_0x242e82['f2y']);if(_0x49d5b7<0x0)_0x49d5b7=0x0;if(_0x1ca6e8<0x0)_0x1ca6e8=0x0;_0x50ed84(_0x5762fc,_0xe04615,_0x297098,_0x1ca6e8,_0x49d5b7,_0x5a2c59,_0x55c7fe);});});function _0x50ed84(_0x5d2ce6,_0x593a01,_0x964acc,_0x57108b,_0x112fe5,_0x52b547,_0x2e745d,_0x224553){const _0x16d934=_0x419c90;let _0x380794=sharpUtil[_0x16d934(0x282)](_0x5d2ce6),_0x4e307e=exifUtils[_0x16d934(0x2ed)](_0x964acc);_0x4e307e?_0x380794=_0x380794[_0x16d934(0x291)](_0x4e307e):_0x380794=_0x380794['rotate'](),_0x380794[_0x16d934(0x2de)]({'width':_0x109189,'height':_0x109189,'withoutEnlargement':!![]})[_0x16d934(0x2c9)]()[_0x16d934(0x2f0)]({'left':_0x57108b,'top':_0x112fe5,'width':_0x52b547,'height':_0x2e745d})['toFile'](_0x369c62,function(_0x1e7d99){const _0x47e27e=_0x16d934;if(_0x1e7d99){_0x593a01&&sharpUtil[_0x47e27e(0x22a)](_0x5d2ce6);if(_0x224553)_0x224553();else return _0x47592d['status'](0x194)[_0x47e27e(0x267)]();}else{_0x593a01&&sharpUtil[_0x47e27e(0x22a)](_0x5d2ce6);if(_0x382621)return _0x571424['app'][_0x47e27e(0x251)][_0x47e27e(0x2fb)](_0x47e27e(0x304)+_0x369c62+_0x47e27e(0x29a)+_0x59ec49)[_0x47e27e(0x2e8)](),_0x47592d[_0x47e27e(0x2aa)](_0x369c62);else _0x47592d['sendFile'](_0x369c62),_0x47592d['on'](_0x47e27e(0x27f),()=>{fs['rm'](_0x369c62,_0xd0b0bd=>{});});}});}}}}}),router[_0x5169d3(0x1fb)]('/switchFaceId',(_0x547012,_0x239f9e,_0x191b7b)=>{const _0x227383=_0x5169d3;let _0x300bba=_0x547012[_0x227383(0x255)][_0x227383(0x208)],_0x5da6f7=_0x547012[_0x227383(0x255)][_0x227383(0x20d)],_0x217c4d=[];if(!_0x300bba||!_0x5da6f7)return _0x239f9e[_0x227383(0x2f7)]({'code':0x0,'sucIdList':_0x217c4d});try{_0x5da6f7=JSON['parse'](_0x5da6f7);for(let _0x44249e in _0x5da6f7){let _0x312b42=_0x5da6f7[_0x44249e],_0x15a152=_0x547012[_0x227383(0x2a8)][_0x227383(0x251)][_0x227383(0x2fb)](_0x227383(0x2f5))['run'](parseInt(_0x300bba),parseInt(_0x312b42[_0x227383(0x27b)]),parseInt(_0x312b42['photo_index_id']));_0x217c4d[_0x227383(0x23b)](_0x312b42['photo_index_id']);}return _0x239f9e[_0x227383(0x2f7)]({'code':0x0,'sucIdList':_0x217c4d});}catch(_0x5e61c0){return console[_0x227383(0x24e)](_0x5e61c0),_0x239f9e[_0x227383(0x2f7)]({'code':0x0,'sucIdList':_0x217c4d});}}),router[_0x5169d3(0x1fb)]('/getAiDealState',(_0x559830,_0x5519b6,_0x43304d)=>{const _0x1ed93a=_0x5169d3;let _0x240f5a=_0x559830['body'][_0x1ed93a(0x2cc)],_0x346990={};if(_0x559830['currentUser'][_0x1ed93a(0x263)]==0x1){if(!_0x240f5a||_0x240f5a==_0x1ed93a(0x2c8)){let _0x4c0f72=_0x559830[_0x1ed93a(0x2a8)]['dbFileIndex'][_0x1ed93a(0x2fb)](_0x1ed93a(0x222))[_0x1ed93a(0x344)]();_0x346990['faceApiWaitDealCount']=_0x4c0f72[_0x1ed93a(0x30b)];if(_0x4c0f72['count']<0x1){let _0x53dcc0=_0x559830[_0x1ed93a(0x2a8)]['dbFileIndex'][_0x1ed93a(0x2fb)]('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20photo_faces2index\x20WHERE\x20compare_state=0')[_0x1ed93a(0x344)]();_0x346990['faceApiWaitCompareCount']=_0x53dcc0['count'];}}if(!_0x240f5a||_0x240f5a=='cocossd'){let _0x4eb3f4=_0x559830[_0x1ed93a(0x2a8)][_0x1ed93a(0x251)]['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_class_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27')[_0x1ed93a(0x344)]();_0x346990['cocossdWaitDealCount']=_0x4eb3f4[_0x1ed93a(0x30b)];}if(!_0x240f5a||_0x240f5a=='similar'){let _0x6b77fc=_0x559830[_0x1ed93a(0x2a8)][_0x1ed93a(0x251)][_0x1ed93a(0x2fb)](_0x1ed93a(0x279))[_0x1ed93a(0x344)]();_0x346990[_0x1ed93a(0x243)]=_0x6b77fc[_0x1ed93a(0x30b)];}}let _0x237cb6=dbConfigTable['findByTitle'](_0x559830[_0x1ed93a(0x2a8)]['dbOther'],'file_index_photo-indexing'),_0x33bb54=0x0;return!_0x237cb6?_0x33bb54=0x0:_0x33bb54=_0x237cb6['value'],_0x346990['isIndexing']=_0x33bb54,_0x5519b6[_0x1ed93a(0x2f7)]({'code':0x0,'data':_0x346990});}),router['post']('/resetFaceAi',(_0x3d724e,_0x1a916d,_0x27303d)=>{const _0x5e23d1=_0x5169d3;if(dbUserTable[_0x5e23d1(0x298)](_0x3d724e,_0x1a916d,_0x5e23d1(0x226),_0x5e23d1(0x284))==!![])try{fs['rm'](config[_0x5e23d1(0x29f)],{'recursive':!![]},_0x5dd00e=>{const _0x127dcf=_0x5e23d1;if(_0x5dd00e)return console[_0x127dcf(0x24e)](_0x5dd00e),_0x3d724e['app'][_0x127dcf(0x259)](_0x1a916d,_0x1a916d['__'](_0x127dcf(0x1f7))+':'+config[_0x127dcf(0x29f)],_0x127dcf(0x2fd));fs[_0x127dcf(0x2a4)](config[_0x127dcf(0x29f)],_0x5606c8=>{const _0x3a1531=_0x127dcf;if(_0x5606c8)return _0x3d724e[_0x3a1531(0x2a8)][_0x3a1531(0x259)](_0x1a916d,_0x1a916d['__'](_0x3a1531(0x317)),_0x3a1531(0x2fd));let _0x590e64=_0x3d724e[_0x3a1531(0x2a8)][_0x3a1531(0x251)][_0x3a1531(0x33d)](()=>{const _0x3bfad1=_0x3a1531;return _0x3d724e[_0x3bfad1(0x2a8)][_0x3bfad1(0x251)][_0x3bfad1(0x2fb)]('delete\x20from\x20photo_faces\x20where\x201=1')[_0x3bfad1(0x2e8)](),_0x3d724e[_0x3bfad1(0x2a8)][_0x3bfad1(0x251)][_0x3bfad1(0x2fb)](_0x3bfad1(0x207))[_0x3bfad1(0x2e8)](),_0x3d724e[_0x3bfad1(0x2a8)][_0x3bfad1(0x251)][_0x3bfad1(0x2fb)]('update\x20file_index_photo\x20set\x20ai_face_detect_state=0')[_0x3bfad1(0x2e8)](),process[_0x3bfad1(0x2a5)]({'type':_0x3bfad1(0x1f1)}),_0x1a916d[_0x3bfad1(0x2f7)]({'code':0x0});});_0x590e64();});});}catch(_0x1607c7){return _0x3d724e[_0x5e23d1(0x2a8)]['returnErrMsg'](_0x1a916d,_0x1a916d['__'](_0x5e23d1(0x317)),'dialog');}}),router['post'](_0x5169d3(0x349),(_0x30c267,_0x1b9b05,_0x4334e9)=>{const _0x572faf=_0x5169d3;if(dbUserTable[_0x572faf(0x298)](_0x30c267,_0x1b9b05,_0x572faf(0x226),'power_change')==!![])try{let _0x23da1f=_0x30c267[_0x572faf(0x2a8)][_0x572faf(0x251)]['transaction'](()=>{const _0x4346f4=_0x572faf;return _0x30c267[_0x4346f4(0x2a8)][_0x4346f4(0x251)]['prepare']('delete\x20from\x20photo_phash_similar\x20where\x201=1')['run'](),_0x30c267['app'][_0x4346f4(0x251)][_0x4346f4(0x2fb)](_0x4346f4(0x28a))['run'](),process[_0x4346f4(0x2a5)]({'type':'startSimilarPhotoWork'}),_0x1b9b05[_0x4346f4(0x2f7)]({'code':0x0});});_0x23da1f();}catch(_0x19dbfd){return _0x30c267[_0x572faf(0x2a8)][_0x572faf(0x259)](_0x1b9b05,_0x1b9b05['__'](_0x572faf(0x317)),_0x572faf(0x2fd));}}),router['post'](_0x5169d3(0x25c),(_0x4878fc,_0x5e5c7e,_0x4b097c)=>{const _0xf91762=_0x5169d3;if(dbUserTable[_0xf91762(0x2b8)](_0x4878fc,_0x5e5c7e)!==!![])return;let _0x2403e3=dbConfigTable[_0xf91762(0x2e3)](_0x4878fc[_0xf91762(0x2a8)]['dbOther'],_0xf91762(0x2c4));if(!_0x2403e3||_0x2403e3[_0xf91762(0x26f)]!='1')return _0x5e5c7e[_0xf91762(0x2f7)]({'code':0x0,'data':[],'enable':![]});let _0x24a846=_0x4878fc['body']['minIndexId'];if(!_0x24a846)_0x24a846=0x0;let _0x2d7a14=_0x4878fc[_0xf91762(0x255)][_0xf91762(0x30b)];if(!_0x2d7a14||_0x2d7a14>0x64)_0x2d7a14=0x64;let _0x4ee023=[],_0x31ef5c=_0x4878fc[_0xf91762(0x2a8)][_0xf91762(0x251)][_0xf91762(0x2fb)](_0xf91762(0x2ec))[_0xf91762(0x218)](),_0x9d2307=_0x4878fc[_0xf91762(0x2a8)]['dbFileIndex']['prepare']('SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id\x20limit\x20'+_0x2d7a14)[_0xf91762(0x218)]();for(let _0x1920a4 in _0x9d2307){let _0xa1dbcf=_0x9d2307[_0x1920a4],_0x3bc91e=_0x4878fc[_0xf91762(0x2a8)][_0xf91762(0x251)][_0xf91762(0x2fb)]('SELECT\x20id,path,filename,original_date,size\x20FROM\x20file_index_photo\x20where\x20id='+_0xa1dbcf[_0xf91762(0x274)])['get'](),_0x191659=_0x4878fc[_0xf91762(0x2a8)][_0xf91762(0x251)][_0xf91762(0x2fb)](_0xf91762(0x2a6)+_0xa1dbcf[_0xf91762(0x274)])[_0xf91762(0x218)]();_0x9d2307[_0x1920a4][_0xf91762(0x2ba)]=_0x3bc91e,_0x9d2307[_0x1920a4][_0xf91762(0x32c)]=[_0x3bc91e],_0x9d2307[_0x1920a4]['similarIndexList']['push'](..._0x191659),_0x9d2307[_0x1920a4][_0xf91762(0x32c)][_0xf91762(0x328)]>0x1?_0x4ee023[_0xf91762(0x23b)](_0x9d2307[_0x1920a4]):_0x4878fc[_0xf91762(0x2a8)][_0xf91762(0x251)][_0xf91762(0x2fb)](_0xf91762(0x276))[_0xf91762(0x2e8)](_0xa1dbcf[_0xf91762(0x274)]);}return _0x5e5c7e['json']({'code':0x0,'data':_0x4ee023,'enable':!![],'waitDealCount':_0x31ef5c[_0xf91762(0x328)]});}),router[_0x5169d3(0x1fb)](_0x5169d3(0x343),(_0x105e15,_0x30db06,_0x2beff6)=>{const _0x148eff=_0x5169d3;if(dbUserTable[_0x148eff(0x2b8)](_0x105e15,_0x30db06)!==!![])return;let _0xcc2db2=_0x105e15[_0x148eff(0x255)][_0x148eff(0x31a)];for(let _0x213a87 in _0xcc2db2){let _0xe954b7=_0x105e15[_0x148eff(0x2a8)][_0x148eff(0x251)]['prepare'](_0x148eff(0x336)+_0xcc2db2[_0x213a87][_0x148eff(0x274)])[_0x148eff(0x218)]();for(let _0x167679 in _0xe954b7){if(!_0xcc2db2[_0x213a87]['keepIndexList'][_0x148eff(0x2bf)](parseInt(_0xe954b7[_0x167679][_0x148eff(0x296)]))){let _0x2dc17a=new Date()[_0x148eff(0x2d5)]();_0x105e15[_0x148eff(0x2a8)]['dbFileIndex'][_0x148eff(0x2fb)](_0x148eff(0x333)+dbFileIndexTable[_0x148eff(0x2f9)]+_0x148eff(0x22c)+_0x2dc17a+_0x148eff(0x33b)+_0xe954b7[_0x167679]['similar_index_id'])[_0x148eff(0x2e8)]();}}if(!_0xcc2db2[_0x213a87][_0x148eff(0x244)][_0x148eff(0x2bf)](parseInt(_0xcc2db2[_0x213a87][_0x148eff(0x274)]))){let _0x9522ca=new Date()['getTime']();_0x105e15['app'][_0x148eff(0x251)]['prepare'](_0x148eff(0x333)+dbFileIndexTable[_0x148eff(0x2f9)]+'\x20SET\x20in_trash=1,in_trash_time='+_0x9522ca+_0x148eff(0x33b)+_0xcc2db2[_0x213a87][_0x148eff(0x274)])[_0x148eff(0x2e8)]();}_0x105e15[_0x148eff(0x2a8)][_0x148eff(0x251)][_0x148eff(0x2fb)](_0x148eff(0x22f)+_0xcc2db2[_0x213a87][_0x148eff(0x274)])[_0x148eff(0x2e8)]();}return _0x30db06[_0x148eff(0x2f7)]({'code':0x0});}),router['post'](_0x5169d3(0x26a),(_0x24d4ef,_0x37f3aa,_0x15eefe)=>{const _0x42f5c7=_0x5169d3;if(dbUserTable['doUserCanGet'](_0x24d4ef,_0x37f3aa,_0x42f5c7(0x226),'power_change','')==!![]){let _0x55c58b=_0x24d4ef[_0x42f5c7(0x2a8)][_0x42f5c7(0x251)][_0x42f5c7(0x2fb)]('SELECT\x20*\x20FROM\x20file_index_photo\x20WHERE\x20in_trash=1\x20AND\x20is_file=1\x20AND\x20raw_filename\x20is\x20not\x20null\x20AND\x20raw_filename!=\x27\x27\x20AND\x20type=1')[_0x42f5c7(0x218)]();for(let _0xd9d408 of _0x55c58b){_0x24d4ef[_0x42f5c7(0x2a8)][_0x42f5c7(0x251)][_0x42f5c7(0x2fb)]('UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?')[_0x42f5c7(0x2e8)](_0xd9d408['path'],_0xd9d408['raw_filename']);}return _0x24d4ef[_0x42f5c7(0x2a8)][_0x42f5c7(0x251)][_0x42f5c7(0x2fb)](_0x42f5c7(0x333)+dbFileIndexTable[_0x42f5c7(0x2f9)]+_0x42f5c7(0x2e4))[_0x42f5c7(0x2e8)](),_0x37f3aa[_0x42f5c7(0x2f7)]({'code':0x0});}}),router[_0x5169d3(0x1fb)]('/clearTrashBin',(_0x308060,_0x4b8a7d,_0x29b74d)=>{const _0x1eb82c=_0x5169d3;let _0x26a405=_0x308060[_0x1eb82c(0x255)][_0x1eb82c(0x28c)],_0x7ccb09=dbFileIndexTable['getAllByWhere'](_0x308060[_0x1eb82c(0x2a8)][_0x1eb82c(0x251)],_0x1eb82c(0x1f2),_0x1eb82c(0x271),dbFileIndexTable[_0x1eb82c(0x2f9)]),_0xe7733c=dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'];console['log'](_0x1eb82c(0x34a)+_0x7ccb09[_0x1eb82c(0x328)]);function _0x2e7b1f(_0x2d6695,_0x427f4d){const _0x598e7f=_0x1eb82c;dbFileOperationRecord['addFileOperationRecord'](_0x308060[_0x598e7f(0x2a8)][_0x598e7f(0x290)],{'username':_0x308060['currentUser']['username'],'targetPath':_0x2d6695,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x598e7f(0x25a)],'state':_0x427f4d?dbFileOperationRecord[_0x598e7f(0x2f3)]:dbFileOperationRecord[_0x598e7f(0x323)]});}function _0x5d719b(_0x5598d3){const _0xe18019=_0x1eb82c;if(_0x5598d3[_0xe18019(0x2b2)]==0x1&&_0x5598d3[_0xe18019(0x238)]==0x1){let _0x40e38a=path[_0xe18019(0x27d)](_0x5598d3[_0xe18019(0x2ef)],_0x5598d3[_0xe18019(0x248)][_0xe18019(0x20e)]('.MOV','')+'.HEIC');_0x5598d3[_0xe18019(0x248)]['endsWith'](_0xe18019(0x311))&&(_0x40e38a=path[_0xe18019(0x27d)](_0x5598d3['path'],_0x5598d3[_0xe18019(0x248)][_0xe18019(0x20e)](_0xe18019(0x311),'')+_0xe18019(0x33a))),fs['existsSync'](_0x40e38a)&&(console['log'](_0xe18019(0x2dc),_0x40e38a),_0x25fe51(_0x5598d3,_0x40e38a,![]));}}function _0x25fe51(_0x3fb830,_0x9cecc4,_0x143091){const _0x115bfa=_0x1eb82c;_0x26a405==0x1?(process[_0x115bfa(0x2a5)]({'type':'shell','shellType':_0x115bfa(0x1fa),'path':_0x9cecc4}),_0x2e7b1f(_0x9cecc4,!![])):fs['rm'](_0x9cecc4,{'recursive':!![]},_0x13ec27=>{_0x13ec27?_0x2e7b1f(_0x9cecc4,![]):_0x2e7b1f(_0x9cecc4,!![]);}),_0x143091&&_0x5d719b(_0x3fb830);}function _0x1efb62(_0x54e01c){const _0x48cd24=_0x1eb82c;dbFileIndexTable['delete'](_0x308060[_0x48cd24(0x2a8)][_0x48cd24(0x251)],_0x54e01c['id'],_0xe7733c);}for(let _0x18ed84 in _0x7ccb09){let _0x23d5e6=_0x7ccb09[_0x18ed84];if(_0x23d5e6){if(dbUserTable['doUserCanGet'](_0x308060,_0x4b8a7d,'photo','power_delete',_0x23d5e6[_0x1eb82c(0x2ef)])==!![]){let _0x1211ba=path[_0x1eb82c(0x27d)](_0x23d5e6[_0x1eb82c(0x2ef)],path[_0x1eb82c(0x26c)],_0x23d5e6[_0x1eb82c(0x248)]);_0x1efb62(_0x23d5e6),_0x25fe51(_0x23d5e6,_0x1211ba,!![]);}}}return _0x4b8a7d[_0x1eb82c(0x2f7)]({'code':0x0});}),router['post'](_0x5169d3(0x201),(_0x2714f1,_0x363b90,_0x2fd0f5)=>{const _0x8b72d7=_0x5169d3;let _0x1ae34a=_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x1f6)],_0x5ad1c4=_0x2714f1[_0x8b72d7(0x255)]['libraryId'],_0x289871=_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x347)],_0x40a790=_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x2b7)],_0x2dcae8=_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x20c)],_0x305b1f=_0x2714f1['body']['operation'];if(_0x305b1f==_0x8b72d7(0x278)){let _0xfd130c=_0x2714f1['body']['offset']||0x0,_0x251a50=_0x2714f1[_0x8b72d7(0x255)]['count']||0x32,_0x17638b=_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x256)]||'',_0x13b8cf=_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x206)]||_0x8b72d7(0x2ce),_0x308a15=_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x2cd)]||_0x8b72d7(0x337);if(![_0x8b72d7(0x2ce),_0x8b72d7(0x1f6)][_0x8b72d7(0x2bf)](_0x13b8cf))return console['log']('order\x20field\x20error',_0x13b8cf),[];let _0x6b29c2=[],_0x230022=[],_0x23405d=_0x8b72d7(0x250);_0x2714f1[_0x8b72d7(0x214)]['is_admin']==0x1?_0x17638b&&(_0x23405d+=_0x8b72d7(0x34b),_0x230022[_0x8b72d7(0x23b)]('%'+_0x17638b+'%')):(_0x23405d='SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20share_for_subuser=1',_0x17638b&&(_0x23405d+=_0x8b72d7(0x288),_0x230022[_0x8b72d7(0x23b)]('%'+_0x17638b+'%')));_0x23405d+=_0x8b72d7(0x319)+_0x13b8cf+'\x20'+_0x308a15+_0x8b72d7(0x21c),_0x230022['push'](_0x251a50),_0x230022[_0x8b72d7(0x23b)](_0xfd130c),_0x6b29c2=_0x2714f1[_0x8b72d7(0x2a8)]['dbFileIndex']['prepare'](_0x23405d)[_0x8b72d7(0x218)](_0x230022);if(_0x6b29c2[_0x8b72d7(0x328)]<0x1)return _0x363b90[_0x8b72d7(0x2f7)]({'code':0x0,'data':[]});for(let _0x4f917f in _0x6b29c2){let _0x50fdf=_0x6b29c2[_0x4f917f];try{let _0x8fb44f=JSON[_0x8b72d7(0x23c)](_0x50fdf[_0x8b72d7(0x2eb)]),_0x5acca2=[];for(let _0x4fc9f0 of _0x8fb44f){let _0x27a451=dbUserTable['findWithField'](_0x2714f1[_0x8b72d7(0x2a8)]['dbOther'],_0x4fc9f0,_0x8b72d7(0x273));_0x5acca2[_0x8b72d7(0x23b)](_0x27a451);}_0x6b29c2[_0x4f917f][_0x8b72d7(0x1f9)]=_0x5acca2;}catch(_0x56373a){console[_0x8b72d7(0x24e)](_0x56373a);}_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x30b)]=0x4,_0x2714f1[_0x8b72d7(0x255)]['excludeIds']=[],_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x2cb)]=0x0,_0x2714f1['body'][_0x8b72d7(0x27c)]=_0x8b72d7(0x2ad),_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x1ff)]=_0x8b72d7(0x337),_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x252)]=0x1,_0x2714f1['body']['timestamp']=0x9184e729fff,_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x1fa)]=0x0,_0x2714f1[_0x8b72d7(0x255)][_0x8b72d7(0x262)]=_0x6b29c2[_0x4f917f]['id'],_0x6b29c2[_0x4f917f][_0x8b72d7(0x34c)]=photoApiUtil['getPhotoByParams'](_0x2714f1,_0x363b90);}return _0x363b90['json']({'code':0x0,'data':_0x6b29c2});}else{if(_0x2714f1[_0x8b72d7(0x214)][_0x8b72d7(0x263)]!=0x1)return _0x2714f1[_0x8b72d7(0x2a8)][_0x8b72d7(0x259)](_0x363b90,_0x363b90['__'](_0x8b72d7(0x2b5)));if(_0x305b1f=='ADD'||_0x305b1f=='EDIT'){if(!_0x289871||!_0x289871 instanceof Array||_0x289871[_0x8b72d7(0x328)]<0x1)return _0x2714f1[_0x8b72d7(0x2a8)]['returnErrMsg'](_0x363b90,_0x363b90['__']('operationFail'));if(_0x2dcae8){if(_0x40a790!=null&&!_0x40a790 instanceof Array)return _0x2714f1[_0x8b72d7(0x2a8)][_0x8b72d7(0x259)](_0x363b90,_0x363b90['__'](_0x8b72d7(0x317)));}if(sqliteUtil[_0x8b72d7(0x203)](JSON[_0x8b72d7(0x318)](_0x289871))==!![])return _0x2714f1[_0x8b72d7(0x2a8)][_0x8b72d7(0x259)](_0x363b90,_0x8b72d7(0x29c));}if(_0x305b1f=='EDIT'&&_0x5ad1c4)_0x2714f1['app'][_0x8b72d7(0x251)]['prepare']('UPDATE\x20photo_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?')[_0x8b72d7(0x2e8)](_0x1ae34a,JSON[_0x8b72d7(0x318)](_0x289871),_0x2dcae8,JSON['stringify'](_0x40a790),_0x5ad1c4);else{if(_0x305b1f==_0x8b72d7(0x2c6)&&_0x5ad1c4)_0x2714f1['app']['dbFileIndex'][_0x8b72d7(0x2fb)]('DELETE\x20FROM\x20photo_library\x20\x20WHERE\x20id=?')[_0x8b72d7(0x2e8)](_0x5ad1c4);else{if(_0x305b1f==_0x8b72d7(0x22e))_0x2714f1[_0x8b72d7(0x2a8)][_0x8b72d7(0x251)][_0x8b72d7(0x2fb)](_0x8b72d7(0x2c2))[_0x8b72d7(0x2e8)](_0x1ae34a,JSON[_0x8b72d7(0x318)](_0x289871),_0x2dcae8,JSON['stringify'](_0x40a790),_0x2714f1['currentUser']['id']);else return _0x2714f1[_0x8b72d7(0x2a8)][_0x8b72d7(0x259)](_0x363b90,_0x363b90['__'](_0x8b72d7(0x2b5)));}}return _0x363b90['json']({'code':0x0});}}),module[_0x5169d3(0x2c1)]=router;