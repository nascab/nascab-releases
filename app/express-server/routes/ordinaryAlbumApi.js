function _0x3969(_0xeee217,_0x2691be){const _0x115f4d=_0x115f();return _0x3969=function(_0x39691e,_0x1aedee){_0x39691e=_0x39691e-0x12a;let _0x247866=_0x115f4d[_0x39691e];return _0x247866;},_0x3969(_0xeee217,_0x2691be);}const _0x4874b1=_0x3969;(function(_0x2d78ba,_0x20fb8c){const _0x213962=_0x3969,_0x1d72eb=_0x2d78ba();while(!![]){try{const _0x5bb9d2=-parseInt(_0x213962(0x16f))/0x1+parseInt(_0x213962(0x147))/0x2*(parseInt(_0x213962(0x168))/0x3)+-parseInt(_0x213962(0x133))/0x4+-parseInt(_0x213962(0x166))/0x5*(parseInt(_0x213962(0x141))/0x6)+parseInt(_0x213962(0x169))/0x7+parseInt(_0x213962(0x144))/0x8*(-parseInt(_0x213962(0x15a))/0x9)+parseInt(_0x213962(0x173))/0xa*(parseInt(_0x213962(0x170))/0xb);if(_0x5bb9d2===_0x20fb8c)break;else _0x1d72eb['push'](_0x1d72eb['shift']());}catch(_0x4eecf5){_0x1d72eb['push'](_0x1d72eb['shift']());}}}(_0x115f,0xb7d67));var express=require(_0x4874b1(0x13f)),router=express[_0x4874b1(0x130)]();const dbFileIndexTable=require(_0x4874b1(0x16d)),dbUserTable=require('../../db/dbUserTable'),dbOrdinaryAlbumTable=require(_0x4874b1(0x15e));router[_0x4874b1(0x167)](_0x4874b1(0x131),(_0x1c5c54,_0x237652,_0x4da358)=>{const _0x2888c6=_0x4874b1;if(dbUserTable['doUserCanGet'](_0x1c5c54,_0x237652,'photo',_0x2888c6(0x146))==!![]){let _0x2120b5=_0x1c5c54['body'][_0x2888c6(0x14a)],_0x339fb3=_0x1c5c54[_0x2888c6(0x148)]['parentPath'],_0x596e8b=_0x1c5c54[_0x2888c6(0x148)]['share'];_0x596e8b!='1'&&(_0x596e8b='0');let _0x1066bc=dbOrdinaryAlbumTable[_0x2888c6(0x161)](_0x1c5c54['app']['dbFileIndex'],_0x2120b5);if(_0x1066bc)return _0x1c5c54[_0x2888c6(0x159)][_0x2888c6(0x134)](_0x237652,_0x237652['__'](_0x2888c6(0x165)));let _0x2f6977=dbOrdinaryAlbumTable[_0x2888c6(0x15d)](_0x1c5c54[_0x2888c6(0x159)]['dbFileIndex'],{'name':_0x2120b5,'username':_0x1c5c54[_0x2888c6(0x171)][_0x2888c6(0x14e)],'share':_0x596e8b});if(_0x2f6977[_0x2888c6(0x132)]>0x0){if(_0x339fb3){let _0x32e000=_0x2f6977[_0x2888c6(0x154)];if(_0x32e000){let _0x15ffd1=dbFileIndexTable['getPathAll'](_0x1c5c54['app'][_0x2888c6(0x16b)],_0x339fb3,dbFileIndexTable[_0x2888c6(0x15c)],'id');for(let _0x235fc7 in _0x15ffd1){dbOrdinaryAlbumTable[_0x2888c6(0x143)](_0x1c5c54[_0x2888c6(0x159)][_0x2888c6(0x16b)],{'album_id':_0x32e000,'index_id':_0x15ffd1[_0x235fc7]['id']});}}}_0x237652[_0x2888c6(0x13a)]({'code':0x0,'result':_0x2f6977});}else _0x237652['json']({'code':0x1,'message':_0x2888c6(0x156)});}}),router[_0x4874b1(0x167)](_0x4874b1(0x137),(_0x159ff3,_0x495493,_0xdf477c)=>{const _0x1f30da=_0x4874b1;let _0x10da7b=_0x159ff3['body']['id'],_0x3a39b7=dbOrdinaryAlbumTable['getById'](_0x159ff3[_0x1f30da(0x159)][_0x1f30da(0x16b)],_0x10da7b);if(!_0x3a39b7)return _0x159ff3[_0x1f30da(0x159)][_0x1f30da(0x134)](_0x495493,_0x1f30da(0x16a));if(_0x3a39b7[_0x1f30da(0x14e)]==_0x159ff3[_0x1f30da(0x171)][_0x1f30da(0x14e)]||dbUserTable[_0x1f30da(0x162)](_0x159ff3,_0x495493,_0x1f30da(0x12e),'power_delete')==!![]){let _0x498753=dbOrdinaryAlbumTable[_0x1f30da(0x14d)](_0x159ff3[_0x1f30da(0x159)][_0x1f30da(0x16b)],_0x10da7b);_0x498753[_0x1f30da(0x132)]>0x0?_0x495493['json']({'code':0x0,'result':_0x498753}):_0x495493[_0x1f30da(0x13a)]({'code':0x1,'message':_0x1f30da(0x156)});}}),router[_0x4874b1(0x167)]('/updateAlbum',(_0x29969c,_0x26ab14,_0x5a9135)=>{const _0x47674b=_0x4874b1;let _0x289052=_0x29969c[_0x47674b(0x148)]['id'],_0x541ac8=dbOrdinaryAlbumTable[_0x47674b(0x163)](_0x29969c[_0x47674b(0x159)]['dbFileIndex'],_0x289052);if(!_0x541ac8)return _0x29969c[_0x47674b(0x159)][_0x47674b(0x134)](_0x26ab14,_0x47674b(0x16a));if(_0x541ac8[_0x47674b(0x14e)]==_0x29969c['currentUser'][_0x47674b(0x14e)]||dbUserTable[_0x47674b(0x162)](_0x29969c,_0x26ab14,_0x47674b(0x12e),'power_change')==!![]){let _0x3b4055=_0x29969c[_0x47674b(0x148)][_0x47674b(0x14a)],_0xcc1c50=_0x29969c[_0x47674b(0x148)][_0x47674b(0x16c)];_0xcc1c50!='1'&&(_0xcc1c50='0');let _0x3028d1=dbOrdinaryAlbumTable[_0x47674b(0x175)](_0x29969c[_0x47674b(0x159)][_0x47674b(0x16b)],_0x289052,_0x3b4055,_0xcc1c50);_0x3028d1['changes']>0x0?_0x26ab14[_0x47674b(0x13a)]({'code':0x0,'result':_0x3028d1}):_0x26ab14['json']({'code':0x1,'message':_0x47674b(0x156)});}}),router['post'](_0x4874b1(0x158),(_0x41d1b8,_0x3f56ad,_0x145c6a)=>{const _0x27e233=_0x4874b1;if(dbUserTable[_0x27e233(0x162)](_0x41d1b8,_0x3f56ad,_0x27e233(0x12e),_0x27e233(0x172))==!![]){let _0x228d7e=dbUserTable[_0x27e233(0x149)](_0x41d1b8,_0x27e233(0x12e),_0x27e233(0x172),!![]),_0x5d25bc=_0x41d1b8[_0x27e233(0x148)]['count']||0x14,_0x5b4b31=_0x41d1b8[_0x27e233(0x148)][_0x27e233(0x14b)]||0x0,_0x47de99=_0x41d1b8['body'][_0x27e233(0x136)]||'id',_0x25ba05=_0x41d1b8[_0x27e233(0x148)][_0x27e233(0x157)]||_0x27e233(0x140),_0x5bad8c=_0x41d1b8[_0x27e233(0x148)][_0x27e233(0x15b)];(![_0x27e233(0x14a),'id'][_0x27e233(0x13e)](_0x47de99)||![_0x27e233(0x12d),_0x27e233(0x140)]['includes'](_0x25ba05))&&_0x3f56ad[_0x27e233(0x13a)]({'code':0x0,'data':[]});let _0x1637aa=dbOrdinaryAlbumTable[_0x27e233(0x16e)](_0x41d1b8[_0x27e233(0x159)][_0x27e233(0x16b)],_0x5d25bc,_0x5b4b31,_0x47de99,_0x25ba05,_0x5bad8c),_0xea396c=_0x1637aa;if(_0x41d1b8[_0x27e233(0x171)][_0x27e233(0x13c)]!=0x1){_0xea396c=[];for(let _0x10d3e1=0x0;_0x10d3e1<_0x1637aa[_0x27e233(0x150)];_0x10d3e1++){let _0x476470=_0x1637aa[_0x10d3e1];(_0x476470[_0x27e233(0x16c)]==0x1||_0x476470['username']==_0x41d1b8[_0x27e233(0x171)]['username'])&&_0xea396c['push'](_0x476470);}}for(let _0x253b62=0x0;_0x253b62<_0xea396c[_0x27e233(0x150)];_0x253b62++){let _0x138ee7=_0x27e233(0x14f);_0x138ee7+=_0x228d7e[_0x27e233(0x152)];let _0x4208d5=[..._0x228d7e[_0x27e233(0x176)]],_0x25877b=dbOrdinaryAlbumTable[_0x27e233(0x160)](_0x41d1b8[_0x27e233(0x159)][_0x27e233(0x16b)],_0x27e233(0x12a),[_0xea396c[_0x253b62]['id']]);!_0x25877b&&(_0x25877b=dbOrdinaryAlbumTable['getIndexByWhere'](_0x41d1b8[_0x27e233(0x159)][_0x27e233(0x16b)],_0x27e233(0x135),[_0xea396c[_0x253b62]['id']]));if(_0x25877b){let _0x34ef61=dbFileIndexTable[_0x27e233(0x163)](_0x41d1b8[_0x27e233(0x159)][_0x27e233(0x16b)],_0x25877b['index_id']);_0x34ef61&&_0x34ef61[_0x27e233(0x139)]!=0x1&&(_0x138ee7+=_0x27e233(0x138),_0x4208d5['push'](parseInt(_0x25877b[_0x27e233(0x142)])));}else{_0xea396c[_0x253b62][_0x27e233(0x15f)]=[];continue;}_0x138ee7+='\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0',_0x138ee7+=_0x27e233(0x14c);let _0xfd43bd=dbFileIndexTable['getAllByWhere'](_0x41d1b8[_0x27e233(0x159)]['dbFileIndex'],_0x138ee7,'*',dbFileIndexTable[_0x27e233(0x15c)],_0x4208d5);_0xea396c[_0x253b62][_0x27e233(0x15f)]=_0xfd43bd;}_0x3f56ad[_0x27e233(0x13a)]({'code':0x0,'data':_0xea396c});}}),router[_0x4874b1(0x167)](_0x4874b1(0x155),(_0x4dd5c4,_0xd74121,_0x1a688)=>{const _0xad0163=_0x4874b1;if(dbUserTable[_0xad0163(0x162)](_0x4dd5c4,_0xd74121,_0xad0163(0x12e),_0xad0163(0x146))==!![]){let _0x4807bf=_0x4dd5c4[_0xad0163(0x148)][_0xad0163(0x12c)],_0x16a7b7=_0x4dd5c4[_0xad0163(0x148)][_0xad0163(0x12b)],_0x4428fd=dbOrdinaryAlbumTable['getById'](_0x4dd5c4[_0xad0163(0x159)][_0xad0163(0x16b)],_0x16a7b7);if(!_0x4428fd)return _0xd74121[_0xad0163(0x164)](0x194)[_0xad0163(0x145)]();let _0x51d50e=0x0;if(_0x4807bf&&_0x4807bf[_0xad0163(0x150)]>0x0)for(let _0x56d381=0x0;_0x56d381<_0x4807bf[_0xad0163(0x150)];_0x56d381++){let _0x10f211=_0x4807bf[_0x56d381],_0xdd8cf4=dbFileIndexTable[_0xad0163(0x163)](_0x4dd5c4[_0xad0163(0x159)][_0xad0163(0x16b)],_0x10f211);if(!_0xdd8cf4)continue;let _0x8fa937=dbOrdinaryAlbumTable['addIndexToAlbum'](_0x4dd5c4[_0xad0163(0x159)]['dbFileIndex'],{'album_id':_0x16a7b7,'index_id':_0x10f211});_0x8fa937['changes']>0x0&&(_0x51d50e+=0x1);}_0xd74121[_0xad0163(0x13a)]({'code':0x0,'sucCount':_0x51d50e});}}),router['post']('/deleteFromAlbum',(_0x2a4c9e,_0x121c9b,_0x1e122a)=>{const _0x9ff757=_0x4874b1;if(dbUserTable[_0x9ff757(0x162)](_0x2a4c9e,_0x121c9b,_0x9ff757(0x12e),_0x9ff757(0x151))==!![]){let _0x38a1ce=_0x2a4c9e['body'][_0x9ff757(0x12c)],_0x37b868=_0x2a4c9e[_0x9ff757(0x148)][_0x9ff757(0x12b)],_0x8a3f8d=dbOrdinaryAlbumTable[_0x9ff757(0x163)](_0x2a4c9e[_0x9ff757(0x159)][_0x9ff757(0x16b)],_0x37b868);if(!_0x8a3f8d)return _0x121c9b[_0x9ff757(0x13a)]({'code':0x1,'message':_0x9ff757(0x12f)});if(_0x38a1ce&&_0x38a1ce[_0x9ff757(0x150)]>0x0){let _0x32ca70='(';for(let _0x4b9bed=0x0;_0x4b9bed<_0x38a1ce[_0x9ff757(0x150)];_0x4b9bed++){let _0x555e6e=_0x38a1ce[_0x4b9bed],_0x46cece=dbFileIndexTable['getById'](_0x2a4c9e[_0x9ff757(0x159)][_0x9ff757(0x16b)],_0x555e6e);if(!_0x46cece)continue;_0x32ca70+=_0x555e6e,_0x4b9bed!=_0x38a1ce[_0x9ff757(0x150)]-0x1&&(_0x32ca70+=',');}_0x32ca70+=')';let _0x3bd9ae=dbOrdinaryAlbumTable[_0x9ff757(0x153)](_0x2a4c9e[_0x9ff757(0x159)]['dbFileIndex'],_0x37b868,_0x32ca70);_0x121c9b[_0x9ff757(0x13a)]({'code':0x0,'sucCount':_0x3bd9ae[_0x9ff757(0x132)]});}else _0x121c9b[_0x9ff757(0x13a)]({'code':0x0,'sucCount':0x0});}}),router[_0x4874b1(0x167)]('/setAlbumCover',(_0x3a46aa,_0x5992cd,_0x1e4db9)=>{const _0x18726b=_0x4874b1;if(dbUserTable[_0x18726b(0x162)](_0x3a46aa,_0x5992cd,_0x18726b(0x12e),'power_change')==!![]){let _0x341a48=_0x3a46aa['body'][_0x18726b(0x13d)],_0xddc252=_0x3a46aa['body']['albumId'],_0x10d38e=dbOrdinaryAlbumTable[_0x18726b(0x163)](_0x3a46aa[_0x18726b(0x159)]['dbFileIndex'],_0xddc252);if(!_0x10d38e)return _0x5992cd[_0x18726b(0x13a)]({'code':0x1,'message':_0x18726b(0x12f)});let _0x185f21=dbFileIndexTable[_0x18726b(0x163)](_0x3a46aa[_0x18726b(0x159)][_0x18726b(0x16b)],_0x341a48);if(!_0x185f21)return _0x5992cd[_0x18726b(0x13a)]({'code':0x1,'message':'index\x20id\x20invalid'});return dbOrdinaryAlbumTable[_0x18726b(0x174)](_0x3a46aa[_0x18726b(0x159)]['dbFileIndex'],_0xddc252,_0x341a48),_0x5992cd[_0x18726b(0x13a)]({'code':0x0});}}),module[_0x4874b1(0x13b)]=router;function _0x115f(){const _0x5ace6a=['indexId','includes','express','desc','62862jCNqlh','index_id','addIndexToAlbum','70440zLARIn','end','power_add','158MrsThx','body','getUserPathWhere','name','offset','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','delete','username','\x20\x20is_file=1\x20','length','power_delete','whereStr','deleteIndexFromAlbum','lastInsertRowid','/addToAlbum','operation\x20fail','orderType','/getAllAlbum','app','63rGtrXz','search','INDEX_TABLE_NAME_PHOTO','create','../../db/dbOrdinaryAlbumTable','imgList','getIndexByWhere','getByName','doUserCanGet','getById','status','album.sameNameExist','85ssLSPC','post','38034VxvDHd','8231034wvepFu','id\x20not\x20exist','dbFileIndex','share','../../db/dbFileIndexTable','getList','1199696PipMhn','22033twLSxf','currentUser','power_get','6190Llhkyk','udpateCover','udpateName','paramsList','\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201','albumId','indexIdArr','asc','photo','album\x20id\x20invalid','Router','/addAlbum','changes','4899368sZTkVc','returnErrMsg','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','orderField','/deleteAlbum','\x20AND\x20id=?','in_trash','json','exports','is_admin'];_0x115f=function(){return _0x5ace6a;};return _0x115f();}