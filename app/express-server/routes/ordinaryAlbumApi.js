function _0x5835(_0x2a6ed2,_0x420438){const _0x2f4cb7=_0x2f4c();return _0x5835=function(_0x583577,_0x2f1ddc){_0x583577=_0x583577-0x1d7;let _0x132f1b=_0x2f4cb7[_0x583577];return _0x132f1b;},_0x5835(_0x2a6ed2,_0x420438);}const _0x5adf32=_0x5835;(function(_0x35cce1,_0x4b4a10){const _0x3190a3=_0x5835,_0x4d2bfe=_0x35cce1();while(!![]){try{const _0x3dc7bb=parseInt(_0x3190a3(0x1ec))/0x1+-parseInt(_0x3190a3(0x1d7))/0x2+parseInt(_0x3190a3(0x1ff))/0x3*(parseInt(_0x3190a3(0x1ee))/0x4)+-parseInt(_0x3190a3(0x1e1))/0x5*(parseInt(_0x3190a3(0x200))/0x6)+parseInt(_0x3190a3(0x202))/0x7+-parseInt(_0x3190a3(0x209))/0x8*(parseInt(_0x3190a3(0x1fc))/0x9)+-parseInt(_0x3190a3(0x1fa))/0xa*(-parseInt(_0x3190a3(0x1da))/0xb);if(_0x3dc7bb===_0x4b4a10)break;else _0x4d2bfe['push'](_0x4d2bfe['shift']());}catch(_0x362346){_0x4d2bfe['push'](_0x4d2bfe['shift']());}}}(_0x2f4c,0x241a1));var express=require(_0x5adf32(0x1f3)),router=express[_0x5adf32(0x222)]();function _0x2f4c(){const _0x4810a1=['changes','912513KKkTYx','\x20\x20is_file=1\x20','getByName','udpateCover','is_admin','orderType','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','960392qtFGIm','index_id','../../db/dbFileIndexTable','power_delete','index\x20id\x20invalid','includes','parentPath','username','exports','indexIdArr','whereStr','length','returnErrMsg','deleteIndexFromAlbum','dbFileIndex','asc','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','status','push','desc','album\x20id\x20invalid','doUserCanGet','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','power_add','addIndexToAlbum','Router','/addToAlbum','276330cBtJzg','paramsList','share','10648qJihnt','json','create','/getAllAlbum','../../db/dbOrdinaryAlbumTable','\x20AND\x20id=?','albumId','30935gzJPyx','getById','search','in_trash','power_change','/deleteAlbum','album.sameNameExist','post','offset','power_get','currentUser','201964AxXBRN','udpateName','3352GCdysJ','id\x20not\x20exist','INDEX_TABLE_NAME_PHOTO','/setAlbumCover','/addAlbum','express','/updateAlbum','end','photo','operation\x20fail','delete','app','970WdNbka','indexId','9luNwlI','body','name','681zrRJNk','204HDnkNe'];_0x2f4c=function(){return _0x4810a1;};return _0x2f4c();}const dbFileIndexTable=require(_0x5adf32(0x20b)),dbUserTable=require('../../db/dbUserTable'),dbOrdinaryAlbumTable=require(_0x5adf32(0x1de));router[_0x5adf32(0x1e8)](_0x5adf32(0x1f2),(_0x2a95ad,_0x174feb,_0x478394)=>{const _0x4687c1=_0x5adf32;if(dbUserTable[_0x4687c1(0x21e)](_0x2a95ad,_0x174feb,'photo','power_add')==!![]){let _0x5202c2=_0x2a95ad[_0x4687c1(0x1fd)]['name'],_0x196937=_0x2a95ad['body'][_0x4687c1(0x20f)],_0x260f30=_0x2a95ad[_0x4687c1(0x1fd)][_0x4687c1(0x1d9)];_0x260f30!='1'&&(_0x260f30='0');let _0x1ef823=dbOrdinaryAlbumTable[_0x4687c1(0x204)](_0x2a95ad['app'][_0x4687c1(0x217)],_0x5202c2);if(_0x1ef823)return _0x2a95ad[_0x4687c1(0x1f9)][_0x4687c1(0x215)](_0x174feb,_0x174feb['__'](_0x4687c1(0x1e7)));let _0x45527d=dbOrdinaryAlbumTable[_0x4687c1(0x1dc)](_0x2a95ad[_0x4687c1(0x1f9)]['dbFileIndex'],{'name':_0x5202c2,'username':_0x2a95ad[_0x4687c1(0x1eb)][_0x4687c1(0x210)],'share':_0x260f30});if(_0x45527d[_0x4687c1(0x201)]>0x0){if(_0x196937){let _0x1ce789=_0x45527d['lastInsertRowid'];if(_0x1ce789){let _0x32c514=dbFileIndexTable['getPathAll'](_0x2a95ad[_0x4687c1(0x1f9)][_0x4687c1(0x217)],_0x196937,dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],'id');for(let _0x11aade in _0x32c514){dbOrdinaryAlbumTable[_0x4687c1(0x221)](_0x2a95ad[_0x4687c1(0x1f9)]['dbFileIndex'],{'album_id':_0x1ce789,'index_id':_0x32c514[_0x11aade]['id']});}}}_0x174feb[_0x4687c1(0x1db)]({'code':0x0,'result':_0x45527d});}else _0x174feb[_0x4687c1(0x1db)]({'code':0x1,'message':_0x4687c1(0x1f7)});}}),router['post'](_0x5adf32(0x1e6),(_0x121b5d,_0x13d7e3,_0x5812ef)=>{const _0x174755=_0x5adf32;let _0x29d6a6=_0x121b5d[_0x174755(0x1fd)]['id'],_0x2a8bc9=dbOrdinaryAlbumTable[_0x174755(0x1e2)](_0x121b5d['app']['dbFileIndex'],_0x29d6a6);if(!_0x2a8bc9)return _0x121b5d[_0x174755(0x1f9)]['returnErrMsg'](_0x13d7e3,'id\x20not\x20exist');if(_0x2a8bc9[_0x174755(0x210)]==_0x121b5d[_0x174755(0x1eb)]['username']||dbUserTable[_0x174755(0x21e)](_0x121b5d,_0x13d7e3,_0x174755(0x1f6),_0x174755(0x20c))==!![]){let _0x4ea781=dbOrdinaryAlbumTable[_0x174755(0x1f8)](_0x121b5d['app'][_0x174755(0x217)],_0x29d6a6);_0x4ea781[_0x174755(0x201)]>0x0?_0x13d7e3[_0x174755(0x1db)]({'code':0x0,'result':_0x4ea781}):_0x13d7e3[_0x174755(0x1db)]({'code':0x1,'message':_0x174755(0x1f7)});}}),router[_0x5adf32(0x1e8)](_0x5adf32(0x1f4),(_0xf47061,_0x2a0770,_0xb41141)=>{const _0x2a9692=_0x5adf32;let _0x54be81=_0xf47061['body']['id'],_0x5dd8b4=dbOrdinaryAlbumTable[_0x2a9692(0x1e2)](_0xf47061[_0x2a9692(0x1f9)][_0x2a9692(0x217)],_0x54be81);if(!_0x5dd8b4)return _0xf47061['app'][_0x2a9692(0x215)](_0x2a0770,_0x2a9692(0x1ef));if(_0x5dd8b4[_0x2a9692(0x210)]==_0xf47061[_0x2a9692(0x1eb)]['username']||dbUserTable[_0x2a9692(0x21e)](_0xf47061,_0x2a0770,_0x2a9692(0x1f6),'power_change')==!![]){let _0x300290=_0xf47061['body']['name'],_0x372ebb=_0xf47061[_0x2a9692(0x1fd)][_0x2a9692(0x1d9)];_0x372ebb!='1'&&(_0x372ebb='0');let _0x34be44=dbOrdinaryAlbumTable[_0x2a9692(0x1ed)](_0xf47061['app'][_0x2a9692(0x217)],_0x54be81,_0x300290,_0x372ebb);_0x34be44[_0x2a9692(0x201)]>0x0?_0x2a0770[_0x2a9692(0x1db)]({'code':0x0,'result':_0x34be44}):_0x2a0770[_0x2a9692(0x1db)]({'code':0x1,'message':_0x2a9692(0x1f7)});}}),router[_0x5adf32(0x1e8)](_0x5adf32(0x1dd),(_0x1bb2e6,_0x3e5f38,_0x4b08c6)=>{const _0x5d4df6=_0x5adf32;if(dbUserTable[_0x5d4df6(0x21e)](_0x1bb2e6,_0x3e5f38,_0x5d4df6(0x1f6),_0x5d4df6(0x1ea))==!![]){let _0x5d2182=dbUserTable['getUserPathWhere'](_0x1bb2e6,'photo',_0x5d4df6(0x1ea),!![]),_0x2cd5f7=_0x1bb2e6[_0x5d4df6(0x1fd)]['count']||0x14,_0x5bb4ef=_0x1bb2e6[_0x5d4df6(0x1fd)][_0x5d4df6(0x1e9)]||0x0,_0x26ca01=_0x1bb2e6[_0x5d4df6(0x1fd)]['orderField']||'id',_0x20291f=_0x1bb2e6[_0x5d4df6(0x1fd)][_0x5d4df6(0x207)]||'desc',_0x48cabe=_0x1bb2e6['body'][_0x5d4df6(0x1e3)];(![_0x5d4df6(0x1fe),'id']['includes'](_0x26ca01)||![_0x5d4df6(0x218),_0x5d4df6(0x21c)][_0x5d4df6(0x20e)](_0x20291f))&&_0x3e5f38[_0x5d4df6(0x1db)]({'code':0x0,'data':[]});let _0x556841=dbOrdinaryAlbumTable['getList'](_0x1bb2e6['app'][_0x5d4df6(0x217)],_0x2cd5f7,_0x5bb4ef,_0x26ca01,_0x20291f,_0x48cabe),_0x4428b4=_0x556841;if(_0x1bb2e6[_0x5d4df6(0x1eb)][_0x5d4df6(0x206)]!=0x1){_0x4428b4=[];for(let _0x23fb16=0x0;_0x23fb16<_0x556841[_0x5d4df6(0x214)];_0x23fb16++){let _0x541433=_0x556841[_0x23fb16];(_0x541433[_0x5d4df6(0x1d9)]==0x1||_0x541433['username']==_0x1bb2e6[_0x5d4df6(0x1eb)]['username'])&&_0x4428b4[_0x5d4df6(0x21b)](_0x541433);}}for(let _0x1e54f1=0x0;_0x1e54f1<_0x4428b4[_0x5d4df6(0x214)];_0x1e54f1++){let _0x478c8e=_0x5d4df6(0x203);_0x478c8e+=_0x5d2182[_0x5d4df6(0x213)];let _0x15c62f=[..._0x5d2182[_0x5d4df6(0x1d8)]],_0x5f2b3f=dbOrdinaryAlbumTable['getIndexByWhere'](_0x1bb2e6['app'][_0x5d4df6(0x217)],'\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201',[_0x4428b4[_0x1e54f1]['id']]);!_0x5f2b3f&&(_0x5f2b3f=dbOrdinaryAlbumTable['getIndexByWhere'](_0x1bb2e6[_0x5d4df6(0x1f9)][_0x5d4df6(0x217)],_0x5d4df6(0x219),[_0x4428b4[_0x1e54f1]['id']]));if(_0x5f2b3f){let _0x5a6cf7=dbFileIndexTable[_0x5d4df6(0x1e2)](_0x1bb2e6[_0x5d4df6(0x1f9)][_0x5d4df6(0x217)],_0x5f2b3f[_0x5d4df6(0x20a)]);_0x5a6cf7&&_0x5a6cf7[_0x5d4df6(0x1e4)]!=0x1&&(_0x478c8e+=_0x5d4df6(0x1df),_0x15c62f[_0x5d4df6(0x21b)](parseInt(_0x5f2b3f[_0x5d4df6(0x20a)])));}else{_0x4428b4[_0x1e54f1]['imgList']=[];continue;}_0x478c8e+=_0x5d4df6(0x208),_0x478c8e+=_0x5d4df6(0x21f);let _0x1697f7=dbFileIndexTable['getAllByWhere'](_0x1bb2e6[_0x5d4df6(0x1f9)]['dbFileIndex'],_0x478c8e,'*',dbFileIndexTable[_0x5d4df6(0x1f0)],_0x15c62f);_0x4428b4[_0x1e54f1]['imgList']=_0x1697f7;}_0x3e5f38['json']({'code':0x0,'data':_0x4428b4});}}),router[_0x5adf32(0x1e8)](_0x5adf32(0x223),(_0x4448da,_0x2f8895,_0x5b82bf)=>{const _0x3e81e7=_0x5adf32;if(dbUserTable[_0x3e81e7(0x21e)](_0x4448da,_0x2f8895,'photo',_0x3e81e7(0x220))==!![]){let _0x2cc674=_0x4448da['body'][_0x3e81e7(0x212)],_0x237144=_0x4448da[_0x3e81e7(0x1fd)]['albumId'],_0x31c996=dbOrdinaryAlbumTable[_0x3e81e7(0x1e2)](_0x4448da[_0x3e81e7(0x1f9)][_0x3e81e7(0x217)],_0x237144);if(!_0x31c996)return _0x2f8895[_0x3e81e7(0x21a)](0x194)[_0x3e81e7(0x1f5)]();let _0x34a5ca=0x0;if(_0x2cc674&&_0x2cc674['length']>0x0)for(let _0x887d90=0x0;_0x887d90<_0x2cc674[_0x3e81e7(0x214)];_0x887d90++){let _0x402fd8=_0x2cc674[_0x887d90],_0x816487=dbFileIndexTable[_0x3e81e7(0x1e2)](_0x4448da[_0x3e81e7(0x1f9)][_0x3e81e7(0x217)],_0x402fd8);if(!_0x816487)continue;let _0xd1977f=dbOrdinaryAlbumTable[_0x3e81e7(0x221)](_0x4448da[_0x3e81e7(0x1f9)][_0x3e81e7(0x217)],{'album_id':_0x237144,'index_id':_0x402fd8});_0xd1977f[_0x3e81e7(0x201)]>0x0&&(_0x34a5ca+=0x1);}_0x2f8895[_0x3e81e7(0x1db)]({'code':0x0,'sucCount':_0x34a5ca});}}),router[_0x5adf32(0x1e8)]('/deleteFromAlbum',(_0x4d4a81,_0x3eb9f2,_0x48fc1a)=>{const _0x510e76=_0x5adf32;if(dbUserTable[_0x510e76(0x21e)](_0x4d4a81,_0x3eb9f2,_0x510e76(0x1f6),'power_delete')==!![]){let _0x316725=_0x4d4a81[_0x510e76(0x1fd)]['indexIdArr'],_0x3dafa7=_0x4d4a81[_0x510e76(0x1fd)][_0x510e76(0x1e0)],_0x5d21ea=dbOrdinaryAlbumTable[_0x510e76(0x1e2)](_0x4d4a81[_0x510e76(0x1f9)][_0x510e76(0x217)],_0x3dafa7);if(!_0x5d21ea)return _0x3eb9f2[_0x510e76(0x1db)]({'code':0x1,'message':_0x510e76(0x21d)});if(_0x316725&&_0x316725['length']>0x0){let _0x2b336e='(';for(let _0x1e93cd=0x0;_0x1e93cd<_0x316725[_0x510e76(0x214)];_0x1e93cd++){let _0x266c36=_0x316725[_0x1e93cd],_0x317db7=dbFileIndexTable[_0x510e76(0x1e2)](_0x4d4a81[_0x510e76(0x1f9)][_0x510e76(0x217)],_0x266c36);if(!_0x317db7)continue;_0x2b336e+=_0x266c36,_0x1e93cd!=_0x316725[_0x510e76(0x214)]-0x1&&(_0x2b336e+=',');}_0x2b336e+=')';let _0x1625a4=dbOrdinaryAlbumTable[_0x510e76(0x216)](_0x4d4a81[_0x510e76(0x1f9)][_0x510e76(0x217)],_0x3dafa7,_0x2b336e);_0x3eb9f2[_0x510e76(0x1db)]({'code':0x0,'sucCount':_0x1625a4[_0x510e76(0x201)]});}else _0x3eb9f2[_0x510e76(0x1db)]({'code':0x0,'sucCount':0x0});}}),router[_0x5adf32(0x1e8)](_0x5adf32(0x1f1),(_0x5e19ca,_0x24ae00,_0x52217c)=>{const _0x2f75f9=_0x5adf32;if(dbUserTable[_0x2f75f9(0x21e)](_0x5e19ca,_0x24ae00,_0x2f75f9(0x1f6),_0x2f75f9(0x1e5))==!![]){let _0x2f9c5a=_0x5e19ca[_0x2f75f9(0x1fd)][_0x2f75f9(0x1fb)],_0x4d4055=_0x5e19ca[_0x2f75f9(0x1fd)]['albumId'],_0x4cb4e=dbOrdinaryAlbumTable['getById'](_0x5e19ca['app']['dbFileIndex'],_0x4d4055);if(!_0x4cb4e)return _0x24ae00[_0x2f75f9(0x1db)]({'code':0x1,'message':'album\x20id\x20invalid'});let _0x452eb6=dbFileIndexTable[_0x2f75f9(0x1e2)](_0x5e19ca[_0x2f75f9(0x1f9)][_0x2f75f9(0x217)],_0x2f9c5a);if(!_0x452eb6)return _0x24ae00[_0x2f75f9(0x1db)]({'code':0x1,'message':_0x2f75f9(0x20d)});return dbOrdinaryAlbumTable[_0x2f75f9(0x205)](_0x5e19ca[_0x2f75f9(0x1f9)][_0x2f75f9(0x217)],_0x4d4055,_0x2f9c5a),_0x24ae00[_0x2f75f9(0x1db)]({'code':0x0});}}),module[_0x5adf32(0x211)]=router;