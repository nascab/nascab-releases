const _0xc74128=_0x4776;function _0x977b(){const _0x7072a4=['orderField','desc','photo','2246465ekCsyg','power_change','/deleteAlbum','length','/getAllAlbum','../../db/dbUserTable','743672UGIETY','indexIdArr','delete','dbFileIndex','end','1900506bVsZpf','/deleteFromAlbum','deleteIndexFromAlbum','power_delete','3652yUlIDY','returnErrMsg','post','../../db/dbFileIndexTable','search','Router','is_admin','orderType','1068kQuMZn','imgList','changes','offset','getList','2YKikuX','express','index\x20id\x20invalid','body','operation\x20fail','../../db/dbOrdinaryAlbumTable','name','album.sameNameExist','7BEaqxs','exports','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','20gwvBWV','currentUser','lastInsertRowid','\x20\x20is_file=1\x20','share','92npehte','/addAlbum','status','/addToAlbum','\x20AND\x20id=?','getById','includes','addIndexToAlbum','1080621btIeQo','album\x20id\x20invalid','push','app','\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201','/updateAlbum','indexId','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','power_get','udpateName','asc','udpateCover','whereStr','index_id','getPathAll','doUserCanGet','username','power_add','getByName','/setAlbumCover','id\x20not\x20exist','getUserPathWhere','11244kkOdNd','INDEX_TABLE_NAME_PHOTO','json','albumId','205581JRxchX'];_0x977b=function(){return _0x7072a4;};return _0x977b();}(function(_0x15cbef,_0x10de79){const _0x4e0598=_0x4776,_0x5c9d23=_0x15cbef();while(!![]){try{const _0x5d6b90=parseInt(_0x4e0598(0xda))/0x1*(parseInt(_0x4e0598(0xa8))/0x2)+-parseInt(_0x4e0598(0xd6))/0x3*(-parseInt(_0x4e0598(0xb8))/0x4)+parseInt(_0x4e0598(0xde))/0x5+-parseInt(_0x4e0598(0x97))/0x6+parseInt(_0x4e0598(0xb0))/0x7*(parseInt(_0x4e0598(0x92))/0x8)+-parseInt(_0x4e0598(0xc0))/0x9*(parseInt(_0x4e0598(0xb3))/0xa)+parseInt(_0x4e0598(0x9b))/0xb*(-parseInt(_0x4e0598(0xa3))/0xc);if(_0x5d6b90===_0x10de79)break;else _0x5c9d23['push'](_0x5c9d23['shift']());}catch(_0x1c717f){_0x5c9d23['push'](_0x5c9d23['shift']());}}}(_0x977b,0x3c730));function _0x4776(_0x2da9e9,_0x46b7a7){const _0x977bc3=_0x977b();return _0x4776=function(_0x4776b2,_0x486902){_0x4776b2=_0x4776b2-0x92;let _0x7679a8=_0x977bc3[_0x4776b2];return _0x7679a8;},_0x4776(_0x2da9e9,_0x46b7a7);}var express=require(_0xc74128(0xa9)),router=express[_0xc74128(0xa0)]();const dbFileIndexTable=require(_0xc74128(0x9e)),dbUserTable=require(_0xc74128(0xe3)),dbOrdinaryAlbumTable=require(_0xc74128(0xad));router['post'](_0xc74128(0xb9),(_0x39763f,_0x2d7d07,_0x2d9eaa)=>{const _0x2ddd19=_0xc74128;if(dbUserTable[_0x2ddd19(0xcf)](_0x39763f,_0x2d7d07,_0x2ddd19(0xdd),_0x2ddd19(0xd1))==!![]){let _0xc34a19=_0x39763f[_0x2ddd19(0xab)]['name'],_0x4e98a6=_0x39763f[_0x2ddd19(0xab)]['parentPath'],_0x5f2a97=_0x39763f['body'][_0x2ddd19(0xb7)];_0x5f2a97!='1'&&(_0x5f2a97='0');let _0x4009a0=dbOrdinaryAlbumTable[_0x2ddd19(0xd2)](_0x39763f[_0x2ddd19(0xc3)][_0x2ddd19(0x95)],_0xc34a19);if(_0x4009a0)return _0x39763f[_0x2ddd19(0xc3)][_0x2ddd19(0x9c)](_0x2d7d07,_0x2d7d07['__'](_0x2ddd19(0xaf)));let _0x889c64=dbOrdinaryAlbumTable['create'](_0x39763f['app'][_0x2ddd19(0x95)],{'name':_0xc34a19,'username':_0x39763f[_0x2ddd19(0xb4)][_0x2ddd19(0xd0)],'share':_0x5f2a97});if(_0x889c64['changes']>0x0){if(_0x4e98a6){let _0x14c87b=_0x889c64[_0x2ddd19(0xb5)];if(_0x14c87b){let _0x1cfd2b=dbFileIndexTable[_0x2ddd19(0xce)](_0x39763f[_0x2ddd19(0xc3)][_0x2ddd19(0x95)],_0x4e98a6,dbFileIndexTable[_0x2ddd19(0xd7)],'id');for(let _0x9afbd0 in _0x1cfd2b){dbOrdinaryAlbumTable[_0x2ddd19(0xbf)](_0x39763f[_0x2ddd19(0xc3)][_0x2ddd19(0x95)],{'album_id':_0x14c87b,'index_id':_0x1cfd2b[_0x9afbd0]['id']});}}}_0x2d7d07[_0x2ddd19(0xd8)]({'code':0x0,'result':_0x889c64});}else _0x2d7d07[_0x2ddd19(0xd8)]({'code':0x1,'message':_0x2ddd19(0xac)});}}),router[_0xc74128(0x9d)](_0xc74128(0xe0),(_0x37211d,_0xfe7cf8,_0x45328e)=>{const _0xa29792=_0xc74128;let _0x195f5f=_0x37211d[_0xa29792(0xab)]['id'],_0x51a648=dbOrdinaryAlbumTable['getById'](_0x37211d[_0xa29792(0xc3)][_0xa29792(0x95)],_0x195f5f);if(!_0x51a648)return _0x37211d[_0xa29792(0xc3)]['returnErrMsg'](_0xfe7cf8,_0xa29792(0xd4));if(_0x51a648[_0xa29792(0xd0)]==_0x37211d[_0xa29792(0xb4)]['username']||dbUserTable[_0xa29792(0xcf)](_0x37211d,_0xfe7cf8,_0xa29792(0xdd),'power_delete')==!![]){let _0x4d318e=dbOrdinaryAlbumTable[_0xa29792(0x94)](_0x37211d[_0xa29792(0xc3)]['dbFileIndex'],_0x195f5f);_0x4d318e[_0xa29792(0xa5)]>0x0?_0xfe7cf8[_0xa29792(0xd8)]({'code':0x0,'result':_0x4d318e}):_0xfe7cf8[_0xa29792(0xd8)]({'code':0x1,'message':_0xa29792(0xac)});}}),router[_0xc74128(0x9d)](_0xc74128(0xc5),(_0xc18c52,_0x6fd9f0,_0xd9109d)=>{const _0x2f1f4d=_0xc74128;let _0x880c16=_0xc18c52['body']['id'],_0x575e9f=dbOrdinaryAlbumTable['getById'](_0xc18c52[_0x2f1f4d(0xc3)]['dbFileIndex'],_0x880c16);if(!_0x575e9f)return _0xc18c52[_0x2f1f4d(0xc3)][_0x2f1f4d(0x9c)](_0x6fd9f0,_0x2f1f4d(0xd4));if(_0x575e9f[_0x2f1f4d(0xd0)]==_0xc18c52[_0x2f1f4d(0xb4)]['username']||dbUserTable[_0x2f1f4d(0xcf)](_0xc18c52,_0x6fd9f0,_0x2f1f4d(0xdd),_0x2f1f4d(0xdf))==!![]){let _0x5d4f9a=_0xc18c52[_0x2f1f4d(0xab)]['name'],_0x66e57=_0xc18c52['body'][_0x2f1f4d(0xb7)];_0x66e57!='1'&&(_0x66e57='0');let _0x2116e4=dbOrdinaryAlbumTable[_0x2f1f4d(0xc9)](_0xc18c52['app'][_0x2f1f4d(0x95)],_0x880c16,_0x5d4f9a,_0x66e57);_0x2116e4[_0x2f1f4d(0xa5)]>0x0?_0x6fd9f0[_0x2f1f4d(0xd8)]({'code':0x0,'result':_0x2116e4}):_0x6fd9f0['json']({'code':0x1,'message':_0x2f1f4d(0xac)});}}),router['post'](_0xc74128(0xe2),(_0x1d2302,_0x2af209,_0x4f7153)=>{const _0x51c453=_0xc74128;if(dbUserTable[_0x51c453(0xcf)](_0x1d2302,_0x2af209,_0x51c453(0xdd),_0x51c453(0xc8))==!![]){let _0x4c50c9=dbUserTable[_0x51c453(0xd5)](_0x1d2302,_0x51c453(0xdd),'power_get',!![]),_0x2946bb=_0x1d2302[_0x51c453(0xab)]['count']||0x14,_0x52a8bf=_0x1d2302['body'][_0x51c453(0xa6)]||0x0,_0x2c1b47=_0x1d2302[_0x51c453(0xab)][_0x51c453(0xdb)]||'id',_0x3a949b=_0x1d2302[_0x51c453(0xab)][_0x51c453(0xa2)]||_0x51c453(0xdc),_0xbc9fda=_0x1d2302[_0x51c453(0xab)][_0x51c453(0x9f)];(![_0x51c453(0xae),'id'][_0x51c453(0xbe)](_0x2c1b47)||![_0x51c453(0xca),'desc'][_0x51c453(0xbe)](_0x3a949b))&&_0x2af209[_0x51c453(0xd8)]({'code':0x0,'data':[]});let _0x2eb5b0=dbOrdinaryAlbumTable[_0x51c453(0xa7)](_0x1d2302[_0x51c453(0xc3)][_0x51c453(0x95)],_0x2946bb,_0x52a8bf,_0x2c1b47,_0x3a949b,_0xbc9fda),_0x2f92f9=_0x2eb5b0;if(_0x1d2302[_0x51c453(0xb4)][_0x51c453(0xa1)]!=0x1){_0x2f92f9=[];for(let _0x3a3816=0x0;_0x3a3816<_0x2eb5b0[_0x51c453(0xe1)];_0x3a3816++){let _0x24e593=_0x2eb5b0[_0x3a3816];(_0x24e593[_0x51c453(0xb7)]==0x1||_0x24e593[_0x51c453(0xd0)]==_0x1d2302['currentUser']['username'])&&_0x2f92f9[_0x51c453(0xc2)](_0x24e593);}}for(let _0xff3c6e=0x0;_0xff3c6e<_0x2f92f9[_0x51c453(0xe1)];_0xff3c6e++){let _0x19ed9e=_0x51c453(0xb6);_0x19ed9e+=_0x4c50c9[_0x51c453(0xcc)];let _0x3f306f=[..._0x4c50c9['paramsList']],_0x1464a6=dbOrdinaryAlbumTable['getIndexByWhere'](_0x1d2302[_0x51c453(0xc3)][_0x51c453(0x95)],_0x51c453(0xc4),[_0x2f92f9[_0xff3c6e]['id']]);!_0x1464a6&&(_0x1464a6=dbOrdinaryAlbumTable['getIndexByWhere'](_0x1d2302[_0x51c453(0xc3)]['dbFileIndex'],_0x51c453(0xb2),[_0x2f92f9[_0xff3c6e]['id']]));if(_0x1464a6){let _0xac9845=dbFileIndexTable[_0x51c453(0xbd)](_0x1d2302[_0x51c453(0xc3)][_0x51c453(0x95)],_0x1464a6[_0x51c453(0xcd)]);_0xac9845&&_0xac9845['in_trash']!=0x1&&(_0x19ed9e+=_0x51c453(0xbc),_0x3f306f[_0x51c453(0xc2)](parseInt(_0x1464a6[_0x51c453(0xcd)])));}else{_0x2f92f9[_0xff3c6e][_0x51c453(0xa4)]=[];continue;}_0x19ed9e+=_0x51c453(0xc7),_0x19ed9e+='\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201';let _0x3f9f96=dbFileIndexTable['getAllByWhere'](_0x1d2302['app']['dbFileIndex'],_0x19ed9e,'*',dbFileIndexTable[_0x51c453(0xd7)],_0x3f306f);_0x2f92f9[_0xff3c6e]['imgList']=_0x3f9f96;}_0x2af209[_0x51c453(0xd8)]({'code':0x0,'data':_0x2f92f9});}}),router[_0xc74128(0x9d)](_0xc74128(0xbb),(_0x15a320,_0x3f1301,_0x5d9e56)=>{const _0x35871f=_0xc74128;if(dbUserTable[_0x35871f(0xcf)](_0x15a320,_0x3f1301,'photo','power_add')==!![]){let _0x428c43=_0x15a320[_0x35871f(0xab)][_0x35871f(0x93)],_0x1c1d65=_0x15a320['body'][_0x35871f(0xd9)],_0x540bca=dbOrdinaryAlbumTable[_0x35871f(0xbd)](_0x15a320[_0x35871f(0xc3)][_0x35871f(0x95)],_0x1c1d65);if(!_0x540bca)return _0x3f1301[_0x35871f(0xba)](0x194)[_0x35871f(0x96)]();let _0x3f1cb0=0x0;if(_0x428c43&&_0x428c43[_0x35871f(0xe1)]>0x0)for(let _0x3b56ba=0x0;_0x3b56ba<_0x428c43[_0x35871f(0xe1)];_0x3b56ba++){let _0x10236c=_0x428c43[_0x3b56ba],_0x1a47c4=dbFileIndexTable[_0x35871f(0xbd)](_0x15a320['app'][_0x35871f(0x95)],_0x10236c);if(!_0x1a47c4)continue;let _0x3a0aea=dbOrdinaryAlbumTable['addIndexToAlbum'](_0x15a320[_0x35871f(0xc3)][_0x35871f(0x95)],{'album_id':_0x1c1d65,'index_id':_0x10236c});_0x3a0aea[_0x35871f(0xa5)]>0x0&&(_0x3f1cb0+=0x1);}_0x3f1301[_0x35871f(0xd8)]({'code':0x0,'sucCount':_0x3f1cb0});}}),router['post'](_0xc74128(0x98),(_0x3a50f8,_0x2b6842,_0xd032e2)=>{const _0x4e3d6d=_0xc74128;if(dbUserTable[_0x4e3d6d(0xcf)](_0x3a50f8,_0x2b6842,_0x4e3d6d(0xdd),_0x4e3d6d(0x9a))==!![]){let _0x5da61f=_0x3a50f8[_0x4e3d6d(0xab)][_0x4e3d6d(0x93)],_0x2b6c44=_0x3a50f8[_0x4e3d6d(0xab)][_0x4e3d6d(0xd9)],_0x3a1742=dbOrdinaryAlbumTable['getById'](_0x3a50f8['app'][_0x4e3d6d(0x95)],_0x2b6c44);if(!_0x3a1742)return _0x2b6842[_0x4e3d6d(0xd8)]({'code':0x1,'message':_0x4e3d6d(0xc1)});if(_0x5da61f&&_0x5da61f[_0x4e3d6d(0xe1)]>0x0){let _0x4b267a='(';for(let _0x575e44=0x0;_0x575e44<_0x5da61f['length'];_0x575e44++){let _0x3b612d=_0x5da61f[_0x575e44],_0x2f3f8f=dbFileIndexTable[_0x4e3d6d(0xbd)](_0x3a50f8[_0x4e3d6d(0xc3)][_0x4e3d6d(0x95)],_0x3b612d);if(!_0x2f3f8f)continue;_0x4b267a+=_0x3b612d,_0x575e44!=_0x5da61f[_0x4e3d6d(0xe1)]-0x1&&(_0x4b267a+=',');}_0x4b267a+=')';let _0xeae1b1=dbOrdinaryAlbumTable[_0x4e3d6d(0x99)](_0x3a50f8['app'][_0x4e3d6d(0x95)],_0x2b6c44,_0x4b267a);_0x2b6842['json']({'code':0x0,'sucCount':_0xeae1b1[_0x4e3d6d(0xa5)]});}else _0x2b6842['json']({'code':0x0,'sucCount':0x0});}}),router[_0xc74128(0x9d)](_0xc74128(0xd3),(_0xeb306f,_0x2ce567,_0x3524ec)=>{const _0x5999d8=_0xc74128;if(dbUserTable[_0x5999d8(0xcf)](_0xeb306f,_0x2ce567,'photo',_0x5999d8(0xdf))==!![]){let _0x21046a=_0xeb306f[_0x5999d8(0xab)][_0x5999d8(0xc6)],_0x3661ca=_0xeb306f[_0x5999d8(0xab)][_0x5999d8(0xd9)],_0x912ce6=dbOrdinaryAlbumTable[_0x5999d8(0xbd)](_0xeb306f['app']['dbFileIndex'],_0x3661ca);if(!_0x912ce6)return _0x2ce567[_0x5999d8(0xd8)]({'code':0x1,'message':_0x5999d8(0xc1)});let _0x559f9a=dbFileIndexTable[_0x5999d8(0xbd)](_0xeb306f[_0x5999d8(0xc3)][_0x5999d8(0x95)],_0x21046a);if(!_0x559f9a)return _0x2ce567[_0x5999d8(0xd8)]({'code':0x1,'message':_0x5999d8(0xaa)});return dbOrdinaryAlbumTable[_0x5999d8(0xcb)](_0xeb306f[_0x5999d8(0xc3)][_0x5999d8(0x95)],_0x3661ca,_0x21046a),_0x2ce567[_0x5999d8(0xd8)]({'code':0x0});}}),module[_0xc74128(0xb1)]=router;