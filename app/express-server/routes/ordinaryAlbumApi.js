const _0x248b4e=_0x368f;function _0x4855(){const _0x505c36=['imgList','id\x20not\x20exist','22612HyjuwA','indexId','parentPath','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','offset','desc','name','getIndexByWhere','push','exports','lastInsertRowid','end','currentUser','create','udpateCover','udpateName','album\x20id\x20invalid','length','albumId','is_admin','/getAllAlbum','2261425ADUzxO','power_change','changes','express','/deleteAlbum','2ofKxdn','getByName','index_id','81ySwlBb','index\x20id\x20invalid','/setAlbumCover','1417674vHBVlc','json','getById','delete','body','75AgSMwd','photo','\x20AND\x20id=?','\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201','paramsList','includes','power_add','share','app','operation\x20fail','\x20\x20is_file=1\x20','returnErrMsg','../../db/dbFileIndexTable','../../db/dbOrdinaryAlbumTable','indexIdArr','deleteIndexFromAlbum','doUserCanGet','username','getAllByWhere','status','post','addIndexToAlbum','3849461nGXcSA','/deleteFromAlbum','731266QmpKRE','power_delete','power_get','count','whereStr','album.sameNameExist','orderField','orderType','INDEX_TABLE_NAME_PHOTO','dbFileIndex','5751530wlokKL','getList','/addToAlbum','538968TDmSpA','/addAlbum'];_0x4855=function(){return _0x505c36;};return _0x4855();}(function(_0x2d4063,_0x176509){const _0xb0556c=_0x368f,_0x7a5d17=_0x2d4063();while(!![]){try{const _0x2b59f5=-parseInt(_0xb0556c(0x16b))/0x1*(parseInt(_0xb0556c(0x18e))/0x2)+parseInt(_0xb0556c(0x176))/0x3*(-parseInt(_0xb0556c(0x19f))/0x4)+-parseInt(_0xb0556c(0x166))/0x5+parseInt(_0xb0556c(0x171))/0x6+parseInt(_0xb0556c(0x18c))/0x7+-parseInt(_0xb0556c(0x19b))/0x8*(-parseInt(_0xb0556c(0x16e))/0x9)+parseInt(_0xb0556c(0x198))/0xa;if(_0x2b59f5===_0x176509)break;else _0x7a5d17['push'](_0x7a5d17['shift']());}catch(_0x2c88d3){_0x7a5d17['push'](_0x7a5d17['shift']());}}}(_0x4855,0x9cf02));function _0x368f(_0x2dee03,_0x2072da){const _0x4855d2=_0x4855();return _0x368f=function(_0x368fe2,_0x30581c){_0x368fe2=_0x368fe2-0x164;let _0x17a5a7=_0x4855d2[_0x368fe2];return _0x17a5a7;},_0x368f(_0x2dee03,_0x2072da);}var express=require(_0x248b4e(0x169)),router=express['Router']();const dbFileIndexTable=require(_0x248b4e(0x182)),dbUserTable=require('../../db/dbUserTable'),dbOrdinaryAlbumTable=require(_0x248b4e(0x183));router[_0x248b4e(0x18a)](_0x248b4e(0x19c),(_0x1a28d5,_0x40ce13,_0x12a8ad)=>{const _0x22e019=_0x248b4e;if(dbUserTable[_0x22e019(0x186)](_0x1a28d5,_0x40ce13,_0x22e019(0x177),_0x22e019(0x17c))==!![]){let _0x1f5793=_0x1a28d5['body'][_0x22e019(0x1a5)],_0x3f99e9=_0x1a28d5[_0x22e019(0x175)][_0x22e019(0x1a1)],_0x11eb42=_0x1a28d5[_0x22e019(0x175)][_0x22e019(0x17d)];_0x11eb42!='1'&&(_0x11eb42='0');let _0x1caa0a=dbOrdinaryAlbumTable[_0x22e019(0x16c)](_0x1a28d5[_0x22e019(0x17e)][_0x22e019(0x197)],_0x1f5793);if(_0x1caa0a)return _0x1a28d5['app'][_0x22e019(0x181)](_0x40ce13,_0x40ce13['__'](_0x22e019(0x193)));let _0x24b91a=dbOrdinaryAlbumTable[_0x22e019(0x1ac)](_0x1a28d5[_0x22e019(0x17e)][_0x22e019(0x197)],{'name':_0x1f5793,'username':_0x1a28d5[_0x22e019(0x1ab)]['username'],'share':_0x11eb42});if(_0x24b91a[_0x22e019(0x168)]>0x0){if(_0x3f99e9){let _0xe912d9=_0x24b91a[_0x22e019(0x1a9)];if(_0xe912d9){let _0x339ef9=dbFileIndexTable['getPathAll'](_0x1a28d5[_0x22e019(0x17e)][_0x22e019(0x197)],_0x3f99e9,dbFileIndexTable[_0x22e019(0x196)],'id');for(let _0x4251e6 in _0x339ef9){dbOrdinaryAlbumTable['addIndexToAlbum'](_0x1a28d5[_0x22e019(0x17e)][_0x22e019(0x197)],{'album_id':_0xe912d9,'index_id':_0x339ef9[_0x4251e6]['id']});}}}_0x40ce13[_0x22e019(0x172)]({'code':0x0,'result':_0x24b91a});}else _0x40ce13['json']({'code':0x1,'message':'operation\x20fail'});}}),router[_0x248b4e(0x18a)](_0x248b4e(0x16a),(_0x7a3ff6,_0x58b076,_0x1866ca)=>{const _0x24f369=_0x248b4e;let _0x246cbc=_0x7a3ff6[_0x24f369(0x175)]['id'],_0x82d17f=dbOrdinaryAlbumTable['getById'](_0x7a3ff6['app']['dbFileIndex'],_0x246cbc);if(!_0x82d17f)return _0x7a3ff6[_0x24f369(0x17e)][_0x24f369(0x181)](_0x58b076,_0x24f369(0x19e));if(_0x82d17f['username']==_0x7a3ff6[_0x24f369(0x1ab)]['username']||dbUserTable['doUserCanGet'](_0x7a3ff6,_0x58b076,'photo',_0x24f369(0x18f))==!![]){let _0x105cf9=dbOrdinaryAlbumTable[_0x24f369(0x174)](_0x7a3ff6[_0x24f369(0x17e)]['dbFileIndex'],_0x246cbc);_0x105cf9[_0x24f369(0x168)]>0x0?_0x58b076['json']({'code':0x0,'result':_0x105cf9}):_0x58b076[_0x24f369(0x172)]({'code':0x1,'message':_0x24f369(0x17f)});}}),router[_0x248b4e(0x18a)]('/updateAlbum',(_0x48b1e4,_0x23c0fa,_0x1eb221)=>{const _0x3e96c1=_0x248b4e;let _0x1f6eb9=_0x48b1e4[_0x3e96c1(0x175)]['id'],_0x488d7f=dbOrdinaryAlbumTable[_0x3e96c1(0x173)](_0x48b1e4[_0x3e96c1(0x17e)]['dbFileIndex'],_0x1f6eb9);if(!_0x488d7f)return _0x48b1e4[_0x3e96c1(0x17e)]['returnErrMsg'](_0x23c0fa,_0x3e96c1(0x19e));if(_0x488d7f[_0x3e96c1(0x187)]==_0x48b1e4[_0x3e96c1(0x1ab)][_0x3e96c1(0x187)]||dbUserTable[_0x3e96c1(0x186)](_0x48b1e4,_0x23c0fa,_0x3e96c1(0x177),_0x3e96c1(0x167))==!![]){let _0x1c2762=_0x48b1e4[_0x3e96c1(0x175)][_0x3e96c1(0x1a5)],_0x4c9792=_0x48b1e4['body'][_0x3e96c1(0x17d)];_0x4c9792!='1'&&(_0x4c9792='0');let _0x2395ea=dbOrdinaryAlbumTable[_0x3e96c1(0x1ae)](_0x48b1e4[_0x3e96c1(0x17e)][_0x3e96c1(0x197)],_0x1f6eb9,_0x1c2762,_0x4c9792);_0x2395ea['changes']>0x0?_0x23c0fa[_0x3e96c1(0x172)]({'code':0x0,'result':_0x2395ea}):_0x23c0fa[_0x3e96c1(0x172)]({'code':0x1,'message':'operation\x20fail'});}}),router[_0x248b4e(0x18a)](_0x248b4e(0x165),(_0x316b96,_0x27803d,_0x1dbf3a)=>{const _0xc94f30=_0x248b4e;if(dbUserTable[_0xc94f30(0x186)](_0x316b96,_0x27803d,_0xc94f30(0x177),_0xc94f30(0x190))==!![]){let _0x2b0fde=dbUserTable['getUserPathWhere'](_0x316b96,_0xc94f30(0x177),_0xc94f30(0x190),!![]),_0x19a62c=_0x316b96[_0xc94f30(0x175)][_0xc94f30(0x191)]||0x14,_0x405dc0=_0x316b96[_0xc94f30(0x175)][_0xc94f30(0x1a3)]||0x0,_0xfa7d2d=_0x316b96[_0xc94f30(0x175)][_0xc94f30(0x194)]||'id',_0x34b2fc=_0x316b96[_0xc94f30(0x175)][_0xc94f30(0x195)]||_0xc94f30(0x1a4),_0x17ae6f=_0x316b96['body']['search'];(!['name','id'][_0xc94f30(0x17b)](_0xfa7d2d)||!['asc',_0xc94f30(0x1a4)][_0xc94f30(0x17b)](_0x34b2fc))&&_0x27803d[_0xc94f30(0x172)]({'code':0x0,'data':[]});let _0xaec94=dbOrdinaryAlbumTable[_0xc94f30(0x199)](_0x316b96[_0xc94f30(0x17e)][_0xc94f30(0x197)],_0x19a62c,_0x405dc0,_0xfa7d2d,_0x34b2fc,_0x17ae6f),_0xa1ae95=_0xaec94;if(_0x316b96[_0xc94f30(0x1ab)][_0xc94f30(0x164)]!=0x1){_0xa1ae95=[];for(let _0x14bdb5=0x0;_0x14bdb5<_0xaec94[_0xc94f30(0x1b0)];_0x14bdb5++){let _0x11aa49=_0xaec94[_0x14bdb5];(_0x11aa49[_0xc94f30(0x17d)]==0x1||_0x11aa49[_0xc94f30(0x187)]==_0x316b96[_0xc94f30(0x1ab)][_0xc94f30(0x187)])&&_0xa1ae95['push'](_0x11aa49);}}for(let _0x5c5463=0x0;_0x5c5463<_0xa1ae95[_0xc94f30(0x1b0)];_0x5c5463++){let _0x4a9b28=_0xc94f30(0x180);_0x4a9b28+=_0x2b0fde[_0xc94f30(0x192)];let _0x46038c=[..._0x2b0fde[_0xc94f30(0x17a)]],_0x49e49b=dbOrdinaryAlbumTable[_0xc94f30(0x1a6)](_0x316b96[_0xc94f30(0x17e)][_0xc94f30(0x197)],_0xc94f30(0x179),[_0xa1ae95[_0x5c5463]['id']]);!_0x49e49b&&(_0x49e49b=dbOrdinaryAlbumTable[_0xc94f30(0x1a6)](_0x316b96[_0xc94f30(0x17e)]['dbFileIndex'],'\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201',[_0xa1ae95[_0x5c5463]['id']]));if(_0x49e49b){let _0x5802d1=dbFileIndexTable[_0xc94f30(0x173)](_0x316b96[_0xc94f30(0x17e)][_0xc94f30(0x197)],_0x49e49b[_0xc94f30(0x16d)]);_0x5802d1&&_0x5802d1['in_trash']!=0x1&&(_0x4a9b28+=_0xc94f30(0x178),_0x46038c[_0xc94f30(0x1a7)](parseInt(_0x49e49b[_0xc94f30(0x16d)])));}else{_0xa1ae95[_0x5c5463][_0xc94f30(0x19d)]=[];continue;}_0x4a9b28+='\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0',_0x4a9b28+=_0xc94f30(0x1a2);let _0x5711b4=dbFileIndexTable[_0xc94f30(0x188)](_0x316b96['app'][_0xc94f30(0x197)],_0x4a9b28,'*',dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],_0x46038c);_0xa1ae95[_0x5c5463][_0xc94f30(0x19d)]=_0x5711b4;}_0x27803d[_0xc94f30(0x172)]({'code':0x0,'data':_0xa1ae95});}}),router[_0x248b4e(0x18a)](_0x248b4e(0x19a),(_0x1ae64c,_0xafc243,_0x57f933)=>{const _0x17e003=_0x248b4e;if(dbUserTable[_0x17e003(0x186)](_0x1ae64c,_0xafc243,_0x17e003(0x177),_0x17e003(0x17c))==!![]){let _0x3dfef7=_0x1ae64c[_0x17e003(0x175)][_0x17e003(0x184)],_0x28f4aa=_0x1ae64c[_0x17e003(0x175)][_0x17e003(0x1b1)],_0x28b259=dbOrdinaryAlbumTable['getById'](_0x1ae64c[_0x17e003(0x17e)][_0x17e003(0x197)],_0x28f4aa);if(!_0x28b259)return _0xafc243[_0x17e003(0x189)](0x194)[_0x17e003(0x1aa)]();let _0x2d81a8=0x0;if(_0x3dfef7&&_0x3dfef7[_0x17e003(0x1b0)]>0x0)for(let _0x403114=0x0;_0x403114<_0x3dfef7[_0x17e003(0x1b0)];_0x403114++){let _0xf3463e=_0x3dfef7[_0x403114],_0x292863=dbFileIndexTable[_0x17e003(0x173)](_0x1ae64c[_0x17e003(0x17e)][_0x17e003(0x197)],_0xf3463e);if(!_0x292863)continue;let _0xd566d0=dbOrdinaryAlbumTable[_0x17e003(0x18b)](_0x1ae64c[_0x17e003(0x17e)][_0x17e003(0x197)],{'album_id':_0x28f4aa,'index_id':_0xf3463e});_0xd566d0['changes']>0x0&&(_0x2d81a8+=0x1);}_0xafc243[_0x17e003(0x172)]({'code':0x0,'sucCount':_0x2d81a8});}}),router['post'](_0x248b4e(0x18d),(_0x114f89,_0x10a349,_0x59e33b)=>{const _0x4b0665=_0x248b4e;if(dbUserTable[_0x4b0665(0x186)](_0x114f89,_0x10a349,_0x4b0665(0x177),_0x4b0665(0x18f))==!![]){let _0x46e427=_0x114f89[_0x4b0665(0x175)][_0x4b0665(0x184)],_0x3e1b20=_0x114f89[_0x4b0665(0x175)][_0x4b0665(0x1b1)],_0x1e5c77=dbOrdinaryAlbumTable[_0x4b0665(0x173)](_0x114f89['app'][_0x4b0665(0x197)],_0x3e1b20);if(!_0x1e5c77)return _0x10a349['json']({'code':0x1,'message':'album\x20id\x20invalid'});if(_0x46e427&&_0x46e427['length']>0x0){let _0x80561='(';for(let _0x917b9b=0x0;_0x917b9b<_0x46e427[_0x4b0665(0x1b0)];_0x917b9b++){let _0x52258a=_0x46e427[_0x917b9b],_0x5201ee=dbFileIndexTable['getById'](_0x114f89['app'][_0x4b0665(0x197)],_0x52258a);if(!_0x5201ee)continue;_0x80561+=_0x52258a,_0x917b9b!=_0x46e427[_0x4b0665(0x1b0)]-0x1&&(_0x80561+=',');}_0x80561+=')';let _0x360937=dbOrdinaryAlbumTable[_0x4b0665(0x185)](_0x114f89['app'][_0x4b0665(0x197)],_0x3e1b20,_0x80561);_0x10a349[_0x4b0665(0x172)]({'code':0x0,'sucCount':_0x360937[_0x4b0665(0x168)]});}else _0x10a349[_0x4b0665(0x172)]({'code':0x0,'sucCount':0x0});}}),router[_0x248b4e(0x18a)](_0x248b4e(0x170),(_0x2b1e54,_0x371169,_0x39a664)=>{const _0x56f58b=_0x248b4e;if(dbUserTable[_0x56f58b(0x186)](_0x2b1e54,_0x371169,_0x56f58b(0x177),_0x56f58b(0x167))==!![]){let _0x4080ad=_0x2b1e54['body'][_0x56f58b(0x1a0)],_0x3286cb=_0x2b1e54[_0x56f58b(0x175)][_0x56f58b(0x1b1)],_0x542875=dbOrdinaryAlbumTable[_0x56f58b(0x173)](_0x2b1e54[_0x56f58b(0x17e)][_0x56f58b(0x197)],_0x3286cb);if(!_0x542875)return _0x371169[_0x56f58b(0x172)]({'code':0x1,'message':_0x56f58b(0x1af)});let _0x535f28=dbFileIndexTable[_0x56f58b(0x173)](_0x2b1e54[_0x56f58b(0x17e)]['dbFileIndex'],_0x4080ad);if(!_0x535f28)return _0x371169[_0x56f58b(0x172)]({'code':0x1,'message':_0x56f58b(0x16f)});return dbOrdinaryAlbumTable[_0x56f58b(0x1ad)](_0x2b1e54[_0x56f58b(0x17e)]['dbFileIndex'],_0x3286cb,_0x4080ad),_0x371169['json']({'code':0x0});}}),module[_0x248b4e(0x1a8)]=router;