function _0x1f01(_0x3d34c9,_0x27a945){const _0x2157c5=_0x2157();return _0x1f01=function(_0x1f0155,_0x4aa3d1){_0x1f0155=_0x1f0155-0xbb;let _0x304376=_0x2157c5[_0x1f0155];return _0x304376;},_0x1f01(_0x3d34c9,_0x27a945);}function _0x2157(){const _0xde5d23=['photo','532693NCZqeB','/setAlbumCover','INDEX_TABLE_NAME_PHOTO','index\x20id\x20invalid','/updateAlbum','power_change','end','103365XtyKWQ','getAllByWhere','doUserCanGet','includes','asc','../../db/dbUserTable','42spZMyB','body','../../db/dbOrdinaryAlbumTable','\x20AND\x20id=?','getById','8SylSHZ','84JSXxFT','87180HsFkIQ','\x20\x20is_file=1\x20','orderType','returnErrMsg','Router','album.sameNameExist','count','currentUser','length','getIndexByWhere','udpateName','parentPath','/deleteFromAlbum','username','post','indexId','/addAlbum','../../db/dbFileIndexTable','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','/getAllAlbum','370GTMyOh','whereStr','name','power_delete','orderField','create','power_get','\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201','772016yMRGFy','operation\x20fail','push','paramsList','index_id','app','changes','indexIdArr','power_add','deleteIndexFromAlbum','udpateCover','id\x20not\x20exist','addIndexToAlbum','delete','dbFileIndex','99GcrxoF','album\x20id\x20invalid','getPathAll','/addToAlbum','839854uzGvVb','json','23892rAVrxr','445825JpEEog','imgList','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','status','exports','albumId','share'];_0x2157=function(){return _0xde5d23;};return _0x2157();}const _0x2ecd6b=_0x1f01;(function(_0x10c884,_0x37fafa){const _0x1136e4=_0x1f01,_0x369c26=_0x10c884();while(!![]){try{const _0x513a65=parseInt(_0x1136e4(0xc7))/0x1+-parseInt(_0x1136e4(0xda))/0x2+-parseInt(_0x1136e4(0xdc))/0x3*(-parseInt(_0x1136e4(0xf8))/0x4)+-parseInt(_0x1136e4(0xdd))/0x5*(parseInt(_0x1136e4(0xf2))/0x6)+-parseInt(_0x1136e4(0xe5))/0x7*(-parseInt(_0x1136e4(0xf7))/0x8)+-parseInt(_0x1136e4(0xec))/0x9*(-parseInt(_0x1136e4(0xbf))/0xa)+-parseInt(_0x1136e4(0xd6))/0xb*(-parseInt(_0x1136e4(0xf9))/0xc);if(_0x513a65===_0x37fafa)break;else _0x369c26['push'](_0x369c26['shift']());}catch(_0x26f61a){_0x369c26['push'](_0x369c26['shift']());}}}(_0x2157,0x70b27));var express=require('express'),router=express[_0x2ecd6b(0xfd)]();const dbFileIndexTable=require(_0x2ecd6b(0xbc)),dbUserTable=require(_0x2ecd6b(0xf1)),dbOrdinaryAlbumTable=require(_0x2ecd6b(0xf4));router[_0x2ecd6b(0x107)](_0x2ecd6b(0xbb),(_0x681bda,_0x4e15a4,_0xa319e2)=>{const _0x1f89c1=_0x2ecd6b;if(dbUserTable['doUserCanGet'](_0x681bda,_0x4e15a4,_0x1f89c1(0xe4),'power_add')==!![]){let _0x578f7f=_0x681bda[_0x1f89c1(0xf3)][_0x1f89c1(0xc1)],_0x162b3b=_0x681bda['body'][_0x1f89c1(0x104)],_0x1a345d=_0x681bda[_0x1f89c1(0xf3)][_0x1f89c1(0xe3)];_0x1a345d!='1'&&(_0x1a345d='0');let _0x47ec41=dbOrdinaryAlbumTable['getByName'](_0x681bda[_0x1f89c1(0xcc)][_0x1f89c1(0xd5)],_0x578f7f);if(_0x47ec41)return _0x681bda[_0x1f89c1(0xcc)][_0x1f89c1(0xfc)](_0x4e15a4,_0x4e15a4['__'](_0x1f89c1(0xfe)));let _0x1aa253=dbOrdinaryAlbumTable[_0x1f89c1(0xc4)](_0x681bda[_0x1f89c1(0xcc)]['dbFileIndex'],{'name':_0x578f7f,'username':_0x681bda[_0x1f89c1(0x100)][_0x1f89c1(0x106)],'share':_0x1a345d});if(_0x1aa253['changes']>0x0){if(_0x162b3b){let _0x178646=_0x1aa253['lastInsertRowid'];if(_0x178646){let _0x452377=dbFileIndexTable[_0x1f89c1(0xd8)](_0x681bda[_0x1f89c1(0xcc)]['dbFileIndex'],_0x162b3b,dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],'id');for(let _0x5ea602 in _0x452377){dbOrdinaryAlbumTable[_0x1f89c1(0xd3)](_0x681bda[_0x1f89c1(0xcc)][_0x1f89c1(0xd5)],{'album_id':_0x178646,'index_id':_0x452377[_0x5ea602]['id']});}}}_0x4e15a4[_0x1f89c1(0xdb)]({'code':0x0,'result':_0x1aa253});}else _0x4e15a4[_0x1f89c1(0xdb)]({'code':0x1,'message':_0x1f89c1(0xc8)});}}),router['post']('/deleteAlbum',(_0x507857,_0x239d39,_0x5cb4bd)=>{const _0x1b9001=_0x2ecd6b;let _0x3338c9=_0x507857['body']['id'],_0x2b7d35=dbOrdinaryAlbumTable[_0x1b9001(0xf6)](_0x507857[_0x1b9001(0xcc)][_0x1b9001(0xd5)],_0x3338c9);if(!_0x2b7d35)return _0x507857[_0x1b9001(0xcc)][_0x1b9001(0xfc)](_0x239d39,_0x1b9001(0xd2));if(_0x2b7d35[_0x1b9001(0x106)]==_0x507857[_0x1b9001(0x100)][_0x1b9001(0x106)]||dbUserTable[_0x1b9001(0xee)](_0x507857,_0x239d39,'photo',_0x1b9001(0xc2))==!![]){let _0x1a1117=dbOrdinaryAlbumTable[_0x1b9001(0xd4)](_0x507857['app'][_0x1b9001(0xd5)],_0x3338c9);_0x1a1117['changes']>0x0?_0x239d39[_0x1b9001(0xdb)]({'code':0x0,'result':_0x1a1117}):_0x239d39[_0x1b9001(0xdb)]({'code':0x1,'message':'operation\x20fail'});}}),router[_0x2ecd6b(0x107)](_0x2ecd6b(0xe9),(_0x3c81a2,_0x52bf13,_0x27c741)=>{const _0x3b4d18=_0x2ecd6b;let _0x4def2e=_0x3c81a2[_0x3b4d18(0xf3)]['id'],_0xa5921b=dbOrdinaryAlbumTable[_0x3b4d18(0xf6)](_0x3c81a2[_0x3b4d18(0xcc)]['dbFileIndex'],_0x4def2e);if(!_0xa5921b)return _0x3c81a2[_0x3b4d18(0xcc)][_0x3b4d18(0xfc)](_0x52bf13,_0x3b4d18(0xd2));if(_0xa5921b[_0x3b4d18(0x106)]==_0x3c81a2[_0x3b4d18(0x100)][_0x3b4d18(0x106)]||dbUserTable[_0x3b4d18(0xee)](_0x3c81a2,_0x52bf13,'photo',_0x3b4d18(0xea))==!![]){let _0x37309c=_0x3c81a2[_0x3b4d18(0xf3)][_0x3b4d18(0xc1)],_0x45a35f=_0x3c81a2['body'][_0x3b4d18(0xe3)];_0x45a35f!='1'&&(_0x45a35f='0');let _0x3ddd77=dbOrdinaryAlbumTable[_0x3b4d18(0x103)](_0x3c81a2['app']['dbFileIndex'],_0x4def2e,_0x37309c,_0x45a35f);_0x3ddd77[_0x3b4d18(0xcd)]>0x0?_0x52bf13[_0x3b4d18(0xdb)]({'code':0x0,'result':_0x3ddd77}):_0x52bf13['json']({'code':0x1,'message':_0x3b4d18(0xc8)});}}),router[_0x2ecd6b(0x107)](_0x2ecd6b(0xbe),(_0x4d47cf,_0x148b82,_0xe97e7a)=>{const _0x3011c5=_0x2ecd6b;if(dbUserTable[_0x3011c5(0xee)](_0x4d47cf,_0x148b82,_0x3011c5(0xe4),_0x3011c5(0xc5))==!![]){let _0xbb7908=dbUserTable['getUserPathWhere'](_0x4d47cf,'photo',_0x3011c5(0xc5),!![]),_0x44eaf6=_0x4d47cf[_0x3011c5(0xf3)][_0x3011c5(0xff)]||0x14,_0xd1f6cf=_0x4d47cf['body']['offset']||0x0,_0x3b527f=_0x4d47cf[_0x3011c5(0xf3)][_0x3011c5(0xc3)]||'id',_0x1aa0f0=_0x4d47cf['body'][_0x3011c5(0xfb)]||'desc',_0x416935=_0x4d47cf[_0x3011c5(0xf3)]['search'];(![_0x3011c5(0xc1),'id'][_0x3011c5(0xef)](_0x3b527f)||![_0x3011c5(0xf0),'desc'][_0x3011c5(0xef)](_0x1aa0f0))&&_0x148b82['json']({'code':0x0,'data':[]});let _0x6f7593=dbOrdinaryAlbumTable['getList'](_0x4d47cf[_0x3011c5(0xcc)][_0x3011c5(0xd5)],_0x44eaf6,_0xd1f6cf,_0x3b527f,_0x1aa0f0,_0x416935),_0x4f601f=_0x6f7593;if(_0x4d47cf['currentUser']['is_admin']!=0x1){_0x4f601f=[];for(let _0x1539cb=0x0;_0x1539cb<_0x6f7593[_0x3011c5(0x101)];_0x1539cb++){let _0x35ac5d=_0x6f7593[_0x1539cb];(_0x35ac5d['share']==0x1||_0x35ac5d[_0x3011c5(0x106)]==_0x4d47cf[_0x3011c5(0x100)][_0x3011c5(0x106)])&&_0x4f601f[_0x3011c5(0xc9)](_0x35ac5d);}}for(let _0xabc19d=0x0;_0xabc19d<_0x4f601f[_0x3011c5(0x101)];_0xabc19d++){let _0x25bba3=_0x3011c5(0xfa);_0x25bba3+=_0xbb7908[_0x3011c5(0xc0)];let _0x5c662d=[..._0xbb7908[_0x3011c5(0xca)]],_0x40e047=dbOrdinaryAlbumTable['getIndexByWhere'](_0x4d47cf[_0x3011c5(0xcc)]['dbFileIndex'],_0x3011c5(0xc6),[_0x4f601f[_0xabc19d]['id']]);!_0x40e047&&(_0x40e047=dbOrdinaryAlbumTable[_0x3011c5(0x102)](_0x4d47cf['app'][_0x3011c5(0xd5)],_0x3011c5(0xdf),[_0x4f601f[_0xabc19d]['id']]));if(_0x40e047){let _0x19a67e=dbFileIndexTable[_0x3011c5(0xf6)](_0x4d47cf[_0x3011c5(0xcc)][_0x3011c5(0xd5)],_0x40e047[_0x3011c5(0xcb)]);_0x19a67e&&_0x19a67e['in_trash']!=0x1&&(_0x25bba3+=_0x3011c5(0xf5),_0x5c662d[_0x3011c5(0xc9)](parseInt(_0x40e047['index_id'])));}else{_0x4f601f[_0xabc19d]['imgList']=[];continue;}_0x25bba3+='\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0',_0x25bba3+=_0x3011c5(0xbd);let _0x171fdc=dbFileIndexTable[_0x3011c5(0xed)](_0x4d47cf[_0x3011c5(0xcc)][_0x3011c5(0xd5)],_0x25bba3,'*',dbFileIndexTable[_0x3011c5(0xe7)],_0x5c662d);_0x4f601f[_0xabc19d][_0x3011c5(0xde)]=_0x171fdc;}_0x148b82[_0x3011c5(0xdb)]({'code':0x0,'data':_0x4f601f});}}),router['post'](_0x2ecd6b(0xd9),(_0x245a19,_0x28bdf4,_0x628ad0)=>{const _0x1637ce=_0x2ecd6b;if(dbUserTable[_0x1637ce(0xee)](_0x245a19,_0x28bdf4,'photo',_0x1637ce(0xcf))==!![]){let _0x3b6cb9=_0x245a19['body']['indexIdArr'],_0x159265=_0x245a19[_0x1637ce(0xf3)][_0x1637ce(0xe2)],_0x44503d=dbOrdinaryAlbumTable[_0x1637ce(0xf6)](_0x245a19['app'][_0x1637ce(0xd5)],_0x159265);if(!_0x44503d)return _0x28bdf4[_0x1637ce(0xe0)](0x194)[_0x1637ce(0xeb)]();let _0x66df11=0x0;if(_0x3b6cb9&&_0x3b6cb9[_0x1637ce(0x101)]>0x0)for(let _0x4331da=0x0;_0x4331da<_0x3b6cb9['length'];_0x4331da++){let _0x5d4925=_0x3b6cb9[_0x4331da],_0x3868db=dbFileIndexTable[_0x1637ce(0xf6)](_0x245a19['app'][_0x1637ce(0xd5)],_0x5d4925);if(!_0x3868db)continue;let _0x40055b=dbOrdinaryAlbumTable['addIndexToAlbum'](_0x245a19['app']['dbFileIndex'],{'album_id':_0x159265,'index_id':_0x5d4925});_0x40055b[_0x1637ce(0xcd)]>0x0&&(_0x66df11+=0x1);}_0x28bdf4['json']({'code':0x0,'sucCount':_0x66df11});}}),router[_0x2ecd6b(0x107)](_0x2ecd6b(0x105),(_0x4f9af1,_0x1bb2fc,_0x5a246)=>{const _0x5be2b5=_0x2ecd6b;if(dbUserTable[_0x5be2b5(0xee)](_0x4f9af1,_0x1bb2fc,_0x5be2b5(0xe4),_0x5be2b5(0xc2))==!![]){let _0x47f675=_0x4f9af1[_0x5be2b5(0xf3)][_0x5be2b5(0xce)],_0x381077=_0x4f9af1[_0x5be2b5(0xf3)][_0x5be2b5(0xe2)],_0x52bffc=dbOrdinaryAlbumTable[_0x5be2b5(0xf6)](_0x4f9af1[_0x5be2b5(0xcc)][_0x5be2b5(0xd5)],_0x381077);if(!_0x52bffc)return _0x1bb2fc[_0x5be2b5(0xdb)]({'code':0x1,'message':_0x5be2b5(0xd7)});if(_0x47f675&&_0x47f675['length']>0x0){let _0xf1af48='(';for(let _0x2f40fe=0x0;_0x2f40fe<_0x47f675[_0x5be2b5(0x101)];_0x2f40fe++){let _0x5f1dde=_0x47f675[_0x2f40fe],_0x4a72dd=dbFileIndexTable[_0x5be2b5(0xf6)](_0x4f9af1[_0x5be2b5(0xcc)][_0x5be2b5(0xd5)],_0x5f1dde);if(!_0x4a72dd)continue;_0xf1af48+=_0x5f1dde,_0x2f40fe!=_0x47f675[_0x5be2b5(0x101)]-0x1&&(_0xf1af48+=',');}_0xf1af48+=')';let _0x533404=dbOrdinaryAlbumTable[_0x5be2b5(0xd0)](_0x4f9af1['app']['dbFileIndex'],_0x381077,_0xf1af48);_0x1bb2fc['json']({'code':0x0,'sucCount':_0x533404['changes']});}else _0x1bb2fc[_0x5be2b5(0xdb)]({'code':0x0,'sucCount':0x0});}}),router['post'](_0x2ecd6b(0xe6),(_0x4bc38f,_0x286bd6,_0x2834e1)=>{const _0x3a65ef=_0x2ecd6b;if(dbUserTable[_0x3a65ef(0xee)](_0x4bc38f,_0x286bd6,_0x3a65ef(0xe4),_0x3a65ef(0xea))==!![]){let _0x483f10=_0x4bc38f[_0x3a65ef(0xf3)][_0x3a65ef(0x108)],_0x20c521=_0x4bc38f['body'][_0x3a65ef(0xe2)],_0x3e3844=dbOrdinaryAlbumTable[_0x3a65ef(0xf6)](_0x4bc38f[_0x3a65ef(0xcc)][_0x3a65ef(0xd5)],_0x20c521);if(!_0x3e3844)return _0x286bd6[_0x3a65ef(0xdb)]({'code':0x1,'message':_0x3a65ef(0xd7)});let _0x38f2ef=dbFileIndexTable[_0x3a65ef(0xf6)](_0x4bc38f[_0x3a65ef(0xcc)][_0x3a65ef(0xd5)],_0x483f10);if(!_0x38f2ef)return _0x286bd6[_0x3a65ef(0xdb)]({'code':0x1,'message':_0x3a65ef(0xe8)});return dbOrdinaryAlbumTable[_0x3a65ef(0xd1)](_0x4bc38f[_0x3a65ef(0xcc)]['dbFileIndex'],_0x20c521,_0x483f10),_0x286bd6[_0x3a65ef(0xdb)]({'code':0x0});}}),module[_0x2ecd6b(0xe1)]=router;