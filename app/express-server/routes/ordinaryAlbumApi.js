const _0x5c2049=_0x30e9;function _0x30e9(_0x24ec12,_0x10879b){const _0xc96a97=_0xc96a();return _0x30e9=function(_0x30e9bf,_0x13c375){_0x30e9bf=_0x30e9bf-0xea;let _0x3dfa24=_0xc96a97[_0x30e9bf];return _0x3dfa24;},_0x30e9(_0x24ec12,_0x10879b);}(function(_0x3ecfd,_0x356288){const _0x1aba00=_0x30e9,_0x3834ff=_0x3ecfd();while(!![]){try{const _0x354129=parseInt(_0x1aba00(0x105))/0x1*(-parseInt(_0x1aba00(0xf9))/0x2)+parseInt(_0x1aba00(0xf7))/0x3*(parseInt(_0x1aba00(0x102))/0x4)+parseInt(_0x1aba00(0x115))/0x5+parseInt(_0x1aba00(0x133))/0x6*(-parseInt(_0x1aba00(0x12a))/0x7)+-parseInt(_0x1aba00(0x132))/0x8+-parseInt(_0x1aba00(0x107))/0x9+-parseInt(_0x1aba00(0x111))/0xa*(-parseInt(_0x1aba00(0xed))/0xb);if(_0x354129===_0x356288)break;else _0x3834ff['push'](_0x3834ff['shift']());}catch(_0x2b930a){_0x3834ff['push'](_0x3834ff['shift']());}}}(_0xc96a,0xdd762));var express=require('express'),router=express[_0x5c2049(0x103)]();function _0xc96a(){const _0xd7fbb8=['index\x20id\x20invalid','power_change','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','app','asc','6151816kcidbC','51306ozTzsL','desc','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','orderType','power_delete','whereStr','913wXmjKy','offset','orderField','length','lastInsertRowid','count','power_get','push','/getAllAlbum','returnErrMsg','3kFpjtk','udpateName','424WcLHHU','operation\x20fail','udpateCover','status','\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201','addIndexToAlbum','getById','post','json','1219252mwNEVt','Router','getPathAll','4842PpEiSK','search','14048928zbpJCs','imgList','body','/deleteAlbum','includes','currentUser','getList','share','albumId','doUserCanGet','303580RqsAgO','INDEX_TABLE_NAME_PHOTO','/deleteFromAlbum','../../db/dbOrdinaryAlbumTable','7751075BOeUmo','../../db/dbUserTable','album\x20id\x20invalid','/addAlbum','\x20AND\x20id=?','/addToAlbum','index_id','indexId','getIndexByWhere','name','changes','getUserPathWhere','photo','indexIdArr','exports','dbFileIndex','id\x20not\x20exist','delete','power_add','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','username','91IiKxSB','../../db/dbFileIndexTable','paramsList'];_0xc96a=function(){return _0xd7fbb8;};return _0xc96a();}const dbFileIndexTable=require(_0x5c2049(0x12b)),dbUserTable=require(_0x5c2049(0x116)),dbOrdinaryAlbumTable=require(_0x5c2049(0x114));router[_0x5c2049(0x100)](_0x5c2049(0x118),(_0x217c08,_0x48b691,_0x44a7d9)=>{const _0x458531=_0x5c2049;if(dbUserTable[_0x458531(0x110)](_0x217c08,_0x48b691,'photo',_0x458531(0x127))==!![]){let _0x158fb6=_0x217c08[_0x458531(0x109)][_0x458531(0x11e)],_0x5c8b10=_0x217c08[_0x458531(0x109)]['parentPath'],_0x299f5b=_0x217c08[_0x458531(0x109)][_0x458531(0x10e)];_0x299f5b!='1'&&(_0x299f5b='0');let _0xcc7fab=dbOrdinaryAlbumTable['getByName'](_0x217c08[_0x458531(0x130)][_0x458531(0x124)],_0x158fb6);if(_0xcc7fab)return _0x217c08['app'][_0x458531(0xf6)](_0x48b691,_0x48b691['__']('album.sameNameExist'));let _0x12319a=dbOrdinaryAlbumTable['create'](_0x217c08[_0x458531(0x130)][_0x458531(0x124)],{'name':_0x158fb6,'username':_0x217c08[_0x458531(0x10c)][_0x458531(0x129)],'share':_0x299f5b});if(_0x12319a[_0x458531(0x11f)]>0x0){if(_0x5c8b10){let _0x4235e8=_0x12319a[_0x458531(0xf1)];if(_0x4235e8){let _0x543a89=dbFileIndexTable[_0x458531(0x104)](_0x217c08[_0x458531(0x130)][_0x458531(0x124)],_0x5c8b10,dbFileIndexTable[_0x458531(0x112)],'id');for(let _0x24bc47 in _0x543a89){dbOrdinaryAlbumTable['addIndexToAlbum'](_0x217c08[_0x458531(0x130)][_0x458531(0x124)],{'album_id':_0x4235e8,'index_id':_0x543a89[_0x24bc47]['id']});}}}_0x48b691[_0x458531(0x101)]({'code':0x0,'result':_0x12319a});}else _0x48b691[_0x458531(0x101)]({'code':0x1,'message':_0x458531(0xfa)});}}),router[_0x5c2049(0x100)](_0x5c2049(0x10a),(_0x1bc977,_0x41a333,_0x4e1691)=>{const _0xad1695=_0x5c2049;let _0x34ceae=_0x1bc977[_0xad1695(0x109)]['id'],_0x558b09=dbOrdinaryAlbumTable[_0xad1695(0xff)](_0x1bc977[_0xad1695(0x130)][_0xad1695(0x124)],_0x34ceae);if(!_0x558b09)return _0x1bc977[_0xad1695(0x130)]['returnErrMsg'](_0x41a333,_0xad1695(0x125));if(_0x558b09['username']==_0x1bc977['currentUser'][_0xad1695(0x129)]||dbUserTable[_0xad1695(0x110)](_0x1bc977,_0x41a333,_0xad1695(0x121),_0xad1695(0xeb))==!![]){let _0x1760cb=dbOrdinaryAlbumTable[_0xad1695(0x126)](_0x1bc977['app'][_0xad1695(0x124)],_0x34ceae);_0x1760cb['changes']>0x0?_0x41a333[_0xad1695(0x101)]({'code':0x0,'result':_0x1760cb}):_0x41a333[_0xad1695(0x101)]({'code':0x1,'message':_0xad1695(0xfa)});}}),router[_0x5c2049(0x100)]('/updateAlbum',(_0x273224,_0x5969d8,_0x6ebbda)=>{const _0x1418ae=_0x5c2049;let _0x196b9f=_0x273224[_0x1418ae(0x109)]['id'],_0x94de98=dbOrdinaryAlbumTable[_0x1418ae(0xff)](_0x273224[_0x1418ae(0x130)][_0x1418ae(0x124)],_0x196b9f);if(!_0x94de98)return _0x273224[_0x1418ae(0x130)][_0x1418ae(0xf6)](_0x5969d8,_0x1418ae(0x125));if(_0x94de98['username']==_0x273224['currentUser'][_0x1418ae(0x129)]||dbUserTable[_0x1418ae(0x110)](_0x273224,_0x5969d8,_0x1418ae(0x121),_0x1418ae(0x12e))==!![]){let _0x31cdd5=_0x273224[_0x1418ae(0x109)][_0x1418ae(0x11e)],_0x2dc20d=_0x273224['body'][_0x1418ae(0x10e)];_0x2dc20d!='1'&&(_0x2dc20d='0');let _0x2b35f3=dbOrdinaryAlbumTable[_0x1418ae(0xf8)](_0x273224[_0x1418ae(0x130)][_0x1418ae(0x124)],_0x196b9f,_0x31cdd5,_0x2dc20d);_0x2b35f3[_0x1418ae(0x11f)]>0x0?_0x5969d8[_0x1418ae(0x101)]({'code':0x0,'result':_0x2b35f3}):_0x5969d8[_0x1418ae(0x101)]({'code':0x1,'message':_0x1418ae(0xfa)});}}),router[_0x5c2049(0x100)](_0x5c2049(0xf5),(_0x5a9d77,_0x146532,_0x43b0a5)=>{const _0x344958=_0x5c2049;if(dbUserTable[_0x344958(0x110)](_0x5a9d77,_0x146532,'photo',_0x344958(0xf3))==!![]){let _0x37bc72=dbUserTable[_0x344958(0x120)](_0x5a9d77,_0x344958(0x121),_0x344958(0xf3),!![]),_0x4e900d=_0x5a9d77[_0x344958(0x109)][_0x344958(0xf2)]||0x14,_0x5876e0=_0x5a9d77['body'][_0x344958(0xee)]||0x0,_0x1a8127=_0x5a9d77[_0x344958(0x109)][_0x344958(0xef)]||'id',_0x458e8f=_0x5a9d77[_0x344958(0x109)][_0x344958(0xea)]||'desc',_0x29523d=_0x5a9d77[_0x344958(0x109)][_0x344958(0x106)];(![_0x344958(0x11e),'id']['includes'](_0x1a8127)||![_0x344958(0x131),_0x344958(0x134)][_0x344958(0x10b)](_0x458e8f))&&_0x146532[_0x344958(0x101)]({'code':0x0,'data':[]});let _0x194a16=dbOrdinaryAlbumTable[_0x344958(0x10d)](_0x5a9d77[_0x344958(0x130)][_0x344958(0x124)],_0x4e900d,_0x5876e0,_0x1a8127,_0x458e8f,_0x29523d),_0x24a917=_0x194a16;if(_0x5a9d77['currentUser']['is_admin']!=0x1){_0x24a917=[];for(let _0xcd31ad=0x0;_0xcd31ad<_0x194a16[_0x344958(0xf0)];_0xcd31ad++){let _0x5f3ab0=_0x194a16[_0xcd31ad];(_0x5f3ab0[_0x344958(0x10e)]==0x1||_0x5f3ab0['username']==_0x5a9d77[_0x344958(0x10c)][_0x344958(0x129)])&&_0x24a917[_0x344958(0xf4)](_0x5f3ab0);}}for(let _0x224941=0x0;_0x224941<_0x24a917[_0x344958(0xf0)];_0x224941++){let _0x188dd0='\x20\x20is_file=1\x20';_0x188dd0+=_0x37bc72[_0x344958(0xec)];let _0x5af479=[..._0x37bc72[_0x344958(0x12c)]],_0x41b4fa=dbOrdinaryAlbumTable[_0x344958(0x11d)](_0x5a9d77[_0x344958(0x130)][_0x344958(0x124)],_0x344958(0xfd),[_0x24a917[_0x224941]['id']]);!_0x41b4fa&&(_0x41b4fa=dbOrdinaryAlbumTable[_0x344958(0x11d)](_0x5a9d77[_0x344958(0x130)][_0x344958(0x124)],_0x344958(0x128),[_0x24a917[_0x224941]['id']]));if(_0x41b4fa){let _0x33cfe9=dbFileIndexTable[_0x344958(0xff)](_0x5a9d77['app'][_0x344958(0x124)],_0x41b4fa[_0x344958(0x11b)]);_0x33cfe9&&_0x33cfe9['in_trash']!=0x1&&(_0x188dd0+=_0x344958(0x119),_0x5af479[_0x344958(0xf4)](parseInt(_0x41b4fa[_0x344958(0x11b)])));}else{_0x24a917[_0x224941][_0x344958(0x108)]=[];continue;}_0x188dd0+=_0x344958(0x135),_0x188dd0+=_0x344958(0x12f);let _0x3ff416=dbFileIndexTable['getAllByWhere'](_0x5a9d77[_0x344958(0x130)][_0x344958(0x124)],_0x188dd0,'*',dbFileIndexTable[_0x344958(0x112)],_0x5af479);_0x24a917[_0x224941][_0x344958(0x108)]=_0x3ff416;}_0x146532['json']({'code':0x0,'data':_0x24a917});}}),router[_0x5c2049(0x100)](_0x5c2049(0x11a),(_0x1b6ae5,_0x56634d,_0x59f89f)=>{const _0x51f452=_0x5c2049;if(dbUserTable[_0x51f452(0x110)](_0x1b6ae5,_0x56634d,'photo','power_add')==!![]){let _0x28023c=_0x1b6ae5[_0x51f452(0x109)][_0x51f452(0x122)],_0x6e4b7d=_0x1b6ae5[_0x51f452(0x109)][_0x51f452(0x10f)],_0x7bb59d=dbOrdinaryAlbumTable[_0x51f452(0xff)](_0x1b6ae5[_0x51f452(0x130)][_0x51f452(0x124)],_0x6e4b7d);if(!_0x7bb59d)return _0x56634d[_0x51f452(0xfc)](0x194)['end']();let _0x48b936=0x0;if(_0x28023c&&_0x28023c[_0x51f452(0xf0)]>0x0)for(let _0x50a329=0x0;_0x50a329<_0x28023c['length'];_0x50a329++){let _0x156ac0=_0x28023c[_0x50a329],_0x457e57=dbFileIndexTable[_0x51f452(0xff)](_0x1b6ae5['app'][_0x51f452(0x124)],_0x156ac0);if(!_0x457e57)continue;let _0x24eb29=dbOrdinaryAlbumTable[_0x51f452(0xfe)](_0x1b6ae5[_0x51f452(0x130)][_0x51f452(0x124)],{'album_id':_0x6e4b7d,'index_id':_0x156ac0});_0x24eb29[_0x51f452(0x11f)]>0x0&&(_0x48b936+=0x1);}_0x56634d[_0x51f452(0x101)]({'code':0x0,'sucCount':_0x48b936});}}),router['post'](_0x5c2049(0x113),(_0x32d96b,_0x3f76a7,_0xcc5082)=>{const _0x409b09=_0x5c2049;if(dbUserTable[_0x409b09(0x110)](_0x32d96b,_0x3f76a7,_0x409b09(0x121),_0x409b09(0xeb))==!![]){let _0x3738ef=_0x32d96b[_0x409b09(0x109)][_0x409b09(0x122)],_0x8a06cf=_0x32d96b['body'][_0x409b09(0x10f)],_0x343c91=dbOrdinaryAlbumTable[_0x409b09(0xff)](_0x32d96b[_0x409b09(0x130)]['dbFileIndex'],_0x8a06cf);if(!_0x343c91)return _0x3f76a7[_0x409b09(0x101)]({'code':0x1,'message':_0x409b09(0x117)});if(_0x3738ef&&_0x3738ef[_0x409b09(0xf0)]>0x0){let _0x5d1354='(';for(let _0x5d7f39=0x0;_0x5d7f39<_0x3738ef[_0x409b09(0xf0)];_0x5d7f39++){let _0x583510=_0x3738ef[_0x5d7f39],_0x417558=dbFileIndexTable[_0x409b09(0xff)](_0x32d96b[_0x409b09(0x130)]['dbFileIndex'],_0x583510);if(!_0x417558)continue;_0x5d1354+=_0x583510,_0x5d7f39!=_0x3738ef[_0x409b09(0xf0)]-0x1&&(_0x5d1354+=',');}_0x5d1354+=')';let _0x7d8ec3=dbOrdinaryAlbumTable['deleteIndexFromAlbum'](_0x32d96b[_0x409b09(0x130)][_0x409b09(0x124)],_0x8a06cf,_0x5d1354);_0x3f76a7['json']({'code':0x0,'sucCount':_0x7d8ec3['changes']});}else _0x3f76a7['json']({'code':0x0,'sucCount':0x0});}}),router[_0x5c2049(0x100)]('/setAlbumCover',(_0xca360c,_0x6e3a57,_0x4a8d6d)=>{const _0x1432f0=_0x5c2049;if(dbUserTable[_0x1432f0(0x110)](_0xca360c,_0x6e3a57,_0x1432f0(0x121),_0x1432f0(0x12e))==!![]){let _0x3abf2e=_0xca360c[_0x1432f0(0x109)][_0x1432f0(0x11c)],_0x480065=_0xca360c['body'][_0x1432f0(0x10f)],_0x2b9bee=dbOrdinaryAlbumTable['getById'](_0xca360c[_0x1432f0(0x130)][_0x1432f0(0x124)],_0x480065);if(!_0x2b9bee)return _0x6e3a57[_0x1432f0(0x101)]({'code':0x1,'message':_0x1432f0(0x117)});let _0x46f535=dbFileIndexTable['getById'](_0xca360c[_0x1432f0(0x130)][_0x1432f0(0x124)],_0x3abf2e);if(!_0x46f535)return _0x6e3a57[_0x1432f0(0x101)]({'code':0x1,'message':_0x1432f0(0x12d)});return dbOrdinaryAlbumTable[_0x1432f0(0xfb)](_0xca360c[_0x1432f0(0x130)]['dbFileIndex'],_0x480065,_0x3abf2e),_0x6e3a57['json']({'code':0x0});}}),module[_0x5c2049(0x123)]=router;