const _0x5f977e=_0x3920;(function(_0x294ee6,_0x43af3e){const _0x31101e=_0x3920,_0x27d108=_0x294ee6();while(!![]){try{const _0xe9a38f=parseInt(_0x31101e(0xf7))/0x1*(-parseInt(_0x31101e(0x14d))/0x2)+parseInt(_0x31101e(0x10c))/0x3+parseInt(_0x31101e(0x127))/0x4*(-parseInt(_0x31101e(0xa4))/0x5)+-parseInt(_0x31101e(0x10f))/0x6+parseInt(_0x31101e(0xc6))/0x7+parseInt(_0x31101e(0x89))/0x8*(-parseInt(_0x31101e(0xd9))/0x9)+parseInt(_0x31101e(0x152))/0xa;if(_0xe9a38f===_0x43af3e)break;else _0x27d108['push'](_0x27d108['shift']());}catch(_0x5b0e86){_0x27d108['push'](_0x27d108['shift']());}}}(_0x4e6a,0x9d57d));let express=require(_0x5f977e(0x115)),router=express['Router'](),path=require(_0x5f977e(0xdc)),fs=require('fs'),sha256=require(_0x5f977e(0x8d)),fileUtil=require(_0x5f977e(0x121));const sharp=require(_0x5f977e(0xc8)),os=require('os');function _0x3920(_0x36c148,_0x1fdb24){const _0x4e6a2b=_0x4e6a();return _0x3920=function(_0x3920d5,_0x44a379){_0x3920d5=_0x3920d5-0x85;let _0x40f785=_0x4e6a2b[_0x3920d5];return _0x40f785;},_0x3920(_0x36c148,_0x1fdb24);}function _0x4e6a(){const _0x48831a=['json','zip\x20finish','8048999PjEWJS','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','sharp','stack','sameNameFileAlreadExist','W_OK','/deleteByPath','noReadPermission','fileFullPath','cwd','power_add','TYPE_RENMAE','stringify','extname','DELETE\x20FROM\x20share_temp\x20WHERE\x20id\x20=\x20?\x20and\x20user_id=?','fullPath','/getTempShare','checkPower','ctimeMs','981PNrYhB','destroy','cut','path','doUserCanGet','lastInsertRowid','floor','decodePath','stat','R_OK','length','photo','FILE_OPERATION','sourceFolderPhoto','query','shell','Downloads','/clearOperationRecord','customHomeBgImage','basename','access','/fileExist','pathName','message','/rawFile*','.sys','/Users','samba','directory','Unable\x20to\x20read\x20file','97756ehjTnP','constants','cachePathRoot','res\x20closed,destroy\x20zip\x20stream','size','userDataFolder','trash','createTime','Documents','filename','type','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20REPLACE\x20INTO\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path_mount(type,url,name,username,password,remark)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES(?,?,?,?,?,?)','delete','../../utils/encodingUtil','subType','prepare','data','end','log','isDirectory','book','1184274VLFFBc','getByPage','darwin','1740996oGQDTe','/operationFolder','setHeader','music','result','returnDealedFile','express','archiver','rename','.zip','INSERT\x20INTO\x20share_temp(path,password,token,create_timestamp,end_timestamp,user_id)\x20VALUES(?,?,?,?,?,?)','run','STATE_SUC','children','returnFileError','$RECYCLE.BIN','toUpperCase','win32','../utils/fileUtils','sourceFolderMusic','download','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?','getPathByType','charAt','8vJwSNJ','/addNewFolder','An\x20error\x20occurred\x20while\x20compressing\x20the\x20files.','/operationFileList','getWindowsDiskList','sourcePathList','readdir','then','test','unpipe','../../utils/globalInfoUtil','add','../../db/dbFileOperationRecord','returnErrMsg','quality','getExcludePathList','/checkFolderPower','power_get','START_WORKER_FILE_OPERATION','toLowerCase','$WinREAgent','post','DELETE\x20FROM\x20share_temp\x20WHERE\x20id\x20=\x20?','parse','createReadStream','/tempShare','404','birthtimeMs','endsWith','deleteSuccess','shareToken','SELECT\x20*\x20FROM\x20share_temp','join','.tmp','getTempShareObj','sourceFolderBook','slice','../../myConfig/config','2RXECny','attachment;\x20filename*=UTF-8\x27\x27','isFile','app','cannotCopyToSelf','2971390zkHxXh','sourcePath','normalize','resolve','localeCompare','LEVEL_MAIN_OPERATION','/getPathTree','dbOther','includes','delete\x20from\x20path_mount\x20where\x20id=?','power_delete','findByTitleParamsList','removeHeader','findByTitle','sep','localPathIsFolder','folder','searchStr','doUserCanGetTempShare','custom','/getPathState','$Recycle.Bin','push','level','checkPath','is_admin','get','atimeMs','Content-Disposition','folderName','7736RnzEWQ','local','close','parent','sha256','Convert\x20to\x20utf8\x20','error','copy','read','status','startsWith','env','../../db/dbSourceFolderTable','STATE_FAIL','exports','root','folderPath','pipe','parentPath','existsSync','username','all','url','days','SELECT\x20*\x20FROM\x20share_temp\x20where\x20user_id=?','getTransSizeStr','password','1759880GsxQfG','/getTempShareFiles','deleteId','utf8','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','send','operationType','replace','no\x20permission\x20','name','deleteFileRecordAll','currentUser','code','mtimeMs','targetPath','../../db/dbUserTable','addFileOperationRecord','../../db/dbNoticeCenterTable','EXIST','fileRenameFail','operationFail','append','System\x20Volume\x20Information','body','Documents\x20and\x20Settings','headersSent','TYPE_DELETE','sizeStr','sort','/operationPathMount','targetPathInvalid','raw'];_0x4e6a=function(){return _0x48831a;};return _0x4e6a();}let platform=os['platform']();const dbUserTable=require(_0x5f977e(0xb3)),dbNoticeCenterTable=require(_0x5f977e(0xb5)),dbConfigTable=require('../../db/dbConfigTable'),dbSourceFolderTable=require(_0x5f977e(0x95)),dbFileOperationRecord=require(_0x5f977e(0x133)),fileStatUtil=require('../../utils/fileStatUtil'),config=require(_0x5f977e(0x14c)),sharpUtil=require('../utils/sharpUtils'),globalInfoUtil=require(_0x5f977e(0x131)),archiver=require(_0x5f977e(0x116)),encodingUtil=require(_0x5f977e(0x104));let macPowerDetected=![],win32ExcludeList=[_0x5f977e(0xba),_0x5f977e(0x167),_0x5f977e(0x11e),_0x5f977e(0x13b),_0x5f977e(0xbc),'PerfLogs'];router['get']('/zipFile/*',(_0x9b8cbe,_0x5d6e41,_0x59e3dc)=>{const _0x1a8e7c=_0x5f977e;if(!_0x9b8cbe[_0x1a8e7c(0xe7)]['path'])return _0x5d6e41[_0x1a8e7c(0x92)](0x194)['end']();let _0x2d8416=fileUtil[_0x1a8e7c(0xe0)](_0x9b8cbe[_0x1a8e7c(0xe7)][_0x1a8e7c(0xdc)]),_0x302c67=_0x9b8cbe['query'][_0x1a8e7c(0x100)];_0x302c67&&(_0x2d8416=path[_0x1a8e7c(0x147)](_0x2d8416,_0x302c67)),dbUserTable[_0x1a8e7c(0xdd)](_0x9b8cbe,_0x5d6e41,'',_0x1a8e7c(0x138),_0x2d8416)==!![]&&fs[_0x1a8e7c(0xe1)](_0x2d8416,(_0x382efc,_0x4ee4fc)=>{const _0x198aca=_0x1a8e7c;if(_0x382efc)return _0x5d6e41[_0x198aca(0x92)](0x194)[_0x198aca(0x108)]();let _0x18c7e0=path[_0x198aca(0xec)](_0x2d8416)+_0x198aca(0x118);try{const _0x29c12b=encodeURIComponent(_0x18c7e0)[_0x198aca(0xab)](/%([0-9A-F]{2})/g,(_0x58bb7e,_0x65596e)=>'%'+_0x65596e[_0x198aca(0x11f)]());_0x5d6e41[_0x198aca(0x111)]('Content-Disposition','attachment;\x20filename*=UTF-8\x27\x27'+_0x29c12b);}catch(_0x37febe){console[_0x198aca(0x109)](_0x37febe);}const _0x1c90cf=archiver('zip',{'zlib':{'level':0x0}});_0x1c90cf['on'](_0x198aca(0x8f),function(_0x52d28a){const _0x3097e8=_0x198aca;console[_0x3097e8(0x109)]('zip\x20error',_0x52d28a[_0x3097e8(0xf0)]||_0x52d28a[_0x3097e8(0xc9)]),_0x1c90cf[_0x3097e8(0x130)](),!_0x5d6e41[_0x3097e8(0xbd)]?(_0x5d6e41[_0x3097e8(0x15e)](_0x3097e8(0x87)),_0x5d6e41[_0x3097e8(0x92)](0x1f4)['send'](_0x3097e8(0x129))):_0x5d6e41[_0x3097e8(0xda)]();}),_0x1c90cf['on'](_0x198aca(0x108),function(){const _0x6b1dd6=_0x198aca;console[_0x6b1dd6(0x109)](_0x6b1dd6(0xc5)),_0x1c90cf[_0x6b1dd6(0xda)]();});try{fs[_0x198aca(0x12d)](_0x2d8416,(_0x2b1a2b,_0x38176d)=>{const _0x4f08c4=_0x198aca;for(let _0x18dd9f in _0x38176d){let _0x3b26a0=_0x38176d[_0x18dd9f];const _0x3fd12d=path[_0x4f08c4(0x147)](_0x2d8416,_0x3b26a0);let _0x91fdd4=fs['statSync'](_0x3fd12d);_0x91fdd4[_0x4f08c4(0x10a)]()?_0x1c90cf[_0x4f08c4(0xf5)](_0x3fd12d,_0x3b26a0):_0x1c90cf[_0x4f08c4(0xb9)](fs[_0x4f08c4(0x13f)](_0x3fd12d),{'name':_0x3b26a0});}_0x1c90cf['finalize'](),_0x1c90cf[_0x4f08c4(0x9a)](_0x5d6e41);});}catch(_0x1f05cb){!_0x5d6e41[_0x198aca(0xbd)]&&_0x5d6e41[_0x198aca(0x92)](0x1f4)[_0x198aca(0xa9)]({'error':'An\x20error\x20occurred\x20while\x20reading\x20the\x20directory.'}),console[_0x198aca(0x8f)](_0x1f05cb);}_0x5d6e41['on'](_0x198aca(0x8b),()=>{const _0x4e0d6d=_0x198aca;console[_0x4e0d6d(0x109)](_0x4e0d6d(0xfa)),_0x1c90cf[_0x4e0d6d(0xda)]();});});}),router[_0x5f977e(0x13c)](_0x5f977e(0x158),(_0x306a75,_0x638d38,_0x25ec81)=>{const _0x2b8cd3=_0x5f977e;let _0x3aaa6d=_0x306a75[_0x2b8cd3(0xbb)][_0x2b8cd3(0x8c)],_0x463de0=path['sep'],_0x10b3e6=_0x306a75[_0x2b8cd3(0xbb)][_0x2b8cd3(0x101)],_0x5e83ef=_0x306a75[_0x2b8cd3(0xbb)][_0x2b8cd3(0x163)],_0x83972d=[],_0x14afda=parseInt(_0x306a75['currentUser']['is_admin'])==0x1;platform=='win32'&&_0x3aaa6d&&_0x3aaa6d['length']>0x4&&_0x3aaa6d['endsWith'](path['sep'])&&(_0x3aaa6d=_0x3aaa6d[_0x2b8cd3(0x14b)](0x0,-0x1));let _0x4a1ed0=fileUtil[_0x2b8cd3(0x136)](_0x306a75[_0x2b8cd3(0x150)]['dbOther']);try{function _0x2f2914(){const _0x24a4e9=_0x2b8cd3;let _0x263572=dbUserTable['getUserPower'](_0x306a75[_0x24a4e9(0x150)][_0x24a4e9(0x159)],_0x306a75['currentUser'][_0x24a4e9(0x9d)],_0x24a4e9(0x162),_0x24a4e9(0x138));for(let _0x45e0cb of _0x263572){if(_0x4a1ed0[_0x24a4e9(0x15a)](_0x45e0cb['path']))continue;_0x83972d[_0x24a4e9(0x168)]({'type':0x2,'name':_0x45e0cb['path'],'fileFullPath':_0x45e0cb[_0x24a4e9(0xdc)]});}return _0x638d38[_0x24a4e9(0xc4)]({'code':0x0,'data':{'parent':'','children':_0x83972d,'sep':_0x463de0,'platform':platform}});}if(!_0x3aaa6d){if(_0x14afda){if(platform==_0x2b8cd3(0x120)){function _0x5b1549(_0x50a99a){const _0x1d8ee2=_0x2b8cd3;let _0x4c4edf=[];for(let _0x37743c of _0x50a99a){if(_0x4a1ed0[_0x1d8ee2(0x15a)](_0x37743c['name']))continue;_0x37743c['type']=0x2,_0x4c4edf[_0x1d8ee2(0x168)](_0x37743c);}for(let _0x791076 in _0x4c4edf){_0x4c4edf[_0x791076][_0x1d8ee2(0xce)]=_0x4c4edf[_0x791076][_0x1d8ee2(0xad)];}return _0x638d38[_0x1d8ee2(0xc4)]({'code':0x0,'data':{'parent':_0x3aaa6d,'children':_0x4c4edf,'sep':path[_0x1d8ee2(0x160)],'platform':platform}});}let _0x48a675=dbConfigTable[_0x2b8cd3(0x15f)](_0x306a75[_0x2b8cd3(0x150)][_0x2b8cd3(0x159)],'cachePathRoot');if(_0x48a675)try{_0x48a675=JSON[_0x2b8cd3(0x13e)](_0x48a675['value']),_0x359174(![]),_0x5b1549(_0x48a675);}catch(_0x1362c2){_0x359174(!![]);}else _0x359174(!![]);function _0x359174(_0x4a399d){const _0x4f1837=_0x2b8cd3;globalInfoUtil[_0x4f1837(0x12b)](_0x3d8d63=>{const _0x154d24=_0x4f1837;_0x3d8d63=_0x3d8d63[_0x154d24(0xc0)]((_0x1479a4,_0xdb743e)=>{const _0x56f318=_0x154d24;if(!_0x1479a4[_0x56f318(0xad)]||!_0xdb743e[_0x56f318(0xad)])return;return _0x1479a4['name'][_0x56f318(0x156)](_0xdb743e[_0x56f318(0xad)]);}),dbConfigTable['create'](_0x306a75[_0x154d24(0x150)][_0x154d24(0x159)],{'title':_0x154d24(0xf9),'value':JSON[_0x154d24(0xd2)](_0x3d8d63)}),_0x4a399d&&_0x5b1549(_0x3d8d63);});}}else{if(platform==_0x2b8cd3(0x10e)){if(!macPowerDetected){macPowerDetected=!![];try{const _0x176eb4=process[_0x2b8cd3(0x94)]['USER'];let _0x964419=[path[_0x2b8cd3(0x147)](_0x2b8cd3(0xf3),_0x176eb4,_0x2b8cd3(0xff)),path[_0x2b8cd3(0x147)](_0x2b8cd3(0xf3),_0x176eb4,_0x2b8cd3(0xe9)),path[_0x2b8cd3(0x147)](_0x2b8cd3(0xf3),_0x176eb4,'Desktop')];for(let _0x19588c in _0x964419){fs['stat'](_0x964419[_0x19588c],(_0x2e1bed,_0x108c66)=>{});}}catch(_0x493f8b){}}let _0x28f339=path[_0x2b8cd3(0x13e)](process[_0x2b8cd3(0xcf)]())[_0x2b8cd3(0x98)];_0xd2321(_0x28f339);}else _0x3aaa6d=path[_0x2b8cd3(0x13e)](process[_0x2b8cd3(0xcf)]())[_0x2b8cd3(0x98)],_0xd2321(_0x3aaa6d);}}else return _0x2f2914();}else _0xd2321(_0x3aaa6d);function _0xd2321(_0x237937){const _0xa95f8e=_0x2b8cd3;if(!_0x14afda){if(!dbUserTable[_0xa95f8e(0xdd)](_0x306a75,_0x638d38,_0xa95f8e(0x162),_0xa95f8e(0x138),_0x237937,!![]))return console[_0xa95f8e(0x109)]('未授权',_0x237937),_0x2f2914();}if(_0x237937==_0xa95f8e(0xe6)||_0x237937=='sourceFolderMovie'||_0x237937==_0xa95f8e(0x122)||_0x237937=='sourceFolderBook'){let _0x501f20=_0xa95f8e(0xe4);if(_0x237937=='sourceFolderMovie')_0x501f20='movie';else{if(_0x237937==_0xa95f8e(0x122))_0x501f20=_0xa95f8e(0x112);else _0x237937==_0xa95f8e(0x14a)&&(_0x501f20=_0xa95f8e(0x10b));}let _0x132a48=dbSourceFolderTable[_0xa95f8e(0x125)](_0x306a75[_0xa95f8e(0x150)][_0xa95f8e(0x159)],_0x501f20);for(let _0x4d4333 in _0x132a48){_0x83972d[_0xa95f8e(0x168)]({'type':0x2,'name':path['basename'](_0x132a48[_0x4d4333][_0xa95f8e(0xdc)]),'fileFullPath':_0x132a48[_0x4d4333][_0xa95f8e(0xdc)]});}return _0x638d38['json']({'code':0x0,'data':{'parent':_0x237937,'children':_0x83972d,'sep':_0x463de0,'platform':platform}});}fs[_0xa95f8e(0x12d)](_0x237937,{'withFileTypes':!![]},(_0x2dc8fc,_0x3ceffb)=>{const _0x60620b=_0xa95f8e;if(_0x2dc8fc)return console[_0x60620b(0x109)](_0x2dc8fc),fileUtil[_0x60620b(0x11d)](_0x638d38,_0x2dc8fc);for(let _0x41ff88=0x0;_0x41ff88<_0x3ceffb[_0x60620b(0xe3)];_0x41ff88++){let _0x26de7f=_0x3ceffb[_0x41ff88],_0x2b67cb=_0x3ceffb[_0x41ff88][_0x60620b(0xad)];if(_0x2b67cb[_0x60620b(0xe3)]>0x0){if(_0x2b67cb[0x0]=='.')continue;if(/[A-Z]:\\/i['test'](_0x237937)&&_0x237937[_0x60620b(0xe3)]<=0x3){if(win32ExcludeList[_0x60620b(0x15a)](_0x2b67cb)||_0x2b67cb[_0x60620b(0x143)]('.sys')||_0x2b67cb['endsWith'](_0x60620b(0x148)))continue;}}let _0x555156=path[_0x60620b(0x147)](_0x237937,_0x2b67cb);if(_0x4a1ed0[_0x60620b(0x15a)](_0x555156))continue;let _0x599f89=_0x26de7f[_0x60620b(0x14f)](),_0x37ccc0=_0x26de7f[_0x60620b(0x10a)]();function _0x1204df(){const _0x97f012=_0x60620b;if(_0x599f89)(_0x10b3e6==0x0||_0x10b3e6==0x1)&&_0x83972d[_0x97f012(0x168)]({'type':0x1,'name':_0x2b67cb,'fileFullPath':_0x555156});else _0x37ccc0&&_0x83972d[_0x97f012(0x168)]({'type':0x2,'name':_0x2b67cb,'fileFullPath':_0x555156});}_0x5e83ef?_0x2b67cb[_0x60620b(0x15a)](_0x5e83ef)&&_0x1204df():_0x1204df();try{if(_0x83972d[_0x60620b(0xe3)]>0x1770)break;}catch(_0x3f5633){continue;}}let _0x40edf6=_0x83972d['length'],_0x31265e=0x0;if(_0x83972d[_0x60620b(0xe3)]<0x1)return _0x638d38['json']({'code':0x0,'data':{'parent':_0x237937,'children':_0x83972d,'sep':_0x463de0,'platform':platform}});for(let _0x3e8be6 of _0x83972d){fs[_0x60620b(0xe1)](_0x3e8be6['fileFullPath'],(_0x5870a5,_0x30e8cb)=>{const _0x51f47a=_0x60620b;_0x31265e+=0x1;!_0x5870a5&&(_0x3e8be6[_0x51f47a(0x86)]=_0x30e8cb['atimeMs'],_0x3e8be6[_0x51f47a(0xb1)]=_0x30e8cb[_0x51f47a(0xb1)],_0x3e8be6['birthtimeMs']=_0x30e8cb[_0x51f47a(0x142)],_0x3e8be6[_0x51f47a(0xfb)]=_0x30e8cb[_0x51f47a(0xfb)]);if(_0x31265e>=_0x40edf6)return _0x638d38[_0x51f47a(0xc4)]({'code':0x0,'data':{'parent':_0x237937,'children':_0x83972d,'sep':_0x463de0,'platform':platform}});});}});}}catch(_0x50da0c){return console['log'](_0x50da0c),fileUtil['returnFileError'](_0x638d38,_0x50da0c);}}),router['get']('/customImageFile',(_0x2683ec,_0x557198,_0x13dc3f)=>{const _0x7f2eec=_0x5f977e;let _0x3efdce=fileUtil['decodePath'](_0x2683ec[_0x7f2eec(0xe7)][_0x7f2eec(0xdc)]);if(!_0x3efdce)return _0x557198[_0x7f2eec(0x92)](0x194)[_0x7f2eec(0x108)]();_0x3efdce=path[_0x7f2eec(0x155)](path[_0x7f2eec(0x154)](_0x3efdce));let _0x5c05d3=path[_0x7f2eec(0x147)](config[_0x7f2eec(0xfc)],_0x7f2eec(0x165),path[_0x7f2eec(0x160)]);return _0x3efdce[_0x7f2eec(0x93)](_0x5c05d3)?_0x557198['sendFile'](_0x3efdce):(console['log'](_0x7f2eec(0x141)),_0x557198[_0x7f2eec(0x92)](0x194)[_0x7f2eec(0x108)]());}),router[_0x5f977e(0x85)](_0x5f977e(0xf1),(_0xa7af87,_0x14d189,_0x39e008)=>{const _0x2eebe2=_0x5f977e;let _0x5bbe56=_0xa7af87[_0x2eebe2(0xe7)][_0x2eebe2(0xdc)],_0x3d82db=_0xa7af87[_0x2eebe2(0xe7)][_0x2eebe2(0x123)]==0x1,_0x1f6180=fileUtil['decodePath'](_0x5bbe56),_0x1b4d47=_0xa7af87[_0x2eebe2(0xe7)][_0x2eebe2(0xfb)],_0x497960=_0xa7af87[_0x2eebe2(0xe7)][_0x2eebe2(0x135)];if(dbUserTable[_0x2eebe2(0xdd)](_0xa7af87,_0x14d189,'',_0x2eebe2(0x138),_0x1f6180)==!![])try{let _0x18e28a=_0xa7af87[_0x2eebe2(0xe7)][_0x2eebe2(0xc3)];if(_0x18e28a&&_0x18e28a==0x1){if(_0x3d82db){const _0xa8c7f7=encodeURIComponent(path['basename'](_0x1f6180))['replace'](/%([0-9A-F]{2})/g,(_0x3cadaa,_0xe3ac9b)=>'%'+_0xe3ac9b[_0x2eebe2(0x11f)]());_0x14d189[_0x2eebe2(0x111)](_0x2eebe2(0x87),_0x2eebe2(0x14e)+_0xa8c7f7);}return _0x14d189['sendFile'](_0x1f6180);}else _0xa7af87[_0x2eebe2(0xe7)]['code']&&_0xa7af87['query'][_0x2eebe2(0xb0)]==_0x2eebe2(0xa7)&&path[_0x2eebe2(0xd3)](_0x1f6180)&&path[_0x2eebe2(0xd3)](_0x1f6180)[_0x2eebe2(0x13a)]()=='.txt'?(console['log'](_0x2eebe2(0x8e),_0x1f6180),encodingUtil['getUtf8FileStream'](_0x1f6180)[_0x2eebe2(0x12e)](_0x52e7ab=>{const _0x5049e4=_0x2eebe2;return _0x52e7ab?_0x52e7ab[_0x5049e4(0x9a)](_0x14d189):(console[_0x5049e4(0x109)](_0x5049e4(0xf6),_0x1f6180),_0x14d189['sendFile'](_0x1f6180));})):sharpUtil[_0x2eebe2(0x114)](_0x14d189,_0x1f6180,_0x3d82db,_0x1b4d47,_0x497960);}catch(_0x1da454){return console[_0x2eebe2(0x109)](_0x1da454),fileUtil[_0x2eebe2(0x11d)](_0x14d189,_0x1da454);}}),router['post'](_0x5f977e(0x137),(_0x4980bf,_0xbc8172,_0x39aa30)=>{const _0x2a949d=_0x5f977e;let _0x487e25=fileUtil[_0x2a949d(0xe0)](_0x4980bf[_0x2a949d(0xbb)][_0x2a949d(0x16a)]),_0x4e9909=_0x4980bf[_0x2a949d(0xbb)][_0x2a949d(0xd7)];if(_0x4e9909=='write')_0x4e9909=fs[_0x2a949d(0xf8)]['W_OK'];else _0x4e9909==_0x2a949d(0x91)&&(_0x4e9909=fs[_0x2a949d(0xf8)]['R_OK']);try{_0x4e9909==_0x2a949d(0x9e)?fs['access'](_0x487e25,fs[_0x2a949d(0xf8)][_0x2a949d(0xcb)],_0x273dee=>{const _0x5b7463=_0x2a949d;if(_0x273dee)return fileUtil[_0x5b7463(0x11d)](_0xbc8172,_0x273dee);return _0xbc8172[_0x5b7463(0xc4)]({'code':0x0,'access':!![]});}):fs[_0x2a949d(0xed)](_0x487e25,_0x4e9909,_0x1e0cb5=>{if(_0x1e0cb5)return fileUtil['returnFileError'](_0xbc8172,_0x1e0cb5);return _0xbc8172['json']({'code':0x0,'access':!![]});});}catch(_0x5f59f6){return _0xbc8172[_0x2a949d(0xc4)]({'code':0x0,'access':![]});}}),router[_0x5f977e(0x13c)](_0x5f977e(0x128),(_0x8864d,_0x59595d,_0x206953)=>{const _0x1dedd5=_0x5f977e;let _0x24b059=fileUtil[_0x1dedd5(0xe0)](_0x8864d[_0x1dedd5(0xbb)][_0x1dedd5(0x9b)]),_0xb57c0d=_0x8864d[_0x1dedd5(0xbb)][_0x1dedd5(0x88)],_0x5ec1db=path[_0x1dedd5(0x147)](_0x24b059,_0xb57c0d);if(dbUserTable[_0x1dedd5(0xdd)](_0x8864d,_0x59595d,'folder','power_add',_0x5ec1db)==!![])try{fs[_0x1dedd5(0xe1)](_0x5ec1db,_0x364fe4=>{const _0x24d420=_0x1dedd5;if(!_0x364fe4)return _0x8864d['app'][_0x24d420(0x134)](_0x59595d,_0x59595d['__'](_0x24d420(0xca))+':'+_0x5ec1db);else fs['mkdir'](_0x5ec1db,{'recursive':!![]},_0x18053d=>{const _0x5847dd=_0x24d420;return _0x18053d?fileUtil[_0x5847dd(0x11d)](_0x59595d,_0x18053d):_0x59595d[_0x5847dd(0xc4)]({'code':0x0});});});}catch(_0x18c48d){return fileUtil['returnFileError'](_0x59595d,_0x18c48d);}}),router[_0x5f977e(0x13c)]('/zipFile',(_0x5715ba,_0x5871b9,_0x242fef)=>{const _0x348a4e=_0x5f977e;let _0x400481=_0x5715ba[_0x348a4e(0xbb)][_0x348a4e(0x153)],_0x4637f7=_0x5715ba['body']['targetPath'],_0x5b9c4f=_0x5715ba[_0x348a4e(0xbb)][_0x348a4e(0x101)];if(_0x5b9c4f!='zip'&&_0x5b9c4f!='unzip')return _0x5715ba[_0x348a4e(0x150)]['returnErrMsg'](_0x5871b9,_0x5871b9['__'](_0x348a4e(0xb8)));if(dbUserTable['doUserCanGet'](_0x5715ba,_0x5871b9,_0x348a4e(0x162),_0x348a4e(0x138),_0x400481)==!![]&&dbUserTable['doUserCanGet'](_0x5715ba,_0x5871b9,_0x348a4e(0x162),_0x348a4e(0xd0),_0x4637f7)==!![]){let _0x1b22f7=_0x5715ba[_0x348a4e(0x150)]['dbOther'][_0x348a4e(0x106)]('INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)')[_0x348a4e(0x11a)]('FILE_OPERATION',JSON[_0x348a4e(0xd2)]({'sourcePath':_0x400481,'targetPath':_0x4637f7,'type':_0x5b9c4f,'username':_0x5715ba['currentUser'][_0x348a4e(0x9d)]}));return process[_0x348a4e(0xa9)]({'type':_0x348a4e(0x139),'taskIdList':[_0x1b22f7[_0x348a4e(0xde)]]}),_0x5871b9[_0x348a4e(0xc4)]({'code':0x0});}}),router[_0x5f977e(0x13c)](_0x5f977e(0x12a),(_0x52f7d2,_0x2de117,_0x38f9d4)=>{const _0x45ae90=_0x5f977e;let _0x54c2ca=_0x52f7d2[_0x45ae90(0xbb)][_0x45ae90(0x12c)],_0x10c176=_0x52f7d2['body'][_0x45ae90(0xb2)],_0x4abe4c=_0x52f7d2['body']['type'];if(_0x54c2ca['length']<0x1)return _0x52f7d2['app'][_0x45ae90(0x134)](_0x2de117,_0x2de117['__'](_0x45ae90(0xb8)));if(dbUserTable[_0x45ae90(0xdd)](_0x52f7d2,_0x2de117,_0x45ae90(0x162),_0x45ae90(0x138),_0x54c2ca[0x0])==!![]&&dbUserTable[_0x45ae90(0xdd)](_0x52f7d2,_0x2de117,'folder',_0x45ae90(0xd0),_0x10c176)==!![])try{let _0x41b0d9=[];for(let _0x19e538 in _0x54c2ca){let _0x325eec=_0x54c2ca[_0x19e538],_0x32f416=path['basename'](_0x325eec),_0x20cbc9=path[_0x45ae90(0x147)](_0x10c176,_0x32f416),_0x338dd9=_0x52f7d2[_0x45ae90(0x150)][_0x45ae90(0x159)][_0x45ae90(0x106)](_0x45ae90(0xc7))[_0x45ae90(0x11a)]('FILE_OPERATION',JSON[_0x45ae90(0xd2)]({'sourcePath':_0x325eec,'targetPath':_0x20cbc9,'type':_0x4abe4c,'username':_0x52f7d2[_0x45ae90(0xaf)][_0x45ae90(0x9d)]}));_0x41b0d9['push'](_0x338dd9[_0x45ae90(0xde)]);}return process['send']({'type':_0x45ae90(0x139),'taskIdList':_0x41b0d9}),_0x2de117[_0x45ae90(0xc4)]({'code':0x0});}catch(_0x20f8c6){return _0x52f7d2[_0x45ae90(0x150)]['returnErrMsg'](_0x2de117,_0x2de117['__'](_0x45ae90(0xb8)));}}),router[_0x5f977e(0x13c)](_0x5f977e(0x110),(_0x27030f,_0x3e34e3,_0x492e78)=>{const _0x1ffccd=_0x5f977e;let _0x58da6c=fileUtil[_0x1ffccd(0xe0)](_0x27030f[_0x1ffccd(0xbb)][_0x1ffccd(0x153)]),_0x123387=fileUtil[_0x1ffccd(0xe0)](_0x27030f[_0x1ffccd(0xbb)][_0x1ffccd(0xb2)]),_0x3100c8=path[_0x1ffccd(0xec)](_0x58da6c),_0xadeb2b=_0x27030f[_0x1ffccd(0xbb)][_0x1ffccd(0x101)],_0x1ac57e=path[_0x1ffccd(0x147)](_0x123387,_0x3100c8);if(_0xadeb2b==_0x1ffccd(0x90)||_0xadeb2b=='cut'){if(fs[_0x1ffccd(0x9c)](_0x1ac57e))return _0x27030f[_0x1ffccd(0x150)][_0x1ffccd(0x134)](_0x3e34e3,_0x3e34e3['__']('sameNameFileAlreadExist')+':'+_0x1ac57e);}let _0x1a2965=_0x27030f[_0x1ffccd(0xbb)]['newName'];function _0xe1f16d(_0xf4ce54,_0x1f0112){const _0xb90153=_0x1ffccd;let _0x16f7cc=_0x27030f[_0xb90153(0x150)][_0xb90153(0x159)][_0xb90153(0x106)](_0xb90153(0xc7))[_0xb90153(0x11a)](_0xb90153(0xe5),JSON[_0xb90153(0xd2)]({'sourcePath':_0xf4ce54,'targetPath':_0x1f0112,'type':_0xadeb2b,'username':_0x27030f['currentUser'][_0xb90153(0x9d)]}));return _0x16f7cc[_0xb90153(0xde)];}try{_0x58da6c=path['join'](_0x58da6c),_0x123387=path[_0x1ffccd(0x147)](_0x123387);if(_0x123387==_0x58da6c||_0x123387[_0x1ffccd(0x93)](_0x58da6c+path[_0x1ffccd(0x160)]))return _0x27030f['app']['returnErrMsg'](_0x3e34e3,_0x3e34e3['__'](_0x1ffccd(0x151)));if(dbUserTable['doUserCanGet'](_0x27030f,_0x3e34e3,'folder',_0x1ffccd(0x138),_0x58da6c)==!![]){let _0x5b56d9=![];fs[_0x1ffccd(0xe1)](_0x58da6c,(_0x3a939a,_0x2523de)=>{const _0x7d0200=_0x1ffccd;if(_0x3a939a)return _0x27030f[_0x7d0200(0x150)][_0x7d0200(0x134)](_0x3e34e3,_0x3e34e3['__'](_0x7d0200(0xcd))+':'+_0x58da6c);let _0x44e358=path[_0x7d0200(0xec)](_0x58da6c);fs[_0x7d0200(0xed)](_0x123387,fs['constants'][_0x7d0200(0xe2)]|fs[_0x7d0200(0xf8)]['W_OK'],_0x318e74=>{const _0x54355f=_0x7d0200;if(_0x318e74)return _0x27030f[_0x54355f(0x150)]['returnErrMsg'](_0x3e34e3,_0x3e34e3['__']('noWritePermission')+':'+_0x123387);if(_0xadeb2b==_0x54355f(0x117))dbUserTable[_0x54355f(0xdd)](_0x27030f,_0x3e34e3,_0x54355f(0x162),'power_change',_0x123387)==!![]&&(_0x123387=path[_0x54355f(0x147)](_0x123387,_0x1a2965),fs[_0x54355f(0xe1)](_0x123387,_0x19255c=>{const _0x44ed0c=_0x54355f;if(!_0x19255c)return _0x27030f['app'][_0x44ed0c(0x134)](_0x3e34e3,_0x3e34e3['__'](_0x44ed0c(0xca))+':'+_0x123387);else fs[_0x44ed0c(0x117)](_0x58da6c,_0x123387,_0x33215d=>{const _0x294417=_0x44ed0c;if(_0x33215d)return dbFileOperationRecord[_0x294417(0xb4)](_0x27030f[_0x294417(0x150)]['dbOther'],{'username':_0x27030f[_0x294417(0xaf)][_0x294417(0x9d)],'sourcePath':_0x58da6c,'targetPath':_0x123387,'level':dbFileOperationRecord[_0x294417(0x157)],'belongId':null,'type':dbFileOperationRecord[_0x294417(0xd1)],'subType':null,'state':dbFileOperationRecord[_0x294417(0x96)],'remark':fileUtil[_0x294417(0x11d)](_0x3e34e3,_0x33215d,!![])}),dbNoticeCenterTable['create'](_0x27030f[_0x294417(0x150)][_0x294417(0x159)],{'title':_0x3e34e3['__'](_0x294417(0xb8)),'level':_0x294417(0x8f),'content':_0x3e34e3['__'](_0x294417(0xb7))+':'+(_0x58da6c+'\x20->\x20'+_0x123387)});_0x5b56d9=!![],dbFileOperationRecord[_0x294417(0xb4)](_0x27030f['app'][_0x294417(0x159)],{'username':_0x27030f[_0x294417(0xaf)]['username'],'sourcePath':_0x58da6c,'targetPath':_0x123387,'level':dbFileOperationRecord[_0x294417(0x157)],'belongId':null,'type':dbFileOperationRecord[_0x294417(0xd1)],'subType':null,'state':dbFileOperationRecord[_0x294417(0x11b)]});}),setTimeout(()=>{const _0x173d70=_0x44ed0c;return _0x3e34e3[_0x173d70(0xc4)]({'code':0x0,'isOver':_0x5b56d9?0x1:0x0});},0x3e8);}));else{if(_0xadeb2b==_0x54355f(0xdb)){if(dbUserTable[_0x54355f(0xdd)](_0x27030f,_0x3e34e3,'folder',_0x54355f(0x15c),_0x123387)!==!![])return;}if(dbUserTable[_0x54355f(0xdd)](_0x27030f,_0x3e34e3,_0x54355f(0x162),_0x54355f(0xd0),_0x123387)==!![]){_0x123387=path[_0x54355f(0x147)](_0x123387,_0x44e358);let _0x37ef53=_0xe1f16d(_0x58da6c,_0x123387);return process['send']({'type':_0x54355f(0x139),'taskIdList':[_0x37ef53]}),_0x3e34e3[_0x54355f(0xc4)]({'code':0x0});}}});});}}catch(_0x1b8bad){return _0x27030f[_0x1ffccd(0x150)]['returnErrMsg'](_0x3e34e3,_0x3e34e3['__'](_0x1ffccd(0xb8)));}}),router['post'](_0x5f977e(0x166),(_0x2469bd,_0x392fe5,_0x1a2c8b)=>{const _0x2fb53c=_0x5f977e;let _0x365edf=_0x2469bd[_0x2fb53c(0xbb)][_0x2fb53c(0xd5)];if(!_0x365edf)return _0x392fe5[_0x2fb53c(0x92)](0x194)[_0x2fb53c(0x108)]();dbUserTable[_0x2fb53c(0xdd)](_0x2469bd,_0x392fe5,_0x2fb53c(0x162),_0x2fb53c(0x138),_0x365edf)==!![]&&fs[_0x2fb53c(0xe1)](_0x365edf,(_0x102f76,_0x518da7)=>{const _0x259f68=_0x2fb53c;if(_0x102f76)return fileUtil[_0x259f68(0x11d)](_0x392fe5,_0x102f76);return _0x518da7[_0x259f68(0xbf)]=fileUtil[_0x259f68(0xa2)](_0x518da7[_0x259f68(0xfb)]),_0x392fe5[_0x259f68(0xc4)]({'code':0x0,'data':_0x518da7});});}),router[_0x5f977e(0x13c)](_0x5f977e(0xee),(_0xc5c57e,_0x56844e,_0x1f7c87)=>{const _0x46b40d=_0x5f977e;let _0x20597a=_0xc5c57e[_0x46b40d(0xbb)][_0x46b40d(0x99)],_0x18b4cd=_0xc5c57e[_0x46b40d(0xbb)]['fileName'];_0x18b4cd&&(_0x18b4cd=_0x18b4cd[_0x46b40d(0xab)](/[<>\\\/:\*\?\"\|]/g,'_')),_0x20597a&&(_0x20597a=fileUtil[_0x46b40d(0xe0)](_0x20597a)),fs[_0x46b40d(0xed)](_0x20597a,fs[_0x46b40d(0xf8)]['W_OK']|fs[_0x46b40d(0xf8)][_0x46b40d(0xe2)],_0x46d5d7=>{const _0x1e51e5=_0x46b40d;if(_0x46d5d7)return _0x56844e[_0x1e51e5(0xc4)]({'code':0x1,'message':_0x56844e['__']('noWritePermission')+':'+_0x20597a});else{let _0x185175='';if(_0x20597a&&_0x18b4cd)_0x185175=path[_0x1e51e5(0x147)](_0x20597a,_0x18b4cd);else{if(_0x20597a)_0x185175=path[_0x1e51e5(0x147)](_0x20597a);else return _0x56844e[_0x1e51e5(0xc4)]({'code':0x1,'message':_0x56844e['__']('folderNotExist')+':'+_0x20597a});}fs[_0x1e51e5(0xe1)](_0x185175,_0x4c17b1=>{const _0x293f5a=_0x1e51e5;return _0x4c17b1?_0x56844e[_0x293f5a(0xc4)]({'code':0x0}):_0x56844e[_0x293f5a(0xc4)]({'code':0x1,'remark':_0x293f5a(0xb6)});});}});}),router[_0x5f977e(0x13c)](_0x5f977e(0xcc),(_0x17a1eb,_0x2b4efe,_0x3cc846)=>{const _0x5c44ee=_0x5f977e;let _0x36f845=_0x17a1eb['body'][_0x5c44ee(0xd5)],_0x714826=_0x17a1eb[_0x5c44ee(0xbb)]['putInSystemTrash'];if(!_0x36f845)return _0x2b4efe['status'](0x194)[_0x5c44ee(0x108)]();_0x36f845=path[_0x5c44ee(0x147)](_0x36f845);if(dbUserTable[_0x5c44ee(0xdd)](_0x17a1eb,_0x2b4efe,_0x5c44ee(0x162),_0x5c44ee(0x15c),_0x36f845)==!![]){if(_0x714826==0x1)return process[_0x5c44ee(0xa9)]({'type':_0x5c44ee(0xe8),'shellType':_0x5c44ee(0xfd),'path':_0x36f845}),dbFileOperationRecord[_0x5c44ee(0xb4)](_0x17a1eb[_0x5c44ee(0x150)]['dbOther'],{'username':_0x17a1eb[_0x5c44ee(0xaf)][_0x5c44ee(0x9d)],'targetPath':_0x36f845,'level':dbFileOperationRecord[_0x5c44ee(0x157)],'type':dbFileOperationRecord['TYPE_DELETE'],'state':dbFileOperationRecord[_0x5c44ee(0x11b)]}),_0x2b4efe[_0x5c44ee(0xc4)]({'code':0x0,'message':_0x2b4efe['__'](_0x5c44ee(0x144))});else fs['rm'](_0x36f845,{'recursive':!![]},_0x2815aa=>{const _0x2132a4=_0x5c44ee;if(_0x2815aa)return dbFileOperationRecord[_0x2132a4(0xb4)](_0x17a1eb[_0x2132a4(0x150)][_0x2132a4(0x159)],{'username':_0x17a1eb[_0x2132a4(0xaf)][_0x2132a4(0x9d)],'targetPath':_0x36f845,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x2132a4(0xbe)],'state':dbFileOperationRecord[_0x2132a4(0x96)],'remark':fileUtil[_0x2132a4(0x11d)](_0x2b4efe,_0x2815aa,!![])}),fileUtil[_0x2132a4(0x11d)](_0x2b4efe,_0x2815aa);return dbFileOperationRecord[_0x2132a4(0xb4)](_0x17a1eb[_0x2132a4(0x150)][_0x2132a4(0x159)],{'username':_0x17a1eb[_0x2132a4(0xaf)][_0x2132a4(0x9d)],'targetPath':_0x36f845,'level':dbFileOperationRecord[_0x2132a4(0x157)],'type':dbFileOperationRecord[_0x2132a4(0xbe)],'state':dbFileOperationRecord[_0x2132a4(0x11b)]}),_0x2b4efe['json']({'code':0x0,'message':_0x2b4efe['__']('deleteSuccess')});});}}),router[_0x5f977e(0x13c)](_0x5f977e(0xea),(_0x3f77db,_0x19e08e,_0xf526ee)=>{const _0x4c7799=_0x5f977e;if(_0x3f77db[_0x4c7799(0xaf)]['is_admin']!=0x1)return _0x19e08e[_0x4c7799(0xc4)]({'code':0x66});return dbFileOperationRecord[_0x4c7799(0xae)](_0x3f77db[_0x4c7799(0x150)][_0x4c7799(0x159)]),_0x19e08e[_0x4c7799(0xc4)]({'code':0x0});}),router['post']('/getOperationRecord',(_0x480a64,_0x37b11d,_0x566d21)=>{const _0x597d54=_0x5f977e;let _0x34bbe6=_0x480a64[_0x597d54(0xbb)]['page'],_0x39d571=_0x480a64[_0x597d54(0xbb)]['pageSize'],_0x24a558=_0x480a64[_0x597d54(0xbb)]['type'],_0x5ddb13=_0x480a64[_0x597d54(0xbb)][_0x597d54(0x169)],_0x150078=_0x480a64[_0x597d54(0xbb)][_0x597d54(0x105)],_0x22686b=_0x480a64['body'][_0x597d54(0x113)],_0x5b49e7=_0x480a64[_0x597d54(0xbb)][_0x597d54(0x163)],_0x1cf338;return _0x480a64['currentUser'][_0x597d54(0x16b)]==0x1?_0x1cf338=dbFileOperationRecord['getByPage'](_0x480a64[_0x597d54(0x150)]['dbOther'],_0x34bbe6,_0x39d571,_0x5ddb13,_0x24a558,_0x150078,_0x22686b,_0x5b49e7):_0x1cf338=dbFileOperationRecord[_0x597d54(0x10d)](_0x480a64[_0x597d54(0x150)][_0x597d54(0x159)],_0x34bbe6,_0x39d571,_0x5ddb13,_0x24a558,_0x150078,_0x22686b,_0x5b49e7,_0x480a64[_0x597d54(0xaf)][_0x597d54(0x9d)]),_0x37b11d['json']({'code':0x0,'data':_0x1cf338});}),router['post'](_0x5f977e(0xc1),(_0xcd43e,_0x4c3f98,_0x3a65c1)=>{const _0x5408a3=_0x5f977e;let _0x4fc2b9=_0xcd43e['body']['operationType'];if(_0x4fc2b9==_0x5408a3(0x132)||_0x4fc2b9=='delete'){if(_0xcd43e['currentUser'][_0x5408a3(0x16b)]!=0x1)return _0x4c3f98[_0x5408a3(0xc4)]({'code':0x66});}if(_0x4fc2b9==_0x5408a3(0x132)){let _0xc3462f=_0xcd43e['body'][_0x5408a3(0x101)],_0x43d6e7=_0xcd43e[_0x5408a3(0xbb)][_0x5408a3(0x9f)],_0x414e48=_0xcd43e['body']['username'],_0x13e067=_0xcd43e['body'][_0x5408a3(0xef)],_0x3acd33=_0xcd43e[_0x5408a3(0xbb)][_0x5408a3(0x9d)],_0x43eb9a=_0xcd43e[_0x5408a3(0xbb)][_0x5408a3(0xa3)],_0xcc1766=[_0x5408a3(0x8a),'webdav',_0x5408a3(0xf4)];if(!_0xc3462f||!_0x43d6e7||!_0xcc1766['includes'](_0xc3462f))return _0xcd43e[_0x5408a3(0x150)][_0x5408a3(0x134)](_0x4c3f98,_0x4c3f98['__']('operationFail'));_0xc3462f==_0x5408a3(0x8a)&&fileStatUtil[_0x5408a3(0x161)](_0x43d6e7,()=>{fileStatUtil['localPathIsReadable'](_0x43d6e7,()=>{const _0x48c563=_0x3920,_0x1913c9=_0x48c563(0x102);return _0xcd43e[_0x48c563(0x150)]['dbOther'][_0x48c563(0x106)](_0x1913c9)[_0x48c563(0x11a)](_0xc3462f,_0x43d6e7,_0x414e48,_0x3acd33,_0x43eb9a,_0x13e067),_0x4c3f98[_0x48c563(0xc4)]({'code':0x0});},()=>{const _0x4dac11=_0x3920;return _0xcd43e[_0x4dac11(0x150)]['returnErrMsg'](_0x4c3f98,_0x4c3f98['__'](_0x4dac11(0xcd)));});},()=>{const _0x594cdf=_0x5408a3;return _0xcd43e['app'][_0x594cdf(0x134)](_0x4c3f98,_0x4c3f98['__'](_0x594cdf(0xc2)));});}else{if(_0x4fc2b9==_0x5408a3(0x103)){let _0x6ae596=_0xcd43e[_0x5408a3(0xbb)]['id'];return _0xcd43e[_0x5408a3(0x150)][_0x5408a3(0x159)][_0x5408a3(0x106)](_0x5408a3(0x15b))[_0x5408a3(0x11a)](_0x6ae596),_0x4c3f98['json']({'code':0x0});}else{if(_0x4fc2b9=='get'){let _0x21dd3a=[],_0x346eef=_0xcd43e[_0x5408a3(0x150)]['dbOther'][_0x5408a3(0x106)]('select\x20id,type,url,name,remark\x20from\x20path_mount')[_0x5408a3(0x9e)]();if(_0xcd43e['currentUser'][_0x5408a3(0x16b)]==0x1)_0x21dd3a=_0x346eef;else{let _0x282ab0=dbUserTable['getUserPower'](_0xcd43e[_0x5408a3(0x150)]['dbOther'],_0xcd43e['currentUser'][_0x5408a3(0x9d)],_0x5408a3(0x162),_0x5408a3(0x138));for(let _0x36d347 in _0x282ab0){let _0x379422=_0x282ab0[_0x36d347][_0x5408a3(0xdc)][_0x5408a3(0x13a)]();_0x379422=path[_0x5408a3(0x147)](_0x379422);for(let _0x1e7ef0 in _0x346eef){try{if(_0x346eef[_0x1e7ef0][_0x5408a3(0x9f)]&&_0x379422){let _0x335e98=_0x346eef[_0x1e7ef0][_0x5408a3(0x9f)][_0x5408a3(0x13a)]();_0x335e98[_0x5408a3(0x143)](':')&&_0x335e98[_0x5408a3(0xe3)]==0x2&&(_0x335e98=_0x335e98+path[_0x5408a3(0x160)]),_0x335e98=path[_0x5408a3(0x147)](_0x335e98)[_0x5408a3(0x13a)](),(_0x379422==_0x335e98||_0x335e98['startsWith'](path[_0x5408a3(0x147)](_0x379422+path[_0x5408a3(0x160)])))&&_0x21dd3a[_0x5408a3(0x168)](_0x346eef[_0x1e7ef0]);}}catch(_0x4cdfa5){continue;}}}}return _0x4c3f98[_0x5408a3(0xc4)]({'code':0x0,'data':_0x21dd3a});}}}});function getRandomString(_0x2f2add){const _0x49bcc2=_0x5f977e;let _0x4bc910='';const _0x5df598=_0x49bcc2(0xa8),_0xc38a3f=_0x5df598[_0x49bcc2(0xe3)];for(let _0x570063=0x0;_0x570063<_0x2f2add;_0x570063++){_0x4bc910+=_0x5df598[_0x49bcc2(0x126)](Math[_0x49bcc2(0xdf)](Math['random']()*_0xc38a3f));}return _0x4bc910;}router[_0x5f977e(0x13c)](_0x5f977e(0xd6),(_0x2674d9,_0x33e698,_0x26ec05)=>{const _0x2980e3=_0x5f977e;let _0x470f70=[];return _0x2674d9['currentUser'][_0x2980e3(0x16b)]==0x1?_0x470f70=_0x2674d9[_0x2980e3(0x150)][_0x2980e3(0x159)]['prepare'](_0x2980e3(0x146))[_0x2980e3(0x9e)]():_0x470f70=_0x2674d9[_0x2980e3(0x150)][_0x2980e3(0x159)][_0x2980e3(0x106)](_0x2980e3(0xa1))['all'](_0x2674d9[_0x2980e3(0xaf)]['id']),_0x33e698[_0x2980e3(0xc4)]({'code':0x0,'data':_0x470f70});}),router[_0x5f977e(0x13c)](_0x5f977e(0x140),(_0x47a2a4,_0x377d78,_0x35fe91)=>{const _0x1db769=_0x5f977e;let _0x4c15ad=_0x47a2a4[_0x1db769(0xbb)][_0x1db769(0xaa)];if(_0x4c15ad==_0x1db769(0x132))try{if(!_0x47a2a4[_0x1db769(0xbb)][_0x1db769(0xdc)])return _0x47a2a4[_0x1db769(0x150)][_0x1db769(0x134)](_0x377d78,_0x1db769(0x8f));let _0x4d6d11=fileUtil[_0x1db769(0xe0)](_0x47a2a4[_0x1db769(0xbb)]['path']);_0x4d6d11=path[_0x1db769(0x147)](_0x4d6d11);function _0x4ba3c4(){const _0x9d4053=_0x1db769;if(dbUserTable[_0x9d4053(0xdd)](_0x47a2a4,_0x377d78,'',_0x9d4053(0x138),_0x4d6d11)==!![]){let _0x4bbead=_0x47a2a4[_0x9d4053(0xbb)]['password']?_0x47a2a4['body'][_0x9d4053(0xa3)]:'',_0x43dde4=new Date()['getTime'](),_0xab99a0=getRandomString(0x5),_0x3981ec=_0x47a2a4[_0x9d4053(0x150)]['dbOther'][_0x9d4053(0x106)](_0x9d4053(0x124))[_0x9d4053(0x85)](_0xab99a0);if(_0x3981ec)return _0x4ba3c4();let _0xa296c=_0x47a2a4[_0x9d4053(0xbb)]['days']?_0x47a2a4['body'][_0x9d4053(0xa0)]:0x1e,_0x3dda7f=0xe10*0x3e8*0x18*_0xa296c+_0x43dde4;return _0x47a2a4['app'][_0x9d4053(0x159)][_0x9d4053(0x106)](_0x9d4053(0x119))['run'](_0x4d6d11,_0x4bbead,_0xab99a0,_0x43dde4,_0x3dda7f,_0x47a2a4[_0x9d4053(0xaf)]['id']),_0x377d78[_0x9d4053(0xc4)]({'code':0x0,'token':_0xab99a0});}}return _0x4ba3c4();}catch(_0x5a17e8){return console[_0x1db769(0x109)](_0x5a17e8),_0x47a2a4[_0x1db769(0x150)][_0x1db769(0x134)](_0x377d78,_0x1db769(0x8f));}else{if(_0x4c15ad==_0x1db769(0x103)){let _0x5f4b61=_0x47a2a4[_0x1db769(0xbb)][_0x1db769(0xa6)];return _0x47a2a4[_0x1db769(0xaf)][_0x1db769(0x16b)]==0x1?_0x47a2a4[_0x1db769(0x150)][_0x1db769(0x159)][_0x1db769(0x106)](_0x1db769(0x13d))[_0x1db769(0x11a)](_0x5f4b61):_0x47a2a4['app'][_0x1db769(0x159)][_0x1db769(0x106)](_0x1db769(0xd4))[_0x1db769(0x11a)](_0x5f4b61,_0x47a2a4['currentUser']['id']),_0x377d78['json']({'code':0x0});}}}),router[_0x5f977e(0x13c)](_0x5f977e(0xa5),(_0x261186,_0x2c7166,_0x202b77)=>{const _0x2006a4=_0x5f977e;let _0x585210=_0x261186[_0x2006a4(0xbb)][_0x2006a4(0x145)]||_0x261186[_0x2006a4(0xbb)]['st'],_0x45c48c=_0x261186['body'][_0x2006a4(0x8c)],_0x369f68=_0x261186[_0x2006a4(0xbb)][_0x2006a4(0xa3)],_0x32adda=[],_0x448767=dbConfigTable[_0x2006a4(0x15d)](_0x261186[_0x2006a4(0x150)][_0x2006a4(0x159)],['customLogoImage',_0x2006a4(0xeb)]),_0x5603f0={'code':0x0,'data':{'customConfig':_0x448767,'parent':_0x45c48c,'children':_0x32adda,'sep':path['sep'],'platform':platform}};if(!_0x585210)return _0x2c7166[_0x2006a4(0xc4)](_0x5603f0);let _0x22c732=dbUserTable[_0x2006a4(0x149)](_0x261186['app'][_0x2006a4(0x159)],_0x585210);if(!_0x22c732)return _0x2c7166[_0x2006a4(0xc4)](_0x5603f0);if(_0x22c732['password']){if(!_0x369f68)return _0x2c7166['json']({'code':0x2});if(_0x22c732[_0x2006a4(0xa3)]!=_0x369f68)return _0x2c7166[_0x2006a4(0xc4)]({'code':0x2,'message':_0x2c7166['__']('login.pwdErr')});}function _0x2d949c(){const _0x4a7cd9=_0x2006a4;fs[_0x4a7cd9(0xe1)](_0x22c732[_0x4a7cd9(0xdc)],(_0x7f689c,_0x2c8b0a)=>{const _0x94ac6a=_0x4a7cd9;if(_0x7f689c)return _0x2c7166[_0x94ac6a(0xc4)](_0x5603f0);return _0x5603f0['data']['children'][_0x94ac6a(0x168)]({'type':_0x2c8b0a[_0x94ac6a(0x14f)]()?0x1:0x2,'name':path[_0x94ac6a(0xec)](_0x22c732['path']),'fileFullPath':_0x22c732[_0x94ac6a(0xdc)]}),_0x2c7166['json'](_0x5603f0);});}if(!_0x45c48c)_0x2d949c();else{let _0x475e7a=dbUserTable[_0x2006a4(0x164)](_0x261186[_0x2006a4(0x150)][_0x2006a4(0x159)],_0x585210,_0x45c48c,_0x369f68);if(!_0x475e7a)return console[_0x2006a4(0x109)](_0x2006a4(0xac),_0x45c48c),_0x2d949c();fs[_0x2006a4(0x12d)](_0x45c48c,{'withFileTypes':!![]},(_0x7f4581,_0x235e21)=>{const _0x4d3eb7=_0x2006a4;if(_0x7f4581)return _0x2c7166['json'](_0x5603f0);let _0x40fc0a=0x0;if(_0x235e21[_0x4d3eb7(0xe3)]<0x1)return _0x2c7166['json'](_0x5603f0);for(let _0x5504ed=0x0;_0x5504ed<_0x235e21['length'];_0x5504ed++){let _0x1f77cd=_0x235e21[_0x5504ed],_0x302e6d=_0x235e21[_0x5504ed][_0x4d3eb7(0xad)];if(_0x302e6d[_0x4d3eb7(0xe3)]>0x0){if(_0x302e6d[0x0]=='.'){_0x40fc0a+=0x1;if(_0x40fc0a>=_0x235e21[_0x4d3eb7(0xe3)])return _0x2c7166[_0x4d3eb7(0xc4)](_0x5603f0);continue;}if(/[A-Z]:\\/i[_0x4d3eb7(0x12f)](_0x45c48c)&&_0x45c48c['length']<=0x3){if(win32ExcludeList['includes'](_0x302e6d)||_0x302e6d[_0x4d3eb7(0x143)](_0x4d3eb7(0xf2))||_0x302e6d[_0x4d3eb7(0x143)](_0x4d3eb7(0x148))){_0x40fc0a+=0x1;if(_0x40fc0a>=_0x235e21[_0x4d3eb7(0xe3)])return _0x2c7166[_0x4d3eb7(0xc4)](_0x5603f0);continue;}}}let _0x147b4a=path['join'](_0x45c48c,_0x302e6d);fs[_0x4d3eb7(0xe1)](_0x147b4a,(_0x1f70b5,_0x54bcdf)=>{const _0x590102=_0x4d3eb7;_0x40fc0a+=0x1;let _0x1402e9=_0x1f77cd[_0x590102(0x14f)](),_0x335650=_0x1f77cd[_0x590102(0x10a)](),_0x169278={'name':_0x302e6d,'fileFullPath':_0x147b4a};!_0x1f70b5&&_0x54bcdf&&(_0x169278[_0x590102(0xfb)]=_0x54bcdf[_0x590102(0xfb)],_0x169278[_0x590102(0xfe)]=_0x54bcdf[_0x590102(0x142)]||_0x54bcdf[_0x590102(0xd8)]);_0x1402e9?_0x169278[_0x590102(0x101)]=0x1:_0x169278[_0x590102(0x101)]=0x2;_0x5603f0[_0x590102(0x107)][_0x590102(0x11c)]['push'](_0x169278);if(_0x40fc0a>=_0x235e21['length'])return _0x2c7166[_0x590102(0xc4)](_0x5603f0);});}});}}),module[_0x5f977e(0x97)]=router;