const _0x36f822=_0x2c5a;function _0x2455(){const _0x13db59=['Documents','USER','parent','getWindowsDiskList','180148TAoMjx','delete','/zipFile/*','value','DELETE\x20FROM\x20share_temp\x20WHERE\x20id\x20=\x20?','Downloads','replace','../../utils/fileStatUtil','addFileOperationRecord','music','attachment;\x20filename*=UTF-8\x27\x27','access','post','endsWith','An\x20error\x20occurred\x20while\x20compressing\x20the\x20files.','getExcludePathList','.tmp','System\x20Volume\x20Information','zip','../../db/dbNoticeCenterTable','statSync','customHomeBgImage','push','deleteId','random','book','mkdir','searchStr','Router','createTime','SELECT\x20*\x20FROM\x20share_temp\x20where\x20user_id=?','targetPathInvalid','sameNameFileAlreadExist','delete\x20from\x20path_mount\x20where\x20id=?','/getTempShareFiles','/fileExist','win32','pipe','findByTitle','sizeStr','decodePath','custom','/checkFolderPower','checkPath','then','root','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?','An\x20error\x20occurred\x20while\x20reading\x20the\x20directory.','finalize','operationType','STATE_SUC','Desktop','R_OK','close','quality','pathName','filename','LEVEL_MAIN_OPERATION','extname','fileFullPath','code','../../utils/globalInfoUtil','power_get','fileName','page','fullPath','readdir','PerfLogs','setHeader','cut','constants','STATE_FAIL','data','shell','power_add','Content-Disposition','returnDealedFile','atimeMs','stringify','darwin','status','/getOperationRecord','folder','localPathIsReadable','returnErrMsg','power_delete','userDataFolder','targetPath','add','EXIST','currentUser','path','\x20->\x20','newName','/tempShare','trash','/customImageFile','FILE_OPERATION','localPathIsFolder','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','toLowerCase','length','archiver','type','getTransSizeStr','1119sTLADL','copy','getPathByType','json','Documents\x20and\x20Settings','normalize','name','isFile','sourcePath','test','webdav','no\x20permission\x20','../utils/fileUtils','596118djXHZq','unpipe','deleteSuccess','get','../../db/dbUserTable','operationFail','zip\x20finish','sourceFolderBook','139625XsZzSB','zip\x20error','lastInsertRowid','parentPath','localeCompare','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','/getPathState','username','result','W_OK','size','send','cwd','DELETE\x20FROM\x20share_temp\x20WHERE\x20id\x20=\x20?\x20and\x20user_id=?','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20REPLACE\x20INTO\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path_mount(type,url,name,username,password,remark)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES(?,?,?,?,?,?)','cachePathRoot','append','dbOther','end','prepare','mtimeMs','customLogoImage','url','birthtimeMs','sort','destroy','query','download','noReadPermission','2992490VSnclU','414072NEsfaw','/operationFileList','samba','/operationFolder','ctimeMs','sourceFolderMovie','startsWith','$WinREAgent','floor','getByPage','.sys','parse','sendFile','body','charAt','getTempShareObj','run','local','headersSent','create','password','../../db/dbConfigTable','join','utf8','basename','.txt','rename','includes','SELECT\x20*\x20FROM\x20share_temp','err','doUserCanGetTempShare','$Recycle.Bin','14vmDzeR','express','shareToken','days','res\x20closed,destroy\x20zip\x20stream','is_admin','../../db/dbSourceFolderTable','log','sourcePathList','photo','app','isDirectory','toUpperCase','START_WORKER_FILE_OPERATION','createReadStream','error','sourceFolderPhoto','TYPE_RENMAE','doUserCanGet','noWritePermission','unzip','/Users','folderPath','stat','/operationPathMount','findByTitleParamsList','1142nxGLqj','all','1609308gMBhVs','5RBzhjL','sep','returnFileError','TYPE_DELETE','/getPathTree','getUserPower'];_0x2455=function(){return _0x13db59;};return _0x2455();}(function(_0x2a96f0,_0x202ba6){const _0x496608=_0x2c5a,_0x436bc4=_0x2a96f0();while(!![]){try{const _0x1dd22f=-parseInt(_0x496608(0xf5))/0x1+-parseInt(_0x496608(0x14d))/0x2*(parseInt(_0x496608(0xe0))/0x3)+-parseInt(_0x496608(0x15a))/0x4*(-parseInt(_0x496608(0x150))/0x5)+parseInt(_0x496608(0xed))/0x6+-parseInt(_0x496608(0x133))/0x7*(parseInt(_0x496608(0x113))/0x8)+parseInt(_0x496608(0x14f))/0x9+parseInt(_0x496608(0x112))/0xa;if(_0x1dd22f===_0x202ba6)break;else _0x436bc4['push'](_0x436bc4['shift']());}catch(_0x4555c3){_0x436bc4['push'](_0x436bc4['shift']());}}}(_0x2455,0x289b5));function _0x2c5a(_0x37d098,_0x40d0d3){const _0x2455a2=_0x2455();return _0x2c5a=function(_0x2c5a06,_0x5470c6){_0x2c5a06=_0x2c5a06-0xdc;let _0x24ad36=_0x2455a2[_0x2c5a06];return _0x24ad36;},_0x2c5a(_0x37d098,_0x40d0d3);}let express=require(_0x36f822(0x134)),router=express[_0x36f822(0x176)](),path=require(_0x36f822(0x1b5)),fs=require('fs'),sha256=require('sha256'),fileUtil=require(_0x36f822(0xec));const sharp=require('sharp'),os=require('os');let platform=os['platform']();const dbUserTable=require(_0x36f822(0xf1)),dbNoticeCenterTable=require(_0x36f822(0x16d)),dbConfigTable=require(_0x36f822(0x128)),dbSourceFolderTable=require(_0x36f822(0x139)),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),fileStatUtil=require(_0x36f822(0x161)),config=require('../../myConfig/config'),sharpUtil=require('../utils/sharpUtils'),globalInfoUtil=require(_0x36f822(0x197)),archiver=require(_0x36f822(0xdd)),encodingUtil=require('../../utils/encodingUtil');let macPowerDetected=![],win32ExcludeList=[_0x36f822(0x16b),_0x36f822(0x132),'$RECYCLE.BIN',_0x36f822(0x11a),_0x36f822(0xe4),_0x36f822(0x19d)];router[_0x36f822(0xf0)](_0x36f822(0x15c),(_0xf82d54,_0x6a4b93,_0x1a41f9)=>{const _0xf69f12=_0x36f822;if(!_0xf82d54[_0xf69f12(0x10f)][_0xf69f12(0x1b5)])return _0x6a4b93[_0xf69f12(0x1aa)](0x194)[_0xf69f12(0x107)]();let _0x440ad0=fileUtil[_0xf69f12(0x182)](_0xf82d54['query'][_0xf69f12(0x1b5)]),_0x45597c=_0xf82d54[_0xf69f12(0x10f)][_0xf69f12(0x192)];_0x45597c&&(_0x440ad0=path[_0xf69f12(0x129)](_0x440ad0,_0x45597c)),dbUserTable[_0xf69f12(0x145)](_0xf82d54,_0x6a4b93,'',_0xf69f12(0x198),_0x440ad0)==!![]&&fs[_0xf69f12(0x14a)](_0x440ad0,(_0x3d7456,_0x2810e5)=>{const _0xbba822=_0xf69f12;if(_0x3d7456)return _0x6a4b93['status'](0x194)[_0xbba822(0x107)]();let _0x34cbd7=path['basename'](_0x440ad0)+'.zip';try{const _0x53fc28=encodeURIComponent(_0x34cbd7)[_0xbba822(0x160)](/%([0-9A-F]{2})/g,(_0x3c3129,_0x5add54)=>'%'+_0x5add54[_0xbba822(0x13f)]());_0x6a4b93[_0xbba822(0x19e)](_0xbba822(0x1a5),_0xbba822(0x164)+_0x53fc28);}catch(_0xfa95fe){console[_0xbba822(0x13a)](_0xfa95fe);}const _0xa49dbd=archiver(_0xbba822(0x16c),{'zlib':{'level':0x0}});_0xa49dbd['on']('error',function(_0x55f23f){const _0x368e84=_0xbba822;console[_0x368e84(0x13a)](_0x368e84(0xf6),_0x55f23f['message']||_0x55f23f['stack']),_0xa49dbd[_0x368e84(0xee)](),!_0x6a4b93[_0x368e84(0x125)]?(_0x6a4b93['removeHeader'](_0x368e84(0x1a5)),_0x6a4b93[_0x368e84(0x1aa)](0x1f4)[_0x368e84(0x100)](_0x368e84(0x168))):_0x6a4b93['destroy']();}),_0xa49dbd['on'](_0xbba822(0x107),function(){const _0x167bfc=_0xbba822;console['log'](_0x167bfc(0xf3)),_0xa49dbd[_0x167bfc(0x10e)]();});try{fs[_0xbba822(0x19c)](_0x440ad0,(_0x34879c,_0x2dbcfd)=>{const _0x19252b=_0xbba822;for(let _0x59d73e in _0x2dbcfd){let _0x22d416=_0x2dbcfd[_0x59d73e];const _0x264c56=path['join'](_0x440ad0,_0x22d416);let _0x3e750a=fs[_0x19252b(0x16e)](_0x264c56);_0x3e750a[_0x19252b(0x13e)]()?_0xa49dbd['directory'](_0x264c56,_0x22d416):_0xa49dbd[_0x19252b(0x105)](fs[_0x19252b(0x141)](_0x264c56),{'name':_0x22d416});}_0xa49dbd[_0x19252b(0x18a)](),_0xa49dbd[_0x19252b(0x17f)](_0x6a4b93);});}catch(_0x59c937){!_0x6a4b93[_0xbba822(0x125)]&&_0x6a4b93['status'](0x1f4)[_0xbba822(0x100)]({'error':_0xbba822(0x189)}),console[_0xbba822(0x142)](_0x59c937);}_0x6a4b93['on'](_0xbba822(0x18f),()=>{const _0x1f2dfc=_0xbba822;console[_0x1f2dfc(0x13a)](_0x1f2dfc(0x137)),_0xa49dbd['destroy']();});});}),router[_0x36f822(0x166)](_0x36f822(0x154),(_0x117335,_0x2f5bed,_0x4ef1df)=>{const _0x37c34c=_0x36f822;let _0x2ae6ce=_0x117335[_0x37c34c(0x120)][_0x37c34c(0x158)],_0xc81dcf=path[_0x37c34c(0x151)],_0x5eff27=_0x117335[_0x37c34c(0x120)][_0x37c34c(0xde)],_0x1cc34b=_0x117335[_0x37c34c(0x120)][_0x37c34c(0x175)],_0x1fcdc2=[],_0x58759e=parseInt(_0x117335[_0x37c34c(0x1b4)][_0x37c34c(0x138)])==0x1,_0x254db6=fileUtil[_0x37c34c(0x169)](_0x117335['app'][_0x37c34c(0x106)]);try{function _0x576701(){const _0x17978f=_0x37c34c;let _0xbcf0aa=dbUserTable[_0x17978f(0x155)](_0x117335[_0x17978f(0x13d)]['dbOther'],_0x117335['currentUser'][_0x17978f(0xfc)],'folder',_0x17978f(0x198));for(let _0xa72102 of _0xbcf0aa){if(_0x254db6[_0x17978f(0x12e)](_0xa72102[_0x17978f(0x1b5)]))continue;_0x1fcdc2[_0x17978f(0x170)]({'type':0x2,'name':_0xa72102[_0x17978f(0x1b5)],'fileFullPath':_0xa72102['path']});}return _0x2f5bed[_0x17978f(0xe3)]({'code':0x0,'data':{'parent':'','children':_0x1fcdc2,'sep':_0xc81dcf,'platform':platform}});}if(!_0x2ae6ce){if(_0x58759e){if(platform==_0x37c34c(0x17e)){function _0x1c5e64(_0x319473){const _0x3af77d=_0x37c34c;let _0x59e2ab=[];for(let _0x4709d3 of _0x319473){if(_0x254db6[_0x3af77d(0x12e)](_0x4709d3[_0x3af77d(0xe6)]))continue;_0x4709d3[_0x3af77d(0xde)]=0x2,_0x59e2ab['push'](_0x4709d3);}for(let _0x329693 in _0x59e2ab){_0x59e2ab[_0x329693][_0x3af77d(0x195)]=_0x59e2ab[_0x329693]['name'];}return _0x2f5bed['json']({'code':0x0,'data':{'parent':_0x2ae6ce,'children':_0x59e2ab,'sep':path[_0x3af77d(0x151)],'platform':platform}});}let _0x2a1261=dbConfigTable[_0x37c34c(0x180)](_0x117335[_0x37c34c(0x13d)][_0x37c34c(0x106)],'cachePathRoot');if(_0x2a1261)try{_0x2a1261=JSON[_0x37c34c(0x11e)](_0x2a1261[_0x37c34c(0x15d)]),_0x2e8293(![]),_0x1c5e64(_0x2a1261);}catch(_0x301493){_0x2e8293(!![]);}else _0x2e8293(!![]);function _0x2e8293(_0x2b355c){const _0x5d3a41=_0x37c34c;globalInfoUtil[_0x5d3a41(0x159)](_0x4c77e3=>{const _0x12f82d=_0x5d3a41;_0x4c77e3=_0x4c77e3[_0x12f82d(0x10d)]((_0x452439,_0x460287)=>{const _0x45a55c=_0x12f82d;if(!_0x452439[_0x45a55c(0xe6)]||!_0x460287[_0x45a55c(0xe6)])return;return _0x452439['name'][_0x45a55c(0xf9)](_0x460287[_0x45a55c(0xe6)]);}),dbConfigTable[_0x12f82d(0x126)](_0x117335[_0x12f82d(0x13d)][_0x12f82d(0x106)],{'title':_0x12f82d(0x104),'value':JSON['stringify'](_0x4c77e3)}),_0x2b355c&&_0x1c5e64(_0x4c77e3);});}}else{if(platform==_0x37c34c(0x1a9)){if(!macPowerDetected){macPowerDetected=!![];try{const _0x4cc839=process['env'][_0x37c34c(0x157)];let _0x2fd137=[path[_0x37c34c(0x129)](_0x37c34c(0x148),_0x4cc839,_0x37c34c(0x156)),path['join'](_0x37c34c(0x148),_0x4cc839,_0x37c34c(0x15f)),path[_0x37c34c(0x129)](_0x37c34c(0x148),_0x4cc839,_0x37c34c(0x18d))];for(let _0x2a424d in _0x2fd137){fs[_0x37c34c(0x14a)](_0x2fd137[_0x2a424d],(_0x27419b,_0x5b594a)=>{});}}catch(_0x14137f){}}let _0x29ffe4=path['parse'](process[_0x37c34c(0x101)]())[_0x37c34c(0x187)];_0x47a324(_0x29ffe4);}else _0x2ae6ce=path[_0x37c34c(0x11e)](process[_0x37c34c(0x101)]())[_0x37c34c(0x187)],_0x47a324(_0x2ae6ce);}}else return _0x576701();}else _0x47a324(_0x2ae6ce);function _0x47a324(_0x37033f){const _0x2ffbbc=_0x37c34c;if(!_0x58759e){if(!dbUserTable[_0x2ffbbc(0x145)](_0x117335,_0x2f5bed,'folder',_0x2ffbbc(0x198),_0x37033f,!![]))return _0x576701();}if(_0x37033f==_0x2ffbbc(0x143)||_0x37033f=='sourceFolderMovie'||_0x37033f=='sourceFolderMusic'||_0x37033f=='sourceFolderBook'){let _0x39f785=_0x2ffbbc(0x13c);if(_0x37033f==_0x2ffbbc(0x118))_0x39f785='movie';else{if(_0x37033f=='sourceFolderMusic')_0x39f785=_0x2ffbbc(0x163);else _0x37033f==_0x2ffbbc(0xf4)&&(_0x39f785=_0x2ffbbc(0x173));}let _0x23675a=dbSourceFolderTable[_0x2ffbbc(0xe2)](_0x117335['app']['dbOther'],_0x39f785);for(let _0x42011a in _0x23675a){_0x1fcdc2[_0x2ffbbc(0x170)]({'type':0x2,'name':path[_0x2ffbbc(0x12b)](_0x23675a[_0x42011a]['path']),'fileFullPath':_0x23675a[_0x42011a]['path']});}return _0x2f5bed[_0x2ffbbc(0xe3)]({'code':0x0,'data':{'parent':_0x37033f,'children':_0x1fcdc2,'sep':_0xc81dcf,'platform':platform}});}fs[_0x2ffbbc(0x19c)](_0x37033f,{'withFileTypes':!![]},(_0x32bcc0,_0x31a96b)=>{const _0x44d62a=_0x2ffbbc;if(_0x32bcc0)return console[_0x44d62a(0x13a)](_0x32bcc0),fileUtil['returnFileError'](_0x2f5bed,_0x32bcc0);for(let _0x15c449=0x0;_0x15c449<_0x31a96b[_0x44d62a(0xdc)];_0x15c449++){let _0x47355d=_0x31a96b[_0x15c449],_0x1a3d22=_0x31a96b[_0x15c449][_0x44d62a(0xe6)];if(_0x1a3d22[_0x44d62a(0xdc)]>0x0){if(_0x1a3d22[0x0]=='.')continue;if(/[A-Z]:\\/i[_0x44d62a(0xe9)](_0x37033f)&&_0x37033f[_0x44d62a(0xdc)]<=0x3){if(win32ExcludeList[_0x44d62a(0x12e)](_0x1a3d22)||_0x1a3d22['endsWith']('.sys')||_0x1a3d22[_0x44d62a(0x167)](_0x44d62a(0x16a)))continue;}}let _0x279742=path['join'](_0x37033f,_0x1a3d22);if(_0x254db6[_0x44d62a(0x12e)](_0x279742))continue;let _0x43f518=_0x47355d[_0x44d62a(0xe7)](),_0xc3dcc5=_0x47355d['isDirectory']();function _0x5ea97b(){const _0x2d6316=_0x44d62a;if(_0x43f518)(_0x5eff27==0x0||_0x5eff27==0x1)&&_0x1fcdc2[_0x2d6316(0x170)]({'type':0x1,'name':_0x1a3d22,'fileFullPath':_0x279742});else _0xc3dcc5&&_0x1fcdc2[_0x2d6316(0x170)]({'type':0x2,'name':_0x1a3d22,'fileFullPath':_0x279742});}_0x1cc34b?_0x1a3d22[_0x44d62a(0x12e)](_0x1cc34b)&&_0x5ea97b():_0x5ea97b();try{if(_0x1fcdc2['length']>0x1770)break;}catch(_0x530386){continue;}}let _0x18accc=_0x1fcdc2[_0x44d62a(0xdc)],_0x18157a=0x0;if(_0x1fcdc2[_0x44d62a(0xdc)]<0x1)return _0x2f5bed[_0x44d62a(0xe3)]({'code':0x0,'data':{'parent':_0x37033f,'children':_0x1fcdc2,'sep':_0xc81dcf,'platform':platform}});for(let _0x1e6493 of _0x1fcdc2){fs['stat'](_0x1e6493[_0x44d62a(0x195)],(_0x85e8b8,_0x5769f0)=>{const _0x5a4fd7=_0x44d62a;_0x18157a+=0x1;!_0x85e8b8&&(_0x1e6493[_0x5a4fd7(0x1a7)]=_0x5769f0[_0x5a4fd7(0x1a7)],_0x1e6493[_0x5a4fd7(0x109)]=_0x5769f0[_0x5a4fd7(0x109)],_0x1e6493['birthtimeMs']=_0x5769f0[_0x5a4fd7(0x10c)],_0x1e6493['size']=_0x5769f0[_0x5a4fd7(0xff)]);if(_0x18157a>=_0x18accc)return _0x2f5bed[_0x5a4fd7(0xe3)]({'code':0x0,'data':{'parent':_0x37033f,'children':_0x1fcdc2,'sep':_0xc81dcf,'platform':platform}});});}});}}catch(_0x335f65){return fileUtil[_0x37c34c(0x152)](_0x2f5bed,_0x335f65);}}),router[_0x36f822(0xf0)](_0x36f822(0x1ba),(_0x109d44,_0x2c373c,_0x45ddb1)=>{const _0x5506cc=_0x36f822;let _0x544f4c=fileUtil['decodePath'](_0x109d44[_0x5506cc(0x10f)][_0x5506cc(0x1b5)]);if(!_0x544f4c)return _0x2c373c[_0x5506cc(0x1aa)](0x194)[_0x5506cc(0x107)]();_0x544f4c=path['resolve'](path[_0x5506cc(0xe5)](_0x544f4c));let _0x41e972=path['join'](config[_0x5506cc(0x1b0)],_0x5506cc(0x183),path[_0x5506cc(0x151)]);return _0x544f4c[_0x5506cc(0x119)](_0x41e972)?_0x2c373c[_0x5506cc(0x11f)](_0x544f4c):(console[_0x5506cc(0x13a)]('404'),_0x2c373c[_0x5506cc(0x1aa)](0x194)[_0x5506cc(0x107)]());}),router[_0x36f822(0xf0)]('/rawFile*',(_0x1d1fa7,_0x21579c,_0x133d16)=>{const _0x50b3ef=_0x36f822;let _0x55b9d7=_0x1d1fa7[_0x50b3ef(0x10f)][_0x50b3ef(0x1b5)],_0x1841e0=_0x1d1fa7['query'][_0x50b3ef(0x110)]==0x1,_0x181dbd=fileUtil[_0x50b3ef(0x182)](_0x55b9d7),_0x9d475b=_0x1d1fa7[_0x50b3ef(0x10f)][_0x50b3ef(0xff)],_0x48a825=_0x1d1fa7['query'][_0x50b3ef(0x190)];if(dbUserTable[_0x50b3ef(0x145)](_0x1d1fa7,_0x21579c,'',_0x50b3ef(0x198),_0x181dbd)==!![])try{let _0x49608c=_0x1d1fa7[_0x50b3ef(0x10f)]['raw'];if(_0x49608c&&_0x49608c==0x1){if(_0x1841e0){const _0x3bff67=encodeURIComponent(path[_0x50b3ef(0x12b)](_0x181dbd))['replace'](/%([0-9A-F]{2})/g,(_0x3c4fcb,_0x305281)=>'%'+_0x305281['toUpperCase']());_0x21579c[_0x50b3ef(0x19e)](_0x50b3ef(0x1a5),'attachment;\x20filename*=UTF-8\x27\x27'+_0x3bff67);}return _0x21579c[_0x50b3ef(0x11f)](_0x181dbd);}else _0x1d1fa7[_0x50b3ef(0x10f)][_0x50b3ef(0x196)]&&_0x1d1fa7[_0x50b3ef(0x10f)][_0x50b3ef(0x196)]==_0x50b3ef(0x12a)&&path['extname'](_0x181dbd)&&path[_0x50b3ef(0x194)](_0x181dbd)[_0x50b3ef(0x1be)]()==_0x50b3ef(0x12c)?(console[_0x50b3ef(0x13a)]('Convert\x20to\x20utf8\x20',_0x181dbd),encodingUtil['getUtf8FileStream'](_0x181dbd)[_0x50b3ef(0x186)](_0x555d68=>{const _0x5dc12e=_0x50b3ef;return _0x555d68?_0x555d68[_0x5dc12e(0x17f)](_0x21579c):(console[_0x5dc12e(0x13a)]('Unable\x20to\x20read\x20file',_0x181dbd),_0x21579c[_0x5dc12e(0x11f)](_0x181dbd));})):sharpUtil[_0x50b3ef(0x1a6)](_0x21579c,_0x181dbd,_0x1841e0,_0x9d475b,_0x48a825);}catch(_0x1b1073){return console[_0x50b3ef(0x13a)](_0x1b1073),fileUtil[_0x50b3ef(0x152)](_0x21579c,_0x1b1073);}}),router[_0x36f822(0x166)](_0x36f822(0x184),(_0x98ce99,_0x3d5b48,_0x44d26c)=>{const _0x2a5ef5=_0x36f822;let _0x5f2f05=fileUtil[_0x2a5ef5(0x182)](_0x98ce99[_0x2a5ef5(0x120)][_0x2a5ef5(0x185)]),_0x53f97e=_0x98ce99['body']['checkPower'];if(_0x53f97e=='write')_0x53f97e=fs[_0x2a5ef5(0x1a0)][_0x2a5ef5(0xfe)];else _0x53f97e=='read'&&(_0x53f97e=fs['constants'][_0x2a5ef5(0x18e)]);try{_0x53f97e==_0x2a5ef5(0x14e)?fs[_0x2a5ef5(0x165)](_0x5f2f05,fs[_0x2a5ef5(0x1a0)][_0x2a5ef5(0xfe)],_0x208dae=>{const _0x4fde29=_0x2a5ef5;if(_0x208dae)return fileUtil[_0x4fde29(0x152)](_0x3d5b48,_0x208dae);return _0x3d5b48[_0x4fde29(0xe3)]({'code':0x0,'access':!![]});}):fs[_0x2a5ef5(0x165)](_0x5f2f05,_0x53f97e,_0x5a8b48=>{if(_0x5a8b48)return fileUtil['returnFileError'](_0x3d5b48,_0x5a8b48);return _0x3d5b48['json']({'code':0x0,'access':!![]});});}catch(_0x839c39){return _0x3d5b48[_0x2a5ef5(0xe3)]({'code':0x0,'access':![]});}}),router[_0x36f822(0x166)]('/addNewFolder',(_0xa10be5,_0x5a7b2d,_0x749750)=>{const _0x1836ff=_0x36f822;let _0x28d14a=fileUtil[_0x1836ff(0x182)](_0xa10be5[_0x1836ff(0x120)][_0x1836ff(0xf8)]),_0x43fe36=_0xa10be5[_0x1836ff(0x120)]['folderName'],_0x25ec23=path[_0x1836ff(0x129)](_0x28d14a,_0x43fe36);if(dbUserTable[_0x1836ff(0x145)](_0xa10be5,_0x5a7b2d,_0x1836ff(0x1ac),_0x1836ff(0x1a4),_0x25ec23)==!![])try{fs[_0x1836ff(0x14a)](_0x25ec23,_0x3e9bcd=>{const _0x2d0bb4=_0x1836ff;if(!_0x3e9bcd)return _0xa10be5[_0x2d0bb4(0x13d)][_0x2d0bb4(0x1ae)](_0x5a7b2d,_0x5a7b2d['__'](_0x2d0bb4(0x17a))+':'+_0x25ec23);else fs[_0x2d0bb4(0x174)](_0x25ec23,{'recursive':!![]},_0x4b8a7b=>{const _0x44246a=_0x2d0bb4;return _0x4b8a7b?fileUtil[_0x44246a(0x152)](_0x5a7b2d,_0x4b8a7b):_0x5a7b2d[_0x44246a(0xe3)]({'code':0x0});});});}catch(_0x51011e){return fileUtil[_0x1836ff(0x152)](_0x5a7b2d,_0x51011e);}}),router[_0x36f822(0x166)]('/zipFile',(_0x520177,_0x4adca8,_0xc4e8de)=>{const _0x33231f=_0x36f822;let _0x3b0811=_0x520177['body'][_0x33231f(0xe8)],_0x5b47db=_0x520177[_0x33231f(0x120)]['targetPath'],_0x47af07=_0x520177['body'][_0x33231f(0xde)];if(_0x47af07!=_0x33231f(0x16c)&&_0x47af07!=_0x33231f(0x147))return _0x520177[_0x33231f(0x13d)]['returnErrMsg'](_0x4adca8,_0x4adca8['__'](_0x33231f(0xf2)));if(dbUserTable[_0x33231f(0x145)](_0x520177,_0x4adca8,'folder','power_get',_0x3b0811)==!![]&&dbUserTable['doUserCanGet'](_0x520177,_0x4adca8,_0x33231f(0x1ac),'power_add',_0x5b47db)==!![]){let _0x302859=_0x520177[_0x33231f(0x13d)][_0x33231f(0x106)]['prepare'](_0x33231f(0x1bd))[_0x33231f(0x123)](_0x33231f(0x1bb),JSON[_0x33231f(0x1a8)]({'sourcePath':_0x3b0811,'targetPath':_0x5b47db,'type':_0x47af07,'username':_0x520177[_0x33231f(0x1b4)][_0x33231f(0xfc)]}));return process['send']({'type':'START_WORKER_FILE_OPERATION','taskIdList':[_0x302859['lastInsertRowid']]}),_0x4adca8['json']({'code':0x0});}}),router['post'](_0x36f822(0x114),(_0x33973d,_0x5273ab,_0x3b7a89)=>{const _0x36116e=_0x36f822;let _0x518bd4=_0x33973d['body'][_0x36116e(0x13b)],_0x3a02f2=_0x33973d['body'][_0x36116e(0x1b1)],_0x14bfa3=_0x33973d['body']['type'];if(_0x518bd4[_0x36116e(0xdc)]<0x1)return _0x33973d[_0x36116e(0x13d)]['returnErrMsg'](_0x5273ab,_0x5273ab['__'](_0x36116e(0xf2)));if(dbUserTable[_0x36116e(0x145)](_0x33973d,_0x5273ab,_0x36116e(0x1ac),_0x36116e(0x198),_0x518bd4[0x0])==!![]&&dbUserTable['doUserCanGet'](_0x33973d,_0x5273ab,'folder',_0x36116e(0x1a4),_0x3a02f2)==!![])try{let _0x47d402=[];for(let _0x5a36b2 in _0x518bd4){let _0x33c7dc=_0x518bd4[_0x5a36b2],_0x380202=path[_0x36116e(0x12b)](_0x33c7dc),_0x5e1664=path[_0x36116e(0x129)](_0x3a02f2,_0x380202),_0xd102e3=_0x33973d[_0x36116e(0x13d)]['dbOther']['prepare'](_0x36116e(0x1bd))[_0x36116e(0x123)](_0x36116e(0x1bb),JSON[_0x36116e(0x1a8)]({'sourcePath':_0x33c7dc,'targetPath':_0x5e1664,'type':_0x14bfa3,'username':_0x33973d[_0x36116e(0x1b4)][_0x36116e(0xfc)]}));_0x47d402['push'](_0xd102e3[_0x36116e(0xf7)]);}return process['send']({'type':_0x36116e(0x140),'taskIdList':_0x47d402}),_0x5273ab[_0x36116e(0xe3)]({'code':0x0});}catch(_0x462b94){return _0x33973d[_0x36116e(0x13d)][_0x36116e(0x1ae)](_0x5273ab,_0x5273ab['__'](_0x36116e(0xf2)));}}),router[_0x36f822(0x166)](_0x36f822(0x116),(_0x2cc7e3,_0x2d14d7,_0x23118c)=>{const _0x5a4dff=_0x36f822;let _0x1280b3=fileUtil[_0x5a4dff(0x182)](_0x2cc7e3['body'][_0x5a4dff(0xe8)]),_0x267731=fileUtil[_0x5a4dff(0x182)](_0x2cc7e3[_0x5a4dff(0x120)][_0x5a4dff(0x1b1)]),_0x30e386=path['basename'](_0x1280b3),_0x1b2191=_0x2cc7e3[_0x5a4dff(0x120)][_0x5a4dff(0xde)],_0x5d93d9=path[_0x5a4dff(0x129)](_0x267731,_0x30e386);if(_0x1b2191==_0x5a4dff(0xe1)||_0x1b2191==_0x5a4dff(0x19f)){if(fs['existsSync'](_0x5d93d9))return _0x2cc7e3[_0x5a4dff(0x13d)]['returnErrMsg'](_0x2d14d7,_0x2d14d7['__'](_0x5a4dff(0x17a))+':'+_0x5d93d9);}let _0x3207c9=_0x2cc7e3[_0x5a4dff(0x120)][_0x5a4dff(0x1b7)];function _0x4c633d(_0x1c437f,_0x24ca57){const _0x3468a0=_0x5a4dff;let _0x4b1250=_0x2cc7e3['app'][_0x3468a0(0x106)][_0x3468a0(0x108)]('INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)')[_0x3468a0(0x123)](_0x3468a0(0x1bb),JSON[_0x3468a0(0x1a8)]({'sourcePath':_0x1c437f,'targetPath':_0x24ca57,'type':_0x1b2191,'username':_0x2cc7e3[_0x3468a0(0x1b4)][_0x3468a0(0xfc)]}));return _0x4b1250[_0x3468a0(0xf7)];}try{_0x1280b3=path[_0x5a4dff(0x129)](_0x1280b3),_0x267731=path['join'](_0x267731);if(_0x267731==_0x1280b3||_0x267731[_0x5a4dff(0x119)](_0x1280b3+path['sep']))return _0x2cc7e3['app']['returnErrMsg'](_0x2d14d7,_0x2d14d7['__']('cannotCopyToSelf'));if(dbUserTable[_0x5a4dff(0x145)](_0x2cc7e3,_0x2d14d7,_0x5a4dff(0x1ac),'power_get',_0x1280b3)==!![]){let _0x106a50=![];fs[_0x5a4dff(0x14a)](_0x1280b3,(_0x21e36b,_0x3c28f9)=>{const _0x583fd3=_0x5a4dff;if(_0x21e36b)return _0x2cc7e3['app'][_0x583fd3(0x1ae)](_0x2d14d7,_0x2d14d7['__']('noReadPermission')+':'+_0x1280b3);let _0x396459=path[_0x583fd3(0x12b)](_0x1280b3);fs[_0x583fd3(0x165)](_0x267731,fs[_0x583fd3(0x1a0)]['R_OK']|fs[_0x583fd3(0x1a0)][_0x583fd3(0xfe)],_0x448097=>{const _0x3544af=_0x583fd3;if(_0x448097)return _0x2cc7e3[_0x3544af(0x13d)][_0x3544af(0x1ae)](_0x2d14d7,_0x2d14d7['__'](_0x3544af(0x146))+':'+_0x267731);if(_0x1b2191==_0x3544af(0x12d))dbUserTable[_0x3544af(0x145)](_0x2cc7e3,_0x2d14d7,_0x3544af(0x1ac),'power_change',_0x267731)==!![]&&(_0x267731=path[_0x3544af(0x129)](_0x267731,_0x3207c9),fs[_0x3544af(0x14a)](_0x267731,_0x30970e=>{const _0x1b5a4f=_0x3544af;if(!_0x30970e)return _0x2cc7e3['app'][_0x1b5a4f(0x1ae)](_0x2d14d7,_0x2d14d7['__'](_0x1b5a4f(0x17a))+':'+_0x267731);else fs[_0x1b5a4f(0x12d)](_0x1280b3,_0x267731,_0x51c0ab=>{const _0x14e143=_0x1b5a4f;if(_0x51c0ab)return dbFileOperationRecord['addFileOperationRecord'](_0x2cc7e3[_0x14e143(0x13d)][_0x14e143(0x106)],{'username':_0x2cc7e3[_0x14e143(0x1b4)][_0x14e143(0xfc)],'sourcePath':_0x1280b3,'targetPath':_0x267731,'level':dbFileOperationRecord[_0x14e143(0x193)],'belongId':null,'type':dbFileOperationRecord[_0x14e143(0x144)],'subType':null,'state':dbFileOperationRecord[_0x14e143(0x1a1)],'remark':fileUtil['returnFileError'](_0x2d14d7,_0x51c0ab,!![])}),dbNoticeCenterTable[_0x14e143(0x126)](_0x2cc7e3[_0x14e143(0x13d)][_0x14e143(0x106)],{'title':_0x2d14d7['__']('operationFail'),'level':_0x14e143(0x142),'content':_0x2d14d7['__']('fileRenameFail')+':'+(_0x1280b3+_0x14e143(0x1b6)+_0x267731)});_0x106a50=!![],dbFileOperationRecord[_0x14e143(0x162)](_0x2cc7e3[_0x14e143(0x13d)][_0x14e143(0x106)],{'username':_0x2cc7e3['currentUser'][_0x14e143(0xfc)],'sourcePath':_0x1280b3,'targetPath':_0x267731,'level':dbFileOperationRecord[_0x14e143(0x193)],'belongId':null,'type':dbFileOperationRecord[_0x14e143(0x144)],'subType':null,'state':dbFileOperationRecord['STATE_SUC']});}),setTimeout(()=>{return _0x2d14d7['json']({'code':0x0,'isOver':_0x106a50?0x1:0x0});},0x3e8);}));else{if(_0x1b2191==_0x3544af(0x19f)){if(dbUserTable[_0x3544af(0x145)](_0x2cc7e3,_0x2d14d7,_0x3544af(0x1ac),'power_delete',_0x267731)!==!![])return;}if(dbUserTable[_0x3544af(0x145)](_0x2cc7e3,_0x2d14d7,_0x3544af(0x1ac),_0x3544af(0x1a4),_0x267731)==!![]){_0x267731=path['join'](_0x267731,_0x396459);let _0x33ac10=_0x4c633d(_0x1280b3,_0x267731);return process['send']({'type':'START_WORKER_FILE_OPERATION','taskIdList':[_0x33ac10]}),_0x2d14d7[_0x3544af(0xe3)]({'code':0x0});}}});});}}catch(_0x439231){return _0x2cc7e3[_0x5a4dff(0x13d)][_0x5a4dff(0x1ae)](_0x2d14d7,_0x2d14d7['__']('operationFail'));}}),router[_0x36f822(0x166)](_0x36f822(0xfb),(_0x5b7e6c,_0x3e5137,_0x296dec)=>{const _0x110cbd=_0x36f822;let _0x260697=_0x5b7e6c[_0x110cbd(0x120)][_0x110cbd(0x19b)];if(!_0x260697)return _0x3e5137[_0x110cbd(0x1aa)](0x194)[_0x110cbd(0x107)]();dbUserTable[_0x110cbd(0x145)](_0x5b7e6c,_0x3e5137,_0x110cbd(0x1ac),_0x110cbd(0x198),_0x260697)==!![]&&fs[_0x110cbd(0x14a)](_0x260697,(_0x4929df,_0x442c7b)=>{const _0x2f6187=_0x110cbd;if(_0x4929df)return fileUtil[_0x2f6187(0x152)](_0x3e5137,_0x4929df);return _0x442c7b[_0x2f6187(0x181)]=fileUtil[_0x2f6187(0xdf)](_0x442c7b[_0x2f6187(0xff)]),_0x3e5137['json']({'code':0x0,'data':_0x442c7b});});}),router[_0x36f822(0x166)](_0x36f822(0x17d),(_0x359285,_0x22676f,_0x157749)=>{const _0x4fe61e=_0x36f822;let _0x3a4a69=_0x359285['body'][_0x4fe61e(0x149)],_0x443be0=_0x359285[_0x4fe61e(0x120)][_0x4fe61e(0x199)];_0x443be0&&(_0x443be0=_0x443be0[_0x4fe61e(0x160)](/[<>\\\/:\*\?\"\|]/g,'_')),_0x3a4a69&&(_0x3a4a69=fileUtil[_0x4fe61e(0x182)](_0x3a4a69)),fs[_0x4fe61e(0x165)](_0x3a4a69,fs[_0x4fe61e(0x1a0)][_0x4fe61e(0xfe)]|fs[_0x4fe61e(0x1a0)]['R_OK'],_0x3066ed=>{const _0x36032b=_0x4fe61e;if(_0x3066ed)return _0x22676f[_0x36032b(0xe3)]({'code':0x1,'message':_0x22676f['__'](_0x36032b(0x146))+':'+_0x3a4a69});else{let _0x41c7fa='';if(_0x3a4a69&&_0x443be0)_0x41c7fa=path[_0x36032b(0x129)](_0x3a4a69,_0x443be0);else{if(_0x3a4a69)_0x41c7fa=path[_0x36032b(0x129)](_0x3a4a69);else return _0x22676f[_0x36032b(0xe3)]({'code':0x1,'message':_0x22676f['__']('folderNotExist')+':'+_0x3a4a69});}fs[_0x36032b(0x14a)](_0x41c7fa,_0x556ac0=>{const _0x26858b=_0x36032b;return _0x556ac0?(console[_0x26858b(0x13a)](_0x26858b(0x130),_0x41c7fa),_0x22676f[_0x26858b(0xe3)]({'code':0x0})):_0x22676f[_0x26858b(0xe3)]({'code':0x1,'remark':_0x26858b(0x1b3)});});}});}),router[_0x36f822(0x166)]('/deleteByPath',(_0x15e440,_0x2206bb,_0xdabc8e)=>{const _0x4fcd9a=_0x36f822;let _0x186de1=_0x15e440[_0x4fcd9a(0x120)][_0x4fcd9a(0x19b)],_0x400fae=_0x15e440[_0x4fcd9a(0x120)]['putInSystemTrash'];if(!_0x186de1)return _0x2206bb[_0x4fcd9a(0x1aa)](0x194)['end']();_0x186de1=path[_0x4fcd9a(0x129)](_0x186de1);if(dbUserTable[_0x4fcd9a(0x145)](_0x15e440,_0x2206bb,_0x4fcd9a(0x1ac),_0x4fcd9a(0x1af),_0x186de1)==!![]){if(_0x400fae==0x1)return process[_0x4fcd9a(0x100)]({'type':_0x4fcd9a(0x1a3),'shellType':_0x4fcd9a(0x1b9),'path':_0x186de1}),dbFileOperationRecord[_0x4fcd9a(0x162)](_0x15e440[_0x4fcd9a(0x13d)][_0x4fcd9a(0x106)],{'username':_0x15e440[_0x4fcd9a(0x1b4)][_0x4fcd9a(0xfc)],'targetPath':_0x186de1,'level':dbFileOperationRecord[_0x4fcd9a(0x193)],'type':dbFileOperationRecord[_0x4fcd9a(0x153)],'state':dbFileOperationRecord[_0x4fcd9a(0x18c)]}),_0x2206bb[_0x4fcd9a(0xe3)]({'code':0x0,'message':_0x2206bb['__']('deleteSuccess')});else fs['rm'](_0x186de1,{'recursive':!![]},_0x1f420a=>{const _0x23dd68=_0x4fcd9a;if(_0x1f420a)return dbFileOperationRecord[_0x23dd68(0x162)](_0x15e440['app'][_0x23dd68(0x106)],{'username':_0x15e440[_0x23dd68(0x1b4)]['username'],'targetPath':_0x186de1,'level':dbFileOperationRecord[_0x23dd68(0x193)],'type':dbFileOperationRecord[_0x23dd68(0x153)],'state':dbFileOperationRecord[_0x23dd68(0x1a1)],'remark':fileUtil[_0x23dd68(0x152)](_0x2206bb,_0x1f420a,!![])}),fileUtil['returnFileError'](_0x2206bb,_0x1f420a);return dbFileOperationRecord[_0x23dd68(0x162)](_0x15e440[_0x23dd68(0x13d)][_0x23dd68(0x106)],{'username':_0x15e440['currentUser'][_0x23dd68(0xfc)],'targetPath':_0x186de1,'level':dbFileOperationRecord[_0x23dd68(0x193)],'type':dbFileOperationRecord[_0x23dd68(0x153)],'state':dbFileOperationRecord['STATE_SUC']}),_0x2206bb[_0x23dd68(0xe3)]({'code':0x0,'message':_0x2206bb['__'](_0x23dd68(0xef))});});}}),router[_0x36f822(0x166)]('/clearOperationRecord',(_0x16738f,_0x16fe77,_0x2ca1d1)=>{const _0x2bb45b=_0x36f822;if(_0x16738f[_0x2bb45b(0x1b4)][_0x2bb45b(0x138)]!=0x1)return _0x16fe77[_0x2bb45b(0xe3)]({'code':0x66});return dbFileOperationRecord['deleteFileRecordAll'](_0x16738f['app']['dbOther']),_0x16fe77[_0x2bb45b(0xe3)]({'code':0x0});}),router[_0x36f822(0x166)](_0x36f822(0x1ab),(_0x1012b9,_0x2e85b2,_0x20fd55)=>{const _0x5f4317=_0x36f822;let _0x273cd1=_0x1012b9['body'][_0x5f4317(0x19a)],_0x125767=_0x1012b9[_0x5f4317(0x120)]['pageSize'],_0x5347db=_0x1012b9[_0x5f4317(0x120)][_0x5f4317(0xde)],_0x17fc22=_0x1012b9['body']['level'],_0x5a9ab3=_0x1012b9[_0x5f4317(0x120)]['subType'],_0x5580ca=_0x1012b9[_0x5f4317(0x120)][_0x5f4317(0xfd)],_0x342304=_0x1012b9[_0x5f4317(0x120)]['searchStr'],_0x58390a;return _0x1012b9[_0x5f4317(0x1b4)]['is_admin']==0x1?_0x58390a=dbFileOperationRecord[_0x5f4317(0x11c)](_0x1012b9[_0x5f4317(0x13d)][_0x5f4317(0x106)],_0x273cd1,_0x125767,_0x17fc22,_0x5347db,_0x5a9ab3,_0x5580ca,_0x342304):_0x58390a=dbFileOperationRecord[_0x5f4317(0x11c)](_0x1012b9[_0x5f4317(0x13d)][_0x5f4317(0x106)],_0x273cd1,_0x125767,_0x17fc22,_0x5347db,_0x5a9ab3,_0x5580ca,_0x342304,_0x1012b9[_0x5f4317(0x1b4)][_0x5f4317(0xfc)]),_0x2e85b2[_0x5f4317(0xe3)]({'code':0x0,'data':_0x58390a});}),router[_0x36f822(0x166)](_0x36f822(0x14b),(_0x3e3d3d,_0x5a4379,_0x3176a4)=>{const _0x31e7ca=_0x36f822;let _0x3e6a86=_0x3e3d3d[_0x31e7ca(0x120)][_0x31e7ca(0x18b)];if(_0x3e6a86==_0x31e7ca(0x1b2)||_0x3e6a86==_0x31e7ca(0x15b)){if(_0x3e3d3d['currentUser'][_0x31e7ca(0x138)]!=0x1)return _0x5a4379['json']({'code':0x66});}if(_0x3e6a86==_0x31e7ca(0x1b2)){let _0x44fed8=_0x3e3d3d[_0x31e7ca(0x120)][_0x31e7ca(0xde)],_0x5f4df5=_0x3e3d3d[_0x31e7ca(0x120)][_0x31e7ca(0x10b)],_0x1087be=_0x3e3d3d['body'][_0x31e7ca(0xfc)],_0x2d208d=_0x3e3d3d[_0x31e7ca(0x120)][_0x31e7ca(0x191)],_0x3a7f10=_0x3e3d3d[_0x31e7ca(0x120)][_0x31e7ca(0xfc)],_0x287e92=_0x3e3d3d[_0x31e7ca(0x120)][_0x31e7ca(0x127)],_0x24d225=[_0x31e7ca(0x124),_0x31e7ca(0xea),_0x31e7ca(0x115)];if(!_0x44fed8||!_0x5f4df5||!_0x24d225[_0x31e7ca(0x12e)](_0x44fed8))return _0x3e3d3d['app']['returnErrMsg'](_0x5a4379,_0x5a4379['__']('operationFail'));_0x44fed8==_0x31e7ca(0x124)&&fileStatUtil[_0x31e7ca(0x1bc)](_0x5f4df5,()=>{const _0x1df112=_0x31e7ca;fileStatUtil[_0x1df112(0x1ad)](_0x5f4df5,()=>{const _0x2544d1=_0x1df112,_0x3fb2cb=_0x2544d1(0x103);return _0x3e3d3d[_0x2544d1(0x13d)]['dbOther'][_0x2544d1(0x108)](_0x3fb2cb)[_0x2544d1(0x123)](_0x44fed8,_0x5f4df5,_0x1087be,_0x3a7f10,_0x287e92,_0x2d208d),_0x5a4379[_0x2544d1(0xe3)]({'code':0x0});},()=>{const _0x368122=_0x1df112;return _0x3e3d3d[_0x368122(0x13d)][_0x368122(0x1ae)](_0x5a4379,_0x5a4379['__'](_0x368122(0x111)));});},()=>{const _0x13c4c5=_0x31e7ca;return _0x3e3d3d[_0x13c4c5(0x13d)][_0x13c4c5(0x1ae)](_0x5a4379,_0x5a4379['__'](_0x13c4c5(0x179)));});}else{if(_0x3e6a86==_0x31e7ca(0x15b)){let _0x3f3b74=_0x3e3d3d[_0x31e7ca(0x120)]['id'];return _0x3e3d3d[_0x31e7ca(0x13d)][_0x31e7ca(0x106)]['prepare'](_0x31e7ca(0x17b))[_0x31e7ca(0x123)](_0x3f3b74),_0x5a4379[_0x31e7ca(0xe3)]({'code':0x0});}else{if(_0x3e6a86==_0x31e7ca(0xf0)){let _0x3a2b42=[],_0xc0300d=_0x3e3d3d[_0x31e7ca(0x13d)]['dbOther'][_0x31e7ca(0x108)]('select\x20id,type,url,name,remark\x20from\x20path_mount')['all']();if(_0x3e3d3d[_0x31e7ca(0x1b4)][_0x31e7ca(0x138)]==0x1)_0x3a2b42=_0xc0300d;else{let _0x4a16bd=dbUserTable[_0x31e7ca(0x155)](_0x3e3d3d[_0x31e7ca(0x13d)][_0x31e7ca(0x106)],_0x3e3d3d[_0x31e7ca(0x1b4)][_0x31e7ca(0xfc)],_0x31e7ca(0x1ac),'power_get');for(let _0xd706f5 in _0x4a16bd){let _0xf84af8=_0x4a16bd[_0xd706f5]['path'][_0x31e7ca(0x1be)]();_0xf84af8=path['join'](_0xf84af8);for(let _0x26a983 in _0xc0300d){try{if(_0xc0300d[_0x26a983][_0x31e7ca(0x10b)]&&_0xf84af8){let _0x248c4a=_0xc0300d[_0x26a983][_0x31e7ca(0x10b)][_0x31e7ca(0x1be)]();_0x248c4a['endsWith'](':')&&_0x248c4a['length']==0x2&&(_0x248c4a=_0x248c4a+path[_0x31e7ca(0x151)]),_0x248c4a=path[_0x31e7ca(0x129)](_0x248c4a)[_0x31e7ca(0x1be)](),(_0xf84af8==_0x248c4a||_0x248c4a[_0x31e7ca(0x119)](path[_0x31e7ca(0x129)](_0xf84af8+path[_0x31e7ca(0x151)])))&&_0x3a2b42['push'](_0xc0300d[_0x26a983]);}}catch(_0x4562a4){continue;}}}}return _0x5a4379[_0x31e7ca(0xe3)]({'code':0x0,'data':_0x3a2b42});}}}});function getRandomString(_0x361e45){const _0x111700=_0x36f822;let _0x50162f='';const _0x54d43d=_0x111700(0xfa),_0x1089ba=_0x54d43d[_0x111700(0xdc)];for(let _0x145313=0x0;_0x145313<_0x361e45;_0x145313++){_0x50162f+=_0x54d43d[_0x111700(0x121)](Math[_0x111700(0x11b)](Math[_0x111700(0x172)]()*_0x1089ba));}return _0x50162f;}router[_0x36f822(0x166)]('/getTempShare',(_0xe5ab10,_0x3febf9,_0xb44a60)=>{const _0x3e0898=_0x36f822;let _0x23d0d1=[];return _0xe5ab10['currentUser']['is_admin']==0x1?_0x23d0d1=_0xe5ab10[_0x3e0898(0x13d)][_0x3e0898(0x106)]['prepare'](_0x3e0898(0x12f))[_0x3e0898(0x14e)]():_0x23d0d1=_0xe5ab10[_0x3e0898(0x13d)][_0x3e0898(0x106)][_0x3e0898(0x108)](_0x3e0898(0x178))[_0x3e0898(0x14e)](_0xe5ab10['currentUser']['id']),_0x3febf9[_0x3e0898(0xe3)]({'code':0x0,'data':_0x23d0d1});}),router['post'](_0x36f822(0x1b8),(_0x41e35a,_0x4e1b68,_0x417e9a)=>{const _0x208465=_0x36f822;let _0x2c2697=_0x41e35a[_0x208465(0x120)][_0x208465(0x18b)];if(_0x2c2697==_0x208465(0x1b2))try{if(!_0x41e35a[_0x208465(0x120)]['path'])return _0x41e35a[_0x208465(0x13d)][_0x208465(0x1ae)](_0x4e1b68,_0x208465(0x142));let _0x51032c=fileUtil['decodePath'](_0x41e35a[_0x208465(0x120)][_0x208465(0x1b5)]);function _0x501c92(){const _0x45d33e=_0x208465;if(dbUserTable[_0x45d33e(0x145)](_0x41e35a,_0x4e1b68,'',_0x45d33e(0x198),_0x51032c)==!![]){let _0xa4fc36=_0x41e35a['body'][_0x45d33e(0x127)]?_0x41e35a['body']['password']:'',_0x45ef2f=new Date()['getTime'](),_0x58dbca=getRandomString(0x5),_0x94ca25=_0x41e35a[_0x45d33e(0x13d)][_0x45d33e(0x106)][_0x45d33e(0x108)](_0x45d33e(0x188))[_0x45d33e(0xf0)](_0x58dbca);if(_0x94ca25)return _0x501c92();let _0x482cb1=_0x41e35a['body'][_0x45d33e(0x136)]?_0x41e35a['body'][_0x45d33e(0x136)]:0x1e,_0x49af32=0xe10*0x3e8*0x18*_0x482cb1+_0x45ef2f;return _0x41e35a[_0x45d33e(0x13d)][_0x45d33e(0x106)][_0x45d33e(0x108)]('INSERT\x20INTO\x20share_temp(path,password,token,create_timestamp,end_timestamp,user_id)\x20VALUES(?,?,?,?,?,?)')[_0x45d33e(0x123)](_0x51032c,_0xa4fc36,_0x58dbca,_0x45ef2f,_0x49af32,_0x41e35a[_0x45d33e(0x1b4)]['id']),_0x4e1b68[_0x45d33e(0xe3)]({'code':0x0,'token':_0x58dbca});}}return _0x501c92();}catch(_0x41340b){return console['log'](_0x41340b),_0x41e35a[_0x208465(0x13d)][_0x208465(0x1ae)](_0x4e1b68,_0x208465(0x142));}else{if(_0x2c2697==_0x208465(0x15b)){let _0x580fa7=_0x41e35a[_0x208465(0x120)][_0x208465(0x171)];return _0x41e35a[_0x208465(0x1b4)]['is_admin']==0x1?_0x41e35a[_0x208465(0x13d)][_0x208465(0x106)][_0x208465(0x108)](_0x208465(0x15e))[_0x208465(0x123)](_0x580fa7):_0x41e35a[_0x208465(0x13d)]['dbOther'][_0x208465(0x108)](_0x208465(0x102))[_0x208465(0x123)](_0x580fa7,_0x41e35a[_0x208465(0x1b4)]['id']),_0x4e1b68['json']({'code':0x0});}}}),router[_0x36f822(0x166)](_0x36f822(0x17c),(_0x538e06,_0x1744fb,_0x2463cf)=>{const _0x16a131=_0x36f822;let _0x231549=_0x538e06['body'][_0x16a131(0x135)]||_0x538e06[_0x16a131(0x120)]['st'],_0x532fd9=_0x538e06[_0x16a131(0x120)]['parent'],_0x149230=_0x538e06[_0x16a131(0x120)][_0x16a131(0x127)],_0x5f098a=[],_0x4ed190=dbConfigTable[_0x16a131(0x14c)](_0x538e06['app']['dbOther'],[_0x16a131(0x10a),_0x16a131(0x16f)]),_0x5c1365={'code':0x0,'data':{'customConfig':_0x4ed190,'parent':_0x532fd9,'children':_0x5f098a,'sep':path['sep'],'platform':platform}};if(!_0x231549)return _0x1744fb[_0x16a131(0xe3)](_0x5c1365);let _0x62e533=dbUserTable[_0x16a131(0x122)](_0x538e06[_0x16a131(0x13d)]['dbOther'],_0x231549);if(!_0x62e533)return _0x1744fb[_0x16a131(0xe3)](_0x5c1365);if(_0x62e533[_0x16a131(0x127)]){if(!_0x149230)return _0x1744fb[_0x16a131(0xe3)]({'code':0x2});if(_0x62e533[_0x16a131(0x127)]!=_0x149230)return _0x1744fb[_0x16a131(0xe3)]({'code':0x2,'message':_0x1744fb['__']('login.pwdErr')});}function _0x256900(){const _0xb5abe2=_0x16a131;fs[_0xb5abe2(0x14a)](_0x62e533[_0xb5abe2(0x1b5)],(_0x43f591,_0x27e9df)=>{const _0x4122dd=_0xb5abe2;if(_0x43f591)return _0x1744fb[_0x4122dd(0xe3)](_0x5c1365);return _0x5c1365[_0x4122dd(0x1a2)]['children'][_0x4122dd(0x170)]({'type':_0x27e9df[_0x4122dd(0xe7)]()?0x1:0x2,'name':path[_0x4122dd(0x12b)](_0x62e533['path']),'fileFullPath':_0x62e533[_0x4122dd(0x1b5)]}),_0x1744fb[_0x4122dd(0xe3)](_0x5c1365);});}if(!_0x532fd9)_0x256900();else{let _0xd1003f=dbUserTable[_0x16a131(0x131)](_0x538e06[_0x16a131(0x13d)][_0x16a131(0x106)],_0x231549,_0x532fd9,_0x149230);if(!_0xd1003f)return console[_0x16a131(0x13a)](_0x16a131(0xeb),_0x532fd9),_0x256900();fs[_0x16a131(0x19c)](_0x532fd9,{'withFileTypes':!![]},(_0x20b435,_0x6569b4)=>{const _0x1b0b86=_0x16a131;if(_0x20b435)return _0x1744fb[_0x1b0b86(0xe3)](_0x5c1365);let _0x3403e1=0x0;if(_0x6569b4[_0x1b0b86(0xdc)]<0x1)return _0x1744fb[_0x1b0b86(0xe3)](_0x5c1365);for(let _0x4e3c3b=0x0;_0x4e3c3b<_0x6569b4[_0x1b0b86(0xdc)];_0x4e3c3b++){let _0xa595aa=_0x6569b4[_0x4e3c3b],_0x5b55ad=_0x6569b4[_0x4e3c3b]['name'];if(_0x5b55ad[_0x1b0b86(0xdc)]>0x0){if(_0x5b55ad[0x0]=='.'){_0x3403e1+=0x1;if(_0x3403e1>=_0x6569b4[_0x1b0b86(0xdc)])return _0x1744fb[_0x1b0b86(0xe3)](_0x5c1365);continue;}if(/[A-Z]:\\/i[_0x1b0b86(0xe9)](_0x532fd9)&&_0x532fd9[_0x1b0b86(0xdc)]<=0x3){if(win32ExcludeList[_0x1b0b86(0x12e)](_0x5b55ad)||_0x5b55ad[_0x1b0b86(0x167)](_0x1b0b86(0x11d))||_0x5b55ad[_0x1b0b86(0x167)](_0x1b0b86(0x16a))){_0x3403e1+=0x1;if(_0x3403e1>=_0x6569b4[_0x1b0b86(0xdc)])return _0x1744fb[_0x1b0b86(0xe3)](_0x5c1365);continue;}}}let _0x3024a6=path[_0x1b0b86(0x129)](_0x532fd9,_0x5b55ad);fs['stat'](_0x3024a6,(_0x1d9b8c,_0x2a3ff4)=>{const _0x5d6721=_0x1b0b86;_0x3403e1+=0x1;let _0x47b96a=_0xa595aa[_0x5d6721(0xe7)](),_0x175328=_0xa595aa[_0x5d6721(0x13e)](),_0x2c85b4={'name':_0x5b55ad,'fileFullPath':_0x3024a6};!_0x1d9b8c&&_0x2a3ff4&&(_0x2c85b4['size']=_0x2a3ff4['size'],_0x2c85b4[_0x5d6721(0x177)]=_0x2a3ff4[_0x5d6721(0x10c)]||_0x2a3ff4[_0x5d6721(0x117)]);_0x47b96a?_0x2c85b4['type']=0x1:_0x2c85b4[_0x5d6721(0xde)]=0x2;_0x5c1365['data']['children'][_0x5d6721(0x170)](_0x2c85b4);if(_0x3403e1>=_0x6569b4[_0x5d6721(0xdc)])return _0x1744fb['json'](_0x5c1365);});}});}}),module['exports']=router;