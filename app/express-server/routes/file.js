const _0x4a5d42=_0x2377;(function(_0x64131c,_0x588450){const _0x45c5e7=_0x2377,_0x3ea40b=_0x64131c();while(!![]){try{const _0x3ec16c=parseInt(_0x45c5e7(0x120))/0x1+parseInt(_0x45c5e7(0xfe))/0x2+-parseInt(_0x45c5e7(0xcc))/0x3*(parseInt(_0x45c5e7(0x192))/0x4)+parseInt(_0x45c5e7(0x16c))/0x5+parseInt(_0x45c5e7(0xd5))/0x6*(-parseInt(_0x45c5e7(0xd0))/0x7)+-parseInt(_0x45c5e7(0x110))/0x8+-parseInt(_0x45c5e7(0xe9))/0x9;if(_0x3ec16c===_0x588450)break;else _0x3ea40b['push'](_0x3ea40b['shift']());}catch(_0x2a1d41){_0x3ea40b['push'](_0x3ea40b['shift']());}}}(_0x20ef,0x18b08));let express=require(_0x4a5d42(0xef)),router=express[_0x4a5d42(0xbe)](),path=require(_0x4a5d42(0x158)),fs=require('fs'),sha256=require(_0x4a5d42(0x199)),fileUtil=require(_0x4a5d42(0x168));const sharp=require(_0x4a5d42(0x118)),os=require('os');function _0x2377(_0x5da70b,_0x3ecdaf){const _0x20efde=_0x20ef();return _0x2377=function(_0x23773b,_0x166da0){_0x23773b=_0x23773b-0xb7;let _0x1012e4=_0x20efde[_0x23773b];return _0x1012e4;},_0x2377(_0x5da70b,_0x3ecdaf);}let platform=os[_0x4a5d42(0x111)]();const dbUserTable=require(_0x4a5d42(0xe0)),dbNoticeCenterTable=require('../../db/dbNoticeCenterTable'),dbConfigTable=require(_0x4a5d42(0xbb)),dbSourceFolderTable=require(_0x4a5d42(0x163)),dbFileOperationRecord=require(_0x4a5d42(0x11a)),fileStatUtil=require(_0x4a5d42(0x177)),config=require(_0x4a5d42(0x116)),sharpUtil=require(_0x4a5d42(0x12f)),globalInfoUtil=require('../../utils/globalInfoUtil'),archiver=require(_0x4a5d42(0x119)),encodingUtil=require(_0x4a5d42(0x19c));let macPowerDetected=![],win32ExcludeList=[_0x4a5d42(0xf7),_0x4a5d42(0xd1),_0x4a5d42(0x188),_0x4a5d42(0xc9),_0x4a5d42(0x169),'PerfLogs'];router[_0x4a5d42(0x112)](_0x4a5d42(0x164),(_0x4f2db9,_0x8d9eb6,_0x420efd)=>{const _0x4124db=_0x4a5d42;if(!_0x4f2db9[_0x4124db(0x106)][_0x4124db(0x158)])return _0x8d9eb6[_0x4124db(0xb7)](0x194)['end']();let _0xda450d=fileUtil[_0x4124db(0x198)](_0x4f2db9[_0x4124db(0x106)][_0x4124db(0x158)]),_0xa58007=_0x4f2db9[_0x4124db(0x106)]['filename'];_0xa58007&&(_0xda450d=path[_0x4124db(0xf9)](_0xda450d,_0xa58007)),dbUserTable['doUserCanGet'](_0x4f2db9,_0x8d9eb6,'',_0x4124db(0x103),_0xda450d)==!![]&&fs[_0x4124db(0x161)](_0xda450d,(_0x59290e,_0x2059b2)=>{const _0x485c67=_0x4124db;if(_0x59290e)return _0x8d9eb6[_0x485c67(0xb7)](0x194)[_0x485c67(0x186)]();let _0x2f795f=path[_0x485c67(0x13b)](_0xda450d)+_0x485c67(0x14e);try{const _0x58b4ab=encodeURIComponent(_0x2f795f)[_0x485c67(0xb8)](/%([0-9A-F]{2})/g,(_0x2e7235,_0x4c17f2)=>'%'+_0x4c17f2['toUpperCase']());_0x8d9eb6[_0x485c67(0x195)](_0x485c67(0xee),'attachment;\x20filename*=UTF-8\x27\x27'+_0x58b4ab);}catch(_0x36bf9a){console['log'](_0x36bf9a);}const _0x5a9d89=archiver(_0x485c67(0x123),{'zlib':{'level':0x0}});_0x5a9d89['on']('error',function(_0x1af982){const _0x5e3506=_0x485c67;console[_0x5e3506(0x12a)](_0x5e3506(0x11c),_0x1af982['message']||_0x1af982['stack']),_0x5a9d89[_0x5e3506(0x13f)](),!_0x8d9eb6[_0x5e3506(0x11d)]?(_0x8d9eb6[_0x5e3506(0x160)](_0x5e3506(0xee)),_0x8d9eb6['status'](0x1f4)[_0x5e3506(0xd7)](_0x5e3506(0xf8))):_0x8d9eb6[_0x5e3506(0x136)]();}),_0x5a9d89['on']('end',function(){const _0x5ea0be=_0x485c67;console[_0x5ea0be(0x12a)](_0x5ea0be(0xd8)),_0x5a9d89[_0x5ea0be(0x136)]();});try{fs[_0x485c67(0x135)](_0xda450d,(_0x408db2,_0x2bcdbc)=>{const _0x58dee5=_0x485c67;for(let _0x4f353b in _0x2bcdbc){let _0x2abacc=_0x2bcdbc[_0x4f353b];const _0x1beb4b=path[_0x58dee5(0xf9)](_0xda450d,_0x2abacc);let _0xcc6707=fs['statSync'](_0x1beb4b);_0xcc6707[_0x58dee5(0x172)]()?_0x5a9d89[_0x58dee5(0x121)](_0x1beb4b,_0x2abacc):_0x5a9d89['append'](fs[_0x58dee5(0x170)](_0x1beb4b),{'name':_0x2abacc});}_0x5a9d89[_0x58dee5(0x11f)](),_0x5a9d89[_0x58dee5(0x157)](_0x8d9eb6);});}catch(_0x5660b8){!_0x8d9eb6[_0x485c67(0x11d)]&&_0x8d9eb6[_0x485c67(0xb7)](0x1f4)[_0x485c67(0xd7)]({'error':'An\x20error\x20occurred\x20while\x20reading\x20the\x20directory.'}),console[_0x485c67(0x15b)](_0x5660b8);}_0x8d9eb6['on'](_0x485c67(0x174),()=>{const _0x1c01eb=_0x485c67;console['log'](_0x1c01eb(0x159)),_0x5a9d89[_0x1c01eb(0x136)]();});});}),router['post'](_0x4a5d42(0x16f),(_0x46d44e,_0x57dd56,_0x5c6aa8)=>{const _0x57575b=_0x4a5d42;let _0x2c11ee=_0x46d44e[_0x57575b(0xfa)]['parent'],_0x56829c=path[_0x57575b(0xed)],_0x55a3db=_0x46d44e['body']['type'],_0x3d96cf=_0x46d44e[_0x57575b(0xfa)][_0x57575b(0xd9)],_0x32181a=[],_0x30eea8=parseInt(_0x46d44e[_0x57575b(0x17b)][_0x57575b(0x196)])==0x1;platform==_0x57575b(0x14d)&&_0x2c11ee&&_0x2c11ee[_0x57575b(0x154)]>0x4&&_0x2c11ee[_0x57575b(0x143)](path['sep'])&&(_0x2c11ee=_0x2c11ee[_0x57575b(0x100)](0x0,-0x1));let _0x516d88=fileUtil[_0x57575b(0x17a)](_0x46d44e[_0x57575b(0x102)]['dbOther']);try{function _0x171a5d(){const _0x2bda58=_0x57575b;let _0x1127fa=dbUserTable[_0x2bda58(0x151)](_0x46d44e[_0x2bda58(0x102)][_0x2bda58(0x128)],_0x46d44e[_0x2bda58(0x17b)]['username'],_0x2bda58(0x108),_0x2bda58(0x103));for(let _0x40b1e7 of _0x1127fa){if(_0x516d88[_0x2bda58(0x175)](_0x40b1e7[_0x2bda58(0x158)]))continue;_0x32181a[_0x2bda58(0x10b)]({'type':0x2,'name':_0x40b1e7['path'],'fileFullPath':_0x40b1e7[_0x2bda58(0x158)]});}return _0x57dd56[_0x2bda58(0x15c)]({'code':0x0,'data':{'parent':'','children':_0x32181a,'sep':_0x56829c,'platform':platform}});}if(!_0x2c11ee){if(_0x30eea8){if(platform=='win32'){function _0x529cf4(_0x5e8090){const _0x1b3806=_0x57575b;let _0x379e84=[];for(let _0xf9e697 of _0x5e8090){if(_0x516d88[_0x1b3806(0x175)](_0xf9e697['name']))continue;_0xf9e697[_0x1b3806(0x133)]=0x2,_0x379e84[_0x1b3806(0x10b)](_0xf9e697);}for(let _0x56c6c0 in _0x379e84){_0x379e84[_0x56c6c0]['fileFullPath']=_0x379e84[_0x56c6c0]['name'];}return _0x57dd56['json']({'code':0x0,'data':{'parent':_0x2c11ee,'children':_0x379e84,'sep':path[_0x1b3806(0xed)],'platform':platform}});}let _0x4a084a=dbConfigTable[_0x57575b(0x13a)](_0x46d44e[_0x57575b(0x102)]['dbOther'],_0x57575b(0x18d));if(_0x4a084a)try{_0x4a084a=JSON[_0x57575b(0x14b)](_0x4a084a['value']),_0x4e362d(![]),_0x529cf4(_0x4a084a);}catch(_0x2d2978){_0x4e362d(!![]);}else _0x4e362d(!![]);function _0x4e362d(_0x51e61e){const _0x210b96=_0x57575b;globalInfoUtil[_0x210b96(0xe4)](_0x2d1302=>{const _0x38c514=_0x210b96;_0x2d1302=_0x2d1302['sort']((_0x1fa272,_0x15dcbd)=>{const _0x187136=_0x2377;if(!_0x1fa272[_0x187136(0x152)]||!_0x15dcbd[_0x187136(0x152)])return;return _0x1fa272[_0x187136(0x152)]['localeCompare'](_0x15dcbd['name']);}),dbConfigTable[_0x38c514(0xca)](_0x46d44e[_0x38c514(0x102)][_0x38c514(0x128)],{'title':_0x38c514(0x18d),'value':JSON[_0x38c514(0x12b)](_0x2d1302)}),_0x51e61e&&_0x529cf4(_0x2d1302);});}}else{if(platform=='darwin'){if(!macPowerDetected){macPowerDetected=!![];try{const _0x5b2051=process[_0x57575b(0x137)][_0x57575b(0x197)];let _0x4c9ac4=[path[_0x57575b(0xf9)](_0x57575b(0x194),_0x5b2051,_0x57575b(0x101)),path[_0x57575b(0xf9)]('/Users',_0x5b2051,_0x57575b(0xc0)),path[_0x57575b(0xf9)](_0x57575b(0x194),_0x5b2051,'Desktop')];for(let _0x1b803a in _0x4c9ac4){fs[_0x57575b(0x161)](_0x4c9ac4[_0x1b803a],(_0x3936d2,_0x18863d)=>{});}}catch(_0x1f4b3d){}}let _0xb3cbcd=path['parse'](process[_0x57575b(0xf6)]())[_0x57575b(0x153)];_0x58f5d5(_0xb3cbcd);}else _0x2c11ee=path['parse'](process[_0x57575b(0xf6)]())[_0x57575b(0x153)],_0x58f5d5(_0x2c11ee);}}else return _0x171a5d();}else _0x58f5d5(_0x2c11ee);function _0x58f5d5(_0xf4db7a){const _0x28a583=_0x57575b;if(!_0x30eea8){if(!dbUserTable[_0x28a583(0x15e)](_0x46d44e,_0x57dd56,'folder',_0x28a583(0x103),_0xf4db7a,!![]))return console[_0x28a583(0x12a)]('未授权',_0xf4db7a),_0x171a5d();}if(_0xf4db7a=='sourceFolderPhoto'||_0xf4db7a==_0x28a583(0xdb)||_0xf4db7a==_0x28a583(0x145)||_0xf4db7a==_0x28a583(0x171)){let _0x10686f=_0x28a583(0x184);if(_0xf4db7a==_0x28a583(0xdb))_0x10686f=_0x28a583(0x104);else{if(_0xf4db7a==_0x28a583(0x145))_0x10686f=_0x28a583(0xfd);else _0xf4db7a==_0x28a583(0x171)&&(_0x10686f=_0x28a583(0x11e));}let _0x2b43f5=dbSourceFolderTable[_0x28a583(0xe7)](_0x46d44e[_0x28a583(0x102)]['dbOther'],_0x10686f);for(let _0x271455 in _0x2b43f5){_0x32181a[_0x28a583(0x10b)]({'type':0x2,'name':path[_0x28a583(0x13b)](_0x2b43f5[_0x271455]['path']),'fileFullPath':_0x2b43f5[_0x271455][_0x28a583(0x158)]});}return _0x57dd56[_0x28a583(0x15c)]({'code':0x0,'data':{'parent':_0xf4db7a,'children':_0x32181a,'sep':_0x56829c,'platform':platform}});}fs[_0x28a583(0x135)](_0xf4db7a,{'withFileTypes':!![]},(_0x4324dc,_0x2c3d99)=>{const _0xe6d7d3=_0x28a583;if(_0x4324dc)return console['log'](_0x4324dc),fileUtil[_0xe6d7d3(0xe6)](_0x57dd56,_0x4324dc);for(let _0x37c10d=0x0;_0x37c10d<_0x2c3d99[_0xe6d7d3(0x154)];_0x37c10d++){let _0x4946f7=_0x2c3d99[_0x37c10d],_0x250c52=_0x2c3d99[_0x37c10d][_0xe6d7d3(0x152)];if(_0x250c52[_0xe6d7d3(0x154)]>0x0){if(_0x250c52[0x0]=='.')continue;if(/[A-Z]:\\/i[_0xe6d7d3(0x155)](_0xf4db7a)&&_0xf4db7a[_0xe6d7d3(0x154)]<=0x3){if(win32ExcludeList[_0xe6d7d3(0x175)](_0x250c52)||_0x250c52[_0xe6d7d3(0x143)](_0xe6d7d3(0xc7))||_0x250c52[_0xe6d7d3(0x143)]('.tmp'))continue;}}let _0x1c8368=path[_0xe6d7d3(0xf9)](_0xf4db7a,_0x250c52);if(_0x516d88[_0xe6d7d3(0x175)](_0x1c8368))continue;let _0x3f0242=_0x4946f7['isFile'](),_0x48532d=_0x4946f7[_0xe6d7d3(0x172)]();function _0x1182bf(){if(_0x3f0242)(_0x55a3db==0x0||_0x55a3db==0x1)&&_0x32181a['push']({'type':0x1,'name':_0x250c52,'fileFullPath':_0x1c8368});else _0x48532d&&_0x32181a['push']({'type':0x2,'name':_0x250c52,'fileFullPath':_0x1c8368});}_0x3d96cf?_0x250c52[_0xe6d7d3(0x175)](_0x3d96cf)&&_0x1182bf():_0x1182bf();try{if(_0x32181a[_0xe6d7d3(0x154)]>0x1770)break;}catch(_0x31cb6b){continue;}}let _0x10e1f8=_0x32181a[_0xe6d7d3(0x154)],_0x54f8f1=0x0;if(_0x32181a[_0xe6d7d3(0x154)]<0x1)return _0x57dd56[_0xe6d7d3(0x15c)]({'code':0x0,'data':{'parent':_0xf4db7a,'children':_0x32181a,'sep':_0x56829c,'platform':platform}});for(let _0x54ead1 of _0x32181a){fs[_0xe6d7d3(0x161)](_0x54ead1[_0xe6d7d3(0x147)],(_0x4bb1de,_0x4e2ad2)=>{const _0x4a008c=_0xe6d7d3;_0x54f8f1+=0x1;!_0x4bb1de&&(_0x54ead1[_0x4a008c(0xc1)]=_0x4e2ad2[_0x4a008c(0xc1)],_0x54ead1[_0x4a008c(0x180)]=_0x4e2ad2[_0x4a008c(0x180)],_0x54ead1[_0x4a008c(0xbc)]=_0x4e2ad2[_0x4a008c(0xbc)],_0x54ead1[_0x4a008c(0xf1)]=_0x4e2ad2[_0x4a008c(0xf1)]);if(_0x54f8f1>=_0x10e1f8)return _0x57dd56[_0x4a008c(0x15c)]({'code':0x0,'data':{'parent':_0xf4db7a,'children':_0x32181a,'sep':_0x56829c,'platform':platform}});});}});}}catch(_0x531af5){return console['log'](_0x531af5),fileUtil[_0x57575b(0xe6)](_0x57dd56,_0x531af5);}}),router[_0x4a5d42(0x112)](_0x4a5d42(0xf3),(_0x51a47f,_0x91e8d7,_0x4d80f8)=>{const _0x5575c7=_0x4a5d42;let _0xeaceea=fileUtil[_0x5575c7(0x198)](_0x51a47f[_0x5575c7(0x106)][_0x5575c7(0x158)]);if(!_0xeaceea)return _0x91e8d7[_0x5575c7(0xb7)](0x194)[_0x5575c7(0x186)]();_0xeaceea=path['resolve'](path[_0x5575c7(0x16e)](_0xeaceea));let _0x1b2d9d=path['join'](config[_0x5575c7(0x10e)],'custom',path[_0x5575c7(0xed)]);return _0xeaceea[_0x5575c7(0x183)](_0x1b2d9d)?_0x91e8d7['sendFile'](_0xeaceea):(console['log'](_0x5575c7(0xc3)),_0x91e8d7[_0x5575c7(0xb7)](0x194)[_0x5575c7(0x186)]());}),router[_0x4a5d42(0x112)](_0x4a5d42(0xdd),(_0x43defb,_0x13c354,_0x572e18)=>{const _0x57064d=_0x4a5d42;let _0x2da4d9=_0x43defb[_0x57064d(0x106)][_0x57064d(0x158)],_0x1ef71f=_0x43defb[_0x57064d(0x106)]['download']==0x1,_0x121971=fileUtil[_0x57064d(0x198)](_0x2da4d9),_0xa27cef=_0x43defb[_0x57064d(0x106)][_0x57064d(0xf1)],_0x1fbac7=_0x43defb['query']['quality'];if(dbUserTable[_0x57064d(0x15e)](_0x43defb,_0x13c354,'','power_get',_0x121971)==!![])try{let _0x25b86f=_0x43defb['query'][_0x57064d(0xf4)];if(_0x25b86f&&_0x25b86f==0x1){if(_0x1ef71f){const _0x39f250=encodeURIComponent(path['basename'](_0x121971))[_0x57064d(0xb8)](/%([0-9A-F]{2})/g,(_0x1aa270,_0x2383ee)=>'%'+_0x2383ee[_0x57064d(0xda)]());_0x13c354[_0x57064d(0x195)](_0x57064d(0xee),'attachment;\x20filename*=UTF-8\x27\x27'+_0x39f250);}return _0x13c354[_0x57064d(0x178)](_0x121971);}else _0x43defb['query'][_0x57064d(0x15a)]&&_0x43defb[_0x57064d(0x106)][_0x57064d(0x15a)]=='utf8'&&path[_0x57064d(0xba)](_0x121971)&&path[_0x57064d(0xba)](_0x121971)[_0x57064d(0x129)]()==_0x57064d(0x140)?(console[_0x57064d(0x12a)](_0x57064d(0x13c),_0x121971),encodingUtil[_0x57064d(0xbf)](_0x121971)['then'](_0x2063b7=>{const _0xd86286=_0x57064d;return _0x2063b7?_0x2063b7[_0xd86286(0x157)](_0x13c354):(console['log'](_0xd86286(0x146),_0x121971),_0x13c354[_0xd86286(0x178)](_0x121971));})):sharpUtil[_0x57064d(0xf5)](_0x13c354,_0x121971,_0x1ef71f,_0xa27cef,_0x1fbac7);}catch(_0x59067b){return console[_0x57064d(0x12a)](_0x59067b),fileUtil[_0x57064d(0xe6)](_0x13c354,_0x59067b);}}),router[_0x4a5d42(0xcb)]('/checkFolderPower',(_0xad3fff,_0x459758,_0x339295)=>{const _0x527fa8=_0x4a5d42;let _0x4a1412=fileUtil[_0x527fa8(0x198)](_0xad3fff[_0x527fa8(0xfa)][_0x527fa8(0x134)]),_0x4a30bc=_0xad3fff[_0x527fa8(0xfa)][_0x527fa8(0x17e)];if(_0x4a30bc=='write')_0x4a30bc=fs[_0x527fa8(0x17d)][_0x527fa8(0x14f)];else _0x4a30bc==_0x527fa8(0x18f)&&(_0x4a30bc=fs[_0x527fa8(0x17d)][_0x527fa8(0x18b)]);try{_0x4a30bc==_0x527fa8(0x19b)?fs[_0x527fa8(0x142)](_0x4a1412,fs[_0x527fa8(0x17d)][_0x527fa8(0x14f)],_0x4c9867=>{const _0x130ca3=_0x527fa8;if(_0x4c9867)return fileUtil[_0x130ca3(0xe6)](_0x459758,_0x4c9867);return _0x459758[_0x130ca3(0x15c)]({'code':0x0,'access':!![]});}):fs[_0x527fa8(0x142)](_0x4a1412,_0x4a30bc,_0x3d1aa6=>{const _0x5dc1a3=_0x527fa8;if(_0x3d1aa6)return fileUtil[_0x5dc1a3(0xe6)](_0x459758,_0x3d1aa6);return _0x459758[_0x5dc1a3(0x15c)]({'code':0x0,'access':!![]});});}catch(_0xbb5d7b){return _0x459758['json']({'code':0x0,'access':![]});}}),router[_0x4a5d42(0xcb)](_0x4a5d42(0x13e),(_0x4b4bb1,_0x4698b0,_0x1c5da9)=>{const _0x3269bc=_0x4a5d42;let _0x39c833=fileUtil['decodePath'](_0x4b4bb1[_0x3269bc(0xfa)][_0x3269bc(0xd2)]),_0x45f3f3=_0x4b4bb1[_0x3269bc(0xfa)][_0x3269bc(0xe1)],_0x290928=path['join'](_0x39c833,_0x45f3f3);if(dbUserTable[_0x3269bc(0x15e)](_0x4b4bb1,_0x4698b0,_0x3269bc(0x108),'power_add',_0x290928)==!![])try{fs[_0x3269bc(0x161)](_0x290928,_0x14b4bd=>{const _0x27bbba=_0x3269bc;if(!_0x14b4bd)return _0x4b4bb1[_0x27bbba(0x102)]['returnErrMsg'](_0x4698b0,_0x4698b0['__']('sameNameFileAlreadExist')+':'+_0x290928);else fs[_0x27bbba(0xd6)](_0x290928,{'recursive':!![]},_0x52ac55=>{const _0xc72645=_0x27bbba;return _0x52ac55?fileUtil[_0xc72645(0xe6)](_0x4698b0,_0x52ac55):_0x4698b0[_0xc72645(0x15c)]({'code':0x0});});});}catch(_0x11a74a){return fileUtil[_0x3269bc(0xe6)](_0x4698b0,_0x11a74a);}}),router[_0x4a5d42(0xcb)](_0x4a5d42(0x18e),(_0x10be86,_0x5dee09,_0x2d7853)=>{const _0x2db5c3=_0x4a5d42;let _0x3b1600=_0x10be86[_0x2db5c3(0xfa)][_0x2db5c3(0x15d)],_0x4b7559=_0x10be86['body'][_0x2db5c3(0x14c)],_0x3ad7a5=_0x10be86[_0x2db5c3(0xfa)][_0x2db5c3(0x133)];if(_0x3ad7a5!=_0x2db5c3(0x123)&&_0x3ad7a5!=_0x2db5c3(0xbd))return _0x10be86[_0x2db5c3(0x102)][_0x2db5c3(0x13d)](_0x5dee09,_0x5dee09['__'](_0x2db5c3(0x156)));if(dbUserTable['doUserCanGet'](_0x10be86,_0x5dee09,_0x2db5c3(0x108),_0x2db5c3(0x103),_0x3b1600)==!![]&&dbUserTable[_0x2db5c3(0x15e)](_0x10be86,_0x5dee09,_0x2db5c3(0x108),_0x2db5c3(0x10f),_0x4b7559)==!![]){let _0x21c46f=_0x10be86[_0x2db5c3(0x102)][_0x2db5c3(0x128)][_0x2db5c3(0xcd)](_0x2db5c3(0x190))[_0x2db5c3(0xc2)](_0x2db5c3(0x12d),JSON[_0x2db5c3(0x12b)]({'sourcePath':_0x3b1600,'targetPath':_0x4b7559,'type':_0x3ad7a5,'username':_0x10be86[_0x2db5c3(0x17b)][_0x2db5c3(0x182)]}));return process['send']({'type':'START_WORKER_FILE_OPERATION','taskIdList':[_0x21c46f[_0x2db5c3(0x105)]]}),_0x5dee09['json']({'code':0x0});}}),router[_0x4a5d42(0xcb)](_0x4a5d42(0xc6),(_0x4f0630,_0x20596a,_0x12d63f)=>{const _0x4610eb=_0x4a5d42;let _0x436fff=_0x4f0630[_0x4610eb(0xfa)]['sourcePathList'],_0x4067e5=_0x4f0630[_0x4610eb(0xfa)][_0x4610eb(0x14c)],_0x470204=_0x4f0630['body'][_0x4610eb(0x133)];if(_0x436fff[_0x4610eb(0x154)]<0x1)return _0x4f0630[_0x4610eb(0x102)][_0x4610eb(0x13d)](_0x20596a,_0x20596a['__'](_0x4610eb(0x156)));if(dbUserTable[_0x4610eb(0x15e)](_0x4f0630,_0x20596a,_0x4610eb(0x108),'power_get',_0x436fff[0x0])==!![]&&dbUserTable[_0x4610eb(0x15e)](_0x4f0630,_0x20596a,_0x4610eb(0x108),_0x4610eb(0x10f),_0x4067e5)==!![])try{let _0x716ced=[];for(let _0x5d4134 in _0x436fff){let _0x52bc90=_0x436fff[_0x5d4134],_0x6ede40=path[_0x4610eb(0x13b)](_0x52bc90),_0x239dfd=path[_0x4610eb(0xf9)](_0x4067e5,_0x6ede40),_0x438479=_0x4f0630[_0x4610eb(0x102)][_0x4610eb(0x128)][_0x4610eb(0xcd)](_0x4610eb(0x190))[_0x4610eb(0xc2)]('FILE_OPERATION',JSON[_0x4610eb(0x12b)]({'sourcePath':_0x52bc90,'targetPath':_0x239dfd,'type':_0x470204,'username':_0x4f0630['currentUser']['username']}));_0x716ced[_0x4610eb(0x10b)](_0x438479[_0x4610eb(0x105)]);}return process[_0x4610eb(0xd7)]({'type':'START_WORKER_FILE_OPERATION','taskIdList':_0x716ced}),_0x20596a[_0x4610eb(0x15c)]({'code':0x0});}catch(_0x8f6daf){return _0x4f0630['app']['returnErrMsg'](_0x20596a,_0x20596a['__']('operationFail'));}}),router[_0x4a5d42(0xcb)]('/operationFolder',(_0x388670,_0x273dc9,_0x1d7906)=>{const _0xd16588=_0x4a5d42;let _0x5ba620=fileUtil[_0xd16588(0x198)](_0x388670[_0xd16588(0xfa)][_0xd16588(0x15d)]),_0x49c69a=fileUtil[_0xd16588(0x198)](_0x388670['body'][_0xd16588(0x14c)]),_0x111813=path[_0xd16588(0x13b)](_0x5ba620),_0xa313a5=_0x388670['body'][_0xd16588(0x133)],_0x477d09=path['join'](_0x49c69a,_0x111813);if(_0xa313a5==_0xd16588(0xc5)||_0xa313a5==_0xd16588(0xe5)){if(fs[_0xd16588(0xff)](_0x477d09))return _0x388670['app'][_0xd16588(0x13d)](_0x273dc9,_0x273dc9['__'](_0xd16588(0xe3))+':'+_0x477d09);}let _0x5c66d9=_0x388670['body'][_0xd16588(0x162)];function _0x451d72(_0x433864,_0x2e16a1){const _0x12a982=_0xd16588;let _0x288be3=_0x388670[_0x12a982(0x102)]['dbOther'][_0x12a982(0xcd)](_0x12a982(0x190))['run']('FILE_OPERATION',JSON[_0x12a982(0x12b)]({'sourcePath':_0x433864,'targetPath':_0x2e16a1,'type':_0xa313a5,'username':_0x388670[_0x12a982(0x17b)]['username']}));return _0x288be3[_0x12a982(0x105)];}try{_0x5ba620=path[_0xd16588(0xf9)](_0x5ba620),_0x49c69a=path[_0xd16588(0xf9)](_0x49c69a);if(_0x49c69a==_0x5ba620||_0x49c69a[_0xd16588(0x183)](_0x5ba620+path['sep']))return _0x388670[_0xd16588(0x102)][_0xd16588(0x13d)](_0x273dc9,_0x273dc9['__'](_0xd16588(0x167)));if(dbUserTable['doUserCanGet'](_0x388670,_0x273dc9,_0xd16588(0x108),_0xd16588(0x103),_0x5ba620)==!![]){let _0x233c8d=![];fs[_0xd16588(0x161)](_0x5ba620,(_0x34f5c2,_0x3f005a)=>{const _0x546d8c=_0xd16588;if(_0x34f5c2)return _0x388670['app'][_0x546d8c(0x13d)](_0x273dc9,_0x273dc9['__'](_0x546d8c(0x185))+':'+_0x5ba620);let _0x3e78e3=path[_0x546d8c(0x13b)](_0x5ba620);fs[_0x546d8c(0x142)](_0x49c69a,fs[_0x546d8c(0x17d)][_0x546d8c(0x18b)]|fs['constants'][_0x546d8c(0x14f)],_0x531e89=>{const _0x514358=_0x546d8c;if(_0x531e89)return _0x388670[_0x514358(0x102)]['returnErrMsg'](_0x273dc9,_0x273dc9['__'](_0x514358(0xf0))+':'+_0x49c69a);if(_0xa313a5=='rename')dbUserTable[_0x514358(0x15e)](_0x388670,_0x273dc9,'folder',_0x514358(0xd3),_0x49c69a)==!![]&&(_0x49c69a=path[_0x514358(0xf9)](_0x49c69a,_0x5c66d9),fs[_0x514358(0x161)](_0x49c69a,_0x1c641e=>{const _0x2e5414=_0x514358;if(!_0x1c641e)return _0x388670[_0x2e5414(0x102)][_0x2e5414(0x13d)](_0x273dc9,_0x273dc9['__'](_0x2e5414(0xe3))+':'+_0x49c69a);else fs[_0x2e5414(0x181)](_0x5ba620,_0x49c69a,_0x14359c=>{const _0x2bf5a6=_0x2e5414;if(_0x14359c)return dbFileOperationRecord[_0x2bf5a6(0xf2)](_0x388670[_0x2bf5a6(0x102)][_0x2bf5a6(0x128)],{'username':_0x388670[_0x2bf5a6(0x17b)][_0x2bf5a6(0x182)],'sourcePath':_0x5ba620,'targetPath':_0x49c69a,'level':dbFileOperationRecord[_0x2bf5a6(0xe8)],'belongId':null,'type':dbFileOperationRecord['TYPE_RENMAE'],'subType':null,'state':dbFileOperationRecord[_0x2bf5a6(0x150)],'remark':fileUtil[_0x2bf5a6(0xe6)](_0x273dc9,_0x14359c,!![])}),dbNoticeCenterTable['create'](_0x388670['app'][_0x2bf5a6(0x128)],{'title':_0x273dc9['__'](_0x2bf5a6(0x156)),'level':'error','content':_0x273dc9['__'](_0x2bf5a6(0xeb))+':'+(_0x5ba620+_0x2bf5a6(0xfb)+_0x49c69a)});_0x233c8d=!![],dbFileOperationRecord['addFileOperationRecord'](_0x388670[_0x2bf5a6(0x102)]['dbOther'],{'username':_0x388670[_0x2bf5a6(0x17b)]['username'],'sourcePath':_0x5ba620,'targetPath':_0x49c69a,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'belongId':null,'type':dbFileOperationRecord[_0x2bf5a6(0x189)],'subType':null,'state':dbFileOperationRecord['STATE_SUC']});}),setTimeout(()=>{const _0x61cd1f=_0x2e5414;return _0x273dc9[_0x61cd1f(0x15c)]({'code':0x0,'isOver':_0x233c8d?0x1:0x0});},0x3e8);}));else{if(_0xa313a5==_0x514358(0xe5)){if(dbUserTable['doUserCanGet'](_0x388670,_0x273dc9,_0x514358(0x108),'power_delete',_0x49c69a)!==!![])return;}if(dbUserTable['doUserCanGet'](_0x388670,_0x273dc9,_0x514358(0x108),'power_add',_0x49c69a)==!![]){_0x49c69a=path[_0x514358(0xf9)](_0x49c69a,_0x3e78e3);let _0x376b90=_0x451d72(_0x5ba620,_0x49c69a);return process[_0x514358(0xd7)]({'type':_0x514358(0x18a),'taskIdList':[_0x376b90]}),_0x273dc9[_0x514358(0x15c)]({'code':0x0});}}});});}}catch(_0x455c6b){return _0x388670['app'][_0xd16588(0x13d)](_0x273dc9,_0x273dc9['__']('operationFail'));}}),router['post']('/getPathState',(_0x5b34a1,_0x1e4643,_0x905f41)=>{const _0x12511a=_0x4a5d42;let _0x3b2c57=_0x5b34a1[_0x12511a(0xfa)][_0x12511a(0x10a)];if(!_0x3b2c57)return _0x1e4643[_0x12511a(0xb7)](0x194)[_0x12511a(0x186)]();dbUserTable[_0x12511a(0x15e)](_0x5b34a1,_0x1e4643,'folder',_0x12511a(0x103),_0x3b2c57)==!![]&&fs[_0x12511a(0x161)](_0x3b2c57,(_0x48becf,_0x286a75)=>{const _0x5f23e1=_0x12511a;if(_0x48becf)return fileUtil[_0x5f23e1(0xe6)](_0x1e4643,_0x48becf);return _0x286a75['sizeStr']=fileUtil['getTransSizeStr'](_0x286a75[_0x5f23e1(0xf1)]),_0x1e4643[_0x5f23e1(0x15c)]({'code':0x0,'data':_0x286a75});});}),router[_0x4a5d42(0xcb)](_0x4a5d42(0xde),(_0x5ca21e,_0x11c3bf,_0x32e36c)=>{const _0xdcf600=_0x4a5d42;let _0x8e3b7d=_0x5ca21e['body'][_0xdcf600(0x141)],_0x25c839=_0x5ca21e['body'][_0xdcf600(0x130)];_0x25c839&&(_0x25c839=_0x25c839[_0xdcf600(0xb8)](/[<>\\\/:\*\?\"\|]/g,'_')),_0x8e3b7d&&(_0x8e3b7d=fileUtil[_0xdcf600(0x198)](_0x8e3b7d)),fs[_0xdcf600(0x142)](_0x8e3b7d,fs['constants'][_0xdcf600(0x14f)]|fs[_0xdcf600(0x17d)][_0xdcf600(0x18b)],_0x4d65e3=>{const _0x4a8aca=_0xdcf600;if(_0x4d65e3)return _0x11c3bf['json']({'code':0x1,'message':_0x11c3bf['__']('noWritePermission')+':'+_0x8e3b7d});else{let _0x48fb45='';if(_0x8e3b7d&&_0x25c839)_0x48fb45=path[_0x4a8aca(0xf9)](_0x8e3b7d,_0x25c839);else{if(_0x8e3b7d)_0x48fb45=path[_0x4a8aca(0xf9)](_0x8e3b7d);else return _0x11c3bf['json']({'code':0x1,'message':_0x11c3bf['__'](_0x4a8aca(0x127))+':'+_0x8e3b7d});}fs[_0x4a8aca(0x161)](_0x48fb45,_0x3fdb7d=>{const _0x383430=_0x4a8aca;return _0x3fdb7d?_0x11c3bf['json']({'code':0x0}):_0x11c3bf[_0x383430(0x15c)]({'code':0x1,'remark':'EXIST'});});}});}),router['post'](_0x4a5d42(0x15f),(_0x394f67,_0x2039eb,_0x920006)=>{const _0x2f6f4a=_0x4a5d42;let _0x1e6002=_0x394f67[_0x2f6f4a(0xfa)][_0x2f6f4a(0x10a)],_0x96819b=_0x394f67['body']['putInSystemTrash'];if(!_0x1e6002)return _0x2039eb[_0x2f6f4a(0xb7)](0x194)[_0x2f6f4a(0x186)]();_0x1e6002=path[_0x2f6f4a(0xf9)](_0x1e6002);if(dbUserTable[_0x2f6f4a(0x15e)](_0x394f67,_0x2039eb,_0x2f6f4a(0x108),_0x2f6f4a(0x14a),_0x1e6002)==!![]){if(_0x96819b==0x1)return process[_0x2f6f4a(0xd7)]({'type':_0x2f6f4a(0x16a),'shellType':_0x2f6f4a(0x113),'path':_0x1e6002}),dbFileOperationRecord[_0x2f6f4a(0xf2)](_0x394f67[_0x2f6f4a(0x102)][_0x2f6f4a(0x128)],{'username':_0x394f67[_0x2f6f4a(0x17b)][_0x2f6f4a(0x182)],'targetPath':_0x1e6002,'level':dbFileOperationRecord[_0x2f6f4a(0xe8)],'type':dbFileOperationRecord[_0x2f6f4a(0x107)],'state':dbFileOperationRecord[_0x2f6f4a(0xec)]}),_0x2039eb[_0x2f6f4a(0x15c)]({'code':0x0,'message':_0x2039eb['__'](_0x2f6f4a(0xea))});else fs['rm'](_0x1e6002,{'recursive':!![]},_0x172252=>{const _0x349bff=_0x2f6f4a;if(_0x172252)return dbFileOperationRecord[_0x349bff(0xf2)](_0x394f67['app'][_0x349bff(0x128)],{'username':_0x394f67[_0x349bff(0x17b)]['username'],'targetPath':_0x1e6002,'level':dbFileOperationRecord[_0x349bff(0xe8)],'type':dbFileOperationRecord[_0x349bff(0x107)],'state':dbFileOperationRecord['STATE_FAIL'],'remark':fileUtil[_0x349bff(0xe6)](_0x2039eb,_0x172252,!![])}),fileUtil[_0x349bff(0xe6)](_0x2039eb,_0x172252);return dbFileOperationRecord[_0x349bff(0xf2)](_0x394f67['app'][_0x349bff(0x128)],{'username':_0x394f67[_0x349bff(0x17b)][_0x349bff(0x182)],'targetPath':_0x1e6002,'level':dbFileOperationRecord[_0x349bff(0xe8)],'type':dbFileOperationRecord[_0x349bff(0x107)],'state':dbFileOperationRecord['STATE_SUC']}),_0x2039eb['json']({'code':0x0,'message':_0x2039eb['__'](_0x349bff(0xea))});});}}),router['post'](_0x4a5d42(0xc8),(_0x2c055c,_0x4dbc6a,_0x2be995)=>{const _0x5570c5=_0x4a5d42;if(_0x2c055c['currentUser']['is_admin']!=0x1)return _0x4dbc6a[_0x5570c5(0x15c)]({'code':0x66});return dbFileOperationRecord[_0x5570c5(0x191)](_0x2c055c[_0x5570c5(0x102)][_0x5570c5(0x128)]),_0x4dbc6a[_0x5570c5(0x15c)]({'code':0x0});}),router[_0x4a5d42(0xcb)]('/getOperationRecord',(_0x4f0053,_0x12d45c,_0x4be5c0)=>{const _0x1c49b3=_0x4a5d42;let _0x3fc003=_0x4f0053[_0x1c49b3(0xfa)][_0x1c49b3(0x16b)],_0x285c1a=_0x4f0053[_0x1c49b3(0xfa)][_0x1c49b3(0x131)],_0x3b9881=_0x4f0053[_0x1c49b3(0xfa)][_0x1c49b3(0x133)],_0x42afa0=_0x4f0053[_0x1c49b3(0xfa)]['level'],_0xd8747e=_0x4f0053[_0x1c49b3(0xfa)][_0x1c49b3(0xfc)],_0x1fccf8=_0x4f0053[_0x1c49b3(0xfa)][_0x1c49b3(0x124)],_0x361d82=_0x4f0053[_0x1c49b3(0xfa)][_0x1c49b3(0xd9)],_0x2ec33a;return _0x4f0053[_0x1c49b3(0x17b)]['is_admin']==0x1?_0x2ec33a=dbFileOperationRecord['getByPage'](_0x4f0053[_0x1c49b3(0x102)]['dbOther'],_0x3fc003,_0x285c1a,_0x42afa0,_0x3b9881,_0xd8747e,_0x1fccf8,_0x361d82):_0x2ec33a=dbFileOperationRecord['getByPage'](_0x4f0053[_0x1c49b3(0x102)]['dbOther'],_0x3fc003,_0x285c1a,_0x42afa0,_0x3b9881,_0xd8747e,_0x1fccf8,_0x361d82,_0x4f0053[_0x1c49b3(0x17b)][_0x1c49b3(0x182)]),_0x12d45c['json']({'code':0x0,'data':_0x2ec33a});}),router[_0x4a5d42(0xcb)](_0x4a5d42(0x148),(_0xd643b0,_0x15158a,_0x4afa42)=>{const _0x1500fc=_0x4a5d42;let _0x207f45=_0xd643b0['body'][_0x1500fc(0x187)];if(_0x207f45==_0x1500fc(0x126)||_0x207f45==_0x1500fc(0x117)){if(_0xd643b0[_0x1500fc(0x17b)][_0x1500fc(0x196)]!=0x1)return _0x15158a[_0x1500fc(0x15c)]({'code':0x66});}if(_0x207f45==_0x1500fc(0x126)){let _0x3b375d=_0xd643b0[_0x1500fc(0xfa)][_0x1500fc(0x133)],_0x3a28fb=_0xd643b0[_0x1500fc(0xfa)][_0x1500fc(0x149)],_0x27925b=_0xd643b0[_0x1500fc(0xfa)]['username'],_0x5c698d=_0xd643b0[_0x1500fc(0xfa)][_0x1500fc(0x17f)],_0x4104bc=_0xd643b0['body']['username'],_0xf833d7=_0xd643b0['body'][_0x1500fc(0x115)],_0x54ec13=[_0x1500fc(0x193),_0x1500fc(0x138),'samba'];if(!_0x3b375d||!_0x3a28fb||!_0x54ec13[_0x1500fc(0x175)](_0x3b375d))return _0xd643b0[_0x1500fc(0x102)][_0x1500fc(0x13d)](_0x15158a,_0x15158a['__']('operationFail'));_0x3b375d=='local'&&fileStatUtil['localPathIsFolder'](_0x3a28fb,()=>{const _0x1d8665=_0x1500fc;fileStatUtil[_0x1d8665(0x12c)](_0x3a28fb,()=>{const _0x424184=_0x1d8665,_0x36bd6e=_0x424184(0x114);return _0xd643b0[_0x424184(0x102)][_0x424184(0x128)][_0x424184(0xcd)](_0x36bd6e)['run'](_0x3b375d,_0x3a28fb,_0x27925b,_0x4104bc,_0xf833d7,_0x5c698d),_0x15158a[_0x424184(0x15c)]({'code':0x0});},()=>{const _0x3a6766=_0x1d8665;return _0xd643b0[_0x3a6766(0x102)][_0x3a6766(0x13d)](_0x15158a,_0x15158a['__'](_0x3a6766(0x185)));});},()=>{const _0x44b769=_0x1500fc;return _0xd643b0[_0x44b769(0x102)][_0x44b769(0x13d)](_0x15158a,_0x15158a['__'](_0x44b769(0xd4)));});}else{if(_0x207f45=='delete'){let _0x48d316=_0xd643b0[_0x1500fc(0xfa)]['id'];return _0xd643b0[_0x1500fc(0x102)][_0x1500fc(0x128)][_0x1500fc(0xcd)](_0x1500fc(0x125))[_0x1500fc(0xc2)](_0x48d316),_0x15158a[_0x1500fc(0x15c)]({'code':0x0});}else{if(_0x207f45==_0x1500fc(0x112)){let _0x2ded13=[],_0x288433=_0xd643b0[_0x1500fc(0x102)]['dbOther'][_0x1500fc(0xcd)](_0x1500fc(0x16d))['all']();if(_0xd643b0[_0x1500fc(0x17b)]['is_admin']==0x1)_0x2ded13=_0x288433;else{let _0x3cff83=dbUserTable['getUserPower'](_0xd643b0['app'][_0x1500fc(0x128)],_0xd643b0[_0x1500fc(0x17b)][_0x1500fc(0x182)],'folder',_0x1500fc(0x103));for(let _0x42e2c8 in _0x3cff83){let _0x42c109=_0x3cff83[_0x42e2c8][_0x1500fc(0x158)][_0x1500fc(0x129)]();_0x42c109=path[_0x1500fc(0xf9)](_0x42c109);for(let _0x1ed1f4 in _0x288433){try{if(_0x288433[_0x1ed1f4][_0x1500fc(0x149)]&&_0x42c109){let _0x332935=_0x288433[_0x1ed1f4][_0x1500fc(0x149)]['toLowerCase']();_0x332935[_0x1500fc(0x143)](':')&&_0x332935[_0x1500fc(0x154)]==0x2&&(_0x332935=_0x332935+path['sep']),_0x332935=path[_0x1500fc(0xf9)](_0x332935)[_0x1500fc(0x129)](),(_0x42c109==_0x332935||_0x332935[_0x1500fc(0x183)](path[_0x1500fc(0xf9)](_0x42c109+path['sep'])))&&_0x2ded13[_0x1500fc(0x10b)](_0x288433[_0x1ed1f4]);}}catch(_0x3758e3){continue;}}}}return _0x15158a['json']({'code':0x0,'data':_0x2ded13});}}}});function getRandomString(_0x40a044){const _0x1318cc=_0x4a5d42;let _0xc777b='';const _0x915290='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',_0x4ea15e=_0x915290['length'];for(let _0x5c2837=0x0;_0x5c2837<_0x40a044;_0x5c2837++){_0xc777b+=_0x915290[_0x1318cc(0xcf)](Math[_0x1318cc(0xc4)](Math['random']()*_0x4ea15e));}return _0xc777b;}router[_0x4a5d42(0xcb)](_0x4a5d42(0x19a),(_0x262281,_0x4cbd22,_0x46a0ee)=>{const _0x38bc25=_0x4a5d42;let _0x453b4a=[];return _0x262281[_0x38bc25(0x17b)][_0x38bc25(0x196)]==0x1?_0x453b4a=_0x262281['app'][_0x38bc25(0x128)]['prepare'](_0x38bc25(0xdf))[_0x38bc25(0x19b)]():_0x453b4a=_0x262281[_0x38bc25(0x102)][_0x38bc25(0x128)][_0x38bc25(0xcd)](_0x38bc25(0x109))[_0x38bc25(0x19b)](_0x262281['currentUser']['id']),_0x4cbd22['json']({'code':0x0,'data':_0x453b4a});}),router[_0x4a5d42(0xcb)](_0x4a5d42(0x12e),(_0x2cd844,_0x1bb590,_0x187f7e)=>{const _0x16a471=_0x4a5d42;let _0x5ac7fd=_0x2cd844['body'][_0x16a471(0x187)];if(_0x5ac7fd==_0x16a471(0x126))try{if(!_0x2cd844[_0x16a471(0xfa)]['path'])return _0x2cd844['app'][_0x16a471(0x13d)](_0x1bb590,'error');let _0x2f1217=fileUtil[_0x16a471(0x198)](_0x2cd844[_0x16a471(0xfa)][_0x16a471(0x158)]);_0x2f1217=path[_0x16a471(0xf9)](_0x2f1217);function _0x950eb9(){const _0xf76f59=_0x16a471;if(dbUserTable[_0xf76f59(0x15e)](_0x2cd844,_0x1bb590,'',_0xf76f59(0x103),_0x2f1217)==!![]){let _0x5de32d=_0x2cd844[_0xf76f59(0xfa)]['password']?_0x2cd844[_0xf76f59(0xfa)][_0xf76f59(0x115)]:'',_0x7aa8d=new Date()[_0xf76f59(0xb9)](),_0x2e2d90=getRandomString(0x5),_0xa0c53d=_0x2cd844[_0xf76f59(0x102)][_0xf76f59(0x128)][_0xf76f59(0xcd)]('SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?')[_0xf76f59(0x112)](_0x2e2d90);if(_0xa0c53d)return _0x950eb9();let _0x10479b=_0x2cd844[_0xf76f59(0xfa)][_0xf76f59(0x173)]?_0x2cd844[_0xf76f59(0xfa)][_0xf76f59(0x173)]:0x1e,_0x4d4c40=0xe10*0x3e8*0x18*_0x10479b+_0x7aa8d;return _0x2cd844[_0xf76f59(0x102)][_0xf76f59(0x128)][_0xf76f59(0xcd)](_0xf76f59(0xe2))[_0xf76f59(0xc2)](_0x2f1217,_0x5de32d,_0x2e2d90,_0x7aa8d,_0x4d4c40,_0x2cd844[_0xf76f59(0x17b)]['id']),_0x1bb590['json']({'code':0x0,'token':_0x2e2d90});}}return _0x950eb9();}catch(_0x4dc85c){return console[_0x16a471(0x12a)](_0x4dc85c),_0x2cd844['app']['returnErrMsg'](_0x1bb590,_0x16a471(0x15b));}else{if(_0x5ac7fd=='delete'){let _0xd813dd=_0x2cd844[_0x16a471(0xfa)][_0x16a471(0xce)];return _0x2cd844[_0x16a471(0x17b)][_0x16a471(0x196)]==0x1?_0x2cd844[_0x16a471(0x102)]['dbOther'][_0x16a471(0xcd)](_0x16a471(0x166))[_0x16a471(0xc2)](_0xd813dd):_0x2cd844[_0x16a471(0x102)][_0x16a471(0x128)][_0x16a471(0xcd)]('DELETE\x20FROM\x20share_temp\x20WHERE\x20id\x20=\x20?\x20and\x20user_id=?')[_0x16a471(0xc2)](_0xd813dd,_0x2cd844[_0x16a471(0x17b)]['id']),_0x1bb590[_0x16a471(0x15c)]({'code':0x0});}}}),router['post'](_0x4a5d42(0x17c),(_0x3209a4,_0x527b0b,_0x53cfe4)=>{const _0x5c7870=_0x4a5d42;let _0x306038=_0x3209a4['body'][_0x5c7870(0xdc)]||_0x3209a4['body']['st'],_0x5ec599=_0x3209a4['body']['parent'],_0x12fa01=_0x3209a4[_0x5c7870(0xfa)]['password'],_0x22ae6b=[],_0x38599a=dbConfigTable[_0x5c7870(0x165)](_0x3209a4['app']['dbOther'],[_0x5c7870(0x139),_0x5c7870(0x179)]),_0xed4db3={'code':0x0,'data':{'customConfig':_0x38599a,'parent':_0x5ec599,'children':_0x22ae6b,'sep':path[_0x5c7870(0xed)],'platform':platform}};if(!_0x306038)return _0x527b0b['json'](_0xed4db3);let _0x4717b5=dbUserTable[_0x5c7870(0x144)](_0x3209a4[_0x5c7870(0x102)][_0x5c7870(0x128)],_0x306038);if(!_0x4717b5)return _0x527b0b[_0x5c7870(0x15c)](_0xed4db3);if(_0x4717b5[_0x5c7870(0x115)]){if(!_0x12fa01)return _0x527b0b['json']({'code':0x2});if(_0x4717b5[_0x5c7870(0x115)]!=_0x12fa01)return _0x527b0b[_0x5c7870(0x15c)]({'code':0x2,'message':_0x527b0b['__']('login.pwdErr')});}function _0x3ba605(){const _0x3048f5=_0x5c7870;fs[_0x3048f5(0x161)](_0x4717b5[_0x3048f5(0x158)],(_0x44720c,_0x407165)=>{const _0x40c7d3=_0x3048f5;if(_0x44720c)return _0x527b0b[_0x40c7d3(0x15c)](_0xed4db3);return _0xed4db3[_0x40c7d3(0x18c)][_0x40c7d3(0x176)][_0x40c7d3(0x10b)]({'type':_0x407165[_0x40c7d3(0x10d)]()?0x1:0x2,'name':path[_0x40c7d3(0x13b)](_0x4717b5[_0x40c7d3(0x158)]),'fileFullPath':_0x4717b5[_0x40c7d3(0x158)]}),_0x527b0b[_0x40c7d3(0x15c)](_0xed4db3);});}if(!_0x5ec599)_0x3ba605();else{let _0x3a2d18=dbUserTable[_0x5c7870(0x122)](_0x3209a4[_0x5c7870(0x102)][_0x5c7870(0x128)],_0x306038,_0x5ec599,_0x12fa01);if(!_0x3a2d18)return console[_0x5c7870(0x12a)](_0x5c7870(0x11b),_0x5ec599),_0x3ba605();fs['readdir'](_0x5ec599,{'withFileTypes':!![]},(_0x3b2769,_0x5271d0)=>{const _0x135883=_0x5c7870;if(_0x3b2769)return _0x527b0b[_0x135883(0x15c)](_0xed4db3);let _0x277598=0x0;if(_0x5271d0['length']<0x1)return _0x527b0b[_0x135883(0x15c)](_0xed4db3);for(let _0x444ad3=0x0;_0x444ad3<_0x5271d0['length'];_0x444ad3++){let _0x86b90e=_0x5271d0[_0x444ad3],_0x40eba9=_0x5271d0[_0x444ad3][_0x135883(0x152)];if(_0x40eba9[_0x135883(0x154)]>0x0){if(_0x40eba9[0x0]=='.'){_0x277598+=0x1;if(_0x277598>=_0x5271d0['length'])return _0x527b0b[_0x135883(0x15c)](_0xed4db3);continue;}if(/[A-Z]:\\/i['test'](_0x5ec599)&&_0x5ec599['length']<=0x3){if(win32ExcludeList['includes'](_0x40eba9)||_0x40eba9['endsWith'](_0x135883(0xc7))||_0x40eba9[_0x135883(0x143)](_0x135883(0x132))){_0x277598+=0x1;if(_0x277598>=_0x5271d0[_0x135883(0x154)])return _0x527b0b[_0x135883(0x15c)](_0xed4db3);continue;}}}let _0x5718f4=path[_0x135883(0xf9)](_0x5ec599,_0x40eba9);fs[_0x135883(0x161)](_0x5718f4,(_0x58854e,_0x21b07d)=>{const _0x122df6=_0x135883;_0x277598+=0x1;let _0x2a9084=_0x86b90e[_0x122df6(0x10d)](),_0x23d551=_0x86b90e[_0x122df6(0x172)](),_0x324d57={'name':_0x40eba9,'fileFullPath':_0x5718f4};!_0x58854e&&_0x21b07d&&(_0x324d57['size']=_0x21b07d[_0x122df6(0xf1)],_0x324d57['createTime']=_0x21b07d[_0x122df6(0xbc)]||_0x21b07d['ctimeMs']);_0x2a9084?_0x324d57[_0x122df6(0x133)]=0x1:_0x324d57['type']=0x2;_0xed4db3[_0x122df6(0x18c)]['children'][_0x122df6(0x10b)](_0x324d57);if(_0x277598>=_0x5271d0[_0x122df6(0x154)])return _0x527b0b[_0x122df6(0x15c)](_0xed4db3);});}});}}),module[_0x4a5d42(0x10c)]=router;function _0x20ef(){const _0x125535=['Documents','app','power_get','movie','lastInsertRowid','query','TYPE_DELETE','folder','SELECT\x20*\x20FROM\x20share_temp\x20where\x20user_id=?','fullPath','push','exports','isFile','userDataFolder','power_add','454552JZYyzN','platform','get','trash','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20REPLACE\x20INTO\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path_mount(type,url,name,username,password,remark)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES(?,?,?,?,?,?)','password','../../myConfig/config','delete','sharp','archiver','../../db/dbFileOperationRecord','no\x20permission\x20','zip\x20error','headersSent','book','finalize','172711wpjxdk','directory','doUserCanGetTempShare','zip','result','delete\x20from\x20path_mount\x20where\x20id=?','add','folderNotExist','dbOther','toLowerCase','log','stringify','localPathIsReadable','FILE_OPERATION','/tempShare','../utils/sharpUtils','fileName','pageSize','.tmp','type','checkPath','readdir','destroy','env','webdav','customLogoImage','findByTitle','basename','Convert\x20to\x20utf8\x20','returnErrMsg','/addNewFolder','unpipe','.txt','folderPath','access','endsWith','getTempShareObj','sourceFolderMusic','Unable\x20to\x20read\x20file','fileFullPath','/operationPathMount','url','power_delete','parse','targetPath','win32','.zip','W_OK','STATE_FAIL','getUserPower','name','root','length','test','operationFail','pipe','path','res\x20closed,destroy\x20zip\x20stream','code','error','json','sourcePath','doUserCanGet','/deleteByPath','removeHeader','stat','newName','../../db/dbSourceFolderTable','/zipFile/*','findByTitleParamsList','DELETE\x20FROM\x20share_temp\x20WHERE\x20id\x20=\x20?','cannotCopyToSelf','../utils/fileUtils','Documents\x20and\x20Settings','shell','page','143845qjiZBL','select\x20id,type,url,name,remark\x20from\x20path_mount','normalize','/getPathTree','createReadStream','sourceFolderBook','isDirectory','days','close','includes','children','../../utils/fileStatUtil','sendFile','customHomeBgImage','getExcludePathList','currentUser','/getTempShareFiles','constants','checkPower','pathName','mtimeMs','rename','username','startsWith','photo','noReadPermission','end','operationType','$RECYCLE.BIN','TYPE_RENMAE','START_WORKER_FILE_OPERATION','R_OK','data','cachePathRoot','/zipFile','read','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','deleteFileRecordAll','144vXlnWS','local','/Users','setHeader','is_admin','USER','decodePath','sha256','/getTempShare','all','../../utils/encodingUtil','status','replace','getTime','extname','../../db/dbConfigTable','birthtimeMs','unzip','Router','getUtf8FileStream','Downloads','atimeMs','run','404','floor','copy','/operationFileList','.sys','/clearOperationRecord','$WinREAgent','create','post','10311qqQsiA','prepare','deleteId','charAt','1176yjSEHn','$Recycle.Bin','parentPath','power_change','targetPathInvalid','2022NimTcV','mkdir','send','zip\x20finish','searchStr','toUpperCase','sourceFolderMovie','shareToken','/rawFile*','/fileExist','SELECT\x20*\x20FROM\x20share_temp','../../db/dbUserTable','folderName','INSERT\x20INTO\x20share_temp(path,password,token,create_timestamp,end_timestamp,user_id)\x20VALUES(?,?,?,?,?,?)','sameNameFileAlreadExist','getWindowsDiskList','cut','returnFileError','getPathByType','LEVEL_MAIN_OPERATION','210132nnsjVO','deleteSuccess','fileRenameFail','STATE_SUC','sep','Content-Disposition','express','noWritePermission','size','addFileOperationRecord','/customImageFile','raw','returnDealedFile','cwd','System\x20Volume\x20Information','An\x20error\x20occurred\x20while\x20compressing\x20the\x20files.','join','body','\x20->\x20','subType','music','320326AsGHIZ','existsSync','slice'];_0x20ef=function(){return _0x125535;};return _0x20ef();}