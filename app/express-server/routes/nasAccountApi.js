const _0x477b70=_0x2150;(function(_0x35d67f,_0x3d13ea){const _0x326a32=_0x2150,_0x2d9c30=_0x35d67f();while(!![]){try{const _0x50b6a9=-parseInt(_0x326a32(0x13f))/0x1*(parseInt(_0x326a32(0x15a))/0x2)+-parseInt(_0x326a32(0x14f))/0x3+-parseInt(_0x326a32(0x159))/0x4+parseInt(_0x326a32(0x164))/0x5*(-parseInt(_0x326a32(0x170))/0x6)+-parseInt(_0x326a32(0x172))/0x7+parseInt(_0x326a32(0x18a))/0x8*(-parseInt(_0x326a32(0x16b))/0x9)+parseInt(_0x326a32(0x18c))/0xa*(parseInt(_0x326a32(0x178))/0xb);if(_0x50b6a9===_0x3d13ea)break;else _0x2d9c30['push'](_0x2d9c30['shift']());}catch(_0x127c49){_0x2d9c30['push'](_0x2d9c30['shift']());}}}(_0x3d99,0xa1070));var express=require('express'),router=express[_0x477b70(0x176)]();function _0x2150(_0x132baa,_0x2c1940){const _0x3d9972=_0x3d99();return _0x2150=function(_0x215032,_0x8dedff){_0x215032=_0x215032-0x12d;let _0x5d135e=_0x3d9972[_0x215032];return _0x5d135e;},_0x2150(_0x132baa,_0x2c1940);}let config=require(_0x477b70(0x15d)),dbConfigTable=require('../../db/dbConfigTable'),dbNoticeCenterTable=require(_0x477b70(0x136)),cryptoUtils=require(_0x477b70(0x189)),nasAccountUtil=require(_0x477b70(0x17e));const dbUserTable=require(_0x477b70(0x134)),fs=require('fs');let axios=require('axios');const urlConfig=require('../../myConfig/urlConfig');router['post'](_0x477b70(0x15c),(_0xb47012,_0x349373,_0xfbc7e0)=>{const _0x39352f=_0x477b70;if(dbUserTable['isAdmin'](_0xb47012,_0x349373)!==!![])return;let _0x27f741=dbConfigTable['findByTitle'](_0xb47012[_0x39352f(0x14b)][_0x39352f(0x135)],_0x39352f(0x18f));return _0x349373[_0x39352f(0x144)]({'code':0x0,'ddnsState':_0x27f741?JSON['parse'](_0x27f741[_0x39352f(0x18b)]):''});}),router[_0x477b70(0x14e)](_0x477b70(0x175),(_0x56d6d9,_0x966845,_0x659cbf)=>{const _0x83b7ac=_0x477b70;if(dbUserTable[_0x83b7ac(0x13d)](_0x56d6d9,_0x966845)!==!![])return;let _0x42c735=_0x56d6d9[_0x83b7ac(0x166)][_0x83b7ac(0x15f)];if(_0x42c735==0x0||_0x42c735==0x1)return dbConfigTable['create'](_0x56d6d9[_0x83b7ac(0x14b)][_0x83b7ac(0x135)],{'title':'nasDdnsEnable','value':_0x42c735+''}),process[_0x83b7ac(0x184)]({'type':_0x83b7ac(0x149)}),_0x966845[_0x83b7ac(0x144)]({'code':0x0});});function saveConfig(_0x68eff7,_0x4b10e7,_0x4a2454){dbConfigTable['create'](_0x68eff7,{'title':_0x4b10e7,'value':_0x4a2454+''});}function saveNasCabHttpsCerts(_0x560d73,_0x573b16){const _0x566b38=_0x477b70;let _0x5b2039=dbConfigTable['findByTitle'](_0x560d73,config['nasAccountInfoConfigKey']);if(!_0x5b2039){if(_0x573b16)return _0x573b16[_0x566b38(0x144)]({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}cryptoUtils[_0x566b38(0x16a)](config['nasAccountInfoPwd'],_0x5b2039[_0x566b38(0x18b)])['then'](_0x33796c=>{const _0x483058=_0x566b38;let _0x46212f=JSON[_0x483058(0x133)](_0x33796c),_0xc207d5=_0x46212f['userInfo'];_0xc207d5[_0x483058(0x180)]&&_0xc207d5[_0x483058(0x180)][_0x483058(0x16e)]>0x0&&(userToken=_0xc207d5[_0x483058(0x180)][_0xc207d5[_0x483058(0x180)][_0x483058(0x16e)]-0x1]);if(!userToken){if(_0x573b16)return _0x573b16['json']({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}let _0x110206={'token':userToken,'type':'getCerts'};axios['post'](urlConfig[_0x483058(0x16d)](_0x560d73,_0x483058(0x179)),_0x110206)[_0x483058(0x18d)](_0x363d6a=>{const _0x474120=_0x483058;if(_0x363d6a[_0x474120(0x160)][_0x474120(0x145)]){if(_0x573b16)return _0x573b16[_0x474120(0x144)]({'code':0x1,'message':_0x363d6a[_0x474120(0x160)][_0x474120(0x161)]});}else{saveConfig(_0x560d73,_0x474120(0x13e),_0x363d6a[_0x474120(0x160)][_0x474120(0x147)]),saveConfig(_0x560d73,_0x474120(0x138),_0x363d6a[_0x474120(0x160)]['crt']);if(_0x573b16)return _0x573b16['json']({'code':0x0});}})['catch'](_0x2d8325=>{const _0x1444ea=_0x483058;if(_0x573b16)return _0x573b16[_0x1444ea(0x144)]({'code':0x1,'message':_0x573b16['__'](_0x1444ea(0x188))});});})[_0x566b38(0x18e)](_0x526957=>{const _0x458189=_0x566b38;console[_0x458189(0x14d)](_0x526957),dbConfigTable['deleteByTitle'](dbOther,config[_0x458189(0x16f)]);});}function _0x3d99(){const _0x2b32a0=['serverRootPath','log','post','1127493jlioYP','frpcPath','pageUrl_privacy','/setRemoteEnable','nasAccountLogin','pageUrl_contact_us','globalIpList','nasRemoteEnable','/setUseNasCabCert','/getVipInfo','3492720wgSYKt','14DNPPqN','type','/getDDNSState','../../myConfig/config','proxy.frpcExist','nasDdnsEnable','data','msg','vipType','returnErrMsg','5gpBnRh','/nasCabLogout','body','pageUrl_ddns_set_subdomain','nascabToken','mkdirSync','decryptString','590841FKGSWX','frpcFolder','getUrlByUrlKey','length','nasAccountInfoConfigKey','440214pvVZSY','FRPC\x20download\x20exception','4194078AKkPXs','exports','ddnsType','/setDdnsEnable','Router','FRPC\x20download\x20error','33brrROI','apiDDNSUrl','downloadUrlFrpc','pageUrl_buy_vip','pageUrl_update_log','deleteByTitle','../utils/nasAccountUtils','finish','token','useNasCabCerts','ipv4','nasCabLoginByToken','send','pageUrl_agreement','createWriteStream','/downloadFrpc','netWorkRequestFail','../utils/cryptoUtils','8IkFhQy','value','11316230YsIJZE','then','catch','nasDdnsState','/setDdnsType','FRPC\x20download\x20finish','pageUrl_login','info','frpcTempPath','loginByToken','create','parse','../../db/dbUserTable','dbOther','../../db/dbNoticeCenterTable','findByTitle','httpsCert','/getProxyState','GET','pageUrl_marketing','getVipInfo','isAdmin','httpsKey','106874DndGIO','proxy.frpcDownloaded','ipv6','nasRemoteState','stream','json','code','ipv6addressNotFound','key','existsSync','nasDdnsRestart','pageUrl_ddns_set_subdomain_nat','app'];_0x3d99=function(){return _0x2b32a0;};return _0x3d99();}router['post'](_0x477b70(0x157),(_0x254c82,_0x35d266,_0x1bf7e5)=>{const _0x211e54=_0x477b70;if(dbUserTable[_0x211e54(0x13d)](_0x254c82,_0x35d266)!==!![])return;let _0x2e3bfb=_0x254c82[_0x211e54(0x166)]['useNasCabCerts'];if(_0x2e3bfb==0x0||_0x2e3bfb==0x1){saveConfig(_0x254c82[_0x211e54(0x14b)]['dbOther'],_0x211e54(0x181),_0x2e3bfb+'');if(_0x2e3bfb==0x1)saveNasCabHttpsCerts(_0x254c82[_0x211e54(0x14b)][_0x211e54(0x135)],_0x35d266);else return saveConfig(_0x254c82[_0x211e54(0x14b)][_0x211e54(0x135)],_0x211e54(0x13e),''),saveConfig(_0x254c82['app'][_0x211e54(0x135)],'httpsCert',''),_0x35d266[_0x211e54(0x144)]({'code':0x0});}else return _0x35d266['json']({'code':0x1});}),router[_0x477b70(0x14e)](_0x477b70(0x190),(_0x10b21d,_0x55bbb1,_0x59e4dd)=>{const _0x576476=_0x477b70;if(dbUserTable[_0x576476(0x13d)](_0x10b21d,_0x55bbb1)!==!![])return;let _0x591e23=_0x10b21d[_0x576476(0x166)][_0x576476(0x174)];if(_0x591e23!=_0x576476(0x182)&&_0x591e23!=_0x576476(0x141))return _0x55bbb1[_0x576476(0x144)]({'code':0x1});if(_0x591e23=='ipv6'){let _0x330825='';try{let _0x40c671=dbConfigTable[_0x576476(0x137)](_0x10b21d['app'][_0x576476(0x135)],_0x576476(0x155));_0x40c671&&(_0x40c671=JSON[_0x576476(0x133)](_0x40c671[_0x576476(0x18b)]));for(let _0x1d0936 in _0x40c671){if(_0x40c671[_0x1d0936]['type']=='ipv6'){_0x330825=_0x40c671[_0x1d0936]['ip'];break;}}}catch(_0x3ffc96){console[_0x576476(0x14d)](_0x3ffc96);}if(!_0x330825)return _0x10b21d['app'][_0x576476(0x163)](_0x55bbb1,_0x55bbb1['__'](_0x576476(0x146)));}return dbConfigTable[_0x576476(0x132)](_0x10b21d[_0x576476(0x14b)][_0x576476(0x135)],{'title':_0x576476(0x174),'value':_0x591e23}),process[_0x576476(0x184)]({'type':_0x576476(0x149)}),_0x55bbb1[_0x576476(0x144)]({'code':0x0});}),router[_0x477b70(0x14e)](_0x477b70(0x158),(_0xd0d0af,_0xc6a390,_0x55e856)=>{const _0x55aebc=_0x477b70;let _0x734ce5={'code':0x0};nasAccountUtil[_0x55aebc(0x13c)](_0xd0d0af[_0x55aebc(0x14b)][_0x55aebc(0x135)])[_0x55aebc(0x18d)](_0x23bdf7=>{const _0x41345b=_0x55aebc;return _0x23bdf7==![]?_0x734ce5[_0x41345b(0x162)]=0x0:_0x734ce5['vipType']=_0x23bdf7[_0x41345b(0x15b)],_0xc6a390[_0x41345b(0x144)](_0x734ce5);})[_0x55aebc(0x18e)](_0x3a5621=>{return _0x734ce5['vipType']=0x0,_0xc6a390['json'](_0x734ce5);});}),router['post']('/getNasAccountInfo',(_0x46f334,_0x2d480e,_0x14a348)=>{const _0xf78279=_0x477b70;let _0x20fc7d=dbConfigTable['findByTitle'](_0x46f334[_0xf78279(0x14b)][_0xf78279(0x135)],config['nasAccountInfoConfigKey']),_0x31f397=dbConfigTable[_0xf78279(0x137)](_0x46f334[_0xf78279(0x14b)][_0xf78279(0x135)],_0xf78279(0x18f)),_0x48e423=dbConfigTable[_0xf78279(0x137)](_0x46f334[_0xf78279(0x14b)][_0xf78279(0x135)],'nasDdnsEnable'),_0x5ab1e8=dbConfigTable[_0xf78279(0x137)](_0x46f334[_0xf78279(0x14b)][_0xf78279(0x135)],_0xf78279(0x156)),_0x2e4da5={'pageUrl_login':urlConfig['getUrlByUrlKey'](_0x46f334[_0xf78279(0x14b)][_0xf78279(0x135)],_0xf78279(0x12e)),'pageUrl_contact_us':urlConfig[_0xf78279(0x16d)](_0x46f334[_0xf78279(0x14b)][_0xf78279(0x135)],'pageUrl_contact_us'),'pageUrl_marketing':urlConfig['getUrlByUrlKey'](_0x46f334[_0xf78279(0x14b)]['dbOther'],_0xf78279(0x13b)),'pageUrl_buy_vip':urlConfig[_0xf78279(0x16d)](_0x46f334[_0xf78279(0x14b)][_0xf78279(0x135)],_0xf78279(0x17b))};if(_0x20fc7d)cryptoUtils['decryptString'](config['nasAccountInfoPwd'],_0x20fc7d['value'])['then'](_0x4a5cad=>{const _0x2bb154=_0xf78279;return _0x2d480e[_0x2bb154(0x144)]({'code':0x0,'data':JSON[_0x2bb154(0x133)](_0x4a5cad),'nasDdnsState':_0x31f397?JSON['parse'](_0x31f397[_0x2bb154(0x18b)]):'','nasDdnsEnable':_0x48e423?_0x48e423[_0x2bb154(0x18b)]:0x0,'nasRemoteEnable':_0x5ab1e8?_0x5ab1e8[_0x2bb154(0x18b)]:0x0,'pagesUrl':_0x2e4da5});})[_0xf78279(0x18e)](_0x5d10c3=>{const _0x48e8ac=_0xf78279;return console[_0x48e8ac(0x14d)](_0x5d10c3),dbConfigTable[_0x48e8ac(0x17d)](_0x46f334['app'][_0x48e8ac(0x135)],config[_0x48e8ac(0x16f)]),_0x2d480e[_0x48e8ac(0x144)]({'code':0x0,'data':'','pagesUrl':_0x2e4da5});});else return _0x2d480e[_0xf78279(0x144)]({'code':0x0,'data':'','pagesUrl':_0x2e4da5});}),router[_0x477b70(0x14e)]('/nasCabLoginByToken',(_0x5a6aaf,_0x4b9893,_0x3ea758)=>{const _0x40df3b=_0x477b70;let _0xf06f6f=_0x5a6aaf[_0x40df3b(0x166)][_0x40df3b(0x168)];if(!_0xf06f6f)return _0x5a6aaf[_0x40df3b(0x14b)][_0x40df3b(0x163)](_0x4b9893,'Params\x20invalid');console[_0x40df3b(0x14d)](_0x40df3b(0x183),_0xf06f6f);if(dbUserTable[_0x40df3b(0x13d)](_0x5a6aaf,_0x4b9893)!==!![])return;nasAccountUtil[_0x40df3b(0x131)](_0x5a6aaf['app'][_0x40df3b(0x135)],_0xf06f6f,()=>{const _0x56529d=_0x40df3b;return process[_0x56529d(0x184)]({'type':_0x56529d(0x153)}),_0x4b9893[_0x56529d(0x144)]({'code':0x0});},()=>{const _0x12aba6=_0x40df3b;return _0x5a6aaf[_0x12aba6(0x14b)][_0x12aba6(0x163)](_0x4b9893,_0x4b9893['__']('loginFailedTryLater'));});}),router[_0x477b70(0x14e)](_0x477b70(0x165),(_0x8cb341,_0x498a67,_0x4477b4)=>{const _0x26a762=_0x477b70;if(dbUserTable['isAdmin'](_0x8cb341,_0x498a67)!==!![])return;return dbConfigTable[_0x26a762(0x17d)](_0x8cb341['app'][_0x26a762(0x135)],config[_0x26a762(0x16f)]),process[_0x26a762(0x184)]({'type':'nasCabLogout'}),_0x498a67[_0x26a762(0x144)]({'code':0x0,'data':''});}),router[_0x477b70(0x14e)]('/reconnectRemote',(_0x34ea0f,_0x1dccbe,_0x39280e)=>{const _0x1c6f76=_0x477b70;if(dbUserTable[_0x1c6f76(0x13d)](_0x34ea0f,_0x1dccbe)!==!![])return;let _0x5370fa=_0x34ea0f[_0x1c6f76(0x166)]['serverId'];return process[_0x1c6f76(0x184)]({'type':'nasProxyRestart','serverId':_0x5370fa}),_0x1dccbe['json']({'code':0x0});}),router['post'](_0x477b70(0x139),(_0x1ae9e2,_0x3853d6,_0x2a1c73)=>{const _0x7ba89b=_0x477b70;if(dbUserTable['isAdmin'](_0x1ae9e2,_0x3853d6)!==!![])return;let _0x2a33ca=fs['existsSync'](config[_0x7ba89b(0x150)]),_0x1bc2c7=dbConfigTable['findByTitle'](_0x1ae9e2[_0x7ba89b(0x14b)][_0x7ba89b(0x135)],_0x7ba89b(0x142)),_0x2b60da=dbConfigTable['findByTitle'](_0x1ae9e2[_0x7ba89b(0x14b)][_0x7ba89b(0x135)],'proxyServerList'),_0x3c94b9=dbConfigTable[_0x7ba89b(0x137)](_0x1ae9e2[_0x7ba89b(0x14b)][_0x7ba89b(0x135)],_0x7ba89b(0x14c));return _0x3853d6[_0x7ba89b(0x144)]({'code':0x0,'serverRootPath':_0x3c94b9?_0x3c94b9[_0x7ba89b(0x18b)]:'','proxyState':_0x1bc2c7?JSON[_0x7ba89b(0x133)](_0x1bc2c7[_0x7ba89b(0x18b)]):'','pluginExists':_0x2a33ca,'pluginPath':config[_0x7ba89b(0x150)],'proxyServerList':_0x2b60da?_0x2b60da[_0x7ba89b(0x18b)]:'[]'});}),router['post'](_0x477b70(0x187),(_0x417f15,_0xbb8399,_0x3ad535)=>{const _0x3d7fd7=_0x477b70;if(dbUserTable[_0x3d7fd7(0x13d)](_0x417f15,_0xbb8399)!==!![])return;if(fs[_0x3d7fd7(0x148)](config['frpcPath']))return _0x417f15[_0x3d7fd7(0x14b)][_0x3d7fd7(0x163)](_0xbb8399,_0xbb8399['__'](_0x3d7fd7(0x15e)));return downloadFrpc(_0x417f15,_0xbb8399),_0xbb8399[_0x3d7fd7(0x144)]({'code':0x0});});function downloadFrpc(_0xeba9ea,_0x278841){const _0x38ccfe=_0x477b70;!fs[_0x38ccfe(0x148)](config[_0x38ccfe(0x16c)])&&fs[_0x38ccfe(0x169)](config[_0x38ccfe(0x16c)],{'recursive':!![]}),axios({'url':urlConfig[_0x38ccfe(0x16d)](_0xeba9ea[_0x38ccfe(0x14b)][_0x38ccfe(0x135)],_0x38ccfe(0x17a)),'method':_0x38ccfe(0x13a),'responseType':_0x38ccfe(0x143)})[_0x38ccfe(0x18d)](_0x485fed=>{const _0x35e54c=_0x38ccfe;let _0x232965=fs[_0x35e54c(0x186)](config[_0x35e54c(0x130)]);_0x485fed[_0x35e54c(0x160)]['pipe'](_0x232965),_0x232965['on'](_0x35e54c(0x17f),()=>{const _0x4ff999=_0x35e54c;console['log'](_0x4ff999(0x12d)),fs['renameSync'](config[_0x4ff999(0x130)],config[_0x4ff999(0x150)]),dbNoticeCenterTable[_0x4ff999(0x132)](_0xeba9ea[_0x4ff999(0x14b)][_0x4ff999(0x135)],{'title':_0x278841['__'](_0x4ff999(0x140)),'level':_0x4ff999(0x12f),'content':_0x278841['__']('proxy.frpcDownloaded')}),process[_0x4ff999(0x184)]({'type':'nasProxyRestart'});}),_0x232965['on']('error',_0x48e118=>{const _0x13a093=_0x35e54c;console[_0x13a093(0x14d)](_0x13a093(0x177),_0x48e118);});})[_0x38ccfe(0x18e)](_0x354f03=>{const _0x4d2416=_0x38ccfe;console[_0x4d2416(0x14d)](_0x4d2416(0x171),_0x354f03);});}router['post'](_0x477b70(0x152),(_0x1d0f0d,_0x2ba35a,_0x1d0648)=>{const _0x4c3db8=_0x477b70;if(dbUserTable['isAdmin'](_0x1d0f0d,_0x2ba35a)!==!![])return;let _0x507a5e=_0x1d0f0d[_0x4c3db8(0x166)][_0x4c3db8(0x156)];if(_0x507a5e==0x0||_0x507a5e==0x1)return dbConfigTable['create'](_0x1d0f0d[_0x4c3db8(0x14b)][_0x4c3db8(0x135)],{'title':_0x4c3db8(0x156),'value':_0x507a5e+''}),process['send']({'type':'nasProxyRestart'}),_0x2ba35a['json']({'code':0x0});}),router[_0x477b70(0x14e)]('/getPagesUrl',(_0x5a9858,_0x1e5052,_0x2222ec)=>{const _0x2bf745=_0x477b70;return _0x1e5052['json']({'code':0x0,'pagesUrl':{'pageUrl_update_log':urlConfig[_0x2bf745(0x16d)](_0x5a9858[_0x2bf745(0x14b)][_0x2bf745(0x135)],_0x2bf745(0x17c)),'pageUrl_agreement':urlConfig['getUrlByUrlKey'](_0x5a9858[_0x2bf745(0x14b)][_0x2bf745(0x135)],_0x2bf745(0x185)),'pageUrl_privacy':urlConfig[_0x2bf745(0x16d)](_0x5a9858[_0x2bf745(0x14b)][_0x2bf745(0x135)],_0x2bf745(0x151)),'pageUrl_login':urlConfig[_0x2bf745(0x16d)](_0x5a9858[_0x2bf745(0x14b)][_0x2bf745(0x135)],_0x2bf745(0x12e)),'pageUrl_ddns_set_subdomain':urlConfig[_0x2bf745(0x16d)](_0x5a9858[_0x2bf745(0x14b)][_0x2bf745(0x135)],_0x2bf745(0x167)),'pageUrl_ddns_set_subdomain_nat':urlConfig[_0x2bf745(0x16d)](_0x5a9858[_0x2bf745(0x14b)][_0x2bf745(0x135)],_0x2bf745(0x14a)),'pageUrl_contact_us':urlConfig[_0x2bf745(0x16d)](_0x5a9858[_0x2bf745(0x14b)][_0x2bf745(0x135)],_0x2bf745(0x154)),'pageUrl_marketing':urlConfig['getUrlByUrlKey'](_0x5a9858[_0x2bf745(0x14b)]['dbOther'],_0x2bf745(0x13b)),'pageUrl_buy_vip':urlConfig[_0x2bf745(0x16d)](_0x5a9858[_0x2bf745(0x14b)][_0x2bf745(0x135)],_0x2bf745(0x17b))}});}),module[_0x477b70(0x173)]=router;