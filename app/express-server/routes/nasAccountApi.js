const _0x2a1240=_0x282c;(function(_0x210a15,_0x4ae08e){const _0x7c67db=_0x282c,_0x16a8ee=_0x210a15();while(!![]){try{const _0x42a45c=parseInt(_0x7c67db(0x8a))/0x1+parseInt(_0x7c67db(0x7f))/0x2+parseInt(_0x7c67db(0xd0))/0x3+-parseInt(_0x7c67db(0x82))/0x4*(-parseInt(_0x7c67db(0x83))/0x5)+-parseInt(_0x7c67db(0xc8))/0x6*(-parseInt(_0x7c67db(0xc1))/0x7)+-parseInt(_0x7c67db(0xb1))/0x8*(parseInt(_0x7c67db(0xcb))/0x9)+-parseInt(_0x7c67db(0xc7))/0xa;if(_0x42a45c===_0x4ae08e)break;else _0x16a8ee['push'](_0x16a8ee['shift']());}catch(_0x4ec9bf){_0x16a8ee['push'](_0x16a8ee['shift']());}}}(_0x4129,0xc4313));function _0x282c(_0x4ebcc9,_0x1e174f){const _0x4129dc=_0x4129();return _0x282c=function(_0x282cde,_0x46891b){_0x282cde=_0x282cde-0x7c;let _0x50354f=_0x4129dc[_0x282cde];return _0x50354f;},_0x282c(_0x4ebcc9,_0x1e174f);}var express=require(_0x2a1240(0xaa)),router=express[_0x2a1240(0x84)]();let config=require(_0x2a1240(0x90)),dbConfigTable=require(_0x2a1240(0xc4)),dbNoticeCenterTable=require(_0x2a1240(0x7c)),cryptoUtils=require(_0x2a1240(0xa5)),nasAccountUtil=require('../utils/nasAccountUtils');const dbUserTable=require('../../db/dbUserTable'),fs=require('fs');let axios=require(_0x2a1240(0xa0));function _0x4129(){const _0x5e93d9=['pageUrl_ddns_set_subdomain_nat','pageUrl_update_log','/reconnectRemote','../utils/cryptoUtils','httpsKey','proxyServerList','ipv6','getCerts','express','nasCabLoginByToken','nasRemoteEnable','nasDdnsRestart','serverRootPath','dbOther','pageUrl_login','2000VljCRM','exports','log','FRPC\x20download\x20exception','nasAccountInfoConfigKey','netWorkRequestFail','pageUrl_agreement','data','catch','nasRemoteState','post','nasDdnsEnable','downloadUrlFrpc','returnErrMsg','loginByToken','nasProxyRestart','7lMFyXj','/getDDNSState','../../myConfig/urlConfig','../../db/dbConfigTable','isAdmin','ipv4','10159620kCaKFR','177474udntrO','/getPagesUrl','FRPC\x20download\x20finish','35037iJlrdy','/setDdnsEnable','FRPC\x20download\x20error','json','useNasCabCerts','2273973pkikbf','/getNasAccountInfo','token','getUrlByUrlKey','stream','nascabToken','length','mkdirSync','then','renameSync','/nasCabLogout','/setRemoteEnable','nasDdnsState','nasAccountInfoPwd','frpcFolder','findByTitle','getVipInfo','create','pageUrl_buy_vip','httpsCert','key','serverId','body','../../db/dbNoticeCenterTable','deleteByTitle','code','1217646kcuWOw','loginFailedTryLater','/nasCabLoginByToken','4786076aqGIKt','5gRHPeP','Router','existsSync','pageUrl_privacy','app','vipType','send','199903FbYLUx','nasCabLogout','parse','frpcPath','/getVipInfo','type','../../myConfig/config','NasCab\x20account\x20not\x20found','value','finish','/getProxyState','info','ddnsType','userInfo','error','pageUrl_ddns_set_subdomain','pageUrl_marketing','frpcTempPath','globalIpList','/setUseNasCabCert','/downloadFrpc','proxy.frpcDownloaded','axios','apiDDNSUrl'];_0x4129=function(){return _0x5e93d9;};return _0x4129();}const urlConfig=require(_0x2a1240(0xc3));router['post'](_0x2a1240(0xc2),(_0x5a4104,_0x13ccdc,_0x18efcb)=>{const _0x27b5ef=_0x2a1240;if(dbUserTable['isAdmin'](_0x5a4104,_0x13ccdc)!==!![])return;let _0x46045f=dbConfigTable[_0x27b5ef(0xdf)](_0x5a4104[_0x27b5ef(0x87)]['dbOther'],_0x27b5ef(0xdc));return _0x13ccdc[_0x27b5ef(0xce)]({'code':0x0,'ddnsState':_0x46045f?JSON[_0x27b5ef(0x8c)](_0x46045f[_0x27b5ef(0x92)]):''});}),router[_0x2a1240(0xbb)](_0x2a1240(0xcc),(_0x17ecb8,_0x57a326,_0x2cf804)=>{const _0x2ba8b6=_0x2a1240;if(dbUserTable['isAdmin'](_0x17ecb8,_0x57a326)!==!![])return;let _0x1f4da5=_0x17ecb8[_0x2ba8b6(0xe6)][_0x2ba8b6(0xbc)];if(_0x1f4da5==0x0||_0x1f4da5==0x1)return dbConfigTable[_0x2ba8b6(0xe1)](_0x17ecb8[_0x2ba8b6(0x87)][_0x2ba8b6(0xaf)],{'title':_0x2ba8b6(0xbc),'value':_0x1f4da5+''}),process['send']({'type':_0x2ba8b6(0xad)}),_0x57a326[_0x2ba8b6(0xce)]({'code':0x0});});function saveConfig(_0x57b896,_0x2699e0,_0x33a94c){dbConfigTable['create'](_0x57b896,{'title':_0x2699e0,'value':_0x33a94c+''});}function saveNasCabHttpsCerts(_0x2c8143,_0x476052){const _0x3f0ead=_0x2a1240;let _0x2df7c0=dbConfigTable[_0x3f0ead(0xdf)](_0x2c8143,config[_0x3f0ead(0xb5)]);if(!_0x2df7c0){if(_0x476052)return _0x476052[_0x3f0ead(0xce)]({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}cryptoUtils['decryptString'](config[_0x3f0ead(0xdd)],_0x2df7c0['value'])[_0x3f0ead(0xd8)](_0x11ba21=>{const _0x9f9c30=_0x3f0ead;let _0x166d6a=JSON[_0x9f9c30(0x8c)](_0x11ba21),_0x1d1738=_0x166d6a[_0x9f9c30(0x97)];_0x1d1738[_0x9f9c30(0xd2)]&&_0x1d1738[_0x9f9c30(0xd2)][_0x9f9c30(0xd6)]>0x0&&(userToken=_0x1d1738[_0x9f9c30(0xd2)][_0x1d1738[_0x9f9c30(0xd2)][_0x9f9c30(0xd6)]-0x1]);if(!userToken){if(_0x476052)return _0x476052[_0x9f9c30(0xce)]({'code':0x1,'message':_0x9f9c30(0x91)});}let _0x3aca88={'token':userToken,'type':_0x9f9c30(0xa9)};axios[_0x9f9c30(0xbb)](urlConfig[_0x9f9c30(0xd3)](_0x2c8143,_0x9f9c30(0xa1)),_0x3aca88)[_0x9f9c30(0xd8)](_0x197fb4=>{const _0x23ceb1=_0x9f9c30;if(_0x197fb4['data'][_0x23ceb1(0x7e)]){if(_0x476052)return _0x476052[_0x23ceb1(0xce)]({'code':0x1,'message':_0x197fb4[_0x23ceb1(0xb8)]['msg']});}else{saveConfig(_0x2c8143,_0x23ceb1(0xa6),_0x197fb4['data'][_0x23ceb1(0xe4)]),saveConfig(_0x2c8143,_0x23ceb1(0xe3),_0x197fb4['data']['crt']);if(_0x476052)return _0x476052[_0x23ceb1(0xce)]({'code':0x0});}})[_0x9f9c30(0xb9)](_0x555a57=>{const _0x4298b1=_0x9f9c30;if(_0x476052)return _0x476052[_0x4298b1(0xce)]({'code':0x1,'message':_0x476052['__'](_0x4298b1(0xb6))});});})[_0x3f0ead(0xb9)](_0x3e931d=>{const _0x42e024=_0x3f0ead;console[_0x42e024(0xb3)](_0x3e931d),dbConfigTable['deleteByTitle'](dbOther,config['nasAccountInfoConfigKey']);});}router['post'](_0x2a1240(0x9d),(_0x40a8c9,_0x58f168,_0x29b80a)=>{const _0x14e698=_0x2a1240;if(dbUserTable[_0x14e698(0xc5)](_0x40a8c9,_0x58f168)!==!![])return;let _0x11af4b=_0x40a8c9[_0x14e698(0xe6)][_0x14e698(0xcf)];if(_0x11af4b==0x0||_0x11af4b==0x1){saveConfig(_0x40a8c9[_0x14e698(0x87)]['dbOther'],_0x14e698(0xcf),_0x11af4b+'');if(_0x11af4b==0x1)saveNasCabHttpsCerts(_0x40a8c9[_0x14e698(0x87)][_0x14e698(0xaf)],_0x58f168);else return saveConfig(_0x40a8c9['app'][_0x14e698(0xaf)],_0x14e698(0xa6),''),saveConfig(_0x40a8c9[_0x14e698(0x87)]['dbOther'],'httpsCert',''),_0x58f168[_0x14e698(0xce)]({'code':0x0});}else return _0x58f168[_0x14e698(0xce)]({'code':0x1});}),router[_0x2a1240(0xbb)]('/setDdnsType',(_0x1091ac,_0x52d29,_0xf64e39)=>{const _0x357a3b=_0x2a1240;if(dbUserTable[_0x357a3b(0xc5)](_0x1091ac,_0x52d29)!==!![])return;let _0x34690c=_0x1091ac[_0x357a3b(0xe6)]['ddnsType'];if(_0x34690c!=_0x357a3b(0xc6)&&_0x34690c!=_0x357a3b(0xa8))return _0x52d29['json']({'code':0x1});if(_0x34690c=='ipv6'){let _0x2245fe='';try{let _0x232db4=dbConfigTable[_0x357a3b(0xdf)](_0x1091ac['app'][_0x357a3b(0xaf)],_0x357a3b(0x9c));_0x232db4&&(_0x232db4=JSON['parse'](_0x232db4['value']));for(let _0x350fb7 in _0x232db4){if(_0x232db4[_0x350fb7]['type']==_0x357a3b(0xa8)){_0x2245fe=_0x232db4[_0x350fb7]['ip'];break;}}}catch(_0x1a611d){console[_0x357a3b(0xb3)](_0x1a611d);}if(!_0x2245fe)return _0x1091ac[_0x357a3b(0x87)][_0x357a3b(0xbe)](_0x52d29,_0x52d29['__']('ipv6addressNotFound'));}return dbConfigTable[_0x357a3b(0xe1)](_0x1091ac[_0x357a3b(0x87)][_0x357a3b(0xaf)],{'title':_0x357a3b(0x96),'value':_0x34690c}),process[_0x357a3b(0x89)]({'type':_0x357a3b(0xad)}),_0x52d29['json']({'code':0x0});}),router[_0x2a1240(0xbb)](_0x2a1240(0x8e),(_0x5d35ed,_0x2e9197,_0x5f092b)=>{const _0x4b252f=_0x2a1240;let _0x2e936e={'code':0x0};nasAccountUtil[_0x4b252f(0xe0)](_0x5d35ed[_0x4b252f(0x87)][_0x4b252f(0xaf)])[_0x4b252f(0xd8)](_0x18dfd8=>{const _0x3d0522=_0x4b252f;return _0x18dfd8==![]?_0x2e936e[_0x3d0522(0x88)]=0x0:_0x2e936e['vipType']=_0x18dfd8[_0x3d0522(0x8f)],_0x2e9197[_0x3d0522(0xce)](_0x2e936e);})['catch'](_0x1e0c77=>{const _0x52ce5b=_0x4b252f;return _0x2e936e[_0x52ce5b(0x88)]=0x0,_0x2e9197['json'](_0x2e936e);});}),router[_0x2a1240(0xbb)](_0x2a1240(0xd1),(_0x358943,_0x26f967,_0x319f5b)=>{const _0x5d4fc4=_0x2a1240;let _0x5e2dba=dbConfigTable[_0x5d4fc4(0xdf)](_0x358943[_0x5d4fc4(0x87)][_0x5d4fc4(0xaf)],config[_0x5d4fc4(0xb5)]),_0x1b3659=dbConfigTable[_0x5d4fc4(0xdf)](_0x358943[_0x5d4fc4(0x87)][_0x5d4fc4(0xaf)],'nasDdnsState'),_0x5ba892=dbConfigTable['findByTitle'](_0x358943[_0x5d4fc4(0x87)]['dbOther'],'nasDdnsEnable'),_0x437d16=dbConfigTable[_0x5d4fc4(0xdf)](_0x358943['app'][_0x5d4fc4(0xaf)],_0x5d4fc4(0xac)),_0x5d6ecd={'pageUrl_login':urlConfig[_0x5d4fc4(0xd3)](_0x358943['app'][_0x5d4fc4(0xaf)],_0x5d4fc4(0xb0)),'pageUrl_contact_us':urlConfig[_0x5d4fc4(0xd3)](_0x358943['app'][_0x5d4fc4(0xaf)],'pageUrl_contact_us'),'pageUrl_marketing':urlConfig[_0x5d4fc4(0xd3)](_0x358943[_0x5d4fc4(0x87)][_0x5d4fc4(0xaf)],_0x5d4fc4(0x9a)),'pageUrl_buy_vip':urlConfig[_0x5d4fc4(0xd3)](_0x358943[_0x5d4fc4(0x87)][_0x5d4fc4(0xaf)],_0x5d4fc4(0xe2))};if(_0x5e2dba)cryptoUtils['decryptString'](config[_0x5d4fc4(0xdd)],_0x5e2dba[_0x5d4fc4(0x92)])[_0x5d4fc4(0xd8)](_0x5d36ef=>{const _0x1a3f99=_0x5d4fc4;return _0x26f967[_0x1a3f99(0xce)]({'code':0x0,'data':JSON[_0x1a3f99(0x8c)](_0x5d36ef),'nasDdnsState':_0x1b3659?JSON[_0x1a3f99(0x8c)](_0x1b3659['value']):'','nasDdnsEnable':_0x5ba892?_0x5ba892[_0x1a3f99(0x92)]:0x0,'nasRemoteEnable':_0x437d16?_0x437d16[_0x1a3f99(0x92)]:0x0,'pagesUrl':_0x5d6ecd});})[_0x5d4fc4(0xb9)](_0x430ae6=>{const _0x4db98e=_0x5d4fc4;return console['log'](_0x430ae6),dbConfigTable[_0x4db98e(0x7d)](_0x358943['app']['dbOther'],config[_0x4db98e(0xb5)]),_0x26f967['json']({'code':0x0,'data':'','pagesUrl':_0x5d6ecd});});else return _0x26f967[_0x5d4fc4(0xce)]({'code':0x0,'data':'','pagesUrl':_0x5d6ecd});}),router['post'](_0x2a1240(0x81),(_0x1859da,_0x36f3eb,_0x2fadaa)=>{const _0x2d125d=_0x2a1240;let _0x50e7b5=_0x1859da[_0x2d125d(0xe6)][_0x2d125d(0xd5)];if(!_0x50e7b5)return _0x1859da[_0x2d125d(0x87)]['returnErrMsg'](_0x36f3eb,'Params\x20invalid');console['log'](_0x2d125d(0xab),_0x50e7b5);if(dbUserTable[_0x2d125d(0xc5)](_0x1859da,_0x36f3eb)!==!![])return;nasAccountUtil[_0x2d125d(0xbf)](_0x1859da[_0x2d125d(0x87)][_0x2d125d(0xaf)],_0x50e7b5,()=>{const _0x3309ee=_0x2d125d;return process['send']({'type':'nasAccountLogin'}),_0x36f3eb[_0x3309ee(0xce)]({'code':0x0});},()=>{const _0x13864d=_0x2d125d;return _0x1859da[_0x13864d(0x87)][_0x13864d(0xbe)](_0x36f3eb,_0x36f3eb['__'](_0x13864d(0x80)));});}),router[_0x2a1240(0xbb)](_0x2a1240(0xda),(_0x59c82c,_0x190dbc,_0x4ba3fd)=>{const _0x448df1=_0x2a1240;if(dbUserTable[_0x448df1(0xc5)](_0x59c82c,_0x190dbc)!==!![])return;return dbConfigTable['deleteByTitle'](_0x59c82c['app']['dbOther'],config['nasAccountInfoConfigKey']),process[_0x448df1(0x89)]({'type':_0x448df1(0x8b)}),_0x190dbc['json']({'code':0x0,'data':''});}),router['post'](_0x2a1240(0xa4),(_0x1edaa4,_0x1214f1,_0x341841)=>{const _0xeaa90a=_0x2a1240;if(dbUserTable[_0xeaa90a(0xc5)](_0x1edaa4,_0x1214f1)!==!![])return;let _0x2fc4bf=_0x1edaa4[_0xeaa90a(0xe6)][_0xeaa90a(0xe5)];return process[_0xeaa90a(0x89)]({'type':_0xeaa90a(0xc0),'serverId':_0x2fc4bf}),_0x1214f1[_0xeaa90a(0xce)]({'code':0x0});}),router[_0x2a1240(0xbb)](_0x2a1240(0x94),(_0x21c267,_0x2ef918,_0x162051)=>{const _0x59c3e8=_0x2a1240;if(dbUserTable[_0x59c3e8(0xc5)](_0x21c267,_0x2ef918)!==!![])return;let _0x3184c9=fs[_0x59c3e8(0x85)](config[_0x59c3e8(0x8d)]),_0x36210a=dbConfigTable[_0x59c3e8(0xdf)](_0x21c267[_0x59c3e8(0x87)][_0x59c3e8(0xaf)],_0x59c3e8(0xba)),_0x41dfe0=dbConfigTable['findByTitle'](_0x21c267[_0x59c3e8(0x87)][_0x59c3e8(0xaf)],_0x59c3e8(0xa7)),_0x2341cc=dbConfigTable['findByTitle'](_0x21c267[_0x59c3e8(0x87)][_0x59c3e8(0xaf)],_0x59c3e8(0xae));return _0x2ef918['json']({'code':0x0,'serverRootPath':_0x2341cc?_0x2341cc[_0x59c3e8(0x92)]:'','proxyState':_0x36210a?JSON[_0x59c3e8(0x8c)](_0x36210a['value']):'','pluginExists':_0x3184c9,'pluginPath':config[_0x59c3e8(0x8d)],'proxyServerList':_0x41dfe0?_0x41dfe0[_0x59c3e8(0x92)]:'[]'});}),router[_0x2a1240(0xbb)](_0x2a1240(0x9e),(_0x12b997,_0x5dfc56,_0x20fd31)=>{const _0x490720=_0x2a1240;if(dbUserTable[_0x490720(0xc5)](_0x12b997,_0x5dfc56)!==!![])return;if(fs[_0x490720(0x85)](config['frpcPath']))return _0x12b997['app'][_0x490720(0xbe)](_0x5dfc56,_0x5dfc56['__']('proxy.frpcExist'));return downloadFrpc(_0x12b997,_0x5dfc56),_0x5dfc56[_0x490720(0xce)]({'code':0x0});});function downloadFrpc(_0x2e2708,_0x3ff206){const _0x4d7680=_0x2a1240;!fs[_0x4d7680(0x85)](config[_0x4d7680(0xde)])&&fs[_0x4d7680(0xd7)](config['frpcFolder'],{'recursive':!![]}),axios({'url':urlConfig['getUrlByUrlKey'](_0x2e2708[_0x4d7680(0x87)][_0x4d7680(0xaf)],_0x4d7680(0xbd)),'method':'GET','responseType':_0x4d7680(0xd4)})[_0x4d7680(0xd8)](_0x453926=>{const _0x2c9161=_0x4d7680;let _0x254839=fs['createWriteStream'](config[_0x2c9161(0x9b)]);_0x453926[_0x2c9161(0xb8)]['pipe'](_0x254839),_0x254839['on'](_0x2c9161(0x93),()=>{const _0x344af7=_0x2c9161;console[_0x344af7(0xb3)](_0x344af7(0xca)),fs[_0x344af7(0xd9)](config[_0x344af7(0x9b)],config[_0x344af7(0x8d)]),dbNoticeCenterTable[_0x344af7(0xe1)](_0x2e2708[_0x344af7(0x87)][_0x344af7(0xaf)],{'title':_0x3ff206['__'](_0x344af7(0x9f)),'level':_0x344af7(0x95),'content':_0x3ff206['__'](_0x344af7(0x9f))}),process[_0x344af7(0x89)]({'type':'nasProxyRestart'});}),_0x254839['on'](_0x2c9161(0x98),_0x1476da=>{const _0x224289=_0x2c9161;console[_0x224289(0xb3)](_0x224289(0xcd),_0x1476da);});})[_0x4d7680(0xb9)](_0x13cc3c=>{const _0xe2002=_0x4d7680;console[_0xe2002(0xb3)](_0xe2002(0xb4),_0x13cc3c);});}router['post'](_0x2a1240(0xdb),(_0x3ec424,_0xc2db0c,_0x14f9d3)=>{const _0x4b43da=_0x2a1240;if(dbUserTable[_0x4b43da(0xc5)](_0x3ec424,_0xc2db0c)!==!![])return;let _0x591850=_0x3ec424[_0x4b43da(0xe6)][_0x4b43da(0xac)];if(_0x591850==0x0||_0x591850==0x1)return dbConfigTable[_0x4b43da(0xe1)](_0x3ec424[_0x4b43da(0x87)][_0x4b43da(0xaf)],{'title':'nasRemoteEnable','value':_0x591850+''}),process[_0x4b43da(0x89)]({'type':_0x4b43da(0xc0)}),_0xc2db0c[_0x4b43da(0xce)]({'code':0x0});}),router[_0x2a1240(0xbb)](_0x2a1240(0xc9),(_0x3572fb,_0x3bca4d,_0x39d0e2)=>{const _0x4ee5fd=_0x2a1240;return _0x3bca4d[_0x4ee5fd(0xce)]({'code':0x0,'pagesUrl':{'pageUrl_update_log':urlConfig[_0x4ee5fd(0xd3)](_0x3572fb[_0x4ee5fd(0x87)][_0x4ee5fd(0xaf)],_0x4ee5fd(0xa3)),'pageUrl_agreement':urlConfig['getUrlByUrlKey'](_0x3572fb[_0x4ee5fd(0x87)][_0x4ee5fd(0xaf)],_0x4ee5fd(0xb7)),'pageUrl_privacy':urlConfig['getUrlByUrlKey'](_0x3572fb[_0x4ee5fd(0x87)][_0x4ee5fd(0xaf)],_0x4ee5fd(0x86)),'pageUrl_login':urlConfig[_0x4ee5fd(0xd3)](_0x3572fb[_0x4ee5fd(0x87)][_0x4ee5fd(0xaf)],'pageUrl_login'),'pageUrl_ddns_set_subdomain':urlConfig[_0x4ee5fd(0xd3)](_0x3572fb[_0x4ee5fd(0x87)][_0x4ee5fd(0xaf)],_0x4ee5fd(0x99)),'pageUrl_ddns_set_subdomain_nat':urlConfig[_0x4ee5fd(0xd3)](_0x3572fb[_0x4ee5fd(0x87)][_0x4ee5fd(0xaf)],_0x4ee5fd(0xa2)),'pageUrl_contact_us':urlConfig[_0x4ee5fd(0xd3)](_0x3572fb[_0x4ee5fd(0x87)]['dbOther'],'pageUrl_contact_us'),'pageUrl_marketing':urlConfig['getUrlByUrlKey'](_0x3572fb['app']['dbOther'],'pageUrl_marketing'),'pageUrl_buy_vip':urlConfig['getUrlByUrlKey'](_0x3572fb[_0x4ee5fd(0x87)]['dbOther'],_0x4ee5fd(0xe2))}});}),module[_0x2a1240(0xb2)]=router;