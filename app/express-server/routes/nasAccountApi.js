function _0x2fe9(_0x21af87,_0x267802){const _0x48dd9c=_0x48dd();return _0x2fe9=function(_0x2fe960,_0x45d959){_0x2fe960=_0x2fe960-0x151;let _0x402660=_0x48dd9c[_0x2fe960];return _0x402660;},_0x2fe9(_0x21af87,_0x267802);}const _0x507d9c=_0x2fe9;(function(_0x133c32,_0x369869){const _0x2c074d=_0x2fe9,_0x51f821=_0x133c32();while(!![]){try{const _0x261abb=-parseInt(_0x2c074d(0x19a))/0x1+-parseInt(_0x2c074d(0x189))/0x2*(parseInt(_0x2c074d(0x19c))/0x3)+parseInt(_0x2c074d(0x18a))/0x4+parseInt(_0x2c074d(0x15e))/0x5*(-parseInt(_0x2c074d(0x167))/0x6)+-parseInt(_0x2c074d(0x185))/0x7+parseInt(_0x2c074d(0x1b5))/0x8*(-parseInt(_0x2c074d(0x1a2))/0x9)+parseInt(_0x2c074d(0x16c))/0xa;if(_0x261abb===_0x369869)break;else _0x51f821['push'](_0x51f821['shift']());}catch(_0x3b565f){_0x51f821['push'](_0x51f821['shift']());}}}(_0x48dd,0xdcfdd));var express=require(_0x507d9c(0x159)),router=express[_0x507d9c(0x16e)]();let config=require(_0x507d9c(0x17a)),dbConfigTable=require(_0x507d9c(0x1b7)),dbNoticeCenterTable=require('../../db/dbNoticeCenterTable'),cryptoUtils=require(_0x507d9c(0x169)),nasAccountUtil=require(_0x507d9c(0x1b3));function _0x48dd(){const _0x24b234=['apiDDNSUrl','parse','proxy.frpcExist','decryptString','5463GqiMLf','nascabToken','renameSync','/setDdnsType','error','../../db/dbUserTable','returnErrMsg','send','httpsCert','vipType','create','GET','netWorkRequestFail','frpcTempPath','json','finish','/setUseNasCabCert','../utils/nasAccountUtils','deleteByTitle','16352lpgqLC','frpcPath','../../db/dbConfigTable','findByTitle','axios','FRPC\x20download\x20finish','mkdirSync','post','pageUrl_login','/getNasAccountInfo','then','serverRootPath','express','pageUrl_contact_us','pageUrl_update_log','/setRemoteEnable','pageUrl_privacy','5GINfAY','/setDdnsEnable','pageUrl_buy_vip','nasDdnsState','userInfo','nasAccountInfoPwd','getCerts','serverId','getUrlByUrlKey','5890086yxEWnZ','ipv6','../utils/cryptoUtils','length','isAdmin','45812680WCSItT','nasProxyRestart','Router','exports','downloadUrlFrpc','nasDdnsRestart','nasDdnsEnable','msg','nasAccountInfoConfigKey','getVipInfo','pageUrl_ddns_set_subdomain','useNasCabCerts','key','FRPC\x20download\x20error','../../myConfig/config','app','/nasCabLogout','/downloadFrpc','nasRemoteState','/getVipInfo','httpsKey','nasCabLoginByToken','code','loginFailedTryLater','data','3037748aeUlWj','ddnsType','token','/nasCabLoginByToken','2WHTOpk','115916qPLcAP','body','dbOther','nasRemoteEnable','type','FRPC\x20download\x20exception','Params\x20invalid','pageUrl_agreement','proxy.frpcDownloaded','catch','value','createWriteStream','log','NasCab\x20account\x20not\x20found','proxyServerList','frpcFolder','713782GAutQt','globalIpList','1004793SvHhBB','pipe'];_0x48dd=function(){return _0x24b234;};return _0x48dd();}const dbUserTable=require(_0x507d9c(0x1a7)),fs=require('fs');let axios=require(_0x507d9c(0x151));const urlConfig=require('../../myConfig/urlConfig');router[_0x507d9c(0x154)]('/getDDNSState',(_0x3c6b60,_0x4ad5c8,_0x2f02b4)=>{const _0x58e7b7=_0x507d9c;if(dbUserTable[_0x58e7b7(0x16b)](_0x3c6b60,_0x4ad5c8)!==!![])return;let _0x4af0d8=dbConfigTable[_0x58e7b7(0x1b8)](_0x3c6b60[_0x58e7b7(0x17b)][_0x58e7b7(0x18c)],_0x58e7b7(0x161));return _0x4ad5c8[_0x58e7b7(0x1b0)]({'code':0x0,'ddnsState':_0x4af0d8?JSON[_0x58e7b7(0x19f)](_0x4af0d8[_0x58e7b7(0x194)]):''});}),router['post'](_0x507d9c(0x15f),(_0x3d7021,_0x50a17d,_0x1bae2c)=>{const _0x16ff8e=_0x507d9c;if(dbUserTable[_0x16ff8e(0x16b)](_0x3d7021,_0x50a17d)!==!![])return;let _0x268379=_0x3d7021[_0x16ff8e(0x18b)]['nasDdnsEnable'];if(_0x268379==0x0||_0x268379==0x1)return dbConfigTable[_0x16ff8e(0x1ac)](_0x3d7021[_0x16ff8e(0x17b)]['dbOther'],{'title':_0x16ff8e(0x172),'value':_0x268379+''}),process[_0x16ff8e(0x1a9)]({'type':_0x16ff8e(0x171)}),_0x50a17d[_0x16ff8e(0x1b0)]({'code':0x0});});function saveConfig(_0x3b7fd5,_0x28f179,_0x3a1113){const _0x5f0d71=_0x507d9c;dbConfigTable[_0x5f0d71(0x1ac)](_0x3b7fd5,{'title':_0x28f179,'value':_0x3a1113+''});}function saveNasCabHttpsCerts(_0x37e98f,_0x5f00fb){const _0x3369a8=_0x507d9c;let _0x5318d6=dbConfigTable[_0x3369a8(0x1b8)](_0x37e98f,config[_0x3369a8(0x174)]);if(!_0x5318d6){if(_0x5f00fb)return _0x5f00fb[_0x3369a8(0x1b0)]({'code':0x1,'message':_0x3369a8(0x197)});}cryptoUtils[_0x3369a8(0x1a1)](config['nasAccountInfoPwd'],_0x5318d6[_0x3369a8(0x194)])[_0x3369a8(0x157)](_0x2f2d29=>{const _0x394103=_0x3369a8;let _0x3c39b5=JSON[_0x394103(0x19f)](_0x2f2d29),_0x3bc33c=_0x3c39b5[_0x394103(0x162)];_0x3bc33c[_0x394103(0x187)]&&_0x3bc33c[_0x394103(0x187)][_0x394103(0x16a)]>0x0&&(userToken=_0x3bc33c[_0x394103(0x187)][_0x3bc33c[_0x394103(0x187)][_0x394103(0x16a)]-0x1]);if(!userToken){if(_0x5f00fb)return _0x5f00fb[_0x394103(0x1b0)]({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}let _0x37c421={'token':userToken,'type':_0x394103(0x164)};axios[_0x394103(0x154)](urlConfig[_0x394103(0x166)](_0x37e98f,_0x394103(0x19e)),_0x37c421)[_0x394103(0x157)](_0x16bde1=>{const _0x1b25b7=_0x394103;if(_0x16bde1['data'][_0x1b25b7(0x182)]){if(_0x5f00fb)return _0x5f00fb[_0x1b25b7(0x1b0)]({'code':0x1,'message':_0x16bde1[_0x1b25b7(0x184)][_0x1b25b7(0x173)]});}else{saveConfig(_0x37e98f,_0x1b25b7(0x180),_0x16bde1[_0x1b25b7(0x184)][_0x1b25b7(0x178)]),saveConfig(_0x37e98f,_0x1b25b7(0x1aa),_0x16bde1[_0x1b25b7(0x184)]['crt']);if(_0x5f00fb)return _0x5f00fb[_0x1b25b7(0x1b0)]({'code':0x0});}})[_0x394103(0x193)](_0x45d827=>{const _0x5addbc=_0x394103;if(_0x5f00fb)return _0x5f00fb[_0x5addbc(0x1b0)]({'code':0x1,'message':_0x5f00fb['__'](_0x5addbc(0x1ae))});});})[_0x3369a8(0x193)](_0x293d83=>{const _0x5569b8=_0x3369a8;console[_0x5569b8(0x196)](_0x293d83),dbConfigTable[_0x5569b8(0x1b4)](dbOther,config[_0x5569b8(0x174)]);});}router[_0x507d9c(0x154)](_0x507d9c(0x1b2),(_0x145768,_0x471b3b,_0x22d95b)=>{const _0x181411=_0x507d9c;if(dbUserTable[_0x181411(0x16b)](_0x145768,_0x471b3b)!==!![])return;let _0x427bf6=_0x145768[_0x181411(0x18b)][_0x181411(0x177)];if(_0x427bf6==0x0||_0x427bf6==0x1){saveConfig(_0x145768[_0x181411(0x17b)]['dbOther'],_0x181411(0x177),_0x427bf6+'');if(_0x427bf6==0x1)saveNasCabHttpsCerts(_0x145768[_0x181411(0x17b)][_0x181411(0x18c)],_0x471b3b);else return saveConfig(_0x145768['app'][_0x181411(0x18c)],_0x181411(0x180),''),saveConfig(_0x145768[_0x181411(0x17b)]['dbOther'],_0x181411(0x1aa),''),_0x471b3b['json']({'code':0x0});}else return _0x471b3b[_0x181411(0x1b0)]({'code':0x1});}),router['post'](_0x507d9c(0x1a5),(_0x27b2db,_0x4c96aa,_0x5b5bd)=>{const _0x1d2a1d=_0x507d9c;if(dbUserTable[_0x1d2a1d(0x16b)](_0x27b2db,_0x4c96aa)!==!![])return;let _0x4f113e=_0x27b2db['body'][_0x1d2a1d(0x186)];if(_0x4f113e!='ipv4'&&_0x4f113e!=_0x1d2a1d(0x168))return _0x4c96aa[_0x1d2a1d(0x1b0)]({'code':0x1});if(_0x4f113e=='ipv6'){let _0x1ca09d='';try{let _0x98e2c8=dbConfigTable[_0x1d2a1d(0x1b8)](_0x27b2db['app'][_0x1d2a1d(0x18c)],_0x1d2a1d(0x19b));_0x98e2c8&&(_0x98e2c8=JSON[_0x1d2a1d(0x19f)](_0x98e2c8[_0x1d2a1d(0x194)]));for(let _0x25739a in _0x98e2c8){if(_0x98e2c8[_0x25739a][_0x1d2a1d(0x18e)]==_0x1d2a1d(0x168)){_0x1ca09d=_0x98e2c8[_0x25739a]['ip'];break;}}}catch(_0x177174){console[_0x1d2a1d(0x196)](_0x177174);}if(!_0x1ca09d)return _0x27b2db[_0x1d2a1d(0x17b)][_0x1d2a1d(0x1a8)](_0x4c96aa,_0x4c96aa['__']('ipv6addressNotFound'));}return dbConfigTable[_0x1d2a1d(0x1ac)](_0x27b2db['app'][_0x1d2a1d(0x18c)],{'title':'ddnsType','value':_0x4f113e}),process[_0x1d2a1d(0x1a9)]({'type':'nasDdnsRestart'}),_0x4c96aa[_0x1d2a1d(0x1b0)]({'code':0x0});}),router[_0x507d9c(0x154)](_0x507d9c(0x17f),(_0x31c8b9,_0x2a5f7f,_0x1e4f19)=>{const _0x7dbf08=_0x507d9c;let _0x34be00={'code':0x0};nasAccountUtil[_0x7dbf08(0x175)](_0x31c8b9[_0x7dbf08(0x17b)][_0x7dbf08(0x18c)])[_0x7dbf08(0x157)](_0x52e221=>{const _0x12830a=_0x7dbf08;return _0x52e221==![]?_0x34be00[_0x12830a(0x1ab)]=0x0:_0x34be00[_0x12830a(0x1ab)]=_0x52e221[_0x12830a(0x18e)],_0x2a5f7f[_0x12830a(0x1b0)](_0x34be00);})[_0x7dbf08(0x193)](_0x2211dd=>{const _0x2999ad=_0x7dbf08;return _0x34be00[_0x2999ad(0x1ab)]=0x0,_0x2a5f7f[_0x2999ad(0x1b0)](_0x34be00);});}),router[_0x507d9c(0x154)](_0x507d9c(0x156),(_0x24bc9c,_0x826036,_0xfc0d6)=>{const _0x5b1e1f=_0x507d9c;let _0x2937f6=dbConfigTable[_0x5b1e1f(0x1b8)](_0x24bc9c['app'][_0x5b1e1f(0x18c)],config[_0x5b1e1f(0x174)]),_0x2a4142=dbConfigTable['findByTitle'](_0x24bc9c['app']['dbOther'],_0x5b1e1f(0x161)),_0x3eca24=dbConfigTable[_0x5b1e1f(0x1b8)](_0x24bc9c[_0x5b1e1f(0x17b)][_0x5b1e1f(0x18c)],_0x5b1e1f(0x172)),_0xd90a42=dbConfigTable[_0x5b1e1f(0x1b8)](_0x24bc9c[_0x5b1e1f(0x17b)][_0x5b1e1f(0x18c)],_0x5b1e1f(0x18d)),_0x28eff0={'pageUrl_login':urlConfig[_0x5b1e1f(0x166)](_0x24bc9c[_0x5b1e1f(0x17b)][_0x5b1e1f(0x18c)],_0x5b1e1f(0x155)),'pageUrl_contact_us':urlConfig[_0x5b1e1f(0x166)](_0x24bc9c[_0x5b1e1f(0x17b)][_0x5b1e1f(0x18c)],'pageUrl_contact_us'),'pageUrl_marketing':urlConfig['getUrlByUrlKey'](_0x24bc9c[_0x5b1e1f(0x17b)][_0x5b1e1f(0x18c)],'pageUrl_marketing'),'pageUrl_buy_vip':urlConfig[_0x5b1e1f(0x166)](_0x24bc9c[_0x5b1e1f(0x17b)][_0x5b1e1f(0x18c)],_0x5b1e1f(0x160))};if(_0x2937f6)cryptoUtils[_0x5b1e1f(0x1a1)](config[_0x5b1e1f(0x163)],_0x2937f6[_0x5b1e1f(0x194)])[_0x5b1e1f(0x157)](_0x29fc00=>{const _0x1edeca=_0x5b1e1f;return _0x826036[_0x1edeca(0x1b0)]({'code':0x0,'data':JSON[_0x1edeca(0x19f)](_0x29fc00),'nasDdnsState':_0x2a4142?JSON[_0x1edeca(0x19f)](_0x2a4142[_0x1edeca(0x194)]):'','nasDdnsEnable':_0x3eca24?_0x3eca24[_0x1edeca(0x194)]:0x0,'nasRemoteEnable':_0xd90a42?_0xd90a42[_0x1edeca(0x194)]:0x0,'pagesUrl':_0x28eff0});})['catch'](_0x1697f2=>{const _0x17ee61=_0x5b1e1f;return console[_0x17ee61(0x196)](_0x1697f2),dbConfigTable[_0x17ee61(0x1b4)](_0x24bc9c['app']['dbOther'],config[_0x17ee61(0x174)]),_0x826036['json']({'code':0x0,'data':'','pagesUrl':_0x28eff0});});else return _0x826036[_0x5b1e1f(0x1b0)]({'code':0x0,'data':'','pagesUrl':_0x28eff0});}),router[_0x507d9c(0x154)](_0x507d9c(0x188),(_0x6ae7ca,_0x2bdc6e,_0x5d6538)=>{const _0x4d2c45=_0x507d9c;let _0x14d2fc=_0x6ae7ca[_0x4d2c45(0x18b)][_0x4d2c45(0x1a3)];if(!_0x14d2fc)return _0x6ae7ca[_0x4d2c45(0x17b)][_0x4d2c45(0x1a8)](_0x2bdc6e,_0x4d2c45(0x190));console[_0x4d2c45(0x196)](_0x4d2c45(0x181),_0x14d2fc);if(dbUserTable[_0x4d2c45(0x16b)](_0x6ae7ca,_0x2bdc6e)!==!![])return;nasAccountUtil['loginByToken'](_0x6ae7ca[_0x4d2c45(0x17b)]['dbOther'],_0x14d2fc,()=>{const _0x20db53=_0x4d2c45;return process[_0x20db53(0x1a9)]({'type':'nasAccountLogin'}),_0x2bdc6e[_0x20db53(0x1b0)]({'code':0x0});},()=>{const _0x44c279=_0x4d2c45;return _0x6ae7ca[_0x44c279(0x17b)][_0x44c279(0x1a8)](_0x2bdc6e,_0x2bdc6e['__'](_0x44c279(0x183)));});}),router[_0x507d9c(0x154)](_0x507d9c(0x17c),(_0x314d45,_0x2ae564,_0x18f0af)=>{const _0x4863b3=_0x507d9c;if(dbUserTable[_0x4863b3(0x16b)](_0x314d45,_0x2ae564)!==!![])return;return dbConfigTable[_0x4863b3(0x1b4)](_0x314d45['app'][_0x4863b3(0x18c)],config[_0x4863b3(0x174)]),process[_0x4863b3(0x1a9)]({'type':'nasCabLogout'}),_0x2ae564[_0x4863b3(0x1b0)]({'code':0x0,'data':''});}),router['post']('/reconnectRemote',(_0x2d4598,_0x2f15f2,_0x1a79e7)=>{const _0x491698=_0x507d9c;if(dbUserTable[_0x491698(0x16b)](_0x2d4598,_0x2f15f2)!==!![])return;let _0x5ae369=_0x2d4598['body'][_0x491698(0x165)];return process[_0x491698(0x1a9)]({'type':'nasProxyRestart','serverId':_0x5ae369}),_0x2f15f2['json']({'code':0x0});}),router[_0x507d9c(0x154)]('/getProxyState',(_0x452970,_0x437f35,_0x1fb3c7)=>{const _0x52b38d=_0x507d9c;if(dbUserTable[_0x52b38d(0x16b)](_0x452970,_0x437f35)!==!![])return;let _0x4ea535=fs['existsSync'](config[_0x52b38d(0x1b6)]),_0x1b14c=dbConfigTable[_0x52b38d(0x1b8)](_0x452970['app']['dbOther'],_0x52b38d(0x17e)),_0x14e2e8=dbConfigTable[_0x52b38d(0x1b8)](_0x452970[_0x52b38d(0x17b)][_0x52b38d(0x18c)],_0x52b38d(0x198)),_0x37e27a=dbConfigTable[_0x52b38d(0x1b8)](_0x452970['app'][_0x52b38d(0x18c)],_0x52b38d(0x158));return _0x437f35[_0x52b38d(0x1b0)]({'code':0x0,'serverRootPath':_0x37e27a?_0x37e27a['value']:'','proxyState':_0x1b14c?JSON['parse'](_0x1b14c['value']):'','pluginExists':_0x4ea535,'pluginPath':config[_0x52b38d(0x1b6)],'proxyServerList':_0x14e2e8?_0x14e2e8[_0x52b38d(0x194)]:'[]'});}),router[_0x507d9c(0x154)](_0x507d9c(0x17d),(_0x5ab7c7,_0x29b91d,_0x1f89b3)=>{const _0x5b536a=_0x507d9c;if(dbUserTable[_0x5b536a(0x16b)](_0x5ab7c7,_0x29b91d)!==!![])return;if(fs['existsSync'](config[_0x5b536a(0x1b6)]))return _0x5ab7c7[_0x5b536a(0x17b)]['returnErrMsg'](_0x29b91d,_0x29b91d['__'](_0x5b536a(0x1a0)));return downloadFrpc(_0x5ab7c7,_0x29b91d),_0x29b91d[_0x5b536a(0x1b0)]({'code':0x0});});function downloadFrpc(_0x227da4,_0x1a4f06){const _0x1141a7=_0x507d9c;!fs['existsSync'](config[_0x1141a7(0x199)])&&fs[_0x1141a7(0x153)](config[_0x1141a7(0x199)],{'recursive':!![]}),axios({'url':urlConfig[_0x1141a7(0x166)](_0x227da4[_0x1141a7(0x17b)][_0x1141a7(0x18c)],_0x1141a7(0x170)),'method':_0x1141a7(0x1ad),'responseType':'stream'})[_0x1141a7(0x157)](_0xf6b050=>{const _0x33e845=_0x1141a7;let _0x463810=fs[_0x33e845(0x195)](config[_0x33e845(0x1af)]);_0xf6b050[_0x33e845(0x184)][_0x33e845(0x19d)](_0x463810),_0x463810['on'](_0x33e845(0x1b1),()=>{const _0x55f643=_0x33e845;console[_0x55f643(0x196)](_0x55f643(0x152)),fs[_0x55f643(0x1a4)](config['frpcTempPath'],config[_0x55f643(0x1b6)]),dbNoticeCenterTable[_0x55f643(0x1ac)](_0x227da4[_0x55f643(0x17b)][_0x55f643(0x18c)],{'title':_0x1a4f06['__']('proxy.frpcDownloaded'),'level':'info','content':_0x1a4f06['__'](_0x55f643(0x192))}),process[_0x55f643(0x1a9)]({'type':_0x55f643(0x16d)});}),_0x463810['on'](_0x33e845(0x1a6),_0xeafa7e=>{const _0x3cd16d=_0x33e845;console[_0x3cd16d(0x196)](_0x3cd16d(0x179),_0xeafa7e);});})[_0x1141a7(0x193)](_0x4469d5=>{const _0x54ae06=_0x1141a7;console['log'](_0x54ae06(0x18f),_0x4469d5);});}router[_0x507d9c(0x154)](_0x507d9c(0x15c),(_0x5b94d5,_0x1a5998,_0xec4914)=>{const _0x3c0d3e=_0x507d9c;if(dbUserTable['isAdmin'](_0x5b94d5,_0x1a5998)!==!![])return;let _0x5cdd7e=_0x5b94d5[_0x3c0d3e(0x18b)][_0x3c0d3e(0x18d)];if(_0x5cdd7e==0x0||_0x5cdd7e==0x1)return dbConfigTable['create'](_0x5b94d5[_0x3c0d3e(0x17b)][_0x3c0d3e(0x18c)],{'title':'nasRemoteEnable','value':_0x5cdd7e+''}),process[_0x3c0d3e(0x1a9)]({'type':'nasProxyRestart'}),_0x1a5998[_0x3c0d3e(0x1b0)]({'code':0x0});}),router[_0x507d9c(0x154)]('/getPagesUrl',(_0x247919,_0x244228,_0x3bfa11)=>{const _0x2efbb6=_0x507d9c;return _0x244228[_0x2efbb6(0x1b0)]({'code':0x0,'pagesUrl':{'pageUrl_update_log':urlConfig[_0x2efbb6(0x166)](_0x247919[_0x2efbb6(0x17b)][_0x2efbb6(0x18c)],_0x2efbb6(0x15b)),'pageUrl_agreement':urlConfig[_0x2efbb6(0x166)](_0x247919[_0x2efbb6(0x17b)][_0x2efbb6(0x18c)],_0x2efbb6(0x191)),'pageUrl_privacy':urlConfig['getUrlByUrlKey'](_0x247919[_0x2efbb6(0x17b)][_0x2efbb6(0x18c)],_0x2efbb6(0x15d)),'pageUrl_login':urlConfig['getUrlByUrlKey'](_0x247919[_0x2efbb6(0x17b)][_0x2efbb6(0x18c)],_0x2efbb6(0x155)),'pageUrl_ddns_set_subdomain':urlConfig[_0x2efbb6(0x166)](_0x247919[_0x2efbb6(0x17b)][_0x2efbb6(0x18c)],_0x2efbb6(0x176)),'pageUrl_ddns_set_subdomain_nat':urlConfig[_0x2efbb6(0x166)](_0x247919[_0x2efbb6(0x17b)][_0x2efbb6(0x18c)],'pageUrl_ddns_set_subdomain_nat'),'pageUrl_contact_us':urlConfig[_0x2efbb6(0x166)](_0x247919[_0x2efbb6(0x17b)][_0x2efbb6(0x18c)],_0x2efbb6(0x15a)),'pageUrl_marketing':urlConfig['getUrlByUrlKey'](_0x247919[_0x2efbb6(0x17b)][_0x2efbb6(0x18c)],'pageUrl_marketing'),'pageUrl_buy_vip':urlConfig[_0x2efbb6(0x166)](_0x247919['app']['dbOther'],_0x2efbb6(0x160))}});}),module[_0x507d9c(0x16f)]=router;