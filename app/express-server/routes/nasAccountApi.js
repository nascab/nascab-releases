const _0x52add8=_0x5bf8;(function(_0x19b474,_0x500d30){const _0x5be6a0=_0x5bf8,_0x57434e=_0x19b474();while(!![]){try{const _0x1b7725=-parseInt(_0x5be6a0(0x210))/0x1*(-parseInt(_0x5be6a0(0x1f4))/0x2)+-parseInt(_0x5be6a0(0x219))/0x3+parseInt(_0x5be6a0(0x205))/0x4*(parseInt(_0x5be6a0(0x200))/0x5)+parseInt(_0x5be6a0(0x1fa))/0x6+parseInt(_0x5be6a0(0x1f0))/0x7+parseInt(_0x5be6a0(0x222))/0x8+parseInt(_0x5be6a0(0x1ed))/0x9*(-parseInt(_0x5be6a0(0x203))/0xa);if(_0x1b7725===_0x500d30)break;else _0x57434e['push'](_0x57434e['shift']());}catch(_0x44d3f0){_0x57434e['push'](_0x57434e['shift']());}}}(_0x8d5c,0x5b254));var express=require(_0x52add8(0x20f)),router=express[_0x52add8(0x21b)]();function _0x5bf8(_0x5297d1,_0x1d159b){const _0x8d5c26=_0x8d5c();return _0x5bf8=function(_0x5bf85c,_0x7d84d6){_0x5bf85c=_0x5bf85c-0x1d8;let _0x2074c8=_0x8d5c26[_0x5bf85c];return _0x2074c8;},_0x5bf8(_0x5297d1,_0x1d159b);}let config=require(_0x52add8(0x22c)),dbConfigTable=require('../../db/dbConfigTable'),dbNoticeCenterTable=require('../../db/dbNoticeCenterTable'),cryptoUtils=require(_0x52add8(0x221)),nasAccountUtil=require(_0x52add8(0x217));const dbUserTable=require(_0x52add8(0x1ea)),fs=require('fs');function _0x8d5c(){const _0x3b8b45=['/getProxyState','4965982xqhOiQ','data','json','vipType','790qHcRQu','/getNasAccountInfo','post','getVipInfo','nasDdnsEnable','userInfo','3783780tZovPd','token','ipv6','ipv4','/reconnectRemote','../../myConfig/urlConfig','5wIEDeO','Params\x20invalid','then','3469510CjjdKB','body','404252SoWDvG','existsSync','type','info','nasAccountInfoConfigKey','httpsCert','send','pageUrl_marketing','/setDdnsEnable','pipe','express','334hrzWYZ','axios','/getVipInfo','nasDdnsRestart','frpcFolder','GET','stream','../utils/nasAccountUtils','frpcPath','44859eIytiz','globalIpList','Router','NasCab\x20account\x20not\x20found','/setUseNasCabCert','pageUrl_update_log','nasRemoteEnable','proxy.frpcDownloaded','../utils/cryptoUtils','1624320QGyvNi','returnErrMsg','nasDdnsState','frpcTempPath','getUrlByUrlKey','pageUrl_ddns_set_subdomain','log','msg','nasProxyRestart','apiDDNSUrl','../../myConfig/config','nasCabLogout','findByTitle','ipv6addressNotFound','/nasCabLogout','proxyServerList','createWriteStream','mkdirSync','exports','FRPC\x20download\x20finish','pageUrl_login','catch','decryptString','length','value','parse','/downloadFrpc','pageUrl_privacy','/getPagesUrl','app','dbOther','nasAccountLogin','httpsKey','/setRemoteEnable','isAdmin','key','getCerts','pageUrl_contact_us','ddnsType','pageUrl_ddns_set_subdomain_nat','pageUrl_agreement','renameSync','loginByToken','nasAccountInfoPwd','create','../../db/dbUserTable','downloadUrlFrpc','FRPC\x20download\x20error','36IbPRpc','deleteByTitle'];_0x8d5c=function(){return _0x3b8b45;};return _0x8d5c();}let axios=require(_0x52add8(0x211));const urlConfig=require(_0x52add8(0x1ff));router[_0x52add8(0x1f6)]('/getDDNSState',(_0x464b0e,_0x5800a4,_0x1167e9)=>{const _0x1b8645=_0x52add8;if(dbUserTable[_0x1b8645(0x1df)](_0x464b0e,_0x5800a4)!==!![])return;let _0x212bc4=dbConfigTable['findByTitle'](_0x464b0e['app'][_0x1b8645(0x1db)],'nasDdnsState');return _0x5800a4[_0x1b8645(0x1f2)]({'code':0x0,'ddnsState':_0x212bc4?JSON['parse'](_0x212bc4[_0x1b8645(0x23a)]):''});}),router['post'](_0x52add8(0x20d),(_0x1c38d9,_0xb95e3b,_0x2bb6bc)=>{const _0x48c9a9=_0x52add8;if(dbUserTable[_0x48c9a9(0x1df)](_0x1c38d9,_0xb95e3b)!==!![])return;let _0x3be17d=_0x1c38d9[_0x48c9a9(0x204)]['nasDdnsEnable'];if(_0x3be17d==0x0||_0x3be17d==0x1)return dbConfigTable['create'](_0x1c38d9['app']['dbOther'],{'title':_0x48c9a9(0x1f8),'value':_0x3be17d+''}),process['send']({'type':_0x48c9a9(0x213)}),_0xb95e3b[_0x48c9a9(0x1f2)]({'code':0x0});});function saveConfig(_0x17bbcf,_0x5b830f,_0x511d8e){const _0x52d68c=_0x52add8;dbConfigTable[_0x52d68c(0x1e9)](_0x17bbcf,{'title':_0x5b830f,'value':_0x511d8e+''});}function saveNasCabHttpsCerts(_0x559ba2,_0x488ffd){const _0x2f0def=_0x52add8;let _0x1b556a=dbConfigTable[_0x2f0def(0x22e)](_0x559ba2,config[_0x2f0def(0x209)]);if(!_0x1b556a){if(_0x488ffd)return _0x488ffd[_0x2f0def(0x1f2)]({'code':0x1,'message':_0x2f0def(0x21c)});}cryptoUtils[_0x2f0def(0x238)](config['nasAccountInfoPwd'],_0x1b556a[_0x2f0def(0x23a)])[_0x2f0def(0x202)](_0x1bf745=>{const _0x354b29=_0x2f0def;let _0x1f9511=JSON['parse'](_0x1bf745),_0x18630a=_0x1f9511[_0x354b29(0x1f9)];_0x18630a['token']&&_0x18630a[_0x354b29(0x1fb)][_0x354b29(0x239)]>0x0&&(userToken=_0x18630a[_0x354b29(0x1fb)][_0x18630a[_0x354b29(0x1fb)][_0x354b29(0x239)]-0x1]);if(!userToken){if(_0x488ffd)return _0x488ffd['json']({'code':0x1,'message':_0x354b29(0x21c)});}let _0x2dd1da={'token':userToken,'type':_0x354b29(0x1e1)};axios[_0x354b29(0x1f6)](urlConfig[_0x354b29(0x226)](_0x559ba2,_0x354b29(0x22b)),_0x2dd1da)[_0x354b29(0x202)](_0x1dfe23=>{const _0x2ee37d=_0x354b29;if(_0x1dfe23[_0x2ee37d(0x1f1)]['code']){if(_0x488ffd)return _0x488ffd['json']({'code':0x1,'message':_0x1dfe23[_0x2ee37d(0x1f1)][_0x2ee37d(0x229)]});}else{saveConfig(_0x559ba2,_0x2ee37d(0x1dd),_0x1dfe23[_0x2ee37d(0x1f1)][_0x2ee37d(0x1e0)]),saveConfig(_0x559ba2,_0x2ee37d(0x20a),_0x1dfe23['data']['crt']);if(_0x488ffd)return _0x488ffd[_0x2ee37d(0x1f2)]({'code':0x0});}})['catch'](_0x48496e=>{const _0x595ae4=_0x354b29;if(_0x488ffd)return _0x488ffd[_0x595ae4(0x1f2)]({'code':0x1,'message':_0x488ffd['__']('netWorkRequestFail')});});})['catch'](_0x178c7b=>{const _0x165aec=_0x2f0def;console['log'](_0x178c7b),dbConfigTable[_0x165aec(0x1ee)](dbOther,config[_0x165aec(0x209)]);});}router[_0x52add8(0x1f6)](_0x52add8(0x21d),(_0x4aa93e,_0x129f55,_0x503a68)=>{const _0x6241d=_0x52add8;if(dbUserTable['isAdmin'](_0x4aa93e,_0x129f55)!==!![])return;let _0x523a26=_0x4aa93e[_0x6241d(0x204)]['useNasCabCerts'];if(_0x523a26==0x0||_0x523a26==0x1){saveConfig(_0x4aa93e[_0x6241d(0x1da)][_0x6241d(0x1db)],'useNasCabCerts',_0x523a26+'');if(_0x523a26==0x1)saveNasCabHttpsCerts(_0x4aa93e[_0x6241d(0x1da)]['dbOther'],_0x129f55);else return saveConfig(_0x4aa93e['app']['dbOther'],_0x6241d(0x1dd),''),saveConfig(_0x4aa93e['app'][_0x6241d(0x1db)],'httpsCert',''),_0x129f55[_0x6241d(0x1f2)]({'code':0x0});}else return _0x129f55[_0x6241d(0x1f2)]({'code':0x1});}),router[_0x52add8(0x1f6)]('/setDdnsType',(_0x19c430,_0x448a6a,_0x27c723)=>{const _0x379c79=_0x52add8;if(dbUserTable[_0x379c79(0x1df)](_0x19c430,_0x448a6a)!==!![])return;let _0x4621ce=_0x19c430[_0x379c79(0x204)][_0x379c79(0x1e3)];if(_0x4621ce!=_0x379c79(0x1fd)&&_0x4621ce!=_0x379c79(0x1fc))return _0x448a6a[_0x379c79(0x1f2)]({'code':0x1});if(_0x4621ce==_0x379c79(0x1fc)){let _0x1f81c9='';try{let _0x54973e=dbConfigTable[_0x379c79(0x22e)](_0x19c430['app'][_0x379c79(0x1db)],_0x379c79(0x21a));_0x54973e&&(_0x54973e=JSON[_0x379c79(0x23b)](_0x54973e['value']));for(let _0x4bf659 in _0x54973e){if(_0x54973e[_0x4bf659][_0x379c79(0x207)]==_0x379c79(0x1fc)){_0x1f81c9=_0x54973e[_0x4bf659]['ip'];break;}}}catch(_0xfa6ff6){console['log'](_0xfa6ff6);}if(!_0x1f81c9)return _0x19c430[_0x379c79(0x1da)][_0x379c79(0x223)](_0x448a6a,_0x448a6a['__'](_0x379c79(0x22f)));}return dbConfigTable['create'](_0x19c430[_0x379c79(0x1da)][_0x379c79(0x1db)],{'title':'ddnsType','value':_0x4621ce}),process[_0x379c79(0x20b)]({'type':_0x379c79(0x213)}),_0x448a6a[_0x379c79(0x1f2)]({'code':0x0});}),router[_0x52add8(0x1f6)](_0x52add8(0x212),(_0x3c6d7b,_0x37944f,_0x40087c)=>{const _0x20fe3f=_0x52add8;let _0xcea391={'code':0x0};nasAccountUtil[_0x20fe3f(0x1f7)](_0x3c6d7b[_0x20fe3f(0x1da)][_0x20fe3f(0x1db)])[_0x20fe3f(0x202)](_0x4b3472=>{const _0x29213a=_0x20fe3f;return _0x4b3472==![]?_0xcea391[_0x29213a(0x1f3)]=0x0:_0xcea391[_0x29213a(0x1f3)]=_0x4b3472['type'],_0x37944f[_0x29213a(0x1f2)](_0xcea391);})[_0x20fe3f(0x237)](_0x9fd45f=>{const _0x5cd93a=_0x20fe3f;return _0xcea391[_0x5cd93a(0x1f3)]=0x0,_0x37944f[_0x5cd93a(0x1f2)](_0xcea391);});}),router['post'](_0x52add8(0x1f5),(_0x344dde,_0x425aa5,_0x199fc5)=>{const _0x193e76=_0x52add8;let _0xf9e6e7=dbConfigTable[_0x193e76(0x22e)](_0x344dde[_0x193e76(0x1da)][_0x193e76(0x1db)],config['nasAccountInfoConfigKey']),_0x1a1e5e=dbConfigTable[_0x193e76(0x22e)](_0x344dde[_0x193e76(0x1da)]['dbOther'],_0x193e76(0x224)),_0xd62a23=dbConfigTable[_0x193e76(0x22e)](_0x344dde[_0x193e76(0x1da)]['dbOther'],_0x193e76(0x1f8)),_0x4326f3=dbConfigTable['findByTitle'](_0x344dde['app']['dbOther'],_0x193e76(0x21f)),_0x2a32f1={'pageUrl_login':urlConfig['getUrlByUrlKey'](_0x344dde[_0x193e76(0x1da)][_0x193e76(0x1db)],'pageUrl_login'),'pageUrl_contact_us':urlConfig[_0x193e76(0x226)](_0x344dde['app'][_0x193e76(0x1db)],_0x193e76(0x1e2)),'pageUrl_marketing':urlConfig['getUrlByUrlKey'](_0x344dde[_0x193e76(0x1da)]['dbOther'],_0x193e76(0x20c)),'pageUrl_buy_vip':urlConfig[_0x193e76(0x226)](_0x344dde[_0x193e76(0x1da)][_0x193e76(0x1db)],'pageUrl_buy_vip')};if(_0xf9e6e7)cryptoUtils['decryptString'](config[_0x193e76(0x1e8)],_0xf9e6e7[_0x193e76(0x23a)])[_0x193e76(0x202)](_0x2da57d=>{const _0x2eaeb4=_0x193e76;return _0x425aa5['json']({'code':0x0,'data':JSON['parse'](_0x2da57d),'nasDdnsState':_0x1a1e5e?JSON[_0x2eaeb4(0x23b)](_0x1a1e5e['value']):'','nasDdnsEnable':_0xd62a23?_0xd62a23['value']:0x0,'nasRemoteEnable':_0x4326f3?_0x4326f3['value']:0x0,'pagesUrl':_0x2a32f1});})['catch'](_0x5b0a92=>{const _0x39dfdb=_0x193e76;return console[_0x39dfdb(0x228)](_0x5b0a92),dbConfigTable['deleteByTitle'](_0x344dde[_0x39dfdb(0x1da)]['dbOther'],config[_0x39dfdb(0x209)]),_0x425aa5[_0x39dfdb(0x1f2)]({'code':0x0,'data':'','pagesUrl':_0x2a32f1});});else return _0x425aa5['json']({'code':0x0,'data':'','pagesUrl':_0x2a32f1});}),router[_0x52add8(0x1f6)]('/nasCabLoginByToken',(_0x5e40ca,_0x282c60,_0x4df1d7)=>{const _0x13786d=_0x52add8;let _0x35e1ce=_0x5e40ca[_0x13786d(0x204)]['nascabToken'];if(!_0x35e1ce)return _0x5e40ca[_0x13786d(0x1da)][_0x13786d(0x223)](_0x282c60,_0x13786d(0x201));console[_0x13786d(0x228)]('nasCabLoginByToken',_0x35e1ce);if(dbUserTable[_0x13786d(0x1df)](_0x5e40ca,_0x282c60)!==!![])return;nasAccountUtil[_0x13786d(0x1e7)](_0x5e40ca[_0x13786d(0x1da)]['dbOther'],_0x35e1ce,()=>{const _0xc04057=_0x13786d;return process[_0xc04057(0x20b)]({'type':_0xc04057(0x1dc)}),_0x282c60[_0xc04057(0x1f2)]({'code':0x0});},()=>{const _0x2aa3ab=_0x13786d;return _0x5e40ca[_0x2aa3ab(0x1da)]['returnErrMsg'](_0x282c60,_0x282c60['__']('loginFailedTryLater'));});}),router['post'](_0x52add8(0x230),(_0x347424,_0x4e510a,_0x5912d3)=>{const _0x201f0b=_0x52add8;if(dbUserTable[_0x201f0b(0x1df)](_0x347424,_0x4e510a)!==!![])return;return dbConfigTable[_0x201f0b(0x1ee)](_0x347424['app'][_0x201f0b(0x1db)],config[_0x201f0b(0x209)]),process[_0x201f0b(0x20b)]({'type':_0x201f0b(0x22d)}),_0x4e510a[_0x201f0b(0x1f2)]({'code':0x0,'data':''});}),router[_0x52add8(0x1f6)](_0x52add8(0x1fe),(_0x2cf219,_0x2bf241,_0x10c5f9)=>{const _0x50591e=_0x52add8;if(dbUserTable['isAdmin'](_0x2cf219,_0x2bf241)!==!![])return;let _0x4b0ac0=_0x2cf219['body']['serverId'];return process[_0x50591e(0x20b)]({'type':'nasProxyRestart','serverId':_0x4b0ac0}),_0x2bf241[_0x50591e(0x1f2)]({'code':0x0});}),router[_0x52add8(0x1f6)](_0x52add8(0x1ef),(_0x6ab1fd,_0x4ca7cc,_0x25a9f0)=>{const _0x387278=_0x52add8;if(dbUserTable['isAdmin'](_0x6ab1fd,_0x4ca7cc)!==!![])return;let _0x1e1c53=fs[_0x387278(0x206)](config[_0x387278(0x218)]),_0x4e1301=dbConfigTable[_0x387278(0x22e)](_0x6ab1fd['app'][_0x387278(0x1db)],'nasRemoteState'),_0xc75f48=dbConfigTable[_0x387278(0x22e)](_0x6ab1fd[_0x387278(0x1da)][_0x387278(0x1db)],_0x387278(0x231)),_0x1714e8=dbConfigTable[_0x387278(0x22e)](_0x6ab1fd[_0x387278(0x1da)][_0x387278(0x1db)],'serverRootPath');return _0x4ca7cc['json']({'code':0x0,'serverRootPath':_0x1714e8?_0x1714e8[_0x387278(0x23a)]:'','proxyState':_0x4e1301?JSON[_0x387278(0x23b)](_0x4e1301['value']):'','pluginExists':_0x1e1c53,'pluginPath':config[_0x387278(0x218)],'proxyServerList':_0xc75f48?_0xc75f48[_0x387278(0x23a)]:'[]'});}),router[_0x52add8(0x1f6)](_0x52add8(0x23c),(_0x6c063f,_0x3e0a4e,_0x4d7aa3)=>{const _0x2ada7a=_0x52add8;if(dbUserTable[_0x2ada7a(0x1df)](_0x6c063f,_0x3e0a4e)!==!![])return;if(fs[_0x2ada7a(0x206)](config[_0x2ada7a(0x218)]))return _0x6c063f[_0x2ada7a(0x1da)][_0x2ada7a(0x223)](_0x3e0a4e,_0x3e0a4e['__']('proxy.frpcExist'));return downloadFrpc(_0x6c063f,_0x3e0a4e),_0x3e0a4e['json']({'code':0x0});});function downloadFrpc(_0x440569,_0x460378){const _0x579c75=_0x52add8;!fs[_0x579c75(0x206)](config[_0x579c75(0x214)])&&fs[_0x579c75(0x233)](config[_0x579c75(0x214)],{'recursive':!![]}),axios({'url':urlConfig[_0x579c75(0x226)](_0x440569[_0x579c75(0x1da)]['dbOther'],_0x579c75(0x1eb)),'method':_0x579c75(0x215),'responseType':_0x579c75(0x216)})[_0x579c75(0x202)](_0x25f24d=>{const _0x382710=_0x579c75;let _0x167138=fs[_0x382710(0x232)](config[_0x382710(0x225)]);_0x25f24d[_0x382710(0x1f1)][_0x382710(0x20e)](_0x167138),_0x167138['on']('finish',()=>{const _0x4af9a8=_0x382710;console[_0x4af9a8(0x228)](_0x4af9a8(0x235)),fs[_0x4af9a8(0x1e6)](config['frpcTempPath'],config[_0x4af9a8(0x218)]),dbNoticeCenterTable[_0x4af9a8(0x1e9)](_0x440569[_0x4af9a8(0x1da)][_0x4af9a8(0x1db)],{'title':_0x460378['__'](_0x4af9a8(0x220)),'level':_0x4af9a8(0x208),'content':_0x460378['__'](_0x4af9a8(0x220))}),process[_0x4af9a8(0x20b)]({'type':_0x4af9a8(0x22a)});}),_0x167138['on']('error',_0x5b733c=>{const _0x36b133=_0x382710;console[_0x36b133(0x228)](_0x36b133(0x1ec),_0x5b733c);});})[_0x579c75(0x237)](_0x291a49=>{const _0x4e78d9=_0x579c75;console[_0x4e78d9(0x228)]('FRPC\x20download\x20exception',_0x291a49);});}router['post'](_0x52add8(0x1de),(_0x58a84e,_0x29d7d5,_0x54e11b)=>{const _0x517c56=_0x52add8;if(dbUserTable[_0x517c56(0x1df)](_0x58a84e,_0x29d7d5)!==!![])return;let _0x2e862e=_0x58a84e['body'][_0x517c56(0x21f)];if(_0x2e862e==0x0||_0x2e862e==0x1)return dbConfigTable['create'](_0x58a84e[_0x517c56(0x1da)][_0x517c56(0x1db)],{'title':_0x517c56(0x21f),'value':_0x2e862e+''}),process[_0x517c56(0x20b)]({'type':_0x517c56(0x22a)}),_0x29d7d5[_0x517c56(0x1f2)]({'code':0x0});}),router['post'](_0x52add8(0x1d9),(_0x573464,_0x1081b3,_0x5a7b57)=>{const _0x4800df=_0x52add8;return _0x1081b3['json']({'code':0x0,'pagesUrl':{'pageUrl_update_log':urlConfig[_0x4800df(0x226)](_0x573464[_0x4800df(0x1da)][_0x4800df(0x1db)],_0x4800df(0x21e)),'pageUrl_agreement':urlConfig[_0x4800df(0x226)](_0x573464[_0x4800df(0x1da)][_0x4800df(0x1db)],_0x4800df(0x1e5)),'pageUrl_privacy':urlConfig[_0x4800df(0x226)](_0x573464[_0x4800df(0x1da)][_0x4800df(0x1db)],_0x4800df(0x1d8)),'pageUrl_login':urlConfig[_0x4800df(0x226)](_0x573464[_0x4800df(0x1da)][_0x4800df(0x1db)],_0x4800df(0x236)),'pageUrl_ddns_set_subdomain':urlConfig[_0x4800df(0x226)](_0x573464[_0x4800df(0x1da)][_0x4800df(0x1db)],_0x4800df(0x227)),'pageUrl_ddns_set_subdomain_nat':urlConfig[_0x4800df(0x226)](_0x573464['app'][_0x4800df(0x1db)],_0x4800df(0x1e4)),'pageUrl_contact_us':urlConfig[_0x4800df(0x226)](_0x573464[_0x4800df(0x1da)][_0x4800df(0x1db)],_0x4800df(0x1e2)),'pageUrl_marketing':urlConfig[_0x4800df(0x226)](_0x573464[_0x4800df(0x1da)][_0x4800df(0x1db)],_0x4800df(0x20c)),'pageUrl_buy_vip':urlConfig['getUrlByUrlKey'](_0x573464['app'][_0x4800df(0x1db)],'pageUrl_buy_vip')}});}),module[_0x52add8(0x234)]=router;