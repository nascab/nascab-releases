const _0x2aef0c=_0x4c7f;(function(_0x195388,_0x1910db){const _0xeef1f3=_0x4c7f,_0x1ecd36=_0x195388();while(!![]){try{const _0x22cd3c=-parseInt(_0xeef1f3(0xa4))/0x1*(-parseInt(_0xeef1f3(0xd0))/0x2)+-parseInt(_0xeef1f3(0xa8))/0x3+-parseInt(_0xeef1f3(0xb0))/0x4+parseInt(_0xeef1f3(0x9b))/0x5+parseInt(_0xeef1f3(0xa5))/0x6*(parseInt(_0xeef1f3(0xc8))/0x7)+-parseInt(_0xeef1f3(0xe4))/0x8*(parseInt(_0xeef1f3(0xad))/0x9)+-parseInt(_0xeef1f3(0xfe))/0xa;if(_0x22cd3c===_0x1910db)break;else _0x1ecd36['push'](_0x1ecd36['shift']());}catch(_0x59770c){_0x1ecd36['push'](_0x1ecd36['shift']());}}}(_0xaaae,0xcb63e));var express=require(_0x2aef0c(0xd5)),router=express[_0x2aef0c(0xb6)]();let config=require('../../myConfig/config'),dbConfigTable=require(_0x2aef0c(0xc7)),dbNoticeCenterTable=require(_0x2aef0c(0xbe)),cryptoUtils=require(_0x2aef0c(0xd1)),nasAccountUtil=require('../utils/nasAccountUtils');const dbUserTable=require(_0x2aef0c(0xae)),fs=require('fs');let axios=require(_0x2aef0c(0xf5));function _0xaaae(){const _0xbac145=['globalIpList','../../myConfig/urlConfig','axios','mkdirSync','value','finish','decryptString','getCerts','nasDdnsEnable','body','then','4166790NlTtkt','catch','send','key','loginByToken','4573040mNruRl','/nasCabLogout','error','frpcPath','FRPC\x20download\x20finish','downloadUrlFrpc','create','ipv4','token','1654464nEumZK','214614DKMTly','deleteByTitle','NasCab\x20account\x20not\x20found','1357077PGTcbY','parse','length','netWorkRequestFail','serverId','9540wiHqnI','../../db/dbUserTable','serverRootPath','4695828pAWusK','json','pipe','info','proxy.frpcExist','stream','Router','getUrlByUrlKey','pageUrl_login','app','type','getVipInfo','frpcFolder','nasCabLoginByToken','../../db/dbNoticeCenterTable','GET','pageUrl_update_log','httpsKey','useNasCabCerts','/reconnectRemote','proxy.frpcDownloaded','httpsCert','/downloadFrpc','../../db/dbConfigTable','147KXxmNu','isAdmin','nasProxyRestart','pageUrl_marketing','existsSync','ipv6','nasDdnsRestart','msg','2pNAeVP','../utils/cryptoUtils','nasAccountInfoPwd','crt','/getProxyState','express','vipType','loginFailedTryLater','pageUrl_contact_us','renameSync','/setUseNasCabCert','proxyServerList','createWriteStream','ddnsType','/getNasAccountInfo','returnErrMsg','nasDdnsState','nasAccountInfoConfigKey','FRPC\x20download\x20error','/getVipInfo','3352xHALSN','log','dbOther','pageUrl_agreement','ipv6addressNotFound','/getDDNSState','nasRemoteEnable','post','/setRemoteEnable','code','apiDDNSUrl','pageUrl_buy_vip','data','Params\x20invalid','findByTitle'];_0xaaae=function(){return _0xbac145;};return _0xaaae();}const urlConfig=require(_0x2aef0c(0xf4));router[_0x2aef0c(0xeb)](_0x2aef0c(0xe9),(_0x15ff41,_0x5a599f,_0x2a295d)=>{const _0x5b3f61=_0x2aef0c;if(dbUserTable[_0x5b3f61(0xc9)](_0x15ff41,_0x5a599f)!==!![])return;let _0x38dd5c=dbConfigTable[_0x5b3f61(0xf2)](_0x15ff41[_0x5b3f61(0xb9)][_0x5b3f61(0xe6)],_0x5b3f61(0xe0));return _0x5a599f[_0x5b3f61(0xb1)]({'code':0x0,'ddnsState':_0x38dd5c?JSON[_0x5b3f61(0xa9)](_0x38dd5c['value']):''});}),router[_0x2aef0c(0xeb)]('/setDdnsEnable',(_0x3a1fbe,_0x1caa7e,_0x1c66cf)=>{const _0x27ae74=_0x2aef0c;if(dbUserTable[_0x27ae74(0xc9)](_0x3a1fbe,_0x1caa7e)!==!![])return;let _0x7ef5a=_0x3a1fbe[_0x27ae74(0xfc)][_0x27ae74(0xfb)];if(_0x7ef5a==0x0||_0x7ef5a==0x1)return dbConfigTable['create'](_0x3a1fbe['app']['dbOther'],{'title':_0x27ae74(0xfb),'value':_0x7ef5a+''}),process[_0x27ae74(0x100)]({'type':'nasDdnsRestart'}),_0x1caa7e[_0x27ae74(0xb1)]({'code':0x0});});function _0x4c7f(_0x31c315,_0x308f6d){const _0xaaaec0=_0xaaae();return _0x4c7f=function(_0x4c7f0f,_0x5f20a8){_0x4c7f0f=_0x4c7f0f-0x99;let _0x279702=_0xaaaec0[_0x4c7f0f];return _0x279702;},_0x4c7f(_0x31c315,_0x308f6d);}function saveConfig(_0x319fd8,_0xf0a444,_0x490154){const _0x50aa70=_0x2aef0c;dbConfigTable[_0x50aa70(0xa1)](_0x319fd8,{'title':_0xf0a444,'value':_0x490154+''});}function saveNasCabHttpsCerts(_0x2c864a,_0x469657){const _0x208408=_0x2aef0c;let _0x26089d=dbConfigTable[_0x208408(0xf2)](_0x2c864a,config[_0x208408(0xe1)]);if(!_0x26089d){if(_0x469657)return _0x469657[_0x208408(0xb1)]({'code':0x1,'message':_0x208408(0xa7)});}cryptoUtils[_0x208408(0xf9)](config[_0x208408(0xd2)],_0x26089d[_0x208408(0xf7)])[_0x208408(0xfd)](_0x4ff29c=>{const _0x1ecde0=_0x208408;let _0x52fc5f=JSON['parse'](_0x4ff29c),_0x5a4481=_0x52fc5f['userInfo'];_0x5a4481[_0x1ecde0(0xa3)]&&_0x5a4481[_0x1ecde0(0xa3)][_0x1ecde0(0xaa)]>0x0&&(userToken=_0x5a4481[_0x1ecde0(0xa3)][_0x5a4481[_0x1ecde0(0xa3)][_0x1ecde0(0xaa)]-0x1]);if(!userToken){if(_0x469657)return _0x469657['json']({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}let _0x1bfdbc={'token':userToken,'type':_0x1ecde0(0xfa)};axios[_0x1ecde0(0xeb)](urlConfig[_0x1ecde0(0xb7)](_0x2c864a,_0x1ecde0(0xee)),_0x1bfdbc)[_0x1ecde0(0xfd)](_0x3475dc=>{const _0x47da1c=_0x1ecde0;if(_0x3475dc[_0x47da1c(0xf0)][_0x47da1c(0xed)]){if(_0x469657)return _0x469657[_0x47da1c(0xb1)]({'code':0x1,'message':_0x3475dc[_0x47da1c(0xf0)][_0x47da1c(0xcf)]});}else{saveConfig(_0x2c864a,_0x47da1c(0xc1),_0x3475dc['data'][_0x47da1c(0x99)]),saveConfig(_0x2c864a,_0x47da1c(0xc5),_0x3475dc[_0x47da1c(0xf0)][_0x47da1c(0xd3)]);if(_0x469657)return _0x469657['json']({'code':0x0});}})[_0x1ecde0(0xff)](_0x5215ea=>{const _0x7deb9b=_0x1ecde0;if(_0x469657)return _0x469657[_0x7deb9b(0xb1)]({'code':0x1,'message':_0x469657['__'](_0x7deb9b(0xab))});});})[_0x208408(0xff)](_0x2fb7a9=>{const _0x326384=_0x208408;console['log'](_0x2fb7a9),dbConfigTable[_0x326384(0xa6)](dbOther,config[_0x326384(0xe1)]);});}router['post'](_0x2aef0c(0xda),(_0xf2410d,_0xf14a4b,_0x3c9a16)=>{const _0x2f0ef4=_0x2aef0c;if(dbUserTable[_0x2f0ef4(0xc9)](_0xf2410d,_0xf14a4b)!==!![])return;let _0x24812c=_0xf2410d[_0x2f0ef4(0xfc)]['useNasCabCerts'];if(_0x24812c==0x0||_0x24812c==0x1){saveConfig(_0xf2410d[_0x2f0ef4(0xb9)][_0x2f0ef4(0xe6)],_0x2f0ef4(0xc2),_0x24812c+'');if(_0x24812c==0x1)saveNasCabHttpsCerts(_0xf2410d['app'][_0x2f0ef4(0xe6)],_0xf14a4b);else return saveConfig(_0xf2410d[_0x2f0ef4(0xb9)][_0x2f0ef4(0xe6)],_0x2f0ef4(0xc1),''),saveConfig(_0xf2410d['app'][_0x2f0ef4(0xe6)],_0x2f0ef4(0xc5),''),_0xf14a4b[_0x2f0ef4(0xb1)]({'code':0x0});}else return _0xf14a4b[_0x2f0ef4(0xb1)]({'code':0x1});}),router[_0x2aef0c(0xeb)]('/setDdnsType',(_0x18f755,_0x28676a,_0xa2f377)=>{const _0x12c1d0=_0x2aef0c;if(dbUserTable[_0x12c1d0(0xc9)](_0x18f755,_0x28676a)!==!![])return;let _0xa3edb0=_0x18f755[_0x12c1d0(0xfc)][_0x12c1d0(0xdd)];if(_0xa3edb0!=_0x12c1d0(0xa2)&&_0xa3edb0!=_0x12c1d0(0xcd))return _0x28676a[_0x12c1d0(0xb1)]({'code':0x1});if(_0xa3edb0==_0x12c1d0(0xcd)){let _0x5d5989='';try{let _0x4d7fbe=dbConfigTable[_0x12c1d0(0xf2)](_0x18f755['app']['dbOther'],_0x12c1d0(0xf3));_0x4d7fbe&&(_0x4d7fbe=JSON[_0x12c1d0(0xa9)](_0x4d7fbe[_0x12c1d0(0xf7)]));for(let _0x4336f0 in _0x4d7fbe){if(_0x4d7fbe[_0x4336f0][_0x12c1d0(0xba)]==_0x12c1d0(0xcd)){_0x5d5989=_0x4d7fbe[_0x4336f0]['ip'];break;}}}catch(_0xce56d6){console['log'](_0xce56d6);}if(!_0x5d5989)return _0x18f755[_0x12c1d0(0xb9)]['returnErrMsg'](_0x28676a,_0x28676a['__'](_0x12c1d0(0xe8)));}return dbConfigTable[_0x12c1d0(0xa1)](_0x18f755['app']['dbOther'],{'title':'ddnsType','value':_0xa3edb0}),process['send']({'type':_0x12c1d0(0xce)}),_0x28676a[_0x12c1d0(0xb1)]({'code':0x0});}),router['post'](_0x2aef0c(0xe3),(_0x231637,_0x2679d2,_0x28982d)=>{const _0x16a99d=_0x2aef0c;let _0x287f3a={'code':0x0};nasAccountUtil[_0x16a99d(0xbb)](_0x231637[_0x16a99d(0xb9)][_0x16a99d(0xe6)])[_0x16a99d(0xfd)](_0x115bbf=>{const _0x4b4f04=_0x16a99d;return _0x115bbf==![]?_0x287f3a[_0x4b4f04(0xd6)]=0x0:_0x287f3a[_0x4b4f04(0xd6)]=_0x115bbf[_0x4b4f04(0xba)],_0x2679d2['json'](_0x287f3a);})[_0x16a99d(0xff)](_0x3d9261=>{const _0x4d4b66=_0x16a99d;return _0x287f3a['vipType']=0x0,_0x2679d2[_0x4d4b66(0xb1)](_0x287f3a);});}),router[_0x2aef0c(0xeb)](_0x2aef0c(0xde),(_0x22f134,_0x4f8720,_0x1eadba)=>{const _0x316bf7=_0x2aef0c;let _0x581f75=dbConfigTable[_0x316bf7(0xf2)](_0x22f134[_0x316bf7(0xb9)][_0x316bf7(0xe6)],config[_0x316bf7(0xe1)]),_0x52e633=dbConfigTable[_0x316bf7(0xf2)](_0x22f134[_0x316bf7(0xb9)]['dbOther'],_0x316bf7(0xe0)),_0x212098=dbConfigTable[_0x316bf7(0xf2)](_0x22f134['app'][_0x316bf7(0xe6)],'nasDdnsEnable'),_0x423d5f=dbConfigTable[_0x316bf7(0xf2)](_0x22f134[_0x316bf7(0xb9)]['dbOther'],_0x316bf7(0xea)),_0x36f71b={'pageUrl_login':urlConfig[_0x316bf7(0xb7)](_0x22f134[_0x316bf7(0xb9)][_0x316bf7(0xe6)],'pageUrl_login'),'pageUrl_contact_us':urlConfig[_0x316bf7(0xb7)](_0x22f134[_0x316bf7(0xb9)][_0x316bf7(0xe6)],'pageUrl_contact_us'),'pageUrl_marketing':urlConfig[_0x316bf7(0xb7)](_0x22f134[_0x316bf7(0xb9)][_0x316bf7(0xe6)],_0x316bf7(0xcb)),'pageUrl_buy_vip':urlConfig['getUrlByUrlKey'](_0x22f134[_0x316bf7(0xb9)][_0x316bf7(0xe6)],'pageUrl_buy_vip')};if(_0x581f75)cryptoUtils[_0x316bf7(0xf9)](config[_0x316bf7(0xd2)],_0x581f75[_0x316bf7(0xf7)])[_0x316bf7(0xfd)](_0x4d0bcd=>{const _0x19e12a=_0x316bf7;return _0x4f8720['json']({'code':0x0,'data':JSON['parse'](_0x4d0bcd),'nasDdnsState':_0x52e633?JSON['parse'](_0x52e633[_0x19e12a(0xf7)]):'','nasDdnsEnable':_0x212098?_0x212098[_0x19e12a(0xf7)]:0x0,'nasRemoteEnable':_0x423d5f?_0x423d5f[_0x19e12a(0xf7)]:0x0,'pagesUrl':_0x36f71b});})[_0x316bf7(0xff)](_0x54b74f=>{const _0x4c2202=_0x316bf7;return console[_0x4c2202(0xe5)](_0x54b74f),dbConfigTable[_0x4c2202(0xa6)](_0x22f134['app'][_0x4c2202(0xe6)],config[_0x4c2202(0xe1)]),_0x4f8720[_0x4c2202(0xb1)]({'code':0x0,'data':'','pagesUrl':_0x36f71b});});else return _0x4f8720[_0x316bf7(0xb1)]({'code':0x0,'data':'','pagesUrl':_0x36f71b});}),router[_0x2aef0c(0xeb)]('/nasCabLoginByToken',(_0x4df870,_0x1d8847,_0x488e87)=>{const _0x279980=_0x2aef0c;let _0x21d909=_0x4df870[_0x279980(0xfc)]['nascabToken'];if(!_0x21d909)return _0x4df870[_0x279980(0xb9)][_0x279980(0xdf)](_0x1d8847,_0x279980(0xf1));console[_0x279980(0xe5)](_0x279980(0xbd),_0x21d909);if(dbUserTable[_0x279980(0xc9)](_0x4df870,_0x1d8847)!==!![])return;nasAccountUtil[_0x279980(0x9a)](_0x4df870['app'][_0x279980(0xe6)],_0x21d909,()=>{const _0x50494c=_0x279980;return process[_0x50494c(0x100)]({'type':'nasAccountLogin'}),_0x1d8847[_0x50494c(0xb1)]({'code':0x0});},()=>{const _0x185d34=_0x279980;return _0x4df870[_0x185d34(0xb9)]['returnErrMsg'](_0x1d8847,_0x1d8847['__'](_0x185d34(0xd7)));});}),router['post'](_0x2aef0c(0x9c),(_0x2527c4,_0x2a9cfc,_0x35ee7a)=>{const _0x1cb952=_0x2aef0c;if(dbUserTable['isAdmin'](_0x2527c4,_0x2a9cfc)!==!![])return;return dbConfigTable[_0x1cb952(0xa6)](_0x2527c4['app']['dbOther'],config['nasAccountInfoConfigKey']),process[_0x1cb952(0x100)]({'type':'nasCabLogout'}),_0x2a9cfc[_0x1cb952(0xb1)]({'code':0x0,'data':''});}),router[_0x2aef0c(0xeb)](_0x2aef0c(0xc3),(_0x53b097,_0x1b2bac,_0x39badf)=>{const _0x19d37b=_0x2aef0c;if(dbUserTable[_0x19d37b(0xc9)](_0x53b097,_0x1b2bac)!==!![])return;let _0x1a7f33=_0x53b097[_0x19d37b(0xfc)][_0x19d37b(0xac)];return process[_0x19d37b(0x100)]({'type':_0x19d37b(0xca),'serverId':_0x1a7f33}),_0x1b2bac[_0x19d37b(0xb1)]({'code':0x0});}),router[_0x2aef0c(0xeb)](_0x2aef0c(0xd4),(_0x14c0a1,_0x38600a,_0x484d21)=>{const _0x3395e7=_0x2aef0c;if(dbUserTable[_0x3395e7(0xc9)](_0x14c0a1,_0x38600a)!==!![])return;let _0x58a2fd=fs[_0x3395e7(0xcc)](config[_0x3395e7(0x9e)]),_0x2938f9=dbConfigTable[_0x3395e7(0xf2)](_0x14c0a1[_0x3395e7(0xb9)][_0x3395e7(0xe6)],'nasRemoteState'),_0xd7fa9e=dbConfigTable[_0x3395e7(0xf2)](_0x14c0a1[_0x3395e7(0xb9)][_0x3395e7(0xe6)],_0x3395e7(0xdb)),_0x392855=dbConfigTable['findByTitle'](_0x14c0a1[_0x3395e7(0xb9)][_0x3395e7(0xe6)],_0x3395e7(0xaf));return _0x38600a['json']({'code':0x0,'serverRootPath':_0x392855?_0x392855[_0x3395e7(0xf7)]:'','proxyState':_0x2938f9?JSON['parse'](_0x2938f9[_0x3395e7(0xf7)]):'','pluginExists':_0x58a2fd,'pluginPath':config[_0x3395e7(0x9e)],'proxyServerList':_0xd7fa9e?_0xd7fa9e[_0x3395e7(0xf7)]:'[]'});}),router[_0x2aef0c(0xeb)](_0x2aef0c(0xc6),(_0x45f337,_0x5aec39,_0x151b93)=>{const _0x5495dd=_0x2aef0c;if(dbUserTable['isAdmin'](_0x45f337,_0x5aec39)!==!![])return;if(fs[_0x5495dd(0xcc)](config[_0x5495dd(0x9e)]))return _0x45f337[_0x5495dd(0xb9)]['returnErrMsg'](_0x5aec39,_0x5aec39['__'](_0x5495dd(0xb4)));return downloadFrpc(_0x45f337,_0x5aec39),_0x5aec39[_0x5495dd(0xb1)]({'code':0x0});});function downloadFrpc(_0x597847,_0x2bfccd){const _0x1ea30a=_0x2aef0c;!fs['existsSync'](config[_0x1ea30a(0xbc)])&&fs[_0x1ea30a(0xf6)](config[_0x1ea30a(0xbc)],{'recursive':!![]}),axios({'url':urlConfig[_0x1ea30a(0xb7)](_0x597847['app'][_0x1ea30a(0xe6)],_0x1ea30a(0xa0)),'method':_0x1ea30a(0xbf),'responseType':_0x1ea30a(0xb5)})[_0x1ea30a(0xfd)](_0x17ae9e=>{const _0x190fa4=_0x1ea30a;let _0x398a34=fs[_0x190fa4(0xdc)](config['frpcTempPath']);_0x17ae9e[_0x190fa4(0xf0)][_0x190fa4(0xb2)](_0x398a34),_0x398a34['on'](_0x190fa4(0xf8),()=>{const _0x32765e=_0x190fa4;console[_0x32765e(0xe5)](_0x32765e(0x9f)),fs[_0x32765e(0xd9)](config['frpcTempPath'],config[_0x32765e(0x9e)]),dbNoticeCenterTable[_0x32765e(0xa1)](_0x597847[_0x32765e(0xb9)][_0x32765e(0xe6)],{'title':_0x2bfccd['__'](_0x32765e(0xc4)),'level':_0x32765e(0xb3),'content':_0x2bfccd['__']('proxy.frpcDownloaded')}),process[_0x32765e(0x100)]({'type':_0x32765e(0xca)});}),_0x398a34['on'](_0x190fa4(0x9d),_0x5c14b6=>{const _0x31e51f=_0x190fa4;console['log'](_0x31e51f(0xe2),_0x5c14b6);});})[_0x1ea30a(0xff)](_0xdfbf9c=>{console['log']('FRPC\x20download\x20exception',_0xdfbf9c);});}router[_0x2aef0c(0xeb)](_0x2aef0c(0xec),(_0x4ca213,_0x26eee,_0x4a0edb)=>{const _0x476a59=_0x2aef0c;if(dbUserTable[_0x476a59(0xc9)](_0x4ca213,_0x26eee)!==!![])return;let _0x520e92=_0x4ca213[_0x476a59(0xfc)][_0x476a59(0xea)];if(_0x520e92==0x0||_0x520e92==0x1)return dbConfigTable[_0x476a59(0xa1)](_0x4ca213[_0x476a59(0xb9)]['dbOther'],{'title':_0x476a59(0xea),'value':_0x520e92+''}),process[_0x476a59(0x100)]({'type':_0x476a59(0xca)}),_0x26eee[_0x476a59(0xb1)]({'code':0x0});}),router['post']('/getPagesUrl',(_0x3da204,_0x919a03,_0x2b2ec6)=>{const _0x53fe0b=_0x2aef0c;return _0x919a03[_0x53fe0b(0xb1)]({'code':0x0,'pagesUrl':{'pageUrl_update_log':urlConfig[_0x53fe0b(0xb7)](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],_0x53fe0b(0xc0)),'pageUrl_agreement':urlConfig[_0x53fe0b(0xb7)](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],_0x53fe0b(0xe7)),'pageUrl_privacy':urlConfig[_0x53fe0b(0xb7)](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],'pageUrl_privacy'),'pageUrl_login':urlConfig[_0x53fe0b(0xb7)](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],_0x53fe0b(0xb8)),'pageUrl_ddns_set_subdomain':urlConfig[_0x53fe0b(0xb7)](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],'pageUrl_ddns_set_subdomain'),'pageUrl_ddns_set_subdomain_nat':urlConfig[_0x53fe0b(0xb7)](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],'pageUrl_ddns_set_subdomain_nat'),'pageUrl_contact_us':urlConfig[_0x53fe0b(0xb7)](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],_0x53fe0b(0xd8)),'pageUrl_marketing':urlConfig['getUrlByUrlKey'](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],'pageUrl_marketing'),'pageUrl_buy_vip':urlConfig[_0x53fe0b(0xb7)](_0x3da204[_0x53fe0b(0xb9)][_0x53fe0b(0xe6)],_0x53fe0b(0xef))}});}),module['exports']=router;