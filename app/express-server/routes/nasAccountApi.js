const _0x12de17=_0x47cd;(function(_0x528572,_0x2e34b8){const _0x3df357=_0x47cd,_0x4d8852=_0x528572();while(!![]){try{const _0x4da072=parseInt(_0x3df357(0x1f3))/0x1*(parseInt(_0x3df357(0x1e0))/0x2)+-parseInt(_0x3df357(0x1b7))/0x3*(parseInt(_0x3df357(0x1b5))/0x4)+parseInt(_0x3df357(0x1d6))/0x5+parseInt(_0x3df357(0x1f0))/0x6*(-parseInt(_0x3df357(0x1ef))/0x7)+parseInt(_0x3df357(0x1be))/0x8+parseInt(_0x3df357(0x1d0))/0x9*(-parseInt(_0x3df357(0x1b1))/0xa)+parseInt(_0x3df357(0x1ff))/0xb;if(_0x4da072===_0x2e34b8)break;else _0x4d8852['push'](_0x4d8852['shift']());}catch(_0x39f0b8){_0x4d8852['push'](_0x4d8852['shift']());}}}(_0x4e39,0xbb2be));var express=require('express'),router=express[_0x12de17(0x1c2)]();function _0x4e39(){const _0x3d41ab=['../../myConfig/config','globalIpList','/getDDNSState','then','4826100lsAQZP','netWorkRequestFail','pageUrl_update_log','key','type','nasRemoteState','post','parse','nasCabLogout','loginFailedTryLater','2874rgftlu','log','ipv6','mkdirSync','app','getCerts','pageUrl_privacy','getUrlByUrlKey','pageUrl_ddns_set_subdomain_nat','/getVipInfo','pipe','apiDDNSUrl','dbOther','nasAccountLogin','useNasCabCerts','1748243gzUEHq','12XlYjti','returnErrMsg','axios','232CTyslO','value','finish','pageUrl_agreement','../../db/dbConfigTable','downloadUrlFrpc','/getPagesUrl','Params\x20invalid','loginByToken','code','/nasCabLogout','create','6368780EmvpKy','frpcPath','frpcTempPath','token','frpcFolder','nasProxyRestart','decryptString','createWriteStream','nasAccountInfoPwd','/nasCabLoginByToken','data','/reconnectRemote','nasAccountInfoConfigKey','nasDdnsRestart','../../db/dbNoticeCenterTable','nasRemoteEnable','../../db/dbUserTable','proxy.frpcExist','catch','stream','isAdmin','FRPC\x20download\x20exception','crt','../utils/nasAccountUtils','info','deleteByTitle','ddnsType','ipv6addressNotFound','10JLDhjC','json','nasDdnsEnable','FRPC\x20download\x20finish','1512IVhMaB','../../myConfig/urlConfig','10083neNTHK','FRPC\x20download\x20error','/getNasAccountInfo','proxy.frpcDownloaded','existsSync','/downloadFrpc','findByTitle','9109024ncnVyf','send','serverRootPath','/setDdnsEnable','Router','ipv4','pageUrl_contact_us','httpsKey','body','../utils/cryptoUtils','/setUseNasCabCert','getVipInfo','pageUrl_login','msg','pageUrl_ddns_set_subdomain','pageUrl_buy_vip','nasDdnsState','vipType','4316418SolGON','proxyServerList'];_0x4e39=function(){return _0x3d41ab;};return _0x4e39();}let config=require(_0x12de17(0x1d2)),dbConfigTable=require(_0x12de17(0x1f7)),dbNoticeCenterTable=require(_0x12de17(0x20d)),cryptoUtils=require(_0x12de17(0x1c7)),nasAccountUtil=require(_0x12de17(0x216));const dbUserTable=require(_0x12de17(0x20f)),fs=require('fs');let axios=require(_0x12de17(0x1f2));const urlConfig=require(_0x12de17(0x1b6));router['post'](_0x12de17(0x1d4),(_0x5a6039,_0x3bf939,_0x18948f)=>{const _0x1a3c18=_0x12de17;if(dbUserTable[_0x1a3c18(0x213)](_0x5a6039,_0x3bf939)!==!![])return;let _0x3a933a=dbConfigTable[_0x1a3c18(0x1bd)](_0x5a6039[_0x1a3c18(0x1e4)][_0x1a3c18(0x1ec)],'nasDdnsState');return _0x3bf939['json']({'code':0x0,'ddnsState':_0x3a933a?JSON[_0x1a3c18(0x1dd)](_0x3a933a['value']):''});}),router[_0x12de17(0x1dc)](_0x12de17(0x1c1),(_0x474454,_0x1f729e,_0xf85b5f)=>{const _0x5337be=_0x12de17;if(dbUserTable['isAdmin'](_0x474454,_0x1f729e)!==!![])return;let _0x3bf92c=_0x474454[_0x5337be(0x1c6)][_0x5337be(0x1b3)];if(_0x3bf92c==0x0||_0x3bf92c==0x1)return dbConfigTable[_0x5337be(0x1fe)](_0x474454[_0x5337be(0x1e4)][_0x5337be(0x1ec)],{'title':_0x5337be(0x1b3),'value':_0x3bf92c+''}),process[_0x5337be(0x1bf)]({'type':_0x5337be(0x20c)}),_0x1f729e[_0x5337be(0x1b2)]({'code':0x0});});function _0x47cd(_0x5334a7,_0x500013){const _0x4e39f8=_0x4e39();return _0x47cd=function(_0x47cdf2,_0x500868){_0x47cdf2=_0x47cdf2-0x1af;let _0x176276=_0x4e39f8[_0x47cdf2];return _0x176276;},_0x47cd(_0x5334a7,_0x500013);}function saveConfig(_0x12896b,_0x407f83,_0x3a539e){const _0x1c6a79=_0x12de17;dbConfigTable[_0x1c6a79(0x1fe)](_0x12896b,{'title':_0x407f83,'value':_0x3a539e+''});}function saveNasCabHttpsCerts(_0x236032,_0x5c13d3){const _0x3b98f9=_0x12de17;let _0x2a8410=dbConfigTable[_0x3b98f9(0x1bd)](_0x236032,config['nasAccountInfoConfigKey']);if(!_0x2a8410){if(_0x5c13d3)return _0x5c13d3['json']({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}cryptoUtils[_0x3b98f9(0x205)](config[_0x3b98f9(0x207)],_0x2a8410[_0x3b98f9(0x1f4)])['then'](_0x502800=>{const _0x43c4d9=_0x3b98f9;let _0x2219f4=JSON['parse'](_0x502800),_0x54919d=_0x2219f4['userInfo'];_0x54919d[_0x43c4d9(0x202)]&&_0x54919d[_0x43c4d9(0x202)]['length']>0x0&&(userToken=_0x54919d[_0x43c4d9(0x202)][_0x54919d[_0x43c4d9(0x202)]['length']-0x1]);if(!userToken){if(_0x5c13d3)return _0x5c13d3[_0x43c4d9(0x1b2)]({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}let _0x4d4ed1={'token':userToken,'type':_0x43c4d9(0x1e5)};axios['post'](urlConfig[_0x43c4d9(0x1e7)](_0x236032,_0x43c4d9(0x1eb)),_0x4d4ed1)[_0x43c4d9(0x1d5)](_0x164011=>{const _0x3f67a3=_0x43c4d9;if(_0x164011[_0x3f67a3(0x209)][_0x3f67a3(0x1fc)]){if(_0x5c13d3)return _0x5c13d3[_0x3f67a3(0x1b2)]({'code':0x1,'message':_0x164011[_0x3f67a3(0x209)][_0x3f67a3(0x1cb)]});}else{saveConfig(_0x236032,_0x3f67a3(0x1c5),_0x164011[_0x3f67a3(0x209)][_0x3f67a3(0x1d9)]),saveConfig(_0x236032,'httpsCert',_0x164011[_0x3f67a3(0x209)][_0x3f67a3(0x215)]);if(_0x5c13d3)return _0x5c13d3[_0x3f67a3(0x1b2)]({'code':0x0});}})[_0x43c4d9(0x211)](_0xd4c302=>{const _0x19ba2e=_0x43c4d9;if(_0x5c13d3)return _0x5c13d3[_0x19ba2e(0x1b2)]({'code':0x1,'message':_0x5c13d3['__'](_0x19ba2e(0x1d7))});});})[_0x3b98f9(0x211)](_0xcc278d=>{const _0x1f6b8a=_0x3b98f9;console[_0x1f6b8a(0x1e1)](_0xcc278d),dbConfigTable['deleteByTitle'](dbOther,config[_0x1f6b8a(0x20b)]);});}router[_0x12de17(0x1dc)](_0x12de17(0x1c8),(_0x531660,_0x32ac34,_0x598955)=>{const _0x24560e=_0x12de17;if(dbUserTable[_0x24560e(0x213)](_0x531660,_0x32ac34)!==!![])return;let _0x2a703b=_0x531660[_0x24560e(0x1c6)][_0x24560e(0x1ee)];if(_0x2a703b==0x0||_0x2a703b==0x1){saveConfig(_0x531660[_0x24560e(0x1e4)][_0x24560e(0x1ec)],_0x24560e(0x1ee),_0x2a703b+'');if(_0x2a703b==0x1)saveNasCabHttpsCerts(_0x531660[_0x24560e(0x1e4)][_0x24560e(0x1ec)],_0x32ac34);else return saveConfig(_0x531660[_0x24560e(0x1e4)][_0x24560e(0x1ec)],_0x24560e(0x1c5),''),saveConfig(_0x531660[_0x24560e(0x1e4)][_0x24560e(0x1ec)],'httpsCert',''),_0x32ac34['json']({'code':0x0});}else return _0x32ac34[_0x24560e(0x1b2)]({'code':0x1});}),router['post']('/setDdnsType',(_0x5a6394,_0x365eec,_0x5dcf4a)=>{const _0x418d91=_0x12de17;if(dbUserTable[_0x418d91(0x213)](_0x5a6394,_0x365eec)!==!![])return;let _0x254e28=_0x5a6394['body']['ddnsType'];if(_0x254e28!=_0x418d91(0x1c3)&&_0x254e28!=_0x418d91(0x1e2))return _0x365eec[_0x418d91(0x1b2)]({'code':0x1});if(_0x254e28==_0x418d91(0x1e2)){let _0x3e901a='';try{let _0x5ecd3d=dbConfigTable[_0x418d91(0x1bd)](_0x5a6394[_0x418d91(0x1e4)][_0x418d91(0x1ec)],_0x418d91(0x1d3));_0x5ecd3d&&(_0x5ecd3d=JSON[_0x418d91(0x1dd)](_0x5ecd3d[_0x418d91(0x1f4)]));for(let _0x21512d in _0x5ecd3d){if(_0x5ecd3d[_0x21512d][_0x418d91(0x1da)]==_0x418d91(0x1e2)){_0x3e901a=_0x5ecd3d[_0x21512d]['ip'];break;}}}catch(_0x584698){console[_0x418d91(0x1e1)](_0x584698);}if(!_0x3e901a)return _0x5a6394[_0x418d91(0x1e4)][_0x418d91(0x1f1)](_0x365eec,_0x365eec['__'](_0x418d91(0x1b0)));}return dbConfigTable[_0x418d91(0x1fe)](_0x5a6394[_0x418d91(0x1e4)][_0x418d91(0x1ec)],{'title':_0x418d91(0x1af),'value':_0x254e28}),process[_0x418d91(0x1bf)]({'type':_0x418d91(0x20c)}),_0x365eec[_0x418d91(0x1b2)]({'code':0x0});}),router[_0x12de17(0x1dc)](_0x12de17(0x1e9),(_0x430fc0,_0x3d2edb,_0x34ff96)=>{const _0x4ef303=_0x12de17;let _0x5f2c58={'code':0x0};nasAccountUtil[_0x4ef303(0x1c9)](_0x430fc0[_0x4ef303(0x1e4)][_0x4ef303(0x1ec)])['then'](_0x47a0b4=>{const _0x1410b2=_0x4ef303;return _0x47a0b4==![]?_0x5f2c58[_0x1410b2(0x1cf)]=0x0:_0x5f2c58[_0x1410b2(0x1cf)]=_0x47a0b4[_0x1410b2(0x1da)],_0x3d2edb[_0x1410b2(0x1b2)](_0x5f2c58);})[_0x4ef303(0x211)](_0x241403=>{const _0x4e4cfd=_0x4ef303;return _0x5f2c58['vipType']=0x0,_0x3d2edb[_0x4e4cfd(0x1b2)](_0x5f2c58);});}),router[_0x12de17(0x1dc)](_0x12de17(0x1b9),(_0x475593,_0x3ba636,_0x74957d)=>{const _0x2456d2=_0x12de17;let _0x2be568=dbConfigTable[_0x2456d2(0x1bd)](_0x475593['app']['dbOther'],config[_0x2456d2(0x20b)]),_0x2feec5=dbConfigTable[_0x2456d2(0x1bd)](_0x475593['app'][_0x2456d2(0x1ec)],_0x2456d2(0x1ce)),_0x2f21eb=dbConfigTable[_0x2456d2(0x1bd)](_0x475593[_0x2456d2(0x1e4)]['dbOther'],'nasDdnsEnable'),_0xc883d2=dbConfigTable[_0x2456d2(0x1bd)](_0x475593[_0x2456d2(0x1e4)][_0x2456d2(0x1ec)],_0x2456d2(0x20e)),_0xc8ff91={'pageUrl_login':urlConfig[_0x2456d2(0x1e7)](_0x475593[_0x2456d2(0x1e4)]['dbOther'],'pageUrl_login'),'pageUrl_contact_us':urlConfig[_0x2456d2(0x1e7)](_0x475593[_0x2456d2(0x1e4)]['dbOther'],'pageUrl_contact_us'),'pageUrl_marketing':urlConfig[_0x2456d2(0x1e7)](_0x475593[_0x2456d2(0x1e4)]['dbOther'],'pageUrl_marketing'),'pageUrl_buy_vip':urlConfig[_0x2456d2(0x1e7)](_0x475593[_0x2456d2(0x1e4)][_0x2456d2(0x1ec)],_0x2456d2(0x1cd))};if(_0x2be568)cryptoUtils['decryptString'](config[_0x2456d2(0x207)],_0x2be568[_0x2456d2(0x1f4)])[_0x2456d2(0x1d5)](_0x13b7f5=>{const _0x3c3a3c=_0x2456d2;return _0x3ba636[_0x3c3a3c(0x1b2)]({'code':0x0,'data':JSON[_0x3c3a3c(0x1dd)](_0x13b7f5),'nasDdnsState':_0x2feec5?JSON[_0x3c3a3c(0x1dd)](_0x2feec5[_0x3c3a3c(0x1f4)]):'','nasDdnsEnable':_0x2f21eb?_0x2f21eb['value']:0x0,'nasRemoteEnable':_0xc883d2?_0xc883d2[_0x3c3a3c(0x1f4)]:0x0,'pagesUrl':_0xc8ff91});})['catch'](_0x5240b6=>{const _0x2f1b0e=_0x2456d2;return console[_0x2f1b0e(0x1e1)](_0x5240b6),dbConfigTable[_0x2f1b0e(0x218)](_0x475593[_0x2f1b0e(0x1e4)][_0x2f1b0e(0x1ec)],config[_0x2f1b0e(0x20b)]),_0x3ba636[_0x2f1b0e(0x1b2)]({'code':0x0,'data':'','pagesUrl':_0xc8ff91});});else return _0x3ba636['json']({'code':0x0,'data':'','pagesUrl':_0xc8ff91});}),router[_0x12de17(0x1dc)](_0x12de17(0x208),(_0x1c3c97,_0x109fa7,_0x28f36a)=>{const _0x4ad34a=_0x12de17;let _0x25c79a=_0x1c3c97[_0x4ad34a(0x1c6)]['nascabToken'];if(!_0x25c79a)return _0x1c3c97[_0x4ad34a(0x1e4)][_0x4ad34a(0x1f1)](_0x109fa7,_0x4ad34a(0x1fa));console[_0x4ad34a(0x1e1)]('nasCabLoginByToken',_0x25c79a);if(dbUserTable[_0x4ad34a(0x213)](_0x1c3c97,_0x109fa7)!==!![])return;nasAccountUtil[_0x4ad34a(0x1fb)](_0x1c3c97[_0x4ad34a(0x1e4)][_0x4ad34a(0x1ec)],_0x25c79a,()=>{const _0x255698=_0x4ad34a;return process['send']({'type':_0x255698(0x1ed)}),_0x109fa7['json']({'code':0x0});},()=>{const _0xfe8d34=_0x4ad34a;return _0x1c3c97['app'][_0xfe8d34(0x1f1)](_0x109fa7,_0x109fa7['__'](_0xfe8d34(0x1df)));});}),router[_0x12de17(0x1dc)](_0x12de17(0x1fd),(_0x43f757,_0x2ad4a1,_0x2aa1fd)=>{const _0x4b13ea=_0x12de17;if(dbUserTable[_0x4b13ea(0x213)](_0x43f757,_0x2ad4a1)!==!![])return;return dbConfigTable[_0x4b13ea(0x218)](_0x43f757['app'][_0x4b13ea(0x1ec)],config[_0x4b13ea(0x20b)]),process[_0x4b13ea(0x1bf)]({'type':_0x4b13ea(0x1de)}),_0x2ad4a1['json']({'code':0x0,'data':''});}),router[_0x12de17(0x1dc)](_0x12de17(0x20a),(_0x1407ec,_0xe08d36,_0x1ea76e)=>{const _0x3dc7c7=_0x12de17;if(dbUserTable[_0x3dc7c7(0x213)](_0x1407ec,_0xe08d36)!==!![])return;let _0x1f2c51=_0x1407ec[_0x3dc7c7(0x1c6)]['serverId'];return process[_0x3dc7c7(0x1bf)]({'type':_0x3dc7c7(0x204),'serverId':_0x1f2c51}),_0xe08d36[_0x3dc7c7(0x1b2)]({'code':0x0});}),router[_0x12de17(0x1dc)]('/getProxyState',(_0x27f2b1,_0x141c76,_0x3ebe40)=>{const _0x3b4f50=_0x12de17;if(dbUserTable[_0x3b4f50(0x213)](_0x27f2b1,_0x141c76)!==!![])return;let _0x4700bf=fs['existsSync'](config['frpcPath']),_0x39e5f2=dbConfigTable['findByTitle'](_0x27f2b1['app'][_0x3b4f50(0x1ec)],_0x3b4f50(0x1db)),_0x5aa1df=dbConfigTable[_0x3b4f50(0x1bd)](_0x27f2b1[_0x3b4f50(0x1e4)]['dbOther'],_0x3b4f50(0x1d1)),_0x37f354=dbConfigTable[_0x3b4f50(0x1bd)](_0x27f2b1[_0x3b4f50(0x1e4)][_0x3b4f50(0x1ec)],_0x3b4f50(0x1c0));return _0x141c76[_0x3b4f50(0x1b2)]({'code':0x0,'serverRootPath':_0x37f354?_0x37f354[_0x3b4f50(0x1f4)]:'','proxyState':_0x39e5f2?JSON[_0x3b4f50(0x1dd)](_0x39e5f2['value']):'','pluginExists':_0x4700bf,'pluginPath':config[_0x3b4f50(0x200)],'proxyServerList':_0x5aa1df?_0x5aa1df[_0x3b4f50(0x1f4)]:'[]'});}),router['post'](_0x12de17(0x1bc),(_0x3f2429,_0x36b45e,_0x1e18ed)=>{const _0x2a7b14=_0x12de17;if(dbUserTable['isAdmin'](_0x3f2429,_0x36b45e)!==!![])return;if(fs[_0x2a7b14(0x1bb)](config[_0x2a7b14(0x200)]))return _0x3f2429['app'][_0x2a7b14(0x1f1)](_0x36b45e,_0x36b45e['__'](_0x2a7b14(0x210)));return downloadFrpc(_0x3f2429,_0x36b45e),_0x36b45e['json']({'code':0x0});});function downloadFrpc(_0x293801,_0x1c7b30){const _0x1802cb=_0x12de17;!fs['existsSync'](config[_0x1802cb(0x203)])&&fs[_0x1802cb(0x1e3)](config[_0x1802cb(0x203)],{'recursive':!![]}),axios({'url':urlConfig[_0x1802cb(0x1e7)](_0x293801['app'][_0x1802cb(0x1ec)],_0x1802cb(0x1f8)),'method':'GET','responseType':_0x1802cb(0x212)})[_0x1802cb(0x1d5)](_0x420535=>{const _0x232baf=_0x1802cb;let _0x3c1eb6=fs[_0x232baf(0x206)](config['frpcTempPath']);_0x420535[_0x232baf(0x209)][_0x232baf(0x1ea)](_0x3c1eb6),_0x3c1eb6['on'](_0x232baf(0x1f5),()=>{const _0x481a4a=_0x232baf;console[_0x481a4a(0x1e1)](_0x481a4a(0x1b4)),fs['renameSync'](config[_0x481a4a(0x201)],config[_0x481a4a(0x200)]),dbNoticeCenterTable[_0x481a4a(0x1fe)](_0x293801[_0x481a4a(0x1e4)]['dbOther'],{'title':_0x1c7b30['__'](_0x481a4a(0x1ba)),'level':_0x481a4a(0x217),'content':_0x1c7b30['__'](_0x481a4a(0x1ba))}),process[_0x481a4a(0x1bf)]({'type':'nasProxyRestart'});}),_0x3c1eb6['on']('error',_0x47ed0e=>{const _0x24619f=_0x232baf;console['log'](_0x24619f(0x1b8),_0x47ed0e);});})[_0x1802cb(0x211)](_0x4766c0=>{const _0x49f692=_0x1802cb;console[_0x49f692(0x1e1)](_0x49f692(0x214),_0x4766c0);});}router[_0x12de17(0x1dc)]('/setRemoteEnable',(_0x15bf99,_0x1270de,_0x328261)=>{const _0x1e5238=_0x12de17;if(dbUserTable[_0x1e5238(0x213)](_0x15bf99,_0x1270de)!==!![])return;let _0x24bc3b=_0x15bf99['body'][_0x1e5238(0x20e)];if(_0x24bc3b==0x0||_0x24bc3b==0x1)return dbConfigTable[_0x1e5238(0x1fe)](_0x15bf99[_0x1e5238(0x1e4)][_0x1e5238(0x1ec)],{'title':_0x1e5238(0x20e),'value':_0x24bc3b+''}),process[_0x1e5238(0x1bf)]({'type':_0x1e5238(0x204)}),_0x1270de['json']({'code':0x0});}),router[_0x12de17(0x1dc)](_0x12de17(0x1f9),(_0x5f45c8,_0x55acc8,_0x504f3b)=>{const _0x1e0d29=_0x12de17;return _0x55acc8['json']({'code':0x0,'pagesUrl':{'pageUrl_update_log':urlConfig[_0x1e0d29(0x1e7)](_0x5f45c8['app'][_0x1e0d29(0x1ec)],_0x1e0d29(0x1d8)),'pageUrl_agreement':urlConfig[_0x1e0d29(0x1e7)](_0x5f45c8[_0x1e0d29(0x1e4)][_0x1e0d29(0x1ec)],_0x1e0d29(0x1f6)),'pageUrl_privacy':urlConfig['getUrlByUrlKey'](_0x5f45c8[_0x1e0d29(0x1e4)][_0x1e0d29(0x1ec)],_0x1e0d29(0x1e6)),'pageUrl_login':urlConfig[_0x1e0d29(0x1e7)](_0x5f45c8[_0x1e0d29(0x1e4)][_0x1e0d29(0x1ec)],_0x1e0d29(0x1ca)),'pageUrl_ddns_set_subdomain':urlConfig[_0x1e0d29(0x1e7)](_0x5f45c8[_0x1e0d29(0x1e4)][_0x1e0d29(0x1ec)],_0x1e0d29(0x1cc)),'pageUrl_ddns_set_subdomain_nat':urlConfig[_0x1e0d29(0x1e7)](_0x5f45c8['app'][_0x1e0d29(0x1ec)],_0x1e0d29(0x1e8)),'pageUrl_contact_us':urlConfig['getUrlByUrlKey'](_0x5f45c8[_0x1e0d29(0x1e4)][_0x1e0d29(0x1ec)],_0x1e0d29(0x1c4)),'pageUrl_marketing':urlConfig['getUrlByUrlKey'](_0x5f45c8[_0x1e0d29(0x1e4)][_0x1e0d29(0x1ec)],'pageUrl_marketing'),'pageUrl_buy_vip':urlConfig[_0x1e0d29(0x1e7)](_0x5f45c8[_0x1e0d29(0x1e4)][_0x1e0d29(0x1ec)],_0x1e0d29(0x1cd))}});}),module['exports']=router;