const _0x3da14a=_0x2105;(function(_0x45679b,_0x5cd276){const _0x1a17e3=_0x2105,_0x8298f0=_0x45679b();while(!![]){try{const _0x2831a3=parseInt(_0x1a17e3(0x15c))/0x1*(parseInt(_0x1a17e3(0x1e8))/0x2)+-parseInt(_0x1a17e3(0x16d))/0x3+-parseInt(_0x1a17e3(0x135))/0x4*(parseInt(_0x1a17e3(0x112))/0x5)+-parseInt(_0x1a17e3(0x177))/0x6+-parseInt(_0x1a17e3(0x145))/0x7*(parseInt(_0x1a17e3(0x14d))/0x8)+parseInt(_0x1a17e3(0x1ec))/0x9*(-parseInt(_0x1a17e3(0x1f2))/0xa)+parseInt(_0x1a17e3(0x105))/0xb*(parseInt(_0x1a17e3(0x14c))/0xc);if(_0x2831a3===_0x5cd276)break;else _0x8298f0['push'](_0x8298f0['shift']());}catch(_0x405d37){_0x8298f0['push'](_0x8298f0['shift']());}}}(_0x394b,0x9566b));var express=require(_0x3da14a(0xd1)),router=express['Router']();let path=require(_0x3da14a(0x124));const dbFileIndexTable=require(_0x3da14a(0xc5)),dbUserTable=require('../../db/dbUserTable');var fs=require('fs');let sha256=require('sha256');function _0x2105(_0x182116,_0x5ed8b8){const _0x394b03=_0x394b();return _0x2105=function(_0x21058b,_0x43f0ef){_0x21058b=_0x21058b-0x9b;let _0xe56407=_0x394b03[_0x21058b];return _0xe56407;},_0x2105(_0x182116,_0x5ed8b8);}const dbConfigTable=require(_0x3da14a(0x14e)),dbSourceFolderTable=require(_0x3da14a(0x1ee)),nfoUtil=require(_0x3da14a(0xe1)),dbMovieFavorite=require(_0x3da14a(0x165)),movieUtil=require(_0x3da14a(0x19f));let fileUtil=require(_0x3da14a(0x149));const sqliteUtil=require(_0x3da14a(0x163)),photoApiUtils=require(_0x3da14a(0xb2));let movieSeasonUtil=require(_0x3da14a(0x143)),movieInfoUtil=require(_0x3da14a(0x155));const dbScanTaskTable=require(_0x3da14a(0xcf));let movieFieldStr=_0x3da14a(0x12d);function getTvSeriesPoster(_0x373acf){const _0x1297ba=_0x3da14a;let _0xfe1f7c='',_0x40f141=path[_0x1297ba(0x10a)](path[_0x1297ba(0xb7)](_0x373acf[_0x1297ba(0x124)]),_0x1297ba(0x150));return fs[_0x1297ba(0xea)](_0x40f141)&&(_0xfe1f7c=_0x40f141),!_0xfe1f7c&&(_0x40f141=path[_0x1297ba(0x10a)](path[_0x1297ba(0xb7)](_0x373acf[_0x1297ba(0x124)]),'poster.jpeg'),fs[_0x1297ba(0xea)](_0x40f141)&&(_0xfe1f7c=_0x40f141)),!_0xfe1f7c&&(_0x40f141=path[_0x1297ba(0x10a)](path['dirname'](_0x373acf[_0x1297ba(0x124)]),_0x1297ba(0xf3)),fs[_0x1297ba(0xea)](_0x40f141)&&(_0xfe1f7c=_0x40f141)),!_0xfe1f7c&&(_0x40f141=path[_0x1297ba(0x10a)](path[_0x1297ba(0xb7)](_0x373acf[_0x1297ba(0x124)]),_0x1297ba(0x1a1)),fs['existsSync'](_0x40f141)&&(_0xfe1f7c=_0x40f141)),_0xfe1f7c;}router[_0x3da14a(0xb8)](_0x3da14a(0x133),(_0x5428ff,_0x4d8113,_0x5cf292)=>{const _0x548aff=_0x3da14a;let _0x5cfb64=_0x5428ff[_0x548aff(0x1f6)]['id'],_0x20f187=dbFileIndexTable[_0x548aff(0x1bc)](_0x5428ff[_0x548aff(0xba)][_0x548aff(0x1cd)],_0x5cfb64,dbFileIndexTable[_0x548aff(0x9b)]);if(!_0x20f187)return _0x5428ff[_0x548aff(0xba)][_0x548aff(0x138)](_0x4d8113,_0x4d8113['__'](_0x548aff(0x13b)));if(dbUserTable[_0x548aff(0xdb)](_0x5428ff,_0x4d8113,_0x548aff(0x192),'power_get',_0x20f187['path'])==!![]){nfoUtil[_0x548aff(0x1d0)](_0x20f187)[_0x548aff(0xdc)](_0x1beaf6=>{const _0x1c79c0=_0x548aff;_0x20f187=_0x1beaf6,_0x5428ff[_0x1c79c0(0x1f6)][_0x1c79c0(0x117)]=!![],_0x5428ff[_0x1c79c0(0x1f6)][_0x1c79c0(0x1ac)]=0x1,_0x20f187=addFolderCoverPath(_0x4d8113,_0x5428ff,_0x20f187),_0xf04df5();})[_0x548aff(0x1f5)](_0x44a554=>{const _0x182a87=_0x548aff;console[_0x182a87(0xfa)]('未找到NFO信息',_0x44a554),_0x20f187=addFolderCoverPath(_0x4d8113,_0x5428ff,_0x20f187),_0x20f187[_0x182a87(0x176)]=_0x20f187[_0x182a87(0x1c7)],_0xf04df5();});function _0xf04df5(){const _0x34a199=_0x548aff;addTvFolderPathAndName(_0x20f187),setLogoAndFanart(_0x5428ff,_0x20f187,_0x20f187['tvFolderPath']);let _0x13830d=dbMovieFavorite[_0x34a199(0x1b2)](_0x5428ff['app']['dbFileIndex'],_0x5428ff[_0x34a199(0x18c)]['id'],_0x20f187['id']);_0x13830d?_0x20f187[_0x34a199(0x140)]=0x1:_0x20f187[_0x34a199(0x140)]=0x0;let _0x4649eb={'code':0x0,'movieIndex':_0x20f187};fs['stat'](_0x20f187['tvFolderPath'],(_0x42ba13,_0x5bcce5)=>{const _0x46c9f9=_0x34a199;_0x4649eb[_0x46c9f9(0x188)]=_0x42ba13?0x0:0x1,_0x4d8113['json'](_0x4649eb),_0x20f187[_0x46c9f9(0x103)]==0x1&&_0x20f187[_0x46c9f9(0x18e)]&&(dbScanTaskTable[_0x46c9f9(0x147)](_0x5428ff[_0x46c9f9(0xba)]['dbOther'],'movie',_0x20f187['tvFolderPath']),process[_0x46c9f9(0x12f)]({'type':_0x46c9f9(0x1ef),'source_type':'movie','restartWatcher':![]}));});}}}),router[_0x3da14a(0xb8)]('/getMovieDetail',(_0x336b91,_0xbc32b,_0x510439)=>{const _0x422e8d=_0x3da14a;let _0xa46c91=_0x336b91[_0x422e8d(0x1f6)]['id'],_0x2630d3=dbFileIndexTable[_0x422e8d(0x1bc)](_0x336b91[_0x422e8d(0xba)][_0x422e8d(0x1cd)],_0xa46c91,dbFileIndexTable[_0x422e8d(0x9b)]);if(!_0x2630d3)return _0x336b91[_0x422e8d(0xba)][_0x422e8d(0x138)](_0xbc32b,_0xbc32b['__']('index.videoInfoReadFail'));if(dbUserTable[_0x422e8d(0xdb)](_0x336b91,_0xbc32b,_0x422e8d(0x192),_0x422e8d(0x19c),_0x2630d3['path'])==!![]){nfoUtil[_0x422e8d(0x179)](_0x2630d3,!![],![])['then'](_0x5ddc3e=>{const _0xe43da5=_0x422e8d;_0x2630d3=_0x5ddc3e,_0x336b91[_0xe43da5(0x1f6)][_0xe43da5(0x117)]=!![],_0x2630d3=addFolderCoverPath(_0xbc32b,_0x336b91,_0x2630d3),movieInfoUtil[_0xe43da5(0xca)](_0x336b91[_0xe43da5(0xba)]['dbFileIndex'],_0x2630d3['id'],_0x5ddc3e),_0x46762d();})['catch'](()=>{_0x2630d3=addFolderCoverPath(_0xbc32b,_0x336b91,_0x2630d3),_0x46762d();});function _0x46762d(){const _0x721b4a=_0x422e8d;let _0x3d4549=dbMovieFavorite[_0x721b4a(0x1b2)](_0x336b91['app']['dbFileIndex'],_0x336b91[_0x721b4a(0x18c)]['id'],_0x2630d3['id']);_0x3d4549?_0x2630d3[_0x721b4a(0x140)]=0x1:_0x2630d3[_0x721b4a(0x140)]=0x0;let _0x288b22=null;if(_0x2630d3[_0x721b4a(0x103)]==0x1){let _0x55572e=_0x336b91[_0x721b4a(0xba)][_0x721b4a(0x1cd)][_0x721b4a(0xe3)](_0x721b4a(0x1c3)+dbFileIndexTable[_0x721b4a(0x9b)]+_0x721b4a(0x1b8))[_0x721b4a(0xa7)](_0x2630d3[_0x721b4a(0x124)]),_0x46fb51='(';for(let _0x55c3c5 in _0x55572e){_0x46fb51+=_0x55572e[_0x55c3c5]['id'],_0x55c3c5!=_0x55572e[_0x721b4a(0x11c)]-0x1&&(_0x46fb51+=',');}_0x46fb51+=')';let _0x4905f9=_0x336b91[_0x721b4a(0xba)][_0x721b4a(0x1cd)][_0x721b4a(0xe3)]('SELECT\x20index_id\x20FROM\x20movie_history\x20where\x20index_id\x20in\x20'+_0x46fb51+_0x721b4a(0xb0))[_0x721b4a(0x15f)]();_0x4905f9&&(_0x288b22=dbFileIndexTable[_0x721b4a(0x1bc)](_0x336b91[_0x721b4a(0xba)][_0x721b4a(0x1cd)],_0x4905f9[_0x721b4a(0x1c8)],dbFileIndexTable[_0x721b4a(0x9b)]));}let _0x17a182={'code':0x0,'movieIndex':_0x2630d3,'lastTvEpisodeIndex':_0x288b22},_0x1a3082=[];try{let _0x2c91af=_0x336b91[_0x721b4a(0xba)]['dbFileIndex'][_0x721b4a(0xe3)](_0x721b4a(0x1eb)+_0x2630d3[_0x721b4a(0x124)]+'\x27\x20and\x20type=1\x20and\x20is_file=1\x20limit\x2020')['all']();for(let _0x39b3de in _0x2c91af){let _0x128f41=path[_0x721b4a(0x10a)](_0x2c91af[_0x39b3de][_0x721b4a(0x124)],_0x2c91af[_0x39b3de][_0x721b4a(0x162)]);(_0x336b91[_0x721b4a(0x18c)][_0x721b4a(0x118)]==0x1||dbUserTable[_0x721b4a(0xdb)](_0x336b91,_0xbc32b,_0x721b4a(0x101),_0x721b4a(0x19c),_0x128f41,!![])==!![])&&_0x1a3082[_0x721b4a(0x122)](_0x128f41);}_0x17a182[_0x721b4a(0x1b4)]=_0x1a3082;}catch(_0x550537){}let _0x366249=path[_0x721b4a(0x10a)](_0x2630d3[_0x721b4a(0x124)],_0x2630d3[_0x721b4a(0x162)]);fs[_0x721b4a(0x1e9)](_0x366249,(_0x10ee65,_0x20cd6c)=>{const _0x331a5f=_0x721b4a;_0x17a182[_0x331a5f(0x188)]=_0x10ee65?0x0:0x1,_0x17a182[_0x331a5f(0x144)]=_0x366249,_0xbc32b[_0x331a5f(0x172)](_0x17a182),_0x2630d3[_0x331a5f(0x103)]==0x1&&_0x2630d3['tvFolderPath']&&_0x2630d3[_0x331a5f(0x183)]!=0x1&&(dbScanTaskTable[_0x331a5f(0x147)](_0x336b91[_0x331a5f(0xba)][_0x331a5f(0x1b0)],_0x331a5f(0x192),_0x2630d3['tvFolderPath']),process[_0x331a5f(0x12f)]({'type':_0x331a5f(0x1ef),'source_type':_0x331a5f(0x192),'restartWatcher':![]}));});}}}),router['post'](_0x3da14a(0x16b),(_0x18ddcf,_0x5b4db8,_0x653200)=>{const _0x5ef550=_0x3da14a;let _0x1ee1c9=_0x18ddcf[_0x5ef550(0x1f6)]['id'],_0x5010e0=_0x18ddcf['body'][_0x5ef550(0x152)]||0x0,_0x51ab64=_0x18ddcf[_0x5ef550(0x1f6)][_0x5ef550(0x164)]||0xa,_0x34eceb=_0x18ddcf[_0x5ef550(0x1f6)][_0x5ef550(0x153)],_0x1adf2a=_0x18ddcf['body'][_0x5ef550(0xc9)],_0x1d67e8=_0x18ddcf[_0x5ef550(0x1f6)][_0x5ef550(0x185)],_0x582de8=_0x18ddcf[_0x5ef550(0x1f6)][_0x5ef550(0x1c2)],_0x42ac58=dbFileIndexTable[_0x5ef550(0x1bc)](_0x18ddcf[_0x5ef550(0xba)][_0x5ef550(0x1cd)],_0x1ee1c9,dbFileIndexTable[_0x5ef550(0x9b)]);if(!_0x42ac58)return _0x18ddcf[_0x5ef550(0xba)]['returnErrMsg'](_0x5b4db8,_0x5b4db8['__'](_0x5ef550(0x13b)));let _0x517f86=movieFieldStr,_0x134dd6=[],_0x20eb67=0x0;if(dbUserTable['doUserCanGet'](_0x18ddcf,_0x5b4db8,_0x5ef550(0x192),_0x5ef550(0x19c),_0x42ac58[_0x5ef550(0x124)])==!![]){if(_0x1d67e8==0x1)return _0x39aff7();let _0x3a984b=_0x18ddcf['app'][_0x5ef550(0x1cd)][_0x5ef550(0xe3)](_0x5ef550(0x1a9)+dbFileIndexTable[_0x5ef550(0x9b)]+_0x5ef550(0xe2))[_0x5ef550(0xa7)](_0x42ac58[_0x5ef550(0x124)]);for(let _0x32c4a6 in _0x3a984b){let _0x5cb386=_0x3a984b[_0x32c4a6];if(_0x5cb386['filename']){let _0x49a015=movieUtil['getFilenameNumber'](_0x5cb386[_0x5ef550(0x162)]);_0x18ddcf[_0x5ef550(0xba)][_0x5ef550(0x1cd)][_0x5ef550(0xe3)](_0x5ef550(0x186)+dbFileIndexTable[_0x5ef550(0x9b)]+'\x20SET\x20filename_number=?\x20\x20WHERE\x20\x20id=?')[_0x5ef550(0x126)](_0x49a015,_0x5cb386['id']);}}let _0x594457=dbUserTable['getUserPathWhere'](_0x18ddcf,_0x5ef550(0x192),'power_get',!![]),_0xc840f4=[..._0x594457['paramsList']],_0x16a690=_0x5ef550(0x120);_0x16a690+=_0x594457[_0x5ef550(0x1b1)],_0x16a690+='\x20and\x20path=?\x20and\x20is_tvplay=1\x20',_0xc840f4[_0x5ef550(0x122)](_0x42ac58['path']);_0x34eceb&&(_0x16a690+=_0x5ef550(0x125),_0xc840f4[_0x5ef550(0x122)]('%'+_0x34eceb+'%','%'+_0x34eceb+'%'));if(_0x1adf2a){let _0x49a4e1=movieUtil[_0x5ef550(0x195)](_0x1adf2a);_0x49a4e1?(_0x16a690+=_0x5ef550(0xce),_0xc840f4[_0x5ef550(0x122)](_0x49a4e1)):(_0x16a690+='\x20and\x20filename\x20>=\x20?\x20',_0xc840f4['push'](_0x1adf2a));}let _0x421a9b=_0x16a690+'';_0x16a690+='\x20order\x20by\x20filename_number,filename';let _0x355e67=_0x5ef550(0x198)+_0x517f86+_0x5ef550(0x132)+dbFileIndexTable[_0x5ef550(0x9b)]+'\x20as\x20f\x20WHERE\x20'+_0x16a690+_0x5ef550(0xa1)+_0x51ab64+_0x5ef550(0xc6)+_0x5010e0*_0x51ab64;_0x134dd6=_0x18ddcf[_0x5ef550(0xba)]['dbFileIndex']['prepare'](_0x355e67)[_0x5ef550(0xa7)](_0xc840f4);let _0x134a09=_0x5ef550(0xfc)+dbFileIndexTable[_0x5ef550(0x9b)]+'\x20\x20WHERE\x20'+_0x421a9b+'\x20',_0x40a07c=_0x18ddcf['app']['dbFileIndex'][_0x5ef550(0xe3)](_0x134a09)[_0x5ef550(0x15f)](_0xc840f4);_0x20eb67=_0x40a07c[_0x5ef550(0x136)];if(_0x134dd6[_0x5ef550(0x11c)]>0x0){let _0x6a522b=0x0;for(let _0x2b953b in _0x134dd6){let _0x20082a=_0x134dd6[_0x2b953b];nfoUtil[_0x5ef550(0x179)](_0x20082a,!![],!![])[_0x5ef550(0xdc)](_0x3b31dd=>{_0x6a522b+=0x1,_0x134dd6[_0x2b953b]=_0x3b31dd,_0x134dd6[_0x2b953b]=addFolderCoverPath(_0x5b4db8,_0x18ddcf,_0x134dd6[_0x2b953b],!![]),_0x6a522b>=_0x134dd6['length']&&_0x39aff7();})[_0x5ef550(0x1f5)](()=>{_0x6a522b+=0x1,_0x134dd6[_0x2b953b]=addFolderCoverPath(_0x5b4db8,_0x18ddcf,_0x134dd6[_0x2b953b],!![]),_0x6a522b>=_0x134dd6['length']&&_0x39aff7();});}}else _0x39aff7();function _0x39aff7(){const _0x3cb7be=_0x5ef550;let _0x29796b={'code':0x0,'tvplayList':_0x134dd6,'count':_0x20eb67,'pageSize':_0x51ab64};if(!_0x582de8){let _0x3046d5=path['basename'](_0x42ac58[_0x3cb7be(0x124)]),_0x4bf41b=movieSeasonUtil['getSeasonNumber'](_0x3046d5);if(_0x4bf41b>-0x1){let _0x202303=_0x3cb7be(0x198)+_0x517f86+_0x3cb7be(0x132)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x3cb7be(0x1bd),_0x42ac51=_0x18ddcf[_0x3cb7be(0xba)]['dbFileIndex'][_0x3cb7be(0xe3)](_0x202303)[_0x3cb7be(0xa7)](path['dirname'](_0x42ac58[_0x3cb7be(0x124)])+path[_0x3cb7be(0x154)]+'%'),_0x55350e=[];for(let _0x2588dc of _0x42ac51){let _0x322c68=path[_0x3cb7be(0xc3)](_0x2588dc[_0x3cb7be(0x124)]),_0x3b37f0=movieSeasonUtil[_0x3cb7be(0x1c4)](_0x322c68);_0x3b37f0>-0x1&&(_0x2588dc[_0x3cb7be(0x102)]=_0x3b37f0,_0x55350e[_0x3cb7be(0x122)](_0x2588dc));}for(let _0x1348c3 of _0x55350e){_0x1348c3=addFolderCoverPath(_0x5b4db8,_0x18ddcf,_0x1348c3);let _0x21dbdf=dbFileIndexTable[_0x3cb7be(0x123)](_0x18ddcf['app']['dbFileIndex'],_0x1348c3);_0x1348c3[_0x3cb7be(0x139)]=_0x21dbdf[_0x3cb7be(0x136)];}_0x55350e[_0x3cb7be(0x11c)]>0x0&&(_0x55350e['sort'](function(_0x1cdbbd,_0x4bcd32){return _0x1cdbbd['seasonNumber']-_0x4bcd32['seasonNumber'];}),_0x29796b[_0x3cb7be(0x142)]=_0x55350e);}}return _0x5b4db8[_0x3cb7be(0x172)](_0x29796b);}}}),router[_0x3da14a(0xb8)](_0x3da14a(0xa9),(_0x1fdcd3,_0x28b4fd,_0x37f650)=>{const _0x870b3e=_0x3da14a;let _0x4b35a8=_0x1fdcd3[_0x870b3e(0x1f6)][_0x870b3e(0x1af)],_0x5300c9=[];for(let _0x3e4823 of _0x4b35a8){let _0x48e378=dbFileIndexTable[_0x870b3e(0x1bc)](_0x1fdcd3[_0x870b3e(0xba)]['dbFileIndex'],_0x3e4823,dbFileIndexTable[_0x870b3e(0x9b)]);if(!_0x48e378)continue;if(dbUserTable[_0x870b3e(0xdb)](_0x1fdcd3,_0x28b4fd,'',_0x870b3e(0x197),_0x48e378['path'])!==!![])continue;let _0x785811=path[_0x870b3e(0xc3)](_0x48e378['path']),_0x163aec=movieSeasonUtil[_0x870b3e(0x1c4)](_0x785811);if(_0x163aec>-0x1){let _0x6de46b=path[_0x870b3e(0x10a)](path[_0x870b3e(0xb7)](_0x48e378[_0x870b3e(0x124)])),_0x4fd277=_0x1fdcd3[_0x870b3e(0xba)]['dbFileIndex'][_0x870b3e(0xe3)](_0x870b3e(0x182))[_0x870b3e(0xa7)](_0x6de46b+path['sep']+'%',_0x6de46b);for(let _0x5a42f0 of _0x4fd277){_0x5300c9[_0x870b3e(0x122)](_0x5a42f0['id']);}}}_0x5300c9[_0x870b3e(0x11c)]>0x0&&(_0x4b35a8=[..._0x4b35a8,..._0x5300c9]);if(_0x4b35a8[_0x870b3e(0x11c)]<0x1)return _0x28b4fd[_0x870b3e(0x172)]({'code':0x0});let _0xd2401='(';for(let _0x10d443 in _0x4b35a8){_0xd2401+=_0x4b35a8[_0x10d443],_0x10d443!=_0x4b35a8[_0x870b3e(0x11c)]-0x1&&(_0xd2401+=',');}return _0xd2401+=')',_0x1fdcd3['app'][_0x870b3e(0x1cd)][_0x870b3e(0xe3)](_0x870b3e(0xe4)+_0xd2401)[_0x870b3e(0x126)](),_0x28b4fd[_0x870b3e(0x172)]({'code':0x0});}),router['post']('/addIndexToCollection',(_0x12d73a,_0x1f198d,_0x1db257)=>{const _0xd336af=_0x3da14a;let _0x395156=_0x12d73a[_0xd336af(0x1f6)][_0xd336af(0x1d1)],_0x405a85=_0x12d73a[_0xd336af(0x1f6)][_0xd336af(0x131)],_0x29482f=_0x12d73a['body']['filepath'];function _0x47e996(_0x307468){const _0x24868f=_0xd336af;let _0x51f13f=[];for(let _0x94d306 in _0x307468){_0x51f13f[_0x24868f(0x122)](_0x307468[_0x94d306]['id']);}inSql='(';for(let _0x22ef3c in _0x51f13f){inSql+=_0x51f13f[_0x22ef3c],_0x22ef3c!=_0x51f13f[_0x24868f(0x11c)]-0x1&&(inSql+=',');}return inSql+=')',inSql;}if(_0x395156&&_0x405a85){let _0x50a614=dbFileIndexTable['getById'](_0x12d73a[_0xd336af(0xba)]['dbFileIndex'],_0x405a85,dbFileIndexTable[_0xd336af(0x9b)]),_0x467ecd='('+_0x405a85+')';if(!_0x50a614)return _0x12d73a[_0xd336af(0xba)][_0xd336af(0x138)](_0x1f198d,_0x1f198d['__'](_0xd336af(0xab)),_0xd336af(0x14f));if(dbUserTable[_0xd336af(0xdb)](_0x12d73a,_0x1f198d,'',_0xd336af(0x197),_0x50a614[_0xd336af(0x124)])!==!![])return;let _0x4f6222=path['basename'](_0x50a614[_0xd336af(0x124)]),_0x50310d=movieSeasonUtil[_0xd336af(0x1c4)](_0x4f6222);_0x50310d>-0x1&&(_0x50a614[_0xd336af(0x1e3)]=0x0,_0x50a614['path']=path['dirname'](_0x50a614['path']),_0x50a614[_0xd336af(0x162)]='');if(_0x50a614[_0xd336af(0x1e3)]!=0x1){let _0x3ebd07=path[_0xd336af(0x10a)](_0x50a614[_0xd336af(0x124)],_0x50a614[_0xd336af(0x162)]);console[_0xd336af(0xfa)](_0xd336af(0x160),_0x3ebd07);let _0x57dc1b=_0x12d73a['app']['dbFileIndex'][_0xd336af(0xe3)]('select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2')[_0xd336af(0xa7)](_0x3ebd07+path['sep']+'%',_0x3ebd07);if(_0x57dc1b[_0xd336af(0x11c)]<0x1)return _0x1f198d['json']({'code':0x0});_0x467ecd=_0x47e996(_0x57dc1b);}return _0x12d73a['app']['dbFileIndex'][_0xd336af(0xe3)]('UPDATE\x20file_index_movie\x20SET\x20collection_id=?\x20WHERE\x20id\x20in\x20'+_0x467ecd+'\x20and\x20show_in_list=1')[_0xd336af(0x126)](_0x395156),_0x1f198d[_0xd336af(0x172)]({'code':0x0});}else{if(_0x395156&&_0x29482f){let _0x248f98=_0x12d73a[_0xd336af(0xba)][_0xd336af(0x1cd)][_0xd336af(0xe3)](_0xd336af(0x182))[_0xd336af(0xa7)](_0x29482f+path[_0xd336af(0x154)]+'%',_0x29482f),_0x3117f6=_0x47e996(_0x248f98);return _0x12d73a[_0xd336af(0xba)][_0xd336af(0x1cd)][_0xd336af(0xe3)](_0xd336af(0xaf)+_0x3117f6+_0xd336af(0x1e5))[_0xd336af(0x126)](_0x395156),_0x1f198d[_0xd336af(0x172)]({'code':0x0});}else return _0x12d73a[_0xd336af(0xba)][_0xd336af(0x138)](_0x1f198d,_0x1f198d['__'](_0xd336af(0xab)),_0xd336af(0x14f));}});function getCollectionList(_0x30067f,_0x491d3c,_0x54560){const _0x2dd421=_0x3da14a;let _0x330ac6=[],_0x2fbc99=_0x30067f[_0x2dd421(0x1f6)][_0x2dd421(0x136)]||0x32,_0x32b56e=_0x30067f['body']['offset']||0x0,_0x335b40=_0x30067f[_0x2dd421(0x1f6)][_0x2dd421(0x1ca)]||'id',_0x33d7a6=_0x30067f[_0x2dd421(0x1f6)][_0x2dd421(0x1f7)]||_0x2dd421(0xd8),_0x277e7b=_0x30067f['body'][_0x2dd421(0x113)],_0x1596be='\x20id,title,data,enable_pwd,collection_cover_path,data_value,create_time,share_for_subuser\x20',_0x39ecb6=_0x2dd421(0x107)+_0x1596be+_0x2dd421(0xe7),_0x5a98dd=[_0x54560];_0x277e7b&&(_0x39ecb6+='\x20AND\x20title\x20like\x20?\x20',_0x5a98dd['push']('%'+_0x277e7b+'%'));_0x30067f[_0x2dd421(0x18c)][_0x2dd421(0x118)]!=0x1&&(_0x39ecb6+=_0x2dd421(0x1aa),_0x5a98dd[_0x2dd421(0x122)](0x1));_0x39ecb6+=_0x2dd421(0x17f)+_0x335b40+'\x20'+_0x33d7a6+'\x20LIMIT\x20?\x20OFFSET\x20?',_0x5a98dd[_0x2dd421(0x122)](_0x2fbc99),_0x5a98dd[_0x2dd421(0x122)](_0x32b56e),_0x330ac6=_0x30067f[_0x2dd421(0xba)][_0x2dd421(0x1cd)][_0x2dd421(0xe3)](_0x39ecb6)[_0x2dd421(0xa7)](_0x5a98dd);for(let _0x9d7218 of _0x330ac6){if(_0x9d7218['enable_pwd']==0x1)continue;let _0x3787ff=getMoviesByParams(_0x491d3c,_0x30067f,null,'id',0x1,0x0,_0x2dd421(0xd8),null,null,null,null,null,null,_0x9d7218['id']);_0x3787ff[_0x2dd421(0x11c)]>0x0&&(_0x9d7218[_0x2dd421(0x1b5)]=_0x3787ff[0x0]);}return _0x330ac6;}router[_0x3da14a(0xb8)]('/getCollection',(_0x52514f,_0x406e0c,_0x328d75)=>{const _0x12c579=_0x3da14a;let _0x1544a3=_0x52514f['body'][_0x12c579(0x17e)]||_0x12c579(0x1a5),_0x1850d9=getCollectionList(_0x52514f,_0x406e0c,_0x1544a3);return _0x406e0c[_0x12c579(0x172)]({'code':0x0,'data':_0x1850d9});}),router['post'](_0x3da14a(0x1e4),(_0x15ab37,_0x23d4bd,_0x72909c)=>{const _0x3a8e72=_0x3da14a;let _0x398ce3=_0x15ab37[_0x3a8e72(0x1f6)][_0x3a8e72(0xf4)],_0x398243=_0x15ab37['body']['collectionId'];if(!_0x398ce3)return _0x15ab37[_0x3a8e72(0xba)][_0x3a8e72(0x138)](_0x23d4bd,_0x23d4bd['__'](_0x3a8e72(0x175)),'dialog');_0x398ce3=sha256(_0x398ce3);let _0x46c04c=_0x15ab37['app'][_0x3a8e72(0x1cd)][_0x3a8e72(0xe3)]('SELECT\x20id,title,enable_pwd,create_time\x20FROM\x20movie_collection\x20where\x20id=?\x20and\x20pwd=?')[_0x3a8e72(0x15f)](_0x398243,_0x398ce3);if(!_0x46c04c)return _0x15ab37[_0x3a8e72(0xba)][_0x3a8e72(0x138)](_0x23d4bd,_0x23d4bd['__'](_0x3a8e72(0x178)),_0x3a8e72(0x14f));return _0x23d4bd[_0x3a8e72(0x172)]({'code':0x0,'data':_0x46c04c});}),router[_0x3da14a(0xb8)](_0x3da14a(0x10d),(_0x4b6156,_0x4450af,_0x11db68)=>{const _0x4f16f0=_0x3da14a;let _0x385f43=_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0x159)],_0x12b640=_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0x189)],_0x4b8670=_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0xf4)],_0x24da2d=_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0x1d1)],_0x404dc3=_0x4b6156[_0x4f16f0(0x1f6)]['type']?_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0x17e)]:'ordinary',_0xfa21dd=_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0x15d)]?_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0x15d)]:'',_0x147e21=_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0x1dd)]?_0x4b6156[_0x4f16f0(0x1f6)][_0x4f16f0(0x1dd)]:'',_0x4f34d3=_0x4b6156['body']['shareForSubUser'];_0x4f34d3==null&&(_0x4f34d3=0x1);if(_0x404dc3=='smart'){if(!_0xfa21dd||!_0xfa21dd[_0x4f16f0(0xcd)]||sqliteUtil[_0x4f16f0(0xc0)](_0xfa21dd[_0x4f16f0(0xcd)])==!![])return _0x4b6156[_0x4f16f0(0xba)][_0x4f16f0(0x138)](_0x4450af,_0x4f16f0(0xbb));}let _0x424aa7=_0x4b6156['body'][_0x4f16f0(0x10f)]?_0x4b6156[_0x4f16f0(0x1f6)]['dataValue']:'';if(_0x4b6156[_0x4f16f0(0x18c)]['is_admin']!=0x1)return _0x4b6156[_0x4f16f0(0xba)][_0x4f16f0(0x138)](_0x4450af,_0x4450af['__'](_0x4f16f0(0x16c)));if(_0x12b640=='1'){if(!_0x4b8670)return _0x4b6156[_0x4f16f0(0xba)][_0x4f16f0(0x138)](_0x4450af,_0x4450af['__'](_0x4f16f0(0x175)),_0x4f16f0(0x14f));_0x4b8670=sha256(_0x4b8670);}return _0x24da2d?_0x4b6156[_0x4f16f0(0xba)][_0x4f16f0(0x1cd)][_0x4f16f0(0xe3)]('UPDATE\x20movie_collection\x20SET\x20title=?,data=?,enable_pwd=?,pwd=?,collection_cover_path=?,data_value=?,share_for_subuser=?\x20WHERE\x20id=?')[_0x4f16f0(0x126)](_0x385f43,JSON[_0x4f16f0(0xb1)](_0xfa21dd),_0x12b640+'',_0x4b8670,_0x147e21,_0x424aa7,_0x4f34d3,_0x24da2d):_0x4b6156[_0x4f16f0(0xba)][_0x4f16f0(0x1cd)]['prepare'](_0x4f16f0(0x115))[_0x4f16f0(0x126)](_0x385f43,_0x12b640+'',_0x4b8670,_0x4b6156[_0x4f16f0(0x18c)]['id']+'',_0x404dc3,JSON[_0x4f16f0(0xb1)](_0xfa21dd),_0x147e21,_0x424aa7,_0x4f34d3),_0x4450af['json']({'code':0x0});}),router[_0x3da14a(0xb8)](_0x3da14a(0xf9),(_0x429e33,_0x3a6e7,_0x332700)=>{const _0x58ab52=_0x3da14a;let _0x587e17=_0x429e33[_0x58ab52(0x1f6)]['collectionId'];if(_0x429e33['currentUser'][_0x58ab52(0x118)]!=0x1)return _0x429e33['app'][_0x58ab52(0x138)](_0x3a6e7,_0x3a6e7['__']('noPermission'));return _0x429e33[_0x58ab52(0xba)][_0x58ab52(0x1cd)]['prepare'](_0x58ab52(0x14a))['run'](_0x587e17),_0x429e33['app'][_0x58ab52(0x1cd)][_0x58ab52(0xe3)](_0x58ab52(0x190))[_0x58ab52(0x126)](_0x587e17),_0x3a6e7[_0x58ab52(0x172)]({'code':0x0});}),router[_0x3da14a(0xb8)](_0x3da14a(0x1d7),(_0x3d1c98,_0x106d34,_0x456db4)=>{const _0xb097cc=_0x3da14a;return _0x3d1c98[_0xb097cc(0xba)]['dbFileIndex'][_0xb097cc(0xe3)](_0xb097cc(0xf5)+_0x3d1c98[_0xb097cc(0x18c)]['id'])[_0xb097cc(0x126)](),_0x106d34[_0xb097cc(0x172)]({'code':0x0});}),router['post'](_0x3da14a(0x18d),(_0x2d42eb,_0x109e2e,_0x1b60ba)=>{const _0x3d53a4=_0x3da14a;let _0x3ecb8d=_0x2d42eb[_0x3d53a4(0x1f6)][_0x3d53a4(0x131)],_0x4aee2=_0x2d42eb['body'][_0x3d53a4(0xaa)],_0x234162=dbFileIndexTable[_0x3d53a4(0x1bc)](_0x2d42eb[_0x3d53a4(0xba)][_0x3d53a4(0x1cd)],_0x3ecb8d,dbFileIndexTable[_0x3d53a4(0x9b)]);if(!_0x234162)return _0x109e2e[_0x3d53a4(0x172)]({'code':0x0});if(_0x234162[_0x3d53a4(0xa5)]){let _0x3c42d7=_0x2d42eb[_0x3d53a4(0xba)][_0x3d53a4(0x1cd)][_0x3d53a4(0xe3)](_0x3d53a4(0x148))[_0x3d53a4(0x15f)](_0x234162['collection_id']);if(_0x3c42d7&&_0x3c42d7[_0x3d53a4(0xb5)]==0x1)return _0x109e2e[_0x3d53a4(0x172)]({'code':0x0});}let _0x2a3c3f=_0x2d42eb[_0x3d53a4(0xba)][_0x3d53a4(0x1cd)][_0x3d53a4(0xe3)](_0x3d53a4(0x19d))[_0x3d53a4(0x15f)](_0x3ecb8d+'',_0x2d42eb[_0x3d53a4(0x18c)]['id']+'');return _0x2a3c3f?_0x2d42eb[_0x3d53a4(0xba)][_0x3d53a4(0x1cd)][_0x3d53a4(0xe3)](_0x3d53a4(0x11e))[_0x3d53a4(0x126)](_0x4aee2,new Date()[_0x3d53a4(0x1be)](),_0x3ecb8d+'',_0x2d42eb[_0x3d53a4(0x18c)]['id']+''):_0x2d42eb[_0x3d53a4(0xba)]['dbFileIndex'][_0x3d53a4(0xe3)](_0x3d53a4(0x18a))[_0x3d53a4(0x126)](_0x3ecb8d+'',_0x2d42eb['currentUser']['id']+'',_0x4aee2,new Date()[_0x3d53a4(0x1be)]()),_0x109e2e['json']({'code':0x0});}),router[_0x3da14a(0xb8)](_0x3da14a(0x10c),(_0x54505b,_0x48403c,_0x981b79)=>{const _0xec3866=_0x3da14a;let _0x2a368c=_0x54505b[_0xec3866(0x1f6)]['indexId'],_0x4ef08e=_0xec3866(0xfe);if(_0x2a368c){let _0x23bc92=_0x54505b[_0xec3866(0xba)][_0xec3866(0x1cd)]['prepare']('SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?')[_0xec3866(0x15f)](_0x54505b['currentUser']['id']+'',_0x2a368c+'');return _0x48403c['json']({'code':0x0,'data':_0x23bc92});}else{let _0x2a4393='SELECT\x20'+_0x4ef08e+_0xec3866(0xa2)+_0x54505b[_0xec3866(0x18c)]['id']+'\x20order\x20by\x20m.create_time\x20desc\x20limit\x2050',_0x135b5e=_0x54505b[_0xec3866(0xba)]['dbFileIndex']['prepare'](_0x2a4393)['all']();return _0x48403c[_0xec3866(0x172)]({'code':0x0,'data':_0x135b5e});}}),router[_0x3da14a(0xb8)](_0x3da14a(0x11b),(_0x2826c0,_0x106a01,_0x43c9ed)=>{const _0x5c29e8=_0x3da14a;let _0xbd6103=_0x2826c0[_0x5c29e8(0x1f6)]['id'],_0x4d8f36=dbFileIndexTable[_0x5c29e8(0x1bc)](_0x2826c0[_0x5c29e8(0xba)][_0x5c29e8(0x1cd)],_0xbd6103,dbFileIndexTable[_0x5c29e8(0x9b)]);if(dbUserTable['doUserCanGet'](_0x2826c0,_0x106a01,_0x5c29e8(0x192),_0x5c29e8(0x19c),_0x4d8f36[_0x5c29e8(0x124)])==!![]){let _0x17b728={'code':0x0,'data':_0x4d8f36};return _0x106a01['json'](_0x17b728);}}),router[_0x3da14a(0xb8)](_0x3da14a(0x199),(_0x29e98c,_0x2b46ff,_0x54f4c3)=>{const _0x41af63=_0x3da14a;let _0x2d5711=_0x29e98c[_0x41af63(0x1f6)][_0x41af63(0x1a3)],_0x5216ed=_0x29e98c[_0x41af63(0x1f6)][_0x41af63(0xc1)];if(dbUserTable[_0x41af63(0x1d6)](_0x29e98c,_0x2b46ff)===!![]){let _0x23274b=dbSourceFolderTable[_0x41af63(0x1bc)](_0x29e98c[_0x41af63(0xba)][_0x41af63(0x1b0)],_0x2d5711);if(!_0x23274b)return _0x2b46ff['status'](0x194)[_0x41af63(0xe0)]();return _0x5216ed==0x1?(_0x29e98c[_0x41af63(0xba)][_0x41af63(0x1cd)][_0x41af63(0xe3)](_0x41af63(0x1b7))[_0x41af63(0x126)](_0x23274b[_0x41af63(0x124)]+path['sep']+'%',_0x23274b['path']),dbSourceFolderTable[_0x41af63(0x1ab)](_0x29e98c['app']['dbOther'],_0x41af63(0x15e),_0x5216ed,_0x2d5711),process[_0x41af63(0x12f)]({'type':_0x41af63(0xc2)}),_0x2b46ff[_0x41af63(0x172)]({'code':0x0})):(dbSourceFolderTable[_0x41af63(0x1ab)](_0x29e98c['app']['dbOther'],_0x41af63(0x15e),_0x5216ed,_0x2d5711),_0x29e98c[_0x41af63(0xba)]['dbFileIndex'][_0x41af63(0xe3)](_0x41af63(0xf6))['run'](_0x23274b[_0x41af63(0x124)]+path[_0x41af63(0x154)]+'%',_0x23274b[_0x41af63(0x124)]),process[_0x41af63(0x12f)]({'type':_0x41af63(0xc2)}),_0x2b46ff[_0x41af63(0x172)]({'code':0x0}));}}),router[_0x3da14a(0xb8)]('/setTvplay',(_0x4dbed3,_0x191e4f,_0xc844bc)=>{const _0x49d9c1=_0x3da14a;let _0xf307f8=_0x4dbed3['body'][_0x49d9c1(0x1f0)],_0x33d5dd=_0x4dbed3[_0x49d9c1(0x1f6)][_0x49d9c1(0x131)],_0x50c919=_0x4dbed3['body']['sourceFolderId'];function _0x551dd1(_0x21a62e){const _0x57af1f=_0x49d9c1;let _0xa9a833=_0x4dbed3[_0x57af1f(0xba)][_0x57af1f(0x1cd)]['prepare'](_0x57af1f(0xd0)+dbFileIndexTable[_0x57af1f(0x9b)]+_0x57af1f(0x1d8))['get'](_0x21a62e);if(!_0xa9a833)return;_0x4dbed3[_0x57af1f(0xba)][_0x57af1f(0x1cd)][_0x57af1f(0xe3)](_0x57af1f(0x186)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x57af1f(0xdd))['run'](_0x21a62e),_0x4dbed3[_0x57af1f(0xba)][_0x57af1f(0x1cd)][_0x57af1f(0xe3)]('UPDATE\x20'+dbFileIndexTable[_0x57af1f(0x9b)]+_0x57af1f(0xda))[_0x57af1f(0x126)](_0xa9a833['id']),movieUtil[_0x57af1f(0x17b)](_0x4dbed3['app'][_0x57af1f(0x1cd)],_0xa9a833);}if(_0x33d5dd){let _0x147118=dbFileIndexTable[_0x49d9c1(0x1bc)](_0x4dbed3[_0x49d9c1(0xba)][_0x49d9c1(0x1cd)],_0x33d5dd,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(dbUserTable[_0x49d9c1(0xdb)](_0x4dbed3,_0x191e4f,_0x49d9c1(0x192),_0x49d9c1(0x197),_0x147118[_0x49d9c1(0x124)])==!![])return _0xf307f8==0x1?_0x551dd1(_0x147118[_0x49d9c1(0x124)]):_0x4dbed3[_0x49d9c1(0xba)][_0x49d9c1(0x1cd)]['prepare'](_0x49d9c1(0x186)+dbFileIndexTable[_0x49d9c1(0x9b)]+_0x49d9c1(0x1a0)+_0x147118['path']+'\x27')[_0x49d9c1(0x126)](),_0x191e4f[_0x49d9c1(0x172)]({'code':0x0});}else{if(_0x50c919){let _0x15f5e0=dbSourceFolderTable[_0x49d9c1(0x1bc)](_0x4dbed3['app'][_0x49d9c1(0x1b0)],_0x50c919);if(!_0x15f5e0||_0x15f5e0[_0x49d9c1(0x17e)]!=_0x49d9c1(0x192))return _0x4dbed3[_0x49d9c1(0xba)][_0x49d9c1(0x138)](_0x191e4f,_0x191e4f['__'](_0x49d9c1(0xab)),_0x49d9c1(0x14f));if(_0xf307f8==0x1){dbSourceFolderTable['updateByWhere'](_0x4dbed3[_0x49d9c1(0xba)][_0x49d9c1(0x1b0)],_0x49d9c1(0x1cf),_0x49d9c1(0xe6),_0x50c919),_0x551dd1(_0x15f5e0[_0x49d9c1(0x124)]);let _0x55ab20=_0x4dbed3['app'][_0x49d9c1(0x1cd)][_0x49d9c1(0xe3)](_0x49d9c1(0xec)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x49d9c1(0x1ba))[_0x49d9c1(0xa7)](_0x15f5e0[_0x49d9c1(0x124)],''+_0x15f5e0[_0x49d9c1(0x124)]+path[_0x49d9c1(0x154)]+'%');for(let _0xa9f46f in _0x55ab20){let _0x3b14ab=path['join'](_0x55ab20[_0xa9f46f]['path'],_0x55ab20[_0xa9f46f]['filename']);_0x551dd1(_0x3b14ab);}}else{dbSourceFolderTable[_0x49d9c1(0x1ab)](_0x4dbed3[_0x49d9c1(0xba)][_0x49d9c1(0x1b0)],_0x49d9c1(0x1cf),_0x49d9c1(0x192),_0x50c919);let _0x212378=_0x4dbed3['app'][_0x49d9c1(0x1cd)][_0x49d9c1(0xe3)](_0x49d9c1(0x186)+dbFileIndexTable[_0x49d9c1(0x9b)]+'\x20SET\x20show_in_list=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=?\x20or\x20path\x20like\x20?')[_0x49d9c1(0x126)](_0x15f5e0[_0x49d9c1(0x124)],''+_0x15f5e0['path']+path['sep']+'%');}return _0x191e4f[_0x49d9c1(0x172)]({'code':0x0});}else return _0x4dbed3['app'][_0x49d9c1(0x138)](_0x191e4f,_0x191e4f['__'](_0x49d9c1(0xab)),_0x49d9c1(0x14f));}});function setLogoAndFanart(_0x32737e,_0x336806,_0x5e09d9,_0x5e75a6){const _0x14518d=_0x3da14a;if(_0x32737e[_0x14518d(0x1f6)]['needLogoPathAndFanart']){let _0x5a03e0='SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20',_0x460109=[_0x5e09d9];_0x5e75a6?(_0x5a03e0+=_0x14518d(0xc7),_0x460109[_0x14518d(0x122)](_0x14518d(0xac)),_0x460109[_0x14518d(0x122)](_0x5e75a6+'-clearlogo.%'),_0x460109[_0x14518d(0x122)](_0x5e75a6+_0x14518d(0x1db))):(_0x5a03e0+=_0x14518d(0xd9),_0x460109[_0x14518d(0x122)]('clearlogo.%'));let _0x1bcfd1=_0x32737e[_0x14518d(0xba)][_0x14518d(0x1cd)][_0x14518d(0xe3)](_0x5a03e0)[_0x14518d(0x15f)](_0x460109);if(_0x1bcfd1){let _0x339aaf=path['join'](_0x1bcfd1[_0x14518d(0x124)],_0x1bcfd1['filename']);_0x336806[_0x14518d(0x14b)]=_0x339aaf;}let _0x3311a7=_0x14518d(0x16a),_0x46114e=[_0x5e09d9];_0x5e75a6?(_0x3311a7+=_0x14518d(0x19a),_0x46114e[_0x14518d(0x122)](_0x14518d(0x10e)),_0x46114e[_0x14518d(0x122)](_0x5e75a6+'-fanart.%'),_0x46114e[_0x14518d(0x122)](_0x5e75a6+_0x14518d(0x1f4))):(_0x3311a7+=_0x14518d(0xd9),_0x46114e[_0x14518d(0x122)]('fanart.%'));let _0x215bf2=_0x32737e[_0x14518d(0xba)][_0x14518d(0x1cd)][_0x14518d(0xe3)](_0x3311a7)[_0x14518d(0x15f)](_0x46114e);if(_0x215bf2){let _0x3583b6=path['join'](_0x215bf2[_0x14518d(0x124)],_0x215bf2['filename']);_0x336806['fanart_path']=_0x3583b6;}}}function addTvFolderPathAndName(_0x6d1326){const _0x39e44b=_0x3da14a;_0x6d1326[_0x39e44b(0x1c7)]=path[_0x39e44b(0xc3)](_0x6d1326[_0x39e44b(0x124)]),_0x6d1326[_0x39e44b(0x18e)]=_0x6d1326[_0x39e44b(0x124)];if(_0x6d1326[_0x39e44b(0x103)]==0x1){let _0x30bbbe=path['basename'](_0x6d1326[_0x39e44b(0x124)]),_0x792282=path['dirname'](_0x6d1326['path']),_0xb84520=movieSeasonUtil[_0x39e44b(0x1c4)](_0x30bbbe);_0xb84520>-0x1&&(_0x6d1326[_0x39e44b(0x1c7)]=path['basename'](_0x792282),_0x6d1326[_0x39e44b(0x18e)]=_0x792282);if(!_0x6d1326[_0x39e44b(0xf8)])_0x6d1326['show_name']=_0x6d1326[_0x39e44b(0x1c7)];}}function addFolderCoverPath(_0x3b6f5b,_0x187208,_0x1c6482,_0x4d3b78=![]){const _0x20fad1=_0x3da14a;let _0x3ca48e;addTvFolderPathAndName(_0x1c6482);let _0x539eaa=_0x1c6482['id']+_0x20fad1(0x170)+_0x4d3b78;!_0x187208[_0x20fad1(0x166)]&&(_0x187208[_0x20fad1(0x166)]=new Map());try{if(_0x1c6482['is_tvplay']==0x1&&!_0x4d3b78)try{let _0x3b2259=path[_0x20fad1(0xc3)](_0x1c6482['path']),_0xfcd764=path[_0x20fad1(0xb7)](_0x1c6482[_0x20fad1(0x124)]),_0x12ff7d=movieSeasonUtil['getSeasonNumber'](_0x3b2259);if(_0x12ff7d>-0x1){_0x1c6482[_0x20fad1(0x183)]=0x1,_0x1c6482[_0x20fad1(0x102)]=_0x12ff7d;if(_0x187208['body']['needSeasonCount']){let _0xb0440a=_0xfcd764+_0x20fad1(0x106)+_0x4d3b78;_0x187208[_0x20fad1(0x166)][_0x20fad1(0x9e)](_0xb0440a)?_0x1c6482['seasonCount']=_0x187208[_0x20fad1(0x166)]['get'](_0xb0440a):(_0x1c6482[_0x20fad1(0xb9)]=_0x187208[_0x20fad1(0xba)][_0x20fad1(0x1cd)][_0x20fad1(0xe3)](_0x20fad1(0x1c1))[_0x20fad1(0x15f)](''+_0xfcd764+path[_0x20fad1(0x154)]+'%')[_0x20fad1(0x136)],_0x187208[_0x20fad1(0x166)]['set'](_0xb0440a,_0x1c6482[_0x20fad1(0xb9)]));}}setLogoAndFanart(_0x187208,_0x1c6482,_0x1c6482[_0x20fad1(0x18e)]);if(_0x187208[_0x20fad1(0x1f6)][_0x20fad1(0x1ac)]==0x1&&_0x12ff7d>-0x1){let _0x2c96c5=_0x1c6482[_0x20fad1(0x18e)]+_0x20fad1(0xd5);if(_0x187208[_0x20fad1(0x166)][_0x20fad1(0x9e)](_0x2c96c5))return _0x1c6482['folder_cover_path']=_0x187208['movieTvCache'][_0x20fad1(0x15f)](_0x2c96c5),_0x1c6482;let _0x4e644f=getTvSeriesPoster(_0x1c6482);if(_0x4e644f)return _0x187208['movieTvCache'][_0x20fad1(0x181)](_0x2c96c5,_0x4e644f),_0x1c6482[_0x20fad1(0xd6)]=_0x4e644f,_0x1c6482;}if(!_0x3ca48e&&_0x187208[_0x20fad1(0x166)][_0x20fad1(0x9e)](_0x539eaa))return _0x1c6482[_0x20fad1(0xd6)]=_0x187208['movieTvCache'][_0x20fad1(0x15f)](_0x539eaa),_0x1c6482;if(!_0x3ca48e&&_0x12ff7d>-0x1){parseInt(_0x12ff7d)<0xa&&(_0x12ff7d='0'+_0x12ff7d);let _0x38888e='%season'+_0x12ff7d+_0x20fad1(0x171),_0x19f569='%s'+_0x12ff7d+_0x20fad1(0x171),_0x2c508e=_0x20fad1(0x1eb)+_0xfcd764+_0x20fad1(0xfd)+_0x38888e+'\x27\x20or\x20filename\x20like\x20\x27'+_0x19f569+'\x27)';_0x3ca48e=_0x187208[_0x20fad1(0xba)]['dbFileIndex'][_0x20fad1(0xe3)](_0x2c508e)[_0x20fad1(0x15f)]();}!_0x3ca48e&&(_0x3ca48e=_0x187208[_0x20fad1(0xba)]['dbFileIndex']['prepare']('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)')[_0x20fad1(0x15f)](_0x1c6482[_0x20fad1(0x124)]));}catch(_0x44fa00){console[_0x20fad1(0xfa)](_0x44fa00);}else{if(_0x187208[_0x20fad1(0x166)][_0x20fad1(0x9e)](_0x539eaa))return _0x1c6482[_0x20fad1(0xd6)]=_0x187208[_0x20fad1(0x166)][_0x20fad1(0x15f)](_0x539eaa),_0x1c6482;let _0x1395c2=path[_0x20fad1(0xdf)](_0x1c6482[_0x20fad1(0x162)]),_0xfcd361=_0x1395c2[_0x20fad1(0xde)],_0x39aae5=path['join'](_0x1c6482[_0x20fad1(0x124)],_0xfcd361+'.jpg');if(fs[_0x20fad1(0xea)](_0x39aae5))return _0x1c6482[_0x20fad1(0xd6)]=_0x39aae5,_0x1c6482;!_0x3ca48e&&(_0x3ca48e=_0x187208[_0x20fad1(0xba)][_0x20fad1(0x1cd)][_0x20fad1(0xe3)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20filename\x20like\x20?')[_0x20fad1(0x15f)](_0x1c6482[_0x20fad1(0x124)],'%'+_0xfcd361+_0x20fad1(0x171)));if(!_0x3ca48e){let _0x252fb0=_0xfcd361;(_0xfcd361['endsWith'](_0x20fad1(0xa3))||_0xfcd361['endsWith'](_0x20fad1(0x1e7))||_0xfcd361[_0x20fad1(0xbe)](_0x20fad1(0x167))||_0xfcd361[_0x20fad1(0xbe)](_0x20fad1(0x1ae)))&&(_0xfcd361['endsWith'](_0x20fad1(0xa3))?_0x252fb0=_0x252fb0['substr'](0x0,_0x252fb0[_0x20fad1(0x11c)]-0x3):_0x252fb0=_0x252fb0['substr'](0x0,_0x252fb0[_0x20fad1(0x11c)]-0x4)),_0x3ca48e=_0x187208[_0x20fad1(0xba)]['dbFileIndex'][_0x20fad1(0xe3)](_0x20fad1(0x9d))['get'](_0x1c6482['path'],_0xfcd361+'%',_0x252fb0+'%',_0x20fad1(0x12a));}!_0x3ca48e&&(_0x3ca48e=_0x187208[_0x20fad1(0xba)]['dbFileIndex'][_0x20fad1(0xe3)](_0x20fad1(0xef))[_0x20fad1(0x15f)](_0x1c6482[_0x20fad1(0x124)]));let {name:_0x507980}=path[_0x20fad1(0xdf)](_0x1c6482['filename']);setLogoAndFanart(_0x187208,_0x1c6482,_0x1c6482[_0x20fad1(0x124)],_0x507980);}if(_0x3ca48e){let _0x6ada=path[_0x20fad1(0x10a)](_0x3ca48e[_0x20fad1(0x124)],_0x3ca48e[_0x20fad1(0x162)]);!_0x6ada[_0x20fad1(0xbe)](_0x20fad1(0xcb))&&!_0x6ada['endsWith'](_0x20fad1(0x1b3))&&fs[_0x20fad1(0xea)](_0x6ada)?(_0x1c6482[_0x20fad1(0xd6)]=_0x6ada,_0x187208[_0x20fad1(0x166)][_0x20fad1(0x181)](_0x539eaa,_0x1c6482[_0x20fad1(0xd6)])):_0x187208[_0x20fad1(0x166)][_0x20fad1(0x181)](_0x539eaa,'');}return _0x1c6482;}catch(_0x21ee7f){return console['log'](_0x21ee7f),_0x1c6482;}}function getMoviesByParams(_0x23b6a5,_0x2c9cfb,_0x22be70,_0x395659,_0xe53c54,_0x2106fc,_0x2a81e2,_0x3e84ad,_0x340f26,_0x34e7a0,_0x1a5cda,_0x5d65e0,_0x24d731,_0x361b44,_0x84b252,_0x2f9ad4,_0x6a831f,_0x1fc541){const _0x17873a=_0x3da14a;let _0x2b5538=movieFieldStr;_0x1fc541&&(_0x2b5538=_0x1fc541);!_0x84b252&&(_0x84b252=_0x17873a(0x180));let _0x3e7b13='',_0x4a738e=[],_0x4089b6=dbUserTable[_0x17873a(0xeb)](_0x2c9cfb,_0x17873a(0x192),_0x17873a(0x19c),!![],_0x34e7a0);if(_0x2c9cfb['currentUser']['is_admin']!=0x1&&!_0x4089b6['whereStr'])return[];_0x3e7b13+=_0x17873a(0xad);_0x340f26&&(_0x340f26=_0x340f26[_0x17873a(0xbf)]('\x27','')[_0x17873a(0xbf)]('’',''),_0x3e7b13+=_0x17873a(0xe9),_0x4a738e[_0x17873a(0x122)]('%'+_0x340f26+'%'),_0x4a738e[_0x17873a(0x122)]('%'+_0x340f26+'%'),_0x4a738e[_0x17873a(0x122)]('%'+_0x340f26+'%'));let _0x49ed58=dbSourceFolderTable['getExcludePathWhereStr'](_0x2c9cfb['app']['dbOther'],_0x17873a(0x124),'excludePathMovie');_0x49ed58&&(_0x3e7b13+=_0x17873a(0x1dc)+_0x49ed58);let _0x3d047a=dbSourceFolderTable[_0x17873a(0xd3)](_0x2c9cfb[_0x17873a(0xba)][_0x17873a(0x1b0)],_0x17873a(0x162),_0x17873a(0x100));_0x3d047a&&(_0x3e7b13+=_0x17873a(0x1dc)+_0x3d047a);function _0x1d56d0(_0xbe3e2b,_0x1370c8){const _0x4f64c2=_0x17873a;let _0x526f07=_0x4f64c2(0xd2);try{let _0x2dd28b=JSON['parse'](_0x1370c8),_0x14856c=![];for(let _0x4efa4a=0x0;_0x4efa4a<_0x2dd28b[_0x4f64c2(0x11c)];_0x4efa4a++){if(!_0x2dd28b[_0x4efa4a])continue;_0x14856c=!![],_0x526f07+='\x20'+_0xbe3e2b+_0x4f64c2(0x134),_0x4a738e[_0x4f64c2(0x122)]('%'+_0x2dd28b[_0x4efa4a]['trim']()+'%'),_0x4efa4a!=_0x2dd28b['length']-0x1&&(_0x526f07+=_0x4f64c2(0x12e));}_0x526f07+=')',_0x14856c&&(_0x3e7b13+=_0x526f07);}catch(_0x7d6386){console[_0x4f64c2(0xfa)](_0x7d6386);}}_0x1a5cda&&_0x1d56d0(_0x17873a(0x1a7),_0x1a5cda);_0x5d65e0&&_0x1d56d0('movie_language',_0x5d65e0);_0x24d731&&_0x1d56d0(_0x17873a(0xd4),_0x24d731);_0x2c9cfb['body'][_0x17873a(0x184)]&&_0x2c9cfb['body'][_0x17873a(0x184)]['length']>0x0&&_0x2c9cfb[_0x17873a(0x1f6)][_0x17873a(0x184)][0x0]!=''&&_0x1d56d0('movie_actor',_0x2c9cfb[_0x17873a(0x1f6)]['movieActors']);_0x2c9cfb[_0x17873a(0x1f6)][_0x17873a(0x15a)]&&_0x2c9cfb[_0x17873a(0x1f6)][_0x17873a(0x15a)][_0x17873a(0x11c)]>0x0&&_0x2c9cfb['body'][_0x17873a(0x15a)][0x0]!=''&&_0x1d56d0(_0x17873a(0x119),_0x2c9cfb['body'][_0x17873a(0x15a)]);if(_0x6a831f){let _0x1efc1e=_0x2c9cfb[_0x17873a(0xba)][_0x17873a(0x1cd)]['prepare'](_0x17873a(0xfb))[_0x17873a(0x15f)](_0x6a831f);if(_0x1efc1e)try{let _0x1f31d9=JSON[_0x17873a(0xdf)](_0x1efc1e[_0x17873a(0x129)]),_0x57cad6=dbUserTable[_0x17873a(0xcc)](!![],_0x1f31d9);_0x3e7b13+=_0x57cad6[_0x17873a(0x1b1)],_0x4a738e[_0x17873a(0x122)](..._0x57cad6[_0x17873a(0x1c9)]);}catch(_0x2f831f){console['log'](_0x2f831f);}}else{!_0x361b44&&(_0x361b44=0x0);let _0xe92c09;if(_0x361b44!=0x0){_0xe92c09=_0x2c9cfb['app'][_0x17873a(0x1cd)]['prepare']('SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?')[_0x17873a(0x15f)](_0x361b44);if(!_0xe92c09)return _0x2c9cfb['app']['returnErrMsg'](_0x23b6a5,_0x23b6a5['__'](_0x17873a(0xbd)));if(_0xe92c09[_0x17873a(0xb5)]==0x1){let _0x578f8d=_0x2c9cfb[_0x17873a(0x1f6)]['collectionPwd'];if(!_0x578f8d||_0xe92c09[_0x17873a(0xf4)]!=sha256(_0x578f8d))return _0x2c9cfb['app'][_0x17873a(0x138)](_0x23b6a5,_0x23b6a5['__'](_0x17873a(0x178)));}}if(_0xe92c09&&_0xe92c09[_0x17873a(0x17e)]==_0x17873a(0x156))try{_0xe92c09[_0x17873a(0x15d)]=JSON['parse'](_0xe92c09[_0x17873a(0x15d)]),_0x3e7b13+=_0x17873a(0x1dc)+_0xe92c09[_0x17873a(0x15d)]['searchValue'];}catch(_0x2572a6){console[_0x17873a(0xfa)](_0x2572a6);}else _0x3e7b13+='\x20AND\x20collection_id\x20=\x20'+_0x361b44;}if(_0x22be70){if(_0x22be70==0x1)_0x3e7b13+=_0x17873a(0x1bb);else _0x22be70==0x2&&(_0x3e7b13+=_0x17873a(0x17d));}_0x2f9ad4&&(_0x2f9ad4=='#'?(_0x3e7b13+=_0x17873a(0xa6),_0x4a738e[_0x17873a(0x122)](_0x2f9ad4),_0x4a738e['push'](_0x2f9ad4),_0x4a738e[_0x17873a(0x122)](_0x2f9ad4)):(_0x3e7b13+=_0x17873a(0x13c),_0x4a738e[_0x17873a(0x122)](_0x2f9ad4),_0x4a738e[_0x17873a(0x122)](_0x2f9ad4),_0x4a738e['push'](_0x2f9ad4)));if(_0x3e84ad&&_0x3e84ad[_0x17873a(0x11c)]>0x0){_0x3e7b13+=_0x17873a(0x1cc);for(let _0x4dabd0=0x0;_0x4dabd0<_0x3e84ad[_0x17873a(0x11c)];_0x4dabd0++){_0x3e7b13+=_0x3e84ad[_0x4dabd0],_0x4dabd0!=_0x3e84ad[_0x17873a(0x11c)]-0x1&&(_0x3e7b13+=',');}_0x3e7b13+=')';}_0x3e7b13+=_0x4089b6[_0x17873a(0x1b1)],_0x4a738e[_0x17873a(0x122)](..._0x4089b6[_0x17873a(0x1c9)]);_0x395659&&_0x2a81e2?_0x3e7b13+=_0x17873a(0x13e)+_0x395659+'\x20'+_0x2a81e2:_0x3e7b13+=_0x17873a(0x1d9);!_0xe53c54&&(_0xe53c54=0x32);_0x3e7b13+=_0x17873a(0xed),_0x4a738e['push'](_0xe53c54),_0x4a738e[_0x17873a(0x122)](_0x2106fc);let _0x3a8ffe=[];if(_0x84b252==_0x17873a(0xf7))_0x3a8ffe=dbMovieFavorite[_0x17873a(0x146)](_0x2c9cfb[_0x17873a(0xba)]['dbFileIndex'],_0x2c9cfb[_0x17873a(0x18c)]['id'],_0x3e7b13,_0x2b5538,_0x4a738e);else _0x84b252==_0x17873a(0x180)&&(_0x3a8ffe=dbFileIndexTable[_0x17873a(0x104)](_0x2c9cfb[_0x17873a(0xba)][_0x17873a(0x1cd)],_0x3e7b13,_0x2b5538,dbFileIndexTable[_0x17873a(0x9b)],_0x4a738e));if(_0x3a8ffe[_0x17873a(0x11c)]<0x1)return _0x3a8ffe;let _0x2c2d75=[];for(let _0x18abc8 in _0x3a8ffe){_0x2c2d75['push'](_0x3a8ffe[_0x18abc8]['id']);}let _0x34dbc8=dbMovieFavorite[_0x17873a(0x1d5)](_0x2c9cfb[_0x17873a(0xba)][_0x17873a(0x1cd)],_0x2c9cfb['currentUser']['id'],_0x2c2d75);for(let _0x1dfc3f=0x0;_0x1dfc3f<_0x3a8ffe[_0x17873a(0x11c)];_0x1dfc3f++){_0x3a8ffe[_0x1dfc3f][_0x17873a(0x140)]=0x0;for(let _0x5e86f3 in _0x34dbc8){if(_0x34dbc8[_0x5e86f3][_0x17873a(0x1ed)]==_0x3a8ffe[_0x1dfc3f]['id']){_0x3a8ffe[_0x1dfc3f][_0x17873a(0x140)]=0x1;break;}}let _0x435cbd=_0x2c9cfb[_0x17873a(0xba)]['dbFileIndex'][_0x17873a(0xe3)](_0x17873a(0x10b))[_0x17873a(0x15f)](_0x2c9cfb[_0x17873a(0x18c)]['id']+'',_0x3a8ffe[_0x1dfc3f]['id']+'');_0x435cbd&&(_0x3a8ffe[_0x1dfc3f][_0x17873a(0x13d)]=_0x435cbd);_0x3a8ffe[_0x1dfc3f]=addFolderCoverPath(_0x23b6a5,_0x2c9cfb,_0x3a8ffe[_0x1dfc3f]);if(_0x3a8ffe[_0x1dfc3f][_0x17873a(0x103)]==0x1&&_0x2c9cfb[_0x17873a(0x1f6)][_0x17873a(0x12b)]){let _0x5f2e91=dbFileIndexTable[_0x17873a(0x123)](_0x2c9cfb['app']['dbFileIndex'],_0x3a8ffe[_0x1dfc3f]);_0x3a8ffe[_0x1dfc3f][_0x17873a(0x139)]=_0x5f2e91[_0x17873a(0x136)];}}return _0x3a8ffe;}function getShowMatchName(_0x29d5d2){const _0x46cc56=_0x3da14a;let _0x2f718e=dbConfigTable[_0x46cc56(0x19e)](_0x29d5d2,_0x46cc56(0x1e1));return!_0x2f718e||_0x2f718e&&_0x2f718e['value']!=0x0?0x1:0x0;}router[_0x3da14a(0xb8)](_0x3da14a(0xb4),(_0x4a1a61,_0x5669c1,_0x2af95f)=>{const _0x484baf=_0x3da14a;if(dbUserTable['doUserCanGet'](_0x4a1a61,_0x5669c1,_0x484baf(0x192),'power_get')==!![]){let _0x27562f=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x136)],_0x1b60cd=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x196)],_0x55e1d9=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0xb3)],_0x3a88ea=_0x4a1a61[_0x484baf(0x1f6)]['sortType'],_0x3b5b25=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x18f)],_0x14eca8=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x153)],_0x20eaba=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x17c)],_0x1f78a3=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x15b)],_0x286790=_0x4a1a61['body'][_0x484baf(0x1f1)],_0x4eb20f=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x11d)],_0x116266=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x108)],_0x574d78=_0x4a1a61['body'][_0x484baf(0x1d1)],_0x440f2c=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x1c0)],_0x46b028=_0x4a1a61[_0x484baf(0x1f6)]['firstLetter'],_0x2a89c0=_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x110)];_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0x12b)]=!![],_0x4a1a61[_0x484baf(0x1f6)][_0x484baf(0xee)]=!![];let _0x3012f7=getMoviesByParams(_0x5669c1,_0x4a1a61,_0x116266,_0x55e1d9,_0x27562f,_0x1b60cd,_0x3a88ea,_0x3b5b25,_0x14eca8,_0x20eaba,_0x1f78a3,_0x286790,_0x4eb20f,_0x574d78,_0x440f2c,_0x46b028,_0x2a89c0);return _0x5669c1[_0x484baf(0x172)]({'movieShowMatchName':getShowMatchName(_0x4a1a61['app'][_0x484baf(0x1b0)]),'code':0x0,'data':_0x3012f7});}}),router[_0x3da14a(0xb8)](_0x3da14a(0xf2),(_0x2a5a9b,_0x274e70,_0x34b697)=>{const _0x3b3b74=_0x3da14a;if(dbUserTable[_0x3b3b74(0xdb)](_0x2a5a9b,_0x274e70,_0x3b3b74(0x192),_0x3b3b74(0x19c))==!![]){let _0x4debfb=_0x2a5a9b[_0x3b3b74(0x1f6)][_0x3b3b74(0x17c)],_0x5a6c6=_0x2a5a9b[_0x3b3b74(0x1f6)]['pageCount'],_0x28c42d=_0x2a5a9b['body'][_0x3b3b74(0x108)];!_0x5a6c6&&(_0x5a6c6=0x9);let _0x5bb372=_0x3b3b74(0x1f3),_0x14d728='';_0x4debfb?_0x14d728=dbUserTable[_0x3b3b74(0xeb)](_0x2a5a9b,_0x3b3b74(0x192),_0x3b3b74(0x19c),!![],_0x4debfb):_0x14d728=dbUserTable[_0x3b3b74(0xeb)](_0x2a5a9b,_0x3b3b74(0x192),_0x3b3b74(0x19c),!![]);let _0x3b9116=_0x2a5a9b['body'][_0x3b3b74(0xf1)];_0x3b9116!='movie_genres'&&_0x3b9116!='movie_regions'&&(_0x3b9116='movie_genres');!_0x3b9116&&(_0x3b9116=_0x3b3b74(0xd4));let _0x2029c7=_0x2a5a9b[_0x3b3b74(0xba)][_0x3b3b74(0x1cd)][_0x3b3b74(0xe3)](_0x3b3b74(0x1de))['all'](_0x3b9116),_0x23c60e=[];for(let _0x213111 of _0x2029c7){let _0x31c646=_0x213111['key_value'],_0x5e29af=_0x3b3b74(0xad),_0xb4b424=[];_0x5e29af+=_0x14d728[_0x3b3b74(0x1b1)],_0xb4b424[_0x3b3b74(0x122)](..._0x14d728['paramsList']),_0x5e29af+='\x20AND\x20collection_id=0';if(_0x28c42d){if(_0x28c42d==0x1)_0x5e29af+=_0x3b3b74(0x1bb);else _0x28c42d==0x2&&(_0x5e29af+=_0x3b3b74(0x17d));}_0x5e29af+='\x20AND\x20'+_0x3b9116+_0x3b3b74(0x1df),_0xb4b424['push']('%'+_0x31c646+'%'),_0x5e29af+='\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20check_time\x20DESC\x20LIMIT\x20?',_0xb4b424[_0x3b3b74(0x122)](parseInt(_0x5a6c6));let _0x1211a2=dbFileIndexTable[_0x3b3b74(0x104)](_0x2a5a9b[_0x3b3b74(0xba)][_0x3b3b74(0x1cd)],_0x5e29af,_0x5bb372,dbFileIndexTable[_0x3b3b74(0x9b)],_0xb4b424),_0x42dcd4=[];for(let _0x3c6b05 in _0x1211a2){_0x42dcd4[_0x3b3b74(0x122)](_0x1211a2[_0x3c6b05]['id']);}let _0x1f3829=dbMovieFavorite[_0x3b3b74(0x1d5)](_0x2a5a9b['app']['dbFileIndex'],_0x2a5a9b['currentUser']['id'],_0x42dcd4);for(let _0x30906b=0x0;_0x30906b<_0x1211a2[_0x3b3b74(0x11c)];_0x30906b++){_0x1211a2[_0x30906b][_0x3b3b74(0x140)]=0x0;for(let _0x4753d7 in _0x1f3829){if(_0x1f3829[_0x4753d7][_0x3b3b74(0x1ed)]==_0x1211a2[_0x30906b]['id']){_0x1211a2[_0x30906b][_0x3b3b74(0x140)]=0x1;break;}}_0x1211a2[_0x30906b]=addFolderCoverPath(_0x274e70,_0x2a5a9b,_0x1211a2[_0x30906b]);}_0x1211a2['length']>0x0&&_0x23c60e[_0x3b3b74(0x122)]({'genresType':_0x3b9116,'genresValue':_0x31c646,'movieList':_0x1211a2,'indexCount':_0x213111[_0x3b3b74(0x187)]});}_0x274e70[_0x3b3b74(0x172)]({'code':0x0,'data':_0x23c60e,'movieShowMatchName':getShowMatchName(_0x2a5a9b[_0x3b3b74(0xba)][_0x3b3b74(0x1b0)])});}}),router['post'](_0x3da14a(0x128),(_0x577b01,_0x249591,_0x158fe6)=>{const _0x883e2a=_0x3da14a;if(dbUserTable[_0x883e2a(0xdb)](_0x577b01,_0x249591,'movie',_0x883e2a(0x19c))==!![]){let _0x32cec8=getMoviesByParams(_0x249591,_0x577b01,0x1,_0x883e2a(0x1d4),0xf,0x0,'desc');_0x577b01[_0x883e2a(0x1f6)][_0x883e2a(0x12b)]=!![],_0x577b01['body'][_0x883e2a(0xee)]=!![],_0x577b01[_0x883e2a(0x1f6)][_0x883e2a(0x1ac)]=0x1;let _0x1c136e=getMoviesByParams(_0x249591,_0x577b01,0x2,'create_time',0x32,0x0,'desc');_0x577b01['body'][_0x883e2a(0x12b)]=![],_0x577b01[_0x883e2a(0x1f6)]['needSeasonCount']=![],_0x577b01[_0x883e2a(0x1f6)]['useTvSeriesInfo']=0x0;let _0x1268ce=dbConfigTable[_0x883e2a(0x19e)](_0x577b01['app'][_0x883e2a(0x1b0)],_0x883e2a(0xbc));_0x1268ce=!_0x1268ce||_0x1268ce&&_0x1268ce['value']==0x1;let _0xa9b109=dbConfigTable['findByTitle'](_0x577b01[_0x883e2a(0xba)][_0x883e2a(0x1b0)],_0x883e2a(0xa8));_0xa9b109=!_0xa9b109||_0xa9b109&&_0xa9b109['value']==0x1;let _0xf00e12=dbConfigTable['findByTitle'](_0x577b01[_0x883e2a(0xba)]['dbOther'],_0x883e2a(0x174));_0xf00e12=!_0xf00e12||_0xf00e12&&_0xf00e12[_0x883e2a(0x1d2)]==0x1;let _0x4c1b77=[];if(_0xf00e12){let _0x3702e2=_0x883e2a(0x13a),_0xe14ca4='SELECT\x20'+_0x3702e2+'\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id='+_0x577b01[_0x883e2a(0x18c)]['id']+_0x883e2a(0x157);_0x4c1b77=_0x577b01[_0x883e2a(0xba)][_0x883e2a(0x1cd)][_0x883e2a(0xe3)](_0xe14ca4)[_0x883e2a(0xa7)]();let _0x1070dc=[];for(let _0x4516ab in _0x4c1b77){_0x1070dc['push'](_0x4c1b77[_0x4516ab]['id']);}let _0x1fa89f=dbMovieFavorite[_0x883e2a(0x1d5)](_0x577b01[_0x883e2a(0xba)]['dbFileIndex'],_0x577b01[_0x883e2a(0x18c)]['id'],_0x1070dc);for(let _0x214e15=0x0;_0x214e15<_0x4c1b77[_0x883e2a(0x11c)];_0x214e15++){_0x4c1b77[_0x214e15]['favorite']=0x0;for(let _0x134d58 in _0x1fa89f){if(_0x1fa89f[_0x134d58][_0x883e2a(0x1ed)]==_0x4c1b77[_0x214e15]['id']){_0x4c1b77[_0x214e15][_0x883e2a(0x140)]=0x1;break;}}}}let _0x577374=[];_0xa9b109&&(_0x577374=getMovieLibrary(_0x577b01,_0x249591,0x6));let _0x37037d={'code':0x0,'movies':_0x32cec8,'tv':_0x1c136e,'history':_0x4c1b77,'libraryList':_0x577374,'sourceList':[]};_0x37037d['movieShowMatchName']=getShowMatchName(_0x577b01[_0x883e2a(0xba)]['dbOther']);if(_0x1268ce){let _0x54887c=_0x577b01['app'][_0x883e2a(0x1b0)][_0x883e2a(0xe3)](_0x883e2a(0xff))[_0x883e2a(0xa7)]('movie');for(let _0x463eb9 of _0x54887c){let _0xfbd8=getMoviesByParams(_0x249591,_0x577b01,null,'check_time',0x4,0x0,_0x883e2a(0xd8),null,null,JSON[_0x883e2a(0xb1)]([path[_0x883e2a(0x10a)](_0x463eb9[_0x883e2a(0x124)])]));if(_0xfbd8[_0x883e2a(0x11c)]<0x1)continue;_0x37037d['sourceList']['push']({'mediaType':_0x463eb9[_0x883e2a(0x1cf)],'path':_0x463eb9[_0x883e2a(0x124)],'name':path[_0x883e2a(0xc3)](_0x463eb9[_0x883e2a(0x124)]),'sourceMovies':_0xfbd8});}}return _0x249591[_0x883e2a(0x172)](_0x37037d);}}),router[_0x3da14a(0xb8)](_0x3da14a(0x121),(_0x759059,_0x15f6b1,_0x4f35d5)=>{const _0x310073=_0x3da14a;if(dbUserTable[_0x310073(0xdb)](_0x759059,_0x15f6b1,_0x310073(0x192),_0x310073(0x19c))==!![]){let _0x3f4b42=getMoviesByParams(_0x15f6b1,_0x759059,0x1,'check_time',0xa,0x0,'desc'),_0x527e3d=getMoviesByParams(_0x15f6b1,_0x759059,0x2,_0x310073(0x19b),0xa,0x0,'desc'),_0xb5144d=_0x310073(0x1c5),_0x225a1a=_0x310073(0x198)+_0xb5144d+'\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id='+_0x759059[_0x310073(0x18c)]['id']+'\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010',_0x90547b=_0x759059[_0x310073(0xba)][_0x310073(0x1cd)][_0x310073(0xe3)](_0x225a1a)[_0x310073(0xa7)](),_0x350c7b=getCollectionList(_0x759059,_0x15f6b1,'ordinary'),_0x13df40=getCollectionList(_0x759059,_0x15f6b1,_0x310073(0x156)),_0x190df5=getMoviesByParams(_0x15f6b1,_0x759059,null,'check_time',0xa,0x0,_0x310073(0xd8),null,null,null,null,null,null,null,_0x310073(0xf7)),_0x13a3c6=getMovieLibrary(_0x759059,_0x15f6b1),_0x13a750={'code':0x0,'movies':_0x3f4b42,'tv':_0x527e3d,'history':_0x90547b,'favorites':_0x190df5,'collectionList':_0x350c7b,'aiCollectionList':_0x13df40,'libraryList':_0x13a3c6};return _0x15f6b1[_0x310073(0x172)](_0x13a750);}}),router[_0x3da14a(0xb8)]('/getTvHomeData2',(_0x56b338,_0x3ebf56,_0x4f0056)=>{const _0x39bdba=_0x3da14a;if(dbUserTable[_0x39bdba(0xdb)](_0x56b338,_0x3ebf56,_0x39bdba(0x192),_0x39bdba(0x19c))==!![]){let _0x18c177=getMoviesByParams(_0x3ebf56,_0x56b338,0x1,_0x39bdba(0x19b),0x1,0x0,_0x39bdba(0xd8)),_0x2bf15f=getMoviesByParams(_0x3ebf56,_0x56b338,0x2,_0x39bdba(0x19b),0x1,0x0,_0x39bdba(0xd8)),_0x4cfb07=_0x39bdba(0x1c5),_0x2db640='SELECT\x20'+_0x4cfb07+'\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id='+_0x56b338[_0x39bdba(0x18c)]['id']+_0x39bdba(0x1b6),_0x5a036c=_0x56b338['app']['dbFileIndex'][_0x39bdba(0xe3)](_0x2db640)[_0x39bdba(0xa7)](),_0x8807f0=getMoviesByParams(_0x3ebf56,_0x56b338,null,_0x39bdba(0x19b),0x1,0x0,_0x39bdba(0xd8),null,null,null,null,null,null,null,_0x39bdba(0xf7)),_0x560918=dbFileIndexTable[_0x39bdba(0xb6)](_0x56b338[_0x39bdba(0xba)][_0x39bdba(0x1cd)],_0x39bdba(0x13f),dbFileIndexTable[_0x39bdba(0x9b)]),_0x1a06b4=dbFileIndexTable['getCountByWhere'](_0x56b338['app']['dbFileIndex'],_0x39bdba(0x130),dbFileIndexTable[_0x39bdba(0x9b)]);_0x56b338['body'][_0x39bdba(0x1e2)]=0x5af3107a3fff,_0x56b338[_0x39bdba(0x1f6)][_0x39bdba(0x11a)]=0x1,_0x56b338['body'][_0x39bdba(0xb3)]='check_time',_0x56b338[_0x39bdba(0x1f6)][_0x39bdba(0xa0)]=_0x39bdba(0xd8),_0x56b338['body'][_0x39bdba(0x16f)]=0x0,_0x56b338[_0x39bdba(0x1f6)][_0x39bdba(0x136)]=0x1;let _0xb37dcb=photoApiUtils[_0x39bdba(0xc8)](_0x56b338,_0x3ebf56),_0x11467f=getMovieLibrary(_0x56b338,_0x3ebf56),_0x5043af={'movieCount':_0x560918[_0x39bdba(0x136)],'tvCount':_0x1a06b4['count'],'code':0x0,'movies':_0x18c177,'tv':_0x2bf15f,'history':_0x5a036c,'favorites':_0x8807f0,'photos':_0xb37dcb,'libraryList':_0x11467f};return _0x3ebf56['json'](_0x5043af);}});let subtitleExtList=['.srt',_0x3da14a(0x18b),'.vtt'];function _0x394b(){const _0x28aad9=['filename','../utils/sqliteUtil','pageSize','../../db/dbMovieFavorite','movieTvCache','-QHD','movieIndexId','SELECT\x20*\x20FROM\x20movie_library\x20','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20','/getTvList','noPermission','3254244rmMeQq','power_delete','trash','-coverCache-','%poster%','json','GET','movieHomeShowHistory','pwdCanNotBeNull','movie_info_name','4351104eCXnIt','login.pwdErr','parseNfo','DELETE\x20FROM\x20movie_library\x20\x20WHERE\x20id=?','dealFirstLetterSingle','sourceFolderList','\x20AND\x20is_tvplay==1','type','\x20order\x20by\x20','ALL','set','select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2','isTvSeries','movieActors','ignoreTvList','UPDATE\x20','index_count','fileExist','enablePwd','REPLACE\x20INTO\x20movie_history(index_id,user_id,time,create_time)\x20VALUES(\x20?,?,?,?)','.ass','currentUser','/addHistory','tvFolderPath','excludeIds','DELETE\x20FROM\x20movie_collection\x20WHERE\x20id=?','startsWith','movie','extname','\x20WHERE\x20title\x20like\x20?','getFilenameNumber','offset','power_change','SELECT\x20','/switchMatchInfo','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20or\x20filename\x20like\x20?)','check_time','power_get','SELECT\x20*\x20from\x20movie_history\x20WHERE\x20index_id=?\x20and\x20user_id=?','findByTitle','../utils/movieUtil','\x20SET\x20show_in_list\x20=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=\x27','thumb.jpg','EDIT','sourceFolderId','share_uid','ordinary','/getSameNameSubtitles','movie_regions','ADD','SELECT\x20id,filename\x20FROM\x20','\x20AND\x20share_for_subuser\x20=\x20?\x20','updateByWhere','useTvSeriesInfo','/deleteIndex','-UHD','indexIdList','dbOther','whereStr','getFavorite','heic','sameFolderImgList','coverMovie','\x20order\x20by\x20m.create_time\x20desc\x20limit\x201','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=3\x20WHERE\x20path\x20like\x20?\x20OR\x20path=?','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','concat','\x20WHERE\x20is_file=0\x20and\x20(path=?\x20or\x20path\x20like\x20?)\x20','\x20AND\x20is_tvplay==0','getById','\x20as\x20f\x20WHERE\x20path\x20like\x20?\x20and\x20is_tvplay=1\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20limit\x20200','getTime','UPDATE\x20file_index_movie\x20set\x20open_duration=?,end_duration=?,skip_open_end=?\x20WHERE\x20id\x20in\x20','listType','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_movie\x20WHERE\x20path\x20like\x20?\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1','ignoreSeasonList','SELECT\x20id\x20FROM\x20','getSeasonNumber','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','/operationLibrary','tvFolderName','index_id','paramsList','orderField','/getMovieKeys','\x20AND\x20id\x20NOT\x20IN\x20(','dbFileIndex','id,username','media_type','parseNfoTvSeries','collectionId','value','pathList','create_time','getFavoriteList','isAdmin','/clearHistory','\x20WHERE\x20path=?\x20and\x20is_file=1\x20and\x20type=2\x20order\x20by\x20filename','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1','operation','.clearlogo.%','\x20AND\x20','coverPath','SELECT\x20*\x20FROM\x20movie_keys\x20WHERE\x20key_type=?\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20200','\x20LIKE\x20?','includes','movieShowMatchName','timestamp','is_file','/checkCollectionPwd','\x20and\x20show_in_list=1','openDuration','-FHD','542744rBkJSP','stat','autoSkip','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=\x27','1145070KIGZUF','movie_index_id','../../db/dbSourceFolderTable','startScanPath','isTvPlay','movieLanguage','10AdweLH','\x20id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list','.fanart.%','catch','body','orderType','INDEX_TABLE_NAME_MOVIE','readdir','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20?\x20or\x20filename\x20like\x20?)\x20and\x20filename\x20not\x20like\x20?','has','duration','sortType','\x20LIMIT\x20','\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id=','-HD','shareUidList','collection_id','\x20AND\x20(filename_fl=?\x20AND\x20show_name_fl=?\x20AND\x20movie_info_name_fl=?)','all','movieHomeShowLibrary','/removeIndexFromCollection','time','operationFail','clearlogo.%','\x20type=2','UPDATE\x20file_index_movie\x20set\x20check_time=?\x20WHERE\x20id=?','UPDATE\x20file_index_movie\x20SET\x20collection_id=?\x20WHERE\x20id\x20in\x20','\x20order\x20by\x20create_time\x20desc','stringify','./photoApiUtils','sortField','/getMovies','enable_pwd','getCountByWhere','dirname','post','seasonCount','app','error\x20data','movieHomeShowMyMedia','movieCollectionNotExist','endsWith','replace','checkSqlInjection','ignoreMatchInfo','SWITCH_MOVIE_INFO','basename','findWithField','../../db/dbFileIndexTable','\x20OFFSET\x20','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20\x20or\x20filename\x20like\x20?)','getPhotoByParams','fromName','saveMovieInfoToDb','HEIC','getPathWhere','searchValue','\x20and\x20filename_number\x20>=\x20?\x20','../../db/dbScanTaskTable','SELECT\x20*\x20from\x20','express','\x20AND\x20(','getExcludePathWhereStr','movie_genres','-seriesPoster','folder_cover_path','/setTitleAndEnding','desc','(filename\x20like\x20?)','\x20SET\x20show_in_list=1\x20WHERE\x20id=?','doUserCanGet','then','\x20SET\x20show_in_list\x20=0,is_tvplay=1\x20WHERE\x20path=?','name','parse','end','../../utils/nfoUtil','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20and\x20filename_number\x20is\x20null','prepare','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20WHERE\x20id\x20in\x20','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20share_for_subuser=1','tvplay','\x20FROM\x20\x20movie_collection\x20WHERE\x20type=?','now','\x20AND\x20(path\x20like\x20?\x20OR\x20filename\x20like\x20?\x20OR\x20movie_info_name\x20like\x20?\x20)','existsSync','getUserPathWhere','SELECT\x20path,filename\x20from\x20','\x20LIMIT\x20?\x20OFFSET\x20?','needSeasonCount','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)','replaceAll','genresType','/getMoviesByGenres','folder.jpg','pwd','DELETE\x20FROM\x20movie_history\x20where\x20user_id=','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0\x20WHERE\x20(path\x20like\x20?\x20OR\x20path=?)','FAVORITE','show_name','/deleteCollection','log','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20id=?','SELECT\x20count(*)\x20as\x20count\x20FROM\x20','\x27\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id','SELECT\x20*\x20FROM\x20source_folder\x20WHERE\x20type=?\x20LIMIT\x2010','excludeFilenameMovie','folder','seasonNumber','is_tvplay','getAllByWhereAndField','22mMpXaA','-seasonCount-','\x20SELECT\x20','sourceType','defaultTranscodeResolution','join','SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?','/getHistory','/addCollection','fanart.%','dataValue','libraryId','addFavorite','30GDJOgR','search','videoPath','REPLACE\x20INTO\x20movie_collection(title,enable_pwd,pwd,user_id,type,data,collection_cover_path,data_value,share_for_subuser)\x20VALUES(\x20?,?,?,?,?,?,?,?,?)','UPDATE\x20movie_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','needLogoPathAndFanart','is_admin','movie_director','timeType','/getIndexDetail','length','movieGenres','UPDATE\x20movie_history\x20SET\x20time=?,create_time=?\x20where\x20index_id=?\x20AND\x20user_id=?','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_genres\x27\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','\x20type=2\x20and\x20is_file=1','/getTvHomeData','push','getTvCount','path','\x20and\x20(filename\x20like\x20?\x20or\x20movie_info_name\x20like\x20?)\x20','run','\x20ORDER\x20BY\x20','/getMovieHomeData','path_list','%fanart%','needTvCount','user_list','\x20id,collection_id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list','\x20or\x20','send','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay==1','indexId','\x20FROM\x20','/getTvSeriesDetail','\x20like\x20?\x20','224108MyKRgH','count','delete','returnErrMsg','tvCount','m.time,\x20f.id,f.is_tvplay,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','index.videoInfoReadFail','\x20AND\x20(filename_fl=?\x20OR\x20show_name_fl=?\x20OR\x20movie_info_name_fl=?)','history','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay!=1','favorite','REPLACE\x20INTO\x20movie_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','seasonList','../../utils/movieSeasonUtil','fileFullPath','2602327KdhLmV','getAllFavoriteByWhere','addScanTask','SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?','../utils/fileUtils','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20where\x20collection_id=?','logo_path','22375092gFcMfK','24MwBJRC','../../db/dbConfigTable','dialog','poster.jpg','/movieFavorite','page','searchStr','sep','../../utils/movieInfoUtil','smart','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010','decodePath','title','movieDirectors','movieRegion','1RHPkMs','data','ignore_match_info','get','checkPath','order\x20field\x20error'];_0x394b=function(){return _0x28aad9;};return _0x394b();}router[_0x3da14a(0xb8)](_0x3da14a(0x1a6),(_0x4188dd,_0x346dbe,_0x32e53e)=>{const _0x3c76bd=_0x3da14a;let _0x97e09a=[],_0x47b35f=null;if(_0x4188dd[_0x3c76bd(0x1f6)][_0x3c76bd(0x114)])_0x47b35f=_0x4188dd[_0x3c76bd(0x1f6)][_0x3c76bd(0x114)],_0x47b35f=fileUtil[_0x3c76bd(0x158)](_0x47b35f);else{if(_0x4188dd[_0x3c76bd(0x1f6)]['id']){let _0x12bfde=_0x4188dd[_0x3c76bd(0x1f6)]['id'],_0x202115=dbFileIndexTable[_0x3c76bd(0x1bc)](_0x4188dd[_0x3c76bd(0xba)][_0x3c76bd(0x1cd)],_0x12bfde,dbFileIndexTable[_0x3c76bd(0x9b)]);_0x202115&&(_0x47b35f=path[_0x3c76bd(0x10a)](_0x202115['path'],_0x202115[_0x3c76bd(0x162)]),_0x4188dd[_0x3c76bd(0xba)][_0x3c76bd(0x1cd)][_0x3c76bd(0xe3)](_0x3c76bd(0xae))[_0x3c76bd(0x126)](Date[_0x3c76bd(0xe8)](),_0x202115['id']));}}function _0x50a90f(){const _0x5d23a8=_0x3c76bd;let _0x2d9ff1=dbConfigTable[_0x5d23a8(0x19e)](_0x4188dd[_0x5d23a8(0xba)][_0x5d23a8(0x1b0)],'subtitleSize'),_0x4af16f=dbConfigTable['findByTitle'](_0x4188dd[_0x5d23a8(0xba)]['dbOther'],_0x5d23a8(0x109));return _0x346dbe['json']({'code':0x0,'data':_0x97e09a,'defaultTranscodeResolution':_0x4af16f?_0x4af16f[_0x5d23a8(0x1d2)]:'1080p\x203mbps','userFontSize':_0x2d9ff1?_0x2d9ff1[_0x5d23a8(0x1d2)]:1.5});}_0x47b35f?fs[_0x3c76bd(0x1e9)](_0x47b35f,(_0x41948a,_0x32371)=>{const _0x1f9173=_0x3c76bd;if(_0x41948a)return _0x50a90f();let _0xa23f56=path[_0x1f9173(0xb7)](_0x47b35f);fs[_0x1f9173(0x9c)](_0xa23f56,(_0x183432,_0x39bbeb)=>{const _0x491826=_0x1f9173;if(_0x183432)return _0x50a90f();let _0x7db893=path[_0x491826(0xc3)](_0x47b35f)[_0x491826(0xbf)](path['extname'](_0x47b35f),''),_0x55cb15=_0x7db893[_0x491826(0xf0)]('\x20','_');for(let _0x46957e in _0x39bbeb){let _0x3bbbcf=_0x39bbeb[_0x46957e],_0x44f46e=path[_0x491826(0x193)](_0x3bbbcf);(_0x3bbbcf[_0x491826(0x191)](_0x7db893)||_0x3bbbcf['startsWith'](_0x55cb15))&&subtitleExtList[_0x491826(0x1e0)](_0x44f46e)&&_0x97e09a[_0x491826(0x122)]({'fileName':path['basename'](_0x3bbbcf),'filePath':path['join'](_0xa23f56,_0x3bbbcf)});}return _0x50a90f();});}):_0x50a90f();}),router[_0x3da14a(0xb8)](_0x3da14a(0x1cb),(_0x3eefc2,_0x1e7fe6,_0x251b93)=>{const _0x17b8c4=_0x3da14a;let _0x392710=_0x3eefc2[_0x17b8c4(0xba)]['dbFileIndex']['prepare'](_0x17b8c4(0x11f))[_0x17b8c4(0xa7)](),_0x5d826f=_0x3eefc2[_0x17b8c4(0xba)]['dbFileIndex']['prepare']('SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_language\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100')[_0x17b8c4(0xa7)](),_0x34ef66=_0x3eefc2[_0x17b8c4(0xba)][_0x17b8c4(0x1cd)][_0x17b8c4(0xe3)]('SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_regions\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100')[_0x17b8c4(0xa7)]();_0x1e7fe6[_0x17b8c4(0x172)]({'code':0x0,'data':_0x392710[_0x17b8c4(0x1b9)](_0x5d826f,_0x34ef66)});}),router[_0x3da14a(0xb8)](_0x3da14a(0x1ad),(_0x243ba4,_0xc48522,_0x4148a9)=>{const _0x2864eb=_0x3da14a;let _0x12b4b1=_0x243ba4['body'][_0x2864eb(0x131)],_0x5f18eb=dbFileIndexTable[_0x2864eb(0x1bc)](_0x243ba4['app']['dbFileIndex'],_0x12b4b1,dbFileIndexTable[_0x2864eb(0x9b)]);if(!_0x5f18eb)return _0xc48522['json']({'code':0x0});if(dbUserTable[_0x2864eb(0xdb)](_0x243ba4,_0xc48522,'movie',_0x2864eb(0x16e),_0x5f18eb[_0x2864eb(0x124)])==!![])return dbFileIndexTable[_0x2864eb(0x137)](_0x243ba4[_0x2864eb(0xba)][_0x2864eb(0x1cd)],_0x12b4b1,dbFileIndexTable[_0x2864eb(0x9b)]),_0xc48522[_0x2864eb(0x172)]({'code':0x0});}),router['post'](_0x3da14a(0x151),(_0x2fd639,_0x556c5f,_0x373a9e)=>{const _0x33c419=_0x3da14a;let _0x3e5174=_0x2fd639[_0x33c419(0x18c)]['id'],_0x475540=parseInt(_0x2fd639[_0x33c419(0x1f6)][_0x33c419(0x168)]),_0x263cfd=dbMovieFavorite[_0x33c419(0x1b2)](_0x2fd639['app'][_0x33c419(0x1cd)],_0x3e5174,_0x475540),_0x7c6494=0x0;if(_0x263cfd)dbMovieFavorite['deleteFavorite'](_0x2fd639['app'][_0x33c419(0x1cd)],_0x3e5174,_0x475540);else{_0x7c6494=0x1;let _0x423382=new Date()[_0x33c419(0x1be)]();_0x2fd639[_0x33c419(0xba)]['dbFileIndex'][_0x33c419(0xe3)]('UPDATE\x20file_index_movie\x20set\x20check_time=?\x20WHERE\x20id=?')[_0x33c419(0x126)](_0x423382,_0x475540),dbMovieFavorite[_0x33c419(0x111)](_0x2fd639[_0x33c419(0xba)][_0x33c419(0x1cd)],_0x3e5174,_0x475540);}return _0x556c5f['json']({'code':0x0,'favorite':_0x7c6494});}),router[_0x3da14a(0xb8)](_0x3da14a(0xd7),(_0x9380d6,_0x53d8fd,_0x5099e7)=>{const _0x515df8=_0x3da14a;try{let _0x21d182=parseInt(_0x9380d6[_0x515df8(0x1f6)][_0x515df8(0x131)]),_0x3ec8f0=dbFileIndexTable[_0x515df8(0x1bc)](_0x9380d6['app']['dbFileIndex'],_0x21d182,dbFileIndexTable[_0x515df8(0x9b)]);if(!_0x3ec8f0)return _0x53d8fd[_0x515df8(0x172)]({'code':0x0});let _0x3f44a6=parseInt(_0x9380d6['body'][_0x515df8(0x1e6)]),_0x2a2233=parseInt(_0x9380d6[_0x515df8(0x1f6)]['endDuration']);!_0x2a2233&&(_0x2a2233=0x0);!_0x3f44a6&&(_0x3f44a6=0x0);let _0x177e02=parseInt(_0x9380d6['body'][_0x515df8(0x1ea)]);if(_0x3f44a6<0x0||_0x2a2233<0x0||_0x3f44a6>_0x3ec8f0['duration']||_0x2a2233>_0x3ec8f0[_0x515df8(0x9f)]||_0x177e02!=0x0&&_0x177e02!=0x1)return _0x9380d6['app']['returnErrMsg'](_0x53d8fd,'Value\x20out\x20of\x20limit');let _0x36c0b4=[_0x3ec8f0];_0x3ec8f0[_0x515df8(0x103)]==0x1&&(_0x36c0b4=_0x9380d6[_0x515df8(0xba)]['dbFileIndex'][_0x515df8(0xe3)](_0x515df8(0x1c3)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x515df8(0x1b8))[_0x515df8(0xa7)](_0x3ec8f0[_0x515df8(0x124)]));let _0x1b01ba='(';for(let _0x5df6e3 in _0x36c0b4){_0x1b01ba+=_0x36c0b4[_0x5df6e3]['id'],_0x5df6e3!=_0x36c0b4[_0x515df8(0x11c)]-0x1&&(_0x1b01ba+=',');}return _0x1b01ba+=')',_0x9380d6[_0x515df8(0xba)][_0x515df8(0x1cd)][_0x515df8(0xe3)](_0x515df8(0x1bf)+_0x1b01ba)['run'](_0x3f44a6,_0x2a2233,_0x177e02),_0x53d8fd[_0x515df8(0x172)]({'code':0x0});}catch(_0x1b5123){return console[_0x515df8(0xfa)](_0x1b5123),_0x9380d6[_0x515df8(0xba)][_0x515df8(0x138)](_0x53d8fd,_0x53d8fd['__'](_0x515df8(0xab)));}});function getMovieLibrary(_0x387acd,_0x1e5fdc,_0x36f4c9){const _0xa89c84=_0x3da14a;let _0x1a2e61=_0x387acd['body']['offset']||0x0,_0x5cd3a8=_0x36f4c9||_0x387acd['body'][_0xa89c84(0x136)]||0x32,_0x5c2c4f=_0x387acd[_0xa89c84(0x1f6)][_0xa89c84(0x113)]||'',_0x1804d8=_0x387acd[_0xa89c84(0x1f6)]['orderField']||'create_time',_0x19dc5f=_0x387acd[_0xa89c84(0x1f6)][_0xa89c84(0x1f7)]||_0xa89c84(0xd8);if(![_0xa89c84(0x1d4),_0xa89c84(0x159)][_0xa89c84(0x1e0)](_0x1804d8))return console[_0xa89c84(0xfa)](_0xa89c84(0x161),_0x1804d8),[];let _0xa942b9=[],_0x2fb294=[],_0x26aa55=_0xa89c84(0x169);_0x387acd[_0xa89c84(0x18c)]['is_admin']==0x1?_0x5c2c4f&&(_0x26aa55+=_0xa89c84(0x194),_0x2fb294[_0xa89c84(0x122)]('%'+_0x5c2c4f+'%')):(_0x26aa55=_0xa89c84(0xe5),_0x5c2c4f&&(_0x26aa55+='\x20and\x20title\x20like\x20?',_0x2fb294['push']('%'+_0x5c2c4f+'%')));_0x26aa55+=_0xa89c84(0x127)+_0x1804d8+'\x20'+_0x19dc5f+_0xa89c84(0xed),_0x2fb294[_0xa89c84(0x122)](_0x5cd3a8),_0x2fb294[_0xa89c84(0x122)](_0x1a2e61),_0xa942b9=_0x387acd['app'][_0xa89c84(0x1cd)][_0xa89c84(0xe3)](_0x26aa55)[_0xa89c84(0xa7)](_0x2fb294);if(_0xa942b9[_0xa89c84(0x11c)]<0x1)return[];for(let _0x4b099a in _0xa942b9){let _0x51f862=_0xa942b9[_0x4b099a];try{let _0x4a7188=JSON[_0xa89c84(0xdf)](_0x51f862[_0xa89c84(0x1a4)]),_0x5edfc0=[];for(let _0x59fed2 of _0x4a7188){let _0x4221b0=dbUserTable[_0xa89c84(0xc4)](_0x387acd[_0xa89c84(0xba)][_0xa89c84(0x1b0)],_0x59fed2,_0xa89c84(0x1ce));_0x5edfc0[_0xa89c84(0x122)](_0x4221b0);}_0xa942b9[_0x4b099a][_0xa89c84(0x12c)]=_0x5edfc0;}catch(_0x1af7c0){console[_0xa89c84(0xfa)](_0x1af7c0);}let _0x3dbe86=getMoviesByParams(_0x1e5fdc,_0x387acd,null,_0xa89c84(0x19b),0x4,0x0,_0xa89c84(0xd8),null,null,null,null,null,null,null,null,null,_0xa942b9[_0x4b099a]['id']);_0xa942b9[_0x4b099a]['dataPreview']=_0x3dbe86;}return _0xa942b9;}router['post'](_0x3da14a(0x1c6),(_0x7636d9,_0x233917,_0x597f36)=>{const _0x8747fc=_0x3da14a;let _0x3c4636=_0x7636d9[_0x8747fc(0x1f6)][_0x8747fc(0x159)],_0x3470d8=_0x7636d9[_0x8747fc(0x1f6)]['libraryId'],_0x56bf07=_0x7636d9[_0x8747fc(0x1f6)][_0x8747fc(0x1d3)],_0x1f00cf=_0x7636d9['body'][_0x8747fc(0xa4)],_0x340a6c=_0x7636d9[_0x8747fc(0x1f6)]['shareForSubUser'],_0x226fa9=_0x7636d9[_0x8747fc(0x1f6)][_0x8747fc(0x1da)];if(_0x226fa9==_0x8747fc(0x173)){let _0x4556da=getMovieLibrary(_0x7636d9,_0x233917);return _0x233917[_0x8747fc(0x172)]({'code':0x0,'data':_0x4556da});}else{if(_0x7636d9[_0x8747fc(0x18c)]['is_admin']!=0x1)return _0x7636d9[_0x8747fc(0xba)][_0x8747fc(0x138)](_0x233917,_0x233917['__'](_0x8747fc(0x16c)));if(_0x226fa9==_0x8747fc(0x1a8)||_0x226fa9=='EDIT'){if(!_0x56bf07||!_0x56bf07 instanceof Array||_0x56bf07[_0x8747fc(0x11c)]<0x1)return _0x7636d9[_0x8747fc(0xba)][_0x8747fc(0x138)](_0x233917,_0x233917['__'](_0x8747fc(0xab)));if(_0x340a6c){if(_0x1f00cf!=null&&!_0x1f00cf instanceof Array)return _0x7636d9[_0x8747fc(0xba)]['returnErrMsg'](_0x233917,_0x233917['__']('operationFail'));}if(sqliteUtil['checkSqlInjection'](JSON['stringify'](_0x56bf07))==!![])return _0x7636d9[_0x8747fc(0xba)][_0x8747fc(0x138)](_0x233917,'error\x20pathList');}if(_0x226fa9==_0x8747fc(0x1a2)&&_0x3470d8)_0x7636d9[_0x8747fc(0xba)][_0x8747fc(0x1cd)]['prepare'](_0x8747fc(0x116))[_0x8747fc(0x126)](_0x3c4636,JSON[_0x8747fc(0xb1)](_0x56bf07),_0x340a6c,JSON[_0x8747fc(0xb1)](_0x1f00cf),_0x3470d8);else{if(_0x226fa9=='DELETE'&&_0x3470d8)_0x7636d9['app'][_0x8747fc(0x1cd)][_0x8747fc(0xe3)](_0x8747fc(0x17a))[_0x8747fc(0x126)](_0x3470d8);else{if(_0x226fa9==_0x8747fc(0x1a8))_0x7636d9[_0x8747fc(0xba)][_0x8747fc(0x1cd)][_0x8747fc(0xe3)](_0x8747fc(0x141))['run'](_0x3c4636,JSON[_0x8747fc(0xb1)](_0x56bf07),_0x340a6c,JSON[_0x8747fc(0xb1)](_0x1f00cf),_0x7636d9[_0x8747fc(0x18c)]['id']);else return _0x7636d9[_0x8747fc(0xba)]['returnErrMsg'](_0x233917,_0x233917['__'](_0x8747fc(0x16c)));}}return _0x233917['json']({'code':0x0});}}),module['exports']=router;