const _0x55faad=_0x1f02;(function(_0x5b1d22,_0x139afd){const _0x47ecb1=_0x1f02,_0x385190=_0x5b1d22();while(!![]){try{const _0x50e361=parseInt(_0x47ecb1(0x1bf))/0x1*(parseInt(_0x47ecb1(0x158))/0x2)+parseInt(_0x47ecb1(0x20f))/0x3*(parseInt(_0x47ecb1(0x1d2))/0x4)+-parseInt(_0x47ecb1(0x173))/0x5+parseInt(_0x47ecb1(0x134))/0x6*(-parseInt(_0x47ecb1(0x186))/0x7)+-parseInt(_0x47ecb1(0x137))/0x8*(-parseInt(_0x47ecb1(0x1b3))/0x9)+parseInt(_0x47ecb1(0x1ac))/0xa*(-parseInt(_0x47ecb1(0x14b))/0xb)+-parseInt(_0x47ecb1(0x169))/0xc*(-parseInt(_0x47ecb1(0x26e))/0xd);if(_0x50e361===_0x139afd)break;else _0x385190['push'](_0x385190['shift']());}catch(_0x498dab){_0x385190['push'](_0x385190['shift']());}}}(_0x8a5c,0xd4091));var express=require(_0x55faad(0x131)),router=express[_0x55faad(0x237)]();let path=require(_0x55faad(0x146));const dbFileIndexTable=require(_0x55faad(0x1e9)),dbUserTable=require('../../db/dbUserTable');var fs=require('fs');let sha256=require(_0x55faad(0x1f3));const dbConfigTable=require(_0x55faad(0x221)),dbSourceFolderTable=require(_0x55faad(0x220)),nfoUtil=require('../../utils/nfoUtil'),dbMovieFavorite=require('../../db/dbMovieFavorite'),movieUtil=require(_0x55faad(0x1ae));let fileUtil=require(_0x55faad(0x1e6));const sqliteUtil=require('../utils/sqliteUtil'),photoApiUtils=require('./photoApiUtils');let movieSeasonUtil=require(_0x55faad(0x245)),movieInfoUtil=require(_0x55faad(0x1fe));const dbScanTaskTable=require(_0x55faad(0x218));let movieFieldStr='\x20id,collection_id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list';function getTvSeriesPoster(_0x4fe62b){const _0x50b32c=_0x55faad;let _0x8615e='',_0xcb7874=path[_0x50b32c(0x21a)](path[_0x50b32c(0x172)](_0x4fe62b[_0x50b32c(0x146)]),_0x50b32c(0x20c));return fs[_0x50b32c(0x16f)](_0xcb7874)&&(_0x8615e=_0xcb7874),!_0x8615e&&(_0xcb7874=path[_0x50b32c(0x21a)](path[_0x50b32c(0x172)](_0x4fe62b[_0x50b32c(0x146)]),'poster.jpeg'),fs[_0x50b32c(0x16f)](_0xcb7874)&&(_0x8615e=_0xcb7874)),!_0x8615e&&(_0xcb7874=path[_0x50b32c(0x21a)](path['dirname'](_0x4fe62b['path']),_0x50b32c(0x133)),fs[_0x50b32c(0x16f)](_0xcb7874)&&(_0x8615e=_0xcb7874)),!_0x8615e&&(_0xcb7874=path[_0x50b32c(0x21a)](path[_0x50b32c(0x172)](_0x4fe62b['path']),_0x50b32c(0x1fb)),fs['existsSync'](_0xcb7874)&&(_0x8615e=_0xcb7874)),_0x8615e;}function _0x1f02(_0x900eda,_0x5b26f5){const _0x8a5c4=_0x8a5c();return _0x1f02=function(_0x1f0299,_0x32a6e9){_0x1f0299=_0x1f0299-0x11f;let _0x1e792=_0x8a5c4[_0x1f0299];return _0x1e792;},_0x1f02(_0x900eda,_0x5b26f5);}router[_0x55faad(0x1ee)](_0x55faad(0x1c6),(_0x1f58f8,_0x241cc0,_0x578ab7)=>{const _0x4d6fd0=_0x55faad;let _0x4f21a5=_0x1f58f8[_0x4d6fd0(0x1bd)]['id'],_0xe0eb38=dbFileIndexTable['getById'](_0x1f58f8[_0x4d6fd0(0x121)][_0x4d6fd0(0x1d8)],_0x4f21a5,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0xe0eb38)return _0x1f58f8[_0x4d6fd0(0x121)][_0x4d6fd0(0x138)](_0x241cc0,_0x241cc0['__'](_0x4d6fd0(0x17a)));if(dbUserTable['doUserCanGet'](_0x1f58f8,_0x241cc0,_0x4d6fd0(0x231),_0x4d6fd0(0x227),_0xe0eb38[_0x4d6fd0(0x146)])==!![]){nfoUtil[_0x4d6fd0(0x211)](_0xe0eb38)[_0x4d6fd0(0x213)](_0x8f63ce=>{const _0xe7a5d4=_0x4d6fd0;_0xe0eb38=_0x8f63ce,_0x1f58f8[_0xe7a5d4(0x1bd)][_0xe7a5d4(0x24e)]=!![],_0x1f58f8['body'][_0xe7a5d4(0x209)]=0x1,_0xe0eb38=addFolderCoverPath(_0x241cc0,_0x1f58f8,_0xe0eb38),_0x405e7c();})[_0x4d6fd0(0x248)](_0x56e51a=>{const _0x416acd=_0x4d6fd0;console[_0x416acd(0x162)](_0x416acd(0x152),_0x56e51a),_0xe0eb38=addFolderCoverPath(_0x241cc0,_0x1f58f8,_0xe0eb38),_0xe0eb38[_0x416acd(0x26c)]=_0xe0eb38[_0x416acd(0x178)],_0x405e7c();});function _0x405e7c(){const _0x22d2e7=_0x4d6fd0;addTvFolderPathAndName(_0xe0eb38),setLogoAndFanart(_0x1f58f8,_0xe0eb38,_0xe0eb38[_0x22d2e7(0x150)]);let _0x3b4caa=dbMovieFavorite[_0x22d2e7(0x236)](_0x1f58f8[_0x22d2e7(0x121)][_0x22d2e7(0x1d8)],_0x1f58f8[_0x22d2e7(0x11f)]['id'],_0xe0eb38['id']);_0x3b4caa?_0xe0eb38[_0x22d2e7(0x241)]=0x1:_0xe0eb38[_0x22d2e7(0x241)]=0x0;let _0x389c86={'code':0x0,'movieIndex':_0xe0eb38};fs['stat'](_0xe0eb38[_0x22d2e7(0x150)],(_0x1848aa,_0x4ca966)=>{const _0x58ad59=_0x22d2e7;_0x389c86[_0x58ad59(0x225)]=_0x1848aa?0x0:0x1,_0x241cc0[_0x58ad59(0x1c1)](_0x389c86),_0xe0eb38[_0x58ad59(0x269)]==0x1&&_0xe0eb38['tvFolderPath']&&(dbScanTaskTable[_0x58ad59(0x147)](_0x1f58f8[_0x58ad59(0x121)]['dbOther'],_0x58ad59(0x231),_0xe0eb38[_0x58ad59(0x150)]),process[_0x58ad59(0x1cc)]({'type':'startScanPath','source_type':_0x58ad59(0x231),'restartWatcher':![]}));});}}}),router[_0x55faad(0x1ee)]('/getMovieDetail',(_0x3cf69a,_0x54c6c3,_0x58bb2a)=>{const _0x32f7b3=_0x55faad;let _0x5959e6=_0x3cf69a[_0x32f7b3(0x1bd)]['id'],_0x2a54f3=dbFileIndexTable[_0x32f7b3(0x206)](_0x3cf69a['app'][_0x32f7b3(0x1d8)],_0x5959e6,dbFileIndexTable[_0x32f7b3(0x229)]);if(!_0x2a54f3)return _0x3cf69a[_0x32f7b3(0x121)]['returnErrMsg'](_0x54c6c3,_0x54c6c3['__']('index.videoInfoReadFail'));if(dbUserTable[_0x32f7b3(0x1d4)](_0x3cf69a,_0x54c6c3,'movie',_0x32f7b3(0x227),_0x2a54f3['path'])==!![]){nfoUtil[_0x32f7b3(0x18e)](_0x2a54f3,!![],![])[_0x32f7b3(0x213)](_0x1f64e1=>{const _0x42810f=_0x32f7b3;_0x2a54f3=_0x1f64e1,_0x3cf69a[_0x42810f(0x1bd)][_0x42810f(0x24e)]=!![],_0x2a54f3=addFolderCoverPath(_0x54c6c3,_0x3cf69a,_0x2a54f3),movieInfoUtil[_0x42810f(0x192)](_0x3cf69a[_0x42810f(0x121)][_0x42810f(0x1d8)],_0x2a54f3['id'],_0x1f64e1),_0x1f5c5f();})[_0x32f7b3(0x248)](()=>{_0x2a54f3=addFolderCoverPath(_0x54c6c3,_0x3cf69a,_0x2a54f3),_0x1f5c5f();});function _0x1f5c5f(){const _0x2631be=_0x32f7b3;let _0x113806=dbMovieFavorite[_0x2631be(0x236)](_0x3cf69a['app'][_0x2631be(0x1d8)],_0x3cf69a[_0x2631be(0x11f)]['id'],_0x2a54f3['id']);_0x113806?_0x2a54f3[_0x2631be(0x241)]=0x1:_0x2a54f3[_0x2631be(0x241)]=0x0;let _0x277368=null;if(_0x2a54f3['is_tvplay']==0x1){let _0x916cfa=_0x3cf69a[_0x2631be(0x121)][_0x2631be(0x1d8)][_0x2631be(0x156)](_0x2631be(0x157)+dbFileIndexTable[_0x2631be(0x229)]+_0x2631be(0x14e))[_0x2631be(0x148)](_0x2a54f3[_0x2631be(0x146)]),_0x2949bd='(';for(let _0x12dce1 in _0x916cfa){_0x2949bd+=_0x916cfa[_0x12dce1]['id'],_0x12dce1!=_0x916cfa[_0x2631be(0x1b0)]-0x1&&(_0x2949bd+=',');}_0x2949bd+=')';let _0x48f189=_0x3cf69a[_0x2631be(0x121)][_0x2631be(0x1d8)]['prepare']('SELECT\x20index_id\x20FROM\x20movie_history\x20where\x20index_id\x20in\x20'+_0x2949bd+_0x2631be(0x1df))['get']();_0x48f189&&(_0x277368=dbFileIndexTable[_0x2631be(0x206)](_0x3cf69a['app'][_0x2631be(0x1d8)],_0x48f189['index_id'],dbFileIndexTable[_0x2631be(0x229)]));}let _0x300a86={'code':0x0,'movieIndex':_0x2a54f3,'lastTvEpisodeIndex':_0x277368},_0x1d5290=[];try{let _0x15946d=_0x3cf69a[_0x2631be(0x121)][_0x2631be(0x1d8)][_0x2631be(0x156)](_0x2631be(0x1d9)+_0x2a54f3[_0x2631be(0x146)]+'\x27\x20and\x20type=1\x20and\x20is_file=1\x20limit\x2020')['all']();for(let _0x522df6 in _0x15946d){let _0x12e2bb=path['join'](_0x15946d[_0x522df6][_0x2631be(0x146)],_0x15946d[_0x522df6]['filename']);(_0x3cf69a[_0x2631be(0x11f)][_0x2631be(0x270)]==0x1||dbUserTable[_0x2631be(0x1d4)](_0x3cf69a,_0x54c6c3,'folder','power_get',_0x12e2bb,!![])==!![])&&_0x1d5290[_0x2631be(0x161)](_0x12e2bb);}_0x300a86[_0x2631be(0x1aa)]=_0x1d5290;}catch(_0x5bb91b){}let _0x145492=path[_0x2631be(0x21a)](_0x2a54f3['path'],_0x2a54f3[_0x2631be(0x23e)]);fs[_0x2631be(0x142)](_0x145492,(_0x3e85f9,_0x5f19d7)=>{const _0x1fb221=_0x2631be;_0x300a86[_0x1fb221(0x225)]=_0x3e85f9?0x0:0x1,_0x300a86[_0x1fb221(0x262)]=_0x145492,_0x54c6c3[_0x1fb221(0x1c1)](_0x300a86),_0x2a54f3['is_tvplay']==0x1&&_0x2a54f3[_0x1fb221(0x150)]&&_0x2a54f3[_0x1fb221(0x1e5)]!=0x1&&(dbScanTaskTable[_0x1fb221(0x147)](_0x3cf69a[_0x1fb221(0x121)][_0x1fb221(0x247)],'movie',_0x2a54f3['tvFolderPath']),process[_0x1fb221(0x1cc)]({'type':'startScanPath','source_type':_0x1fb221(0x231),'restartWatcher':![]}));});}}}),router[_0x55faad(0x1ee)](_0x55faad(0x149),(_0x82f991,_0x45ca55,_0x31e1e3)=>{const _0x548371=_0x55faad;let _0x58e171=_0x82f991[_0x548371(0x1bd)]['id'],_0x2712c1=_0x82f991[_0x548371(0x1bd)]['page']||0x0,_0x113a2a=_0x82f991[_0x548371(0x1bd)][_0x548371(0x1ad)]||0xa,_0x4b2c54=_0x82f991[_0x548371(0x1bd)][_0x548371(0x13d)],_0xa9e194=_0x82f991[_0x548371(0x1bd)]['fromName'],_0x5368e2=_0x82f991[_0x548371(0x1bd)][_0x548371(0x199)],_0xb86253=_0x82f991[_0x548371(0x1bd)][_0x548371(0x123)],_0x15324a=dbFileIndexTable[_0x548371(0x206)](_0x82f991[_0x548371(0x121)][_0x548371(0x1d8)],_0x58e171,dbFileIndexTable[_0x548371(0x229)]);if(!_0x15324a)return _0x82f991['app'][_0x548371(0x138)](_0x45ca55,_0x45ca55['__'](_0x548371(0x17a)));let _0x2c7a19=movieFieldStr,_0x25eb68=[],_0x3f1afb=0x0;if(dbUserTable['doUserCanGet'](_0x82f991,_0x45ca55,_0x548371(0x231),_0x548371(0x227),_0x15324a[_0x548371(0x146)])==!![]){if(_0x5368e2==0x1)return _0x2c8164();let _0x538448=_0x82f991[_0x548371(0x121)][_0x548371(0x1d8)][_0x548371(0x156)]('SELECT\x20id,filename\x20FROM\x20'+dbFileIndexTable[_0x548371(0x229)]+'\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20and\x20filename_number\x20is\x20null')[_0x548371(0x148)](_0x15324a[_0x548371(0x146)]);for(let _0x3706c5 in _0x538448){let _0x8713bd=_0x538448[_0x3706c5];if(_0x8713bd['filename']){let _0xd5d2fb=movieUtil['getFilenameNumber'](_0x8713bd[_0x548371(0x23e)]);_0x82f991[_0x548371(0x121)]['dbFileIndex'][_0x548371(0x156)]('UPDATE\x20'+dbFileIndexTable[_0x548371(0x229)]+_0x548371(0x260))[_0x548371(0x160)](_0xd5d2fb,_0x8713bd['id']);}}let _0x519151=dbUserTable[_0x548371(0x20d)](_0x82f991,_0x548371(0x231),_0x548371(0x227),!![]),_0x5262fe=[..._0x519151[_0x548371(0x242)]],_0x2fbe7b=_0x548371(0x1f2);_0x2fbe7b+=_0x519151[_0x548371(0x198)],_0x2fbe7b+='\x20and\x20path=?\x20and\x20is_tvplay=1\x20',_0x5262fe['push'](_0x15324a[_0x548371(0x146)]);_0x4b2c54&&(_0x2fbe7b+=_0x548371(0x14a),_0x5262fe['push']('%'+_0x4b2c54+'%','%'+_0x4b2c54+'%'));if(_0xa9e194){let _0x533d7d=movieUtil['getFilenameNumber'](_0xa9e194);_0x533d7d?(_0x2fbe7b+=_0x548371(0x235),_0x5262fe[_0x548371(0x161)](_0x533d7d)):(_0x2fbe7b+=_0x548371(0x272),_0x5262fe['push'](_0xa9e194));}let _0x13329b=_0x2fbe7b+'';_0x2fbe7b+=_0x548371(0x207);let _0xa927f=_0x548371(0x1c7)+_0x2c7a19+_0x548371(0x22d)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+'\x20as\x20f\x20WHERE\x20'+_0x2fbe7b+'\x20LIMIT\x20'+_0x113a2a+_0x548371(0x243)+_0x2712c1*_0x113a2a;_0x25eb68=_0x82f991[_0x548371(0x121)][_0x548371(0x1d8)][_0x548371(0x156)](_0xa927f)[_0x548371(0x148)](_0x5262fe);let _0x2bdd5c=_0x548371(0x22c)+dbFileIndexTable[_0x548371(0x229)]+_0x548371(0x1a4)+_0x13329b+'\x20',_0x488239=_0x82f991[_0x548371(0x121)]['dbFileIndex']['prepare'](_0x2bdd5c)['get'](_0x5262fe);_0x3f1afb=_0x488239[_0x548371(0x1b2)];if(_0x25eb68['length']>0x0){let _0x39fe79=0x0;for(let _0x694633 in _0x25eb68){let _0x320abe=_0x25eb68[_0x694633];nfoUtil[_0x548371(0x18e)](_0x320abe,!![],!![])[_0x548371(0x213)](_0xafb0ad=>{const _0x3609dd=_0x548371;_0x39fe79+=0x1,_0x25eb68[_0x694633]=_0xafb0ad,_0x25eb68[_0x694633]=addFolderCoverPath(_0x45ca55,_0x82f991,_0x25eb68[_0x694633],!![]),_0x39fe79>=_0x25eb68[_0x3609dd(0x1b0)]&&_0x2c8164();})[_0x548371(0x248)](()=>{const _0x2bf109=_0x548371;_0x39fe79+=0x1,_0x25eb68[_0x694633]=addFolderCoverPath(_0x45ca55,_0x82f991,_0x25eb68[_0x694633],!![]),_0x39fe79>=_0x25eb68[_0x2bf109(0x1b0)]&&_0x2c8164();});}}else _0x2c8164();function _0x2c8164(){const _0x1ab491=_0x548371;let _0x2896cb={'code':0x0,'tvplayList':_0x25eb68,'count':_0x3f1afb,'pageSize':_0x113a2a};if(!_0xb86253){let _0x251a46=path['basename'](_0x15324a[_0x1ab491(0x146)]),_0x5094f8=movieSeasonUtil[_0x1ab491(0x171)](_0x251a46);if(_0x5094f8>-0x1){let _0x19c2a0=_0x1ab491(0x1c7)+_0x2c7a19+_0x1ab491(0x22d)+dbFileIndexTable[_0x1ab491(0x229)]+'\x20as\x20f\x20WHERE\x20path\x20like\x20?\x20and\x20is_tvplay=1\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20limit\x20200',_0x436a62=_0x82f991['app'][_0x1ab491(0x1d8)]['prepare'](_0x19c2a0)[_0x1ab491(0x148)](path[_0x1ab491(0x172)](_0x15324a[_0x1ab491(0x146)])+path[_0x1ab491(0x1a1)]+'%'),_0x3c0819=[];for(let _0x1851c7 of _0x436a62){let _0x2bb8b0=path[_0x1ab491(0x23f)](_0x1851c7[_0x1ab491(0x146)]),_0x296f34=movieSeasonUtil['getSeasonNumber'](_0x2bb8b0);_0x296f34>-0x1&&(_0x1851c7[_0x1ab491(0x266)]=_0x296f34,_0x3c0819['push'](_0x1851c7));}for(let _0x43e694 of _0x3c0819){_0x43e694=addFolderCoverPath(_0x45ca55,_0x82f991,_0x43e694);let _0x2b38a0=dbFileIndexTable[_0x1ab491(0x203)](_0x82f991[_0x1ab491(0x121)]['dbFileIndex'],_0x43e694);_0x43e694['tvCount']=_0x2b38a0[_0x1ab491(0x1b2)];}_0x3c0819[_0x1ab491(0x1b0)]>0x0&&(_0x3c0819['sort'](function(_0x579fa7,_0x193ef8){const _0x1af2b9=_0x1ab491;return _0x579fa7[_0x1af2b9(0x266)]-_0x193ef8[_0x1af2b9(0x266)];}),_0x2896cb[_0x1ab491(0x183)]=_0x3c0819);}}return _0x45ca55[_0x1ab491(0x1c1)](_0x2896cb);}}}),router[_0x55faad(0x1ee)](_0x55faad(0x1e7),(_0x15709d,_0x2ad517,_0x1a35e5)=>{const _0x5060ac=_0x55faad;let _0x57ad39=_0x15709d['body'][_0x5060ac(0x25f)],_0x291922=[];for(let _0x2ddd07 of _0x57ad39){let _0x1778c5=dbFileIndexTable['getById'](_0x15709d[_0x5060ac(0x121)]['dbFileIndex'],_0x2ddd07,dbFileIndexTable[_0x5060ac(0x229)]);if(!_0x1778c5)continue;if(dbUserTable[_0x5060ac(0x1d4)](_0x15709d,_0x2ad517,'',_0x5060ac(0x165),_0x1778c5[_0x5060ac(0x146)])!==!![])continue;let _0x278300=path[_0x5060ac(0x23f)](_0x1778c5['path']),_0xefb2f2=movieSeasonUtil[_0x5060ac(0x171)](_0x278300);if(_0xefb2f2>-0x1){let _0x2ea4aa=path[_0x5060ac(0x21a)](path['dirname'](_0x1778c5[_0x5060ac(0x146)])),_0x4830e8=_0x15709d[_0x5060ac(0x121)][_0x5060ac(0x1d8)][_0x5060ac(0x156)]('select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2')['all'](_0x2ea4aa+path[_0x5060ac(0x1a1)]+'%',_0x2ea4aa);for(let _0xb2bfb4 of _0x4830e8){_0x291922[_0x5060ac(0x161)](_0xb2bfb4['id']);}}}_0x291922['length']>0x0&&(_0x57ad39=[..._0x57ad39,..._0x291922]);if(_0x57ad39[_0x5060ac(0x1b0)]<0x1)return _0x2ad517[_0x5060ac(0x1c1)]({'code':0x0});let _0x251ea9='(';for(let _0x1e1aba in _0x57ad39){_0x251ea9+=_0x57ad39[_0x1e1aba],_0x1e1aba!=_0x57ad39['length']-0x1&&(_0x251ea9+=',');}return _0x251ea9+=')',_0x15709d[_0x5060ac(0x121)][_0x5060ac(0x1d8)][_0x5060ac(0x156)]('UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20WHERE\x20id\x20in\x20'+_0x251ea9)[_0x5060ac(0x160)](),_0x2ad517['json']({'code':0x0});}),router[_0x55faad(0x1ee)](_0x55faad(0x180),(_0x282e37,_0x258b9d,_0x46b29d)=>{const _0x30b460=_0x55faad;let _0x44dea3=_0x282e37[_0x30b460(0x1bd)][_0x30b460(0x1d3)],_0x19c14b=_0x282e37[_0x30b460(0x1bd)][_0x30b460(0x168)],_0x192005=_0x282e37[_0x30b460(0x1bd)][_0x30b460(0x1c5)];function _0x2c22fa(_0x2692a1){const _0x22b2d8=_0x30b460;let _0xe770c0=[];for(let _0x3f8b8b in _0x2692a1){_0xe770c0[_0x22b2d8(0x161)](_0x2692a1[_0x3f8b8b]['id']);}inSql='(';for(let _0x5b87f5 in _0xe770c0){inSql+=_0xe770c0[_0x5b87f5],_0x5b87f5!=_0xe770c0[_0x22b2d8(0x1b0)]-0x1&&(inSql+=',');}return inSql+=')',inSql;}if(_0x44dea3&&_0x19c14b){let _0x39d035=dbFileIndexTable['getById'](_0x282e37[_0x30b460(0x121)][_0x30b460(0x1d8)],_0x19c14b,dbFileIndexTable[_0x30b460(0x229)]),_0x68af34='('+_0x19c14b+')';if(!_0x39d035)return _0x282e37['app']['returnErrMsg'](_0x258b9d,_0x258b9d['__']('operationFail'),_0x30b460(0x174));if(dbUserTable[_0x30b460(0x1d4)](_0x282e37,_0x258b9d,'',_0x30b460(0x165),_0x39d035[_0x30b460(0x146)])!==!![])return;let _0x3d3fb1=path[_0x30b460(0x23f)](_0x39d035['path']),_0x4d531e=movieSeasonUtil['getSeasonNumber'](_0x3d3fb1);_0x4d531e>-0x1&&(_0x39d035[_0x30b460(0x244)]=0x0,_0x39d035['path']=path[_0x30b460(0x172)](_0x39d035['path']),_0x39d035[_0x30b460(0x23e)]='');if(_0x39d035['is_file']!=0x1){let _0x1a21ec=path['join'](_0x39d035[_0x30b460(0x146)],_0x39d035[_0x30b460(0x23e)]);console[_0x30b460(0x162)](_0x30b460(0x1a9),_0x1a21ec);let _0x34a3c1=_0x282e37[_0x30b460(0x121)]['dbFileIndex'][_0x30b460(0x156)](_0x30b460(0x200))['all'](_0x1a21ec+path[_0x30b460(0x1a1)]+'%',_0x1a21ec);if(_0x34a3c1['length']<0x1)return _0x258b9d[_0x30b460(0x1c1)]({'code':0x0});_0x68af34=_0x2c22fa(_0x34a3c1);}return _0x282e37[_0x30b460(0x121)][_0x30b460(0x1d8)][_0x30b460(0x156)](_0x30b460(0x191)+_0x68af34+_0x30b460(0x219))['run'](_0x44dea3),_0x258b9d[_0x30b460(0x1c1)]({'code':0x0});}else{if(_0x44dea3&&_0x192005){let _0x4a6390=_0x282e37[_0x30b460(0x121)][_0x30b460(0x1d8)]['prepare']('select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2')[_0x30b460(0x148)](_0x192005+path['sep']+'%',_0x192005),_0x232667=_0x2c22fa(_0x4a6390);return _0x282e37[_0x30b460(0x121)][_0x30b460(0x1d8)]['prepare'](_0x30b460(0x191)+_0x232667+_0x30b460(0x219))[_0x30b460(0x160)](_0x44dea3),_0x258b9d[_0x30b460(0x1c1)]({'code':0x0});}else return _0x282e37['app'][_0x30b460(0x138)](_0x258b9d,_0x258b9d['__'](_0x30b460(0x13e)),'dialog');}});function _0x8a5c(){const _0x1f0f5f=['movie_language','/getMovieKeys','\x20id,title,data,enable_pwd,collection_cover_path,data_value,create_time,share_for_subuser\x20','searchStr','operationFail','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=3\x20WHERE\x20path\x20like\x20?\x20OR\x20path=?','get','/movieFavorite','stat','1080p\x203mbps','DELETE\x20FROM\x20movie_collection\x20WHERE\x20id=?','folder_cover_path','path','addScanTask','all','/getTvList','\x20and\x20(filename\x20like\x20?\x20or\x20movie_info_name\x20like\x20?)\x20','4059ythVVR','operation','firstLetter','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','SELECT\x20*\x20FROM\x20source_folder\x20WHERE\x20type=?\x20LIMIT\x2010','tvFolderPath','HEIC','未找到NFO信息','.srt','.vtt','updateByWhere','prepare','SELECT\x20id\x20FROM\x20','4SIQVKK','\x20SET\x20show_in_list=1\x20WHERE\x20id=?','time','/switchMatchInfo','/getTvHomeData2','trim','\x20type=2','\x27\x20or\x20filename\x20like\x20\x27','run','push','log','ignoreMatchInfo','/getMovieHomeData','power_change','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010','desc','indexId','1570068AlzUMn','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20share_for_subuser=1','deleteFavorite','coverPath','REPLACE\x20INTO\x20movie_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','\x20ORDER\x20BY\x20','existsSync','/addCollection','getSeasonNumber','dirname','1508910VcxYwP','dialog','sourceFolderList','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay==1','getAllByWhereAndField','tvFolderName','movie_genres','index.videoInfoReadFail','openDuration','-clearlogo.%','timestamp','SELECT\x20*\x20from\x20movie_history\x20WHERE\x20index_id=?\x20and\x20user_id=?','\x20LIKE\x20?','/addIndexToCollection','exports','UPDATE\x20movie_history\x20SET\x20time=?,create_time=?\x20where\x20index_id=?\x20AND\x20user_id=?','seasonList','defaultTranscodeResolution','\x20and\x20title\x20like\x20?','21mlHAEv','movie_regions','extname','\x20AND\x20(filename_fl=?\x20AND\x20show_name_fl=?\x20AND\x20movie_info_name_fl=?)','/getHistory','shareForSubUser','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_language\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','GET','parseNfo','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20where\x20collection_id=?','shareUidList','UPDATE\x20file_index_movie\x20SET\x20collection_id=?\x20WHERE\x20id\x20in\x20','saveMovieInfoToDb','fanart_path','/getCollection','key_value','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20or\x20filename\x20like\x20?)','-coverCache-','whereStr','ignoreTvList','error\x20pathList','%poster%','SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?','ALL','needSeasonCount','\x20SELECT\x20','movieLanguage','sep','check_time','login.pwdErr','\x20\x20WHERE\x20','collectionPwd','checkSqlInjection','getExcludePathWhereStr','orderType','checkPath','sameFolderImgList','tvplay','45110kpIrfD','pageSize','../utils/movieUtil','\x20AND\x20is_tvplay==0','length','sortField','count','5868pGRmuw','has','needTvCount','endDuration','stringify','dataPreview','pwd','index_count','SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?','replace','body','DELETE\x20FROM\x20movie_library\x20\x20WHERE\x20id=?','773686PBYUHB','SELECT\x20id,title,enable_pwd,create_time\x20FROM\x20movie_collection\x20where\x20id=?\x20and\x20pwd=?','json','getAllFavoriteByWhere','noPermission','duration','filepath','/getTvSeriesDetail','SELECT\x20','.jpg','movieActors','sortType','value','send','-seriesPoster','movieIndexId','/getSameNameSubtitles','\x20AND\x20is_tvplay==1','\x20AND\x20(path\x20like\x20?\x20OR\x20filename\x20like\x20?\x20OR\x20movie_info_name\x20like\x20?\x20)','16WrHZII','collectionId','doUserCanGet','\x20like\x20?\x20','m.time,\x20f.id,f.is_tvplay,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','SELECT\x20*\x20from\x20','dbFileIndex','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=\x27','name','\x20order\x20by\x20m.create_time\x20desc\x20limit\x201','set','sourceType','/getTvHomeData','\x20order\x20by\x20create_time\x20desc','%season','EDIT','power_delete','-UHD','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20\x20or\x20filename\x20like\x20?)','isTvSeries','../utils/fileUtils','/removeIndexFromCollection','/addHistory','../../db/dbFileIndexTable','media_type','/clearHistory','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20id=?','\x20AND\x20title\x20like\x20?\x20','post','(filename\x20like\x20?)','includes','\x20FROM\x20\x20movie_collection\x20WHERE\x20type=?','\x20type=2\x20and\x20is_file=1','sha256','status','.ass','decodePath','-fanart.%','replaceAll','share_uid','\x20WHERE\x20path=?\x20and\x20is_file=1\x20and\x20type=2\x20order\x20by\x20filename','thumb.jpg','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2050','.fanart.%','../../utils/movieInfoUtil','%fanart%','select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_movie\x20WHERE\x20path\x20like\x20?\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1','videoPath','getTvCount','SELECT\x20path,filename\x20from\x20','REPLACE\x20INTO\x20movie_history(index_id,user_id,time,create_time)\x20VALUES(\x20?,?,?,?)','getById','\x20order\x20by\x20filename_number,filename','movieRegion','useTvSeriesInfo','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_genres\x27\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','poster.jpg','getUserPathWhere','movieDirectors','476160vtdlSn','\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id=','parseNfoTvSeries','seasonCount','then','SWITCH_MOVIE_INFO','search','genresType','end','../../db/dbScanTaskTable','\x20and\x20show_in_list=1','join','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id','getTime','ordinary','path_list','DELETE\x20FROM\x20movie_history\x20where\x20user_id=','../../db/dbSourceFolderTable','../../db/dbConfigTable','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay!=1','smart','movie_actor','fileExist','enablePwd','power_get','tvCount','INDEX_TABLE_NAME_MOVIE','autoSkip','listType','SELECT\x20count(*)\x20as\x20count\x20FROM\x20','\x20FROM\x20','timeType','pwdCanNotBeNull','getFavoriteList','movie','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0\x20WHERE\x20(path\x20like\x20?\x20OR\x20path=?)','/getIndexDetail','getCountByWhere','\x20and\x20filename_number\x20>=\x20?\x20','getFavorite','Router','excludePathMovie','sourceFolderId','delete','-seasonCount-','parse','UPDATE\x20file_index_movie\x20set\x20open_duration=?,end_duration=?,skip_open_end=?\x20WHERE\x20id\x20in\x20','filename','basename','getPathWhere','favorite','paramsList','\x20OFFSET\x20','is_file','../../utils/movieSeasonUtil','\x20AND\x20(filename_fl=?\x20OR\x20show_name_fl=?\x20OR\x20movie_info_name_fl=?)','dbOther','catch','type','movieTvCache','endsWith','ADD','offset','needLogoPathAndFanart','\x20SET\x20show_in_list=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=?\x20or\x20path\x20like\x20?','movieShowMatchName','dataValue','\x20SET\x20show_in_list\x20=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=\x27','title','\x20LIMIT\x20?\x20OFFSET\x20?','movieHomeShowMyMedia','movieHomeShowHistory','UPDATE\x20','/getMovies','excludeIds','movieCollectionNotExist','history','\x20SET\x20show_in_list\x20=0,is_tvplay=1\x20WHERE\x20path=?','ignore_match_info','fanart.%','indexIdList','\x20SET\x20filename_number=?\x20\x20WHERE\x20\x20id=?','create_time','fileFullPath','\x20AND\x20collection_id=0','movieHomeShowLibrary','searchValue','seasonNumber','isAdmin','/setTitleAndEnding','is_tvplay','dealFirstLetterSingle','startsWith','movie_info_name','\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20check_time\x20DESC\x20LIMIT\x20?','13rDQTuU','subtitleSize','is_admin','SELECT\x20*\x20FROM\x20movie_library\x20','\x20and\x20filename\x20>=\x20?\x20','currentUser','\x20AND\x20','app','readdir','ignoreSeasonList','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_regions\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','coverMovie','findByTitle','movie_director','substr','FAVORITE','pageCount','logo_path','UPDATE\x20movie_collection\x20SET\x20title=?,data=?,enable_pwd=?,pwd=?,collection_cover_path=?,data_value=?,share_for_subuser=?\x20WHERE\x20id=?','enable_pwd','getPhotoByParams','REPLACE\x20INTO\x20movie_collection(title,enable_pwd,pwd,user_id,type,data,collection_cover_path,data_value,share_for_subuser)\x20VALUES(\x20?,?,?,?,?,?,?,?,?)','express','movie_index_id','folder.jpg','167922NKZqNg','data','clearlogo.%','7432JrplvF','returnErrMsg','-HD'];_0x8a5c=function(){return _0x1f0f5f;};return _0x8a5c();}function getCollectionList(_0x6e684,_0x2c9faf,_0x37de6f){const _0x5d17f2=_0x55faad;let _0xe38ab=[],_0x1dd988=_0x6e684[_0x5d17f2(0x1bd)][_0x5d17f2(0x1b2)]||0x32,_0x1a52d2=_0x6e684[_0x5d17f2(0x1bd)][_0x5d17f2(0x24d)]||0x0,_0x29da0a=_0x6e684[_0x5d17f2(0x1bd)]['orderField']||'id',_0x37567c=_0x6e684['body'][_0x5d17f2(0x1a8)]||_0x5d17f2(0x167),_0xb633e2=_0x6e684[_0x5d17f2(0x1bd)]['search'],_0x18eb44=_0x5d17f2(0x13c),_0x2d2e22=_0x5d17f2(0x19f)+_0x18eb44+_0x5d17f2(0x1f1),_0x8e9b2=[_0x37de6f];_0xb633e2&&(_0x2d2e22+=_0x5d17f2(0x1ed),_0x8e9b2['push']('%'+_0xb633e2+'%'));_0x6e684[_0x5d17f2(0x11f)][_0x5d17f2(0x270)]!=0x1&&(_0x2d2e22+='\x20AND\x20share_for_subuser\x20=\x20?\x20',_0x8e9b2['push'](0x1));_0x2d2e22+='\x20order\x20by\x20'+_0x29da0a+'\x20'+_0x37567c+_0x5d17f2(0x254),_0x8e9b2[_0x5d17f2(0x161)](_0x1dd988),_0x8e9b2[_0x5d17f2(0x161)](_0x1a52d2),_0xe38ab=_0x6e684[_0x5d17f2(0x121)][_0x5d17f2(0x1d8)][_0x5d17f2(0x156)](_0x2d2e22)[_0x5d17f2(0x148)](_0x8e9b2);for(let _0x25bd80 of _0xe38ab){if(_0x25bd80['enable_pwd']==0x1)continue;let _0x3ddb92=getMoviesByParams(_0x2c9faf,_0x6e684,null,'id',0x1,0x0,_0x5d17f2(0x167),null,null,null,null,null,null,_0x25bd80['id']);_0x3ddb92[_0x5d17f2(0x1b0)]>0x0&&(_0x25bd80[_0x5d17f2(0x126)]=_0x3ddb92[0x0]);}return _0xe38ab;}router[_0x55faad(0x1ee)](_0x55faad(0x194),(_0x126087,_0x4019d9,_0x11ab68)=>{const _0xe44f4d=_0x55faad;let _0x3a8b2d=_0x126087[_0xe44f4d(0x1bd)][_0xe44f4d(0x249)]||_0xe44f4d(0x21d),_0x38ae45=getCollectionList(_0x126087,_0x4019d9,_0x3a8b2d);return _0x4019d9[_0xe44f4d(0x1c1)]({'code':0x0,'data':_0x38ae45});}),router[_0x55faad(0x1ee)]('/checkCollectionPwd',(_0x4b600f,_0x3cb7ef,_0x5e91fd)=>{const _0x1b2084=_0x55faad;let _0x521ba1=_0x4b600f['body'][_0x1b2084(0x1b9)],_0x115b80=_0x4b600f['body'][_0x1b2084(0x1d3)];if(!_0x521ba1)return _0x4b600f[_0x1b2084(0x121)][_0x1b2084(0x138)](_0x3cb7ef,_0x3cb7ef['__'](_0x1b2084(0x22f)),_0x1b2084(0x174));_0x521ba1=sha256(_0x521ba1);let _0x43334a=_0x4b600f['app'][_0x1b2084(0x1d8)][_0x1b2084(0x156)](_0x1b2084(0x1c0))['get'](_0x115b80,_0x521ba1);if(!_0x43334a)return _0x4b600f[_0x1b2084(0x121)][_0x1b2084(0x138)](_0x3cb7ef,_0x3cb7ef['__'](_0x1b2084(0x1a3)),_0x1b2084(0x174));return _0x3cb7ef[_0x1b2084(0x1c1)]({'code':0x0,'data':_0x43334a});}),router[_0x55faad(0x1ee)](_0x55faad(0x170),(_0x111cd9,_0x469abd,_0xe5cb05)=>{const _0x18065d=_0x55faad;let _0x2bbb3f=_0x111cd9['body'][_0x18065d(0x253)],_0x50d44c=_0x111cd9[_0x18065d(0x1bd)][_0x18065d(0x226)],_0x4603c5=_0x111cd9[_0x18065d(0x1bd)][_0x18065d(0x1b9)],_0x95199=_0x111cd9[_0x18065d(0x1bd)]['collectionId'],_0x5a307b=_0x111cd9[_0x18065d(0x1bd)][_0x18065d(0x249)]?_0x111cd9['body'][_0x18065d(0x249)]:_0x18065d(0x21d),_0xa103c7=_0x111cd9[_0x18065d(0x1bd)][_0x18065d(0x135)]?_0x111cd9[_0x18065d(0x1bd)][_0x18065d(0x135)]:'',_0x40200f=_0x111cd9['body'][_0x18065d(0x16c)]?_0x111cd9[_0x18065d(0x1bd)]['coverPath']:'',_0xc3cc74=_0x111cd9[_0x18065d(0x1bd)][_0x18065d(0x18b)];_0xc3cc74==null&&(_0xc3cc74=0x1);if(_0x5a307b==_0x18065d(0x223)){if(!_0xa103c7||!_0xa103c7['searchValue']||sqliteUtil[_0x18065d(0x1a6)](_0xa103c7[_0x18065d(0x265)])==!![])return _0x111cd9['app'][_0x18065d(0x138)](_0x469abd,'error\x20data');}let _0x34e79c=_0x111cd9['body'][_0x18065d(0x251)]?_0x111cd9[_0x18065d(0x1bd)][_0x18065d(0x251)]:'';if(_0x111cd9[_0x18065d(0x11f)][_0x18065d(0x270)]!=0x1)return _0x111cd9[_0x18065d(0x121)][_0x18065d(0x138)](_0x469abd,_0x469abd['__'](_0x18065d(0x1c3)));if(_0x50d44c=='1'){if(!_0x4603c5)return _0x111cd9['app'][_0x18065d(0x138)](_0x469abd,_0x469abd['__']('pwdCanNotBeNull'),_0x18065d(0x174));_0x4603c5=sha256(_0x4603c5);}return _0x95199?_0x111cd9[_0x18065d(0x121)][_0x18065d(0x1d8)]['prepare'](_0x18065d(0x12d))[_0x18065d(0x160)](_0x2bbb3f,JSON[_0x18065d(0x1b7)](_0xa103c7),_0x50d44c+'',_0x4603c5,_0x40200f,_0x34e79c,_0xc3cc74,_0x95199):_0x111cd9[_0x18065d(0x121)]['dbFileIndex'][_0x18065d(0x156)](_0x18065d(0x130))[_0x18065d(0x160)](_0x2bbb3f,_0x50d44c+'',_0x4603c5,_0x111cd9[_0x18065d(0x11f)]['id']+'',_0x5a307b,JSON[_0x18065d(0x1b7)](_0xa103c7),_0x40200f,_0x34e79c,_0xc3cc74),_0x469abd[_0x18065d(0x1c1)]({'code':0x0});}),router['post']('/deleteCollection',(_0x45b42a,_0x24e8ec,_0x49c05b)=>{const _0x598a15=_0x55faad;let _0x1a6402=_0x45b42a[_0x598a15(0x1bd)][_0x598a15(0x1d3)];if(_0x45b42a['currentUser']['is_admin']!=0x1)return _0x45b42a[_0x598a15(0x121)]['returnErrMsg'](_0x24e8ec,_0x24e8ec['__']('noPermission'));return _0x45b42a[_0x598a15(0x121)]['dbFileIndex']['prepare'](_0x598a15(0x18f))[_0x598a15(0x160)](_0x1a6402),_0x45b42a['app'][_0x598a15(0x1d8)]['prepare'](_0x598a15(0x144))['run'](_0x1a6402),_0x24e8ec[_0x598a15(0x1c1)]({'code':0x0});}),router[_0x55faad(0x1ee)](_0x55faad(0x1eb),(_0x4a7f6d,_0x3f061a,_0x4cb0f8)=>{const _0x199317=_0x55faad;return _0x4a7f6d['app'][_0x199317(0x1d8)]['prepare'](_0x199317(0x21f)+_0x4a7f6d[_0x199317(0x11f)]['id'])[_0x199317(0x160)](),_0x3f061a[_0x199317(0x1c1)]({'code':0x0});}),router['post'](_0x55faad(0x1e8),(_0x2d67b0,_0x7b891c,_0x56d2ab)=>{const _0x5d6e47=_0x55faad;let _0x27660c=_0x2d67b0[_0x5d6e47(0x1bd)]['indexId'],_0x5debc3=_0x2d67b0['body'][_0x5d6e47(0x15a)],_0x42e19a=dbFileIndexTable[_0x5d6e47(0x206)](_0x2d67b0[_0x5d6e47(0x121)][_0x5d6e47(0x1d8)],_0x27660c,dbFileIndexTable[_0x5d6e47(0x229)]);if(!_0x42e19a)return _0x7b891c[_0x5d6e47(0x1c1)]({'code':0x0});if(_0x42e19a['collection_id']){let _0x9ec3d5=_0x2d67b0[_0x5d6e47(0x121)]['dbFileIndex']['prepare'](_0x5d6e47(0x19c))[_0x5d6e47(0x140)](_0x42e19a['collection_id']);if(_0x9ec3d5&&_0x9ec3d5[_0x5d6e47(0x12e)]==0x1)return _0x7b891c[_0x5d6e47(0x1c1)]({'code':0x0});}let _0x13814f=_0x2d67b0['app'][_0x5d6e47(0x1d8)][_0x5d6e47(0x156)](_0x5d6e47(0x17e))[_0x5d6e47(0x140)](_0x27660c+'',_0x2d67b0[_0x5d6e47(0x11f)]['id']+'');return _0x13814f?_0x2d67b0[_0x5d6e47(0x121)][_0x5d6e47(0x1d8)]['prepare'](_0x5d6e47(0x182))[_0x5d6e47(0x160)](_0x5debc3,new Date()[_0x5d6e47(0x21c)](),_0x27660c+'',_0x2d67b0['currentUser']['id']+''):_0x2d67b0[_0x5d6e47(0x121)]['dbFileIndex'][_0x5d6e47(0x156)](_0x5d6e47(0x205))['run'](_0x27660c+'',_0x2d67b0[_0x5d6e47(0x11f)]['id']+'',_0x5debc3,new Date()['getTime']()),_0x7b891c[_0x5d6e47(0x1c1)]({'code':0x0});}),router[_0x55faad(0x1ee)](_0x55faad(0x18a),(_0x193e20,_0x1acaa2,_0x22b7e0)=>{const _0x298547=_0x55faad;let _0x2cffc5=_0x193e20['body'][_0x298547(0x168)],_0x533c32=_0x298547(0x21b);if(_0x2cffc5){let _0x2111f7=_0x193e20[_0x298547(0x121)][_0x298547(0x1d8)][_0x298547(0x156)](_0x298547(0x1bb))[_0x298547(0x140)](_0x193e20['currentUser']['id']+'',_0x2cffc5+'');return _0x1acaa2[_0x298547(0x1c1)]({'code':0x0,'data':_0x2111f7});}else{let _0x23c274=_0x298547(0x1c7)+_0x533c32+'\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id='+_0x193e20[_0x298547(0x11f)]['id']+_0x298547(0x1fc),_0x12bc00=_0x193e20[_0x298547(0x121)][_0x298547(0x1d8)][_0x298547(0x156)](_0x23c274)['all']();return _0x1acaa2[_0x298547(0x1c1)]({'code':0x0,'data':_0x12bc00});}}),router[_0x55faad(0x1ee)](_0x55faad(0x233),(_0x89f5f9,_0x33b1b7,_0x53058f)=>{const _0x5093f3=_0x55faad;let _0x1bb7b7=_0x89f5f9[_0x5093f3(0x1bd)]['id'],_0x7eecac=dbFileIndexTable[_0x5093f3(0x206)](_0x89f5f9[_0x5093f3(0x121)][_0x5093f3(0x1d8)],_0x1bb7b7,dbFileIndexTable[_0x5093f3(0x229)]);if(dbUserTable['doUserCanGet'](_0x89f5f9,_0x33b1b7,_0x5093f3(0x231),_0x5093f3(0x227),_0x7eecac[_0x5093f3(0x146)])==!![]){let _0x3aff3f={'code':0x0,'data':_0x7eecac};return _0x33b1b7['json'](_0x3aff3f);}}),router['post'](_0x55faad(0x15b),(_0x13395c,_0x2d7c2c,_0x52611d)=>{const _0x5abb07=_0x55faad;let _0x16f1a2=_0x13395c['body'][_0x5abb07(0x239)],_0x578ca4=_0x13395c[_0x5abb07(0x1bd)][_0x5abb07(0x163)];if(dbUserTable[_0x5abb07(0x267)](_0x13395c,_0x2d7c2c)===!![]){let _0x6b8e19=dbSourceFolderTable[_0x5abb07(0x206)](_0x13395c['app'][_0x5abb07(0x247)],_0x16f1a2);if(!_0x6b8e19)return _0x2d7c2c[_0x5abb07(0x1f4)](0x194)[_0x5abb07(0x217)]();return _0x578ca4==0x1?(_0x13395c[_0x5abb07(0x121)][_0x5abb07(0x1d8)][_0x5abb07(0x156)](_0x5abb07(0x13f))[_0x5abb07(0x160)](_0x6b8e19['path']+path['sep']+'%',_0x6b8e19['path']),dbSourceFolderTable['updateByWhere'](_0x13395c[_0x5abb07(0x121)][_0x5abb07(0x247)],_0x5abb07(0x25d),_0x578ca4,_0x16f1a2),process[_0x5abb07(0x1cc)]({'type':'SWITCH_MOVIE_INFO'}),_0x2d7c2c[_0x5abb07(0x1c1)]({'code':0x0})):(dbSourceFolderTable[_0x5abb07(0x155)](_0x13395c[_0x5abb07(0x121)][_0x5abb07(0x247)],_0x5abb07(0x25d),_0x578ca4,_0x16f1a2),_0x13395c[_0x5abb07(0x121)]['dbFileIndex'][_0x5abb07(0x156)](_0x5abb07(0x232))[_0x5abb07(0x160)](_0x6b8e19['path']+path[_0x5abb07(0x1a1)]+'%',_0x6b8e19[_0x5abb07(0x146)]),process['send']({'type':_0x5abb07(0x214)}),_0x2d7c2c['json']({'code':0x0}));}}),router['post']('/setTvplay',(_0xbd37ce,_0x521a87,_0x555e22)=>{const _0x3f4353=_0x55faad;let _0x40f3b0=_0xbd37ce['body']['isTvPlay'],_0x824d3c=_0xbd37ce['body'][_0x3f4353(0x168)],_0x4c775b=_0xbd37ce[_0x3f4353(0x1bd)][_0x3f4353(0x239)];function _0x284a05(_0x280ef1){const _0x3bb8a5=_0x3f4353;let _0x1a5ac6=_0xbd37ce[_0x3bb8a5(0x121)][_0x3bb8a5(0x1d8)]['prepare'](_0x3bb8a5(0x1d7)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x3bb8a5(0x1fa))['get'](_0x280ef1);if(!_0x1a5ac6)return;_0xbd37ce[_0x3bb8a5(0x121)][_0x3bb8a5(0x1d8)][_0x3bb8a5(0x156)](_0x3bb8a5(0x257)+dbFileIndexTable[_0x3bb8a5(0x229)]+_0x3bb8a5(0x25c))[_0x3bb8a5(0x160)](_0x280ef1),_0xbd37ce[_0x3bb8a5(0x121)][_0x3bb8a5(0x1d8)][_0x3bb8a5(0x156)]('UPDATE\x20'+dbFileIndexTable[_0x3bb8a5(0x229)]+_0x3bb8a5(0x159))['run'](_0x1a5ac6['id']),movieUtil[_0x3bb8a5(0x26a)](_0xbd37ce[_0x3bb8a5(0x121)][_0x3bb8a5(0x1d8)],_0x1a5ac6);}if(_0x824d3c){let _0x3fd415=dbFileIndexTable[_0x3f4353(0x206)](_0xbd37ce[_0x3f4353(0x121)][_0x3f4353(0x1d8)],_0x824d3c,dbFileIndexTable[_0x3f4353(0x229)]);if(dbUserTable[_0x3f4353(0x1d4)](_0xbd37ce,_0x521a87,'movie',_0x3f4353(0x165),_0x3fd415[_0x3f4353(0x146)])==!![])return _0x40f3b0==0x1?_0x284a05(_0x3fd415[_0x3f4353(0x146)]):_0xbd37ce[_0x3f4353(0x121)]['dbFileIndex'][_0x3f4353(0x156)](_0x3f4353(0x257)+dbFileIndexTable[_0x3f4353(0x229)]+_0x3f4353(0x252)+_0x3fd415[_0x3f4353(0x146)]+'\x27')[_0x3f4353(0x160)](),_0x521a87[_0x3f4353(0x1c1)]({'code':0x0});}else{if(_0x4c775b){let _0x3861f1=dbSourceFolderTable[_0x3f4353(0x206)](_0xbd37ce[_0x3f4353(0x121)]['dbOther'],_0x4c775b);if(!_0x3861f1||_0x3861f1[_0x3f4353(0x249)]!=_0x3f4353(0x231))return _0xbd37ce[_0x3f4353(0x121)][_0x3f4353(0x138)](_0x521a87,_0x521a87['__'](_0x3f4353(0x13e)),_0x3f4353(0x174));if(_0x40f3b0==0x1){dbSourceFolderTable[_0x3f4353(0x155)](_0xbd37ce[_0x3f4353(0x121)]['dbOther'],_0x3f4353(0x1ea),_0x3f4353(0x1ab),_0x4c775b),_0x284a05(_0x3861f1[_0x3f4353(0x146)]);let _0xaea6f7=_0xbd37ce[_0x3f4353(0x121)][_0x3f4353(0x1d8)][_0x3f4353(0x156)](_0x3f4353(0x204)+dbFileIndexTable[_0x3f4353(0x229)]+'\x20WHERE\x20is_file=0\x20and\x20(path=?\x20or\x20path\x20like\x20?)\x20')[_0x3f4353(0x148)](_0x3861f1[_0x3f4353(0x146)],''+_0x3861f1[_0x3f4353(0x146)]+path['sep']+'%');for(let _0xfdaa1d in _0xaea6f7){let _0x428963=path['join'](_0xaea6f7[_0xfdaa1d][_0x3f4353(0x146)],_0xaea6f7[_0xfdaa1d]['filename']);_0x284a05(_0x428963);}}else{dbSourceFolderTable[_0x3f4353(0x155)](_0xbd37ce[_0x3f4353(0x121)][_0x3f4353(0x247)],_0x3f4353(0x1ea),_0x3f4353(0x231),_0x4c775b);let _0x3fa1d1=_0xbd37ce[_0x3f4353(0x121)][_0x3f4353(0x1d8)][_0x3f4353(0x156)](_0x3f4353(0x257)+dbFileIndexTable[_0x3f4353(0x229)]+_0x3f4353(0x24f))[_0x3f4353(0x160)](_0x3861f1[_0x3f4353(0x146)],''+_0x3861f1[_0x3f4353(0x146)]+path[_0x3f4353(0x1a1)]+'%');}return _0x521a87[_0x3f4353(0x1c1)]({'code':0x0});}else return _0xbd37ce['app'][_0x3f4353(0x138)](_0x521a87,_0x521a87['__'](_0x3f4353(0x13e)),_0x3f4353(0x174));}});function setLogoAndFanart(_0x2e63b1,_0x1e7b23,_0x30a3ee,_0x3c5540){const _0x56ad5f=_0x55faad;if(_0x2e63b1[_0x56ad5f(0x1bd)][_0x56ad5f(0x24e)]){let _0xf19ed1=_0x56ad5f(0x124),_0x1ec826=[_0x30a3ee];_0x3c5540?(_0xf19ed1+=_0x56ad5f(0x1e4),_0x1ec826['push']('clearlogo.%'),_0x1ec826[_0x56ad5f(0x161)](_0x3c5540+_0x56ad5f(0x17c)),_0x1ec826[_0x56ad5f(0x161)](_0x3c5540+'.clearlogo.%')):(_0xf19ed1+=_0x56ad5f(0x1ef),_0x1ec826[_0x56ad5f(0x161)](_0x56ad5f(0x136)));let _0x408a09=_0x2e63b1[_0x56ad5f(0x121)]['dbFileIndex'][_0x56ad5f(0x156)](_0xf19ed1)[_0x56ad5f(0x140)](_0x1ec826);if(_0x408a09){let _0x59b28b=path[_0x56ad5f(0x21a)](_0x408a09['path'],_0x408a09['filename']);_0x1e7b23[_0x56ad5f(0x12c)]=_0x59b28b;}let _0x29815e=_0x56ad5f(0x124),_0x101773=[_0x30a3ee];_0x3c5540?(_0x29815e+=_0x56ad5f(0x196),_0x101773['push']('fanart.%'),_0x101773[_0x56ad5f(0x161)](_0x3c5540+_0x56ad5f(0x1f7)),_0x101773[_0x56ad5f(0x161)](_0x3c5540+_0x56ad5f(0x1fd))):(_0x29815e+=_0x56ad5f(0x1ef),_0x101773[_0x56ad5f(0x161)](_0x56ad5f(0x25e)));let _0x3288b9=_0x2e63b1['app']['dbFileIndex'][_0x56ad5f(0x156)](_0x29815e)[_0x56ad5f(0x140)](_0x101773);if(_0x3288b9){let _0x2e4645=path[_0x56ad5f(0x21a)](_0x3288b9[_0x56ad5f(0x146)],_0x3288b9[_0x56ad5f(0x23e)]);_0x1e7b23[_0x56ad5f(0x193)]=_0x2e4645;}}}function addTvFolderPathAndName(_0x2b8a91){const _0x5ca5b6=_0x55faad;_0x2b8a91[_0x5ca5b6(0x178)]=path['basename'](_0x2b8a91['path']),_0x2b8a91[_0x5ca5b6(0x150)]=_0x2b8a91[_0x5ca5b6(0x146)];if(_0x2b8a91[_0x5ca5b6(0x269)]==0x1){let _0x118cc0=path[_0x5ca5b6(0x23f)](_0x2b8a91[_0x5ca5b6(0x146)]),_0x2fe38e=path[_0x5ca5b6(0x172)](_0x2b8a91['path']),_0x5e0b8b=movieSeasonUtil[_0x5ca5b6(0x171)](_0x118cc0);_0x5e0b8b>-0x1&&(_0x2b8a91[_0x5ca5b6(0x178)]=path[_0x5ca5b6(0x23f)](_0x2fe38e),_0x2b8a91[_0x5ca5b6(0x150)]=_0x2fe38e);if(!_0x2b8a91['show_name'])_0x2b8a91['show_name']=_0x2b8a91['tvFolderName'];}}function addFolderCoverPath(_0x2b19bd,_0x554a67,_0x4a301a,_0x374360=![]){const _0x1d2819=_0x55faad;let _0x5e6806;addTvFolderPathAndName(_0x4a301a);let _0x2a0fb0=_0x4a301a['id']+_0x1d2819(0x197)+_0x374360;!_0x554a67[_0x1d2819(0x24a)]&&(_0x554a67[_0x1d2819(0x24a)]=new Map());try{if(_0x4a301a[_0x1d2819(0x269)]==0x1&&!_0x374360)try{let _0x4bc458=path[_0x1d2819(0x23f)](_0x4a301a[_0x1d2819(0x146)]),_0x802b2f=path['dirname'](_0x4a301a[_0x1d2819(0x146)]),_0x4f0c63=movieSeasonUtil['getSeasonNumber'](_0x4bc458);if(_0x4f0c63>-0x1){_0x4a301a[_0x1d2819(0x1e5)]=0x1,_0x4a301a[_0x1d2819(0x266)]=_0x4f0c63;if(_0x554a67[_0x1d2819(0x1bd)][_0x1d2819(0x19e)]){let _0x21c3d4=_0x802b2f+_0x1d2819(0x23b)+_0x374360;_0x554a67[_0x1d2819(0x24a)]['has'](_0x21c3d4)?_0x4a301a['seasonCount']=_0x554a67[_0x1d2819(0x24a)]['get'](_0x21c3d4):(_0x4a301a[_0x1d2819(0x212)]=_0x554a67[_0x1d2819(0x121)][_0x1d2819(0x1d8)]['prepare'](_0x1d2819(0x201))['get'](''+_0x802b2f+path[_0x1d2819(0x1a1)]+'%')[_0x1d2819(0x1b2)],_0x554a67[_0x1d2819(0x24a)][_0x1d2819(0x1dc)](_0x21c3d4,_0x4a301a[_0x1d2819(0x212)]));}}setLogoAndFanart(_0x554a67,_0x4a301a,_0x4a301a[_0x1d2819(0x150)]);if(_0x554a67[_0x1d2819(0x1bd)][_0x1d2819(0x209)]==0x1&&_0x4f0c63>-0x1){let _0x3cbb80=_0x4a301a[_0x1d2819(0x150)]+_0x1d2819(0x1cd);if(_0x554a67['movieTvCache'][_0x1d2819(0x1b4)](_0x3cbb80))return _0x4a301a[_0x1d2819(0x145)]=_0x554a67['movieTvCache'][_0x1d2819(0x140)](_0x3cbb80),_0x4a301a;let _0x250845=getTvSeriesPoster(_0x4a301a);if(_0x250845)return _0x554a67['movieTvCache'][_0x1d2819(0x1dc)](_0x3cbb80,_0x250845),_0x4a301a[_0x1d2819(0x145)]=_0x250845,_0x4a301a;}if(!_0x5e6806&&_0x554a67['movieTvCache'][_0x1d2819(0x1b4)](_0x2a0fb0))return _0x4a301a['folder_cover_path']=_0x554a67[_0x1d2819(0x24a)][_0x1d2819(0x140)](_0x2a0fb0),_0x4a301a;if(!_0x5e6806&&_0x4f0c63>-0x1){parseInt(_0x4f0c63)<0xa&&(_0x4f0c63='0'+_0x4f0c63);let _0x19b63b=_0x1d2819(0x1e0)+_0x4f0c63+'%poster%',_0x35232c='%s'+_0x4f0c63+'%poster%',_0x28d4d4=_0x1d2819(0x1d9)+_0x802b2f+'\x27\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27'+_0x19b63b+_0x1d2819(0x15f)+_0x35232c+'\x27)';_0x5e6806=_0x554a67[_0x1d2819(0x121)][_0x1d2819(0x1d8)][_0x1d2819(0x156)](_0x28d4d4)['get']();}!_0x5e6806&&(_0x5e6806=_0x554a67[_0x1d2819(0x121)][_0x1d2819(0x1d8)][_0x1d2819(0x156)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)')[_0x1d2819(0x140)](_0x4a301a[_0x1d2819(0x146)]));}catch(_0x692a85){console[_0x1d2819(0x162)](_0x692a85);}else{if(_0x554a67[_0x1d2819(0x24a)][_0x1d2819(0x1b4)](_0x2a0fb0))return _0x4a301a[_0x1d2819(0x145)]=_0x554a67[_0x1d2819(0x24a)][_0x1d2819(0x140)](_0x2a0fb0),_0x4a301a;let _0x195876=path[_0x1d2819(0x23c)](_0x4a301a[_0x1d2819(0x23e)]),_0x426a22=_0x195876[_0x1d2819(0x1da)],_0x46f298=path[_0x1d2819(0x21a)](_0x4a301a[_0x1d2819(0x146)],_0x426a22+_0x1d2819(0x1c8));if(fs[_0x1d2819(0x16f)](_0x46f298))return _0x4a301a[_0x1d2819(0x145)]=_0x46f298,_0x4a301a;!_0x5e6806&&(_0x5e6806=_0x554a67[_0x1d2819(0x121)][_0x1d2819(0x1d8)][_0x1d2819(0x156)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20filename\x20like\x20?')[_0x1d2819(0x140)](_0x4a301a[_0x1d2819(0x146)],'%'+_0x426a22+_0x1d2819(0x19b)));if(!_0x5e6806){let _0x163c18=_0x426a22;(_0x426a22[_0x1d2819(0x24b)](_0x1d2819(0x139))||_0x426a22[_0x1d2819(0x24b)]('-FHD')||_0x426a22[_0x1d2819(0x24b)]('-QHD')||_0x426a22[_0x1d2819(0x24b)](_0x1d2819(0x1e3)))&&(_0x426a22['endsWith'](_0x1d2819(0x139))?_0x163c18=_0x163c18[_0x1d2819(0x129)](0x0,_0x163c18[_0x1d2819(0x1b0)]-0x3):_0x163c18=_0x163c18[_0x1d2819(0x129)](0x0,_0x163c18[_0x1d2819(0x1b0)]-0x4)),_0x5e6806=_0x554a67[_0x1d2819(0x121)][_0x1d2819(0x1d8)][_0x1d2819(0x156)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20?\x20or\x20filename\x20like\x20?)\x20and\x20filename\x20not\x20like\x20?')['get'](_0x4a301a[_0x1d2819(0x146)],_0x426a22+'%',_0x163c18+'%',_0x1d2819(0x1ff));}!_0x5e6806&&(_0x5e6806=_0x554a67[_0x1d2819(0x121)][_0x1d2819(0x1d8)][_0x1d2819(0x156)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)')[_0x1d2819(0x140)](_0x4a301a[_0x1d2819(0x146)]));let {name:_0x54c5b5}=path['parse'](_0x4a301a[_0x1d2819(0x23e)]);setLogoAndFanart(_0x554a67,_0x4a301a,_0x4a301a[_0x1d2819(0x146)],_0x54c5b5);}if(_0x5e6806){let _0x4a394c=path[_0x1d2819(0x21a)](_0x5e6806[_0x1d2819(0x146)],_0x5e6806[_0x1d2819(0x23e)]);!_0x4a394c['endsWith'](_0x1d2819(0x151))&&!_0x4a394c['endsWith']('heic')&&fs[_0x1d2819(0x16f)](_0x4a394c)?(_0x4a301a[_0x1d2819(0x145)]=_0x4a394c,_0x554a67['movieTvCache']['set'](_0x2a0fb0,_0x4a301a[_0x1d2819(0x145)])):_0x554a67[_0x1d2819(0x24a)][_0x1d2819(0x1dc)](_0x2a0fb0,'');}return _0x4a301a;}catch(_0x13003f){return console[_0x1d2819(0x162)](_0x13003f),_0x4a301a;}}function getMoviesByParams(_0x31cc6c,_0x145a07,_0x8abcbd,_0x2b19a5,_0x231936,_0x5aceb1,_0x67a59a,_0x352493,_0x47e66e,_0x2ba2a6,_0xbb519f,_0x39a006,_0x30f9cd,_0xf8d870,_0x11381d,_0x5195e6,_0x34daf2,_0x8bd736){const _0x31ddc7=_0x55faad;let _0x947d1c=movieFieldStr;_0x8bd736&&(_0x947d1c=_0x8bd736);!_0x11381d&&(_0x11381d=_0x31ddc7(0x19d));let _0x2100e3='',_0x12609b=[],_0x3a51d5=dbUserTable[_0x31ddc7(0x20d)](_0x145a07,_0x31ddc7(0x231),_0x31ddc7(0x227),!![],_0x2ba2a6);if(_0x145a07[_0x31ddc7(0x11f)][_0x31ddc7(0x270)]!=0x1&&!_0x3a51d5[_0x31ddc7(0x198)])return[];_0x2100e3+=_0x31ddc7(0x15e);_0x47e66e&&(_0x47e66e=_0x47e66e[_0x31ddc7(0x1bc)]('\x27','')['replace']('’',''),_0x2100e3+=_0x31ddc7(0x1d1),_0x12609b['push']('%'+_0x47e66e+'%'),_0x12609b[_0x31ddc7(0x161)]('%'+_0x47e66e+'%'),_0x12609b['push']('%'+_0x47e66e+'%'));let _0x4f154a=dbSourceFolderTable[_0x31ddc7(0x1a7)](_0x145a07[_0x31ddc7(0x121)][_0x31ddc7(0x247)],_0x31ddc7(0x146),_0x31ddc7(0x238));_0x4f154a&&(_0x2100e3+=_0x31ddc7(0x120)+_0x4f154a);let _0x1d4a87=dbSourceFolderTable[_0x31ddc7(0x1a7)](_0x145a07[_0x31ddc7(0x121)][_0x31ddc7(0x247)],_0x31ddc7(0x23e),'excludeFilenameMovie');_0x1d4a87&&(_0x2100e3+='\x20AND\x20'+_0x1d4a87);function _0x1fe029(_0xf2be10,_0x49c3b0){const _0x381ac7=_0x31ddc7;let _0x169279='\x20AND\x20(';try{let _0x14231d=JSON['parse'](_0x49c3b0),_0xe44337=![];for(let _0x139039=0x0;_0x139039<_0x14231d[_0x381ac7(0x1b0)];_0x139039++){if(!_0x14231d[_0x139039])continue;_0xe44337=!![],_0x169279+='\x20'+_0xf2be10+_0x381ac7(0x1d5),_0x12609b[_0x381ac7(0x161)]('%'+_0x14231d[_0x139039][_0x381ac7(0x15d)]()+'%'),_0x139039!=_0x14231d[_0x381ac7(0x1b0)]-0x1&&(_0x169279+='\x20or\x20');}_0x169279+=')',_0xe44337&&(_0x2100e3+=_0x169279);}catch(_0x374842){console[_0x381ac7(0x162)](_0x374842);}}_0xbb519f&&_0x1fe029(_0x31ddc7(0x187),_0xbb519f);_0x39a006&&_0x1fe029(_0x31ddc7(0x13a),_0x39a006);_0x30f9cd&&_0x1fe029(_0x31ddc7(0x179),_0x30f9cd);_0x145a07[_0x31ddc7(0x1bd)][_0x31ddc7(0x1c9)]&&_0x145a07[_0x31ddc7(0x1bd)][_0x31ddc7(0x1c9)][_0x31ddc7(0x1b0)]>0x0&&_0x145a07['body'][_0x31ddc7(0x1c9)][0x0]!=''&&_0x1fe029(_0x31ddc7(0x224),_0x145a07[_0x31ddc7(0x1bd)][_0x31ddc7(0x1c9)]);_0x145a07['body'][_0x31ddc7(0x20e)]&&_0x145a07[_0x31ddc7(0x1bd)][_0x31ddc7(0x20e)]['length']>0x0&&_0x145a07['body'][_0x31ddc7(0x20e)][0x0]!=''&&_0x1fe029(_0x31ddc7(0x128),_0x145a07[_0x31ddc7(0x1bd)][_0x31ddc7(0x20e)]);if(_0x34daf2){let _0x1f7c4b=_0x145a07[_0x31ddc7(0x121)][_0x31ddc7(0x1d8)][_0x31ddc7(0x156)](_0x31ddc7(0x1ec))[_0x31ddc7(0x140)](_0x34daf2);if(_0x1f7c4b)try{let _0x52493e=JSON[_0x31ddc7(0x23c)](_0x1f7c4b[_0x31ddc7(0x21e)]),_0x5e8701=dbUserTable[_0x31ddc7(0x240)](!![],_0x52493e);_0x2100e3+=_0x5e8701[_0x31ddc7(0x198)],_0x12609b[_0x31ddc7(0x161)](..._0x5e8701['paramsList']);}catch(_0x289618){console[_0x31ddc7(0x162)](_0x289618);}}else{!_0xf8d870&&(_0xf8d870=0x0);let _0x50427e;if(_0xf8d870!=0x0){_0x50427e=_0x145a07['app']['dbFileIndex'][_0x31ddc7(0x156)](_0x31ddc7(0x19c))['get'](_0xf8d870);if(!_0x50427e)return _0x145a07[_0x31ddc7(0x121)][_0x31ddc7(0x138)](_0x31cc6c,_0x31cc6c['__'](_0x31ddc7(0x25a)));if(_0x50427e[_0x31ddc7(0x12e)]==0x1){let _0x210d05=_0x145a07[_0x31ddc7(0x1bd)][_0x31ddc7(0x1a5)];if(!_0x210d05||_0x50427e[_0x31ddc7(0x1b9)]!=sha256(_0x210d05))return _0x145a07['app'][_0x31ddc7(0x138)](_0x31cc6c,_0x31cc6c['__'](_0x31ddc7(0x1a3)));}}if(_0x50427e&&_0x50427e[_0x31ddc7(0x249)]==_0x31ddc7(0x223))try{_0x50427e[_0x31ddc7(0x135)]=JSON[_0x31ddc7(0x23c)](_0x50427e[_0x31ddc7(0x135)]),_0x2100e3+=_0x31ddc7(0x120)+_0x50427e[_0x31ddc7(0x135)][_0x31ddc7(0x265)];}catch(_0x5baec6){console['log'](_0x5baec6);}else _0x2100e3+='\x20AND\x20collection_id\x20=\x20'+_0xf8d870;}if(_0x8abcbd){if(_0x8abcbd==0x1)_0x2100e3+=_0x31ddc7(0x1af);else _0x8abcbd==0x2&&(_0x2100e3+=_0x31ddc7(0x1d0));}_0x5195e6&&(_0x5195e6=='#'?(_0x2100e3+=_0x31ddc7(0x189),_0x12609b[_0x31ddc7(0x161)](_0x5195e6),_0x12609b[_0x31ddc7(0x161)](_0x5195e6),_0x12609b[_0x31ddc7(0x161)](_0x5195e6)):(_0x2100e3+=_0x31ddc7(0x246),_0x12609b[_0x31ddc7(0x161)](_0x5195e6),_0x12609b[_0x31ddc7(0x161)](_0x5195e6),_0x12609b[_0x31ddc7(0x161)](_0x5195e6)));if(_0x352493&&_0x352493['length']>0x0){_0x2100e3+='\x20AND\x20id\x20NOT\x20IN\x20(';for(let _0x623ebe=0x0;_0x623ebe<_0x352493[_0x31ddc7(0x1b0)];_0x623ebe++){_0x2100e3+=_0x352493[_0x623ebe],_0x623ebe!=_0x352493['length']-0x1&&(_0x2100e3+=',');}_0x2100e3+=')';}_0x2100e3+=_0x3a51d5[_0x31ddc7(0x198)],_0x12609b[_0x31ddc7(0x161)](..._0x3a51d5[_0x31ddc7(0x242)]);_0x2b19a5&&_0x67a59a?_0x2100e3+='\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20'+_0x2b19a5+'\x20'+_0x67a59a:_0x2100e3+='\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1';!_0x231936&&(_0x231936=0x32);_0x2100e3+=_0x31ddc7(0x254),_0x12609b['push'](_0x231936),_0x12609b[_0x31ddc7(0x161)](_0x5aceb1);let _0x35ef5e=[];if(_0x11381d=='FAVORITE')_0x35ef5e=dbMovieFavorite[_0x31ddc7(0x1c2)](_0x145a07['app'][_0x31ddc7(0x1d8)],_0x145a07[_0x31ddc7(0x11f)]['id'],_0x2100e3,_0x947d1c,_0x12609b);else _0x11381d==_0x31ddc7(0x19d)&&(_0x35ef5e=dbFileIndexTable[_0x31ddc7(0x177)](_0x145a07[_0x31ddc7(0x121)][_0x31ddc7(0x1d8)],_0x2100e3,_0x947d1c,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE'],_0x12609b));if(_0x35ef5e[_0x31ddc7(0x1b0)]<0x1)return _0x35ef5e;let _0x1eaec3=[];for(let _0x10632a in _0x35ef5e){_0x1eaec3[_0x31ddc7(0x161)](_0x35ef5e[_0x10632a]['id']);}let _0x5a3f47=dbMovieFavorite[_0x31ddc7(0x230)](_0x145a07[_0x31ddc7(0x121)]['dbFileIndex'],_0x145a07['currentUser']['id'],_0x1eaec3);for(let _0x32f661=0x0;_0x32f661<_0x35ef5e[_0x31ddc7(0x1b0)];_0x32f661++){_0x35ef5e[_0x32f661]['favorite']=0x0;for(let _0x5a4295 in _0x5a3f47){if(_0x5a3f47[_0x5a4295]['movie_index_id']==_0x35ef5e[_0x32f661]['id']){_0x35ef5e[_0x32f661]['favorite']=0x1;break;}}let _0x31297a=_0x145a07[_0x31ddc7(0x121)][_0x31ddc7(0x1d8)][_0x31ddc7(0x156)]('SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?')[_0x31ddc7(0x140)](_0x145a07[_0x31ddc7(0x11f)]['id']+'',_0x35ef5e[_0x32f661]['id']+'');_0x31297a&&(_0x35ef5e[_0x32f661][_0x31ddc7(0x25b)]=_0x31297a);_0x35ef5e[_0x32f661]=addFolderCoverPath(_0x31cc6c,_0x145a07,_0x35ef5e[_0x32f661]);if(_0x35ef5e[_0x32f661][_0x31ddc7(0x269)]==0x1&&_0x145a07[_0x31ddc7(0x1bd)]['needTvCount']){let _0x3b6bcc=dbFileIndexTable[_0x31ddc7(0x203)](_0x145a07[_0x31ddc7(0x121)]['dbFileIndex'],_0x35ef5e[_0x32f661]);_0x35ef5e[_0x32f661][_0x31ddc7(0x228)]=_0x3b6bcc[_0x31ddc7(0x1b2)];}}return _0x35ef5e;}function getShowMatchName(_0x9ecb75){const _0x569812=_0x55faad;let _0x1ebad5=dbConfigTable['findByTitle'](_0x9ecb75,'movieShowMatchName');return!_0x1ebad5||_0x1ebad5&&_0x1ebad5[_0x569812(0x1cb)]!=0x0?0x1:0x0;}router[_0x55faad(0x1ee)](_0x55faad(0x258),(_0x2937a1,_0x1c040c,_0x1dcf8d)=>{const _0xebeab6=_0x55faad;if(dbUserTable[_0xebeab6(0x1d4)](_0x2937a1,_0x1c040c,'movie',_0xebeab6(0x227))==!![]){let _0x13aaa9=_0x2937a1[_0xebeab6(0x1bd)]['count'],_0x222115=_0x2937a1[_0xebeab6(0x1bd)][_0xebeab6(0x24d)],_0x528fa1=_0x2937a1[_0xebeab6(0x1bd)]['sortField'],_0x20b306=_0x2937a1[_0xebeab6(0x1bd)]['sortType'],_0x457430=_0x2937a1['body'][_0xebeab6(0x259)],_0x29de44=_0x2937a1[_0xebeab6(0x1bd)][_0xebeab6(0x13d)],_0x1dd33e=_0x2937a1['body'][_0xebeab6(0x175)],_0x2382e1=_0x2937a1['body'][_0xebeab6(0x208)],_0x31c023=_0x2937a1[_0xebeab6(0x1bd)][_0xebeab6(0x1a0)],_0x4443ff=_0x2937a1[_0xebeab6(0x1bd)]['movieGenres'],_0x1f2a95=_0x2937a1[_0xebeab6(0x1bd)]['sourceType'],_0x2c1445=_0x2937a1[_0xebeab6(0x1bd)][_0xebeab6(0x1d3)],_0xa2546c=_0x2937a1[_0xebeab6(0x1bd)][_0xebeab6(0x22b)],_0x3e914e=_0x2937a1[_0xebeab6(0x1bd)][_0xebeab6(0x14d)],_0xd0631d=_0x2937a1['body']['libraryId'];_0x2937a1['body'][_0xebeab6(0x1b5)]=!![],_0x2937a1[_0xebeab6(0x1bd)][_0xebeab6(0x19e)]=!![];let _0xbf959c=getMoviesByParams(_0x1c040c,_0x2937a1,_0x1f2a95,_0x528fa1,_0x13aaa9,_0x222115,_0x20b306,_0x457430,_0x29de44,_0x1dd33e,_0x2382e1,_0x31c023,_0x4443ff,_0x2c1445,_0xa2546c,_0x3e914e,_0xd0631d);return _0x1c040c[_0xebeab6(0x1c1)]({'movieShowMatchName':getShowMatchName(_0x2937a1[_0xebeab6(0x121)][_0xebeab6(0x247)]),'code':0x0,'data':_0xbf959c});}}),router[_0x55faad(0x1ee)]('/getMoviesByGenres',(_0x172d8c,_0xcc4250,_0xe8d407)=>{const _0x358395=_0x55faad;if(dbUserTable[_0x358395(0x1d4)](_0x172d8c,_0xcc4250,_0x358395(0x231),_0x358395(0x227))==!![]){let _0x4422de=_0x172d8c['body']['sourceFolderList'],_0x47bb0a=_0x172d8c[_0x358395(0x1bd)][_0x358395(0x12b)],_0x1f289d=_0x172d8c[_0x358395(0x1bd)][_0x358395(0x1dd)];!_0x47bb0a&&(_0x47bb0a=0x9);let _0xf35a64='\x20id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list',_0x397bcb='';_0x4422de?_0x397bcb=dbUserTable[_0x358395(0x20d)](_0x172d8c,_0x358395(0x231),_0x358395(0x227),!![],_0x4422de):_0x397bcb=dbUserTable[_0x358395(0x20d)](_0x172d8c,_0x358395(0x231),'power_get',!![]);let _0x23d11c=_0x172d8c[_0x358395(0x1bd)][_0x358395(0x216)];_0x23d11c!=_0x358395(0x179)&&_0x23d11c!=_0x358395(0x187)&&(_0x23d11c=_0x358395(0x179));!_0x23d11c&&(_0x23d11c=_0x358395(0x179));let _0x12eb6e=_0x172d8c[_0x358395(0x121)][_0x358395(0x1d8)]['prepare']('SELECT\x20*\x20FROM\x20movie_keys\x20WHERE\x20key_type=?\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20200')[_0x358395(0x148)](_0x23d11c),_0x1bdd68=[];for(let _0x700d5a of _0x12eb6e){let _0x5acfbd=_0x700d5a[_0x358395(0x195)],_0x1d4c2f='\x20type=2',_0x50b2b3=[];_0x1d4c2f+=_0x397bcb['whereStr'],_0x50b2b3[_0x358395(0x161)](..._0x397bcb[_0x358395(0x242)]),_0x1d4c2f+=_0x358395(0x263);if(_0x1f289d){if(_0x1f289d==0x1)_0x1d4c2f+=_0x358395(0x1af);else _0x1f289d==0x2&&(_0x1d4c2f+='\x20AND\x20is_tvplay==1');}_0x1d4c2f+='\x20AND\x20'+_0x23d11c+_0x358395(0x17f),_0x50b2b3['push']('%'+_0x5acfbd+'%'),_0x1d4c2f+=_0x358395(0x26d),_0x50b2b3[_0x358395(0x161)](parseInt(_0x47bb0a));let _0x253552=dbFileIndexTable['getAllByWhereAndField'](_0x172d8c[_0x358395(0x121)][_0x358395(0x1d8)],_0x1d4c2f,_0xf35a64,dbFileIndexTable[_0x358395(0x229)],_0x50b2b3),_0x3a98a0=[];for(let _0x246034 in _0x253552){_0x3a98a0[_0x358395(0x161)](_0x253552[_0x246034]['id']);}let _0x214fdb=dbMovieFavorite['getFavoriteList'](_0x172d8c[_0x358395(0x121)][_0x358395(0x1d8)],_0x172d8c[_0x358395(0x11f)]['id'],_0x3a98a0);for(let _0x4a7eb1=0x0;_0x4a7eb1<_0x253552[_0x358395(0x1b0)];_0x4a7eb1++){_0x253552[_0x4a7eb1]['favorite']=0x0;for(let _0x36b6ea in _0x214fdb){if(_0x214fdb[_0x36b6ea][_0x358395(0x132)]==_0x253552[_0x4a7eb1]['id']){_0x253552[_0x4a7eb1][_0x358395(0x241)]=0x1;break;}}_0x253552[_0x4a7eb1]=addFolderCoverPath(_0xcc4250,_0x172d8c,_0x253552[_0x4a7eb1]);}_0x253552[_0x358395(0x1b0)]>0x0&&_0x1bdd68[_0x358395(0x161)]({'genresType':_0x23d11c,'genresValue':_0x5acfbd,'movieList':_0x253552,'indexCount':_0x700d5a[_0x358395(0x1ba)]});}_0xcc4250[_0x358395(0x1c1)]({'code':0x0,'data':_0x1bdd68,'movieShowMatchName':getShowMatchName(_0x172d8c['app'][_0x358395(0x247)])});}}),router['post'](_0x55faad(0x164),(_0x4417e5,_0x1955a7,_0xa1f667)=>{const _0x5b2e9d=_0x55faad;if(dbUserTable['doUserCanGet'](_0x4417e5,_0x1955a7,_0x5b2e9d(0x231),_0x5b2e9d(0x227))==!![]){let _0x551666=getMoviesByParams(_0x1955a7,_0x4417e5,0x1,_0x5b2e9d(0x261),0xf,0x0,_0x5b2e9d(0x167));_0x4417e5[_0x5b2e9d(0x1bd)]['needTvCount']=!![],_0x4417e5[_0x5b2e9d(0x1bd)][_0x5b2e9d(0x19e)]=!![],_0x4417e5[_0x5b2e9d(0x1bd)][_0x5b2e9d(0x209)]=0x1;let _0x396f98=getMoviesByParams(_0x1955a7,_0x4417e5,0x2,_0x5b2e9d(0x261),0x32,0x0,_0x5b2e9d(0x167));_0x4417e5[_0x5b2e9d(0x1bd)][_0x5b2e9d(0x1b5)]=![],_0x4417e5['body'][_0x5b2e9d(0x19e)]=![],_0x4417e5[_0x5b2e9d(0x1bd)][_0x5b2e9d(0x209)]=0x0;let _0xe30f24=dbConfigTable[_0x5b2e9d(0x127)](_0x4417e5[_0x5b2e9d(0x121)][_0x5b2e9d(0x247)],_0x5b2e9d(0x255));_0xe30f24=!_0xe30f24||_0xe30f24&&_0xe30f24[_0x5b2e9d(0x1cb)]==0x1;let _0x22d59f=dbConfigTable['findByTitle'](_0x4417e5[_0x5b2e9d(0x121)][_0x5b2e9d(0x247)],_0x5b2e9d(0x264));_0x22d59f=!_0x22d59f||_0x22d59f&&_0x22d59f['value']==0x1;let _0xb5da8f=dbConfigTable[_0x5b2e9d(0x127)](_0x4417e5[_0x5b2e9d(0x121)]['dbOther'],_0x5b2e9d(0x256));_0xb5da8f=!_0xb5da8f||_0xb5da8f&&_0xb5da8f[_0x5b2e9d(0x1cb)]==0x1;let _0x2d0c40=[];if(_0xb5da8f){let _0x436c69=_0x5b2e9d(0x1d6),_0x206790='SELECT\x20'+_0x436c69+_0x5b2e9d(0x210)+_0x4417e5[_0x5b2e9d(0x11f)]['id']+_0x5b2e9d(0x166);_0x2d0c40=_0x4417e5['app']['dbFileIndex'][_0x5b2e9d(0x156)](_0x206790)[_0x5b2e9d(0x148)]();let _0x3aa935=[];for(let _0x5dac49 in _0x2d0c40){_0x3aa935[_0x5b2e9d(0x161)](_0x2d0c40[_0x5dac49]['id']);}let _0x17f8fe=dbMovieFavorite[_0x5b2e9d(0x230)](_0x4417e5['app'][_0x5b2e9d(0x1d8)],_0x4417e5[_0x5b2e9d(0x11f)]['id'],_0x3aa935);for(let _0xc18d63=0x0;_0xc18d63<_0x2d0c40[_0x5b2e9d(0x1b0)];_0xc18d63++){_0x2d0c40[_0xc18d63][_0x5b2e9d(0x241)]=0x0;for(let _0x1add9e in _0x17f8fe){if(_0x17f8fe[_0x1add9e][_0x5b2e9d(0x132)]==_0x2d0c40[_0xc18d63]['id']){_0x2d0c40[_0xc18d63]['favorite']=0x1;break;}}}}let _0x384fc8=[];_0x22d59f&&(_0x384fc8=getMovieLibrary(_0x4417e5,_0x1955a7,0x6));let _0x353f04={'code':0x0,'movies':_0x551666,'tv':_0x396f98,'history':_0x2d0c40,'libraryList':_0x384fc8,'sourceList':[]};_0x353f04[_0x5b2e9d(0x250)]=getShowMatchName(_0x4417e5[_0x5b2e9d(0x121)][_0x5b2e9d(0x247)]);if(_0xe30f24){let _0x59dcde=_0x4417e5[_0x5b2e9d(0x121)][_0x5b2e9d(0x247)][_0x5b2e9d(0x156)](_0x5b2e9d(0x14f))[_0x5b2e9d(0x148)](_0x5b2e9d(0x231));for(let _0x3c140a of _0x59dcde){let _0x5d46e4=getMoviesByParams(_0x1955a7,_0x4417e5,null,_0x5b2e9d(0x1a2),0x4,0x0,_0x5b2e9d(0x167),null,null,JSON[_0x5b2e9d(0x1b7)]([path[_0x5b2e9d(0x21a)](_0x3c140a[_0x5b2e9d(0x146)])]));if(_0x5d46e4['length']<0x1)continue;_0x353f04['sourceList'][_0x5b2e9d(0x161)]({'mediaType':_0x3c140a[_0x5b2e9d(0x1ea)],'path':_0x3c140a[_0x5b2e9d(0x146)],'name':path['basename'](_0x3c140a['path']),'sourceMovies':_0x5d46e4});}}return _0x1955a7[_0x5b2e9d(0x1c1)](_0x353f04);}}),router[_0x55faad(0x1ee)](_0x55faad(0x1de),(_0x592f09,_0x52bb35,_0x295488)=>{const _0x358c53=_0x55faad;if(dbUserTable[_0x358c53(0x1d4)](_0x592f09,_0x52bb35,_0x358c53(0x231),_0x358c53(0x227))==!![]){let _0x6e5d48=getMoviesByParams(_0x52bb35,_0x592f09,0x1,'check_time',0xa,0x0,'desc'),_0x435269=getMoviesByParams(_0x52bb35,_0x592f09,0x2,_0x358c53(0x1a2),0xa,0x0,_0x358c53(0x167)),_0x2635a1='m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name',_0x482f91=_0x358c53(0x1c7)+_0x2635a1+_0x358c53(0x210)+_0x592f09[_0x358c53(0x11f)]['id']+_0x358c53(0x166),_0xc9a976=_0x592f09['app'][_0x358c53(0x1d8)][_0x358c53(0x156)](_0x482f91)[_0x358c53(0x148)](),_0x2eec41=getCollectionList(_0x592f09,_0x52bb35,_0x358c53(0x21d)),_0x120ea3=getCollectionList(_0x592f09,_0x52bb35,'smart'),_0x4a26d1=getMoviesByParams(_0x52bb35,_0x592f09,null,'check_time',0xa,0x0,_0x358c53(0x167),null,null,null,null,null,null,null,_0x358c53(0x12a)),_0x55e494=getMovieLibrary(_0x592f09,_0x52bb35),_0x283fd2={'code':0x0,'movies':_0x6e5d48,'tv':_0x435269,'history':_0xc9a976,'favorites':_0x4a26d1,'collectionList':_0x2eec41,'aiCollectionList':_0x120ea3,'libraryList':_0x55e494};return _0x52bb35[_0x358c53(0x1c1)](_0x283fd2);}}),router[_0x55faad(0x1ee)](_0x55faad(0x15c),(_0x6916a9,_0x5c27,_0x1b4dd8)=>{const _0x1f77c3=_0x55faad;if(dbUserTable['doUserCanGet'](_0x6916a9,_0x5c27,_0x1f77c3(0x231),_0x1f77c3(0x227))==!![]){let _0x1d1366=getMoviesByParams(_0x5c27,_0x6916a9,0x1,'check_time',0x1,0x0,_0x1f77c3(0x167)),_0x402c10=getMoviesByParams(_0x5c27,_0x6916a9,0x2,'check_time',0x1,0x0,_0x1f77c3(0x167)),_0x7c8106=_0x1f77c3(0x20b),_0x6a8a7='SELECT\x20'+_0x7c8106+_0x1f77c3(0x210)+_0x6916a9[_0x1f77c3(0x11f)]['id']+_0x1f77c3(0x1db),_0x356ca7=_0x6916a9[_0x1f77c3(0x121)][_0x1f77c3(0x1d8)][_0x1f77c3(0x156)](_0x6a8a7)[_0x1f77c3(0x148)](),_0x17bdca=getMoviesByParams(_0x5c27,_0x6916a9,null,_0x1f77c3(0x1a2),0x1,0x0,_0x1f77c3(0x167),null,null,null,null,null,null,null,_0x1f77c3(0x12a)),_0x156e57=dbFileIndexTable[_0x1f77c3(0x234)](_0x6916a9[_0x1f77c3(0x121)][_0x1f77c3(0x1d8)],_0x1f77c3(0x222),dbFileIndexTable[_0x1f77c3(0x229)]),_0x55b0af=dbFileIndexTable['getCountByWhere'](_0x6916a9[_0x1f77c3(0x121)][_0x1f77c3(0x1d8)],_0x1f77c3(0x176),dbFileIndexTable[_0x1f77c3(0x229)]);_0x6916a9[_0x1f77c3(0x1bd)][_0x1f77c3(0x17d)]=0x5af3107a3fff,_0x6916a9[_0x1f77c3(0x1bd)][_0x1f77c3(0x22e)]=0x1,_0x6916a9[_0x1f77c3(0x1bd)][_0x1f77c3(0x1b1)]=_0x1f77c3(0x1a2),_0x6916a9[_0x1f77c3(0x1bd)][_0x1f77c3(0x1ca)]=_0x1f77c3(0x167),_0x6916a9[_0x1f77c3(0x1bd)]['trash']=0x0,_0x6916a9[_0x1f77c3(0x1bd)][_0x1f77c3(0x1b2)]=0x1;let _0x1c7c0d=photoApiUtils[_0x1f77c3(0x12f)](_0x6916a9,_0x5c27),_0x120244=getMovieLibrary(_0x6916a9,_0x5c27),_0x2bbf8c={'movieCount':_0x156e57['count'],'tvCount':_0x55b0af[_0x1f77c3(0x1b2)],'code':0x0,'movies':_0x1d1366,'tv':_0x402c10,'history':_0x356ca7,'favorites':_0x17bdca,'photos':_0x1c7c0d,'libraryList':_0x120244};return _0x5c27[_0x1f77c3(0x1c1)](_0x2bbf8c);}});let subtitleExtList=[_0x55faad(0x153),_0x55faad(0x1f5),_0x55faad(0x154)];router[_0x55faad(0x1ee)](_0x55faad(0x1cf),(_0x12a99f,_0x44ff29,_0x282066)=>{const _0x53585f=_0x55faad;let _0x4aac34=[],_0x532624=null;if(_0x12a99f['body']['videoPath'])_0x532624=_0x12a99f[_0x53585f(0x1bd)][_0x53585f(0x202)],_0x532624=fileUtil[_0x53585f(0x1f6)](_0x532624);else{if(_0x12a99f[_0x53585f(0x1bd)]['id']){let _0x107ba6=_0x12a99f[_0x53585f(0x1bd)]['id'],_0x2c564a=dbFileIndexTable['getById'](_0x12a99f[_0x53585f(0x121)][_0x53585f(0x1d8)],_0x107ba6,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);_0x2c564a&&(_0x532624=path[_0x53585f(0x21a)](_0x2c564a[_0x53585f(0x146)],_0x2c564a[_0x53585f(0x23e)]),_0x12a99f['app'][_0x53585f(0x1d8)]['prepare']('UPDATE\x20file_index_movie\x20set\x20check_time=?\x20WHERE\x20id=?')['run'](Date['now'](),_0x2c564a['id']));}}function _0x2951e9(){const _0x36b49a=_0x53585f;let _0x15dbe9=dbConfigTable[_0x36b49a(0x127)](_0x12a99f[_0x36b49a(0x121)][_0x36b49a(0x247)],_0x36b49a(0x26f)),_0x3c08fe=dbConfigTable[_0x36b49a(0x127)](_0x12a99f[_0x36b49a(0x121)][_0x36b49a(0x247)],_0x36b49a(0x184));return _0x44ff29['json']({'code':0x0,'data':_0x4aac34,'defaultTranscodeResolution':_0x3c08fe?_0x3c08fe['value']:_0x36b49a(0x143),'userFontSize':_0x15dbe9?_0x15dbe9[_0x36b49a(0x1cb)]:1.5});}_0x532624?fs['stat'](_0x532624,(_0x924d57,_0x33a16c)=>{const _0x9d422d=_0x53585f;if(_0x924d57)return _0x2951e9();let _0x25c84c=path[_0x9d422d(0x172)](_0x532624);fs[_0x9d422d(0x122)](_0x25c84c,(_0x2b77ae,_0x88cf8a)=>{const _0x10c02d=_0x9d422d;if(_0x2b77ae)return _0x2951e9();let _0x4c65b8=path[_0x10c02d(0x23f)](_0x532624)[_0x10c02d(0x1bc)](path[_0x10c02d(0x188)](_0x532624),''),_0x40c795=_0x4c65b8[_0x10c02d(0x1f8)]('\x20','_');for(let _0x577045 in _0x88cf8a){let _0x251cfa=_0x88cf8a[_0x577045],_0x2f4aa2=path[_0x10c02d(0x188)](_0x251cfa);(_0x251cfa[_0x10c02d(0x26b)](_0x4c65b8)||_0x251cfa[_0x10c02d(0x26b)](_0x40c795))&&subtitleExtList[_0x10c02d(0x1f0)](_0x2f4aa2)&&_0x4aac34['push']({'fileName':path[_0x10c02d(0x23f)](_0x251cfa),'filePath':path[_0x10c02d(0x21a)](_0x25c84c,_0x251cfa)});}return _0x2951e9();});}):_0x2951e9();}),router[_0x55faad(0x1ee)](_0x55faad(0x13b),(_0x12d3ff,_0x449c08,_0x3ef6fd)=>{const _0x2a2c50=_0x55faad;let _0x366fb1=_0x12d3ff[_0x2a2c50(0x121)][_0x2a2c50(0x1d8)]['prepare'](_0x2a2c50(0x20a))[_0x2a2c50(0x148)](),_0x1a078a=_0x12d3ff[_0x2a2c50(0x121)][_0x2a2c50(0x1d8)][_0x2a2c50(0x156)](_0x2a2c50(0x18c))[_0x2a2c50(0x148)](),_0x58aed7=_0x12d3ff[_0x2a2c50(0x121)][_0x2a2c50(0x1d8)][_0x2a2c50(0x156)](_0x2a2c50(0x125))[_0x2a2c50(0x148)]();_0x449c08[_0x2a2c50(0x1c1)]({'code':0x0,'data':_0x366fb1['concat'](_0x1a078a,_0x58aed7)});}),router[_0x55faad(0x1ee)]('/deleteIndex',(_0x252bf3,_0x38733e,_0x84bb52)=>{const _0x2f95eb=_0x55faad;let _0x27edb6=_0x252bf3['body'][_0x2f95eb(0x168)],_0x5e638c=dbFileIndexTable['getById'](_0x252bf3[_0x2f95eb(0x121)][_0x2f95eb(0x1d8)],_0x27edb6,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x5e638c)return _0x38733e[_0x2f95eb(0x1c1)]({'code':0x0});if(dbUserTable[_0x2f95eb(0x1d4)](_0x252bf3,_0x38733e,_0x2f95eb(0x231),_0x2f95eb(0x1e2),_0x5e638c[_0x2f95eb(0x146)])==!![])return dbFileIndexTable[_0x2f95eb(0x23a)](_0x252bf3['app'][_0x2f95eb(0x1d8)],_0x27edb6,dbFileIndexTable[_0x2f95eb(0x229)]),_0x38733e[_0x2f95eb(0x1c1)]({'code':0x0});}),router[_0x55faad(0x1ee)](_0x55faad(0x141),(_0x173e3b,_0x2d6f31,_0xf630b7)=>{const _0x3da27a=_0x55faad;let _0x41fdfc=_0x173e3b['currentUser']['id'],_0x21f305=parseInt(_0x173e3b['body'][_0x3da27a(0x1ce)]),_0x46c33d=dbMovieFavorite[_0x3da27a(0x236)](_0x173e3b[_0x3da27a(0x121)]['dbFileIndex'],_0x41fdfc,_0x21f305),_0x4b6f35=0x0;if(_0x46c33d)dbMovieFavorite[_0x3da27a(0x16b)](_0x173e3b[_0x3da27a(0x121)][_0x3da27a(0x1d8)],_0x41fdfc,_0x21f305);else{_0x4b6f35=0x1;let _0x4d9087=new Date()['getTime']();_0x173e3b[_0x3da27a(0x121)][_0x3da27a(0x1d8)][_0x3da27a(0x156)]('UPDATE\x20file_index_movie\x20set\x20check_time=?\x20WHERE\x20id=?')['run'](_0x4d9087,_0x21f305),dbMovieFavorite['addFavorite'](_0x173e3b[_0x3da27a(0x121)][_0x3da27a(0x1d8)],_0x41fdfc,_0x21f305);}return _0x2d6f31['json']({'code':0x0,'favorite':_0x4b6f35});}),router[_0x55faad(0x1ee)](_0x55faad(0x268),(_0x5742d2,_0x154974,_0x25d09e)=>{const _0xaea910=_0x55faad;try{let _0x58e3c1=parseInt(_0x5742d2[_0xaea910(0x1bd)][_0xaea910(0x168)]),_0x3d8787=dbFileIndexTable[_0xaea910(0x206)](_0x5742d2['app'][_0xaea910(0x1d8)],_0x58e3c1,dbFileIndexTable[_0xaea910(0x229)]);if(!_0x3d8787)return _0x154974[_0xaea910(0x1c1)]({'code':0x0});let _0xa09e6f=parseInt(_0x5742d2[_0xaea910(0x1bd)][_0xaea910(0x17b)]),_0x423f1f=parseInt(_0x5742d2[_0xaea910(0x1bd)][_0xaea910(0x1b6)]);!_0x423f1f&&(_0x423f1f=0x0);!_0xa09e6f&&(_0xa09e6f=0x0);let _0x39fee5=parseInt(_0x5742d2[_0xaea910(0x1bd)][_0xaea910(0x22a)]);if(_0xa09e6f<0x0||_0x423f1f<0x0||_0xa09e6f>_0x3d8787[_0xaea910(0x1c4)]||_0x423f1f>_0x3d8787[_0xaea910(0x1c4)]||_0x39fee5!=0x0&&_0x39fee5!=0x1)return _0x5742d2[_0xaea910(0x121)][_0xaea910(0x138)](_0x154974,'Value\x20out\x20of\x20limit');let _0x5d9ae1=[_0x3d8787];_0x3d8787['is_tvplay']==0x1&&(_0x5d9ae1=_0x5742d2['app']['dbFileIndex']['prepare'](_0xaea910(0x157)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0xaea910(0x14e))[_0xaea910(0x148)](_0x3d8787[_0xaea910(0x146)]));let _0x21387c='(';for(let _0x39f16b in _0x5d9ae1){_0x21387c+=_0x5d9ae1[_0x39f16b]['id'],_0x39f16b!=_0x5d9ae1[_0xaea910(0x1b0)]-0x1&&(_0x21387c+=',');}return _0x21387c+=')',_0x5742d2[_0xaea910(0x121)][_0xaea910(0x1d8)][_0xaea910(0x156)](_0xaea910(0x23d)+_0x21387c)[_0xaea910(0x160)](_0xa09e6f,_0x423f1f,_0x39fee5),_0x154974[_0xaea910(0x1c1)]({'code':0x0});}catch(_0x5a95ea){return console[_0xaea910(0x162)](_0x5a95ea),_0x5742d2[_0xaea910(0x121)][_0xaea910(0x138)](_0x154974,_0x154974['__']('operationFail'));}});function getMovieLibrary(_0x303019,_0x2170bb,_0x3121d2){const _0x58a819=_0x55faad;let _0x5612c1=_0x303019[_0x58a819(0x1bd)]['offset']||0x0,_0x571537=_0x3121d2||_0x303019[_0x58a819(0x1bd)][_0x58a819(0x1b2)]||0x32,_0x54961a=_0x303019[_0x58a819(0x1bd)][_0x58a819(0x215)]||'',_0x341e12=_0x303019[_0x58a819(0x1bd)]['orderField']||_0x58a819(0x261),_0x5864c1=_0x303019[_0x58a819(0x1bd)][_0x58a819(0x1a8)]||_0x58a819(0x167);if(!['create_time',_0x58a819(0x253)][_0x58a819(0x1f0)](_0x341e12))return console['log']('order\x20field\x20error',_0x341e12),[];let _0x5a7664=[],_0x5a82de=[],_0x540464=_0x58a819(0x271);_0x303019['currentUser'][_0x58a819(0x270)]==0x1?_0x54961a&&(_0x540464+='\x20WHERE\x20title\x20like\x20?',_0x5a82de[_0x58a819(0x161)]('%'+_0x54961a+'%')):(_0x540464=_0x58a819(0x16a),_0x54961a&&(_0x540464+=_0x58a819(0x185),_0x5a82de[_0x58a819(0x161)]('%'+_0x54961a+'%')));_0x540464+=_0x58a819(0x16e)+_0x341e12+'\x20'+_0x5864c1+_0x58a819(0x254),_0x5a82de[_0x58a819(0x161)](_0x571537),_0x5a82de[_0x58a819(0x161)](_0x5612c1),_0x5a7664=_0x303019[_0x58a819(0x121)]['dbFileIndex'][_0x58a819(0x156)](_0x540464)[_0x58a819(0x148)](_0x5a82de);if(_0x5a7664[_0x58a819(0x1b0)]<0x1)return[];for(let _0x1eaaaf in _0x5a7664){let _0x100a4f=_0x5a7664[_0x1eaaaf];try{let _0x4a13c4=JSON[_0x58a819(0x23c)](_0x100a4f[_0x58a819(0x1f9)]),_0x27b578=[];for(let _0x174a1a of _0x4a13c4){let _0x26302d=dbUserTable['findWithField'](_0x303019['app'][_0x58a819(0x247)],_0x174a1a,'id,username');_0x27b578['push'](_0x26302d);}_0x5a7664[_0x1eaaaf]['user_list']=_0x27b578;}catch(_0x2e19b2){console[_0x58a819(0x162)](_0x2e19b2);}let _0x5abc09=getMoviesByParams(_0x2170bb,_0x303019,null,_0x58a819(0x1a2),0x4,0x0,_0x58a819(0x167),null,null,null,null,null,null,null,null,null,_0x5a7664[_0x1eaaaf]['id']);_0x5a7664[_0x1eaaaf][_0x58a819(0x1b8)]=_0x5abc09;}return _0x5a7664;}router[_0x55faad(0x1ee)]('/operationLibrary',(_0x4498c6,_0x1ed44d,_0xe80e78)=>{const _0x304afa=_0x55faad;let _0x18866c=_0x4498c6[_0x304afa(0x1bd)][_0x304afa(0x253)],_0x55f4ac=_0x4498c6[_0x304afa(0x1bd)]['libraryId'],_0x45e248=_0x4498c6[_0x304afa(0x1bd)]['pathList'],_0xec1cbf=_0x4498c6[_0x304afa(0x1bd)][_0x304afa(0x190)],_0x5c2f45=_0x4498c6[_0x304afa(0x1bd)][_0x304afa(0x18b)],_0x404735=_0x4498c6[_0x304afa(0x1bd)][_0x304afa(0x14c)];if(_0x404735==_0x304afa(0x18d)){let _0x12a3b6=getMovieLibrary(_0x4498c6,_0x1ed44d);return _0x1ed44d['json']({'code':0x0,'data':_0x12a3b6});}else{if(_0x4498c6[_0x304afa(0x11f)][_0x304afa(0x270)]!=0x1)return _0x4498c6[_0x304afa(0x121)][_0x304afa(0x138)](_0x1ed44d,_0x1ed44d['__']('noPermission'));if(_0x404735==_0x304afa(0x24c)||_0x404735==_0x304afa(0x1e1)){if(!_0x45e248||!_0x45e248 instanceof Array||_0x45e248[_0x304afa(0x1b0)]<0x1)return _0x4498c6[_0x304afa(0x121)][_0x304afa(0x138)](_0x1ed44d,_0x1ed44d['__'](_0x304afa(0x13e)));if(_0x5c2f45){if(_0xec1cbf!=null&&!_0xec1cbf instanceof Array)return _0x4498c6['app']['returnErrMsg'](_0x1ed44d,_0x1ed44d['__'](_0x304afa(0x13e)));}if(sqliteUtil[_0x304afa(0x1a6)](JSON[_0x304afa(0x1b7)](_0x45e248))==!![])return _0x4498c6[_0x304afa(0x121)][_0x304afa(0x138)](_0x1ed44d,_0x304afa(0x19a));}if(_0x404735==_0x304afa(0x1e1)&&_0x55f4ac)_0x4498c6[_0x304afa(0x121)][_0x304afa(0x1d8)]['prepare']('UPDATE\x20movie_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?')[_0x304afa(0x160)](_0x18866c,JSON[_0x304afa(0x1b7)](_0x45e248),_0x5c2f45,JSON[_0x304afa(0x1b7)](_0xec1cbf),_0x55f4ac);else{if(_0x404735=='DELETE'&&_0x55f4ac)_0x4498c6['app'][_0x304afa(0x1d8)][_0x304afa(0x156)](_0x304afa(0x1be))['run'](_0x55f4ac);else{if(_0x404735=='ADD')_0x4498c6['app']['dbFileIndex'][_0x304afa(0x156)](_0x304afa(0x16d))[_0x304afa(0x160)](_0x18866c,JSON[_0x304afa(0x1b7)](_0x45e248),_0x5c2f45,JSON[_0x304afa(0x1b7)](_0xec1cbf),_0x4498c6[_0x304afa(0x11f)]['id']);else return _0x4498c6[_0x304afa(0x121)]['returnErrMsg'](_0x1ed44d,_0x1ed44d['__'](_0x304afa(0x1c3)));}}return _0x1ed44d['json']({'code':0x0});}}),module[_0x55faad(0x181)]=router;