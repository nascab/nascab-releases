const _0x4c1276=_0x2c5e;(function(_0x31fc44,_0x1a85dc){const _0x536c22=_0x2c5e,_0x47766d=_0x31fc44();while(!![]){try{const _0x13d580=-parseInt(_0x536c22(0x263))/0x1*(parseInt(_0x536c22(0x341))/0x2)+-parseInt(_0x536c22(0x2e9))/0x3*(-parseInt(_0x536c22(0x276))/0x4)+-parseInt(_0x536c22(0x30f))/0x5+-parseInt(_0x536c22(0x313))/0x6*(-parseInt(_0x536c22(0x25e))/0x7)+-parseInt(_0x536c22(0x2f9))/0x8+parseInt(_0x536c22(0x1ef))/0x9*(-parseInt(_0x536c22(0x25f))/0xa)+parseInt(_0x536c22(0x2d5))/0xb*(parseInt(_0x536c22(0x2b3))/0xc);if(_0x13d580===_0x1a85dc)break;else _0x47766d['push'](_0x47766d['shift']());}catch(_0x234192){_0x47766d['push'](_0x47766d['shift']());}}}(_0x39c4,0xb09ae));function _0x39c4(){const _0x245d88=['SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_movie\x20WHERE\x20path\x20like\x20?\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1','\x20\x20WHERE\x20','delete','-QHD','\x20id,title,data,enable_pwd,collection_cover_path,data_value,create_time,share_for_subuser\x20','\x20AND\x20(','fromName','saveMovieInfoToDb','../../db/dbSourceFolderTable','json','whereStr','/addIndexToCollection','\x20AND\x20(filename_fl=?\x20OR\x20show_name_fl=?\x20OR\x20movie_info_name_fl=?)','dataPreview','298SpbLqT','ignoreTvList','replace','dbFileIndex','\x20order\x20by\x20filename_number,filename','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20\x20or\x20filename\x20like\x20?)','tvCount','1959723fRiONw','isTvSeries','../../utils/nfoUtil','parseNfoTvSeries','\x20type=2\x20and\x20is_file=1','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20where\x20collection_id=?','getFilenameNumber','sha256','tvFolderName','SELECT\x20*\x20FROM\x20movie_library\x20','./photoApiUtils','dealFirstLetterSingle','getTime','SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?','INDEX_TABLE_NAME_MOVIE','name','parse','stringify','startScanPath','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=3\x20WHERE\x20path\x20like\x20?\x20OR\x20path=?','pageCount','movieTvCache','stat','/setTvplay','SELECT\x20index_id\x20FROM\x20movie_history\x20where\x20index_id\x20in\x20','filepath','currentUser','duration','(filename\x20like\x20?)','../../utils/movieInfoUtil','media_type','/getIndexDetail','status','indexId','-seriesPoster','DELETE','\x20FROM\x20','returnErrMsg','excludeIds','orderField','movieRegion','SELECT\x20id\x20FROM\x20','SELECT\x20*\x20FROM\x20movie_keys\x20WHERE\x20key_type=?\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20200','UPDATE\x20file_index_movie\x20SET\x20collection_id=?\x20WHERE\x20id\x20in\x20','searchValue','/removeIndexFromCollection','enable_pwd','\x27\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27','title','.jpg','movie_index_id','fanart.%','.ass','sort','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay!=1','\x20AND\x20(path\x20like\x20?\x20OR\x20filename\x20like\x20?\x20OR\x20movie_info_name\x20like\x20?\x20)','1080p\x203mbps','SELECT\x20count(*)\x20as\x20count\x20FROM\x20','clearlogo.%','timeType','\x20SET\x20show_in_list=1\x20WHERE\x20id=?','getAllByWhereAndField','collection_id','/setTitleAndEnding','movie_info_name','movieLanguage','/getMovies','length','folder.jpg','catch','tvFolderPath','coverMovie','UPDATE\x20movie_collection\x20SET\x20title=?,data=?,enable_pwd=?,pwd=?,collection_cover_path=?,data_value=?,share_for_subuser=?\x20WHERE\x20id=?','needLogoPathAndFanart','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_regions\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','FAVORITE','DELETE\x20FROM\x20movie_collection\x20WHERE\x20id=?','pwdCanNotBeNull','openDuration','power_change','\x20WHERE\x20is_file=0\x20and\x20(path=?\x20or\x20path\x20like\x20?)\x20','push','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_language\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','needTvCount','-HD','../../db/dbFileIndexTable','movie_language','dbOther','/getTvList','pageSize','search','sep','%season','movieHomeShowLibrary','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20share_for_subuser=1','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0\x20WHERE\x20(path\x20like\x20?\x20OR\x20path=?)','sameFolderImgList','SELECT\x20','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','error\x20pathList','user_list','ADD','getFavorite','\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20check_time\x20DESC\x20LIMIT\x20?','Value\x20out\x20of\x20limit','\x20and\x20show_in_list=1','is_file','/getTvSeriesDetail','SELECT\x20id,title,enable_pwd,create_time\x20FROM\x20movie_collection\x20where\x20id=?\x20and\x20pwd=?','listType','poster.jpeg','154cMHpir','30ucxhGa','check_time','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010','getExcludePathWhereStr','828awBVBJ','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20id=?','sortField','SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?','substr','checkPath','-FHD','\x20AND\x20','movieActors','SWITCH_MOVIE_INFO','create_time','defaultTranscodeResolution','index.videoInfoReadFail','findWithField','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20','autoSkip','\x20SELECT\x20','\x20type=2','SELECT\x20*\x20from\x20','1760984CCYWeb','folder_cover_path','coverPath','ordinary','seasonNumber','DELETE\x20FROM\x20movie_history\x20where\x20user_id=','heic','\x27\x20and\x20type=1\x20and\x20is_file=1\x20limit\x2020','../../db/dbConfigTable','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1','collectionId','dataValue','tvplay','trim','startsWith','shareForSubUser','/getTvHomeData','movie_actor','\x20SET\x20show_in_list=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=?\x20or\x20path\x20like\x20?','fileExist','key_value','../utils/sqliteUtil','/getMoviesByGenres','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id','\x20FROM\x20\x20movie_collection\x20WHERE\x20type=?','ALL','findByTitle','then','GET','\x20AND\x20is_tvplay==0','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2050','power_get','isAdmin','log','operation','\x20id,collection_id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list','movieCollectionNotExist','dialog','endDuration','REPLACE\x20INTO\x20movie_history(index_id,user_id,time,create_time)\x20VALUES(\x20?,?,?,?)','sortType','\x20LIKE\x20?','/movieFavorite','send','\x20LIMIT\x20','data','../../db/dbMovieFavorite','-UHD','movieDirectors','path_list','count','checkSqlInjection','/getMovieKeys','sourceFolderId','seasonList','join','filename','endsWith','basename','paramsList','needSeasonCount','501744gFmycP','prepare','genresType','SELECT\x20*\x20FROM\x20source_folder\x20WHERE\x20type=?\x20LIMIT\x2010','\x20like\x20?\x20','UPDATE\x20file_index_movie\x20set\x20check_time=?\x20WHERE\x20id=?','updateByWhere','/getMovieHomeData','exports','set','/clearHistory','getById','\x20and\x20filename\x20>=\x20?\x20','/deleteIndex','videoPath','error\x20data','run','enablePwd','smart','\x20order\x20by\x20create_time\x20desc','../../db/dbUserTable','value','getFavoriteList','show_name','REPLACE\x20INTO\x20movie_collection(title,enable_pwd,pwd,user_id,type,data,collection_cover_path,data_value,share_for_subuser)\x20VALUES(\x20?,?,?,?,?,?,?,?,?)','order\x20field\x20error','DELETE\x20FROM\x20movie_library\x20\x20WHERE\x20id=?','m.time,\x20f.id,f.is_tvplay,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','/addHistory','express','thumb.jpg','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','index_count','movie','704VJwJYM','app','\x20and\x20title\x20like\x20?','/getHistory','indexIdList','movie_genres','dirname','\x20as\x20f\x20WHERE\x20','movieGenres','-clearlogo.%','history','未找到NFO信息','\x20AND\x20(filename_fl=?\x20AND\x20show_name_fl=?\x20AND\x20movie_info_name_fl=?)','getSeasonNumber','body','useTvSeriesInfo','REPLACE\x20INTO\x20movie_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','collectionPwd','now','concat','3DZbumO','UPDATE\x20','\x20WHERE\x20title\x20like\x20?','sourceFolderList','movie_regions','getAllFavoriteByWhere','type','path','movie_director','/getMovieDetail','getUserPathWhere','seasonCount','is_tvplay','-coverCache-','\x20AND\x20is_tvplay==1','deleteFavorite','10205072pWjGOt','time','UPDATE\x20movie_history\x20SET\x20time=?,create_time=?\x20where\x20index_id=?\x20AND\x20user_id=?','\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id=','addScanTask','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_genres\x27\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','.fanart.%','\x20AND\x20id\x20NOT\x20IN\x20(','getCountByWhere','decodePath','login.pwdErr','\x20LIMIT\x20?\x20OFFSET\x20?','desc','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20or\x20filename\x20like\x20?)','select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2','-fanart.%','excludeFilenameMovie','searchStr','/getTvHomeData2','\x20AND\x20collection_id\x20=\x20','ignore_match_info','../../utils/movieSeasonUtil','6746905nFjjyi','%poster%','get','has','275124WvBwwm','is_admin','orderType','\x20OFFSET\x20','/operationLibrary','\x20as\x20f\x20WHERE\x20path\x20like\x20?\x20and\x20is_tvplay=1\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20limit\x20200','poster.jpg','favorite','id,username','/checkCollectionPwd','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20?\x20or\x20filename\x20like\x20?)\x20and\x20filename\x20not\x20like\x20?','operationFail','extname','../utils/movieUtil','offset','movieShowMatchName','includes','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)','existsSync','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay==1','/deleteCollection','post','sourceType','all','parseNfo','-seasonCount-','noPermission','ignoreSeasonList','doUserCanGet','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20and\x20filename_number\x20is\x20null','\x20or\x20','index_id'];_0x39c4=function(){return _0x245d88;};return _0x39c4();}var express=require(_0x4c1276(0x2d0)),router=express['Router']();let path=require(_0x4c1276(0x2f0));const dbFileIndexTable=require(_0x4c1276(0x244)),dbUserTable=require(_0x4c1276(0x2c7));var fs=require('fs');let sha256=require(_0x4c1276(0x1f6));const dbConfigTable=require(_0x4c1276(0x27e)),dbSourceFolderTable=require(_0x4c1276(0x33b)),nfoUtil=require(_0x4c1276(0x1f1)),dbMovieFavorite=require(_0x4c1276(0x2a4)),movieUtil=require(_0x4c1276(0x320));let fileUtil=require('../utils/fileUtils');const sqliteUtil=require(_0x4c1276(0x28b)),photoApiUtils=require(_0x4c1276(0x1f9));let movieSeasonUtil=require(_0x4c1276(0x30e)),movieInfoUtil=require(_0x4c1276(0x20c));const dbScanTaskTable=require('../../db/dbScanTaskTable');let movieFieldStr=_0x4c1276(0x299);function getTvSeriesPoster(_0xdfa56a){const _0x56b339=_0x4c1276;let _0x147d6b='',_0x179fde=path['join'](path[_0x56b339(0x2db)](_0xdfa56a[_0x56b339(0x2f0)]),_0x56b339(0x319));return fs['existsSync'](_0x179fde)&&(_0x147d6b=_0x179fde),!_0x147d6b&&(_0x179fde=path[_0x56b339(0x2ad)](path[_0x56b339(0x2db)](_0xdfa56a['path']),_0x56b339(0x25d)),fs[_0x56b339(0x325)](_0x179fde)&&(_0x147d6b=_0x179fde)),!_0x147d6b&&(_0x179fde=path[_0x56b339(0x2ad)](path[_0x56b339(0x2db)](_0xdfa56a[_0x56b339(0x2f0)]),_0x56b339(0x233)),fs[_0x56b339(0x325)](_0x179fde)&&(_0x147d6b=_0x179fde)),!_0x147d6b&&(_0x179fde=path[_0x56b339(0x2ad)](path[_0x56b339(0x2db)](_0xdfa56a[_0x56b339(0x2f0)]),_0x56b339(0x2d1)),fs[_0x56b339(0x325)](_0x179fde)&&(_0x147d6b=_0x179fde)),_0x147d6b;}router[_0x4c1276(0x328)](_0x4c1276(0x25a),(_0xe8efbf,_0x468dca,_0x47a499)=>{const _0x309fa7=_0x4c1276;let _0x26842d=_0xe8efbf[_0x309fa7(0x2e3)]['id'],_0x1b8726=dbFileIndexTable[_0x309fa7(0x2be)](_0xe8efbf[_0x309fa7(0x2d6)][_0x309fa7(0x344)],_0x26842d,dbFileIndexTable[_0x309fa7(0x1fd)]);if(!_0x1b8726)return _0xe8efbf[_0x309fa7(0x2d6)][_0x309fa7(0x214)](_0x468dca,_0x468dca['__'](_0x309fa7(0x26f)));if(dbUserTable[_0x309fa7(0x32f)](_0xe8efbf,_0x468dca,'movie',_0x309fa7(0x295),_0x1b8726[_0x309fa7(0x2f0)])==!![]){nfoUtil[_0x309fa7(0x1f2)](_0x1b8726)['then'](_0x1de329=>{const _0x41452e=_0x309fa7;_0x1b8726=_0x1de329,_0xe8efbf[_0x41452e(0x2e3)][_0x41452e(0x238)]=!![],_0xe8efbf[_0x41452e(0x2e3)][_0x41452e(0x2e4)]=0x1,_0x1b8726=addFolderCoverPath(_0x468dca,_0xe8efbf,_0x1b8726),_0x5ab15d();})[_0x309fa7(0x234)](_0x5503b0=>{const _0x7a001f=_0x309fa7;console[_0x7a001f(0x297)](_0x7a001f(0x2e0),_0x5503b0),_0x1b8726=addFolderCoverPath(_0x468dca,_0xe8efbf,_0x1b8726),_0x1b8726[_0x7a001f(0x22f)]=_0x1b8726[_0x7a001f(0x1f7)],_0x5ab15d();});function _0x5ab15d(){const _0x38215f=_0x309fa7;addTvFolderPathAndName(_0x1b8726),setLogoAndFanart(_0xe8efbf,_0x1b8726,_0x1b8726[_0x38215f(0x235)]);let _0x495bf2=dbMovieFavorite[_0x38215f(0x255)](_0xe8efbf[_0x38215f(0x2d6)][_0x38215f(0x344)],_0xe8efbf[_0x38215f(0x209)]['id'],_0x1b8726['id']);_0x495bf2?_0x1b8726[_0x38215f(0x31a)]=0x1:_0x1b8726[_0x38215f(0x31a)]=0x0;let _0x263ef3={'code':0x0,'movieIndex':_0x1b8726};fs[_0x38215f(0x205)](_0x1b8726['tvFolderPath'],(_0x8b90d,_0x56826f)=>{const _0x4b4654=_0x38215f;_0x263ef3[_0x4b4654(0x289)]=_0x8b90d?0x0:0x1,_0x468dca['json'](_0x263ef3),_0x1b8726[_0x4b4654(0x2f5)]==0x1&&_0x1b8726[_0x4b4654(0x235)]&&(dbScanTaskTable[_0x4b4654(0x2fd)](_0xe8efbf['app']['dbOther'],_0x4b4654(0x2d4),_0x1b8726[_0x4b4654(0x235)]),process[_0x4b4654(0x2a1)]({'type':_0x4b4654(0x201),'source_type':_0x4b4654(0x2d4),'restartWatcher':![]}));});}}}),router[_0x4c1276(0x328)](_0x4c1276(0x2f2),(_0x3a26aa,_0x417aca,_0x54de6b)=>{const _0x4c4440=_0x4c1276;let _0x2d5d85=_0x3a26aa['body']['id'],_0x108b12=dbFileIndexTable[_0x4c4440(0x2be)](_0x3a26aa[_0x4c4440(0x2d6)][_0x4c4440(0x344)],_0x2d5d85,dbFileIndexTable[_0x4c4440(0x1fd)]);if(!_0x108b12)return _0x3a26aa[_0x4c4440(0x2d6)]['returnErrMsg'](_0x417aca,_0x417aca['__'](_0x4c4440(0x26f)));if(dbUserTable[_0x4c4440(0x32f)](_0x3a26aa,_0x417aca,_0x4c4440(0x2d4),_0x4c4440(0x295),_0x108b12[_0x4c4440(0x2f0)])==!![]){nfoUtil[_0x4c4440(0x32b)](_0x108b12,!![],![])[_0x4c4440(0x291)](_0x54fb1d=>{const _0x51328d=_0x4c4440;_0x108b12=_0x54fb1d,_0x3a26aa[_0x51328d(0x2e3)][_0x51328d(0x238)]=!![],_0x108b12=addFolderCoverPath(_0x417aca,_0x3a26aa,_0x108b12),movieInfoUtil[_0x51328d(0x33a)](_0x3a26aa[_0x51328d(0x2d6)][_0x51328d(0x344)],_0x108b12['id'],_0x54fb1d),_0x31b212();})[_0x4c4440(0x234)](()=>{_0x108b12=addFolderCoverPath(_0x417aca,_0x3a26aa,_0x108b12),_0x31b212();});function _0x31b212(){const _0x11c54a=_0x4c4440;let _0x45c665=dbMovieFavorite[_0x11c54a(0x255)](_0x3a26aa[_0x11c54a(0x2d6)]['dbFileIndex'],_0x3a26aa[_0x11c54a(0x209)]['id'],_0x108b12['id']);_0x45c665?_0x108b12[_0x11c54a(0x31a)]=0x1:_0x108b12[_0x11c54a(0x31a)]=0x0;let _0x1edf3f=null;if(_0x108b12[_0x11c54a(0x2f5)]==0x1){let _0x1e131e=_0x3a26aa[_0x11c54a(0x2d6)][_0x11c54a(0x344)][_0x11c54a(0x2b4)](_0x11c54a(0x218)+dbFileIndexTable[_0x11c54a(0x1fd)]+_0x11c54a(0x251))['all'](_0x108b12['path']),_0x402ed0='(';for(let _0x5af725 in _0x1e131e){_0x402ed0+=_0x1e131e[_0x5af725]['id'],_0x5af725!=_0x1e131e[_0x11c54a(0x232)]-0x1&&(_0x402ed0+=',');}_0x402ed0+=')';let _0x53387f=_0x3a26aa[_0x11c54a(0x2d6)]['dbFileIndex']['prepare'](_0x11c54a(0x207)+_0x402ed0+_0x11c54a(0x2c6))[_0x11c54a(0x311)]();_0x53387f&&(_0x1edf3f=dbFileIndexTable['getById'](_0x3a26aa['app'][_0x11c54a(0x344)],_0x53387f[_0x11c54a(0x332)],dbFileIndexTable[_0x11c54a(0x1fd)]));}let _0x2b99d4={'code':0x0,'movieIndex':_0x108b12,'lastTvEpisodeIndex':_0x1edf3f},_0x39e732=[];try{let _0x2a980f=_0x3a26aa[_0x11c54a(0x2d6)][_0x11c54a(0x344)][_0x11c54a(0x2b4)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=\x27'+_0x108b12[_0x11c54a(0x2f0)]+_0x11c54a(0x27d))[_0x11c54a(0x32a)]();for(let _0x484beb in _0x2a980f){let _0x1eaa82=path[_0x11c54a(0x2ad)](_0x2a980f[_0x484beb][_0x11c54a(0x2f0)],_0x2a980f[_0x484beb]['filename']);(_0x3a26aa[_0x11c54a(0x209)][_0x11c54a(0x314)]==0x1||dbUserTable[_0x11c54a(0x32f)](_0x3a26aa,_0x417aca,'folder',_0x11c54a(0x295),_0x1eaa82,!![])==!![])&&_0x39e732['push'](_0x1eaa82);}_0x2b99d4[_0x11c54a(0x24f)]=_0x39e732;}catch(_0x3db2a9){}let _0x1180a5=path[_0x11c54a(0x2ad)](_0x108b12[_0x11c54a(0x2f0)],_0x108b12[_0x11c54a(0x2ae)]);fs[_0x11c54a(0x205)](_0x1180a5,(_0x9e2405,_0xcdb0b1)=>{const _0x3296c7=_0x11c54a;_0x2b99d4[_0x3296c7(0x289)]=_0x9e2405?0x0:0x1,_0x2b99d4['fileFullPath']=_0x1180a5,_0x417aca[_0x3296c7(0x33c)](_0x2b99d4),_0x108b12[_0x3296c7(0x2f5)]==0x1&&_0x108b12[_0x3296c7(0x235)]&&_0x108b12[_0x3296c7(0x1f0)]!=0x1&&(dbScanTaskTable[_0x3296c7(0x2fd)](_0x3a26aa[_0x3296c7(0x2d6)][_0x3296c7(0x246)],'movie',_0x108b12[_0x3296c7(0x235)]),process[_0x3296c7(0x2a1)]({'type':_0x3296c7(0x201),'source_type':_0x3296c7(0x2d4),'restartWatcher':![]}));});}}}),router[_0x4c1276(0x328)](_0x4c1276(0x247),(_0x10b3b6,_0x269d8f,_0x54decd)=>{const _0x283f14=_0x4c1276;let _0x342a7f=_0x10b3b6[_0x283f14(0x2e3)]['id'],_0x2c15f0=_0x10b3b6['body']['page']||0x0,_0x54d2ef=_0x10b3b6[_0x283f14(0x2e3)][_0x283f14(0x248)]||0xa,_0x5c42c3=_0x10b3b6['body'][_0x283f14(0x30a)],_0x2cae23=_0x10b3b6[_0x283f14(0x2e3)][_0x283f14(0x339)],_0x450b23=_0x10b3b6['body'][_0x283f14(0x342)],_0x50c099=_0x10b3b6[_0x283f14(0x2e3)][_0x283f14(0x32e)],_0x12bc78=dbFileIndexTable[_0x283f14(0x2be)](_0x10b3b6[_0x283f14(0x2d6)][_0x283f14(0x344)],_0x342a7f,dbFileIndexTable[_0x283f14(0x1fd)]);if(!_0x12bc78)return _0x10b3b6[_0x283f14(0x2d6)][_0x283f14(0x214)](_0x269d8f,_0x269d8f['__'](_0x283f14(0x26f)));let _0x3dba6d=movieFieldStr,_0x177a36=[],_0x4fa6f0=0x0;if(dbUserTable[_0x283f14(0x32f)](_0x10b3b6,_0x269d8f,_0x283f14(0x2d4),_0x283f14(0x295),_0x12bc78[_0x283f14(0x2f0)])==!![]){if(_0x450b23==0x1)return _0x4c04b3();let _0x5e2239=_0x10b3b6['app']['dbFileIndex'][_0x283f14(0x2b4)]('SELECT\x20id,filename\x20FROM\x20'+dbFileIndexTable[_0x283f14(0x1fd)]+_0x283f14(0x330))['all'](_0x12bc78[_0x283f14(0x2f0)]);for(let _0x2c2b4a in _0x5e2239){let _0x5b68f4=_0x5e2239[_0x2c2b4a];if(_0x5b68f4['filename']){let _0x4a5275=movieUtil['getFilenameNumber'](_0x5b68f4[_0x283f14(0x2ae)]);_0x10b3b6['app']['dbFileIndex']['prepare'](_0x283f14(0x2ea)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+'\x20SET\x20filename_number=?\x20\x20WHERE\x20\x20id=?')[_0x283f14(0x2c3)](_0x4a5275,_0x5b68f4['id']);}}let _0x288221=dbUserTable[_0x283f14(0x2f3)](_0x10b3b6,_0x283f14(0x2d4),_0x283f14(0x295),!![]),_0xd399b7=[..._0x288221[_0x283f14(0x2b1)]],_0x58a4be=_0x283f14(0x1f3);_0x58a4be+=_0x288221[_0x283f14(0x33d)],_0x58a4be+='\x20and\x20path=?\x20and\x20is_tvplay=1\x20',_0xd399b7[_0x283f14(0x240)](_0x12bc78[_0x283f14(0x2f0)]);_0x5c42c3&&(_0x58a4be+='\x20and\x20(filename\x20like\x20?\x20or\x20movie_info_name\x20like\x20?)\x20',_0xd399b7[_0x283f14(0x240)]('%'+_0x5c42c3+'%','%'+_0x5c42c3+'%'));if(_0x2cae23){let _0x57c669=movieUtil[_0x283f14(0x1f5)](_0x2cae23);_0x57c669?(_0x58a4be+='\x20and\x20filename_number\x20>=\x20?\x20',_0xd399b7['push'](_0x57c669)):(_0x58a4be+=_0x283f14(0x2bf),_0xd399b7[_0x283f14(0x240)](_0x2cae23));}let _0x4e43ab=_0x58a4be+'';_0x58a4be+=_0x283f14(0x345);let _0x4c45c5='SELECT\x20'+_0x3dba6d+_0x283f14(0x213)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x283f14(0x2dc)+_0x58a4be+_0x283f14(0x2a2)+_0x54d2ef+_0x283f14(0x316)+_0x2c15f0*_0x54d2ef;_0x177a36=_0x10b3b6[_0x283f14(0x2d6)][_0x283f14(0x344)][_0x283f14(0x2b4)](_0x4c45c5)[_0x283f14(0x32a)](_0xd399b7);let _0x1f74fd=_0x283f14(0x228)+dbFileIndexTable[_0x283f14(0x1fd)]+_0x283f14(0x334)+_0x4e43ab+'\x20',_0x4997c7=_0x10b3b6[_0x283f14(0x2d6)][_0x283f14(0x344)]['prepare'](_0x1f74fd)['get'](_0xd399b7);_0x4fa6f0=_0x4997c7['count'];if(_0x177a36[_0x283f14(0x232)]>0x0){let _0x59564b=0x0;for(let _0x267e3f in _0x177a36){let _0x4bd374=_0x177a36[_0x267e3f];nfoUtil['parseNfo'](_0x4bd374,!![],!![])[_0x283f14(0x291)](_0xf22fa6=>{const _0x75c053=_0x283f14;_0x59564b+=0x1,_0x177a36[_0x267e3f]=_0xf22fa6,_0x177a36[_0x267e3f]=addFolderCoverPath(_0x269d8f,_0x10b3b6,_0x177a36[_0x267e3f],!![]),_0x59564b>=_0x177a36[_0x75c053(0x232)]&&_0x4c04b3();})[_0x283f14(0x234)](()=>{const _0x135514=_0x283f14;_0x59564b+=0x1,_0x177a36[_0x267e3f]=addFolderCoverPath(_0x269d8f,_0x10b3b6,_0x177a36[_0x267e3f],!![]),_0x59564b>=_0x177a36[_0x135514(0x232)]&&_0x4c04b3();});}}else _0x4c04b3();function _0x4c04b3(){const _0x91bb93=_0x283f14;let _0x2eba72={'code':0x0,'tvplayList':_0x177a36,'count':_0x4fa6f0,'pageSize':_0x54d2ef};if(!_0x50c099){let _0x260d86=path[_0x91bb93(0x2b0)](_0x12bc78['path']),_0x329bd6=movieSeasonUtil[_0x91bb93(0x2e2)](_0x260d86);if(_0x329bd6>-0x1){let _0x35413a=_0x91bb93(0x250)+_0x3dba6d+_0x91bb93(0x213)+dbFileIndexTable[_0x91bb93(0x1fd)]+_0x91bb93(0x318),_0x5c15b2=_0x10b3b6[_0x91bb93(0x2d6)][_0x91bb93(0x344)]['prepare'](_0x35413a)[_0x91bb93(0x32a)](path[_0x91bb93(0x2db)](_0x12bc78[_0x91bb93(0x2f0)])+path[_0x91bb93(0x24a)]+'%'),_0x301975=[];for(let _0x5a5767 of _0x5c15b2){let _0x3a819c=path[_0x91bb93(0x2b0)](_0x5a5767[_0x91bb93(0x2f0)]),_0x404b61=movieSeasonUtil[_0x91bb93(0x2e2)](_0x3a819c);_0x404b61>-0x1&&(_0x5a5767[_0x91bb93(0x27a)]=_0x404b61,_0x301975[_0x91bb93(0x240)](_0x5a5767));}for(let _0x2a42cb of _0x301975){_0x2a42cb=addFolderCoverPath(_0x269d8f,_0x10b3b6,_0x2a42cb);let _0x29c8a9=dbFileIndexTable['getTvCount'](_0x10b3b6[_0x91bb93(0x2d6)][_0x91bb93(0x344)],_0x2a42cb);_0x2a42cb['tvCount']=_0x29c8a9['count'];}_0x301975[_0x91bb93(0x232)]>0x0&&(_0x301975[_0x91bb93(0x224)](function(_0x3fecb3,_0x5957a3){const _0x4709c4=_0x91bb93;return _0x3fecb3[_0x4709c4(0x27a)]-_0x5957a3[_0x4709c4(0x27a)];}),_0x2eba72[_0x91bb93(0x2ac)]=_0x301975);}}return _0x269d8f[_0x91bb93(0x33c)](_0x2eba72);}}}),router[_0x4c1276(0x328)](_0x4c1276(0x21c),(_0xc6f4aa,_0x37eb1c,_0x21afbc)=>{const _0x28fe29=_0x4c1276;let _0x3fa7c3=_0xc6f4aa['body'][_0x28fe29(0x2d9)],_0x20b7a0=[];for(let _0x8938d3 of _0x3fa7c3){let _0x22b9d8=dbFileIndexTable[_0x28fe29(0x2be)](_0xc6f4aa[_0x28fe29(0x2d6)][_0x28fe29(0x344)],_0x8938d3,dbFileIndexTable[_0x28fe29(0x1fd)]);if(!_0x22b9d8)continue;if(dbUserTable[_0x28fe29(0x32f)](_0xc6f4aa,_0x37eb1c,'',_0x28fe29(0x23e),_0x22b9d8[_0x28fe29(0x2f0)])!==!![])continue;let _0x4f4a1a=path['basename'](_0x22b9d8[_0x28fe29(0x2f0)]),_0x5b3586=movieSeasonUtil[_0x28fe29(0x2e2)](_0x4f4a1a);if(_0x5b3586>-0x1){let _0x3c3bd6=path[_0x28fe29(0x2ad)](path[_0x28fe29(0x2db)](_0x22b9d8[_0x28fe29(0x2f0)])),_0x3a1d7d=_0xc6f4aa['app'][_0x28fe29(0x344)][_0x28fe29(0x2b4)](_0x28fe29(0x307))[_0x28fe29(0x32a)](_0x3c3bd6+path[_0x28fe29(0x24a)]+'%',_0x3c3bd6);for(let _0x3a999b of _0x3a1d7d){_0x20b7a0[_0x28fe29(0x240)](_0x3a999b['id']);}}}_0x20b7a0[_0x28fe29(0x232)]>0x0&&(_0x3fa7c3=[..._0x3fa7c3,..._0x20b7a0]);if(_0x3fa7c3[_0x28fe29(0x232)]<0x1)return _0x37eb1c[_0x28fe29(0x33c)]({'code':0x0});let _0x4c0429='(';for(let _0x5a2eb8 in _0x3fa7c3){_0x4c0429+=_0x3fa7c3[_0x5a2eb8],_0x5a2eb8!=_0x3fa7c3[_0x28fe29(0x232)]-0x1&&(_0x4c0429+=',');}return _0x4c0429+=')',_0xc6f4aa['app'][_0x28fe29(0x344)][_0x28fe29(0x2b4)]('UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20WHERE\x20id\x20in\x20'+_0x4c0429)['run'](),_0x37eb1c['json']({'code':0x0});}),router[_0x4c1276(0x328)](_0x4c1276(0x33e),(_0x4065b5,_0x46d4bb,_0x4a83c8)=>{const _0x320326=_0x4c1276;let _0x3b1f13=_0x4065b5[_0x320326(0x2e3)][_0x320326(0x280)],_0x3208d8=_0x4065b5[_0x320326(0x2e3)][_0x320326(0x210)],_0x15d646=_0x4065b5[_0x320326(0x2e3)][_0x320326(0x208)];function _0x4e46cc(_0x25fc72){const _0x10bd4c=_0x320326;let _0x17d204=[];for(let _0x14d7c7 in _0x25fc72){_0x17d204[_0x10bd4c(0x240)](_0x25fc72[_0x14d7c7]['id']);}inSql='(';for(let _0x412af2 in _0x17d204){inSql+=_0x17d204[_0x412af2],_0x412af2!=_0x17d204[_0x10bd4c(0x232)]-0x1&&(inSql+=',');}return inSql+=')',inSql;}if(_0x3b1f13&&_0x3208d8){let _0x54e3b9=dbFileIndexTable[_0x320326(0x2be)](_0x4065b5[_0x320326(0x2d6)][_0x320326(0x344)],_0x3208d8,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x4ad957='('+_0x3208d8+')';if(!_0x54e3b9)return _0x4065b5['app'][_0x320326(0x214)](_0x46d4bb,_0x46d4bb['__'](_0x320326(0x31e)),_0x320326(0x29b));if(dbUserTable[_0x320326(0x32f)](_0x4065b5,_0x46d4bb,'','power_change',_0x54e3b9['path'])!==!![])return;let _0x423265=path[_0x320326(0x2b0)](_0x54e3b9[_0x320326(0x2f0)]),_0x31a877=movieSeasonUtil['getSeasonNumber'](_0x423265);_0x31a877>-0x1&&(_0x54e3b9[_0x320326(0x259)]=0x0,_0x54e3b9['path']=path[_0x320326(0x2db)](_0x54e3b9['path']),_0x54e3b9[_0x320326(0x2ae)]='');if(_0x54e3b9['is_file']!=0x1){let _0x553a01=path[_0x320326(0x2ad)](_0x54e3b9[_0x320326(0x2f0)],_0x54e3b9['filename']);console['log'](_0x320326(0x268),_0x553a01);let _0x3a1dbd=_0x4065b5['app']['dbFileIndex']['prepare'](_0x320326(0x307))[_0x320326(0x32a)](_0x553a01+path[_0x320326(0x24a)]+'%',_0x553a01);if(_0x3a1dbd[_0x320326(0x232)]<0x1)return _0x46d4bb[_0x320326(0x33c)]({'code':0x0});_0x4ad957=_0x4e46cc(_0x3a1dbd);}return _0x4065b5[_0x320326(0x2d6)][_0x320326(0x344)][_0x320326(0x2b4)](_0x320326(0x21a)+_0x4ad957+_0x320326(0x258))['run'](_0x3b1f13),_0x46d4bb[_0x320326(0x33c)]({'code':0x0});}else{if(_0x3b1f13&&_0x15d646){let _0x4fd674=_0x4065b5['app'][_0x320326(0x344)][_0x320326(0x2b4)](_0x320326(0x307))[_0x320326(0x32a)](_0x15d646+path[_0x320326(0x24a)]+'%',_0x15d646),_0x252619=_0x4e46cc(_0x4fd674);return _0x4065b5[_0x320326(0x2d6)][_0x320326(0x344)][_0x320326(0x2b4)](_0x320326(0x21a)+_0x252619+_0x320326(0x258))[_0x320326(0x2c3)](_0x3b1f13),_0x46d4bb[_0x320326(0x33c)]({'code':0x0});}else return _0x4065b5[_0x320326(0x2d6)][_0x320326(0x214)](_0x46d4bb,_0x46d4bb['__'](_0x320326(0x31e)),_0x320326(0x29b));}});function getCollectionList(_0x2779c0,_0x1a2053,_0x3b4bb8){const _0x4b56fe=_0x4c1276;let _0x5a754f=[],_0x56bfae=_0x2779c0[_0x4b56fe(0x2e3)][_0x4b56fe(0x2a8)]||0x32,_0x2a118d=_0x2779c0['body'][_0x4b56fe(0x321)]||0x0,_0x373b34=_0x2779c0[_0x4b56fe(0x2e3)][_0x4b56fe(0x216)]||'id',_0x39093b=_0x2779c0[_0x4b56fe(0x2e3)][_0x4b56fe(0x315)]||_0x4b56fe(0x305),_0x13e5ef=_0x2779c0['body'][_0x4b56fe(0x249)],_0x652faf=_0x4b56fe(0x337),_0x414a90=_0x4b56fe(0x273)+_0x652faf+_0x4b56fe(0x28e),_0x1a093a=[_0x3b4bb8];_0x13e5ef&&(_0x414a90+='\x20AND\x20title\x20like\x20?\x20',_0x1a093a[_0x4b56fe(0x240)]('%'+_0x13e5ef+'%'));_0x2779c0[_0x4b56fe(0x209)][_0x4b56fe(0x314)]!=0x1&&(_0x414a90+='\x20AND\x20share_for_subuser\x20=\x20?\x20',_0x1a093a['push'](0x1));_0x414a90+='\x20order\x20by\x20'+_0x373b34+'\x20'+_0x39093b+_0x4b56fe(0x304),_0x1a093a['push'](_0x56bfae),_0x1a093a[_0x4b56fe(0x240)](_0x2a118d),_0x5a754f=_0x2779c0[_0x4b56fe(0x2d6)][_0x4b56fe(0x344)]['prepare'](_0x414a90)[_0x4b56fe(0x32a)](_0x1a093a);for(let _0x22d380 of _0x5a754f){if(_0x22d380[_0x4b56fe(0x21d)]==0x1)continue;let _0x22dcce=getMoviesByParams(_0x1a2053,_0x2779c0,null,'id',0x1,0x0,_0x4b56fe(0x305),null,null,null,null,null,null,_0x22d380['id']);_0x22dcce[_0x4b56fe(0x232)]>0x0&&(_0x22d380[_0x4b56fe(0x236)]=_0x22dcce[0x0]);}return _0x5a754f;}router['post']('/getCollection',(_0x16252b,_0x46fad2,_0x1caec3)=>{const _0x425beb=_0x4c1276;let _0x295e57=_0x16252b[_0x425beb(0x2e3)][_0x425beb(0x2ef)]||'ordinary',_0x1ef50f=getCollectionList(_0x16252b,_0x46fad2,_0x295e57);return _0x46fad2[_0x425beb(0x33c)]({'code':0x0,'data':_0x1ef50f});}),router[_0x4c1276(0x328)](_0x4c1276(0x31c),(_0x656715,_0x3e75b0,_0x4bcd3e)=>{const _0x536c9e=_0x4c1276;let _0x4b1f1f=_0x656715[_0x536c9e(0x2e3)]['pwd'],_0x82c1cc=_0x656715[_0x536c9e(0x2e3)][_0x536c9e(0x280)];if(!_0x4b1f1f)return _0x656715[_0x536c9e(0x2d6)]['returnErrMsg'](_0x3e75b0,_0x3e75b0['__'](_0x536c9e(0x23c)),_0x536c9e(0x29b));_0x4b1f1f=sha256(_0x4b1f1f);let _0x572afe=_0x656715[_0x536c9e(0x2d6)][_0x536c9e(0x344)][_0x536c9e(0x2b4)](_0x536c9e(0x25b))['get'](_0x82c1cc,_0x4b1f1f);if(!_0x572afe)return _0x656715[_0x536c9e(0x2d6)][_0x536c9e(0x214)](_0x3e75b0,_0x3e75b0['__'](_0x536c9e(0x303)),_0x536c9e(0x29b));return _0x3e75b0[_0x536c9e(0x33c)]({'code':0x0,'data':_0x572afe});}),router[_0x4c1276(0x328)]('/addCollection',(_0x1079d5,_0x4f1327,_0x3945e1)=>{const _0x3fdcd8=_0x4c1276;let _0x366832=_0x1079d5[_0x3fdcd8(0x2e3)]['title'],_0x3f6061=_0x1079d5[_0x3fdcd8(0x2e3)][_0x3fdcd8(0x2c4)],_0x270515=_0x1079d5[_0x3fdcd8(0x2e3)]['pwd'],_0x44bb18=_0x1079d5[_0x3fdcd8(0x2e3)][_0x3fdcd8(0x280)],_0x4feb2a=_0x1079d5[_0x3fdcd8(0x2e3)]['type']?_0x1079d5['body'][_0x3fdcd8(0x2ef)]:_0x3fdcd8(0x279),_0x331bd7=_0x1079d5[_0x3fdcd8(0x2e3)]['data']?_0x1079d5[_0x3fdcd8(0x2e3)][_0x3fdcd8(0x2a3)]:'',_0x3a9abe=_0x1079d5[_0x3fdcd8(0x2e3)][_0x3fdcd8(0x278)]?_0x1079d5[_0x3fdcd8(0x2e3)][_0x3fdcd8(0x278)]:'',_0x67f8c8=_0x1079d5[_0x3fdcd8(0x2e3)]['shareForSubUser'];_0x67f8c8==null&&(_0x67f8c8=0x1);if(_0x4feb2a==_0x3fdcd8(0x2c5)){if(!_0x331bd7||!_0x331bd7[_0x3fdcd8(0x21b)]||sqliteUtil[_0x3fdcd8(0x2a9)](_0x331bd7[_0x3fdcd8(0x21b)])==!![])return _0x1079d5[_0x3fdcd8(0x2d6)][_0x3fdcd8(0x214)](_0x4f1327,_0x3fdcd8(0x2c2));}let _0x3ceed9=_0x1079d5[_0x3fdcd8(0x2e3)]['dataValue']?_0x1079d5[_0x3fdcd8(0x2e3)][_0x3fdcd8(0x281)]:'';if(_0x1079d5[_0x3fdcd8(0x209)]['is_admin']!=0x1)return _0x1079d5['app'][_0x3fdcd8(0x214)](_0x4f1327,_0x4f1327['__'](_0x3fdcd8(0x32d)));if(_0x3f6061=='1'){if(!_0x270515)return _0x1079d5[_0x3fdcd8(0x2d6)][_0x3fdcd8(0x214)](_0x4f1327,_0x4f1327['__']('pwdCanNotBeNull'),_0x3fdcd8(0x29b));_0x270515=sha256(_0x270515);}return _0x44bb18?_0x1079d5['app'][_0x3fdcd8(0x344)][_0x3fdcd8(0x2b4)](_0x3fdcd8(0x237))['run'](_0x366832,JSON[_0x3fdcd8(0x200)](_0x331bd7),_0x3f6061+'',_0x270515,_0x3a9abe,_0x3ceed9,_0x67f8c8,_0x44bb18):_0x1079d5[_0x3fdcd8(0x2d6)][_0x3fdcd8(0x344)][_0x3fdcd8(0x2b4)](_0x3fdcd8(0x2cb))[_0x3fdcd8(0x2c3)](_0x366832,_0x3f6061+'',_0x270515,_0x1079d5[_0x3fdcd8(0x209)]['id']+'',_0x4feb2a,JSON[_0x3fdcd8(0x200)](_0x331bd7),_0x3a9abe,_0x3ceed9,_0x67f8c8),_0x4f1327[_0x3fdcd8(0x33c)]({'code':0x0});}),router[_0x4c1276(0x328)](_0x4c1276(0x327),(_0x1210fa,_0x33b004,_0x4be6c7)=>{const _0x6fbe0d=_0x4c1276;let _0x387fba=_0x1210fa['body'][_0x6fbe0d(0x280)];if(_0x1210fa['currentUser']['is_admin']!=0x1)return _0x1210fa[_0x6fbe0d(0x2d6)]['returnErrMsg'](_0x33b004,_0x33b004['__'](_0x6fbe0d(0x32d)));return _0x1210fa[_0x6fbe0d(0x2d6)][_0x6fbe0d(0x344)][_0x6fbe0d(0x2b4)](_0x6fbe0d(0x1f4))[_0x6fbe0d(0x2c3)](_0x387fba),_0x1210fa[_0x6fbe0d(0x2d6)][_0x6fbe0d(0x344)][_0x6fbe0d(0x2b4)](_0x6fbe0d(0x23b))[_0x6fbe0d(0x2c3)](_0x387fba),_0x33b004[_0x6fbe0d(0x33c)]({'code':0x0});}),router[_0x4c1276(0x328)](_0x4c1276(0x2bd),(_0x82b9c8,_0x502482,_0x4c0062)=>{const _0xf2c774=_0x4c1276;return _0x82b9c8['app'][_0xf2c774(0x344)]['prepare'](_0xf2c774(0x27b)+_0x82b9c8[_0xf2c774(0x209)]['id'])['run'](),_0x502482[_0xf2c774(0x33c)]({'code':0x0});}),router[_0x4c1276(0x328)](_0x4c1276(0x2cf),(_0x2fe4c7,_0x46466e,_0x5e4305)=>{const _0x431fd2=_0x4c1276;let _0x5492ae=_0x2fe4c7[_0x431fd2(0x2e3)][_0x431fd2(0x210)],_0x24d8f7=_0x2fe4c7['body'][_0x431fd2(0x2fa)],_0x1a2282=dbFileIndexTable[_0x431fd2(0x2be)](_0x2fe4c7['app'][_0x431fd2(0x344)],_0x5492ae,dbFileIndexTable[_0x431fd2(0x1fd)]);if(!_0x1a2282)return _0x46466e['json']({'code':0x0});if(_0x1a2282[_0x431fd2(0x22d)]){let _0x32771b=_0x2fe4c7['app'][_0x431fd2(0x344)][_0x431fd2(0x2b4)]('SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?')['get'](_0x1a2282['collection_id']);if(_0x32771b&&_0x32771b[_0x431fd2(0x21d)]==0x1)return _0x46466e[_0x431fd2(0x33c)]({'code':0x0});}let _0x5dc429=_0x2fe4c7[_0x431fd2(0x2d6)][_0x431fd2(0x344)][_0x431fd2(0x2b4)]('SELECT\x20*\x20from\x20movie_history\x20WHERE\x20index_id=?\x20and\x20user_id=?')[_0x431fd2(0x311)](_0x5492ae+'',_0x2fe4c7[_0x431fd2(0x209)]['id']+'');return _0x5dc429?_0x2fe4c7[_0x431fd2(0x2d6)][_0x431fd2(0x344)][_0x431fd2(0x2b4)](_0x431fd2(0x2fb))[_0x431fd2(0x2c3)](_0x24d8f7,new Date()[_0x431fd2(0x1fb)](),_0x5492ae+'',_0x2fe4c7[_0x431fd2(0x209)]['id']+''):_0x2fe4c7[_0x431fd2(0x2d6)]['dbFileIndex'][_0x431fd2(0x2b4)](_0x431fd2(0x29d))[_0x431fd2(0x2c3)](_0x5492ae+'',_0x2fe4c7['currentUser']['id']+'',_0x24d8f7,new Date()[_0x431fd2(0x1fb)]()),_0x46466e[_0x431fd2(0x33c)]({'code':0x0});}),router[_0x4c1276(0x328)](_0x4c1276(0x2d8),(_0x397055,_0x5958e6,_0x103619)=>{const _0x50b6f7=_0x4c1276;let _0x57462a=_0x397055[_0x50b6f7(0x2e3)][_0x50b6f7(0x210)],_0x5b737c=_0x50b6f7(0x28d);if(_0x57462a){let _0xb572d8=_0x397055[_0x50b6f7(0x2d6)][_0x50b6f7(0x344)][_0x50b6f7(0x2b4)](_0x50b6f7(0x266))['get'](_0x397055[_0x50b6f7(0x209)]['id']+'',_0x57462a+'');return _0x5958e6['json']({'code':0x0,'data':_0xb572d8});}else{let _0x482379=_0x50b6f7(0x250)+_0x5b737c+_0x50b6f7(0x2fc)+_0x397055[_0x50b6f7(0x209)]['id']+_0x50b6f7(0x294),_0xa85aa8=_0x397055['app'][_0x50b6f7(0x344)][_0x50b6f7(0x2b4)](_0x482379)[_0x50b6f7(0x32a)]();return _0x5958e6[_0x50b6f7(0x33c)]({'code':0x0,'data':_0xa85aa8});}}),router['post'](_0x4c1276(0x20e),(_0x5a7bea,_0x3df1aa,_0x436574)=>{const _0x490e05=_0x4c1276;let _0x13de39=_0x5a7bea[_0x490e05(0x2e3)]['id'],_0x1779d6=dbFileIndexTable[_0x490e05(0x2be)](_0x5a7bea[_0x490e05(0x2d6)][_0x490e05(0x344)],_0x13de39,dbFileIndexTable[_0x490e05(0x1fd)]);if(dbUserTable[_0x490e05(0x32f)](_0x5a7bea,_0x3df1aa,_0x490e05(0x2d4),_0x490e05(0x295),_0x1779d6[_0x490e05(0x2f0)])==!![]){let _0xff9eb2={'code':0x0,'data':_0x1779d6};return _0x3df1aa[_0x490e05(0x33c)](_0xff9eb2);}}),router['post']('/switchMatchInfo',(_0x4b1802,_0x15a9bd,_0x186ab6)=>{const _0x58aebe=_0x4c1276;let _0x5ccf0d=_0x4b1802[_0x58aebe(0x2e3)][_0x58aebe(0x2ab)],_0x23e4b3=_0x4b1802['body']['ignoreMatchInfo'];if(dbUserTable[_0x58aebe(0x296)](_0x4b1802,_0x15a9bd)===!![]){let _0x2e70de=dbSourceFolderTable[_0x58aebe(0x2be)](_0x4b1802[_0x58aebe(0x2d6)][_0x58aebe(0x246)],_0x5ccf0d);if(!_0x2e70de)return _0x15a9bd[_0x58aebe(0x20f)](0x194)['end']();return _0x23e4b3==0x1?(_0x4b1802['app'][_0x58aebe(0x344)][_0x58aebe(0x2b4)](_0x58aebe(0x202))[_0x58aebe(0x2c3)](_0x2e70de[_0x58aebe(0x2f0)]+path[_0x58aebe(0x24a)]+'%',_0x2e70de[_0x58aebe(0x2f0)]),dbSourceFolderTable[_0x58aebe(0x2b9)](_0x4b1802[_0x58aebe(0x2d6)][_0x58aebe(0x246)],_0x58aebe(0x30d),_0x23e4b3,_0x5ccf0d),process[_0x58aebe(0x2a1)]({'type':_0x58aebe(0x26c)}),_0x15a9bd[_0x58aebe(0x33c)]({'code':0x0})):(dbSourceFolderTable['updateByWhere'](_0x4b1802[_0x58aebe(0x2d6)][_0x58aebe(0x246)],_0x58aebe(0x30d),_0x23e4b3,_0x5ccf0d),_0x4b1802[_0x58aebe(0x2d6)]['dbFileIndex'][_0x58aebe(0x2b4)](_0x58aebe(0x24e))[_0x58aebe(0x2c3)](_0x2e70de[_0x58aebe(0x2f0)]+path[_0x58aebe(0x24a)]+'%',_0x2e70de['path']),process['send']({'type':_0x58aebe(0x26c)}),_0x15a9bd[_0x58aebe(0x33c)]({'code':0x0}));}}),router[_0x4c1276(0x328)](_0x4c1276(0x206),(_0x10258b,_0x443c49,_0x348e15)=>{const _0x787ad3=_0x4c1276;let _0x308950=_0x10258b['body']['isTvPlay'],_0xab588c=_0x10258b[_0x787ad3(0x2e3)][_0x787ad3(0x210)],_0x2ed123=_0x10258b[_0x787ad3(0x2e3)]['sourceFolderId'];function _0x5639b3(_0x486fa6){const _0x43eee4=_0x787ad3;let _0x25daf4=_0x10258b[_0x43eee4(0x2d6)]['dbFileIndex'][_0x43eee4(0x2b4)](_0x43eee4(0x275)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+'\x20WHERE\x20path=?\x20and\x20is_file=1\x20and\x20type=2\x20order\x20by\x20filename')['get'](_0x486fa6);if(!_0x25daf4)return;_0x10258b[_0x43eee4(0x2d6)][_0x43eee4(0x344)][_0x43eee4(0x2b4)](_0x43eee4(0x2ea)+dbFileIndexTable[_0x43eee4(0x1fd)]+'\x20SET\x20show_in_list\x20=0,is_tvplay=1\x20WHERE\x20path=?')['run'](_0x486fa6),_0x10258b[_0x43eee4(0x2d6)]['dbFileIndex'][_0x43eee4(0x2b4)](_0x43eee4(0x2ea)+dbFileIndexTable[_0x43eee4(0x1fd)]+_0x43eee4(0x22b))[_0x43eee4(0x2c3)](_0x25daf4['id']),movieUtil[_0x43eee4(0x1fa)](_0x10258b[_0x43eee4(0x2d6)][_0x43eee4(0x344)],_0x25daf4);}if(_0xab588c){let _0x4e5a52=dbFileIndexTable[_0x787ad3(0x2be)](_0x10258b[_0x787ad3(0x2d6)][_0x787ad3(0x344)],_0xab588c,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(dbUserTable[_0x787ad3(0x32f)](_0x10258b,_0x443c49,_0x787ad3(0x2d4),_0x787ad3(0x23e),_0x4e5a52[_0x787ad3(0x2f0)])==!![])return _0x308950==0x1?_0x5639b3(_0x4e5a52[_0x787ad3(0x2f0)]):_0x10258b[_0x787ad3(0x2d6)][_0x787ad3(0x344)][_0x787ad3(0x2b4)]('UPDATE\x20'+dbFileIndexTable[_0x787ad3(0x1fd)]+'\x20SET\x20show_in_list\x20=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=\x27'+_0x4e5a52[_0x787ad3(0x2f0)]+'\x27')['run'](),_0x443c49[_0x787ad3(0x33c)]({'code':0x0});}else{if(_0x2ed123){let _0x33ad41=dbSourceFolderTable[_0x787ad3(0x2be)](_0x10258b[_0x787ad3(0x2d6)][_0x787ad3(0x246)],_0x2ed123);if(!_0x33ad41||_0x33ad41['type']!=_0x787ad3(0x2d4))return _0x10258b[_0x787ad3(0x2d6)][_0x787ad3(0x214)](_0x443c49,_0x443c49['__'](_0x787ad3(0x31e)),_0x787ad3(0x29b));if(_0x308950==0x1){dbSourceFolderTable[_0x787ad3(0x2b9)](_0x10258b[_0x787ad3(0x2d6)][_0x787ad3(0x246)],_0x787ad3(0x20d),_0x787ad3(0x282),_0x2ed123),_0x5639b3(_0x33ad41['path']);let _0x463cdd=_0x10258b[_0x787ad3(0x2d6)]['dbFileIndex'][_0x787ad3(0x2b4)]('SELECT\x20path,filename\x20from\x20'+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x787ad3(0x23f))[_0x787ad3(0x32a)](_0x33ad41['path'],''+_0x33ad41[_0x787ad3(0x2f0)]+path['sep']+'%');for(let _0xe3e228 in _0x463cdd){let _0x3f8fee=path[_0x787ad3(0x2ad)](_0x463cdd[_0xe3e228]['path'],_0x463cdd[_0xe3e228]['filename']);_0x5639b3(_0x3f8fee);}}else{dbSourceFolderTable[_0x787ad3(0x2b9)](_0x10258b[_0x787ad3(0x2d6)][_0x787ad3(0x246)],_0x787ad3(0x20d),_0x787ad3(0x2d4),_0x2ed123);let _0x4ffd47=_0x10258b['app']['dbFileIndex']['prepare'](_0x787ad3(0x2ea)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x787ad3(0x288))[_0x787ad3(0x2c3)](_0x33ad41[_0x787ad3(0x2f0)],''+_0x33ad41[_0x787ad3(0x2f0)]+path[_0x787ad3(0x24a)]+'%');}return _0x443c49[_0x787ad3(0x33c)]({'code':0x0});}else return _0x10258b[_0x787ad3(0x2d6)][_0x787ad3(0x214)](_0x443c49,_0x443c49['__'](_0x787ad3(0x31e)),_0x787ad3(0x29b));}});function setLogoAndFanart(_0x43beb9,_0x2be1b2,_0x3f182b,_0x5cbcce){const _0x41c287=_0x4c1276;if(_0x43beb9[_0x41c287(0x2e3)][_0x41c287(0x238)]){let _0xf6f02='SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20',_0x309724=[_0x3f182b];_0x5cbcce?(_0xf6f02+=_0x41c287(0x1ed),_0x309724[_0x41c287(0x240)](_0x41c287(0x229)),_0x309724[_0x41c287(0x240)](_0x5cbcce+_0x41c287(0x2de)),_0x309724['push'](_0x5cbcce+'.clearlogo.%')):(_0xf6f02+='(filename\x20like\x20?)',_0x309724['push'](_0x41c287(0x229)));let _0x584466=_0x43beb9[_0x41c287(0x2d6)][_0x41c287(0x344)]['prepare'](_0xf6f02)[_0x41c287(0x311)](_0x309724);if(_0x584466){let _0x2f8d71=path['join'](_0x584466[_0x41c287(0x2f0)],_0x584466['filename']);_0x2be1b2['logo_path']=_0x2f8d71;}let _0x5c5f54=_0x41c287(0x346),_0x5e5b26=[_0x3f182b];_0x5cbcce?(_0x5c5f54+=_0x41c287(0x306),_0x5e5b26['push'](_0x41c287(0x222)),_0x5e5b26['push'](_0x5cbcce+_0x41c287(0x308)),_0x5e5b26[_0x41c287(0x240)](_0x5cbcce+_0x41c287(0x2ff))):(_0x5c5f54+=_0x41c287(0x20b),_0x5e5b26[_0x41c287(0x240)]('fanart.%'));let _0x1972b8=_0x43beb9[_0x41c287(0x2d6)][_0x41c287(0x344)][_0x41c287(0x2b4)](_0x5c5f54)['get'](_0x5e5b26);if(_0x1972b8){let _0x41d161=path[_0x41c287(0x2ad)](_0x1972b8[_0x41c287(0x2f0)],_0x1972b8[_0x41c287(0x2ae)]);_0x2be1b2['fanart_path']=_0x41d161;}}}function addTvFolderPathAndName(_0x381dd4){const _0x34ebac=_0x4c1276;_0x381dd4[_0x34ebac(0x1f7)]=path[_0x34ebac(0x2b0)](_0x381dd4[_0x34ebac(0x2f0)]),_0x381dd4['tvFolderPath']=_0x381dd4[_0x34ebac(0x2f0)];if(_0x381dd4[_0x34ebac(0x2f5)]==0x1){let _0x133dad=path[_0x34ebac(0x2b0)](_0x381dd4['path']),_0x18431f=path['dirname'](_0x381dd4[_0x34ebac(0x2f0)]),_0x380001=movieSeasonUtil[_0x34ebac(0x2e2)](_0x133dad);_0x380001>-0x1&&(_0x381dd4['tvFolderName']=path[_0x34ebac(0x2b0)](_0x18431f),_0x381dd4[_0x34ebac(0x235)]=_0x18431f);if(!_0x381dd4[_0x34ebac(0x2ca)])_0x381dd4['show_name']=_0x381dd4[_0x34ebac(0x1f7)];}}function addFolderCoverPath(_0x56e142,_0x50747c,_0x50a46d,_0x438bf3=![]){const _0x55ba96=_0x4c1276;let _0x13a7f5;addTvFolderPathAndName(_0x50a46d);let _0x2fbe38=_0x50a46d['id']+_0x55ba96(0x2f6)+_0x438bf3;!_0x50747c[_0x55ba96(0x204)]&&(_0x50747c[_0x55ba96(0x204)]=new Map());try{if(_0x50a46d['is_tvplay']==0x1&&!_0x438bf3)try{let _0x1017d6=path[_0x55ba96(0x2b0)](_0x50a46d[_0x55ba96(0x2f0)]),_0x54542a=path[_0x55ba96(0x2db)](_0x50a46d[_0x55ba96(0x2f0)]),_0x37997e=movieSeasonUtil[_0x55ba96(0x2e2)](_0x1017d6);if(_0x37997e>-0x1){_0x50a46d['isTvSeries']=0x1,_0x50a46d[_0x55ba96(0x27a)]=_0x37997e;if(_0x50747c[_0x55ba96(0x2e3)][_0x55ba96(0x2b2)]){let _0x194863=_0x54542a+_0x55ba96(0x32c)+_0x438bf3;_0x50747c[_0x55ba96(0x204)]['has'](_0x194863)?_0x50a46d[_0x55ba96(0x2f4)]=_0x50747c[_0x55ba96(0x204)][_0x55ba96(0x311)](_0x194863):(_0x50a46d[_0x55ba96(0x2f4)]=_0x50747c[_0x55ba96(0x2d6)][_0x55ba96(0x344)]['prepare'](_0x55ba96(0x333))[_0x55ba96(0x311)](''+_0x54542a+path['sep']+'%')[_0x55ba96(0x2a8)],_0x50747c[_0x55ba96(0x204)]['set'](_0x194863,_0x50a46d[_0x55ba96(0x2f4)]));}}setLogoAndFanart(_0x50747c,_0x50a46d,_0x50a46d[_0x55ba96(0x235)]);if(_0x50747c[_0x55ba96(0x2e3)][_0x55ba96(0x2e4)]==0x1&&_0x37997e>-0x1){let _0x10083b=_0x50a46d[_0x55ba96(0x235)]+_0x55ba96(0x211);if(_0x50747c[_0x55ba96(0x204)]['has'](_0x10083b))return _0x50a46d[_0x55ba96(0x277)]=_0x50747c[_0x55ba96(0x204)][_0x55ba96(0x311)](_0x10083b),_0x50a46d;let _0x39ef94=getTvSeriesPoster(_0x50a46d);if(_0x39ef94)return _0x50747c[_0x55ba96(0x204)][_0x55ba96(0x2bc)](_0x10083b,_0x39ef94),_0x50a46d[_0x55ba96(0x277)]=_0x39ef94,_0x50a46d;}if(!_0x13a7f5&&_0x50747c[_0x55ba96(0x204)]['has'](_0x2fbe38))return _0x50a46d[_0x55ba96(0x277)]=_0x50747c['movieTvCache'][_0x55ba96(0x311)](_0x2fbe38),_0x50a46d;if(!_0x13a7f5&&_0x37997e>-0x1){parseInt(_0x37997e)<0xa&&(_0x37997e='0'+_0x37997e);let _0x296659=_0x55ba96(0x24b)+_0x37997e+_0x55ba96(0x310),_0x1e24f1='%s'+_0x37997e+_0x55ba96(0x310),_0x5649ef='SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=\x27'+_0x54542a+_0x55ba96(0x21e)+_0x296659+'\x27\x20or\x20filename\x20like\x20\x27'+_0x1e24f1+'\x27)';_0x13a7f5=_0x50747c[_0x55ba96(0x2d6)][_0x55ba96(0x344)][_0x55ba96(0x2b4)](_0x5649ef)[_0x55ba96(0x311)]();}!_0x13a7f5&&(_0x13a7f5=_0x50747c[_0x55ba96(0x2d6)][_0x55ba96(0x344)]['prepare'](_0x55ba96(0x324))[_0x55ba96(0x311)](_0x50a46d['path']));}catch(_0x86ed99){console[_0x55ba96(0x297)](_0x86ed99);}else{if(_0x50747c['movieTvCache'][_0x55ba96(0x312)](_0x2fbe38))return _0x50a46d[_0x55ba96(0x277)]=_0x50747c[_0x55ba96(0x204)][_0x55ba96(0x311)](_0x2fbe38),_0x50a46d;let _0x4fda0c=path[_0x55ba96(0x1ff)](_0x50a46d['filename']),_0x4cced2=_0x4fda0c[_0x55ba96(0x1fe)],_0xaefb3e=path['join'](_0x50a46d[_0x55ba96(0x2f0)],_0x4cced2+_0x55ba96(0x220));if(fs['existsSync'](_0xaefb3e))return _0x50a46d[_0x55ba96(0x277)]=_0xaefb3e,_0x50a46d;!_0x13a7f5&&(_0x13a7f5=_0x50747c[_0x55ba96(0x2d6)][_0x55ba96(0x344)]['prepare']('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20filename\x20like\x20?')[_0x55ba96(0x311)](_0x50a46d[_0x55ba96(0x2f0)],'%'+_0x4cced2+_0x55ba96(0x310)));if(!_0x13a7f5){let _0x156438=_0x4cced2;(_0x4cced2[_0x55ba96(0x2af)]('-HD')||_0x4cced2[_0x55ba96(0x2af)](_0x55ba96(0x269))||_0x4cced2[_0x55ba96(0x2af)](_0x55ba96(0x336))||_0x4cced2['endsWith'](_0x55ba96(0x2a5)))&&(_0x4cced2[_0x55ba96(0x2af)](_0x55ba96(0x243))?_0x156438=_0x156438[_0x55ba96(0x267)](0x0,_0x156438[_0x55ba96(0x232)]-0x3):_0x156438=_0x156438['substr'](0x0,_0x156438[_0x55ba96(0x232)]-0x4)),_0x13a7f5=_0x50747c['app']['dbFileIndex'][_0x55ba96(0x2b4)](_0x55ba96(0x31d))['get'](_0x50a46d[_0x55ba96(0x2f0)],_0x4cced2+'%',_0x156438+'%','%fanart%');}!_0x13a7f5&&(_0x13a7f5=_0x50747c[_0x55ba96(0x2d6)][_0x55ba96(0x344)][_0x55ba96(0x2b4)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)')[_0x55ba96(0x311)](_0x50a46d[_0x55ba96(0x2f0)]));let {name:_0xaa4663}=path[_0x55ba96(0x1ff)](_0x50a46d[_0x55ba96(0x2ae)]);setLogoAndFanart(_0x50747c,_0x50a46d,_0x50a46d[_0x55ba96(0x2f0)],_0xaa4663);}if(_0x13a7f5){let _0x1315f3=path[_0x55ba96(0x2ad)](_0x13a7f5[_0x55ba96(0x2f0)],_0x13a7f5[_0x55ba96(0x2ae)]);!_0x1315f3[_0x55ba96(0x2af)]('HEIC')&&!_0x1315f3[_0x55ba96(0x2af)](_0x55ba96(0x27c))&&fs[_0x55ba96(0x325)](_0x1315f3)?(_0x50a46d[_0x55ba96(0x277)]=_0x1315f3,_0x50747c['movieTvCache'][_0x55ba96(0x2bc)](_0x2fbe38,_0x50a46d[_0x55ba96(0x277)])):_0x50747c['movieTvCache'][_0x55ba96(0x2bc)](_0x2fbe38,'');}return _0x50a46d;}catch(_0x78ddbc){return console[_0x55ba96(0x297)](_0x78ddbc),_0x50a46d;}}function getMoviesByParams(_0x249e23,_0x19974a,_0x4d25fc,_0x4d2438,_0x19bca0,_0x13bd27,_0x39de7b,_0x288b69,_0x5be68a,_0x29c729,_0x59cd57,_0x5f4d7c,_0x2d78a7,_0x178e2b,_0x3b04c6,_0x4c04f3,_0x18b437,_0x1e1352){const _0x1f7d16=_0x4c1276;let _0x325fa0=movieFieldStr;_0x1e1352&&(_0x325fa0=_0x1e1352);!_0x3b04c6&&(_0x3b04c6='ALL');let _0x4d4cea='',_0x974f40=[],_0x3bc881=dbUserTable[_0x1f7d16(0x2f3)](_0x19974a,_0x1f7d16(0x2d4),_0x1f7d16(0x295),!![],_0x29c729);if(_0x19974a[_0x1f7d16(0x209)][_0x1f7d16(0x314)]!=0x1&&!_0x3bc881[_0x1f7d16(0x33d)])return[];_0x4d4cea+=_0x1f7d16(0x274);_0x5be68a&&(_0x5be68a=_0x5be68a[_0x1f7d16(0x343)]('\x27','')[_0x1f7d16(0x343)]('’',''),_0x4d4cea+=_0x1f7d16(0x226),_0x974f40[_0x1f7d16(0x240)]('%'+_0x5be68a+'%'),_0x974f40[_0x1f7d16(0x240)]('%'+_0x5be68a+'%'),_0x974f40[_0x1f7d16(0x240)]('%'+_0x5be68a+'%'));let _0x112c69=dbSourceFolderTable['getExcludePathWhereStr'](_0x19974a[_0x1f7d16(0x2d6)]['dbOther'],_0x1f7d16(0x2f0),'excludePathMovie');_0x112c69&&(_0x4d4cea+=_0x1f7d16(0x26a)+_0x112c69);let _0x175df2=dbSourceFolderTable[_0x1f7d16(0x262)](_0x19974a['app'][_0x1f7d16(0x246)],_0x1f7d16(0x2ae),_0x1f7d16(0x309));_0x175df2&&(_0x4d4cea+=_0x1f7d16(0x26a)+_0x175df2);function _0xef9685(_0x508434,_0xeaa0dc){const _0xf1f4d5=_0x1f7d16;let _0x51f067=_0xf1f4d5(0x338);try{let _0x4b0d0c=JSON[_0xf1f4d5(0x1ff)](_0xeaa0dc),_0x27b8cb=![];for(let _0x526760=0x0;_0x526760<_0x4b0d0c[_0xf1f4d5(0x232)];_0x526760++){if(!_0x4b0d0c[_0x526760])continue;_0x27b8cb=!![],_0x51f067+='\x20'+_0x508434+_0xf1f4d5(0x2b7),_0x974f40[_0xf1f4d5(0x240)]('%'+_0x4b0d0c[_0x526760][_0xf1f4d5(0x283)]()+'%'),_0x526760!=_0x4b0d0c[_0xf1f4d5(0x232)]-0x1&&(_0x51f067+=_0xf1f4d5(0x331));}_0x51f067+=')',_0x27b8cb&&(_0x4d4cea+=_0x51f067);}catch(_0x4a2188){console[_0xf1f4d5(0x297)](_0x4a2188);}}_0x59cd57&&_0xef9685(_0x1f7d16(0x2ed),_0x59cd57);_0x5f4d7c&&_0xef9685(_0x1f7d16(0x245),_0x5f4d7c);_0x2d78a7&&_0xef9685(_0x1f7d16(0x2da),_0x2d78a7);_0x19974a[_0x1f7d16(0x2e3)]['movieActors']&&_0x19974a[_0x1f7d16(0x2e3)][_0x1f7d16(0x26b)][_0x1f7d16(0x232)]>0x0&&_0x19974a[_0x1f7d16(0x2e3)][_0x1f7d16(0x26b)][0x0]!=''&&_0xef9685(_0x1f7d16(0x287),_0x19974a['body'][_0x1f7d16(0x26b)]);_0x19974a[_0x1f7d16(0x2e3)][_0x1f7d16(0x2a6)]&&_0x19974a[_0x1f7d16(0x2e3)][_0x1f7d16(0x2a6)][_0x1f7d16(0x232)]>0x0&&_0x19974a[_0x1f7d16(0x2e3)][_0x1f7d16(0x2a6)][0x0]!=''&&_0xef9685(_0x1f7d16(0x2f1),_0x19974a[_0x1f7d16(0x2e3)][_0x1f7d16(0x2a6)]);if(_0x18b437){let _0x322181=_0x19974a[_0x1f7d16(0x2d6)]['dbFileIndex'][_0x1f7d16(0x2b4)](_0x1f7d16(0x264))['get'](_0x18b437);if(_0x322181)try{let _0x4b4dd0=JSON[_0x1f7d16(0x1ff)](_0x322181[_0x1f7d16(0x2a7)]),_0x763908=dbUserTable['getPathWhere'](!![],_0x4b4dd0);_0x4d4cea+=_0x763908[_0x1f7d16(0x33d)],_0x974f40['push'](..._0x763908[_0x1f7d16(0x2b1)]);}catch(_0x492e2f){console[_0x1f7d16(0x297)](_0x492e2f);}}else{!_0x178e2b&&(_0x178e2b=0x0);let _0x23c3d3;if(_0x178e2b!=0x0){_0x23c3d3=_0x19974a[_0x1f7d16(0x2d6)][_0x1f7d16(0x344)][_0x1f7d16(0x2b4)](_0x1f7d16(0x1fc))[_0x1f7d16(0x311)](_0x178e2b);if(!_0x23c3d3)return _0x19974a[_0x1f7d16(0x2d6)][_0x1f7d16(0x214)](_0x249e23,_0x249e23['__'](_0x1f7d16(0x29a)));if(_0x23c3d3['enable_pwd']==0x1){let _0x5131d9=_0x19974a[_0x1f7d16(0x2e3)][_0x1f7d16(0x2e6)];if(!_0x5131d9||_0x23c3d3['pwd']!=sha256(_0x5131d9))return _0x19974a[_0x1f7d16(0x2d6)][_0x1f7d16(0x214)](_0x249e23,_0x249e23['__']('login.pwdErr'));}}if(_0x23c3d3&&_0x23c3d3['type']==_0x1f7d16(0x2c5))try{_0x23c3d3['data']=JSON[_0x1f7d16(0x1ff)](_0x23c3d3['data']),_0x4d4cea+=_0x1f7d16(0x26a)+_0x23c3d3[_0x1f7d16(0x2a3)]['searchValue'];}catch(_0x4e7e0e){console[_0x1f7d16(0x297)](_0x4e7e0e);}else _0x4d4cea+=_0x1f7d16(0x30c)+_0x178e2b;}if(_0x4d25fc){if(_0x4d25fc==0x1)_0x4d4cea+=_0x1f7d16(0x293);else _0x4d25fc==0x2&&(_0x4d4cea+=_0x1f7d16(0x2f7));}_0x4c04f3&&(_0x4c04f3=='#'?(_0x4d4cea+=_0x1f7d16(0x2e1),_0x974f40[_0x1f7d16(0x240)](_0x4c04f3),_0x974f40[_0x1f7d16(0x240)](_0x4c04f3),_0x974f40[_0x1f7d16(0x240)](_0x4c04f3)):(_0x4d4cea+=_0x1f7d16(0x33f),_0x974f40[_0x1f7d16(0x240)](_0x4c04f3),_0x974f40['push'](_0x4c04f3),_0x974f40['push'](_0x4c04f3)));if(_0x288b69&&_0x288b69[_0x1f7d16(0x232)]>0x0){_0x4d4cea+=_0x1f7d16(0x300);for(let _0x2c115d=0x0;_0x2c115d<_0x288b69[_0x1f7d16(0x232)];_0x2c115d++){_0x4d4cea+=_0x288b69[_0x2c115d],_0x2c115d!=_0x288b69['length']-0x1&&(_0x4d4cea+=',');}_0x4d4cea+=')';}_0x4d4cea+=_0x3bc881['whereStr'],_0x974f40[_0x1f7d16(0x240)](..._0x3bc881[_0x1f7d16(0x2b1)]);_0x4d2438&&_0x39de7b?_0x4d4cea+=_0x1f7d16(0x271)+_0x4d2438+'\x20'+_0x39de7b:_0x4d4cea+=_0x1f7d16(0x27f);!_0x19bca0&&(_0x19bca0=0x32);_0x4d4cea+=_0x1f7d16(0x304),_0x974f40[_0x1f7d16(0x240)](_0x19bca0),_0x974f40[_0x1f7d16(0x240)](_0x13bd27);let _0x10cd8d=[];if(_0x3b04c6==_0x1f7d16(0x23a))_0x10cd8d=dbMovieFavorite[_0x1f7d16(0x2ee)](_0x19974a['app'][_0x1f7d16(0x344)],_0x19974a[_0x1f7d16(0x209)]['id'],_0x4d4cea,_0x325fa0,_0x974f40);else _0x3b04c6==_0x1f7d16(0x28f)&&(_0x10cd8d=dbFileIndexTable[_0x1f7d16(0x22c)](_0x19974a['app'][_0x1f7d16(0x344)],_0x4d4cea,_0x325fa0,dbFileIndexTable[_0x1f7d16(0x1fd)],_0x974f40));if(_0x10cd8d['length']<0x1)return _0x10cd8d;let _0x29a5ba=[];for(let _0x49253e in _0x10cd8d){_0x29a5ba[_0x1f7d16(0x240)](_0x10cd8d[_0x49253e]['id']);}let _0xda2d7f=dbMovieFavorite[_0x1f7d16(0x2c9)](_0x19974a['app']['dbFileIndex'],_0x19974a['currentUser']['id'],_0x29a5ba);for(let _0x4177b3=0x0;_0x4177b3<_0x10cd8d[_0x1f7d16(0x232)];_0x4177b3++){_0x10cd8d[_0x4177b3][_0x1f7d16(0x31a)]=0x0;for(let _0x52ab02 in _0xda2d7f){if(_0xda2d7f[_0x52ab02][_0x1f7d16(0x221)]==_0x10cd8d[_0x4177b3]['id']){_0x10cd8d[_0x4177b3]['favorite']=0x1;break;}}let _0x318966=_0x19974a[_0x1f7d16(0x2d6)][_0x1f7d16(0x344)][_0x1f7d16(0x2b4)](_0x1f7d16(0x266))[_0x1f7d16(0x311)](_0x19974a[_0x1f7d16(0x209)]['id']+'',_0x10cd8d[_0x4177b3]['id']+'');_0x318966&&(_0x10cd8d[_0x4177b3][_0x1f7d16(0x2df)]=_0x318966);_0x10cd8d[_0x4177b3]=addFolderCoverPath(_0x249e23,_0x19974a,_0x10cd8d[_0x4177b3]);if(_0x10cd8d[_0x4177b3]['is_tvplay']==0x1&&_0x19974a[_0x1f7d16(0x2e3)][_0x1f7d16(0x242)]){let _0x41394=dbFileIndexTable['getTvCount'](_0x19974a[_0x1f7d16(0x2d6)]['dbFileIndex'],_0x10cd8d[_0x4177b3]);_0x10cd8d[_0x4177b3][_0x1f7d16(0x1ee)]=_0x41394[_0x1f7d16(0x2a8)];}}return _0x10cd8d;}function getShowMatchName(_0xd6dfa4){const _0x15593d=_0x4c1276;let _0x2fd9ee=dbConfigTable[_0x15593d(0x290)](_0xd6dfa4,_0x15593d(0x322));return!_0x2fd9ee||_0x2fd9ee&&_0x2fd9ee[_0x15593d(0x2c8)]!=0x0?0x1:0x0;}router[_0x4c1276(0x328)](_0x4c1276(0x231),(_0x38d8a4,_0x1db264,_0xc72840)=>{const _0x5287d7=_0x4c1276;if(dbUserTable['doUserCanGet'](_0x38d8a4,_0x1db264,_0x5287d7(0x2d4),_0x5287d7(0x295))==!![]){let _0xc324da=_0x38d8a4[_0x5287d7(0x2e3)]['count'],_0x3fb591=_0x38d8a4[_0x5287d7(0x2e3)][_0x5287d7(0x321)],_0x36fcda=_0x38d8a4['body'][_0x5287d7(0x265)],_0x420ad0=_0x38d8a4['body'][_0x5287d7(0x29e)],_0x5a995d=_0x38d8a4[_0x5287d7(0x2e3)][_0x5287d7(0x215)],_0x309e12=_0x38d8a4[_0x5287d7(0x2e3)][_0x5287d7(0x30a)],_0x5e4298=_0x38d8a4['body']['sourceFolderList'],_0x132de6=_0x38d8a4['body'][_0x5287d7(0x217)],_0x4496ab=_0x38d8a4[_0x5287d7(0x2e3)][_0x5287d7(0x230)],_0x5e7bb3=_0x38d8a4[_0x5287d7(0x2e3)][_0x5287d7(0x2dd)],_0x2774fd=_0x38d8a4[_0x5287d7(0x2e3)][_0x5287d7(0x329)],_0x1764c7=_0x38d8a4[_0x5287d7(0x2e3)]['collectionId'],_0x38176d=_0x38d8a4['body'][_0x5287d7(0x25c)],_0x2d311c=_0x38d8a4[_0x5287d7(0x2e3)]['firstLetter'],_0x1161e6=_0x38d8a4[_0x5287d7(0x2e3)]['libraryId'];_0x38d8a4['body'][_0x5287d7(0x242)]=!![],_0x38d8a4[_0x5287d7(0x2e3)][_0x5287d7(0x2b2)]=!![];let _0x482957=getMoviesByParams(_0x1db264,_0x38d8a4,_0x2774fd,_0x36fcda,_0xc324da,_0x3fb591,_0x420ad0,_0x5a995d,_0x309e12,_0x5e4298,_0x132de6,_0x4496ab,_0x5e7bb3,_0x1764c7,_0x38176d,_0x2d311c,_0x1161e6);return _0x1db264[_0x5287d7(0x33c)]({'movieShowMatchName':getShowMatchName(_0x38d8a4[_0x5287d7(0x2d6)][_0x5287d7(0x246)]),'code':0x0,'data':_0x482957});}}),router[_0x4c1276(0x328)](_0x4c1276(0x28c),(_0x3fb6ea,_0x2e0210,_0x53b16d)=>{const _0x19cd0e=_0x4c1276;if(dbUserTable[_0x19cd0e(0x32f)](_0x3fb6ea,_0x2e0210,_0x19cd0e(0x2d4),'power_get')==!![]){let _0xa07362=_0x3fb6ea[_0x19cd0e(0x2e3)][_0x19cd0e(0x2ec)],_0xcf0b49=_0x3fb6ea[_0x19cd0e(0x2e3)][_0x19cd0e(0x203)],_0x27b296=_0x3fb6ea[_0x19cd0e(0x2e3)]['sourceType'];!_0xcf0b49&&(_0xcf0b49=0x9);let _0x5c8ff8='\x20id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list',_0x1f52af='';_0xa07362?_0x1f52af=dbUserTable[_0x19cd0e(0x2f3)](_0x3fb6ea,'movie',_0x19cd0e(0x295),!![],_0xa07362):_0x1f52af=dbUserTable[_0x19cd0e(0x2f3)](_0x3fb6ea,_0x19cd0e(0x2d4),_0x19cd0e(0x295),!![]);let _0x1e93ce=_0x3fb6ea[_0x19cd0e(0x2e3)][_0x19cd0e(0x2b5)];_0x1e93ce!=_0x19cd0e(0x2da)&&_0x1e93ce!='movie_regions'&&(_0x1e93ce=_0x19cd0e(0x2da));!_0x1e93ce&&(_0x1e93ce='movie_genres');let _0x376052=_0x3fb6ea[_0x19cd0e(0x2d6)][_0x19cd0e(0x344)][_0x19cd0e(0x2b4)](_0x19cd0e(0x219))[_0x19cd0e(0x32a)](_0x1e93ce),_0x2d23ea=[];for(let _0x42acdd of _0x376052){let _0x19564d=_0x42acdd[_0x19cd0e(0x28a)],_0x595867=_0x19cd0e(0x274),_0xa7ba5b=[];_0x595867+=_0x1f52af[_0x19cd0e(0x33d)],_0xa7ba5b[_0x19cd0e(0x240)](..._0x1f52af[_0x19cd0e(0x2b1)]),_0x595867+='\x20AND\x20collection_id=0';if(_0x27b296){if(_0x27b296==0x1)_0x595867+=_0x19cd0e(0x293);else _0x27b296==0x2&&(_0x595867+=_0x19cd0e(0x2f7));}_0x595867+='\x20AND\x20'+_0x1e93ce+_0x19cd0e(0x29f),_0xa7ba5b[_0x19cd0e(0x240)]('%'+_0x19564d+'%'),_0x595867+=_0x19cd0e(0x256),_0xa7ba5b[_0x19cd0e(0x240)](parseInt(_0xcf0b49));let _0x81fb0f=dbFileIndexTable[_0x19cd0e(0x22c)](_0x3fb6ea[_0x19cd0e(0x2d6)][_0x19cd0e(0x344)],_0x595867,_0x5c8ff8,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE'],_0xa7ba5b),_0x235846=[];for(let _0x4f5e65 in _0x81fb0f){_0x235846[_0x19cd0e(0x240)](_0x81fb0f[_0x4f5e65]['id']);}let _0x2c791f=dbMovieFavorite[_0x19cd0e(0x2c9)](_0x3fb6ea['app'][_0x19cd0e(0x344)],_0x3fb6ea[_0x19cd0e(0x209)]['id'],_0x235846);for(let _0x1256f6=0x0;_0x1256f6<_0x81fb0f[_0x19cd0e(0x232)];_0x1256f6++){_0x81fb0f[_0x1256f6]['favorite']=0x0;for(let _0x3c6048 in _0x2c791f){if(_0x2c791f[_0x3c6048][_0x19cd0e(0x221)]==_0x81fb0f[_0x1256f6]['id']){_0x81fb0f[_0x1256f6][_0x19cd0e(0x31a)]=0x1;break;}}_0x81fb0f[_0x1256f6]=addFolderCoverPath(_0x2e0210,_0x3fb6ea,_0x81fb0f[_0x1256f6]);}_0x81fb0f[_0x19cd0e(0x232)]>0x0&&_0x2d23ea[_0x19cd0e(0x240)]({'genresType':_0x1e93ce,'genresValue':_0x19564d,'movieList':_0x81fb0f,'indexCount':_0x42acdd[_0x19cd0e(0x2d3)]});}_0x2e0210['json']({'code':0x0,'data':_0x2d23ea,'movieShowMatchName':getShowMatchName(_0x3fb6ea[_0x19cd0e(0x2d6)]['dbOther'])});}}),router[_0x4c1276(0x328)](_0x4c1276(0x2ba),(_0x572b59,_0x377e64,_0x450693)=>{const _0x15b725=_0x4c1276;if(dbUserTable[_0x15b725(0x32f)](_0x572b59,_0x377e64,_0x15b725(0x2d4),_0x15b725(0x295))==!![]){let _0x176b00=getMoviesByParams(_0x377e64,_0x572b59,0x1,_0x15b725(0x26d),0xf,0x0,_0x15b725(0x305));_0x572b59['body'][_0x15b725(0x242)]=!![],_0x572b59['body'][_0x15b725(0x2b2)]=!![],_0x572b59['body']['useTvSeriesInfo']=0x1;let _0x2f6ecf=getMoviesByParams(_0x377e64,_0x572b59,0x2,_0x15b725(0x26d),0x32,0x0,_0x15b725(0x305));_0x572b59['body']['needTvCount']=![],_0x572b59[_0x15b725(0x2e3)]['needSeasonCount']=![],_0x572b59[_0x15b725(0x2e3)][_0x15b725(0x2e4)]=0x0;let _0x35df63=dbConfigTable[_0x15b725(0x290)](_0x572b59['app'][_0x15b725(0x246)],'movieHomeShowMyMedia');_0x35df63=!_0x35df63||_0x35df63&&_0x35df63[_0x15b725(0x2c8)]==0x1;let _0x1751d6=dbConfigTable[_0x15b725(0x290)](_0x572b59[_0x15b725(0x2d6)][_0x15b725(0x246)],_0x15b725(0x24c));_0x1751d6=!_0x1751d6||_0x1751d6&&_0x1751d6['value']==0x1;let _0x47c7fb=dbConfigTable[_0x15b725(0x290)](_0x572b59['app']['dbOther'],'movieHomeShowHistory');_0x47c7fb=!_0x47c7fb||_0x47c7fb&&_0x47c7fb[_0x15b725(0x2c8)]==0x1;let _0x419fec=[];if(_0x47c7fb){let _0x3d546a=_0x15b725(0x2ce),_0x3a5b29=_0x15b725(0x250)+_0x3d546a+_0x15b725(0x2fc)+_0x572b59['currentUser']['id']+_0x15b725(0x261);_0x419fec=_0x572b59['app'][_0x15b725(0x344)][_0x15b725(0x2b4)](_0x3a5b29)[_0x15b725(0x32a)]();let _0x4e42bc=[];for(let _0x26c8c1 in _0x419fec){_0x4e42bc[_0x15b725(0x240)](_0x419fec[_0x26c8c1]['id']);}let _0x588522=dbMovieFavorite[_0x15b725(0x2c9)](_0x572b59['app'][_0x15b725(0x344)],_0x572b59[_0x15b725(0x209)]['id'],_0x4e42bc);for(let _0x152b1f=0x0;_0x152b1f<_0x419fec[_0x15b725(0x232)];_0x152b1f++){_0x419fec[_0x152b1f]['favorite']=0x0;for(let _0x4c47e9 in _0x588522){if(_0x588522[_0x4c47e9][_0x15b725(0x221)]==_0x419fec[_0x152b1f]['id']){_0x419fec[_0x152b1f][_0x15b725(0x31a)]=0x1;break;}}}}let _0x56a85c=[];_0x1751d6&&(_0x56a85c=getMovieLibrary(_0x572b59,_0x377e64,0x6));let _0x582955={'code':0x0,'movies':_0x176b00,'tv':_0x2f6ecf,'history':_0x419fec,'libraryList':_0x56a85c,'sourceList':[]};_0x582955[_0x15b725(0x322)]=getShowMatchName(_0x572b59[_0x15b725(0x2d6)][_0x15b725(0x246)]);if(_0x35df63){let _0x11e56e=_0x572b59[_0x15b725(0x2d6)][_0x15b725(0x246)][_0x15b725(0x2b4)](_0x15b725(0x2b6))[_0x15b725(0x32a)](_0x15b725(0x2d4));for(let _0x298501 of _0x11e56e){let _0x16867a=getMoviesByParams(_0x377e64,_0x572b59,null,_0x15b725(0x260),0x4,0x0,'desc',null,null,JSON[_0x15b725(0x200)]([path['join'](_0x298501[_0x15b725(0x2f0)])]));if(_0x16867a[_0x15b725(0x232)]<0x1)continue;_0x582955['sourceList']['push']({'mediaType':_0x298501[_0x15b725(0x20d)],'path':_0x298501[_0x15b725(0x2f0)],'name':path[_0x15b725(0x2b0)](_0x298501[_0x15b725(0x2f0)]),'sourceMovies':_0x16867a});}}return _0x377e64[_0x15b725(0x33c)](_0x582955);}}),router[_0x4c1276(0x328)](_0x4c1276(0x286),(_0xeeaa9f,_0x39a722,_0x403304)=>{const _0xeed5a=_0x4c1276;if(dbUserTable[_0xeed5a(0x32f)](_0xeeaa9f,_0x39a722,_0xeed5a(0x2d4),_0xeed5a(0x295))==!![]){let _0x43f296=getMoviesByParams(_0x39a722,_0xeeaa9f,0x1,_0xeed5a(0x260),0xa,0x0,'desc'),_0x1df53b=getMoviesByParams(_0x39a722,_0xeeaa9f,0x2,'check_time',0xa,0x0,'desc'),_0x583da1=_0xeed5a(0x2d2),_0x2d5bef='SELECT\x20'+_0x583da1+_0xeed5a(0x2fc)+_0xeeaa9f[_0xeed5a(0x209)]['id']+'\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010',_0x3eca9c=_0xeeaa9f[_0xeed5a(0x2d6)][_0xeed5a(0x344)][_0xeed5a(0x2b4)](_0x2d5bef)[_0xeed5a(0x32a)](),_0x5acc13=getCollectionList(_0xeeaa9f,_0x39a722,_0xeed5a(0x279)),_0x3c630a=getCollectionList(_0xeeaa9f,_0x39a722,'smart'),_0x34ad00=getMoviesByParams(_0x39a722,_0xeeaa9f,null,_0xeed5a(0x260),0xa,0x0,_0xeed5a(0x305),null,null,null,null,null,null,null,_0xeed5a(0x23a)),_0xe13e6e=getMovieLibrary(_0xeeaa9f,_0x39a722),_0x15fccd={'code':0x0,'movies':_0x43f296,'tv':_0x1df53b,'history':_0x3eca9c,'favorites':_0x34ad00,'collectionList':_0x5acc13,'aiCollectionList':_0x3c630a,'libraryList':_0xe13e6e};return _0x39a722[_0xeed5a(0x33c)](_0x15fccd);}}),router[_0x4c1276(0x328)](_0x4c1276(0x30b),(_0x580f84,_0x64292,_0x27be0d)=>{const _0x740f5a=_0x4c1276;if(dbUserTable['doUserCanGet'](_0x580f84,_0x64292,_0x740f5a(0x2d4),_0x740f5a(0x295))==!![]){let _0x16b609=getMoviesByParams(_0x64292,_0x580f84,0x1,_0x740f5a(0x260),0x1,0x0,_0x740f5a(0x305)),_0xcfe88a=getMoviesByParams(_0x64292,_0x580f84,0x2,_0x740f5a(0x260),0x1,0x0,_0x740f5a(0x305)),_0x5de956=_0x740f5a(0x2d2),_0x5eff71=_0x740f5a(0x250)+_0x5de956+_0x740f5a(0x2fc)+_0x580f84[_0x740f5a(0x209)]['id']+'\x20order\x20by\x20m.create_time\x20desc\x20limit\x201',_0x8ad90d=_0x580f84[_0x740f5a(0x2d6)][_0x740f5a(0x344)]['prepare'](_0x5eff71)[_0x740f5a(0x32a)](),_0x1906e5=getMoviesByParams(_0x64292,_0x580f84,null,'check_time',0x1,0x0,'desc',null,null,null,null,null,null,null,'FAVORITE'),_0x4b8c4f=dbFileIndexTable[_0x740f5a(0x301)](_0x580f84[_0x740f5a(0x2d6)]['dbFileIndex'],_0x740f5a(0x225),dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x1a5676=dbFileIndexTable[_0x740f5a(0x301)](_0x580f84['app'][_0x740f5a(0x344)],_0x740f5a(0x326),dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);_0x580f84['body']['timestamp']=0x5af3107a3fff,_0x580f84[_0x740f5a(0x2e3)][_0x740f5a(0x22a)]=0x1,_0x580f84[_0x740f5a(0x2e3)][_0x740f5a(0x265)]=_0x740f5a(0x260),_0x580f84[_0x740f5a(0x2e3)][_0x740f5a(0x29e)]=_0x740f5a(0x305),_0x580f84[_0x740f5a(0x2e3)]['trash']=0x0,_0x580f84[_0x740f5a(0x2e3)][_0x740f5a(0x2a8)]=0x1;let _0x26f459=photoApiUtils['getPhotoByParams'](_0x580f84,_0x64292),_0x431154=getMovieLibrary(_0x580f84,_0x64292),_0x5dc81c={'movieCount':_0x4b8c4f[_0x740f5a(0x2a8)],'tvCount':_0x1a5676[_0x740f5a(0x2a8)],'code':0x0,'movies':_0x16b609,'tv':_0xcfe88a,'history':_0x8ad90d,'favorites':_0x1906e5,'photos':_0x26f459,'libraryList':_0x431154};return _0x64292[_0x740f5a(0x33c)](_0x5dc81c);}});let subtitleExtList=['.srt',_0x4c1276(0x223),'.vtt'];router[_0x4c1276(0x328)]('/getSameNameSubtitles',(_0x5981b9,_0x511e7c,_0x5e5e3d)=>{const _0x910f71=_0x4c1276;let _0x2496f3=[],_0x4f347c=null;if(_0x5981b9['body'][_0x910f71(0x2c1)])_0x4f347c=_0x5981b9['body']['videoPath'],_0x4f347c=fileUtil[_0x910f71(0x302)](_0x4f347c);else{if(_0x5981b9['body']['id']){let _0x4dc6ff=_0x5981b9[_0x910f71(0x2e3)]['id'],_0x446fef=dbFileIndexTable[_0x910f71(0x2be)](_0x5981b9[_0x910f71(0x2d6)][_0x910f71(0x344)],_0x4dc6ff,dbFileIndexTable[_0x910f71(0x1fd)]);_0x446fef&&(_0x4f347c=path[_0x910f71(0x2ad)](_0x446fef[_0x910f71(0x2f0)],_0x446fef[_0x910f71(0x2ae)]),_0x5981b9['app'][_0x910f71(0x344)][_0x910f71(0x2b4)](_0x910f71(0x2b8))['run'](Date[_0x910f71(0x2e7)](),_0x446fef['id']));}}function _0x2d15b5(){const _0x380d7f=_0x910f71;let _0x4dde3e=dbConfigTable[_0x380d7f(0x290)](_0x5981b9[_0x380d7f(0x2d6)][_0x380d7f(0x246)],'subtitleSize'),_0x1c051f=dbConfigTable[_0x380d7f(0x290)](_0x5981b9[_0x380d7f(0x2d6)][_0x380d7f(0x246)],_0x380d7f(0x26e));return _0x511e7c[_0x380d7f(0x33c)]({'code':0x0,'data':_0x2496f3,'defaultTranscodeResolution':_0x1c051f?_0x1c051f[_0x380d7f(0x2c8)]:_0x380d7f(0x227),'userFontSize':_0x4dde3e?_0x4dde3e[_0x380d7f(0x2c8)]:1.5});}_0x4f347c?fs[_0x910f71(0x205)](_0x4f347c,(_0xaf6ff,_0x48329c)=>{const _0x2eb18e=_0x910f71;if(_0xaf6ff)return _0x2d15b5();let _0x79827=path[_0x2eb18e(0x2db)](_0x4f347c);fs['readdir'](_0x79827,(_0x1fc09e,_0x3cb05b)=>{const _0x246283=_0x2eb18e;if(_0x1fc09e)return _0x2d15b5();let _0x4d304a=path[_0x246283(0x2b0)](_0x4f347c)[_0x246283(0x343)](path[_0x246283(0x31f)](_0x4f347c),''),_0x3e1f25=_0x4d304a['replaceAll']('\x20','_');for(let _0x4b4235 in _0x3cb05b){let _0x220e38=_0x3cb05b[_0x4b4235],_0x1dddcb=path[_0x246283(0x31f)](_0x220e38);(_0x220e38[_0x246283(0x284)](_0x4d304a)||_0x220e38[_0x246283(0x284)](_0x3e1f25))&&subtitleExtList[_0x246283(0x323)](_0x1dddcb)&&_0x2496f3['push']({'fileName':path[_0x246283(0x2b0)](_0x220e38),'filePath':path[_0x246283(0x2ad)](_0x79827,_0x220e38)});}return _0x2d15b5();});}):_0x2d15b5();}),router['post'](_0x4c1276(0x2aa),(_0x28b291,_0x5d64e4,_0xd90417)=>{const _0x1e5b6c=_0x4c1276;let _0x815a0b=_0x28b291[_0x1e5b6c(0x2d6)][_0x1e5b6c(0x344)][_0x1e5b6c(0x2b4)](_0x1e5b6c(0x2fe))['all'](),_0x59d3e5=_0x28b291['app'][_0x1e5b6c(0x344)][_0x1e5b6c(0x2b4)](_0x1e5b6c(0x241))[_0x1e5b6c(0x32a)](),_0x4ba53d=_0x28b291[_0x1e5b6c(0x2d6)][_0x1e5b6c(0x344)][_0x1e5b6c(0x2b4)](_0x1e5b6c(0x239))[_0x1e5b6c(0x32a)]();_0x5d64e4[_0x1e5b6c(0x33c)]({'code':0x0,'data':_0x815a0b[_0x1e5b6c(0x2e8)](_0x59d3e5,_0x4ba53d)});}),router[_0x4c1276(0x328)](_0x4c1276(0x2c0),(_0x56a9f4,_0x2a45ab,_0x916c3)=>{const _0x38c906=_0x4c1276;let _0x2eebe4=_0x56a9f4['body'][_0x38c906(0x210)],_0x3aad5b=dbFileIndexTable[_0x38c906(0x2be)](_0x56a9f4[_0x38c906(0x2d6)]['dbFileIndex'],_0x2eebe4,dbFileIndexTable[_0x38c906(0x1fd)]);if(!_0x3aad5b)return _0x2a45ab[_0x38c906(0x33c)]({'code':0x0});if(dbUserTable['doUserCanGet'](_0x56a9f4,_0x2a45ab,_0x38c906(0x2d4),'power_delete',_0x3aad5b[_0x38c906(0x2f0)])==!![])return dbFileIndexTable[_0x38c906(0x335)](_0x56a9f4[_0x38c906(0x2d6)][_0x38c906(0x344)],_0x2eebe4,dbFileIndexTable[_0x38c906(0x1fd)]),_0x2a45ab['json']({'code':0x0});}),router[_0x4c1276(0x328)](_0x4c1276(0x2a0),(_0x520514,_0xd128f6,_0x148718)=>{const _0x5911a4=_0x4c1276;let _0x5713bd=_0x520514[_0x5911a4(0x209)]['id'],_0x85b267=parseInt(_0x520514[_0x5911a4(0x2e3)]['movieIndexId']),_0x18788a=dbMovieFavorite['getFavorite'](_0x520514[_0x5911a4(0x2d6)]['dbFileIndex'],_0x5713bd,_0x85b267),_0x10741c=0x0;if(_0x18788a)dbMovieFavorite[_0x5911a4(0x2f8)](_0x520514['app']['dbFileIndex'],_0x5713bd,_0x85b267);else{_0x10741c=0x1;let _0xd21f1d=new Date()[_0x5911a4(0x1fb)]();_0x520514[_0x5911a4(0x2d6)][_0x5911a4(0x344)][_0x5911a4(0x2b4)](_0x5911a4(0x2b8))[_0x5911a4(0x2c3)](_0xd21f1d,_0x85b267),dbMovieFavorite['addFavorite'](_0x520514[_0x5911a4(0x2d6)][_0x5911a4(0x344)],_0x5713bd,_0x85b267);}return _0xd128f6[_0x5911a4(0x33c)]({'code':0x0,'favorite':_0x10741c});}),router[_0x4c1276(0x328)](_0x4c1276(0x22e),(_0x2a8b8e,_0x2acaf7,_0x343287)=>{const _0x2d00c2=_0x4c1276;try{let _0x119215=parseInt(_0x2a8b8e[_0x2d00c2(0x2e3)][_0x2d00c2(0x210)]),_0xacde17=dbFileIndexTable[_0x2d00c2(0x2be)](_0x2a8b8e['app'][_0x2d00c2(0x344)],_0x119215,dbFileIndexTable[_0x2d00c2(0x1fd)]);if(!_0xacde17)return _0x2acaf7[_0x2d00c2(0x33c)]({'code':0x0});let _0x3ef6f0=parseInt(_0x2a8b8e[_0x2d00c2(0x2e3)][_0x2d00c2(0x23d)]),_0x8c8bbe=parseInt(_0x2a8b8e['body'][_0x2d00c2(0x29c)]);!_0x8c8bbe&&(_0x8c8bbe=0x0);!_0x3ef6f0&&(_0x3ef6f0=0x0);let _0x4fc7aa=parseInt(_0x2a8b8e[_0x2d00c2(0x2e3)][_0x2d00c2(0x272)]);if(_0x3ef6f0<0x0||_0x8c8bbe<0x0||_0x3ef6f0>_0xacde17[_0x2d00c2(0x20a)]||_0x8c8bbe>_0xacde17[_0x2d00c2(0x20a)]||_0x4fc7aa!=0x0&&_0x4fc7aa!=0x1)return _0x2a8b8e[_0x2d00c2(0x2d6)][_0x2d00c2(0x214)](_0x2acaf7,_0x2d00c2(0x257));let _0x549c47=[_0xacde17];_0xacde17[_0x2d00c2(0x2f5)]==0x1&&(_0x549c47=_0x2a8b8e[_0x2d00c2(0x2d6)][_0x2d00c2(0x344)]['prepare']('SELECT\x20id\x20FROM\x20'+dbFileIndexTable[_0x2d00c2(0x1fd)]+_0x2d00c2(0x251))[_0x2d00c2(0x32a)](_0xacde17[_0x2d00c2(0x2f0)]));let _0x342af4='(';for(let _0x3fa938 in _0x549c47){_0x342af4+=_0x549c47[_0x3fa938]['id'],_0x3fa938!=_0x549c47[_0x2d00c2(0x232)]-0x1&&(_0x342af4+=',');}return _0x342af4+=')',_0x2a8b8e['app'][_0x2d00c2(0x344)][_0x2d00c2(0x2b4)]('UPDATE\x20file_index_movie\x20set\x20open_duration=?,end_duration=?,skip_open_end=?\x20WHERE\x20id\x20in\x20'+_0x342af4)[_0x2d00c2(0x2c3)](_0x3ef6f0,_0x8c8bbe,_0x4fc7aa),_0x2acaf7[_0x2d00c2(0x33c)]({'code':0x0});}catch(_0x5de105){return console[_0x2d00c2(0x297)](_0x5de105),_0x2a8b8e[_0x2d00c2(0x2d6)][_0x2d00c2(0x214)](_0x2acaf7,_0x2acaf7['__'](_0x2d00c2(0x31e)));}});function _0x2c5e(_0x51d48a,_0x31e347){const _0x39c47f=_0x39c4();return _0x2c5e=function(_0x2c5ec2,_0x19ef25){_0x2c5ec2=_0x2c5ec2-0x1ed;let _0x5e5e94=_0x39c47f[_0x2c5ec2];return _0x5e5e94;},_0x2c5e(_0x51d48a,_0x31e347);}function getMovieLibrary(_0x20d279,_0x29896a,_0x5cfc59){const _0x467cfc=_0x4c1276;let _0xa75b81=_0x20d279[_0x467cfc(0x2e3)][_0x467cfc(0x321)]||0x0,_0x297eaa=_0x5cfc59||_0x20d279[_0x467cfc(0x2e3)][_0x467cfc(0x2a8)]||0x32,_0x1bcc18=_0x20d279[_0x467cfc(0x2e3)][_0x467cfc(0x249)]||'',_0x34242b=_0x20d279[_0x467cfc(0x2e3)][_0x467cfc(0x216)]||'create_time',_0x2ea973=_0x20d279[_0x467cfc(0x2e3)][_0x467cfc(0x315)]||_0x467cfc(0x305);if(![_0x467cfc(0x26d),_0x467cfc(0x21f)][_0x467cfc(0x323)](_0x34242b))return console[_0x467cfc(0x297)](_0x467cfc(0x2cc),_0x34242b),[];let _0x114a71=[],_0x2d57ff=[],_0x1aae37=_0x467cfc(0x1f8);_0x20d279['currentUser'][_0x467cfc(0x314)]==0x1?_0x1bcc18&&(_0x1aae37+=_0x467cfc(0x2eb),_0x2d57ff['push']('%'+_0x1bcc18+'%')):(_0x1aae37=_0x467cfc(0x24d),_0x1bcc18&&(_0x1aae37+=_0x467cfc(0x2d7),_0x2d57ff[_0x467cfc(0x240)]('%'+_0x1bcc18+'%')));_0x1aae37+='\x20ORDER\x20BY\x20'+_0x34242b+'\x20'+_0x2ea973+_0x467cfc(0x304),_0x2d57ff[_0x467cfc(0x240)](_0x297eaa),_0x2d57ff[_0x467cfc(0x240)](_0xa75b81),_0x114a71=_0x20d279[_0x467cfc(0x2d6)][_0x467cfc(0x344)][_0x467cfc(0x2b4)](_0x1aae37)['all'](_0x2d57ff);if(_0x114a71[_0x467cfc(0x232)]<0x1)return[];for(let _0x47b147 in _0x114a71){let _0x216417=_0x114a71[_0x47b147];try{let _0x5c8019=JSON[_0x467cfc(0x1ff)](_0x216417['share_uid']),_0x376c06=[];for(let _0x4f5c29 of _0x5c8019){let _0x58aae0=dbUserTable[_0x467cfc(0x270)](_0x20d279[_0x467cfc(0x2d6)][_0x467cfc(0x246)],_0x4f5c29,_0x467cfc(0x31b));_0x376c06[_0x467cfc(0x240)](_0x58aae0);}_0x114a71[_0x47b147][_0x467cfc(0x253)]=_0x376c06;}catch(_0x43df72){console[_0x467cfc(0x297)](_0x43df72);}let _0x3a228b=getMoviesByParams(_0x29896a,_0x20d279,null,_0x467cfc(0x260),0x4,0x0,_0x467cfc(0x305),null,null,null,null,null,null,null,null,null,_0x114a71[_0x47b147]['id']);_0x114a71[_0x47b147][_0x467cfc(0x340)]=_0x3a228b;}return _0x114a71;}router[_0x4c1276(0x328)](_0x4c1276(0x317),(_0x1e9565,_0x479b3c,_0x21b361)=>{const _0x3f1650=_0x4c1276;let _0x5f2035=_0x1e9565['body'][_0x3f1650(0x21f)],_0xbe24e0=_0x1e9565['body']['libraryId'],_0x2ccbca=_0x1e9565[_0x3f1650(0x2e3)]['pathList'],_0x20aeb7=_0x1e9565[_0x3f1650(0x2e3)]['shareUidList'],_0x36c932=_0x1e9565[_0x3f1650(0x2e3)][_0x3f1650(0x285)],_0x55845b=_0x1e9565[_0x3f1650(0x2e3)][_0x3f1650(0x298)];if(_0x55845b==_0x3f1650(0x292)){let _0x4abbd5=getMovieLibrary(_0x1e9565,_0x479b3c);return _0x479b3c[_0x3f1650(0x33c)]({'code':0x0,'data':_0x4abbd5});}else{if(_0x1e9565['currentUser']['is_admin']!=0x1)return _0x1e9565[_0x3f1650(0x2d6)][_0x3f1650(0x214)](_0x479b3c,_0x479b3c['__'](_0x3f1650(0x32d)));if(_0x55845b==_0x3f1650(0x254)||_0x55845b=='EDIT'){if(!_0x2ccbca||!_0x2ccbca instanceof Array||_0x2ccbca[_0x3f1650(0x232)]<0x1)return _0x1e9565[_0x3f1650(0x2d6)][_0x3f1650(0x214)](_0x479b3c,_0x479b3c['__'](_0x3f1650(0x31e)));if(_0x36c932){if(_0x20aeb7!=null&&!_0x20aeb7 instanceof Array)return _0x1e9565[_0x3f1650(0x2d6)][_0x3f1650(0x214)](_0x479b3c,_0x479b3c['__'](_0x3f1650(0x31e)));}if(sqliteUtil[_0x3f1650(0x2a9)](JSON[_0x3f1650(0x200)](_0x2ccbca))==!![])return _0x1e9565[_0x3f1650(0x2d6)][_0x3f1650(0x214)](_0x479b3c,_0x3f1650(0x252));}if(_0x55845b=='EDIT'&&_0xbe24e0)_0x1e9565[_0x3f1650(0x2d6)][_0x3f1650(0x344)]['prepare']('UPDATE\x20movie_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?')[_0x3f1650(0x2c3)](_0x5f2035,JSON['stringify'](_0x2ccbca),_0x36c932,JSON[_0x3f1650(0x200)](_0x20aeb7),_0xbe24e0);else{if(_0x55845b==_0x3f1650(0x212)&&_0xbe24e0)_0x1e9565[_0x3f1650(0x2d6)][_0x3f1650(0x344)][_0x3f1650(0x2b4)](_0x3f1650(0x2cd))['run'](_0xbe24e0);else{if(_0x55845b=='ADD')_0x1e9565[_0x3f1650(0x2d6)][_0x3f1650(0x344)][_0x3f1650(0x2b4)](_0x3f1650(0x2e5))['run'](_0x5f2035,JSON[_0x3f1650(0x200)](_0x2ccbca),_0x36c932,JSON['stringify'](_0x20aeb7),_0x1e9565[_0x3f1650(0x209)]['id']);else return _0x1e9565[_0x3f1650(0x2d6)][_0x3f1650(0x214)](_0x479b3c,_0x479b3c['__']('noPermission'));}}return _0x479b3c[_0x3f1650(0x33c)]({'code':0x0});}}),module[_0x4c1276(0x2bb)]=router;