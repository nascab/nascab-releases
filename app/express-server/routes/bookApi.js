const _0x17ac9b=_0x3909;(function(_0x44d400,_0x165503){const _0x51da85=_0x3909,_0x164fa2=_0x44d400();while(!![]){try{const _0x34cb2b=-parseInt(_0x51da85(0x136))/0x1+parseInt(_0x51da85(0x177))/0x2*(-parseInt(_0x51da85(0x17f))/0x3)+parseInt(_0x51da85(0x137))/0x4*(parseInt(_0x51da85(0x119))/0x5)+parseInt(_0x51da85(0x116))/0x6+parseInt(_0x51da85(0x1b8))/0x7*(parseInt(_0x51da85(0x1a7))/0x8)+parseInt(_0x51da85(0x159))/0x9*(-parseInt(_0x51da85(0x164))/0xa)+parseInt(_0x51da85(0x170))/0xb;if(_0x34cb2b===_0x165503)break;else _0x164fa2['push'](_0x164fa2['shift']());}catch(_0x41af66){_0x164fa2['push'](_0x164fa2['shift']());}}}(_0x3011,0x4a5d7));function _0x3909(_0xbc7b25,_0x3a0282){const _0x30112b=_0x3011();return _0x3909=function(_0x39090f,_0x467a54){_0x39090f=_0x39090f-0x10a;let _0x5275db=_0x30112b[_0x39090f];return _0x5275db;},_0x3909(_0xbc7b25,_0x3a0282);}let express=require(_0x17ac9b(0x1af)),router=express[_0x17ac9b(0x184)](),path=require(_0x17ac9b(0x11f)),fs=require('fs'),dbBookIndexTable=require(_0x17ac9b(0x12d)),dbFileIndexTable=require(_0x17ac9b(0x1b2)),dbBookListTable=require('../../db/dbBookListTable'),dbBookFavorite=require(_0x17ac9b(0x152));const dbUserTable=require(_0x17ac9b(0x114)),dbSourceFolderTable=require('../../db/dbSourceFolderTable');let os=require('os'),config=require('../../myConfig/config');function _0x3011(){const _0x254c54=['now','json','progress','size','parse','includes','tag','dbFileIndex','prepare','sortFileNamesByNumber','coverData','filename','getBookList','nfo写入成功','desc','uid','edit','body','config\x20json\x20format\x20error','/getBookCover','INDEX_TABLE_NAME_BOOK','\x20order\x20by\x20f.artist_fl\x20','isbn','post','title','add','../../db/dbBookFavorite','bookIsFavorite','SELECT\x20','getPathByType','book\x20not\x20exist','getBookListByPath','platform','9sGJHmU','count','operation','getBookIndex','\x20id,is_file,id,path,filename,type,size,title,artist,ext,cover_path,language,publisher,total_page,type,check_time,create_time','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','REPLACE\x20INTO\x20book_reader_config\x20(uid,config_json,remark)\x20VALUES(?,?,?)','SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid\x20=\x20?','folderNotExist','year','all','2695450FVmMkL','need\x20\x27name\x27','nfo写入失败',',f.title\x20','getBookIndexByFileName','getBookListBookCount','removeBookFromList','artist','need\x20bookIndexId','offset','power_change','cover\x20format\x20error','6273817JHNwoH','SELECT\x20id\x20from\x20file_index_book\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','need\x20index\x20id','/getHomeData','book','\x20path=?\x20\x20','cover_path','26618VdRoHo','../../utils/arrayUtil','filePath','substring','getUserPathWhere','birthtime','existsSync','remark','111dwlOEf','/getReadRecord','file_cover_path','bookListId','type','Router','search','UPDATE\x20book_read_record\x20SET\x20progress=?,read_time=?\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','power_delete','orderField','deleteFail','groupField','error','\x20order\x20by\x20m.update_time\x20','/addReadRecord','sharpWriteCover','play_count','doUserCanGet','replace','book_path','language','/setBookType','catch','fileName','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','returnErrMsg','need\x20bookListId','recentReadList','NO\x20book\x20INDEX','delete','stat','app','sep','check_time','addBookToBookList','recentAddList','\x20is_file=1','/operationBookList','getMediaCoverCachePath','searchStr','144hbfyxE','getUserPower','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_book\x20WHERE\x20path=?\x20and\x20is_file=1','updateBook','orderField/orderType\x20error','status','genre','runGetBookInfoWorker','express','getBookListCount','power_get','../../db/dbFileIndexTable','getBookListById','is_file','getById','cover','orderType','224973jdbRvg','end','letterIndex','need\x20config\x20json','query','whereStr','SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid=?','log','/deleteSameNameCover','/operationBookListIndex','update','currentUser','configJson','join','extname','publisher','book_count','/setReaderConfig','UPDATE\x20book_reader_config\x20SET\x20remark=?\x20WHERE\x20uid=?','list','name','fileExist','/getGroupList','get','deleteFavorite','dbOther','\x20order\x20by\x20f.title_fl\x20','UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?','bookList','is_admin','.nfo','../../db/dbUserTable','\x20FROM\x20file_index_book\x20WHERE\x20','1759986AEELYu','listType','need\x20type/indexId','247655ONYeXY','getTime','removeBookList','getFavorite','bookIndexId','then','path','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_size=?','getFavoriteCount','indexId','封面写入成功','index\x20id\x20error','lastIndexOf','run','exports','/getBookList','operation\x20error','push','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20OR\x20artist\x20like\x20?\x20OR\x20tag\x20like\x20?\x20OR\x20publisher\x20like\x20?\x20OR\x20isbn\x20like\x20?\x20OR\x20genre\x20like\x20?\x20OR\x20year\x20like\x20?)','.jpg','../../db/dbBookIndexTable','\x20LIMIT\x20?\x20OFFSET\x20?\x20','createBookList','/updateBookNfo','length','checkOrderParams','fileCount','favorite','/bookFavorite','524196dETRcH','12LchZNe'];_0x3011=function(){return _0x254c54;};return _0x3011();}const bookIndexUtil=require('../../myWorkers/index/bookIndexUtil'),arrayUtil=require(_0x17ac9b(0x178)),nfoUtil=require('../../utils/nfoUtil');function getBookSameNameCover(_0x4d3bd3){return new Promise((_0x1abd08,_0x22f5f9)=>{const _0x11901b=_0x3909;try{let _0x51a1c9=_0x4d3bd3[_0x11901b(0x143)]['replace'](path[_0x11901b(0x1c6)](_0x4d3bd3['filename']),''),_0x5979e9=path[_0x11901b(0x1c5)](_0x4d3bd3['path'],_0x51a1c9+_0x11901b(0x12c)),_0x1defe4='';fs[_0x11901b(0x17d)](_0x5979e9)&&(_0x1defe4=_0x5979e9),_0x1abd08(_0x1defe4);}catch(_0x340b6c){_0x1abd08('');}});}router[_0x17ac9b(0x14f)](_0x17ac9b(0x1c9),(_0x3c4ba1,_0x4c62b6,_0x341f45)=>{const _0x582b79=_0x17ac9b;let _0x42c4c8=_0x3c4ba1[_0x582b79(0x1c3)]['id'],_0x1adeb3=_0x3c4ba1['body'][_0x582b79(0x1c4)],_0x5ed8df=_0x3c4ba1[_0x582b79(0x149)][_0x582b79(0x17e)];if(!_0x1adeb3&&!_0x5ed8df)return _0x3c4ba1[_0x582b79(0x19e)][_0x582b79(0x198)](_0x4c62b6,_0x582b79(0x1bb));try{JSON[_0x582b79(0x13c)](_0x1adeb3);}catch(_0x470203){return _0x3c4ba1['app'][_0x582b79(0x198)](_0x4c62b6,_0x582b79(0x14a));}let _0x1bbc63=_0x3c4ba1[_0x582b79(0x19e)][_0x582b79(0x10e)][_0x582b79(0x140)](_0x582b79(0x1be))[_0x582b79(0x10c)](_0x42c4c8);if(_0x1bbc63){if(_0x1adeb3)_0x3c4ba1[_0x582b79(0x19e)][_0x582b79(0x10e)][_0x582b79(0x140)]('UPDATE\x20book_reader_config\x20SET\x20config_json=?\x20WHERE\x20uid=?')[_0x582b79(0x126)](_0x1adeb3,_0x42c4c8);else _0x5ed8df&&_0x3c4ba1[_0x582b79(0x19e)][_0x582b79(0x10e)][_0x582b79(0x140)](_0x582b79(0x1ca))[_0x582b79(0x126)](_0x5ed8df,_0x42c4c8);}else _0x3c4ba1['app'][_0x582b79(0x10e)][_0x582b79(0x140)](_0x582b79(0x15f))[_0x582b79(0x126)](_0x42c4c8,_0x1adeb3,_0x5ed8df);return _0x4c62b6['json']({'code':0x0});}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x1c0),(_0x1e9a94,_0x3b5bd1,_0x13a60f)=>{const _0x50a102=_0x17ac9b;let _0x1832c4=_0x1e9a94[_0x50a102(0x1c3)]['id'],_0x1ef189=_0x1e9a94['body'][_0x50a102(0x11d)];if(!_0x1ef189)return _0x1e9a94[_0x50a102(0x19e)][_0x50a102(0x198)](_0x3b5bd1,_0x50a102(0x16c));let _0x522bbe=dbFileIndexTable[_0x50a102(0x1b5)](_0x1e9a94[_0x50a102(0x19e)]['dbFileIndex'],_0x1ef189,dbFileIndexTable[_0x50a102(0x14c)]);if(!_0x522bbe)return _0x1e9a94[_0x50a102(0x19e)][_0x50a102(0x198)](_0x3b5bd1,'need\x20bookIndexId');dbUserTable[_0x50a102(0x190)](_0x1e9a94,_0x3b5bd1,'',_0x50a102(0x187),_0x522bbe[_0x50a102(0x11f)])==!![]&&getBookSameNameCover(_0x522bbe)['then'](_0x14e018=>{const _0x962109=_0x50a102;if(!_0x14e018['endsWith'](_0x962109(0x12c)))return _0x1e9a94[_0x962109(0x19e)][_0x962109(0x198)](_0x3b5bd1,_0x962109(0x16f));fs[_0x962109(0x19d)](_0x14e018,(_0x466eea,_0x21f50c)=>{const _0x5c38ba=_0x962109;if(_0x466eea)return console[_0x5c38ba(0x1bf)]('封面文件已不存在'),_0x3b5bd1[_0x5c38ba(0x139)]({'code':0x0});fs['rm'](_0x14e018,_0x6c2a5d=>{const _0x343cd2=_0x5c38ba;if(_0x6c2a5d)return _0x1e9a94[_0x343cd2(0x19e)][_0x343cd2(0x198)](_0x3b5bd1,_0x3b5bd1['__']('deleteFail')+_0x14e018);return console['log']('封面文件已删除',_0x14e018),_0x3b5bd1[_0x343cd2(0x139)]({'code':0x0});});});});}),router[_0x17ac9b(0x14f)]('/refreshCheckTime',(_0x62728,_0x527022,_0x1ec00c)=>{const _0x9daaa1=_0x17ac9b;let _0x41c2a5=_0x62728['currentUser']['id'],_0x67eb22=_0x62728[_0x9daaa1(0x149)][_0x9daaa1(0x11d)];if(!_0x67eb22)return _0x527022[_0x9daaa1(0x1ac)](0x194)[_0x9daaa1(0x1b9)]();return dbBookIndexTable['updateByFiled'](_0x62728[_0x9daaa1(0x19e)][_0x9daaa1(0x13f)],_0x67eb22,'check_time',new Date()[_0x9daaa1(0x11a)]()),_0x527022[_0x9daaa1(0x139)]({'code':0x0});}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x18d),(_0x27db97,_0x421134,_0x4fcb31)=>{const _0x4b88d7=_0x17ac9b;let _0x1c5a94=_0x27db97[_0x4b88d7(0x1c3)]['id'];if(!_0x27db97['body']['fileName']||!_0x27db97[_0x4b88d7(0x149)][_0x4b88d7(0x179)]||!_0x27db97['body'][_0x4b88d7(0x13a)])return _0x421134[_0x4b88d7(0x139)]({'code':0x0});let _0x1b74df=_0x27db97[_0x4b88d7(0x149)][_0x4b88d7(0x196)];_0x1b74df=path['basename'](_0x27db97['body']['fileName']);let _0x2f465c=path[_0x4b88d7(0x1c5)](_0x27db97['body'][_0x4b88d7(0x179)]),_0x411c66=_0x27db97[_0x4b88d7(0x149)]['progress'],_0x168a14=_0x27db97[_0x4b88d7(0x19e)][_0x4b88d7(0x13f)][_0x4b88d7(0x140)]('SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?')[_0x4b88d7(0x10c)](_0x1c5a94,_0x1b74df,_0x2f465c);return _0x168a14?_0x27db97[_0x4b88d7(0x19e)]['dbFileIndex'][_0x4b88d7(0x140)](_0x4b88d7(0x186))[_0x4b88d7(0x126)](_0x411c66,Date[_0x4b88d7(0x138)](),_0x1c5a94,_0x1b74df,_0x2f465c):_0x27db97[_0x4b88d7(0x19e)]['dbFileIndex'][_0x4b88d7(0x140)]('REPLACE\x20INTO\x20book_read_record\x20(uid,book_filename,book_path,progress,read_time)\x20VALUES(?,?,?,?,?)')[_0x4b88d7(0x126)](_0x1c5a94,_0x1b74df,_0x2f465c,_0x411c66,Date['now']()),_0x421134[_0x4b88d7(0x139)]({'code':0x0});}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x180),(_0x400b07,_0x37ff24,_0x3f65c8)=>{const _0x563a23=_0x17ac9b;let _0x5b777b=_0x400b07[_0x563a23(0x1c3)]['id'],_0x421ddb=_0x400b07[_0x563a23(0x19e)][_0x563a23(0x10e)][_0x563a23(0x140)](_0x563a23(0x160))[_0x563a23(0x10c)](_0x5b777b),_0x13152e=0x0,_0x3a3169=_0x400b07[_0x563a23(0x149)]['fileName'],_0x1e16a5=_0x400b07[_0x563a23(0x149)]['filePath'];if(_0x3a3169&&_0x1e16a5){_0x1e16a5=path['join'](_0x1e16a5+'');let _0x3fb1d7=_0x400b07[_0x563a23(0x19e)][_0x563a23(0x13f)][_0x563a23(0x140)](_0x563a23(0x197))['get'](_0x5b777b,_0x3a3169,_0x1e16a5);_0x3fb1d7&&(_0x13152e=_0x3fb1d7[_0x563a23(0x13a)]);}return _0x37ff24[_0x563a23(0x139)]({'code':0x0,'progress':_0x13152e,'readerConfig':_0x421ddb});}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x194),(_0x3e5daa,_0x2750c6,_0x5a4cb1)=>{const _0x1eb173=_0x17ac9b;let _0x407448=_0x3e5daa[_0x1eb173(0x149)][_0x1eb173(0x122)],_0x2244e2=_0x3e5daa[_0x1eb173(0x149)]['type'];if(!_0x2244e2||!_0x407448)return _0x3e5daa[_0x1eb173(0x19e)]['returnErrMsg'](_0x2750c6,_0x1eb173(0x118));if(_0x2244e2!=0x1&&_0x2244e2!=0x2)return _0x3e5daa[_0x1eb173(0x19e)]['returnErrMsg'](_0x2750c6,'need\x20type');let _0x400ebf=dbBookIndexTable[_0x1eb173(0x15c)](_0x3e5daa[_0x1eb173(0x19e)][_0x1eb173(0x13f)],_0x407448);if(!_0x400ebf)return _0x3e5daa['app'][_0x1eb173(0x198)](_0x2750c6,_0x1eb173(0x156));if(dbUserTable[_0x1eb173(0x190)](_0x3e5daa,_0x2750c6,'book',_0x1eb173(0x16e),_0x400ebf[_0x1eb173(0x11f)])==!![])return dbBookIndexTable['updateByFiled'](_0x3e5daa[_0x1eb173(0x19e)][_0x1eb173(0x13f)],_0x407448,_0x1eb173(0x183),_0x2244e2),_0x2750c6[_0x1eb173(0x139)]({'code':0x0});});function getListByParams(_0x21cd0a,_0x703b9c,_0x20d925,_0x6978c6,_0x5ec88d,_0x162337,_0x2137ba,_0x268a2a,_0x44d5cc,_0x44c10e,_0x2dad4e,_0x54fe20){return new Promise((_0x3a0bc3,_0x215f5b)=>{const _0x2fc097=_0x3909;let _0x56e74f=_0x21cd0a[_0x2fc097(0x19e)][_0x2fc097(0x13f)],_0x257321=[];if(_0x20d925=='list'||_0x20d925==_0x2fc097(0x111))_0x257321=dbBookIndexTable[_0x2fc097(0x144)](_0x56e74f,_0x703b9c,_0x6978c6,_0x5ec88d,_0x162337,_0x2137ba,_0x268a2a,_0x44c10e,_0x44d5cc,_0x2dad4e,_0x54fe20);else{if(_0x20d925==_0x2fc097(0x134)){let _0x5e6a4e='',_0x416904=[];_0x5e6a4e+=_0x2fc097(0x1a3);_0x44d5cc&&(_0x44d5cc=_0x44d5cc[_0x2fc097(0x191)]('\x27','')['replace']('’',''),_0x5e6a4e+=_0x2fc097(0x12b),_0x416904[_0x2fc097(0x12a)]('%'+_0x44d5cc+'%','%'+_0x44d5cc+'%','%'+_0x44d5cc+'%','%'+_0x44d5cc+'%','%'+_0x44d5cc+'%','%'+_0x44d5cc+'%','%'+_0x44d5cc+'%','%'+_0x44d5cc+'%'));_0x2dad4e&&(_0x5e6a4e+=_0x2fc097(0x15e),_0x416904[_0x2fc097(0x12a)](_0x2dad4e,_0x2dad4e));if(_0x162337&&_0x2137ba){if(_0x162337==_0x2fc097(0x16b))_0x5e6a4e+=_0x2fc097(0x14d)+_0x2137ba+',f.artist\x20'+_0x2137ba+'\x20';else{if(_0x162337==_0x2fc097(0x150))_0x5e6a4e+=_0x2fc097(0x10f)+_0x2137ba+_0x2fc097(0x167)+_0x2137ba+',f.filename_fl\x20'+_0x2137ba+'\x20';else _0x162337=='favorite_time'?_0x5e6a4e+=_0x2fc097(0x18c)+_0x2137ba+'\x20':_0x5e6a4e+='\x20order\x20by\x20f.'+_0x162337+'\x20'+_0x2137ba+'\x20';}}else _0x5e6a4e+='\x20order\x20by\x20m.update_time\x20DESC\x20';_0x5e6a4e+=_0x2fc097(0x12e),_0x416904[_0x2fc097(0x12a)](_0x6978c6),_0x416904[_0x2fc097(0x12a)](_0x5ec88d),_0x257321=dbBookFavorite['getAllFavoriteByWhere'](_0x21cd0a[_0x2fc097(0x19e)][_0x2fc097(0x13f)],_0x21cd0a[_0x2fc097(0x1c3)]['id'],_0x5e6a4e,_0x416904);}}setBookListProps(_0x21cd0a,_0x257321)['then'](_0x5d6bbb=>{_0x3a0bc3(_0x5d6bbb);});});}function setBookListProps(_0x5eae6d,_0x2d0b2f){return new Promise(async(_0x32d8b3,_0x20e22d)=>{const _0x46aab6=_0x3909;for(let _0x49007d of _0x2d0b2f){_0x49007d[_0x46aab6(0x134)]=dbBookFavorite[_0x46aab6(0x153)](_0x5eae6d[_0x46aab6(0x19e)][_0x46aab6(0x13f)],_0x49007d['id'],_0x5eae6d[_0x46aab6(0x1c3)]['id'])?'1':'0',_0x49007d[_0x46aab6(0x179)]=path['join'](_0x49007d[_0x46aab6(0x11f)],_0x49007d[_0x46aab6(0x143)]),_0x49007d[_0x46aab6(0x181)]=await getBookSameNameCover(_0x49007d);}_0x32d8b3(_0x2d0b2f);});}router['post'](_0x17ac9b(0x173),(_0x462099,_0x42d82e,_0x449af3)=>{const _0x5db91c=_0x17ac9b;let _0x2f1bc4=_0x462099['body'][_0x5db91c(0x15a)]?_0x462099[_0x5db91c(0x149)][_0x5db91c(0x15a)]:0xc,_0x59d6b5=_0x462099[_0x5db91c(0x1c3)]['id'],_0x5e1f32=dbUserTable[_0x5db91c(0x17b)](_0x462099,'book',_0x5db91c(0x1b1),!![]);if(_0x462099[_0x5db91c(0x1c3)][_0x5db91c(0x112)]!=0x1&&!_0x5e1f32[_0x5db91c(0x1bd)])return _0x42d82e[_0x5db91c(0x139)]({'code':0x0,'data':null});let _0x1cd510=[],_0x160fe2=_0x462099[_0x5db91c(0x19e)][_0x5db91c(0x13f)][_0x5db91c(0x140)]('SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20ORDER\x20BY\x20read_time\x20desc\x20LIMIT\x20?')[_0x5db91c(0x163)](_0x59d6b5,_0x2f1bc4);for(let _0x2cdbc1 of _0x160fe2){let _0x20e6cf=dbBookIndexTable[_0x5db91c(0x168)](_0x462099[_0x5db91c(0x19e)][_0x5db91c(0x13f)],_0x2cdbc1[_0x5db91c(0x192)],_0x2cdbc1['book_filename']);_0x20e6cf&&dbUserTable['doUserCanGet'](_0x462099,_0x42d82e,_0x5db91c(0x174),_0x5db91c(0x1b1),_0x20e6cf['path'],!![])==!![]&&(_0x20e6cf[_0x5db91c(0x13a)]=_0x2cdbc1[_0x5db91c(0x13a)],_0x1cd510['push'](_0x20e6cf));}setBookListProps(_0x462099,_0x1cd510)['then'](_0x31da30=>{const _0xbd41f=_0x5db91c;_0x1cd510=_0x31da30,getListByParams(_0x462099,_0x5e1f32,'list',_0x2f1bc4,0x0,_0xbd41f(0x1a0),'desc',null,null,null,null,0x1)[_0xbd41f(0x11e)](_0x52d570=>{const _0x561287=_0xbd41f;getListByParams(_0x462099,_0x5e1f32,'list',_0x2f1bc4,0x0,'check_time',_0x561287(0x146),null,null,null,null,0x2)[_0x561287(0x11e)](_0x5dcd37=>{const _0x2f8eee=_0x561287;getListByParams(_0x462099,_0x5e1f32,_0x2f8eee(0x1cb),_0x2f1bc4,0x0,'id',_0x2f8eee(0x146))[_0x2f8eee(0x11e)](_0x570dc6=>{const _0x2070b8=_0x2f8eee;let _0x7ccce8={};return _0x1cd510&&_0x1cd510['length']>0x0&&(_0x7ccce8[_0x2070b8(0x19a)]=_0x1cd510),_0x570dc6&&_0x570dc6[_0x2070b8(0x131)]>0x0&&(_0x7ccce8[_0x2070b8(0x1a2)]=_0x570dc6),_0x52d570&&_0x52d570[_0x2070b8(0x131)]>0x0&&(_0x7ccce8[_0x2070b8(0x111)]=_0x52d570),_0x5dcd37&&_0x5dcd37[_0x2070b8(0x131)]>0x0&&(_0x7ccce8['comicList']=_0x5dcd37),_0x42d82e[_0x2070b8(0x139)]({'code':0x0,'data':_0x7ccce8,'platform':os[_0x2070b8(0x158)]()});});});});});}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x128),(_0x22e1a0,_0x4d6297,_0x520f5e)=>{const _0x426d00=_0x17ac9b;let _0x4c5f59=_0x22e1a0[_0x426d00(0x149)][_0x426d00(0x15a)]||0x32,_0x385a73=_0x22e1a0['body'][_0x426d00(0x16d)]||0x0,_0x526d25=_0x22e1a0[_0x426d00(0x149)][_0x426d00(0x16b)],_0x101713=_0x22e1a0[_0x426d00(0x149)][_0x426d00(0x188)]||_0x426d00(0x1a0),_0x1b84f4=_0x22e1a0['body'][_0x426d00(0x1b7)]||'desc',_0xf55dde=['list','favorite',_0x426d00(0x111)],_0xd720b0=_0x22e1a0[_0x426d00(0x149)][_0x426d00(0x117)]||_0x426d00(0x1cb),_0x5337d8=_0x22e1a0[_0x426d00(0x149)][_0x426d00(0x185)],_0x56b55e=_0x22e1a0[_0x426d00(0x149)][_0x426d00(0x1ba)],_0x102027=_0x22e1a0[_0x426d00(0x149)][_0x426d00(0x182)],_0x5c37a4=_0x22e1a0['body']['type'];if(dbBookIndexTable[_0x426d00(0x132)](_0x22e1a0,_0x4d6297,_0x101713,_0x1b84f4)!==!![])return;if(_0xd720b0==_0x426d00(0x111)){if(!_0x102027)return _0x22e1a0['app'][_0x426d00(0x198)](_0x4d6297,_0x426d00(0x199));}!_0xf55dde['includes'](_0xd720b0)&&(_0xd720b0=_0x426d00(0x1cb));_0x4c5f59>0x1f4&&(_0x4c5f59=0x1f4);let _0x316e3=dbUserTable[_0x426d00(0x17b)](_0x22e1a0,_0x426d00(0x174),'power_get',!![]);if(_0x22e1a0[_0x426d00(0x1c3)][_0x426d00(0x112)]!=0x1&&!_0x316e3[_0x426d00(0x1bd)])return _0x4d6297[_0x426d00(0x139)]({'code':0x0,'data':null});getListByParams(_0x22e1a0,_0x316e3,_0xd720b0,_0x4c5f59,_0x385a73,_0x101713,_0x1b84f4,_0x526d25,_0x5337d8,_0x102027,_0x56b55e,_0x5c37a4)[_0x426d00(0x11e)](_0x222e54=>{const _0x240195=_0x426d00;let _0x19df00={'code':0x0,'data':_0x222e54};if(_0xd720b0==_0x240195(0x134))_0x19df00[_0x240195(0x1c8)]=dbBookFavorite[_0x240195(0x121)](_0x22e1a0[_0x240195(0x19e)]['dbFileIndex'],_0x22e1a0[_0x240195(0x1c3)]['id']);else{if(_0xd720b0=='list')_0x19df00[_0x240195(0x1c8)]=dbBookIndexTable[_0x240195(0x1b0)](_0x22e1a0[_0x240195(0x19e)][_0x240195(0x13f)],_0x316e3,_0x526d25,_0x5337d8,_0x5c37a4);else _0xd720b0=='bookList'&&(_0x19df00[_0x240195(0x1c8)]=dbBookListTable[_0x240195(0x169)](_0x22e1a0[_0x240195(0x19e)][_0x240195(0x13f)],_0x102027));}return _0x4d6297[_0x240195(0x139)](_0x19df00);});}),router[_0x17ac9b(0x14f)]('/getBookDetail',(_0x3bbd29,_0x41d579,_0x1825f8)=>{const _0x2bbb0d=_0x17ac9b;let _0x346260=_0x3bbd29['body']['id'],_0x1f4ad1=dbFileIndexTable[_0x2bbb0d(0x1b5)](_0x3bbd29[_0x2bbb0d(0x19e)][_0x2bbb0d(0x13f)],_0x346260,dbFileIndexTable[_0x2bbb0d(0x14c)]);if(!_0x1f4ad1)return _0x3bbd29[_0x2bbb0d(0x19e)]['returnErrMsg'](_0x41d579,_0x2bbb0d(0x19b));if(dbUserTable[_0x2bbb0d(0x190)](_0x3bbd29,_0x41d579,_0x2bbb0d(0x174),'power_get',_0x1f4ad1[_0x2bbb0d(0x11f)])==!![]){let _0x3026d9=_0x3bbd29['currentUser']['id'],_0x4455be=dbBookFavorite[_0x2bbb0d(0x11c)](_0x3bbd29[_0x2bbb0d(0x19e)][_0x2bbb0d(0x13f)],_0x3026d9,_0x346260);_0x1f4ad1[_0x2bbb0d(0x134)]=_0x4455be?0x1:0x0,_0x1f4ad1['filePath']=path['join'](_0x1f4ad1['path'],_0x1f4ad1[_0x2bbb0d(0x143)]);let _0x5c53b5=dbBookIndexTable[_0x2bbb0d(0x157)](_0x3bbd29[_0x2bbb0d(0x19e)][_0x2bbb0d(0x13f)],_0x1f4ad1[_0x2bbb0d(0x11f)]);_0x5c53b5['length']>0x0?(_0x5c53b5=arrayUtil[_0x2bbb0d(0x141)](_0x5c53b5,_0x2bbb0d(0x143)),setBookListProps(_0x3bbd29,_0x5c53b5)[_0x2bbb0d(0x11e)](_0x20ef5a=>{_0x5c53b5=_0x20ef5a,_0x1e036e();})):_0x1e036e;function _0x1e036e(){let _0x143706={'code':0x0,'data':_0x1f4ad1,'sameFolderBookList':_0x5c53b5};getBookSameNameCover(_0x1f4ad1)['then'](_0x436438=>{const _0x428620=_0x3909;_0x1f4ad1['file_cover_path']=_0x436438;let _0x2f0bc0=_0x3bbd29[_0x428620(0x19e)][_0x428620(0x13f)]['prepare'](_0x428620(0x120))[_0x428620(0x10c)](_0x3026d9,path[_0x428620(0x1c5)](_0x1f4ad1['path'],_0x1f4ad1[_0x428620(0x143)]),_0x1f4ad1[_0x428620(0x13b)]);_0x2f0bc0&&(_0x143706[_0x428620(0x13a)]=_0x2f0bc0['progress']),_0x143706[_0x428620(0x10a)]=fs['stat'](_0x1f4ad1['filePath'],(_0x3aa02d,_0x5d89b9)=>{return _0x3aa02d?_0x143706['exist']=0x0:_0x143706['exist']=0x1,_0x41d579['json'](_0x143706);});});}}}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x135),(_0x4c04a6,_0xd91cb,_0x385c1f)=>{const _0x4c9320=_0x17ac9b;let _0x4f800f=_0x4c04a6[_0x4c9320(0x1c3)]['id'];function _0x25be99(_0x540426){const _0x25760a=_0x4c9320;let _0x191282=dbFileIndexTable[_0x25760a(0x1b5)](_0x4c04a6['app'][_0x25760a(0x13f)],_0x540426,dbFileIndexTable[_0x25760a(0x14c)]);if(!_0x191282)return;let _0x5ba27b=new Date()[_0x25760a(0x11a)]();_0x4c04a6['app'][_0x25760a(0x13f)][_0x25760a(0x140)](_0x25760a(0x110))[_0x25760a(0x126)](_0x5ba27b,_0x540426),dbBookFavorite['addFavorite'](_0x4c04a6['app'][_0x25760a(0x13f)],_0x4f800f,_0x540426);}if(_0x4c04a6[_0x4c9320(0x149)][_0x4c9320(0x122)]instanceof Array){let _0x19622d=_0x4c04a6[_0x4c9320(0x149)][_0x4c9320(0x15b)];if(_0x19622d==_0x4c9320(0x151))for(let _0x19f963 of _0x4c04a6['body']['indexId']){_0x25be99(_0x19f963);}else{if(_0x19622d==_0x4c9320(0x19c))for(let _0x5b40e1 of _0x4c04a6[_0x4c9320(0x149)]['indexId']){dbBookFavorite[_0x4c9320(0x10d)](_0x4c04a6[_0x4c9320(0x19e)]['dbFileIndex'],_0x4f800f,_0x5b40e1);}}return _0xd91cb[_0x4c9320(0x139)]({'code':0x0});}else{let _0x11553d=parseInt(_0x4c04a6['body']['indexId']),_0x31c69d=dbBookFavorite['getFavorite'](_0x4c04a6['app'][_0x4c9320(0x13f)],_0x4f800f,_0x11553d),_0x3a35eb=0x0;return _0x31c69d?dbBookFavorite['deleteFavorite'](_0x4c04a6[_0x4c9320(0x19e)][_0x4c9320(0x13f)],_0x4f800f,_0x11553d):(_0x3a35eb=0x1,_0x25be99(_0x11553d)),_0xd91cb['json']({'code':0x0,'favorite':_0x3a35eb});}}),router[_0x17ac9b(0x10c)](_0x17ac9b(0x14b),(_0x5a77c7,_0x4ad73b,_0x4c6112)=>{const _0x3e0a39=_0x17ac9b;let _0x20adea=_0x5a77c7[_0x3e0a39(0x1bc)][_0x3e0a39(0x122)],_0x2952d9=dbBookIndexTable[_0x3e0a39(0x15c)](_0x5a77c7[_0x3e0a39(0x19e)][_0x3e0a39(0x13f)],_0x20adea),_0x5b37ad=_0x5a77c7[_0x3e0a39(0x1bc)][_0x3e0a39(0x13b)];!_0x5b37ad&&(_0x5b37ad=0x200);if(!_0x2952d9||_0x2952d9&&!_0x2952d9['cover_path'])return _0x4ad73b['status'](0x194)[_0x3e0a39(0x1b9)]();dbUserTable[_0x3e0a39(0x190)](_0x5a77c7,_0x4ad73b,'book',_0x3e0a39(0x1b1),_0x2952d9[_0x3e0a39(0x11f)])==!![]&&fs[_0x3e0a39(0x19d)](_0x2952d9[_0x3e0a39(0x176)],(_0x561799,_0x1fb002)=>{const _0xaf4a73=_0x3e0a39;if(_0x561799){let _0x21453d=config[_0xaf4a73(0x1a5)](_0x2952d9);bookIndexUtil[_0xaf4a73(0x1ae)](_0x2952d9,_0x21453d)[_0xaf4a73(0x11e)](_0x3ce871=>{const _0x50b2dc=_0xaf4a73;if(_0x3ce871[_0x50b2dc(0x142)])bookIndexUtil[_0x50b2dc(0x18e)](_0x3ce871['coverData'],_0x21453d)['then'](_0xabc360=>{const _0x3ab7ef=_0x50b2dc;return console[_0x3ab7ef(0x1bf)](_0x3ab7ef(0x123),_0xabc360),_0x4ad73b['sendFile'](_0xabc360);})[_0x50b2dc(0x195)](_0x3bb387=>{const _0x503464=_0x50b2dc;return _0x4ad73b['status'](0x194)[_0x503464(0x1b9)]();});else return _0x4ad73b[_0x50b2dc(0x1ac)](0x194)[_0x50b2dc(0x1b9)]();})[_0xaf4a73(0x195)](_0x4b37ba=>{const _0x1507d0=_0xaf4a73;return _0x4ad73b[_0x1507d0(0x1ac)](0x194)[_0x1507d0(0x1b9)]();});}else return _0x4ad73b['sendFile'](_0x2952d9['cover_path']);});}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x10b),(_0x12dedf,_0x2fb621,_0x3d2f28)=>{const _0x295286=_0x17ac9b;let _0x31ea40=_0x12dedf['body'][_0x295286(0x15a)]||0x32,_0x51a1d5=_0x12dedf[_0x295286(0x149)][_0x295286(0x16d)]||0x0,_0x5d0ca8=_0x12dedf[_0x295286(0x149)][_0x295286(0x18a)]||_0x295286(0x111),_0x5cfe8b=_0x12dedf[_0x295286(0x149)]['orderField']||_0x295286(0x1a0),_0x29483f=_0x12dedf[_0x295286(0x149)]['orderType']||_0x295286(0x146),_0x687dd1=_0x12dedf[_0x295286(0x149)]['search'],_0x21565d=_0x12dedf[_0x295286(0x149)][_0x295286(0x1ba)];if(dbBookIndexTable['checkOrderParams'](_0x12dedf,_0x2fb621,_0x5cfe8b,_0x29483f)!==!![])return;let _0x575a3d=[_0x295286(0x1a0),_0x295286(0x18f),'check_time','filename','title',_0x295286(0x16b),_0x295286(0x17c),'id',_0x295286(0x1c7)],_0x20da9b=['asc',_0x295286(0x146)];if(!_0x575a3d[_0x295286(0x13d)](_0x5cfe8b)||!_0x20da9b['includes'](_0x29483f))return _0x12dedf['app'][_0x295286(0x198)](_0x2fb621,_0x295286(0x1ab),_0x5cfe8b,_0x29483f);let _0x3fc0bd=dbUserTable['getUserPathWhere'](_0x12dedf,_0x295286(0x174),_0x295286(0x1b1),!![]);if(_0x12dedf[_0x295286(0x1c3)][_0x295286(0x112)]!=0x1&&!_0x3fc0bd[_0x295286(0x1bd)]&&_0x5d0ca8!='bookList')return _0x2fb621['json']({'code':0x0,'data':null});let _0x2bc100=[];if(_0x5d0ca8==_0x295286(0x16b))_0x2bc100=dbBookIndexTable['getGroupList'](_0x12dedf[_0x295286(0x19e)][_0x295286(0x13f)],_0x3fc0bd,_0x5d0ca8,_0x31ea40,_0x51a1d5,_0x5cfe8b,_0x29483f,_0x687dd1,_0x21565d);else{if(_0x5d0ca8==_0x295286(0x111)){_0x2bc100=dbBookListTable['getBookListList'](_0x12dedf[_0x295286(0x19e)][_0x295286(0x13f)],_0x12dedf[_0x295286(0x1c3)]['id'],_0x31ea40,_0x51a1d5,'id',_0x295286(0x146),_0x687dd1);for(let _0x1f85cf of _0x2bc100){_0x1f85cf[_0x295286(0x1b6)]=dbBookIndexTable['getBooklistCover'](_0x12dedf['app'][_0x295286(0x13f)],_0x1f85cf['id']);}}}return _0x2fb621['json']({'code':0x0,'data':_0x2bc100});}),router['post'](_0x17ac9b(0x1a4),(_0x251f24,_0xb49dd0,_0x49def3)=>{const _0x34135e=_0x17ac9b;let _0x4ccd36=_0x251f24[_0x34135e(0x149)][_0x34135e(0x1cc)],_0x7b345b=_0x251f24[_0x34135e(0x149)][_0x34135e(0x15b)];if(_0x7b345b==_0x34135e(0x151)){if(!_0x4ccd36)return _0x251f24['app'][_0x34135e(0x198)](_0xb49dd0,_0x34135e(0x165));dbBookListTable[_0x34135e(0x12f)](_0x251f24[_0x34135e(0x19e)][_0x34135e(0x13f)],_0x251f24['currentUser']['id'],_0x4ccd36);}else{if(_0x7b345b==_0x34135e(0x148)||_0x7b345b=='delete'){let _0x5f1427=_0x251f24[_0x34135e(0x149)][_0x34135e(0x182)],_0x48d838=dbBookListTable['getBookListById'](_0x251f24['app']['dbFileIndex'],_0x5f1427),_0x36ce79=![];(_0x251f24[_0x34135e(0x1c3)][_0x34135e(0x112)]==0x1||_0x48d838[_0x34135e(0x147)]==_0x251f24[_0x34135e(0x1c3)]['id'])&&(_0x36ce79=!![]);if(!_0x36ce79)return _0xb49dd0[_0x34135e(0x139)]({'code':0x66});if(_0x7b345b==_0x34135e(0x19c))dbBookListTable[_0x34135e(0x11b)](_0x251f24[_0x34135e(0x19e)][_0x34135e(0x13f)],_0x5f1427);else{if(_0x7b345b==_0x34135e(0x148)){if(!_0x4ccd36)return _0x251f24[_0x34135e(0x19e)]['returnErrMsg'](_0xb49dd0,_0x34135e(0x165));dbBookListTable['updateBookList'](_0x251f24[_0x34135e(0x19e)][_0x34135e(0x13f)],_0x5f1427,_0x4ccd36);}}}else return _0x251f24[_0x34135e(0x19e)][_0x34135e(0x198)](_0xb49dd0,_0x34135e(0x129));}return _0xb49dd0[_0x34135e(0x139)]({'code':0x0});}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x1c1),(_0x3884ff,_0x352fd9,_0x56bdd6)=>{const _0x18fdaa=_0x17ac9b;let _0x74cc83=_0x3884ff[_0x18fdaa(0x149)][_0x18fdaa(0x11d)],_0x1affd1=_0x3884ff[_0x18fdaa(0x149)][_0x18fdaa(0x182)];if(!_0x74cc83||!_0x1affd1)return _0x3884ff[_0x18fdaa(0x19e)]['returnErrMsg'](_0x352fd9,'need\x20bookIndexId/bookListId');let _0x577af1=dbBookListTable[_0x18fdaa(0x1b3)](_0x3884ff[_0x18fdaa(0x19e)][_0x18fdaa(0x13f)],_0x1affd1);if(!_0x577af1)return _0x3884ff[_0x18fdaa(0x19e)][_0x18fdaa(0x198)](_0x352fd9,'bookListId\x20no\x20exists');let _0x3b33e1=_0x3884ff['body'][_0x18fdaa(0x15b)];if(_0x3b33e1==_0x18fdaa(0x151)){function _0x2e2fe8(_0x47d5e4){const _0x7b0f37=_0x18fdaa;let _0x2424e6=dbBookIndexTable[_0x7b0f37(0x15c)](_0x3884ff[_0x7b0f37(0x19e)][_0x7b0f37(0x13f)],_0x47d5e4);if(!_0x2424e6)return;if(_0x2424e6[_0x7b0f37(0x1b4)]==0x1){dbBookListTable[_0x7b0f37(0x1a1)](_0x3884ff[_0x7b0f37(0x19e)][_0x7b0f37(0x13f)],_0x47d5e4,_0x1affd1);let _0x49ac34=Date[_0x7b0f37(0x138)]();_0x3884ff['app'][_0x7b0f37(0x13f)][_0x7b0f37(0x140)](_0x7b0f37(0x110))[_0x7b0f37(0x126)](_0x49ac34,_0x2424e6['id']);}else{let _0x515dfc=path[_0x7b0f37(0x1c5)](_0x2424e6[_0x7b0f37(0x11f)],_0x2424e6[_0x7b0f37(0x143)]),_0x3d7dcc=_0x3884ff[_0x7b0f37(0x19e)][_0x7b0f37(0x13f)][_0x7b0f37(0x140)](_0x7b0f37(0x171))[_0x7b0f37(0x163)](_0x515dfc,_0x515dfc+path[_0x7b0f37(0x19f)]+'%');for(let _0x35740f of _0x3d7dcc){dbBookListTable['addBookToBookList'](_0x3884ff[_0x7b0f37(0x19e)][_0x7b0f37(0x13f)],_0x35740f['id'],_0x1affd1);}}}if(_0x74cc83 instanceof Array)for(let _0x1bf7ee of _0x74cc83){_0x2e2fe8(_0x1bf7ee);}else _0x2e2fe8(_0x74cc83);}else{if(_0x3b33e1==_0x18fdaa(0x19c)){if(_0x74cc83 instanceof Array)for(let _0x53578b of _0x74cc83){dbBookListTable[_0x18fdaa(0x16a)](_0x3884ff[_0x18fdaa(0x19e)][_0x18fdaa(0x13f)],_0x53578b,_0x1affd1);}else dbBookListTable[_0x18fdaa(0x16a)](_0x3884ff[_0x18fdaa(0x19e)][_0x18fdaa(0x13f)],_0x74cc83,_0x1affd1);}else return _0x3884ff['app']['returnErrMsg'](_0x352fd9,_0x18fdaa(0x129));}return _0x352fd9['json']({'code':0x0,'data':{}});}),router[_0x17ac9b(0x14f)]('/getBookIndexFileTree',(_0x43b960,_0x41da64,_0x28490b)=>{const _0x13b6de=_0x17ac9b;let _0x5d0729=_0x43b960[_0x13b6de(0x149)]['parent'],_0x25f6b6=_0x43b960[_0x13b6de(0x149)][_0x13b6de(0x1a6)],_0x4929fe=_0x13b6de(0x174);if(dbUserTable[_0x13b6de(0x190)](_0x43b960,_0x41da64,_0x4929fe,'power_get')==!![]){let _0x48881b=[];if(!_0x5d0729){let _0x80bcc0=[];_0x43b960[_0x13b6de(0x1c3)][_0x13b6de(0x112)]==0x1?_0x80bcc0=dbSourceFolderTable[_0x13b6de(0x155)](_0x43b960[_0x13b6de(0x19e)][_0x13b6de(0x10e)],_0x4929fe):_0x80bcc0=dbUserTable[_0x13b6de(0x1a8)](_0x43b960[_0x13b6de(0x19e)][_0x13b6de(0x10e)],_0x43b960[_0x13b6de(0x1c3)]['username'],_0x4929fe);if(_0x80bcc0)for(let _0x13c847=0x0;_0x13c847<_0x80bcc0[_0x13b6de(0x131)];_0x13c847++){_0x48881b[_0x13b6de(0x12a)]({'path':_0x80bcc0[_0x13c847]['path'],'is_file':0x0,'filename':path['basename'](_0x80bcc0[_0x13c847][_0x13b6de(0x11f)]),'root':!![]});}}else{let _0x284f0f=[];if(_0x43b960[_0x13b6de(0x1c3)]['is_admin']!=0x1){if(dbUserTable[_0x13b6de(0x190)](_0x43b960,_0x41da64,_0x4929fe,'power_get',_0x5d0729)!==!![])return;}_0x5d0729=path[_0x13b6de(0x1c5)](_0x5d0729);let _0x9696e3=_0x13b6de(0x175);_0x284f0f['push'](_0x5d0729);if(_0x25f6b6){let _0x4cc696='\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20';_0x9696e3+=_0x4cc696,_0x284f0f['push']('%'+_0x25f6b6+'%'),_0x284f0f[_0x13b6de(0x12a)]('%'+_0x25f6b6+'%');}let _0x43741d=_0x13b6de(0x15d);_0x48881b=_0x43b960[_0x13b6de(0x19e)][_0x13b6de(0x13f)][_0x13b6de(0x140)](_0x13b6de(0x154)+_0x43741d+_0x13b6de(0x115)+_0x9696e3)['all'](_0x284f0f);}for(let _0x8af9bd of _0x48881b){if(_0x8af9bd[_0x13b6de(0x1b4)]==0x0){let _0x3db6ee=path['join'](_0x8af9bd[_0x13b6de(0x11f)],_0x8af9bd['filename']),_0x265a25=_0x43b960[_0x13b6de(0x19e)][_0x13b6de(0x13f)][_0x13b6de(0x140)](_0x13b6de(0x1a9))[_0x13b6de(0x10c)](_0x3db6ee);_0x8af9bd[_0x13b6de(0x133)]=_0x265a25['count'];}}let _0x4d4d49=path[_0x13b6de(0x19f)],_0x275015={'code':0x0,'data':_0x48881b,'sep':_0x4d4d49};return _0x41da64[_0x13b6de(0x139)](_0x275015);}}),router[_0x17ac9b(0x14f)](_0x17ac9b(0x130),(_0x4a4e46,_0x551427,_0x2fb902)=>{const _0x4bc4ed=_0x17ac9b;let _0x57d884=_0x4a4e46[_0x4bc4ed(0x149)][_0x4bc4ed(0x11d)],_0x20a29a=_0x4a4e46[_0x4bc4ed(0x149)][_0x4bc4ed(0x15b)];if(!_0x57d884)return _0x4a4e46[_0x4bc4ed(0x19e)][_0x4bc4ed(0x198)](_0x551427,_0x4bc4ed(0x172));let _0xe16dad=dbBookIndexTable['getBookIndex'](_0x4a4e46[_0x4bc4ed(0x19e)][_0x4bc4ed(0x13f)],_0x57d884);if(!_0xe16dad)return _0x4a4e46['app'][_0x4bc4ed(0x198)](_0x551427,_0x4bc4ed(0x124));if(_0x20a29a==_0x4bc4ed(0x1c2)){let _0x389f99={'title':_0x4a4e46['body']['title'],'publish_date':_0x4a4e46[_0x4bc4ed(0x149)]['publish_date'],'year':_0x4a4e46[_0x4bc4ed(0x149)][_0x4bc4ed(0x162)],'isbn':_0x4a4e46[_0x4bc4ed(0x149)][_0x4bc4ed(0x14e)],'language':_0x4a4e46[_0x4bc4ed(0x149)][_0x4bc4ed(0x193)],'genre':_0x4a4e46[_0x4bc4ed(0x149)][_0x4bc4ed(0x1ad)],'tag':_0x4a4e46[_0x4bc4ed(0x149)][_0x4bc4ed(0x13e)],'publisher':_0x4a4e46[_0x4bc4ed(0x149)]['publisher'],'artist':_0x4a4e46[_0x4bc4ed(0x149)][_0x4bc4ed(0x16b)],'introduction':_0x4a4e46[_0x4bc4ed(0x149)]['introduction']},_0x4b98c3=path['join'](_0xe16dad[_0x4bc4ed(0x11f)],_0xe16dad[_0x4bc4ed(0x143)]);fs[_0x4bc4ed(0x19d)](_0x4b98c3,(_0x1fb0c1,_0x49f533)=>{const _0x20e0fb=_0x4bc4ed;if(_0x1fb0c1)return _0x4a4e46[_0x20e0fb(0x19e)][_0x20e0fb(0x198)](_0x551427,_0x551427['__']('folderNotExist')+_0x4b98c3);let _0x59e853=_0x4b98c3['substring'](0x0,_0x4b98c3[_0x20e0fb(0x125)]('.'))+_0x20e0fb(0x113);nfoUtil['saveBookNfo'](_0x389f99,_0x59e853)[_0x20e0fb(0x11e)](()=>{const _0xcc8ddf=_0x20e0fb;console[_0xcc8ddf(0x1bf)](_0xcc8ddf(0x145)),dbBookIndexTable[_0xcc8ddf(0x1aa)](_0x4a4e46[_0xcc8ddf(0x19e)]['dbFileIndex'],_0x57d884,_0x389f99),_0xe16dad=dbBookIndexTable[_0xcc8ddf(0x15c)](_0x4a4e46['app'][_0xcc8ddf(0x13f)],_0x57d884),setBookListProps(_0x4a4e46,[_0xe16dad])[_0xcc8ddf(0x11e)](_0x23f38e=>{const _0x29dbb4=_0xcc8ddf;return _0x551427[_0x29dbb4(0x139)]({'code':0x0,'data':_0x23f38e[0x0]});});})['catch'](_0x14a789=>{const _0x447b41=_0x20e0fb;return console['log'](_0x447b41(0x166),_0x14a789),_0x4a4e46[_0x447b41(0x19e)][_0x447b41(0x198)](_0x551427,_0x447b41(0x18b));});});}else{if(_0x20a29a==_0x4bc4ed(0x19c)){let _0x423212=path[_0x4bc4ed(0x1c5)](_0xe16dad[_0x4bc4ed(0x11f)],_0xe16dad[_0x4bc4ed(0x143)]),_0x3bc48a=_0x423212[_0x4bc4ed(0x17a)](0x0,_0x423212[_0x4bc4ed(0x125)]('.'))+_0x4bc4ed(0x113);fs[_0x4bc4ed(0x19d)](_0x3bc48a,(_0x43f6d5,_0xbe754e)=>{const _0x4c0adf=_0x4bc4ed;if(_0x43f6d5)return _0x4a4e46[_0x4c0adf(0x19e)]['returnErrMsg'](_0x551427,_0x551427['__'](_0x4c0adf(0x161))+_0x3bc48a);fs['rm'](_0x3bc48a,_0x42bd1f=>{const _0x337665=_0x4c0adf;if(_0x42bd1f)return _0x4a4e46[_0x337665(0x19e)]['returnErrMsg'](_0x551427,_0x551427['__'](_0x337665(0x189))+_0x3bc48a);return dbBookIndexTable['updateBook'](_0x4a4e46[_0x337665(0x19e)][_0x337665(0x13f)],indexId,{}),_0x551427[_0x337665(0x139)]({'code':0x0});});});}else return _0x4a4e46[_0x4bc4ed(0x19e)]['returnErrMsg'](_0x551427,_0x4bc4ed(0x129));}}),module[_0x17ac9b(0x127)]=router;