const _0x46d84e=_0x2895;(function(_0x5e4532,_0x420b78){const _0xe2e887=_0x2895,_0x10185a=_0x5e4532();while(!![]){try{const _0x5692c9=parseInt(_0xe2e887(0xe9))/0x1+parseInt(_0xe2e887(0x15c))/0x2+parseInt(_0xe2e887(0x15a))/0x3+parseInt(_0xe2e887(0xfb))/0x4+-parseInt(_0xe2e887(0x114))/0x5*(-parseInt(_0xe2e887(0x119))/0x6)+parseInt(_0xe2e887(0x105))/0x7*(parseInt(_0xe2e887(0x125))/0x8)+parseInt(_0xe2e887(0xf7))/0x9*(-parseInt(_0xe2e887(0x172))/0xa);if(_0x5692c9===_0x420b78)break;else _0x10185a['push'](_0x10185a['shift']());}catch(_0x8638ca){_0x10185a['push'](_0x10185a['shift']());}}}(_0x32d4,0x95312));function _0x2895(_0x59cfc2,_0x3261ce){const _0x32d439=_0x32d4();return _0x2895=function(_0x289537,_0xa60397){_0x289537=_0x289537-0xb3;let _0x11edd1=_0x32d439[_0x289537];return _0x11edd1;},_0x2895(_0x59cfc2,_0x3261ce);}let express=require(_0x46d84e(0x163)),router=express[_0x46d84e(0x160)](),path=require('path'),fs=require('fs'),dbBookIndexTable=require(_0x46d84e(0x16d)),dbFileIndexTable=require(_0x46d84e(0xdf)),dbBookListTable=require(_0x46d84e(0xc8)),dbBookFavorite=require(_0x46d84e(0x13d));const dbUserTable=require(_0x46d84e(0x10d)),dbSourceFolderTable=require('../../db/dbSourceFolderTable');let os=require('os'),config=require(_0x46d84e(0x139));const bookIndexUtil=require(_0x46d84e(0x10e)),arrayUtil=require(_0x46d84e(0x116)),nfoUtil=require(_0x46d84e(0xd7));function getBookSameNameCover(_0x256fc5){return new Promise((_0x461e14,_0x765698)=>{const _0x3897f2=_0x2895;try{let _0x35391a=_0x256fc5[_0x3897f2(0x142)][_0x3897f2(0xef)](path[_0x3897f2(0x16e)](_0x256fc5['filename']),''),_0x166594=path[_0x3897f2(0x11f)](_0x256fc5[_0x3897f2(0xdd)],_0x35391a+'.jpg'),_0x38ba74='';fs['existsSync'](_0x166594)&&(_0x38ba74=_0x166594),_0x461e14(_0x38ba74);}catch(_0x543d2c){_0x461e14('');}});}router[_0x46d84e(0x103)]('/setReaderConfig',(_0x394506,_0x187282,_0x41f764)=>{const _0x1b13a4=_0x46d84e;let _0x5a5f53=_0x394506[_0x1b13a4(0x12f)]['id'],_0x2ada7e=_0x394506[_0x1b13a4(0xd6)][_0x1b13a4(0x167)],_0x3e6a34=_0x394506[_0x1b13a4(0xd6)][_0x1b13a4(0x144)];if(!_0x2ada7e&&!_0x3e6a34)return _0x394506['app'][_0x1b13a4(0x128)](_0x187282,_0x1b13a4(0x115));try{JSON[_0x1b13a4(0xdc)](_0x2ada7e);}catch(_0x498efa){return _0x394506[_0x1b13a4(0x124)][_0x1b13a4(0x128)](_0x187282,_0x1b13a4(0xe7));}let _0x2de188=_0x394506['app']['dbOther'][_0x1b13a4(0x140)](_0x1b13a4(0xe1))[_0x1b13a4(0x169)](_0x5a5f53);if(_0x2de188){if(_0x2ada7e)_0x394506[_0x1b13a4(0x124)][_0x1b13a4(0xf2)][_0x1b13a4(0x140)](_0x1b13a4(0xe4))[_0x1b13a4(0xfd)](_0x2ada7e,_0x5a5f53);else _0x3e6a34&&_0x394506[_0x1b13a4(0x124)][_0x1b13a4(0xf2)][_0x1b13a4(0x140)]('UPDATE\x20book_reader_config\x20SET\x20remark=?\x20WHERE\x20uid=?')[_0x1b13a4(0xfd)](_0x3e6a34,_0x5a5f53);}else _0x394506['app']['dbOther'][_0x1b13a4(0x140)](_0x1b13a4(0x109))[_0x1b13a4(0xfd)](_0x5a5f53,_0x2ada7e,_0x3e6a34);return _0x187282[_0x1b13a4(0xfc)]({'code':0x0});}),router[_0x46d84e(0x103)]('/deleteSameNameCover',(_0xdc5724,_0xf0bbb6,_0x3a0c8e)=>{const _0xd6011b=_0x46d84e;let _0x1872be=_0xdc5724[_0xd6011b(0x12f)]['id'],_0x5f34fb=_0xdc5724['body'][_0xd6011b(0x153)];if(!_0x5f34fb)return _0xdc5724['app'][_0xd6011b(0x128)](_0xf0bbb6,_0xd6011b(0x162));let _0x3c6596=dbFileIndexTable['getById'](_0xdc5724['app'][_0xd6011b(0x145)],_0x5f34fb,dbFileIndexTable['INDEX_TABLE_NAME_BOOK']);if(!_0x3c6596)return _0xdc5724['app']['returnErrMsg'](_0xf0bbb6,_0xd6011b(0x162));dbUserTable[_0xd6011b(0x13f)](_0xdc5724,_0xf0bbb6,'',_0xd6011b(0xc4),_0x3c6596['path'])==!![]&&getBookSameNameCover(_0x3c6596)[_0xd6011b(0xea)](_0x3c0a8b=>{const _0x53b977=_0xd6011b;if(!_0x3c0a8b[_0x53b977(0x16a)](_0x53b977(0x154)))return _0xdc5724[_0x53b977(0x124)][_0x53b977(0x128)](_0xf0bbb6,'cover\x20format\x20error');fs['stat'](_0x3c0a8b,(_0x2d0687,_0x5b9b55)=>{const _0x1dade2=_0x53b977;if(_0x2d0687)return console[_0x1dade2(0xb3)](_0x1dade2(0xc5)),_0xf0bbb6[_0x1dade2(0xfc)]({'code':0x0});fs['rm'](_0x3c0a8b,_0x135a5e=>{const _0x38f132=_0x1dade2;if(_0x135a5e)return _0xdc5724['app'][_0x38f132(0x128)](_0xf0bbb6,_0xf0bbb6['__'](_0x38f132(0x112))+_0x3c0a8b);return console[_0x38f132(0xb3)](_0x38f132(0xc7),_0x3c0a8b),_0xf0bbb6[_0x38f132(0xfc)]({'code':0x0});});});});}),router[_0x46d84e(0x103)](_0x46d84e(0xee),(_0x172cc6,_0x3cb496,_0x292527)=>{const _0x2d6ee4=_0x46d84e;let _0x25b5de=_0x172cc6[_0x2d6ee4(0x12f)]['id'],_0x32b056=_0x172cc6[_0x2d6ee4(0xd6)][_0x2d6ee4(0x153)];if(!_0x32b056)return _0x3cb496[_0x2d6ee4(0xf6)](0x194)['end']();return dbBookIndexTable[_0x2d6ee4(0x12a)](_0x172cc6[_0x2d6ee4(0x124)]['dbFileIndex'],_0x32b056,_0x2d6ee4(0x150),new Date()[_0x2d6ee4(0xf3)]()),_0x3cb496['json']({'code':0x0});}),router[_0x46d84e(0x103)](_0x46d84e(0x165),(_0x3792a3,_0x19a19c,_0x15e9a8)=>{const _0x6d8e5=_0x46d84e;let _0x20fc72=_0x3792a3[_0x6d8e5(0x12f)]['id'];if(!_0x3792a3[_0x6d8e5(0xd6)][_0x6d8e5(0x12c)]||!_0x3792a3[_0x6d8e5(0xd6)][_0x6d8e5(0x11d)]||!_0x3792a3[_0x6d8e5(0xd6)]['progress'])return _0x19a19c['json']({'code':0x0});let _0x40cee8=_0x3792a3[_0x6d8e5(0xd6)]['fileName'];_0x40cee8=path[_0x6d8e5(0x129)](_0x3792a3[_0x6d8e5(0xd6)][_0x6d8e5(0x12c)]);let _0x1a6416=path[_0x6d8e5(0x11f)](_0x3792a3['body'][_0x6d8e5(0x11d)]),_0x72f51d=_0x3792a3[_0x6d8e5(0xd6)][_0x6d8e5(0xb8)],_0xb64243=_0x3792a3[_0x6d8e5(0x124)]['dbFileIndex'][_0x6d8e5(0x140)](_0x6d8e5(0xb6))['get'](_0x20fc72,_0x40cee8,_0x1a6416);return _0xb64243?_0x3792a3[_0x6d8e5(0x124)][_0x6d8e5(0x145)][_0x6d8e5(0x140)](_0x6d8e5(0xb4))[_0x6d8e5(0xfd)](_0x72f51d,Date[_0x6d8e5(0x121)](),_0x20fc72,_0x40cee8,_0x1a6416):_0x3792a3[_0x6d8e5(0x124)]['dbFileIndex']['prepare'](_0x6d8e5(0x14a))['run'](_0x20fc72,_0x40cee8,_0x1a6416,_0x72f51d,Date[_0x6d8e5(0x121)]()),_0x19a19c['json']({'code':0x0});}),router[_0x46d84e(0x103)](_0x46d84e(0x11b),(_0x26534b,_0x46374b,_0xd5d6ce)=>{const _0x4df9b1=_0x46d84e;let _0x1f83b2=_0x26534b[_0x4df9b1(0x12f)]['id'],_0x273883=_0x26534b[_0x4df9b1(0x124)]['dbOther']['prepare']('SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid\x20=\x20?')[_0x4df9b1(0x169)](_0x1f83b2),_0x2f6c35=0x0,_0x3b628c=_0x26534b[_0x4df9b1(0xd6)]['fileName'],_0x3faee3=_0x26534b[_0x4df9b1(0xd6)]['filePath'];if(_0x3b628c&&_0x3faee3){_0x3faee3=path['join'](_0x3faee3+'');let _0x8ab417=_0x26534b[_0x4df9b1(0x124)][_0x4df9b1(0x145)][_0x4df9b1(0x140)](_0x4df9b1(0xb6))[_0x4df9b1(0x169)](_0x1f83b2,_0x3b628c,_0x3faee3);_0x8ab417&&(_0x2f6c35=_0x8ab417['progress']);}return _0x46374b['json']({'code':0x0,'progress':_0x2f6c35,'readerConfig':_0x273883});}),router[_0x46d84e(0x103)](_0x46d84e(0x161),(_0x4664a6,_0x5a57ec,_0x2e6a80)=>{const _0x3bdf43=_0x46d84e;let _0x545d40=_0x4664a6[_0x3bdf43(0xd6)][_0x3bdf43(0x168)],_0x1ab33f=_0x4664a6[_0x3bdf43(0xd6)][_0x3bdf43(0x178)];if(!_0x1ab33f||!_0x545d40)return _0x4664a6[_0x3bdf43(0x124)][_0x3bdf43(0x128)](_0x5a57ec,_0x3bdf43(0xcc));if(_0x1ab33f!=0x1&&_0x1ab33f!=0x2)return _0x4664a6[_0x3bdf43(0x124)][_0x3bdf43(0x128)](_0x5a57ec,_0x3bdf43(0x148));let _0x5def51=dbBookIndexTable['getBookIndex'](_0x4664a6[_0x3bdf43(0x124)][_0x3bdf43(0x145)],_0x545d40);if(!_0x5def51)return _0x4664a6[_0x3bdf43(0x124)]['returnErrMsg'](_0x5a57ec,_0x3bdf43(0xb7));if(dbUserTable[_0x3bdf43(0x13f)](_0x4664a6,_0x5a57ec,_0x3bdf43(0x130),'power_change',_0x5def51[_0x3bdf43(0xdd)])==!![])return dbBookIndexTable[_0x3bdf43(0x12a)](_0x4664a6[_0x3bdf43(0x124)][_0x3bdf43(0x145)],_0x545d40,_0x3bdf43(0x178),_0x1ab33f),_0x5a57ec[_0x3bdf43(0xfc)]({'code':0x0});});function getListByParams(_0x4672c4,_0x45e01f,_0x47f0cd,_0xb8100b,_0x1fadd7,_0x2a8cb6,_0x5d7b22,_0x13dbce,_0x2ffd1e,_0x4ecdf6,_0x171d49,_0x4a435f){return new Promise((_0x86ecc5,_0x6ee89d)=>{const _0x584654=_0x2895;let _0x32cf34=_0x4672c4[_0x584654(0x124)]['dbFileIndex'],_0x505608=[];if(_0x47f0cd==_0x584654(0x133)||_0x47f0cd==_0x584654(0x152))_0x505608=dbBookIndexTable[_0x584654(0x13e)](_0x32cf34,_0x45e01f,_0xb8100b,_0x1fadd7,_0x2a8cb6,_0x5d7b22,_0x13dbce,_0x4ecdf6,_0x2ffd1e,_0x171d49,_0x4a435f);else{if(_0x47f0cd==_0x584654(0xf1)){let _0x51d207='',_0x3c690f=[];_0x51d207+=_0x584654(0xd9);_0x2ffd1e&&(_0x2ffd1e=_0x2ffd1e[_0x584654(0xef)]('\x27','')[_0x584654(0xef)]('’',''),_0x51d207+=_0x584654(0x146),_0x3c690f[_0x584654(0x170)]('%'+_0x2ffd1e+'%','%'+_0x2ffd1e+'%','%'+_0x2ffd1e+'%','%'+_0x2ffd1e+'%','%'+_0x2ffd1e+'%','%'+_0x2ffd1e+'%','%'+_0x2ffd1e+'%','%'+_0x2ffd1e+'%'));_0x171d49&&(_0x51d207+=_0x584654(0x106),_0x3c690f[_0x584654(0x170)](_0x171d49,_0x171d49));if(_0x2a8cb6&&_0x5d7b22){if(_0x2a8cb6==_0x584654(0x108))_0x51d207+=_0x584654(0x15f)+_0x5d7b22+',f.artist\x20'+_0x5d7b22+'\x20';else{if(_0x2a8cb6==_0x584654(0xce))_0x51d207+='\x20order\x20by\x20f.title_fl\x20'+_0x5d7b22+_0x584654(0xbb)+_0x5d7b22+_0x584654(0x118)+_0x5d7b22+'\x20';else _0x2a8cb6==_0x584654(0x177)?_0x51d207+=_0x584654(0xd0)+_0x5d7b22+'\x20':_0x51d207+='\x20order\x20by\x20f.'+_0x2a8cb6+'\x20'+_0x5d7b22+'\x20';}}else _0x51d207+='\x20order\x20by\x20m.update_time\x20DESC\x20';_0x51d207+='\x20LIMIT\x20?\x20OFFSET\x20?\x20',_0x3c690f[_0x584654(0x170)](_0xb8100b),_0x3c690f[_0x584654(0x170)](_0x1fadd7),_0x505608=dbBookFavorite[_0x584654(0xff)](_0x4672c4[_0x584654(0x124)][_0x584654(0x145)],_0x4672c4['currentUser']['id'],_0x51d207,_0x3c690f);}}setBookListProps(_0x4672c4,_0x505608)['then'](_0x50a3de=>{_0x86ecc5(_0x50a3de);});});}function setBookListProps(_0x161b94,_0x12ca34){return new Promise(async(_0x5dbc22,_0x365b23)=>{const _0x277d2a=_0x2895;for(let _0x5d9ffe of _0x12ca34){_0x5d9ffe[_0x277d2a(0xf1)]=dbBookFavorite[_0x277d2a(0x107)](_0x161b94['app'][_0x277d2a(0x145)],_0x5d9ffe['id'],_0x161b94[_0x277d2a(0x12f)]['id'])?'1':'0',_0x5d9ffe[_0x277d2a(0x11d)]=path[_0x277d2a(0x11f)](_0x5d9ffe[_0x277d2a(0xdd)],_0x5d9ffe[_0x277d2a(0x142)]),_0x5d9ffe[_0x277d2a(0x13c)]=await getBookSameNameCover(_0x5d9ffe);}_0x5dbc22(_0x12ca34);});}function _0x32d4(){const _0x50dac1=['tag','408134gNPcqR','then','\x20FROM\x20file_index_book\x20WHERE\x20','INDEX_TABLE_NAME_BOOK','createBookList','/refreshCheckTime','replace','.nfo','favorite','dbOther','getTime','book_path','cover_path','status','37145106XYIUuz','getMediaCoverCachePath','UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?','getById','3908508EdFLvZ','json','run','book_count','getAllFavoriteByWhere','count','sep','power_get','post','orderField','7PUVsqZ','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','bookIsFavorite','artist','REPLACE\x20INTO\x20book_reader_config\x20(uid,config_json,remark)\x20VALUES(?,?,?)','stat','edit','getBookListBookCount','../../db/dbUserTable','../../myWorkers/index/bookIndexUtil','searchStr','operation\x20error','getFavoriteCount','deleteFail','cover','1994415DMuJtf','need\x20config\x20json','../../utils/arrayUtil','/getBookIndexFileTree',',f.filename_fl\x20','12xAAETM','SELECT\x20','/getReadRecord','asc','filePath','is_file','join','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','now','publish_date','need\x20\x27name\x27','app','8577544mKFqRY','/operationBookList','sendFile','returnErrMsg','basename','updateByFiled','size','fileName','desc','getUserPathWhere','currentUser','book','recentAddList','updateBook','list','play_count','groupField','delete','bookListId','offset','../../myConfig/config','catch','runGetBookInfoWorker','file_cover_path','../../db/dbBookFavorite','getBookList','doUserCanGet','prepare','genre','filename','all','remark','dbFileIndex','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20OR\x20artist\x20like\x20?\x20OR\x20tag\x20like\x20?\x20OR\x20publisher\x20like\x20?\x20OR\x20isbn\x20like\x20?\x20OR\x20genre\x20like\x20?\x20OR\x20year\x20like\x20?)','/getBookList','need\x20type','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_size=?','REPLACE\x20INTO\x20book_read_record\x20(uid,book_filename,book_path,progress,read_time)\x20VALUES(?,?,?,?,?)','language','getBookListByPath','getBookIndexByFileName','orderType','exist','check_time','getBookListCount','bookList','bookIndexId','.jpg','need\x20bookIndexId/bookListId','getGroupList','add','deleteFavorite','index\x20id\x20error','2682327aBNbEg','getBookListById','1177990MkmRnl','update','need\x20index\x20id','\x20order\x20by\x20f.artist_fl\x20','Router','/setBookType','need\x20bookIndexId','express','addBookToBookList','/addReadRecord','/operationBookListIndex','configJson','indexId','get','endsWith','error','substring','../../db/dbBookIndexTable','extname','getBookListList','push','is_admin','10qFozcU','removeBookList','book_filename','nfo写入失败','\x20path=?\x20\x20','favorite_time','type','log','UPDATE\x20book_read_record\x20SET\x20progress=?,read_time=?\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','getBookIndex','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','book\x20not\x20exist','progress','comicList','getPathByType',',f.title\x20','birthtime','search','bookListId\x20no\x20exists','end','/updateBookNfo','name','whereStr','username','power_delete','封面文件已不存在','nfo写入成功','封面文件已删除','../../db/dbBookListTable','SELECT\x20id\x20from\x20file_index_book\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','letterIndex','/bookFavorite','need\x20type/indexId','includes','title','length','\x20order\x20by\x20m.update_time\x20','fileExist','folderNotExist','operation','year','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_book\x20WHERE\x20path=?\x20and\x20is_file=1','body','../../utils/nfoUtil','parent','\x20is_file=1','lastIndexOf','exports','parse','path','coverData','../../db/dbFileIndexTable','NO\x20book\x20INDEX','SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid=?','query','listType','UPDATE\x20book_reader_config\x20SET\x20config_json=?\x20WHERE\x20uid=?','封面写入成功','saveBookNfo','config\x20json\x20format\x20error'];_0x32d4=function(){return _0x50dac1;};return _0x32d4();}router[_0x46d84e(0x103)]('/getHomeData',(_0x2171c4,_0x2c7c7,_0x5e4130)=>{const _0x4579d6=_0x46d84e;let _0x3669b7=_0x2171c4[_0x4579d6(0xd6)][_0x4579d6(0x100)]?_0x2171c4[_0x4579d6(0xd6)][_0x4579d6(0x100)]:0xc,_0x314b05=_0x2171c4[_0x4579d6(0x12f)]['id'],_0x221717=dbUserTable['getUserPathWhere'](_0x2171c4,_0x4579d6(0x130),_0x4579d6(0x102),!![]);if(_0x2171c4[_0x4579d6(0x12f)][_0x4579d6(0x171)]!=0x1&&!_0x221717[_0x4579d6(0xc2)])return _0x2c7c7['json']({'code':0x0,'data':null});let _0x351ff8=[],_0x4872c9=_0x2171c4[_0x4579d6(0x124)]['dbFileIndex'][_0x4579d6(0x140)]('SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20ORDER\x20BY\x20read_time\x20desc\x20LIMIT\x20?')['all'](_0x314b05,_0x3669b7);for(let _0x20ef6d of _0x4872c9){let _0xafb337=dbBookIndexTable[_0x4579d6(0x14d)](_0x2171c4[_0x4579d6(0x124)]['dbFileIndex'],_0x20ef6d[_0x4579d6(0xf4)],_0x20ef6d[_0x4579d6(0x174)]);_0xafb337&&dbUserTable[_0x4579d6(0x13f)](_0x2171c4,_0x2c7c7,_0x4579d6(0x130),_0x4579d6(0x102),_0xafb337[_0x4579d6(0xdd)],!![])==!![]&&(_0xafb337[_0x4579d6(0xb8)]=_0x20ef6d[_0x4579d6(0xb8)],_0x351ff8['push'](_0xafb337));}setBookListProps(_0x2171c4,_0x351ff8)[_0x4579d6(0xea)](_0x2addfe=>{const _0xa86658=_0x4579d6;_0x351ff8=_0x2addfe,getListByParams(_0x2171c4,_0x221717,'list',_0x3669b7,0x0,'check_time',_0xa86658(0x12d),null,null,null,null,0x1)['then'](_0x18e2dc=>{const _0x85afce=_0xa86658;getListByParams(_0x2171c4,_0x221717,_0x85afce(0x133),_0x3669b7,0x0,_0x85afce(0x150),_0x85afce(0x12d),null,null,null,null,0x2)[_0x85afce(0xea)](_0x15721a=>{const _0x41faf1=_0x85afce;getListByParams(_0x2171c4,_0x221717,_0x41faf1(0x133),_0x3669b7,0x0,'id',_0x41faf1(0x12d))[_0x41faf1(0xea)](_0x4d3049=>{const _0x10c72f=_0x41faf1;let _0x2586ad={};return _0x351ff8&&_0x351ff8[_0x10c72f(0xcf)]>0x0&&(_0x2586ad['recentReadList']=_0x351ff8),_0x4d3049&&_0x4d3049[_0x10c72f(0xcf)]>0x0&&(_0x2586ad[_0x10c72f(0x131)]=_0x4d3049),_0x18e2dc&&_0x18e2dc[_0x10c72f(0xcf)]>0x0&&(_0x2586ad[_0x10c72f(0x152)]=_0x18e2dc),_0x15721a&&_0x15721a[_0x10c72f(0xcf)]>0x0&&(_0x2586ad[_0x10c72f(0xb9)]=_0x15721a),_0x2c7c7[_0x10c72f(0xfc)]({'code':0x0,'data':_0x2586ad,'platform':os['platform']()});});});});});}),router['post'](_0x46d84e(0x147),(_0x45b3a3,_0x1c5f50,_0x14a5e2)=>{const _0x3e2168=_0x46d84e;let _0x3c297d=_0x45b3a3[_0x3e2168(0xd6)]['count']||0x32,_0x174119=_0x45b3a3[_0x3e2168(0xd6)][_0x3e2168(0x138)]||0x0,_0x25025c=_0x45b3a3[_0x3e2168(0xd6)][_0x3e2168(0x108)],_0x358041=_0x45b3a3[_0x3e2168(0xd6)]['orderField']||_0x3e2168(0x150),_0x486736=_0x45b3a3[_0x3e2168(0xd6)][_0x3e2168(0x14e)]||_0x3e2168(0x12d),_0x485e4b=[_0x3e2168(0x133),'favorite',_0x3e2168(0x152)],_0x160d15=_0x45b3a3[_0x3e2168(0xd6)][_0x3e2168(0xe3)]||_0x3e2168(0x133),_0x4107e2=_0x45b3a3[_0x3e2168(0xd6)][_0x3e2168(0xbd)],_0x38679f=_0x45b3a3[_0x3e2168(0xd6)][_0x3e2168(0xca)],_0x3e2f5f=_0x45b3a3[_0x3e2168(0xd6)][_0x3e2168(0x137)],_0x9942f7=_0x45b3a3[_0x3e2168(0xd6)][_0x3e2168(0x178)];if(dbBookIndexTable['checkOrderParams'](_0x45b3a3,_0x1c5f50,_0x358041,_0x486736)!==!![])return;if(_0x160d15==_0x3e2168(0x152)){if(!_0x3e2f5f)return _0x45b3a3[_0x3e2168(0x124)][_0x3e2168(0x128)](_0x1c5f50,'need\x20bookListId');}!_0x485e4b['includes'](_0x160d15)&&(_0x160d15='list');_0x3c297d>0x1f4&&(_0x3c297d=0x1f4);let _0x4e9d5e=dbUserTable[_0x3e2168(0x12e)](_0x45b3a3,'book','power_get',!![]);if(_0x45b3a3[_0x3e2168(0x12f)][_0x3e2168(0x171)]!=0x1&&!_0x4e9d5e[_0x3e2168(0xc2)])return _0x1c5f50['json']({'code':0x0,'data':null});getListByParams(_0x45b3a3,_0x4e9d5e,_0x160d15,_0x3c297d,_0x174119,_0x358041,_0x486736,_0x25025c,_0x4107e2,_0x3e2f5f,_0x38679f,_0x9942f7)['then'](_0x327254=>{const _0x2bc041=_0x3e2168;let _0x2d1979={'code':0x0,'data':_0x327254};if(_0x160d15==_0x2bc041(0xf1))_0x2d1979[_0x2bc041(0xfe)]=dbBookFavorite[_0x2bc041(0x111)](_0x45b3a3[_0x2bc041(0x124)][_0x2bc041(0x145)],_0x45b3a3[_0x2bc041(0x12f)]['id']);else{if(_0x160d15==_0x2bc041(0x133))_0x2d1979[_0x2bc041(0xfe)]=dbBookIndexTable[_0x2bc041(0x151)](_0x45b3a3['app'][_0x2bc041(0x145)],_0x4e9d5e,_0x25025c,_0x4107e2,_0x9942f7);else _0x160d15=='bookList'&&(_0x2d1979[_0x2bc041(0xfe)]=dbBookListTable[_0x2bc041(0x10c)](_0x45b3a3[_0x2bc041(0x124)][_0x2bc041(0x145)],_0x3e2f5f));}return _0x1c5f50[_0x2bc041(0xfc)](_0x2d1979);});}),router[_0x46d84e(0x103)]('/getBookDetail',(_0x4c0347,_0xe5de7f,_0x51abc2)=>{const _0x4a4de9=_0x46d84e;let _0x1484ba=_0x4c0347[_0x4a4de9(0xd6)]['id'],_0x4a4795=dbFileIndexTable['getById'](_0x4c0347[_0x4a4de9(0x124)][_0x4a4de9(0x145)],_0x1484ba,dbFileIndexTable[_0x4a4de9(0xec)]);if(!_0x4a4795)return _0x4c0347[_0x4a4de9(0x124)]['returnErrMsg'](_0xe5de7f,_0x4a4de9(0xe0));if(dbUserTable[_0x4a4de9(0x13f)](_0x4c0347,_0xe5de7f,_0x4a4de9(0x130),_0x4a4de9(0x102),_0x4a4795[_0x4a4de9(0xdd)])==!![]){let _0x11be83=_0x4c0347['currentUser']['id'],_0x2704ee=dbBookFavorite['getFavorite'](_0x4c0347[_0x4a4de9(0x124)][_0x4a4de9(0x145)],_0x11be83,_0x1484ba);_0x4a4795[_0x4a4de9(0xf1)]=_0x2704ee?0x1:0x0,_0x4a4795[_0x4a4de9(0x11d)]=path[_0x4a4de9(0x11f)](_0x4a4795['path'],_0x4a4795[_0x4a4de9(0x142)]);let _0x51d090=dbBookIndexTable[_0x4a4de9(0x14c)](_0x4c0347['app'][_0x4a4de9(0x145)],_0x4a4795[_0x4a4de9(0xdd)]);_0x51d090[_0x4a4de9(0xcf)]>0x0?(_0x51d090=arrayUtil['sortFileNamesByNumber'](_0x51d090,'filename'),setBookListProps(_0x4c0347,_0x51d090)[_0x4a4de9(0xea)](_0x6d4b1=>{_0x51d090=_0x6d4b1,_0x147bc9();})):_0x147bc9;function _0x147bc9(){const _0x6dd2ec=_0x4a4de9;let _0x41d868={'code':0x0,'data':_0x4a4795,'sameFolderBookList':_0x51d090};getBookSameNameCover(_0x4a4795)[_0x6dd2ec(0xea)](_0x3cee8e=>{const _0x4ad503=_0x6dd2ec;_0x4a4795[_0x4ad503(0x13c)]=_0x3cee8e;let _0x4e5829=_0x4c0347[_0x4ad503(0x124)][_0x4ad503(0x145)][_0x4ad503(0x140)](_0x4ad503(0x149))[_0x4ad503(0x169)](_0x11be83,path[_0x4ad503(0x11f)](_0x4a4795[_0x4ad503(0xdd)],_0x4a4795[_0x4ad503(0x142)]),_0x4a4795[_0x4ad503(0x12b)]);_0x4e5829&&(_0x41d868[_0x4ad503(0xb8)]=_0x4e5829['progress']),_0x41d868[_0x4ad503(0xd1)]=fs['stat'](_0x4a4795['filePath'],(_0x2cf272,_0x372833)=>{const _0x5e8515=_0x4ad503;return _0x2cf272?_0x41d868[_0x5e8515(0x14f)]=0x0:_0x41d868['exist']=0x1,_0xe5de7f['json'](_0x41d868);});});}}}),router[_0x46d84e(0x103)](_0x46d84e(0xcb),(_0x42e6cc,_0x1d1f52,_0x58793f)=>{const _0x39d504=_0x46d84e;let _0x57bff1=_0x42e6cc[_0x39d504(0x12f)]['id'];function _0x5f0919(_0x1a71b8){const _0xec9e40=_0x39d504;let _0x8c70fb=dbFileIndexTable[_0xec9e40(0xfa)](_0x42e6cc[_0xec9e40(0x124)][_0xec9e40(0x145)],_0x1a71b8,dbFileIndexTable[_0xec9e40(0xec)]);if(!_0x8c70fb)return;let _0x335f12=new Date()[_0xec9e40(0xf3)]();_0x42e6cc['app'][_0xec9e40(0x145)][_0xec9e40(0x140)]('UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?')[_0xec9e40(0xfd)](_0x335f12,_0x1a71b8),dbBookFavorite['addFavorite'](_0x42e6cc[_0xec9e40(0x124)][_0xec9e40(0x145)],_0x57bff1,_0x1a71b8);}if(_0x42e6cc[_0x39d504(0xd6)][_0x39d504(0x168)]instanceof Array){let _0x4fa1d2=_0x42e6cc[_0x39d504(0xd6)][_0x39d504(0xd3)];if(_0x4fa1d2==_0x39d504(0x157))for(let _0x55677a of _0x42e6cc['body']['indexId']){_0x5f0919(_0x55677a);}else{if(_0x4fa1d2==_0x39d504(0x136))for(let _0x3808ad of _0x42e6cc[_0x39d504(0xd6)][_0x39d504(0x168)]){dbBookFavorite[_0x39d504(0x158)](_0x42e6cc['app'][_0x39d504(0x145)],_0x57bff1,_0x3808ad);}}return _0x1d1f52['json']({'code':0x0});}else{let _0x2fbd46=parseInt(_0x42e6cc[_0x39d504(0xd6)][_0x39d504(0x168)]),_0x1f4abe=dbBookFavorite['getFavorite'](_0x42e6cc['app'][_0x39d504(0x145)],_0x57bff1,_0x2fbd46),_0x55e3b9=0x0;return _0x1f4abe?dbBookFavorite[_0x39d504(0x158)](_0x42e6cc[_0x39d504(0x124)]['dbFileIndex'],_0x57bff1,_0x2fbd46):(_0x55e3b9=0x1,_0x5f0919(_0x2fbd46)),_0x1d1f52[_0x39d504(0xfc)]({'code':0x0,'favorite':_0x55e3b9});}}),router[_0x46d84e(0x169)]('/getBookCover',(_0x58eaf5,_0x3f367e,_0x6ccfb8)=>{const _0x2f0d99=_0x46d84e;let _0x5224c0=_0x58eaf5[_0x2f0d99(0xe2)][_0x2f0d99(0x168)],_0x3ec0bf=dbBookIndexTable[_0x2f0d99(0xb5)](_0x58eaf5[_0x2f0d99(0x124)][_0x2f0d99(0x145)],_0x5224c0),_0x4ba4af=_0x58eaf5['query']['size'];!_0x4ba4af&&(_0x4ba4af=0x200);if(!_0x3ec0bf||_0x3ec0bf&&!_0x3ec0bf[_0x2f0d99(0xf5)])return _0x3f367e[_0x2f0d99(0xf6)](0x194)[_0x2f0d99(0xbf)]();dbUserTable[_0x2f0d99(0x13f)](_0x58eaf5,_0x3f367e,_0x2f0d99(0x130),_0x2f0d99(0x102),_0x3ec0bf[_0x2f0d99(0xdd)])==!![]&&fs[_0x2f0d99(0x10a)](_0x3ec0bf[_0x2f0d99(0xf5)],(_0x14f005,_0x4d5a06)=>{const _0x55902c=_0x2f0d99;if(_0x14f005){let _0x1fbfb3=config[_0x55902c(0xf8)](_0x3ec0bf);bookIndexUtil[_0x55902c(0x13b)](_0x3ec0bf,_0x1fbfb3)[_0x55902c(0xea)](_0x52ab6b=>{const _0x515f56=_0x55902c;if(_0x52ab6b[_0x515f56(0xde)])bookIndexUtil['sharpWriteCover'](_0x52ab6b['coverData'],_0x1fbfb3)['then'](_0x4f0130=>{const _0x8f5368=_0x515f56;return console['log'](_0x8f5368(0xe5),_0x4f0130),_0x3f367e['sendFile'](_0x4f0130);})[_0x515f56(0x13a)](_0x283f2c=>{const _0x51efa3=_0x515f56;return _0x3f367e['status'](0x194)[_0x51efa3(0xbf)]();});else return _0x3f367e[_0x515f56(0xf6)](0x194)[_0x515f56(0xbf)]();})['catch'](_0x23f0ad=>{const _0x4af012=_0x55902c;return _0x3f367e[_0x4af012(0xf6)](0x194)[_0x4af012(0xbf)]();});}else return _0x3f367e[_0x55902c(0x127)](_0x3ec0bf[_0x55902c(0xf5)]);});}),router[_0x46d84e(0x103)]('/getGroupList',(_0x4c67da,_0x22510c,_0x2149dd)=>{const _0xde455b=_0x46d84e;let _0x209aa7=_0x4c67da['body'][_0xde455b(0x100)]||0x32,_0x5b8884=_0x4c67da[_0xde455b(0xd6)]['offset']||0x0,_0x26df26=_0x4c67da[_0xde455b(0xd6)][_0xde455b(0x135)]||_0xde455b(0x152),_0x57af20=_0x4c67da[_0xde455b(0xd6)][_0xde455b(0x104)]||_0xde455b(0x150),_0x48c4a7=_0x4c67da[_0xde455b(0xd6)]['orderType']||_0xde455b(0x12d),_0x3c36cf=_0x4c67da[_0xde455b(0xd6)][_0xde455b(0xbd)],_0x45d491=_0x4c67da['body'][_0xde455b(0xca)];if(dbBookIndexTable['checkOrderParams'](_0x4c67da,_0x22510c,_0x57af20,_0x48c4a7)!==!![])return;let _0x437a90=[_0xde455b(0x150),_0xde455b(0x134),'check_time','filename',_0xde455b(0xce),'artist',_0xde455b(0xbc),'id','publisher'],_0x3175bf=[_0xde455b(0x11c),'desc'];if(!_0x437a90[_0xde455b(0xcd)](_0x57af20)||!_0x3175bf[_0xde455b(0xcd)](_0x48c4a7))return _0x4c67da['app']['returnErrMsg'](_0x22510c,'orderField/orderType\x20error',_0x57af20,_0x48c4a7);let _0x1f83f0=dbUserTable[_0xde455b(0x12e)](_0x4c67da,_0xde455b(0x130),_0xde455b(0x102),!![]);if(_0x4c67da[_0xde455b(0x12f)][_0xde455b(0x171)]!=0x1&&!_0x1f83f0[_0xde455b(0xc2)]&&_0x26df26!=_0xde455b(0x152))return _0x22510c[_0xde455b(0xfc)]({'code':0x0,'data':null});let _0x4f9bda=[];if(_0x26df26==_0xde455b(0x108))_0x4f9bda=dbBookIndexTable[_0xde455b(0x156)](_0x4c67da['app'][_0xde455b(0x145)],_0x1f83f0,_0x26df26,_0x209aa7,_0x5b8884,_0x57af20,_0x48c4a7,_0x3c36cf,_0x45d491);else{if(_0x26df26==_0xde455b(0x152)){_0x4f9bda=dbBookListTable[_0xde455b(0x16f)](_0x4c67da[_0xde455b(0x124)][_0xde455b(0x145)],_0x4c67da[_0xde455b(0x12f)]['id'],_0x209aa7,_0x5b8884,'id',_0xde455b(0x12d),_0x3c36cf);for(let _0x44ec56 of _0x4f9bda){_0x44ec56[_0xde455b(0x113)]=dbBookIndexTable['getBooklistCover'](_0x4c67da['app']['dbFileIndex'],_0x44ec56['id']);}}}return _0x22510c[_0xde455b(0xfc)]({'code':0x0,'data':_0x4f9bda});}),router[_0x46d84e(0x103)](_0x46d84e(0x126),(_0x350f60,_0x565b5c,_0x1dc3f1)=>{const _0x216c7c=_0x46d84e;let _0x61f329=_0x350f60[_0x216c7c(0xd6)][_0x216c7c(0xc1)],_0x2de12e=_0x350f60[_0x216c7c(0xd6)][_0x216c7c(0xd3)];if(_0x2de12e=='add'){if(!_0x61f329)return _0x350f60[_0x216c7c(0x124)][_0x216c7c(0x128)](_0x565b5c,_0x216c7c(0x123));dbBookListTable[_0x216c7c(0xed)](_0x350f60[_0x216c7c(0x124)][_0x216c7c(0x145)],_0x350f60[_0x216c7c(0x12f)]['id'],_0x61f329);}else{if(_0x2de12e==_0x216c7c(0x10b)||_0x2de12e==_0x216c7c(0x136)){let _0x343c4e=_0x350f60[_0x216c7c(0xd6)][_0x216c7c(0x137)],_0x2d20f5=dbBookListTable[_0x216c7c(0x15b)](_0x350f60[_0x216c7c(0x124)][_0x216c7c(0x145)],_0x343c4e),_0x39ed46=![];(_0x350f60[_0x216c7c(0x12f)]['is_admin']==0x1||_0x2d20f5['uid']==_0x350f60['currentUser']['id'])&&(_0x39ed46=!![]);if(!_0x39ed46)return _0x565b5c[_0x216c7c(0xfc)]({'code':0x66});if(_0x2de12e==_0x216c7c(0x136))dbBookListTable[_0x216c7c(0x173)](_0x350f60['app'][_0x216c7c(0x145)],_0x343c4e);else{if(_0x2de12e=='edit'){if(!_0x61f329)return _0x350f60[_0x216c7c(0x124)][_0x216c7c(0x128)](_0x565b5c,'need\x20\x27name\x27');dbBookListTable['updateBookList'](_0x350f60[_0x216c7c(0x124)][_0x216c7c(0x145)],_0x343c4e,_0x61f329);}}}else return _0x350f60[_0x216c7c(0x124)][_0x216c7c(0x128)](_0x565b5c,_0x216c7c(0x110));}return _0x565b5c[_0x216c7c(0xfc)]({'code':0x0});}),router[_0x46d84e(0x103)](_0x46d84e(0x166),(_0x2cdcd5,_0x3dc487,_0x3615cd)=>{const _0x5cc74a=_0x46d84e;let _0x28168c=_0x2cdcd5['body']['bookIndexId'],_0x443a4d=_0x2cdcd5[_0x5cc74a(0xd6)][_0x5cc74a(0x137)];if(!_0x28168c||!_0x443a4d)return _0x2cdcd5[_0x5cc74a(0x124)][_0x5cc74a(0x128)](_0x3dc487,_0x5cc74a(0x155));let _0x356907=dbBookListTable[_0x5cc74a(0x15b)](_0x2cdcd5['app']['dbFileIndex'],_0x443a4d);if(!_0x356907)return _0x2cdcd5['app'][_0x5cc74a(0x128)](_0x3dc487,_0x5cc74a(0xbe));let _0x545968=_0x2cdcd5[_0x5cc74a(0xd6)]['operation'];if(_0x545968==_0x5cc74a(0x157)){function _0x57ab6d(_0x5cbf59){const _0x25245d=_0x5cc74a;let _0x1b0380=dbBookIndexTable['getBookIndex'](_0x2cdcd5[_0x25245d(0x124)][_0x25245d(0x145)],_0x5cbf59);if(!_0x1b0380)return;if(_0x1b0380[_0x25245d(0x11e)]==0x1){dbBookListTable[_0x25245d(0x164)](_0x2cdcd5['app']['dbFileIndex'],_0x5cbf59,_0x443a4d);let _0x375199=Date[_0x25245d(0x121)]();_0x2cdcd5[_0x25245d(0x124)][_0x25245d(0x145)][_0x25245d(0x140)](_0x25245d(0xf9))['run'](_0x375199,_0x1b0380['id']);}else{let _0x328871=path['join'](_0x1b0380[_0x25245d(0xdd)],_0x1b0380[_0x25245d(0x142)]),_0x3419ba=_0x2cdcd5[_0x25245d(0x124)][_0x25245d(0x145)][_0x25245d(0x140)](_0x25245d(0xc9))['all'](_0x328871,_0x328871+path[_0x25245d(0x101)]+'%');for(let _0xe49ffe of _0x3419ba){dbBookListTable['addBookToBookList'](_0x2cdcd5[_0x25245d(0x124)][_0x25245d(0x145)],_0xe49ffe['id'],_0x443a4d);}}}if(_0x28168c instanceof Array)for(let _0x45c653 of _0x28168c){_0x57ab6d(_0x45c653);}else _0x57ab6d(_0x28168c);}else{if(_0x545968==_0x5cc74a(0x136)){if(_0x28168c instanceof Array)for(let _0x30f90e of _0x28168c){dbBookListTable['removeBookFromList'](_0x2cdcd5[_0x5cc74a(0x124)][_0x5cc74a(0x145)],_0x30f90e,_0x443a4d);}else dbBookListTable['removeBookFromList'](_0x2cdcd5['app'][_0x5cc74a(0x145)],_0x28168c,_0x443a4d);}else return _0x2cdcd5['app'][_0x5cc74a(0x128)](_0x3dc487,'operation\x20error');}return _0x3dc487['json']({'code':0x0,'data':{}});}),router[_0x46d84e(0x103)](_0x46d84e(0x117),(_0x18fb25,_0x20999f,_0x20e045)=>{const _0x45ecc2=_0x46d84e;let _0x1dac29=_0x18fb25[_0x45ecc2(0xd6)][_0x45ecc2(0xd8)],_0x2e9678=_0x18fb25['body'][_0x45ecc2(0x10f)],_0x7cd75c='book';if(dbUserTable['doUserCanGet'](_0x18fb25,_0x20999f,_0x7cd75c,_0x45ecc2(0x102))==!![]){let _0x26e306=[];if(!_0x1dac29){let _0x404307=[];_0x18fb25[_0x45ecc2(0x12f)][_0x45ecc2(0x171)]==0x1?_0x404307=dbSourceFolderTable[_0x45ecc2(0xba)](_0x18fb25[_0x45ecc2(0x124)][_0x45ecc2(0xf2)],_0x7cd75c):_0x404307=dbUserTable['getUserPower'](_0x18fb25[_0x45ecc2(0x124)][_0x45ecc2(0xf2)],_0x18fb25[_0x45ecc2(0x12f)][_0x45ecc2(0xc3)],_0x7cd75c);if(_0x404307)for(let _0x245432=0x0;_0x245432<_0x404307[_0x45ecc2(0xcf)];_0x245432++){_0x26e306[_0x45ecc2(0x170)]({'path':_0x404307[_0x245432][_0x45ecc2(0xdd)],'is_file':0x0,'filename':path['basename'](_0x404307[_0x245432]['path']),'root':!![]});}}else{let _0x125bff=[];if(_0x18fb25[_0x45ecc2(0x12f)][_0x45ecc2(0x171)]!=0x1){if(dbUserTable[_0x45ecc2(0x13f)](_0x18fb25,_0x20999f,_0x7cd75c,_0x45ecc2(0x102),_0x1dac29)!==!![])return;}_0x1dac29=path[_0x45ecc2(0x11f)](_0x1dac29);let _0x36cfde=_0x45ecc2(0x176);_0x125bff[_0x45ecc2(0x170)](_0x1dac29);if(_0x2e9678){let _0x10ff86=_0x45ecc2(0x120);_0x36cfde+=_0x10ff86,_0x125bff[_0x45ecc2(0x170)]('%'+_0x2e9678+'%'),_0x125bff[_0x45ecc2(0x170)]('%'+_0x2e9678+'%');}let _0x331b34='\x20id,is_file,id,path,filename,type,size,title,artist,ext,cover_path,language,publisher,total_page,type,check_time,create_time';_0x26e306=_0x18fb25[_0x45ecc2(0x124)][_0x45ecc2(0x145)][_0x45ecc2(0x140)](_0x45ecc2(0x11a)+_0x331b34+_0x45ecc2(0xeb)+_0x36cfde)[_0x45ecc2(0x143)](_0x125bff);}for(let _0x5a9e28 of _0x26e306){if(_0x5a9e28[_0x45ecc2(0x11e)]==0x0){let _0x525e17=path[_0x45ecc2(0x11f)](_0x5a9e28[_0x45ecc2(0xdd)],_0x5a9e28[_0x45ecc2(0x142)]),_0x36fbe1=_0x18fb25[_0x45ecc2(0x124)]['dbFileIndex']['prepare'](_0x45ecc2(0xd5))['get'](_0x525e17);_0x5a9e28['fileCount']=_0x36fbe1[_0x45ecc2(0x100)];}}let _0x3d48b7=path[_0x45ecc2(0x101)],_0x2d4415={'code':0x0,'data':_0x26e306,'sep':_0x3d48b7};return _0x20999f[_0x45ecc2(0xfc)](_0x2d4415);}}),router[_0x46d84e(0x103)](_0x46d84e(0xc0),(_0x5abf54,_0x11e6cd,_0x5821d6)=>{const _0x5cf385=_0x46d84e;let _0x56b45e=_0x5abf54[_0x5cf385(0xd6)][_0x5cf385(0x153)],_0x1169f3=_0x5abf54[_0x5cf385(0xd6)][_0x5cf385(0xd3)];if(!_0x56b45e)return _0x5abf54[_0x5cf385(0x124)][_0x5cf385(0x128)](_0x11e6cd,_0x5cf385(0x15e));let _0x580007=dbBookIndexTable[_0x5cf385(0xb5)](_0x5abf54[_0x5cf385(0x124)]['dbFileIndex'],_0x56b45e);if(!_0x580007)return _0x5abf54['app'][_0x5cf385(0x128)](_0x11e6cd,_0x5cf385(0x159));if(_0x1169f3==_0x5cf385(0x15d)){let _0x241bff={'title':_0x5abf54['body'][_0x5cf385(0xce)],'publish_date':_0x5abf54['body'][_0x5cf385(0x122)],'year':_0x5abf54[_0x5cf385(0xd6)][_0x5cf385(0xd4)],'isbn':_0x5abf54[_0x5cf385(0xd6)]['isbn'],'language':_0x5abf54[_0x5cf385(0xd6)][_0x5cf385(0x14b)],'genre':_0x5abf54[_0x5cf385(0xd6)][_0x5cf385(0x141)],'tag':_0x5abf54[_0x5cf385(0xd6)][_0x5cf385(0xe8)],'publisher':_0x5abf54[_0x5cf385(0xd6)]['publisher'],'artist':_0x5abf54[_0x5cf385(0xd6)][_0x5cf385(0x108)],'introduction':_0x5abf54['body']['introduction']},_0x21c393=path['join'](_0x580007[_0x5cf385(0xdd)],_0x580007[_0x5cf385(0x142)]);fs['stat'](_0x21c393,(_0x59b16f,_0x53977f)=>{const _0x34b813=_0x5cf385;if(_0x59b16f)return _0x5abf54[_0x34b813(0x124)][_0x34b813(0x128)](_0x11e6cd,_0x11e6cd['__'](_0x34b813(0xd2))+_0x21c393);let _0x15d5d0=_0x21c393['substring'](0x0,_0x21c393['lastIndexOf']('.'))+_0x34b813(0xf0);nfoUtil[_0x34b813(0xe6)](_0x241bff,_0x15d5d0)[_0x34b813(0xea)](()=>{const _0x4f5554=_0x34b813;console['log'](_0x4f5554(0xc6)),dbBookIndexTable['updateBook'](_0x5abf54[_0x4f5554(0x124)]['dbFileIndex'],_0x56b45e,_0x241bff),_0x580007=dbBookIndexTable[_0x4f5554(0xb5)](_0x5abf54[_0x4f5554(0x124)][_0x4f5554(0x145)],_0x56b45e),setBookListProps(_0x5abf54,[_0x580007])[_0x4f5554(0xea)](_0x218928=>{const _0x57e23f=_0x4f5554;return _0x11e6cd[_0x57e23f(0xfc)]({'code':0x0,'data':_0x218928[0x0]});});})[_0x34b813(0x13a)](_0x140869=>{const _0x8c5120=_0x34b813;return console['log'](_0x8c5120(0x175),_0x140869),_0x5abf54[_0x8c5120(0x124)]['returnErrMsg'](_0x11e6cd,_0x8c5120(0x16b));});});}else{if(_0x1169f3=='delete'){let _0x3d4274=path[_0x5cf385(0x11f)](_0x580007[_0x5cf385(0xdd)],_0x580007['filename']),_0x53111c=_0x3d4274[_0x5cf385(0x16c)](0x0,_0x3d4274[_0x5cf385(0xda)]('.'))+_0x5cf385(0xf0);fs[_0x5cf385(0x10a)](_0x53111c,(_0x4b7def,_0x31c804)=>{const _0xff9b49=_0x5cf385;if(_0x4b7def)return _0x5abf54['app'][_0xff9b49(0x128)](_0x11e6cd,_0x11e6cd['__']('folderNotExist')+_0x53111c);fs['rm'](_0x53111c,_0x3a2928=>{const _0x56a74f=_0xff9b49;if(_0x3a2928)return _0x5abf54['app'][_0x56a74f(0x128)](_0x11e6cd,_0x11e6cd['__'](_0x56a74f(0x112))+_0x53111c);return dbBookIndexTable[_0x56a74f(0x132)](_0x5abf54['app'][_0x56a74f(0x145)],indexId,{}),_0x11e6cd['json']({'code':0x0});});});}else return _0x5abf54['app'][_0x5cf385(0x128)](_0x11e6cd,'operation\x20error');}}),module[_0x46d84e(0xdb)]=router;