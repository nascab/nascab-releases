const _0x5c4b85=_0x307f;function _0x4d64(){const _0x1755e3=['count',',f.artist\x20','getTime','json','/getBookList','introduction','removeBookFromList','.nfo','type','../../myWorkers/index/bookIndexUtil','includes','edit','updateBook','progress','end','sortFileNamesByNumber','NO\x20book\x20INDEX','782308kYCRxa','post','basename','year','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20ORDER\x20BY\x20read_time\x20desc\x20LIMIT\x20?','.jpg','language','listType','exist','\x20FROM\x20file_index_book\x20WHERE\x20','dbFileIndex','getBooklistCover','file_cover_path','INDEX_TABLE_NAME_BOOK','folderNotExist','1732192CMOspY','doUserCanGet','status','/setBookType','operation','/getReadRecord','bookList','getBookListById','18550dlZdzD',',f.filename_fl\x20','letterIndex','publisher','nfo写入成功','book','need\x20bookIndexId','SELECT\x20','tag','bookListId','cover\x20format\x20error','exports','/getBookIndexFileTree','search','config\x20json\x20format\x20error','extname','book_count','power_get','checkOrderParams','index\x20id\x20error','../../db/dbBookListTable','getBookListByPath','error','3sQsiBi','orderField/orderType\x20error','length','4sroBYa','/updateBookNfo','genre','asc','favorite','\x20id,is_file,id,path,filename,type,size,title,artist,ext,cover_path,language,publisher,total_page,type,check_time,create_time','getUserPathWhere','list','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_size=?','封面写入成功','UPDATE\x20book_reader_config\x20SET\x20remark=?\x20WHERE\x20uid=?','get','SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid=?','getBookIndex','groupField','/operationBookList','existsSync','nfo写入失败','/getBookCover','operation\x20error','saveBookNfo','../../utils/nfoUtil','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_book\x20WHERE\x20path=?\x20and\x20is_file=1','check_time','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','\x20is_file=1','book_filename','SELECT\x20id\x20from\x20file_index_book\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','/operationBookListIndex','then','all','log','getBookListBookCount','recentReadList','addFavorite','../../db/dbBookFavorite','removeBookList','bookIsFavorite','substring','app','book_path','fileName','need\x20bookIndexId/bookListId','cover_path','addBookToBookList','deleteFavorite','bookIndexId','artist','desc','9jzaPXO','getGroupList','play_count','is_admin','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20OR\x20artist\x20like\x20?\x20OR\x20tag\x20like\x20?\x20OR\x20publisher\x20like\x20?\x20OR\x20isbn\x20like\x20?\x20OR\x20genre\x20like\x20?\x20OR\x20year\x20like\x20?)','getAllFavoriteByWhere','/addReadRecord','filename','parse','currentUser','is_file','getBookList','push','cover','need\x20index\x20id','title','endsWith','getBookIndexByFileName','publish_date','getById','orderField','\x20order\x20by\x20m.update_time\x20','270496DAtSbY','need\x20config\x20json','whereStr','offset','path','dbOther','birthtime','486350NwoEZF','configJson','\x20order\x20by\x20m.update_time\x20DESC\x20','createBookList','封面文件已删除','deleteFail','33168BhCxcX','searchStr','\x20LIMIT\x20?\x20OFFSET\x20?\x20','/getBookDetail','lastIndexOf','comicList','22019bdVcMP','bookListId\x20no\x20exists','\x20order\x20by\x20f.artist_fl\x20','uid','platform','../../db/dbFileIndexTable','215QkdUWk','../../db/dbSourceFolderTable','add','UPDATE\x20book_reader_config\x20SET\x20config_json=?\x20WHERE\x20uid=?','stat','join','getMediaCoverCachePath','replace','\x20path=?\x20\x20','updateByFiled','favorite_time','/setReaderConfig','runGetBookInfoWorker','recentAddList','returnErrMsg','book\x20not\x20exist','\x20order\x20by\x20f.title_fl\x20','now','getFavoriteCount','need\x20\x27name\x27','../../db/dbBookIndexTable','catch','fileExist','remark','getFavorite','need\x20bookListId','sep','indexId','query','UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?','filePath','prepare','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','body','power_delete','run','delete'];_0x4d64=function(){return _0x1755e3;};return _0x4d64();}(function(_0x7a6b1e,_0x176497){const _0x4d0240=_0x307f,_0x3d7a14=_0x7a6b1e();while(!![]){try{const _0x4588cf=parseInt(_0x4d0240(0x184))/0x1*(-parseInt(_0x4d0240(0x12a))/0x2)+-parseInt(_0x4d0240(0x127))/0x3*(-parseInt(_0x4d0240(0x1c0))/0x4)+parseInt(_0x4d0240(0x18a))/0x5*(parseInt(_0x4d0240(0x17e))/0x6)+-parseInt(_0x4d0240(0x110))/0x7+-parseInt(_0x4d0240(0x171))/0x8+-parseInt(_0x4d0240(0x15b))/0x9*(parseInt(_0x4d0240(0x178))/0xa)+-parseInt(_0x4d0240(0x108))/0xb;if(_0x4588cf===_0x176497)break;else _0x3d7a14['push'](_0x3d7a14['shift']());}catch(_0x333458){_0x3d7a14['push'](_0x3d7a14['shift']());}}}(_0x4d64,0x23cf2));function _0x307f(_0x3cda6f,_0x4aad2e){const _0x4d6466=_0x4d64();return _0x307f=function(_0x307fd2,_0x2870df){_0x307fd2=_0x307fd2-0xfc;let _0x5e7ce5=_0x4d6466[_0x307fd2];return _0x5e7ce5;},_0x307f(_0x3cda6f,_0x4aad2e);}let express=require('express'),router=express['Router'](),path=require('path'),fs=require('fs'),dbBookIndexTable=require(_0x5c4b85(0x19e)),dbFileIndexTable=require(_0x5c4b85(0x189)),dbBookListTable=require(_0x5c4b85(0x124)),dbBookFavorite=require(_0x5c4b85(0x14d));const dbUserTable=require('../../db/dbUserTable'),dbSourceFolderTable=require(_0x5c4b85(0x18b));let os=require('os'),config=require('../../myConfig/config');const bookIndexUtil=require(_0x5c4b85(0x1b8)),arrayUtil=require('../../utils/arrayUtil'),nfoUtil=require(_0x5c4b85(0x13f));function getBookSameNameCover(_0x49f25d){return new Promise((_0x51be13,_0x24cd67)=>{const _0x469d14=_0x307f;try{let _0x7e60f3=_0x49f25d[_0x469d14(0x162)][_0x469d14(0x191)](path[_0x469d14(0x11f)](_0x49f25d['filename']),''),_0x175052=path['join'](_0x49f25d['path'],_0x7e60f3+_0x469d14(0xfe)),_0x394263='';fs[_0x469d14(0x13a)](_0x175052)&&(_0x394263=_0x175052),_0x51be13(_0x394263);}catch(_0xa4328d){_0x51be13('');}});}router[_0x5c4b85(0x1c1)](_0x5c4b85(0x195),(_0x4768b3,_0x2c1566,_0x47716)=>{const _0x7188e0=_0x5c4b85;let _0x2649c4=_0x4768b3[_0x7188e0(0x164)]['id'],_0x8bb9b0=_0x4768b3[_0x7188e0(0x1ab)][_0x7188e0(0x179)],_0x58fe64=_0x4768b3[_0x7188e0(0x1ab)][_0x7188e0(0x1a1)];if(!_0x8bb9b0&&!_0x58fe64)return _0x4768b3[_0x7188e0(0x151)]['returnErrMsg'](_0x2c1566,_0x7188e0(0x172));try{JSON[_0x7188e0(0x163)](_0x8bb9b0);}catch(_0x5d115c){return _0x4768b3[_0x7188e0(0x151)][_0x7188e0(0x198)](_0x2c1566,_0x7188e0(0x11e));}let _0x28bc2e=_0x4768b3[_0x7188e0(0x151)]['dbOther'][_0x7188e0(0x1a9)](_0x7188e0(0x136))[_0x7188e0(0x135)](_0x2649c4);if(_0x28bc2e){if(_0x8bb9b0)_0x4768b3[_0x7188e0(0x151)]['dbOther'][_0x7188e0(0x1a9)](_0x7188e0(0x18d))[_0x7188e0(0x1ad)](_0x8bb9b0,_0x2649c4);else _0x58fe64&&_0x4768b3['app']['dbOther'][_0x7188e0(0x1a9)](_0x7188e0(0x134))[_0x7188e0(0x1ad)](_0x58fe64,_0x2649c4);}else _0x4768b3[_0x7188e0(0x151)][_0x7188e0(0x176)]['prepare']('REPLACE\x20INTO\x20book_reader_config\x20(uid,config_json,remark)\x20VALUES(?,?,?)')[_0x7188e0(0x1ad)](_0x2649c4,_0x8bb9b0,_0x58fe64);return _0x2c1566['json']({'code':0x0});}),router[_0x5c4b85(0x1c1)]('/deleteSameNameCover',(_0x35f59c,_0xfbe2a9,_0x54151b)=>{const _0x2f28b2=_0x5c4b85;let _0x4d5596=_0x35f59c[_0x2f28b2(0x164)]['id'],_0x424ba4=_0x35f59c[_0x2f28b2(0x1ab)][_0x2f28b2(0x158)];if(!_0x424ba4)return _0x35f59c[_0x2f28b2(0x151)][_0x2f28b2(0x198)](_0xfbe2a9,_0x2f28b2(0x116));let _0x365caa=dbFileIndexTable[_0x2f28b2(0x16e)](_0x35f59c[_0x2f28b2(0x151)][_0x2f28b2(0x103)],_0x424ba4,dbFileIndexTable[_0x2f28b2(0x106)]);if(!_0x365caa)return _0x35f59c[_0x2f28b2(0x151)]['returnErrMsg'](_0xfbe2a9,_0x2f28b2(0x116));dbUserTable[_0x2f28b2(0x109)](_0x35f59c,_0xfbe2a9,'',_0x2f28b2(0x1ac),_0x365caa[_0x2f28b2(0x175)])==!![]&&getBookSameNameCover(_0x365caa)['then'](_0x4580af=>{const _0x2cd55f=_0x2f28b2;if(!_0x4580af[_0x2cd55f(0x16b)](_0x2cd55f(0xfe)))return _0x35f59c['app'][_0x2cd55f(0x198)](_0xfbe2a9,_0x2cd55f(0x11a));fs['stat'](_0x4580af,(_0x2d38d1,_0x12f400)=>{const _0x4cc220=_0x2cd55f;if(_0x2d38d1)return console['log']('封面文件已不存在'),_0xfbe2a9[_0x4cc220(0x1b2)]({'code':0x0});fs['rm'](_0x4580af,_0x16267b=>{const _0x20a1ee=_0x4cc220;if(_0x16267b)return _0x35f59c['app'][_0x20a1ee(0x198)](_0xfbe2a9,_0xfbe2a9['__'](_0x20a1ee(0x17d))+_0x4580af);return console[_0x20a1ee(0x149)](_0x20a1ee(0x17c),_0x4580af),_0xfbe2a9[_0x20a1ee(0x1b2)]({'code':0x0});});});});}),router['post']('/refreshCheckTime',(_0x4874a1,_0x227f17,_0x2ea0a8)=>{const _0x1ea2dd=_0x5c4b85;let _0x3beebb=_0x4874a1[_0x1ea2dd(0x164)]['id'],_0x4c32d5=_0x4874a1[_0x1ea2dd(0x1ab)][_0x1ea2dd(0x158)];if(!_0x4c32d5)return _0x227f17[_0x1ea2dd(0x10a)](0x194)[_0x1ea2dd(0x1bd)]();return dbBookIndexTable[_0x1ea2dd(0x193)](_0x4874a1[_0x1ea2dd(0x151)][_0x1ea2dd(0x103)],_0x4c32d5,_0x1ea2dd(0x141),new Date()[_0x1ea2dd(0x1b1)]()),_0x227f17['json']({'code':0x0});}),router['post'](_0x5c4b85(0x161),(_0x5010d2,_0x152a68,_0x4773de)=>{const _0x191a9d=_0x5c4b85;let _0x50cc9b=_0x5010d2[_0x191a9d(0x164)]['id'];if(!_0x5010d2[_0x191a9d(0x1ab)][_0x191a9d(0x153)]||!_0x5010d2['body'][_0x191a9d(0x1a8)]||!_0x5010d2[_0x191a9d(0x1ab)][_0x191a9d(0x1bc)])return _0x152a68['json']({'code':0x0});let _0x4e6f66=_0x5010d2[_0x191a9d(0x1ab)][_0x191a9d(0x153)];_0x4e6f66=path[_0x191a9d(0x1c2)](_0x5010d2[_0x191a9d(0x1ab)]['fileName']);let _0x38d830=path['join'](_0x5010d2[_0x191a9d(0x1ab)]['filePath']),_0x1f0161=_0x5010d2[_0x191a9d(0x1ab)][_0x191a9d(0x1bc)],_0x3c83a6=_0x5010d2[_0x191a9d(0x151)][_0x191a9d(0x103)]['prepare'](_0x191a9d(0x142))[_0x191a9d(0x135)](_0x50cc9b,_0x4e6f66,_0x38d830);return _0x3c83a6?_0x5010d2['app']['dbFileIndex'][_0x191a9d(0x1a9)]('UPDATE\x20book_read_record\x20SET\x20progress=?,read_time=?\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?')[_0x191a9d(0x1ad)](_0x1f0161,Date[_0x191a9d(0x19b)](),_0x50cc9b,_0x4e6f66,_0x38d830):_0x5010d2[_0x191a9d(0x151)][_0x191a9d(0x103)][_0x191a9d(0x1a9)]('REPLACE\x20INTO\x20book_read_record\x20(uid,book_filename,book_path,progress,read_time)\x20VALUES(?,?,?,?,?)')[_0x191a9d(0x1ad)](_0x50cc9b,_0x4e6f66,_0x38d830,_0x1f0161,Date[_0x191a9d(0x19b)]()),_0x152a68[_0x191a9d(0x1b2)]({'code':0x0});}),router[_0x5c4b85(0x1c1)](_0x5c4b85(0x10d),(_0x3dcca5,_0x3149cf,_0x59f321)=>{const _0x4c8248=_0x5c4b85;let _0x3c74af=_0x3dcca5[_0x4c8248(0x164)]['id'],_0x307793=_0x3dcca5[_0x4c8248(0x151)][_0x4c8248(0x176)][_0x4c8248(0x1a9)]('SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid\x20=\x20?')[_0x4c8248(0x135)](_0x3c74af),_0x54c49f=0x0,_0x3b790b=_0x3dcca5[_0x4c8248(0x1ab)][_0x4c8248(0x153)],_0x38921f=_0x3dcca5[_0x4c8248(0x1ab)]['filePath'];if(_0x3b790b&&_0x38921f){_0x38921f=path[_0x4c8248(0x18f)](_0x38921f+'');let _0x26a2db=_0x3dcca5[_0x4c8248(0x151)]['dbFileIndex'][_0x4c8248(0x1a9)](_0x4c8248(0x142))[_0x4c8248(0x135)](_0x3c74af,_0x3b790b,_0x38921f);_0x26a2db&&(_0x54c49f=_0x26a2db[_0x4c8248(0x1bc)]);}return _0x3149cf['json']({'code':0x0,'progress':_0x54c49f,'readerConfig':_0x307793});}),router[_0x5c4b85(0x1c1)](_0x5c4b85(0x10b),(_0x5641bb,_0x1480b4,_0x589914)=>{const _0x231dc4=_0x5c4b85;let _0xee81dc=_0x5641bb['body'][_0x231dc4(0x1a5)],_0x31a4bf=_0x5641bb[_0x231dc4(0x1ab)][_0x231dc4(0x1b7)];if(!_0x31a4bf||!_0xee81dc)return _0x5641bb['app'][_0x231dc4(0x198)](_0x1480b4,'need\x20type/indexId');if(_0x31a4bf!=0x1&&_0x31a4bf!=0x2)return _0x5641bb[_0x231dc4(0x151)]['returnErrMsg'](_0x1480b4,'need\x20type');let _0x1f8291=dbBookIndexTable[_0x231dc4(0x137)](_0x5641bb[_0x231dc4(0x151)][_0x231dc4(0x103)],_0xee81dc);if(!_0x1f8291)return _0x5641bb[_0x231dc4(0x151)][_0x231dc4(0x198)](_0x1480b4,_0x231dc4(0x199));if(dbUserTable[_0x231dc4(0x109)](_0x5641bb,_0x1480b4,'book','power_change',_0x1f8291[_0x231dc4(0x175)])==!![])return dbBookIndexTable[_0x231dc4(0x193)](_0x5641bb[_0x231dc4(0x151)][_0x231dc4(0x103)],_0xee81dc,'type',_0x31a4bf),_0x1480b4[_0x231dc4(0x1b2)]({'code':0x0});});function getListByParams(_0x582d9c,_0x27c64c,_0x281737,_0x4fe311,_0xb77962,_0xbad710,_0x9c7d83,_0x3e5c0f,_0x2233fe,_0x51b9c4,_0x2b5522,_0x154766){return new Promise((_0x3829ad,_0x4669d7)=>{const _0x4e2edd=_0x307f;let _0x2a40e3=_0x582d9c[_0x4e2edd(0x151)][_0x4e2edd(0x103)],_0x46c120=[];if(_0x281737=='list'||_0x281737==_0x4e2edd(0x10e))_0x46c120=dbBookIndexTable[_0x4e2edd(0x166)](_0x2a40e3,_0x27c64c,_0x4fe311,_0xb77962,_0xbad710,_0x9c7d83,_0x3e5c0f,_0x51b9c4,_0x2233fe,_0x2b5522,_0x154766);else{if(_0x281737==_0x4e2edd(0x12e)){let _0x5881dc='',_0x32f865=[];_0x5881dc+=_0x4e2edd(0x143);_0x2233fe&&(_0x2233fe=_0x2233fe[_0x4e2edd(0x191)]('\x27','')['replace']('’',''),_0x5881dc+=_0x4e2edd(0x15f),_0x32f865[_0x4e2edd(0x167)]('%'+_0x2233fe+'%','%'+_0x2233fe+'%','%'+_0x2233fe+'%','%'+_0x2233fe+'%','%'+_0x2233fe+'%','%'+_0x2233fe+'%','%'+_0x2233fe+'%','%'+_0x2233fe+'%'));_0x2b5522&&(_0x5881dc+='\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)',_0x32f865[_0x4e2edd(0x167)](_0x2b5522,_0x2b5522));if(_0xbad710&&_0x9c7d83){if(_0xbad710==_0x4e2edd(0x159))_0x5881dc+=_0x4e2edd(0x186)+_0x9c7d83+_0x4e2edd(0x1b0)+_0x9c7d83+'\x20';else{if(_0xbad710=='title')_0x5881dc+=_0x4e2edd(0x19a)+_0x9c7d83+',f.title\x20'+_0x9c7d83+_0x4e2edd(0x111)+_0x9c7d83+'\x20';else _0xbad710==_0x4e2edd(0x194)?_0x5881dc+=_0x4e2edd(0x170)+_0x9c7d83+'\x20':_0x5881dc+='\x20order\x20by\x20f.'+_0xbad710+'\x20'+_0x9c7d83+'\x20';}}else _0x5881dc+=_0x4e2edd(0x17a);_0x5881dc+=_0x4e2edd(0x180),_0x32f865[_0x4e2edd(0x167)](_0x4fe311),_0x32f865[_0x4e2edd(0x167)](_0xb77962),_0x46c120=dbBookFavorite[_0x4e2edd(0x160)](_0x582d9c[_0x4e2edd(0x151)][_0x4e2edd(0x103)],_0x582d9c[_0x4e2edd(0x164)]['id'],_0x5881dc,_0x32f865);}}setBookListProps(_0x582d9c,_0x46c120)[_0x4e2edd(0x147)](_0x129aa3=>{_0x3829ad(_0x129aa3);});});}function setBookListProps(_0x353ece,_0x55d0d1){return new Promise(async(_0x40dcdf,_0x41924b)=>{const _0x5bfe78=_0x307f;for(let _0x1d8b31 of _0x55d0d1){_0x1d8b31['favorite']=dbBookFavorite[_0x5bfe78(0x14f)](_0x353ece['app'][_0x5bfe78(0x103)],_0x1d8b31['id'],_0x353ece[_0x5bfe78(0x164)]['id'])?'1':'0',_0x1d8b31[_0x5bfe78(0x1a8)]=path['join'](_0x1d8b31[_0x5bfe78(0x175)],_0x1d8b31[_0x5bfe78(0x162)]),_0x1d8b31[_0x5bfe78(0x105)]=await getBookSameNameCover(_0x1d8b31);}_0x40dcdf(_0x55d0d1);});}router[_0x5c4b85(0x1c1)]('/getHomeData',(_0x151eb0,_0xdcb3dd,_0x239559)=>{const _0x2ad848=_0x5c4b85;let _0x5621a0=_0x151eb0[_0x2ad848(0x1ab)][_0x2ad848(0x1af)]?_0x151eb0['body'][_0x2ad848(0x1af)]:0xc,_0x5f481a=_0x151eb0['currentUser']['id'],_0xa71490=dbUserTable[_0x2ad848(0x130)](_0x151eb0,_0x2ad848(0x115),_0x2ad848(0x121),!![]);if(_0x151eb0[_0x2ad848(0x164)]['is_admin']!=0x1&&!_0xa71490[_0x2ad848(0x173)])return _0xdcb3dd[_0x2ad848(0x1b2)]({'code':0x0,'data':null});let _0x191cd7=[],_0x3bf9c4=_0x151eb0[_0x2ad848(0x151)][_0x2ad848(0x103)][_0x2ad848(0x1a9)](_0x2ad848(0xfd))['all'](_0x5f481a,_0x5621a0);for(let _0x2384be of _0x3bf9c4){let _0x4b8cfc=dbBookIndexTable[_0x2ad848(0x16c)](_0x151eb0['app']['dbFileIndex'],_0x2384be[_0x2ad848(0x152)],_0x2384be[_0x2ad848(0x144)]);_0x4b8cfc&&dbUserTable[_0x2ad848(0x109)](_0x151eb0,_0xdcb3dd,'book',_0x2ad848(0x121),_0x4b8cfc[_0x2ad848(0x175)],!![])==!![]&&(_0x4b8cfc[_0x2ad848(0x1bc)]=_0x2384be[_0x2ad848(0x1bc)],_0x191cd7['push'](_0x4b8cfc));}setBookListProps(_0x151eb0,_0x191cd7)['then'](_0x129c89=>{const _0x1eb7ad=_0x2ad848;_0x191cd7=_0x129c89,getListByParams(_0x151eb0,_0xa71490,_0x1eb7ad(0x131),_0x5621a0,0x0,'check_time',_0x1eb7ad(0x15a),null,null,null,null,0x1)[_0x1eb7ad(0x147)](_0x3335e4=>{const _0x105569=_0x1eb7ad;getListByParams(_0x151eb0,_0xa71490,_0x105569(0x131),_0x5621a0,0x0,_0x105569(0x141),_0x105569(0x15a),null,null,null,null,0x2)[_0x105569(0x147)](_0x37857a=>{const _0x19bf76=_0x105569;getListByParams(_0x151eb0,_0xa71490,_0x19bf76(0x131),_0x5621a0,0x0,'id','desc')['then'](_0x496d70=>{const _0xdcb234=_0x19bf76;let _0x208247={};return _0x191cd7&&_0x191cd7[_0xdcb234(0x129)]>0x0&&(_0x208247[_0xdcb234(0x14b)]=_0x191cd7),_0x496d70&&_0x496d70[_0xdcb234(0x129)]>0x0&&(_0x208247[_0xdcb234(0x197)]=_0x496d70),_0x3335e4&&_0x3335e4['length']>0x0&&(_0x208247[_0xdcb234(0x10e)]=_0x3335e4),_0x37857a&&_0x37857a['length']>0x0&&(_0x208247[_0xdcb234(0x183)]=_0x37857a),_0xdcb3dd[_0xdcb234(0x1b2)]({'code':0x0,'data':_0x208247,'platform':os[_0xdcb234(0x188)]()});});});});});}),router[_0x5c4b85(0x1c1)](_0x5c4b85(0x1b3),(_0x3de36e,_0x58c101,_0x2518d8)=>{const _0xc72f94=_0x5c4b85;let _0x23e2ad=_0x3de36e[_0xc72f94(0x1ab)][_0xc72f94(0x1af)]||0x32,_0x53da01=_0x3de36e[_0xc72f94(0x1ab)][_0xc72f94(0x174)]||0x0,_0x225a8a=_0x3de36e['body'][_0xc72f94(0x159)],_0x4ee21c=_0x3de36e[_0xc72f94(0x1ab)][_0xc72f94(0x16f)]||_0xc72f94(0x141),_0x4f1411=_0x3de36e[_0xc72f94(0x1ab)]['orderType']||_0xc72f94(0x15a),_0x23ffbc=[_0xc72f94(0x131),'favorite',_0xc72f94(0x10e)],_0x159fcf=_0x3de36e[_0xc72f94(0x1ab)][_0xc72f94(0x100)]||_0xc72f94(0x131),_0xd3c427=_0x3de36e[_0xc72f94(0x1ab)][_0xc72f94(0x11d)],_0x23c497=_0x3de36e['body']['letterIndex'],_0x3da02c=_0x3de36e['body'][_0xc72f94(0x119)],_0x458b6e=_0x3de36e['body']['type'];if(dbBookIndexTable[_0xc72f94(0x122)](_0x3de36e,_0x58c101,_0x4ee21c,_0x4f1411)!==!![])return;if(_0x159fcf==_0xc72f94(0x10e)){if(!_0x3da02c)return _0x3de36e[_0xc72f94(0x151)]['returnErrMsg'](_0x58c101,_0xc72f94(0x1a3));}!_0x23ffbc[_0xc72f94(0x1b9)](_0x159fcf)&&(_0x159fcf='list');_0x23e2ad>0x1f4&&(_0x23e2ad=0x1f4);let _0x20837c=dbUserTable[_0xc72f94(0x130)](_0x3de36e,_0xc72f94(0x115),_0xc72f94(0x121),!![]);if(_0x3de36e[_0xc72f94(0x164)]['is_admin']!=0x1&&!_0x20837c[_0xc72f94(0x173)])return _0x58c101[_0xc72f94(0x1b2)]({'code':0x0,'data':null});getListByParams(_0x3de36e,_0x20837c,_0x159fcf,_0x23e2ad,_0x53da01,_0x4ee21c,_0x4f1411,_0x225a8a,_0xd3c427,_0x3da02c,_0x23c497,_0x458b6e)[_0xc72f94(0x147)](_0x281fde=>{const _0x41f035=_0xc72f94;let _0x1c030f={'code':0x0,'data':_0x281fde};if(_0x159fcf==_0x41f035(0x12e))_0x1c030f[_0x41f035(0x120)]=dbBookFavorite[_0x41f035(0x19c)](_0x3de36e[_0x41f035(0x151)][_0x41f035(0x103)],_0x3de36e[_0x41f035(0x164)]['id']);else{if(_0x159fcf==_0x41f035(0x131))_0x1c030f[_0x41f035(0x120)]=dbBookIndexTable['getBookListCount'](_0x3de36e[_0x41f035(0x151)][_0x41f035(0x103)],_0x20837c,_0x225a8a,_0xd3c427,_0x458b6e);else _0x159fcf==_0x41f035(0x10e)&&(_0x1c030f[_0x41f035(0x120)]=dbBookListTable[_0x41f035(0x14a)](_0x3de36e['app'][_0x41f035(0x103)],_0x3da02c));}return _0x58c101[_0x41f035(0x1b2)](_0x1c030f);});}),router['post'](_0x5c4b85(0x181),(_0x5048e5,_0x4d1cb9,_0x5310f1)=>{const _0x12c9c2=_0x5c4b85;let _0x2e83be=_0x5048e5[_0x12c9c2(0x1ab)]['id'],_0x134e6c=dbFileIndexTable[_0x12c9c2(0x16e)](_0x5048e5[_0x12c9c2(0x151)]['dbFileIndex'],_0x2e83be,dbFileIndexTable[_0x12c9c2(0x106)]);if(!_0x134e6c)return _0x5048e5[_0x12c9c2(0x151)][_0x12c9c2(0x198)](_0x4d1cb9,_0x12c9c2(0x1bf));if(dbUserTable[_0x12c9c2(0x109)](_0x5048e5,_0x4d1cb9,_0x12c9c2(0x115),'power_get',_0x134e6c[_0x12c9c2(0x175)])==!![]){let _0x443c8c=_0x5048e5[_0x12c9c2(0x164)]['id'],_0x5f536a=dbBookFavorite[_0x12c9c2(0x1a2)](_0x5048e5['app']['dbFileIndex'],_0x443c8c,_0x2e83be);_0x134e6c[_0x12c9c2(0x12e)]=_0x5f536a?0x1:0x0,_0x134e6c[_0x12c9c2(0x1a8)]=path[_0x12c9c2(0x18f)](_0x134e6c[_0x12c9c2(0x175)],_0x134e6c[_0x12c9c2(0x162)]);let _0x582e84=dbBookIndexTable[_0x12c9c2(0x125)](_0x5048e5[_0x12c9c2(0x151)][_0x12c9c2(0x103)],_0x134e6c[_0x12c9c2(0x175)]);_0x582e84[_0x12c9c2(0x129)]>0x0?(_0x582e84=arrayUtil[_0x12c9c2(0x1be)](_0x582e84,'filename'),setBookListProps(_0x5048e5,_0x582e84)['then'](_0x2c1424=>{_0x582e84=_0x2c1424,_0x4993a0();})):_0x4993a0;function _0x4993a0(){const _0x40ee4c=_0x12c9c2;let _0xe1fea={'code':0x0,'data':_0x134e6c,'sameFolderBookList':_0x582e84};getBookSameNameCover(_0x134e6c)[_0x40ee4c(0x147)](_0x432922=>{const _0x179bb9=_0x40ee4c;_0x134e6c[_0x179bb9(0x105)]=_0x432922;let _0x273aaa=_0x5048e5[_0x179bb9(0x151)][_0x179bb9(0x103)][_0x179bb9(0x1a9)](_0x179bb9(0x132))[_0x179bb9(0x135)](_0x443c8c,path['join'](_0x134e6c[_0x179bb9(0x175)],_0x134e6c[_0x179bb9(0x162)]),_0x134e6c['size']);_0x273aaa&&(_0xe1fea[_0x179bb9(0x1bc)]=_0x273aaa[_0x179bb9(0x1bc)]),_0xe1fea[_0x179bb9(0x1a0)]=fs[_0x179bb9(0x18e)](_0x134e6c[_0x179bb9(0x1a8)],(_0x5b3ebc,_0x509d69)=>{const _0x506637=_0x179bb9;return _0x5b3ebc?_0xe1fea[_0x506637(0x101)]=0x0:_0xe1fea[_0x506637(0x101)]=0x1,_0x4d1cb9[_0x506637(0x1b2)](_0xe1fea);});});}}}),router[_0x5c4b85(0x1c1)]('/bookFavorite',(_0xd3956f,_0x4944d1,_0x48c3ec)=>{const _0x42069d=_0x5c4b85;let _0x2233a5=_0xd3956f[_0x42069d(0x164)]['id'];function _0x43b205(_0x4ef947){const _0x15bef6=_0x42069d;let _0x2c1d45=dbFileIndexTable[_0x15bef6(0x16e)](_0xd3956f['app'][_0x15bef6(0x103)],_0x4ef947,dbFileIndexTable[_0x15bef6(0x106)]);if(!_0x2c1d45)return;let _0x3dd6d1=new Date()[_0x15bef6(0x1b1)]();_0xd3956f[_0x15bef6(0x151)][_0x15bef6(0x103)][_0x15bef6(0x1a9)](_0x15bef6(0x1a7))[_0x15bef6(0x1ad)](_0x3dd6d1,_0x4ef947),dbBookFavorite[_0x15bef6(0x14c)](_0xd3956f[_0x15bef6(0x151)][_0x15bef6(0x103)],_0x2233a5,_0x4ef947);}if(_0xd3956f['body'][_0x42069d(0x1a5)]instanceof Array){let _0x52d83c=_0xd3956f[_0x42069d(0x1ab)][_0x42069d(0x10c)];if(_0x52d83c==_0x42069d(0x18c))for(let _0xefc472 of _0xd3956f[_0x42069d(0x1ab)][_0x42069d(0x1a5)]){_0x43b205(_0xefc472);}else{if(_0x52d83c==_0x42069d(0x1ae))for(let _0x152892 of _0xd3956f['body']['indexId']){dbBookFavorite[_0x42069d(0x157)](_0xd3956f[_0x42069d(0x151)][_0x42069d(0x103)],_0x2233a5,_0x152892);}}return _0x4944d1[_0x42069d(0x1b2)]({'code':0x0});}else{let _0x4d3ab0=parseInt(_0xd3956f[_0x42069d(0x1ab)][_0x42069d(0x1a5)]),_0x1d8203=dbBookFavorite[_0x42069d(0x1a2)](_0xd3956f[_0x42069d(0x151)]['dbFileIndex'],_0x2233a5,_0x4d3ab0),_0x34ff0d=0x0;return _0x1d8203?dbBookFavorite[_0x42069d(0x157)](_0xd3956f[_0x42069d(0x151)]['dbFileIndex'],_0x2233a5,_0x4d3ab0):(_0x34ff0d=0x1,_0x43b205(_0x4d3ab0)),_0x4944d1['json']({'code':0x0,'favorite':_0x34ff0d});}}),router['get'](_0x5c4b85(0x13c),(_0x715a6b,_0x46dfdd,_0x5ab640)=>{const _0x2d52f6=_0x5c4b85;let _0x21ce81=_0x715a6b[_0x2d52f6(0x1a6)][_0x2d52f6(0x1a5)],_0x2662c3=dbBookIndexTable[_0x2d52f6(0x137)](_0x715a6b[_0x2d52f6(0x151)][_0x2d52f6(0x103)],_0x21ce81),_0x484688=_0x715a6b[_0x2d52f6(0x1a6)]['size'];!_0x484688&&(_0x484688=0x200);if(!_0x2662c3||_0x2662c3&&!_0x2662c3[_0x2d52f6(0x155)])return _0x46dfdd[_0x2d52f6(0x10a)](0x194)['end']();dbUserTable[_0x2d52f6(0x109)](_0x715a6b,_0x46dfdd,_0x2d52f6(0x115),_0x2d52f6(0x121),_0x2662c3[_0x2d52f6(0x175)])==!![]&&fs['stat'](_0x2662c3[_0x2d52f6(0x155)],(_0x1bdd18,_0xcb2e06)=>{const _0x484e9a=_0x2d52f6;if(_0x1bdd18){let _0x72e03c=config[_0x484e9a(0x190)](_0x2662c3);bookIndexUtil[_0x484e9a(0x196)](_0x2662c3,_0x72e03c)[_0x484e9a(0x147)](_0x41f9f0=>{const _0x1effbb=_0x484e9a;if(_0x41f9f0['coverData'])bookIndexUtil['sharpWriteCover'](_0x41f9f0['coverData'],_0x72e03c)[_0x1effbb(0x147)](_0x3ad1ed=>{const _0x3c860=_0x1effbb;return console[_0x3c860(0x149)](_0x3c860(0x133),_0x3ad1ed),_0x46dfdd['sendFile'](_0x3ad1ed);})[_0x1effbb(0x19f)](_0x40bae9=>{const _0x2b6978=_0x1effbb;return _0x46dfdd[_0x2b6978(0x10a)](0x194)['end']();});else return _0x46dfdd[_0x1effbb(0x10a)](0x194)[_0x1effbb(0x1bd)]();})[_0x484e9a(0x19f)](_0x5539c5=>{const _0x495635=_0x484e9a;return _0x46dfdd[_0x495635(0x10a)](0x194)[_0x495635(0x1bd)]();});}else return _0x46dfdd['sendFile'](_0x2662c3['cover_path']);});}),router[_0x5c4b85(0x1c1)]('/getGroupList',(_0x3f5d32,_0x2ce998,_0x52a8ad)=>{const _0x2a8ee1=_0x5c4b85;let _0x1ddfcc=_0x3f5d32[_0x2a8ee1(0x1ab)][_0x2a8ee1(0x1af)]||0x32,_0x543eed=_0x3f5d32['body'][_0x2a8ee1(0x174)]||0x0,_0x5a0910=_0x3f5d32[_0x2a8ee1(0x1ab)][_0x2a8ee1(0x138)]||_0x2a8ee1(0x10e),_0x2a43a1=_0x3f5d32['body'][_0x2a8ee1(0x16f)]||_0x2a8ee1(0x141),_0x4a95e4=_0x3f5d32[_0x2a8ee1(0x1ab)]['orderType']||'desc',_0x201a0a=_0x3f5d32[_0x2a8ee1(0x1ab)]['search'],_0x5506a2=_0x3f5d32[_0x2a8ee1(0x1ab)][_0x2a8ee1(0x112)];if(dbBookIndexTable['checkOrderParams'](_0x3f5d32,_0x2ce998,_0x2a43a1,_0x4a95e4)!==!![])return;let _0x234474=['check_time',_0x2a8ee1(0x15d),'check_time',_0x2a8ee1(0x162),_0x2a8ee1(0x16a),_0x2a8ee1(0x159),_0x2a8ee1(0x177),'id',_0x2a8ee1(0x113)],_0x4ac7c7=[_0x2a8ee1(0x12d),_0x2a8ee1(0x15a)];if(!_0x234474[_0x2a8ee1(0x1b9)](_0x2a43a1)||!_0x4ac7c7[_0x2a8ee1(0x1b9)](_0x4a95e4))return _0x3f5d32[_0x2a8ee1(0x151)][_0x2a8ee1(0x198)](_0x2ce998,_0x2a8ee1(0x128),_0x2a43a1,_0x4a95e4);let _0x72f05e=dbUserTable['getUserPathWhere'](_0x3f5d32,_0x2a8ee1(0x115),_0x2a8ee1(0x121),!![]);if(_0x3f5d32[_0x2a8ee1(0x164)]['is_admin']!=0x1&&!_0x72f05e['whereStr']&&_0x5a0910!=_0x2a8ee1(0x10e))return _0x2ce998['json']({'code':0x0,'data':null});let _0x167fbb=[];if(_0x5a0910==_0x2a8ee1(0x159))_0x167fbb=dbBookIndexTable[_0x2a8ee1(0x15c)](_0x3f5d32[_0x2a8ee1(0x151)][_0x2a8ee1(0x103)],_0x72f05e,_0x5a0910,_0x1ddfcc,_0x543eed,_0x2a43a1,_0x4a95e4,_0x201a0a,_0x5506a2);else{if(_0x5a0910==_0x2a8ee1(0x10e)){_0x167fbb=dbBookListTable['getBookListList'](_0x3f5d32[_0x2a8ee1(0x151)][_0x2a8ee1(0x103)],_0x3f5d32[_0x2a8ee1(0x164)]['id'],_0x1ddfcc,_0x543eed,'id','desc',_0x201a0a);for(let _0x2593b8 of _0x167fbb){_0x2593b8[_0x2a8ee1(0x168)]=dbBookIndexTable[_0x2a8ee1(0x104)](_0x3f5d32[_0x2a8ee1(0x151)][_0x2a8ee1(0x103)],_0x2593b8['id']);}}}return _0x2ce998[_0x2a8ee1(0x1b2)]({'code':0x0,'data':_0x167fbb});}),router['post'](_0x5c4b85(0x139),(_0x43d473,_0x1a889b,_0x16dcbf)=>{const _0x533d38=_0x5c4b85;let _0x458ccf=_0x43d473[_0x533d38(0x1ab)]['name'],_0x3d713e=_0x43d473['body'][_0x533d38(0x10c)];if(_0x3d713e==_0x533d38(0x18c)){if(!_0x458ccf)return _0x43d473['app'][_0x533d38(0x198)](_0x1a889b,_0x533d38(0x19d));dbBookListTable[_0x533d38(0x17b)](_0x43d473[_0x533d38(0x151)][_0x533d38(0x103)],_0x43d473[_0x533d38(0x164)]['id'],_0x458ccf);}else{if(_0x3d713e==_0x533d38(0x1ba)||_0x3d713e==_0x533d38(0x1ae)){let _0x1b6ad5=_0x43d473['body'][_0x533d38(0x119)],_0x5bf0cf=dbBookListTable[_0x533d38(0x10f)](_0x43d473['app']['dbFileIndex'],_0x1b6ad5),_0x299a2e=![];(_0x43d473[_0x533d38(0x164)][_0x533d38(0x15e)]==0x1||_0x5bf0cf[_0x533d38(0x187)]==_0x43d473['currentUser']['id'])&&(_0x299a2e=!![]);if(!_0x299a2e)return _0x1a889b[_0x533d38(0x1b2)]({'code':0x66});if(_0x3d713e==_0x533d38(0x1ae))dbBookListTable[_0x533d38(0x14e)](_0x43d473[_0x533d38(0x151)][_0x533d38(0x103)],_0x1b6ad5);else{if(_0x3d713e=='edit'){if(!_0x458ccf)return _0x43d473[_0x533d38(0x151)][_0x533d38(0x198)](_0x1a889b,_0x533d38(0x19d));dbBookListTable['updateBookList'](_0x43d473[_0x533d38(0x151)]['dbFileIndex'],_0x1b6ad5,_0x458ccf);}}}else return _0x43d473['app'][_0x533d38(0x198)](_0x1a889b,_0x533d38(0x13d));}return _0x1a889b['json']({'code':0x0});}),router['post'](_0x5c4b85(0x146),(_0x4fb74d,_0x2e2fa1,_0x522bc4)=>{const _0x19434a=_0x5c4b85;let _0x3a2484=_0x4fb74d[_0x19434a(0x1ab)]['bookIndexId'],_0xae82e8=_0x4fb74d[_0x19434a(0x1ab)][_0x19434a(0x119)];if(!_0x3a2484||!_0xae82e8)return _0x4fb74d[_0x19434a(0x151)][_0x19434a(0x198)](_0x2e2fa1,_0x19434a(0x154));let _0xc6f9a0=dbBookListTable[_0x19434a(0x10f)](_0x4fb74d['app']['dbFileIndex'],_0xae82e8);if(!_0xc6f9a0)return _0x4fb74d[_0x19434a(0x151)][_0x19434a(0x198)](_0x2e2fa1,_0x19434a(0x185));let _0xfbcaf=_0x4fb74d['body'][_0x19434a(0x10c)];if(_0xfbcaf=='add'){function _0x5b8736(_0x1db007){const _0x77127f=_0x19434a;let _0x5aceee=dbBookIndexTable[_0x77127f(0x137)](_0x4fb74d[_0x77127f(0x151)][_0x77127f(0x103)],_0x1db007);if(!_0x5aceee)return;if(_0x5aceee[_0x77127f(0x165)]==0x1){dbBookListTable['addBookToBookList'](_0x4fb74d[_0x77127f(0x151)][_0x77127f(0x103)],_0x1db007,_0xae82e8);let _0x2b56c3=Date[_0x77127f(0x19b)]();_0x4fb74d[_0x77127f(0x151)][_0x77127f(0x103)][_0x77127f(0x1a9)](_0x77127f(0x1a7))[_0x77127f(0x1ad)](_0x2b56c3,_0x5aceee['id']);}else{let _0x2e6986=path[_0x77127f(0x18f)](_0x5aceee[_0x77127f(0x175)],_0x5aceee['filename']),_0x14c30b=_0x4fb74d['app'][_0x77127f(0x103)]['prepare'](_0x77127f(0x145))[_0x77127f(0x148)](_0x2e6986,_0x2e6986+path[_0x77127f(0x1a4)]+'%');for(let _0x599bad of _0x14c30b){dbBookListTable[_0x77127f(0x156)](_0x4fb74d['app'][_0x77127f(0x103)],_0x599bad['id'],_0xae82e8);}}}if(_0x3a2484 instanceof Array)for(let _0x1d79f7 of _0x3a2484){_0x5b8736(_0x1d79f7);}else _0x5b8736(_0x3a2484);}else{if(_0xfbcaf==_0x19434a(0x1ae)){if(_0x3a2484 instanceof Array)for(let _0x3d1097 of _0x3a2484){dbBookListTable[_0x19434a(0x1b5)](_0x4fb74d[_0x19434a(0x151)][_0x19434a(0x103)],_0x3d1097,_0xae82e8);}else dbBookListTable['removeBookFromList'](_0x4fb74d['app'][_0x19434a(0x103)],_0x3a2484,_0xae82e8);}else return _0x4fb74d['app'][_0x19434a(0x198)](_0x2e2fa1,'operation\x20error');}return _0x2e2fa1['json']({'code':0x0,'data':{}});}),router[_0x5c4b85(0x1c1)](_0x5c4b85(0x11c),(_0x26a203,_0x5c57ca,_0x30b59f)=>{const _0x1e8282=_0x5c4b85;let _0xcd23a9=_0x26a203[_0x1e8282(0x1ab)]['parent'],_0x49feb5=_0x26a203[_0x1e8282(0x1ab)][_0x1e8282(0x17f)],_0x49a39d=_0x1e8282(0x115);if(dbUserTable[_0x1e8282(0x109)](_0x26a203,_0x5c57ca,_0x49a39d,_0x1e8282(0x121))==!![]){let _0x3f7d83=[];if(!_0xcd23a9){let _0x36f1c3=[];_0x26a203[_0x1e8282(0x164)][_0x1e8282(0x15e)]==0x1?_0x36f1c3=dbSourceFolderTable['getPathByType'](_0x26a203[_0x1e8282(0x151)][_0x1e8282(0x176)],_0x49a39d):_0x36f1c3=dbUserTable['getUserPower'](_0x26a203[_0x1e8282(0x151)]['dbOther'],_0x26a203[_0x1e8282(0x164)]['username'],_0x49a39d);if(_0x36f1c3)for(let _0x409a3a=0x0;_0x409a3a<_0x36f1c3[_0x1e8282(0x129)];_0x409a3a++){_0x3f7d83[_0x1e8282(0x167)]({'path':_0x36f1c3[_0x409a3a][_0x1e8282(0x175)],'is_file':0x0,'filename':path['basename'](_0x36f1c3[_0x409a3a][_0x1e8282(0x175)]),'root':!![]});}}else{let _0x2b1b99=[];if(_0x26a203[_0x1e8282(0x164)][_0x1e8282(0x15e)]!=0x1){if(dbUserTable[_0x1e8282(0x109)](_0x26a203,_0x5c57ca,_0x49a39d,_0x1e8282(0x121),_0xcd23a9)!==!![])return;}_0xcd23a9=path[_0x1e8282(0x18f)](_0xcd23a9);let _0x5f2787=_0x1e8282(0x192);_0x2b1b99[_0x1e8282(0x167)](_0xcd23a9);if(_0x49feb5){let _0x21937d=_0x1e8282(0x1aa);_0x5f2787+=_0x21937d,_0x2b1b99[_0x1e8282(0x167)]('%'+_0x49feb5+'%'),_0x2b1b99['push']('%'+_0x49feb5+'%');}let _0x426441=_0x1e8282(0x12f);_0x3f7d83=_0x26a203[_0x1e8282(0x151)][_0x1e8282(0x103)][_0x1e8282(0x1a9)](_0x1e8282(0x117)+_0x426441+_0x1e8282(0x102)+_0x5f2787)[_0x1e8282(0x148)](_0x2b1b99);}for(let _0x2a105c of _0x3f7d83){if(_0x2a105c[_0x1e8282(0x165)]==0x0){let _0x3c2c31=path[_0x1e8282(0x18f)](_0x2a105c['path'],_0x2a105c[_0x1e8282(0x162)]),_0x1ea920=_0x26a203['app'][_0x1e8282(0x103)][_0x1e8282(0x1a9)](_0x1e8282(0x140))[_0x1e8282(0x135)](_0x3c2c31);_0x2a105c['fileCount']=_0x1ea920['count'];}}let _0x15a035=path[_0x1e8282(0x1a4)],_0x1760ef={'code':0x0,'data':_0x3f7d83,'sep':_0x15a035};return _0x5c57ca['json'](_0x1760ef);}}),router[_0x5c4b85(0x1c1)](_0x5c4b85(0x12b),(_0x4422f5,_0x580061,_0x53b20d)=>{const _0x3c1a94=_0x5c4b85;let _0x5ddaa3=_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0x158)],_0x3f04c9=_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0x10c)];if(!_0x5ddaa3)return _0x4422f5[_0x3c1a94(0x151)]['returnErrMsg'](_0x580061,_0x3c1a94(0x169));let _0xd7dd95=dbBookIndexTable[_0x3c1a94(0x137)](_0x4422f5['app'][_0x3c1a94(0x103)],_0x5ddaa3);if(!_0xd7dd95)return _0x4422f5[_0x3c1a94(0x151)][_0x3c1a94(0x198)](_0x580061,_0x3c1a94(0x123));if(_0x3f04c9=='update'){let _0xe59f19={'title':_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0x16a)],'publish_date':_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0x16d)],'year':_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0xfc)],'isbn':_0x4422f5[_0x3c1a94(0x1ab)]['isbn'],'language':_0x4422f5['body'][_0x3c1a94(0xff)],'genre':_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0x12c)],'tag':_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0x118)],'publisher':_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0x113)],'artist':_0x4422f5['body'][_0x3c1a94(0x159)],'introduction':_0x4422f5[_0x3c1a94(0x1ab)][_0x3c1a94(0x1b4)]},_0xc3f08b=path[_0x3c1a94(0x18f)](_0xd7dd95[_0x3c1a94(0x175)],_0xd7dd95[_0x3c1a94(0x162)]);fs[_0x3c1a94(0x18e)](_0xc3f08b,(_0x4c1dfa,_0x49c84c)=>{const _0x43324f=_0x3c1a94;if(_0x4c1dfa)return _0x4422f5[_0x43324f(0x151)][_0x43324f(0x198)](_0x580061,_0x580061['__'](_0x43324f(0x107))+_0xc3f08b);let _0x567823=_0xc3f08b[_0x43324f(0x150)](0x0,_0xc3f08b[_0x43324f(0x182)]('.'))+_0x43324f(0x1b6);nfoUtil[_0x43324f(0x13e)](_0xe59f19,_0x567823)[_0x43324f(0x147)](()=>{const _0x1fb4a4=_0x43324f;console[_0x1fb4a4(0x149)](_0x1fb4a4(0x114)),dbBookIndexTable[_0x1fb4a4(0x1bb)](_0x4422f5[_0x1fb4a4(0x151)]['dbFileIndex'],_0x5ddaa3,_0xe59f19),_0xd7dd95=dbBookIndexTable[_0x1fb4a4(0x137)](_0x4422f5[_0x1fb4a4(0x151)][_0x1fb4a4(0x103)],_0x5ddaa3),setBookListProps(_0x4422f5,[_0xd7dd95])[_0x1fb4a4(0x147)](_0x1ab858=>{const _0x286bad=_0x1fb4a4;return _0x580061[_0x286bad(0x1b2)]({'code':0x0,'data':_0x1ab858[0x0]});});})[_0x43324f(0x19f)](_0x18fb07=>{const _0xbcab38=_0x43324f;return console[_0xbcab38(0x149)](_0xbcab38(0x13b),_0x18fb07),_0x4422f5[_0xbcab38(0x151)]['returnErrMsg'](_0x580061,_0xbcab38(0x126));});});}else{if(_0x3f04c9==_0x3c1a94(0x1ae)){let _0x45e6d9=path[_0x3c1a94(0x18f)](_0xd7dd95[_0x3c1a94(0x175)],_0xd7dd95[_0x3c1a94(0x162)]),_0x5817c0=_0x45e6d9[_0x3c1a94(0x150)](0x0,_0x45e6d9[_0x3c1a94(0x182)]('.'))+_0x3c1a94(0x1b6);fs[_0x3c1a94(0x18e)](_0x5817c0,(_0x59a0af,_0x506126)=>{const _0x76d829=_0x3c1a94;if(_0x59a0af)return _0x4422f5['app'][_0x76d829(0x198)](_0x580061,_0x580061['__'](_0x76d829(0x107))+_0x5817c0);fs['rm'](_0x5817c0,_0x39e103=>{const _0x302a1c=_0x76d829;if(_0x39e103)return _0x4422f5[_0x302a1c(0x151)][_0x302a1c(0x198)](_0x580061,_0x580061['__'](_0x302a1c(0x17d))+_0x5817c0);return dbBookIndexTable['updateBook'](_0x4422f5[_0x302a1c(0x151)][_0x302a1c(0x103)],indexId,{}),_0x580061[_0x302a1c(0x1b2)]({'code':0x0});});});}else return _0x4422f5[_0x3c1a94(0x151)][_0x3c1a94(0x198)](_0x580061,'operation\x20error');}}),module[_0x5c4b85(0x11b)]=router;