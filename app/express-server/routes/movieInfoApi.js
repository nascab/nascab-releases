const _0x10869e=_0x1768;(function(_0xc4b690,_0x75d5b){const _0x4aa685=_0x1768,_0x32059e=_0xc4b690();while(!![]){try{const _0x4e4243=-parseInt(_0x4aa685(0x234))/0x1*(parseInt(_0x4aa685(0x215))/0x2)+-parseInt(_0x4aa685(0x1f4))/0x3*(-parseInt(_0x4aa685(0x1d0))/0x4)+-parseInt(_0x4aa685(0x1f7))/0x5*(parseInt(_0x4aa685(0x1ce))/0x6)+parseInt(_0x4aa685(0x242))/0x7*(-parseInt(_0x4aa685(0x221))/0x8)+-parseInt(_0x4aa685(0x205))/0x9+-parseInt(_0x4aa685(0x1de))/0xa+parseInt(_0x4aa685(0x1eb))/0xb*(parseInt(_0x4aa685(0x20a))/0xc);if(_0x4e4243===_0x75d5b)break;else _0x32059e['push'](_0x32059e['shift']());}catch(_0x1b7b6f){_0x32059e['push'](_0x32059e['shift']());}}}(_0x5715,0x43392));var express=require(_0x10869e(0x244)),router=express[_0x10869e(0x216)]();const fs=require('fs'),sharp=require(_0x10869e(0x1df)),axios=require(_0x10869e(0x1cf));let sha256=require('sha256'),path=require(_0x10869e(0x1d6)),config=require(_0x10869e(0x209));function _0x5715(){const _0x1f04ee=['\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?','body','jpeg','dirname','/testTmdbProxy','2575300pmGamC','sharp','tmdb','indexId','saveMovieInfoToDb','operationFail','username','刮削文件清理成功','Need\x20tmdb\x20api\x20url','dbFileIndex','indexId/tmdbId\x20error','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','basename','121HYFBVj','Need\x20tmdb\x20key','join','/setMovieInfo','is_admin','filename','catch','searchMediaType','query','364623suqkxs','indexId\x20error','pipe','790sBaKyA','movieTmdbApiUrl','tvshow.nfo','currentUser','/clearNfoImg','getProxyUrl','getSeasonNumber','movieTmdbApiKey','sep','TYPE_DELETE','count','log','downloadImg','doUserCanGet','4446261ARSXqR','length','params\x20error','addFileOperationRecord','../../myConfig/config','2036052rejULD','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','returnErrMsg','message','status_code','searchType','headersSent','search','INDEX_TABLE_NAME_MOVIE','prepare','exports','64zIDLgg','Router','movieTmdbLanguage','poster.jpg','status_message','../../db/dbUserTable','-fanart.jpg','.nfo','fanart.jpg','/clearMovieInfo','toBuffer','../../utils/movieSeasonUtil','2307304LrVBhM','SELECT\x20*\x20FROM\x20','ext','power_change','getById','TMDBID','TMDB\x20search接口请求失败','indexOf','then','getDetail','json','success','splice','sourceFolder','need\x20folder','all','end','offset','/searchMovieInfo','12119BYDCVA','KEYWORD','/scrapeAgain','app','lastIndexOf','noCache','status','../../utils/movieInfoTmdbApi','getTmdbApi','runSearchNfoWorker','push','err1','is_tvplay','scrapeMissing','7rufwKs','allSettled','express','tmdbId','season','post','/clearScrapeLog','posterPath','20046LjqMqF','axios','12raGpKb','url','season.nfo','dbOther','STATE_SUC','send','path','page','resize'];_0x5715=function(){return _0x1f04ee;};return _0x5715();}function _0x1768(_0x5e4f2e,_0x53bb06){const _0x5715ff=_0x5715();return _0x1768=function(_0x17680d,_0x32e53d){_0x17680d=_0x17680d-0x1ce;let _0x4db9ae=_0x5715ff[_0x17680d];return _0x4db9ae;},_0x1768(_0x5e4f2e,_0x53bb06);}const tmdbApi=require(_0x10869e(0x23b)),movieInfoUtil=require('../../utils/movieInfoUtil'),movieSeasonUtil=require(_0x10869e(0x220)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbUserTable=require(_0x10869e(0x21a)),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),nfoUtil=require('../../utils/nfoUtil'),httpUtil=require('../../utils/httpUtil');router[_0x10869e(0x247)]('/testTmdb',(_0x34d044,_0x2231c8,_0x2dfb43)=>{const _0x22d766=_0x10869e;if(_0x34d044['currentUser'][_0x22d766(0x1ef)]!=0x1)return _0x2231c8[_0x22d766(0x22b)]({'code':0x66});let _0x503170=_0x34d044[_0x22d766(0x1da)][_0x22d766(0x217)],_0x2dea56=_0x34d044[_0x22d766(0x1da)][_0x22d766(0x1f8)],_0x29adb0=_0x34d044[_0x22d766(0x1da)][_0x22d766(0x1fe)];if(!_0x503170)return _0x34d044[_0x22d766(0x237)][_0x22d766(0x20c)](_0x2231c8,'Need\x20tmdb\x20language');if(!_0x2dea56)return _0x34d044[_0x22d766(0x237)][_0x22d766(0x20c)](_0x2231c8,_0x22d766(0x1e6));if(!_0x29adb0)return _0x34d044[_0x22d766(0x237)][_0x22d766(0x20c)](_0x2231c8,_0x22d766(0x1ec));let _0x33e7e1=movieInfoUtil[_0x22d766(0x1fc)](_0x34d044[_0x22d766(0x237)][_0x22d766(0x1d3)]),_0x17bdb1=new tmdbApi['API'](_0x29adb0,_0x503170,_0x2dea56,_0x33e7e1);_0x17bdb1['languageList']()[_0x22d766(0x229)](_0x57f939=>{const _0x4956b9=_0x22d766;if(_0x57f939[_0x4956b9(0x22c)]==![]||_0x57f939[_0x4956b9(0x20e)])return _0x2231c8[_0x4956b9(0x22b)]({'code':0x2,'msg':_0x57f939[_0x4956b9(0x219)]});return _0x2231c8['json']({'code':0x0,'data':[]});})[_0x22d766(0x1f1)](_0xbee16a=>{const _0xd5db65=_0x22d766;let _0xc9f7f5='TMDB\x20Error';if(_0xbee16a){if(_0xbee16a['status_code'])_0xc9f7f5+=':'+_0xbee16a[_0xd5db65(0x219)];else _0xbee16a[_0xd5db65(0x20d)]&&(_0xc9f7f5+=':'+_0xbee16a['message']);}return _0x2231c8['json']({'code':0x2,'msg':_0xc9f7f5,'data':[]});});}),router[_0x10869e(0x247)](_0x10869e(0x1dd),(_0x18294b,_0x5982fc,_0x276525)=>{const _0x54d357=_0x10869e;if(_0x18294b[_0x54d357(0x1fa)]['is_admin']!=0x1)return _0x5982fc['json']({'code':0x66});movieInfoUtil['testTmdb'](_0x18294b[_0x54d357(0x237)]['dbOther'])[_0x54d357(0x229)](()=>{const _0x380133=_0x54d357;return _0x5982fc[_0x380133(0x22b)]({'code':0x0});})[_0x54d357(0x1f1)](_0x3aad57=>{const _0x1b94c4=_0x54d357;return _0x5982fc[_0x1b94c4(0x22b)]({'code':0x2,'msg':_0x3aad57});});}),router[_0x10869e(0x247)](_0x10869e(0x233),(_0x35819e,_0x2bd46a,_0xfd3d5e)=>{const _0x22a5e2=_0x10869e;let _0x11be50=_0x35819e[_0x22a5e2(0x1da)]['searchStr'],_0x1bbed4=_0x35819e[_0x22a5e2(0x1da)][_0x22a5e2(0x20f)],_0x53f1ea=_0x35819e['body'][_0x22a5e2(0x1f2)],_0x5eb820=_0x35819e[_0x22a5e2(0x1da)][_0x22a5e2(0x1d7)];if(!_0x11be50||!_0x1bbed4||!_0x53f1ea)return _0x35819e[_0x22a5e2(0x237)][_0x22a5e2(0x20c)](_0x2bd46a,_0x22a5e2(0x207));let _0x49e54c=movieInfoUtil[_0x22a5e2(0x23c)](_0x35819e[_0x22a5e2(0x237)][_0x22a5e2(0x1d3)]);if(_0x1bbed4==_0x22a5e2(0x235))_0x49e54c[_0x22a5e2(0x211)](_0x11be50,_0x53f1ea=='TV',null,_0x5eb820,!![])[_0x22a5e2(0x229)](_0x22b981=>{const _0x5e4da0=_0x22a5e2;if(!_0x2bd46a[_0x5e4da0(0x210)])return _0x2bd46a[_0x5e4da0(0x22b)]({'code':0x0,'data':_0x22b981});})[_0x22a5e2(0x1f1)](_0x323d1d=>{const _0x5f0615=_0x22a5e2;console['log'](_0x5f0615(0x227),_0x323d1d);if(_0x323d1d&&_0x323d1d[_0x5f0615(0x20e)]&&_0x323d1d['status_message'])return _0x35819e[_0x5f0615(0x237)][_0x5f0615(0x20c)](_0x2bd46a,_0x323d1d[_0x5f0615(0x219)]);if(!_0x2bd46a[_0x5f0615(0x210)])return _0x2bd46a[_0x5f0615(0x22b)]({'code':0x0,'data':[]});});else{if(_0x1bbed4==_0x22a5e2(0x226))_0x49e54c[_0x22a5e2(0x22a)](_0x11be50,_0x53f1ea=='TV')['then'](_0xa3c085=>{const _0x44ca38=_0x22a5e2;if(!_0x2bd46a[_0x44ca38(0x210)])return _0x2bd46a[_0x44ca38(0x22b)]({'code':0x0,'data':[_0xa3c085]});})[_0x22a5e2(0x1f1)](_0x3c94f6=>{const _0x33bf3f=_0x22a5e2;console['log'](_0x33bf3f(0x227),_0x3c94f6);if(_0x3c94f6&&_0x3c94f6[_0x33bf3f(0x20e)]&&_0x3c94f6[_0x33bf3f(0x219)])return _0x35819e[_0x33bf3f(0x237)][_0x33bf3f(0x20c)](_0x2bd46a,_0x3c94f6['status_message']);if(!_0x2bd46a['headersSent'])return _0x2bd46a['json']({'code':0x0,'data':[]});});else{if(!_0x2bd46a['headersSent'])return _0x2bd46a[_0x22a5e2(0x22b)]({'code':0x0,'data':[]});}}});function updateIndexByNfo(_0x58a07d,_0xa9c904){return new Promise((_0x1f2390,_0x2c346b)=>{const _0x305d6d=_0x1768;nfoUtil['parseNfo'](_0xa9c904,!![],![])[_0x305d6d(0x229)](_0x255acb=>{const _0x3435ec=_0x305d6d;return movieInfoUtil[_0x3435ec(0x1e2)](_0x58a07d,_0xa9c904['id'],_0x255acb),_0x1f2390();})[_0x305d6d(0x1f1)](_0x1af544=>{return _0x1f2390();});});}router[_0x10869e(0x247)](_0x10869e(0x236),(_0x53c832,_0x5d5edc,_0x1cc805)=>{const _0x5f45ad=_0x10869e;let _0x463c88=_0x53c832[_0x5f45ad(0x1da)][_0x5f45ad(0x1e1)],_0x17c37f=_0x53c832[_0x5f45ad(0x1da)][_0x5f45ad(0x241)],_0x240aa3=dbFileIndexTable[_0x5f45ad(0x225)](_0x53c832[_0x5f45ad(0x237)][_0x5f45ad(0x1e7)],_0x463c88,dbFileIndexTable[_0x5f45ad(0x212)]);if(!_0x240aa3)return _0x53c832[_0x5f45ad(0x237)][_0x5f45ad(0x20c)](_0x5d5edc,_0x5f45ad(0x1f5));if(dbUserTable[_0x5f45ad(0x204)](_0x53c832,_0x5d5edc,'',_0x5f45ad(0x224),_0x240aa3['path'])==!![]){function _0x47aaee(){const _0x355954=_0x5f45ad;movieInfoUtil[_0x355954(0x23d)](_0x53c832[_0x355954(0x237)]['dbOther'],_0x240aa3[_0x355954(0x1d6)],_0x240aa3[_0x355954(0x1f0)],_0x240aa3[_0x355954(0x240)],null,_0x17c37f)[_0x355954(0x229)](()=>{const _0x528cd6=_0x355954;_0x240aa3[_0x528cd6(0x240)]==0x0&&updateIndexByNfo(_0x53c832[_0x528cd6(0x237)][_0x528cd6(0x1e7)],_0x240aa3)[_0x528cd6(0x229)](()=>{});})[_0x355954(0x1f1)](_0x5d3ab4=>{});}_0x17c37f==0x1?_0x47aaee():clearInfo(_0x53c832,_0x5d5edc,_0x240aa3)[_0x5f45ad(0x229)](()=>{_0x47aaee();});if(!_0x5d5edc[_0x5f45ad(0x210)])return _0x5d5edc[_0x5f45ad(0x22b)]({'code':0x0});}}),router[_0x10869e(0x247)]('/getScrapeLog',(_0x87e237,_0x14c71f,_0x5f1429)=>{const _0xa3b63e=_0x10869e;if(_0x87e237['currentUser'][_0xa3b63e(0x1ef)]!=0x1)return _0x14c71f[_0xa3b63e(0x22b)]({'code':0x66});let _0x57e570=_0x87e237[_0xa3b63e(0x1da)][_0xa3b63e(0x201)]||0x1e,_0x155b0d=_0x87e237[_0xa3b63e(0x1da)][_0xa3b63e(0x232)]||0x0;const _0x24542e=_0xa3b63e(0x20b);let _0x524460=_0x87e237[_0xa3b63e(0x237)][_0xa3b63e(0x1e7)]['prepare'](_0x24542e)[_0xa3b63e(0x230)](_0x57e570,_0x155b0d);return _0x14c71f[_0xa3b63e(0x22b)]({'code':0x0,'data':_0x524460});}),router['post'](_0x10869e(0x248),(_0x2cf5ac,_0x835c12,_0x4f66d8)=>{const _0x1f83eb=_0x10869e;if(_0x2cf5ac[_0x1f83eb(0x1fa)][_0x1f83eb(0x1ef)]!=0x1)return _0x835c12[_0x1f83eb(0x22b)]({'code':0x66});const _0x1abd18=_0x1f83eb(0x1e9);return _0x2cf5ac[_0x1f83eb(0x237)][_0x1f83eb(0x1e7)][_0x1f83eb(0x213)](_0x1abd18)['run'](),_0x835c12['json']({'code':0x0});}),router[_0x10869e(0x247)](_0x10869e(0x1fb),(_0x4c5968,_0x46dae9,_0x5bf892)=>{const _0x569576=_0x10869e;if(_0x4c5968[_0x569576(0x1fa)][_0x569576(0x1ef)]!=0x1)return _0x46dae9[_0x569576(0x22b)]({'code':0x66});let _0x20cb47=_0x4c5968[_0x569576(0x1da)][_0x569576(0x22e)];if(!_0x20cb47)return _0x4c5968[_0x569576(0x237)][_0x569576(0x20c)](_0x46dae9,_0x569576(0x22f));const _0x5b869f='UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?';_0x4c5968['app']['dbFileIndex'][_0x569576(0x213)](_0x5b869f)['run'](_0x20cb47,_0x20cb47+path[_0x569576(0x1ff)]+'%');let _0x55ef02=_0x569576(0x222)+dbFileIndexTable[_0x569576(0x212)]+_0x569576(0x1d9),_0x4b4440=_0x4c5968[_0x569576(0x237)][_0x569576(0x1e7)][_0x569576(0x213)](_0x55ef02)[_0x569576(0x230)](_0x20cb47,_0x20cb47+path[_0x569576(0x1ff)]+'%'),_0x2e6b9a=[];for(let _0x40d4d0 of _0x4b4440){movieInfoUtil[_0x569576(0x1e2)](_0x4c5968[_0x569576(0x237)][_0x569576(0x1e7)],_0x40d4d0['id'],{}),_0x2e6b9a[_0x569576(0x23e)](deleteMovieInfoOfIndex(_0x4c5968,_0x40d4d0));}Promise[_0x569576(0x243)](_0x2e6b9a)[_0x569576(0x229)](_0x221af7=>{const _0x308304=_0x569576;return process[_0x308304(0x1d5)]({'type':'SWITCH_MOVIE_INFO'}),_0x46dae9[_0x308304(0x22b)]({'code':0x0});});});function deleteMovieInfoOfIndex(_0xcacf60,_0x374d66){return new Promise((_0x237769,_0x330441)=>{const _0x23212c=_0x1768;let _0x6642f4=path[_0x23212c(0x1ed)](_0x374d66[_0x23212c(0x1d6)],_0x374d66[_0x23212c(0x1f0)]['substring'](0x0,_0x374d66[_0x23212c(0x1f0)][_0x23212c(0x238)](_0x374d66['ext']))+'.jpg'),_0x298fc8=path[_0x23212c(0x1ed)](_0x374d66['path'],_0x374d66[_0x23212c(0x1f0)]['substring'](0x0,_0x374d66[_0x23212c(0x1f0)][_0x23212c(0x238)](_0x374d66[_0x23212c(0x223)]))+'-thumb.jpg'),_0x14eabb=path[_0x23212c(0x1ed)](_0x374d66['path'],_0x374d66[_0x23212c(0x1f0)]['substring'](0x0,_0x374d66[_0x23212c(0x1f0)][_0x23212c(0x238)](_0x374d66[_0x23212c(0x223)]))+_0x23212c(0x21b)),_0x5a2bab=path['join'](_0x374d66[_0x23212c(0x1d6)],_0x374d66[_0x23212c(0x1f0)]['substring'](0x0,_0x374d66['filename'][_0x23212c(0x238)](_0x374d66[_0x23212c(0x223)]))+'-poster.jpg'),_0x298de0=path[_0x23212c(0x1ed)](_0x374d66[_0x23212c(0x1d6)],_0x23212c(0x218)),_0x1a6f85=path[_0x23212c(0x1ed)](_0x374d66[_0x23212c(0x1d6)],_0x374d66[_0x23212c(0x1f0)]['substring'](0x0,_0x374d66[_0x23212c(0x1f0)]['lastIndexOf'](_0x374d66[_0x23212c(0x223)]))+_0x23212c(0x21c)),_0x51d8a6=[_0x6642f4,_0x298de0,_0x298fc8,_0x14eabb,_0x5a2bab,_0x1a6f85];if(_0x374d66['is_tvplay']==0x1){let _0x596d60=path[_0x23212c(0x1ed)](_0x374d66['path'],_0x23212c(0x1f9)),_0x244d38=path['join'](_0x374d66['path'],_0x23212c(0x1d2));_0x51d8a6['push'](_0x596d60),_0x51d8a6[_0x23212c(0x23e)](_0x244d38);let _0x564642=path[_0x23212c(0x1ea)](_0x374d66[_0x23212c(0x1d6)]),_0x31cc06=path[_0x23212c(0x1dc)](_0x374d66[_0x23212c(0x1d6)]),_0x2750e5=movieSeasonUtil[_0x23212c(0x1fd)](_0x564642);if(_0x2750e5>0x0){let _0x8296fb=path[_0x23212c(0x1ed)](_0x31cc06,_0x23212c(0x1f9));_0x51d8a6['push'](_0x8296fb);_0x2750e5<0xa&&(_0x2750e5='0'+_0x2750e5);let _0x6d09d9=path[_0x23212c(0x1ed)](_0x31cc06,_0x23212c(0x246)+_0x2750e5+'-poster.jpg');_0x51d8a6[_0x23212c(0x23e)](_0x6d09d9);let _0xbbffb7=path[_0x23212c(0x1ed)](_0x31cc06,'poster.jpg');_0x51d8a6[_0x23212c(0x23e)](_0xbbffb7);let _0x2292ae=path['join'](_0x31cc06,_0x23212c(0x21d));_0x51d8a6['push'](_0x2292ae);}}console['log']('要清除的nfo和海报文件列表',_0x51d8a6);function _0x4ce198(){const _0x380d44=_0x23212c;_0x51d8a6[_0x380d44(0x206)]>0x0?fs['stat'](_0x51d8a6[0x0],(_0x102bf4,_0x25f86a)=>{const _0x2a5678=_0x380d44;!_0x102bf4&&_0x25f86a&&_0x25f86a['isFile']()?(console[_0x2a5678(0x202)]('清理',_0x51d8a6[0x0]),fs['rm'](_0x51d8a6[0x0],_0x5c7aa4=>{const _0x4ffc1b=_0x2a5678;let _0x28abdf=_0x51d8a6[0x0];_0x51d8a6[_0x4ffc1b(0x22d)](0x0,0x1),!_0x5c7aa4&&(console[_0x4ffc1b(0x202)](_0x4ffc1b(0x1e5),_0x28abdf),dbFileOperationRecord[_0x4ffc1b(0x208)](_0xcacf60[_0x4ffc1b(0x237)][_0x4ffc1b(0x1d3)],{'username':_0xcacf60[_0x4ffc1b(0x1fa)][_0x4ffc1b(0x1e4)],'targetPath':_0x28abdf,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x4ffc1b(0x200)],'state':dbFileOperationRecord[_0x4ffc1b(0x1d4)]})),_0x4ce198();})):(_0x51d8a6[_0x2a5678(0x22d)](0x0,0x1),_0x4ce198());}):(movieInfoUtil[_0x380d44(0x1e2)](_0xcacf60[_0x380d44(0x237)][_0x380d44(0x1e7)],_0x374d66['id'],{}),_0x237769());}_0x4ce198();});}function clearInfo(_0x186aed,_0x3f4823,_0x461355){return new Promise((_0x339ee9,_0x3e79e6)=>{const _0x2ebddb=_0x1768;if(dbUserTable[_0x2ebddb(0x204)](_0x186aed,_0x3f4823,'','power_delete',_0x461355[_0x2ebddb(0x1d6)])==!![]){if(_0x461355[_0x2ebddb(0x240)]==0x1){let _0x2ffd6e=_0x2ebddb(0x222)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+'\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20',_0x27863d=_0x186aed[_0x2ebddb(0x237)][_0x2ebddb(0x1e7)][_0x2ebddb(0x213)](_0x2ffd6e)[_0x2ebddb(0x230)](_0x461355['path']),_0x5c249e=[];for(let _0x445d5c of _0x27863d){_0x5c249e[_0x2ebddb(0x23e)](deleteMovieInfoOfIndex(_0x186aed,_0x445d5c));}if(_0x5c249e[_0x2ebddb(0x206)]<0x1)return _0x339ee9();Promise[_0x2ebddb(0x243)](_0x5c249e)[_0x2ebddb(0x229)](_0x1cefa2=>{return _0x339ee9();})[_0x2ebddb(0x1f1)](_0x6c35fb=>{return _0x339ee9();});}else deleteMovieInfoOfIndex(_0x186aed,_0x461355)[_0x2ebddb(0x229)](_0xab9e10=>{return _0x339ee9();});}});}router[_0x10869e(0x247)](_0x10869e(0x21e),(_0x58c3db,_0x2eae3b,_0x397ad9)=>{const _0x2b7efa=_0x10869e;let _0x48c95a=_0x58c3db[_0x2b7efa(0x1da)]['indexId'],_0x5b1e62=dbFileIndexTable[_0x2b7efa(0x225)](_0x58c3db['app'][_0x2b7efa(0x1e7)],_0x48c95a,dbFileIndexTable[_0x2b7efa(0x212)]);if(!_0x5b1e62)return _0x58c3db['app']['returnErrMsg'](_0x2eae3b,'indexId\x20error');clearInfo(_0x58c3db,_0x2eae3b,_0x5b1e62)['then'](()=>{const _0x1c1c34=_0x2b7efa;return _0x2eae3b[_0x1c1c34(0x22b)]({'code':0x0});});}),router[_0x10869e(0x247)](_0x10869e(0x1ee),(_0x30551e,_0x35db76,_0x53be82)=>{const _0xa404df=_0x10869e;let _0x5dd2a4=_0x30551e[_0xa404df(0x1da)][_0xa404df(0x1e1)],_0x4fea6a=dbFileIndexTable['getById'](_0x30551e[_0xa404df(0x237)][_0xa404df(0x1e7)],_0x5dd2a4,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x2e3874=_0x30551e['body'][_0xa404df(0x245)];if(!_0x4fea6a||!_0x2e3874)return _0x30551e['app'][_0xa404df(0x20c)](_0x35db76,_0xa404df(0x1e8));dbUserTable[_0xa404df(0x204)](_0x30551e,_0x35db76,'','power_change',_0x4fea6a[_0xa404df(0x1d6)])==!![]&&clearInfo(_0x30551e,_0x35db76,_0x4fea6a)[_0xa404df(0x229)](()=>{const _0x793307=_0xa404df;return movieInfoUtil[_0x793307(0x23d)](_0x30551e[_0x793307(0x237)]['dbOther'],_0x4fea6a['path'],_0x4fea6a[_0x793307(0x1f0)],_0x4fea6a[_0x793307(0x240)],_0x2e3874)[_0x793307(0x229)](()=>{const _0x15e564=_0x793307;if(_0x4fea6a[_0x15e564(0x240)]==0x0)updateIndexByNfo(_0x30551e[_0x15e564(0x237)][_0x15e564(0x1e7)],_0x4fea6a)[_0x15e564(0x229)](()=>{});else{}})['catch'](_0x517606=>{const _0x54d3e0=_0x793307;return console[_0x54d3e0(0x202)](_0x517606),_0x30551e['app'][_0x54d3e0(0x20c)](_0x35db76,_0x35db76['__'](_0x54d3e0(0x1e3)));}),_0x35db76[_0x793307(0x22b)]({'code':0x0});});}),router['get']('/getImdbImg',(_0x65d583,_0x3289e1,_0x39fa31)=>{const _0x2b18a5=_0x10869e;let _0x26f8d1=_0x65d583[_0x2b18a5(0x1f3)][_0x2b18a5(0x1d1)];if(!_0x26f8d1||!_0x26f8d1[_0x2b18a5(0x228)](_0x2b18a5(0x1e0))==-0x1)return _0x3289e1['status'](0x194)[_0x2b18a5(0x231)]();_0x26f8d1=decodeURIComponent(_0x26f8d1);let _0x178123=path['join'](config[_0x2b18a5(0x249)],sha256(_0x26f8d1));function _0x40c638(){const _0x10dbaf=_0x2b18a5;sharp(_0x178123,{'failOnError':![]})[_0x10dbaf(0x1db)]({'quality':0x4d})[_0x10dbaf(0x1d8)]({'width':0x1f4})[_0x10dbaf(0x21f)]()[_0x10dbaf(0x229)](_0x4a129c=>{const _0x2836b7=_0x10dbaf;return _0x3289e1[_0x2836b7(0x1d5)](_0x4a129c);})['catch'](_0x676f24=>{const _0x421370=_0x10dbaf;return console[_0x421370(0x202)](_0x421370(0x23f),_0x676f24),_0x3289e1['status'](0x194)[_0x421370(0x231)]();});}fs['stat'](_0x178123,(_0x5c0109,_0x5baff2)=>{const _0x5746c8=_0x2b18a5;if(!_0x5c0109)return _0x40c638();_0x65d583[_0x5746c8(0x1f3)][_0x5746c8(0x239)]==0x1?httpUtil[_0x5746c8(0x203)](_0x65d583[_0x5746c8(0x237)][_0x5746c8(0x1d3)],_0x26f8d1)[_0x5746c8(0x229)](_0x5a9a49=>{const _0x2cb6da=_0x5746c8;return _0x5a9a49[_0x2cb6da(0x1f6)](_0x3289e1);})[_0x5746c8(0x1f1)](_0x582a45=>{const _0x1aa260=_0x5746c8;return _0x3289e1['status'](0x194)[_0x1aa260(0x231)]();}):httpUtil[_0x5746c8(0x203)](_0x65d583[_0x5746c8(0x237)][_0x5746c8(0x1d3)],_0x26f8d1,_0x178123)[_0x5746c8(0x229)](_0x18e52f=>{_0x40c638();})[_0x5746c8(0x1f1)](_0x5c39fd=>{const _0x1a2114=_0x5746c8;return _0x3289e1[_0x1a2114(0x23a)](0x194)[_0x1a2114(0x231)]();});});}),module[_0x10869e(0x214)]=router;