const _0x52fd5e=_0x2dbd;(function(_0x16a314,_0xc7f1a0){const _0x2edecb=_0x2dbd,_0xa86a40=_0x16a314();while(!![]){try{const _0x3ea829=parseInt(_0x2edecb(0x135))/0x1+-parseInt(_0x2edecb(0xc1))/0x2+-parseInt(_0x2edecb(0x116))/0x3*(-parseInt(_0x2edecb(0xc3))/0x4)+-parseInt(_0x2edecb(0xd6))/0x5*(parseInt(_0x2edecb(0x101))/0x6)+-parseInt(_0x2edecb(0xdc))/0x7+parseInt(_0x2edecb(0xf5))/0x8*(-parseInt(_0x2edecb(0xf1))/0x9)+parseInt(_0x2edecb(0xd0))/0xa;if(_0x3ea829===_0xc7f1a0)break;else _0xa86a40['push'](_0xa86a40['shift']());}catch(_0x2ed131){_0xa86a40['push'](_0xa86a40['shift']());}}}(_0x255b,0x696e0));function _0x255b(){const _0x1e4821=['-thumb.jpg','15978860oYxPWm','send','push','SWITCH_MOVIE_INFO','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','../../db/dbUserTable','812495dnqvXq','doUserCanGet','power_delete','/testTmdbProxy','indexId\x20error','sep','2368723covdzA','getSeasonNumber','movieTmdbLanguage','/clearNfoImg','lastIndexOf','returnErrMsg','season','status_code','jpeg','operationFail','basename','scrapeMissing','tvshow.nfo','url','STATE_SUC','SELECT\x20*\x20FROM\x20','path','all','status','then','posterPath','279LfuugX','dbOther','params\x20error','-fanart.jpg','148424aifNpA','ext','headersSent','Need\x20tmdb\x20api\x20url','fanart.jpg','catch','json','indexId/tmdbId\x20error','parseNfo','LEVEL_MAIN_OPERATION','offset','axios','12tFtfXl','movieTmdbApiUrl','API','post','username','要清除的nfo和海报文件列表','is_tvplay','pipe','tmdb','../../utils/movieSeasonUtil','run','query','/getScrapeLog','express','splice','getById','../../utils/movieInfoTmdbApi','TMDB\x20search接口请求失败','stat','runSearchNfoWorker','count','6366nMAeHZ','sha256','/testTmdb','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?','../../utils/movieInfoUtil','INDEX_TABLE_NAME_MOVIE','../../utils/httpUtil','search','season.nfo','log','/setMovieInfo','power_change','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','app','../../utils/nfoUtil','substring','downloadImg','刮削文件清理成功','poster.jpg','searchMediaType','languageList','get','page','TYPE_DELETE','exports','filename','Need\x20tmdb\x20key','searchType','message','body','isFile','178361vzeTZP','getProxyUrl','toBuffer','allSettled','/scrapeAgain','tmdbId','TMDBID','movieTmdbApiKey','addFileOperationRecord','-poster.jpg','end','join','need\x20folder','899282NPDmwy','currentUser','648pLtQbm','length','prepare','dbFileIndex','Router','indexId','getTmdbApi','saveMovieInfoToDb','/clearScrapeLog','getDetail','status_message','is_admin'];_0x255b=function(){return _0x1e4821;};return _0x255b();}var express=require(_0x52fd5e(0x10e)),router=express[_0x52fd5e(0xc7)]();const fs=require('fs'),sharp=require('sharp'),axios=require(_0x52fd5e(0x100));let sha256=require(_0x52fd5e(0x117)),path=require(_0x52fd5e(0xec)),config=require('../../myConfig/config');const tmdbApi=require(_0x52fd5e(0x111)),movieInfoUtil=require(_0x52fd5e(0x11a)),movieSeasonUtil=require(_0x52fd5e(0x10a)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbUserTable=require(_0x52fd5e(0xd5)),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),nfoUtil=require(_0x52fd5e(0x124)),httpUtil=require(_0x52fd5e(0x11c));function _0x2dbd(_0x21882f,_0x444988){const _0x255b0d=_0x255b();return _0x2dbd=function(_0x2dbdaf,_0xa0ed3){_0x2dbdaf=_0x2dbdaf-0xb5;let _0x21a215=_0x255b0d[_0x2dbdaf];return _0x21a215;},_0x2dbd(_0x21882f,_0x444988);}router[_0x52fd5e(0x104)](_0x52fd5e(0x118),(_0x354aef,_0x1d644b,_0x47f6c2)=>{const _0x4eeb8c=_0x52fd5e;if(_0x354aef[_0x4eeb8c(0xc2)][_0x4eeb8c(0xce)]!=0x1)return _0x1d644b[_0x4eeb8c(0xfb)]({'code':0x66});let _0x5715a8=_0x354aef[_0x4eeb8c(0x133)][_0x4eeb8c(0xde)],_0x4b77ce=_0x354aef['body'][_0x4eeb8c(0x102)],_0x500c0d=_0x354aef[_0x4eeb8c(0x133)][_0x4eeb8c(0xbb)];if(!_0x5715a8)return _0x354aef[_0x4eeb8c(0x123)][_0x4eeb8c(0xe1)](_0x1d644b,'Need\x20tmdb\x20language');if(!_0x4b77ce)return _0x354aef[_0x4eeb8c(0x123)]['returnErrMsg'](_0x1d644b,_0x4eeb8c(0xf8));if(!_0x500c0d)return _0x354aef[_0x4eeb8c(0x123)][_0x4eeb8c(0xe1)](_0x1d644b,_0x4eeb8c(0x130));let _0x324ad4=movieInfoUtil[_0x4eeb8c(0xb5)](_0x354aef[_0x4eeb8c(0x123)][_0x4eeb8c(0xf2)]),_0x550385=new tmdbApi[(_0x4eeb8c(0x103))](_0x500c0d,_0x5715a8,_0x4b77ce,_0x324ad4);_0x550385[_0x4eeb8c(0x12a)]()[_0x4eeb8c(0xef)](_0x1c413f=>{const _0x2e6255=_0x4eeb8c;if(_0x1c413f['success']==![]||_0x1c413f[_0x2e6255(0xe3)])return _0x1d644b[_0x2e6255(0xfb)]({'code':0x2,'msg':_0x1c413f['status_message']});return _0x1d644b['json']({'code':0x0,'data':[]});})[_0x4eeb8c(0xfa)](_0x469db3=>{const _0x4fc260=_0x4eeb8c;let _0x4cf073='TMDB\x20Error';if(_0x469db3){if(_0x469db3[_0x4fc260(0xe3)])_0x4cf073+=':'+_0x469db3[_0x4fc260(0xcd)];else _0x469db3[_0x4fc260(0x132)]&&(_0x4cf073+=':'+_0x469db3[_0x4fc260(0x132)]);}return _0x1d644b['json']({'code':0x2,'msg':_0x4cf073,'data':[]});});}),router[_0x52fd5e(0x104)](_0x52fd5e(0xd9),(_0x37a7c4,_0x189843,_0x3c568a)=>{const _0x4e2081=_0x52fd5e;if(_0x37a7c4['currentUser'][_0x4e2081(0xce)]!=0x1)return _0x189843[_0x4e2081(0xfb)]({'code':0x66});movieInfoUtil['testTmdb'](_0x37a7c4[_0x4e2081(0x123)][_0x4e2081(0xf2)])[_0x4e2081(0xef)](()=>{const _0x2af522=_0x4e2081;return _0x189843[_0x2af522(0xfb)]({'code':0x0});})[_0x4e2081(0xfa)](_0x5cbef4=>{const _0x182c7c=_0x4e2081;return _0x189843[_0x182c7c(0xfb)]({'code':0x2,'msg':_0x5cbef4});});}),router[_0x52fd5e(0x104)]('/searchMovieInfo',(_0x27b523,_0x2d7e7c,_0x1b461e)=>{const _0x1de470=_0x52fd5e;let _0x31d3df=_0x27b523[_0x1de470(0x133)]['searchStr'],_0x110e02=_0x27b523[_0x1de470(0x133)][_0x1de470(0x131)],_0x72429a=_0x27b523[_0x1de470(0x133)][_0x1de470(0x129)],_0x32b406=_0x27b523['body'][_0x1de470(0x12c)];if(!_0x31d3df||!_0x110e02||!_0x72429a)return _0x27b523[_0x1de470(0x123)][_0x1de470(0xe1)](_0x2d7e7c,_0x1de470(0xf3));let _0x1080db=movieInfoUtil[_0x1de470(0xc9)](_0x27b523[_0x1de470(0x123)][_0x1de470(0xf2)]);if(_0x110e02=='KEYWORD')_0x1080db[_0x1de470(0x11d)](_0x31d3df,_0x72429a=='TV',null,_0x32b406,!![])[_0x1de470(0xef)](_0x592911=>{const _0x135600=_0x1de470;if(!_0x2d7e7c[_0x135600(0xf7)])return _0x2d7e7c[_0x135600(0xfb)]({'code':0x0,'data':_0x592911});})[_0x1de470(0xfa)](_0x351d31=>{const _0x5d1eb6=_0x1de470;console[_0x5d1eb6(0x11f)](_0x5d1eb6(0x112),_0x351d31);if(_0x351d31&&_0x351d31[_0x5d1eb6(0xe3)]&&_0x351d31['status_message'])return _0x27b523[_0x5d1eb6(0x123)][_0x5d1eb6(0xe1)](_0x2d7e7c,_0x351d31[_0x5d1eb6(0xcd)]);if(!_0x2d7e7c[_0x5d1eb6(0xf7)])return _0x2d7e7c[_0x5d1eb6(0xfb)]({'code':0x0,'data':[]});});else{if(_0x110e02==_0x1de470(0xba))_0x1080db[_0x1de470(0xcc)](_0x31d3df,_0x72429a=='TV')[_0x1de470(0xef)](_0x511c52=>{const _0x32266e=_0x1de470;if(!_0x2d7e7c[_0x32266e(0xf7)])return _0x2d7e7c['json']({'code':0x0,'data':[_0x511c52]});})['catch'](_0x7c5157=>{const _0x1794bb=_0x1de470;console[_0x1794bb(0x11f)](_0x1794bb(0x112),_0x7c5157);if(_0x7c5157&&_0x7c5157[_0x1794bb(0xe3)]&&_0x7c5157['status_message'])return _0x27b523[_0x1794bb(0x123)]['returnErrMsg'](_0x2d7e7c,_0x7c5157[_0x1794bb(0xcd)]);if(!_0x2d7e7c[_0x1794bb(0xf7)])return _0x2d7e7c[_0x1794bb(0xfb)]({'code':0x0,'data':[]});});else{if(!_0x2d7e7c[_0x1de470(0xf7)])return _0x2d7e7c[_0x1de470(0xfb)]({'code':0x0,'data':[]});}}});function updateIndexByNfo(_0x3b3262,_0x53a93c){return new Promise((_0xf5c4a0,_0x512576)=>{const _0x4a83e3=_0x2dbd;nfoUtil[_0x4a83e3(0xfd)](_0x53a93c,!![],![])['then'](_0x1b839d=>{const _0x174209=_0x4a83e3;return movieInfoUtil[_0x174209(0xca)](_0x3b3262,_0x53a93c['id'],_0x1b839d),_0xf5c4a0();})[_0x4a83e3(0xfa)](_0x4c891c=>{return _0xf5c4a0();});});}router[_0x52fd5e(0x104)](_0x52fd5e(0xb8),(_0xd18c7b,_0x64ab18,_0x541947)=>{const _0x1d065a=_0x52fd5e;let _0x387e4b=_0xd18c7b[_0x1d065a(0x133)][_0x1d065a(0xc8)],_0x2e369a=_0xd18c7b[_0x1d065a(0x133)][_0x1d065a(0xe7)],_0x240630=dbFileIndexTable[_0x1d065a(0x110)](_0xd18c7b['app'][_0x1d065a(0xc6)],_0x387e4b,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x240630)return _0xd18c7b['app']['returnErrMsg'](_0x64ab18,'indexId\x20error');if(dbUserTable[_0x1d065a(0xd7)](_0xd18c7b,_0x64ab18,'','power_change',_0x240630[_0x1d065a(0xec)])==!![]){function _0x49ca65(){const _0x518c27=_0x1d065a;movieInfoUtil[_0x518c27(0x114)](_0xd18c7b[_0x518c27(0x123)][_0x518c27(0xf2)],_0x240630[_0x518c27(0xec)],_0x240630[_0x518c27(0x12f)],_0x240630['is_tvplay'],null,_0x2e369a)[_0x518c27(0xef)](()=>{const _0x421914=_0x518c27;_0x240630['is_tvplay']==0x0&&updateIndexByNfo(_0xd18c7b[_0x421914(0x123)][_0x421914(0xc6)],_0x240630)[_0x421914(0xef)](()=>{});})[_0x518c27(0xfa)](_0x4c787d=>{});}_0x2e369a==0x1?_0x49ca65():clearInfo(_0xd18c7b,_0x64ab18,_0x240630)['then'](()=>{_0x49ca65();});if(!_0x64ab18[_0x1d065a(0xf7)])return _0x64ab18['json']({'code':0x0});}}),router['post'](_0x52fd5e(0x10d),(_0x205ed1,_0x23ebe3,_0x544d42)=>{const _0x17ecbb=_0x52fd5e;if(_0x205ed1['currentUser']['is_admin']!=0x1)return _0x23ebe3['json']({'code':0x66});let _0x282ca8=_0x205ed1[_0x17ecbb(0x133)][_0x17ecbb(0x115)]||0x1e,_0x1e7481=_0x205ed1[_0x17ecbb(0x133)][_0x17ecbb(0xff)]||0x0;const _0x474378=_0x17ecbb(0x122);let _0x8add5=_0x205ed1['app']['dbFileIndex'][_0x17ecbb(0xc5)](_0x474378)['all'](_0x282ca8,_0x1e7481);return _0x23ebe3[_0x17ecbb(0xfb)]({'code':0x0,'data':_0x8add5});}),router['post'](_0x52fd5e(0xcb),(_0x536f69,_0x3d37b7,_0x5629cb)=>{const _0x25f0c6=_0x52fd5e;if(_0x536f69['currentUser'][_0x25f0c6(0xce)]!=0x1)return _0x3d37b7[_0x25f0c6(0xfb)]({'code':0x66});const _0x5d3420=_0x25f0c6(0xd4);return _0x536f69['app'][_0x25f0c6(0xc6)]['prepare'](_0x5d3420)[_0x25f0c6(0x10b)](),_0x3d37b7[_0x25f0c6(0xfb)]({'code':0x0});}),router[_0x52fd5e(0x104)](_0x52fd5e(0xdf),(_0x2cf948,_0x5c2b4d,_0x39ca1b)=>{const _0x42e087=_0x52fd5e;if(_0x2cf948[_0x42e087(0xc2)]['is_admin']!=0x1)return _0x5c2b4d['json']({'code':0x66});let _0x2700ff=_0x2cf948[_0x42e087(0x133)]['sourceFolder'];if(!_0x2700ff)return _0x2cf948[_0x42e087(0x123)]['returnErrMsg'](_0x5c2b4d,_0x42e087(0xc0));const _0x467ec9='UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?';_0x2cf948[_0x42e087(0x123)][_0x42e087(0xc6)][_0x42e087(0xc5)](_0x467ec9)['run'](_0x2700ff,_0x2700ff+path['sep']+'%');let _0x6281c8=_0x42e087(0xeb)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x42e087(0x119),_0x2d4b47=_0x2cf948['app'][_0x42e087(0xc6)][_0x42e087(0xc5)](_0x6281c8)[_0x42e087(0xed)](_0x2700ff,_0x2700ff+path[_0x42e087(0xdb)]+'%'),_0x401a47=[];for(let _0x390aec of _0x2d4b47){movieInfoUtil[_0x42e087(0xca)](_0x2cf948[_0x42e087(0x123)]['dbFileIndex'],_0x390aec['id'],{}),_0x401a47[_0x42e087(0xd2)](deleteMovieInfoOfIndex(_0x2cf948,_0x390aec));}Promise[_0x42e087(0xb7)](_0x401a47)[_0x42e087(0xef)](_0x433eaf=>{const _0x5e6a38=_0x42e087;return process[_0x5e6a38(0xd1)]({'type':_0x5e6a38(0xd3)}),_0x5c2b4d[_0x5e6a38(0xfb)]({'code':0x0});});});function deleteMovieInfoOfIndex(_0x4f2e06,_0x23d9aa){return new Promise((_0x10aeb9,_0x12f025)=>{const _0x42eca4=_0x2dbd;let _0x496e85=path[_0x42eca4(0xbf)](_0x23d9aa[_0x42eca4(0xec)],_0x23d9aa[_0x42eca4(0x12f)][_0x42eca4(0x125)](0x0,_0x23d9aa['filename'][_0x42eca4(0xe0)](_0x23d9aa[_0x42eca4(0xf6)]))+'.jpg'),_0x59753c=path[_0x42eca4(0xbf)](_0x23d9aa[_0x42eca4(0xec)],_0x23d9aa['filename'][_0x42eca4(0x125)](0x0,_0x23d9aa[_0x42eca4(0x12f)][_0x42eca4(0xe0)](_0x23d9aa['ext']))+_0x42eca4(0xcf)),_0x450616=path[_0x42eca4(0xbf)](_0x23d9aa[_0x42eca4(0xec)],_0x23d9aa[_0x42eca4(0x12f)][_0x42eca4(0x125)](0x0,_0x23d9aa['filename']['lastIndexOf'](_0x23d9aa[_0x42eca4(0xf6)]))+_0x42eca4(0xf4)),_0x44f561=path['join'](_0x23d9aa['path'],_0x23d9aa[_0x42eca4(0x12f)][_0x42eca4(0x125)](0x0,_0x23d9aa['filename']['lastIndexOf'](_0x23d9aa[_0x42eca4(0xf6)]))+_0x42eca4(0xbd)),_0x44f52a=path['join'](_0x23d9aa[_0x42eca4(0xec)],_0x42eca4(0x128)),_0x30cfd7=path[_0x42eca4(0xbf)](_0x23d9aa[_0x42eca4(0xec)],_0x23d9aa[_0x42eca4(0x12f)][_0x42eca4(0x125)](0x0,_0x23d9aa[_0x42eca4(0x12f)][_0x42eca4(0xe0)](_0x23d9aa[_0x42eca4(0xf6)]))+'.nfo'),_0x5d71b2=[_0x496e85,_0x44f52a,_0x59753c,_0x450616,_0x44f561,_0x30cfd7];if(_0x23d9aa[_0x42eca4(0x107)]==0x1){let _0x5cce6c=path[_0x42eca4(0xbf)](_0x23d9aa['path'],_0x42eca4(0xe8)),_0x3536cf=path[_0x42eca4(0xbf)](_0x23d9aa['path'],_0x42eca4(0x11e));_0x5d71b2[_0x42eca4(0xd2)](_0x5cce6c),_0x5d71b2[_0x42eca4(0xd2)](_0x3536cf);let _0x1ab978=path[_0x42eca4(0xe6)](_0x23d9aa[_0x42eca4(0xec)]),_0x5883ba=path['dirname'](_0x23d9aa['path']),_0x8ae458=movieSeasonUtil[_0x42eca4(0xdd)](_0x1ab978);if(_0x8ae458>0x0){let _0x29f693=path[_0x42eca4(0xbf)](_0x5883ba,_0x42eca4(0xe8));_0x5d71b2[_0x42eca4(0xd2)](_0x29f693);_0x8ae458<0xa&&(_0x8ae458='0'+_0x8ae458);let _0x5c15de=path[_0x42eca4(0xbf)](_0x5883ba,_0x42eca4(0xe2)+_0x8ae458+_0x42eca4(0xbd));_0x5d71b2[_0x42eca4(0xd2)](_0x5c15de);let _0x55c2b1=path[_0x42eca4(0xbf)](_0x5883ba,_0x42eca4(0x128));_0x5d71b2[_0x42eca4(0xd2)](_0x55c2b1);let _0xbb1a0e=path['join'](_0x5883ba,_0x42eca4(0xf9));_0x5d71b2[_0x42eca4(0xd2)](_0xbb1a0e);}}console[_0x42eca4(0x11f)](_0x42eca4(0x106),_0x5d71b2);function _0x170e09(){const _0xcee466=_0x42eca4;_0x5d71b2[_0xcee466(0xc4)]>0x0?fs[_0xcee466(0x113)](_0x5d71b2[0x0],(_0x540d6e,_0x59d9e2)=>{const _0x47443d=_0xcee466;!_0x540d6e&&_0x59d9e2&&_0x59d9e2[_0x47443d(0x134)]()?(console['log']('清理',_0x5d71b2[0x0]),fs['rm'](_0x5d71b2[0x0],_0x3079bb=>{const _0x388f4d=_0x47443d;let _0x23bfc2=_0x5d71b2[0x0];_0x5d71b2[_0x388f4d(0x10f)](0x0,0x1),!_0x3079bb&&(console[_0x388f4d(0x11f)](_0x388f4d(0x127),_0x23bfc2),dbFileOperationRecord[_0x388f4d(0xbc)](_0x4f2e06['app']['dbOther'],{'username':_0x4f2e06[_0x388f4d(0xc2)][_0x388f4d(0x105)],'targetPath':_0x23bfc2,'level':dbFileOperationRecord[_0x388f4d(0xfe)],'type':dbFileOperationRecord[_0x388f4d(0x12d)],'state':dbFileOperationRecord[_0x388f4d(0xea)]})),_0x170e09();})):(_0x5d71b2['splice'](0x0,0x1),_0x170e09());}):(movieInfoUtil[_0xcee466(0xca)](_0x4f2e06[_0xcee466(0x123)][_0xcee466(0xc6)],_0x23d9aa['id'],{}),_0x10aeb9());}_0x170e09();});}function clearInfo(_0x2b0148,_0x273506,_0x82eaf5){return new Promise((_0x539cbc,_0x2b3f4b)=>{const _0x42ae4a=_0x2dbd;if(dbUserTable['doUserCanGet'](_0x2b0148,_0x273506,'',_0x42ae4a(0xd8),_0x82eaf5[_0x42ae4a(0xec)])==!![]){if(_0x82eaf5[_0x42ae4a(0x107)]==0x1){let _0x328653='SELECT\x20*\x20FROM\x20'+dbFileIndexTable[_0x42ae4a(0x11b)]+'\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20',_0x2b7b7e=_0x2b0148[_0x42ae4a(0x123)][_0x42ae4a(0xc6)]['prepare'](_0x328653)[_0x42ae4a(0xed)](_0x82eaf5[_0x42ae4a(0xec)]),_0x2aa387=[];for(let _0x22e475 of _0x2b7b7e){_0x2aa387[_0x42ae4a(0xd2)](deleteMovieInfoOfIndex(_0x2b0148,_0x22e475));}if(_0x2aa387[_0x42ae4a(0xc4)]<0x1)return _0x539cbc();Promise[_0x42ae4a(0xb7)](_0x2aa387)[_0x42ae4a(0xef)](_0x45d4a4=>{return _0x539cbc();})[_0x42ae4a(0xfa)](_0x39f6ef=>{return _0x539cbc();});}else deleteMovieInfoOfIndex(_0x2b0148,_0x82eaf5)[_0x42ae4a(0xef)](_0x4db667=>{return _0x539cbc();});}});}router[_0x52fd5e(0x104)]('/clearMovieInfo',(_0x5cfe34,_0x306e41,_0x3910d5)=>{const _0x2776cf=_0x52fd5e;let _0x28b3ea=_0x5cfe34[_0x2776cf(0x133)][_0x2776cf(0xc8)],_0x348b51=dbFileIndexTable[_0x2776cf(0x110)](_0x5cfe34[_0x2776cf(0x123)][_0x2776cf(0xc6)],_0x28b3ea,dbFileIndexTable[_0x2776cf(0x11b)]);if(!_0x348b51)return _0x5cfe34[_0x2776cf(0x123)][_0x2776cf(0xe1)](_0x306e41,_0x2776cf(0xda));clearInfo(_0x5cfe34,_0x306e41,_0x348b51)[_0x2776cf(0xef)](()=>{return _0x306e41['json']({'code':0x0});});}),router[_0x52fd5e(0x104)](_0x52fd5e(0x120),(_0x197af2,_0x2580eb,_0x18a533)=>{const _0x20bfec=_0x52fd5e;let _0x10cd63=_0x197af2['body'][_0x20bfec(0xc8)],_0x1971c9=dbFileIndexTable[_0x20bfec(0x110)](_0x197af2[_0x20bfec(0x123)][_0x20bfec(0xc6)],_0x10cd63,dbFileIndexTable[_0x20bfec(0x11b)]),_0xf76fd=_0x197af2[_0x20bfec(0x133)][_0x20bfec(0xb9)];if(!_0x1971c9||!_0xf76fd)return _0x197af2[_0x20bfec(0x123)][_0x20bfec(0xe1)](_0x2580eb,_0x20bfec(0xfc));dbUserTable['doUserCanGet'](_0x197af2,_0x2580eb,'',_0x20bfec(0x121),_0x1971c9[_0x20bfec(0xec)])==!![]&&clearInfo(_0x197af2,_0x2580eb,_0x1971c9)[_0x20bfec(0xef)](()=>{const _0x2cb5e7=_0x20bfec;return movieInfoUtil[_0x2cb5e7(0x114)](_0x197af2[_0x2cb5e7(0x123)][_0x2cb5e7(0xf2)],_0x1971c9['path'],_0x1971c9['filename'],_0x1971c9['is_tvplay'],_0xf76fd)[_0x2cb5e7(0xef)](()=>{const _0x155ae4=_0x2cb5e7;if(_0x1971c9['is_tvplay']==0x0)updateIndexByNfo(_0x197af2[_0x155ae4(0x123)]['dbFileIndex'],_0x1971c9)['then'](()=>{});else{}})['catch'](_0x40da93=>{const _0x1a11bc=_0x2cb5e7;return console[_0x1a11bc(0x11f)](_0x40da93),_0x197af2['app'][_0x1a11bc(0xe1)](_0x2580eb,_0x2580eb['__'](_0x1a11bc(0xe5)));}),_0x2580eb['json']({'code':0x0});});}),router[_0x52fd5e(0x12b)]('/getImdbImg',(_0x316a07,_0x36d515,_0x7b064f)=>{const _0x264e13=_0x52fd5e;let _0x526443=_0x316a07['query'][_0x264e13(0xe9)];if(!_0x526443||!_0x526443['indexOf'](_0x264e13(0x109))==-0x1)return _0x36d515[_0x264e13(0xee)](0x194)[_0x264e13(0xbe)]();_0x526443=decodeURIComponent(_0x526443);let _0x4c8cef=path[_0x264e13(0xbf)](config[_0x264e13(0xf0)],sha256(_0x526443));function _0x591fee(){const _0x55bdbc=_0x264e13;sharp(_0x4c8cef,{'failOnError':![]})[_0x55bdbc(0xe4)]({'quality':0x4d})['resize']({'width':0x1f4})[_0x55bdbc(0xb6)]()[_0x55bdbc(0xef)](_0xd6e049=>{const _0x5cb5d9=_0x55bdbc;return _0x36d515[_0x5cb5d9(0xd1)](_0xd6e049);})[_0x55bdbc(0xfa)](_0x1402a6=>{const _0x29dc37=_0x55bdbc;return console[_0x29dc37(0x11f)]('err1',_0x1402a6),_0x36d515[_0x29dc37(0xee)](0x194)[_0x29dc37(0xbe)]();});}fs[_0x264e13(0x113)](_0x4c8cef,(_0x3cf4f8,_0x512559)=>{const _0x3eb253=_0x264e13;if(!_0x3cf4f8)return _0x591fee();_0x316a07[_0x3eb253(0x10c)]['noCache']==0x1?httpUtil[_0x3eb253(0x126)](_0x316a07[_0x3eb253(0x123)]['dbOther'],_0x526443)[_0x3eb253(0xef)](_0x1d1b0c=>{const _0x35458f=_0x3eb253;return _0x1d1b0c[_0x35458f(0x108)](_0x36d515);})['catch'](_0x2f90f1=>{const _0x40c59b=_0x3eb253;return _0x36d515[_0x40c59b(0xee)](0x194)[_0x40c59b(0xbe)]();}):httpUtil['downloadImg'](_0x316a07[_0x3eb253(0x123)]['dbOther'],_0x526443,_0x4c8cef)[_0x3eb253(0xef)](_0x1a9c0=>{_0x591fee();})[_0x3eb253(0xfa)](_0x466d2e=>{const _0x1cbe0c=_0x3eb253;return _0x36d515[_0x1cbe0c(0xee)](0x194)[_0x1cbe0c(0xbe)]();});});}),module[_0x52fd5e(0x12e)]=router;