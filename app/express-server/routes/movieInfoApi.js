const _0x2c08cf=_0x4e27;(function(_0x5bb818,_0x2c0a57){const _0x1fc51d=_0x4e27,_0x5dfc34=_0x5bb818();while(!![]){try{const _0x198f40=-parseInt(_0x1fc51d(0x118))/0x1+-parseInt(_0x1fc51d(0x162))/0x2*(-parseInt(_0x1fc51d(0x167))/0x3)+-parseInt(_0x1fc51d(0x11f))/0x4*(parseInt(_0x1fc51d(0x13e))/0x5)+parseInt(_0x1fc51d(0x101))/0x6+parseInt(_0x1fc51d(0x134))/0x7*(-parseInt(_0x1fc51d(0x168))/0x8)+parseInt(_0x1fc51d(0x177))/0x9*(parseInt(_0x1fc51d(0x164))/0xa)+parseInt(_0x1fc51d(0x15f))/0xb*(parseInt(_0x1fc51d(0x137))/0xc);if(_0x198f40===_0x2c0a57)break;else _0x5dfc34['push'](_0x5dfc34['shift']());}catch(_0x290232){_0x5dfc34['push'](_0x5dfc34['shift']());}}}(_0x2c8c,0xc42d6));function _0x4e27(_0x2fb10f,_0x464426){const _0x2c8c86=_0x2c8c();return _0x4e27=function(_0x4e2722,_0x32b41c){_0x4e2722=_0x4e2722-0xf8;let _0x3fb0d7=_0x2c8c86[_0x4e2722];return _0x3fb0d7;},_0x4e27(_0x2fb10f,_0x464426);}var express=require(_0x2c08cf(0x175)),router=express[_0x2c08cf(0x15d)]();const fs=require('fs'),sharp=require(_0x2c08cf(0x127)),axios=require(_0x2c08cf(0x172));let sha256=require(_0x2c08cf(0x176)),path=require(_0x2c08cf(0x130)),config=require(_0x2c08cf(0x131));const tmdbApi=require('../../utils/movieInfoTmdbApi'),movieInfoUtil=require(_0x2c08cf(0x13a)),movieSeasonUtil=require(_0x2c08cf(0x11a)),dbFileIndexTable=require(_0x2c08cf(0x160)),dbUserTable=require(_0x2c08cf(0x16d)),dbFileOperationRecord=require(_0x2c08cf(0x15e)),nfoUtil=require(_0x2c08cf(0x11c)),httpUtil=require('../../utils/httpUtil');router[_0x2c08cf(0x163)](_0x2c08cf(0x16f),(_0x62372d,_0x37ccb7,_0x1c0f2d)=>{const _0x107535=_0x2c08cf;if(_0x62372d[_0x107535(0x14c)][_0x107535(0x17a)]!=0x1)return _0x37ccb7[_0x107535(0x153)]({'code':0x66});let _0x53dfd6=_0x62372d[_0x107535(0x106)]['movieTmdbLanguage'],_0x48841e=_0x62372d[_0x107535(0x106)]['movieTmdbApiUrl'],_0x1f8ee8=_0x62372d['body'][_0x107535(0x12f)];if(!_0x53dfd6)return _0x62372d[_0x107535(0x10d)][_0x107535(0x110)](_0x37ccb7,_0x107535(0x17d));if(!_0x48841e)return _0x62372d[_0x107535(0x10d)][_0x107535(0x110)](_0x37ccb7,_0x107535(0x154));if(!_0x1f8ee8)return _0x62372d['app'][_0x107535(0x110)](_0x37ccb7,_0x107535(0x136));let _0x24a412=movieInfoUtil[_0x107535(0x124)](_0x62372d[_0x107535(0x10d)][_0x107535(0x156)]),_0x50c3e=new tmdbApi[(_0x107535(0x13b))](_0x1f8ee8,_0x53dfd6,_0x48841e,_0x24a412);_0x50c3e[_0x107535(0x16b)]()['then'](_0x2aa933=>{const _0x27982c=_0x107535;if(_0x2aa933[_0x27982c(0x12a)]==![]||_0x2aa933[_0x27982c(0x122)])return _0x37ccb7[_0x27982c(0x153)]({'code':0x2,'msg':_0x2aa933[_0x27982c(0x17b)]});return _0x37ccb7[_0x27982c(0x153)]({'code':0x0,'data':[]});})['catch'](_0x3a104d=>{const _0x2aac99=_0x107535;let _0x10321a=_0x2aac99(0x117);if(_0x3a104d){if(_0x3a104d['status_code'])_0x10321a+=':'+_0x3a104d[_0x2aac99(0x17b)];else _0x3a104d[_0x2aac99(0x125)]&&(_0x10321a+=':'+_0x3a104d[_0x2aac99(0x125)]);}return _0x37ccb7[_0x2aac99(0x153)]({'code':0x2,'msg':_0x10321a,'data':[]});});}),router[_0x2c08cf(0x163)](_0x2c08cf(0x158),(_0x561417,_0xd62b3a,_0xbde901)=>{const _0x424014=_0x2c08cf;if(_0x561417['currentUser'][_0x424014(0x17a)]!=0x1)return _0xd62b3a[_0x424014(0x153)]({'code':0x66});movieInfoUtil[_0x424014(0x13d)](_0x561417[_0x424014(0x10d)][_0x424014(0x156)])['then'](()=>{const _0x498e8e=_0x424014;return _0xd62b3a[_0x498e8e(0x153)]({'code':0x0});})[_0x424014(0xfe)](_0xc6c963=>{const _0x21138b=_0x424014;return _0xd62b3a[_0x21138b(0x153)]({'code':0x2,'msg':_0xc6c963});});}),router[_0x2c08cf(0x163)]('/searchMovieInfo',(_0x21a993,_0x9a00cd,_0x2cc461)=>{const _0x3f47d7=_0x2c08cf;let _0x4eabd7=_0x21a993[_0x3f47d7(0x106)][_0x3f47d7(0x121)],_0x3feeec=_0x21a993[_0x3f47d7(0x106)][_0x3f47d7(0x157)],_0x4acc51=_0x21a993[_0x3f47d7(0x106)]['searchMediaType'],_0x31c66f=_0x21a993['body'][_0x3f47d7(0x103)];if(!_0x4eabd7||!_0x3feeec||!_0x4acc51)return _0x21a993['app'][_0x3f47d7(0x110)](_0x9a00cd,_0x3f47d7(0x147));let _0x3918fc=movieInfoUtil[_0x3f47d7(0x135)](_0x21a993[_0x3f47d7(0x10d)][_0x3f47d7(0x156)]);if(_0x3feeec=='KEYWORD')_0x3918fc[_0x3f47d7(0x15c)](_0x4eabd7,_0x4acc51=='TV',null,_0x31c66f,!![])[_0x3f47d7(0x129)](_0x3767ca=>{const _0x512df0=_0x3f47d7;if(!_0x9a00cd[_0x512df0(0x149)])return _0x9a00cd['json']({'code':0x0,'data':_0x3767ca});})[_0x3f47d7(0xfe)](_0xdb8b13=>{const _0xd26749=_0x3f47d7;console[_0xd26749(0x146)](_0xd26749(0xfc),_0xdb8b13);if(_0xdb8b13&&_0xdb8b13[_0xd26749(0x122)]&&_0xdb8b13[_0xd26749(0x17b)])return _0x21a993['app'][_0xd26749(0x110)](_0x9a00cd,_0xdb8b13[_0xd26749(0x17b)]);if(!_0x9a00cd[_0xd26749(0x149)])return _0x9a00cd[_0xd26749(0x153)]({'code':0x0,'data':[]});});else{if(_0x3feeec=='TMDBID')_0x3918fc[_0x3f47d7(0x113)](_0x4eabd7,_0x4acc51=='TV')['then'](_0x2d2676=>{const _0x4b1f61=_0x3f47d7;if(!_0x9a00cd[_0x4b1f61(0x149)])return _0x9a00cd['json']({'code':0x0,'data':[_0x2d2676]});})[_0x3f47d7(0xfe)](_0x4a4436=>{const _0x4ee2dd=_0x3f47d7;console[_0x4ee2dd(0x146)](_0x4ee2dd(0xfc),_0x4a4436);if(_0x4a4436&&_0x4a4436[_0x4ee2dd(0x122)]&&_0x4a4436[_0x4ee2dd(0x17b)])return _0x21a993[_0x4ee2dd(0x10d)]['returnErrMsg'](_0x9a00cd,_0x4a4436[_0x4ee2dd(0x17b)]);if(!_0x9a00cd[_0x4ee2dd(0x149)])return _0x9a00cd[_0x4ee2dd(0x153)]({'code':0x0,'data':[]});});else{if(!_0x9a00cd[_0x3f47d7(0x149)])return _0x9a00cd[_0x3f47d7(0x153)]({'code':0x0,'data':[]});}}});function _0x2c8c(){const _0xffb47=['/getImdbImg','page','tmdb','sep','body','query','getById','filename','.nfo','noCache','indexOf','app','INDEX_TABLE_NAME_MOVIE','tmdbId','returnErrMsg','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?','splice','getDetail','resize','runSearchNfoWorker','/scrapeAgain','TMDB\x20Error','1503739FngggS','dbFileIndex','../../utils/movieSeasonUtil','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?','../../utils/nfoUtil','getSeasonNumber','parseNfo','28JriWHO','jpeg','searchStr','status_code','LEVEL_MAIN_OPERATION','getProxyUrl','message','power_delete','sharp','run','then','success','SELECT\x20*\x20FROM\x20','要清除的nfo和海报文件列表','push','power_change','movieTmdbApiKey','path','../../myConfig/config','posterPath','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','35jOxUlz','getTmdbApi','Need\x20tmdb\x20key','46176yfvpvG','basename','addFileOperationRecord','../../utils/movieInfoUtil','API','dirname','testTmdb','1078245NiPDKI','toBuffer','substring','fanart.jpg','err1','count','is_tvplay','/getScrapeLog','log','params\x20error','-poster.jpg','headersSent','url','saveMovieInfoToDb','currentUser','allSettled','length','exports','刮削文件清理成功','username','/clearScrapeLog','json','Need\x20tmdb\x20api\x20url','status','dbOther','searchType','/testTmdbProxy','lastIndexOf','stat','SWITCH_MOVIE_INFO','search','Router','../../db/dbFileOperationRecord','3773FuNJFG','../../db/dbFileIndexTable','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','306642NVciGC','post','42220zPKmdE','indexId\x20error','join','18RimIRH','77936SuJCjc','all','end','languageList','ext','../../db/dbUserTable','downloadImg','/testTmdb','operationFail','tvshow.nfo','axios','scrapeMissing','send','express','sha256','2682GBWGsS','season.nfo','-thumb.jpg','is_admin','status_message','poster.jpg','Need\x20tmdb\x20language','get','prepare','doUserCanGet','offset','indexId','TMDB\x20search接口请求失败','/setMovieInfo','catch','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','indexId/tmdbId\x20error','2205528YPbTzD'];_0x2c8c=function(){return _0xffb47;};return _0x2c8c();}function updateIndexByNfo(_0xc443f3,_0x266724){return new Promise((_0x1f29d8,_0x18880e)=>{const _0x45698d=_0x4e27;nfoUtil[_0x45698d(0x11e)](_0x266724,!![],![])['then'](_0x324cce=>{return movieInfoUtil['saveMovieInfoToDb'](_0xc443f3,_0x266724['id'],_0x324cce),_0x1f29d8();})[_0x45698d(0xfe)](_0x2029b0=>{return _0x1f29d8();});});}router[_0x2c08cf(0x163)](_0x2c08cf(0x116),(_0x5e9d54,_0x118211,_0x4c016d)=>{const _0x73beee=_0x2c08cf;let _0x40aa96=_0x5e9d54[_0x73beee(0x106)][_0x73beee(0xfb)],_0x24e16a=_0x5e9d54[_0x73beee(0x106)][_0x73beee(0x173)],_0xfcbd65=dbFileIndexTable[_0x73beee(0x108)](_0x5e9d54[_0x73beee(0x10d)]['dbFileIndex'],_0x40aa96,dbFileIndexTable[_0x73beee(0x10e)]);if(!_0xfcbd65)return _0x5e9d54[_0x73beee(0x10d)][_0x73beee(0x110)](_0x118211,'indexId\x20error');if(dbUserTable['doUserCanGet'](_0x5e9d54,_0x118211,'',_0x73beee(0x12e),_0xfcbd65[_0x73beee(0x130)])==!![]){function _0x14c062(){const _0x2111a8=_0x73beee;movieInfoUtil[_0x2111a8(0x115)](_0x5e9d54[_0x2111a8(0x10d)][_0x2111a8(0x156)],_0xfcbd65['path'],_0xfcbd65[_0x2111a8(0x109)],_0xfcbd65['is_tvplay'],null,_0x24e16a)[_0x2111a8(0x129)](()=>{const _0x30c86d=_0x2111a8;_0xfcbd65[_0x30c86d(0x144)]==0x0&&updateIndexByNfo(_0x5e9d54[_0x30c86d(0x10d)][_0x30c86d(0x119)],_0xfcbd65)['then'](()=>{});})[_0x2111a8(0xfe)](_0x2c7a49=>{});}_0x24e16a==0x1?_0x14c062():clearInfo(_0x5e9d54,_0x118211,_0xfcbd65)[_0x73beee(0x129)](()=>{_0x14c062();});if(!_0x118211[_0x73beee(0x149)])return _0x118211[_0x73beee(0x153)]({'code':0x0});}}),router['post'](_0x2c08cf(0x145),(_0x1e3f19,_0x3afbbc,_0x18e6c4)=>{const _0x1a1ce4=_0x2c08cf;if(_0x1e3f19['currentUser'][_0x1a1ce4(0x17a)]!=0x1)return _0x3afbbc[_0x1a1ce4(0x153)]({'code':0x66});let _0x3fcdc1=_0x1e3f19[_0x1a1ce4(0x106)][_0x1a1ce4(0x143)]||0x1e,_0x15b6f3=_0x1e3f19[_0x1a1ce4(0x106)][_0x1a1ce4(0xfa)]||0x0;const _0x4ce7d8=_0x1a1ce4(0x133);let _0xb16fb6=_0x1e3f19[_0x1a1ce4(0x10d)][_0x1a1ce4(0x119)][_0x1a1ce4(0xf8)](_0x4ce7d8)[_0x1a1ce4(0x169)](_0x3fcdc1,_0x15b6f3);return _0x3afbbc['json']({'code':0x0,'data':_0xb16fb6});}),router[_0x2c08cf(0x163)](_0x2c08cf(0x152),(_0x29855d,_0x3e0707,_0x110bd1)=>{const _0x28a25a=_0x2c08cf;if(_0x29855d['currentUser'][_0x28a25a(0x17a)]!=0x1)return _0x3e0707[_0x28a25a(0x153)]({'code':0x66});const _0x27f105=_0x28a25a(0xff);return _0x29855d[_0x28a25a(0x10d)][_0x28a25a(0x119)][_0x28a25a(0xf8)](_0x27f105)[_0x28a25a(0x128)](),_0x3e0707['json']({'code':0x0});}),router[_0x2c08cf(0x163)]('/clearNfoImg',(_0x2acd78,_0x1bddaa,_0x303751)=>{const _0x342ce3=_0x2c08cf;if(_0x2acd78[_0x342ce3(0x14c)]['is_admin']!=0x1)return _0x1bddaa['json']({'code':0x66});let _0x5b4d36=_0x2acd78[_0x342ce3(0x106)]['sourceFolder'];if(!_0x5b4d36)return _0x2acd78[_0x342ce3(0x10d)][_0x342ce3(0x110)](_0x1bddaa,'need\x20folder');const _0x5281ee=_0x342ce3(0x111);_0x2acd78[_0x342ce3(0x10d)]['dbFileIndex'][_0x342ce3(0xf8)](_0x5281ee)[_0x342ce3(0x128)](_0x5b4d36,_0x5b4d36+path[_0x342ce3(0x105)]+'%');let _0x1800ea='SELECT\x20*\x20FROM\x20'+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x342ce3(0x11b),_0xd146b8=_0x2acd78[_0x342ce3(0x10d)][_0x342ce3(0x119)]['prepare'](_0x1800ea)[_0x342ce3(0x169)](_0x5b4d36,_0x5b4d36+path[_0x342ce3(0x105)]+'%'),_0x46fa0b=[];for(let _0xdc2f8d of _0xd146b8){movieInfoUtil[_0x342ce3(0x14b)](_0x2acd78[_0x342ce3(0x10d)]['dbFileIndex'],_0xdc2f8d['id'],{}),_0x46fa0b['push'](deleteMovieInfoOfIndex(_0x2acd78,_0xdc2f8d));}Promise[_0x342ce3(0x14d)](_0x46fa0b)[_0x342ce3(0x129)](_0x3bc3e1=>{const _0x506497=_0x342ce3;return process[_0x506497(0x174)]({'type':_0x506497(0x15b)}),_0x1bddaa[_0x506497(0x153)]({'code':0x0});});});function deleteMovieInfoOfIndex(_0x5dfe90,_0x75091d){return new Promise((_0x2506b3,_0x39c708)=>{const _0x461ccf=_0x4e27;let _0x57dc3c=path[_0x461ccf(0x166)](_0x75091d['path'],_0x75091d['filename']['substring'](0x0,_0x75091d[_0x461ccf(0x109)][_0x461ccf(0x159)](_0x75091d[_0x461ccf(0x16c)]))+'.jpg'),_0x36821f=path[_0x461ccf(0x166)](_0x75091d['path'],_0x75091d[_0x461ccf(0x109)]['substring'](0x0,_0x75091d[_0x461ccf(0x109)][_0x461ccf(0x159)](_0x75091d['ext']))+_0x461ccf(0x179)),_0x388801=path[_0x461ccf(0x166)](_0x75091d['path'],_0x75091d[_0x461ccf(0x109)][_0x461ccf(0x140)](0x0,_0x75091d[_0x461ccf(0x109)][_0x461ccf(0x159)](_0x75091d[_0x461ccf(0x16c)]))+'-fanart.jpg'),_0x4506bd=path[_0x461ccf(0x166)](_0x75091d[_0x461ccf(0x130)],_0x75091d[_0x461ccf(0x109)][_0x461ccf(0x140)](0x0,_0x75091d['filename'][_0x461ccf(0x159)](_0x75091d[_0x461ccf(0x16c)]))+_0x461ccf(0x148)),_0x2da57b=path[_0x461ccf(0x166)](_0x75091d['path'],_0x461ccf(0x17c)),_0xac7d3b=path[_0x461ccf(0x166)](_0x75091d[_0x461ccf(0x130)],_0x75091d['filename'][_0x461ccf(0x140)](0x0,_0x75091d[_0x461ccf(0x109)][_0x461ccf(0x159)](_0x75091d[_0x461ccf(0x16c)]))+_0x461ccf(0x10a)),_0x217d7a=[_0x57dc3c,_0x2da57b,_0x36821f,_0x388801,_0x4506bd,_0xac7d3b];if(_0x75091d['is_tvplay']==0x1){let _0x37a873=path[_0x461ccf(0x166)](_0x75091d[_0x461ccf(0x130)],_0x461ccf(0x171)),_0x25512e=path[_0x461ccf(0x166)](_0x75091d[_0x461ccf(0x130)],_0x461ccf(0x178));_0x217d7a['push'](_0x37a873),_0x217d7a[_0x461ccf(0x12d)](_0x25512e);let _0x58001f=path[_0x461ccf(0x138)](_0x75091d[_0x461ccf(0x130)]),_0x421860=path[_0x461ccf(0x13c)](_0x75091d['path']),_0x22b313=movieSeasonUtil[_0x461ccf(0x11d)](_0x58001f);if(_0x22b313>0x0){let _0x5c187d=path['join'](_0x421860,_0x461ccf(0x171));_0x217d7a['push'](_0x5c187d);_0x22b313<0xa&&(_0x22b313='0'+_0x22b313);let _0x17e164=path[_0x461ccf(0x166)](_0x421860,'season'+_0x22b313+'-poster.jpg');_0x217d7a[_0x461ccf(0x12d)](_0x17e164);let _0x3c8a89=path['join'](_0x421860,_0x461ccf(0x17c));_0x217d7a[_0x461ccf(0x12d)](_0x3c8a89);let _0x2afc89=path['join'](_0x421860,_0x461ccf(0x141));_0x217d7a[_0x461ccf(0x12d)](_0x2afc89);}}console[_0x461ccf(0x146)](_0x461ccf(0x12c),_0x217d7a);function _0x1d3469(){const _0x1bc233=_0x461ccf;_0x217d7a[_0x1bc233(0x14e)]>0x0?fs[_0x1bc233(0x15a)](_0x217d7a[0x0],(_0x1f3c44,_0x356e1f)=>{!_0x1f3c44&&_0x356e1f&&_0x356e1f['isFile']()?(console['log']('清理',_0x217d7a[0x0]),fs['rm'](_0x217d7a[0x0],_0x138d24=>{const _0x51afd9=_0x4e27;let _0x4aa17c=_0x217d7a[0x0];_0x217d7a[_0x51afd9(0x112)](0x0,0x1),!_0x138d24&&(console['log'](_0x51afd9(0x150),_0x4aa17c),dbFileOperationRecord[_0x51afd9(0x139)](_0x5dfe90['app']['dbOther'],{'username':_0x5dfe90[_0x51afd9(0x14c)][_0x51afd9(0x151)],'targetPath':_0x4aa17c,'level':dbFileOperationRecord[_0x51afd9(0x123)],'type':dbFileOperationRecord['TYPE_DELETE'],'state':dbFileOperationRecord['STATE_SUC']})),_0x1d3469();})):(_0x217d7a['splice'](0x0,0x1),_0x1d3469());}):(movieInfoUtil['saveMovieInfoToDb'](_0x5dfe90[_0x1bc233(0x10d)]['dbFileIndex'],_0x75091d['id'],{}),_0x2506b3());}_0x1d3469();});}function clearInfo(_0x42a137,_0x4a12e0,_0x44779c){return new Promise((_0x416b5d,_0x3d75ec)=>{const _0x484bc4=_0x4e27;if(dbUserTable[_0x484bc4(0xf9)](_0x42a137,_0x4a12e0,'',_0x484bc4(0x126),_0x44779c[_0x484bc4(0x130)])==!![]){if(_0x44779c['is_tvplay']==0x1){let _0x143eb3=_0x484bc4(0x12b)+dbFileIndexTable[_0x484bc4(0x10e)]+_0x484bc4(0x161),_0x1a45ef=_0x42a137['app'][_0x484bc4(0x119)][_0x484bc4(0xf8)](_0x143eb3)[_0x484bc4(0x169)](_0x44779c[_0x484bc4(0x130)]),_0xafe1c=[];for(let _0x588063 of _0x1a45ef){_0xafe1c['push'](deleteMovieInfoOfIndex(_0x42a137,_0x588063));}if(_0xafe1c[_0x484bc4(0x14e)]<0x1)return _0x416b5d();Promise[_0x484bc4(0x14d)](_0xafe1c)[_0x484bc4(0x129)](_0x21361b=>{return _0x416b5d();})[_0x484bc4(0xfe)](_0x2e1863=>{return _0x416b5d();});}else deleteMovieInfoOfIndex(_0x42a137,_0x44779c)[_0x484bc4(0x129)](_0x3ecb49=>{return _0x416b5d();});}});}router[_0x2c08cf(0x163)]('/clearMovieInfo',(_0x58a046,_0x5eccae,_0x58f676)=>{const _0x2a8fdf=_0x2c08cf;let _0x17a28d=_0x58a046[_0x2a8fdf(0x106)][_0x2a8fdf(0xfb)],_0x31bdd3=dbFileIndexTable[_0x2a8fdf(0x108)](_0x58a046[_0x2a8fdf(0x10d)][_0x2a8fdf(0x119)],_0x17a28d,dbFileIndexTable[_0x2a8fdf(0x10e)]);if(!_0x31bdd3)return _0x58a046[_0x2a8fdf(0x10d)][_0x2a8fdf(0x110)](_0x5eccae,_0x2a8fdf(0x165));clearInfo(_0x58a046,_0x5eccae,_0x31bdd3)[_0x2a8fdf(0x129)](()=>{return _0x5eccae['json']({'code':0x0});});}),router['post'](_0x2c08cf(0xfd),(_0x45274e,_0x542b8f,_0x5399cf)=>{const _0x188eb1=_0x2c08cf;let _0x1d08e8=_0x45274e['body'][_0x188eb1(0xfb)],_0x479622=dbFileIndexTable['getById'](_0x45274e[_0x188eb1(0x10d)][_0x188eb1(0x119)],_0x1d08e8,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x3b54de=_0x45274e[_0x188eb1(0x106)][_0x188eb1(0x10f)];if(!_0x479622||!_0x3b54de)return _0x45274e[_0x188eb1(0x10d)]['returnErrMsg'](_0x542b8f,_0x188eb1(0x100));dbUserTable[_0x188eb1(0xf9)](_0x45274e,_0x542b8f,'',_0x188eb1(0x12e),_0x479622[_0x188eb1(0x130)])==!![]&&clearInfo(_0x45274e,_0x542b8f,_0x479622)[_0x188eb1(0x129)](()=>{const _0x2a0bd8=_0x188eb1;return movieInfoUtil[_0x2a0bd8(0x115)](_0x45274e[_0x2a0bd8(0x10d)][_0x2a0bd8(0x156)],_0x479622['path'],_0x479622[_0x2a0bd8(0x109)],_0x479622[_0x2a0bd8(0x144)],_0x3b54de)['then'](()=>{const _0x1c0c42=_0x2a0bd8;if(_0x479622[_0x1c0c42(0x144)]==0x0)updateIndexByNfo(_0x45274e[_0x1c0c42(0x10d)][_0x1c0c42(0x119)],_0x479622)[_0x1c0c42(0x129)](()=>{});else{}})[_0x2a0bd8(0xfe)](_0x257578=>{const _0x248802=_0x2a0bd8;return console[_0x248802(0x146)](_0x257578),_0x45274e[_0x248802(0x10d)][_0x248802(0x110)](_0x542b8f,_0x542b8f['__'](_0x248802(0x170)));}),_0x542b8f['json']({'code':0x0});});}),router[_0x2c08cf(0x17e)](_0x2c08cf(0x102),(_0x25de0f,_0x2522e6,_0x5ac720)=>{const _0x5bdfe9=_0x2c08cf;let _0x15080e=_0x25de0f[_0x5bdfe9(0x107)][_0x5bdfe9(0x14a)];if(!_0x15080e||!_0x15080e[_0x5bdfe9(0x10c)](_0x5bdfe9(0x104))==-0x1)return _0x2522e6[_0x5bdfe9(0x155)](0x194)[_0x5bdfe9(0x16a)]();_0x15080e=decodeURIComponent(_0x15080e);let _0x4866c3=path[_0x5bdfe9(0x166)](config[_0x5bdfe9(0x132)],sha256(_0x15080e));function _0xf6461f(){const _0x392205=_0x5bdfe9;sharp(_0x4866c3,{'failOnError':![]})[_0x392205(0x120)]({'quality':0x4d})[_0x392205(0x114)]({'width':0x1f4})[_0x392205(0x13f)]()[_0x392205(0x129)](_0x25da9d=>{const _0x143061=_0x392205;return _0x2522e6[_0x143061(0x174)](_0x25da9d);})[_0x392205(0xfe)](_0xcaed0e=>{const _0x2d06a5=_0x392205;return console[_0x2d06a5(0x146)](_0x2d06a5(0x142),_0xcaed0e),_0x2522e6[_0x2d06a5(0x155)](0x194)[_0x2d06a5(0x16a)]();});}fs[_0x5bdfe9(0x15a)](_0x4866c3,(_0x1b21d9,_0x59b176)=>{const _0x5b990c=_0x5bdfe9;if(!_0x1b21d9)return _0xf6461f();_0x25de0f[_0x5b990c(0x107)][_0x5b990c(0x10b)]==0x1?httpUtil[_0x5b990c(0x16e)](_0x25de0f[_0x5b990c(0x10d)][_0x5b990c(0x156)],_0x15080e)['then'](_0x19250a=>{return _0x19250a['pipe'](_0x2522e6);})[_0x5b990c(0xfe)](_0x56d721=>{const _0x39c329=_0x5b990c;return _0x2522e6['status'](0x194)[_0x39c329(0x16a)]();}):httpUtil[_0x5b990c(0x16e)](_0x25de0f[_0x5b990c(0x10d)][_0x5b990c(0x156)],_0x15080e,_0x4866c3)[_0x5b990c(0x129)](_0x4b2c2b=>{_0xf6461f();})[_0x5b990c(0xfe)](_0x22f356=>{const _0x190609=_0x5b990c;return _0x2522e6[_0x190609(0x155)](0x194)[_0x190609(0x16a)]();});});}),module[_0x2c08cf(0x14f)]=router;