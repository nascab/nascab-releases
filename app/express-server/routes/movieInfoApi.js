const _0xf83001=_0x2a36;(function(_0xe272df,_0x50293c){const _0x104455=_0x2a36,_0x5f2312=_0xe272df();while(!![]){try{const _0x576453=parseInt(_0x104455(0xf8))/0x1+-parseInt(_0x104455(0xe6))/0x2+-parseInt(_0x104455(0x114))/0x3*(parseInt(_0x104455(0xdc))/0x4)+parseInt(_0x104455(0xed))/0x5+parseInt(_0x104455(0x12a))/0x6+parseInt(_0x104455(0x122))/0x7*(parseInt(_0x104455(0x120))/0x8)+-parseInt(_0x104455(0x131))/0x9*(parseInt(_0x104455(0xc3))/0xa);if(_0x576453===_0x50293c)break;else _0x5f2312['push'](_0x5f2312['shift']());}catch(_0x562360){_0x5f2312['push'](_0x5f2312['shift']());}}}(_0x5682,0xd051e));function _0x5682(){const _0x5419d=['stat','TMDBID','message','posterPath','/searchMovieInfo','username','tmdb','status_code','testTmdb','1302894qoCURN','page','post','-thumb.jpg','要清除的nfo和海报文件列表','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?','tvshow.nfo','TMDB\x20search接口请求失败','movieTmdbApiKey','STATE_SUC','catch','/scrapeAgain','.nfo','TYPE_DELETE','TMDB\x20Error','indexId','ext','returnErrMsg','Need\x20tmdb\x20key','searchMediaType','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','API','all','then','downloadImg','scrapeMissing','err1','status','399zUAOmA','-poster.jpg','getDetail','is_tvplay','path','LEVEL_MAIN_OPERATION','headersSent','getTmdbApi','searchType','Need\x20tmdb\x20language','power_change','KEYWORD','7151944dLGMML','jpeg','7PQwDZL','season','../../utils/movieSeasonUtil','sep','filename','exports','sourceFolder','get','10208232nVidIO','noCache','sha256','doUserCanGet','run','query','INDEX_TABLE_NAME_MOVIE','144JreTlg','dbFileIndex','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','isFile','basename','offset','log','indexId\x20error','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?','allSettled','getSeasonNumber','dbOther','success','/clearScrapeLog','1646390HxkXFu','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','movieTmdbApiUrl','send','join','status_message','prepare','saveMovieInfoToDb','/setMovieInfo','SELECT\x20*\x20FROM\x20','json','lastIndexOf','indexId/tmdbId\x20error','Need\x20tmdb\x20api\x20url','power_delete','substring','pipe','getProxyUrl','dirname','fanart.jpg','push','poster.jpg','end','getById','is_admin','21884JhqYUv','../../utils/nfoUtil','Router','need\x20folder','express','currentUser','movieTmdbLanguage','runSearchNfoWorker','app','刮削文件清理成功','1564550UBjcfw','body','splice','../../db/dbUserTable','tmdbId','languageList','../../db/dbFileIndexTable','5495805xKTdEf','searchStr'];_0x5682=function(){return _0x5419d;};return _0x5682();}function _0x2a36(_0x53fe25,_0x1bc28a){const _0x5682d0=_0x5682();return _0x2a36=function(_0x2a366b,_0x185b6a){_0x2a366b=_0x2a366b-0xba;let _0x309b62=_0x5682d0[_0x2a366b];return _0x309b62;},_0x2a36(_0x53fe25,_0x1bc28a);}var express=require(_0xf83001(0xe0)),router=express[_0xf83001(0xde)]();const fs=require('fs'),sharp=require('sharp'),axios=require('axios');let sha256=require(_0xf83001(0x12c)),path=require(_0xf83001(0x118)),config=require('../../myConfig/config');const tmdbApi=require('../../utils/movieInfoTmdbApi'),movieInfoUtil=require('../../utils/movieInfoUtil'),movieSeasonUtil=require(_0xf83001(0x124)),dbFileIndexTable=require(_0xf83001(0xec)),dbUserTable=require(_0xf83001(0xe9)),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),nfoUtil=require(_0xf83001(0xdd)),httpUtil=require('../../utils/httpUtil');router['post']('/testTmdb',(_0x42dc95,_0x950ebe,_0x427de0)=>{const _0xac716c=_0xf83001;if(_0x42dc95[_0xac716c(0xe1)][_0xac716c(0xdb)]!=0x1)return _0x950ebe[_0xac716c(0xcd)]({'code':0x66});let _0x3b06c3=_0x42dc95[_0xac716c(0xe7)][_0xac716c(0xe2)],_0xefdefa=_0x42dc95['body'][_0xac716c(0xc5)],_0x52ae09=_0x42dc95[_0xac716c(0xe7)][_0xac716c(0x100)];if(!_0x3b06c3)return _0x42dc95['app']['returnErrMsg'](_0x950ebe,_0xac716c(0x11d));if(!_0xefdefa)return _0x42dc95[_0xac716c(0xe4)][_0xac716c(0x109)](_0x950ebe,_0xac716c(0xd0));if(!_0x52ae09)return _0x42dc95[_0xac716c(0xe4)][_0xac716c(0x109)](_0x950ebe,_0xac716c(0x10a));let _0x2f0811=movieInfoUtil[_0xac716c(0xd4)](_0x42dc95['app'][_0xac716c(0xc0)]),_0x44a1e2=new tmdbApi[(_0xac716c(0x10d))](_0x52ae09,_0x3b06c3,_0xefdefa,_0x2f0811);_0x44a1e2[_0xac716c(0xeb)]()[_0xac716c(0x10f)](_0x870a6b=>{const _0x4f8ecd=_0xac716c;if(_0x870a6b[_0x4f8ecd(0xc1)]==![]||_0x870a6b[_0x4f8ecd(0xf6)])return _0x950ebe[_0x4f8ecd(0xcd)]({'code':0x2,'msg':_0x870a6b[_0x4f8ecd(0xc8)]});return _0x950ebe[_0x4f8ecd(0xcd)]({'code':0x0,'data':[]});})[_0xac716c(0x102)](_0x501970=>{const _0x471bba=_0xac716c;let _0x484acd=_0x471bba(0x106);if(_0x501970){if(_0x501970['status_code'])_0x484acd+=':'+_0x501970[_0x471bba(0xc8)];else _0x501970[_0x471bba(0xf1)]&&(_0x484acd+=':'+_0x501970[_0x471bba(0xf1)]);}return _0x950ebe[_0x471bba(0xcd)]({'code':0x2,'msg':_0x484acd,'data':[]});});}),router[_0xf83001(0xfa)]('/testTmdbProxy',(_0x45762f,_0xe172c6,_0x3a6614)=>{const _0xac9865=_0xf83001;if(_0x45762f[_0xac9865(0xe1)][_0xac9865(0xdb)]!=0x1)return _0xe172c6[_0xac9865(0xcd)]({'code':0x66});movieInfoUtil[_0xac9865(0xf7)](_0x45762f['app'][_0xac9865(0xc0)])['then'](()=>{const _0x504fb5=_0xac9865;return _0xe172c6[_0x504fb5(0xcd)]({'code':0x0});})[_0xac9865(0x102)](_0x5504b5=>{const _0x13edc1=_0xac9865;return _0xe172c6[_0x13edc1(0xcd)]({'code':0x2,'msg':_0x5504b5});});}),router[_0xf83001(0xfa)](_0xf83001(0xf3),(_0x5dc10a,_0x2b21c9,_0x3e5e24)=>{const _0x248aca=_0xf83001;let _0x4c7149=_0x5dc10a[_0x248aca(0xe7)][_0x248aca(0xee)],_0x39d69=_0x5dc10a[_0x248aca(0xe7)][_0x248aca(0x11c)],_0x368cfa=_0x5dc10a[_0x248aca(0xe7)][_0x248aca(0x10b)],_0x3d1d01=_0x5dc10a[_0x248aca(0xe7)][_0x248aca(0xf9)];if(!_0x4c7149||!_0x39d69||!_0x368cfa)return _0x5dc10a[_0x248aca(0xe4)]['returnErrMsg'](_0x2b21c9,'params\x20error');let _0x1c3c15=movieInfoUtil[_0x248aca(0x11b)](_0x5dc10a['app'][_0x248aca(0xc0)]);if(_0x39d69==_0x248aca(0x11f))_0x1c3c15['search'](_0x4c7149,_0x368cfa=='TV',null,_0x3d1d01,!![])[_0x248aca(0x10f)](_0x42a37b=>{const _0x14cdcc=_0x248aca;if(!_0x2b21c9[_0x14cdcc(0x11a)])return _0x2b21c9['json']({'code':0x0,'data':_0x42a37b});})['catch'](_0x5c4831=>{const _0xbee869=_0x248aca;console['log'](_0xbee869(0xff),_0x5c4831);if(_0x5c4831&&_0x5c4831[_0xbee869(0xf6)]&&_0x5c4831[_0xbee869(0xc8)])return _0x5dc10a[_0xbee869(0xe4)]['returnErrMsg'](_0x2b21c9,_0x5c4831['status_message']);if(!_0x2b21c9['headersSent'])return _0x2b21c9['json']({'code':0x0,'data':[]});});else{if(_0x39d69==_0x248aca(0xf0))_0x1c3c15[_0x248aca(0x116)](_0x4c7149,_0x368cfa=='TV')[_0x248aca(0x10f)](_0x3d9190=>{const _0xf508ce=_0x248aca;if(!_0x2b21c9['headersSent'])return _0x2b21c9[_0xf508ce(0xcd)]({'code':0x0,'data':[_0x3d9190]});})[_0x248aca(0x102)](_0x1c15b7=>{const _0x19be1c=_0x248aca;console[_0x19be1c(0xbb)]('TMDB\x20search接口请求失败',_0x1c15b7);if(_0x1c15b7&&_0x1c15b7['status_code']&&_0x1c15b7[_0x19be1c(0xc8)])return _0x5dc10a[_0x19be1c(0xe4)][_0x19be1c(0x109)](_0x2b21c9,_0x1c15b7[_0x19be1c(0xc8)]);if(!_0x2b21c9[_0x19be1c(0x11a)])return _0x2b21c9[_0x19be1c(0xcd)]({'code':0x0,'data':[]});});else{if(!_0x2b21c9[_0x248aca(0x11a)])return _0x2b21c9[_0x248aca(0xcd)]({'code':0x0,'data':[]});}}});function updateIndexByNfo(_0x579d29,_0x399b5e){return new Promise((_0x2e409f,_0x1ab2f3)=>{const _0x4b4a94=_0x2a36;nfoUtil['parseNfo'](_0x399b5e,!![],![])['then'](_0x526bf3=>{return movieInfoUtil['saveMovieInfoToDb'](_0x579d29,_0x399b5e['id'],_0x526bf3),_0x2e409f();})[_0x4b4a94(0x102)](_0x16d4f7=>{return _0x2e409f();});});}router[_0xf83001(0xfa)](_0xf83001(0x103),(_0x2c61b3,_0x2d9580,_0x45b406)=>{const _0x14f5ae=_0xf83001;let _0x8e93d8=_0x2c61b3[_0x14f5ae(0xe7)][_0x14f5ae(0x107)],_0x4b3ffe=_0x2c61b3[_0x14f5ae(0xe7)][_0x14f5ae(0x111)],_0x63f433=dbFileIndexTable[_0x14f5ae(0xda)](_0x2c61b3['app'][_0x14f5ae(0x132)],_0x8e93d8,dbFileIndexTable[_0x14f5ae(0x130)]);if(!_0x63f433)return _0x2c61b3[_0x14f5ae(0xe4)]['returnErrMsg'](_0x2d9580,_0x14f5ae(0xbc));if(dbUserTable['doUserCanGet'](_0x2c61b3,_0x2d9580,'',_0x14f5ae(0x11e),_0x63f433[_0x14f5ae(0x118)])==!![]){function _0x4cbb82(){const _0x2fe1ae=_0x14f5ae;movieInfoUtil['runSearchNfoWorker'](_0x2c61b3[_0x2fe1ae(0xe4)]['dbOther'],_0x63f433[_0x2fe1ae(0x118)],_0x63f433[_0x2fe1ae(0x126)],_0x63f433[_0x2fe1ae(0x117)],null,_0x4b3ffe)['then'](()=>{const _0x1f5792=_0x2fe1ae;_0x63f433[_0x1f5792(0x117)]==0x0&&updateIndexByNfo(_0x2c61b3['app'][_0x1f5792(0x132)],_0x63f433)['then'](()=>{});})[_0x2fe1ae(0x102)](_0x1ac9f7=>{});}_0x4b3ffe==0x1?_0x4cbb82():clearInfo(_0x2c61b3,_0x2d9580,_0x63f433)[_0x14f5ae(0x10f)](()=>{_0x4cbb82();});if(!_0x2d9580['headersSent'])return _0x2d9580[_0x14f5ae(0xcd)]({'code':0x0});}}),router[_0xf83001(0xfa)]('/getScrapeLog',(_0xb16ef8,_0x4b05dd,_0x1d7fbe)=>{const _0x4cc788=_0xf83001;if(_0xb16ef8[_0x4cc788(0xe1)][_0x4cc788(0xdb)]!=0x1)return _0x4b05dd[_0x4cc788(0xcd)]({'code':0x66});let _0x2175a6=_0xb16ef8[_0x4cc788(0xe7)]['count']||0x1e,_0x75be99=_0xb16ef8['body'][_0x4cc788(0xba)]||0x0;const _0x1ee748=_0x4cc788(0x10c);let _0x14acbb=_0xb16ef8[_0x4cc788(0xe4)]['dbFileIndex'][_0x4cc788(0xc9)](_0x1ee748)['all'](_0x2175a6,_0x75be99);return _0x4b05dd[_0x4cc788(0xcd)]({'code':0x0,'data':_0x14acbb});}),router[_0xf83001(0xfa)](_0xf83001(0xc2),(_0x26951c,_0x3f1637,_0x6093f6)=>{const _0x1add48=_0xf83001;if(_0x26951c['currentUser'][_0x1add48(0xdb)]!=0x1)return _0x3f1637[_0x1add48(0xcd)]({'code':0x66});const _0x46d35f=_0x1add48(0x133);return _0x26951c['app'][_0x1add48(0x132)]['prepare'](_0x46d35f)[_0x1add48(0x12e)](),_0x3f1637[_0x1add48(0xcd)]({'code':0x0});}),router[_0xf83001(0xfa)]('/clearNfoImg',(_0x3dd488,_0x32fe18,_0x149a9a)=>{const _0x567451=_0xf83001;if(_0x3dd488[_0x567451(0xe1)][_0x567451(0xdb)]!=0x1)return _0x32fe18[_0x567451(0xcd)]({'code':0x66});let _0x3d24e8=_0x3dd488[_0x567451(0xe7)][_0x567451(0x128)];if(!_0x3d24e8)return _0x3dd488[_0x567451(0xe4)][_0x567451(0x109)](_0x32fe18,_0x567451(0xdf));const _0x1c8953=_0x567451(0xbd);_0x3dd488[_0x567451(0xe4)][_0x567451(0x132)]['prepare'](_0x1c8953)[_0x567451(0x12e)](_0x3d24e8,_0x3d24e8+path[_0x567451(0x125)]+'%');let _0x7ef639=_0x567451(0xcc)+dbFileIndexTable[_0x567451(0x130)]+_0x567451(0xfd),_0x25a095=_0x3dd488['app'][_0x567451(0x132)][_0x567451(0xc9)](_0x7ef639)['all'](_0x3d24e8,_0x3d24e8+path[_0x567451(0x125)]+'%'),_0x44871c=[];for(let _0x1d9ace of _0x25a095){movieInfoUtil[_0x567451(0xca)](_0x3dd488[_0x567451(0xe4)][_0x567451(0x132)],_0x1d9ace['id'],{}),_0x44871c[_0x567451(0xd7)](deleteMovieInfoOfIndex(_0x3dd488,_0x1d9ace));}Promise[_0x567451(0xbe)](_0x44871c)['then'](_0xea1bf0=>{const _0x32c92b=_0x567451;return process[_0x32c92b(0xc6)]({'type':'SWITCH_MOVIE_INFO'}),_0x32fe18[_0x32c92b(0xcd)]({'code':0x0});});});function deleteMovieInfoOfIndex(_0x4f4280,_0x446199){return new Promise((_0x5ca1c7,_0x3508ca)=>{const _0x283020=_0x2a36;let _0x1434a1=path['join'](_0x446199[_0x283020(0x118)],_0x446199[_0x283020(0x126)][_0x283020(0xd2)](0x0,_0x446199[_0x283020(0x126)]['lastIndexOf'](_0x446199[_0x283020(0x108)]))+'.jpg'),_0x1906d7=path[_0x283020(0xc7)](_0x446199[_0x283020(0x118)],_0x446199[_0x283020(0x126)][_0x283020(0xd2)](0x0,_0x446199[_0x283020(0x126)]['lastIndexOf'](_0x446199['ext']))+_0x283020(0xfb)),_0xc02bd6=path[_0x283020(0xc7)](_0x446199[_0x283020(0x118)],_0x446199[_0x283020(0x126)][_0x283020(0xd2)](0x0,_0x446199['filename'][_0x283020(0xce)](_0x446199[_0x283020(0x108)]))+'-fanart.jpg'),_0x22537d=path['join'](_0x446199[_0x283020(0x118)],_0x446199[_0x283020(0x126)][_0x283020(0xd2)](0x0,_0x446199[_0x283020(0x126)]['lastIndexOf'](_0x446199['ext']))+'-poster.jpg'),_0x4899fc=path[_0x283020(0xc7)](_0x446199[_0x283020(0x118)],_0x283020(0xd8)),_0xa7920a=path[_0x283020(0xc7)](_0x446199['path'],_0x446199['filename'][_0x283020(0xd2)](0x0,_0x446199[_0x283020(0x126)][_0x283020(0xce)](_0x446199['ext']))+_0x283020(0x104)),_0x4bf236=[_0x1434a1,_0x4899fc,_0x1906d7,_0xc02bd6,_0x22537d,_0xa7920a];if(_0x446199['is_tvplay']==0x1){let _0x392d26=path[_0x283020(0xc7)](_0x446199[_0x283020(0x118)],_0x283020(0xfe)),_0x79c654=path['join'](_0x446199['path'],'season.nfo');_0x4bf236['push'](_0x392d26),_0x4bf236['push'](_0x79c654);let _0x1c82d5=path[_0x283020(0x135)](_0x446199[_0x283020(0x118)]),_0x2984d2=path[_0x283020(0xd5)](_0x446199[_0x283020(0x118)]),_0x52d052=movieSeasonUtil[_0x283020(0xbf)](_0x1c82d5);if(_0x52d052>0x0){let _0x5b7127=path[_0x283020(0xc7)](_0x2984d2,_0x283020(0xfe));_0x4bf236['push'](_0x5b7127);_0x52d052<0xa&&(_0x52d052='0'+_0x52d052);let _0x130b62=path[_0x283020(0xc7)](_0x2984d2,_0x283020(0x123)+_0x52d052+_0x283020(0x115));_0x4bf236[_0x283020(0xd7)](_0x130b62);let _0x2b751f=path[_0x283020(0xc7)](_0x2984d2,_0x283020(0xd8));_0x4bf236[_0x283020(0xd7)](_0x2b751f);let _0x299f16=path['join'](_0x2984d2,_0x283020(0xd6));_0x4bf236[_0x283020(0xd7)](_0x299f16);}}console[_0x283020(0xbb)](_0x283020(0xfc),_0x4bf236);function _0x16cbb4(){const _0x23ec82=_0x283020;_0x4bf236['length']>0x0?fs[_0x23ec82(0xef)](_0x4bf236[0x0],(_0x1ec401,_0x37a14d)=>{const _0x8f0481=_0x23ec82;!_0x1ec401&&_0x37a14d&&_0x37a14d[_0x8f0481(0x134)]()?(console[_0x8f0481(0xbb)]('清理',_0x4bf236[0x0]),fs['rm'](_0x4bf236[0x0],_0x30e9e0=>{const _0x134002=_0x8f0481;let _0x206dca=_0x4bf236[0x0];_0x4bf236[_0x134002(0xe8)](0x0,0x1),!_0x30e9e0&&(console['log'](_0x134002(0xe5),_0x206dca),dbFileOperationRecord['addFileOperationRecord'](_0x4f4280[_0x134002(0xe4)]['dbOther'],{'username':_0x4f4280['currentUser'][_0x134002(0xf4)],'targetPath':_0x206dca,'level':dbFileOperationRecord[_0x134002(0x119)],'type':dbFileOperationRecord[_0x134002(0x105)],'state':dbFileOperationRecord[_0x134002(0x101)]})),_0x16cbb4();})):(_0x4bf236['splice'](0x0,0x1),_0x16cbb4());}):(movieInfoUtil['saveMovieInfoToDb'](_0x4f4280['app'][_0x23ec82(0x132)],_0x446199['id'],{}),_0x5ca1c7());}_0x16cbb4();});}function clearInfo(_0x29e89a,_0x5720d9,_0x334ad8){return new Promise((_0x1c1b11,_0x47b7ee)=>{const _0x22416e=_0x2a36;if(dbUserTable['doUserCanGet'](_0x29e89a,_0x5720d9,'',_0x22416e(0xd1),_0x334ad8[_0x22416e(0x118)])==!![]){if(_0x334ad8[_0x22416e(0x117)]==0x1){let _0x188434=_0x22416e(0xcc)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x22416e(0xc4),_0x47a1fb=_0x29e89a[_0x22416e(0xe4)]['dbFileIndex'][_0x22416e(0xc9)](_0x188434)[_0x22416e(0x10e)](_0x334ad8[_0x22416e(0x118)]),_0x56b362=[];for(let _0x14a4f5 of _0x47a1fb){_0x56b362[_0x22416e(0xd7)](deleteMovieInfoOfIndex(_0x29e89a,_0x14a4f5));}if(_0x56b362['length']<0x1)return _0x1c1b11();Promise[_0x22416e(0xbe)](_0x56b362)[_0x22416e(0x10f)](_0x517490=>{return _0x1c1b11();})['catch'](_0x46072d=>{return _0x1c1b11();});}else deleteMovieInfoOfIndex(_0x29e89a,_0x334ad8)[_0x22416e(0x10f)](_0x149c52=>{return _0x1c1b11();});}});}router['post']('/clearMovieInfo',(_0x1c90fd,_0x1495e4,_0x314a44)=>{const _0x5a131b=_0xf83001;let _0x28cb62=_0x1c90fd['body'][_0x5a131b(0x107)],_0x37031f=dbFileIndexTable['getById'](_0x1c90fd[_0x5a131b(0xe4)]['dbFileIndex'],_0x28cb62,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x37031f)return _0x1c90fd[_0x5a131b(0xe4)]['returnErrMsg'](_0x1495e4,_0x5a131b(0xbc));clearInfo(_0x1c90fd,_0x1495e4,_0x37031f)[_0x5a131b(0x10f)](()=>{const _0x516a94=_0x5a131b;return _0x1495e4[_0x516a94(0xcd)]({'code':0x0});});}),router[_0xf83001(0xfa)](_0xf83001(0xcb),(_0xdf2e3e,_0x15b89f,_0x1ec4ac)=>{const _0x272eb9=_0xf83001;let _0x34768f=_0xdf2e3e[_0x272eb9(0xe7)][_0x272eb9(0x107)],_0x4bad6f=dbFileIndexTable['getById'](_0xdf2e3e[_0x272eb9(0xe4)][_0x272eb9(0x132)],_0x34768f,dbFileIndexTable[_0x272eb9(0x130)]),_0x3bb75f=_0xdf2e3e['body'][_0x272eb9(0xea)];if(!_0x4bad6f||!_0x3bb75f)return _0xdf2e3e['app'][_0x272eb9(0x109)](_0x15b89f,_0x272eb9(0xcf));dbUserTable[_0x272eb9(0x12d)](_0xdf2e3e,_0x15b89f,'',_0x272eb9(0x11e),_0x4bad6f['path'])==!![]&&clearInfo(_0xdf2e3e,_0x15b89f,_0x4bad6f)['then'](()=>{const _0x34501d=_0x272eb9;return movieInfoUtil[_0x34501d(0xe3)](_0xdf2e3e[_0x34501d(0xe4)][_0x34501d(0xc0)],_0x4bad6f[_0x34501d(0x118)],_0x4bad6f['filename'],_0x4bad6f[_0x34501d(0x117)],_0x3bb75f)[_0x34501d(0x10f)](()=>{const _0x46dba5=_0x34501d;if(_0x4bad6f[_0x46dba5(0x117)]==0x0)updateIndexByNfo(_0xdf2e3e[_0x46dba5(0xe4)]['dbFileIndex'],_0x4bad6f)[_0x46dba5(0x10f)](()=>{});else{}})[_0x34501d(0x102)](_0x257276=>{const _0x3d21a9=_0x34501d;return console[_0x3d21a9(0xbb)](_0x257276),_0xdf2e3e['app'][_0x3d21a9(0x109)](_0x15b89f,_0x15b89f['__']('operationFail'));}),_0x15b89f[_0x34501d(0xcd)]({'code':0x0});});}),router[_0xf83001(0x129)]('/getImdbImg',(_0x5161ae,_0x516a9b,_0xdc2594)=>{const _0x20c2da=_0xf83001;let _0x4ca33f=_0x5161ae[_0x20c2da(0x12f)]['url'];if(!_0x4ca33f||!_0x4ca33f['indexOf'](_0x20c2da(0xf5))==-0x1)return _0x516a9b[_0x20c2da(0x113)](0x194)[_0x20c2da(0xd9)]();_0x4ca33f=decodeURIComponent(_0x4ca33f);let _0x3c8b3d=path['join'](config[_0x20c2da(0xf2)],sha256(_0x4ca33f));function _0x497cb5(){const _0x4fa1dc=_0x20c2da;sharp(_0x3c8b3d,{'failOnError':![]})[_0x4fa1dc(0x121)]({'quality':0x4d})['resize']({'width':0x1f4})['toBuffer']()['then'](_0x2567d4=>{return _0x516a9b['send'](_0x2567d4);})['catch'](_0x4552ba=>{const _0x2b34b9=_0x4fa1dc;return console[_0x2b34b9(0xbb)](_0x2b34b9(0x112),_0x4552ba),_0x516a9b[_0x2b34b9(0x113)](0x194)[_0x2b34b9(0xd9)]();});}fs[_0x20c2da(0xef)](_0x3c8b3d,(_0x5d1fd0,_0x21c50b)=>{const _0xcc6e47=_0x20c2da;if(!_0x5d1fd0)return _0x497cb5();_0x5161ae[_0xcc6e47(0x12f)][_0xcc6e47(0x12b)]==0x1?httpUtil[_0xcc6e47(0x110)](_0x5161ae['app']['dbOther'],_0x4ca33f)[_0xcc6e47(0x10f)](_0x23b194=>{const _0x38c365=_0xcc6e47;return _0x23b194[_0x38c365(0xd3)](_0x516a9b);})[_0xcc6e47(0x102)](_0x1f81f5=>{const _0x322ba5=_0xcc6e47;return _0x516a9b[_0x322ba5(0x113)](0x194)[_0x322ba5(0xd9)]();}):httpUtil[_0xcc6e47(0x110)](_0x5161ae[_0xcc6e47(0xe4)][_0xcc6e47(0xc0)],_0x4ca33f,_0x3c8b3d)[_0xcc6e47(0x10f)](_0x5cf6a3=>{_0x497cb5();})['catch'](_0x16d252=>{const _0x21d8dc=_0xcc6e47;return _0x516a9b[_0x21d8dc(0x113)](0x194)[_0x21d8dc(0xd9)]();});});}),module[_0xf83001(0x127)]=router;