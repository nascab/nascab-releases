const _0x2effaf=_0x5af8;(function(_0xcbfdf7,_0x4986f9){const _0x293e45=_0x5af8,_0xa32f5b=_0xcbfdf7();while(!![]){try{const _0x52c9ee=parseInt(_0x293e45(0x20e))/0x1+-parseInt(_0x293e45(0x23b))/0x2*(parseInt(_0x293e45(0x1f2))/0x3)+-parseInt(_0x293e45(0x254))/0x4*(parseInt(_0x293e45(0x253))/0x5)+parseInt(_0x293e45(0x240))/0x6+parseInt(_0x293e45(0x24f))/0x7+-parseInt(_0x293e45(0x203))/0x8*(parseInt(_0x293e45(0x255))/0x9)+parseInt(_0x293e45(0x222))/0xa*(parseInt(_0x293e45(0x1ee))/0xb);if(_0x52c9ee===_0x4986f9)break;else _0xa32f5b['push'](_0xa32f5b['shift']());}catch(_0x22202b){_0xa32f5b['push'](_0xa32f5b['shift']());}}}(_0x358b,0xf369d));var express=require(_0x2effaf(0x22d)),router=express[_0x2effaf(0x22f)]();const fs=require('fs'),sharp=require(_0x2effaf(0x202)),axios=require('axios');let sha256=require(_0x2effaf(0x207)),path=require(_0x2effaf(0x1eb)),config=require(_0x2effaf(0x24e));const tmdbApi=require(_0x2effaf(0x245)),movieInfoUtil=require('../../utils/movieInfoUtil'),movieSeasonUtil=require('../../utils/movieSeasonUtil'),dbFileIndexTable=require(_0x2effaf(0x201)),dbUserTable=require(_0x2effaf(0x1ed)),dbFileOperationRecord=require(_0x2effaf(0x239)),nfoUtil=require('../../utils/nfoUtil'),httpUtil=require(_0x2effaf(0x1ff));router[_0x2effaf(0x20c)]('/testTmdb',(_0xe2a1d3,_0x1ee78f,_0x1bac5e)=>{const _0x5da64c=_0x2effaf;if(_0xe2a1d3['currentUser'][_0x5da64c(0x1f6)]!=0x1)return _0x1ee78f[_0x5da64c(0x221)]({'code':0x66});let _0x5b906=_0xe2a1d3[_0x5da64c(0x224)]['movieTmdbLanguage'],_0x66bbc=_0xe2a1d3[_0x5da64c(0x224)][_0x5da64c(0x228)],_0x188177=_0xe2a1d3['body'][_0x5da64c(0x249)];if(!_0x5b906)return _0xe2a1d3['app']['returnErrMsg'](_0x1ee78f,_0x5da64c(0x1f7));if(!_0x66bbc)return _0xe2a1d3[_0x5da64c(0x22b)]['returnErrMsg'](_0x1ee78f,_0x5da64c(0x206));if(!_0x188177)return _0xe2a1d3[_0x5da64c(0x22b)][_0x5da64c(0x23a)](_0x1ee78f,'Need\x20tmdb\x20key');let _0x371972=movieInfoUtil['getProxyUrl'](_0xe2a1d3[_0x5da64c(0x22b)][_0x5da64c(0x214)]),_0x50edce=new tmdbApi['API'](_0x188177,_0x5b906,_0x66bbc,_0x371972);_0x50edce[_0x5da64c(0x209)]()[_0x5da64c(0x1ea)](_0x5e86e8=>{const _0x34a42e=_0x5da64c;if(_0x5e86e8['success']==![]||_0x5e86e8[_0x34a42e(0x211)])return _0x1ee78f[_0x34a42e(0x221)]({'code':0x2,'msg':_0x5e86e8[_0x34a42e(0x1f3)]});return _0x1ee78f['json']({'code':0x0,'data':[]});})[_0x5da64c(0x23e)](_0x293604=>{const _0x50150c=_0x5da64c;let _0x4a56de=_0x50150c(0x216);if(_0x293604){if(_0x293604[_0x50150c(0x211)])_0x4a56de+=':'+_0x293604[_0x50150c(0x1f3)];else _0x293604[_0x50150c(0x1e4)]&&(_0x4a56de+=':'+_0x293604['message']);}return _0x1ee78f[_0x50150c(0x221)]({'code':0x2,'msg':_0x4a56de,'data':[]});});}),router[_0x2effaf(0x20c)](_0x2effaf(0x1f1),(_0x3865a,_0x32b514,_0x18a670)=>{const _0x5e8f8b=_0x2effaf;if(_0x3865a[_0x5e8f8b(0x1e1)][_0x5e8f8b(0x1f6)]!=0x1)return _0x32b514['json']({'code':0x66});movieInfoUtil['testTmdb'](_0x3865a[_0x5e8f8b(0x22b)][_0x5e8f8b(0x214)])[_0x5e8f8b(0x1ea)](()=>{return _0x32b514['json']({'code':0x0});})[_0x5e8f8b(0x23e)](_0x289b6f=>{const _0x1b3bc3=_0x5e8f8b;return _0x32b514[_0x1b3bc3(0x221)]({'code':0x2,'msg':_0x289b6f});});}),router['post'](_0x2effaf(0x210),(_0x1174f7,_0x3e5aec,_0x1d9ee6)=>{const _0x267eea=_0x2effaf;let _0x2e8e98=_0x1174f7[_0x267eea(0x224)][_0x267eea(0x25e)],_0x5af28b=_0x1174f7[_0x267eea(0x224)][_0x267eea(0x200)],_0x2488b3=_0x1174f7[_0x267eea(0x224)][_0x267eea(0x1fe)],_0xf7071d=_0x1174f7['body'][_0x267eea(0x24b)];if(!_0x2e8e98||!_0x5af28b||!_0x2488b3)return _0x1174f7[_0x267eea(0x22b)][_0x267eea(0x23a)](_0x3e5aec,_0x267eea(0x241));let _0x2f91b6=movieInfoUtil[_0x267eea(0x258)](_0x1174f7[_0x267eea(0x22b)][_0x267eea(0x214)]);if(_0x5af28b=='KEYWORD')_0x2f91b6['search'](_0x2e8e98,_0x2488b3=='TV',null,_0xf7071d,!![])['then'](_0x49e53d=>{const _0x197d3b=_0x267eea;if(!_0x3e5aec[_0x197d3b(0x246)])return _0x3e5aec[_0x197d3b(0x221)]({'code':0x0,'data':_0x49e53d});})[_0x267eea(0x23e)](_0x275522=>{const _0x1bb667=_0x267eea;console[_0x1bb667(0x212)](_0x1bb667(0x259),_0x275522);if(_0x275522&&_0x275522['status_code']&&_0x275522['status_message'])return _0x1174f7[_0x1bb667(0x22b)][_0x1bb667(0x23a)](_0x3e5aec,_0x275522['status_message']);if(!_0x3e5aec[_0x1bb667(0x246)])return _0x3e5aec[_0x1bb667(0x221)]({'code':0x0,'data':[]});});else{if(_0x5af28b==_0x267eea(0x25b))_0x2f91b6['getDetail'](_0x2e8e98,_0x2488b3=='TV')[_0x267eea(0x1ea)](_0x17360c=>{const _0x3c6ca2=_0x267eea;if(!_0x3e5aec[_0x3c6ca2(0x246)])return _0x3e5aec[_0x3c6ca2(0x221)]({'code':0x0,'data':[_0x17360c]});})[_0x267eea(0x23e)](_0x35b1af=>{const _0x53c9d7=_0x267eea;console[_0x53c9d7(0x212)](_0x53c9d7(0x259),_0x35b1af);if(_0x35b1af&&_0x35b1af[_0x53c9d7(0x211)]&&_0x35b1af[_0x53c9d7(0x1f3)])return _0x1174f7[_0x53c9d7(0x22b)][_0x53c9d7(0x23a)](_0x3e5aec,_0x35b1af[_0x53c9d7(0x1f3)]);if(!_0x3e5aec[_0x53c9d7(0x246)])return _0x3e5aec[_0x53c9d7(0x221)]({'code':0x0,'data':[]});});else{if(!_0x3e5aec[_0x267eea(0x246)])return _0x3e5aec[_0x267eea(0x221)]({'code':0x0,'data':[]});}}});function updateIndexByNfo(_0x2a76c6,_0x384758){return new Promise((_0x40d079,_0x26e732)=>{const _0x6d2bfc=_0x5af8;nfoUtil[_0x6d2bfc(0x22c)](_0x384758,!![],![])[_0x6d2bfc(0x1ea)](_0x5d98b0=>{const _0x530dfc=_0x6d2bfc;return movieInfoUtil[_0x530dfc(0x1ec)](_0x2a76c6,_0x384758['id'],_0x5d98b0),_0x40d079();})['catch'](_0x4ac6c1=>{return _0x40d079();});});}function _0x358b(){const _0x5ce32b=['10211796vswGGX','params\x20error','query','STATE_SUC','err1','../../utils/movieInfoTmdbApi','headersSent','splice','lastIndexOf','movieTmdbApiKey','tvshow.nfo','page','toBuffer','/clearMovieInfo','../../myConfig/config','9413586xaGGRS','url','send','SELECT\x20*\x20FROM\x20','4048450BnNZEc','4EwBWaC','1244277nbVZQs','LEVEL_MAIN_OPERATION','length','getTmdbApi','TMDB\x20search接口请求失败','power_change','TMDBID','-thumb.jpg','-poster.jpg','searchStr','is_tvplay','prepare','currentUser','/scrapeAgain','/getImdbImg','message','要清除的nfo和海报文件列表','刮削文件清理成功','push','.jpg','operationFail','then','path','saveMovieInfoToDb','../../db/dbUserTable','88Ehjaah','indexId','all','/testTmdbProxy','5469eYziqn','status_message','sep','basename','is_admin','Need\x20tmdb\x20language','INDEX_TABLE_NAME_MOVIE','ext','indexId/tmdbId\x20error','offset','fanart.jpg','end','searchMediaType','../../utils/httpUtil','searchType','../../db/dbFileIndexTable','sharp','88LHzcdE','indexOf','filename','Need\x20tmdb\x20api\x20url','sha256','status','languageList','exports','resize','post','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?','404069ZebkIW','join','/searchMovieInfo','status_code','log','doUserCanGet','dbOther','stat','TMDB\x20Error','pipe','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','downloadImg','/getScrapeLog','username','SWITCH_MOVIE_INFO','scrapeMissing','/setMovieInfo','tmdb','indexId\x20error','json','750490rLiDYR','poster.jpg','body','dbFileIndex','dirname','runSearchNfoWorker','movieTmdbApiUrl','addFileOperationRecord','.nfo','app','parseNfo','express','/clearNfoImg','Router','getById','tmdbId','noCache','season.nfo','substring','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','TYPE_DELETE','-fanart.jpg','run','../../db/dbFileOperationRecord','returnErrMsg','794qRSklk','allSettled','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','catch','posterPath'];_0x358b=function(){return _0x5ce32b;};return _0x358b();}function _0x5af8(_0x560ed5,_0x29d620){const _0x358b72=_0x358b();return _0x5af8=function(_0x5af8dc,_0x21c4e2){_0x5af8dc=_0x5af8dc-0x1e0;let _0x4d095b=_0x358b72[_0x5af8dc];return _0x4d095b;},_0x5af8(_0x560ed5,_0x29d620);}router[_0x2effaf(0x20c)](_0x2effaf(0x1e2),(_0x3ce787,_0x4d6552,_0x469b44)=>{const _0x395594=_0x2effaf;let _0x576a48=_0x3ce787[_0x395594(0x224)][_0x395594(0x1ef)],_0x56d61a=_0x3ce787[_0x395594(0x224)][_0x395594(0x21d)],_0x10bb36=dbFileIndexTable[_0x395594(0x230)](_0x3ce787[_0x395594(0x22b)]['dbFileIndex'],_0x576a48,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x10bb36)return _0x3ce787['app']['returnErrMsg'](_0x4d6552,_0x395594(0x220));if(dbUserTable[_0x395594(0x213)](_0x3ce787,_0x4d6552,'',_0x395594(0x25a),_0x10bb36['path'])==!![]){function _0x50d78e(){const _0x3cafe5=_0x395594;movieInfoUtil[_0x3cafe5(0x227)](_0x3ce787[_0x3cafe5(0x22b)]['dbOther'],_0x10bb36['path'],_0x10bb36['filename'],_0x10bb36[_0x3cafe5(0x25f)],null,_0x56d61a)['then'](()=>{const _0x1fab7e=_0x3cafe5;_0x10bb36[_0x1fab7e(0x25f)]==0x0&&updateIndexByNfo(_0x3ce787['app'][_0x1fab7e(0x225)],_0x10bb36)[_0x1fab7e(0x1ea)](()=>{});})[_0x3cafe5(0x23e)](_0x179fa6=>{});}_0x56d61a==0x1?_0x50d78e():clearInfo(_0x3ce787,_0x4d6552,_0x10bb36)[_0x395594(0x1ea)](()=>{_0x50d78e();});if(!_0x4d6552['headersSent'])return _0x4d6552[_0x395594(0x221)]({'code':0x0});}}),router[_0x2effaf(0x20c)](_0x2effaf(0x21a),(_0x1dad90,_0x29a1af,_0x2f1957)=>{const _0x44a5a6=_0x2effaf;if(_0x1dad90[_0x44a5a6(0x1e1)][_0x44a5a6(0x1f6)]!=0x1)return _0x29a1af['json']({'code':0x66});let _0x4b1de9=_0x1dad90[_0x44a5a6(0x224)]['count']||0x1e,_0x180cda=_0x1dad90[_0x44a5a6(0x224)][_0x44a5a6(0x1fb)]||0x0;const _0x431cb1=_0x44a5a6(0x23d);let _0x1a8ee5=_0x1dad90[_0x44a5a6(0x22b)]['dbFileIndex'][_0x44a5a6(0x1e0)](_0x431cb1)[_0x44a5a6(0x1f0)](_0x4b1de9,_0x180cda);return _0x29a1af[_0x44a5a6(0x221)]({'code':0x0,'data':_0x1a8ee5});}),router['post']('/clearScrapeLog',(_0x1df0e2,_0x76b9c1,_0x48815b)=>{const _0x5cc877=_0x2effaf;if(_0x1df0e2[_0x5cc877(0x1e1)][_0x5cc877(0x1f6)]!=0x1)return _0x76b9c1[_0x5cc877(0x221)]({'code':0x66});const _0x391119=_0x5cc877(0x235);return _0x1df0e2[_0x5cc877(0x22b)][_0x5cc877(0x225)][_0x5cc877(0x1e0)](_0x391119)['run'](),_0x76b9c1[_0x5cc877(0x221)]({'code':0x0});}),router[_0x2effaf(0x20c)](_0x2effaf(0x22e),(_0x2b2ecc,_0x548f87,_0x11b435)=>{const _0x471ad8=_0x2effaf;if(_0x2b2ecc[_0x471ad8(0x1e1)]['is_admin']!=0x1)return _0x548f87[_0x471ad8(0x221)]({'code':0x66});let _0x3048ac=_0x2b2ecc['body']['sourceFolder'];if(!_0x3048ac)return _0x2b2ecc[_0x471ad8(0x22b)][_0x471ad8(0x23a)](_0x548f87,'need\x20folder');const _0x50b6a3=_0x471ad8(0x20d);_0x2b2ecc[_0x471ad8(0x22b)][_0x471ad8(0x225)]['prepare'](_0x50b6a3)[_0x471ad8(0x238)](_0x3048ac,_0x3048ac+path[_0x471ad8(0x1f4)]+'%');let _0x2d9cda=_0x471ad8(0x252)+dbFileIndexTable[_0x471ad8(0x1f8)]+'\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?',_0x560397=_0x2b2ecc['app'][_0x471ad8(0x225)]['prepare'](_0x2d9cda)['all'](_0x3048ac,_0x3048ac+path[_0x471ad8(0x1f4)]+'%'),_0x3ac915=[];for(let _0x1fe357 of _0x560397){movieInfoUtil[_0x471ad8(0x1ec)](_0x2b2ecc['app'][_0x471ad8(0x225)],_0x1fe357['id'],{}),_0x3ac915['push'](deleteMovieInfoOfIndex(_0x2b2ecc,_0x1fe357));}Promise[_0x471ad8(0x23c)](_0x3ac915)[_0x471ad8(0x1ea)](_0x4b0def=>{const _0x289710=_0x471ad8;return process['send']({'type':_0x289710(0x21c)}),_0x548f87['json']({'code':0x0});});});function deleteMovieInfoOfIndex(_0x3feef1,_0x1c3fc9){return new Promise((_0x447b08,_0xf9c4bd)=>{const _0x59fbcf=_0x5af8;let _0x3e7048=path[_0x59fbcf(0x20f)](_0x1c3fc9[_0x59fbcf(0x1eb)],_0x1c3fc9[_0x59fbcf(0x205)][_0x59fbcf(0x234)](0x0,_0x1c3fc9[_0x59fbcf(0x205)][_0x59fbcf(0x248)](_0x1c3fc9['ext']))+_0x59fbcf(0x1e8)),_0x2f50f4=path['join'](_0x1c3fc9['path'],_0x1c3fc9[_0x59fbcf(0x205)][_0x59fbcf(0x234)](0x0,_0x1c3fc9['filename'][_0x59fbcf(0x248)](_0x1c3fc9['ext']))+_0x59fbcf(0x25c)),_0x18a52e=path[_0x59fbcf(0x20f)](_0x1c3fc9[_0x59fbcf(0x1eb)],_0x1c3fc9[_0x59fbcf(0x205)][_0x59fbcf(0x234)](0x0,_0x1c3fc9[_0x59fbcf(0x205)][_0x59fbcf(0x248)](_0x1c3fc9[_0x59fbcf(0x1f9)]))+_0x59fbcf(0x237)),_0xccd85a=path[_0x59fbcf(0x20f)](_0x1c3fc9['path'],_0x1c3fc9[_0x59fbcf(0x205)][_0x59fbcf(0x234)](0x0,_0x1c3fc9[_0x59fbcf(0x205)][_0x59fbcf(0x248)](_0x1c3fc9['ext']))+_0x59fbcf(0x25d)),_0x5048d4=path[_0x59fbcf(0x20f)](_0x1c3fc9[_0x59fbcf(0x1eb)],_0x59fbcf(0x223)),_0x1dee7a=path[_0x59fbcf(0x20f)](_0x1c3fc9[_0x59fbcf(0x1eb)],_0x1c3fc9[_0x59fbcf(0x205)][_0x59fbcf(0x234)](0x0,_0x1c3fc9['filename'][_0x59fbcf(0x248)](_0x1c3fc9['ext']))+_0x59fbcf(0x22a)),_0x1a1629=[_0x3e7048,_0x5048d4,_0x2f50f4,_0x18a52e,_0xccd85a,_0x1dee7a];if(_0x1c3fc9[_0x59fbcf(0x25f)]==0x1){let _0x14da46=path['join'](_0x1c3fc9[_0x59fbcf(0x1eb)],'tvshow.nfo'),_0x424cb0=path[_0x59fbcf(0x20f)](_0x1c3fc9['path'],_0x59fbcf(0x233));_0x1a1629[_0x59fbcf(0x1e7)](_0x14da46),_0x1a1629[_0x59fbcf(0x1e7)](_0x424cb0);let _0x5879e2=path[_0x59fbcf(0x1f5)](_0x1c3fc9['path']),_0x10750a=path[_0x59fbcf(0x226)](_0x1c3fc9[_0x59fbcf(0x1eb)]),_0x1e737a=movieSeasonUtil['getSeasonNumber'](_0x5879e2);if(_0x1e737a>0x0){let _0x4973a0=path[_0x59fbcf(0x20f)](_0x10750a,_0x59fbcf(0x24a));_0x1a1629[_0x59fbcf(0x1e7)](_0x4973a0);_0x1e737a<0xa&&(_0x1e737a='0'+_0x1e737a);let _0x432e07=path[_0x59fbcf(0x20f)](_0x10750a,'season'+_0x1e737a+'-poster.jpg');_0x1a1629[_0x59fbcf(0x1e7)](_0x432e07);let _0x388f32=path[_0x59fbcf(0x20f)](_0x10750a,_0x59fbcf(0x223));_0x1a1629[_0x59fbcf(0x1e7)](_0x388f32);let _0x116354=path[_0x59fbcf(0x20f)](_0x10750a,_0x59fbcf(0x1fc));_0x1a1629['push'](_0x116354);}}console[_0x59fbcf(0x212)](_0x59fbcf(0x1e5),_0x1a1629);function _0x3d6c84(){const _0x196a86=_0x59fbcf;_0x1a1629['length']>0x0?fs[_0x196a86(0x215)](_0x1a1629[0x0],(_0x1ff09a,_0x43ec76)=>{const _0x2e854a=_0x196a86;!_0x1ff09a&&_0x43ec76&&_0x43ec76['isFile']()?(console['log']('清理',_0x1a1629[0x0]),fs['rm'](_0x1a1629[0x0],_0x1ba378=>{const _0x8a99d=_0x5af8;let _0x3c97ca=_0x1a1629[0x0];_0x1a1629['splice'](0x0,0x1),!_0x1ba378&&(console['log'](_0x8a99d(0x1e6),_0x3c97ca),dbFileOperationRecord[_0x8a99d(0x229)](_0x3feef1[_0x8a99d(0x22b)]['dbOther'],{'username':_0x3feef1[_0x8a99d(0x1e1)][_0x8a99d(0x21b)],'targetPath':_0x3c97ca,'level':dbFileOperationRecord[_0x8a99d(0x256)],'type':dbFileOperationRecord[_0x8a99d(0x236)],'state':dbFileOperationRecord[_0x8a99d(0x243)]})),_0x3d6c84();})):(_0x1a1629[_0x2e854a(0x247)](0x0,0x1),_0x3d6c84());}):(movieInfoUtil['saveMovieInfoToDb'](_0x3feef1[_0x196a86(0x22b)][_0x196a86(0x225)],_0x1c3fc9['id'],{}),_0x447b08());}_0x3d6c84();});}function clearInfo(_0x2afd2d,_0x3b4904,_0x465878){return new Promise((_0x572be9,_0x248d0c)=>{const _0x3661f8=_0x5af8;if(dbUserTable['doUserCanGet'](_0x2afd2d,_0x3b4904,'','power_delete',_0x465878['path'])==!![]){if(_0x465878[_0x3661f8(0x25f)]==0x1){let _0x2aaa8b=_0x3661f8(0x252)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x3661f8(0x218),_0x46b3c0=_0x2afd2d['app'][_0x3661f8(0x225)][_0x3661f8(0x1e0)](_0x2aaa8b)['all'](_0x465878['path']),_0x4f5f50=[];for(let _0x5cabb5 of _0x46b3c0){_0x4f5f50[_0x3661f8(0x1e7)](deleteMovieInfoOfIndex(_0x2afd2d,_0x5cabb5));}if(_0x4f5f50[_0x3661f8(0x257)]<0x1)return _0x572be9();Promise[_0x3661f8(0x23c)](_0x4f5f50)['then'](_0x88fab4=>{return _0x572be9();})[_0x3661f8(0x23e)](_0x575940=>{return _0x572be9();});}else deleteMovieInfoOfIndex(_0x2afd2d,_0x465878)['then'](_0x221d19=>{return _0x572be9();});}});}router[_0x2effaf(0x20c)](_0x2effaf(0x24d),(_0x44381e,_0x4f2e31,_0xf298ea)=>{const _0x12cfc1=_0x2effaf;let _0x1f61ac=_0x44381e[_0x12cfc1(0x224)]['indexId'],_0x404d10=dbFileIndexTable[_0x12cfc1(0x230)](_0x44381e[_0x12cfc1(0x22b)][_0x12cfc1(0x225)],_0x1f61ac,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x404d10)return _0x44381e['app'][_0x12cfc1(0x23a)](_0x4f2e31,_0x12cfc1(0x220));clearInfo(_0x44381e,_0x4f2e31,_0x404d10)['then'](()=>{const _0x11670a=_0x12cfc1;return _0x4f2e31[_0x11670a(0x221)]({'code':0x0});});}),router[_0x2effaf(0x20c)](_0x2effaf(0x21e),(_0x29f8a4,_0x14e772,_0x3c8be7)=>{const _0xa1dcf8=_0x2effaf;let _0x5cfdaa=_0x29f8a4[_0xa1dcf8(0x224)][_0xa1dcf8(0x1ef)],_0x1d213f=dbFileIndexTable[_0xa1dcf8(0x230)](_0x29f8a4[_0xa1dcf8(0x22b)][_0xa1dcf8(0x225)],_0x5cfdaa,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x53d63a=_0x29f8a4[_0xa1dcf8(0x224)][_0xa1dcf8(0x231)];if(!_0x1d213f||!_0x53d63a)return _0x29f8a4['app'][_0xa1dcf8(0x23a)](_0x14e772,_0xa1dcf8(0x1fa));dbUserTable['doUserCanGet'](_0x29f8a4,_0x14e772,'',_0xa1dcf8(0x25a),_0x1d213f['path'])==!![]&&clearInfo(_0x29f8a4,_0x14e772,_0x1d213f)[_0xa1dcf8(0x1ea)](()=>{const _0x5646dd=_0xa1dcf8;return movieInfoUtil['runSearchNfoWorker'](_0x29f8a4[_0x5646dd(0x22b)][_0x5646dd(0x214)],_0x1d213f[_0x5646dd(0x1eb)],_0x1d213f[_0x5646dd(0x205)],_0x1d213f['is_tvplay'],_0x53d63a)[_0x5646dd(0x1ea)](()=>{const _0x134fc7=_0x5646dd;if(_0x1d213f['is_tvplay']==0x0)updateIndexByNfo(_0x29f8a4[_0x134fc7(0x22b)][_0x134fc7(0x225)],_0x1d213f)['then'](()=>{});else{}})[_0x5646dd(0x23e)](_0x2822c8=>{const _0x22850a=_0x5646dd;return console[_0x22850a(0x212)](_0x2822c8),_0x29f8a4[_0x22850a(0x22b)]['returnErrMsg'](_0x14e772,_0x14e772['__'](_0x22850a(0x1e9)));}),_0x14e772['json']({'code':0x0});});}),router['get'](_0x2effaf(0x1e3),(_0x239f58,_0x47a975,_0x51bee5)=>{const _0x28cbb1=_0x2effaf;let _0x2eccde=_0x239f58['query'][_0x28cbb1(0x250)];if(!_0x2eccde||!_0x2eccde[_0x28cbb1(0x204)](_0x28cbb1(0x21f))==-0x1)return _0x47a975['status'](0x194)[_0x28cbb1(0x1fd)]();_0x2eccde=decodeURIComponent(_0x2eccde);let _0xfc9a35=path[_0x28cbb1(0x20f)](config[_0x28cbb1(0x23f)],sha256(_0x2eccde));function _0x24a7eb(){const _0x48cdc0=_0x28cbb1;sharp(_0xfc9a35,{'failOnError':![]})['jpeg']({'quality':0x4d})[_0x48cdc0(0x20b)]({'width':0x1f4})[_0x48cdc0(0x24c)]()['then'](_0x49c4b3=>{const _0xa83501=_0x48cdc0;return _0x47a975[_0xa83501(0x251)](_0x49c4b3);})[_0x48cdc0(0x23e)](_0x277d5b=>{const _0x4aa873=_0x48cdc0;return console[_0x4aa873(0x212)](_0x4aa873(0x244),_0x277d5b),_0x47a975[_0x4aa873(0x208)](0x194)[_0x4aa873(0x1fd)]();});}fs[_0x28cbb1(0x215)](_0xfc9a35,(_0x49b1c4,_0x542fad)=>{const _0x63ef00=_0x28cbb1;if(!_0x49b1c4)return _0x24a7eb();_0x239f58[_0x63ef00(0x242)][_0x63ef00(0x232)]==0x1?httpUtil['downloadImg'](_0x239f58['app']['dbOther'],_0x2eccde)[_0x63ef00(0x1ea)](_0xac1159=>{const _0x47a25c=_0x63ef00;return _0xac1159[_0x47a25c(0x217)](_0x47a975);})[_0x63ef00(0x23e)](_0x2782ab=>{const _0x18770a=_0x63ef00;return _0x47a975[_0x18770a(0x208)](0x194)[_0x18770a(0x1fd)]();}):httpUtil[_0x63ef00(0x219)](_0x239f58[_0x63ef00(0x22b)][_0x63ef00(0x214)],_0x2eccde,_0xfc9a35)[_0x63ef00(0x1ea)](_0x566c78=>{_0x24a7eb();})['catch'](_0x27595a=>{const _0x2171f2=_0x63ef00;return _0x47a975['status'](0x194)[_0x2171f2(0x1fd)]();});});}),module[_0x2effaf(0x20a)]=router;