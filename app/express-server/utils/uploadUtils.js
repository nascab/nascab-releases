const _0x50eac4=_0x3d5d;(function(_0x41c62a,_0x201b68){const _0x20a0a0=_0x3d5d,_0x45ae5a=_0x41c62a();while(!![]){try{const _0x5eecca=parseInt(_0x20a0a0(0x117))/0x1*(-parseInt(_0x20a0a0(0x125))/0x2)+parseInt(_0x20a0a0(0x10c))/0x3*(parseInt(_0x20a0a0(0x13b))/0x4)+-parseInt(_0x20a0a0(0x111))/0x5*(-parseInt(_0x20a0a0(0x118))/0x6)+-parseInt(_0x20a0a0(0x128))/0x7+parseInt(_0x20a0a0(0x140))/0x8+-parseInt(_0x20a0a0(0x119))/0x9*(parseInt(_0x20a0a0(0x13c))/0xa)+parseInt(_0x20a0a0(0x12f))/0xb*(parseInt(_0x20a0a0(0x11c))/0xc);if(_0x5eecca===_0x201b68)break;else _0x45ae5a['push'](_0x45ae5a['shift']());}catch(_0xcd4163){_0x45ae5a['push'](_0x45ae5a['shift']());}}}(_0x2ebe,0x76843));let fs=require('fs'),path=require(_0x50eac4(0x137)),uploadUtil={},multer=require(_0x50eac4(0x120)),fileUtil=require(_0x50eac4(0x141));const config=require('../../myConfig/config');let dbFileOperationRecord=require(_0x50eac4(0x12c));const storage=multer[_0x50eac4(0x115)]({'destination':function(_0xef1955,_0x1d07b1,_0x10a10e){const _0xd06b89=_0x50eac4;let _0x517210=_0xef1955[_0xd06b89(0x122)][_0xd06b89(0x10d)];if(_0xef1955['query'][_0xd06b89(0x116)]){let _0x4068d5=_0xef1955[_0xd06b89(0x122)][_0xd06b89(0x116)];try{_0x4068d5=decodeURIComponent(_0x4068d5);}catch(_0x2cd2fe){}_0x1d07b1[_0xd06b89(0x12d)]=_0x4068d5;}let _0x2b83d7=path[_0xd06b89(0x110)](_0x517210,_0x1d07b1[_0xd06b89(0x12d)]),_0x1e8f7c=_0xef1955['query'][_0xd06b89(0x129)]||_0xef1955[_0xd06b89(0x12a)]['overMode'];!_0x1e8f7c&&(_0x1e8f7c=_0xd06b89(0x130)),fs['stat'](_0x2b83d7,(_0x4483db,_0x3aa92a)=>{const _0x1480e0=_0xd06b89;if(!_0x4483db){if(_0x1e8f7c==_0x1480e0(0x130))return _0x10a10e(new Error(_0x1480e0(0x133)));else{if(_0x1e8f7c==_0x1480e0(0x11a))_0x1d07b1[_0x1480e0(0x12d)]=new Date()[_0x1480e0(0x10f)]()+_0x1d07b1[_0x1480e0(0x12d)];else{if(_0x1e8f7c==_0x1480e0(0x134)){}}}}_0xef1955[_0x1480e0(0x122)]['originalname']=_0x1d07b1['originalname']['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x1d07b1[_0x1480e0(0x12d)]=(config[_0x1480e0(0x13a)]+_0x1d07b1[_0x1480e0(0x12d)])[_0x1480e0(0x138)](/[<>\\\/:\*\?\"\|]/g,'_'),_0x2b83d7=path[_0x1480e0(0x110)](_0x517210,_0x1d07b1['originalname']),_0xef1955[_0x1480e0(0x122)][_0x1480e0(0x124)]=_0x2b83d7,_0x10a10e(null,_0x517210);});},'filename':function(_0xba4b69,_0x5a4d72,_0x3329d2){const _0x2230a4=_0x50eac4;_0xba4b69[_0x2230a4(0x122)][_0x2230a4(0x136)]?_0x3329d2(null,Buffer[_0x2230a4(0x131)](_0x5a4d72[_0x2230a4(0x12d)])['toString'](_0x2230a4(0x13f))):_0x3329d2(null,_0x5a4d72[_0x2230a4(0x12d)]);}}),multerUpload=multer({'storage':storage})[_0x50eac4(0x127)](_0x50eac4(0x121));function _0x2ebe(){const _0xb6d8a3=['653606XZGXTg','LEVEL_MAIN_OPERATION','single','3808238lsVdIP','overMode','body','set','../../db/dbFileOperationRecord','originalname','message','88847HtGLHG','skip','from','dbOther','SAMENAME','over','torrentPath','base64originalName','path','replace','stat','uploadTempFilePrefix','126472MajEIN','98310pjxRfA','subtitlePath','utimesSync','base64','5563544EIzemQ','../utils/fileUtils','close','3fouJZf','savePath','ctime','getTime','join','92535mbcDqs','uploadSubtitle','exports','length','diskStorage','filename','1JObodY','6aXyWQQ','99bSldHq','rename','uploadFile','1068cpRGQA','json','currentUser','Connection','multer','file','query','returnFileError','saveFullPath'];_0x2ebe=function(){return _0xb6d8a3;};return _0x2ebe();}function _0x3d5d(_0x38e5b7,_0x350231){const _0x2ebea0=_0x2ebe();return _0x3d5d=function(_0x3d5da9,_0x377127){_0x3d5da9=_0x3d5da9-0x10b;let _0x3fa667=_0x2ebea0[_0x3d5da9];return _0x3fa667;},_0x3d5d(_0x38e5b7,_0x350231);}uploadUtil[_0x50eac4(0x11b)]=function(_0x5ee8cb,_0x490134,_0x430d6d,_0x220b86,_0x25f88b,_0x5d7e76,_0xf9a168){const _0x338d13=_0x50eac4;let _0x7deb7b=_0x5ee8cb[_0x338d13(0x122)]['savePath']||_0x5ee8cb[_0x338d13(0x12a)][_0x338d13(0x10d)];if(_0x5ee8cb[_0x338d13(0x122)][_0x338d13(0x112)]==0x1){let _0xc350a2=path[_0x338d13(0x110)](config[_0x338d13(0x13d)],'upload');_0x7deb7b=_0xc350a2;}else _0x25f88b&&(_0x5ee8cb[_0x338d13(0x122)]['base64originalName']=!![]),_0x430d6d&&(_0x7deb7b=fileUtil['decodePath'](_0x7deb7b));if(_0x7deb7b=='nascab_torrentSavePath'){let _0x95eb18=path['join'](config[_0x338d13(0x135)]);_0x7deb7b=_0x95eb18;}_0x5ee8cb[_0x338d13(0x122)][_0x338d13(0x10d)]=_0x7deb7b,multerUpload(_0x5ee8cb,_0x490134,function(_0xef6b4a){const _0x3c3ab8=_0x338d13;if(_0xef6b4a)return _0xef6b4a[_0x3c3ab8(0x12e)]==_0x3c3ab8(0x133)?(_0x490134['statusCode']=0xc8,_0x490134[_0x3c3ab8(0x12b)](_0x3c3ab8(0x11f),_0x3c3ab8(0x10b)),_0x490134[_0x3c3ab8(0x11d)]({'code':0x1,'remark':'SAMENAME','message':_0x490134['__']('sameNameFileAlreadExist')})):(_0xf9a168&&_0xf9a168(_0xef6b4a),fileUtil['returnFileError'](_0x490134,_0xef6b4a));if(!_0x5ee8cb[_0x3c3ab8(0x122)]['originalname']){_0xf9a168&&_0xf9a168(_0xef6b4a);return;}let _0x3bfb=path[_0x3c3ab8(0x110)](_0x5ee8cb[_0x3c3ab8(0x122)][_0x3c3ab8(0x10d)],_0x5ee8cb[_0x3c3ab8(0x122)][_0x3c3ab8(0x12d)]);fs[_0x3c3ab8(0x139)](_0x5ee8cb['query'][_0x3c3ab8(0x124)],(_0x358eb4,_0x528537)=>{const _0x2de890=_0x3c3ab8;if(_0x358eb4){_0xf9a168&&_0xf9a168(_0x358eb4);return;}_0x528537['isFile']()&&fs[_0x2de890(0x11a)](_0x5ee8cb[_0x2de890(0x122)]['saveFullPath'],_0x3bfb,_0x3710bb=>{const _0x53955c=_0x2de890;if(_0x3710bb)return _0xf9a168&&_0xf9a168(_0x3710bb),fileUtil[_0x53955c(0x123)](_0x490134,_0x3710bb);else{dbFileOperationRecord['addFileOperationRecord'](_0x5ee8cb['app'][_0x53955c(0x132)],{'username':_0x5ee8cb[_0x53955c(0x11e)]['username'],'targetPath':_0x3bfb,'level':dbFileOperationRecord[_0x53955c(0x126)],'type':dbFileOperationRecord['TYPE_UPLOAD'],'state':dbFileOperationRecord['STATE_SUC']}),_0x5ee8cb['file'][_0x53955c(0x137)]=_0x3bfb,_0x5ee8cb[_0x53955c(0x121)][_0x53955c(0x116)]=_0x5ee8cb['query']['originalname'];let _0x3ad8e3=_0x5ee8cb[_0x53955c(0x12a)]['ctime']||_0x5ee8cb[_0x53955c(0x122)][_0x53955c(0x10e)];try{if(_0x3ad8e3){_0x3ad8e3=_0x3ad8e3+'';if(_0x3ad8e3[_0x53955c(0x114)]==0xa)fs[_0x53955c(0x13e)](_0x3bfb,_0x3ad8e3,_0x3ad8e3);else{}}}catch(_0x40f7a2){}_0x5d7e76&&_0x5d7e76(_0x5ee8cb[_0x53955c(0x121)]);if(!_0x220b86)return _0x490134[_0x53955c(0x11d)]({'code':0x0,'file':_0x5ee8cb['file']});}});});});},module[_0x50eac4(0x113)]=uploadUtil;