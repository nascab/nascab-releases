const _0x4a90c5=_0x5ca7;(function(_0x238439,_0x317aff){const _0x132ce6=_0x5ca7,_0x2f1f29=_0x238439();while(!![]){try{const _0x5af3e7=parseInt(_0x132ce6(0xa5))/0x1+parseInt(_0x132ce6(0x8d))/0x2+parseInt(_0x132ce6(0xa1))/0x3*(parseInt(_0x132ce6(0x88))/0x4)+parseInt(_0x132ce6(0x9a))/0x5+-parseInt(_0x132ce6(0xb2))/0x6*(parseInt(_0x132ce6(0x9d))/0x7)+parseInt(_0x132ce6(0x98))/0x8*(-parseInt(_0x132ce6(0xb4))/0x9)+-parseInt(_0x132ce6(0x8b))/0xa;if(_0x5af3e7===_0x317aff)break;else _0x2f1f29['push'](_0x2f1f29['shift']());}catch(_0x2fd7f3){_0x2f1f29['push'](_0x2f1f29['shift']());}}}(_0x22e1,0xca3ee));let fs=require('fs'),path=require(_0x4a90c5(0xa7)),uploadUtil={},multer=require(_0x4a90c5(0x9f)),fileUtil=require('../utils/fileUtils');const config=require(_0x4a90c5(0x91));function _0x22e1(){const _0x4588b1=['json','isFile','77zlUnmr','stat','multer','filename','761403FSTVEd','TYPE_UPLOAD','addFileOperationRecord','uploadSubtitle','49052pqJxpc','toString','path','base64originalName','body','set','app','savePath','close','join','overMode','replace','originalname','313890qJxeul','base64','792189fmOmhc','subtitlePath','LEVEL_MAIN_OPERATION','query','dbOther','ctime','from','decodePath','16sPIHiM','single','uploadTempFilePrefix','13577920nCcyNQ','uploadFile','1622102GhEKrT','skip','saveFullPath','SAMENAME','../../myConfig/config','rename','file','over','diskStorage','sameNameFileAlreadExist','returnFileError','64snhWLS','utimesSync','7952580bYcXrf'];_0x22e1=function(){return _0x4588b1;};return _0x22e1();}function _0x5ca7(_0x84941f,_0x2757dd){const _0x22e16b=_0x22e1();return _0x5ca7=function(_0x5ca7f0,_0x3e3eed){_0x5ca7f0=_0x5ca7f0-0x81;let _0x26d43e=_0x22e16b[_0x5ca7f0];return _0x26d43e;},_0x5ca7(_0x84941f,_0x2757dd);}let dbFileOperationRecord=require('../../db/dbFileOperationRecord');const storage=multer[_0x4a90c5(0x95)]({'destination':function(_0x34fe07,_0x3b61d3,_0x2503fc){const _0x535525=_0x4a90c5;let _0x5e5569=_0x34fe07['query'][_0x535525(0xac)];if(_0x34fe07[_0x535525(0x83)]['filename']){let _0x1f0b43=_0x34fe07[_0x535525(0x83)]['filename'];try{_0x1f0b43=decodeURIComponent(_0x1f0b43);}catch(_0x518d59){}_0x3b61d3[_0x535525(0xb1)]=_0x1f0b43;}let _0x58fed6=path['join'](_0x5e5569,_0x3b61d3['originalname']),_0x4c6ac9=_0x34fe07['query'][_0x535525(0xaf)]||_0x34fe07[_0x535525(0xa9)]['overMode'];!_0x4c6ac9&&(_0x4c6ac9='skip'),fs[_0x535525(0x9e)](_0x58fed6,(_0xb1732c,_0x330492)=>{const _0x830d7f=_0x535525;if(!_0xb1732c){if(_0x4c6ac9==_0x830d7f(0x8e))return _0x2503fc(new Error(_0x830d7f(0x90)));else{if(_0x4c6ac9==_0x830d7f(0x92))_0x3b61d3[_0x830d7f(0xb1)]=new Date()['getTime']()+_0x3b61d3[_0x830d7f(0xb1)];else{if(_0x4c6ac9==_0x830d7f(0x94)){}}}}_0x34fe07[_0x830d7f(0x83)]['originalname']=_0x3b61d3['originalname']['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x3b61d3[_0x830d7f(0xb1)]=(config[_0x830d7f(0x8a)]+_0x3b61d3[_0x830d7f(0xb1)])[_0x830d7f(0xb0)](/[<>\\\/:\*\?\"\|]/g,'_'),_0x58fed6=path[_0x830d7f(0xae)](_0x5e5569,_0x3b61d3[_0x830d7f(0xb1)]),_0x34fe07[_0x830d7f(0x83)]['saveFullPath']=_0x58fed6,_0x2503fc(null,_0x5e5569);});},'filename':function(_0x54dea7,_0x3f1c65,_0x33175f){const _0x5dd030=_0x4a90c5;_0x54dea7[_0x5dd030(0x83)]['base64originalName']?_0x33175f(null,Buffer[_0x5dd030(0x86)](_0x3f1c65['originalname'])[_0x5dd030(0xa6)](_0x5dd030(0xb3))):_0x33175f(null,_0x3f1c65[_0x5dd030(0xb1)]);}}),multerUpload=multer({'storage':storage})[_0x4a90c5(0x89)](_0x4a90c5(0x93));uploadUtil[_0x4a90c5(0x8c)]=function(_0xff342f,_0x50c543,_0x57a622,_0xc11d6d,_0x4e1d6c,_0x1d0e19,_0x5c265d){const _0x372e70=_0x4a90c5;let _0x1d969e=_0xff342f[_0x372e70(0x83)]['savePath']||_0xff342f[_0x372e70(0xa9)][_0x372e70(0xac)];if(_0xff342f[_0x372e70(0x83)][_0x372e70(0xa4)]==0x1){let _0x2d20b4=path[_0x372e70(0xae)](config[_0x372e70(0x81)],'upload');_0x1d969e=_0x2d20b4;}else _0x4e1d6c&&(_0xff342f[_0x372e70(0x83)][_0x372e70(0xa8)]=!![]),_0x57a622&&(_0x1d969e=fileUtil[_0x372e70(0x87)](_0x1d969e));if(_0x1d969e=='nascab_torrentSavePath'){let _0x51a5cb=path['join'](config['torrentPath']);_0x1d969e=_0x51a5cb;}_0xff342f[_0x372e70(0x83)][_0x372e70(0xac)]=_0x1d969e,multerUpload(_0xff342f,_0x50c543,function(_0x30aac3){const _0x4d42a3=_0x372e70;if(_0x30aac3)return _0x30aac3['message']==_0x4d42a3(0x90)?(_0x50c543['statusCode']=0xc8,_0x50c543[_0x4d42a3(0xaa)]('Connection',_0x4d42a3(0xad)),_0x50c543['json']({'code':0x1,'remark':_0x4d42a3(0x90),'message':_0x50c543['__'](_0x4d42a3(0x96))})):(_0x5c265d&&_0x5c265d(_0x30aac3),fileUtil[_0x4d42a3(0x97)](_0x50c543,_0x30aac3));if(!_0xff342f[_0x4d42a3(0x83)][_0x4d42a3(0xb1)]){_0x5c265d&&_0x5c265d(_0x30aac3);return;}let _0x5481ca=path[_0x4d42a3(0xae)](_0xff342f['query'][_0x4d42a3(0xac)],_0xff342f[_0x4d42a3(0x83)][_0x4d42a3(0xb1)]);fs['stat'](_0xff342f[_0x4d42a3(0x83)][_0x4d42a3(0x8f)],(_0x3d8156,_0xb2239d)=>{const _0x34a1f2=_0x4d42a3;if(_0x3d8156){_0x5c265d&&_0x5c265d(_0x3d8156);return;}_0xb2239d[_0x34a1f2(0x9c)]()&&fs[_0x34a1f2(0x92)](_0xff342f[_0x34a1f2(0x83)][_0x34a1f2(0x8f)],_0x5481ca,_0x2aefcc=>{const _0x28934e=_0x34a1f2;if(_0x2aefcc)return _0x5c265d&&_0x5c265d(_0x2aefcc),fileUtil['returnFileError'](_0x50c543,_0x2aefcc);else{dbFileOperationRecord[_0x28934e(0xa3)](_0xff342f[_0x28934e(0xab)][_0x28934e(0x84)],{'username':_0xff342f['currentUser']['username'],'targetPath':_0x5481ca,'level':dbFileOperationRecord[_0x28934e(0x82)],'type':dbFileOperationRecord[_0x28934e(0xa2)],'state':dbFileOperationRecord['STATE_SUC']}),_0xff342f[_0x28934e(0x93)]['path']=_0x5481ca,_0xff342f[_0x28934e(0x93)][_0x28934e(0xa0)]=_0xff342f[_0x28934e(0x83)][_0x28934e(0xb1)];let _0x2d9b2b=_0xff342f['body'][_0x28934e(0x85)]||_0xff342f['query'][_0x28934e(0x85)];try{if(_0x2d9b2b){_0x2d9b2b=_0x2d9b2b+'';if(_0x2d9b2b['length']==0xa)fs[_0x28934e(0x99)](_0x5481ca,_0x2d9b2b,_0x2d9b2b);else{}}}catch(_0x1a1a10){}_0x1d0e19&&_0x1d0e19(_0xff342f[_0x28934e(0x93)]);if(!_0xc11d6d)return _0x50c543[_0x28934e(0x9b)]({'code':0x0,'file':_0xff342f[_0x28934e(0x93)]});}});});});},module['exports']=uploadUtil;