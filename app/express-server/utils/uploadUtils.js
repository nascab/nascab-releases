const _0x51144f=_0x2bc2;function _0x2bc2(_0x4ea71a,_0x362c52){const _0x8b436b=_0x8b43();return _0x2bc2=function(_0x2bc22a,_0x4f41fc){_0x2bc22a=_0x2bc22a-0x1a0;let _0x5d505d=_0x8b436b[_0x2bc22a];return _0x5d505d;},_0x2bc2(_0x4ea71a,_0x362c52);}function _0x8b43(){const _0x5c0849=['ctime','overMode','replace','isFile','413819XUJDNB','app','SAMENAME','single','skip','message','close','3wvQjgo','decodePath','sameNameFileAlreadExist','892wiDGRC','subtitlePath','saveFullPath','rename','getTime','../../db/dbFileOperationRecord','currentUser','1711810cxAGBB','421inGXjl','toString','file','over','1190313khedDU','statusCode','body','../../myConfig/config','query','json','filename','534028cbFuEw','36uOrXVx','savePath','base64originalName','../utils/fileUtils','426120QzClXj','returnFileError','LEVEL_MAIN_OPERATION','28092HwAIDM','8OhjMAq','utimesSync','475MbXzxm','join','username','STATE_SUC','diskStorage','originalname','from','upload','path','base64','nascab_torrentSavePath','uploadFile'];_0x8b43=function(){return _0x5c0849;};return _0x8b43();}(function(_0x26095c,_0x33c4ff){const _0x18e81d=_0x2bc2,_0x443af7=_0x26095c();while(!![]){try{const _0x4e52b6=parseInt(_0x18e81d(0x1ca))/0x1*(-parseInt(_0x18e81d(0x1c2))/0x2)+-parseInt(_0x18e81d(0x1bf))/0x3*(-parseInt(_0x18e81d(0x1a2))/0x4)+parseInt(_0x18e81d(0x1a8))/0x5*(parseInt(_0x18e81d(0x1a5))/0x6)+-parseInt(_0x18e81d(0x1b8))/0x7+-parseInt(_0x18e81d(0x1a6))/0x8*(parseInt(_0x18e81d(0x1ce))/0x9)+parseInt(_0x18e81d(0x1c9))/0xa+-parseInt(_0x18e81d(0x1d5))/0xb*(-parseInt(_0x18e81d(0x1d6))/0xc);if(_0x4e52b6===_0x33c4ff)break;else _0x443af7['push'](_0x443af7['shift']());}catch(_0x4067c9){_0x443af7['push'](_0x443af7['shift']());}}}(_0x8b43,0x7762d));let fs=require('fs'),path=require('path'),uploadUtil={},multer=require('multer'),fileUtil=require(_0x51144f(0x1a1));const config=require(_0x51144f(0x1d1));let dbFileOperationRecord=require(_0x51144f(0x1c7));const storage=multer[_0x51144f(0x1ac)]({'destination':function(_0x9c0d9b,_0x556d40,_0x30fd23){const _0x9201c3=_0x51144f;let _0x163895=_0x9c0d9b[_0x9201c3(0x1d2)][_0x9201c3(0x1d7)];if(_0x9c0d9b[_0x9201c3(0x1d2)][_0x9201c3(0x1d4)]){let _0xbe3e87=_0x9c0d9b[_0x9201c3(0x1d2)][_0x9201c3(0x1d4)];try{_0xbe3e87=decodeURIComponent(_0xbe3e87);}catch(_0x5e827a){}_0x556d40[_0x9201c3(0x1ad)]=_0xbe3e87;}let _0x29c1f7=path[_0x9201c3(0x1a9)](_0x163895,_0x556d40[_0x9201c3(0x1ad)]),_0x363be2=_0x9c0d9b[_0x9201c3(0x1d2)]['overMode']||_0x9c0d9b['body'][_0x9201c3(0x1b5)];!_0x363be2&&(_0x363be2=_0x9201c3(0x1bc)),fs['stat'](_0x29c1f7,(_0x5ad643,_0x4cafc4)=>{const _0x2266e2=_0x9201c3;if(!_0x5ad643){if(_0x363be2=='skip')return _0x30fd23(new Error('SAMENAME'));else{if(_0x363be2=='rename')_0x556d40['originalname']=new Date()[_0x2266e2(0x1c6)]()+_0x556d40[_0x2266e2(0x1ad)];else{if(_0x363be2==_0x2266e2(0x1cd)){}}}}_0x9c0d9b[_0x2266e2(0x1d2)][_0x2266e2(0x1ad)]=_0x556d40['originalname']['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x556d40['originalname']=(config['uploadTempFilePrefix']+_0x556d40['originalname'])[_0x2266e2(0x1b6)](/[<>\\\/:\*\?\"\|]/g,'_'),_0x29c1f7=path[_0x2266e2(0x1a9)](_0x163895,_0x556d40[_0x2266e2(0x1ad)]),_0x9c0d9b[_0x2266e2(0x1d2)][_0x2266e2(0x1c4)]=_0x29c1f7,_0x30fd23(null,_0x163895);});},'filename':function(_0x41f9e2,_0x3eb0aa,_0x3161e1){const _0x402252=_0x51144f;_0x41f9e2[_0x402252(0x1d2)][_0x402252(0x1a0)]?_0x3161e1(null,Buffer[_0x402252(0x1ae)](_0x3eb0aa[_0x402252(0x1ad)])[_0x402252(0x1cb)](_0x402252(0x1b1))):_0x3161e1(null,_0x3eb0aa[_0x402252(0x1ad)]);}}),multerUpload=multer({'storage':storage})[_0x51144f(0x1bb)]('file');uploadUtil[_0x51144f(0x1b3)]=function(_0x3bad8d,_0x1495f0,_0x440292,_0x4102a7,_0x496099,_0x328160,_0x407ed8){const _0x23fdb1=_0x51144f;let _0x5bb0ab=_0x3bad8d[_0x23fdb1(0x1d2)]['savePath']||_0x3bad8d['body']['savePath'];if(_0x3bad8d['query']['uploadSubtitle']==0x1){let _0x594e9c=path['join'](config[_0x23fdb1(0x1c3)],_0x23fdb1(0x1af));_0x5bb0ab=_0x594e9c;}else _0x496099&&(_0x3bad8d[_0x23fdb1(0x1d2)][_0x23fdb1(0x1a0)]=!![]),_0x440292&&(_0x5bb0ab=fileUtil[_0x23fdb1(0x1c0)](_0x5bb0ab));if(_0x5bb0ab==_0x23fdb1(0x1b2)){let _0x57393e=path[_0x23fdb1(0x1a9)](config['torrentPath']);_0x5bb0ab=_0x57393e;}_0x3bad8d[_0x23fdb1(0x1d2)][_0x23fdb1(0x1d7)]=_0x5bb0ab,multerUpload(_0x3bad8d,_0x1495f0,function(_0x98954c){const _0x29ac96=_0x23fdb1;if(_0x98954c)return _0x98954c[_0x29ac96(0x1bd)]==_0x29ac96(0x1ba)?(_0x1495f0[_0x29ac96(0x1cf)]=0xc8,_0x1495f0['set']('Connection',_0x29ac96(0x1be)),_0x1495f0[_0x29ac96(0x1d3)]({'code':0x1,'remark':_0x29ac96(0x1ba),'message':_0x1495f0['__'](_0x29ac96(0x1c1))})):(_0x407ed8&&_0x407ed8(_0x98954c),fileUtil['returnFileError'](_0x1495f0,_0x98954c));if(!_0x3bad8d[_0x29ac96(0x1d2)]['originalname']){_0x407ed8&&_0x407ed8(_0x98954c);return;}let _0x1e4be9=path[_0x29ac96(0x1a9)](_0x3bad8d[_0x29ac96(0x1d2)]['savePath'],_0x3bad8d[_0x29ac96(0x1d2)][_0x29ac96(0x1ad)]);fs['stat'](_0x3bad8d[_0x29ac96(0x1d2)][_0x29ac96(0x1c4)],(_0x45685a,_0x49d705)=>{const _0x1effc5=_0x29ac96;if(_0x45685a){_0x407ed8&&_0x407ed8(_0x45685a);return;}_0x49d705[_0x1effc5(0x1b7)]()&&fs[_0x1effc5(0x1c5)](_0x3bad8d[_0x1effc5(0x1d2)][_0x1effc5(0x1c4)],_0x1e4be9,_0x4c7307=>{const _0x131c86=_0x1effc5;if(_0x4c7307)return _0x407ed8&&_0x407ed8(_0x4c7307),fileUtil[_0x131c86(0x1a3)](_0x1495f0,_0x4c7307);else{dbFileOperationRecord['addFileOperationRecord'](_0x3bad8d[_0x131c86(0x1b9)]['dbOther'],{'username':_0x3bad8d[_0x131c86(0x1c8)][_0x131c86(0x1aa)],'targetPath':_0x1e4be9,'level':dbFileOperationRecord[_0x131c86(0x1a4)],'type':dbFileOperationRecord['TYPE_UPLOAD'],'state':dbFileOperationRecord[_0x131c86(0x1ab)]}),_0x3bad8d[_0x131c86(0x1cc)][_0x131c86(0x1b0)]=_0x1e4be9,_0x3bad8d['file']['filename']=_0x3bad8d['query']['originalname'];let _0x4af33a=_0x3bad8d[_0x131c86(0x1d0)][_0x131c86(0x1b4)]||_0x3bad8d[_0x131c86(0x1d2)][_0x131c86(0x1b4)];try{if(_0x4af33a){_0x4af33a=_0x4af33a+'';if(_0x4af33a['length']==0xa)fs[_0x131c86(0x1a7)](_0x1e4be9,_0x4af33a,_0x4af33a);else{}}}catch(_0x30a9fc){}_0x328160&&_0x328160(_0x3bad8d[_0x131c86(0x1cc)]);if(!_0x4102a7)return _0x1495f0[_0x131c86(0x1d3)]({'code':0x0,'file':_0x3bad8d[_0x131c86(0x1cc)]});}});});});},module['exports']=uploadUtil;