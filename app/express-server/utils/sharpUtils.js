const _0x56b486=_0x3f5f;(function(_0x5a57e8,_0x15bf90){const _0x52bf2a=_0x3f5f,_0x3249e4=_0x5a57e8();while(!![]){try{const _0x29ea8b=-parseInt(_0x52bf2a(0x142))/0x1*(parseInt(_0x52bf2a(0x12f))/0x2)+-parseInt(_0x52bf2a(0x13d))/0x3*(-parseInt(_0x52bf2a(0x13e))/0x4)+-parseInt(_0x52bf2a(0xe3))/0x5*(-parseInt(_0x52bf2a(0x133))/0x6)+-parseInt(_0x52bf2a(0x131))/0x7*(parseInt(_0x52bf2a(0xdc))/0x8)+parseInt(_0x52bf2a(0x11e))/0x9*(-parseInt(_0x52bf2a(0x12e))/0xa)+parseInt(_0x52bf2a(0xe1))/0xb+parseInt(_0x52bf2a(0xe5))/0xc;if(_0x29ea8b===_0x15bf90)break;else _0x3249e4['push'](_0x3249e4['shift']());}catch(_0x4ee5fd){_0x3249e4['push'](_0x3249e4['shift']());}}}(_0x30fb,0x644e2));let path=require(_0x56b486(0x114)),fs=require('fs'),FFmpeg=require(_0x56b486(0xff))[_0x56b486(0x101)],sharpUtil={};const sharp=require(_0x56b486(0xe9)),libheif=require(_0x56b486(0x121)),config=require(_0x56b486(0xf2)),transCodeUtil=require(_0x56b486(0x104)),sharpBmp=require('sharp-bmp');function _0x3f5f(_0x45c052,_0x193bf9){const _0x30fbc8=_0x30fb();return _0x3f5f=function(_0x3f5fd1,_0x575f35){_0x3f5fd1=_0x3f5fd1-0xda;let _0xd50875=_0x30fbc8[_0x3f5fd1];return _0xd50875;},_0x3f5f(_0x45c052,_0x193bf9);}let sha256=require(_0x56b486(0x13f));const {Worker}=require('worker_threads');let dcraw;function getDcraw(){const _0x19a007=_0x56b486;if(!dcraw)try{return dcraw=require('dcraw'),dcraw;}catch(_0x3c0998){return console[_0x19a007(0x12b)](_0x19a007(0x135)),null;}else return dcraw;}let PSD;function getPsd(){const _0xf112fb=_0x56b486;if(!PSD)try{return PSD=require(_0xf112fb(0x118)),PSD;}catch(_0x2fb9b8){return console[_0xf112fb(0x12b)](_0xf112fb(0x119)),null;}else return PSD;}function extractThumbnailFromRaw(_0x58d498,_0x8ff802){return new Promise((_0x36d08b,_0x39913d)=>{const _0x193466=_0x3f5f;if(_0x8ff802&&_0x8ff802[_0x193466(0xef)]()==_0x193466(0xf3)){let _0x4c6998=getPsd();if(!_0x4c6998)return _0x39913d(null);try{if(typeof _0x58d498==_0x193466(0x109)){let _0x12fda2=path['join'](config['cachePath'],sha256(_0x58d498)+_0x193466(0xe7));fs[_0x193466(0xf8)](_0x12fda2,(_0x32de90,_0x26b3b5)=>{const _0x3fdc90=_0x193466;try{if(_0x32de90){let _0xa656c3=_0x4c6998[_0x3fdc90(0x117)](_0x58d498);_0xa656c3[_0x3fdc90(0x12d)](),_0xa656c3[_0x3fdc90(0x113)][_0x3fdc90(0xdd)](_0x12fda2)['then'](()=>{const _0x255b48=_0x3fdc90;sharp(_0x12fda2)['jpeg']({'quality':0x4d})[_0x255b48(0x137)]()[_0x255b48(0x103)](_0x38f7dd=>{fs['writeFile'](_0x12fda2,_0x38f7dd,_0x4d16cf=>{if(_0x4d16cf)return _0x39913d(null);_0x36d08b(_0x12fda2);});})[_0x255b48(0x10f)](_0x56f965=>{const _0xc8782e=_0x255b48;return console['log'](_0xc8782e(0x108),_0x56f965),_0x39913d(null);});})[_0x3fdc90(0x10f)](_0xb1a563=>{return console['log']('psd\x20error\x201',_0xb1a563),_0x39913d(null);});}else return _0x36d08b(_0x12fda2);}catch(_0x2eb3d8){return console[_0x3fdc90(0x12b)]('psd\x20error\x202',_0x2eb3d8),_0x39913d(null);}});}else return _0x39913d(null);}catch(_0x593b4e){return _0x39913d(null);}}else{let _0x54163a=getDcraw();if(!_0x54163a)return _0x39913d(null);function _0xf1653d(_0x2f4261){try{const _0x1a64cb=_0x54163a(_0x2f4261,{'extractThumbnail':!![],'identify':!![]});return _0x1a64cb?_0x36d08b(_0x1a64cb):_0x39913d(null);}catch(_0xd46fb3){return _0x39913d(null);}}if(typeof _0x58d498==_0x193466(0x109))fs[_0x193466(0xe8)](_0x58d498,(_0x4f1aab,_0x28207e)=>{const _0x15cc6a=_0x193466;if(_0x4f1aab)return console['log'](_0x15cc6a(0xf4),_0x58d498),_0x39913d(_0x4f1aab);_0xf1653d(_0x28207e);});else{if(Buffer[_0x193466(0x136)](_0x58d498))_0xf1653d(_0x58d498);else return _0x39913d(null);}}});}const exifUtils=require(_0x56b486(0x141));sharpUtil['getSharpInstanceFromInput']=function(_0x2ae2d1){const _0x3a0b8f=_0x56b486;_0x2ae2d1[_0x3a0b8f(0xee)]==_0x3a0b8f(0x11b)&&(_0x2ae2d1=Buffer[_0x3a0b8f(0x11d)](_0x2ae2d1));let _0x448930={'failOnError':![]};return _0x2ae2d1[_0x3a0b8f(0x127)]&&_0x2ae2d1[_0x3a0b8f(0x10c)]&&_0x2ae2d1['data']&&(_0x448930[_0x3a0b8f(0x10e)]={'width':_0x2ae2d1[_0x3a0b8f(0x127)],'height':_0x2ae2d1[_0x3a0b8f(0x10c)],'channels':0x4},_0x2ae2d1=_0x2ae2d1[_0x3a0b8f(0x13a)]),sharp(_0x2ae2d1,_0x448930);},sharpUtil[_0x56b486(0x122)]=function(_0x1e1a9c){const _0x522698=_0x56b486;typeof _0x1e1a9c==_0x522698(0x109)&&_0x1e1a9c['startsWith'](config[_0x522698(0xf1)])&&fs['rm'](_0x1e1a9c,_0x2606ca=>{});},sharpUtil[_0x56b486(0xe6)]=function(_0x213568,_0x3281a2,_0x5070b6,_0x13b8e2,_0x2e2d2e,_0x266745,_0x14e1e7,_0x3eda7a,_0x43c8c8,_0x3da510,_0x2da9f7){const _0x8e3c17=_0x56b486;if(!_0x213568)return _0x14e1e7(null);let _0xa6f9f2=sharpUtil[_0x8e3c17(0xe2)](_0x213568);_0x3281a2==_0x8e3c17(0xf6)?_0x2da9f7?_0xa6f9f2=_0xa6f9f2[_0x8e3c17(0xf6)](_0x2da9f7):_0xa6f9f2=_0xa6f9f2[_0x8e3c17(0xf6)]():_0xa6f9f2=_0xa6f9f2[_0x8e3c17(0xed)]({});_0x5070b6&&(_0xa6f9f2=_0xa6f9f2[_0x8e3c17(0xfc)]());let _0x4c4c48=exifUtils[_0x8e3c17(0x102)](_0x3da510);_0x4c4c48?_0xa6f9f2=_0xa6f9f2[_0x8e3c17(0xdf)](_0x4c4c48):_0xa6f9f2=_0xa6f9f2[_0x8e3c17(0xdf)]();_0x13b8e2&&(_0xa6f9f2=_0xa6f9f2[_0x8e3c17(0x12a)](_0x13b8e2));if(_0x2e2d2e=='file')_0xa6f9f2[_0x8e3c17(0x125)](_0x266745,(_0x52a943,_0x44a11a)=>{const _0x58010d=_0x8e3c17;_0x43c8c8&&(console[_0x58010d(0x12b)](_0x58010d(0xfa),_0x213568),sharpUtil[_0x58010d(0x122)](_0x213568)),_0x52a943?(console['log'](_0x58010d(0x107),_0x213568,_0x52a943),_0x3eda7a()):_0x14e1e7(_0x266745);});else _0x2e2d2e==_0x8e3c17(0x10b)&&_0xa6f9f2[_0x8e3c17(0x137)]((_0x30ff6b,_0x20cac0,_0x256cad)=>{const _0x4295e5=_0x8e3c17;_0x43c8c8&&sharpUtil[_0x4295e5(0x122)](_0x213568),_0x30ff6b?(console[_0x4295e5(0x12b)](_0x4295e5(0x10d),_0x30ff6b),_0x3eda7a()):_0x14e1e7(_0x20cac0);});};function sharpImg(_0x2d25cf,_0x1d82bd,_0x5950cd,_0x45ae95,_0x22766b){const _0x5bc2e8=_0x56b486;sharpUtil[_0x5bc2e8(0x110)](_0x2d25cf,(_0x24c4f0,_0x3e8fdd,_0x19b25d)=>{const _0x5cb330=_0x5bc2e8;!_0x1d82bd[_0x5cb330(0x127)]&&!_0x1d82bd[_0x5cb330(0x10c)]&&(_0x1d82bd={'width':0x1f4,'withoutEnlargement':!![]}),sharpUtil[_0x5cb330(0xe6)](_0x24c4f0,null,![],_0x1d82bd,'file',_0x5950cd,_0x45ae95,_0x22766b,_0x3e8fdd,_0x19b25d);});}function _0x30fb(){const _0x3db577=['sharp\x20err2:','raw','catch','transSpcielFormat','setHeader','join','image','path','terminate','status','fromFile','psd','psd导入失败','send','Buffer','basename','from','858609yGGrOL','extname','decode','libheif-js/wasm-bundle','deleteRawTempFile','inside','Worker\x20stopped\x20with\x20exit\x20code:','toFile','ifExtIsSpecialFormat','width','transSpcielFormatFromBuffer','Worker\x20error:','resize','log','.hif','parse','30AbWGDd','34538glReyt','exit','11291aozaHs','600x?','6POApDX','message','dcraw导入失败','isBuffer','toBuffer','end','output','data','resolve','video','6cZcANE','502352GJjMwW','sha256','genTinyFile','../../utils/exifUtils','21gvheIv','error','.heic','已超时\x20结束处理worker','2720XmrFfR','saveAsPng','code','rotate','Content-Disposition','157872uUAToP','getSharpInstanceFromInput','3606550yDOIBW','returnDealedFile','7455408wjZjxf','sharpDealImg','_psd.png','readFile','sharp','kill','runTransHeicWorker','includes','webp','type','toLowerCase','.bmp','tempFilePath','../../myConfig/config','.psd','读取失败','.tiff','jpeg','正在处理bmp','stat','toUpperCase','处理完成,删除临时文件','../../myWorkers/transHeicWorker.js','withMetadata','replace','returnDealedImage','../../libs/nasTrans','rawImgTypeList','FFmpeg','getRotateFromTags','then','../../utils/transCodeUtil','dealFFmpegPath','.heif','sharp\x20err1:','sharp\x20deal\x20psd\x20png\x20error\x201','string','ifImageIsSpecialFormat','buffer','height'];_0x30fb=function(){return _0x3db577;};return _0x30fb();}sharpUtil[_0x56b486(0x140)]=function(_0x21be7a,_0x226e3c,_0xbaac9e,_0x3f2ee5,_0x318e71,_0x158604,_0x380fb7,_0x31a51f){const _0x454fcb=_0x56b486;_0x31a51f&&(_0x31a51f=parseInt(_0x31a51f));let _0x37e262=path[_0x454fcb(0x112)](_0x226e3c,_0xbaac9e);if(_0x3f2ee5==_0x454fcb(0x113)){let _0x5c3476={};_0x318e71&&_0x318e71[_0x454fcb(0x127)]&&_0x318e71[_0x454fcb(0x10c)]?_0x318e71[_0x454fcb(0x127)]>_0x318e71[_0x454fcb(0x10c)]?_0x5c3476[_0x454fcb(0x127)]=_0x31a51f?_0x31a51f:0x258:_0x5c3476['height']=_0x31a51f?_0x31a51f:0x258:(_0x5c3476[_0x454fcb(0x127)]=_0x31a51f,_0x5c3476['height']=_0x31a51f),sharpImg(_0x21be7a,_0x5c3476,_0x37e262,_0x158604,_0x380fb7);}else{if(_0x3f2ee5==_0x454fcb(0x13c)){let _0x35a564=FFmpeg(transCodeUtil[_0x454fcb(0x105)](_0x21be7a),{'timeout':0x3c});_0x35a564['on'](_0x454fcb(0x138),()=>{const _0x3defbe=_0x454fcb;_0x35a564[_0x3defbe(0xea)](),_0x158604(path['join'](_0x226e3c,_0xbaac9e));}),_0x35a564['on'](_0x454fcb(0x143),function(_0x3d2b14,_0x5795c6,_0x48cedc){const _0x3edd52=_0x454fcb;_0x35a564[_0x3edd52(0xea)](),_0x380fb7&&_0x380fb7();}),_0x35a564['screenshots']({'timestamps':['10%'],'filename':_0xbaac9e,'folder':_0x226e3c,'size':_0x454fcb(0x132)});}}},sharpUtil['runTransHeicWorker']=function(_0x2bcb07){return new Promise((_0x1e20cf,_0x567f6d)=>{const _0x2b42b1=_0x3f5f;let _0x415667=new Worker(path[_0x2b42b1(0x13b)](__dirname,_0x2b42b1(0xfb)),{'workerData':{'inputBuffer':_0x2bcb07}}),_0x4cdd57=setTimeout(()=>{const _0x2528c0=_0x2b42b1;_0x415667&&(console['log'](_0x2528c0(0xdb)),_0x415667['terminate'](),_0x415667=null,_0x567f6d());},0x3a98);_0x415667['on'](_0x2b42b1(0x134),_0x5167aa=>{const _0xf995ed=_0x2b42b1;_0x5167aa[_0xf995ed(0xde)]==0x0&&(_0x4cdd57&&clearTimeout(_0x4cdd57),_0x1e20cf(_0x5167aa[_0xf995ed(0x139)]));}),_0x415667['on'](_0x2b42b1(0x143),_0x510277=>{const _0x457f83=_0x2b42b1;console[_0x457f83(0x143)](_0x457f83(0x129),_0x510277),_0x415667&&(_0x415667[_0x457f83(0x115)](),_0x415667=null),_0x567f6d();}),_0x415667['on'](_0x2b42b1(0x130),_0x1652ae=>{const _0x53e0c6=_0x2b42b1;if(_0x1652ae!==0x0)console['error'](_0x53e0c6(0x124),_0x1652ae);else{}});});},sharpUtil[_0x56b486(0x128)]=function(_0x1b0afc,_0x5189d4,_0x31a246){const _0x3bb4d9=_0x56b486;if(_0x1b0afc)_0x1b0afc=_0x1b0afc['toLowerCase']();if(_0x1b0afc&&(_0x1b0afc=='.heic'||_0x1b0afc==_0x3bb4d9(0x106)||_0x1b0afc=='.hif'))sharpUtil[_0x3bb4d9(0xeb)](_0x5189d4)['then'](_0x56e294=>{_0x56e294?_0x31a246(_0x56e294):_0x31a246(_0x5189d4);})[_0x3bb4d9(0x10f)](()=>{_0x31a246(_0x5189d4);});else{if(_0x1b0afc&&_0x1b0afc==_0x3bb4d9(0xf0))try{const _0x3e3992=sharpBmp['decode'](_0x5189d4);_0x31a246(_0x3e3992);}catch(_0x4f5b41){_0x31a246(_0x5189d4);}else _0x1b0afc&&config[_0x3bb4d9(0x100)][_0x3bb4d9(0xec)](_0x1b0afc[_0x3bb4d9(0xef)]())?extractThumbnailFromRaw(_0x5189d4,_0x1b0afc)['then'](_0x27ebe3=>{_0x31a246(_0x27ebe3);})[_0x3bb4d9(0x10f)](_0x11858b=>{console['log']('raw\x20err1',_0x11858b),_0x31a246(_0x5189d4);}):_0x31a246(_0x5189d4);}},sharpUtil[_0x56b486(0x110)]=function(_0x3deffe,_0x28b422){const _0x32512b=_0x56b486;let _0x34ed0a=path[_0x32512b(0x11f)](_0x3deffe);if(_0x34ed0a)_0x34ed0a=_0x34ed0a[_0x32512b(0xef)]();if(_0x34ed0a&&(_0x34ed0a==_0x32512b(0xda)||_0x34ed0a==_0x32512b(0x106)||_0x34ed0a==_0x32512b(0x12c)))fs[_0x32512b(0xe8)](_0x3deffe,(_0x46cf1e,_0x246977)=>{const _0x31e923=_0x32512b;if(_0x46cf1e)return _0x28b422(_0x3deffe);sharpUtil[_0x31e923(0xeb)](_0x246977)[_0x31e923(0x103)](_0x48809c=>{_0x48809c?_0x28b422(_0x48809c):_0x28b422(_0x246977);})[_0x31e923(0x10f)](()=>{_0x28b422(_0x246977);});});else{if(_0x34ed0a&&_0x34ed0a==_0x32512b(0xf0))console[_0x32512b(0x12b)](_0x32512b(0xf7),_0x3deffe),fs[_0x32512b(0xe8)](_0x3deffe,(_0x331ffa,_0x276f60)=>{const _0x310d9b=_0x32512b;if(_0x331ffa)console[_0x310d9b(0x12b)](_0x331ffa),_0x28b422(_0x3deffe);else try{const _0x5a8971=sharpBmp[_0x310d9b(0x120)](_0x276f60);_0x28b422(_0x5a8971);}catch(_0x17d530){_0x28b422(_0x3deffe);}});else{if(_0x34ed0a&&config[_0x32512b(0x100)]['includes'](_0x34ed0a[_0x32512b(0xef)]()))try{extractThumbnailFromRaw(_0x3deffe,_0x34ed0a)['then'](_0x10f248=>{_0x28b422(_0x10f248);})[_0x32512b(0x10f)](_0x1a9294=>{const _0x8ec88b=_0x32512b;console[_0x8ec88b(0x12b)](_0x1a9294),_0x28b422(_0x3deffe);});}catch(_0x1113af){console['log'](_0x1113af),_0x28b422(_0x3deffe);}else _0x28b422(_0x3deffe);}}},sharpUtil[_0x56b486(0xfe)]=function(_0x2d918c,_0x333298,_0x19b9fd,_0x3f4d34){const _0x323df5=_0x56b486;sharpUtil[_0x323df5(0x110)](_0x333298,(_0x1a31f6,_0x2864ca,_0x550129)=>{const _0x17e1da=_0x323df5;sharpUtil[_0x17e1da(0xe6)](_0x1a31f6,_0x17e1da(0xf6),!![],_0x19b9fd,_0x17e1da(0x10b),null,_0x35b540=>{const _0x5c7c8b=_0x17e1da;_0x2d918c[_0x5c7c8b(0x11a)](Buffer[_0x5c7c8b(0x11d)](_0x35b540));},()=>{const _0x355e45=_0x17e1da;_0x2d918c[_0x355e45(0x116)](0x194)[_0x355e45(0x138)]();},_0x2864ca,_0x550129,_0x3f4d34);});},sharpUtil['ifExtIsSpecialFormat']=function(_0x5043cc){const _0x5c6f1b=_0x56b486;return config['heicExt']['includes'](_0x5043cc)||config[_0x5c6f1b(0x100)][_0x5c6f1b(0xec)](_0x5043cc[_0x5c6f1b(0xef)]())||_0x5043cc==_0x5c6f1b(0xf0)||_0x5043cc==_0x5c6f1b(0xf5)?!![]:![];},sharpUtil[_0x56b486(0x10a)]=function(_0x329bec){const _0x319f11=_0x56b486;let _0x531994=path[_0x319f11(0x11f)](_0x329bec)?path['extname'](_0x329bec)['toLowerCase']():null;if(!_0x531994)return![];return sharpUtil[_0x319f11(0x126)](_0x531994);},sharpUtil[_0x56b486(0xe4)]=function(_0xd65bc,_0x30e81a,_0x43de81,_0x4bf09c,_0x533461){const _0x1d9679=_0x56b486;if(sharpUtil[_0x1d9679(0x10a)](_0x30e81a)||_0x4bf09c||_0x533461){let _0x4048c2=null,_0x1bbc45=null;return _0x4bf09c&&_0x4bf09c>=0x64&&_0x4bf09c<=0x186a0&&(_0x4048c2={'fit':_0x1d9679(0x123),'width':parseInt(_0x4bf09c),'height':parseInt(_0x4bf09c),'withoutEnlargement':!![]}),_0x533461&&_0x533461>=0x1e&&_0x533461<=0x64&&(_0x1bbc45={'quality':parseInt(_0x533461)}),sharpUtil['returnDealedImage'](_0xd65bc,_0x30e81a,_0x4048c2,_0x1bbc45);}else{if(_0x43de81){const _0x3a990b=encodeURIComponent(path[_0x1d9679(0x11c)](_0x30e81a))[_0x1d9679(0xfd)](/%([0-9A-F]{2})/g,(_0x40e43f,_0x18e97c)=>'%'+_0x18e97c[_0x1d9679(0xf9)]());_0xd65bc[_0x1d9679(0x111)](_0x1d9679(0xe0),'attachment;\x20filename*=UTF-8\x27\x27'+_0x3a990b);}_0xd65bc['sendFile'](_0x30e81a);}},module['exports']=sharpUtil;