const _0xeda713=_0x35a5;(function(_0x3eb8d3,_0x5bdbab){const _0x1f5a78=_0x35a5,_0x24f520=_0x3eb8d3();while(!![]){try{const _0x399a5b=parseInt(_0x1f5a78(0x1e4))/0x1+parseInt(_0x1f5a78(0x1ef))/0x2*(-parseInt(_0x1f5a78(0x202))/0x3)+parseInt(_0x1f5a78(0x1fe))/0x4+-parseInt(_0x1f5a78(0x1c7))/0x5*(-parseInt(_0x1f5a78(0x1b5))/0x6)+parseInt(_0x1f5a78(0x208))/0x7*(-parseInt(_0x1f5a78(0x204))/0x8)+-parseInt(_0x1f5a78(0x1b3))/0x9*(parseInt(_0x1f5a78(0x1f6))/0xa)+-parseInt(_0x1f5a78(0x1b1))/0xb*(-parseInt(_0x1f5a78(0x1fc))/0xc);if(_0x399a5b===_0x5bdbab)break;else _0x24f520['push'](_0x24f520['shift']());}catch(_0x29a266){_0x24f520['push'](_0x24f520['shift']());}}}(_0x1efe,0x4c279));let path=require('path'),fs=require('fs'),FFmpeg=require(_0xeda713(0x1ae))['FFmpeg'],sharpUtil={};const sharp=require(_0xeda713(0x1a7)),libheif=require(_0xeda713(0x1a6)),config=require(_0xeda713(0x1a5)),transCodeUtil=require(_0xeda713(0x1e0)),sharpBmp=require(_0xeda713(0x1b2));let sha256=require(_0xeda713(0x1be));const {Worker}=require(_0xeda713(0x1d9));let dcraw;function getDcraw(){const _0x5578ae=_0xeda713;if(!dcraw)try{return dcraw=require('dcraw'),dcraw;}catch(_0x30d8f4){return console[_0x5578ae(0x1c5)]('dcraw导入失败'),null;}else return dcraw;}function _0x1efe(){const _0x5398ae=['parse','44300DURpNr','psd\x20error\x201','sharp\x20err1:','.hif','deleteRawTempFile','output','132fuJIYl','resize','1713972mKswUX','includes','file','读取失败','3ogWXYj','withMetadata','3981352gUFYRk','Content-Disposition','writeFile','buffer','7zsuvmd','../../myWorkers/transHeicWorker.js','heicExt','../../myConfig/config','libheif-js/wasm-bundle','sharp','replace','string','jpeg','rotate','error','raw\x20err1','../../libs/nasTrans','join','startsWith','607717kvYpfT','sharp-bmp','513ynXcRU','getSharpInstanceFromInput','55020sJxTCG','rawImgTypeList','psd导入失败','toBuffer','psd','type','transSpcielFormat','正在处理bmp','Buffer','sha256','width','.heic','sharpDealImg','fromFile','message','已超时\x20结束处理worker','log','kill','10trhpCU','../../utils/exifUtils','decode','video','status','readFile','height','sharp\x20deal\x20psd\x20png\x20error\x201','attachment;\x20filename*=UTF-8\x27\x27','resolve','then','.heif','cachePath','sharp\x20err2:','from','catch','runTransHeicWorker','screenshots','worker_threads','Worker\x20error:','data','sendFile','transSpcielFormatFromBuffer','psd\x20error\x202','ifImageIsSpecialFormat','../../utils/transCodeUtil','terminate','tempFilePath','.psd','181876EZaVMm','ifExtIsSpecialFormat','exports','inside','toLowerCase','exit','.tiff','raw','toUpperCase','.bmp','returnDealedFile','348636drqCkh','extname','_psd.png','webp','image','end'];_0x1efe=function(){return _0x5398ae;};return _0x1efe();}let PSD;function getPsd(){const _0x3e902e=_0xeda713;if(!PSD)try{return PSD=require(_0x3e902e(0x1b9)),PSD;}catch(_0x541d47){return console[_0x3e902e(0x1c5)](_0x3e902e(0x1b7)),null;}else return PSD;}function _0x35a5(_0x3c614f,_0x16dbe9){const _0x1efe21=_0x1efe();return _0x35a5=function(_0x35a564,_0x8cbd8e){_0x35a564=_0x35a564-0x1a4;let _0x3dfda1=_0x1efe21[_0x35a564];return _0x3dfda1;},_0x35a5(_0x3c614f,_0x16dbe9);}function extractThumbnailFromRaw(_0x34d675,_0x3bb1ff){return new Promise((_0xf6ba7a,_0x1c0972)=>{const _0x17f085=_0x35a5;if(_0x3bb1ff&&_0x3bb1ff['toLowerCase']()==_0x17f085(0x1e3)){let _0x904c00=getPsd();if(!_0x904c00)return _0x1c0972(null);try{if(typeof _0x34d675==_0x17f085(0x1a9)){let _0x662311=path['join'](config[_0x17f085(0x1d3)],sha256(_0x34d675)+_0x17f085(0x1f1));fs['stat'](_0x662311,(_0x168fa0,_0x1da396)=>{const _0x4e9963=_0x17f085;try{if(_0x168fa0){let _0x1dff8a=_0x904c00[_0x4e9963(0x1c2)](_0x34d675);_0x1dff8a[_0x4e9963(0x1f5)](),_0x1dff8a['image']['saveAsPng'](_0x662311)[_0x4e9963(0x1d1)](()=>{const _0x59ac42=_0x4e9963;sharp(_0x662311)[_0x59ac42(0x1aa)]({'quality':0x4d})[_0x59ac42(0x1b8)]()[_0x59ac42(0x1d1)](_0x7746ca=>{const _0xf1745c=_0x59ac42;fs[_0xf1745c(0x206)](_0x662311,_0x7746ca,_0x3ef5cb=>{if(_0x3ef5cb)return _0x1c0972(null);_0xf6ba7a(_0x662311);});})[_0x59ac42(0x1d6)](_0x17b897=>{const _0x3fd246=_0x59ac42;return console[_0x3fd246(0x1c5)](_0x3fd246(0x1ce),_0x17b897),_0x1c0972(null);});})[_0x4e9963(0x1d6)](_0x3c7a8e=>{const _0x4c3d5a=_0x4e9963;return console[_0x4c3d5a(0x1c5)](_0x4c3d5a(0x1f7),_0x3c7a8e),_0x1c0972(null);});}else return _0xf6ba7a(_0x662311);}catch(_0x9e94f2){return console[_0x4e9963(0x1c5)](_0x4e9963(0x1de),_0x9e94f2),_0x1c0972(null);}});}else return _0x1c0972(null);}catch(_0xb1dd0e){return _0x1c0972(null);}}else{let _0x3dc435=getDcraw();if(!_0x3dc435)return _0x1c0972(null);function _0x36fb0c(_0x242ed2){try{const _0x14a8d7=_0x3dc435(_0x242ed2,{'extractThumbnail':!![],'identify':!![]});return _0x14a8d7?_0xf6ba7a(_0x14a8d7):_0x1c0972(null);}catch(_0x5ed006){return _0x1c0972(null);}}if(typeof _0x34d675==_0x17f085(0x1a9))fs[_0x17f085(0x1cc)](_0x34d675,(_0x3c3192,_0x58ab6f)=>{const _0x2ca4a7=_0x17f085;if(_0x3c3192)return console['log'](_0x2ca4a7(0x201),_0x34d675),_0x1c0972(_0x3c3192);_0x36fb0c(_0x58ab6f);});else{if(Buffer['isBuffer'](_0x34d675))_0x36fb0c(_0x34d675);else return _0x1c0972(null);}}});}const exifUtils=require(_0xeda713(0x1c8));sharpUtil[_0xeda713(0x1b4)]=function(_0x51fb8d){const _0x4df690=_0xeda713;_0x51fb8d[_0x4df690(0x1ba)]==_0x4df690(0x1bd)&&(_0x51fb8d=Buffer[_0x4df690(0x1d5)](_0x51fb8d));let _0x31b9c0={'failOnError':![]};return _0x51fb8d[_0x4df690(0x1bf)]&&_0x51fb8d[_0x4df690(0x1cd)]&&_0x51fb8d['data']&&(_0x31b9c0[_0x4df690(0x1eb)]={'width':_0x51fb8d['width'],'height':_0x51fb8d['height'],'channels':0x4},_0x51fb8d=_0x51fb8d[_0x4df690(0x1db)]),sharp(_0x51fb8d,_0x31b9c0);},sharpUtil['deleteRawTempFile']=function(_0xb49b77){const _0x213e3c=_0xeda713;typeof _0xb49b77==_0x213e3c(0x1a9)&&_0xb49b77[_0x213e3c(0x1b0)](config[_0x213e3c(0x1e2)])&&fs['rm'](_0xb49b77,_0x5426fa=>{});},sharpUtil['sharpDealImg']=function(_0x499399,_0x288856,_0x496572,_0x3d53b5,_0x277a02,_0x18a494,_0x3e35ad,_0xfded83,_0x57bca8,_0x144f8a,_0x23915d){const _0xe6042f=_0xeda713;if(!_0x499399)return _0x3e35ad(null);let _0x31994d=sharpUtil['getSharpInstanceFromInput'](_0x499399);_0x288856==_0xe6042f(0x1aa)?_0x23915d?_0x31994d=_0x31994d[_0xe6042f(0x1aa)](_0x23915d):_0x31994d=_0x31994d[_0xe6042f(0x1aa)]():_0x31994d=_0x31994d[_0xe6042f(0x1f2)]({});_0x496572&&(_0x31994d=_0x31994d[_0xe6042f(0x203)]());let _0x8cec9e=exifUtils['getRotateFromTags'](_0x144f8a);_0x8cec9e?_0x31994d=_0x31994d[_0xe6042f(0x1ab)](_0x8cec9e):_0x31994d=_0x31994d[_0xe6042f(0x1ab)]();_0x3d53b5&&(_0x31994d=_0x31994d[_0xe6042f(0x1fd)](_0x3d53b5));if(_0x277a02==_0xe6042f(0x200))_0x31994d['toFile'](_0x18a494,(_0x2311f5,_0xdf053)=>{const _0x9b2013=_0xe6042f;_0x57bca8&&(console[_0x9b2013(0x1c5)]('处理完成,删除临时文件',_0x499399),sharpUtil['deleteRawTempFile'](_0x499399)),_0x2311f5?(console['log'](_0x9b2013(0x1f8),_0x499399,_0x2311f5),_0xfded83()):_0x3e35ad(_0x18a494);});else _0x277a02==_0xe6042f(0x207)&&_0x31994d[_0xe6042f(0x1b8)]((_0x2bbc88,_0x770c2a,_0x3d9a52)=>{const _0x4e8439=_0xe6042f;_0x57bca8&&sharpUtil[_0x4e8439(0x1fa)](_0x499399),_0x2bbc88?(console[_0x4e8439(0x1c5)](_0x4e8439(0x1d4),_0x2bbc88),_0xfded83()):_0x3e35ad(_0x770c2a);});};function sharpImg(_0x48364c,_0x338c6d,_0xb565c2,_0x56683a,_0xec86e8){sharpUtil['transSpcielFormat'](_0x48364c,(_0x18de91,_0x36bf7e,_0x494d1f)=>{const _0x564023=_0x35a5;!_0x338c6d[_0x564023(0x1bf)]&&!_0x338c6d[_0x564023(0x1cd)]&&(_0x338c6d={'width':0x1f4,'withoutEnlargement':!![]}),sharpUtil[_0x564023(0x1c1)](_0x18de91,null,![],_0x338c6d,_0x564023(0x200),_0xb565c2,_0x56683a,_0xec86e8,_0x36bf7e,_0x494d1f);});}sharpUtil['genTinyFile']=function(_0x2e1892,_0x530f36,_0x26c775,_0x29fa84,_0x4cc541,_0x3d5b63,_0x1c45a1,_0x55d0d2){const _0x969b76=_0xeda713;_0x55d0d2&&(_0x55d0d2=parseInt(_0x55d0d2));let _0x55ab65=path[_0x969b76(0x1af)](_0x530f36,_0x26c775);if(_0x29fa84==_0x969b76(0x1f3)){let _0x35c7df={};_0x4cc541&&_0x4cc541[_0x969b76(0x1bf)]&&_0x4cc541[_0x969b76(0x1cd)]?_0x4cc541[_0x969b76(0x1bf)]>_0x4cc541[_0x969b76(0x1cd)]?_0x35c7df['width']=_0x55d0d2?_0x55d0d2:0x258:_0x35c7df[_0x969b76(0x1cd)]=_0x55d0d2?_0x55d0d2:0x258:(_0x35c7df[_0x969b76(0x1bf)]=_0x55d0d2,_0x35c7df[_0x969b76(0x1cd)]=_0x55d0d2),sharpImg(_0x2e1892,_0x35c7df,_0x55ab65,_0x3d5b63,_0x1c45a1);}else{if(_0x29fa84==_0x969b76(0x1ca)){let _0x465f20=FFmpeg(transCodeUtil['dealFFmpegPath'](_0x2e1892),{'timeout':0x3c});_0x465f20['on']('end',()=>{const _0x1d8fc3=_0x969b76;_0x465f20[_0x1d8fc3(0x1c6)](),_0x3d5b63(path['join'](_0x530f36,_0x26c775));}),_0x465f20['on'](_0x969b76(0x1ac),function(_0x222779,_0x484929,_0x13dc7d){const _0x29a47a=_0x969b76;_0x465f20[_0x29a47a(0x1c6)](),_0x1c45a1&&_0x1c45a1();}),_0x465f20[_0x969b76(0x1d8)]({'timestamps':['10%'],'filename':_0x26c775,'folder':_0x530f36,'size':'600x?'});}}},sharpUtil['runTransHeicWorker']=function(_0x74404d){return new Promise((_0x2e607c,_0x12c02c)=>{const _0xea2bf8=_0x35a5;let _0xf1ea67=new Worker(path[_0xea2bf8(0x1d0)](__dirname,_0xea2bf8(0x209)),{'workerData':{'inputBuffer':_0x74404d}}),_0x338b6e=setTimeout(()=>{const _0x458daa=_0xea2bf8;_0xf1ea67&&(console[_0x458daa(0x1c5)](_0x458daa(0x1c4)),_0xf1ea67[_0x458daa(0x1e1)](),_0xf1ea67=null,_0x12c02c());},0x3a98);_0xf1ea67['on'](_0xea2bf8(0x1c3),_0x3b6eba=>{const _0xcaca3c=_0xea2bf8;_0x3b6eba['code']==0x0&&(_0x338b6e&&clearTimeout(_0x338b6e),_0x2e607c(_0x3b6eba[_0xcaca3c(0x1fb)]));}),_0xf1ea67['on'](_0xea2bf8(0x1ac),_0x2b0514=>{const _0x2f4800=_0xea2bf8;console[_0x2f4800(0x1ac)](_0x2f4800(0x1da),_0x2b0514),_0xf1ea67&&(_0xf1ea67[_0x2f4800(0x1e1)](),_0xf1ea67=null),_0x12c02c();}),_0xf1ea67['on'](_0xea2bf8(0x1e9),_0x40cfd8=>{const _0x325b1a=_0xea2bf8;if(_0x40cfd8!==0x0)console[_0x325b1a(0x1ac)]('Worker\x20stopped\x20with\x20exit\x20code:',_0x40cfd8);else{}});});},sharpUtil[_0xeda713(0x1dd)]=function(_0xbbe68e,_0x32f23c,_0x38c9e2){const _0x38bd5f=_0xeda713;if(_0xbbe68e)_0xbbe68e=_0xbbe68e[_0x38bd5f(0x1e8)]();if(_0xbbe68e&&(_0xbbe68e==_0x38bd5f(0x1c0)||_0xbbe68e==_0x38bd5f(0x1d2)||_0xbbe68e=='.hif'))sharpUtil[_0x38bd5f(0x1d7)](_0x32f23c)[_0x38bd5f(0x1d1)](_0x460a3b=>{_0x460a3b?_0x38c9e2(_0x460a3b):_0x38c9e2(_0x32f23c);})[_0x38bd5f(0x1d6)](()=>{_0x38c9e2(_0x32f23c);});else{if(_0xbbe68e&&_0xbbe68e=='.bmp')try{const _0x35c1af=sharpBmp['decode'](_0x32f23c);_0x38c9e2(_0x35c1af);}catch(_0x1ebdbb){_0x38c9e2(_0x32f23c);}else _0xbbe68e&&config[_0x38bd5f(0x1b6)][_0x38bd5f(0x1ff)](_0xbbe68e['toLowerCase']())?extractThumbnailFromRaw(_0x32f23c,_0xbbe68e)[_0x38bd5f(0x1d1)](_0x3c4ef8=>{_0x38c9e2(_0x3c4ef8);})[_0x38bd5f(0x1d6)](_0x2ab9c4=>{const _0x34486a=_0x38bd5f;console['log'](_0x34486a(0x1ad),_0x2ab9c4),_0x38c9e2(_0x32f23c);}):_0x38c9e2(_0x32f23c);}},sharpUtil[_0xeda713(0x1bb)]=function(_0x25739b,_0x32619d){const _0xc30f92=_0xeda713;let _0xf48d92=path['extname'](_0x25739b);if(_0xf48d92)_0xf48d92=_0xf48d92[_0xc30f92(0x1e8)]();if(_0xf48d92&&(_0xf48d92==_0xc30f92(0x1c0)||_0xf48d92==_0xc30f92(0x1d2)||_0xf48d92==_0xc30f92(0x1f9)))fs[_0xc30f92(0x1cc)](_0x25739b,(_0x59077c,_0x25d759)=>{const _0x541ca5=_0xc30f92;if(_0x59077c)return _0x32619d(_0x25739b);sharpUtil['runTransHeicWorker'](_0x25d759)['then'](_0x16b27a=>{_0x16b27a?_0x32619d(_0x16b27a):_0x32619d(_0x25d759);})[_0x541ca5(0x1d6)](()=>{_0x32619d(_0x25d759);});});else{if(_0xf48d92&&_0xf48d92==_0xc30f92(0x1ed))console[_0xc30f92(0x1c5)](_0xc30f92(0x1bc),_0x25739b),fs[_0xc30f92(0x1cc)](_0x25739b,(_0x44516a,_0xda2237)=>{const _0x3961e9=_0xc30f92;if(_0x44516a)console[_0x3961e9(0x1c5)](_0x44516a),_0x32619d(_0x25739b);else try{const _0xcab397=sharpBmp[_0x3961e9(0x1c9)](_0xda2237);_0x32619d(_0xcab397);}catch(_0x3f2aee){_0x32619d(_0x25739b);}});else{if(_0xf48d92&&config[_0xc30f92(0x1b6)][_0xc30f92(0x1ff)](_0xf48d92['toLowerCase']()))try{extractThumbnailFromRaw(_0x25739b,_0xf48d92)['then'](_0x116494=>{_0x32619d(_0x116494);})[_0xc30f92(0x1d6)](_0x572b16=>{const _0x1c8daf=_0xc30f92;console[_0x1c8daf(0x1c5)](_0x572b16),_0x32619d(_0x25739b);});}catch(_0x5211ad){console['log'](_0x5211ad),_0x32619d(_0x25739b);}else _0x32619d(_0x25739b);}}},sharpUtil['returnDealedImage']=function(_0x392f33,_0x16d34c,_0x4904dd,_0x38d7c7){const _0x29e017=_0xeda713;sharpUtil[_0x29e017(0x1bb)](_0x16d34c,(_0x5e7a58,_0x14a50f,_0x59e26d)=>{const _0x1e326f=_0x29e017;sharpUtil[_0x1e326f(0x1c1)](_0x5e7a58,_0x1e326f(0x1aa),!![],_0x4904dd,'buffer',null,_0x2f6555=>{const _0xea073f=_0x1e326f;_0x392f33['send'](Buffer[_0xea073f(0x1d5)](_0x2f6555));},()=>{const _0x503ece=_0x1e326f;_0x392f33[_0x503ece(0x1cb)](0x194)[_0x503ece(0x1f4)]();},_0x14a50f,_0x59e26d,_0x38d7c7);});},sharpUtil[_0xeda713(0x1e5)]=function(_0x29730a){const _0x10ff34=_0xeda713;return config[_0x10ff34(0x1a4)][_0x10ff34(0x1ff)](_0x29730a)||config[_0x10ff34(0x1b6)][_0x10ff34(0x1ff)](_0x29730a[_0x10ff34(0x1e8)]())||_0x29730a==_0x10ff34(0x1ed)||_0x29730a==_0x10ff34(0x1ea)?!![]:![];},sharpUtil[_0xeda713(0x1df)]=function(_0x1c60da){const _0x1535ac=_0xeda713;let _0x169710=path[_0x1535ac(0x1f0)](_0x1c60da)?path[_0x1535ac(0x1f0)](_0x1c60da)['toLowerCase']():null;if(!_0x169710)return![];return sharpUtil[_0x1535ac(0x1e5)](_0x169710);},sharpUtil[_0xeda713(0x1ee)]=function(_0x45c17f,_0x292f21,_0x3185e1,_0x3a6569,_0x538405){const _0x33658c=_0xeda713;if(sharpUtil['ifImageIsSpecialFormat'](_0x292f21)||_0x3a6569||_0x538405){let _0x72ed92=null,_0x5e68f8=null;return _0x3a6569&&_0x3a6569>=0x64&&_0x3a6569<=0x186a0&&(_0x72ed92={'fit':_0x33658c(0x1e7),'width':parseInt(_0x3a6569),'height':parseInt(_0x3a6569),'withoutEnlargement':!![]}),_0x538405&&_0x538405>=0x1e&&_0x538405<=0x64&&(_0x5e68f8={'quality':parseInt(_0x538405)}),sharpUtil['returnDealedImage'](_0x45c17f,_0x292f21,_0x72ed92,_0x5e68f8);}else{if(_0x3185e1){const _0x4b964f=encodeURIComponent(path['basename'](_0x292f21))[_0x33658c(0x1a8)](/%([0-9A-F]{2})/g,(_0x5742a4,_0x504e50)=>'%'+_0x504e50[_0x33658c(0x1ec)]());_0x45c17f['setHeader'](_0x33658c(0x205),_0x33658c(0x1cf)+_0x4b964f);}_0x45c17f[_0x33658c(0x1dc)](_0x292f21);}},module[_0xeda713(0x1e6)]=sharpUtil;