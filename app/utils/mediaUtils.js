const _0x51fb56=_0x4c78;(function(_0x2980fc,_0x1d9c35){const _0x4bc412=_0x4c78,_0x1d3c87=_0x2980fc();while(!![]){try{const _0x2da9e5=-parseInt(_0x4bc412(0xb3))/0x1+parseInt(_0x4bc412(0xc2))/0x2+parseInt(_0x4bc412(0xaf))/0x3*(-parseInt(_0x4bc412(0xc5))/0x4)+-parseInt(_0x4bc412(0x99))/0x5*(-parseInt(_0x4bc412(0xa8))/0x6)+-parseInt(_0x4bc412(0xaa))/0x7+parseInt(_0x4bc412(0xb2))/0x8+-parseInt(_0x4bc412(0xc9))/0x9*(-parseInt(_0x4bc412(0xb9))/0xa);if(_0x2da9e5===_0x1d9c35)break;else _0x1d3c87['push'](_0x1d3c87['shift']());}catch(_0x224b7e){_0x1d3c87['push'](_0x1d3c87['shift']());}}}(_0x17a1,0xd2950));let fs=require('fs'),path=require(_0x51fb56(0xce));var exifr=require(_0x51fb56(0xcb));const config=require(_0x51fb56(0xc3));function _0x17a1(){const _0x43955a=['2671202jhvfZN','../myConfig/config','getTime','215144zjrKHE','match','test','ffprobe','432rxVTbz','atimeMs','exifr','获取视频拍摄时间错误','parse','path','324195FYwTwj','creation_time','length','exports','exifr异常','../libs/nasTrans','FFmpeg','substring','includes','匹配到合适的时间戳,YYYY-MM-DD','format','tags','isFile','1970-01-01','ctimeMs','54ecoXyp','videoTypeList','497945XLYqwk','非视频和图片，返回文件创建时间','birthtimeMs','log','ctime','21kLWbIx','startsWith','匹配到合适的时间戳,_d8_d6','2852912fKzMtT','1211489hlaygl','CreateDate','com.apple.quicktime.creationdate','getTimeFromFileName','getFileTime','birthtime','51230gpbUxo','now','stat','then','getFullYear','mtimeMs','dealFFmpegPath','ceil','rawImgTypeList'];_0x17a1=function(){return _0x43955a;};return _0x17a1();}let FFmpeg=require(_0x51fb56(0x9e))[_0x51fb56(0x9f)];const transCodeUtil=require('../utils/transCodeUtil');let mediaUtil={};function extractTimestampFromFilename(_0x584704,_0x2fcb68){const _0x29fba2=_0x51fb56;try{const _0x596dc9=_0x2fcb68[_0x29fba2(0xc6)](_0x584704);if(_0x596dc9){const _0x3a2250=_0x596dc9[0x0];let _0x184ca0=null;if(_0x3a2250&&_0x3a2250[_0x29fba2(0x9b)]==0x8){const _0x335e79=_0x3a2250[_0x29fba2(0xa0)](0x0,0x4),_0x1470db=_0x3a2250['substring'](0x4,0x6),_0x1e8143=_0x3a2250[_0x29fba2(0xa0)](0x6,0x8);_0x184ca0=new Date(_0x335e79,parseInt(_0x1470db,0xa)-0x1,_0x1e8143);}else{if(_0x3a2250&&_0x3a2250[_0x29fba2(0x9b)]==0xa&&_0x3a2250[0x4]=='-'&&_0x3a2250[0x7]=='-')_0x184ca0=new Date(_0x3a2250);else{if(_0x3a2250&&_0x3a2250[_0x29fba2(0x9b)]==0xd)_0x184ca0=new Date(parseInt(_0x3a2250));else{if(_0x3a2250&&_0x3a2250[_0x29fba2(0x9b)]==0xa)_0x184ca0=new Date(parseInt(_0x3a2250)*0x3e8);else{if(_0x3a2250&&_0x3a2250[_0x29fba2(0x9b)]==0xf&&_0x3a2250['startsWith']('_')){const [,_0x2c8197,_0x11e141]=_0x596dc9,_0x1454d8=_0x2c8197[_0x29fba2(0xa0)](0x0,0x4)+'-'+_0x2c8197[_0x29fba2(0xa0)](0x4,0x6)+'-'+_0x2c8197['substring'](0x6,0x8)+'\x20'+_0x11e141[_0x29fba2(0xa0)](0x0,0x2)+':'+_0x11e141[_0x29fba2(0xa0)](0x2,0x4)+':'+_0x11e141[_0x29fba2(0xa0)](0x4,0x6);console['log'](_0x1454d8),_0x184ca0=new Date(_0x1454d8);}else{if(_0x3a2250&&_0x3a2250[_0x29fba2(0x9b)]==0xe){const [,_0x3cacdd,_0x3cf284]=_0x596dc9,_0x20382b=_0x3cacdd[_0x29fba2(0xa0)](0x0,0x4)+'-'+_0x3cacdd['substring'](0x4,0x6)+'-'+_0x3cacdd[_0x29fba2(0xa0)](0x6,0x8)+'\x20'+_0x3cf284[_0x29fba2(0xa0)](0x0,0x2)+':'+_0x3cf284[_0x29fba2(0xa0)](0x2,0x4)+':'+_0x3cf284[_0x29fba2(0xa0)](0x4,0x6);console[_0x29fba2(0xad)](_0x20382b),_0x184ca0=new Date(_0x20382b);}else{if(_0x3a2250&&_0x3a2250[_0x29fba2(0x9b)]==0x10){const [,_0x15f210,_0x136636]=_0x596dc9,_0x38e353=_0x15f210[_0x29fba2(0xa0)](0x0,0x4)+'-'+_0x15f210[_0x29fba2(0xa0)](0x4,0x6)+'-'+_0x15f210[_0x29fba2(0xa0)](0x6,0x8)+'\x20'+_0x136636['substring'](0x0,0x2)+':'+_0x136636[_0x29fba2(0xa0)](0x2,0x4)+':'+_0x136636[_0x29fba2(0xa0)](0x4,0x6);console[_0x29fba2(0xad)](_0x38e353),_0x184ca0=new Date(_0x38e353);}else{if(_0x3a2250&&_0x3a2250[_0x29fba2(0x9b)]==0x13&&_0x3a2250[0x4]=='_'&&_0x3a2250[0x7]=='_'&&_0x3a2250[0xa]=='_'&&_0x3a2250[0xd]=='_'&&_0x3a2250[0x10]=='_')try{const _0x1e508c=_0x3a2250[_0x29fba2(0xa0)](0x0,0x4)+'-'+_0x3a2250['substring'](0x5,0x7)+'-'+_0x3a2250['substring'](0x8,0xa)+'\x20'+_0x3a2250[_0x29fba2(0xa0)](0xb,0xd)+':'+_0x3a2250[_0x29fba2(0xa0)](0xe,0x10)+':'+_0x3a2250[_0x29fba2(0xa0)](0x11,0x13);_0x184ca0=new Date(_0x1e508c);}catch(_0x1dc2b4){}}}}}}}}if(!_0x184ca0)return null;const _0x33068a=new Date()[_0x29fba2(0xbd)]();let _0x4a9687=_0x184ca0[_0x29fba2(0xbd)]();if(!_0x4a9687||_0x4a9687<0x7b2||_0x4a9687>_0x33068a)return null;if(!isNaN(_0x184ca0[_0x29fba2(0xc4)]()))return _0x184ca0['getTime']();}return null;}catch(_0x32b4e4){return console['log'](_0x32b4e4),null;}};mediaUtil[_0x51fb56(0xb6)]=function(_0x2e4034,_0x1ca590){const _0x4a6238=_0x51fb56;if(!_0x2e4034){const _0x528308=/(\d{4}-\d{2}-\d{2})/,_0x53c36a=extractTimestampFromFilename(_0x528308,_0x1ca590);_0x53c36a&&(_0x2e4034=_0x53c36a,console[_0x4a6238(0xad)](_0x4a6238(0xa2),_0x53c36a));}if(!_0x2e4034){const _0x31b00e=/_(\d{8})_(\d{6})/,_0x45aa62=extractTimestampFromFilename(_0x31b00e,_0x1ca590);_0x45aa62&&(_0x2e4034=_0x45aa62,console[_0x4a6238(0xad)](_0x4a6238(0xb1),_0x45aa62));}if(!_0x2e4034){const _0xe0576b=/_(\d{8})(\d{6})/,_0x105a7e=extractTimestampFromFilename(_0xe0576b,_0x1ca590);_0x105a7e&&(_0x2e4034=_0x105a7e);}if(!_0x2e4034){const _0x3f59cf=/(\d{8})(\d{6})/,_0x20737f=extractTimestampFromFilename(_0x3f59cf,_0x1ca590);_0x20737f&&(_0x2e4034=_0x20737f);}if(!_0x2e4034){const _0x54971d=/(\d{13}|\d{10})/,_0x1f91fd=extractTimestampFromFilename(_0x54971d,_0x1ca590);_0x1f91fd&&(_0x2e4034=_0x1f91fd);}if(!_0x2e4034){const _0x3eca54=/(\d{4})(\d{2})(\d{2})/,_0x36e90b=extractTimestampFromFilename(_0x3eca54,_0x1ca590);_0x36e90b&&(_0x2e4034=_0x36e90b);}if(!_0x2e4034){const _0x21f265=/(\d{4})_(\d{2})_(\d{2})_(\d{2})_(\d{2})_(\d{2})/,_0x52d885=extractTimestampFromFilename(_0x21f265,_0x1ca590);_0x52d885&&(_0x2e4034=_0x52d885);}_0x2e4034&&/\d{15,}/[_0x4a6238(0xc7)](_0x1ca590)&&_0x1ca590[_0x4a6238(0xa1)](_0x2e4034)&&(_0x2e4034=null);if(_0x2e4034)try{_0x2e4034=new Date(_0x2e4034)[_0x4a6238(0xc4)]();}catch(_0x4514c1){console[_0x4a6238(0xad)](_0x4514c1);}return _0x2e4034;};function getImageTime(_0x177708,_0x2376a0,_0xcab5c9){const _0x176f66=_0x51fb56;let _0x3db0f3=![],_0x1c5dd4=path['basename'](_0x177708);function _0x46b857(){const _0x276454=_0x4c78;if(!_0x3db0f3){let _0x54e906=_0x2376a0['birthtimeMs'];_0x2376a0['mtimeMs']<_0x54e906&&(_0x54e906=_0x2376a0[_0x276454(0xbe)]),_0x2376a0[_0x276454(0xca)]<_0x54e906&&(_0x54e906=_0x2376a0[_0x276454(0xca)]),_0x2376a0[_0x276454(0xa7)]<_0x54e906&&(_0x54e906=_0x2376a0[_0x276454(0xa7)]),_0x3db0f3=_0x54e906,_0x3db0f3=Math[_0x276454(0xc0)](_0x3db0f3);}_0xcab5c9(_0x3db0f3);}exifr[_0x176f66(0xcd)](_0x177708)[_0x176f66(0xbc)](_0x5844e8=>{const _0x2f26c8=_0x176f66;_0x5844e8&&(_0x3db0f3=_0x5844e8['DateTimeOriginal'],_0x5844e8[_0x2f26c8(0xb4)]&&!_0x3db0f3&&(_0x3db0f3=_0x5844e8[_0x2f26c8(0xb4)])),_0x3db0f3=mediaUtil[_0x2f26c8(0xb6)](_0x3db0f3,_0x1c5dd4),_0x46b857();})['catch'](_0x293ff3=>{const _0x28df21=_0x176f66;console[_0x28df21(0xad)](_0x28df21(0x9d),_0x293ff3),_0x46b857();});};function getVideoTime(_0x1f735a,_0x4dc066,_0x43d5b7){const _0x5effad=_0x51fb56;try{let _0x70c727=![],_0x2a5d2d=path['basename'](_0x1f735a);function _0x5ed211(){const _0x2130b0=_0x4c78;if(!_0x70c727){let _0xfeccd5=_0x4dc066[_0x2130b0(0xac)];_0x4dc066[_0x2130b0(0xbe)]<_0xfeccd5&&(_0xfeccd5=_0x4dc066[_0x2130b0(0xbe)]),_0x4dc066['atimeMs']<_0xfeccd5&&(_0xfeccd5=_0x4dc066[_0x2130b0(0xca)]),_0x4dc066[_0x2130b0(0xa7)]<_0xfeccd5&&(_0xfeccd5=_0x4dc066[_0x2130b0(0xa7)]),_0x70c727=_0xfeccd5,_0x70c727=Math['ceil'](_0x70c727);}_0x43d5b7(_0x70c727);}FFmpeg(transCodeUtil[_0x5effad(0xbf)](_0x1f735a))[_0x5effad(0xc8)]((_0x12511c,_0xb34040)=>{const _0x42e0f0=_0x5effad;if(_0x12511c)return console[_0x42e0f0(0xad)]('ffprobe读取视频信息失败'),_0x43d5b7(_0x70c727);if(_0xb34040&&_0xb34040['format']&&_0xb34040[_0x42e0f0(0xa3)][_0x42e0f0(0xa4)]){let _0x48221b=_0xb34040[_0x42e0f0(0xa3)][_0x42e0f0(0xa4)][_0x42e0f0(0xb5)];_0x48221b&&(_0x70c727=_0x48221b),!_0x70c727&&_0xb34040[_0x42e0f0(0xa3)][_0x42e0f0(0xa4)][_0x42e0f0(0x9a)]&&(_0x70c727=_0xb34040[_0x42e0f0(0xa3)][_0x42e0f0(0xa4)][_0x42e0f0(0x9a)]),_0x70c727&&_0x70c727[_0x42e0f0(0xb0)](_0x42e0f0(0xa6))&&(_0x70c727=![]);}return console[_0x42e0f0(0xad)](_0x70c727),_0x70c727=mediaUtil[_0x42e0f0(0xb6)](_0x70c727,_0x2a5d2d),_0x5ed211();});}catch(_0x303760){return console['log'](_0x5effad(0xcc),_0x1f735a),returnOriginalTime();}}function _0x4c78(_0x248633,_0x5e1522){const _0x17a17a=_0x17a1();return _0x4c78=function(_0x4c78da,_0x26d272){_0x4c78da=_0x4c78da-0x99;let _0x2f365f=_0x17a17a[_0x4c78da];return _0x2f365f;},_0x4c78(_0x248633,_0x5e1522);}mediaUtil[_0x51fb56(0xb7)]=function(_0x455f20){return new Promise((_0x4a73f4,_0x119763)=>{const _0x231544=_0x4c78;let _0x16e16f=Date[_0x231544(0xba)]();fs[_0x231544(0xbb)](_0x455f20,(_0x25f6ec,_0x39c6bb)=>{_0x25f6ec?setTimeout(()=>{const _0x4bb806=_0x4c78;fs[_0x4bb806(0xbb)](_0x455f20,(_0x205ecd,_0x10b23a)=>{if(_0x205ecd)return _0x50d744();else _0x4572b9(_0x10b23a,_0x4a73f4);});},0x3e8):_0x4572b9(_0x39c6bb,_0x4a73f4);});function _0x50d744(){_0x4a73f4(_0x16e16f);}function _0x4572b9(_0x4a0944,_0x51e21e){const _0xf05b52=_0x231544;try{_0x16e16f=_0x4a0944[_0xf05b52(0xb8)]||_0x4a0944[_0xf05b52(0xae)],_0x16e16f=Math[_0xf05b52(0xc0)](_0x16e16f);if(!_0x4a0944['isFile']())return _0x50d744();let _0x10d1c5=path['extname'](_0x455f20)['toLowerCase']();if(_0x4a0944[_0xf05b52(0xa5)]()&&(config['imgTypeList'][_0xf05b52(0xa1)](_0x10d1c5)||config[_0xf05b52(0xc1)][_0xf05b52(0xa1)](_0x10d1c5)))return getImageTime(_0x455f20,_0x4a0944,_0x51e21e);else return _0x4a0944[_0xf05b52(0xa5)]()&&config[_0xf05b52(0xa9)]['includes'](_0x10d1c5)?getVideoTime(_0x455f20,_0x4a0944,_0x51e21e):(console[_0xf05b52(0xad)](_0xf05b52(0xab)),_0x50d744());}catch(_0x376f54){return _0x50d744();}}});},module[_0x51fb56(0x9c)]=mediaUtil;