const _0x23b0ec=_0x1a0c;(function(_0x4ae798,_0x144631){const _0xdfaa10=_0x1a0c,_0x3a794a=_0x4ae798();while(!![]){try{const _0x36ac99=-parseInt(_0xdfaa10(0x100))/0x1+parseInt(_0xdfaa10(0xea))/0x2+-parseInt(_0xdfaa10(0xff))/0x3*(parseInt(_0xdfaa10(0x11c))/0x4)+parseInt(_0xdfaa10(0x104))/0x5*(parseInt(_0xdfaa10(0xf0))/0x6)+parseInt(_0xdfaa10(0x116))/0x7*(-parseInt(_0xdfaa10(0x112))/0x8)+parseInt(_0xdfaa10(0x11b))/0x9+parseInt(_0xdfaa10(0xfc))/0xa;if(_0x36ac99===_0x144631)break;else _0x3a794a['push'](_0x3a794a['shift']());}catch(_0x64eb44){_0x3a794a['push'](_0x3a794a['shift']());}}}(_0x45e2,0x69192));let fs=require('fs'),path=require(_0x23b0ec(0xee));var exifr=require(_0x23b0ec(0x118));const config=require(_0x23b0ec(0x105));let FFmpeg=require(_0x23b0ec(0xeb))[_0x23b0ec(0x107)];const transCodeUtil=require(_0x23b0ec(0x10f));let mediaUtil={};function extractTimestampFromFilename(_0xc91d05,_0x27ffb5){const _0x2cca49=_0x23b0ec;try{const _0x3fea16=_0x27ffb5[_0x2cca49(0xf2)](_0xc91d05);if(_0x3fea16){const _0x42adbe=_0x3fea16[0x0];let _0x3139c8=null;if(_0x42adbe&&_0x42adbe[_0x2cca49(0xf5)]==0x8){const _0x4adac0=_0x42adbe[_0x2cca49(0x102)](0x0,0x4),_0x1f4ec3=_0x42adbe[_0x2cca49(0x102)](0x4,0x6),_0x186635=_0x42adbe[_0x2cca49(0x102)](0x6,0x8);_0x3139c8=new Date(_0x4adac0,parseInt(_0x1f4ec3,0xa)-0x1,_0x186635);}else{if(_0x42adbe&&_0x42adbe[_0x2cca49(0xf5)]==0xa&&_0x42adbe[0x4]=='-'&&_0x42adbe[0x7]=='-')_0x3139c8=new Date(_0x42adbe);else{if(_0x42adbe&&_0x42adbe['length']==0xd)_0x3139c8=new Date(parseInt(_0x42adbe));else{if(_0x42adbe&&_0x42adbe[_0x2cca49(0xf5)]==0xa)_0x3139c8=new Date(parseInt(_0x42adbe)*0x3e8);else{if(_0x42adbe&&_0x42adbe[_0x2cca49(0xf5)]==0xf&&_0x42adbe['startsWith']('_')){const [,_0x559005,_0x106f7f]=_0x3fea16,_0x32ad7b=_0x559005[_0x2cca49(0x102)](0x0,0x4)+'-'+_0x559005[_0x2cca49(0x102)](0x4,0x6)+'-'+_0x559005['substring'](0x6,0x8)+'\x20'+_0x106f7f['substring'](0x0,0x2)+':'+_0x106f7f[_0x2cca49(0x102)](0x2,0x4)+':'+_0x106f7f[_0x2cca49(0x102)](0x4,0x6);console[_0x2cca49(0xe8)](_0x32ad7b),_0x3139c8=new Date(_0x32ad7b);}else{if(_0x42adbe&&_0x42adbe[_0x2cca49(0xf5)]==0xe){const [,_0x17aa66,_0x5856cf]=_0x3fea16,_0x44f190=_0x17aa66[_0x2cca49(0x102)](0x0,0x4)+'-'+_0x17aa66[_0x2cca49(0x102)](0x4,0x6)+'-'+_0x17aa66[_0x2cca49(0x102)](0x6,0x8)+'\x20'+_0x5856cf[_0x2cca49(0x102)](0x0,0x2)+':'+_0x5856cf[_0x2cca49(0x102)](0x2,0x4)+':'+_0x5856cf['substring'](0x4,0x6);console[_0x2cca49(0xe8)](_0x44f190),_0x3139c8=new Date(_0x44f190);}else{if(_0x42adbe&&_0x42adbe[_0x2cca49(0xf5)]==0x10){const [,_0x479cba,_0x2e34a3]=_0x3fea16,_0x40ab82=_0x479cba[_0x2cca49(0x102)](0x0,0x4)+'-'+_0x479cba['substring'](0x4,0x6)+'-'+_0x479cba[_0x2cca49(0x102)](0x6,0x8)+'\x20'+_0x2e34a3[_0x2cca49(0x102)](0x0,0x2)+':'+_0x2e34a3['substring'](0x2,0x4)+':'+_0x2e34a3['substring'](0x4,0x6);console['log'](_0x40ab82),_0x3139c8=new Date(_0x40ab82);}else{if(_0x42adbe&&_0x42adbe['length']==0x13&&_0x42adbe[0x4]=='_'&&_0x42adbe[0x7]=='_'&&_0x42adbe[0xa]=='_'&&_0x42adbe[0xd]=='_'&&_0x42adbe[0x10]=='_')try{const _0x196ea3=_0x42adbe['substring'](0x0,0x4)+'-'+_0x42adbe[_0x2cca49(0x102)](0x5,0x7)+'-'+_0x42adbe[_0x2cca49(0x102)](0x8,0xa)+'\x20'+_0x42adbe[_0x2cca49(0x102)](0xb,0xd)+':'+_0x42adbe['substring'](0xe,0x10)+':'+_0x42adbe[_0x2cca49(0x102)](0x11,0x13);_0x3139c8=new Date(_0x196ea3);}catch(_0x3b103d){}}}}}}}}if(!_0x3139c8)return null;const _0x3f3c07=new Date()[_0x2cca49(0x10c)]();let _0xe7b568=_0x3139c8['getFullYear']();if(!_0xe7b568||_0xe7b568<0x7b2||_0xe7b568>_0x3f3c07)return null;if(!isNaN(_0x3139c8[_0x2cca49(0x10d)]()))return _0x3139c8['getTime']();}return null;}catch(_0x2ba01e){return console[_0x2cca49(0xe8)](_0x2ba01e),null;}};mediaUtil[_0x23b0ec(0xf1)]=function(_0x3ca1b6,_0x5770d2){const _0x51ed63=_0x23b0ec;if(!_0x3ca1b6){const _0x56806a=/(\d{4}-\d{2}-\d{2})/,_0x4c32e8=extractTimestampFromFilename(_0x56806a,_0x5770d2);_0x4c32e8&&(_0x3ca1b6=_0x4c32e8,console[_0x51ed63(0xe8)](_0x51ed63(0x113),_0x4c32e8));}if(!_0x3ca1b6){const _0x5bc80e=/_(\d{8})_(\d{6})/,_0x32c5c8=extractTimestampFromFilename(_0x5bc80e,_0x5770d2);_0x32c5c8&&(_0x3ca1b6=_0x32c5c8,console[_0x51ed63(0xe8)](_0x51ed63(0xf3),_0x32c5c8));}if(!_0x3ca1b6){const _0x497107=/_(\d{8})(\d{6})/,_0xab55b5=extractTimestampFromFilename(_0x497107,_0x5770d2);_0xab55b5&&(_0x3ca1b6=_0xab55b5);}if(!_0x3ca1b6){const _0x3b9ac7=/(\d{8})(\d{6})/,_0x32d558=extractTimestampFromFilename(_0x3b9ac7,_0x5770d2);_0x32d558&&(_0x3ca1b6=_0x32d558);}if(!_0x3ca1b6){const _0x31343e=/(\d{13}|\d{10})/,_0x4fb70d=extractTimestampFromFilename(_0x31343e,_0x5770d2);_0x4fb70d&&(_0x3ca1b6=_0x4fb70d);}if(!_0x3ca1b6){const _0x26a963=/(\d{4})(\d{2})(\d{2})/,_0x3d74d2=extractTimestampFromFilename(_0x26a963,_0x5770d2);_0x3d74d2&&(_0x3ca1b6=_0x3d74d2);}if(!_0x3ca1b6){const _0xb72eff=/(\d{4})_(\d{2})_(\d{2})_(\d{2})_(\d{2})_(\d{2})/,_0x16c20c=extractTimestampFromFilename(_0xb72eff,_0x5770d2);_0x16c20c&&(_0x3ca1b6=_0x16c20c);}_0x3ca1b6&&/\d{15,}/['test'](_0x5770d2)&&_0x5770d2[_0x51ed63(0xe7)](_0x3ca1b6)&&(_0x3ca1b6=null);if(_0x3ca1b6)try{_0x3ca1b6=new Date(_0x3ca1b6)[_0x51ed63(0x10d)]();}catch(_0x589084){console[_0x51ed63(0xe8)](_0x589084);}return _0x3ca1b6;};function getImageTime(_0x32cbaf,_0x5c5d66,_0x47fd85){const _0xa99f01=_0x23b0ec;let _0x46f0bc=![],_0x2ecbd3=path[_0xa99f01(0x119)](_0x32cbaf);function _0x5d082d(){const _0x4749a5=_0xa99f01;if(!_0x46f0bc){let _0xede1e9=_0x5c5d66[_0x4749a5(0xec)];_0x5c5d66[_0x4749a5(0x10a)]<_0xede1e9&&(_0xede1e9=_0x5c5d66[_0x4749a5(0x10a)]),_0x5c5d66[_0x4749a5(0x11a)]<_0xede1e9&&(_0xede1e9=_0x5c5d66[_0x4749a5(0x11a)]),_0x5c5d66[_0x4749a5(0x10b)]<_0xede1e9&&(_0xede1e9=_0x5c5d66['ctimeMs']),_0x46f0bc=_0xede1e9,_0x46f0bc=Math[_0x4749a5(0xf4)](_0x46f0bc);}_0x47fd85(_0x46f0bc);}exifr[_0xa99f01(0x108)](_0x32cbaf)[_0xa99f01(0xf8)](_0x3e1c89=>{const _0x56953c=_0xa99f01;_0x3e1c89&&(_0x46f0bc=_0x3e1c89['DateTimeOriginal'],_0x3e1c89[_0x56953c(0xf6)]&&!_0x46f0bc&&(_0x46f0bc=_0x3e1c89[_0x56953c(0xf6)])),_0x46f0bc=mediaUtil['getTimeFromFileName'](_0x46f0bc,_0x2ecbd3),_0x5d082d();})[_0xa99f01(0xfd)](_0x201560=>{console['log']('exifr异常',_0x201560),_0x5d082d();});};function _0x1a0c(_0x18b5e2,_0x283430){const _0x45e2c6=_0x45e2();return _0x1a0c=function(_0x1a0c2d,_0x570f6c){_0x1a0c2d=_0x1a0c2d-0xe7;let _0x594a26=_0x45e2c6[_0x1a0c2d];return _0x594a26;},_0x1a0c(_0x18b5e2,_0x283430);}function getVideoTime(_0x1c3ef1,_0x5312b,_0x4fbf30){const _0x51e912=_0x23b0ec;try{let _0x48c7a2=![],_0x440f48=path[_0x51e912(0x119)](_0x1c3ef1);function _0xbfe522(){const _0x21d40f=_0x51e912;if(!_0x48c7a2){let _0x21aeba=_0x5312b[_0x21d40f(0xec)];_0x5312b[_0x21d40f(0x10a)]<_0x21aeba&&(_0x21aeba=_0x5312b[_0x21d40f(0x10a)]),_0x5312b[_0x21d40f(0x11a)]<_0x21aeba&&(_0x21aeba=_0x5312b['atimeMs']),_0x5312b[_0x21d40f(0x10b)]<_0x21aeba&&(_0x21aeba=_0x5312b['ctimeMs']),_0x48c7a2=_0x21aeba,_0x48c7a2=Math[_0x21d40f(0xf4)](_0x48c7a2);}_0x4fbf30(_0x48c7a2);}FFmpeg(transCodeUtil[_0x51e912(0xe9)](_0x1c3ef1))['ffprobe']((_0x419525,_0x259823)=>{const _0x4b42af=_0x51e912;if(_0x419525)return console[_0x4b42af(0xe8)]('ffprobe读取视频信息失败'),_0x4fbf30(_0x48c7a2);if(_0x259823&&_0x259823[_0x4b42af(0x11d)]&&_0x259823[_0x4b42af(0x11d)]['tags']){let _0x1886e3=_0x259823[_0x4b42af(0x11d)][_0x4b42af(0x110)][_0x4b42af(0xfe)];_0x1886e3&&(_0x48c7a2=_0x1886e3),!_0x48c7a2&&_0x259823[_0x4b42af(0x11d)][_0x4b42af(0x110)][_0x4b42af(0xed)]&&(_0x48c7a2=_0x259823[_0x4b42af(0x11d)][_0x4b42af(0x110)][_0x4b42af(0xed)]),_0x48c7a2&&_0x48c7a2[_0x4b42af(0x115)](_0x4b42af(0x103))&&(_0x48c7a2=![]);}return console[_0x4b42af(0xe8)](_0x48c7a2),_0x48c7a2=mediaUtil[_0x4b42af(0xf1)](_0x48c7a2,_0x440f48),_0xbfe522();});}catch(_0x22a228){return console[_0x51e912(0xe8)](_0x51e912(0x114),_0x1c3ef1),returnOriginalTime();}}mediaUtil[_0x23b0ec(0x101)]=function(_0x174a09){return new Promise((_0x34e661,_0x10e7ec)=>{const _0x1299a8=_0x1a0c;let _0x41a420=Date[_0x1299a8(0x106)]();fs[_0x1299a8(0x10e)](_0x174a09,(_0x20f788,_0xe0bf6d)=>{_0x20f788?setTimeout(()=>{const _0x5ef799=_0x1a0c;fs[_0x5ef799(0x10e)](_0x174a09,(_0x566e09,_0x89ad0f)=>{if(_0x566e09)return _0x182269();else _0x23f88d(_0x89ad0f,_0x34e661);});},0x3e8):_0x23f88d(_0xe0bf6d,_0x34e661);});function _0x182269(){_0x34e661(_0x41a420);}function _0x23f88d(_0x3c4c06,_0x3e234f){const _0x5b2192=_0x1299a8;try{_0x41a420=_0x3c4c06['birthtime']||_0x3c4c06[_0x5b2192(0xef)],_0x41a420=Math[_0x5b2192(0xf4)](_0x41a420);if(!_0x3c4c06['isFile']())return _0x182269();let _0x5e7693=path[_0x5b2192(0x109)](_0x174a09)[_0x5b2192(0xfa)]();if(_0x3c4c06['isFile']()&&(config[_0x5b2192(0xf7)][_0x5b2192(0xe7)](_0x5e7693)||config[_0x5b2192(0xfb)][_0x5b2192(0xe7)](_0x5e7693)))return getImageTime(_0x174a09,_0x3c4c06,_0x3e234f);else return _0x3c4c06[_0x5b2192(0x111)]()&&config[_0x5b2192(0xf9)][_0x5b2192(0xe7)](_0x5e7693)?getVideoTime(_0x174a09,_0x3c4c06,_0x3e234f):(console[_0x5b2192(0xe8)](_0x5b2192(0x117)),_0x182269());}catch(_0x2463b5){return _0x182269();}}});},module['exports']=mediaUtil;function _0x45e2(){const _0x413f0d=['ceil','length','CreateDate','imgTypeList','then','videoTypeList','toLowerCase','rawImgTypeList','12128930olgULb','catch','com.apple.quicktime.creationdate','3pBSMMj','826564ITQQuR','getFileTime','substring','1970-01-01','2125FIAxRa','../myConfig/config','now','FFmpeg','parse','extname','mtimeMs','ctimeMs','getFullYear','getTime','stat','../utils/transCodeUtil','tags','isFile','1544uMVoSr','匹配到合适的时间戳,YYYY-MM-DD','获取视频拍摄时间错误','startsWith','10549rDromZ','非视频和图片，返回文件创建时间','exifr','basename','atimeMs','2115486UjsAqi','2540948aqDjHN','format','includes','log','dealFFmpegPath','962924oHRptJ','../libs/nasTrans','birthtimeMs','creation_time','path','ctime','3582TaCQyW','getTimeFromFileName','match','匹配到合适的时间戳,_d8_d6'];_0x45e2=function(){return _0x413f0d;};return _0x45e2();}