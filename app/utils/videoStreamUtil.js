const _0x2b571a=_0x5996;(function(_0x22b050,_0x3775bf){const _0x2c7eb1=_0x5996,_0x25761a=_0x22b050();while(!![]){try{const _0x439a6b=-parseInt(_0x2c7eb1(0x1ab))/0x1+parseInt(_0x2c7eb1(0x1ca))/0x2+parseInt(_0x2c7eb1(0x1ba))/0x3*(parseInt(_0x2c7eb1(0x1b6))/0x4)+parseInt(_0x2c7eb1(0x1ad))/0x5+-parseInt(_0x2c7eb1(0x1cb))/0x6*(-parseInt(_0x2c7eb1(0x1bd))/0x7)+parseInt(_0x2c7eb1(0x1d3))/0x8*(parseInt(_0x2c7eb1(0x1ce))/0x9)+-parseInt(_0x2c7eb1(0x1a9))/0xa;if(_0x439a6b===_0x3775bf)break;else _0x25761a['push'](_0x25761a['shift']());}catch(_0x3db525){_0x25761a['push'](_0x25761a['shift']());}}}(_0xcde5,0xcda4e));let FFmpeg=require(_0x2b571a(0x1aa))[_0x2b571a(0x1a1)];const dbConfigTable=require(_0x2b571a(0x1c7)),dbFileIndexTable=require(_0x2b571a(0x1d4)),transCodeUtil=require(_0x2b571a(0x1c2));let videoStreamUtil={};function _0x5996(_0x47831e,_0x5ee898){const _0xcde575=_0xcde5();return _0x5996=function(_0x5996ee,_0xcb13d){_0x5996ee=_0x5996ee-0x19e;let _0x3e7c81=_0xcde575[_0x5996ee];return _0x3e7c81;},_0x5996(_0x47831e,_0x5ee898);}function timeToSec(_0x52b5e8){const _0x5be469=_0x2b571a;var _0x437799='',_0x34aa08=_0x52b5e8[_0x5be469(0x1c6)](':')[0x0],_0x49fdbd=_0x52b5e8[_0x5be469(0x1c6)](':')[0x1],_0x117fe4=_0x52b5e8['split'](':')[0x2];return _0x437799=parseFloat(_0x34aa08*0xe10)+parseFloat(_0x49fdbd*0x3c)+parseFloat(_0x117fe4),_0x437799;}videoStreamUtil[_0x2b571a(0x1c8)]=function(_0x2cd4ad){const _0x232b97=_0x2b571a;let _0x2abfbd=dbConfigTable[_0x232b97(0x1c3)](_0x2cd4ad,_0x232b97(0x1d1));!_0x2abfbd?_0x2cd4ad['prepare'](_0x232b97(0x1b7)+new Date()[_0x232b97(0x1b1)]()+')')[_0x232b97(0x1b3)]():_0x2cd4ad[_0x232b97(0x1c0)](_0x232b97(0x1bb)+new Date()[_0x232b97(0x1b1)]()+'\x20WHERE\x20title=\x27lastTimeStampMatchMovieInfo\x27')[_0x232b97(0x1b3)]();};let lastMovieInfoUpdateTime=0x0;videoStreamUtil['goParseMoviesKeys']=function(_0x4df742,_0x503c51,_0x42b497){const _0x39bd9d=_0x2b571a;let _0x4c9bf4=dbConfigTable[_0x39bd9d(0x1c3)](_0x4df742,_0x39bd9d(0x1d1));if(_0x42b497)videoStreamUtil[_0x39bd9d(0x1be)](_0x503c51);else _0x4c9bf4&&lastMovieInfoUpdateTime!=_0x4c9bf4[_0x39bd9d(0x1ae)]&&(videoStreamUtil[_0x39bd9d(0x1be)](_0x503c51),lastMovieInfoUpdateTime=_0x4c9bf4['value']);};function _0xcde5(){const _0x190698=['FFmpeg','video','DURATION','parseVideoWH','getVideoOriginalTime','rotate','width','duration','30105380zRUlND','../libs/nasTrans','758143MolybL','getDurationFromStream','8219435vqbfgb','value','creation_time','\x27,\x20\x27','getTime','length','run','movie_language','includes','604GjjWZJ','REPLACE\x20INTO\x20config(title,value)\x20values(\x27lastTimeStampMatchMovieInfo\x27,','movie_regions','streams','25089EsJPEA','UPDATE\x20config\x20SET\x20value=','codec_type','13839xTxeua','parseMovieKeys','file_index_movie','prepare','rotation','./transCodeUtil','findByTitle','push','indexOf','split','../db/dbConfigTable','saveLastMatchTime','\x20movie_info_state=1\x20and\x20is_file=1\x20and\x20type=2','782448EEqega','2964YOmXUy','format','tags','3027933JiVvnO','N/A','trim','lastTimeStampMatchMovieInfo','ffprobe','8LFbBxK','../db/dbFileIndexTable','com.apple.quicktime.creationdate','movie_genres','height'];_0xcde5=function(){return _0x190698;};return _0xcde5();}let isParsingMovie=![];videoStreamUtil['parseMovieKeys']=function(_0x446f80){const _0x78dd3c=_0x2b571a;if(isParsingMovie)return;let _0x586cc6={};isParsingMovie=!![];let _0x5902a2=dbFileIndexTable['getAllByWhere'](_0x446f80,_0x78dd3c(0x1c9),'movie_regions,movie_language,movie_genres',_0x78dd3c(0x1bf)),_0x541193=[],_0x497cb1=[],_0x3f90c6=[];function _0x40ad36(_0x3679a6,_0x24cea6,_0x251d25){const _0x527951=_0x78dd3c;if(_0x3679a6){if(_0x3679a6[_0x527951(0x1c5)]('/')!=-0x1){let _0x268113=_0x3679a6[_0x527951(0x1c6)]('/');for(let _0x17c8de in _0x268113){_0x268113[_0x17c8de]&&(!_0x24cea6[_0x527951(0x1b5)](_0x268113[_0x17c8de]['trim']())?(_0x24cea6['push'](_0x268113[_0x17c8de][_0x527951(0x1d0)]()),_0x586cc6[_0x251d25+_0x268113[_0x17c8de][_0x527951(0x1d0)]()]=0x1):_0x586cc6[_0x251d25+_0x268113[_0x17c8de][_0x527951(0x1d0)]()]+=0x1);}}else!_0x24cea6[_0x527951(0x1b5)](_0x3679a6['trim']())?(_0x24cea6[_0x527951(0x1c4)](_0x3679a6[_0x527951(0x1d0)]()),_0x586cc6[_0x251d25+_0x3679a6[_0x527951(0x1d0)]()]=0x1):_0x586cc6[_0x251d25+_0x3679a6['trim']()]+=0x1;}for(let _0x41b096=0x0;_0x41b096<_0x24cea6[_0x527951(0x1b2)];_0x41b096++){const _0x52f6fb='REPLACE\x20INTO\x20\x20movie_keys(key_type,key_value,index_count)\x20VALUES(\x27'+_0x251d25+_0x527951(0x1b0)+_0x24cea6[_0x41b096]+'\x27,'+_0x586cc6[_0x251d25+_0x24cea6[_0x41b096]]+')';_0x446f80[_0x527951(0x1c0)](_0x52f6fb)[_0x527951(0x1b3)]();}}if(_0x5902a2&&_0x5902a2[_0x78dd3c(0x1b2)]>0x0){_0x446f80[_0x78dd3c(0x1c0)]('UPDATE\x20movie_keys\x20SET\x20index_count=0\x20where\x201=1')['run']();for(let _0x3bfa04=0x0;_0x3bfa04<_0x5902a2['length'];_0x3bfa04++){let _0x21fec1=_0x5902a2[_0x3bfa04],_0x604aa5=_0x21fec1['movie_genres'],_0x2fa4f0=_0x21fec1[_0x78dd3c(0x1b4)],_0x56933d=_0x21fec1['movie_regions'];_0x40ad36(_0x604aa5,_0x3f90c6,_0x78dd3c(0x19f)),_0x40ad36(_0x2fa4f0,_0x541193,_0x78dd3c(0x1b4)),_0x40ad36(_0x56933d,_0x497cb1,_0x78dd3c(0x1b8));}}else _0x446f80[_0x78dd3c(0x1c0)]('DELETE\x20FROM\x20movie_keys\x20where\x201=1')['run']();isParsingMovie=![];},videoStreamUtil[_0x2b571a(0x1a5)]=function(_0x4a27a1){const _0x56432b=_0x2b571a;let _0x23df4d=new Date()[_0x56432b(0x1b1)]();if(_0x4a27a1&&_0x4a27a1[_0x56432b(0x1cc)]&&_0x4a27a1[_0x56432b(0x1cc)][_0x56432b(0x1cd)]){let _0x291695=_0x4a27a1['format'][_0x56432b(0x1cd)][_0x56432b(0x19e)],_0x14b453=null;_0x291695&&(_0x14b453=_0x291695,_0x23df4d=new Date(_0x14b453)['getTime']()),!_0x14b453&&_0x4a27a1[_0x56432b(0x1cc)][_0x56432b(0x1cd)]['creation_time']&&(_0x14b453=_0x4a27a1[_0x56432b(0x1cc)][_0x56432b(0x1cd)][_0x56432b(0x1af)],_0x23df4d=new Date(_0x14b453)[_0x56432b(0x1b1)]());}return _0x23df4d;},videoStreamUtil[_0x2b571a(0x1ac)]=function(_0x50555c){const _0xafbfba=_0x2b571a;let _0x8bd8a4=_0x50555c[_0xafbfba(0x1b9)];if(_0x50555c&&_0x50555c[_0xafbfba(0x1cc)]&&_0x50555c[_0xafbfba(0x1cc)][_0xafbfba(0x1a8)]){let _0x3ed697=_0x50555c['format'][_0xafbfba(0x1a8)];if(_0x3ed697&&_0x3ed697!=_0xafbfba(0x1cf)&&!isNaN(_0x3ed697)&&_0x3ed697>0x0)return _0x3ed697;}for(let _0x569822=0x0;_0x569822<_0x8bd8a4[_0xafbfba(0x1b2)];_0x569822++){let _0x4e41e2=_0x8bd8a4[_0x569822];if(_0x4e41e2['duration']&&_0x4e41e2[_0xafbfba(0x1a8)]!=_0xafbfba(0x1cf)&&!isNaN(_0x4e41e2[_0xafbfba(0x1a8)])&&_0x4e41e2[_0xafbfba(0x1a8)]>0x0)return _0x4e41e2[_0xafbfba(0x1a8)];if(_0x4e41e2[_0xafbfba(0x1cd)]){if(_0x4e41e2[_0xafbfba(0x1cd)]['DURATION']||_0x4e41e2[_0xafbfba(0x1cd)][_0xafbfba(0x1a8)]){let _0x4566c5=_0x4e41e2[_0xafbfba(0x1cd)][_0xafbfba(0x1a3)]||_0x4e41e2[_0xafbfba(0x1cd)][_0xafbfba(0x1a8)];if(_0x4566c5['indexOf'](':')!=-0x1)return timeToSec(_0x4566c5);}}}return 0x0;},videoStreamUtil['getVideoMeta']=function(_0x1d8ad9){return new Promise((_0x363bc5,_0x4439b3)=>{const _0x3bd3dc=_0x5996;FFmpeg(_0x1d8ad9)[_0x3bd3dc(0x1d2)]((_0xf8ec8e,_0x5d20ce)=>{_0xf8ec8e?_0x4439b3(_0xf8ec8e):_0x363bc5(_0x5d20ce);});});},videoStreamUtil[_0x2b571a(0x1a4)]=function(_0x4099ed){const _0x57d0a8=_0x2b571a;let _0x1c4dc6=0x0,_0x358106=0x0,_0x1300f4=0x0,_0x5e3097=null;for(let _0x59149f=0x0;_0x59149f<_0x4099ed[_0x57d0a8(0x1b2)];_0x59149f++){let _0x14dd94=_0x4099ed[_0x59149f];_0x14dd94[_0x57d0a8(0x1bc)]==_0x57d0a8(0x1a2)&&(_0x5e3097=_0x14dd94,_0x14dd94['rotation']&&(_0x1300f4=_0x14dd94[_0x57d0a8(0x1c1)]),!_0x1300f4&&(_0x14dd94[_0x57d0a8(0x1cd)]&&_0x14dd94[_0x57d0a8(0x1cd)][_0x57d0a8(0x1a6)]&&(_0x1300f4=_0x14dd94[_0x57d0a8(0x1cd)][_0x57d0a8(0x1a6)])));if(_0x14dd94[_0x57d0a8(0x1a7)]&&_0x14dd94['height']){if(_0x14dd94[_0x57d0a8(0x1a7)]!=_0x57d0a8(0x1cf)&&!isNaN(_0x14dd94['width'])&&_0x14dd94[_0x57d0a8(0x1a7)]>0x0){_0x1c4dc6=_0x14dd94[_0x57d0a8(0x1a7)],_0x358106=_0x14dd94[_0x57d0a8(0x1a0)];break;}}}if((_0x1300f4==0x5a||_0x1300f4==-0x5a||_0x1300f4==0x10e)&&_0x1c4dc6&&_0x358106){let _0x2ee169=_0x1c4dc6,_0x5ab851=_0x358106;_0x1c4dc6=_0x5ab851,_0x358106=_0x2ee169;}return{'videoHeight':_0x358106,'videoWidth':_0x1c4dc6,'videoStream':_0x5e3097};},module['exports']=videoStreamUtil;