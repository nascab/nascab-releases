const _0x158fd6=_0x5741;(function(_0x4695a3,_0x1464c7){const _0x254acd=_0x5741,_0x86a572=_0x4695a3();while(!![]){try{const _0x3f9abb=parseInt(_0x254acd(0x1e2))/0x1*(parseInt(_0x254acd(0x1b7))/0x2)+-parseInt(_0x254acd(0x1cf))/0x3+parseInt(_0x254acd(0x1d9))/0x4+-parseInt(_0x254acd(0x1c9))/0x5*(-parseInt(_0x254acd(0x1da))/0x6)+-parseInt(_0x254acd(0x1d6))/0x7*(parseInt(_0x254acd(0x1e3))/0x8)+-parseInt(_0x254acd(0x1e7))/0x9+-parseInt(_0x254acd(0x1b6))/0xa*(parseInt(_0x254acd(0x1e4))/0xb);if(_0x3f9abb===_0x1464c7)break;else _0x86a572['push'](_0x86a572['shift']());}catch(_0x491dec){_0x86a572['push'](_0x86a572['shift']());}}}(_0x15f6,0xdda9e));let FFmpeg=require('../libs/nasTrans')[_0x158fd6(0x1d1)];const dbConfigTable=require(_0x158fd6(0x1c6)),dbFileIndexTable=require(_0x158fd6(0x1d5)),transCodeUtil=require(_0x158fd6(0x1c7));let videoStreamUtil={};function timeToSec(_0x5c07e6){const _0x1df555=_0x158fd6;var _0x363403='',_0x44f533=_0x5c07e6['split'](':')[0x0],_0x31c843=_0x5c07e6[_0x1df555(0x1e6)](':')[0x1],_0x11911c=_0x5c07e6['split'](':')[0x2];return _0x363403=parseFloat(_0x44f533*0xe10)+parseFloat(_0x31c843*0x3c)+parseFloat(_0x11911c),_0x363403;}videoStreamUtil[_0x158fd6(0x1ba)]=function(_0x1690ec){const _0x5d9bb5=_0x158fd6;let _0x1f9e5c=dbConfigTable[_0x5d9bb5(0x1cd)](_0x1690ec,'lastTimeStampMatchMovieInfo');!_0x1f9e5c?_0x1690ec[_0x5d9bb5(0x1c3)](_0x5d9bb5(0x1e9)+new Date()[_0x5d9bb5(0x1d8)]()+')')[_0x5d9bb5(0x1d3)]():_0x1690ec['prepare'](_0x5d9bb5(0x1b9)+new Date()[_0x5d9bb5(0x1d8)]()+_0x5d9bb5(0x1c0))[_0x5d9bb5(0x1d3)]();};let lastMovieInfoUpdateTime=0x0;function _0x15f6(){const _0xab928d=['259ewyZbU','movie_language','getTime','6538196CXJlBW','192TTeVys','width','DELETE\x20FROM\x20movie_keys\x20where\x201=1','indexOf','codec_type','rotate','format','getVideoMeta','2CKTzix','75224SaOPPc','154DEsLIz','getVideoOriginalTime','split','4813929DwyjeS','getDurationFromStream','REPLACE\x20INTO\x20config(title,value)\x20values(\x27lastTimeStampMatchMovieInfo\x27,','trim','\x27,\x20\x27','N/A','REPLACE\x20INTO\x20\x20movie_keys(key_type,key_value,index_count)\x20VALUES(\x27','tags','height','creation_time','306730VZvokg','914678BkKBJY','parseVideoWH','UPDATE\x20config\x20SET\x20value=','saveLastMatchTime','length','ffprobe','lastTimeStampMatchMovieInfo','streams','duration','\x20WHERE\x20title=\x27lastTimeStampMatchMovieInfo\x27','rotation','push','prepare','includes','\x20movie_info_state=1\x20and\x20is_file=1\x20and\x20type=2','../db/dbConfigTable','./transCodeUtil','getAllByWhere','56300AVHbgS','parseMovieKeys','movie_genres','UPDATE\x20movie_keys\x20SET\x20index_count=0\x20where\x201=1','findByTitle','goParseMoviesKeys','2068197qnywnM','value','FFmpeg','file_index_movie','run','com.apple.quicktime.creationdate','../db/dbFileIndexTable'];_0x15f6=function(){return _0xab928d;};return _0x15f6();}videoStreamUtil[_0x158fd6(0x1ce)]=function(_0x441dad,_0x4f1feb,_0x5f4dea){const _0x47c9f6=_0x158fd6;let _0x18e6a5=dbConfigTable[_0x47c9f6(0x1cd)](_0x441dad,_0x47c9f6(0x1bd));if(_0x5f4dea)videoStreamUtil[_0x47c9f6(0x1ca)](_0x4f1feb);else _0x18e6a5&&lastMovieInfoUpdateTime!=_0x18e6a5[_0x47c9f6(0x1d0)]&&(videoStreamUtil[_0x47c9f6(0x1ca)](_0x4f1feb),lastMovieInfoUpdateTime=_0x18e6a5[_0x47c9f6(0x1d0)]);};function _0x5741(_0x13b354,_0x344adf){const _0x15f606=_0x15f6();return _0x5741=function(_0x5741bc,_0x59ef02){_0x5741bc=_0x5741bc-0x1af;let _0x31dbd7=_0x15f606[_0x5741bc];return _0x31dbd7;},_0x5741(_0x13b354,_0x344adf);}let isParsingMovie=![];videoStreamUtil['parseMovieKeys']=function(_0xaa06c4){const _0xfc2c1b=_0x158fd6;if(isParsingMovie)return;let _0x4a5305={};isParsingMovie=!![];let _0x507c0a=dbFileIndexTable[_0xfc2c1b(0x1c8)](_0xaa06c4,_0xfc2c1b(0x1c5),'movie_regions,movie_language,movie_genres',_0xfc2c1b(0x1d2)),_0x4007cf=[],_0x1f567a=[],_0x1ce5c4=[];function _0x597f17(_0x232c91,_0x5a78a2,_0x128a08){const _0x59eb22=_0xfc2c1b;if(_0x232c91){if(_0x232c91[_0x59eb22(0x1dd)]('/')!=-0x1){let _0x229161=_0x232c91[_0x59eb22(0x1e6)]('/');for(let _0x448c38 in _0x229161){_0x229161[_0x448c38]&&(!_0x5a78a2[_0x59eb22(0x1c4)](_0x229161[_0x448c38][_0x59eb22(0x1af)]())?(_0x5a78a2[_0x59eb22(0x1c2)](_0x229161[_0x448c38][_0x59eb22(0x1af)]()),_0x4a5305[_0x128a08+_0x229161[_0x448c38][_0x59eb22(0x1af)]()]=0x1):_0x4a5305[_0x128a08+_0x229161[_0x448c38][_0x59eb22(0x1af)]()]+=0x1);}}else!_0x5a78a2[_0x59eb22(0x1c4)](_0x232c91[_0x59eb22(0x1af)]())?(_0x5a78a2[_0x59eb22(0x1c2)](_0x232c91['trim']()),_0x4a5305[_0x128a08+_0x232c91[_0x59eb22(0x1af)]()]=0x1):_0x4a5305[_0x128a08+_0x232c91[_0x59eb22(0x1af)]()]+=0x1;}for(let _0x3eeaee=0x0;_0x3eeaee<_0x5a78a2['length'];_0x3eeaee++){const _0x35ed14=_0x59eb22(0x1b2)+_0x128a08+_0x59eb22(0x1b0)+_0x5a78a2[_0x3eeaee]+'\x27,'+_0x4a5305[_0x128a08+_0x5a78a2[_0x3eeaee]]+')';_0xaa06c4[_0x59eb22(0x1c3)](_0x35ed14)[_0x59eb22(0x1d3)]();}}if(_0x507c0a&&_0x507c0a['length']>0x0){_0xaa06c4[_0xfc2c1b(0x1c3)](_0xfc2c1b(0x1cc))[_0xfc2c1b(0x1d3)]();for(let _0x2748de=0x0;_0x2748de<_0x507c0a[_0xfc2c1b(0x1bb)];_0x2748de++){let _0x16844a=_0x507c0a[_0x2748de],_0x3d00c9=_0x16844a['movie_genres'],_0x2a653b=_0x16844a[_0xfc2c1b(0x1d7)],_0x438d15=_0x16844a['movie_regions'];_0x597f17(_0x3d00c9,_0x1ce5c4,_0xfc2c1b(0x1cb)),_0x597f17(_0x2a653b,_0x4007cf,_0xfc2c1b(0x1d7)),_0x597f17(_0x438d15,_0x1f567a,'movie_regions');}}else _0xaa06c4[_0xfc2c1b(0x1c3)](_0xfc2c1b(0x1dc))[_0xfc2c1b(0x1d3)]();isParsingMovie=![];},videoStreamUtil[_0x158fd6(0x1e5)]=function(_0x297997){const _0xaef4f1=_0x158fd6;let _0x56e8ed=new Date()[_0xaef4f1(0x1d8)]();if(_0x297997&&_0x297997[_0xaef4f1(0x1e0)]&&_0x297997['format'][_0xaef4f1(0x1b3)]){let _0x538e94=_0x297997[_0xaef4f1(0x1e0)][_0xaef4f1(0x1b3)][_0xaef4f1(0x1d4)],_0x18c5ae=null;_0x538e94&&(_0x18c5ae=_0x538e94,_0x56e8ed=new Date(_0x18c5ae)[_0xaef4f1(0x1d8)]()),!_0x18c5ae&&_0x297997[_0xaef4f1(0x1e0)][_0xaef4f1(0x1b3)][_0xaef4f1(0x1b5)]&&(_0x18c5ae=_0x297997[_0xaef4f1(0x1e0)]['tags'][_0xaef4f1(0x1b5)],_0x56e8ed=new Date(_0x18c5ae)[_0xaef4f1(0x1d8)]());}return _0x56e8ed;},videoStreamUtil[_0x158fd6(0x1e8)]=function(_0xb19094){const _0x808550=_0x158fd6;let _0x41ebdf=_0xb19094[_0x808550(0x1be)];if(_0xb19094&&_0xb19094[_0x808550(0x1e0)]&&_0xb19094['format'][_0x808550(0x1bf)]){let _0x24e5e7=_0xb19094[_0x808550(0x1e0)][_0x808550(0x1bf)];if(_0x24e5e7&&_0x24e5e7!=_0x808550(0x1b1)&&!isNaN(_0x24e5e7)&&_0x24e5e7>0x0)return _0x24e5e7;}for(let _0x24ae88=0x0;_0x24ae88<_0x41ebdf[_0x808550(0x1bb)];_0x24ae88++){let _0xa54182=_0x41ebdf[_0x24ae88];if(_0xa54182[_0x808550(0x1bf)]&&_0xa54182['duration']!=_0x808550(0x1b1)&&!isNaN(_0xa54182[_0x808550(0x1bf)])&&_0xa54182[_0x808550(0x1bf)]>0x0)return _0xa54182[_0x808550(0x1bf)];if(_0xa54182[_0x808550(0x1b3)]){if(_0xa54182[_0x808550(0x1b3)]['DURATION']||_0xa54182[_0x808550(0x1b3)][_0x808550(0x1bf)]){let _0x8e7fe6=_0xa54182[_0x808550(0x1b3)]['DURATION']||_0xa54182[_0x808550(0x1b3)]['duration'];if(_0x8e7fe6[_0x808550(0x1dd)](':')!=-0x1)return timeToSec(_0x8e7fe6);}}}return 0x0;},videoStreamUtil[_0x158fd6(0x1e1)]=function(_0x516938){return new Promise((_0x125733,_0x4a72db)=>{const _0x3ad0c0=_0x5741;FFmpeg(_0x516938)[_0x3ad0c0(0x1bc)]((_0x2c4d41,_0x405678)=>{_0x2c4d41?_0x4a72db(_0x2c4d41):_0x125733(_0x405678);});});},videoStreamUtil[_0x158fd6(0x1b8)]=function(_0x161f83){const _0x33eedc=_0x158fd6;let _0x53d457=0x0,_0x26502d=0x0,_0xcca638=0x0,_0x4dc1e3=null;for(let _0x151eb3=0x0;_0x151eb3<_0x161f83[_0x33eedc(0x1bb)];_0x151eb3++){let _0xefd855=_0x161f83[_0x151eb3];_0xefd855[_0x33eedc(0x1de)]=='video'&&(_0x4dc1e3=_0xefd855,_0xefd855[_0x33eedc(0x1c1)]&&(_0xcca638=_0xefd855[_0x33eedc(0x1c1)]),!_0xcca638&&(_0xefd855[_0x33eedc(0x1b3)]&&_0xefd855['tags'][_0x33eedc(0x1df)]&&(_0xcca638=_0xefd855[_0x33eedc(0x1b3)][_0x33eedc(0x1df)])));if(_0xefd855[_0x33eedc(0x1db)]&&_0xefd855[_0x33eedc(0x1b4)]){if(_0xefd855['width']!='N/A'&&!isNaN(_0xefd855[_0x33eedc(0x1db)])&&_0xefd855[_0x33eedc(0x1db)]>0x0){_0x53d457=_0xefd855[_0x33eedc(0x1db)],_0x26502d=_0xefd855[_0x33eedc(0x1b4)];break;}}}if((_0xcca638==0x5a||_0xcca638==-0x5a||_0xcca638==0x10e)&&_0x53d457&&_0x26502d){let _0xba94e4=_0x53d457,_0x4d6d0e=_0x26502d;_0x53d457=_0x4d6d0e,_0x26502d=_0xba94e4;}return{'videoHeight':_0x26502d,'videoWidth':_0x53d457,'videoStream':_0x4dc1e3};},module['exports']=videoStreamUtil;