const _0x2ed5bf=_0x2fc5;(function(_0x108707,_0x35154c){const _0x30fa01=_0x2fc5,_0x3d59d9=_0x108707();while(!![]){try{const _0x1a9f50=-parseInt(_0x30fa01(0xb5))/0x1+parseInt(_0x30fa01(0xe6))/0x2+parseInt(_0x30fa01(0xe8))/0x3*(-parseInt(_0x30fa01(0xc2))/0x4)+-parseInt(_0x30fa01(0x8e))/0x5+parseInt(_0x30fa01(0x92))/0x6*(parseInt(_0x30fa01(0xd3))/0x7)+-parseInt(_0x30fa01(0xe0))/0x8+parseInt(_0x30fa01(0xa9))/0x9;if(_0x1a9f50===_0x35154c)break;else _0x3d59d9['push'](_0x3d59d9['shift']());}catch(_0x5bcab5){_0x3d59d9['push'](_0x3d59d9['shift']());}}}(_0x32f2,0xcf049));let app,BrowserWindow,Menu,Tray,protocol,ipcMain;try{let elec=require('electron');app=elec[_0x2ed5bf(0xbb)],BrowserWindow=elec[_0x2ed5bf(0xf3)],Menu=elec[_0x2ed5bf(0xc3)],Tray=elec[_0x2ed5bf(0xaf)],protocol=elec['protocol'],ipcMain=elec['ipcMain'];}catch(_0x1f894c){console['log'](_0x2ed5bf(0xb8));}const {fork}=require(_0x2ed5bf(0x9f));function _0x2fc5(_0x29e72f,_0x3eb23b){const _0x32f2d9=_0x32f2();return _0x2fc5=function(_0x2fc52d,_0x4461ad){_0x2fc52d=_0x2fc52d-0x8b;let _0x3c84e9=_0x32f2d9[_0x2fc52d];return _0x3c84e9;},_0x2fc5(_0x29e72f,_0x3eb23b);}let path=require(_0x2ed5bf(0xbd)),fs=require('fs'),os=require('os'),initUtil={},privateSpaceUtil=require(_0x2ed5bf(0xf4)),dbConfigTable=require(_0x2ed5bf(0xd4)),dbu='',mainWindow='';function _0x32f2(){const _0x605fd3=['initTray','subtitlePath','dbCity','../db/dbUtil','createMainWindow','Using\x20file\x20config\x20port','openDevTools','REPLACE\x20INTO\x20process_record(process_id)\x20VALUES(?)','7meuzPw','../db/dbConfigTable','setApplicationMenu','\x20WHERE\x20last_login_time\x20<?','tokenKeepHour','dirname','startsWith','apiPort','click','../db/dbUserTable','darwin','resolve','kill','351376VmJJEA','getFreePort','dbFileIndex','join','create','expireTokenOnTime','2135964kkaRkl','../express-server/utils/netUtils','772923Ivpnoz','addScanTask','getTime','posterPath','DELETE\x20FROM\x20process_record\x20WHERE\x201=1','tempFilePath','getUpdateInfo','minimize','exitApp','SIGTERM','isVisible','BrowserWindow','../express-server/utils/privateSpaceUtils','autoLaunch','deleteUserTokenByWhere','../db/dbScanTaskTable','m3u8TmpPath','processList','Loading...','launchWithSys','isPortFree','../myConfig/config','length','musicCoverPath','pid','existsSync','getLocale','7558565TxQiwr','initDbu','utf-8','setContextMenu','5900610xmkFcj','loading/loading.html','../utils/updateUtil','buildFromTemplate','logo-tray.png','getAll','runNewVersionTask','../../','loadFile','facesPath','type','addScanTaskWhenStart','getPath','child_process','log','database','appRootPath','cachePath','getRootPath','subtitleUploadPath','dbOther','startUpdate','Show/Hide','16284240qoZwMF','mkdirSync','userDataFolder','run','init','language','Tray','win32','destroy','findByTitle','close','SELECT\x20*\x20FROM\x20process_record','1199556rQBJIs','isPackaged','hide','Clientless\x20service\x20mode','./globalInfoUtil','platform','app','openDev','path','value','Restart(重启应用)','exports','preventDefault','4DuTWiC','Menu','setToolTip','quit','prepare','setLanguage','zh-CN','apiPortHttps','show'];_0x32f2=function(){return _0x605fd3;};return _0x32f2();}const config=require(_0x2ed5bf(0xfd));let netUtils=require(_0x2ed5bf(0xe7)),appTray;const dbUserTable=require(_0x2ed5bf(0xdc)),dbSourceFolderTable=require('../db/dbSourceFolderTable'),dbScanTaskTable=require(_0x2ed5bf(0xf7));initUtil[_0x2ed5bf(0x98)]=function(_0x362434){},initUtil[_0x2ed5bf(0xa4)]=function(){const _0xc9289d=_0x2ed5bf;let _0x1b5c3e='';return app&&app[_0xc9289d(0xb6)]?(_0x1b5c3e=path[_0xc9289d(0xd8)](app[_0xc9289d(0x9e)]('exe')),os[_0xc9289d(0xba)]()==_0xc9289d(0xdd)&&(_0x1b5c3e=path[_0xc9289d(0xd8)](_0x1b5c3e))):_0x1b5c3e=path['join'](__dirname,_0xc9289d(0x99)),_0x1b5c3e;},initUtil[_0x2ed5bf(0x8f)]=function(){const _0x19d64b=_0x2ed5bf;var _0x50dd03=require(_0x19d64b(0xce));return dbu=new _0x50dd03(),dbu;},initUtil[_0x2ed5bf(0x9d)]=function(_0x220966){const _0x310d49=_0x2ed5bf;let _0x18eb2e=dbSourceFolderTable[_0x310d49(0x97)](_0x220966);for(let _0x1105ea of _0x18eb2e){_0x1105ea['scan_when_start']==0x1&&dbScanTaskTable[_0x310d49(0xe9)](_0x220966,_0x1105ea[_0x310d49(0x9c)],_0x1105ea[_0x310d49(0xbd)]);}},initUtil['addProcessRecord']=function(_0xdd59c,_0x483c6f){const _0x30dfb8=_0x2ed5bf;_0xdd59c[_0x30dfb8(0xc6)](_0x30dfb8(0xd2))[_0x30dfb8(0xac)](_0x483c6f+'');},initUtil[_0x2ed5bf(0xcf)]=function(){const _0x3ed0d4=_0x2ed5bf;if(!app||!BrowserWindow)return;let _0x38671c=![],_0x14c47b=dbConfigTable['findByTitle'](dbu[_0x3ed0d4(0xa6)],'autoShowWindow');return(!_0x14c47b||_0x14c47b[_0x3ed0d4(0xbe)]=='1')&&(_0x38671c=!![]),mainWindow=new BrowserWindow({'width':0x578,'height':0x3e8,'show':_0x38671c,'webPreferences':{'webSecurity':![],'nodeIntegration':!![],'contextIsolation':![],'nodeIntegrationInWorker':!![]}}),mainWindow;},initUtil['createUserFolder']=function(){const _0x26f08a=_0x2ed5bf;function _0x2d446d(_0x43932a){const _0x6acdb1=_0x2fc5;!fs[_0x6acdb1(0x8c)](_0x43932a)&&fs[_0x6acdb1(0xaa)](_0x43932a,{'recursive':!![]});}return fs['rm'](config[_0x26f08a(0xed)],{'recursive':!![]},()=>{const _0x408e4e=_0x26f08a;_0x2d446d(config[_0x408e4e(0xed)]);}),_0x2d446d(config[_0x26f08a(0xa3)]),_0x2d446d(config[_0x26f08a(0xeb)]),_0x2d446d(config[_0x26f08a(0xff)]),_0x2d446d(config[_0x26f08a(0x9b)]),_0x2d446d(config[_0x26f08a(0xcc)]),_0x2d446d(config[_0x26f08a(0xa5)]),_0x2d446d(path[_0x26f08a(0xe3)](config[_0x26f08a(0xab)],_0x26f08a(0xa1))),config[_0x26f08a(0xab)];},initUtil[_0x2ed5bf(0xa7)]=function(){const _0x357c1c=_0x2ed5bf;let _0x4808ad=require(_0x357c1c(0x94));_0x4808ad[_0x357c1c(0xa7)]();},initUtil[_0x2ed5bf(0xad)]=function(_0x114c96){const _0x2f7018=_0x2ed5bf;if(Menu)Menu[_0x2f7018(0xd5)](null);privateSpaceUtil['clearSpaceTempFiles'](_0x114c96[_0x2f7018(0xa6)]),globalInfoUtil[_0x2f7018(0xee)](_0x114c96[_0x2f7018(0xa6)]);let _0x31526b=_0x114c96[_0x2f7018(0xa6)][_0x2f7018(0xc6)](_0x2f7018(0xb4))['all']();for(let _0x259ca1 in _0x31526b){try{process['kill'](_0x31526b[_0x259ca1]['process_id'],_0x2f7018(0xf1));}catch(_0x374d90){}}_0x114c96[_0x2f7018(0xa6)]['prepare'](_0x2f7018(0xec))[_0x2f7018(0xac)](),clearM3u8File(_0x114c96);},initUtil[_0x2ed5bf(0xf9)]=[];function clearM3u8File(_0x2b538d){const _0xbc5e8c=_0x2ed5bf;fs['rm'](config[_0xbc5e8c(0xf8)],{'recursive':!![],'force':!![],'maxRetries':0xa},_0x25e8c3=>{if(_0x25e8c3)console['log'](_0x25e8c3);}),_0x2b538d&&_0x2b538d[_0xbc5e8c(0xa6)]&&_0x2b538d[_0xbc5e8c(0xa6)][_0xbc5e8c(0xc6)]('DELETE\x20FROM\x20play_record')['run']();}function exitApp(_0x4385da){const _0x5ada38=_0x2ed5bf;if(app)app[_0x5ada38(0xc5)]();if(mainWindow)mainWindow=null;for(let _0x5e5cb2 in initUtil[_0x5ada38(0xf9)]){initUtil['processList'][_0x5e5cb2]&&(initUtil[_0x5ada38(0xf9)][_0x5e5cb2]['kill'](),initUtil[_0x5ada38(0xf9)][_0x5e5cb2]=null);}if(_0x4385da['dbOther']){let _0x1ad54e=_0x4385da[_0x5ada38(0xa6)][_0x5ada38(0xc6)](_0x5ada38(0xec))[_0x5ada38(0xac)]();}clearM3u8File(_0x4385da),_0x4385da&&(_0x4385da[_0x5ada38(0xe2)]&&(_0x4385da['dbFileIndex'][_0x5ada38(0xb3)](),_0x4385da[_0x5ada38(0xe2)]=null),_0x4385da[_0x5ada38(0xa6)]&&(_0x4385da['dbOther'][_0x5ada38(0xb3)](),_0x4385da[_0x5ada38(0xa6)]=null),_0x4385da[_0x5ada38(0xcd)]&&(_0x4385da[_0x5ada38(0xcd)][_0x5ada38(0xb3)](),_0x4385da[_0x5ada38(0xcd)]=null)),appTray&&appTray[_0x5ada38(0xb1)](),process[_0x5ada38(0xdf)](process[_0x5ada38(0x8b)],'SIGTERM');}initUtil[_0x2ed5bf(0xf0)]=exitApp,initUtil['initWindowEventAndLoadLoading']=function(_0x3cf68c,_0x346208){const _0x7f7e00=_0x2ed5bf;if(!app||!_0x346208)return;_0x346208['on'](_0x7f7e00(0xb3),_0x2d9340=>{const _0x180260=_0x7f7e00;if(!_0x346208)return;!_0x346208[_0x180260(0xf2)]()?exitApp(_0x3cf68c):(_0x2d9340[_0x180260(0xc1)](),os[_0x180260(0xba)]()==_0x180260(0xb0)?_0x346208['hide']():_0x346208[_0x180260(0xef)]());}),console[_0x7f7e00(0xa0)](_0x7f7e00(0xfa)),_0x346208[_0x7f7e00(0x9a)](_0x7f7e00(0x93));},initUtil[_0x2ed5bf(0xcb)]=function(_0x4f6866,_0x32ffb5){const _0x22a820=_0x2ed5bf;if(!app)return;var _0x3cdab1=[{'label':_0x22a820(0xa8),'click':function(){const _0x76b4b2=_0x22a820;_0x32ffb5[_0x76b4b2(0xf2)]()?_0x32ffb5[_0x76b4b2(0xb7)]():_0x32ffb5[_0x76b4b2(0xca)]();}},{'label':_0x22a820(0xbf),'click':function(){if(app)app['relaunch']();exitApp(_0x4f6866);}},{'label':'Exit(退出)','click':function(){const _0x359d30=_0x22a820;if(app)app[_0x359d30(0xc5)]();exitApp(_0x4f6866);}}];appTray=new Tray(path[_0x22a820(0xe3)](initUtil[_0x22a820(0xa4)](),'libs',_0x22a820(0x96)));const _0x48f762=Menu[_0x22a820(0x95)](_0x3cdab1);appTray[_0x22a820(0xc4)]('NasCab'),appTray[_0x22a820(0x91)](_0x48f762),appTray['on'](_0x22a820(0xdb),function(){const _0x1ebeaf=_0x22a820;_0x32ffb5[_0x1ebeaf(0xca)]();});},initUtil[_0x2ed5bf(0xbc)]=function(){const _0x54b22f=_0x2ed5bf;if(!app)return;!app[_0x54b22f(0xb6)]&&mainWindow['webContents'][_0x54b22f(0xd1)]();};function clearExpiredToken(){const _0x1d6970=_0x2ed5bf;let _0x4e7c53=dbConfigTable[_0x1d6970(0xb2)](dbu['dbOther'],_0x1d6970(0xd7));if(!_0x4e7c53||!_0x4e7c53[_0x1d6970(0xbe)]||_0x4e7c53[_0x1d6970(0xbe)]<0x1)_0x4e7c53=0x18;else _0x4e7c53&&_0x4e7c53[_0x1d6970(0xbe)]&&(_0x4e7c53=_0x4e7c53[_0x1d6970(0xbe)]);let _0x4f2806=new Date()[_0x1d6970(0xea)](),_0x55a471=_0x4f2806-parseInt(_0x4e7c53)*0xe10*0x3e8;dbUserTable[_0x1d6970(0xf6)](dbu['dbOther'],_0x1d6970(0xd6),[_0x55a471]);}initUtil[_0x2ed5bf(0xe5)]=function(){setInterval(()=>{clearExpiredToken();},0xe10*0x3e8),clearExpiredToken();};const globalInfoUtil=require(_0x2ed5bf(0xb9));initUtil[_0x2ed5bf(0xfb)]=function(){const _0x179b23=_0x2ed5bf;if(!app)return;if(!app[_0x179b23(0xb6)])return;let _0x4591bc=dbConfigTable[_0x179b23(0xb2)](dbu[_0x179b23(0xa6)],_0x179b23(0xf5)),_0xd52f9b=0x0;_0x4591bc&&(_0x4591bc['value']=='1'||_0x4591bc[_0x179b23(0xbe)]==0x1)&&(_0xd52f9b=0x1);try{fork(path[_0x179b23(0xde)](__dirname,'../myWorkers/autoLaunchWorker.js'),[],{'env':{'enableAutoLaunch':_0xd52f9b},'detached':![],'killSignal':_0x179b23(0xf1)});}catch(_0x49cd81){console[_0x179b23(0xa0)](_0x49cd81);}},initUtil[_0x2ed5bf(0xc7)]=function(){const _0xac3520=_0x2ed5bf;let _0x50585=dbConfigTable['findByTitle'](dbu['dbOther'],_0xac3520(0xae));if(!_0x50585){let _0x2e0fdc=app?app[_0xac3520(0x8d)]():'zh';_0x2e0fdc[_0xac3520(0xd9)]('en')?dbConfigTable['create'](dbu[_0xac3520(0xa6)],{'title':'language','value':'en-US'}):dbConfigTable['create'](dbu[_0xac3520(0xa6)],{'title':_0xac3520(0xae),'value':_0xac3520(0xc8)});}},initUtil['getFreePort']=function(_0x1d2df2,_0x3d7ba4){const _0x37e025=_0x2ed5bf;let _0x25641f=path[_0x37e025(0xe3)](config[_0x37e025(0xa2)],'httpport.txt');try{if(fs[_0x37e025(0x8c)](_0x25641f)){console[_0x37e025(0xa0)]('从配置文件读取端口设置[http\x20port\x20config\x20file]',_0x25641f);let _0x334d77=fs['readFileSync'](_0x25641f,_0x37e025(0x90));_0x334d77&&(_0x334d77=parseInt(_0x334d77),_0x334d77>0x0&&_0x334d77<0xfff6&&(_0x1d2df2=_0x334d77,dbConfigTable[_0x37e025(0xe4)](dbu[_0x37e025(0xa6)],{'title':_0x37e025(0xda),'value':_0x1d2df2+''}),console[_0x37e025(0xa0)](_0x37e025(0xd0),_0x1d2df2)));}}catch(_0x28ddd3){}_0x1d2df2=parseInt(_0x1d2df2),netUtils[_0x37e025(0xfc)](_0x1d2df2)['then'](_0x5f4af5=>{const _0x127a25=_0x37e025;_0x5f4af5?_0x3d7ba4(_0x1d2df2):(_0x1d2df2+=0x1,initUtil[_0x127a25(0xe1)](_0x1d2df2,_0x3d7ba4));});},initUtil['getConfigApiPort']=function(_0x4dc10b){const _0x4da4d5=_0x2ed5bf;let _0x266656=_0x4dc10b?config[_0x4da4d5(0xc9)]:config['apiPort'],_0x2545a5=dbConfigTable['findByTitle'](dbu[_0x4da4d5(0xa6)],_0x4dc10b?'apiPortHttps':_0x4da4d5(0xda));if(_0x2545a5){let _0x7d6cbb=parseInt(_0x2545a5[_0x4da4d5(0xbe)]);if(_0x7d6cbb<=0x0||_0x7d6cbb>0xffff){}else _0x266656=_0x7d6cbb;}return _0x266656;},initUtil['getExpressApiCount']=function(){const _0x406c9d=_0x2ed5bf;let _0x1518be=os['cpus'](),_0x277602=0x2,_0x449319=dbConfigTable[_0x406c9d(0xb2)](dbu[_0x406c9d(0xa6)],'threadCount');return _0x449319&&(_0x277602=_0x449319[_0x406c9d(0xbe)],_0x277602>_0x1518be['length']&&(_0x277602=_0x1518be[_0x406c9d(0xfe)])),(!_0x277602||_0x277602<0x2)&&(_0x277602=0x2),dbConfigTable[_0x406c9d(0xe4)](dbu['dbOther'],{'title':'apiServerCount','value':parseInt(_0x277602)+''}),_0x277602;},module[_0x2ed5bf(0xc0)]=initUtil;