const _0x5cb124=_0x43fe;(function(_0x1c23e8,_0x26977f){const _0x233af3=_0x43fe,_0x5c154c=_0x1c23e8();while(!![]){try{const _0x25d83f=parseInt(_0x233af3(0x123))/0x1+-parseInt(_0x233af3(0x114))/0x2*(-parseInt(_0x233af3(0xda))/0x3)+parseInt(_0x233af3(0x139))/0x4+-parseInt(_0x233af3(0x12f))/0x5+parseInt(_0x233af3(0xd0))/0x6*(parseInt(_0x233af3(0x10f))/0x7)+-parseInt(_0x233af3(0x106))/0x8+-parseInt(_0x233af3(0x116))/0x9;if(_0x25d83f===_0x26977f)break;else _0x5c154c['push'](_0x5c154c['shift']());}catch(_0x72c990){_0x5c154c['push'](_0x5c154c['shift']());}}}(_0x5d73,0xed96f));let app,BrowserWindow,Menu,Tray,protocol,ipcMain;try{let elec=require(_0x5cb124(0x144));app=elec[_0x5cb124(0xd5)],BrowserWindow=elec['BrowserWindow'],Menu=elec['Menu'],Tray=elec[_0x5cb124(0xd4)],protocol=elec['protocol'],ipcMain=elec[_0x5cb124(0x111)];}catch(_0x30b051){console[_0x5cb124(0x13d)]('Clientless\x20service\x20mode');}const {fork}=require(_0x5cb124(0xf7));let path=require(_0x5cb124(0x115)),fs=require('fs'),os=require('os'),initUtil={},privateSpaceUtil=require('../express-server/utils/privateSpaceUtils'),dbConfigTable=require(_0x5cb124(0x12c)),dbu='',mainWindow='';const config=require(_0x5cb124(0x10d));let netUtils=require(_0x5cb124(0xf3)),appTray;const dbUserTable=require('../db/dbUserTable'),dbSourceFolderTable=require('../db/dbSourceFolderTable'),dbScanTaskTable=require(_0x5cb124(0x142));initUtil[_0x5cb124(0x109)]=function(_0x510863){},initUtil[_0x5cb124(0xfd)]=function(){const _0x1d6e55=_0x5cb124;let _0x2bd915='';return app&&app[_0x1d6e55(0x101)]?(_0x2bd915=path[_0x1d6e55(0x135)](app[_0x1d6e55(0xff)]('exe')),os['platform']()==_0x1d6e55(0x131)&&(_0x2bd915=path[_0x1d6e55(0x135)](_0x2bd915))):_0x2bd915=path[_0x1d6e55(0x11f)](__dirname,_0x1d6e55(0x13a)),_0x2bd915;},initUtil[_0x5cb124(0xe9)]=function(){var _0x1e57f9=require('../db/dbUtil');return dbu=new _0x1e57f9(),dbu;},initUtil[_0x5cb124(0x118)]=function(_0x4f7011){const _0x45d1e7=_0x5cb124;let _0x1b95b3=dbSourceFolderTable[_0x45d1e7(0xe5)](_0x4f7011);for(let _0x149521 of _0x1b95b3){_0x149521[_0x45d1e7(0x140)]==0x1&&dbScanTaskTable['addScanTask'](_0x4f7011,_0x149521[_0x45d1e7(0x104)],_0x149521['path']);}},initUtil[_0x5cb124(0x121)]=function(_0xd28517,_0x1d022a){const _0x5b668b=_0x5cb124;_0xd28517[_0x5b668b(0x103)](_0x5b668b(0xf9))['run'](_0x1d022a+'');},initUtil[_0x5cb124(0x120)]=function(){const _0x2451d1=_0x5cb124;if(!app||!BrowserWindow)return;let _0x4119d2=![],_0xcbba78=dbConfigTable[_0x2451d1(0x108)](dbu[_0x2451d1(0xfa)],_0x2451d1(0x132));return(!_0xcbba78||_0xcbba78['value']=='1')&&(_0x4119d2=!![]),mainWindow=new BrowserWindow({'width':0x578,'height':0x3e8,'show':_0x4119d2,'webPreferences':{'webSecurity':![],'nodeIntegration':!![],'contextIsolation':![],'nodeIntegrationInWorker':!![]}}),mainWindow;},initUtil[_0x5cb124(0x145)]=function(){const _0x273935=_0x5cb124;function _0x135de0(_0x5ba428){const _0x31e323=_0x43fe;!fs['existsSync'](_0x5ba428)&&fs[_0x31e323(0xdb)](_0x5ba428,{'recursive':!![]});}return fs['rm'](config[_0x273935(0xfc)],{'recursive':!![]},()=>{const _0xf599e=_0x273935;_0x135de0(config[_0xf599e(0xfc)]);}),_0x135de0(config[_0x273935(0xed)]),_0x135de0(config[_0x273935(0xd8)]),_0x135de0(config['musicCoverPath']),_0x135de0(config['facesPath']),_0x135de0(config[_0x273935(0x128)]),_0x135de0(config[_0x273935(0x10a)]),_0x135de0(path[_0x273935(0x11f)](config[_0x273935(0x110)],_0x273935(0x126))),config[_0x273935(0x110)];},initUtil['startUpdate']=function(){const _0x22adde=_0x5cb124;let _0x2fb0e2=require(_0x22adde(0x122));_0x2fb0e2[_0x22adde(0x13b)]();},initUtil[_0x5cb124(0x12d)]=function(_0x12f207){const _0x256674=_0x5cb124;if(Menu)Menu[_0x256674(0xf5)](null);privateSpaceUtil[_0x256674(0x125)](_0x12f207[_0x256674(0xfa)]),globalInfoUtil[_0x256674(0x102)](_0x12f207[_0x256674(0xfa)]);let _0x24f34f=_0x12f207[_0x256674(0xfa)][_0x256674(0x103)](_0x256674(0x100))[_0x256674(0x13e)]();for(let _0x18671f in _0x24f34f){try{process[_0x256674(0xe0)](_0x24f34f[_0x18671f][_0x256674(0x107)],'SIGTERM');}catch(_0x77877a){}}_0x12f207[_0x256674(0xfa)]['prepare'](_0x256674(0xe6))[_0x256674(0x133)](),clearM3u8File(_0x12f207);},initUtil[_0x5cb124(0xf0)]=[];function clearM3u8File(_0x378c0a){const _0x424094=_0x5cb124;fs['rm'](config['m3u8TmpPath'],{'recursive':!![],'force':!![],'maxRetries':0xa},_0x112fa4=>{const _0x581d9d=_0x43fe;if(_0x112fa4)console[_0x581d9d(0x13d)](_0x112fa4);}),_0x378c0a&&_0x378c0a[_0x424094(0xfa)]&&_0x378c0a[_0x424094(0xfa)][_0x424094(0x103)]('DELETE\x20FROM\x20play_record')[_0x424094(0x133)]();}function exitApp(_0x2754e6){const _0x40746a=_0x5cb124;if(app)app['quit']();if(mainWindow)mainWindow=null;for(let _0x57bb33 in initUtil['processList']){initUtil[_0x40746a(0xf0)][_0x57bb33]&&(initUtil[_0x40746a(0xf0)][_0x57bb33][_0x40746a(0xe0)](),initUtil[_0x40746a(0xf0)][_0x57bb33]=null);}if(_0x2754e6[_0x40746a(0xfa)]){let _0x4456e1=_0x2754e6[_0x40746a(0xfa)][_0x40746a(0x103)]('DELETE\x20FROM\x20process_record\x20WHERE\x201=1')[_0x40746a(0x133)]();}clearM3u8File(_0x2754e6),_0x2754e6&&(_0x2754e6['dbFileIndex']&&(_0x2754e6[_0x40746a(0x10c)]['close'](),_0x2754e6['dbFileIndex']=null),_0x2754e6[_0x40746a(0xfa)]&&(_0x2754e6[_0x40746a(0xfa)][_0x40746a(0xee)](),_0x2754e6[_0x40746a(0xfa)]=null),_0x2754e6[_0x40746a(0x11c)]&&(_0x2754e6[_0x40746a(0x11c)][_0x40746a(0xee)](),_0x2754e6['dbCity']=null)),appTray&&appTray[_0x40746a(0x124)](),process['kill'](process[_0x40746a(0x134)],'SIGTERM');}initUtil[_0x5cb124(0xd9)]=exitApp,initUtil['initWindowEventAndLoadLoading']=function(_0x53d348,_0x5e9a80){const _0x582951=_0x5cb124;if(!app||!_0x5e9a80)return;_0x5e9a80['on'](_0x582951(0xee),_0x5402db=>{const _0x4055e1=_0x582951;if(!_0x5e9a80)return;!_0x5e9a80['isVisible']()?exitApp(_0x53d348):(_0x5402db[_0x4055e1(0x129)](),os[_0x4055e1(0x11e)]()==_0x4055e1(0xea)?_0x5e9a80[_0x4055e1(0xf2)]():_0x5e9a80[_0x4055e1(0xe1)]());}),console[_0x582951(0x13d)](_0x582951(0xf6)),_0x5e9a80[_0x582951(0xe2)](_0x582951(0xd7));},initUtil[_0x5cb124(0x137)]=function(_0x6e3eae,_0x1dac73){const _0x35dc03=_0x5cb124;if(!app)return;var _0x4a8011=[{'label':_0x35dc03(0x13f),'click':function(){const _0x481847=_0x35dc03;_0x1dac73[_0x481847(0x11b)]()?_0x1dac73[_0x481847(0xf2)]():_0x1dac73[_0x481847(0xe4)]();}},{'label':_0x35dc03(0xfe),'click':function(){const _0x5f3df7=_0x35dc03;if(app)app[_0x5f3df7(0x117)]();exitApp(_0x6e3eae);}},{'label':_0x35dc03(0xec),'click':function(){if(app)app['quit']();exitApp(_0x6e3eae);}}];appTray=new Tray(path[_0x35dc03(0x11f)](initUtil[_0x35dc03(0xfd)](),'libs',_0x35dc03(0xd6)));const _0x281788=Menu[_0x35dc03(0xf8)](_0x4a8011);appTray[_0x35dc03(0x11a)]('NasCab'),appTray[_0x35dc03(0xf1)](_0x281788),appTray['on']('click',function(){const _0x4c1c9e=_0x35dc03;_0x1dac73[_0x4c1c9e(0xe4)]();});},initUtil['openDev']=function(){const _0x388ae3=_0x5cb124;if(!app)return;!app['isPackaged']&&mainWindow['webContents'][_0x388ae3(0xd1)]();};function clearExpiredToken(){const _0x43e55a=_0x5cb124;let _0x52343c=dbConfigTable[_0x43e55a(0x108)](dbu[_0x43e55a(0xfa)],_0x43e55a(0x12b));if(!_0x52343c||!_0x52343c[_0x43e55a(0x138)]||_0x52343c[_0x43e55a(0x138)]<0x1)_0x52343c=0x18;else _0x52343c&&_0x52343c[_0x43e55a(0x138)]&&(_0x52343c=_0x52343c[_0x43e55a(0x138)]);let _0x52441f=new Date()[_0x43e55a(0x143)](),_0x389ad2=_0x52441f-parseInt(_0x52343c)*0xe10*0x3e8;dbUserTable['deleteUserTokenByWhere'](dbu['dbOther'],'\x20WHERE\x20last_login_time\x20<?',[_0x389ad2]);}initUtil[_0x5cb124(0xef)]=function(){setInterval(()=>{clearExpiredToken();},0xe10*0x3e8),clearExpiredToken();};const globalInfoUtil=require('./globalInfoUtil');function _0x43fe(_0xbb65b,_0x260021){const _0x5d735d=_0x5d73();return _0x43fe=function(_0x43fe3b,_0x21502b){_0x43fe3b=_0x43fe3b-0xd0;let _0x525b5a=_0x5d735d[_0x43fe3b];return _0x525b5a;},_0x43fe(_0xbb65b,_0x260021);}function _0x5d73(){const _0x33a8a3=['从配置文件读取端口设置[http\x20port\x20config\x20file]','darwin','autoShowWindow','run','pid','dirname','startsWith','initTray','value','7271832IQcxpl','../../','startUpdate','threadCount','log','all','Show/Hide','scan_when_start','length','../db/dbScanTaskTable','getTime','electron','createUserFolder','appRootPath','6WLSOFf','openDevTools','readFileSync','getConfigApiPort','Tray','app','logo-tray.png','loading/loading.html','posterPath','exitApp','21JpJtMm','mkdirSync','apiPort','resolve','Using\x20file\x20config\x20port','SIGTERM','kill','minimize','loadFile','httpport.txt','show','getAll','DELETE\x20FROM\x20process_record\x20WHERE\x201=1','language','getFreePort','initDbu','win32','getExpressApiCount','Exit(退出)','cachePath','close','expireTokenOnTime','processList','setContextMenu','hide','../express-server/utils/netUtils','exports','setApplicationMenu','Loading...','child_process','buildFromTemplate','REPLACE\x20INTO\x20process_record(process_id)\x20VALUES(?)','dbOther','cpus','tempFilePath','getRootPath','Restart(重启应用)','getPath','SELECT\x20*\x20FROM\x20process_record','isPackaged','getUpdateInfo','prepare','type','create','3761264sJpdrn','process_id','findByTitle','runNewVersionTask','subtitleUploadPath','existsSync','dbFileIndex','../myConfig/config','getLocale','11890165Bkujlj','userDataFolder','ipcMain','utf-8','apiServerCount','437086Qanlky','path','39207654TIvsIw','relaunch','addScanTaskWhenStart','zh-CN','setToolTip','isVisible','dbCity','isPortFree','platform','join','createMainWindow','addProcessRecord','../utils/updateUtil','1356008PQMBgN','destroy','clearSpaceTempFiles','database','launchWithSys','subtitlePath','preventDefault','setLanguage','tokenKeepHour','../db/dbConfigTable','init','then','3013155OpSaEa'];_0x5d73=function(){return _0x33a8a3;};return _0x5d73();}initUtil[_0x5cb124(0x127)]=function(){const _0x4e58f7=_0x5cb124;if(!app)return;if(!app[_0x4e58f7(0x101)])return;let _0x27ee73=dbConfigTable['findByTitle'](dbu['dbOther'],'autoLaunch'),_0x965904=0x0;_0x27ee73&&(_0x27ee73[_0x4e58f7(0x138)]=='1'||_0x27ee73['value']==0x1)&&(_0x965904=0x1);try{fork(path[_0x4e58f7(0xdd)](__dirname,'../myWorkers/autoLaunchWorker.js'),[],{'env':{'enableAutoLaunch':_0x965904},'detached':![],'killSignal':_0x4e58f7(0xdf)});}catch(_0x6382ff){console[_0x4e58f7(0x13d)](_0x6382ff);}},initUtil[_0x5cb124(0x12a)]=function(){const _0x26631f=_0x5cb124;let _0x4d3340=dbConfigTable[_0x26631f(0x108)](dbu[_0x26631f(0xfa)],_0x26631f(0xe7));if(!_0x4d3340){let _0xb630b4=app?app[_0x26631f(0x10e)]():'zh';_0xb630b4[_0x26631f(0x136)]('en')?dbConfigTable[_0x26631f(0x105)](dbu[_0x26631f(0xfa)],{'title':_0x26631f(0xe7),'value':'en-US'}):dbConfigTable[_0x26631f(0x105)](dbu[_0x26631f(0xfa)],{'title':'language','value':_0x26631f(0x119)});}},initUtil[_0x5cb124(0xe8)]=function(_0xe8030f,_0x5c67d9){const _0x7e643f=_0x5cb124;let _0x4d30ac=path[_0x7e643f(0x11f)](config[_0x7e643f(0x146)],_0x7e643f(0xe3));try{if(fs[_0x7e643f(0x10b)](_0x4d30ac)){console[_0x7e643f(0x13d)](_0x7e643f(0x130),_0x4d30ac);let _0x25a559=fs[_0x7e643f(0xd2)](_0x4d30ac,_0x7e643f(0x112));_0x25a559&&(_0x25a559=parseInt(_0x25a559),_0x25a559>0x0&&_0x25a559<0xfff6&&(_0xe8030f=_0x25a559,dbConfigTable[_0x7e643f(0x105)](dbu[_0x7e643f(0xfa)],{'title':_0x7e643f(0xdc),'value':_0xe8030f+''}),console[_0x7e643f(0x13d)](_0x7e643f(0xde),_0xe8030f)));}}catch(_0x5e9909){}_0xe8030f=parseInt(_0xe8030f),netUtils[_0x7e643f(0x11d)](_0xe8030f)[_0x7e643f(0x12e)](_0x1c44cb=>{const _0x1b3073=_0x7e643f;_0x1c44cb?_0x5c67d9(_0xe8030f):(_0xe8030f+=0x1,initUtil[_0x1b3073(0xe8)](_0xe8030f,_0x5c67d9));});},initUtil[_0x5cb124(0xd3)]=function(_0x178639){const _0x526f6c=_0x5cb124;let _0x4e09a9=_0x178639?config['apiPortHttps']:config[_0x526f6c(0xdc)],_0x2e7919=dbConfigTable['findByTitle'](dbu['dbOther'],_0x178639?'apiPortHttps':_0x526f6c(0xdc));if(_0x2e7919){let _0x46032b=parseInt(_0x2e7919[_0x526f6c(0x138)]);if(_0x46032b<=0x0||_0x46032b>0xffff){}else _0x4e09a9=_0x46032b;}return _0x4e09a9;},initUtil[_0x5cb124(0xeb)]=function(){const _0x481ac1=_0x5cb124;let _0x1b5290=os[_0x481ac1(0xfb)](),_0x2e08aa=0x2,_0x3c4a14=dbConfigTable[_0x481ac1(0x108)](dbu['dbOther'],_0x481ac1(0x13c));return _0x3c4a14&&(_0x2e08aa=_0x3c4a14[_0x481ac1(0x138)],_0x2e08aa>_0x1b5290[_0x481ac1(0x141)]&&(_0x2e08aa=_0x1b5290[_0x481ac1(0x141)])),(!_0x2e08aa||_0x2e08aa<0x2)&&(_0x2e08aa=0x2),dbConfigTable[_0x481ac1(0x105)](dbu['dbOther'],{'title':_0x481ac1(0x113),'value':parseInt(_0x2e08aa)+''}),_0x2e08aa;},module[_0x5cb124(0xf4)]=initUtil;