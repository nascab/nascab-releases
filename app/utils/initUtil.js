const _0x4c62c5=_0x1da7;(function(_0x3cff12,_0x3e87b3){const _0xa846c1=_0x1da7,_0x4f26a2=_0x3cff12();while(!![]){try{const _0x423f08=-parseInt(_0xa846c1(0xe6))/0x1+parseInt(_0xa846c1(0xea))/0x2*(-parseInt(_0xa846c1(0x129))/0x3)+-parseInt(_0xa846c1(0x141))/0x4+parseInt(_0xa846c1(0x14c))/0x5+parseInt(_0xa846c1(0x12a))/0x6*(parseInt(_0xa846c1(0x14b))/0x7)+parseInt(_0xa846c1(0xe5))/0x8*(-parseInt(_0xa846c1(0x10a))/0x9)+parseInt(_0xa846c1(0x11f))/0xa;if(_0x423f08===_0x3e87b3)break;else _0x4f26a2['push'](_0x4f26a2['shift']());}catch(_0x49ce08){_0x4f26a2['push'](_0x4f26a2['shift']());}}}(_0x4e95,0xd6c66));let app,BrowserWindow,Menu,Tray,protocol,ipcMain;try{let elec=require(_0x4c62c5(0x10d));app=elec[_0x4c62c5(0x13e)],BrowserWindow=elec[_0x4c62c5(0x152)],Menu=elec[_0x4c62c5(0x105)],Tray=elec['Tray'],protocol=elec[_0x4c62c5(0x142)],ipcMain=elec['ipcMain'];}catch(_0x2eafc6){console[_0x4c62c5(0x10c)](_0x4c62c5(0xfc));}const {fork}=require('child_process');let path=require('path'),fs=require('fs'),os=require('os'),initUtil={},privateSpaceUtil=require(_0x4c62c5(0x12c)),dbConfigTable=require(_0x4c62c5(0x100)),dbu='',mainWindow='';const config=require(_0x4c62c5(0x123));let netUtils=require(_0x4c62c5(0x11e)),appTray;const dbUserTable=require(_0x4c62c5(0xe7)),dbSourceFolderTable=require(_0x4c62c5(0x153)),dbScanTaskTable=require(_0x4c62c5(0x13a));initUtil[_0x4c62c5(0x12f)]=function(_0x3523cb){},initUtil[_0x4c62c5(0x13f)]=function(){const _0xc1cb1d=_0x4c62c5;let _0x5869d9='';return app&&app[_0xc1cb1d(0xe9)]?(_0x5869d9=path[_0xc1cb1d(0xe1)](app[_0xc1cb1d(0x135)](_0xc1cb1d(0x103))),os['platform']()=='darwin'&&(_0x5869d9=path[_0xc1cb1d(0xe1)](_0x5869d9))):_0x5869d9=path[_0xc1cb1d(0x13b)](__dirname,_0xc1cb1d(0xe8)),_0x5869d9;},initUtil['initDbu']=function(){var _0x2f124e=require('../db/dbUtil');return dbu=new _0x2f124e(),dbu;},initUtil[_0x4c62c5(0x10b)]=function(_0x390af8){const _0x1dd4ac=_0x4c62c5;let _0x1f9e0b=dbSourceFolderTable[_0x1dd4ac(0xec)](_0x390af8);for(let _0x18a173 of _0x1f9e0b){_0x18a173['scan_when_start']==0x1&&dbScanTaskTable[_0x1dd4ac(0x14f)](_0x390af8,_0x18a173['type'],_0x18a173[_0x1dd4ac(0xf2)]);}},initUtil[_0x4c62c5(0xdd)]=function(_0x4cb4c7,_0x2c2f73){const _0x5f22cb=_0x4c62c5;_0x4cb4c7[_0x5f22cb(0xe0)](_0x5f22cb(0x126))[_0x5f22cb(0x106)](_0x2c2f73+'');},initUtil[_0x4c62c5(0x11b)]=function(){const _0x4fc1f3=_0x4c62c5;if(!app||!BrowserWindow)return;let _0x51114a=![],_0x204a3e=dbConfigTable[_0x4fc1f3(0x150)](dbu[_0x4fc1f3(0x143)],_0x4fc1f3(0x109));return(!_0x204a3e||_0x204a3e[_0x4fc1f3(0x11c)]=='1')&&(_0x51114a=!![]),mainWindow=new BrowserWindow({'width':0x578,'height':0x3e8,'show':_0x51114a,'webPreferences':{'webSecurity':![],'nodeIntegration':!![],'contextIsolation':![],'nodeIntegrationInWorker':!![]}}),mainWindow;},initUtil[_0x4c62c5(0xe4)]=function(){const _0x556e87=_0x4c62c5;function _0x34cebc(_0x8c1d09){const _0x1eec30=_0x1da7;!fs[_0x1eec30(0x14e)](_0x8c1d09)&&fs[_0x1eec30(0xf7)](_0x8c1d09,{'recursive':!![]});}return fs['rm'](config[_0x556e87(0x121)],{'recursive':!![]},()=>{const _0x3f332b=_0x556e87;_0x34cebc(config[_0x3f332b(0x121)]);}),fs['rm'](config[_0x556e87(0x140)],{'recursive':!![]},()=>{const _0x1a8f1b=_0x556e87;_0x34cebc(config[_0x1a8f1b(0x140)]);}),_0x34cebc(config[_0x556e87(0x11a)]),_0x34cebc(config['posterPath']),_0x34cebc(config[_0x556e87(0xee)]),_0x34cebc(config['facesPath']),_0x34cebc(config[_0x556e87(0xfd)]),_0x34cebc(config[_0x556e87(0x12e)]),_0x34cebc(path['join'](config[_0x556e87(0x144)],_0x556e87(0x122))),config[_0x556e87(0x144)];},initUtil['startUpdate']=function(){const _0xa6786a=_0x4c62c5;let _0x244b55=require(_0xa6786a(0x14d));_0x244b55[_0xa6786a(0xdf)]();},initUtil[_0x4c62c5(0x14a)]=function(_0x475be7){const _0x4104c8=_0x4c62c5;if(Menu)Menu[_0x4104c8(0xf5)](null);privateSpaceUtil[_0x4104c8(0x148)](_0x475be7[_0x4104c8(0x143)]),globalInfoUtil[_0x4104c8(0xfe)](_0x475be7[_0x4104c8(0x143)]);let _0x1fc327=_0x475be7[_0x4104c8(0x143)]['prepare']('SELECT\x20*\x20FROM\x20process_record')[_0x4104c8(0xf8)]();for(let _0x4a46c4 in _0x1fc327){try{process[_0x4104c8(0x120)](_0x1fc327[_0x4a46c4][_0x4104c8(0xf3)],_0x4104c8(0x104));}catch(_0x13c819){}}_0x475be7[_0x4104c8(0x143)][_0x4104c8(0xe0)](_0x4104c8(0xfb))[_0x4104c8(0x106)](),clearM3u8File(_0x475be7);},initUtil[_0x4c62c5(0xed)]=[];function clearM3u8File(_0x2a6314){const _0x48d5d4=_0x4c62c5;fs['rm'](config[_0x48d5d4(0x125)],{'recursive':!![],'force':!![],'maxRetries':0xa},_0x3ec9f4=>{const _0x25f374=_0x48d5d4;if(_0x3ec9f4)console[_0x25f374(0x10c)](_0x3ec9f4);}),_0x2a6314&&_0x2a6314[_0x48d5d4(0x143)]&&_0x2a6314[_0x48d5d4(0x143)][_0x48d5d4(0xe0)](_0x48d5d4(0x133))[_0x48d5d4(0x106)]();}function _0x1da7(_0x40a3fb,_0x4cfadb){const _0x4e9573=_0x4e95();return _0x1da7=function(_0x1da7ce,_0x56c5af){_0x1da7ce=_0x1da7ce-0xdd;let _0x3f1792=_0x4e9573[_0x1da7ce];return _0x3f1792;},_0x1da7(_0x40a3fb,_0x4cfadb);}function exitApp(_0x3b7f73){const _0x5984be=_0x4c62c5;if(app)app[_0x5984be(0x131)]();if(mainWindow)mainWindow=null;for(let _0x1c5581 in initUtil['processList']){initUtil[_0x5984be(0xed)][_0x1c5581]&&(initUtil[_0x5984be(0xed)][_0x1c5581][_0x5984be(0x120)](),initUtil[_0x5984be(0xed)][_0x1c5581]=null);}if(_0x3b7f73[_0x5984be(0x143)]){let _0xfd13f8=_0x3b7f73[_0x5984be(0x143)][_0x5984be(0xe0)]('DELETE\x20FROM\x20process_record\x20WHERE\x201=1')[_0x5984be(0x106)]();}clearM3u8File(_0x3b7f73),_0x3b7f73&&(_0x3b7f73[_0x5984be(0xde)]&&(_0x3b7f73[_0x5984be(0xde)][_0x5984be(0x13c)](),_0x3b7f73['dbFileIndex']=null),_0x3b7f73[_0x5984be(0x143)]&&(_0x3b7f73['dbOther']['close'](),_0x3b7f73[_0x5984be(0x143)]=null),_0x3b7f73[_0x5984be(0xf6)]&&(_0x3b7f73[_0x5984be(0xf6)][_0x5984be(0x13c)](),_0x3b7f73[_0x5984be(0xf6)]=null)),appTray&&appTray[_0x5984be(0x114)](),process['kill'](process['pid'],_0x5984be(0x104));}initUtil['exitApp']=exitApp,initUtil[_0x4c62c5(0x110)]=function(_0x5e74ca,_0x172413){const _0x542d69=_0x4c62c5;if(!app||!_0x172413)return;_0x172413['on'](_0x542d69(0x13c),_0x2b154c=>{const _0x185f59=_0x542d69;if(!_0x172413)return;!_0x172413[_0x185f59(0xfa)]()?exitApp(_0x5e74ca):(_0x2b154c[_0x185f59(0x149)](),os['platform']()=='win32'?_0x172413[_0x185f59(0x12b)]():_0x172413[_0x185f59(0x147)]());}),console[_0x542d69(0x10c)](_0x542d69(0xf9)),_0x172413[_0x542d69(0x124)]('loading/loading.html');},initUtil[_0x4c62c5(0x132)]=function(_0x137cea,_0x63f5b2){const _0x1a74b3=_0x4c62c5;if(!app)return;var _0x22055a=[{'label':_0x1a74b3(0x101),'click':function(){const _0x3f5b32=_0x1a74b3;_0x63f5b2['isVisible']()?_0x63f5b2[_0x3f5b32(0x12b)]():_0x63f5b2['show']();}},{'label':_0x1a74b3(0x115),'click':function(){const _0x2339c8=_0x1a74b3;if(app)app[_0x2339c8(0x111)]();exitApp(_0x137cea);}},{'label':'Exit(退出)','click':function(){const _0xe097ad=_0x1a74b3;if(app)app[_0xe097ad(0x131)]();exitApp(_0x137cea);}}];appTray=new Tray(path[_0x1a74b3(0x13b)](initUtil[_0x1a74b3(0x13f)](),'libs',_0x1a74b3(0xf1)));const _0x271757=Menu['buildFromTemplate'](_0x22055a);appTray[_0x1a74b3(0x146)](_0x1a74b3(0xf4)),appTray['setContextMenu'](_0x271757),appTray['on']('click',function(){const _0xa47172=_0x1a74b3;_0x63f5b2[_0xa47172(0x108)]();});},initUtil[_0x4c62c5(0x107)]=function(){const _0x54a223=_0x4c62c5;if(!app)return;!app[_0x54a223(0xe9)]&&mainWindow[_0x54a223(0x13d)][_0x54a223(0xe3)]();};function clearExpiredToken(){const _0x2e9c07=_0x4c62c5;let _0x5144fe=dbConfigTable[_0x2e9c07(0x150)](dbu[_0x2e9c07(0x143)],_0x2e9c07(0x10f));if(!_0x5144fe||!_0x5144fe[_0x2e9c07(0x11c)]||_0x5144fe[_0x2e9c07(0x11c)]<0x1)_0x5144fe=0x18;else _0x5144fe&&_0x5144fe[_0x2e9c07(0x11c)]&&(_0x5144fe=_0x5144fe[_0x2e9c07(0x11c)]);let _0x2b0546=new Date()[_0x2e9c07(0x112)](),_0x394a36=_0x2b0546-parseInt(_0x5144fe)*0xe10*0x3e8;dbUserTable[_0x2e9c07(0x139)](dbu[_0x2e9c07(0x143)],_0x2e9c07(0xef),[_0x394a36]);}initUtil[_0x4c62c5(0xf0)]=function(){setInterval(()=>{clearExpiredToken();},0xe10*0x3e8),clearExpiredToken();};const globalInfoUtil=require(_0x4c62c5(0x127));function _0x4e95(){const _0xb0fd07=['appRootPath','cachePath','createMainWindow','value','create','../express-server/utils/netUtils','13464260NkvPFY','kill','tempFilePath','database','../myConfig/config','loadFile','m3u8TmpPath','REPLACE\x20INTO\x20process_record(process_id)\x20VALUES(?)','./globalInfoUtil','isPortFree','17559PuomJr','9780FnGOAK','hide','../express-server/utils/privateSpaceUtils','apiPort','subtitleUploadPath','runNewVersionTask','setLanguage','quit','initTray','DELETE\x20FROM\x20play_record','getLocale','getPath','从配置文件读取端口设置[http\x20port\x20config\x20file]','resolve','zh-CN','deleteUserTokenByWhere','../db/dbScanTaskTable','join','close','webContents','app','getRootPath','tempMediaToolsUpload','5850696gBcSxW','protocol','dbOther','userDataFolder','../myWorkers/autoLaunchWorker.js','setToolTip','minimize','clearSpaceTempFiles','preventDefault','init','5558bnCpig','8017340jIdPTn','../utils/updateUtil','existsSync','addScanTask','findByTitle','cpus','BrowserWindow','../db/dbSourceFolderTable','addProcessRecord','dbFileIndex','startUpdate','prepare','dirname','Using\x20file\x20config\x20port','openDevTools','createUserFolder','488xjtKhy','321858plLUjt','../db/dbUserTable','../../','isPackaged','146IGbiEQ','startsWith','getAll','processList','musicCoverPath','\x20WHERE\x20last_login_time\x20<?','expireTokenOnTime','logo-tray.png','path','process_id','NasCab','setApplicationMenu','dbCity','mkdirSync','all','Loading...','isVisible','DELETE\x20FROM\x20process_record\x20WHERE\x201=1','Clientless\x20service\x20mode','subtitlePath','getUpdateInfo','threadCount','../db/dbConfigTable','Show/Hide','launchWithSys','exe','SIGTERM','Menu','run','openDev','show','autoShowWindow','170055xEfVcN','addScanTaskWhenStart','log','electron','length','tokenKeepHour','initWindowEventAndLoadLoading','relaunch','getTime','en-US','destroy','Restart(重启应用)','apiPortHttps','language','autoLaunch'];_0x4e95=function(){return _0xb0fd07;};return _0x4e95();}initUtil[_0x4c62c5(0x102)]=function(){const _0x31ac09=_0x4c62c5;if(!app)return;if(!app[_0x31ac09(0xe9)])return;let _0x5606fa=dbConfigTable[_0x31ac09(0x150)](dbu[_0x31ac09(0x143)],_0x31ac09(0x118)),_0x5652a5=0x0;_0x5606fa&&(_0x5606fa[_0x31ac09(0x11c)]=='1'||_0x5606fa[_0x31ac09(0x11c)]==0x1)&&(_0x5652a5=0x1);try{fork(path[_0x31ac09(0x137)](__dirname,_0x31ac09(0x145)),[],{'env':{'enableAutoLaunch':_0x5652a5},'detached':![],'killSignal':_0x31ac09(0x104)});}catch(_0x3d4f5d){console['log'](_0x3d4f5d);}},initUtil[_0x4c62c5(0x130)]=function(){const _0x473ca6=_0x4c62c5;let _0xabe625=dbConfigTable[_0x473ca6(0x150)](dbu[_0x473ca6(0x143)],_0x473ca6(0x117));if(!_0xabe625){let _0xf005ac=app?app[_0x473ca6(0x134)]():'zh';_0xf005ac[_0x473ca6(0xeb)]('en')?dbConfigTable[_0x473ca6(0x11d)](dbu['dbOther'],{'title':_0x473ca6(0x117),'value':_0x473ca6(0x113)}):dbConfigTable[_0x473ca6(0x11d)](dbu[_0x473ca6(0x143)],{'title':_0x473ca6(0x117),'value':_0x473ca6(0x138)});}},initUtil['getFreePort']=function(_0x29cdb3,_0x33bcf7){const _0x4d0aed=_0x4c62c5;let _0x1ffe5f=path[_0x4d0aed(0x13b)](config[_0x4d0aed(0x119)],'httpport.txt');try{if(fs[_0x4d0aed(0x14e)](_0x1ffe5f)){console[_0x4d0aed(0x10c)](_0x4d0aed(0x136),_0x1ffe5f);let _0x49ab84=fs['readFileSync'](_0x1ffe5f,'utf-8');_0x49ab84&&(_0x49ab84=parseInt(_0x49ab84),_0x49ab84>0x0&&_0x49ab84<0xfff6&&(_0x29cdb3=_0x49ab84,dbConfigTable[_0x4d0aed(0x11d)](dbu[_0x4d0aed(0x143)],{'title':_0x4d0aed(0x12d),'value':_0x29cdb3+''}),console[_0x4d0aed(0x10c)](_0x4d0aed(0xe2),_0x29cdb3)));}}catch(_0x2b925c){}_0x29cdb3=parseInt(_0x29cdb3),netUtils[_0x4d0aed(0x128)](_0x29cdb3)['then'](_0x50fd9a=>{_0x50fd9a?_0x33bcf7(_0x29cdb3):(_0x29cdb3+=0x1,initUtil['getFreePort'](_0x29cdb3,_0x33bcf7));});},initUtil['getConfigApiPort']=function(_0x1c8bb6){const _0x2b1b4d=_0x4c62c5;let _0x3f5b37=_0x1c8bb6?config[_0x2b1b4d(0x116)]:config['apiPort'],_0x1fd3b2=dbConfigTable[_0x2b1b4d(0x150)](dbu[_0x2b1b4d(0x143)],_0x1c8bb6?_0x2b1b4d(0x116):_0x2b1b4d(0x12d));if(_0x1fd3b2){let _0x4b059b=parseInt(_0x1fd3b2[_0x2b1b4d(0x11c)]);if(_0x4b059b<=0x0||_0x4b059b>0xffff){}else _0x3f5b37=_0x4b059b;}return _0x3f5b37;},initUtil['getExpressApiCount']=function(){const _0x5b6954=_0x4c62c5;let _0x56d2d0=os[_0x5b6954(0x151)](),_0x51862b=0x2,_0x4d6b8c=dbConfigTable[_0x5b6954(0x150)](dbu['dbOther'],_0x5b6954(0xff));return _0x4d6b8c&&(_0x51862b=_0x4d6b8c[_0x5b6954(0x11c)],_0x51862b>_0x56d2d0[_0x5b6954(0x10e)]&&(_0x51862b=_0x56d2d0[_0x5b6954(0x10e)])),(!_0x51862b||_0x51862b<0x2)&&(_0x51862b=0x2),dbConfigTable['create'](dbu[_0x5b6954(0x143)],{'title':'apiServerCount','value':parseInt(_0x51862b)+''}),_0x51862b;},module['exports']=initUtil;