const _0x5aced6=_0xbd68;(function(_0x1d2b1e,_0x13afe0){const _0x17ac4c=_0xbd68,_0x22e55e=_0x1d2b1e();while(!![]){try{const _0x570b49=parseInt(_0x17ac4c(0x1a0))/0x1+-parseInt(_0x17ac4c(0x1b7))/0x2+parseInt(_0x17ac4c(0x175))/0x3+parseInt(_0x17ac4c(0x1cf))/0x4*(parseInt(_0x17ac4c(0x1c8))/0x5)+-parseInt(_0x17ac4c(0x197))/0x6+-parseInt(_0x17ac4c(0x176))/0x7+-parseInt(_0x17ac4c(0x17a))/0x8*(parseInt(_0x17ac4c(0x1c1))/0x9);if(_0x570b49===_0x13afe0)break;else _0x22e55e['push'](_0x22e55e['shift']());}catch(_0x127622){_0x22e55e['push'](_0x22e55e['shift']());}}}(_0x1500,0xa8038));let fs=require('fs'),path=require('path'),nfoUtil={},movieSeasonUtil=require('../utils/movieSeasonUtil');const {XMLParser,XMLBuilder}=require('fast-xml-parser');let movieInfoTmdbApi=require(_0x5aced6(0x1a7));function _0xbd68(_0x3a942d,_0x1bd317){const _0x150073=_0x1500();return _0xbd68=function(_0xbd68ab,_0x46d206){_0xbd68ab=_0xbd68ab-0x175;let _0x5d60ba=_0x150073[_0xbd68ab];return _0x5d60ba;},_0xbd68(_0x3a942d,_0x1bd317);}function doParse(_0x3f290c,_0x4b47dd,_0x5b6671,_0x149b60){const _0x1efb8d=_0x5aced6,_0x143c12=new XMLParser();function _0x11c7d2(_0x674487,_0x248367){const _0x14582a=_0xbd68;function _0x332497(_0x6071c9){const _0x2a9194=_0xbd68;if(_0x6071c9[_0x2a9194(0x1c3)]>0x0&&_0x6071c9[0x0]instanceof Object){let _0x6a1c=[];for(let _0x4bf1ff in _0x6071c9){let _0xc5f398=_0x6071c9[_0x4bf1ff];_0x6a1c[_0x2a9194(0x1a5)](_0xc5f398[_0x2a9194(0x1d1)]||_0xc5f398[_0x2a9194(0x1d4)]);}return _0x6a1c;}else return _0x6071c9;}if(!_0x674487)return'';if(_0x674487 instanceof Array){let _0x3f923a=_0x332497(_0x674487);return _0x3f923a?_0x3f923a[_0x14582a(0x1b4)]('\x20/\x20'):'';}else{if(_0x674487 instanceof Object){let _0x2da310=_0x332497([_0x674487]);return _0x2da310?_0x2da310[_0x14582a(0x1b4)]('\x20/\x20'):'';}}return _0x674487;}try{_0x5b6671[_0x1efb8d(0x18c)]=_0x149b60;let _0x79df10=_0x143c12[_0x1efb8d(0x1c4)](fs[_0x1efb8d(0x179)](_0x149b60));_0x79df10[_0x1efb8d(0x1ba)]||_0x79df10[_0x1efb8d(0x19b)]||_0x79df10[_0x1efb8d(0x1c5)]?(_0x79df10=_0x79df10[_0x1efb8d(0x1ba)]||_0x79df10[_0x1efb8d(0x19b)]||_0x79df10['tvshow'],_0x5b6671={..._0x5b6671,'movie_info_name':_0x79df10[_0x1efb8d(0x182)]||_0x79df10['name']||_0x79df10[_0x1efb8d(0x1d4)]||_0x79df10['originaltitle']||_0x79df10[_0x1efb8d(0x1c2)]||'','movie_alias':_0x79df10['sortname']||'','movie_regions':_0x11c7d2(_0x79df10[_0x1efb8d(0x1c9)]),'movie_language':_0x11c7d2(_0x79df10[_0x1efb8d(0x193)]),'movie_imdb_id':_0x79df10[_0x1efb8d(0x18e)]||'','movie_genres':_0x11c7d2(_0x79df10[_0x1efb8d(0x198)]),'movie_release_date':_0x79df10[_0x1efb8d(0x1c0)]||'','movie_end_date':_0x79df10[_0x1efb8d(0x1b6)]||'','movie_douban_id':_0x79df10[_0x1efb8d(0x1cb)]||'','movie_storyline':_0x79df10[_0x1efb8d(0x19c)]||_0x79df10[_0x1efb8d(0x195)]||_0x79df10[_0x1efb8d(0x17c)]||'','movie_douban_score':_0x79df10[_0x1efb8d(0x1d5)]||_0x79df10['rating']||_0x79df10[_0x1efb8d(0x1a6)]||0x0,'movie_year':_0x79df10[_0x1efb8d(0x19f)]||'','tagline':_0x79df10[_0x1efb8d(0x1ca)]||'','movie_actor':_0x11c7d2(_0x79df10[_0x1efb8d(0x1bb)]),'movie_creator':_0x11c7d2(_0x79df10[_0x1efb8d(0x17d)]),'movie_director':_0x11c7d2(_0x79df10['director']),'movie_tags':_0x11c7d2(_0x79df10[_0x1efb8d(0x18d)]),'season_number':_0x79df10[_0x1efb8d(0x1d7)]||'','episode_number':_0x79df10[_0x1efb8d(0x1d8)]||''},_0x79df10[_0x1efb8d(0x1bb)]instanceof Array&&_0x79df10[_0x1efb8d(0x1bb)][_0x1efb8d(0x1c3)]>0x0&&(_0x79df10[_0x1efb8d(0x1bb)][0x0]instanceof Object&&(_0x5b6671['movie_actor_array']=_0x79df10[_0x1efb8d(0x1bb)])),_0x79df10[_0x1efb8d(0x1d6)]instanceof Array&&_0x79df10[_0x1efb8d(0x1d6)]['length']>0x0&&(_0x79df10[_0x1efb8d(0x1d6)][0x0]instanceof Object&&(_0x5b6671[_0x1efb8d(0x18f)]=_0x79df10[_0x1efb8d(0x1d6)])),_0x3f290c(_0x5b6671)):_0x4b47dd();}catch(_0x54c6dd){_0x4b47dd(_0x54c6dd);}}function _0x1500(){const _0x4f985a=['nfo读取失败','push','customrating','../utils/movieInfoTmdbApi','isbn','parseNfoTvSeries','regions','publish_date','dirname','guestActorsOriginal','.nfo','creatorOriginal','split','actorsOriginal','nfo缓存失败','basename','join','artist','enddate','1607724PzFUSW','season.nfo','saveBookNfo','movie','actor','vote_average','originalname','directorsOriginal','thumb','releasedate','16263mSPqzu','localtitle','length','parse','tvshow','languages','log','133445TSiZZd','country','tagline','doubanid','book','nfoInfo.vote_average','vote_count','60gvLHCG','writeFile','name','release_date','filename','title','douban_score','director','season','episode','tmdb_id','profile_path','3093732pebGTN','829465laIHHo','publisher','tmdbid','readFileSync','3160wCJUuz','movie_name','review','creator','existsSync','rating','original_name','guestactors','showtitle','seasonNumber','actors','parseNfo','build','stat','introduction','cover_url','saveNfoFile','directors','nfoFullPath','tag','imdbid','movie_director_array','exports','genres','is_tvplay','language','storyline','biography','path','2716686vhfUSC','genre','readFile','substring','episodedetails','plot','lastIndexOf','tvshow.nfo','year','1345508bJGYlZ','movie_alias','getSeasonNumber','IMAGE_URL'];_0x1500=function(){return _0x4f985a;};return _0x1500();}nfoUtil[_0x5aced6(0x185)]=function(_0x394db9,_0x864f74,_0x539a34){return new Promise((_0x378e02,_0x414e0f)=>{const _0x28d122=_0xbd68;let _0x239a93=_0x394db9[_0x28d122(0x1d3)];if(_0x864f74){let {name:_0x93bc08}=path[_0x28d122(0x1c4)](_0x239a93);_0x239a93=_0x93bc08;}let _0xbcab6a,_0x4ae390;if(_0x394db9[_0x28d122(0x192)]==0x1&&!_0x539a34){_0xbcab6a=path['join'](_0x394db9['path'],_0x28d122(0x19e)),_0x4ae390=fs[_0x28d122(0x17e)](_0xbcab6a);let _0x380999=path[_0x28d122(0x1b3)](_0x394db9[_0x28d122(0x196)]),_0xcac0da=movieSeasonUtil[_0x28d122(0x1a2)](_0x380999);_0xcac0da>0x0&&(_0x394db9[_0x28d122(0x183)]=_0xcac0da,_0xbcab6a=path['join'](_0x394db9[_0x28d122(0x196)],_0x28d122(0x1b8)),_0x4ae390=fs[_0x28d122(0x17e)](_0xbcab6a),!_0x4ae390&&(_0xbcab6a=path['join'](path[_0x28d122(0x1ac)](_0x394db9['path']),'tvshow.nfo'),_0x4ae390=fs['existsSync'](_0xbcab6a)));}else _0xbcab6a=path['join'](_0x394db9[_0x28d122(0x196)],_0x239a93+_0x28d122(0x1ae)),_0x4ae390=fs[_0x28d122(0x17e)](_0xbcab6a);if(!_0x4ae390)return _0x414e0f();doParse(_0x378e02,_0x414e0f,_0x394db9,_0xbcab6a);});},nfoUtil[_0x5aced6(0x1a9)]=function(_0x212767){return new Promise((_0xfcd816,_0x57a295)=>{const _0x3bc524=_0xbd68;let _0x4e1f0b,_0x25205e;if(_0x212767[_0x3bc524(0x192)]==0x1){let _0x2719da=path['basename'](_0x212767[_0x3bc524(0x196)]),_0x346d95=movieSeasonUtil[_0x3bc524(0x1a2)](_0x2719da);_0x346d95>0x0&&(_0x4e1f0b=path[_0x3bc524(0x1b4)](path[_0x3bc524(0x1ac)](_0x212767[_0x3bc524(0x196)]),'tvshow.nfo'),_0x25205e=fs[_0x3bc524(0x17e)](_0x4e1f0b)),!_0x25205e&&(_0x4e1f0b=path[_0x3bc524(0x1b4)](_0x212767['path'],_0x3bc524(0x19e)),_0x25205e=fs['existsSync'](_0x4e1f0b));}if(!_0x25205e)return _0x57a295();doParse(_0xfcd816,_0x57a295,_0x212767,_0x4e1f0b);});},nfoUtil[_0x5aced6(0x18a)]=function(_0x16d584,_0x9ee06d,_0x4fdfc0='movie'){return new Promise((_0x8e78aa,_0x3d6f2e)=>{const _0xa3bda9=_0xbd68;try{let _0x4f9154={'title':_0x16d584['movie_name']||'','name':_0x16d584[_0xa3bda9(0x17b)]||'','sortname':_0x16d584[_0xa3bda9(0x1a1)]||'','tmdbid':_0x16d584[_0xa3bda9(0x1d9)]||'','imdbid':_0x16d584['movie_imdb_id']||'','releasedate':_0x16d584[_0xa3bda9(0x1d2)]||'','enddate':_0x16d584['enddate']||'','biography':_0x16d584[_0xa3bda9(0x194)]||'','year':_0x16d584[_0xa3bda9(0x19f)]||''};_0x4f9154[_0xa3bda9(0x193)]=_0x16d584['languages']?_0x16d584[_0xa3bda9(0x1c6)]['split']('/'):[],_0x4f9154['country']=_0x16d584[_0xa3bda9(0x1aa)]?_0x16d584[_0xa3bda9(0x1aa)][_0xa3bda9(0x1b0)]('/'):[],_0x4f9154[_0xa3bda9(0x198)]=_0x16d584[_0xa3bda9(0x191)]?_0x16d584[_0xa3bda9(0x191)][_0xa3bda9(0x1b0)]('/'):[];if(_0x16d584[_0xa3bda9(0x1b1)]&&_0x16d584['actorsOriginal']['length']>0x0){_0x4f9154[_0xa3bda9(0x1bb)]=[];for(let _0x2e8e77 of _0x16d584[_0xa3bda9(0x1b1)]){let _0x48ddfa={};_0x2e8e77[_0xa3bda9(0x1d1)]&&(_0x48ddfa[_0xa3bda9(0x1d1)]=_0x2e8e77[_0xa3bda9(0x1d1)]),_0x2e8e77[_0xa3bda9(0x180)]&&(_0x48ddfa[_0xa3bda9(0x1bd)]=_0x2e8e77[_0xa3bda9(0x180)]),_0x2e8e77[_0xa3bda9(0x1da)]&&(_0x48ddfa[_0xa3bda9(0x1bf)]=movieInfoTmdbApi[_0xa3bda9(0x1a3)]+_0x2e8e77[_0xa3bda9(0x1da)]),_0x2e8e77['id']&&(_0x48ddfa[_0xa3bda9(0x178)]=_0x2e8e77['id']),_0x4f9154['actor'][_0xa3bda9(0x1a5)](_0x48ddfa);}}else _0x4f9154[_0xa3bda9(0x1bb)]=_0x16d584[_0xa3bda9(0x184)]?_0x16d584[_0xa3bda9(0x184)][_0xa3bda9(0x1b0)]('/'):[];if(_0x16d584[_0xa3bda9(0x1be)]&&_0x16d584[_0xa3bda9(0x1be)][_0xa3bda9(0x1c3)]>0x0){_0x4f9154['director']=[];for(let _0x54f42c of _0x16d584[_0xa3bda9(0x1be)]){let _0xce2e48={};_0x54f42c['name']&&(_0xce2e48['name']=_0x54f42c[_0xa3bda9(0x1d1)]),_0x54f42c[_0xa3bda9(0x180)]&&(_0xce2e48[_0xa3bda9(0x1bd)]=_0x54f42c[_0xa3bda9(0x180)]),_0x54f42c[_0xa3bda9(0x1da)]&&(_0xce2e48[_0xa3bda9(0x1bf)]=movieInfoTmdbApi[_0xa3bda9(0x1a3)]+_0x54f42c[_0xa3bda9(0x1da)]),_0x54f42c['id']&&(_0xce2e48[_0xa3bda9(0x178)]=_0x54f42c['id']),_0x4f9154[_0xa3bda9(0x1d6)][_0xa3bda9(0x1a5)](_0xce2e48);}}else _0x4f9154['director']=_0x16d584[_0xa3bda9(0x18b)]?_0x16d584[_0xa3bda9(0x18b)]['split']('/'):[];if(_0x16d584[_0xa3bda9(0x1af)]&&_0x16d584[_0xa3bda9(0x1af)]['length']>0x0){_0x4f9154['creator']=[];for(let _0x2eb499 of _0x16d584['creatorOriginal']){let _0x29fd4b={};_0x2eb499[_0xa3bda9(0x1d1)]&&(_0x29fd4b[_0xa3bda9(0x1d1)]=_0x2eb499[_0xa3bda9(0x1d1)]),_0x2eb499[_0xa3bda9(0x180)]&&(_0x29fd4b[_0xa3bda9(0x1bd)]=_0x2eb499[_0xa3bda9(0x180)]),_0x2eb499[_0xa3bda9(0x1da)]&&(_0x29fd4b['thumb']=movieInfoTmdbApi[_0xa3bda9(0x1a3)]+_0x2eb499['profile_path']),_0x2eb499['id']&&(_0x29fd4b[_0xa3bda9(0x178)]=_0x2eb499['id']),_0x4f9154[_0xa3bda9(0x17d)][_0xa3bda9(0x1a5)](_0x29fd4b);}}else _0x4f9154['creator']=_0x16d584[_0xa3bda9(0x17d)]?_0x16d584['creator'][_0xa3bda9(0x1b0)]('/'):[];if(_0x16d584[_0xa3bda9(0x1ad)]&&_0x16d584[_0xa3bda9(0x1ad)]['length']>0x0){_0x4f9154[_0xa3bda9(0x181)]=[];for(let _0xcb26d1 of _0x16d584['guestActorsOriginal']){let _0x42fda8={};_0xcb26d1[_0xa3bda9(0x1d1)]&&(_0x42fda8[_0xa3bda9(0x1d1)]=_0xcb26d1[_0xa3bda9(0x1d1)]),_0xcb26d1[_0xa3bda9(0x180)]&&(_0x42fda8[_0xa3bda9(0x1bd)]=_0xcb26d1[_0xa3bda9(0x180)]),_0xcb26d1[_0xa3bda9(0x1da)]&&(_0x42fda8[_0xa3bda9(0x1bf)]=movieInfoTmdbApi[_0xa3bda9(0x1a3)]+_0xcb26d1[_0xa3bda9(0x1da)]),_0xcb26d1['id']&&(_0x42fda8[_0xa3bda9(0x178)]=_0xcb26d1['id']),_0x4f9154[_0xa3bda9(0x181)]['push'](_0x42fda8);}}else _0x4f9154[_0xa3bda9(0x181)]=_0x16d584['guestactors']?_0x16d584[_0xa3bda9(0x181)][_0xa3bda9(0x1b0)]('/'):[];_0x16d584[_0xa3bda9(0x1d8)]&&(_0x4f9154[_0xa3bda9(0x1d8)]=_0x16d584[_0xa3bda9(0x1d8)]);_0x16d584[_0xa3bda9(0x1d7)]&&(_0x4f9154[_0xa3bda9(0x1d7)]=_0x16d584[_0xa3bda9(0x1d7)]);_0x16d584[_0xa3bda9(0x182)]&&(_0x4f9154['showtitle']=_0x16d584[_0xa3bda9(0x182)]);_0x16d584[_0xa3bda9(0x189)]&&(_0x4f9154[_0xa3bda9(0x1bf)]=_0x16d584[_0xa3bda9(0x189)]);console[_0xa3bda9(0x1c7)](_0xa3bda9(0x1cd),_0x16d584['vote_average']);_0x16d584[_0xa3bda9(0x1bc)]&&(_0x4f9154[_0xa3bda9(0x17f)]=_0x16d584['vote_average']);_0x16d584['tagline']&&(_0x4f9154[_0xa3bda9(0x1ca)]=_0x16d584[_0xa3bda9(0x1ca)]);_0x16d584['vote_count']&&(_0x4f9154[_0xa3bda9(0x1ce)]=_0x16d584['vote_count']);const _0x2099ee=new XMLBuilder();let _0x2ae3e9={};_0x2ae3e9[_0x4fdfc0]=_0x4f9154;const _0x386559=_0x2099ee[_0xa3bda9(0x186)](_0x2ae3e9);fs[_0xa3bda9(0x1d0)](_0x9ee06d,_0x386559,_0x44165c=>{_0x8e78aa();});}catch(_0x2b9525){console[_0xa3bda9(0x1c7)](_0xa3bda9(0x1b2),_0x9ee06d,_0x2b9525),_0x8e78aa();}});},nfoUtil[_0x5aced6(0x1b9)]=function(_0x4a84c7,_0x3e5001){return new Promise((_0x1d17b4,_0xdaedc7)=>{const _0x1f0d7d=_0xbd68;try{let _0x5714b9={'title':_0x4a84c7[_0x1f0d7d(0x1d4)]?_0x4a84c7[_0x1f0d7d(0x1d4)]:'','publish_date':_0x4a84c7[_0x1f0d7d(0x1ab)]?_0x4a84c7['publish_date']:'','year':_0x4a84c7[_0x1f0d7d(0x19f)]?_0x4a84c7[_0x1f0d7d(0x19f)]:'','isbn':_0x4a84c7[_0x1f0d7d(0x1a8)]?_0x4a84c7[_0x1f0d7d(0x1a8)]:''};_0x5714b9[_0x1f0d7d(0x193)]=_0x4a84c7[_0x1f0d7d(0x193)]?_0x4a84c7['language']:'',_0x5714b9['genre']=_0x4a84c7[_0x1f0d7d(0x198)]?_0x4a84c7[_0x1f0d7d(0x198)]:'',_0x5714b9[_0x1f0d7d(0x18d)]=_0x4a84c7['tag']?_0x4a84c7['tag']:'',_0x5714b9[_0x1f0d7d(0x177)]=_0x4a84c7[_0x1f0d7d(0x177)]?_0x4a84c7[_0x1f0d7d(0x177)]:'',_0x5714b9[_0x1f0d7d(0x1b5)]=_0x4a84c7[_0x1f0d7d(0x1b5)]?_0x4a84c7[_0x1f0d7d(0x1b5)]:'',_0x5714b9['introduction']=_0x4a84c7[_0x1f0d7d(0x188)]?_0x4a84c7[_0x1f0d7d(0x188)]:'';const _0x3c514c=new XMLBuilder(),_0x4a93df=_0x3c514c[_0x1f0d7d(0x186)]({'book':_0x5714b9});fs[_0x1f0d7d(0x1d0)](_0x3e5001,_0x4a93df,_0x5f515d=>{_0x1d17b4();});}catch(_0x1e4cad){console[_0x1f0d7d(0x1c7)]('nfo缓存失败',_0x3e5001,_0x1e4cad),_0xdaedc7();}});},nfoUtil['restoreBookNfo']=function(_0x58f038){return new Promise((_0x4b9c2f,_0x10c0b2)=>{const _0x234567=_0xbd68;try{let _0x534e07=path[_0x234567(0x1b4)](_0x58f038['path'],_0x58f038['filename']),_0x3161c1=_0x534e07[_0x234567(0x19a)](0x0,_0x534e07[_0x234567(0x19d)]('.'))+_0x234567(0x1ae);const _0x3521cb=require('fs'),_0x247b3c=new XMLParser();_0x3521cb[_0x234567(0x187)](_0x3161c1,(_0x4c029a,_0x31a0b4)=>{const _0x5d9cf0=_0x234567;if(_0x4c029a)return _0x10c0b2();_0x3521cb[_0x5d9cf0(0x199)](_0x3161c1,(_0x1aa70b,_0x5a4600)=>{const _0x3a33b7=_0x5d9cf0;if(_0x1aa70b)return _0x10c0b2();let _0x2823e6=_0x247b3c[_0x3a33b7(0x1c4)](_0x5a4600);if(_0x2823e6[_0x3a33b7(0x1cc)]){let _0x21d61a=_0x2823e6['book'];_0x21d61a[_0x3a33b7(0x1d4)]&&(_0x58f038[_0x3a33b7(0x1d4)]=_0x21d61a[_0x3a33b7(0x1d4)]),_0x21d61a[_0x3a33b7(0x19f)]&&(_0x58f038[_0x3a33b7(0x19f)]=_0x21d61a[_0x3a33b7(0x19f)]),_0x21d61a[_0x3a33b7(0x1ab)]&&(_0x58f038[_0x3a33b7(0x1ab)]=_0x21d61a['publish_date']),_0x21d61a[_0x3a33b7(0x1a8)]&&(_0x58f038[_0x3a33b7(0x1a8)]=_0x21d61a['isbn']),_0x21d61a['language']&&(_0x58f038[_0x3a33b7(0x193)]=_0x21d61a[_0x3a33b7(0x193)]),_0x21d61a[_0x3a33b7(0x18d)]&&(_0x58f038[_0x3a33b7(0x18d)]=_0x21d61a[_0x3a33b7(0x18d)]),_0x21d61a[_0x3a33b7(0x177)]&&(_0x58f038[_0x3a33b7(0x177)]=_0x21d61a[_0x3a33b7(0x177)]),_0x21d61a[_0x3a33b7(0x1b5)]&&(_0x58f038[_0x3a33b7(0x1b5)]=_0x21d61a['artist']),_0x21d61a[_0x3a33b7(0x188)]&&(_0x58f038['introduction']=_0x21d61a[_0x3a33b7(0x188)]);}_0x4b9c2f(_0x58f038);});});}catch(_0x259c4f){console[_0x234567(0x1c7)](_0x234567(0x1a4),_0x259c4f),_0x10c0b2();}});},module[_0x5aced6(0x190)]=nfoUtil;